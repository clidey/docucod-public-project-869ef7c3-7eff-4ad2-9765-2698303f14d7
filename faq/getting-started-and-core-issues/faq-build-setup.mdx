---
title: "Build and Setup Issues"
description: "Guidance for solving installation, build, and integration issues, including C++ standard requirements and troubleshooting CMake/Bazel or environment-related errors. Covers the minimum requirements, common misconfigurations, and essential setup mistakes."
---

# Build and Setup Issues

This page provides targeted guidance to help you successfully install, build, and integrate GoogleTest and GoogleMock in your C++ projects. It addresses the essential system requirements, common pitfalls in build configurations, and troubleshooting strategies related to C++ standards, CMake, Bazel, and platform-specific nuances.

---

## 1. Minimum System Requirements and Environment Setup

To build and run GoogleTest and GoogleMock, ensure your development environment meets the following criteria:

- **C++ Standard Support:** Your compiler and build tools **must support at least C++17**. GoogleTest leverages C++17 features which are critical for successful compilation.

- **Build System:** While GoogleTest provides CMake scripts for most platforms, you may also use Bazel or other build systems. Verify your build system is configured to use C++17 standards.

- **Dependency Threads Support:** GoogleTest uses POSIX threads (pthreads) where available for thread safety. If your environment lacks proper pthread support, you may need to configure GoogleTest manually (see section on tweaking). 

- **Supported Platforms:** Linux, Windows, Mac OS X are fully supported with prebuilt CMake integration and tested configurations.

> <Note>
> Before starting the build, verify your toolchain's C++17 support explicitly, such as setting `-std=c++17` or equivalent in compiler flags.
> </Note>

---

## 2. Setting Up GoogleTest with CMake

GoogleTest includes CMake scripts facilitating an easy build experience across platforms.

### Standalone Build Workflow

1. Clone the GoogleTest repository:

```bash
  git clone https://github.com/google/googletest.git -b main
d```

2. Navigate to the top-level directory, create a `build` directory, and generate build files:

```bash
  cd googletest
  mkdir build
  cd build
  cmake ..
```

   - To build only GoogleTest (excluding GoogleMock), use:

```bash
  cmake .. -DBUILD_GMOCK=OFF
```

3. Build and install (requires administrator privileges for system-wide install):

```bash
  make
  sudo make install
```

4. From this point, your build system can link against the installed GoogleTest libraries.

> <Tip>
> When using Visual Studio or Xcode, CMake generates appropriate solution or workspace files (`.sln` or `.xcodeproj`) that you can open and build within those IDEs.
> </Tip>

### Integrating GoogleTest into Your CMake Project

You can embed the GoogleTest source directly using CMakeâ€™s `FetchContent` or `add_subdirectory()`.

Add the following snippet to your project's `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_file.cpp)
target_link_libraries(my_tests gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

This approach keeps your test and main project binaries consistent with compiler/linker settings.

### Common CMake Configuration Pitfalls

- **C++ Standard Version:** Explicitly set `CMAKE_CXX_STANDARD` to `17` and enforce it with `CMAKE_CXX_STANDARD_REQUIRED` to avoid defaulting to earlier standards.
- **Visual Studio Runtime Mismatch:** Use the CMake option `-Dgtest_force_shared_crt=ON` if your project dynamically links the CRT, to prevent runtime linking errors.

---

## 3. Building with Bazel

Though less documented within GoogleTest core, Bazel users can integrate GoogleTest using WORKSPACE and BUILD files. Ensure your Bazel toolchain supports C++17, and configure dependencies accordingly.

Refer to the community contributions or your Bazel build configuration for specific integration steps.

---

## 4. Essential Setup Mistakes to Avoid

- **Ignoring the C++17 Requirement:** Using older C++ standards will cause compilation errors due to incompatible language features.

- **Not Initializing Testing Framework Properly:** Always call `testing::InitGoogleTest(&argc, argv)` before invoking `RUN_ALL_TESTS()` in your `main()` (unless linking against `gtest_main` or `gmock_main`, which provides a default main).

- **Incomplete Linking:** Failing to link against the correct GoogleTest libraries (`gtest` or `gtest_main`, `gmock` or `gmock_main`) leads to linker errors.

- **Including Incorrect Headers:** Use the single umbrella header:

```cpp
#include <gtest/gtest.h>
```

and for mocking, add

```cpp
#include <gmock/gmock.h>
```

- **Conflicting Macros:** If you experience macro name collisions, use build flags such as `-DGTEST_DONT_DEFINE_TEST=1` and prefix macros with `GTEST_`.

> <Warning>
> Directly including private or internal headers can cause issues; always include public headers.
> </Warning>

---

## 5. Troubleshooting Common Build Issues

### Compilation Errors

- **Error related to missing C++17 features:** Confirm your compiler version supports C++17 and that you're passing appropriate flags (e.g., `-std=c++17` for GCC/Clang).

- **`gtest/gtest.h` not found:** Verify that include directories are correctly set in your build system.

### Linker Errors

- **Undefined references to GoogleTest symbols:** Ensure linking against `gtest` or `gtest_main` libraries.

- **Mismatched CRT settings on Visual Studio:** Use the `gtest_force_shared_crt` option to align runtime linkage.

### Runtime Issues

- **Tests not discovered or run:** Ensure tests are registered properly and that `RUN_ALL_TESTS()` is called once.

- **Unrecognized flags or test execution errors:** Call `testing::InitGoogleTest(&argc, argv)` before running tests.

### Multi-threading Support

- By default, GoogleTest is thread-safe on platforms with pthread support.
- If you experience threading related build or runtime problems, define macro `-DGTEST_HAS_PTHREAD=0` or `1` as appropriate.

---

## 6. Practical Tips and Best Practices

- Use `gtest_main` and `gmock_main` to avoid writing your own `main()` unless custom initialization is required.
- For mocking needs, remember `gmock_main` initializes both GoogleMock and GoogleTest.
- Regularly update your GoogleTest version to benefit from fixes and enhancements.
- Organize your build system to isolate GoogleTest building and linking clearly to avoid conflicts and ease maintenance.

---

## 7. Example: Minimal CMake `CMakeLists.txt` for Testing

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProjectTests CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(
  my_tests
  test_mycode.cpp
)

target_link_libraries(
  my_tests
  gtest_main
)

include(GoogleTest)
gtest_discover_tests(my_tests)
```

Build this project with:

```bash
mkdir build
cd build
cmake ..
make
./my_tests
```

---

## 8. Summary Checklist Before Build

- [ ] Confirm C++17 support and specify it.
- [ ] Use the recommended build system integration (CMake with FetchContent or subdirectory).
- [ ] Link against appropriate libraries (`gtest_main`/`gmock_main`).
- [ ] Initialize testing framework in your `main()` (or use provided main).
- [ ] Avoid macro collisions with compile-time flags.
- [ ] Confirm pthread support or configure `GTEST_HAS_PTHREAD` macro.

---

## 9. Getting Further Help

- Review the [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) for basic setup.
- Consult [Installation Instructions by Platform](../getting-started/setup-and-installation/installation-platforms.md) for platform-specific guidance.
- Explore [Troubleshooting and Validation](../getting-started/first-test-experience/troubleshooting-and-validation.md) for runtime issues.
- Join community discussions or report issues on the [GoogleTest GitHub](https://github.com/google/googletest).

---

## Related Documentation

- [GoogleTest Primer](../docs/primer.md)
- [Installation Instructions by Platform](../getting-started/setup-and-installation/installation-platforms.md)
- [Initial Configuration and Integration](../getting-started/setup-and-installation/initial-configuration.md)
- [Integration with Build Systems (CMake, Bazel)](../guides/patterns-integration/build-integration.md)
- [Troubleshooting and Common Setup Issues](../getting-started/first-test-experience/troubleshooting-and-validation.md)


---

With precise configuration and adherence to these guidelines, you will establish a robust testing foundation using GoogleTest and GoogleMock, ensuring a streamlined development experience across diverse environments.
