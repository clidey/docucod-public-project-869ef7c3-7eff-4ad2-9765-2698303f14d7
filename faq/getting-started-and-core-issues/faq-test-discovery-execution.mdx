---
title: "Test Discovery and Execution Problems"
description: "Explains how tests are found and run, resolving issues with test visibility, missing tests, and execution anomalies. Covers running tests in different environments and ensuring consistent test execution across platforms."
---

# Test Discovery and Execution Problems

This page explains how GoogleTest finds and runs your tests, and helps you resolve common issues related to test visibility, missing tests, and execution anomalies. It guides you through running tests across different environments and platforms, ensuring your tests are discovered and executed consistently.

---

## 1. How Does GoogleTest Discover Tests?

GoogleTest automatically discovers tests based on the macros you use (`TEST`, `TEST_F`, `TEST_P`, etc.) during program startup. These macros register tests with the framework so that when you invoke `RUN_ALL_TESTS()`, all registered tests are executed.

### Key Points

- Tests must be compiled and linked into your test binary.
- Test registration occurs statically when the test binary starts.
- `RUN_ALL_TESTS()` executes every registered test.
- Tests are isolated and executed independently.

### Common Pitfall

If your tests are not discovered:

- Confirm that test source files are part of the build.
- Ensure the file contains valid GoogleTest macros.
- Verify that the program calls `RUN_ALL_TESTS()`.

---

## 2. Why Are Some Tests Missing?

If some tests don't appear in the output or are skipped:

- They might be excluded due to test filters (e.g., `--gtest_filter`). Check command-line arguments.
- The tests might be disabled using `DISABLED_` prefix, which prevents execution.
- Linking issues may exclude some object files or translation units.

### Troubleshooting Steps

<Steps>
<Step title="Check Test Filters">
Run your test binary with no filters and examine if all tests appear:

```bash
./my_test_binary --gtest_list_tests
```

If filtered, adjust the filters accordingly or remove them.
</Step>
<Step title="Ensure Tests Are Not Disabled">
Tests with names beginning with `DISABLED_` will not run by default. Rename to enable.
</Step>
<Step title="Verify Build/Link Setup">
Make sure all source files containing tests are compiled and linked.
</Step>
</Steps>

---

## 3. Addressing Test Execution Anomalies

Sometimes tests fail to run correctly or hang:

- Confirm you have a valid test `main()` function or link with the provided `gtest_main` or `gmock_main` libraries, which include a suitable entry point.
- Make sure `InitGoogleTest()` (or `InitGoogleMock()`) is called before running tests, passing in `argc` and `argv` to parse flags.
- Verify that `RUN_ALL_TESTS()` is called and its return value is used as the program exit code.

### Example `main()` in Your Test

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

If using GoogleMock, use `InitGoogleMock()` instead:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 4. Running Tests in Different Environments

### On Embedded and Special Platforms

GoogleTest provides alternative `setup` and `loop` functions, like for ESP8266 or ESP32, instead of `main()`. Example:

```cpp
void setup() {
  testing::InitGoogleMock();
}
void loop() {
  RUN_ALL_TESTS();
}
```

### On Windows with Unicode

Windows users compiling with Unicode may use wide-character versions of initialization functions.

---

## 5. Controlling Test Execution

### Test Filtering

You can run only specific tests by using the `--gtest_filter` flag:

```bash
./my_test_binary --gtest_filter=TestSuiteName.TestName
```

Wildcards (`*` and `-` for excluding tests) are supported.

### Test Sharding

Use environment variables to distribute tests across shards for parallelism.

---

## 6. Debugging Test Discovery and Execution Issues

### Increasing Verbosity

Use the flag `--gtest_print_time=1` to see test timings.

For GoogleMock failures, increase verbosity with:

```bash
./my_test_binary --gmock_verbose=info
```

which shows detailed information about mock expectations and calls.

### Checking Test Registration

Invoke:

```bash
./my_test_binary --gtest_list_tests
```

to list all tests detected by GoogleTest. If your tests don't appear here, they are not registered.

---

## 7. Best Practices to Avoid Test Discovery & Execution Problems

- Always call `InitGoogleTest()` or `InitGoogleMock()` appropriately.
- Have a single call to `RUN_ALL_TESTS()` in your `main()`.
- Ensure all test source files are included in your build.
- Avoid mixing tests with different frameworks without care.
- Use `gtest_main` or `gmock_main` libraries for convenience when possible.
- Use descriptive test and suite names without special characters or underscores.

---

## 8. Additional Resources

- [GoogleTest Primer](primer.md): for writing simple test cases.
- [Building and Running Your Test Suite](getting-started/first-test-experience/building-and-running-tests.md).
- [Troubleshooting and Common Setup Issues](getting-started/first-test-experience/troubleshooting-and-validation.md).
- [GoogleMock for Dummies](docs/gmock_for_dummies.md): for mocking-specific test usage.
- [Mocking Reference](docs/reference/mocking.md): comprehensive mock API.

---

## Diagram: GoogleTest Test Discovery & Execution Flow

```mermaid
flowchart TD
  A[Compiled Test Source Files with TEST Macros]
  B[Test Registration at Startup]
  C[InitGoogleTest or InitGoogleMock]
  D[RUN_ALL_TESTS() Called]
  E[Tests Run One by One]
  F{All Tests Passed?}
  G[Exit Code 0]
  H[Exit Code 1]

  A --> B
  B --> C
  C --> D
  D --> E
  E --> F
  F -->|Yes| G
  F -->|No| H

  click A "/guides/core-workflows/getting-started" "How to write and register tests"
  click C "/api-reference/core-testing-apis/test-execution" "Test initialization details"
  click D "/docs/primer.md#invoking-the-tests" "How RUN_ALL_TESTS works"
```

---