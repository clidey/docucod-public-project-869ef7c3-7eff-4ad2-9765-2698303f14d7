---
title: "How do I install, build, or upgrade GoogleTest/GoogleMock?"
description: "Offers solutions to common build and installation issues, including differences between Bazel and CMake setups, and tips for resolving initial project integration challenges. Directs users to quickstart guides and package configuration details."
---

# How do I install, build, or upgrade GoogleTest/GoogleMock?

GoogleTest and GoogleMock provide flexible, modern C++ testing and mocking frameworks that are straightforward to install and build across various platforms and build systems. This FAQ focuses on guiding you through common installation and build scenarios, resolving issues specific to different environments, and offering tips on upgrading or configuring your setup effectively.

---

## 1. Supported Installation Methods

GoogleTest and GoogleMock can be integrated into your project build environment primarily via CMake or Bazel. Both methods are well-supported and come with detailed workflows to ensure smooth setup.

### Building with CMake

CMake is a widely used cross-platform build system. GoogleTest includes a community-maintained CMake build script that automates configuration and compilation.

#### Standalone GoogleTest Build

To build GoogleTest (and GoogleMock) as a standalone project:

```bash
# Clone the GoogleTest repository at a stable release tag
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
mkdir build
cd build

# Generate build files, including GoogleMock by default
cmake ..

# To build only GoogleTest, disable building GoogleMock
# cmake .. -DBUILD_GMOCK=OFF

# Build the libraries and tests
make

# (Optional) Install system-wide with elevated privileges
sudo make install
```

- On Windows, Visual Studio project files (`.sln`/`.vcproj`) will be generated.
- On macOS, an Xcode project file (`.xcodeproj`) will be generated.

#### Incorporating GoogleTest into Your CMake Project

To use GoogleTest as part of your existing CMake project, you can:

- Import pre-installed GoogleTest using `find_package(GTest CONFIG REQUIRED)` and link with `GTest::gtest` or `GTest::gmock`.
- Embed the GoogleTest source code directly into your project.
- Add GoogleTest as a Git submodule.
- Use CMake's `FetchContent` to automatically download GoogleTest during configure:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows runtimes
FetchContent_MakeAvailable(googletest)

# Then link your tests
add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

##### Important CMake Notes:

- Requires CMake 3.14 or newer for `FetchContent_MakeAvailable()`.
- The `gtest_force_shared_crt` option resolves common Visual Studio runtime linkage errors by using the dynamic CRT.
- The build requires a C++17-compliant compiler.

### Building with Bazel

For Bazel users, GoogleTest and GoogleMock can be added to your workspace using an http_archive rule. Your BUILD files should declare dependencies on the provided Bazel targets.

- Add GoogleTest to your workspace `WORKSPACE` file.
- Use declared targets in your Bazel test rules.
- Run tests with `bazel test //path/to:test_target`.

For complete instructions, see the [installation_bazel documentation](/getting_started/requirements_installation/installation_bazel).

---

## 2. Quickstart and Basic Integration Tips

- Always verify your compiler supports **C++17**, as GoogleTest requires it.
- Use `gtest_main` or `gmock_main` libraries that provide a standard `main()` function to simplify test executables.
- Make sure your include directories and linked libraries are consistent between your tests and GoogleTest/GoogleMock to avoid linkage and runtime issues.
- For embedded platforms like Arduino or specialized OSes, main entry points vary. GoogleTest and GoogleMock provide platform-specific entry points (e.g., with `setup()`/`loop()` for Arduino).

---

## 3. Differences Between Bazel and CMake Setups

| Aspect                | Bazel                                          | CMake                                            |
|-----------------------|------------------------------------------------|--------------------------------------------------|
| Build System          | Declarative BUILD files, remote dependencies   | Generates native makefiles or project files      |
| Integration          | Uses WORKSPACE/http_archive + BUILD targets    | Includes subdirectory or FetchContent to download |
| Test Recipes         | Uses Bazel test rules                           | Uses `add_test()` for CTest/CTest integration      |
| Mock Libraries       | Linked via Bazel targets                        | Linked via `target_link_libraries()`             |
| Cross-platform       | Supported, integrated with Bazel CI             | Supported on all CMake-supported platforms        |

---

## 4. Common Installation and Build Issues

### 4.1. Compiler Compatibility and C++ Standard

If you encounter errors related to unsupported language features, verify your compiler version supports C++17 (GCC 7+, Clang 5+, MSVC 2017+).

Add the following to your build to enforce C++17:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### 4.2. Runtime Library Mismatch on Windows

Visual Studio projects default to dynamic C runtime linkage, but GoogleTest links statically by default, causing linker errors like:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

Resolve this by enabling `gtest_force_shared_crt` in CMake:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### 4.3. Missing Pthread or Threading Support

On *nix systems, link against pthread when GoogleTest detects it is available:

- CMake script normally adds this automatically.
- Manually add `-pthread` if building outside CMake.

For environments that don't support threads, disable with

```cmake
-DGTEST_HAS_PTHREAD=0
```

### 4.4. Linker Failures or Missing Symbols

Verify that your test binary links with either `gtest_main` (for GoogleTest) or `gmock_main` (for GoogleMock) to provide the `main()` entry point.

If you define your own `main()`, link only with `gtest` or `gmock`.

---

## 5. Tips for Upgrading GoogleTest/GoogleMock

- Check the repository tags to track the latest stable versions.
- Update your remote download URLs for `FetchContent` or Bazel `http_archive` to point to the new commit or release tag.
- Review `ChangeLog` and `Breaking Changes` documentation for migration notes.
- Rebuild dependent projects completely after upgrading to avoid ABI or symbol conflicts.

---

## 6. Understanding Package Configuration and Linking

GoogleMock installs pkg-config `.pc` files, like `gmock_main.pc`, which define variables for include directories, library paths, and dependencies:

```
Name: gmock_main
Description: GoogleMock (with main() function)
Version: 1.17.0
URL: https://github.com/google/googletest
Requires: gmock = 1.17.0
Libs: -L${libdir} -lgmock_main -lpthread
Cflags: -I${includedir} -DGTEST_HAS_PTHREAD=1
```

This enables interoperability with automated build tools that query these package files for flags.

---

## 7. Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) — Comprehensive introduction and basic examples.
- [Quickstart Installation Guide](/guides/getting-started/quickstart-installation) — Step-by-step installation instructions.
- [Integration with Build Systems](/overview/integration-feature-overview/integration-build-systems) — Details on integrating with CMake, Bazel, CI tools.
- [Troubleshooting Setup Issues](/getting_started/first_test_and_validation/troubleshooting_setup) — Common errors and resolutions.

---

## 8. Summary

By selecting the build system that matches your environment (CMake or Bazel), following the step-wise instructions for cloning, configuring, building, and linking GoogleTest and GoogleMock, you will establish a robust foundation for your C++ testing workflows. Attention to compiler versions, threading, linkage, and platform specifics guarantees a smooth setup. Upgrading is manageable by updating dependency references and reviewing changelogs.

If you encounter hurdles, explore related troubleshooting documentation, and leverage community knowledge via GitHub and official resources.


---

## Example: Minimal CMake Test Setup

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTests LANGUAGES CXX)

# Download and provide GoogleTest package
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.12.1.tar.gz
)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main)

include(GoogleTest)
gtest_discover_tests(my_test)
```

---

## Platform-Specific Notes

- **Windows:** Use Visual Studio with the option to enable `gtest_force_shared_crt`.
- **Linux/macOS:** Ensure pthread and proper compiler flags are set.
- **Embedded/Arduino:** Use provided platform entry points (`setup()` and `loop()`), linking with GoogleTest/Mock as appropriate.

---