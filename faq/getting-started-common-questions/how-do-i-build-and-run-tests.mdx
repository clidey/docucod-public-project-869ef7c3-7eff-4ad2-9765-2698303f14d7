---
title: "How do I build and run tests with GoogleTest/GoogleMock?"
description: "A step-by-step summary of how to build and execute tests using supported build systems (e.g., CMake, Bazel). Covers setup requirements, core commands, and key configuration steps for running tests seamlessly across platforms."
---

# FAQ: How Do I Build and Run Tests with GoogleTest/GoogleMock?

GoogleTest and GoogleMock support powerful, platform-independent testing for C++ projects. This FAQ guides you through building and running your tests seamlessly using supported build systems, focusing on **setup requirements**, **core commands**, and **key configuration steps** for running tests across platforms like Linux, Windows, and Mac.

---

## 1. How do I set up my environment to build tests with GoogleTest and GoogleMock?

To build and run tests, you first need to install GoogleTest/GoogleMock and integrate them with your build system:

- **Install GoogleTest/GoogleMock:**
  - You can clone the repository or install from packages.
  - Recommended approach is via [CMake](https://cmake.org/) or [Bazel](https://bazel.build/).

- **Build System Integration:**
  - For **CMake:**
    - Use the provided `CMakeLists.txt` scripts in the GoogleTest repository.
    - You can build GoogleTest as a standalone project or embed it in your project.
    - Run these commands in your terminal:

      ```bash
      git clone https://github.com/google/googletest.git -b main
      cd googletest
      mkdir build && cd build
      cmake ..           # Use -DBUILD_GMOCK=OFF to build only GoogleTest
      make
      ```

  - For **Bazel:**
    - Add GoogleTest as a dependency in your WORKSPACE and BUILD files.
    - Use Bazel commands to build and run tests.

- **Compiler and Platform Requirements:**
  - A C++17-compliant compiler is required.
  - GoogleTest is supported across major platforms including Linux, Windows, and Mac.

Refer to the [System Requirements](https://github.com/google/googletest/blob/main/docs/getting-started/prerequisites-installation/system-requirements.md) and [Installation Methods](https://github.com/google/googletest/blob/main/docs/getting-started/prerequisites-installation/installation-methods.md) for detailed environment setup.

---

## 2. How do I write and register tests?

- Use the `TEST()` macro to define simple tests.
- Use `TEST_F()` for tests that require a fixture (shared test environment).
- For parameterized tests, use `TEST_P()` with corresponding `INSTANTIATE_TEST_SUITE_P()`.
- Typed and type-parameterized tests use `TYPED_TEST()` and `TYPED_TEST_SUITE()` macros.

Example of a simple test:

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}
```

Example of a test fixture:

```cpp
class QueueTest : public testing::Test {
 protected:
  Queue<int> queue_;
};

TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(queue_.size(), 0);
}
```

You don't need to explicitly register tests by name; `TEST()` and related macros handle registration automatically.

See [Writing Tests](https://github.com/google/googletest/blob/main/docs/guides/core-workflows/writing-first-tests.md) for more examples.

---

## 3. How do I build my test executable?

- **Using CMake:**
  - Include GoogleTest sources or link against installed `gtest` libraries.
  - Link your test executable against `gtest` or `gtest_main`.

Example CMake snippet for a test executable:

```cmake
add_executable(my_test test_file.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

- **Using Bazel:**
  - Define `cc_test` targets with GoogleTest dependencies.

- **Manual Compilation:**
  - Compile your test files with the GoogleTest sources.
  - Link all object files with `-lgtest` or static libraries.

Make sure the compiler supports at least C++17 standards.

---

## 4. How do I run my tests once built?

- The test executable runs all registered tests by default.
- Tests are run by calling `RUN_ALL_TESTS()` in `main()`.
- You may link with `gtest_main` or `gmock_main` libraries to avoid writing your own `main()`.

Basic usage in a custom `main()`:

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Run your test executable simply by running:

```bash
./my_test
```

### Controlling test execution:

Use various command-line flags:

- `--gtest_filter=TestSuite.TestName` to run specific tests.
- `--gtest_repeat=N` to run tests multiple times.
- `--gtest_shuffle` to randomize test order.
- `--gtest_list_tests` to list all tests without running.
- `--gtest_output=xml:report.xml` or `json:report.json` to generate reports.

See [Configuring and Running Tests](https://github.com/google/googletest/blob/main/docs/api-reference/core-testing-api/running-and-configuring-tests.md) for all flag options.

---

## 5. How do I use GoogleMock and run tests that include mocks?

- GoogleMock depends on GoogleTest and provides mocking capabilities.
- Link your test executable against `gmock_main` for an entry-point with mocks enabled.
- Use `testing::InitGoogleMock()` in place of `InitGoogleTest()`.

Example `main()` for GoogleMock:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Write mock classes and set expectations using GoogleMock macros.
- Building and running tests is the same as with GoogleTest, just ensure you link with `gmock` and initialize correctly.

---

## 6. What are some common build and run troubleshooting tips?

- **Cannot find headers or libs:** Check your build system include paths and library linking.
- **Multiple definitions or linkage errors:** Avoid mixing static and shared versions of gtest/gmock; ensure consistent runtime linkage (especially on Windows).
- **Tests not running or filtered out:** Verify `--gtest_filter` values, and check for `DISABLED_` prefixes on tests/suites.
- **Return value always zero:** Ensure your `main()` returns `RUN_ALL_TESTS()`. This return value indicates success or failure to external systems.

<Tip>
Run your tests with the `--help` flag to see all available runtime options and debug output.
</Tip>

See [Troubleshooting Common Setup Issues](https://github.com/google/googletest/blob/main/docs/getting-started/validation-troubleshooting/common-issues.md) for more detailed resolutions.

---

## 7. How do I customize my test's main entry point?

- You generally do *not* need to write your own `main()`.
- If you need custom pre-test setup or environment registration, write a `main()` that calls `testing::InitGoogleTest()` (or `InitGoogleMock()`), set up your custom behavior, then call `RUN_ALL_TESTS()`.

Example customized `main()`:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);

  // Custom initialization here.

  return RUN_ALL_TESTS();
}
```

- On embedded or unusual platforms, you may use the provided platform-specific entry points.

- When integrating into existing frameworks or runners, consider using GoogleTest event listeners for custom output or behavior.

---

## 8. What build options should I consider for CMake projects?

- Use `-DBUILD_GMOCK=ON` to build GoogleMock alongside GoogleTest.
- Use `gtest_force_shared_crt` option to match Visual Studio runtime linking.
- Specify C++ standard via `-DCMAKE_CXX_STANDARD=17`.
- Prefer `FetchContent` or `add_subdirectory` to embed GoogleTest sources in your project for consistent builds.

Example snippet for embedding:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main)
```

Refer to the [GoogleTest README - Build Instructions](https://github.com/google/googletest/blob/main/README.md) for detailed guidance.

---

## 9. How can I integrate test execution into CI/CD pipelines or IDEs?

- Tests can be executed from CLI with arguments controlling them.
- Use `--gtest_output=xml` to generate reports parsable by CI tools (e.g., Jenkins, GitLab).
- IDEs like Visual Studio, CLion, or VSCode often detect GoogleTest tests automatically if the project is correctly configured.
- Use standard test entry points (`RUN_ALL_TESTS()`) to enable integration.

For specific integration examples, see the [Integration Entry Points & Ecosystem Support](https://github.com/google/googletest/blob/main/docs/overview/architecture-features/integration-entrypoints.md).

---

## Additional Resources
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md): Learn test-writing basics.
- [Testing Reference](https://github.com/google/googletest/blob/main/docs/reference/testing.md): Detailed macro and API reference.
- [Advanced Testing Strategies](https://github.com/google/googletest/blob/main/docs/advanced.md): For advanced usage (parameterized tests, death tests).
- [GoogleMock Getting Started](https://github.com/google/googletest/blob/main/googlemock/README.md): For mocking usage.
- [FAQ: What is GoogleTest & GoogleMock and how do I use them?](https://github.com/google/googletest/blob/main/faq/getting-started-common-questions/what-is-googletest-and-googlemock.md)

---

This FAQ page fits into our documentation ecosystem by linking foundational build and run practices from the Getting Started and Guides sections, enabling smooth onboarding and steady progression to more advanced workflows like parameterized tests and mocking integration.

---

<AccordionGroup title="Common Troubleshooting and Tips">
<Accordion title="Tests Not Running or Executed Unexpectedly">
Check for `DISABLED_` prefix on test or test suites which disables them by default.
Use `--gtest_filter` carefully with correct patterns to match desired tests.
Verify that you don't have conflicting test names or namespaces.
</Accordion>
<Accordion title="Build or Link Errors">
Ensure consistent runtime settings, especially on Windows (dynamic vs static CRT).
Use CMake options like `gtest_force_shared_crt`.
Confirm that all required source files and libraries are linked.
</Accordion>
<Accordion title="Test Output Unexpected Behavior">
Use `--gtest_list_tests` to verify which tests are registered.
Enable verbose or XML output for detailed logs.
Check that `main()` returns `RUN_ALL_TESTS()`'s return value.
</Accordion>
</AccordionGroup>
