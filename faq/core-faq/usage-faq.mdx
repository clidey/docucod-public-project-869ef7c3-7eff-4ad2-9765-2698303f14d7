---
title: "Writing and Running Tests"
description: "Addresses frequently encountered questions about writing test cases, using assertions, organizing test suites, and running tests using various tools. Guides users in adopting best practices for structuring and executing tests."
---

# Writing and Running Tests

This page addresses frequently encountered questions about writing test cases, using assertions, organizing test suites, and running tests using various tools. It guides you in adopting best practices for structuring and executing tests effectively with GoogleTest.

---

## 1. Writing Test Cases: Getting Started

Writing effective tests with GoogleTest begins with understanding the fundamental building blocks: **assertions**, **tests**, and **test suites**.

### What is a Test?

A *test* verifies a specific behavior or output from your code. It typically exercises a particular function path with defined input and checks the resulting output using assertions.

### Using `TEST()` Macro

To define a basic test, use the `TEST(TestSuiteName, TestName)` macro:

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(8), 40320);
}
```

- **Test Suite Name** groups logically related tests.
- **Test Name** describes the individual scenario verified.

**Best Practice:** Avoid underscore characters (`_`) in test suite and test names to prevent naming conflicts and maintain compatibility.

### Using Assertions to Validate Behavior

Assertions are the conditions you expect your code to satisfy. GoogleTest provides both nonfatal (`EXPECT_*`) and fatal (`ASSERT_*`) assertions.

- `EXPECT_*` allows the test to continue after a failure, revealing multiple issues.
- `ASSERT_*` aborts the current test function immediately on failure.

For example:

```cpp
ASSERT_EQ(ptr, nullptr) << "Pointer should be null before initialization";
EXPECT_TRUE(value > 0) << "Value must be positive";
```

Use custom failure messages streamed after assertions to clarify failures.

---

## 2. Organizing Tests with Fixtures and Suites

Complex tests often need shared objects or setup steps to reduce repetition. GoogleTest provides **test fixtures** and grouping via **test suites** for this purpose.

### Using Test Fixtures with `TEST_F()`

Test fixtures allow multiple tests to reuse the same configuration:

```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    // Setup queue states
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  Queue<int> q0_;
  Queue<int> q1_;
  Queue<int> q2_;
};

TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
}
```

- Use `TEST_F(FixtureClassName, TestName)` to access fixture members.
- Each test runs with a fresh fixture instance.

### Sharing Setup and Teardown Across Tests

- Define `SetUp()` and `TearDown()` methods in your fixture class for per-test setup/cleanup.
- For expensive shared setup, use static methods `SetUpTestSuite()` and `TearDownTestSuite()`.

---

## 3. Parameterized and Typed Tests

To avoid duplicated test code that differs only in input values or types, use parameterized or typed tests.

### Value-Parameterized Tests (`TEST_P` and `INSTANTIATE_TEST_SUITE_P`)

Define a fixture inheriting from `testing::TestWithParam<Type>` and create tests using `TEST_P`. Then instantiate the test suite with input values.

```cpp
class FooTest : public testing::TestWithParam<int> {};

TEST_P(FooTest, HandlesValues) {
  int value = GetParam();
  EXPECT_TRUE(value > 0);
}

INSTANTIATE_TEST_SUITE_P(PositiveValues, FooTest, testing::Values(1, 2, 3));
```

### Typed Tests (`TYPED_TEST_SUITE` and `TYPED_TEST`)

Define template fixture classes and associate them with a list of types. Tests run once per type.

```cpp
template <typename T>
class MyTypedTest : public testing::Test {
 public:
  T value_;
};

using MyTypes = ::testing::Types<int, double>;
TYPED_TEST_SUITE(MyTypedTest, MyTypes);

TYPED_TEST(MyTypedTest, DoesStuff) {
  TypeParam val = this->value_;
  EXPECT_TRUE(val >= 0);
}
```

Both parameterized and typed tests support naming customization and enable scalable test coverage.

---

## 4. Running Tests Effectively

### Running All Tests

After defining tests, use `RUN_ALL_TESTS()` in your program's `main()` function to execute them all:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Always return the result of `RUN_ALL_TESTS()` in `main()`.
- Call `InitGoogleTest()` before running tests to initialize flags.

### Filtering Tests

Run specific tests with the `--gtest_filter` flag:

```shell
./my_test --gtest_filter=FactorialTest.*  # Runs all tests in FactorialTest suite
```

### Sharding and Parallel Execution

GoogleTest supports test sharding with environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` for parallel test execution on multiple machines.

### Advanced Running Options

- Use `--gtest_repeat=N` to run tests multiple times for flakiness detection.
- Use `--gtest_shuffle` to run tests in a random order.
- Use `DISABLED_` prefix to temporarily disable tests.

---

## 5. Writing a Custom `main()` (When Needed)

Most use cases do not require writing a custom `main()`. However, if you need to:

- Add global setup or teardown,
- Process custom command-line flags before tests run,

Use this pattern:

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);

  // Custom pre-test code here

  return RUN_ALL_TESTS();
}
```

Linking with `gtest_main` provides a default `main()`.

---

## 6. Troubleshooting Common Test Writing and Running Issues

### Why are my tests not running?

- Ensure `main()` calls `InitGoogleTest()` and `RUN_ALL_TESTS()`.
- Confirm your test cases are linked properly.
- Disabled tests (prefixed with `DISABLED_`) will not run unless overridden.

### Why do my `ASSERT_*` assertions not abort the entire test?

- Fatal failures abort only the current function.
- Use `ASSERT_NO_FATAL_FAILURE` to wrap subroutine calls and catch fatal failures.
- Alternatively, use event listeners to convert failures into exceptions for higher-level flow control.

### Why might a death test be hanging or failing unexpectedly?

- Death tests run in subprocesses and don't share state with the main process.
- Avoid side effects that must be preserved across death test boundaries.
- Use the "threadsafe" death test style if multithreading causes instability.

### How to avoid naming conflicts?

- Do not use underscores in test suite or test names as GoogleTest constructs internal class names combining these names.

---

## 7. Best Practices for Structuring and Writing Tests

- **Group related tests** into clearly named test suites that reflect the code under test.
- Use **test fixtures** to reduce code duplication and establish consistent test environments.
- Prefer `EXPECT_*` assertions to allow more failures to be detected in one run.
- Use **custom failure messages** to make test failures immediately understandable.
- Always **return `RUN_ALL_TESTS()`** from `main()`.
- Use **parameterized tests** to cover multiple input scenarios without duplicating code.
- Use **mock objects** and expectations (covered elsewhere) when interactions with dependencies need to be controlled or verified.

---

## Related Topics and Documentation

- [GoogleTest Primer](primer.md) — Basic test writing and foundational concepts.
- [Assertions Reference](reference/assertions.md) — Full list of GoogleTest assertions.
- [Testing Reference](reference/testing.md) — Details on test macros and classes.
- [Parameterized and Typed Tests](concepts/advanced-models-and-scalability/parameterized-and-typed-tests.mdx) — Advanced test patterns.
- [Death Tests](api-reference/testing-framework/death-tests.mdx) — Testing for expected process termination.
- [Writing and Running Your First Test](getting-started/first-test-experience/writing-first-test.mdx) — Quick practical tutorial.

---

This page fits within the user journey to help you write robust and maintainable tests, guiding you through test case construction, organization, execution, and best practices for using GoogleTest efficiently.
