---
title: "How to Create and Use Mocks"
description: "Answers questions about implementing mock classes, using essential macros (e.g., MOCK_METHOD), subclassing, and proper inclusion practices. Clarifies which headers to use and points out common pitfalls."
---

# How to Create and Use Mocks

This guide answers common questions about implementing mock classes in GoogleTest using GoogleMock (gMock). It covers the essential macros (like `MOCK_METHOD`), subclassing practices, correct header inclusions, and highlights typical pitfalls to avoid.

---

## 1. Defining Mock Classes with `MOCK_METHOD`

GoogleMock provides the `MOCK_METHOD` macro to declare mock methods within your mock classes. This macro simplifies creating method mocks by automatically generating the necessary boilerplate.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Qualifiers));
```

- **ReturnType**: The return type of the method.
- **MethodName**: The name of the method to mock.
- **ArgTypes**: The argument types enclosed in parentheses.
- **Qualifiers**: Optional list of qualifiers such as `(const)`, `(override)`, `(noexcept)`, or calling conventions.

### Example

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Tips and Common Gotchas

- Place mock method declarations inside the `public:` section regardless of the original method's access level to allow `EXPECT_CALL` and `ON_CALL` to access the mocks.
- For methods with commas in the return or argument types, either wrap the type in extra parentheses or use typedefs/aliases to avoid macro parsing issues.
- Mocking overloaded methods requires declaring **all** overloads you intend to mock to avoid hiding base class methods.

## 2. Constructing Mocks

Mock classes behave like regular C++ classes deriving from your interfaces. You instantiate mock objects just like any other class:

```cpp
MockTurtle turtle;
```

If your mock class or its base has custom constructors, `NiceMock`, `NaggyMock`, and `StrictMock` wrappers will pass arguments through their constructors:

```cpp
NiceMock<MockTurtle> nice_mock(5, "arg");
```

## 3. Setting Expectations with `EXPECT_CALL`

To specify which methods of your mock are expected to be called (and how), use `EXPECT_CALL`:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)         // optional
    .WillRepeatedly(action);  // optional
```

Details:

- `matchers...` describe the expected arguments; use `_` as a wildcard matcher to accept any value.
- Chainable clauses allow control over call count (`Times()`), execution order (`InSequence()`, `After()`), and behavior (`WillOnce()`, `WillRepeatedly()`).

### Examples

```cpp
EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1))
    .WillRepeatedly(Return());
```

```cpp
Sequence s;
EXPECT_CALL(turtle, PenDown()).InSequence(s);
EXPECT_CALL(turtle, Forward(_)).InSequence(s);
EXPECT_CALL(turtle, PenUp()).InSequence(s);
```

## 4. Setting Default Behavior with `ON_CALL`

`ON_CALL` sets default actions for mock methods without creating expectations (i.e., no requirement that the call actually happens). Use this for stubbing without verification:

```cpp
ON_CALL(mock_object, MethodName(matchers...))
    .WillByDefault(action);
```

### Important

- `ON_CALL` does *not* set expectations and won't cause errors if the method is not called.
- When both `ON_CALL` and `EXPECT_CALL` match a call, `EXPECT_CALL` actions take precedence.


## 5. Using NiceMock, NaggyMock, and StrictMock Wrappers

GoogleMock offers three wrappers that modify the behavior of uninteresting calls (calls to mocked methods without expectations):

| Wrapper       | Behavior on Uninteresting Calls                           | Usage Scenario                                   |
|---------------|-----------------------------------------------------------|------------------------------------------------|
| `NiceMock<T>` | Silences warnings, allows any uninteresting calls         | When you want quiet tests that ignore most calls|
| `NaggyMock<T>`| Prints warnings for uninteresting calls (default behavior) | When developing or debugging tests                |
| `StrictMock<T>`| Fails tests on uninteresting calls                         | When you want strict strictness on mocks         |

### Usage

```cpp
NiceMock<MockFoo> mock;
EXPECT_CALL(mock, DoThis());
... use mock ...
```

### Caveats

- These wrappers only affect mock methods declared **directly** with `MOCK_METHOD` in the mock class, not inherited mocks.
- Nesting wrappers (e.g., `NiceMock<StrictMock<MockFoo>>`) is not supported.

## 6. Proper Header Inclusion

- To define mocks and use `EXPECT_CALL` or `ON_CALL`, include:

```cpp
#include <gmock/gmock.h>
```

- For wrappers like `NiceMock`, `NaggyMock`, and `StrictMock`, include the same header.

- If you only want to define nice/strict/naggy mocks wrappers, you may include:

```cpp
#include "gmock/gmock-nice-strict.h"  // Rare usage
```

## 7. Common Pitfalls and Best Practices

### Uninteresting Calls

- An uninteresting call is one to a method with no matching `EXPECT_CALL`.
- By default, this generates a warning (naggy behavior).
- Suppress warnings with `NiceMock` or by explicitly allowing calls with `EXPECT_CALL(...).Times(AnyNumber())`.
- Do **not** suppress by only adding `EXPECT_CALL` without `Times(AnyNumber())` or it will enforce the call unnecessarily.

### Overloading

- If mocking overloaded methods, mock all overloads you use or use `using Base::method;` to avoid unexpected hiding.
- Disambiguate calls in expectations using `Const()` or explicit matcher casts.

### Destructor Mocking

- Mocking a destructor directly is unsupported.
- Instead, add a mock method like `MOCK_METHOD(void, Die, ());` called in the destructor to validate destruction timing.

### Constructor Arguments

- Wrappers inherit constructors of the mock class so pass constructor arguments as usual.

### Sequence and Order

- Use `InSequence` or `After` clauses to control expected order of calls.
- Expectations that are not in any sequence are allowed to be called in any order.

### Verification

- Mocks automatically verify expectations on destruction.
- You can force verification earlier with `Mock::VerifyAndClearExpectations(&mock_obj)`.
- Avoid setting new expectations after verification.

## 8. Example: Basic Mock Usage

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int Bar(int n) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int n), (override));
};

TEST(FooTest, Basic) {
  MockFoo mock;
  EXPECT_CALL(mock, Bar(5))
      .Times(1)
      .WillOnce(testing::Return(10));

  int result = mock.Bar(5);
  EXPECT_EQ(result, 10);
}
```

---

## Related Documentation

- [Mocking Reference](reference/mocking.md) — Comprehensive guide to mocks, matchers, and expectations.
- [gMock for Dummies](guides/gmock_for_dummies.md) — Beginner-friendly introduction to mocking.
- [gMock Cookbook](guides/gmock_cook_book.md) — Recipes for advanced mocking scenarios and best practices.
- [Nice, Naggy, and Strict Mocks (API Reference)](api-reference/mock-configuration-behavior/nice-naggy-strict-mocks.mdx) — Details on wrappers for mock strictness.
- [Mocking APIs and Macros](api-reference/core-testing-apis/mocking-apis.mdx) — Reference on core mocking macros and usage.

---

## Summary

Creating mocks in GoogleMock is made easy via the `MOCK_METHOD` macro, which declares mock methods inside public sections of mock classes. Use `EXPECT_CALL` to define expected calls and behaviors, and `ON_CALL` to provide default behavior without enforcing call counts. Manage uninteresting calls with wrappers like `NiceMock`, `NaggyMock`, and `StrictMock` depending on your verbosity and test strictness needs. Always include `<gmock/gmock.h>` for access to all mocking features, and pay attention to common pitfalls such as correct overload mocking and proper use of constructor arguments with wrappers.

---