---
title: "How do I resolve build and linking errors?"
description: "Solutions for the most frequently reported build and linking problems encountered when integrating or upgrading GoogleTest and GoogleMock. Includes tips for CMake, Bazel, and manually-managed projects, along with advice for platform-specific quirks."
---

# How do I resolve build and linking errors?

Integrating GoogleTest and GoogleMock into your C++ projects can sometimes lead to build and linking issues. This guide addresses the most common errors users encounter during setup or upgrades, providing actionable solutions and platform-specific insights.

---

## 1. Common Causes of Build and Linking Errors

### Missing or Incorrect Header Paths
Failing to include the correct directories for GoogleTest and GoogleMock headers results in compilation errors.

- **Check your include paths**: Ensure your build system points to the correct `googletest/include/` and `googlemock/include/` directories.
- **Relative vs Absolute Paths:** Prefer using absolute or properly resolved relative paths to avoid ambiguity.

### Library Linking Issues
Linker errors commonly occur if GoogleTest or GoogleMock libraries are not linked correctly.

- **Link against the right libraries:** Link with `gtest` or `gtest_main` for GoogleTest, and additionally with `gmock` or `gmock_main` for GoogleMock.
- **Static vs Shared Libraries:** Ensure you link against the library type your build is configured to use. For shared libraries, define `GTEST_LINKED_AS_SHARED_LIBRARY` when compiling your tests.

### Mismatched Runtime Libraries (Windows / MSVC)
Runtime library conflicts, such as mixing static and dynamic CRTs, cause unresolved symbols or runtime crashes.

- **Match runtimes:** Confirm that both GoogleTest/GoogleMock and your project use consistent runtime flags (e.g., `/MTd` vs `/MDd`).
- **Use CMake flag:** In CMake, set `gtest_force_shared_crt` to `ON` if you require dynamic CRT linkage.

### C++ Standard Version Mismatches
GoogleTest requires at least C++17. Building your project with an incompatible standard causes errors.

- **Set compiler standard:** Ensure your build toolchain uses the `-std=c++17` flag or equivalent.

### Compiler or Platform Specific Quirks
Some errors arise from platform or compiler peculiarities.

- **Check compiler version:** GoogleMock requires a minimum of Visual C++ 2015 (MSVC 19.0). Upgrade outdated compilers.
- **Platform macros:** GoogleTest auto-detects platforms, but if detection fails, set macros like `GTEST_HAS_PTHREAD` manually.

---

## 2. Solutions by Build System

### Using CMake

1. **Add GoogleTest/GoogleMock as a Subdirectory or FetchContent**

   ```cmake
   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip)
   FetchContent_MakeAvailable(googletest)

   add_executable(my_test my_test.cc)
   target_link_libraries(my_test PRIVATE gtest_main gmock_main)
   ```

2. **Set the C++ standard explicitly:**

   ```cmake
   set(CMAKE_CXX_STANDARD 17)
   set(CMAKE_CXX_STANDARD_REQUIRED ON)
   ```

3. **Handle MSVC runtime mismatch:**

   ```cmake
   set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
   ```

4. **Inspect include directories:**

   Make sure `gtest` and `gmock` include directories are in your include path through `target_include_directories` or global includes.

### Using Bazel

1. Include GoogleTest and GoogleMock in your `WORKSPACE` as external dependencies.
2. Reference the libraries in your `BUILD` files correctly (usually `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock`).
3. Ensure that the `copts` include `-std=c++17` and that you donâ€™t have conflicting runtime options.

### Manually Managed Builds

- **Include and link paths:** Set your compiler's include paths to the GoogleTest and GoogleMock headers.
- **Link the correct `.a` or `.lib` files:** Depending on static or dynamic linkage.
- **Define necessary macros:** Add `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` if using shared libraries.
- **Compiler flags:** Make sure the compiler uses C++17.

---

## 3. Troubleshooting Tips

### Verify Include and Library Paths
Use verbose build output to verify the actual paths searched by the compiler and linker.

```bash
# gcc example
g++ -I/path/to/googletest/include -I/path/to/googlemock/include ... 

# linker
g++ ... -L/path/to/libs -lgtest -lgmock
```

### Check Symbols and Archive Contents

- Use tools like `nm` on Linux or `dumpbin /symbols` on Windows to ensure symbols are defined in GoogleTest/GoogleMock libraries.

### Consistent Compiler and Flags

- If building your own copy of GoogleTest/GoogleMock, build with the **same compiler** and **flags** as your project.

### Order of Link Libraries

- Google Mock depends on Google Test. For static linking, link `-lgmock -lgtest`, ensuring `gmock` precedes `gtest`.

### Watch for Macro Conflicts

- If conflicting macros cause redefinition errors, use `-DGTEST_DONT_DEFINE_TEST=1` or similar to rename Google Test macros.

### Mismatched Architectures

- Ensure all libraries and your test program are built for the same architecture (e.g., x86_64).

---

## 4. Platform-Specific Notes

### Windows (MSVC)

- Use Visual Studio 2015 or later.
- Match `/MT` or `/MD` runtime library in both GoogleTest and your project.
- Use provided CMake flag `gtest_force_shared_crt` to aid runtime consistency.
- Avoid missing symbols related to `__declspec` by properly defining `GTEST_API_` flags.

### Linux/macOS

- Ensure pthreads support is available and `GTEST_HAS_PTHREAD=1` if needed.
- Link `-lpthread` alongside GoogleTest and GoogleMock.

### Cross-Compiling

- Verify target platform and sysroot settings match for all components.
- Double-check ABI compatibility between your project and testing libraries.

---

## 5. Example CMake Setup for GoogleTest and GoogleMock

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyProject)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Fetch GoogleTest and GoogleMock
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test_main.cpp)
# Link with GoogleMock and GoogleTest
target_link_libraries(my_test PRIVATE gmock_main gtest_main)

# Enable pthreads (Linux/macOS)
if(UNIX)
  find_package(Threads REQUIRED)
  target_link_libraries(my_test PRIVATE Threads::Threads)
endif()

# Handle MSVC runtime library mismatch
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

---

## 6. Further Resources

- [GoogleTest Installation Overview](../getting-started/setup-requirements/installation-overview.md)
- [GoogleMock README](../../googlemock/README.md)
- [Overview: Integration and External Dependencies](../../overview/fundamentals-and-architecture/integration-and-dependencies.md)
- [FAQs on Common Setup Issues](../faq/getting-started-faq/how-to-integrate.md)


---

<Tip>
Always ensure you keep your GoogleTest and GoogleMock versions compatible. For the best developer experience, use the CMake integration or Bazel rules provided officially.
</Tip>

<Warning>
Avoid mixing debug and release variants of GoogleTest/GoogleMock libraries and your project binaries, as that often leads to hard-to-diagnose linking errors or runtime crashes.
</Warning>

<Info>
When switching between static and shared library linking, explicitly define the corresponding macros (`GTEST_CREATE_SHARED_LIBRARY`, `GTEST_LINKED_AS_SHARED_LIBRARY`) in your build system.
</Info>

---

For step-by-step issue resolution, consider:

<Steps>
<Step title="Check Include Paths">
Verify all GoogleTest and GoogleMock headers are found by your compiler.
</Step>
<Step title="Review Library Linking">
Confirm correct libraries (`gtest`, `gmock`, `gtest_main`, `gmock_main`) are linked in the right order.
</Step>
<Step title="Confirm Compiler and Flags">
Match C++ standard and runtime settings between your tests and libraries.
</Step>
<Step title="Build Clean and Rebuild">
Clean any cached or generated files and rebuild to avoid stale artifacts.
</Step>
<Step title="Consult Platform Notes">
Follow platform-specific guidance for Windows, Linux, or macOS.
</Step>
</Steps>

---

This guidance ensures a smooth build process, enabling you to focus on writing and running tests rather than battling build issues.

<Note>
If you continue to face errors after applying these steps, please consider enabling verbose output in your build system and searching the exact error messages at the [GoogleTest GitHub Issues](https://github.com/google/googletest/issues) for community solutions.
</Note>
