---
title: "Why aren't my mocks behaving as expected?"
description: "A targeted FAQ for diagnosing why certain mocks, expectations, or actions do not seem to work. Covers common mistakes with ON_CALL, EXPECT_CALL, NiceMock, StrictMock, and function signatures. Reference best practices and debug checklists."
---

# Why Aren't My Mocks Behaving as Expected?

This FAQ addresses common challenges users encounter when their mocks, expectations, or actions in GoogleMock do not behave as intended. It focuses on typical pitfalls with `ON_CALL`, `EXPECT_CALL`, mock strictness (`NiceMock`, `StrictMock`), and function signatures, guiding you to diagnose and resolve these issues effectively.

---

## 1. Common Questions

### Why is the real method called instead of my mock method?
The method you want to mock **must be virtual** unless you employ advanced dependency injection techniques. If the method is non-virtual, GoogleMock cannot intercept the call and your real method will be invoked instead.

### Can I mock variadic functions (functions using `...`)?
No, you cannot mock variadic functions directly because the mock cannot determine the number and types of arguments at runtime. The recommended workaround is to provide overloaded versions of the function instead.

### Why does MSVC warn about `const` parameters in mock methods?
MSVC has bugs related to overriding virtual functions that differ only by top-level `const` qualifiers in parameters. Since in C++, `const` on parameters passed by value is ignored, the advice is to remove the `const` qualifier on such parameters in both base and mock classes to eliminate these warnings.

### Why do I see warnings about "Uninteresting function calls"?
An uninteresting call is a call to a mock method **without any `EXPECT_CALL` set**. By default, GoogleMock warns about such calls because they might indicate missing expectations. If you expect such calls and want to suppress the warnings, use `NiceMock` or add `EXPECT_CALL(...).Times(AnyNumber())` to express that such calls are allowed.

### How do I make a function never be called?
Simply write an expectation with `.Times(0)`:

```cpp
EXPECT_CALL(mock_obj, Method(_))
    .Times(0);
```
This will cause the test to fail if `Method` is ever called.

---

## 2. Understanding `EXPECT_CALL` and `ON_CALL`

- **`EXPECT_CALL`** defines that a method *must* be called (possibly with constraints on arguments and call counts). It also defines its behavior.
- **`ON_CALL`** defines default behavior *without* any expectation of calls. It tells the mock what to do if the method is called with matching arguments, but does not enforce call occurrence.

**Best Practice:** Use `ON_CALL` to set default behaviors (e.g., in mock constructors or test fixtures). Use `EXPECT_CALL` only when you want to verify that methods are called with specific arguments or in a certain order.


---

## 3. Common Mistakes with `EXPECT_CALL` and `ON_CALL`

### 3.1 Setting Expectations After Calls

Expectations must be set **before** the mock methods are called. Setting `EXPECT_CALL` or `ON_CALL` after the code that invokes the mock method results in undefined behavior and unexpected failures.

### 3.2 Argument Matchers and Overloads

- For **overloaded methods**, you must specify argument matchers explicitly to disambiguate which overload is expected, or use helper utilities.
- If you omit matchers on overloaded methods, the code will not compile.

Example:

```cpp
EXPECT_CALL(mock, OverloadedMethod(An<int>()));
```

### 3.3 Order and Priority of Expectations

GoogleMock matches calls against expectations in *reverse order* of definition. The latest matching expectation takes precedence. To avoid unexpected overrides:

- Place more general expectations (e.g., with `_`) **before** more specific ones.
- Use sequences or explicit ordering (`InSequence`, `After`) when call order matters.


### 3.4 Expectation Stickiness and `RetiresOnSaturation()`

Expectations remain active by default even after reaching their call limit, leading to "too many calls" errors on repeated calls. To make an expectation retire immediately after saturation, use `.RetiresOnSaturation()`:

```cpp
EXPECT_CALL(mock, Method()).Times(3).RetiresOnSaturation();
```

This allows the next matching expectation to be considered for further calls.

### 3.5 Interactions between `EXPECT_CALL` and `ON_CALL`

- `EXPECT_CALL` takes precedence over `ON_CALL` for matching calls.
- Multiple `ON_CALL`s are searched in reverse order; the last matching one applies.
- Omitting `EXPECT_CALL` for a method means calls to it are "uninteresting".

---

## 4. Working with Mock Strictness: `NiceMock`, `NaggyMock`, and `StrictMock`

### Default Behavior
Mock objects by default behave like `NaggyMock`: warnings are issued for uninteresting calls but tests do not fail.

### `NiceMock`
- Suppresses warnings for uninteresting calls.
- Use it when you expect calls but don't care to set explicit `EXPECT_CALL`s.
- Example:
  ```cpp
  NiceMock<MockClass> nice_mock;
  ```

### `StrictMock`
- Treats uninteresting calls as test failures.
- Use it when you want to ensure **only expected calls** occur.
- Example:
  ```cpp
  StrictMock<MockClass> strict_mock;
  ```

### Limitations
- These wrappers only work on mock methods defined **directly** in the mock class with `MOCK_METHOD`.
- They may not work as intended if the mock's destructor is *not* virtual.

---

## 5. Debugging Mock Issues: Troubleshooting Checklist

Follow this step-by-step approach to diagnose why mocks may not behave as expected:

<Steps>
<Step title="Verify Method is Virtual">
Ensure the method you want to mock is declared `virtual` in the base class.
</Step>
<Step title="Check Mock Method Signature">
Match your `MOCK_METHOD` exactly to the base class method signature including constness, noexcept, and reference qualifiers.
</Step>
<Step title="Set Expectations Before Calls">
Always invoke `EXPECT_CALL` or `ON_CALL` before code uses the mock.
</Step>
<Step title="Disambiguate Overloaded Methods">
Use explicit matchers or `Const()` wrapper for overloaded const methods.
</Step>
<Step title="Control Strictness via Mock Wrapper">
Use `NiceMock` to suppress uninteresting call warnings, or `StrictMock` to catch unexpected calls.
</Step>
<Step title="Check Expectation Ordering and Cardinalities">
Review the order of expectations, use sequences if needed, and verify `.Times()` clauses match your call counts.
</Step>
<Step title="Run with Verbose Logging">
Use `--gmock_verbose=info` flag to trace all mock calls and matchings.
</Step>
</Steps>

---

## 6. Examples

### Expecting a Method to Be Called Twice Exactly

```cpp
EXPECT_CALL(mock, DoSomething())
    .Times(2);
```

If called more or fewer times, GoogleMock will report an error.

### Ignoring Calls to Uninteresting Methods Using `NiceMock`

```cpp
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, ImportantMethod());
// Calls to other methods won't raise warnings.
```

### Setting Default Behavior with `ON_CALL`

```cpp
ON_CALL(mock, GetValue(_))
    .WillByDefault(Return(42));
```

Calls to `GetValue()` with any argument will return 42 unless overridden by an `EXPECT_CALL`.

---

## 7. Additional Tips & Best Practices

- Avoid overusing `EXPECT_CALL`; prefer `ON_CALL` to set default behaviors.
- Use `.Times(AnyNumber())` on catch-all expectations to permit calls without warnings.
- If your mock calls cause crashes related to destructors, ensure your base classes have **virtual destructors**.
- Avoid mocking free or static functions directly; instead, abstract them behind interfaces.
- When mocking methods with move-only types (`std::unique_ptr`), use lambdas or custom actions.

---

## 8. References & Resources

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Setting Expectations & Behaviors](https://google.github.io/googletest/api-reference/mocking-apis/expectations-behaviors.html)
- [Nice, Naggy, and Strict Mocks](https://google.github.io/googletest/guides/mocking-advanced-usage/nice-strict-mocks.html)
- [Debugging Common Failures](https://google.github.io/googletest/guides/real-world-patterns/debugging-common-failures.html)

---

Remember, mocking is a powerful technique that helps isolate and verify interactions in your C++ tests. Setting correct expectations, understanding mock strictness, and verifying method signatures and call order are key to effective and reliable tests.