---
title: "How do I set up and run my first tests?"
description: "Step-by-step FAQ covering the basics of configuring and running tests using GoogleTest and GoogleMock. Discusses directory structure, required headers, build system considerations, and CLI basics, enabling users to write and execute their first test suite effortlessly."
---

# How do I set up and run my first tests?

Launching your first test suite with GoogleTest and GoogleMock is a straightforward journey when you understand the essential steps and best practices. This guide takes you through configuring your environment, preparing test files, integrating with your build system, and running tests using the command line—all designed to get you confidently up and running with minimal friction.

---

## 1. Understanding the Directory and File Structure

A well-organized project layout simplifies build integration and test maintenance.

- **Source Files (`.cc` or `.cpp`)**: Your production code.
- **Header Files (`.h` or `.hpp`)**: Declarations used by source files.
- **Test Files**: Typically placed under a separate `tests/` or `test/` directory. For instance:

```
project_root/
  src/
    foo.cc
    foo.h
  tests/
    foo_test.cc
```

Naming convention: Test files often mirror the source filename but append `_test`.


## 2. Including Required Headers

To write tests that leverage GoogleTest and GoogleMock features, start by including the appropriate headers:

- For basic testing needs, include GoogleTest:

```cpp
#include <gtest/gtest.h>
```

- To add mocking capabilities, include GoogleMock:

```cpp
#include <gmock/gmock.h>  // Also includes gtest.h
```

### Sample Minimal Test File Example

```cpp
#include <gtest/gtest.h>  // Includes GoogleTest

// Simple test case
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}
```

Use `TEST` for simple test functions, or `TEST_F` when using *test fixtures* that share common setup or teardown.


## 3. Writing Your First Test

### Using `TEST` Macro

Defines a basic test with a test suite and test name:

```cpp
TEST(TestSuiteName, TestName) {
  EXPECT_EQ(1 + 1, 2);
}
```

### Using `TEST_F` Macro for Fixtures

When similar setup or state is required across multiple tests, define a fixture class:

```cpp
class QueueTest : public testing::Test {
 protected:
  void SetUp() override {
    q_.Enqueue(42);
  }
  Queue<int> q_;
};

TEST_F(QueueTest, SizeIsOneInitially) {
  EXPECT_EQ(q_.size(), 1);
}
```

Fixtures are recommended for managing complex state and isolates each test with a fresh object.


## 4. Linking Test Binaries

To avoid writing a `main()` function yourself and accelerate setup, link your tests against the pre-built `gtest_main` or `gmock_main` library. This library provides a suitable `main` function which:

- Initializes the framework (`InitGoogleTest` or `InitGoogleMock`),
- Runs all registered tests via `RUN_ALL_TESTS()`,
- Exits with `0` if all tests pass or `1` otherwise.


### When you do need a custom `main()`

You can write your own `main()` as follows:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For GoogleMock support:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```


## 5. Build System Integration

### Using CMake

The most common and recommended approach is via CMake:

- Add GoogleTest and GoogleMock using `FetchContent` or find them as packages.
- Link your test executables with `gtest`, `gmock`, and optionally `gtest_main` or `gmock_main` for the `main()`.

Example minimal `CMakeLists.txt` snippet:

```cmake
find_package(GTest REQUIRED)  # Or FetchContent to download GoogleTest

add_executable(foo_test foo_test.cc)
target_link_libraries(foo_test GTest::gtest_main GTest::gmock_main pthread)
add_test(NAME FooTest COMMAND foo_test)
```

Tips:
- Ensure `pthread` or threading libraries are linked on platforms that require it.
- Define your tests with `add_test` for CTest or CI integration.


### Manual Compilation

If compiling manually, for example:

```bash
g++ -std=c++17 -isystem /path/to/googletest/include -pthread foo_test.cc /path/to/libgtest.a /path/to/libgmock.a -o foo_test
```

Make sure you provide the necessary include paths and link libraries for threads and GoogleTest/GoogleMock.


## 6. Running Your Tests

After building, execute your test binary. GoogleTest runs all registered tests automatically.

```bash
./foo_test
```

### Command-Line Flag Highlights

- `--gtest_filter=TestSuiteName.TestName` runs selected tests by name pattern.
- `--gtest_list_tests` lists all test suites and test names.
- `--gtest_output=xml:result.xml` outputs an XML report.

Example:

```bash
./foo_test --gtest_filter=FactorialTest.HandlesZeroInput
```

### Return Value

Your `main()` should return the code from `RUN_ALL_TESTS()`. A return value of `0` means all tests passed; `1` or other values indicate failures.


## 7. Troubleshooting Common Startup Issues

### Missing `main()` Link Errors

If you see unresolved `main()` symbol errors, you likely linked `gtest` or `gmock` without `gtest_main` or `gmock_main`. Add these to your linker inputs or provide a custom `main()`.

### Arguments Not Parsed

Always call `InitGoogleTest(&argc, argv)` or `InitGoogleMock(&argc, argv)` before running tests, so command-line flags are recognized and removed.

### Tests Not Detected

- Check that test files are compiled and linked into the executable.
- Confirm tests use `TEST()` or `TEST_F()` macros appropriately.


## 8. Practical Tips and Best Practices

- **Write readable test suite and test names:** Use clear, descriptive names without underscores for better reporting.
- **Keep tests independent:** Each test should set up its state to avoid hidden dependencies.
- **Use fixtures when sharing setups:** Use `TEST_F` and fixture classes to reduce code duplication and improve maintainability.
- **Leverage GoogleMock for dependencies:** Include and mock interfaces to isolate units under test.
- **Run your tests regularly:** Use output flags to generate machine-readable reports for CI.


## 9. Example: Full Minimal Test File

```cpp
#include <gtest/gtest.h>

int Factorial(int n) {
  return n <= 1 ? 1 : n * Factorial(n - 1);
}

TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(5), 120);
}
```

Build and run as follows using CMake or manually, then execute the resulting binary.


## 10. Next Steps

After setting up your first test suite:

- Explore writing tests with fixtures ([`TEST_F`](https://github.com/google/googletest/blob/main/docs/primer.md#test-fixtures)) for shared setups.
- Add mocks to simulate dependencies ([GoogleMock Basics](https://google.github.io/googletest/gmock_for_dummies.html)).
- Learn about assertions and matchers to write expressive tests.
- Investigate test filtering and running test subsets via CLI flags.

---

## Related Documentation

- [GoogleTest Primer](primer.md) — A comprehensive introduction to writing tests with GoogleTest.
- [Using GoogleMock Effectively](guides/mocking-and-advanced-testing/using-googlemock-effectively.md) — Details on mocking workflows.
- [Basic Configuration](getting-started/setup-basics/configuration-overview.md) — How to set up GoogleTest and GoogleMock in your build environment.
- [Write, Build, and Run Your First Test](getting-started/first-tests-validation/write-build-run-test.md) — A quick tutorial for beginners.
- [Troubleshooting Common Setup Issues](getting-started/first-tests-validation/troubleshooting.md) — Tips on resolving test discovery, linking, and runtime errors.

---

<Tip>
To streamline the start, link your test binaries with `gtest_main` or `gmock_main` to avoid writing your own `main()`. This simplifies your workflow and ensures GoogleTest is properly initialized.
</Tip>

<Check>
Always call `InitGoogleTest(&argc, argv)` or `InitGoogleMock(&argc, argv)` before calling `RUN_ALL_TESTS()`. Skipping this can cause test flags to be ignored and unexpected behavior.
</Check>

<Warning>
Do not write your test expectations (`EXPECT_CALL`) after exercising your mocks. Expectations must be established *before* code calls mocked methods to ensure reliable and debuggable tests.
</Warning>
