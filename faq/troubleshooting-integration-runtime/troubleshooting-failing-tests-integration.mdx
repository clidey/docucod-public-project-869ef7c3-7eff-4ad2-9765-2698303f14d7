---
title: "How can I troubleshoot failing tests and confusing output?"
description: "Covers how to interpret test failures, make use of assertion messages and logging, and leverage built-in debugging tools. Also includes hints for isolating flaky tests or understanding anomalous runner behavior."
---

# How can I troubleshoot failing tests and confusing output?

GoogleTest and GoogleMock provide rich diagnostics and control to help you understand why your tests are failing or producing unexpected output. This documentation guides you through interpreting test failures, making effective use of assertion messages and logging, and leveraging built-in debugging and tracing tools. It also offers practical hints for isolating flaky tests and understanding uncommon test runner behaviors.

---

## 1. Understanding Test Failure Output

When a test fails, GoogleTest prints detailed information about the failure, including:

- The *source file* and *line number* where the failed assertion occurs.
- The *expression* being tested and the *values* involved.
- Any *custom failure messages* you appended to assertions.
- Relevant *instrumentation traces* if you use tracing macros.

### Example Failure Message

```none
path/to/file_test.cc:42: Failure
Value of: x.size()
Expected: 5
  Actual: 3
Additional info: Vector has fewer elements than expected
```

This example tells you exactly where the failure happened and why.

### Tips

- Use `ASSERT_*` for fatal failures that prevent continuation, and `EXPECT_*` for non-fatal failures to collect multiple errors in one run.
- Always append custom messages with `<<` streaming to add context that can help debugging.


## 2. Using Scoped Traces to Pinpoint Failures

If your tests call common helper functions or are invoked repeatedly (e.g., in loops), it can be hard to identify *which* invocation caused a failure. GoogleTest provides `SCOPED_TRACE` to add contextual traces automatically.

```cpp
void Helper(int n) {
  SCOPED_TRACE("Helper call with n=" << n);
  EXPECT_EQ(SomeFunction(n), 42);
}

TEST(MyTestSuite, UsesHelper) {
  for (int i = 0; i < 3; ++i) {
    Helper(i);
  }
}
```

Failure output will indicate which `n` triggered the failure:

```none
... Failure ...
Helper call with n=1
Value of: SomeFunction(n)
Expected: 42
  Actual: 13
```

### Best Practices

- Use `SCOPED_TRACE` at the start of helpers, especially when called multiple times.
- Include loop counters or parameter values in the message for disambiguation.


## 3. Propagation of Fatal Failures in Subroutines

A common pitfall is that `ASSERT_*` macros only abort the current function, not the entire test case. This sometimes causes confusing crashes later on.

### How to Detect Fatal Failures in Called Functions

```cpp
void Subroutine() {
  ASSERT_EQ(1, 2);  // Fatal failure here
  ...  // Skipped when failure occurs
}

TEST(FooTest, Bar) {
  Subroutine();
  if (testing::Test::HasFatalFailure()) return;
  // Prevents proceeding if Subroutine failed
  ...
}
```

Alternatively, you can use `ASSERT_NO_FATAL_FAILURE` to guard calls:

```cpp
ASSERT_NO_FATAL_FAILURE(Subroutine());
```

### Advanced: Turn Fatal Failures Into Exceptions

If your environment supports exceptions, you can install a listener that throws on fatal failures, catching them in your test harness.


## 4. Logging Additional Information in Failures

Use streaming into assertion macros to add helpful context:

```cpp
EXPECT_EQ(value, expected) << "Value computed at step " << step_counter;
```

You can also use `RecordProperty(key, value)` to add metadata to test runs; this data will appear in the XML or JSON reports.


## 5. Understanding GoogleMock Output Messages for Mock Failures

gMock provides detailed messages for common mock failure scenarios:

| Scenario               | What it Means                                | What to Check                                   |
|------------------------|---------------------------------------------|------------------------------------------------|
| **Uninteresting call** | A mock method was called without an expectation | Add `EXPECT_CALL` or switch mock to `NiceMock` to suppress warnings
| **Unexpected call**    | A mock method call did not match any expectation | Check argument matchers and call order
| **Excessive call**     | Mock method called more times than expected | Ensure call count constraints (`Times`) are correct
| **Unsatisfied prerequisite** | Call occurred before required prior calls | Review `InSequence` or `After` constraints

### Example Warning for Unexpected Call

```none
GMOCK WARNING:
Unexpected mock function call - returning default value.
    Function call: Bar(3, 4)
...list of expectations...
```

### Tips

- Use `--gmock_verbose=info` to see detailed matching and call trace.
- Confirm that your matchers fully cover expected calls.


## 6. Leveraging Verbose Mock Output

For deeper insight into mock call matching and actions, run tests with `--gmock_verbose=info`:

- Prints all expectations and the result of matching each mock call.
- Shows argument values and return values.
- Includes stack traces pointing to the `EXPECT_CALL` location.

This can illuminate why an unexpected call was matched to a different expectation or why it was rejected.


## 7. Isolating and Diagnosing Flaky Tests

Sometimes tests fail nondeterministically (flaky tests). To diagnose:

- Use `--gtest_repeat=N` to run tests multiple times and observe patterns.
- Use `--gtest_shuffle` to run tests in different orders and detect dependencies.
- Use `SCOPED_TRACE` or custom messages to narrow down the failing iterations.
- Run tests individually with `--gtest_filter=TestSuite.TestName` to isolate.


## 8. Understanding Test Runner Behavior and Flags

GoogleTest offers flags that affect test execution and output:

- `--gtest_filter`: Run a subset of tests by name pattern.
- `--gtest_fail_fast`: Stop at first failure.
- `--gtest_shuffle` and `--gtest_random_seed`: Randomize tests order.
- `--gtest_repeat`: Repeat tests multiple times.
- `--gtest_break_on_failure`: Break into debugger on failure.
- `GTEST_COLOR`: Controls color output.

Use these flags to tailor your test runs and gain clarity on failures.


## 9. Troubleshooting Common Confusing Scenarios

### Tests Not Discovered or Executed

- Ensure test functions are named with valid identifiers without underscores.
- Verify `TEST` and `TEST_F` macros are used correctly.
- Avoid broken test fixture constructors or missing test suite registrations.
- Check filtering flags (`--gtest_filter`) don't exclude tests unintentionally.

### Assertion Failure Without Visible Error

- Check whether your test runner captures stdout/stderr properly.
- Verify you do not ignore the return value of `RUN_ALL_TESTS()`. Always use it as a test status.

### Mismatch Between Expected and Actual Calls in Mocks

- Use mock verbosity to diagnose matcher conflicts and call order problems.
- Confirm that chained clauses such as `.InSequence()`, `.After()`, and `.RetiresOnSaturation()` are ordered correctly.


## 10. Additional Debugging Tools and Best Practices

### Custom Value Printers

Teach GoogleTest how to print your custom types by implementing `AbslStringify()` or `PrintTo()` to get clearer failure messages.

### Using Event Listeners for Custom Logging

Attach custom listeners via GoogleTest's event listener API to capture or modify test output.

### Verifying Mock Expectations Explicitly

If your mock is not destructed by test end, call `Mock::VerifyAndClearExpectations(&mock_object)` to ensure all expectations were met.

### Testing Death and Exception Tests

Use specialized assertions like `ASSERT_DEATH` or `EXPECT_EXIT` for testing termination and exception conditions, respecting naming conventions and thread safety requirements.

---

## References and Further Reading

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md): Basics and assertions
- [Test Macros and Lifecycles](https://github.com/google/googletest/blob/main/api-reference/gtest-api-core/test-macros-and-lifecycle.mdx)
- [Assertions Reference](https://github.com/google/googletest/blob/main/api-reference/gtest-api-core/assertions-and-predicate-macros.mdx)
- [Writing Effective Tests - Advanced Assertions](https://github.com/google/googletest/blob/main/guides/writing-effective-tests/advanced-assertions-practices.mdx)
- [GoogleMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md): Detailed mocking patterns and troubleshooting
- [Troubleshooting and Common Pitfalls Guide](https://github.com/google/googletest/blob/main/guides/integration-real-world/troubleshooting-common-issues.mdx)
- [Test Discovery and Lifecycle](https://github.com/google/googletest/blob/main/concepts/architecture-and-core-concepts/test-discovery-and-lifecycle.mdx)

---

Use this documentation alongside your test code to diagnose failing tests confidently and efficiently, leveraging GoogleTest's full range of output, tracing, and debugging facilities.