---
title: "Build System Integration & Environment Issues"
description: "Guidance for troubleshooting issues with integration into CMake, Bazel, and other build systems. Includes solutions for linking, environment setup, and test discovery questions. Provides links to sample projects and package configuration files."
---

# Build System Integration & Environment Issues

This page provides practical guidance for troubleshooting common issues encountered when integrating GoogleTest into various build systems such as CMake and Bazel. It covers problems related to linking, environment setup, and test discovery, along with actionable solutions to ensure smooth integration of GoogleTest into your build workflow. Additionally, links to sample projects and package configuration files will help you validate and adapt configurations effectively.

---

## Frequently Asked Questions

### What are common linking errors when integrating GoogleTest with CMake or Bazel?

Linking errors typically occur due to omitted or incorrect library references. In CMake, you must explicitly link your test executables against the `gtest` and optionally `gmock` libraries using `target_link_libraries()`. For Bazel, ensure `deps` for `cc_test` targets include GoogleTest packages.

**Example (CMake):**
```cmake
add_executable(my_test my_test.cc)
target_link_libraries(my_test PRIVATE gtest gtest_main)
```

For Bazel, your `cc_test` rule should look like:
```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

### How do I ensure GoogleTest tests are discovered correctly by my build system?

- **CMake**: Use `gtest_discover_tests()` provided by CMake’s GoogleTest integration after adding your test executable. This registers tests with CTest, enabling discovery.

  ```cmake
gtest_discover_tests(my_test)
```

- **Bazel**: Bazel discovers tests based on `cc_test` targets. Ensure your `srcs` and `deps` are correct. Tests are run via `bazel test //path:target`.

### I am encountering environment issues during tests run by the build system. How can I resolve these?

Environment issues often relate to missing runtime dependencies or incorrect environment variables.

- Verify that all shared libraries are accessible in the runtime environment.
- Set necessary environment variables in your build/test scripts or CI configurations.
- In Bazel, use `env` attribute in `sh_test` or specify environment variables in test arguments.

### What are sample projects and files I can use for reference?

- **Sample CMake Project:** Check the `samples` directory of the GoogleTest repository which contains example CMakeLists demonstrating typical usage.
- **Package Configuration Files:** GoogleTest provides `gtest-config.cmake` files installed with the library to simplify finding and linking.

Use these references to compare and adjust your build configurations accordingly.

---

## Common Issues & Gotchas

### Linking Problems

- Forgetting to link `gtest` and/or `gtest_main` causes undefined references.
- Mixing static and dynamic libraries can result in symbol duplication or missing symbols.
- Linking order matters: libraries should come after object files or targets.

### Test Discovery Problems

- Tests not registered properly with CTest (CMake) without using `gtest_discover_tests()`.
- In Bazel, missing or incorrect `cc_test` declarations lead to tests not running.

### Environment Setup

- Missing environment variables expected by GoogleTest (such as for sharding).
- Platform-specific runtime dependencies (e.g., pthreads on Linux) not linked or set up.

---

## Troubleshooting Procedures

### Diagnosing Linking Failures

1. Check your build output for missing symbols related to GoogleTest.
2. Confirm your build definition includes `gtest` and `gtest_main` in linkage.
3. Verify library search paths are correctly specified.

### Fixing Test Discovery Issues

1. For CMake, ensure `gtest_discover_tests()` is invoked after adding test targets.
2. For Bazel, ensure correct use of `cc_test` or `sh_test` rules for executable tests.
3. Run `ctest --verbose` or `bazel test --test_output=all` for detailed output.

### Environment Issues

1. Verify environment variables like `GTEST_SHARD_INDEX`, `GTEST_TOTAL_SHARDS` if using sharded tests.
2. Check that all dependencies exist and are accessible at runtime.
3. On Windows, ensure DLLs are available and environment configured.

---

## Best Practices for Building and Integrating GoogleTest

- Always compile with at least C++17 support, as required by GoogleTest.
- Prefer linking against the prebuilt static or shared GoogleTest libraries.
- Use GoogleTest’s CMake package configuration files when using CMake to avoid manual linkage.
- In Bazel, rely on `@com_google_googletest` repository for seamless rules usage.
- Avoid mixing multiple versions of GoogleTest in one project.
- Use environment variables and command-line flags to control test execution and output.

---

## Helpful Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest): Contains samples and build scripts.
- [Installing with CMake Guide](/getting-started/installation-initialization/installation-cmake): Step-by-step for CMake integration.
- [Installing with Bazel Guide](/getting-started/installation-initialization/installation-bazel): Bazel integration details.
- [GoogleTest Primer](/guides/getting-started/primer-overview): Understanding test design and execution.
- [Integration and Platform Compatibility](/overview/integration-platforms/supported-platforms): Platform-specific considerations.

---

If you encounter issues specific to build systems or environment setup, start by comparing your build files to the official GoogleTest samples. Ensure all dependencies are correctly specified and environments properly configured before invoking tests. Using verbose build and test output can provide essential clues. For persistent problems, consider consulting community forums or opening issues with reproduction details.