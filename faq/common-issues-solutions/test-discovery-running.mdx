---
title: "Test Discovery and Execution Issues"
description: "Helps users resolve challenges when tests are not being detected or executed correctlyâ€”including missing main functions, runner integration problems, and environment variable misconfigurations."
---

# Test Discovery and Execution Issues

This FAQ page is designed to help you identify and resolve common challenges encountered when your tests are not detected or executed properly within the GoogleTest and GoogleMock framework. It addresses typical pitfalls including missing `main()` functions, runner integration problems, and environment variable misconfigurations.

---

## 1. Why Are My Tests Not Being Discovered?

### Common Causes
- **Missing or misnamed test macros:** Ensure your tests use the `TEST()` or `TEST_F()` macros correctly with valid test and suite names.
- **Linker issues:** Your test source files might not be linked into the test executable.
- **Absence of a `main()` function:** The test executable needs a proper entry point.
- **Incorrect initialization:** GoogleMock requires calls to initialize the framework before running tests.

### How to Verify
- Confirm your test code uses GoogleTest macros properly (e.g., using `TEST(TestSuite, TestName)` for defining tests).
- Check your build system to verify all relevant test files are included in the linking stage.
- Confirm your executable either provides its own `main()` or links against `gmock_main` / `gtest_main` libraries.
- Verify that `testing::InitGoogleMock()` or `testing::InitGoogleTest()` is being called before `RUN_ALL_TESTS()`.

<Tip>
GoogleMock provides `gmock_main` which includes a default `main()` function implementing initialization and running all tests. Linking against this library eliminates the need to write your own `main()`.
</Tip>

---

## 2. How to Ensure Proper Test Execution?

### Required Setup Steps
1. **Initialize GoogleMock**
   - Call `testing::InitGoogleMock(&argc, argv);` in your `main()` before calling `RUN_ALL_TESTS()`.
   - On embedded or specialized platforms (e.g., Arduino), ensure the test runner hooks correctly to lifecycle events.

2. **Call `RUN_ALL_TESTS()`**
   - This function runs all discovered tests and returns an appropriate exit code.
   - Use the return value of `RUN_ALL_TESTS()` as the exit code from your `main()`.

3. **Linking**
   - Link your test executable with GoogleMock and GoogleTest libraries, plus the `gmock_main` or `gtest_main` if you want to use their default `main()` functions.

### Example Custom `main()` Implementation
```cpp
#include "gmock/gmock.h"

int main(int argc, char** argv) {
    testing::InitGoogleMock(&argc, argv); // Initializes GoogleMock and GoogleTest
    return RUN_ALL_TESTS(); // Runs tests and returns status
}
```

---

## 3. Common Integration Issues With Test Runner

### Problem: Tests Run but No Output or All Reported as Passed

- The main function is missing proper initialization.
- The test run is managed outside of Google's recommended flow.

### Solution:
- Use `testing::InitGoogleMock()` instead of just `InitGoogleTest()` to account for both GoogleTest and GoogleMock flags and features.
- Avoid manual calls that disrupt the test lifecycle.

### Problem: Linking Errors or Duplicate Symbols for `main()`

- Occurs if you define a `main()` but also link to `gmock_main` or `gtest_main`.

### Solution:
- Either define your own `main()` and link against `gmock` and `gtest` libraries,
  or link against `gmock_main` / `gtest_main` which provides a default `main()`.

---

## 4. Environment Variables and Flags Affecting Test Discovery and Execution

GoogleMock and GoogleTest support flags that influence test discovery, verbosity, and behavior.

### Notable Flags
- `--gtest_filter`: Selects which tests to run.
- `--gmock_verbose=LEVEL`: Controls verbosity of GoogleMock messages (`info`, `warning`, `error`).
- `--gmock_catch_leaked_mocks=0|1`: Enables or disables leak checking for mocks.

### How to Use Flags
- Flags can be passed on the command line and are parsed by `InitGoogleMock()`.
- Unrecognized flags are left untouched and passed through.

### Verifying Flag Impact
- Run your test binary with `--help` or `--gtest_list_tests` to check test discovery.
- Set verbosity flags to `info` or `warning` to debug what GoogleMock is doing.

<Tip>
If your tests mysteriously do not run, try running your executable with `--gtest_list_tests` to verify if tests are being discovered.
</Tip>

---

## 5. Troubleshooting Missing or Incorrect `main()` Function

### Why Is `main()` Important?
- It initializes the framework and triggers execution of all tests.
- Without `main()`, the program may build but tests will not run.

### How to Provide `main()` Correctly
- Use the provided `gmock_main` library which contains a `main()` implementation (recommended).
- If custom initialization is needed, write your own `main()` that calls `testing::InitGoogleMock()` and then `RUN_ALL_TESTS()`.

### Example Default `main()` from `gmock_main.cc`
```cpp
int main(int argc, char** argv) {
  std::cout << "Running main() from gmock_main.cc\n";
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 6. How to Fix Runner Integration Problems on Embedded or Special Platforms

For platforms such as ESP8266, ESP32, or Arduino-like environments:

- Implement `setup()` to call `testing::InitGoogleMock()`.
- Implement a `loop()` function that calls `RUN_ALL_TESTS()` repeatedly or as needed.
- Consult platform-specific integration notes.

<Info>
Due to hardware or OS constraints, standard main-function execution may not be applicable, so GoogleMock provides integration hooks as used in `gmock_main.cc`.
</Info>

---

## 7. Additional Tips and Best Practices

- Always place your `EXPECT_CALL()` and other expectations *before* exercising the mock objects.
- Use `gmock_main` to avoid boilerplate `main()` unless you have specific customization needs.
- Keep your environment variables and flags consistent across development and CI environments.
- Use `--gtest_filter` to narrow down test runs during debugging.

---

## 8. Quick Verification Checklist

- [ ] Do I have a `main()` function or am I linking against `gmock_main`?
- [ ] Do I call `testing::InitGoogleMock()` before `RUN_ALL_TESTS()`?
- [ ] Are all my test files compiled and linked into the test executable?
- [ ] Am I using GoogleTest macros (`TEST`, `TEST_F`) correctly?
- [ ] Are any filtering flags (`--gtest_filter`) unintentionally restricting test execution?
- [ ] Are environment variables or flags correctly set and parsed?

<Check>
Following this checklist ensures your tests are detected and executed as expected.
</Check>

---

## 9. Where to Get More Help

- Consult the [GoogleTest Primer](https://google.github.io/googletest/primer.html) for fundamentals.
- Review the [GoogleMock README](https://google.github.io/googletest/gmock_for_dummies.html) for mock-related initialization.
- Check the [Test Discovery and Assertions guide](https://google.github.io/googletest/guides/getting-started/test-discovery-run.html) for discovery details.
- Ask questions on community forums or GitHub Issues of googletest project.

---

## Related Documentation

- [Test Discovery and Assertions](https://google.github.io/googletest/overview/feature-summary-and-workflows/test-discovery-assertions.html)
- [GoogleMock README](https://google.github.io/googletest/googlemock.html)
- [Basic Configuration & Project Setup](https://google.github.io/googletest/getting-started/setup-installation/configuration-basics.html)
- [Troubleshooting & Common Setup Issues](https://google.github.io/googletest/getting-started/first-steps-usage/troubleshooting-setup.html)

---

For advanced users, consider integrating customized main() with extended flags parsing and handling multiple test suites or embedded systems.

---

_Last updated for the GoogleTest / GoogleMock framework._