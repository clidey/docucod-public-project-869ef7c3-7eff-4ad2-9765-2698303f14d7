---
title: "Why are my tests running slowly and how can I speed them up?"
description: "Identifies the typical causes of slow test execution such as heavy fixtures, I/O bottlenecks, or unintentional dependencies. Offers techniques for profiling tests, parallelizing execution, and leveraging available tooling for speed optimizations."
---

# Why Are My Tests Running Slowly and How Can I Speed Them Up?

When running tests with GoogleTest and GoogleMock, test execution speed can be a critical factor that impacts your development feedback loop, continuous integration throughput, and overall productivity. This page helps you identify common reasons for slow test execution and offers concrete techniques to diagnose and optimize test performance.

## Typical Causes of Slow Test Execution

Understanding why tests are slow is the first step toward speeding them up. Here are the main culprits:

- **Heavy Fixtures**: Tests that allocate or initialize large objects, resources, or test environments in their setup or teardown phases.
- **I/O Bottlenecks**: Tests that perform frequent or slow input/output operations such as disk access, network calls, or database queries.
- **Unintentional Dependencies**: Tests that are dependent on one another or on shared global states, causing serial execution and preventing effective parallelization.
- **Excessive Mock Overhead**: Tests with complex mocks containing a large number of expectations or actions that may slow down execution.
- **Inefficient Test Design**: Overly broad tests that try to cover too many scenarios together, making them bulky and slow.

## Techniques for Profiling and Identifying Slow Tests

To effectively speed up your test suite, start by identifying slow tests and the sources of delay:

### 1. Use Verbose and Timing Flags

- Run your tests with the `--gtest_print_time=1` flag. It reports the time each individual test takes, making it easy to spot slow tests.
- Increase log verbosity with `--gmock_verbose=info` to see mock call traces that may indicate heavy mocking overhead.

### 2. Analyze and Profile Test Code

- Use profiling tools (such as `perf`, Visual Studio Profiler, or Instruments) while running tests to pinpoint bottlenecks at the code or system call level.
- Investigate tests that perform I/O or expensive setup, and consider mocking or faking these dependencies.

### 3. Check for Serial Dependencies

- Look for global state or shared fixtures that cause tests to be implicitly serialized.
- Examine test suites for test cases that depend on execution order or shared external resources.

## Strategies to Speed Up Test Execution

Once you know where the time is spent, these techniques can help optimize your tests:

### 1. Parallelize Test Execution

GoogleTest supports running tests in parallel, leveraging multiple CPU cores.

- Use tools like `bazel test` or custom scripts that run tests concurrently.
- Organize your tests so they do not share state, enabling safe parallel runs.

### 2. Optimize Use of Fixtures

- Use lightweight fixtures; avoid heavy operations in `SetUp()` or `TearDown()` where possible.
- Share expensive resources conservatively and cache results if tests can tolerate it.

### 3. Mock and Stub Out External Dependencies

- Replace real database or network dependency with mocks or fakes using GoogleMock.
- Use `ON_CALL()` and `EXPECT_CALL()` judiciously to specify only needed interactions.
- Apply `NiceMock` for mocks where uninteresting calls should be silently ignored.

### 4. Reduce Over-Mocking and Simplify Expectations

- Avoid setting expectations on every single call unless verification is critical.
- Use generic matchers like `_` to simplify expectations and reduce verification overhead.

### 5. Avoid Unnecessary Serialization of Tests

- Do not rely on shared mutable global states.
- Ensure tests are isolated and order-independent.

### 6. Profile and Refactor Slow Tests

- Break down large, slow tests into smaller focused ones.
- Remove or refactor tests that are checking too many scenarios at once.

### 7. Use Test Filters

- When running tests during development, focus only on a subset of tests using `--gtest_filter` to save time.

## Leveraging Available Tooling

GoogleTest and GoogleMock offer features and flags to assist with performance tuning:

- `--gtest_repeat=<N>`: Run tests multiple times to measure average runtime.
- `--gtest_shuffle`: Randomize test order to detect dependencies between tests.
- `--gmock_verbose`: Control verbosity to monitor mock interactions and diagnose overhead.

## Common Pitfalls and How to Avoid Them

### Pitfall: Using `EXPECT_CALL` Too Liberally

Setting expectations on every mock call can slow tests silently and produce brittle tests. Prefer `ON_CALL()` for default behavior settings when you do not need to verify calls.

### Pitfall: Heavy Fixtures in TestSuite

Shared heavy setup can block test parallelism. Use `SetUpTestSuite()` carefully and avoid expensive operations in global fixtures.

### Pitfall: Disk or Network Calls in Tests

Tests that hit disk or network slow down tests dramatically. Always try to mock or fake such dependencies.

### Pitfall: Global Mutable State

This can cause unintentional test interdependencies and make parallel execution unsafe. Use dependency injection and isolate resources.

## Summary of Actions

1. Profile your tests to identify the biggest slowdowns.
2. Parallelize test runs and ensure tests are independent.
3. Use mocks instead of slow real dependencies.
4. Simplify and optimize your expectations and mock usage.
5. Avoid heavy shared test setups or mitigate their cost.
6. Apply tooling flags to monitor and refine test performance.

## Additional Resources

- [GoogleTest Primer - Writing and Running Tests](https://google.github.io/googletest/primer.html)
- [GoogleMock for Dummies - Intro to gMock](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Patterns and Best Practices Guide](https://google.github.io/googletest/guides/mocking-patterns-and-best-practices.html)
- [GoogleTest FAQ](https://github.com/google/googletest/blob/main/docs/faq.md)

<Tip>
To get immediate feedback on test execution times, always run with `--gtest_print_time=1`. Combine this with parallel runs to maximize throughput.
</Tip>

<Note>
Remember that speeding up tests isn't about skipping checks, but about making them efficient, isolated, and maintainable.
</Note>

<Warning>
Avoid turning off warnings about uninteresting mock calls using `EXPECT_CALL` indiscriminately, as it may hide real test problems and slow test runs unnecessarily.
</Warning>