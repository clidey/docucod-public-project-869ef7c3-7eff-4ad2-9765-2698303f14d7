---
title: "How do I integrate GoogleTest with my build system and CI pipeline?"
description: "Addresses challenges with integrating GoogleTest into different build systems (CMake, Bazel, others) and CI/CD workflows. Provides configuration tips and points to sample setups for common environments."
---

# How do I integrate GoogleTest with my build system and CI pipeline?

Integrating GoogleTest seamlessly into your build system and continuous integration (CI) pipeline is a crucial step to maximize the benefits of automated testing. This guide addresses common challenges, configuration tips, and practical workflows for popular build systems like CMake and Bazel, as well as advice for custom or other build environments and CI setups.

---

## 1. Supported Build Systems Overview

GoogleTest is designed with flexibility to work well across a variety of build systems. The two most commonly used are:

- **CMake**: The recommended build system for most users; facilitates straightforward integration and dependency management.
- **Bazel**: Often used in large-scale projects with strong dependency and caching management.

Other build systems (Make, Ninja, custom scripts) can incorporate GoogleTest by manually specifying include paths and linking libraries.

---

## 2. Integrating GoogleTest with CMake

CMake integration offers a robust and mostly automated experience:

### Step-by-step integration flow:

<Steps>
<Step title="1. Fetch GoogleTest">
Use [`FetchContent`](https://cmake.org/cmake/help/latest/module/FetchContent.html) or add GoogleTest as a subdirectory in your project:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.13.0.zip
)
FetchContent_MakeAvailable(googletest)
```

Or:

```cmake
add_subdirectory(path/to/googletest)
```
</Step>

<Step title="2. Link GoogleTest to Your Tests">
Create test targets and link them against `gtest` and `gtest_main`:

```cmake
add_executable(my_test test_my_feature.cpp)
target_link_libraries(my_test gtest_main)
```

`gtest_main` provides a ready-to-use main() function; if you need custom entry points, link with `gtest` instead.
</Step>

<Step title="3. Enable Testing and Register Tests">

```cmake
enable_testing()
add_test(NAME MyFeatureTest COMMAND my_test)
```

This allows invoking tests via CTest and integrates them into CI pipelines.
</Step>

<Step title="4. Customization and Flags">
Configure GoogleTest behavior using CMake options or passing command-line flags at test run time, such as:

- `--gtest_filter` to select specific tests
- `--gtest_output` to generate XML reports
- `--gtest_repeat` to run tests multiple times

</Step>
</Steps>

### Best practices with CMake:

- Pin GoogleTest to a specific release branch for stable builds.
- Use CTest integration for standardized test execution.
- Export GoogleTest targets for reuse in multi-module projects.

---

## 3. Integrating GoogleTest with Bazel

Bazel uses `BUILD` files to describe test targets:

### Basic example for a C++ test:

```python
cc_test(
    name = "my_feature_test",
    srcs = ["test_my_feature.cpp"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

### Key points:

- Bazel uses external repositories to fetch GoogleTest.
- `gtest_main` provides the test entry point.
- Tests run via `bazel test //path/to:my_feature_test`.

### Tips:

- Always declare dependencies on GoogleTest labels properly.
- Use Bazel's test caching and sandboxing for fast, isolated builds.

---

## 4. Integration with Other Build Systems

If using Makefiles, Ninja, or other custom builds:

- Manually specify include directories and link `libgtest` and `libgtest_main`.
- Compile and link position-independent code for shared GoogleTest libraries.
- Ensure the test executable links with pthread or other necessary threading libraries.

Example command line:

```bash
g++ -isystem /path/to/googletest/include -pthread my_test.cpp /path/to/libgtest.a /path/to/libgtest_main.a -o my_test
```

Testing and CI invocation should be scripted accordingly.

---

## 5. Continuous Integration Pipeline Integration

Integration into CI systems like Jenkins, GitHub Actions, or GitLab CI involves:

### Running Tests Automatically

- Invoke the test binaries using `ctest`, `bazel test`, or direct execution.
- Use flags like `--gtest_output=xml:report.xml` to export JUnit-compatible test results.

### Example:

```bash
./my_test --gtest_output=xml:test_results/my_test.xml
```

- CI systems can collect these XML files and display test results in dashboards.

### Filtering and Selective Runs

- Use `--gtest_filter` to run tests by name or subset.
- Use `--gtest_repeat` for stress or flaky test detection.

### Handling Test Failures

- Check exit codes: GoogleTest returns 0 on all successful tests.
- CI jobs should fail builds if tests fail.

### Parallel and Sharded Runs

- Use test filtering and parallel execution to speed up large test suites.
- Leverage GoogleTest’s built-in support for test sharding (`--gtest_total_shards` and `--gtest_shard_index`).

---

## 6. Troubleshooting Common Integration Issues

### Tests Are Not Discovered or Run

- Confirm test files are compiled and linked correctly.
- Verify that test macros (`TEST`, `TEST_F`, `TEST_P`) are used properly.
- Ensure no filtering flags exclude all tests.

### Linker Errors

- Ensure `gtest` and `gtest_main` or `gmock` libraries are linked.
- Confirm threading libraries (e.g., pthread) are linked where required.

### Test Execution Fails in CI

- Check environment supports threading.
- Validate correct command-line flags and working directories.

---

## 7. References and Further Reading

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — for basics on writing and running tests
- [Integrating with Build Systems Guide](/guides/real-world-examples/integrating-with-build-systems) — detailed instructions for CMake and Bazel
- [Setup and Installation Guide](/guides/getting-started/setup-and-installation) — overall installation and setup
- [Running Tests and Understanding Results](/guides/getting-started/running-tests-and-understanding-results) — interpreting output and controlling test execution
- [GoogleTest CMake Example](https://github.com/google/googletest/blob/main/googletest/CMakeLists.txt) — practical example in repository

---

For convenience, always keep your test infrastructure versioned and reproducible with pinned GoogleTest releases and documented CI scripts. This ensures smooth, maintainable testing workflows across development teams.
