---
title: "Integration with Build Systems and External Tools"
description: "Solutions and explanations for common integration challenges when working with popular build systems (CMake, Bazel) and CI setups. Answers typical configuration questions and recommends best practices for smooth integration."
---

# Integration with Build Systems and External Tools

This page addresses common questions, solutions, and best practices for integrating GoogleMock with popular C++ build systems such as CMake and Bazel, as well as continuous integration (CI) setups. It focuses on typical configuration challenges you may encounter and how to address them to ensure smooth, reliable integration of GoogleMock in your projects.

---

## 1. Common Integration Challenges

### Why do I get linking errors related to GoogleMock symbols?

Linking errors usually mean the GoogleMock library or its dependencies are not linked correctly in your project. To solve this:

- Make sure to link against the `gmock` and `gtest` libraries (or `gmock_main` if you want a default main). For example:

```cmake
target_link_libraries(your_target PRIVATE gmock gtest pthread)
```

- When using Bazel, ensure that your `BUILD` files declare dependencies on `@com_google_googletest//:gmock` and `@com_google_googletest//:gtest`. 

- Confirm that you are not mixing debug and release binaries or incompatible runtimes.

<Tip>
Linking errors are most often resolved by verifying your build files properly include GoogleMock targets. Always build GoogleMock and GoogleTest libraries before linking them to your tests.
</Tip>

### How to properly include GoogleMock headers in my source?

Use the modern recommended include:

```cpp
#include <gmock/gmock.h>
```

Since GoogleMock is distributed alongside GoogleTest, including `gmock.h` also brings in relevant GoogleTest headers.

<Tip>
Use angle brackets `<gmock/gmock.h>` instead of quotes to ensure proper include path resolution when installed via package or FetchContent.
</Tip>

### Which C++ standard should my project use with GoogleMock?

GoogleMock now requires **C++17** or newer. Ensure your compiler flags enable this:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Older standards may cause compilation or linkage failures.

### My project uses multiple mock classes, but tests fail to find them or have duplicate symbols. What can I do?

- Avoid defining mock classes in header files included in multiple compilation units without proper include guards or `#pragma once`.
- For large mock classes, consider moving constructor and destructor definitions to `.cc` files to speed builds and avoid ODR violations (see [gMock Cookbook: Making compilation faster](gmock_cook_book.md#MakingTheCompilationFaster)).


## 2. Integration Tips for CMake

### How to efficiently add GoogleMock to my CMake project?

A common practice is to use FetchContent to bring GoogleTest/GoogleMock as part of your build:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.13.0.tar.gz
)
FetchContent_MakeAvailable(googletest)

add_executable(your_test test.cpp)
target_link_libraries(your_test PRIVATE gmock_main)
```

This automatically manages download and build of GoogleMock/GoogleTest.

### My tests don't run or can't find the test executable. What could be wrong?

Ensure that you:

- Enable testing support in CMake with `enable_testing()`.
- Register tests properly, using `gtest_discover_tests()` or similar CTest integration.


## 3. Integration Tips for Bazel

### How to add GoogleMock dependency in my Bazel workspace?

Include the GoogleTest dependency in your `WORKSPACE` by referencing the official Bazel repository or downloading it directly.

Add dependencies in your `BUILD` files:

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

Note that `gmock_main` includes both gtest and gmock libraries and the main function for test execution.

### Any common pitfalls with Bazel and GoogleMock?

- Ensure that toolchain versions support at least C++17.
- Build targets using the same runtime and standard to avoid ABI issues.
- Cache and incremental builds can sometimes misbehave; a clean build helps when things fail.


## 4. Continuous Integration (CI) Considerations

### How should I configure CI systems to build and run GoogleMock tests?

- Build your tests as normal using your build system (CMake/Bazel).
- Run tests with the generated executables, capturing exit codes and test reports.
- Enable XML output for test runners, e.g., with GoogleTest's `--gtest_output=xml:<path>` parameter to integrate with CI dashboards.

### How to diagnose flaky test failures in CI?

- Use the `--gmock_verbose=info` flag to see detailed mock call traces and help pinpoint failing expectations.
- Capture logs and test output for analysis.
- Re-run to confirm failures and isolate environment causes.


## 5. Best Practices for Smooth Integration

- Use `ON_CALL` for setting default mock behavior and reserve `EXPECT_CALL` only for those calls you want to strictly verify.
- Avoid mixing different mocking styles (like `NiceMock`, `NaggyMock`, `StrictMock`) in the same test unless necessary.
- Define mocks in dedicated test directories or libraries to centralize mock maintenance.
- Always clean your build environment when changing compiler versions or build settings.

<Tip>
Regularly consult the [gMock Cookbook](gmock_cook_book.md) and [Mocking Reference](reference/mocking.md) for detailed usage and advanced patterns that ensure your mocks work as intended in your build environment.
</Tip>

## 6. Frequently Asked Questions

<AccordionGroup title="Integration FAQs">
<Accordion title="Can I use GoogleMock with non-virtual methods or static functions in my build?">
Direct mocking of non-virtual or static functions is not supported directly. GoogleMock supports mocking virtual methods or non-virtual methods via templates (Hi-perf dependency injection). For static or free functions, use interface wrappers or redirect calls through an abstract interface which you can mock.
</Accordion>
<Accordion title="Why do I get unresolved external symbol errors for MOCK_METHOD-generated methods?">
Ensure your build links against GoogleMock libraries properly; also, constructor and destructor definitions for mock classes may need to be explicitly defined in one .cc file to avoid multiple or missing symbol errors.
</Accordion>
<Accordion title="How to manage GoogleMock dependencies in multi-module projects?">
Make sure all modules link consistently against the same GoogleMock artifacts, avoid multiple versions or different compiler options. For Bazel, declare dependencies explicitly; for CMake, use target-based linking and FetchContent or package finders.
</Accordion>
</AccordionGroup>

## 7. Troubleshooting Common Integration Problems

### Linking problems with GoogleMock in CMake

- Verify `target_link_libraries` includes `gmock` and `gtest`.
- If using `gmock_main`, you don't need to add `gtest_main` separately.
- Check for missing pthread (Linux) or additional dependencies.

### Compilation errors related to C++ standard or headers

- Ensure your compiler supports C++17 or later and you set `-std=c++17` or equivalent.
- GoogleMock headers require `<memory>`, `<string>`, and others; ensure system includes are complete.

### Test binary does not run or crashes

- Confirm that your test binary links against all required libraries.
- Run with `--gmock_verbose=info` for call traces to diagnose.
- Disable optimizations or run with debug symbols to trace failures.

## 8. Additional Resources

- [gMock Cheat Sheet](gmock_cheat_sheet.md): Quick syntax reference and usage patterns.
- [gMock Cookbook](gmock_cook_book.md): Detailed recipes covering mock creation, actions, matchers, and advanced usages.
- [Mocking Reference](reference/mocking.md): Comprehensive API and macro documentation.
- [Legacy gMock FAQ](gmock_faq.md): Answers to older questions still relevant for migration or understanding.
- [Continuous Integration with GoogleTest](guides/integration-scenarios/ci-integration.mdx): Guide for running tests in CI.

---

By following these guidelines and using the best practices described, you will ensure a smooth integration of GoogleMock into your build systems and test pipelines, enabling reliable and maintainable mock-based testing.
