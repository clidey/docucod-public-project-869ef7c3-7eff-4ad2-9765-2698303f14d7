---
title: "CI Integration & Troubleshooting"
description: "Addresses frequent integration challenges with CI tools and third-party runners, such as GoogleTest Adapter, gtest-parallel, or custom CI systems. Guides users to diagnose failures unique to CI setups and automate reporting."
---

# CI Integration & Troubleshooting

This page addresses frequent challenges you may face when integrating GoogleTest with Continuous Integration (CI) tools and third-party runners such as the GoogleTest Adapter, gtest-parallel, or custom CI systems. It guides you through diagnosing failures that occur uniquely within CI environments and automating test result reporting to maximize your CI pipeline’s effectiveness.

---

## Frequently Asked Questions

### Why do my GoogleTest suites behave differently or fail in CI but not locally?
CI environments often differ in environment variables, available resources, parallelism, and output handling. Flaky tests may show failures due to timing, race conditions, or resource constraints unique to your CI setup. Additionally, CI tools or third-party runners may apply test filtering, sharding, or retries differently.

### How do I debug GoogleTest failures specific to CI environments?
1. **Check Test Filtering and Sharding Parameters:** CI systems may define environment variables like `GTEST_FILTER`, `GTEST_TOTAL_SHARDS`, `GTEST_SHARD_INDEX` that affect which tests run.
2. **Inspect Logs & Output:** Make sure your CI captures both stdout and stderr and any XML/JSON reports generated.
3. **Use `--gtest_repeat` and `--gtest_shuffle`:** Repeat tests multiple times and shuffle the order to catch flaky issues.
4. **Leverage `GTEST_BREAK_ON_FAILURE`:** When supported, enable for debugging within your CI environment.

### How can I configure GoogleTest to work smoothly with sharding and retries in CI?
- Use the environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` to split test workloads.
- Ensure your CI runner supports and preserves these environment variables.
- Use `--gtest_repeat` to repeat flaky tests automatically.
- Employ `--gtest_output=xml:<path>` or `--gtest_output=json:<path>` to generate test result files for CI dashboards.

### How do I generate test reports compatible with CI tools?
GoogleTest supports XML and JSON reports conforming to common CI formats. Use the `--gtest_output` flag to generate these:

```bash
--gtest_output=xml:/path/to/report.xml
--gtest_output=json:/path/to/report.json
```

These reports contain detailed information on each test and are ideal for integration with CI dashboards and visualization tools.

### How can I implement custom reporting or test event handling in CI?
GoogleTest provides an event listener API (`testing::TestEventListener`) to intercept and handle test lifecycle events. You can create a subclass to emit custom logs, integrate with external reporting, or enforce additional checks during test runs.

Here’s a minimal example:

```cpp
class CustomCIListener : public testing::EmptyTestEventListener {
 public:
  void OnTestEnd(const testing::TestInfo& test_info) override {
    if (!test_info.result()->Passed()) {
      std::cout << "Test " << test_info.test_suite_name() << "." << test_info.name()
                << " failed." << std::endl;
    }
  }
};

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  auto& listeners = testing::UnitTest::GetInstance()->listeners();

  // Remove default printer if desired.
  delete listeners.Release(listeners.default_result_printer());
  listeners.Append(new CustomCIListener);

  return RUN_ALL_TESTS();
}
```

---

## Common Issues & Solutions

### Issue: Tests are skipped or not running in CI
- Verify the `--gtest_filter` flag or `GTEST_FILTER` environment variable. Incorrect filters may exclude tests.
- Check if sharding variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` are set inconsistently.
- Use `--gtest_list_tests` to list all tests recognized by your test binary in the CI environment.

### Issue: Flaky tests due to concurrency or environment differences
- Utilize `--gtest_repeat` to rerun tests and identify flaky behavior.
- Apply `--gtest_shuffle` to randomize test execution order, exposing hidden dependencies.
- Consider isolating flaky tests or marking them disabled until fixes are implemented.

### Issue: XML/JSON reports not generated or accessible
- Ensure the output path specified with `--gtest_output` exists and is writable by the CI agent.
- Validate correct use of the format prefix, e.g., `xml:` or `json:` (e.g., `--gtest_output=xml:reports/tests.xml`).
- If outputting to a directory, GoogleTest will generate uniquely named files based on the executable.

### Issue: Test failures hard to debug due to lost stack trace or logs
- Enable `--gtest_break_on_failure` if supported, triggering a debugger break.
- Enable the `GTEST_INSTALL_FAILURE_SIGNAL_HANDLER` or platform-equivalent settings to get signal handlers printing stack traces.
- Collect and preserve CI logs thoroughly, including standard output and standard error.

---

## Debugging and Diagnostic Tips

### Checking Test Selection and Filtering

Use:

```bash
your_test_binary --gtest_list_tests
```

to list all tests the binary recognizes in the CI environment.

Use:

```bash
your_test_binary --gtest_filter=YourTestSuite.*
```

to limit execution and verify filtering behavior.

### Diagnosing Sharding Problems

- Validate shard indices and total shard counts are consistent and within ranges.
- Check environment variables in your CI logs:

```bash
printenv | grep GTEST_
```

- If a shard’s index exceeds total shards, the program will abort with an error.

### Using Repetition and Shuffling to Identify Flaky Tests

- Run with:

```bash
--gtest_repeat=N --gtest_shuffle
```

- Monitor for intermittent failures caused by order or timing.

### Analyzing Test Failures

- Review detailed failure messages printed by GoogleTest.
- If XML/JSON reporting is enabled, inspect the generated files for aggregated reports.
- Implement custom listeners if needed to capture special test metrics.

---

## Automating Reporting in CI Pipelines

### XML/JSON Reports Integration

- Most CI tools like Jenkins, CircleCI, and GitLab support importing JUnit XML reports.
- Configure GoogleTest using the `--gtest_output` flag to produce the reports at designated paths.
- Example:

```bash
./my_tests --gtest_output=xml:test-results/my_tests_report.xml
```

### Streaming Test Results

- On Linux/macOS, GoogleTest supports streaming test results to TCP endpoints with `--gtest_stream_result_to=host:port`.
- This is useful for custom real-time dashboards or CI systems.

### Handling Flaky Tests in CI

- Use retries via `--gtest_repeat` or CI-native retry mechanisms.
- Split test loads using sharding to reduce load and isolate flaky tests.

---

## Troubleshooting Checklist

- Verify that GoogleTest is initialized correctly by calling `InitGoogleTest(&argc, argv);` prior to `RUN_ALL_TESTS();`.
- Check environment variables and command-line flags related to test filtering, repetition, sharding, and output.
- Ensure output directories exist and are writable in the CI environment.
- Confirm that no test executable name or path changes unexpectedly in CI causing report file confusion.
- If using third-party runners, ensure compatibility with GoogleTest environment variables and flags.
- Use verbose logging and custom event listeners to gather more context about failures.

---

## Best Practices

- Always run GoogleTest with `InitGoogleTest` prior to `RUN_ALL_TESTS` in CI.
- Use `--gtest_filter` judiciously to focus on subsets of tests during debugging.
- Leverage `--gtest_repeat` and `--gtest_shuffle` to catch flaky and order-dependent tests.
- Generate XML or JSON reports via `--gtest_output` to integrate with CI dashboards.
- Avoid mixing test and test fixture naming conventions that confuse runners or filter syntax.
- Consider implementing custom test event listeners for richer reporting or alerts.

---

## References & Related Documentation

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) - for test writing basics
- [Running Tests and Test Discovery FAQ](faq/getting-started-common-issues/running-tests-discovery-faq) - for practical test running hints
- [Integration with Continuous Integration Guide](guides/solutions-and-patterns/integration-ci) - for CI-specific best practices
- [Test Registration and Execution API](api-reference/core-testing-apis/test-registration-and-execution) - deeper insight into GoogleTest internals
- [Assertions Reference](docs/reference/assertions.md) - assertion and failure handling
- [Writing Custom Event Listeners](docs/advanced.md#extending-googletest-by-handling-test-events) - for reporting customization

---

For detailed code examples including custom event listeners, visit the `googletest/samples/sample9_unittest.cc` in the [GoogleTest GitHub repository](https://github.com/google/googletest).

---

Feel free to contact the GoogleTest community or support channels listed under [Community & Support Resources](faq/performance-integration-support/community-support-channels) for direct help on complex CI integrations or troubleshooting advanced scenarios.
