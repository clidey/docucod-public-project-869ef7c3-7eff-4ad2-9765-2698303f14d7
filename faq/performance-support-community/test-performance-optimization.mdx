---
title: "How can I make my tests run faster or scale to large projects?"
description: "Best practices and recommendations for optimizing the performance of GoogleTest/GoogleMock, including running tests in parallel, minimizing fixture overhead, and advanced configuration tips. Addresses challenges faced in very large codebases."
---

# How can I make my tests run faster or scale to large projects?

Optimizing test performance and scaling testing to large C++ codebases is essential to maintain developer productivity and timely feedback cycles. This page provides actionable best practices and recommendations specific to GoogleTest and GoogleMock to help you accelerate test execution, reduce resource overhead, and manage complexity in large projects.

---

## 1. Run Tests in Parallel

### Why Run Tests in Parallel?
Test execution is often I/O-bound or CPU-bound, and running tests sequentially underutilizes available system resources. Running tests in parallel across multiple processor cores yields significantly faster total test suite execution.

### How to Enable Parallel Execution
- Use your build system's parallel test runner capabilities. For instance, tools like `ctest` or `bazel test` support parallel test execution.
- Split your tests into multiple executables or test shards to maximize concurrency.
- Use GoogleTest filters (`--gtest_filter`) to select subsets of tests to run in parallel on different workers.

<Tip>
Parallel test execution is the single most effective way to reduce test turnaround times in large codebases.
</Tip>

### Considerations
- Ensure your tests do not have shared state dependencies that cause conflicts.
- Beware of global resources or persistent states (like files, databases) that might lead to flaky failures due to concurrency.

---

## 2. Minimize Test Fixture Overhead

Test fixtures provide shared setup/teardown logic, but heavy setup can severely impact performance when repeated many times.

### Best Practices
- Use test suite (`TEST_F`) fixtures efficiently. Share immutable data rather than recreating it for each test where possible.
- Offload expensive initialization to suite-level `SetUpTestSuite` and `TearDownTestSuite` functions instead of per-test `SetUp` / `TearDown`.
- Prefer lightweight mocks and minimal dependencies over complex full dependency graphs.

<Note>
Each test gets a fresh fixture instance, so expensive constructions multiply with test count.
</Note>

---

## 3. Use ON_CALL and Default Actions Wisely

Specifying default behaviors for mocks via `ON_CALL` instead of overly strict `EXPECT_CALL` reduces overhead when many calls are expected but not critical to verify.

- Use `ON_CALL` to set default mock method responses without strict call count requirements.
- Reserve `EXPECT_CALL` for interactions that must be verified explicitly.

This minimizes unnecessary bookkeeping and verification costs.

---

## 4. Avoid Overly Fine-Grained Expectations

Expectations on mock calls (`EXPECT_CALL`) come with runtime overhead.

### Guidelines
- Group related expectations when possible rather than setting one for every single call.
- Avoid setting excessive cardinalities (e.g., expecting hundreds or thousands of calls explicitly).
- Use catch-all expectations with wildcards (`_`) combined with `Times(AnyNumber())` for unimportant calls.

---

## 5. Leverage RetiresOnSaturation for Expectations

Use `.RetiresOnSaturation()` on expectations with upper call count limits to let GoogleMock deactivate them when saturated, improving matching performance.

```cpp
EXPECT_CALL(mock, Foo(7)).Times(2).RetiresOnSaturation();
```

---

## 6. Reduce Template and Macro Complexity for Faster Compiles

- Move mock class constructor and destructor definitions to separate `.cc` files if they contain many mock methods. This limits template instantiations and speeds up compilation.
- Use type aliases to reduce verbosity in `MOCK_METHOD` macros especially when argument or return types contain template commas.

---

## 7. Use Sequencing and Partial Ordering Sparingly

Complex ordering constraints (`InSequence`, `.After()`, `Sequence` objects) increase runtime overhead and complexity.

- Apply ordering only when necessary to verify interaction correctness.
- Avoid global ordering constraints that reduce parallelism possibilities.

---

## 8. Profile and Optimize Slow Tests

### Identifying Bottlenecks
- Use GoogleTest's `--gtest_break_on_failure` combined with timing information to isolate slow tests.
- Run tests under profiling tools to identify expensive code paths.

### Refactoring Tips
- Split large tests into smaller, focused ones.
- Replace slow dependencies with mocks/stubs using GoogleMock.
- Batch expensive setup operations.

---

## 9. Harness GoogleMock's Thread Safety for Concurrent Access

GoogleMock supports thread-safe mock usage in tests. To improve scalability:

- Run multiple tests or threads that each use their own mock objects concurrently.
- Avoid setting expectations on mocks from multiple threads simultaneously.

Refer to the [gMock Cookbook: Using gMock and Threads](https://google.github.io/googletest/gmock_cook_book.html#using-gmock-and-threads) for detailed guidance.

---

## 10. Run Tests with Controlled Verbosity

Use the `--gmock_verbose` flag to adjust output verbosity:
- `info` for maximum tracing including call matches
- `warning` to suppress irrelevant info, show warnings only (default)
- `error` for minimal messages

Reducing verbosity can slightly speedup very large test runs by avoiding extra I/O.

---

## 11. Troubleshooting Common Performance Pitfalls

<AccordionGroup title="Common Performance Issues">
<Accordion title="Tests Hangs or Slowdowns Due to Shared Resources">
Shared resource contention (e.g., file I/O or network) can cause slow or flaky tests.

**Solution:** Mock such resources or serialize their access conservatively.
</Accordion>
<Accordion title="Excessive Mock Setup and Teardown">
Mock objects with many expectations or heavy default actions increase runtime.

**Solution:** Reduce strict expectations to only what is necessary. Use default behaviors.
</Accordion>
<Accordion title="Slow Compilation of Mock Classes">
Large mock classes with many methods cause slow incremental builds.

**Solution:** Split mock class implementations and reduce template complexity.
</Accordion>
</AccordionGroup>

---

## 12. Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Introductory guide to mocking.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Practical recipes including threading and performance tips.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) - API details for mocks, expectations, and matchers.
- [Using gMock with Threads](https://google.github.io/googletest/gmock_cook_book.html#using-gmock-and-threads) - Best practices for thread-safe mock usage.

---

_For comprehensive optimization of test performance and scaling, always profile your code and iteratively refine test granularity, mocking strategies, and execution setups._


---

#### Example: Running Tests in Parallel with Filtering

```bash
# Run all tests in parallel using 8 jobs
ctest --parallel 8

# Alternatively, run tests matching a pattern in parallel shards
ctest -j 4 -R "MyComponentTest.*"
```

#### Example: Minimizing Fixture Overhead

```cpp
class BigFixture : public ::testing::Test {
 protected:
  static void SetUpTestSuite() {
    // Construct a shared expensive resource once
    expensive_resource = PrepareExpensiveResource();
  }

  static void TearDownTestSuite() {
    CleanupExpensiveResource(expensive_resource);
  }

  static SharedResourceType* expensive_resource;
  void SetUp() override {
    // Use lightweight setup here
  }
  void TearDown() override {}
};

SharedResourceType* BigFixture::expensive_resource = nullptr;
```

This approach avoids repeated costly setup for each individual test in the suite.

---

#### Key Flags to Control Mock Behavior & Performance

| Flag | Description |
|-------|-------------|
| `--gmock_verbose=LEVEL` | Controls logging verbosity: `info`, `warning`, or `error` (default). |
| `--gmock_catch_leaked_mocks=0|1` | Enable or disable leaked mock detection which adds overhead. |

Use these flags to tune output and runtime overhead during testing.

---

For large-scale C++ projects, systematic application of these techniques creates faster, more reliable test executions and manageable mock maintenance.


---

If issues remain unresolved, consider consulting the FAQ for troubleshooting common problems related to build errors and test failures.

---

_Last updated: main branch_

---

_Source: [GoogleTest GitHub Repository](https://github.com/google/googletest)_

