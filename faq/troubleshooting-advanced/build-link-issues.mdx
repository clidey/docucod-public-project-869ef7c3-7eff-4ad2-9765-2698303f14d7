---
title: "Build and Link Issues"
description: "Guidance for resolving the most frequent build, linkage, and dependency errors seen when integrating or updating GoogleTest and GoogleMock in C++ projects. Step-by-step troubleshooting for failed compiles, missing symbols, and C++ standard mismatches."
---

# Build and Link Issues FAQ

This guide provides clear, practical solutions to the most common build and linking errors encountered when integrating or upgrading GoogleTest and GoogleMock in your C++ projects. Whether you face compiler errors, unresolved symbols, or incompatibilities with C++ standards, this FAQ walks you through diagnosing and resolving these problems to achieve smooth, reliable builds.

---

## 1. Common Build Errors and Their Remedies

### Why am I getting errors about missing C++17 support?

GoogleTest requires a C++17-compatible compiler to build successfully. If you see errors related to language features or standard support, verify:

- Your compiler supports C++17 or higher.
- The project is explicitly set to use C++17 in the build configuration.

**How to fix:**
- In your CMakeLists.txt, ensure you have:
  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```
- If building within another project, confirm the composing build system enforces this standard.

ðŸ“Œ _Failing to set the standard correctly will cause cryptic build errors or unexpected behavior in your tests._


### What causes "undefined symbols" or missing references during linking?

This usually means the GoogleTest libraries are not correctly linked into your test binary.

**How to fix:**
- Link against the appropriate GoogleTest libraries in your build configuration.
  For example, in CMake:
  ```cmake
  target_link_libraries(test_executable PRIVATE GTest::gtest_main)
  ```
- Ensure you link to either `gtest` or `gtest_main` depending on whether you provide your own main() or use GoogleTest's.
- If you build GoogleTest as a shared library, define the macro `GTEST_LINKED_AS_SHARED_LIBRARY=1` during compilation.


### How do I fix "RuntimeLibrary mismatch" errors on Visual Studio?

This arises when your project and GoogleTest link against different C runtime libraries (static vs dynamic).

**How to fix:**
- Enable `gtest_force_shared_crt` in your CMake configuration to use the shared CRT consistently:
  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```
- This ensures both your project and GoogleTest use the dynamic runtime, preventing linker conflicts.


### Why am I getting errors related to pthreads?

Some platforms require special handing for pthread linkage.

**How to fix:**
- If you use the GoogleTest CMake scripts, the pthread dependency is detected and linked automatically.
- In custom build configurations, ensure you explicitly link to pthread:
  ```bash
  -lpthread
  ```
- You can control thread usage by defining `-DGTEST_HAS_PTHREAD=1` or `-DGTEST_HAS_PTHREAD=0` as needed.


### What are the steps to build GoogleTest as a shared (DLL) library?

By default, GoogleTest builds as static libraries. To use it as a shared library:

1. Add `-DGTEST_CREATE_SHARED_LIBRARY=1` to your compiler flags for building GoogleTest.
2. Add `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when compiling your test binaries that link against the shared GoogleTest.
3. Ensure your linker settings produce a shared library (`.dll` on Windows, `.so` on Linux).

<Tip>
These flags may become required in the future due to improvements in library loading speed and visibility.
</Tip>


## 2. Linking GoogleTest into Your Project

### Using GoogleTest as a Standalone CMake Project

A common workflow:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
mkdir build
cd build
cmake ..  # Or cmake .. -DBUILD_GMOCK=OFF if you only want GoogleTest
make
sudo make install
```

### Incorporating GoogleTest into an Existing CMake Project

Recommended approaches:

- Use `find_package(GTest CONFIG REQUIRED)` to locate installed GoogleTest libraries.
- Or add GoogleTest as a subdirectory using `add_subdirectory()` for consistent compiler/linker settings.
- Use the `FetchContent` module to download GoogleTest as part of your projectâ€™s configure step, keeping dependencies managed and up to date.

Example snippet:

```cmake
include(FetchContent)
FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```


## 3. Troubleshooting Build and Link Problems

<AccordionGroup title="Common Troubleshooting Scenarios">
<Accordion title="Compiler Does Not Support C++17">
Make sure your compiler version is new enough (e.g., GCC 7+, Clang 5+, MSVC 2017+). Upgrade if needed. Specify C++17 explicitly in your project build.
</Accordion>
<Accordion title="Linker Errors: Undefined Reference to gtest Symbols">
Verify that you linked your test binaries against `gtest` or `gtest_main`. Missing linking is the top cause. Also check if multiple conflicting versions of GoogleTest exist in your build environment.
</Accordion>
<Accordion title="RuntimeLibrary Mismatch on Windows">
Enable `gtest_force_shared_crt` or align your project runtime settings with GoogleTest's. Avoid mixing static and dynamic CRT linkage.
</Accordion>
<Accordion title="Problems with pthreads on *nix">
Explicitly link `pthread` if using custom build systems. Use `-DGTEST_HAS_PTHREAD=1` or disable with `0` depending on your environment.
</Accordion>
<Accordion title="Shared Library Loading Failures">
Confirm you compile and link with the shared library flags as documented. Define `GTEST_CREATE_SHARED_LIBRARY` when building GoogleTest, and `GTEST_LINKED_AS_SHARED_LIBRARY` when building tests.
</Accordion>
</AccordionGroup>


## 4. Best Practices to Avoid Build and Link Issues

- **Consistent Compiler and Linker Settings:** Make sure GoogleTest and your project share the same compiler, standard version, and runtime library settings.

- **Use Official CMake Functions:** Leverage GoogleTestâ€™s provided CMake functions such as `FetchContent` to manage dependencies and avoid version mismatches.

- **Build GoogleTest as Part of Your Project:** Embedding GoogleTest sources inside your main build via `add_subdirectory()` prevents ABI issues and configuration mismatches.

- **Set Appropriate Compiler Flags:** Specify the C++ standard and threading options clearly to avoid confusion.

- **Install and Link Correctly:** If installing GoogleTest separately, ensure that your `PKG_CONFIG_PATH` or equivalent environment variables point to the installed `.pc` files.

<Tip>
Using pkg-config files generated by GoogleTest helps automate compiler and linker flag management across various build systems.
See the [Using GoogleTest from Various Build Systems](docs/pkgconfig.md) for detailed instructions.
</Tip>


## 5. Additional Resources

- [Generic Build Instructions - README.md](https://github.com/google/googletest/blob/main/README.md)
- [Quickstart: Building with CMake](docs/quickstart-cmake.md)
- [Using GoogleTest from Various Build Systems (pkgconfig)](docs/pkgconfig.md)
- [Integrating with Build Systems and CI](guides/advanced-usage-integration/integration-build-systems.mdx)
- [Troubleshooting Common Issues](getting-started/first-test-troubleshooting/troubleshooting-common-issues.mdx)


---

For a deeper dive into adapting GoogleTest builds for your platform and customizing build options, see the [Portability and Configuration](api-reference/utilities-and-integration/portability-and-configuration.mdx) and [Integration Patterns](concepts/advanced-concepts/integration-patterns.mdx) guides.

---

With these practices and pointers, you can diagnose and resolve the most prevalent build and link errors, streamlining your experience using GoogleTest and GoogleMock in your C++ testing workflows.


---

<CardGroup cols={2}>
<Card title="Step-by-Step Fix: RuntimeLibrary Mismatch">
<Steps>
<Step title="Enable Shared CRT in CMake">
Add `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` before calling `FetchContent_MakeAvailable`.
</Step>
<Step title="Rebuild GoogleTest">
Clean and rebuild GoogleTest and your project with consistent runtime linkage.
</Step>
<Step title="Verify Linking">
Confirm linker input includes GoogleTest libraries without conflicts.
</Step>
</Steps>
</Card>
<Card title="Common Linker Error Messages">
- `undefined reference to 'testing::InitGoogleTest'`
- `error LNK2038: mismatch detected for 'RuntimeLibrary'`
- `cannot find -lgtest_main`
- `multiple definition of ...`
</Card>
</CardGroup>


---

## Frequently Asked Questions (Bonus)

**Q: Should I build GoogleTest as static or shared libraries?**

A: The default and simplest approach is static libraries. Shared libraries are optionally supported but require extra flags and care to avoid runtime issues.


**Q: How do I avoid stale or conflicting GoogleTest builds?**

A: Use clean build directories, avoid mixing installation methods, and prefer embedding GoogleTest sources directly when practical.


**Q: Can I use GoogleTest with other build systems besides CMake?**

A: Yes, see `docs/pkgconfig.md` for hints on using pkg-config with diverse build tools, including Make and Bazel.


**Q: Why do I get errors related to `GTEST_DONT_DEFINE_<MACRO>`?**

A: These flags help avoid macro conflicts when GoogleTest macros collide with other libraries. Define only the needed ones, as described in the Generic Build Instructions.


---

End of `Build and Link Issues` FAQ documentation.
