---
title: "Build System and Integration Troubleshooting"
description: "Step-by-step help for resolving build system integration issues, such as linking GoogleTest into your project, build errors using CMake or Bazel, and using GoogleMock with GoogleTest. Designed to support smooth project integration in a variety of workflows."
---

# Build System and Integration Troubleshooting

Step-by-step guidance to resolve common build system integration issues when incorporating GoogleTest and GoogleMock into your C++ project workflow. This page focuses on troubleshooting linking problems, build errors using CMake or Bazel, and combining GoogleMock with GoogleTest, to help maintain smooth project builds across platforms and environments.

---

## Common Build and Linking Issues

When integrating GoogleTest and GoogleMock into your project, build errors often arise due to incorrect linking, missing dependencies, or misconfigured build options. Understanding these common problems helps quickly resolve them.

### 1. Linker Errors Related to GoogleTest/GMock Symbols

- **Problem:** Undefined references to GoogleTest or GoogleMock functions or symbols during linking.
- **Why it Happens:** 
  - Forgetting to link against the correct GoogleTest/GMock libraries (`gtest`, `gtest_main`, `gmock`, `gmock_main`).
  - Incorrect order of libraries in the linker command.
  - Using incompatible static vs shared library linkage.

- **How to Fix:**
  - Link your test executable against `gtest_main` if you want the default GoogleTest `main()`.
  - When using GoogleMock, link against `gmock_main` or `gmock` plus `gtest` as appropriate.
  - Ensure linking order: `-lgmock_main -lgmock -lgtest -lpthread` at minimum.
  - If using CMake, link targets with `target_link_libraries(your_test PRIVATE gtest_main gmock)`.

<Tip>
Linking the `gmock_main` library provides a ready-made `main()` function for GoogleMock tests, which initializes the test framework correctly.
</Tip>

### 2. Missing Headers or Include Path Issues

- **Problem:** Compilation errors citing missing GoogleTest or GoogleMock header files.
- **Why it Happens:**
  - Include directories are not properly set in your build environment.
  - Using raw source integration without proper include paths.

- **How to Fix:**
  - Add the GoogleTest and GoogleMock include directories to your compiler's include search paths.
  - In CMake, use `target_include_directories()` or ensure the imported target provides the include paths.

---

## Troubleshooting with CMake

GoogleTest and GoogleMock provide CMake support to simplify integration, but you may run into issues if setup is incomplete.

### 1. Using GoogleTest and GoogleMock via `add_subdirectory`

- Add the GoogleTest or GoogleMock source tree (or your downloaded copy) to your project via `add_subdirectory(path_to_googletest)`.
- Link your test targets against the imported targets `gtest`, `gtest_main`, `gmock`, and `gmock_main` as appropriate.

Example CMake snippet:

```cmake
# Add GoogleTest and GoogleMock to your build
add_subdirectory(third_party/googletest)

# Define your test executable
add_executable(my_tests tests/my_tests.cc)

# Link against GoogleTest and GoogleMock libraries
target_link_libraries(my_tests PRIVATE gtest_main gmock)
```

### 2. Handling Pthread Dependencies

GoogleTest requires pthread support on POSIX platforms. The CMake scripts detect and link pthread automatically where available.

If you get unresolved pthread symbols:

- Ensure your platform supports pthreads.
- Manually link pthread in CMake if needed:

```cmake
target_link_libraries(my_tests PRIVATE pthread)
```

### 3. Common CMake Build Errors and Fixes

| Error                                     | Cause                         | Resolution                                        |
|-------------------------------------------|-------------------------------|--------------------------------------------------|
| `undefined reference to pthread_create`   | Missing pthread linkage        | Link pthread library manually or fix platform detection |
| Linker errors with missing GoogleTest symbols | Misconfigured libraries or missing targets | Verify linking to `gtest` and `gtest_main` correctly |
| Multiple definitions or symbol conflicts   | Mixing static/shared libraries inconsistently | Ensure consistent linkage across all dependencies |

<Tip>
To avoid linker conflicts, prefer linking only one main library: use either `gtest_main` or provide your own main function and link to `gtest`.
</Tip>

---

## Troubleshooting with Bazel

Bazel supports GoogleTest and GoogleMock integration with configured rules.

- Use the provided Bazel rules for tests, typically `cc_test` with dependencies on `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock`.
- Ensure your workspace has the GoogleTest repository properly declared.

Common issues:

- Missing dependencies in `BUILD` files.
- Incorrect visibility or target names.

For Bazel-specific setup, see the [Integrations and Supported Platforms](/overview/architecture-integration/integration-environments) and [Build System Integration](/guides/integration-advanced/build-system-integration) pages.

---

## Using GoogleMock with GoogleTest

GoogleMock depends on GoogleTest internally and must be integrated carefully.

### 1. Linking GoogleMock

- Link your test executable against `gmock_main` for standalone usage that initializes GoogleMock and GoogleTest appropriately.

- Alternatively, link against `gmock` and `gtest_main` if you provide your own initialization.

Example CMake:

```cmake
target_link_libraries(my_mock_tests PRIVATE gmock_main)
```

### 2. Initialization

- Use `testing::InitGoogleMock(&argc, argv);` in your `main()` if you write your own main function.
- If linking against `gmock_main`, the main function is provided.

### 3. Common Integration Issues

| Issue                                  | Cause                                  | Fix                                                            |
|---------------------------------------|--------------------------------------|----------------------------------------------------------------|
| Linker error on `InitGoogleMock`      | Missing GoogleMock linkage             | Link with `gmock` or `gmock_main`                               |
| Duplicate `main()` symbol             | Linking both `gtest_main` and `gmock_main` | Link only one of `gtest_main` or `gmock_main` libraries          |

<Tip>
When your tests require mocks, prefer linking to `gmock_main`. Otherwise, use `gtest_main` for only GoogleTest.
</Tip>

---

## Best Practices for Smooth Integration

- Prefer using the provided main libraries (`gtest_main` or `gmock_main`) to avoid boilerplate main functions.
- Ensure that your build system’s include paths and linker flags are consistent across all configurations and platforms.
- When mixing GoogleTest and GoogleMock, always initialize via `InitGoogleMock()` in your main or link against `gmock_main`.
- Regularly update GoogleTest and GoogleMock sources to get the latest build system fixes.
- For custom build systems, refer to the official GoogleTest GitHub repository and examine the provided CMakeLists.txt and Bazel BUILD files for reference.

---

## Diagnosing and Fixing Common Issues

### Step-by-Step Troubleshooting Workflow

1. **Verify Include Paths**
   - Confirm that your compiler can find `gtest/gtest.h` and `gmock/gmock.h`.
2. **Check Linked Libraries**
   - Confirm `gtest`, `gtest_main`, `gmock`, and/or `gmock_main` libraries are linked.
3. **Check Linking Order**
   - Link GoogleMock before GoogleTest (`-lgmock -lgtest`).
4. **Examine Build Output**
   - Look for missing symbols or macro redefinitions.
5. **Test with Minimal Example**
   - Create a minimal test executable linking just the framework to isolate issues.
6. **Rebuild GoogleTest/GoogleMock**
   - Especially if building manually, rebuild cleanly.
7. **Consult Logs and Flags**
   - Use CMake verbose builds or verbose Bazel output to debug.

<Tip>
The `gmock_main` library internally calls `InitGoogleMock()` which initializes GoogleMock and GoogleTest properly, so linking it avoids common initialization errors.
</Tip>

---

## Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) – Introductory guide to writing tests with GoogleTest.
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) – Practical recipes for mock testing.
- [Build System Integration Guide](/guides/integration-advanced/build-system-integration) – How to setup GoogleTest with CMake and Bazel.
- [Troubleshooting Common Setup Issues](/getting-started/troubleshooting-resources/troubleshooting-common-issues) – General setup error fixes.
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md) – Overview and installation tips for GoogleMock.

---

## Example: Simple CMake Integration

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyTests LANGUAGES CXX)

# Add GoogleTest and GoogleMock
add_subdirectory(third_party/googletest)

add_executable(my_tests test/my_tests.cpp)

# Link with gmock_main to get GoogleMock, GoogleTest, and main() function
target_link_libraries(my_tests PRIVATE gmock_main)

# Enable C++17 standard
set_target_properties(my_tests PROPERTIES CXX_STANDARD 17 CXX_STANDARD_REQUIRED ON)
```

With this setup, your tests will build, link, and run with GoogleMock and GoogleTest working seamlessly.

---

## Example: Writing `main()` with GoogleMock Initialization

If you choose to provide your own main function instead of linking `gmock_main`, use:

```cpp
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This ensures both GoogleMock and GoogleTest flags and internals are properly initialized.

---

## Summary

This documentation focused strictly on troubleshooting and resolving build system issues when integrating GoogleTest and GoogleMock. It emphasizes correct linking, proper initialization, and build tool configurations to eliminate common errors and ensure reliable test builds.

---

## Frequently Encountered Problems Overview

<AccordionGroup title="Common Build and Integration Issues">
<Accordion title="Linker Errors: Undefined References to GoogleTest/GoogleMock Symbols">
Ensure you link against `gtest_main` or `gmock_main` appropriately. Avoid mixing both `gtest_main` with `gmock_main` to prevent duplicate `main()` symbols.
</Accordion>
<Accordion title="Missing Headers or Include Path Problems">
Verify the include directories for GoogleTest and GoogleMock are correctly specified. For CMake, this is typically automatic with `add_subdirectory` and target link usage.
</Accordion>
<Accordion title="Pthread Linker Errors">
Explicitly link `pthread` if you experience errors related to threading symbols, especially on Linux and macOS.
</Accordion>
<Accordion title="GoogleMock Initialization Fails or Tests Not Running">
Link to `gmock_main` or call `testing::InitGoogleMock` in your `main()`. These initialize GoogleMock as well as GoogleTest correctly.
</Accordion>
</AccordionGroup>

---

## Final Tips and Best Practices

- Use the official CMake and Bazel integration guides as your starting point.
- Avoid mixing shared and static GoogleTest/GoogleMock builds unless you understand linkage implications.
- Keep your GoogleTest/GoogleMock checkout up to date for the latest build fixes.
- When in doubt, isolate the problem by compiling a minimal test application with GoogleTest and GoogleMock.
- Engage the community on GitHub or official forums if complex integration issues persist.

---

<Check>
Always verify that your build system links against the correct GoogleTest and GoogleMock libraries and initializes the framework properly before running tests.
</Check>


---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/CMakeLists.txt", "range": "1-200"},{"path": "docs/reference/mocking.md", "range": "1-600"},{"path": "googlemock/src/gmock_main.cc", "range": "1-60"},{"path": "googletest/src/gtest_main.cc", "range": "1-65"}]} />
