---
title: "Integration & Build Failures"
description: "Guides users through resolving integration issues with build systems like CMake and Bazel, library linking problems, and compatibility mismatches. Offers troubleshooting checklists for frequent build errors across platforms."
---

# Integration & Build Failures FAQ

This guide equips you to diagnose and resolve common issues encountered when integrating GoogleTest and GoogleMock with build systems such as CMake and Bazel. It also addresses frequent problems related to library linking, compatibility mismatches, and configuration errors that prevent tests from compiling or running correctly.

---

## 1. Common Integration Issues

### Why does my build fail to find GoogleTest or GoogleMock headers?
GoogleTest and GoogleMock are header and source-based libraries. You must tell your build system where to find their headers, typically under an `include` directory, and which source files or libraries to link against.

- **With CMake:** Use `add_subdirectory()` or `find_package(GTest)` to locate the libraries. When using `add_subdirectory()`, ensure GoogleTest paths are correct.
- **With Bazel:** Make sure `googletest` is added as a dependency in your `BUILD` file.

<Tip>
Ensure that your project's include directories are updated to reference GoogleTest's and GoogleMock's header paths. Missing include paths cause compilation errors such as "file not found".
</Tip>

### What causes unresolved symbol errors linking with GoogleTest or GoogleMock?
These errors occur when your test executable doesn't link properly with GoogleTest/GoogleMock libraries.

- Link statically or dynamically to the right libraries, such as `gtest`, `gtest_main`, `gmock`, or `gmock_main`.
- If using GoogleMock features, link with `gmock` libraries.
- To avoid writing your own `main()`, link against `gtest_main` or `gmock_main`.

<Check>
Verify that your linker command includes the necessary `-lgtest` or `-lgmock` flags or their CMake targets.
</Check>

### How can I avoid runtime errors due to mismatched runtimes or library versions (e.g., MSVC issues)?
Ensure consistent runtime library settings across GoogleTest/GoogleMock and your project. Particularly with MSVC:

- Use `gtest_force_shared_crt` CMake option to align runtime DLL linkage.
- Avoid mixing debug/release builds between your code and GoogleTest.
- Always build and link GoogleTest with the same compiler and environment settings.

---

## 2. Troubleshooting Build Errors

### My tests fail to compile after upgrading GoogleTest. What changed?
GoogleTest evolves, and some macros or APIs may be deprecated. For instance, linking and macro usage in GoogleMock have modernized.

- Check the [breaking changes](https://github.com/google/googletest/blob/main/changelog/breaking-changes/breaking-changes-summary.md) documentation.
- Migrate old mocking macros to the new `MOCK_METHOD` macro.

### I get "multiple definition of main" error. How do I fix it?
This error usually means you linked both `gtest_main` and provided your own `main` function.

- Use `gtest` if you provide your own `main()`.
- Use `gtest_main` (or `gmock_main` if using mocks) if you want to use the default test runner.

### Linking errors on Linux with pthreads?
GoogleTest uses pthread in its implementation.

- Ensure you link with `-lpthread` or your build system automatically adds it.
- With CMake, the GoogleTest CMake integration manages this for you.

---

## 3. Specific Build System Notes

### CMake Integration Pitfalls

- Always verify the GoogleTest source directory is correct when adding `add_subdirectory()`.
- Remember to enable testing with `enable_testing()` if you want to run your tests via CTest.
- If using GoogleMock, include the GoogleMock CMakeLists alongside GoogleTestâ€™s.
- Use CMake targets `gtest::gtest`, `gtest::gtest_main`, `gmock::gmock`, and `gmock::gmock_main` when possible to benefit from proper include and link settings.

<Tip>
Set `-DBUILD_GMOCK=ON` when invoking CMake on GoogleTest source if you want GoogleMock included.
</Tip>

### Bazel Build Issues

- Declare the `googletest` dependency and link it properly in your `BUILD` files.
- Use `cc_test` rules for test binaries.

---

## 4. Library Linking & Compatibility

### Should I link GoogleMock with GoogleTest explicitly?
Yes. GoogleMock depends on GoogleTest. The linking order and dependencies should be:

```
link_libraries(gmock)  // which depends on gtest internally
```

### What if I want to use shared libraries (DLLs) of GoogleTest/GoogleMock?

- Define `-DGTEST_CREATE_SHARED_LIBRARY=1` when building GoogleTest to build shared libraries.
- Link your test code with `-DGTEST_LINKED_AS_SHARED_LIBRARY=1`.
- On Windows, ensure your build uses matching runtime linkage (dynamic vs static).

---

## 5. Checklist for Resolving Integration & Build Failures

<Steps>
<Step title="Step 1: Confirm Include Paths">
Validate that your build system includes GoogleTest and GoogleMock header directories.
</Step>
<Step title="Step 2: Verify Linked Libraries">
Ensure linking against the correct set of libraries: `gtest`, `gtest_main`, `gmock`, and `gmock_main` as needed.
</Step>
<Step title="Step 3: Check Compiler and Build Flags">
Match compiler standards (C++17 or newer) and runtime library settings across your project and GoogleTest dependencies.
</Step>
<Step title="Step 4: Align Build System Integration">
For CMake, prefer targets like `GTest::gtest`. For Bazel, declare proper dependencies and use `cc_test` rules.
</Step>
<Step title="Step 5: Consult Detailed Logs and Error Messages">
Use verbose build output and linker diagnostics to pinpoint missing files or mismatches.
</Step>
<Step title="Step 6: Ensure No Duplicate Main Functions">
Link with either `gtest_main` or provide your own `main()`, but not both.
</Step>
</Steps>

---

## 6. Related Troubleshooting

For setup and installation issues that block integration, refer to:

- [Common Installation & Setup Problems](../../getting_started/troubleshooting/common_problems)
- [Prerequisites & Supported Platforms](../../getting_started/setup_requirements/prerequisites_platforms)
- [Installing with CMake](../../getting_started/installation_integration/install_cmake)
- [Installing with Bazel](../../getting_started/installation_integration/install_bazel)

For linking-related build errors, consult:

- GoogleTest READMEâ€™s Generic Build Instructions
- GoogleMock CMakeLists.txt as a reference for proper build configuration

---

## 7. Getting Further Help

If problems persist, consult:

- [Community & Further Help](../../getting_started/troubleshooting/community_resources)
- GitHub issue tracker for GoogleTest: https://github.com/google/googletest/issues

---

## 8. Example: Linking GoogleTest with CMake

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyTestProject)

# Assume googletest is downloaded as a submodule or fetched
add_subdirectory(path/to/googletest)

add_executable(my_tests test1.cpp test2.cpp)

target_link_libraries(my_tests gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

Ensure you replace `path/to/googletest` with the actual path.

## 9. Example: Avoiding "multiple main" Error

```cmake
# Either link with gtest_main and do not write your own main.cpp
target_link_libraries(my_tests gtest_main)

# OR

# Write your own main.cpp
add_executable(my_tests main.cpp test1.cpp test2.cpp)
target_link_libraries(my_tests gtest)
```

Mixing both will cause linker errors.

---

This page is part of the broader [Troubleshooting & FAQ](../../getting_started/troubleshooting/common_problems.md) and complements the [Getting Started](../../getting_started/index.md) and [Installation & Integration](../../getting_started/installation_integration/index.md) documentation.

---

*For more details, also visit:*
- [GoogleTest README](https://github.com/google/googletest/blob/main/README.md)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [CMakeLists.txt reference](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)

---

*Happy Testing!* ðŸŽ¯
