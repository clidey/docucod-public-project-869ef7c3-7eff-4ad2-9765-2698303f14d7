---
title: "Integration & Build Troubleshooting"
description: "Answers to questions about integrating GoogleTest with build systems such as CMake or Bazel, resolving dependency issues, and troubleshooting problems within continuous integration pipelines."
---

# Integration & Build Troubleshooting FAQ

Offering clear, actionable answers for developers integrating GoogleTest with build systems like CMake or Bazel, this page addresses common dependency and configuration issues, and resolves problems encountered within continuous integration (CI) pipelines.

---

## Frequently Asked Questions

### 1. How do I properly integrate GoogleTest with CMake?

When adding GoogleTest to your CMake project, you have two main options:

- **Find Installed Package:** Use `find_package(GTest CONFIG REQUIRED)` if GoogleTest is installed on your system. Then link your test targets with `GTest::gtest` and/or `GTest::gtest_main`.

- **Add GoogleTest as a Subdirectory:** Include GoogleTest source in your project using `add_subdirectory()`, usually pointing to your local or external fetch of GoogleTest.

Example for subdirectory integration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests GTest::gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

For consistent compiler and linker settings, embedding GoogleTest as a subdirectory is recommended, especially on Windows to avoid runtime conflicts.

---

### 2. How can I resolve dependencies conflicts or mismatches when linking GoogleTest?

- Ensure that your project and GoogleTest are built with the same compiler version and compatible compiler flags.
- Confirm that both are linking against the same runtime (e.g., dynamic vs static CRT on Windows). Use `gtest_force_shared_crt` CMake option to align GoogleTest's CRT linkage with your project.
- Avoid mixing debug and release builds between your project and GoogleTest libraries.
- If using shared libraries or DLLs, define the following compiler flags:

```bash
-DGTEST_CREATE_SHARED_LIBRARY=1
-DGTEST_LINKED_AS_SHARED_LIBRARY=1
```

as appropriate during compile and link time.

---

### 3. What are common issues integrating GoogleTest with Bazel?

- Ensure your `WORKSPACE` and `BUILD` configurations properly declare GoogleTest dependencies.
- Use the official `googletest` Bazel rules to avoid manual build complexities.
- Be sure to import both `@com_google_googletest//:gtest` (for core libraries) and `@com_google_googletest//:gtest_main` (which includes `main()` implementation) if you want the default test entry point.
- Verify that your Bazel toolchain supports C++17 or later as required.

---

### 4. How do I troubleshoot failures in continuous integration pipelines when running GoogleTest?

- **Check Environment:** Confirm that the CI environment has the required compiler and dependencies installed with compatible versions.
- **Verify Build Steps:** Make sure GoogleTest is built correctly before running tests.
- **C++ Standard:** Ensure the C++17 standard is enabled for both your code and GoogleTest in your build configuration.
- **Threading Support:** If running multithreaded tests, validate the availability of `pthread` or equivalent on the CI environment.
- **Test Output:** Configure GoogleTest to generate XML reports (e.g., `--gtest_output=xml:<path>`) to integrate with CI tools.

---

### 5. How can I resolve runtime errors or linking errors about missing GoogleTest symbols?

- Confirm that your test executable links against the GoogleTest or GoogleMock libraries.
- Ensure your `CMakeLists.txt` or build scripts include GoogleTest sources or library targets correctly.
- If using static libraries, ensure that all required GoogleTest source files are compiled.
- On Windows, be wary of name mangling or runtime library mismatches.
- Inspect your linker command to verify that the GoogleTest libraries appear in the link order after your object files.

---

### 6. What CMake options are important when building GoogleTest?

- **`gtest_force_shared_crt`**: Use this to link GoogleTest against the dynamic runtime on Visual Studio.
- **`BUILD_GMOCK`**: Enable to build GoogleMock support alongside GoogleTest.
- **`BUILD_SHARED_LIBS`**: Set to `ON` to build shared (DLL) versions of GoogleTest and GoogleMock.

Example:

```bash
cmake .. -DBUILD_SHARED_LIBS=ON -DBUILD_GMOCK=ON -Dgtest_force_shared_crt=ON
```

---

### 7. How to avoid issues caused by macro name clashes with GoogleTest?

GoogleTest defines macros like `TEST`, `ASSERT_EQ`, and others, which can clash with other libraries.

To avoid this:

- Use compiler flags to rename these macros by prefixing with `GTEST_` (e.g., `GTEST_TEST` instead of `TEST`):

```bash
-DGTEST_DONT_DEFINE_TEST=1
```

- Apply the corresponding flags for other macro conflicts like `ASSERT_EQ` etc.

Refer to the *Avoiding Macro Name Clashes* section in the GoogleTest [README](../getting-started/installation-config/README.md) for details.

---

## Common Issues & Fixes

<AccordionGroup title="Typical Integration Pain Points">
<Accordion title="Linker Errors: unresolved external symbols">

Ensure you link against the appropriate libraries: `gtest`, `gtest_main`, `gmock`, or `gmock_main`. Verify that these libraries are built and linked.

For CMake:

```cmake
target_link_libraries(your_test_target gtest_main)
```

On Windows, check for static/dynamic CRT mismatch and consider enabling `gtest_force_shared_crt`.

</Accordion>
<Accordion title="Version Mismatches Between GoogleTest and Project">

Linking errors or runtime failures can arise if different compiler options or versions are used to build GoogleTest vs your project. Synchronize compiler versions, flags, and C++ standards.

</Accordion>
<Accordion title="Tests Not Running in CI">

Verify that `RUN_ALL_TESTS()` is called in your main test executable and that `testing::InitGoogleMock()` or `testing::InitGoogleTest()` is initialized properly.

Also, confirm the CI build pipeline runs tests and captures/pass test results correctly.

</Accordion>
<Accordion title="Incorrect Test Output or Missing Results">

Make sure the test runner is invoked with output options such as:

```
--gtest_output=xml:test_results.xml
```

Check that your CI platform supports parsing GoogleTest XML reports.

</Accordion>
</AccordionGroup>

---

## Troubleshooting Steps

### Step-by-Step to Fix Build & Integration Issues

<Steps>
<Step title="Verify Compiler Compatibility">
Ensure compiler supports C++17 as required by GoogleTest. Use compatible compiler versions for your project and GoogleTest.
</Step>
<Step title="Check Build Configuration">
Confirm GoogleTest is built (standalone or via subdirectory) and libraries exist.
</Step>
<Step title="Validate Linking Order and Flags">
Make sure your test targets link GoogleTest libraries with matching settings.
</Step>
<Step title="Fix Macro Clashes">
Apply `DGTEST_DONT_DEFINE_*` defines if your code conflicts with GoogleTest macros.
</Step>
<Step title="Use Verbose Output in CI">
Add `--gtest_verbose=info` or `--gtest_color=yes` to debug CI test runs.
</Step>
<Step title="Inspect CI Environment">
Verify all build dependencies and environment variables are correctly set.
</Step>
<Step title="Clean and Rebuild">
Sometimes stale builds cause linker errors—clear build artifacts and rebuild.
</Step>
</Steps>

---

## Practical Tips & Best Practices

- Use CMake’s `FetchContent` to smoothly embed GoogleTest in your project, giving consistent configuration.
- Always match runtime library linkage between GoogleTest and your project, especially on Windows.
- When modifying GoogleTest integration, clean builds avoid hidden build cache issues.
- Use `gtest_can_break_on_failure` and similar runtime flags sparingly and only in debugging scenarios.
- Enable verbose flags (`--gtest_verbose=info`) during CI setup to surface hidden issues.
- Manage dependencies carefully to avoid multiple conflicting versions of GoogleTest or GoogleMock.

---

## Related Documentation

- [CMake Integration Guide](../getting-started/installation-config/cmake-integration.md)
- [Bazel Integration Guide](../getting-started/installation-config/bazel-integration.md)
- [Continuous Integration Best Practices](../guides/integration-and-best-practices/ci-best-practices.md)
- [Build and Install from Source](../getting-started/installation-config/build-from-source.md)
- [FAQ: Installation & Setup Issues](../faq/general-usage-faq/installation-setup.md)


<Check>
For build system integration help, visit the [GoogleTest GitHub repository](https://github.com/google/googletest) and explore the example CMake configurations.
</Check>

---

## Example: Minimal CMake Setup to Include GoogleTest

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

# Fetch GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(unit_tests test_main.cpp test_example.cpp)
target_link_libraries(unit_tests gtest_main)

enable_testing()
add_test(NAME unit_tests COMMAND unit_tests)
```

This will build GoogleTest with your project and link it into your test executable.


---

## Troubleshooting Common Errors

### Error: `undefined reference to gtest::internal::...` 

This usually means the GoogleTest library is not linked or your linker command is missing the necessary GoogleTest targets.

- In CMake, confirm you link `gtest` or `gtest_main`.
- In Bazel, ensure proper dependency declarations.

### Runtime executable fails to run or finds symbols missing

- Verify proper runtime library linkage (static vs dynamic CRT).
- Confirm your environment loads the GoogleTest shared libraries if used.

### Tests silently do not run

- Make sure that the `main()` function calls `testing::InitGoogleTest()` or `testing::InitGoogleMock()` and `RUN_ALL_TESTS()`.
- Ensure your test executable is run as a test in the CI pipeline.


---

This page aims to empower developers integrating GoogleTest seamlessly across various build ecosystems, troubleshoot integration issues efficiently, and maintain robust CI pipelines with reliable testing workflows.
