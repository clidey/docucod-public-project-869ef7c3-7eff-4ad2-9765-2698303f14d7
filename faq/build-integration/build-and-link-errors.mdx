---
title: "Resolving Build and Link Errors"
description: "Guides users through troubleshooting linking, compilation, and dependency issues, with diagnostics for CMake, Bazel, and other common build systems. Ensures tests are discoverable and run correctly."
---

# Resolving Build and Link Errors

This page provides comprehensive guidance to troubleshoot and resolve common build, linking, and dependency issues encountered when integrating and building GoogleTest and GoogleMock-based tests. It covers diagnostics and practical solutions for CMake, Bazel, and other standard C++ build systems, ensuring your tests are discoverable and run correctly.

---

## Frequently Asked Questions

### 1. Why do I get link errors related to GoogleMock or GoogleTest symbols?

Link errors often occur when your build setup does not correctly link against the GoogleMock and GoogleTest libraries. Make sure your build system includes `-lgmock` and `-lgtest` libraries, and that the library search paths (`-L`) include their locations.

For example, in CMake, link your test target against `gmock` and `gtest`:

```cmake
add_executable(my_test test_main.cpp)
find_package(GTest REQUIRED)
target_link_libraries(my_test GTest::gtest GTest::gmock)
```

If using Bazel, ensure your `deps` includes the `@com_google_googletest//:gmock` and `@com_google_googletest//:gtest` targets.

### 2. My tests fail to compile due to missing headers like `gmock/gmock.h`.

This usually means your include paths are not correctly set. With CMake, use `find_package(GTest REQUIRED)` and link to `GTest::gmock` which will automatically set include directories.

If building manually, ensure the include path points to the directory containing GoogleMock's headers, for example:

```
-I/path/to/googletest/googlemock/include
```

### 3. How to ensure mocked methods and tests are properly linked?

Mocked methods are generated via the `MOCK_METHOD` macros, which rely on correct compiling and linking of gMock source and headers. Always link your test binaries with the gMock library, which contains the necessary implementations.

### 4. Why are my tests not discovered or not running?

GoogleTest automatically discovers tests defined by macros such as `TEST` or `TEST_F`. For discovery to work:

- Call `testing::InitGoogleMock(&argc, argv);` at the start of your `main()`.
- Link the test binary against GoogleTest and GoogleMock libraries.
- Use `RUN_ALL_TESTS()` in your `main()` to execute tests.

Documented example from the `gmock-spec-builders_test.cc` shows:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  // Setting flags for consistent test results
  GMOCK_FLAG_SET(catch_leaked_mocks, true);
  GMOCK_FLAG_SET(verbose, testing::internal::kWarningVerbosity);

  return RUN_ALL_TESTS();
}
```

### 5. How to troubleshoot build problems with CMake or Bazel?

**CMake:** Make sure the GoogleTest and GoogleMock packages are found and linked properly. Use the official [GoogleTest CMake integration](https://github.com/google/googletest#cmake).

**Bazel:** Use the `@com_google_googletest` external repository and declare dependencies properly. Run `bazel build` and verify your `BUILD` files include:

```bazel
cc_test(
    name = "my_test",
    srcs = [...],
    deps = ["@com_google_googletest//:gmock", "@com_google_googletest//:gtest"],
)
```

### 6. What common pitfalls cause linking errors or build failures?

- Missing virtual destructors in base classes being mocked â€” causes undefined behavior and possible leaks.
- Mock methods defined outside the `public:` section, making `EXPECT_CALL` or `ON_CALL` unable to access them.
- Incorrect or missing qualifiers such as `(override)` or `(const)` in `MOCK_METHOD` declarations, leading to unmatched method signatures.
- Ignoring required dependencies or incorrect order of linking.

### 7. How do I verify and clear mock expectations in tests?

If you want to programmatically verify that mock expectations are met before the mock object is destructed, use:

```cpp
Mock::VerifyAndClearExpectations(&mock_obj);
```

To both verify and clear expectations *and* default actions:

```cpp
Mock::VerifyAndClear(&mock_obj);
```

Be careful not to set new expectations after verification, as this leads to undefined behavior.

---

## Common Issues & Solutions

<AccordionGroup title="Build System Issues">
<Accordion title="Link errors when using GoogleMock or GoogleTest">
Ensure your linker command includes `-lgmock` and `-lgtest`. If using CMake:

```cmake
find_package(GTest REQUIRED)
target_link_libraries(my_test GTest::gmock GTest::gtest)
```

Verify the library search path is correctly configured.
</Accordion>
<Accordion title="Headers not found during compilation">
Add include directories for GoogleMock and GoogleTest:

```
-I/path/to/googlemock/include
-I/path/to/googletest/include
```

Or better, use CMake's imported targets or Bazel's dependencies.
</Accordion>
<Accordion title="Tests not discovered or not running">
Confirm you call `testing::InitGoogleMock` in `main()`, and `RUN_ALL_TESTS()` is used to execute tests.
</Accordion>
</AccordionGroup>

---

## Practical Tips and Best Practices

- Always define mock methods in the `public:` section.
- Use the `MOCK_METHOD` macro with proper qualifiers such as `(override)` and `(const)`.
- Use provided macros like `EXPECT_CALL` and `ON_CALL` before exercising the mock.
- Make sure to link against all gTest and gMock libraries required.
- Use provided imported targets in CMake and proper bazel deps for effortless integration.
- Use `Mock::AllowLeak()` if you deliberately want to ignore leak detection for heap-allocated mocks.
- Utilize GoogleMock's verbosity flags `--gmock_verbose=info|warning|error` to control logs for debugging build or runtime issues.

---

## Troubleshooting Steps

1. **Verify include paths:** Check the compiler output for missing header errors.
2. **Check linker flags:** Ensure linking includes gmock and gtest libs.
3. **Confirm ABI compatibility:** Use compilers and standards consistent with gtest/gmock.
4. **Run a minimal test:** Use the simple example test to isolate environment issues.
5. **Enable verbose output:** Run tests with `--gmock_verbose=info`.
6. **Inspect macro usage:** Confirm `MOCK_METHOD` macros are used correctly.
7. **Check test registration:** Ensure tests use proper `TEST` macros and `RUN_ALL_TESTS()`.

---

## Additional Resources

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) for detailed reference on mock method macros and expectations.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) as quick syntax reference.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) beginner's guide to GoogleMock.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes and techniques.
- [Strictness Modes](https://google.github.io/googletest/api/gmock_strictness_modes.html) to understand NiceMock, NaggyMock, and StrictMock behaviors.
- [Build Integration Guide](https://google.github.io/googletest/concepts/integration-patterns/build-integration.html) for CMake and Bazel setup.

---

For source examples and test verification, please refer to the implementation and tests in the googletest repository under `googlemock/test/` including `gmock-spec-builders_test.cc` and `gmock-nice-strict_test.cc`.

---

# Example: Minimal CMakeLists.txt for GoogleTest and GoogleMock

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject)

set(CMAKE_CXX_STANDARD 17)

# Locate GTest package
find_package(GTest REQUIRED)

add_executable(my_test test_main.cpp test_my_code.cpp)

target_link_libraries(my_test GTest::gtest GTest::gmock pthread)

enable_testing()
add_test(NAME MyTest COMMAND my_test)
```

---

# Example: Typical main() for running tests with GoogleMock

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  GMOCK_FLAG_SET(catch_leaked_mocks, true);
  GMOCK_FLAG_SET(verbose, testing::internal::kWarningVerbosity);
  return RUN_ALL_TESTS();
}
```

---

# Troubleshooting Common Build & Link Errors

<AccordionGroup title="Common Build and Link Problems">
<Accordion title="Undefined reference to mock methods or GoogleMock symbols">
- Cause: Missing linkage to gmock and gtest libraries.
- Solution: Ensure your linker inputs include `-lgmock -lgtest` and correct search paths.
</Accordion>
<Accordion title="Compiler errors regarding MOCK_METHOD usage">
- Cause: Incorrect macro usage or missing qualifiers.
- Solution: Use `MOCK_METHOD(ReturnType, MethodName, (Args...), (qualifiers));` with proper parameters and place them in `public:`.
</Accordion>
<Accordion title="Conflicts between GoogleMock and platform headers (e.g. Win32 API) causing macro redefinitions">
- Cause: Platform headers defining macros with names used by mock methods.
- Solution: Use `#undef` for conflicting macros, or choose distinct method names. GoogleMock test suite uses example of redefining macros (`#define Method MethodW`) and verifying compatibility.
</Accordion>
</AccordionGroup>

---

For more specific issues, refer to the GoogleMock [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) and [mock strictness modes](https://google.github.io/googletest/api/gmock_strictness_modes.html).

---

# Notes

- This page focuses specifically on troubleshooting build, linking, and configuration issues related to test discovery and execution with GoogleTest and GoogleMock.

- For detailed user guides on writing mocks, setting expectations, and advanced testing techniques, please consult the other sections in this documentation.

---

# Contact and Support

If you encounter issues beyond these instructions or unexpected behaviors in your build environment, consider:

- Consulting the [GoogleTest GitHub repository](https://github.com/google/googletest) for reporting issues.
- Engaging with the community through forums and mailing lists linked on the repo.
- Reviewing CI integration guides to confirm your environment compatibility.



---

