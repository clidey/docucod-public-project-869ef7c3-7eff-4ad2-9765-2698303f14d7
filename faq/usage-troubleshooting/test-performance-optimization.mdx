---
title: "Improving Test Performance"
description: "Tips and FAQs related to speeding up test execution, optimizing resource usage, and addressing slow or flaky tests. Covers practical adjustments for large or complex projects."
---

# Improving Test Performance

This page offers practical guidance and frequently asked questions to help you accelerate test execution, optimize resource consumption, and handle slow or flaky tests using GoogleTest. Whether you are working on a large codebase or complex test suites, these strategies will help you run your tests faster and more reliably.

---

## 1. Why Focus on Test Performance?

Fast, reliable tests are essential for continuous integration systems, developer productivity, and confident code changes. Slow or flaky tests introduce bottlenecks and disrupt workflows. This page helps you understand how to diagnose and improve test performance specifically within GoogleTest scenarios.

---

## 2. Common Causes of Slow Tests

- **Expensive Setup or Teardown**: Repeatedly initializing heavy resources inside each test can add delay.
- **Large Number of Tests**: Suites with thousands of tests run sequentially by default.
- **Global State Contention**: Shared resources or locks that cause serialization.
- **Inefficient Test Filtering**: Running many irrelevant tests unintentionally.
- **Flaky Tests and Retries**: Tests failing intermittently cause extra reruns.

---

## 3. Strategies to Speed Up Test Execution

### 3.1 Use Parallel Test Runs and Sharding

GoogleTest supports dividing tests into shards and running tests in parallel processes to reduce wall-clock time.

- Use the `--gtest_shard_count=N` and `--gtest_shard_index=M` flags to split tests into N shards, picking shard M to run in a specific process.
- Run multiple test executables concurrently, each responsible for one shard.

<Tip>
Parallel test execution dramatically reduces execution time for large test suites.
Make sure your tests do not share or conflict over global state.
</Tip>

### 3.2 Filter Tests to Only Run Relevant Ones

Use `--gtest_filter=PositivePatterns[-NegativePatterns]` to restrict test runs.

Example:
```bash
--gtest_filter=SomeSuite.*:OtherSuite.Test1
```
Only tests matching the filter run, saving time.

### 3.3 Optimize Fixtures and Shared Resources

- Use `SetUpTestSuite()` and `TearDownTestSuite()` static methods to allocate resources once per test suite rather than per test.
- Avoid expensive construction in the test fixture constructor or per-test `SetUp()` if possible.

### 3.4 Avoid Complex or Heavy Parameterizations

- Parameterized and typed tests can explode test count. If parameters are costly, consider reducing parameter space or using smarter generators.
- Combine parameters with `Combine()` judiciously.

### 3.5 Minimize Global Test Environment Setup Overhead

- Your custom global environments (via `AddGlobalTestEnvironment()`) should avoid heavyweight initialization or perform lazy setup.

---

## 4. Dealing with Flaky or Slow Tests

### 4.1 Identifying Flaky Tests

- Flaky tests fail intermittently without code changes.
- Use test rerun mechanisms in your CI system.
- Log detailed information using GoogleTest's `SCOPED_TRACE` and tracing capabilities.

### 4.2 Isolating Test Failures

- Run suspected flaky tests in isolation via `--gtest_filter`.
- Use `--gtest_repeat=<count>` to repeat tests and identify intermittent failures.

### 4.3 Best Practices for Flaky Test Prevention

- Avoid shared mutable state.
- Use mocks (GoogleMock) to isolate dependencies and control side effects.
- Use `StrictMock` and `NiceMock` appropriately to catch unexpected calls causing nondeterministic behavior.
- Use sequences and ordering (`Sequence`, `InSequence`) to enforce call ordering.

<Tip>
Failing or intermittent tests slow down the entire test process.
Make failure analysis and fixing flaky tests a priority.
</Tip>

---

## 5. Test Execution Configuration Flags Impacting Performance

GoogleTest's flags provide fine control over test execution and output.

| Flag                         | Purpose                                      | Performance Impact                  |
|------------------------------|----------------------------------------------|----------------------------------|
| `--gtest_repeat=N`           | Runs all tests N times.                       | Increases runtime linearly        |
| `--gtest_shuffle`            | Randomizes test order.                        | Minor overhead; can expose order-dependent tests|
| `--gtest_break_on_failure`   | Breaks on first failure.                      | Can reduce runtime if failures happen early|
| `--gtest_filter=...`         | Runs only matching tests.                     | Reduces test time                  |
| `--gtest_shard_count=N`      | Splits tests across multiple shards.         | Enables parallel execution         |
| `--gtest_death_test_style=fast|threadsafe` | Impacts how death tests run.           | Use `fast` for speed if safe      |

Review and tune these flags to balance diagnostics and speed.

---

## 6. Tips for Large and Complex Projects

- **Modularize Tests**: Separate tests into focused suites to aid filtering and sharding.
- **Profile Tests**: Use timing outputs (`--gtest_print_time`) to identify slow tests or suites.
- **Use Parameterization Wisely**: Avoid combinatorial explosion by limiting parameters or generating intelligently.
- **Leverage Mocks Effectively**: Mocks can help avoid costly dependencies like databases or network calls.
- **Continuous Integration Integration**: Incorporate test flakiness detection and parallel execution in CI workflows.

---

## 7. FAQs

### How do I run tests in parallel?
Use `--gtest_shard_count` and `--gtest_shard_index` to split your test binary into multiple shards and run copies concurrently.

### Why are my tests running slower after adding many parameterized tests?
Each parameter set generates a separate test. Reduce parameter count or optimize fixture setup.

### How do I identify flaky tests?
Use test repeats (`--gtest_repeat=<N>`) and isolate failing tests with `--gtest_filter` to check for inconsistent failures.

### Can GoogleTest run tests in multiple threads?
GoogleTest runs tests sequentially by default. Use external test runners or shard to run multiple instances in parallel.

### What is the recommended way to share setup between multiple tests to improve performance?
Use `SetUpTestSuite()` and `TearDownTestSuite()` static methods to perform expensive setup/teardown once per test suite.

### How can I reduce overhead caused by expensive global environment setup?
Lazy initialize resources in global environments or move initialization into specific test suites.

---

## 8. Troubleshooting Common Performance Problems

<AccordionGroup title="Common Performance Issues and Solutions">
<Accordion title="Tests run too slowly despite parallelization">
- Verify tests are independent and free from global state contention.
- Confirm shards cover distinct subsets of tests.
- Avoid serial bottlenecks such as logging to the same file.
</Accordion>
<Accordion title="Flaky tests causing repeated runs">
- Use `SCOPED_TRACE` to add context to failures.
- Review mocks and dependencies for nondeterministic behavior.
- Capture logs on failure to isolate intermittent issues.
</Accordion>
<Accordion title="Test filtering not working as expected">
- Check filter syntax and patterns in `--gtest_filter`.
- Ensure test names and suite names are correct.
- Use `--gtest_list_tests` to verify available tests.
</Accordion>
<Accordion title="High memory or resource usage during tests">
- Reuse fixtures to reduce allocations.
- Mock out expensive dependencies.
- Avoid heavy static or global data.
</Accordion>
</AccordionGroup>

---

## 9. Useful References

- [Running Tests and Test Configuration](https://github.com/google/googletest/blob/main/docs/getting-started/project-setup/configuration-options.md)
- [Performance and Scalability Strategies Guide](https://github.com/google/googletest/blob/main/docs/guides/real-world-examples/performance-strategies.md)
- [Test Declaration and Execution](https://github.com/google/googletest/blob/main/docs/api-reference/gtest-core-apis/test-declaration-execution.md)
- [Parameterized and Typed Tests](https://github.com/google/googletest/blob/main/docs/api-reference/gtest-core-apis/parameterized-and-typed-tests.md)
- [Mock Object Usage](https://github.com/google/googletest/blob/main/docs/api-reference/gmock-mocking-apis/mock-object-definition.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)

---

## 10. Next Steps

- Begin by profiling your test suite to identify hotspots.
- Apply filtering and sharding to scale test execution.
- Refactor expensive or flaky tests with better fixtures and mocks.
- Integrate parallel test execution in your CI/CD pipelines.
- Consult the Performance and Scalability Strategies guide for detailed workflows.

---

<Check>
Optimizing test performance unlocks faster feedback cycles and boosts confidence.
Use the recommended GoogleTest flags and design patterns here for maximum impact.
</Check>

---

### Example: Running Tests with Sharding

```bash
# Split your tests into 4 shards and run the 2nd one (index 1)
./my_tests --gtest_shard_count=4 --gtest_shard_index=1
```

---

#### Explore More:
- How to write efficient `SetUpTestSuite()` for shared heavy resources
- Using `SCOPED_TRACE` to annotate slow or flaky tests
- Balancing test coverage and parameter combinations


