---
title: "Build, Linker, and Integration Troubleshooting"
description: "Solutions for resolving build failures, missing symbol errors, and linker issues encountered when GoogleTest or GoogleMock is combined with various build systems and platforms."
---

# Build, Linker, and Integration Troubleshooting

This page provides practical solutions for resolving build failures, missing symbol errors, and linker issues that arise when integrating GoogleTest and GoogleMock into various build systems and platforms. Use this guide to diagnose common pain points during build and linking phases and ensure smooth integration of the testing framework.

---

## 1. Common Build Failures

### Why am I getting unresolved symbol errors when linking my tests?

Unresolved symbol errors typically arise when the GoogleTest or GoogleMock libraries are not properly linked into your test binaries. This can happen due to:

- Missing linkage to the GoogleTest and GoogleMock static or shared libraries.
- Mixing incompatible runtime libraries or compiler settings between your code and GoogleTest.
- Not including the required source files or targets in your build system.

**How to fix:**

- Ensure you link your test executable with the correct GoogleTest and GoogleMock libraries.
  - With **CMake**, link your target using `target_link_libraries(your_test gtest gmock)` or their imported targets.
  - With **Bazel**, depend on `@com_google_googletest//:gmock_main` or `:gtest_main` appropriately.
- Verify that the compiler and runtime flags (e.g., C++ standard version, STL type, runtime library) between your project and GoogleTest are consistent.
- If you include GoogleTest sources directly, ensure the `.cc` files are compiled and linked.


### I see errors related to missing `main()` function when running tests

GoogleTest provides its own main function when you link against `gtest_main` or `gmock_main`. If you link only against `gtest` or `gmock` without the `_main` libraries, you must provide your own `main()` implementation.

**Solution:**

- Link with `gtest_main` or `gmock_main` libraries instead of just `gtest` or `gmock`. These provide a default main.
- Alternatively, write your own main function that calls `testing::InitGoogleTest()` and runs `RUN_ALL_TESTS()`.


### How do I handle compiler warnings or errors around MOCK_METHOD or mocking features?

- Make sure you are using a compiler that supports C++17 or later; GoogleTest requires this.
- If you encounter parsing errors related to commas in template parameters with `MOCK_METHOD`, wrap the return or argument types in extra parentheses or use type aliases as detailed in the [gMock Cookbook](gmock_cook_book.md#dealing-with-unprotected-commas).
- For MSVC users, be aware of specific warnings like C4301 or C4373 related to const parameters — removing top-level const qualifiers fixes these issues.


## 2. Linking GoogleMock and GoogleTest in Your Build

### Best Practices for CMake

- Use the official GoogleTest CMake targets after inclusion. For example:

  ```cmake
  find_package(GTest REQUIRED)

  add_executable(my_tests test_file.cc)
  target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock GTest::gtest_main)
  ```

- Confirm that your `CMAKE_CXX_STANDARD` is set to 17 or above.
- If building GoogleTest from source, add it as a subdirectory and link targets accordingly.


### Best Practices for Bazel

- Add the GoogleTest workspace to your `WORKSPACE` file.
- Use `deps = ["@com_google_googletest//:gmock_main"]` in your test rule.
- Reference the documentation on [Installing with Bazel](getting-started/set-up-prerequisites-installation/installation-bazel.mdx) for examples.


### Manual or other Build Systems

- Link with the static or shared libraries for GoogleTest and GoogleMock.
- Include the GoogleTest and GoogleMock headers correctly.
- Ensure correct compile and link flags, including threading and exception handling support.


## 3. Common Linker Errors and Their Solutions

### Missing definitions for mock functions

If you get linker errors about undefined references to mock functions:

- Check that you have included and compiled the mocks where `MOCK_METHOD` macros are used.
- Make sure your mock class implementations are linked into the test binary.

### Undefined references to GoogleMock internal symbols

- Missing linkage of GoogleMock library.
- Incorrect order of libraries on command line can cause unresolved symbols.
- Library order matters — ensure `-lgmock` appears before `-lgmock_main`.


### Conflicting symbols or multiple definitions

- This typically results from mixing static and shared library versions accidentally.
- Avoid linking GoogleTest and GoogleMock multiple times.
- On Windows, linking the same import library from different runtimes causes conflicts.


## 4. Integration Troubleshooting Examples

### Case: Test compiles but fails linker with unresolved gMock symbols

**Check:**
- Linked libraries: Should include `gmock` or `gmock_main`.
- Build settings: Ensure consistent runtime and compiler standards.

### Case: Unexpected calls are reported in test logs

- Occurs when methods are called without matching `EXPECT_CALL` or `ON_CALL` setups.
- Use `ON_CALL` to define default behavior for methods expected to be called without strict checking.
- Use `EXPECT_CALL` only on methods you want to verify are called.
- Increase verbosity (`--gmock_verbose=info`) to diagnose call matching and trace.


### Case: Warnings about leaked mocks on program exit

- Happens when mock objects are allocated on the heap and not deleted.
- Use `Mock::AllowLeak(mock_ptr)` to suppress the warning if intended.
- Best practice: Delete or manage lifetime of mock objects properly.


## 5. Diagnostic Tips and Best Practices

- Always compile GoogleTest and GoogleMock with the same compiler and standard as your code.
- Use `--gmock_verbose=info` command-line to trace mock behavior and call matching.
- Confirm all mocks have virtual destructors to avoid memory leaks.
- Retire expectations (`.RetiresOnSaturation()`) when tests expect sequential calls to prevent sticky expectations failures.
- When mocking overloaded or templated methods, use explicit type aliases or wrappers to avoid macro parsing issues.
- Check that your build system includes and compiles all necessary source files.


## 6. References and Further Reading

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — detailed recipes on mocks, matchers, actions
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — API details for mocks and expectations
- [Integration with Build Systems](https://google.github.io/googletest/guides/integration-build-systems.html) — instructions for CMake, Bazel, others
- [Troubleshooting Common Setup Errors](https://google.github.io/googletest/getting-started/troubleshooting-common-issues/troubleshooting-setup-errors.html) — installation and build troubleshooting


---

## Summary

This page equips you with the knowledge to resolve build and linker issues when using GoogleTest and GoogleMock. From resolving missing symbols to managing expectations and linking libraries properly, the guide aims to help developers integrate these testing frameworks smoothly into their projects.

---

<Tip>
Consistent build environments and correct library linkage are key to avoiding linker and integration issues. Always verify your build configuration matches GoogleTest’s required C++17 standard and platform toolchain.
</Tip>

<Check>
Run your test binary with `--gmock_verbose=info` to get detailed mock call diagnostics and trace unexpected or uninteresting call issues.
</Check>

<Note>
If you intentionally leak mocks (e.g., in asynchronous or shared ownership scenarios), use `Mock::AllowLeak()` to suppress false leak warnings safely.
</Note>