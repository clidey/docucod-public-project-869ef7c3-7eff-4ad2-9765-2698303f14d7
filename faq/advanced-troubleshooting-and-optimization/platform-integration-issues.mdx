---
title: "Platform & Build Integration Issues"
description: "Focuses on resolving build problems (e.g., CMake/Bazel issues), cross-platform quirks, and compatibility with compilers or embedded environments. Provides solutions for the most reported configuration or portability challenges."
---

# Platform & Build Integration Issues

GoogleTest and GoogleMock support a broad range of platforms and build systems, but certain build problems and cross-platform compatibility challenges can arise. This page addresses the most frequently reported issues related to build configuration, compiler requirements, embedded environment quirks, and platform-specific nuances. It provides practical guidance and solutions to help you seamlessly integrate GoogleTest and GoogleMock into your build and runtime environments.

---

## 1. Common Build Configuration Problems

### CMake Integration

GoogleTest and GoogleMock provide first-class support for CMake. However, improper CMake usage can lead to build failures or linkage errors.

#### Typical Issues:
- Missing inclusion of GoogleMock or GoogleTest source导致 incomplete symbols.
- Runtime library conflicts, especially on Windows (static vs dynamic CRT mismatch).
- Incorrect C++ standard version causing build errors.

#### Solutions:
- **Standalone build:** Use the `googletest` repository's root CMakeLists.txt to build. Example workflow:
  ```bash
  git clone https://github.com/google/googletest.git -b v1.17.0
  cd googletest
  mkdir build && cd build
  cmake ..
  make
  sudo make install
  ```
- **Disable GoogleMock if not needed:**
  ```bash
  cmake .. -DBUILD_GMOCK=OFF
  ```
- **Incorporate GoogleTest into an existing project:** Use FetchContent or `add_subdirectory()` in your CMake Projects to build GoogleTest alongside your code. Example snippet:
  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
  )
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  FetchContent_MakeAvailable(googletest)

  add_executable(example example.cpp)
  target_link_libraries(example gtest_main)
  add_test(NAME example_test COMMAND example)
  ```
- **Specify C++17 standard explicitly in your CMakeLists.txt:**
  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```
- **On Windows, handle Visual Studio runtime compatibility:**
  - GoogleTest defaults to static CRT linkage.
  - Use the CMake option `gtest_force_shared_crt` to align CRT linkage with your project.

---

### Bazel Integration Issues

- Ensure correct WORKSPACE and BUILD file definitions with proper dependencies.
- Use GoogleTest and GoogleMock targets correctly.
- Keep your Bazel versions compatible with the GoogleTest release.

See: [Quickstart with Bazel](./googletest-guides/getting-started/quickstart-bazel) for detailed setup.

---

### Compiler Requirements

GoogleTest requires a compiler that supports C++17. Most modern compilers like GCC, Clang, and MSVC (Visual Studio 2017 or later) are supported.

- Visual Studio minimum version: 2015 for GoogleMock compilation.
- Linux/macOS: GCC 7+ or Clang 5+ recommended.
- Ensure your compiler’s C++17 standard is enabled.

If you encounter compile errors:
- Check compiler version.
- Confirm the C++ language standard setting in your build.

---

## 2. Cross-Platform Compatibility and Quirks

GoogleTest strives for cross-platform compatibility. However, platform-specific constraints must be taken into account.

### Supported Platforms

Refer to the official [Supported Platforms](docs/platforms.md) page which aligns with Google's foundational C++ support policy. It includes compiler versions, OS support (Linux, Windows, Mac, embedded systems), and build tool compatibility.

### Embedded and Limited Environments

- Special handling is required for embedded platforms (e.g., ESP32, ESP8266, NRF52).
- Initialization and entry points may differ: Google Mock’s `gmock_main.cc` includes specific setup for embedded cases, using functions like `setup()` and `loop()` instead of `main()`.

### Common Embedded Considerations

- GoogleTest detection of pthread availability is automatic but can be manually forced via:
  ```bash
  -DGTEST_HAS_PTHREAD=1
  ```
  or 
  ```bash
  -DGTEST_HAS_PTHREAD=0
  ```
- Some embedded platforms lack a full filesystem, impacting features like death tests and stream redirection. GoogleTest macros like `GTEST_HAS_FILE_SYSTEM` and `GTEST_HAS_STREAM_REDIRECTION` indicate this automatically.

---

## 3. Linking and Runtime Errors

Users often face errors such as symbol not found, mismatched runtime libraries, or incorrect linking order.

### Causes:
- Mixing static and dynamic runtime libraries/comms.
- Forgetting to link with `pthread` on *nix systems.
- Not linking GoogleTest or GoogleMock libraries explicitly.

### Best Practices:
- Use the provided CMake build targets (`gtest`, `gtest_main`, `gmock`, `gmock_main`).
- If building your own main function, call `testing::InitGoogleTest()` before `RUN_ALL_TESTS()`.

Example custom main:
```c++
#include <gtest/gtest.h>
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```
- When linking, ensure ordering includes GoogleTest first, then your test binaries.
- On Windows, be mindful of `/MT` vs `/MD` flags and use `gtest_force_shared_crt` option.

---

## 4. Multi-threading and Synchronization Issues

- GoogleTest supports multi-threaded tests where pthreads or native OS APIs are available.
- You can check thread safety by verifying the macro `GTEST_IS_THREADSAFE` is defined as 1.
- If running on platforms missing pthread, GoogleTest runs without thread safety, so avoid concurrent assertions.
- Enable threading explicitly via compiler flags if needed.

---

## 5. Troubleshooting Steps and Tips

### When Build Fails:
- **Check compiler version and C++ standard compatibility**.
- **Verify CMake options**: `BUILD_GMOCK`, `gtest_force_shared_crt`, `gtest_disable_pthreads`.
- **On embedded platforms**, confirm platform macros and entry points.
- **Run clean builds** to avoid stale artifacts (e.g., `rm -rf build`).

### Link errors:
- Ensure you link against `gtest`, `gtest_main`, `gmock`, or `gmock_main` as appropriate.
- Add `Threads::Threads` library on Linux/macOS when pthreads are used.

### Initialization Errors:
- Always call `InitGoogleTest()` or `InitGoogleMock()` before running tests.
- Avoid calling `RUN_ALL_TESTS()` more than once per run.

---

## 6. Additional Resources & References

- Detailed instructions for building with CMake: [Quickstart with CMake](./googletest-guides/getting-started/quickstart-cmake)
- Embedded environment specifics: Refer to source `gmock_main.cc` highlighting embedded platform entry points.
- Supported platforms and compilers: [Supported Platforms](docs/platforms.md)
- Build system tweaks: see `cmake/internal_utils.cmake` for advanced CMake macro customizations
- FAQ on platform & build issues: [FAQ and Common Issues](./googletest-guides/integration-and-troubleshooting/faq-and-common-issues)

---

## 7. Summary of Best Practices

- Use the provided `gtest_main` or `gmock_main` libraries to avoid writing custom `main` unless strictly necessary.
- When managing CMake builds, explicitly specify the C++17 standard.
- Use `gtest_force_shared_crt` on Windows to match your project's runtime linkage.
- On platforms with no pthread, disable threading support explicitly.
- Leverage the `ENABLE_TESTING()` and `add_test()` in CMake to integrate with testing frameworks and CI flows.

<Tip>
Maintaining build and platform compatibility requires careful control of compiler settings, runtime linkage, and initialization code. Always start from working examples and adjust incrementally.
</Tip>

<Warning>
Using GoogleTest and GoogleMock on unsupported or niche embedded platforms may require creating or customizing platform-specific build tools and initialization code.
</Warning>

---

For detailed examples, troubleshooting, and build scripts, visit the [GoogleTest GitHub repository](https://github.com/google/googletest) and consult the relevant guide pages listed above.
