---
title: "How do I run tests in parallel or select specific tests?"
description: "Explains how to configure GoogleTest and GoogleMock for parallel test execution, selective test filtering, and leveraging external test runners for even greater performance and CI integration."
---

# How do I run tests in parallel or select specific tests?

GoogleTest provides powerful features that enable you to **increase test execution efficiency** through parallelism and selective test running. Whether you want to run only a subset of your tests or leverage multiple cores and machines for speed, this guide will walk you through configuring GoogleTest and GoogleMock for **parallel test execution, selective test filtering, and integration with external test runners**.

---

## Selective Test Execution: Filter Which Tests to Run

GoogleTest offers flexible ways to select tests to run based on test suite and test names. This empowers you to focus on relevant tests during development, debugging, or CI workflows.

### Using the `--gtest_filter` Flag

- The `--gtest_filter` flag lets you specify patterns to include or exclude tests.
- The syntax is: `--gtest_filter=PositivePatterns[-NegativePatterns]`
- Patterns use wildcards:
  - `*` matches any number of characters
  - `?` matches any single character
  - `:` separates multiple patterns

#### Examples:

```shell
// Run all tests
./my_test

// Run all tests in FooTest test suite
./my_test --gtest_filter=FooTest.*

// Run tests that contain 'Null' or 'Constructor' in their name
./my_test --gtest_filter=*Null*:*Constructor*

// Run all tests except those in DeathTest suites
./my_test --gtest_filter=-*DeathTest.*

// Run FooTest tests except FooTest.Bar
./my_test --gtest_filter=FooTest.*-FooTest.Bar
```

> **Tip:** Disabled tests can be included with the `--gtest_also_run_disabled_tests` flag.

### Environment Variable Equivalent

You can also use `GTEST_FILTER` environment variable to achieve the same filtering effect.

### Important Details About Test Names

- Test full names have the form `TestSuiteName.TestName`.
- Avoid underscores (`_`) in test or test suite names to prevent conflicts or ambiguous test class name generation.
- For more info, see [Why should test suite names and test names not contain underscore?](https://github.com/google/googletest/blob/main/docs/faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore).

---

## Running Tests in Parallel for Faster Execution

When your test suite grows large, running tests sequentially can become prohibitively slow. GoogleTest supports parallel execution strategies that can dramatically speed up your CI or local runs.

### 1. Test Sharding: Distribute Tests Across Multiple Processes or Machines

GoogleTest supports *test sharding*, which divides tests across shards, each running independently and responsible for a subset of all tests.

#### How to Enable Sharding

You configure sharding through environment variables that your test runner sets:

| Environment Variable  | Description                                         |
|----------------------|-----------------------------------------------------|
| `GTEST_TOTAL_SHARDS`   | Total number of shards (machines/processes)         |
| `GTEST_SHARD_INDEX`    | Index of the shard to run on (0-based)               |

#### Example

If you want to run tests on 3 machines:

- Machine 0: `export GTEST_TOTAL_SHARDS=3`
- Machine 0: `export GTEST_SHARD_INDEX=0`

- Machine 1: `export GTEST_TOTAL_SHARDS=3`
- Machine 1: `export GTEST_SHARD_INDEX=1`

- Machine 2: `export GTEST_TOTAL_SHARDS=3`
- Machine 2: `export GTEST_SHARD_INDEX=2`

Then run the *same* test binary on all machines. GoogleTest ensures each test is run exactly once across all shards.

> **Important:** Your test runner or CI system is responsible for setting these variables and distributing the workload.

#### How Sharding Works Internally

- GoogleTest hashes each test and assigns it to a shard based on modulo arithmetic.
- Tests not assigned to a particular shard are skipped.

### 2. Running Tests Concurrently Within One Process

GoogleTest itself does not natively provide built-in multithreaded test execution inside a single test program.

- You can run multiple test binaries concurrently in separate processes.
- Use test sharding to split a large test suite across multiple processes.
- Coordination among concurrent runs is typically managed by the external test runner/environment.

### 3. Leveraging External Test Runners for Parallelism

For even greater performance, especially in large-scale projects and CI environments, consider integrating GoogleTest with external test runners:

- **Bazel:** Provides native support for parallel test execution and test sharding.
- **CMake + CTest:** Allows specifying test properties and running tests in parallel using `ctest --parallel`.
- **GNU Make Ninja:** Run multiple `ctest` invocations concurrently.

#### Benefits

- Automate test parallelism.
- Improved resource utilization.
- Better integration with build and CI pipelines.

### 4. Using the `--gtest_repeat` and `--gtest_shuffle` Flags

- `--gtest_repeat=N`: Repeat tests N times to catch flaky tests. You can combine with parallel execution.
- `--gtest_shuffle`: Randomize test order on each run to detect order dependencies.

---

## Selective Execution Based on Test Categories

You can selectively disable or enable tests:

- Prefix test or test suite names with `DISABLED_` to skip them.
- Run disabled tests with `--gtest_also_run_disabled_tests`.

This approach, combined with filtering, can create focused test runs with specific granularity.

---

## Practical Tips and Best Practices

- Always **call `testing::InitGoogleTest(&argc, argv);` before `RUN_ALL_TESTS()`** in your `main()` to enable flag parsing and filtering.

- Do **not** ignore the return value of `RUN_ALL_TESTS()`; your test program should return it as `main`'s return code.

- Avoid underscores in test and test suite names to prevent subtle name clashes.

- Use test sharding for large projects where test execution time is critical.

- Use test filtering to target debugging sessions to specific test cases or features.

- Combine `--gtest_filter` with `--gtest_repeat` and `--gtest_shuffle` to detect flaky tests and improve reliability.

- In death test suites (usually suffixed with `DeathTest`), run tests first as recommended for better thread safety.

- If using value-parameterized or typed tests, ensure tests are instantiated properly to avoid test discovery issues.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Issues When Running Tests in Parallel or Filtering">
<Accordion title="Tests Not Running Despite Being Defined">
Make sure:
- You are not mixing `TEST()` and `TEST_F()` in the same test suite.
- Tests are instantiated properly for parameterized tests (`TEST_P`, `INSTANTIATE_TEST_SUITE_P`).
- The filter expression (`--gtest_filter`) matches the test names exactly and is syntactically valid.
- Sharding environment variables are set correctly.
- Disabled tests (`DISABLED_` prefix) won't run unless explicitly requested.
</Accordion>
<Accordion title="Undesired Tests Being Skipped or Filtered Out">
Check:
- Your filter patterns.
- Whether the test suite or test is disabled.
- Test sharding environment variables. Tests assigned to other shards will be skipped.
</Accordion>
<Accordion title="Parallel Test Runs Causing Resource Conflicts or Flaky Tests">
- Ensure tests do not share mutable global state without proper synchronization.
- Avoid side effects that may interfere between parallel test executions.
- Use per-test-suite setup and teardown to manage shared resources safely.
</Accordion>
</AccordionGroup>

---

## Example: Running a Subset of Parameterized Tests in Parallel Shards

Consider a value-parameterized test instantiated with multiple parameter values:

```cpp
class MyParamTest : public ::testing::TestWithParam<int> {
 // ...
};

TEST_P(MyParamTest, RunsTest) {
  int param = GetParam();
  // ... perform test ...
}

INSTANTIATE_TEST_SUITE_P(MyParams, MyParamTest, testing::Values(1, 2, 3, 4));
```

If you have 2 machines:

- Machine 0:
  ```bash
  export GTEST_TOTAL_SHARDS=2
  export GTEST_SHARD_INDEX=0
  ./my_test
  ```

- Machine 1:
  ```bash
  export GTEST_TOTAL_SHARDS=2
  export GTEST_SHARD_INDEX=1
  ./my_test
  ```

Each machine runs roughly half the tests based on the sharding logic.

You can also combine with filters:

```bash
./my_test --gtest_filter=MyParamTest.RunsTest/0
```

---

## Related Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md): Get started with test creation.
- [Advanced GoogleTest Topics](https://github.com/google/googletest/blob/main/docs/advanced.md): Learn about death tests, fixtures, and environment setups.
- [Parameterized and Typed Tests](https://github.com/google/googletest/blob/main/docs/concepts/advanced-concepts/parameterized-and-typed-tests.md): Details on defining and instantiating parameterized tests.
- [Running a Subset of Tests](https://github.com/google/googletest/blob/main/docs/advanced.md#running-a-subset-of-the-tests): Filtering and selecting tests.
- [Integration & Build Systems](https://github.com/google/googletest/blob/main/guides/beyond-basics/integration-build-systems.mdx): Using GoogleTest in CMake/Bazel with CI integration.

---

## Summary

Running your tests selectively and in parallel with GoogleTest dramatically improves your efficiency and feedback loop. By mastering test filtering, sharding, and integration with external runners, you ensure faster test execution while maintaining precise control over which tests run when and where.

Start with simple filters, adopt sharding as your suite scales, and leverage your CI system or build environment's capabilities to orchestrate parallel test execution effectively.

For maximum benefit, always combine these techniques with proper test isolation, minimal test dependencies, and clear test organization.

---

## Sample Command Line invocations

```bash
// Run all tests
./my_test

// Run tests in FooTest except Bar
./my_test --gtest_filter=FooTest.*-FooTest.Bar

// Run all tests that have "Edge" in their name
./my_test --gtest_filter=*Edge*

// Run tests in shard 0 of 4. Environment variables set by your test runner.
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0
./my_test

// Run disabled tests too
./my_test --gtest_also_run_disabled_tests

// Repeat tests 10 times, shuffling between runs
./my_test --gtest_repeat=10 --gtest_shuffle
```
