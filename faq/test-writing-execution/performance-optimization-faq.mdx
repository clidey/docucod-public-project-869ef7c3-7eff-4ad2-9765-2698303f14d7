---
title: "How can I optimize test performance?"
description: "Shares best practices and actionable tips for reducing test execution time, running tests in parallel, minimizing flakiness, and scaling test suites efficiently. Surfaces relevant tools and configuration tweaks."
---

# How can I optimize test performance?

GoogleTest offers a robust C++ testing framework supporting scalability, reliability, and speed. This page serves as your go-to resource for best practices and actionable tips on optimizing test performance — from reducing test execution time and running tests in parallel to minimizing flakiness and scaling test suites effectively. You'll also find recommendations on tools and configuration tweaks designed to help you maintain fast, efficient, and reliable testing workflows.

---

## 1. Reducing Test Execution Time

Efficient testing starts with minimizing the runtime of your tests without sacrificing coverage or accuracy. Consider the following:

- **Focus on Test Granularity:**
  Write small, focused tests. Smaller tests typically run faster and isolate failures more clearly.

- **Reuse Resources With Fixtures:**
  Use test fixtures (`TEST_F`) and leverage `SetUpTestSuite()` and `TearDownTestSuite()` for expensive resource initialization and teardown shared across multiple tests. This prevents redundant initialization and dramatically reduces total execution time.

- **Avoid Expensive Operations in Each Test:**
  Beware of costly operations repeated in every test (e.g., filesystem or network access). Instead, mock or stub such dependencies where feasible.

- **Optimize Assertion Use:**
  Prefer `EXPECT_` over `ASSERT_` when possible to continue running tests and gather more information per run. However, balance this with test failure isolation to avoid cascading errors.

- **Keep Tests Independent:**
  Ensure tests do not depend on each other's side-effects to enable parallel and partial execution.

<Tip>
If your tests are IO-heavy or involve network/disk operations, invest time in mocking those dependencies with gMock to measurably speed up execution.
</Tip>

---

## 2. Running Tests in Parallel

Parallel test execution is a powerful approach to significantly reduce total runtime. GoogleTest supports parallelization through test sharding and integration with external test runners.

### Key Strategies:

- **Test Sharding**: Split your overall test suite across multiple parallel shards (processes or machines). GoogleTest honors environment variables `GTEST_TOTAL_SHARDS` (total shards) and `GTEST_SHARD_INDEX` (zero-based shard index) to select a subset of tests to run per shard, ensuring tests are neither duplicated nor omitted.

- **External Parallel Test Runners**: Use your build system or CI tools that manage parallel execution by spawning multiple instances of the test binary with separate shard indices or filtering.

- **Proper Test Partitioning**: Organize your tests into suites and test cases that allow sharding without dependence or interference.

- **Avoid Shared Global State**: Parallel tests must not share or mutate global/static state without appropriate synchronization.

---

## 3. Minimizing Test Flakiness

Flaky tests—those unpredictable and inconsistent in results—cause delays and mistrust in automated testing. To reduce flakiness:

- **Avoid Non-determinism**: Remove or mock randomness, timing dependencies, and external dependencies (e.g., clocks, environment, network).

- **Use Proper Synchronization**: For tests involving concurrency or threads, ensure synchronization primitives are correctly used to avoid race conditions.

- **Leverage `ASSERT_DEATH` and `EXPECT_DEATH` Safely**: Death tests can introduce complexity and flakiness if not isolated properly. Run them in dedicated test suites named with the `*DeathTest` suffix to guarantee appropriate ordering and isolation.

- **Repeat Suspicious Tests**: Use `--gtest_repeat=N` (or environment variable `GTEST_REPEAT`) to run flaky tests multiple times in a row to verify stability.

<Tip>
Use GoogleTest's `SCOPED_TRACE` to add contextual information in flaky tests for improved debugging when issues arise.
</Tip>

---

## 4. Scaling Large Test Suites

As your project grows, your test suite may become large and unwieldy. Follow these best practices:

- **Hierarchical Organization**: Group tests logically into test suites and fixtures reflecting software modules.

- **Parameterized Tests**: Use value-parameterized or typed tests to cover multiple inputs and types efficiently without code duplication.

- **Configure Sharding Strategically**: Larger suites benefit more from sharding; choose shard counts based on test duration and infrastructure.

- **Selective Test Execution**: Use `--gtest_filter` to run focused subsets during development for faster feedback.

- **Leverage `RetiresOnSaturation()`**: For expectations on mocks that should retire once invoked N times, preventing confusing or costly re-matching overhead.

- **Use `InSequence` and Partial Ordering**: Control call order expectations carefully to prevent fragile test ordering.

- **Monitor Test Duration and Optimize Glitches**: Identify slow or flaky tests by reviewing XML reports (`--gtest_output=xml:<file>`) and optimize or quarantine them.

- **Use Build Integration**: Tie GoogleTest with your build system (CMake or Bazel) to run tests efficiently and maintain reproducibility.

---

## 5. Useful Configuration Tweaks & Tools

Several GoogleTest flags and environmental variables can be tuned for performance and stability:

| Flag / Variable                  | Description                                        |
|--------------------------------|---------------------------------------------------|
| `--gtest_repeat=N`             | Repeat all tests N times to catch flakes           |
| `--gtest_shuffle`              | Randomize the order of test execution               |
| `--gtest_color`                | Enable colored output on supported terminals        |
| `GTEST_TOTAL_SHARDS`           | Total number of shards for sharded execution        |
| `GTEST_SHARD_INDEX`            | Index of the current shard (0-based)                 |
| `--gtest_break_on_failure`     | Break into debugger on first failure (useful when repeated runs fail) |
| `--gtest_also_run_disabled_tests` | Enable running disabled tests                       |

Additionally, integrate GoogleTest reports with your CI’s XML or JSON listeners for detailed performance metrics and flaky test identification.

---

## 6. Troubleshooting Common Performance Issues

### Slow Setup or TearDown

If your tests run slowly, check if expensive setup or teardown happens for each test unnecessarily.

* Use `SetUpTestSuite`/`TearDownTestSuite` for once-per-suite initialization of shared resources.
* Avoid allocating large objects or external connections in each test.

### Excessive Test Flakiness

* Use `--gtest_repeat=N` to identify flakiness.
* Add tracing with `SCOPED_TRACE` to find flaky roots.
* Ensure thread safety by avoiding data races in tested code and mocks.

### Parallel Runs Failing Consistently

* Confirm no shared mutable state without proper synchronization or resource locking.
* Verify each test is independent and cleans up fully.

---

## 7. Practical Tips & Best Practices

- **Name Sharded Tests Clearly**: Separate death tests and unstable tests into specific suites named appropriately (e.g., `FooDeathTest`).

- **Apply `RetiresOnSaturation`** to expectations in mocks when calls should not persist beyond their limit.

- **Avoid Overly Strict Expectations** to reduce test brittleness.

- **Keep Tests Deterministic**: Favor explicit input data and mocks over environment-based or timing-sensitive tests.

- **Use `NiceMock` and `StrictMock` Appropriately** to control the verbosity and strictness of mock warnings, aiding cleaner tests.

- **Monitor Test Runtime Trends** to detect regressions in test speed or reliability early.

---

## 8. Additional Resources

- **GoogleTest Primer** – Start with the fundamentals to get a solid understanding of writing tests.
- **Guides/Real-World Integration/Scaling and Optimizing Large Test Suites** – Deeper tips on managing big projects.
- **GoogleMock Cookbook** – For mocking best practices, controlling mock behaviors, and improving test quality.
- **Testing Reference** – Official API reference for assertions, parameterization, and related features.
- **FAQ Sections** – Covering installation, writing tests, performance optimization.

Explore these to gain progressive mastery over test optimization and efficient mocking.

---

## Related Documentation

- [GoogleTest Primer](primer.md): Foundations of test writing and execution.
- [Scaling and Optimizing Large Test Suites](guides/real-world-integration/large-project-tips.md): Managing tests at scale.
- [Mocking Cookbook](gmock_cook_book.md): Advanced mocking patterns and tips.
- [Troubleshooting common build and runtime errors](faq/test-writing-execution/troubleshooting-common-errors.md): For fixing errors that may affect test performance.
- [Core Architecture Overview](overview/introduction-and-architecture/core-architecture-overview.md): To understand the internal test execution flow.

Use `--help` flag and environment variables to view and customize GoogleTest behavior in your environment.

---

## Summary

Optimizing test performance in GoogleTest involves a blend of writing focused, efficient tests, leveraging fixtures for resource reuse, running tests in parallel, minimizing flaky behaviors, and scaling suites smartly. Embrace tooling and configuration options provided by GoogleTest and GoogleMock to achieve fast, reliable, and maintainable CI pipelines. Follow best practices to build confidence in your test suites and accelerate your development workflow.

---