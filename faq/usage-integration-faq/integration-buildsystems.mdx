---
title: "How Can I Integrate GoogleTest with My Build System?"
description: "Solution-oriented FAQ for integrating with CMake, Bazel, and other popular tools. Answers common linking, discovery, and configuration issues for seamless project integration."
---

# How Can I Integrate GoogleTest with My Build System?

This FAQ provides targeted, solution-oriented guidance for integrating GoogleTest and GoogleMock into your C++ project's build system. It covers common questions and issues related to build system configuration, linking, header discovery, and environment setup, with a focus on popular tools like CMake and Bazel for seamless integration.

---

## Frequently Asked Questions

### 1. How do I build GoogleTest using CMake?

You can build GoogleTest either as a standalone project or embedded into your existing CMake-based build:

- **Standalone build:**
  1. Clone the repository:
     ```bash
     git clone https://github.com/google/googletest.git -b v1.17.0
     cd googletest
     mkdir build && cd build
     ```
  2. Generate build files (with GoogleMock included by default):
     ```bash
     cmake ..
     ```
     To build without GoogleMock, use:
     ```bash
     cmake .. -DBUILD_GMOCK=OFF
     ```
  3. Build and optionally install:
     ```bash
     make
     sudo make install
     ```

- **Embedded build in existing CMake project:**
  Use one of the following approaches:
  - Add GoogleTest as a subdirectory within your project’s CMake tree using `add_subdirectory()` to ensure consistent compiler/linker settings.
  - Use CMake's `FetchContent` to download and build GoogleTest during your project's configure step:

    ```cmake
    include(FetchContent)
    FetchContent_Declare(
      googletest
      URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
    )
    set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # To fix MSVC runtime linkage if needed
    FetchContent_MakeAvailable(googletest)

    add_executable(example example.cpp)
    target_link_libraries(example gtest_main)
    add_test(NAME example_test COMMAND example)
    ```

### 2. How should I configure compiler flags to build GoogleTest smoothly?

- GoogleTest requires at least C++17 support. Ensure your build environment uses `-std=c++17` or equivalent, for example:
  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

- On Windows with Visual Studio, configure `gtest_force_shared_crt` to `ON` if your project uses dynamic runtime libraries, to align GoogleTest’s runtime usage and avoid linker errors.

- The CMake build scripts already configure common flags for warnings, pthread usage, and exception handling, but if using your own build tools, these aspects must be handled accordingly.

### 3. How do I link my test executable with GoogleTest libraries?

- When using CMake with installed or embedded GoogleTest libraries, link against the target:
  - Use `gtest` if you provide your own `main()`.
  - Use `gtest_main` to link in GoogleTest’s prebuilt `main()`.

- Example linking with an executable:
  ```cmake
  add_executable(my_test test_mycode.cpp)
  target_link_libraries(my_test PRIVATE gtest_main)
  add_test(NAME my_test COMMAND my_test)
  ```

- Ensure include directories for GoogleTest headers are correctly set by linking to `gtest`/`gtest_main`, which transitively provides include paths.

### 4. Can I use GoogleTest with other build systems like Bazel?

Yes. Bazel users can integrate GoogleTest and GoogleMock by:

- Adding the `google/googletest` dependency in the `MODULE.bazel` file.
- Declaring test targets in Bazel `BUILD` files using `cc_test` that depend on `@com_google_googletest//:gtest` or `@com_google_googletest//:gmock`.
- Running tests with `bazel test //path/to/tests`.

Refer to the [Installation with Bazel](https://github.com/google/googletest/blob/main/getting-started/prerequisites-installation/installation-bazel.mdx) guide for step-by-step instructions.

### 5. How can I use pkg-config files with GoogleTest in my build?

- GoogleTest installs `.pc` pkg-config files for `gtest`, `gtest_main`, `gmock`, and `gmock_main`.

- Using pkg-config allows you to retrieve compilation and linking flags automatically:

  Example using pkg-config in CMake:

  ```cmake
  find_package(PkgConfig REQUIRED)
  pkg_search_module(GTEST REQUIRED gtest_main)

  add_executable(testapp samples/sample3_unittest.cc)
  target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})
  target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})

  enable_testing()
  add_test(NAME first_and_only_test COMMAND testapp)
  ```

- If `pkg-config` cannot find GoogleTest, ensure that `PKG_CONFIG_PATH` includes the directory where GoogleTest installs its `.pc` files, typically `/usr/local/lib/pkgconfig` or similar.

### 6. What common problems might I face when integrating GoogleTest, and how do I resolve them?

- **Compiler version or standard support missing:** Ensure your compiler supports C++17.
- **Linker errors for missing symbols:** Confirm you link against `gtest` or `gtest_main`.
- **Runtime library conflicts on Windows:** Set `gtest_force_shared_crt` in CMake for runtime consistency.
- **Headers not found:** Use the correct target dependency (`gtest`, `gtest_main`), or ensure include paths are properly configured.
- **Threading issues:** On POSIX, ensure linking to pthread libraries if your environment doesn’t handle it automatically.

---

## Troubleshooting Common Integration Issues

<AccordionGroup title="Common Integration Issues">
<Accordion title="Linker Errors Such as 'undefined reference to gtest_main'">
These often occur if your test executable does not link with `gtest_main` or `gtest`:

- Verify your build target links with `gtest_main` if you want GoogleTest’s main.
- If you provide your own main(), link with `gtest` instead.
- Confirm all GoogleTest source files are compiled if embedding GoogleTest directly.
</Accordion>

<Accordion title="Conflicts in Runtime Libraries on Windows">
Visual Studio defaults to dynamic CRT linkage, but GoogleTest defaults to static CRT linkage.

- Enable the `gtest_force_shared_crt` option in your CMake build to match CRT linkage.
- Example in CMake:
  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```
- This avoids linker mismatch errors like LNK2038.
</Accordion>

<Accordion title="Missing pthreads on Linux or macOS">
GoogleTest requires pthread support for thread safety.

- If using custom build scripts, ensure `-pthread` is included in both compile and link flags.
- The CMake build handles this automatically.
- Define `-DGTEST_HAS_PTHREAD=1` manually if detection is flawed.
</Accordion>

<Accordion title="Pkg-config Files Not Found or Flags Not Set">
Common reasons:

- `PKG_CONFIG_PATH` environment variable may not include the directory where GoogleTest’s `.pc` files are installed.
- Set it explicitly, e.g.:
  ```bash
  export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig
  ```
- In cross-compilation, properly set `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` as documented.
</Accordion>
</AccordionGroup>

---

## Best Practices for Integrating GoogleTest

- Prefer adding GoogleTest as a subdirectory or via CMake’s `FetchContent` rather than copying sources manually. This ensures consistent compiler flags.
- Link test executables to `gtest_main` unless custom test initialization is needed.
- Make sure the C++ standard (at least C++17) is consistently enforced across your project and GoogleTest.
- Use `target_compile_options` and `target_link_libraries` to propagate necessary flags from GoogleTest targets.
- For IDE integration (Visual Studio, Xcode), open and build generated projects directly via CMake.

---

## Example CMake Configuration Snippet Using FetchContent

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

# Require C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test_mycode.cpp)
target_link_libraries(my_test PRIVATE gtest_main)
add_test(NAME my_test COMMAND my_test)
```

This example downloads GoogleTest during configuration, builds it with consistent flags, and links your test executable to it.

---

## Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest) — for source, issues, and latest updates
- [CMake and Bazel Integration Guide](https://github.com/google/googletest/blob/main/guides/integration_and_best_practices/cmake_and_bazel_integration.mdx) — detailed walk-through
- [Pkg-config Usage for Various Build Systems](https://github.com/google/googletest/blob/main/docs/pkgconfig.md) — including cross-compilation considerations
- [Installation with CMake](https://github.com/google/googletest/blob/main/getting-started/prerequisites-installation/installation-cmake.mdx)
- [Installation with Bazel](https://github.com/google/googletest/blob/main/getting-started/prerequisites-installation/installation-bazel.mdx)

---

For further help troubleshooting build or link errors, consult the [Troubleshooting Common Setup Issues](https://github.com/google/googletest/blob/main/getting-started/troubleshooting-validation/common-setup-issues.mdx) page.

---

### Diagram: GoogleTest Integration Workflow in a CMake Project

```mermaid
flowchart TD
  A[Start Project CMake Configuration] --> B{Include GoogleTest?}
  B -->|Yes| C[Use FetchContent or add_subdirectory()]
  B -->|No| D[Build without GoogleTest]
  C --> E[Download / Configure GoogleTest Sources]
  E --> F[Build GoogleTest Libraries]
  F --> G[Link Test Executable with gtest_main or gtest]
  G --> H[Run tests using CTest or add_test()]
  H --> I[Check Results & Logs]
  I --> J{Success?}
  J -->|Yes| K[End]
  J -->|No| L[Troubleshoot Build/Link or Runtime Problems]
  L --> K
```

This diagram illustrates the key decision and integration steps when adding GoogleTest to your existing CMake project.
