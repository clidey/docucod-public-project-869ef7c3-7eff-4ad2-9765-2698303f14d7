---
title: "Platform-Specific and Cross-Platform Issues"
description: "Answers to questions involving running tests on different platforms, handling compiler compatibility, and working around platform-specific limitations or quirks. Provides solutions for Windows, Linux, MacOS, and embedded systems."
---

# Platform-Specific and Cross-Platform Issues

This FAQ addresses common questions and solutions when running GoogleTest on different platforms, handling compiler compatibility, and addressing platform-specific quirks. If you develop or run tests on Windows, Linux, MacOS, or embedded systems, this page guides you through practical workarounds and best practices to ensure smooth operation.

---

## 1. Running GoogleTest on Different Platforms

GoogleTest is designed to provide a consistent testing experience across multiple platforms, but each platform may have particular nuances or limitations you need to address.

### Windows

- **Thread Safety**: GoogleTest is thread-safe on Windows Desktop but *not* on Windows Mobile platforms. Avoid running assertions concurrently on worker threads in Windows Mobile.
- **UNICODE Mode**: `testing::InitGoogleTest()` supports wide strings, so you can use it in Unicode builds without additional modifications.
- **Runtime Library Mismatch**: When building on Visual Studio, ensure `gtest_force_shared_crt` is set if you want GoogleTest to match your project's dynamic CRT linkage. This avoids runtime conflicts and linker errors.
- **Shared Libraries (DLL)**: If building GoogleTest as a DLL, compile tests with `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` and the library with `-DGTEST_CREATE_SHARED_LIBRARY=1`.

### Linux and MacOS

- **Pthreads Support**: GoogleTest automatically detects and uses POSIX threads (pthreads) for thread-safe operations. If you're building in an unusual environment where pthreads are missing, force `-DGTEST_HAS_PTHREAD=0` to disable threading features.
- **POSIX Regex**: On Unix-like platforms, GoogleTest uses POSIX extended regex libraries for pattern matching. This requires development headers for regex.
- **Compiling with Exceptions and RTTI**: GoogleTest requires exceptions and RTTI enabled by default. If you disable them, many features won't work correctly. You can explicitly control via compile flags, but disabling is not recommended on these platforms.

### MacOS

- Supports all features as Linux does.
- Special handling exists for iOS builds (see Embedded Systems).

### Embedded Systems and Special Platforms

- GoogleTest supports a limited subset of platforms including embedded devices such as ESP32, ESP8266, and Xtensa processors.
- On embedded and mobile platforms (e.g., Windows Mobile, embedded Linux variants), **stream redirection and death tests may be disabled** due to lack of required OS services or file system support.
- Environment variables and standard file system APIs might be unavailable or limited on embedded systems, so tests relying on them should handle absence gracefully.

---

## 2. Workarounds for Platform-Specific Limitations

### Stream Redirection Not Supported

On platforms without full file system or OS support (Windows Mobile, embedded MCU platforms), GoogleTest disables capturing `stdout` and `stderr`. This means assertions or death tests that rely on output capture will be limited.

**Workaround:** Avoid output-capturing assertion patterns or refactor tests to explicitly check conditions without relying on captured streams.

### Thread Count and Thread Local Storage

GoogleTest attempts to detect the number of active threads and use thread-local storage where possible.

- On platforms without pthreads (or with partial support), thread count queries will return 0, and thread-local features may fallback to non-thread-safe implementations.
- Use `GTEST_HAS_PTHREAD` macro (can be overridden) to disable threads if necessary.

### Compiler Support and Flags

- GoogleTest requires a minimum of C++17 support. Ensure your compiler supports this.
- On MSVC and Clang, GoogleTest overrides default compiler flags for stricter warnings and static CRT linkage unless `gtest_force_shared_crt` is enabled.
- When using GCC, additional warning flags and no-exceptions or no-RTTI flags can independently be passed, but this is discouraged unless you fully understand the impact.

### Build System Integration

- For CMake users, GoogleTest's CMake scripts automatically detect platform and apply appropriate compiler/linker flags, including pthread linkage if needed.
- Bazel builds use `config_setting` rules to detect platforms and adjust compile options appropriately.

<Tip>
When cross-compiling for embedded or special platforms, explicitly specify or disable certain features in compile flags (such as disabling threading or stream capturing) to avoid subtle runtime issues.
</Tip>

---

## 3. Common Platform-Specific FAQs

<AccordionGroup title="Platform-Specific FAQs">
<Accordion title="Why does GoogleTest work differently on Windows and Linux?">
GoogleTest uses native OS primitives behind the scenes for threading, file I/O, and regex support. Windows uses native Windows APIs, whereas Linux and MacOS rely on pthreads and POSIX regex. This leads to differences in thread safety and available features like death tests and stream capturing.


**Tip:** Check that you respect platform limitations and use platform-specific macros like `GTEST_OS_WINDOWS` or `GTEST_OS_LINUX` for conditional code.
</Accordion>

<Accordion title="How do I fix linking errors related to pthread on Linux?">
This is common if your build system does not link against the pthread library. When using CMake, GoogleTest's find_package handles this.


**Solution:** Make sure to link with `-pthread` in your build or add `${CMAKE_THREAD_LIBS_INIT}` to your target link libraries.

Example:
```cmake
find_package(Threads REQUIRED)
target_link_libraries(your_test_target PRIVATE GTest::gtest Threads::Threads)
```
</Accordion>

<Accordion title="What if my platform does not support exceptions or RTTI?">
GoogleTest relies on exceptions and RTTI for many features such as assertions and death tests. Disabling these will reduce functionality and may cause compile or runtime errors.


**Recommendation:** Enable exceptions and RTTI when building GoogleTest unless your target environment explicitly forbids them.
</Accordion>

<Accordion title="Why are death tests disabled on some platforms?">
Death tests rely on OS features like process forking, signal handling, and file system support for temporary files. Platforms without these capabilities (e.g., Windows Mobile, embedded boards without full OS support) disable this feature.


**Workaround:** Design tests to avoid death tests or isolate tested components to be testable without them.
</Accordion>
</AccordionGroup>

---

## 4. Best Practices for Cross-Platform Testing

- **Group platform-specific tests**: Use `#ifdef` guards with `GTEST_OS_*` macros to isolate platform-dependent test logic.
- **Validate build environment regularly**: Verify that compiler flags, threading support, and library dependencies match the target platformâ€™s requirements.
- **Use CMake or Bazel integration scripts**: They handle most platform quirks and compiler options for you.
- **Avoid relying on environment variables on embedded platforms**: Many embedded platforms lack environment variable support.
- **Limit stream-capturing assertions on mobile/embedded platforms**.
- **Return the result of `RUN_ALL_TESTS()` in your main() function**: This is critical for CI systems to properly detect test success or failure across platforms.

---

## 5. Troubleshooting Platform Issues

<AccordionGroup title="Troubleshooting Steps">
<Accordion title="Tests fail mysteriously on Windows with linker errors">
Ensure you link with `gtest_main` if you rely on GoogleTest's default `main()` implementation. If defining your own, link only with `gtest`. Check that all runtime libraries match between your project and GoogleTest (e.g., static vs dynamic CRT).
</Accordion>

<Accordion title="Tests do not run or are not discovered on MacOS">
Confirm you are running tests with `RUN_ALL_TESTS()` return value propagated. Inspect test discovery logs if available. Ensure your Mac toolchain supports C++17 and exceptions.
</Accordion>

<Accordion title="GoogleTest assertions cause crashes on embedded targets">
Check if exceptions and RTTI are enabled for your embedded build. If not available, try disabling features that require them and redesign tests accordingly.
</Accordion>

<Accordion title="Thread local storage does not behave as expected on older Linux kernels">
GoogleTest relies on pthreads for thread local storage. If using an older kernel or C library without robust pthread support, thread local data may not be isolated. Consider disabling threading with `-DGTEST_HAS_PTHREAD=0` if threading is not essential.
</Accordion>
</AccordionGroup>

---

## 6. Additional Resources

- [GoogleTest Primer](docs/primer.md): Comprehensive introductory guide for writing tests.
- [Supported Platforms](docs/platforms.md): Details platform and compiler compatibility.
- [CMake Integration Guide](guides/integration-solutions/cmake-bazel-integration): How to build and link GoogleTest properly.
- [FAQ: Getting Started & Common Setup Issues](faq/common-usage-questions/getting-started-errors.mdx): Covers common setup problems.
- [Build System & Integration Troubleshooting](faq/integration-and-support/build-integration-troubleshooting.mdx): For build and linker problems.

---

For any unresolved platform-specific issues, consult the official GitHub issues page or community forums where platform experts share workarounds and patches.


---

<Check>
Always test your GoogleTest build and run process on all target platforms regularly to catch platform-specific problems early.
</Check>


---

## Example: Conditionals for Platform-Specific Code

```cpp
#ifdef GTEST_OS_WINDOWS
// Windows-specific setup or test logic
#elif defined(GTEST_OS_LINUX)
// Linux-specific code
#elif defined(GTEST_OS_MAC)
// MacOS-specific code
#else
// Fallback or unsupported platform
#endif
```

Use platform macros documented in `gtest-port-arch.h` to detect your platform at compile time.


---

## Summary
This page helps you understand and troubleshoot platform-specific behaviors of GoogleTest. It provides actionable guidance for running tests on Windows, Linux, MacOS, and embedded systems, covering threading, compiler compatibility, stream capture, and death tests. Practical tips and workarounds ensure a consistent test experience across diverse environments.


---

_For the full list of supported platforms and details, see the [Supported Platforms](docs/platforms.md) page._


---