---
title: "Test Performance Optimization Tips"
description: "Offers practical advice on speeding up test execution, managing large test suites, and reducing flakiness for both unit and integration tests."
---

# Test Performance Optimization Tips

Optimizing test performance is crucial for maintaining productivity and confidence as your codebase grows. This page offers practical advice on speeding up test execution, managing large test suites efficiently, and reducing flakiness for both unit and integration tests. By applying these strategies, you can achieve faster feedback cycles and more reliable test results.

---

## 1. Strategies to Speed Up Test Execution

### Parallelize Test Runs

- **Leverage test framework features:** GoogleTest supports running tests in parallel environments when integrated with compatible test runners or CI systems.
- **Distribute tests across CPU cores:** Split your test suite into concurrent batches to utilize all available CPU resources.
- **Use sharding:** Divide the tests into shards that can run independently, reducing the wall-clock time of the full test run.

### Reduce Test Dependencies

- **Isolate tests:** Design tests to avoid expensive external dependencies like databases or network services.
- **Replace with mocks and fakes:** Use gMock to substitute slow or brittle components with lightweight mocks wherever possible.
- **Minimize filesystem interaction:** Prefer in-memory resources or temporary files cleaned up immediately.

### Limit Expensive Setup and Teardown

- **Reuse fixtures:** Share expensive setup across multiple tests using test fixtures, reducing redundant initialization.
- **Lazy initialization:** Defer expensive setup to be executed only if necessary.

### Selective Testing

- **Test filtering:** Run only relevant tests during development using GoogleTest’s filter flags.
- **Focus on fast feedback:** Prioritize quicker unit tests in pre-submit runs and integrate slower tests in nightly pipelines.

## 2. Managing Large Test Suites

### Organizing Tests into Logical Groups

- **Structure by functionality:** Arrange tests by components or features for easier targeting and maintenance.
- **Use test suites and fixtures:** Group related tests sharing similar contexts.

### Incremental Testing

- **Run impacted tests:** Use tools or scripts to detect which tests to run based on code changes.
- **Continuous Integration:** Schedule full test suite runs selectively on integration branches.

### Caching and Artifacts

- **Cache build outputs:** Avoid recompilation of unchanged code.
- **Persist test results:** Use test results caching in CI to skip redundant runs when inputs haven't changed.

### Monitoring and Reporting

- **Track slow tests:** Continuously monitor test execution times and refactor slow tests.
- **Identify flaky tests:** Report and quarantine unstable tests to maintain overall suite reliability.

## 3. Reducing Test Flakiness

### Use Mocks to Eliminate Unreliable External Factors

- Replace flaky dependencies such as network or disk with reliable mocks using gMock.

### Strict Control Over Test Ordering and State

- Avoid implicit ordering or state dependencies between tests.
- Use `InSequence`, `Sequence`, and explicit ordering expectations in mocks when order is critical.

### Avoid Timing-Dependent Logic

- Do not rely on sleep or chrono-based waits in tests.
- Use synchronization primitives or testing hooks for predictable timing.

### Isolate Tests from Global State

- Reset or mock global or static variables and singletons between tests.

### Verbose Logging and Diagnostic Flags

- Enable GoogleMock’s `--gmock_verbose` flag for detailed call tracing when debugging flaky behavior.

## 4. Practical Tips and Best Practices

- **Set expectations clearly:** Use `EXPECT_CALL` with precise arguments and cardinalities to catch improper interactions early.
- **Use default actions wisely:** Employ `ON_CALL` for setting default mock behaviors to avoid over-constraining tests.
- **Avoid overly strict expectations:** Over-specifying calls makes tests brittle to internal refactorings.
- **Use sequences only when necessary:** Enforce call order explicitly only when order matters for correctness.
- **Regularly review and refactor tests:** Eliminate outdated mocks and optimize slow tests.

## 5. Common Mistakes to Avoid

- **Mixing test and production code logic:** Keep mocks and real implementations clearly separated.
- **Long or complex test setup:** Break down complex fixture setup into smaller, manageable parts.
- **Ignoring uninteresting calls warnings:** Address warnings or use `NiceMock` to suppress if understood.
- **Leaking mocks:** Ensure mock objects are properly destroyed to verify expectations.

## 6. Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) – Recipes for writing effective mocks.
- [Mocking Reference](../reference/mocking.md) – Detailed explanation of mock object setup.
- [gMock for Dummies](../gmock_for_dummies.md) – Beginner-friendly guide to GoogleMock.
- [GoogleTest Performance and Scaling](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#performance) section for more tips.

---

## 7. Troubleshooting Performance Issues

<AccordionGroup title="Troubleshooting Performance">
<Accordion title="Tests Run Too Slowly">
- Check for expensive external dependencies (database connections, file I/O).
- Use mocks to replace slow components.
- Run tests in parallel to utilize CPU cores effectively.
- Profile test setup and teardown times to identify bottlenecks.
</Accordion>
<Accordion title="Flaky Tests Cause Intermittent Failures">
- Verify test isolation and lack of shared global state.
- Use GoogleMock's verbose output (`--gmock_verbose=info`) to trace unexpected calls.
- Quarantine flaky tests until fixed.
- Avoid timing-based waits or sleeps.
</Accordion>
<Accordion title="Excessive Mock Expectation Failures">
- Review your mock expectations for accuracy.
- Avoid over-specifying expectations with unnecessary strictness.
- Use `RetiresOnSaturation()` to retire expectations once fulfilled.
- Organize expectations using `InSequence` or `Sequence` to express ordering clearly.
</Accordion>
</AccordionGroup>

---

## 8. Summary Workflow for Optimizing Tests

<Steps>
<Step title="Assess">
Analyze existing test suite execution time and flakiness.
</Step>
<Step title="Isolate">
Identify slow tests and dependencies; isolate them using mocking.
</Step>
<Step title="Refactor">
Refactor tests with over-complicated or brittle expectations.
</Step>
<Step title="Parallelize">
Set up parallel test execution and sharding in CI.
</Step>
<Step title="Maintain">
Continuously monitor test performance and reliability.
</Step>
</Steps>

---

<Check>
Optimize your test workflows for fast, reliable feedback by leveraging mock objects properly, organizing test suites effectively, and utilizing parallel execution and selective test running.
</Check>

---

## 9. Contacting Support & Community

If you encounter persistent performance or flakiness issues beyond your control, consider reaching out to:

- Official GitHub repository issues: https://github.com/google/googletest/issues
- GoogleTest and GoogleMock discussion forums
- Review the [Support Resources and Community Channels](support-resources-and-community.md) page for additional avenues.

Ensure to provide clear descriptions of your issues, test environment, and attempts at optimization.


---