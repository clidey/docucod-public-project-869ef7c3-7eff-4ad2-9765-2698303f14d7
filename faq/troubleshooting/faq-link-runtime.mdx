---
title: "Runtime & Linking Problems"
description: "Outlines common causes for runtime or linking problems, such as duplicated symbols, missing libraries, or incompatible build configurations. Guides users on troubleshooting integration with their applications and build pipelines."
---

# Runtime & Linking Problems

This page helps you understand and troubleshoot common runtime and linking issues encountered when integrating GoogleTest and GoogleMock into your application and build environment. These problems often manifest as duplicated symbols, missing dependencies, incompatible build configurations, or mismatched runtime linkage settings.

---

## 1. Common Runtime and Linking Issues

### 1.1 Duplicated Symbols / Multiple Definitions

- **Cause:** Linking multiple definitions of GoogleTest or GoogleMock symbols, usually when:
  - GoogleTest/GoogleMock is included both as a static library and as source in your project.
  - GoogleTest/GoogleMock built with conflicting compiler or linkage options.

- **Solution:**
  - Use a single method of including GoogleTest/GoogleMock: either as a linked library or as part of the source tree.
  - Avoid mixing static and shared runtime libraries. If you are using Visual Studio, enable the `gtest_force_shared_crt` option in CMake to align runtime CRT linkage.
  - Check for multiple inclusions or transitive linking in your build system.

### 1.2 Missing GoogleTest/GoogleMock Libraries or Object Files

- **Cause:** The linker cannot find GoogleTest or GoogleMock symbols such as `InitGoogleTest()`, `RUN_ALL_TESTS()`, or `MOCK_METHOD()` implementations.

- **Solution:**
  - Ensure your linker includes the proper libraries: `gtest`, `gtest_main`, `gmock`, or `gmock_main`.
  - Verify your build configuration includes these libraries and the correct linking order.
  - If using CMake, use `find_package(GTest REQUIRED)` and link with `GTest::gtest` and `GTest::gtest_main` or GoogleMock equivalents.
  - Confirm that the libraries are built for the same C++ standard and architecture.

### 1.3 Runtime Mismatch and Compiler Incompatibility

- **Cause:** Different compilers or mismatched C++ standard flags can cause ABI incompatibilities leading to runtime failures or linking errors.

- **Solution:**
  - Build GoogleTest and GoogleMock with the same compiler, standard version (C++17 required), and flags as your application.
  - Explicitly specify the C++ standard in your build system (e.g., `-std=c++17` for GCC/Clang or equivalent for MSVC).

### 1.4 Runtime Library Inconsistency

- **Cause:** GoogleTest defaults to static runtime linkage (`/MT` in MSVC) while new projects may use dynamic CRT linkage (`/MD`), resulting in linking conflicts.

- **Solution:**
  - When using CMake, consider setting the option `gtest_force_shared_crt=ON` to instruct GoogleTest to use dynamic CRT linkage and match your project.
  - Alternatively, set your entire project to use the static CRT.

### 1.5 Wide vs Narrow Character Mode Mismatch

- **Cause:** On Windows, when compiling with Unicode (wide char) support, you must use the wchar_t overloads of GoogleTest initialization functions.

- **Solution:**
  - Use `InitGoogleTest(int* argc, wchar_t** argv)` in your `main()` if compiling in Unicode mode.
  - Similarly, use `InitGoogleMock(int* argc, wchar_t** argv)` if you require GoogleMock.

### 1.6 Incorrect Runtime Initialization Order

- **Cause:** Not calling or incorrectly calling initialization functions leads to missing command-line flag parsing and improper internal setup.

- **Solution:**
  - Always call `InitGoogleTest(&argc, argv)` (or `InitGoogleMock`) **before** invoking `RUN_ALL_TESTS()`.
  - This ensures flag parsing, environment setup, and proper linkage.


## 2. Troubleshooting Steps

To isolate and fix runtime and linking problems, follow this approach:

### Step 1: Verify Build and Link Setup

- Confirm GoogleTest and GoogleMock are built with the expected compiler and flags.
- Check your linker is including the necessary libraries: `gtest`, `gtest_main`, `gmock`, `gmock_main`.
- Review build scripts to avoid duplicate linkage or conflicting linkage (static vs shared runtime).

### Step 2: Check Compiler and Runtime Flag Consistency

- Ensure your project and the GoogleTest/GoogleMock libraries use the **same C++ standard (C++17)**.
- Align runtime library linkage. For MSVC, set `gtest_force_shared_crt` correspondingly.

### Step 3: Confirm Initialization Code

- Your `main()` function or test runner must initialize the framework by calling `InitGoogleTest(&argc, argv)`, or `InitGoogleMock(&argc, argv)` before running tests.
- Incorrect or omitted init calls will cause runtime failures or incorrect behavior.

### Step 4: Verify Command-Line Flags Parsing

- GoogleTest and GoogleMock remove recognized flags from `argv`. Improper flag passing or unknown flags can cause failures.
- Use the provided initialization functions to properly parse and strip flags.

### Step 5: Run Minimal Test Case

- Create or run a simple test case to isolate the problem.
- This verifies the integration of GoogleTest/GoogleMock in your environment.

### Step 6: Use Verbose Output

- Use the `--gtest_verbose=info` or `--gmock_verbose=info` flag for more detailed runtime information about mock behavior and test execution.


## 3. Best Practices

- Prefer building GoogleTest and GoogleMock as part of your project build if possible, using `add_subdirectory()` in CMake. This ensures consistent compiler flags and runtime.
- Avoid linking both GoogleTest static library and source compilation into your project.
- When building on Windows, use `gtest_force_shared_crt` if your application and GoogleTest must use dynamic CRT linkage.
- Always use the framework’s initialization functions to parse flags and set up internal state.


## 4. Example `main()` Function

Here’s a canonical example of initializing GoogleTest and GoogleMock safely:

```cpp
#include "gtest/gtest.h"
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);  // Initializes both GoogleMock and GoogleTest
  return RUN_ALL_TESTS();
}
```

On Windows in Unicode mode:

```cpp
int main(int argc, wchar_t** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This guarantees runtime initialization, command-line parsing, and flag handling.


## 5. Diagnosing Linking Problems

- Look for linker errors mentioning duplicated symbols like `InitGoogleTest` or `Mock::Mock`.
  - This indicates multiple object files or libraries define the same symbol.
- Check your build logs or linker command lines to identify extra or redundant GoogleTest/GoogleMock libraries.
- Review library ordering; often the linker is sensitive to the order of static libraries.


## 6. Flags and Environment Variables

GoogleTest and GoogleMock recognize command-line flags and environment variables to control behavior. When linker or runtime issues occur related to flags, verify:

- Flags are properly parsed and removed from `argv` by initialization calls.
- Environment variables such as `GTEST_FILTER`, `GTEST_COLOR`, or `GTEST_REPEAT` are set correctly.
- GoogleMock-specific flags like `--gmock_verbose` or `--gmock_default_mock_behavior` are handled by `InitGoogleMock()`.


## 7. Additional Resources

- [GoogleTest Primer](../getting-started/configuration-and-first-use/writing-first-test) — Basics of writing and running tests.
- [Resolving Build & Integration Issues](../getting-started/common-issues-and-troubleshooting/build-issues) — Common build and integration problems.
- [Project Configuration Guide](../getting-started/configuration-and-first-use/project-configuration) — Setting include paths and linking.
- [Installing with CMake](../getting-started/setup-and-installation/installing-with-cmake) — How to properly build and integrate GoogleTest with CMake.
- [GoogleMock Initialization Details](../api-reference/mocking-api/mock-methods) — For mock method usage and setup.


## 8. Troubleshooting Checklist

<AccordionGroup title="Troubleshooting Checklist for Runtime & Linking Issues">
<Accordion title="Check compiler versions and C++ standard support">
Verify that both GoogleTest/GoogleMock build and your application use a C++17 compatible compiler and flags.
</Accordion>
<Accordion title="Verify consistent runtime libraries on MSVC">
Ensure your project and GoogleTest/GoogleMock share runtime linkage, using `gtest_force_shared_crt=ON` if needed.
</Accordion>
<Accordion title="Avoid multiple copies of GoogleTest or GoogleMock">
Check for multiple definitions by scanning your link line and source inclusions.
</Accordion>
<Accordion title="Use correct initialization functions in main()">
Always call `InitGoogleTest()` or `InitGoogleMock()` before `RUN_ALL_TESTS()`.
</Accordion>
<Accordion title="Confirm linker flags and library paths">
Double-check the linker is finding the expected static/shared libraries of GoogleTest and GoogleMock.
</Accordion>
<Accordion title="Run minimal test suite to isolate problem">
Create a basic test to confirm correct runtime behavior before expanding to your full tests.
</Accordion>
</AccordionGroup>


---

<Tip>
For Windows users: The option `gtest_force_shared_crt` in the CMake build adjusts runtime linkage to dynamic CRT, aligning GoogleTest and your application project settings and preventing linking conflicts caused by mixed static/dynamic linkages.
</Tip>

<Note>
GoogleMock’s initialization flags like `--gmock_verbose` and `--gmock_default_mock_behavior` are parsed and removed from the command line by `InitGoogleMock()`. This prevents unknown flag errors during runtime.
</Note>

<Warning>
Avoid calling `RUN_ALL_TESTS()` without first calling the initialization function (`InitGoogleTest` or `InitGoogleMock`). Failure to do so results in unpredictable test runtime behavior and flag parsing issues.
</Warning>

---

# Summary

This document guides users through recognizing and resolving runtime and linking problems in GoogleTest and GoogleMock integration. It covers common error causes such as duplicated symbols, missing libraries, and runtime linkage mismatches, especially on Windows. Practical troubleshooting steps and best practices are provided alongside essential initialization code examples to ensure proper test execution.

# Key Sections
- Common Runtime and Linking Issues
- Troubleshooting Steps
- Best Practices
- Example `main()` Function
- Diagnosing Linking Problems
- Flags and Environment Variables
- Troubleshooting Checklist

# Important Links
- [GoogleTest Primer and Writing First Test](../getting-started/configuration-and-first-use/writing-first-test)
- [Build and Integration Issues](../getting-started/common-issues-and-troubleshooting/build-issues)
- [Project Configuration Guide](../getting-started/configuration-and-first-use/project-configuration)
- [Installing GoogleTest with CMake](../getting-started/setup-and-installation/installing-with-cmake)

# Cross-References
- Core Test Workflows Guides
- Mocking API References
- Configuration and First Use sections

# Next Steps
- Verify your build and linking setup matches GoogleTest/GoogleMock requirements.
- Use `InitGoogleMock()` or `InitGoogleTest()` as appropriate before running tests.
- Consider building GoogleTest/GoogleMock as part of your project build for consistent flags.
- Consult the [Resolving Build & Integration Issues](../getting-started/common-issues-and-troubleshooting/build-issues) guide for further debugging assistance.
