---
title: "Debugging Runtime Errors in Test Execution"
description: "Helps users diagnose failures or crashes when running tests, such as segmentation faults, improper teardown/setup, and assertion failures. Discusses useful debugging tips, error reporting formats, and log output interpretation."
---

# Debugging Runtime Errors in Test Execution

This page guides you through diagnosing and resolving runtime errors encountered during test execution using GoogleTest and GoogleMock. It covers common failure types such as segmentation faults, setup and teardown issues, and assertion failures. It also provides practical debugging tips, explains error reporting formats, and shows how to interpret log outputs effectively to streamline troubleshooting.

---

## Frequently Asked Questions

### What causes segmentation faults during test execution, and how can I identify them?
Segmentation faults typically occur due to invalid memory accesses in your test code or the code under test. Common causes include dereferencing null or dangling pointers, buffer overruns, or misuse of move-only types in mocks.

**How to identify?** Run the test binary under a debugger (e.g., `gdb` or Visual Studio debugger) to catch the fault as it happens. Use stack traces printed on failure or enabled verbose output (`--gmock_verbose=info`) to pinpoint the exact failing call.

### How do setup and teardown failures manifest, and what should I check?
Failures in `SetUp()` or `TearDown()` methods within test fixtures usually result in test crashes or aborted executions. These might be caused by unhandled exceptions, invalid state, or resource leaks.

Ensure your setup and teardown methods:
- Do not throw exceptions unless expected and handled.
- Properly initialize and clean up all resources.
- Don’t call mock methods before expectations are set or after mock destruction.

Using `Mock::VerifyAndClearExpectations()` can help verify that mocks are in a valid state before teardown.

### What are assertion failures, and how can I interpret their details?
An assertion failure means a test expectation was unmet or an assertion macro (like `EXPECT_EQ`, `ASSERT_TRUE`) failed. GoogleTest shows:
- The source file and line number of the failure.
- The actual and expected values or states.
- Additional diagnostics such as matcher failure reasons.

Enabling `--gmock_verbose=info` can print detailed traces of mock calls and matched expectations, making it easier to debug why a particular assertion failed.

### What debugging flags and output formats can help diagnose failures?
- `--gmock_verbose=[info|warning|error]`
  - `info` shows all mock call traces and stack information.
  - `warning` shows uninteresting call warnings (default).
  - `error` shows only error messages.
- `--gtest_output=`
  - Outputs test results in XML or other supported formats for integration in CI.
- `--gtest_stack_trace_depth=N`
  - Limits the stack trace depth in failure reports, useful to reduce noise.

Use these flags to increase observability during test runs.

### How do I interpret error messages from Google Mock during test failures?
Google Mock provides rich failure diagnostics, including:
- **Uninteresting call warnings:** Indicate calls to mock methods lacking expectations.
- **Unexpected call errors:** Occur when a mock method is called with arguments that don’t match any `EXPECT_CALL`.
- **Excessive call errors:** When a mock method is called more times than expected.
- **Retired expectation notices:** Inform about expectations that no longer match calls due to ordering or saturation.

Messages include function names, argument values, expected call counts, and locations of expectations, guiding precise fixes.

### What are best practices to prevent and troubleshoot runtime errors in test execution?
- Write clear and minimal expectations on mocks.
- Use `NiceMock` to suppress warnings from uninteresting calls unless strictness is required.
- Use `StrictMock` to catch all unexpected calls early.
- Leverage the `InSequence` and `After` clauses for ordered call expectations to catch ordering issues.
- Run your tests under a debugger or with address sanitizers to catch memory issues.
- Use `EXPECT_CALL` with `.RetiresOnSaturation()` to avoid stickiness pitfalls.

---

## Common Issues & Troubleshooting

### Segmentation Faults
- **Check mock object lifetimes:** Ensure mocks are not accessed after destruction.
- **Verify move-only type handling:** When mocking methods taking or returning move-only types (e.g., `std::unique_ptr`), provide appropriate actions to avoid invalid state.
- **Use tools:** Use sanitizers (AddressSanitizer, Valgrind) to detect memory misuse.

### Improper Setup/Teardown Failures
- Avoid calling mock methods before setting expectations.
- Confirm all required resources (files, sockets) are available during setup.
- Catch exceptions in setup/teardown to isolate failure causes.

### Assertion Failures
- Rerun your tests with `--gmock_verbose=info` to get detailed trace logs.
- Verify that all expected calls are properly set with correct matchers.
- Ensure the order of expectations matches the order of call if using sequences.

### Uninteresting or Unexpected Calls
- To suppress warnings for harmless uninteresting calls, use `NiceMock<T>`.
- To treat all uninteresting calls as errors, use `StrictMock<T>`.
- Add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` to explicitly allow certain calls.

### Dealing with Excessive Calls
- Use `.Times()` clauses to limit expected calls.
- Use `.RetiresOnSaturation()` to retire expectations when saturated.
- Review logs indicating which calls are excessive and adjust expectations.

---

## Debugging Workflow and Tips

<Steps>
<Step title="Start with Basic Logs">
Run the tests with default verbosity to observe initial failure messages.
</Step>
<Step title="Enable Verbose Debugging">
Use `--gmock_verbose=info` to print detailed mock call traces and stack information.
</Step>
<Step title="Check Setup and Teardown">
Verify fixture setup and teardown do not crash or throw.
</Step>
<Step title="Inspect Unexpected Calls">
Look for unexpected or uninteresting mock call warnings to find missing or incorrect expectations.
</Step>
<Step title="Verify Call Ordering">
Use `InSequence` or `After` clauses if call order matters, to catch ordering problems.
</Step>
<Step title="Run Under Debugger or Sanitizers">
Catch segmentation faults or memory corruptions with debug tools.
</Step>
<Step title="Use Mock Verification APIs">
Explicitly verify and clear mock expectations early using `Mock::VerifyAndClearExpectations(mock_obj)`.
</Step>
</Steps>

---

## Understanding Google Mock Output and Error Reporting

Google Mock produces detailed diagnostics on test failures, which include:

- **Function call description:** Shows called method name and argument values.
- **Expectation match info:** Indicates which expectation matched or failed.
- **Call counts:** Shows expected versus actual calls.
- **Stack traces:** Available with `--gmock_verbose=info` for uninteresting or unexpected calls.
- **Warning notes:** Explains uninteresting call warnings, accidental omissions of expectations, and how to suppress them.

This output is designed to help users quickly locate the root cause of failures and take corrective action.

---

## Quick Reference Links

- [Using gMock Actions and Matchers](https://google.github.io/googletest/gmock_cook_book.html#using-actions)
- [Understanding Uninteresting vs Unexpected Calls](https://google.github.io/googletest/gmock_cook_book.html#uninteresting-vs-unexpected)
- [Setting Expectations With EXPECT_CALL](reference/mocking.md#EXPECT_CALL)
- [Specifying Default Behavior With ON_CALL](reference/mocking.md#ON_CALL)
- [Debugging Test Failures and Output Customization](guides/integration-and-best-practices/debugging-and-output)

---

## Practical Tips

- Avoid mixing `EXPECT_CALL` and mock calls out of order; always set expectations before exercising mocks.
- Use `NiceMock` for mocks with many uninteresting calls to reduce log noise.
- Use `StrictMock` to enforce that no unexpected calls occur.
- Combine `.Times()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` carefully to model expected calls accurately.
- When you see warnings about leaked mocks, ensure mocks are properly deleted or marked using `Mock::AllowLeak()`.
- Use `--gmock_verbose=warning` by default for balanced visibility.

<Check>
Remember, `ON_CALL` sets behavior but not expectation. Use `EXPECT_CALL` for expectations that must be met.
</Check>

---

## Troubleshooting Example

Suppose your test fails with:

```
Unexpected mock function call - returning default value.
    Function call: Foo(42)
          Returns: 0
Google Mock tried the following 1 expectation, but it didn't match:
  Expected arg #0: is equal to 10
           Actual: 42
         Expected: to be called once
           Actual: called 0 times
```

**Steps to resolve:**

1. Verify the argument passed matches your `EXPECT_CALL` matcher.
2. Check whether the call was made before the expectation was set.
3. Run with `--gmock_verbose=info` to trace calls and expectation matching.
4. Adjust matchers or call order accordingly.

---

## Summary
This page helps you quickly identify and fix runtime issues when running your tests. By understanding the nature of segmentation faults, setup/teardown errors, assertion failures, and Google Mock warnings and errors, you can vastly improve debugging efficiency and test reliability.

For detailed examples of mock syntax and usage, refer to the Mocking Reference and the gMock Cookbook. For output customization and advanced debugging techniques, consult the Debugging and Output guide.

---

<Note>
For step-by-step workflows on defining mocks and writing expectations, see [Defining and Using Mock Classes](guides/mocking-in-action/defining-mocks) and [Setting Expectations and Verifying Interactions](guides/mocking-in-action/setting-expectations).
</Note>
