---
title: "Linking and Integration Errors"
description: "Addresses issues users face when integrating GoogleTest or GoogleMock with larger codebases, including common linker errors, ABI mismatches, and problems arising from improper configuration. Provides resolution strategies and debugging steps."
---

# Linking and Integration Errors FAQ

When integrating GoogleTest and GoogleMock into your projects, encountering linker errors and integration issues is a common stopping point. This page addresses these challenges by explaining typical root causes and giving actionable resolution strategies to ensure smooth incorporation of GoogleTest and GoogleMock into larger codebases.

---

## 1. Common Linker Errors

### Q: Why do I get "undefined reference" or "multiple definition" errors when linking GoogleMock?

**A:**

These linker errors usually stem from one or more of the following problems:

- Including GoogleMock source files or libraries inconsistently—e.g., linking `gmock_main` and also defining your own `main()` function.
- Violations of the One Definition Rule (ODR), caused by inconsistent compilation flags or multiple definitions of the same symbols, especially with inline/template expansion.
- Mixing static and shared library linkage incorrectly.
- Failing to link with the `gtest` library when using `gmock` (remember, `gmock` depends on `gtest`).

**Resolution:**

- Use the provided `gmock_main` target if you do not provide your own `main()`. If you provide your own, link just with `gmock` and `gtest`.
- Ensure consistent compiler flags, especially those affecting RTTI, exception handling, and debug/release modes.
- Link both `gmock` and `gtest` libraries explicitly if you are linking separately.
- Avoid multiple definitions by ensuring header-only usage does not include source files.
- Align static vs shared linkage approaches across your test code and GoogleMock libraries.

### Q: What causes ABI incompatibilities and how do I detect them?

**A:**
ABI incompatibilities can arise from mismatched compiler versions, different compiler flags (e.g., RTTI on vs off, exceptions enabled vs disabled), or using incompatible standard library versions.

Signs include obscure linker errors, runtime crashes, or heap corruption warnings.

**Resolution:**

- Compile GoogleTest and GoogleMock with exactly the same compiler, version, and flags as your tests.
- Use GoogleMock’s provided CMake scripts or configuration macros to enforce strict compiler flag consistency.
- Avoid mixing debug and release builds of GoogleMock with your tests.

### Q: I get a linker error about duplicate symbols when including mock headers in multiple translation units. How do I fix this?

**A:**

This is usually caused because mock classes or helper functions are defined entirely in headers without proper `inline` or separation, leading to multiple definitions.

**Resolution:**

- Ensure mocks are declared with `MOCK_METHOD` macros in classes and implemented inline only if supported.
- Use GoogleMock’s recommended practice of including mock definitions in headers and referencing them properly.
- For actions or matchers defined in headers, ensure they use `inline` or are in anonymous namespaces as required.
- The file `gmock_link_test.h` demonstrates techniques to avoid linker errors by careful header inclusion and namespace management.

---

## 2. Build System and Configuration Issues

### Q: How should I configure CMake for GoogleMock to avoid linkage problems?

**A:**

- Use GoogleMock's `CMakeLists.txt` as it properly sets up targets for `gmock`, `gmock_main`, and their dependencies on `gtest`.
- If integrating into your own CMake project, use `add_subdirectory()` for GoogleMock and link against `gmock` or `gmock_main`.
- Be aware of the `BUILD_SHARED_LIBS` option and match it between your project and GoogleMock.
- Set the `gmock_build_tests` option *off* unless you want to build GoogleMock’s internal tests.
- Make sure to include GoogleMock's headers and link libraries correctly as per the standard documentation ([Configuring Your Project](../getting-started/project-setup-first-run/configuring-project)).

### Q: What about threading libraries and compiler requirements?

**A:**

GoogleTest and GoogleMock depend on threading support (pthreads on POSIX, Windows threading otherwise). Failure to link with threading libraries can cause linker errors.

- CMake scripts for GoogleMock detect and link threading dependencies.
- If compiling manually, ensure you specify linking flags for `-lpthread` or equivalent.
- Use the recommended compiler versions and settings as per the [System Requirements](../getting-started/prerequisites-installation/system-requirements).

---

## 3. Integration with User Code

### Q: Can including GoogleMock headers in multiple source files cause conflicts?

**A:**

Yes, if mock classes or test fixtures are not set up correctly with proper linkage. The `gmock_link_test.h` file exists to demonstrate how to safely define mock classes and actions that can be included in multiple translation units without linker issues.

Best practices from this file include:

- Defining mocks in headers with `MOCK_METHOD` macros properly.
- Using namespaces consistently.
- Restricting copying and assignment of mock classes.

### Q: Why am I getting errors related to `MOCK_METHOD` macro usage?

**A:**

Common reasons include:

- Incorrect method signature in `MOCK_METHOD` (missing parentheses around argument types that contain commas).
- Using `MOCK_METHOD` outside the public section.
- Missing qualifiers like `override` or `const` when required.

Refer to the [Mocking Reference - MOCK_METHOD](../docs/reference/mocking.md#MOCK_METHOD) for exact syntax and examples.

---

## 4. Debugging Tips and Verification

### Q: How do I verify my linking and integration setup is correct?

- Build and run the GoogleMock's own test suite using its CMake setup, which can confirm compiler and linker correctness.
- Use diagnostic compiler and linker verbose flags (`-v`, `--verbose`) to inspect linkage.
- Run tests with `--gmock_verbose=info` to track mock call details.
- If you encounter mysterious runtime issues, verify ABI compatibility and consistent compiler flags.

### Q: What if I get unexpected call warnings or unmatched expectations?

That usually indicates an integration or mock usage problem, but sometimes linking can cause test doubles to malfunction.

- Double-check your linkage with `gmock` and `gtest`.
- Verify that the correct mock objects are instantiated and expectations are set before test code execution.
- Consult the [Legacy gMock FAQ](../docs/gmock_faq.md) for common mock setup pitfalls.

---

## 5. Best Practices Summary

- **Link correctly:** Use `gmock_main` for convenience or link `gmock` + `gtest` explicitly if you provide your own test main.
- **Consistent build:** Align all compiler flags (RTTI, exceptions, debug/release) across GoogleMock and your tests.
- **Use CMake:** Leverage GoogleMock's CMake scripts for reliable build integration.
- **Mock definitions:** Keep mock definitions in headers, mark them properly to avoid multiple definitions.
- **Trace problems:** Enable verbose logging on mock invocations to diagnose issues.
- **Dependency awareness:** Always link threading libraries and related dependencies.

---

## 6. Additional Resources

- [Configuring Your Project](../getting-started/project-setup-first-run/configuring-project) (Project setup and linking)
- [Mocking Reference](../docs/reference/mocking.md) (Detailed expectations, mock methods, and actions)
- [Legacy gMock FAQ](../docs/gmock_faq.md) (Common mock usage issues and clarifications)
- [GoogleMock CMakeLists.txt](../googlemock/CMakeLists.txt) (Official build configuration)
- [gmock_link_test.h](../googlemock/test/gmock_link_test.h) (Example mock definitions to avoid linker errors)

---

## Summary

Effectively integrating GoogleTest and GoogleMock requires proper linking of libraries, consistent compiler settings, and cautious mock class definition management. This page guides users through troubleshooting frequent linker errors, resolving ABI conflicts, configuring CMake properly, and best practices for defining mocks and actions to prevent multiple definition issues. Proactive use of GoogleMock's diagnostic tools and sample tests helps verify setup correctness and accelerates resolution of integration challenges.