---
title: "Common Errors & Their Solutions"
description: "Covers frequent build errors, link problems, runtime failures, and test misconfigurations. Provides clear recommendations and checklists to get tests running smoothly."
---

# Common Errors & Their Solutions

This page addresses frequent errors and issues users may encounter when working with GoogleTest and GoogleMock. It helps identify root causes, outlines practical solutions, and provides clear guidance to get tests running smoothly.

---

## 1. Build and Linking Issues

### Problem: Missing gMock symbols during linking

If your build fails with errors about unresolved symbols related to gMock, it means the mock libraries are not properly linked.

**Cause:**
- The gMock library is not added to the linker inputs.
- Mixing static and dynamic linking inconsistently.

**Solution:**
- Make sure your build system links against both GoogleTest and GoogleMock binaries or static libraries.
- For CMake, link your test target with `gmock` or `gmock_main` appropriately.
- Using Bazel, add `@com_google_googletest//:gmock` as a dependency.

### Problem: Compilation errors when using `MOCK_METHOD`

**Cause:**
- Missing `#include <gmock/gmock.h>` before using mocking macros.
- Incorrect macro usage, especially with function signatures containing commas.

**Solution:**
- Include `<gmock/gmock.h>` in your mock class header.
- For functions with templated or complex types containing commas, wrap the type in parentheses or use a `using` alias. For example:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

or

```cpp
using PairInt = std::pair<int, int>;
MOCK_METHOD(PairInt, GetPair, ());
```

### Problem: Warnings or errors about overriding virtual functions with const-qualified parameters on MSVC

**Cause:**
- A known Microsoft Visual C++ compiler bug regarding ignoring top-level const in parameters.

**Solution:**
- Remove `const` qualifiers on top-level function parameters in both the base class declarations and mock implementations.
- Continue to apply `const` on methods as needed.

---

## 2. Runtime Test Failures

### Failure: "Actual function call count doesn't match this expectation"

This error means that a mock method was called more or fewer times than specified by an `EXPECT_CALL`.

**How to fix:**

- Double-check the `.Times()` specification for your expectations. If omitted, GoogleMock assumes the method should be called exactly once.
- Add `.Times(AnyNumber())` if a method may be called any number of times.
- Use cardinalities like `AtLeast(N)` or `Between(M, N)` for flexible call counts.
- Ensure you set expectations **before** exercising the code that triggers mock calls.

### Failure: "Uninteresting mock function call encountered"

This warning occurs when a mock method without any `EXPECT_CALL` specification is invoked.

**Context:**
- By default, GoogleMock treats such calls as "uninteresting" and allows them but warns.

**How to resolve:**
- Explicitly specify expectations for these calls if they are expected, e.g.,

```cpp
EXPECT_CALL(mock_object, MethodName).Times(AnyNumber());
```
- Alternatively, wrap your mock in `NiceMock<>` to suppress uninteresting call warnings.

### Failure: "Unexpected mock function call"

This indicates that a call was made on a mock method but did not match any existing expectations.

**How to address:**
- Add an appropriate `EXPECT_CALL` with matchers that cover the observed call.
- If the method is overloaded, ensure you specify the matchers carefully to disambiguate the call.
- For calls that should never happen, use `.Times(0)` to specify and catch such issues.

### Failure: "called more times than expected"

This error surfaces if a method is called more times than the upper bound specified in `Times()`.

**Check:**
- If your test flow can invoke the method more than expected, use a looser cardinality (e.g., `AtLeast`, `AnyNumber`).
- Make sure expectations are not conflicting or overlapping in a way that causes ambiguous matching.

---

## 3. Expectation Ordering Issues

### Problem: Expectation is not met in the correct order

**Cause:**
- By default, GoogleMock does not require calls to occur in the order expectations are declared.

**Solution:**
- Use `InSequence` to enforce strict order in a scope:

```cpp
{
  ::testing::InSequence seq;
  EXPECT_CALL(mock, CallA());
  EXPECT_CALL(mock, CallB());
}
```
- For partial orderings or dependencies, use the `.After()` clause or multiple sequences.

### Problem: "Sticky" expectations causing upper-bound violations

Expectations remain active even after their call limit is reached, unless specified.

**Fix:**
- Apply `.RetiresOnSaturation()` on expectations that should become inactive after exhausting their call count.

---

## 4. Mock Object Behavior Controls

### Issue: Too many warnings for uninteresting calls clutter test output

**How to reduce noise:**
- Use `NiceMock<YourMock>` to suppress warnings for uninteresting calls.
- Use `NaggyMock<YourMock>` to keep warnings.
- Use `StrictMock<YourMock>` if you want uninteresting calls to cause test failures.
- Control verbosity with `--gmock_verbose=LEVEL` flag; levels include `info`, `warning`, `error`.

### Issue: Mock object returns default constructed values unexpectedly

If your mock method returns a complex type and you did not specify a return action, the default return might be a default constructed value or null.

**Solution:**
- Explicitly specify return values using `.WillOnce(Return(...))` or `.WillRepeatedly(Return(...))`.
- Use `ON_CALL(mock, Method()).WillByDefault(Return(...))` to configure default actions.

---

## 5. Memory and Lifetime Issues

### Problem: Tests report heapcheck failures when deleting mock objects

**Cause:**
- The base class of a mock interface lacks a virtual destructor.

**Resolution:**
- Ensure the interface/base class has a **virtual destructor**.

### Problem: Final verification doesn't occur because mocks are never deleted

**Tips:**
- Always manage mock object lifetimes thoroughly; if allocating on the heap, ensure proper deletion.
- Use `Mock::AllowLeak(&mock_obj)` if the mock should be intentionally leaked.
- Turn on heap checker and sanitizer tools to detect leaks.

---

## 6. Debugging and Diagnostics

### How to debug expectation failures

- Run tests with flag `--gmock_verbose=info` to see detailed mock call traces.
- Combine with `--gtest_stack_trace_depth=0` for cleaner mock call trace without stack frames.
- Use the warnings in failure messages to identify which expectation wasn't met or was violated.

### How to verify and clear mock expectations prematurely

Use:

```cpp
::testing::Mock::VerifyAndClearExpectations(&mock_obj);
```

to verify whether all previous expectations are satisfied and clear them before reuse.

---

## 7. Common Pitfalls and Best Practices

- Always set `EXPECT_CALL` **before** exercising the code that triggers mock calls.
- Avoid over-specifying expectations that make tests fragile; prefer matchers like `_` when argument value is not essential.
- Use sequences and `.RetiresOnSaturation()` wisely to structure call order and lifetime of expectations.
- Wrap mocks with `NiceMock` unless you specifically want warnings or errors on uninteresting calls.
- Mock only classes/interfaces you own or have proper control over.
- For testing asynchronous code, consider synchronization mechanisms along with mock action callbacks.

---

## 8. Useful Commands and Flags

| Flag                        | Description                                                |
|----------------------------|------------------------------------------------------------|
| `--gmock_verbose=info`     | Prints detailed traces of mock calls and expectations      |
| `--gmock_verbose=warning`  | Prints warnings and errors only (default)                   |
| `--gmock_verbose=error`    | Prints error messages only                                  |
| `Mock::VerifyAndClearExpectations(&mock)` | Verify and clear expectations on a mock object   |
| `Mock::AllowLeak(&mock)`   | Prevents gMock from reporting leaked mock errors            |

---

## 9. Getting More Help

- Refer to the [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for beginner-friendly introductions.
- Consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for practical recipes.
- Use the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick syntax references.
- Visit the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for API details.
- Join community forums or GitHub discussions of GoogleTest for community support.

---

### Callout
<Tip>
For immediate resolution of test failures, always start by running your tests with `--gmock_verbose=info` to get trace logs that reveal mismatched calls and expectations.
</Tip>

---

### Related Documentation
- [Writing Your First Test](https://google.github.io/googletest/getting-started/configuration-validation/writing-first-test.html)
- [Configuring Your Project](https://google.github.io/googletest/getting-started/configuration-validation/project-integration.html)
- [Mocking Basic Usage](https://google.github.io/googletest/gmock_for_dummies.html#using-mocks-in-tests)
- [Mock Strictness Levels](https://google.github.io/googletest/reference/mocking.html#mock-strictness)
- [EXPECT_CALL Clause Reference](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL)
- [Troubleshooting Setup](https://google.github.io/googletest/getting-started/configuration-validation/validation-troubleshooting.html)

---

This comprehensive guide empowers you to quickly diagnose and solve common errors in GoogleTest and GoogleMock, speeding your path to reliable test suites.
