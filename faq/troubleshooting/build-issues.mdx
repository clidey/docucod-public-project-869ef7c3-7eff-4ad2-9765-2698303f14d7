---
title: "Troubleshooting Build and Integration Errors"
description: "Get step-by-step instructions for resolving the most common build problems, linking errors, and third-party integration failures when adopting GoogleTest or GoogleMock."
---

# Troubleshooting Build and Integration Errors

## Overview

This guide provides clear, step-by-step solutions to resolve the most common issues you might encounter while building, linking, and integrating GoogleTest and GoogleMock into your C++ projects. Whether you are adopting these frameworks for the first time or integrating them into existing build systems, this document focuses on practical fixes to help you achieve successful builds and smooth integration.

---

## Common Build Issues

### 1. CMake Configuration Failures

**Problem:** Your build fails at the configuration step with CMake, or fails to locate GoogleTest/GoogleMock sources.

**Cause:** Missing or incorrect CMakeLists.txt setup, or absence of required tools like CMake.

**Solution:**

- Ensure you have [CMake installed](https://cmake.org/download/) (version 3.14 or later is recommended).
- If building GoogleTest standalone, follow these steps:

  ```bash
  git clone https://github.com/google/googletest.git -b v1.17.0
  cd googletest
  mkdir build
  cd build
  cmake .. [-DBUILD_GMOCK=OFF # if you want only GoogleTest]
  ```

- If integrating with an existing CMake project, prefer using `FetchContent` to download the latest stable GoogleTest source during configure:

  ```cmake
  include(FetchContent)

  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
  )

  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Visual Studio

  FetchContent_MakeAvailable(googletest)

  # Link test executables against gtest_main or gtest
  add_executable(my_test ...)
  target_link_libraries(my_test gtest_main)
  add_test(NAME my_test COMMAND my_test)
  ```

---

### 2. Compiler Requirements and Flags

**Problem:** Build fails due to incompatible compiler version or missing C++17 support.

**Cause:** GoogleTest requires a compiler supporting C++17.

**Solution:**

- Make sure your compiler is:
  - GCC 7 or newer
  - Clang 3.4.1 or newer
  - MSVC 2017 Update 3 or newer

- Enable C++17 in your CMakeLists.txt explicitly:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

- When using custom build scripts, add appropriate compiler flags (e.g., `-std=c++17`).

---

### 3. Linking Errors with Visual Studio Runtime

**Problem:** Linker errors such as mismatch for `RuntimeLibrary` when building on Windows.

**Cause:** GoogleTest links against static runtime by default, causing conflicts with dynamic runtime linkage in your project.

**Solution:**

- Use the CMake option to force shared C runtime linkage:

  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```

- This ensures that GoogleTest and your project link against the same runtime libraries.

---

### 4. Inclusion of GoogleMock in Builds

**Problem:** Build fails due to missing GoogleMock sources or linkage problems.

**Cause:** GoogleMock depends on GoogleTest and may require separate setup.

**Solution:**

- GoogleMock is distributed alongside GoogleTest.
- To build GoogleMock standalone or with your project, make sure to include GoogleTest sources.
- With CMake, add the GoogleTest subdirectory first, then GoogleMock's, or include them together as:

  ```cmake
  add_subdirectory(googletest)
  add_subdirectory(googlemock)
  ```

- Link tests against `gmock_main` or `gmock` as needed.

---

## Common Integration Problems

### 1. Using GoogleTest in Existing CMake Projects

**Problem:** Hard-to-manage GoogleTest integration or build conflicts.

**Solution:**

- Prefer building GoogleTest along with your project via `add_subdirectory` or `FetchContent`.
- This ensures consistent compiler and linker settings, preventing mismatches.
- Avoid copying GoogleTest sources manually unless strictly necessary.

### 2. Unresolved Symbols or Missing GoogleTest Symbols at Link Time

**Cause:** GoogleTest libraries are not linked or linked improperly.

**Solution:**

- Link your test executables with `gtest` or `gtest_main`.
- For GoogleMock tests, link with `gmock` or `gmock_main`.
- Example:

  ```cmake
  target_link_libraries(your_test PRIVATE gtest_main) # For GoogleTest
  target_link_libraries(your_mock_test PRIVATE gmock_main) # For GoogleMock
  ```

- Confirm proper library discovery by checking `find_package(GTest CONFIG REQUIRED)` or equivalent.

### 3. Multiple Definition or Duplicate Symbol Errors

**Cause:** GoogleTest source files or object files are compiled multiple times.

**Solution:**

- Do not compile GoogleTest source files directly in your project if linking against the library target.
- Use the CMake targets `gtest` and `gmock` provided by GoogleTest projects.
- If embedding GoogleTest sources, structure your build to avoid repeated compilation.

---

## Best Practices for Third-Party Integration

- Always use the supported, recommended CMake-based integration methods.
- Use the `FetchContent` or submodule approach to keep GoogleTest sources synchronized.
- Build GoogleTest and GoogleMock using your project compiler flags to avoid ABI issues.
- Set and verify the appropriate C++ standard for both your code and GoogleTest.
- Enable `gtest_force_shared_crt` on Windows to avoid runtime library mismatch errors.
- Use `gtest_main` or `gmock_main` libraries to simplify `main()` linkage for test binaries.

---

## Troubleshooting Tips and Diagnostics

### Checking Build Environment

- Verify the installed CMake version: `cmake --version`
- Verify your compiler version meets GoogleTest requirements: `g++ --version`, `clang --version`, or MSVC version
- Confirm the presence of pthreads on Unix-like systems if multithreaded tests are used.

### Verifying Library Linking

- Use verbose builds in CMake: `cmake --build . -- VERBOSE=1`
- Verify that your test target links against GoogleTest/GoogleMock libraries.
- Search for duplicate symbols using linker output to identify multiple compilations of GoogleTest sources.

### Common CMake Variables Impacting GoogleTest

- `BUILD_GMOCK=ON/OFF`: Specifies whether to build GoogleMock, which includes GoogleTest.
- `gtest_force_shared_crt`: Controls linkage of C runtime on MSVC; must be consistent.

### Handling Compiler Options

- Ensure consistent compiler flags across your project and GoogleTest.
- Define thread-related macros if necessary (`-DGTEST_HAS_PTHREAD=1`) if automatic detection fails.

---

## Next Steps

- Refer to [GoogleTest Primer](https://google.github.io/googletest/primer.html) to understand test writing basics.
- Use [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for integrating GoogleMock.
- Visit the [Integration with Build Tools and CI](https://google.github.io/googletest/overview/integration-ecosystem/integration-with-build-and-ci.html) guide for further integration tips.
- Leverage the [GoogleMock CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt) for insights on building mock libraries.

---

## Related Documentation

- [Generic Build Instructions for GoogleTest](https://github.com/google/googletest/blob/main/googletest/README.md#build-with-cmake)
- [GoogleMock README and Testing Guide](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest Advanced Topics](https://google.github.io/googletest/docs/advanced.md)
- [Assertions Reference](https://google.github.io/googletest/reference/assertions.md)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)

---

## Summary Checklist

- [x] Confirm C++17 support and compiler version.
- [x] Verify GoogleTest source availability and CMake configuration.
- [x] Ensure correct linking of libraries (`gtest`, `gtest_main`, `gmock`, `gmock_main`).
- [x] Check for runtime library mismatches on Windows and fix with `gtest_force_shared_crt`.
- [x] Use modern CMake methods like `FetchContent` for integration.
- [x] Run tests with appropriate flags and verify output.
- [x] Consult integration guides for CI and build system best practices.

<Tip>
Always isolate build and linkage errors by progressively building GoogleTest standalone, then integrating into your project to identify root causes effectively.
</Tip>

<Warning>
Avoid manual copying or out-of-date versions of GoogleTest sources inside your projects to prevent build inconsistencies and linkage conflicts.
</Warning>

---

For unresolved issues, consult the [GoogleTest issue tracker](https://github.com/google/googletest/issues) or community forums.
