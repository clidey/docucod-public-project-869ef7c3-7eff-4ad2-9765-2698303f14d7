---
title: "Why won't GoogleTest or GoogleMock build in my environment?"
description: "A collection of troubleshooting tips for common build errors, missing dependencies, and environment misconfigurations. Includes references to minimum version requirements and configuration files for various build systems."
---

# Why won't GoogleTest or GoogleMock build in my environment?

This FAQ page provides a detailed collection of troubleshooting tips addressing common build errors, missing dependencies, and environment misconfigurations encountered when building GoogleTest and GoogleMock. It also includes references to minimum version requirements and necessary configuration files for various build systems.

---

## 1. Common Build Issues with GoogleTest and GoogleMock

### 1.1 Missing or Outdated Compiler Support

GoogleTest and GoogleMock require a **C++17 compliant compiler**. Common issues include:

- **Compiler too old or not fully supporting C++17:**
  - Ensure your compiler version meets the minimum requirements (e.g., GCC >=7, Clang >=7, MSVC 2017 or later).
  - Use appropriate compiler flags such as `-std=c++17` on GCC/Clang or `/std:c++17` on MSVC.

- **Not linking to required libraries:**
  - Build or link against the proper GoogleTest and GoogleMock libraries.
  - Ensure both header and compiled libraries are from compatible versions.

### 1.2 Missing Dependencies or Environment Setup

- **Threading support:** GoogleTest requires a threading library compatible with your platform. Missing `-lpthread` on Linux can cause linking failures.

- **Filesystem and standard library compatibility:** Some platforms or older standard libraries may lack required C++17 filesystem or tuple support.

- Check your environment for incomplete or conflicting standard library installations.

### 1.3 Incomplete or Incorrect Build Configuration

- **Build system setup issues:** 
  - Make sure to correctly add GoogleTest and GoogleMock as dependencies in your build system.
  - In CMake, link using `target_link_libraries(your_test_target gtest gmock)` or use provided CMake targets.
  - For Bazel, ensure your `WORKSPACE` and BUILD files declare GoogleTest and GoogleMock dependencies properly.

- **Include path misconfiguration:** 
  - Verify the include directories point to where `gtest` and `gmock` headers are located.

- **Mixed versions or stale builds:**
  - Clean your build directory and rebuild from scratch after updating source or toolchain.

### 1.4 Platform-Specific Considerations

- Windows systems may require different calling conventions or additional flags (e.g., using `Calltype(STDMETHODCALLTYPE)` qualifier in `MOCK_METHOD`).
- MSVC users may see warnings or errors related to const parameters and method overriding; removing top-level `const` qualifiers in arguments often resolves such issues.

---

## 2. Minimum Version and Configuration Requirements

### 2.1 Compiler Requirements

| Compiler | Minimum Version | Notes |
| -------- | --------------- | ----- |
| GCC      | 7 or later      | Use `-std=c++17` flag.|
| Clang    | 7 or later      | Use `-std=c++17` flag.| 
| MSVC     | Visual Studio 2017 (15.7+) | Use `/std:c++17` flag.

### 2.2 Build Systems Configuration Files

- **CMake:**
  - Must locate GoogleTest correctly using `find_package(GTest REQUIRED)` or add it as part of your source tree.
  - Link targets against `gtest` and `gmock`.
  - Example:

  ```cmake
  find_package(GTest REQUIRED)
  add_executable(my_test my_test.cc)
  target_link_libraries(my_test GTest::gtest GTest::gmock pthread)
  ```

- **Bazel:**
  - Declare dependencies in `WORKSPACE` using git_repository or HTTP archive with correct SHA.
  - Reference `@com_google_googletest//:gmock` or relevant targets in BUILD files.

---

## 3. Practical Troubleshooting Tips

### 3.1 Diagnosing Build Failures

- **Check compiler invocation commands:**
  - Ensure C++17 standard flags are present.
  - Inspect include directories and linked libraries.

- **Run `make clean` or equivalent before rebuilding:**
  - Stale object files with different compiler versions cause conflicts.

- **Verify environment PATH and library paths:**
  - Make sure there are no conflicting versions of GoogleTest or GoogleMock installed globally.

### 3.2 Dealing with Compilation Warnings and Errors

- **Warning about overriding virtual methods with const parameters:**
  - It's a known MSVC issue that top-level const parameters cause warnings.
  - Suggested fix: remove the `const` qualifier in method parameters where possible.

- **Errors related to MOCK_METHOD macro parsing:**
  - Wrap complex return or argument types containing commas with extra parentheses.
  - Example:

    ```cpp
    MOCK_METHOD((std::pair<bool, int>), GetPair, ());
    ```

### 3.3 Controlling Build Verbosity for Debugging

- Use `--gmock_verbose=info` at runtime to trace mock calls and expectations.
- Use `--gtest_stack_trace_depth=0` to limit stack trace clutter.

### 3.4 Handling Linker Errors

- Ensure that both GoogleTest and GoogleMock libraries are built with the same runtime settings (static/dynamic CRT).
- Add necessary linker flags such as `-lpthread` on Unix-like platforms.

---

## 4. Reference to Key GoogleMock Configuration and Behavior

- Use `ON_CALL()` and `EXPECT_CALL()` properly to define default and expected behaviors.
- Verify that expectations are set **before** exercising mocks to avoid undefined behavior.
- Use `Mock::VerifyAndClearExpectations()` to force verification before destruction if needed.
- Use `Mock::AllowLeak()` to mark mocks that do not need verification for cases like intentionally leaked mocks.

---

## 5. Common Pitfalls to Avoid

- Setting expectations after mock calls causes undefined behavior.
- Incorrect use of `MOCK_METHOD` macro without proper parentheses around argument types with commas.
- Mixing versions of GoogleTest/GoogleMock headers and libraries.
- Not cleaning up build artifacts after changing compilers or versions.

---

## 6. Additional Resources

- [GoogleMock Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Setup and Build Integration Guide](https://google.github.io/googletest/guides/getting-started/setup-build-integration)
- [Supported Platforms and Dependencies](https://google.github.io/googletest/overview/feature-architecture-and-integration/supported-platforms-and-dependencies)

---

## 7. Summary

This document covers practical troubleshooting techniques and configuration guidance to help users overcome build issues with GoogleTest and GoogleMock. From compiler and environment setup to build system configuration, users are walked through key areas of failure and provided actionable steps to fix them.

---

### Example Build Warning Fix

If MSVC shows warnings about `const` parameters in virtual methods:

```cpp
// Instead of this:
MOCK_METHOD(void, Bar, (const int i), (override));

// Use this:
MOCK_METHOD(void, Bar, (int i), (override));
```

### Example Complex Type Mock Method

```cpp
class MyMock {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
```

---

For additional help and community support, consult the [GoogleTest and GoogleMock community forums](https://github.com/google/googletest/issues) and official documentation.


---

<Check>
Always ensure your build environment meets the minimum compiler and dependency requirements before integrating GoogleTest and GoogleMock.
</Check>

<Tip>
Leverage the official CMake or Bazel configuration files to streamline building and linking against GoogleTest and GoogleMock.
</Tip>

<Warning>
Avoid mixing header versions and binaries from different GoogleTest or GoogleMock releases to prevent subtle build and runtime issues.
</Warning>
