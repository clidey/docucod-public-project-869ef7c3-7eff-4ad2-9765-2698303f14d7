---
title: "Build and Linking Errors"
description: "Frequently encountered build and linking problems and how to fix them: missing symbols, CMake/Bazel misconfigurations, and typical platform quirks. Offers diagnostic steps and references known-issues documentation."
---

# Build and Linking Errors

This page addresses frequently encountered problems during the build and linking phase when using GoogleTest and GoogleMock, focusing on typical issues like missing symbols, CMake or Bazel misconfigurations, and platform-specific quirks. It provides diagnostic steps and directs you to known issues documentation for deeper insights.

---

## Common Build and Linking Issues

### Why am I seeing "undefined reference" or missing symbol errors when linking GoogleTest?

These errors typically indicate that the linker cannot find the GoogleTest libraries your test binary depends on. Common causes include:

- Forgetting to link your test executable against the `gtest` or `gtest_main` library.
- Mismatching build settings, such as mixing static and shared builds, or conflicts between CRT linkage on Windows.
- Not compiling or including GoogleTest sources correctly.

**How to resolve:**

- Ensure you link your test binary to either `gtest` or `gtest_main` (the latter provides a default `main()` function).
- On Windows, consider using the CMake option `gtest_force_shared_crt` if your project uses the dynamic runtime library (`/MD` or `/MDd`).
- When building from source with CMake, ensure you include the GoogleTest source directory via `add_subdirectory()` or via FetchContent.

### Why do I see linker errors about multiple definitions or main() conflicts?

GoogleTest provides its own main function via the `gtest_main` library. If you:

- Link both `gtest_main` and provide your own `main()`, you’ll have multiple definition errors.
- Link only `gtest` (without `gtest_main`) but do not define your own `main()`, the linker will complain about missing entry points.

**How to resolve:**

- Link `gtest_main` if you want GoogleTest’s default `main()`.
- If you prefer your own `main()`, link only `gtest`.
- Avoid linking both `gtest_main` and your own `main()` together.

### CMake and Bazel Misconfigurations

- Misconfiguring `BUILD_SHARED_LIBS` in CMake may cause runtime linkage problems or wrong CRT linkage on Windows.
- When including GoogleTest as a subdirectory, ensure your compiler and linker flags are consistent across your project and the GoogleTest library.
- For Bazel, verify workspace setup and target dependencies properly include GoogleTest and GoogleMock.

### Platform Specific Quirks

- **Windows:** Incorrect runtime library linkage (`/MT` vs `/MD`) can cause build or runtime failures. Use `gtest_force_shared_crt` in CMake to align CRT linkage.
- **MinGW:** pthreads support is limited; GoogleTest disables pthreads by default and uses native Windows threading.
- **Configuring Exception and RTTI Flags:** GoogleTest’s build scripts control exception handling and RTTI flags, avoid overriding them inconsistently which can cause build errors.

---

## Diagnostic Steps

Follow these logical steps to diagnose and fix build/linking problems:

<Steps>
<Step title="Check Include and Linkage Settings">
Verify your project includes the correct GoogleTest headers and links against `gtest` or `gtest_main`.
</Step>
<Step title="Verify Build Options Consistency">
Ensure that `BUILD_SHARED_LIBS`, `gtest_force_shared_crt`, and your CRT linkage settings align between your project and GoogleTest.
</Step>
<Step title="Examine Compiler and Linker Flags">
Make sure that flags like exceptions and RTTI settings are consistent and compatible.
</Step>
<Step title="Validate Platform-Specific Settings">
Confirm platform-specific considerations such as threading and runtime libraries are appropriately configured.
</Step>
<Step title="Review Build System Integration">
For CMake, check usage of `add_subdirectory`, `find_package`, and FetchContent methods.
For Bazel, verify workspace and target rules correctness.
</Step>
</Steps>

---

## Tips and Best Practices

- Use `gtest_main` to simplify test executables unless you need a custom `main()`.
- When integrating GoogleTest with CMake, prefer FetchContent or `add_subdirectory` to ensure compatible compiler/linker flags.
- On Windows, if you get `RuntimeLibrary` mismatch linker errors, set `gtest_force_shared_crt=ON`.
- Avoid mixing shared and static builds inadvertently.
- Always verify that the compiler supports at least C++17 standard as required by GoogleTest.
- Use verbose build output (e.g., `VERBOSE=1` with Make, or `/VERBOSE` in MSVC) to track exact linker commands.

---

## References and Known Issues

- See the [Integration and Dependencies](https://github.com/google/googletest/blob/main/overview/architecture-integration-usecases/integration-and-dependencies.mdx) guide for detailed integration instructions.
- For troubleshooting specific build problems, consult the [Common Issues & Gotchas](https://github.com/google/googletest/blob/main/getting-started/troubleshooting-validation/common-issues.mdx) documentation.
- Platform-specific compatibility and requirements are outlined in [Supported Platforms](https://github.com/google/googletest/blob/main/faq/core-questions/compatibility.mdx).

---

## Additional Resources

- [Building and Configuring Your Project](https://github.com/google/googletest/blob/main/getting-started/prerequisites-installation/building-configuring-project.mdx): Step-by-step instructions for CMake and Bazel integration.
- [GoogleTest README](https://github.com/google/googletest/blob/main/googletest/README.md): What to know about build environment and flags.
- [Build System Integration Guide](https://github.com/google/googletest/blob/main/guides/integration_real_world_use/build_system_integration.mdx): Practical integration examples and troubleshooting.

---

## Troubleshooting Quick Checklist

<AccordionGroup title="Troubleshooting Build and Linking Errors">
<Accordion title="Missing Symbols / Undefined References">
Make sure to link with `gtest` or `gtest_main` and GoogleMock libraries if used. Verify that your linker paths include GoogleTest build output.
</Accordion>
<Accordion title="Multiple Definitions of `main`">
Do not link both `gtest_main` and provide your own main function. Choose one.
</Accordion>
<Accordion title="Runtime Library Conflicts (Windows)">
Match CRT linkage between your project and GoogleTest via the `gtest_force_shared_crt` CMake option.
</Accordion>
<Accordion title="Pthreads Not Found or Unsupported">
GoogleTest disables pthreads on unsupported systems (like MinGW). Avoid forcing pthread linkage on unsupported platforms.
</Accordion>
<Accordion title="Compile Flags Conflicts">
Ensure exception handling, RTTI, and warning flags are consistent. GoogleTest build scripts tweak these appropriately.
</Accordion>
</AccordionGroup>

---

## Summary

Proper build and linking of GoogleTest projects requires careful setup of compiler and linker flags, consistent C++ standard support, and correct usage of libraries like `gtest_main`. Pay special attention to platform-specific quirks, especially on Windows. When integrating with CMake or Bazel, rely on documented mechanisms such as FetchContent or predefined workspace rules. Avoid mixing runtimes and ensure that your test entry point and linked libraries correspond correctly.

<Tip>
Remember: linking errors usually come down to missing libraries or conflicting definitions. A methodical check of your build system setup and dependencies will resolve most problems.
</Tip>

---

## Example Minimal CMake Usage

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject LANGUAGES CXX)

# Enable C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Include GoogleTest using FetchContent
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
# Force shared CRT on Windows; helps avoid linker mismatches
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test_main.cpp)
# Link with gtest_main to get default main() implementation
target_link_libraries(my_test PRIVATE gtest_main)

include(GoogleTest)
gtest_discover_tests(my_test)
```

## Troubleshooting Common Linker Error Example

```
undefined reference to `testing::InitGoogleTest(int*, char**)'
undefined reference to `main'
```
- Cause: Not linking against `gtest_main` or `gtest`.
- Solution: Link your test binary with `gtest_main` if you don't have your own `main()`.

---

## Further Help

For any remaining build and linking issues:

- Review your CMake or Bazel build configuration.
- Consult the GoogleTest GitHub issues page.
- Seek advice on community forums or Stack Overflow using tags `googletest` and `gmock`.


---

# End of Build and Linking Errors Documentation
