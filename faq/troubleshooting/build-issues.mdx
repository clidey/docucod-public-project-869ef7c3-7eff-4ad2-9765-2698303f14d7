---
title: "Resolving Build and Configuration Issues"
description: "Answers to frequently encountered compilation, dependency, and linking problems. Covers typical error messages, missing headers, or version mismatches, with step-by-step troubleshooting and references to relevant configuration files."
---

# Resolving Build and Configuration Issues

This page addresses the most common challenges users encounter when compiling, linking, and configuring GoogleTest and GoogleMock. It provides actionable steps to identify and fix errors such as missing headers, dependency conflicts, and version mismatches. You will find explanations of typical error messages, guidance for troubleshooting, and references to key configuration files to get your build environment correctly set up and running.

---

## Frequently Asked Questions

### Why do I get "file not found" errors for GoogleTest or GoogleMock headers?
This typically occurs when the compiler's include directories are not set up properly.

- Ensure your build system knows the location of the `googletest/include` and `googlemock/include` directories.
- If using CMake, confirm that `target_include_directories` includes these paths.
- When manually compiling, add `-I/path/to/googletest/include` and `-I/path/to/googlemock/include`.

### What causes linking errors like "undefined reference to ..." for GoogleMock symbols?
Linker errors arise when the necessary GoogleTest and GoogleMock libraries are not linked.

- Link against `gmock` or `gmock_main` libraries depending on whether you provide your own `main()`.
- Verify your linker flags include `-lgmock_main` (or `-lgmock` and `-lgtest`) and threading libraries if required.
- For CMake projects, link with `target_link_libraries(your_target gmock_main)`.

### How do I correctly build and link with `gmock_main` to get the main() function?
GoogleMock provides a library `gmock_main` that defines a suitable `main()` function to run tests.

- Link your test executables with `gmock_main` instead of `gmock` if you don't have a custom `main()`.
- This simplifies setup by handling test initialization.
- See the `googlemock/cmake/gmock_main.pc.in` file for underlying linker and include directives.

### What are common causes of version mismatch or ABI incompatibility errors?

- Mixing debug and release libraries, or static vs. shared library variants,
- Using different compiler versions or incompatible compiler flags between GoogleTest and your project,
- Not using the same C++ standard (GoogleTest requires C++17 or above).

Verify:

- Your project and GoogleTest are built with the same standard and runtime settings.
- Consistent usage of shared or static library versions.
- Compiler flags like exception handling and RTTI are consistent.

### Why am I getting threading-related link errors?

If your build environment requires pthreads support, make sure:

- The macro `GTEST_HAS_PTHREAD` is set appropriately (on or off).
- Your compiler and linker include pthread support (`-pthread` flag on Linux).
- If using CMake, this is usually handled automatically when `find_package(Threads)` is used.

### How do I customize compile and link flags for GoogleTest or GoogleMock?

- You can modify build flags via CMake settings like `cxx_strict` and `cxx_no_exception` as seen in `googletest/cmake/internal_utils.cmake`.
- Adjust flags for warnings, exceptions, RTTI, and threading to fit your project's requirements.

---

## Common Issues & Fixes

### Missing Headers

**Symptoms:** Compiler errors reporting `gtest/gtest.h` or `gmock/gmock.h` not found.

**Fix:** Add the correct include paths to your build environment.

### Linker Errors

**Symptoms:** Undefined references for GoogleMock / GoogleTest symbols.

**Fix:** Ensure linking libraries include `gmock_main` or `gmock` with dependencies on `gtest`.

### Conflicting Runtime Libraries on Windows

**Symptoms:** Link errors about runtime library mismatches for Visual Studio builds.

**Fix:** Align the Runtime Library flags (`/MT`, `/MD`) across your project and GoogleTest.

### Version/ABI Incompatibility

**Symptoms:** Mismatches causing runtime crashes or linker complaints.

**Fix:** Rebuild GoogleTest with the same compiler version and flags as your code.

---

## Step-by-Step Troubleshooting Workflow

<Steps>
<Step title="Verify Include Paths">
Check your project's compiler settings to confirm the include directories for GoogleTest and GoogleMock headers are present and correct.
</Step>
<Step title="Check Linked Libraries">
Make sure to link against the appropriate GoogleTest and GoogleMock libraries (`gmock_main` or `gmock` and `gtest`). Adjust linker settings accordingly.
</Step>
<Step title="Validate Compiler Flags">
Confirm consistency in compiler options such as C++ standard version (must be C++17 or higher), exception handling, RTTI, and warning levels.
</Step>
<Step title="Handle Threading Dependencies">
If your tests require threading support, ensure that pthreads are properly linked and the relevant macros are set (`GTEST_HAS_PTHREAD`).
</Step>
<Step title="Test with a Minimal Example">
Try building a minimal test case with `gmock_main` to isolate the issue from your projectâ€™s complexity.
</Step>
<Step title="Consult Build Logs">
Examine verbose compiler and linker logs for detailed clues on missing headers, unresolved symbols, or flag mismatches.
</Step>
</Steps>

---

## Typical Error Messages Explained

- **`fatal error: gtest/gtest.h: No such file or directory`**
  - Cause: Include paths not set.
  - Solution: Add GoogleTest include directory to compiler flags.

- **`undefined reference to 'testing::InitGoogleMock'`**
  - Cause: Missing linkage against GoogleMock libraries.
  - Solution: Link against `gmock_main` or `gmock` and `gtest`.

- **`multiple definition of main`**
  - Cause: Linking both your own `main()` and `gmock_main`.
  - Solution: Either remove your main or link just `gmock` instead of `gmock_main`.

- **`error LNK2038: mismatch detected for 'RuntimeLibrary'` (MSVC)**
  - Cause: Mixing dynamic and static runtime libraries.
  - Solution: Align all projects and libraries to use the same runtime.

- **`pthread related undefined symbols`**
  - Cause: Missing pthread link or macro settings.
  - Solution: Enable pthreads and link with pthread.

---

## References and Configuration Files

- **`googlemock/cmake/gmock_main.pc.in`**
  - Template for pkg-config file illustrating library linkage and compiler flags.

- **`googlemock/README.md` and `googletest/README.md`**
  - Contains instructions on building and linking GoogleTest and GoogleMock.

- **CMake Build Files**
  - See `googlemock/CMakeLists.txt` for build and installation setup details.

- **Sample Main Implementation**

```cpp
// From googlemock/src/gmock_main.cc
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Tips:

- Prefer linking with `gmock_main` to avoid writing your own `main()` unless customization is needed.
- Use CMake options to toggle building tests and shared versus static libraries.
- Leverage CMake's `find_package(Threads)` to handle pthread requirements automatically.

---

## Practical Tips & Best Practices

- Always match compiler flags and runtime libraries between GoogleTest/GoogleMock and your project.
- When integrating GoogleTest via CMake in your project, import targets via `find_package(GTest CONFIG REQUIRED)` and link with the official targets.
- Use `gmock_main` for convenience unless you need a custom `main()`.
- For multithreaded tests, ensure `GTEST_HAS_PTHREAD` is enabled and link pthread as needed.
- Build GoogleTest and GoogleMock with the same compiler and standard version your project uses (C++17 minimum).

## Troubleshooting Additional Issues

<AccordionGroup title="Advanced Troubleshooting Scenarios">
<Accordion title="Build Fails with Missing Symbols in gtest-all.cc">
Sometimes building shows missing symbols related to `gtest-all.cc`. This usually means you're not linking properly against the core `gtest` library or mixing static and shared builds.

- Verify your link order includes `gmock`, `gtest`, and system threading libraries.
- Confirm whether you are building shared or static libraries and don't mix incompatible variants.
</Accordion>
<Accordion title="Link Errors with Exception Handling Disabled">
If your project disables exceptions, ensure that GoogleTest and GoogleMock are also built without exceptions.

- Use the CMake variables or flags to disable exceptions in GoogleTest builds.
- Expect some extended build setup customized per your needs.
</Accordion>
<Accordion title="Using GoogleTest in Cross-Platform Environments">
Hints for Windows, Mac, and Linux:

- On Windows, be mindful with Unicode compilation modes.
- On Unix-like systems, check pthread linkage.
- On embedded or constrained platforms, review conditional setup in `gmock_main.cc`.
</Accordion>
</AccordionGroup>

---

## Getting Additional Help

- Visit the [GoogleTest GitHub repository](https://github.com/google/googletest) for issue tracking and community discussions.
- Consult the [GoogleTest Primer](primer.md) and [Installation guide](guides/getting-started/install-and-setup.md) for foundational setup.
- Read the [Troubleshooting & Common Issues](getting-started/quickstart-and-troubleshooting/troubleshooting-validation.md) for detailed problem-solving.

---

By following the guidance here, users can confidently overcome common build and configuration barriers, ensuring a smooth GoogleTest and GoogleMock setup experience tailored to their C++ testing needs.

---

# Additional Resources
- [GoogleTest Primer](primer.md)
- [Installation and Setup Guide](guides/getting-started/install-and-setup.md)
- [Troubleshooting & Common Issues](getting-started/quickstart-and-troubleshooting/troubleshooting-validation.md)
- [GoogleMock README](googlemock/README.md)
- [CMake Build Instructions](googletest/README.md#build-with-cmake)
