---
title: "Resolving Build and Compilation Errors"
description: "Addresses the most frequent CMake, Bazel, and platform-specific build problems, including linker errors and missing headers. Explains common error messages and how to fix them."
---

# Resolving Build and Compilation Errors

This page addresses the most frequent build problems users encounter with GoogleTest, CMake, Bazel, and platform-specific toolchains. It focuses on linker errors, missing headers, configuration mismatches, and provides clear instructions to identify, diagnose, and fix these issues.

---

## 1. Common Setup and Build Issues

### Why am I getting linker errors related to GoogleTest symbols?

Linker errors typically occur when your project does not link against GoogleTest libraries correctly or mixes incompatible runtime settings.

- **Ensure linking with `gtest` or `gtest_main`**: Your test executable must link with either `gtest` (GoogleTest basic library) or `gtest_main` (which provides a main function for you).
- **CMake Linking Example:**

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(my_tests test1.cpp test2.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

- **Linkage Mismatch on Windows (Visual Studio)**

  GoogleTest defaults to static runtime linkage, but your project might default to dynamic. Mismatch causes linker errors like:
  
  ```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
value 'MTd_StaticDebug' doesn't match value 'MDd_DynamicDebug' in main.obj
```

  To fix this, enable the `gtest_force_shared_crt` option to force GoogleTest to link using the dynamic runtime:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### Why do headers fail to be found during compilation?

- Confirm the include paths contain GoogleTest headers. GoogleTest headers are typically under `<googletest-root>/include`.
- When using CMake, `target_include_directories` or `include_directories` must list the GoogleTest include directories:

```cmake
target_include_directories(my_tests PRIVATE ${gtest_SOURCE_DIR}/include)
```

- Prefer importing `GTest::gtest` or `GTest::gtest_main` targets, which carry include directory info.

### How do I fix C++ standard related errors?

GoogleTest requires C++17 or later. Use:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

in your top-level `CMakeLists.txt`. If your build system does not allow this easily, pass the flag manually, e.g., `-std=c++17`.

### How do I disable building GoogleMock if I only want GoogleTest?

In CMake standalone build of GoogleTest, include `-DBUILD_GMOCK=OFF`:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

This prevents GoogleMock from being built.

---

## 2. Platform-Specific Build Issues

### Linux and Unix-like Platforms

- Ensure pthread support is enabled if you use multi-threaded tests, or define `-DGTEST_HAS_PTHREAD=0` to disable threading.
- Using the CMake script automatically links pthread via `find_package(Threads)`, but in a manual build, you must add `-lpthread`.

### Windows

- When building with Visual Studio, be aware of runtime mismatches (`MT` vs `MD`). Use `gtest_force_shared_crt` option to align runtimes.
- For MinGW, pthreads support varies; preferring to disable pthreads with `-DGTEST_DISABLE_PTHREADS=ON` might help.

### macOS

- With Xcode generated projects, use the `.xcodeproj` provided by GoogleTest's CMake build.

---

## 3. Incorporating GoogleTest Into Existing Projects

### Using GoogleTest as a Subdirectory in CMake

Add GoogleTest's source as a subdirectory in your project's `CMakeLists.txt`:

```cmake
add_subdirectory(path/to/googletest)
add_executable(my_tests test.cpp)
target_link_libraries(my_tests gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

This ensures GoogleTest is built with the same compiler settings.

### Using CMake's FetchContent to Download GoogleTest

CMake 3.14+ supports `FetchContent` to download and build GoogleTest automatically:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # for runtime linkage
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test.cpp)
target_link_libraries(my_tests gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

---

## 4. Common Error Messages and How to Fix Them

### Linker Error: Undefined Reference to `pthread_create`

This indicates missing pthread linkage. Resolve by linking `pthread` explicitly or enabling threading support in build scripts.

### `fatal error: gtest/gtest.h: No such file or directory`

Check whether GoogleTest is installed and whether your compiler's include paths include GoogleTest's `include` directory.

### Runtime Library Mismatch Errors on Windows

Use the `gtest_force_shared_crt` option in CMake or manually align the /MT vs /MD flags between your project and GoogleTest.

### Error: Clang or GCC warnings elevated to errors

GoogleTest uses strict compiler flags including `-Werror`. You may turn off warnings as needed temporarily, but it's better to fix the warnings or adjust your toolchain.

---

## 5. Troubleshooting Steps

1. **Check Compiler Version & C++ Standard:** GoogleTest requires C++17 or later.
2. **Verify Header Include Paths:** Ensure `gtest` headers are visible to your build system.
3. **Ensure Libraries Are Properly Linked:** Link with correct libraries like `gtest`, `gtest_main`, and pthread if needed.
4. **Align Runtime Libraries (Windows):** Match runtime linkage flags between tests and GoogleTest.
5. **Use CMake Targets When Possible:** `GTest::gtest`, `GTest::gtest_main` set up includes and linkages properly.
6. **Consult Build Logs:** Look for specific compiler or linker errors.
7. **Use Verbose Build:** For CMake, use `cmake --build . --verbose` to see full compile/link commands.

---

## 6. Tips and Best Practices

- Prefer building GoogleTest and GoogleMock as part of your main CMake build tree to avoid inconsistencies.
- Use the CMake `add_subdirectory()` or `FetchContent` methods instead of manual copying.
- Enable `gtest_force_shared_crt` on Windows to avoid runtime linkage conflicts.
- Specify `CMAKE_CXX_STANDARD` explicitly to meet GoogleTestâ€™s C++17 requirement.
- Disable pthreads on Windows MinGW using `gtest_disable_pthreads` option when facing threading issues.
- Use `-DBUILD_GMOCK=OFF` if you do not require GoogleMock.
- Always check for compiler warnings and treat them seriously for clean builds.

---

## 7. References and Further Reading

- [GoogleTest README - Generic Build Instructions](https://github.com/google/googletest/blob/main/googletest/README.md#generic-build-instructions)
- [GoogleTest CMakeLists.txt](https://github.com/google/googletest/blob/main/googletest/CMakeLists.txt)
- [Using GoogleTest with CMake](https://github.com/google/googletest/blob/main/googletest/README.md#incorporating-into-an-existing-cmake-project)
- [GoogleTest Primer](primer.md)
- [Troubleshooting Common Setup Issues](getting-started/first-test-and-validation/troubleshooting-common-issues.md)

---

## 8. Troubleshooting Checklist

| Problem                                  | Check                                      | Solution / Notes                      |
|------------------------------------------|-------------------------------------------|-------------------------------------|
| Missing Headers during compile            | Include paths include GoogleTest headers?  | Add `target_include_directories` or `include_directories` if needed.
| Linker errors unresolved symbols          | Linked against `gtest` or `gtest_main`?    | Link target using libraries explicitly.
| Windows runtime mismatch error             | Runtime setting flags (/MT vs /MD) mismatch? | Use `gtest_force_shared_crt` or adjust runtime.
| pthread undefined reference on Linux      | Linked with pthread?                        | Add `-lpthread` or use CMake `find_package(Threads)`.
| C++ standard version error                  | Compiler supports C++17?                   | Set `CMAKE_CXX_STANDARD` to 17 or higher.

---

**Remember**: Most build issues stem from misalignments in include paths, linker settings, or runtime flags. Adhering to recommended CMake integration workflows prevents many common pitfalls.

---