---
title: "I'm getting integration errors with my build system—what should I do?"
description: "Covers frequently seen integration problems with build tools like Bazel and CMake, and provides best practices for resolving linking or configuration issues between GoogleTest/GoogleMock and external projects."
---

# Integration Issues with Build Systems

Integrating GoogleTest and GoogleMock into your build system can sometimes lead to errors or unexpected behaviors. This documentation addresses common integration pitfalls with popular build tools such as Bazel and CMake, and provides best practices and troubleshooting tips to help you resolve linking, configuration, and compatibility issues.

---

## Common Integration Problems

### 1. Missing or Incorrect Linking

- **Symptoms:** Undefined symbols during linking, test binaries fail to build.
- **Causes:** 
  - Not linking against the correct GoogleTest or GoogleMock libraries.
  - Linking against incompatible or outdated versions.
  - Mixing static and dynamic linking inconsistently across targets.

**Solution:** 
- Verify your build script includes `gtest` and/or `gmock` libraries explicitly.
- For CMake, link targets using:

```cmake
find_package(GTest REQUIRED)
target_link_libraries(your_test PRIVATE GTest::gtest GTest::gmock)
```

- For Bazel, make sure your `BUILD` file declares dependencies on `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` appropriately.

### 2. Header and Include Path Issues

- **Symptoms:** Compile errors indicating missing GoogleTest or GoogleMock headers.
- **Causes:**
  - Incorrect or missing include paths.
  - Inconsistent version of headers and linked libraries.

**Solution:**
- Confirm your build system includes the path to GoogleTest’s headers.
- For CMake, use the imported targets which typically handle include directories automatically.
- For Bazel, ensure the `deps` of your targets include GoogleTest targets to propagate includes.

### 3. ABI or Compiler Compatibility

- **Symptoms:** Linking errors or runtime crashes due to incompatible binaries.
- **Causes:**
  - Using precompiled GoogleTest binaries with a different compiler or compiler settings.
  - Building GoogleTest with different ABI settings than your project.

**Solution:**
- Build GoogleTest from source using the same compiler and flags as your project.
- Pay attention to C++ standard versions and ABI compatibility.

### 4. Missing Initialization or Main Function

- **Symptoms:** Linker errors about missing `main` function or runtime crashes.
- **Causes:**
  - Not linking against `gtest_main` or `gmock_main` if relying on the default test main.
  - Defining your own `main` without proper initialization.

**Solution:**
- Use the provided `gtest_main` or `gmock_main` libraries for test binaries that don't define their own `main()`.

```cmake
target_link_libraries(your_test PRIVATE GTest::gtest_main)
```

- Alternatively, include the proper initialization in your main:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 5. Multiple GoogleTest Versions

- **Symptoms:** Linker conflicts, duplicated symbols, or flaky test behavior.
- **Causes:**
  - Multiple versions of GoogleTest or GoogleMock libraries are present in your build or dependencies.

**Solution:**
- Ensure your entire dependency graph uses a consistent GoogleTest version.
- Avoid mixing system-installed versions with vendored or manually built versions.

### 6. Incomplete Mock Definitions or Build Dependencies

- **Symptoms:** Compilation or linking errors on mock classes or methods.
- **Causes:** 
  - Missing or misconfigured mock definitions.
  - Failure to build generated mock sources or include them properly.

**Solution:**
- Confirm you have proper mock headers and source files included in your build.
- For Bazel, ensure `mock_cc_library` declarations are in place.

### 7. Macro and Header Conflicts

- **Symptoms:** Compilation errors due to macro redefinitions or macro collisions.
- **Causes:** 
  - System headers (such as Windows API headers) define macros that clash with GoogleTest or GoogleMock identifiers.

**Solution:**
- Include GoogleTest and GoogleMock headers after problematic system headers.
- Use macro guards or `#undef` to avoid collisions.
- Example in `gmock-spec-builders_test.cc` illustrates handling macro expansion:

```cpp
#define Method MethodW
// Your mock class and tests
#undef Method
```

---

## Best Practices for Smooth Integration

### Use the Provided CMake and Bazel Support

- Leverage `find_package(GTest)` and GoogleTest-provided CMake targets for CMake builds.
- Use the official `@com_google_googletest` Bazel repository and its rules.

### Separate GoogleTest and GoogleMock Dependencies

- Link test executables with both GoogleTest and GoogleMock libraries.
- If you are not using mocking, linking only GoogleTest is sufficient.

### Avoid Mixing Mock and Real Code In Strange Ways

- Mock classes and test code should be clearly separated from production code.
- Keep test-only code in test-specific directories or targets.

### Pay Attention to Compiler and ABI Settings

- Ensure consistent standards (e.g., C++17) and compiler flags.
- Use the same compiler version for GoogleTest and your code.

### Utilize GoogleMock's Provided `gmock_main` for Default Main

- Simplifies test entry point and initialization.
- Prevents linker errors due to missing `main`.

---

## Troubleshooting Checklist

| Problem | Check / Action |
|---------|---------------|
| Undefined symbols during linking | Confirm linkage against correct GoogleTest/GoogleMock libs; rebuild if needed.
| Missing headers | Verify include paths; use proper target dependencies.
| Compiler ABI mismatch | Rebuild GoogleTest with your compiler and flags.
| Multiple GoogleTest versions | Deduplicate your build dependencies.
| Missing `main` function | Link with `gtest_main` or define your own properly.
| Macro conflicts | Use macro guards or reorder includes.
| Mock method not found | Verify correct inclusion and compilation of mocks.
| Unexpected test failures | Run with `--gmock_verbose=info` to trace mock behavior.

---

## Useful References

- [Setting Up and Building Tests Guide](/guides/getting-started/setup-build-integration) - Covers setup and build instructions with CMake and Bazel.
- [Mocking Reference](/api_reference/mocking_and_expectations/creating_mock_objects) - Provides deep insights on mocking declarations and usage.
- [gMock Cookbook](docs/gmock_cook_book.md) - Recipes and best practices for mocks.
- [gMock for Dummies](docs/gmock_for_dummies.md) - Friendly introduction to mocks.
- [FAQs about Integration and Setup](faq/general-questions/finding-documentation) - Help finding documentation and resolving integration issues.

---

## Additional Tips

<Tip>
Run your tests with verbose logging enabled to diagnose integration or behavior issues:

```sh
./your_test_binary --gmock_verbose=info
```

This will print detailed information about mock calls, expectations, and actions.
</Tip>

<Note>
If you encounter specific linker errors, verify that the order of linked libraries respects dependency order (libraries on the left provide symbols to those on the right).
</Note>

<Warning>
Avoid mixing different versions or builds of GoogleTest/GoogleMock in the same project as this can cause subtle runtime errors.
</Warning>

---

Integrating GoogleTest and GoogleMock can be seamless by following the above best practices and troubleshooting steps. For complex build environments, consider consulting your build system's documentation for handling external dependencies and linking nuances.


---

# Frequently Asked Questions

### Why do I get undefined symbol errors when linking my test binary?
Ensure you link against `gtest`, `gmock`, and their respective main libraries (e.g., `gtest_main`, `gmock_main`). In CMake, use the imported targets `GTest::gtest`, `GTest::gmock`, and `GTest::gtest_main`.

### How do I include GoogleMock in Bazel builds?
Add dependency to `@com_google_googletest//:gmock` and optionally `@com_google_googletest//:gmock_main` in your `BUILD` files under `deps`.

### What if my build system finds multiple GoogleTest versions?
Check your build and third-party dependencies for multiple GoogleTest inclusions and enforce a single version. Consider using dependency management tools to control versions.

### How to resolve macro name collisions?
Review included system headers and GoogleMock headers order. Use `#undef` for known conflicting macros before including GoogleMock.

### What compiler flags do I need?
Use consistent C++ standard flags (e.g., `-std=c++17`) and ensure your compiler supports thread-local storage and exceptions, which are required by GoogleTest.

### Why does my GoogleMock test fail even if I used `ON_CALL`?
Recall that `ON_CALL` does not set expectations, it simply defines default behavior. Use `EXPECT_CALL` to assert that a method will be called.


---

For more detailed debugging and integration help, please consult the GoogleTest and GoogleMock official documentation and guides linked above.

---

# Related Documentation

- [Using Mocks in Tests](guides/core-workflows/mocking-techniques) provides practical information on writing and using mocks.
- [Basic Configuration & Project Setup](/getting-started/setup-requirements/basic-configuration) details setting up GoogleTest/GMock in your project.
- [Troubleshooting & Common Setup Issues](/getting-started/first-steps-validation/troubleshooting) outlines common build problems and solutions.
- [Supported Platforms & Dependencies](/overview/feature-architecture-and-integration/supported-platforms-and-dependencies) to confirm environment compatibility.

---