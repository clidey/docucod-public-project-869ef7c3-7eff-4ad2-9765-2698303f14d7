---
title: "How do I troubleshoot failing assertions or tests?"
description: "Guides users on interpreting test output, common assertion mistakes, and using richer output and diagnostics to track the root cause of test failures."
---

# Troubleshooting Failing Assertions and Tests

GoogleTest aims to make testing straightforward and insightful, but occasionally your tests may fail or behave unexpectedly. This guide helps you understand common reasons why assertions or tests fail, how to interpret test output, and how to leverage GoogleTest's richer diagnostics to isolate and fix issues effectively.

---

## Understanding Test Failures

When a test fails, GoogleTest reports detailed information about which assertion failed, where it happened, and why. Knowing how to read and interpret this output is key to troubleshooting.

### Types of Failures

- **Fatal Failures:** Generated by `ASSERT_*` macros and `FAIL()`. They cause the current function to abort immediately.
- **Nonfatal Failures:** Generated by `EXPECT_*` macros and `ADD_FAILURE()`. The current function continues running, allowing multiple failures to be reported.
- **Skipped Tests:** Occur when `GTEST_SKIP()` is invoked or when tests are disabled.

### How to Read Failure Messages

Failure messages show:

- The expression or condition that failed.
- The expected and actual values.
- Source file and line number.
- Optional user-supplied messages streamed with the assertion.
- Stack traces (if enabled) to show the call path leading to failure.

Example of a typical failure:

```
/path/to/file.cc:42: Failure
Expected equality of these values:
  foo
  bar
    Which is: 3
  4
TestBody()
```

This tells you that on line 42, an assertion comparing `foo` and `bar` failed because `foo == 3` but expected `4`.

---

## Common Reasons for Failure

### 1. Incorrect Assertion Usage

- Using `ASSERT_*` in non-void functions can cause confusing errors because they return from the current function.
- Comparing pointers with `EXPECT_EQ` instead of `EXPECT_STREQ` for C-string content.

### 2. Test Fixture Misuse

- Modifying shared state across tests without proper isolation.
- Forgetting to reset or initialize data in `SetUp()`.
- Mixing `TEST` and `TEST_F` in a test suite with incompatible fixtures.

### 3. Naming and Discovery Issues

- Using underscores in test or test suite names.
- Not instantiating `TEST_P` tests (uninstantiated parameterized tests generate failed synthetic tests).
- Disabled tests (`DISABLED_` prefix) not running unless explicitly included.

### 4. Failing Subroutines

- Functions called by tests that themselves cause failures.
- Fatal failures inside helper functions do not terminate the entire test unless handled explicitly.

### 5. Environment and Setup/TearDown Failures

- Failures in `SetUp`, `TearDown`, `SetUpTestSuite`, or `TearDownTestSuite` cause the entire test or suite to be skipped or fail.

---

## Troubleshooting Workflow

Follow these steps to isolate and resolve test failures:

<Steps>
<Step title="Review the Failure Output">
Carefully read the failure messages and source locations reported by GoogleTest.
Verify if the failure is due to an unexpected value, incorrect usage, or setup failure.
</Step>
<Step title="Isolate the Failing Test">
Run the failing test in isolation using the `--gtest_filter` flag:
```
./your_test --gtest_filter=TestSuiteName.TestName
```
This helps confirm if failure depends on test ordering or external factors.
</Step>
<Step title="Inspect Test Fixture and Setup Code">
Check the test fixture's `SetUp` and `TearDown` methods, and the `SetUpTestSuite` and `TearDownTestSuite` static methods (if present) for any side effects or errors.
</Step>
<Step title="Use SCOPED_TRACE for Subroutine Failures">
If failures come from helper functions or subroutines, add `SCOPED_TRACE` at call sites to get per-call trace points included in failure messages.
Example:
```cpp
SCOPED_TRACE("Calling helper with input=" << input_value);
helper_function(input_value);
```
</Step>
<Step title="Check for Uninstantiated Parameterized Tests">
If testing parameterized tests defined by `TEST_P`, ensure instantiation is done with `INSTANTIATE_TEST_SUITE_P` or suppress the warning using `GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST`.
</Step>
<Step title="Verify Assertion Macros Used Properly">
Replace any pointer equality checks on C strings with string comparison assertions (`EXPECT_STREQ` or `EXPECT_STRNE`).
Make sure that your `ASSERT` macros are used in void-returning functions only.
</Step>
<Step title="Consider Using AssertionResult or Predicate-Formatters for Complex Checks">
For complex boolean expressions, write predicates or predicate-formatters that return `AssertionResult` for reliable and informative diagnostics.
</Step>
<Step title="Enable Stack Traces and Rich Output">
Use flags like `--gtest_stack_trace_depth` to include stack traces in failure reports to trace deeper into the failure context.
Enable `--gtest_brief=0` to see successes and failures during test runs.
</Step>
<Step title="Suppress Output or Enable Verbose Output as Needed">
Use `--gtest_brief=1` to suppress passing test output.
Use `--gtest_color` to enable colored output for better visual parsing.
</Step>
</Steps>

---

## Helpful Tips and Best Practices

- Prefer `EXPECT_` macros when possible to continue tests after failure and report multiple failures.
- Use `ASSERT_` macros when failure should abort the current test function.
- Use `RecordProperty()` to log additional context or metrics useful for diagnosis.
- Disable flaky tests with `DISABLED_` prefix and track them separately.
- Use `--gtest_repeat` and `--gtest_shuffle` flags to detect order dependencies or flaky tests.
- If exceptions are enabled, consider setting `--gtest_throw_on_failure` to integrate GoogleTest with external test frameworks.
- For testing private or internal code, use the `FRIEND_TEST` macro to enable access from friend tests.

---

## Example: Making Sense of a Failure Output

Suppose your test produces this output:

```
gtest_unittest.cc:215: Failure
Expected equality of these values:
  n
  5
    Which is: 6
```

Steps to understand & fix:

- Locate line 215 of `gtest_unittest.cc`.
- Review why the variable `n` is 6 instead of expected 5.
- Check the calculation or initialization of `n` in the test.
- If the check occurs inside a helper function called multiple times, consider adding `SCOPED_TRACE` for context.

---

## Common Pitfalls and How to Avoid Them

### Pitfall: Using ASSERT_* in Non-void Functions

If an `ASSERT_*` macro fails inside a non-void function, compiler errors or undefined behavior can result. Always use `EXPECT_*` in such contexts or rewrite the function to return void.

### Pitfall: Failing to Register Parameterized Tests

Declaring `TEST_P` tests without corresponding `INSTANTIATE_TEST_SUITE_P` makes GoogleTest generate synthetic failures. Use `GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST` to suppress or ensure instantiation.

### Pitfall: Comparing C-Strings with EXPECT_EQ

This compares pointers, not string content. Use `EXPECT_STREQ` to compare C-string contents accurately.

### Pitfall: Side Effects in Assertions

All assertion arguments are evaluated exactly once. However, modifying state inside assertions can cause confusing results. Avoid side effects in assertion expressions.

### Pitfall: Misnamed Test Suites or Tests

Avoid underscores in test or suite names to prevent confusion and test discovery issues.

---

## Using GoogleTest Flags for Troubleshooting

You can control test execution and output with flags:

- `--gtest_filter` to run specific tests.
- `--gtest_list_tests` to see available tests.
- `--gtest_repeat` combined with `--gtest_shuffle` to discover flaky or order-dependent tests.
- `--gtest_break_on_failure` to drop into a debugger on failure.
- `--gtest_stack_trace_depth` to control verbosity of stack traces.
- `--gtest_also_run_disabled_tests` to include temporarily disabled tests.

For a full list of flags and details, run your test binary with `--help` or see the [Testing Reference Documentation](docs/reference/testing.md#InitGoogleTest).

---

## Additional Resources

- [GoogleTest Primer](docs/primer.md) — Get started writing and running tests.
- [Assertions Reference](docs/reference/assertions.md) — Detailed docs on assertion macros.
- [Testing Reference](docs/reference/testing.md) — Comprehensive guide to GoogleTest features.
- [Value- and Type-Parameterized Tests](concepts/test-data-and-types/parameterized-tests.mdx) — Learn parameterized tests.
- [Death Tests API](api-reference/core-testing-api/death-tests.mdx) — Help with death test failures.
- [GMock Integration](faq/core-questions/using-googlemock.mdx) — Troubleshooting mocks.

---

## Getting Help

If you have tried the above and still cannot resolve an issue:

- Check the [Common Setup Issues FAQ](getting-started/first-steps-validation/common-setup-issues.mdx).
- Review your build configuration and include paths.
- Search for the error message in the GoogleTest issue tracker.
- Ask for help or report issues on [GoogleTest GitHub](https://github.com/google/googletest).

---

## Summary

When facing failing assertions or tests:

- Carefully read test output for file, line, failed condition, and message.
- Verify the correct usage of assertion macros and fixtures.
- Use tracing and richer diagnostics (`SCOPED_TRACE`, stack traces).
- Check parameterized test instantiation and test filtering.
- Run failing tests in isolation using filters.
- Leverage GoogleTest flags to control execution and gather more info.

With these strategies, you can quickly locate the root cause of failures and build more robust tests.
