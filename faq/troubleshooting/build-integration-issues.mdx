---
title: "Build & Integration Troubleshooting"
description: "Helps users resolve problems integrating GoogleTest/GoogleMock with build systems such as CMake and Bazel, handling compiler errors, missing dependencies, and version conflicts. Offers actionable steps and links to relevant configuration files."
---

# Build & Integration Troubleshooting

This guide helps you resolve common problems encountered while integrating GoogleTest and GoogleMock with build systems such as CMake and Bazel. It covers typical compiler and linker errors, missing dependencies, version conflicts, and configuration pitfalls. You will find actionable, step-by-step solutions along with references to relevant configuration files.

---

## 1. Common Build Problems

### 1.1 Missing or Incorrect Header Files

**Problem:** Compiler errors about missing `gtest/gtest.h` or `gmock/gmock.h` headers.

**Cause:** Headers are not located or included correctly in your project.

**Solution:**

- Verify that your build system points to the correct include directories for GoogleTest and GoogleMock.
- If using **CMake**, ensure that you either:
  - Use `find_package(GTest REQUIRED)` and link target `GTest::gtest` or `GTest::gmock`, or
  - Use `FetchContent` or `add_subdirectory` properly to add GoogleTest and GoogleMock sources.
- For **pkg-config** users, verify the `.pc` files (`gtest.pc`, `gmock.pc`, `gmock_main.pc`) are installed and referenced.

**Example for CMake:**
```cmake
find_package(GTest REQUIRED)
add_executable(my_test test.cpp)
target_link_libraries(my_test GTest::gtest GTest::gmock GTest::gtest_main Threads::Threads)
```

### 1.2 Linking Errors for GoogleMock or GoogleTest Symbols

**Problem:** Linker errors such as undefined references to `gmock` or `gtest` symbols.

**Cause:** Linker is missing required libraries or linking order is incorrect.

**Solution:**

- Ensure you link against `gmock`, `gmock_main`, `gtest`, or `gtest_main` libraries as appropriate.
- For CMake, link targets `GTest::gmock` and `GTest::gmock_main` represent these libraries.
- Link threading libraries when required (e.g., `Threads::Threads`).
- Confirm that the runtime library and compiler flags for GoogleTest/Mock and your project match (static vs shared runtime).

### 1.3 Conflicts Between Shared and Static Runtime

**Problem:** Errors related to runtime library mismatch (e.g., `MT` vs `MD` flags in MSVC).

**Cause:** The project and GoogleTest/GoogleMock are built with different CRT linkage settings.

**Solution:**

- Use the CMake option `gtest_force_shared_crt` to make GoogleTest and GoogleMock use the dynamic runtime library.

Example:
```bash
cmake .. -Dgtest_force_shared_crt=ON
```

- Ensure your project's runtime settings align with GoogleTest's.

---

## 2. Configuration Issues

### 2.1 Pthread Support Not Found or Improper Configuration

**Problem:** Build errors related to pthread missing (especially on Linux or MinGW).

**Cause:** The pthread library isn't linked properly or is unavailable.

**Solution:**

- On UNIX-like systems, verify pthreads are installed.
- In CMake builds, confirm `Threads` package is properly found and linked.
- MinGW native pthread support is not recommended; instead, use Windows threading primitives.

**Remark:** GoogleTest conditionally sets `GTEST_HAS_PTHREAD` macro based on availability and build rules.

### 2.2 Custom Main Function vs GoogleTest/GMock Provided Mains

**Problem:** Multiple definitions of `main()` during linking or missing `main()` errors.

**Cause:** Mixing `gmock_main` or `gtest_main` libraries with your own `main()` function.

**Solution:**

- Use the `gmock_main` or `gtest_main` libraries when you want the prebuilt main (standard Google Test main).
- If you provide your own `main()`, link only `gmock` or `gtest` libraries, omitting the `*_main` ones.

---

## 3. Version Conflicts & Dependency Management

### 3.1 Mismatched Library Versions

**Problem:** Runtime failures or compilation issues due to version mismatches between GoogleTest and GoogleMock.

**Cause:** Libraries and headers from different versions are mixed.

**Solution:**

- Always use matching versions of GoogleTest and GoogleMock.
- When building from source, build both together to ensure version consistency.
- For package managers, confirm version compatibility.

### 3.2 Conflicts Due to Multiple GoogleTest/GoogleMock Copies

**Problem:** Symbol clashes or inconsistent behavior due to multiple versions or duplicates.

**Cause:** Multiple installed copies or interaction between submodules and system-installed packages.

**Solution:**

- Use only one source of GoogleTest/GoogleMock — either embedded as submodules or installed separately.
- Avoid mixing fetched sources with system-installed versions.
- In CMake, prefer `FetchContent_MakeAvailable` with careful target usage.

---

## 4. Troubleshooting Tips & Best Practices

- **Check Compiler Output:** Look for warnings about missing includes or incorrect libraries.
- **Enable Verbose Build Logs:** Run CMake with `--trace` or build tools with verbose flags to see exact compiler/linker commands.
- **Validate Installation:** Use the `quick-validation` guide to verify basic GoogleTest and GoogleMock functionality.
- **Use pkg-config Files:** If using pkg-config, check that `.pc` files such as `gmock.pc` and `gmock_main.pc` have correct paths and references.
- **Synchronize C++ Standards:** Both the test framework and your project must use the same C++ standard, preferably C++17.

---

## 5. Relevant Configuration Files

### 5.1 `gmock.pc.in` and `gmock_main.pc.in`

- These pkg-config template files define installation layout for libraries and includes.
- Ensure that after installation, the `.pc` files in `${CMAKE_INSTALL_LIBDIR}/pkgconfig` correctly reflect your environment paths.

Example snippet from `gmock_main.pc.in`:
```
Name: gmock_main
Description: GoogleMock (with main() function)
Version: @PROJECT_VERSION@
URL: https://github.com/google/googletest
Requires: gmock = @PROJECT_VERSION@
Libs: -L${libdir} -lgmock_main @CMAKE_THREAD_LIBS_INIT@
Cflags: -I${includedir} @GTEST_HAS_PTHREAD_MACRO@
```

### 5.2 `internal_utils.cmake`

- Defines functions that fix compiler flags and create libraries and executables for GoogleTest and GoogleMock.
- Adjusts compiler flags for MSVC, Clang, GCC, and other platforms to ensure compatibility.
- Handles pthread availability and linking.
- Defines helper functions like `cxx_library`, `cxx_executable`, `cxx_test` etc.

---

## 6. Example Workflow for CMake Integration Troubleshooting

<Steps>
<Step title="Verify prerequisites">Ensure your compiler supports C++17 and CMake 3.14 or later is installed.</Step>
<Step title="Configure GoogleTest with CMake">Run `cmake ..` inside build directory, optionally passing `-DBUILD_GMOCK=ON`.</Step>
<Step title="Inspect errors">If header or linking errors appear, check paths and target linkage.</Step>
<Step title="Check pthread support">Confirm Threads package is found and linked correctly.</Step>
<Step title="Review runtime library settings">Ensure both your project and GoogleTest use compatible runtime linking (static or shared).</Step>
<Step title="Validate `main()` function">Confirm you’re linking only one definition of `main()` by choosing either your own or the provided `gtest_main` / `gmock_main` target.</Step>
<Step title="Enable verboseness">Build with verbose output (`make VERBOSE=1` or equivalent) to verify compile and link commands.</Step>
<Step title="Clean and rebuild">Sometimes stale build files cause issues; perform clean build.</Step>
<Step title="Consult logs and docs">If unresolved, consult the troubleshooting guide and ensure your version consistency.</Step>
</Steps>

---

## 7. Additional Resources

- [GoogleTest Installation Guide](../../getting-started/installation-quickstart/install-cmake)
- [GoogleTest Supported Platforms](../../overview/integration-ecosystem/supported-platforms)
- [Using Mock Objects Effectively](../../guides/writing-and-running-tests/using-mock-objects)
- [Mocking API Reference](../../api-reference/core-apis/mocking)
- [Troubleshooting Common Issues](../../getting-started/validation-troubleshooting/common-issues)
- [Platform and Toolchain Support](../../guides/integration-and-troubleshooting/platform-support)

---

<Note>
If underlying problems persist, consider isolating GoogleTest and GoogleMock by building and running their own sample tests before integrating into your codebase. This will help identify whether issues stem from your environment or your project setup.
</Note>