---
title: "Why are my tests not being discovered or executed?"
description: "Addresses common issues where tests do not run, such as misnaming, build flags, or main function problems. Offers tips for troubleshooting registration and test execution, including advice for custom runners."
---

# FAQ: Why are my tests not being discovered or executed?

This page helps you diagnose and resolve common issues that cause your tests to **not run** or **not be discovered** by GoogleTest/GoogleMock. These problems often stem from test registration failures, naming errors, build misconfigurations, or main function problems. You will find practical advice and troubleshooting tips to ensure your tests execute smoothly.

---

## 1. Common Reasons Why Tests Are Not Run

### 1.1 Misnamed Test Functions or Test Suites

GoogleTest discovers tests based on specific macros like `TEST()`, `TEST_F()`, or `TEST_P()`. Tests must be declared with these macros and use proper naming conventions.

- **Test macros must be invoked in global or namespace scope.** Declaring tests inside functions or classes will prevent registration.
- **Test suite and test names should be valid C++ identifiers**, and avoid underscores (although underscores are now generally tolerated, unconventional usage might affect readability or tooling).
- **Using `TEST_F` requires defining a fixture class derived from `testing::Test`.** If the fixture class is missing or not visible at the point of test definition, tests will not register.

### 1.2 Missing or Incorrect Test Registration

- The macros `TEST()`, `TEST_F()`, etc., register tests automatically using static initialization. If you forget to link the test files, or the code is excluded by the linker, your tests will not appear in the test program.
- If using **custom test runners** or nested `main()` implementations, ensure proper invocation of `RUN_ALL_TESTS()`.

### 1.3 Build and Linking Issues

- Building tests incorrectly (e.g., missing compile or link flags) can result in failed test registration.
- Not linking with **`gmock_main`** or similar libraries means your tests may build but not run (see the `main()` function section below).

### 1.4 Incorrect or Missing Main Function

- GoogleTest needs a main function to discover and run tests. Usually, the provided `gtest_main` or `gmock_main` libraries provide a suitable entry point.
- If you write your own `main()` function, you **must** call `testing::InitGoogleTest(&argc, argv);` or `testing::InitGoogleMock(&argc, argv);` before invoking `RUN_ALL_TESTS();`.
- Skipping initialization or calling `RUN_ALL_TESTS()` improperly will cause tests never to run.

---

## 2. Troubleshooting Registration and Execution

Follow these steps to verify whether tests are being discovered and run properly.

### 2.1 Check Test Discovery Output

Run your test binary with the `--gtest_list_tests` flag:

```bash
./your_test_binary --gtest_list_tests
```

This should list all registered tests. If your tests do not show:

- Verify test source files are compiled and linked.
- Check that test macros are used correctly and in appropriate scopes.
- Compile with `-D` flags or debug info to examine registration.

### 2.2 Enable Verbose Mode for More Details

Passing the flag `--gmock_verbose=info` reveals all EXPECT_CALL registrations and matches. This detailed trace can help locate registration mismatches or missing expectations related to mock methods.

### 2.3 Confirm Proper `main()` Function

Ensure either:

- You link with `gmock_main` or `gtest_main` (which provide a proper `main()` function).
- If providing your own main, it calls:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);  // or testing::InitGoogleTest
  return RUN_ALL_TESTS();
}
```

Improper or missing initialization will prevent test execution.

### 2.4 Review Build System and Linker Settings

- Verify that your test target includes all the relevant `.cc` or `.cpp` files.
- Make sure to link against GoogleTest and GoogleMock libraries.
- For Bazel or CMake, confirm the correct rules/packages are used and their dependencies resolved.

---

## 3. Debugging Common Execution Failures

Here are some specific scenarios and how to address them.

### 3.1 Tests Compiled But Not Found at Runtime

- Are test functions wrapped with the proper `TEST` macros?
- Is `RUN_ALL_TESTS()` called?
- Are the tests disabled (e.g. names starting with `DISABLED_`)?

### 3.2 Tests Not Running Due to Multiple Main Functions

- If your project links multiple test files each with their own `main()`, it may lead to linkage conflicts or only one `main()` being selected.
- Use `gtest_main` or `gmock_main` linked from *one* place only.
- Avoid declaring `main()` in multiple test binaries without proper isolation.

### 3.3 Tests Not Running When Using Custom Test Runners

- Ensure your custom runner correctly triggers Googletest test discovery.
- Call `RUN_ALL_TESTS()` appropriately and handle command line arguments.
- Remember `testing::InitGoogleMock()` must run before test startup.

---

## 4. Tips for Custom Runners and Advanced Usage

- Always initialize the GoogleTest/GoogleMock framework explicitly.
- If you bypass `RUN_ALL_TESTS()`, tests will not run.
- For multi-threaded or embedded environments (ESP32, Arduino), use the provided setup and loop functions in `gmock_main.cc`.

---

## 5. Best Practices to Avoid Test Discovery Failures

- Place test definitions in their own source files compiled and linked into the test binary.
- Use standard test macros (`TEST()`, `TEST_F()`, `TEST_P()`) and do not alter their behavior.
- Avoid conditional compilation that excludes test code unexpectedly.
- Use tools like `--gtest_list_tests` regularly to check test registration.
- Keep your main function simple and use `gmock_main` or `gtest_main` when possible.

---

## 6. Examples

### 6.1 Basic Main Function Example

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 6.2 Using `gmock_main` Library

Instead of writing `main()`, link your tests with `gmock_main` which provides a default main. Your CMake or Bazel target might specify:

```cmake
TARGET_LINK_LIBRARIES(your_test_target gmock_main)
```

### 6.3 Running Test Discovery

```bash
./your_test_binary --gtest_list_tests
```

You should see output like:

```
MyTestSuite.
  MyTest1
  MyTest2
AnotherTestSuite.
  TestA
```

If empty, tests are not properly registered.

---

## 7. Troubleshooting Custom Runners

If you implement a custom runner or embedding tests in special environments:

- Make sure to call `testing::InitGoogleMock()` or `testing::InitGoogleTest()` once before tests execute.
- Use `RUN_ALL_TESTS()` to trigger the registered tests.
- For async or threaded environments, coordinate test execution accordingly.
- Avoid multiple initializations or multiple invocations of `RUN_ALL_TESTS()`.

---

## 8. Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) — fundamental guide for writing and running tests
- [GoogleMock for Dummies](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md) — introduction to mocking
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md) — detailed reference for mocks
- [gmock_main.cc source](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc) — standard main function implementation
- [Troubleshooting Setup](https://github.com/google/googletest/blob/main/getting-started/first-test-run/troubleshooting-setup.md) — guide for early-stage issues

---

<Tip>
When stuck, use the command line flag `--gtest_list_tests` to confirm test discovery.
Combine with `--gmock_verbose=info` for detailed mock expectation tracing.
</Tip>

<Warning>
Never omit `RUN_ALL_TESTS()` or initialization calls in your main function, or no tests will run.
Ensure your test files are compiled and linked into your test executables.
</Warning>
