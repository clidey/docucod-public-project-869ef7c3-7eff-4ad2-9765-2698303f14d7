---
title: "Optimizing Test Performance"
description: "Shares recommended practices for improving test suite speed, such as minimizing unnecessary setup, using test filters, and leveraging parallel execution options. Equips users with methods to keep test feedback fast and actionable."
---

# Optimizing Test Performance

GoogleTest offers extensive functionality for testing C++ code, but as test suites grow, keeping test runs fast and feedback actionable is crucial. This page delivers proven strategies to optimize your GoogleTest test suite's execution speed. By minimizing unnecessary setup, focusing test runs, and leveraging parallelism, you'll maximize productivity and responsiveness during development.

---

## Why Focus on Test Speed?

Slow tests are a productivity killer. Waiting several seconds or minutes to verify a small code change disrupts the developer flow and encourages shortcuts like skipping tests. Optimizing test performance means keeping feedback cycles tight, revealing issues quickly, and allowing frequent and confident verification.

Imagine you have 1000 tests and the test run currently takes 10 minutes. Cutting that to under a minute enables iterative development, immediate bug detection, and resource savings.


## Practical Techniques for Speeding Up Your Tests

### 1. Minimize Unnecessary Setup

#### Prefer `SetUpTestSuite()` Over per-test `SetUp()` When Possible

If multiple tests share expensive setup (e.g., opening a database, loading fixtures), move such work into the **static** `SetUpTestSuite()` method of your fixture class. This way, the setup runs once before all tests in a suite rather than before each individual test.

```cpp
class MyFixture : public testing::Test {
 public:
  static void SetUpTestSuite() {
    // Expensive one-time setup
  }
  static void TearDownTestSuite() {
    // Cleanup
  }

  void SetUp() override {
    // Lightweight per-test setup
  }

  void TearDown() override {
    // Lightweight per-test cleanup
  }
};
```

**Tip:** Ensure tests do not mutate shared state in a way that breaks test isolation.


### 2. Use Test Filters to Run a Subset

GoogleTest supports filtering tests by name using the flag `--gtest_filter` or environment variable `GTEST_FILTER`. Use this to run only relevant tests during iterative development or CI runs.

Examples:

- Run tests in a suite: `--gtest_filter=MyTestSuite.*`
- Exclude slow tests: `--gtest_filter=-*SlowTest`

This focused execution reduces elapsed time dramatically by not running unrelated or expensive test cases.

### 3. Leverage Test Sharding (Parallel Execution)

Distribute tests across multiple machines or processes using GoogleTest's sharding support. When the environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` are set, GoogleTest runs only the subset of tests assigned to the particular shard.

This enables horizontal scaling, slicing large test suites into partitions that run concurrently.

### 4. Use Test Repetition and Shuffling to Detect Flakiness

Though not a direct speed optimization, `--gtest_repeat` combined with `--gtest_shuffle` help uncover flaky tests that can cause slowdowns or nondeterministic failures. Fixing those tests usually improves test reliability and throughput.

### 5. Avoid Unnecessary Test Failures

Unexpected failures cause GoogleTest to stop or skip tests (based on fail-fast flags). Review failing tests to avoid cascading failures that waste time. Use `EXPECT_` macros when you want tests to continue despite failures.

### 6. Disable Tests Temporarily to Shorten Runs

Prefix slow or broken tests with `DISABLED_` to exclude them from runs but keep them compiled in. Use the `--gtest_also_run_disabled_tests` flag to run them optionally.


## Example Optimized Workflow

```bash
# Build test executable (optionally using CMake)
cmake -S . -B build
cmake --build build

# Run all tests with sharding (e.g. shard 0 of 4)
GTEST_TOTAL_SHARDS=4 GTEST_SHARD_INDEX=0 ./my_tests

# Run only tests matching MyFeature
./my_tests --gtest_filter=MyFeature.*

# Repeat tests 10 times to catch flakiness
./my_tests --gtest_repeat=10

# Run disabled tests selectively
./my_tests --gtest_also_run_disabled_tests

```


## Best Practices Summary

| Recommendation                         | Benefit                                        |
|--------------------------------------|------------------------------------------------|
| Use `SetUpTestSuite()`/`TearDownTestSuite()` for expensive setup | Setup cost amortized across suite tests            |
| Use `--gtest_filter` to focus test runs | Save time during development or CI                |
| Employ sharding (`GTEST_TOTAL_SHARDS`) for parallel test execution | Scale across machines for faster runs              |
| Disable flaky/slow tests temporarily with `DISABLED_` prefix | Keep suite lean and fast during development        |
| Use `EXPECT_` Macros when test can continue despite failure | Avoid cascading failures that dilute feedback speed |


## Troubleshooting Common Performance Issues

<AccordionGroup title="Common Performance Issues">
<Accordion title="Tests Running Too Slowly">
Evaluate if costly setup/teardown is done per test. Move expensive init to `SetUpTestSuite()`. Check long-running external dependencies or heavy test data.
</Accordion>
<Accordion title="Flaky Tests Slowing Runs">
Use `--gtest_repeat` to identify flaky tests. Address race conditions, shared state, or timing dependencies.
</Accordion>
<Accordion title="Many Disabled Tests Warning">
GoogleTest warns when many tests are disabled; consider fixing or permanently removing stale disabled tests.
</Accordion>
<Accordion title="Sharding Misconfiguration">
Ensure environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` are consistent and valid. See warning messages for guidance.
</Accordion>
</AccordionGroup>


## Additional Tips & Flags

- `--gtest_fail_fast`: stop test execution on the first failure to save time during debugging.
- `--gtest_repeat=N`: repeat tests to catch intermittent bugs.
- `--gtest_print_time=0`: suppress elapsed time output if distracting.
- `--gtest_brief=1`: print only failures to reduce verbose output.


## Related Documentation

- [Writing and Running Unit Tests](/guides/core-workflows/writing-unit-tests)
- [Performance Optimization Tips](/guides/best-practices-integration/performance-tips)
- [Advanced GoogleTest Topics](/docs/advanced)
- [Test Definition and Execution](/api-reference/core-testing-api/test-definition-and-execution)

Explore the [Testing Reference](https://github.com/google/googletest/blob/main/docs/reference/testing.md) for detailed commands and options.


---

## Summary

This page helps you optimize GoogleTest performance through efficient setup, filtering, sharding, and best practices, turning slow test runs into fast feedback cycles. Use suite-level setup, test filters, parallel execution, and careful test management to keep your development and CI processes speedy and reliable.

---

<Tip>
Maximize test speed to unlock quicker feedback loops and reduce developer downtime. Tool flags and test suite structuring are your primary levers.
</Tip>