---
title: "Using Assertions and Matchers"
description: "Clarifies common points of confusion about the assertion macros, difference between fatal and non-fatal failures, and how to work with built-in and custom matchers. Provides practical tips to help users choose and implement the correct assertions for their tests."
---

# Using Assertions and Matchers

This page clarifies common points of confusion about GoogleTest's assertion macros, explains the difference between fatal and non-fatal failures, and guides you in working with built-in and custom matchers. It provides practical tips to help you choose and implement the correct assertions for your tests effectively.

---

## 1. Understanding Assertion Macros

GoogleTest provides a rich set of assertion macros to verify conditions in your code. Each macro comes in two variants:

- **EXPECT_***: Generates a **non-fatal failure** and allows your test function to continue running.
- **ASSERT_***: Generates a **fatal failure** and immediately aborts the current test function.

### When to Use EXPECT_ vs ASSERT_

- Use `EXPECT_` macros when the test can continue after a failure to catch multiple faults in one run.
- Use `ASSERT_` macros when a failure would make further steps meaningless or cause crashes.

### Basic Examples

```cpp
EXPECT_TRUE(condition) << "Condition failed, but test keeps running";
ASSERT_EQ(expected_value, actual_value) << "Fatal: test stops here if false";
```

All assertion macros support streaming diagnostics with the `<<` operator to provide detailed failure messages.

---

## 2. Fatal vs Non-Fatal Failures

Understanding the difference is key to writing effective tests:

| Failure Type   | Description                                                   | Effect on Test                                                |
|---------------|----------------------------------------------------------------|--------------------------------------------------------------|
| Fatal         | Stops current test immediately                                 | Remaining code in test *not* executed; test marked as failed |
| Non-fatal     | Records failure but allows test to continue running           | Multiple failures can be seen in one test run                 |

---

## 3. Assertion Macros Overview

### Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Verify *condition* is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Verify *condition* is false.

### Binary Comparisons

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`: Verify `val1 == val2`.
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`: Verify `val1 != val2`.
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)`: Verify `val1 < val2`.
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)`: Verify `val1 <= val2`.
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)`: Verify `val1 > val2`.
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)`: Verify `val1 >= val2`.

### String Comparisons

These compare **C strings by content** (otherwise, pointers are compared):

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)`
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)`
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)` (case-insensitive)
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)` (case-insensitive not equal)

### Floating Point Comparisons

Due to precision issues, exact equality is not recommended. Use:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)`
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)`
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`

---

## 4. Using Matchers with EXPECT_THAT and ASSERT_THAT

Matchers allow expressive assertions on the structure and contents of objects.

### What Are Matchers?

Matchers encapsulate logic to verify if a value meets a given property. GoogleTest integrates with GoogleMock’s flexible matchers, allowing rich assertions.

### Basic Usage

```cpp
#include <gmock/gmock.h>

using ::testing::StartsWith;
using ::testing::HasSubstr;
using ::testing::AllOf;

EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_string, AllOf(HasSubstr("world"), StartsWith("Hello")));
```

Matchers enable readable, precise checks and produce detailed failure messages for easier debugging.

### Commonly Used Built-in Matchers

- `_` — wildcard, matches any value
- `Eq(val)` — equals value
- `Ne(val)` — not equals value
- `Lt(val)`, `Le(val)`, `Gt(val)`, `Ge(val)` — numeric comparisons
- `IsNull()`, `NotNull()` — pointer matches
- `ElementsAre(...)`, `Contains(...)` — container contents
- `Field(&Class::member, matcher)` — member matching
- `Property(&Class::method, matcher)` — getter method matching
- `Truly(predicate)` — custom predicate matcher

Explore the [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md) for the full list.

### Writing Custom Matchers

Define a matcher easily with `MATCHER(name, description)` or parameterized forms `MATCHER_P`, `MATCHER_P2`, etc., allowing reusable, expressive validation logic. Example:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }

EXPECT_THAT(value, IsEven());
```

---

## 5. Choosing the Right Assertion or Matcher

### Use Simple Assertions When:
- The check is straightforward (e.g., equality, boolean condition).
- You want fast failure on first check (`ASSERT_` variants).

### Use Matchers and `EXPECT_THAT` When:
- You want expressive, readable checks that describe complex conditions.
- You want better failure messages explaining mismatches in detail.
- Matching containers, fields, or custom validation logic.

### Combining Assertions and Matchers

You can mix both styles as needed. For example:

```cpp
EXPECT_EQ(expected_value, actual_value);
EXPECT_THAT(container, ElementsAre(1, 2, 3));
```

---

## 6. Practical Tips and Best Practices

- **Always specify expectations clearly:** Avoid overly strict expectations that make tests brittle.
- **Use `EXPECT_` unless a test cannot proceed:** Failures from `ASSERT_` will skip remaining checks.
- **Use wildcard `_` matcher for uninteresting arguments:** Don’t overspecify argument matching.
- **Suppress warnings on uninteresting mock calls:** Use `NiceMock<T>` for mocks when you don't care about all calls.
- **Avoid unnecessary `EXPECT_CALL` to silence warnings:** Instead, add `EXPECT_CALL(...).Times(AnyNumber())` if you want to allow calls without error.
- **Write custom matchers to simplify complex argument checks:** This keeps tests clean and expressive.

---

## 7. Troubleshooting Common Issues

- **Unrecognized matcher type or misuse:** Verify you’ve included `<gmock/gmock.h>` and are using the correct matcher types.
- **Mismatch in matcher parameter types:** Consider `SafeMatcherCast<T>(m)` to convert matchers safely.
- **Ambiguous overloaded method matches:** Use argument lists with explicit types or `Const()` wrapper for const overloads.
- **Unexpected test failures from assertion macro misuse:** Remember that `ASSERT_` aborts the test and `EXPECT_` continues.

---

## 8. Additional Resources

- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md) — Complete list and details of assertion macros.
- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md) — Extensive description of built-in and custom matchers.
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) — Recipes for using mocks, expectations, actions, and matchers effectively.
- [Organizing and Running Tests](../guides/getting-started/organizing-tests.md) — Practical advice on structuring tests.
- [Setting Expectations and Verifying Interactions](../guides/mocking-in-action/setting-expectations.md) — How to set up `EXPECT_CALL` and work with mocks.

---

Use this page to deepen your understanding of assertion selection and matcher usage to write tests that are robust, clear, and informative.

---

**Example: Writing an assertion with a matcher**

```cpp
using ::testing::HasSubstr;
using ::testing::StartsWith;

// Check if an error message contains "timeout" and starts with "Error"
EXPECT_THAT(error_message, AllOf(StartsWith("Error"), HasSubstr("timeout")));
```

---

**Example: Custom matcher for even numbers**

```cpp
MATCHER(IsEven, "is an even number") {
  return (arg % 2) == 0;
}

EXPECT_THAT(value, IsEven());
```

---

**Example: Using fatal assertion**

```cpp
ASSERT_NE(pointer, nullptr) << "Pointer must not be null";
// safe to dereference pointer here because fatal on null
EXPECT_EQ(*pointer, expected_value);
```

---

**Troubleshooting tip: Unexpected mock failure**

If you get failures due to "uninteresting call" warnings or unexpected mock calls, consider:

- Using `NiceMock<T>` if you want to suppress warnings for uninteresting calls.
- Adding appropriate `EXPECT_CALL`s to specify expected interactions.


---