---
title: "How do I resolve build or linker errors?"
description: "A comprehensive troubleshooting guide for the build process, including missing symbols, library incompatibilities, and conflicts between GoogleTest/GoogleMock components. Includes diagnostic strategies and references to typical configuration adjustments."
---

# How do I resolve build or linker errors?

A successful GoogleTest/GoogleMock setup depends heavily on proper build and linking configuration. This guide helps you diagnose and fix common build-time issues such as missing symbols, library incompatibilities, and conflicts involving GoogleTest and GoogleMock components. By following practical diagnostic strategies and typical configuration adjustments, you will be able to establish a robust build environment for your tests.

---

## 1. Understanding the GoogleTest/GoogleMock Build Components

GoogleTest and GoogleMock are distributed as separate libraries:

- **GoogleTest (`gtest`)**: The core testing framework.
- **GoogleMock (`gmock`)**: Extends GoogleTest with mock object support.
- **gmock_main**: A convenience library including `gmock` plus a main function.

Your test binaries generally need to link against one or more of these libraries, depending on your test setup.

---

## 2. Common Causes of Build and Link Errors

### 2.1 Missing Symbols or Undefined References

- Ensure you link against **both** GoogleMock and GoogleTest libraries when using mocks.
- Linking only `gmock` but missing `gtest` will cause undefined references because `gmock` depends on `gtest`.
- If using `gmock_main`, link only against `gmock_main` as it includes both `gmock` and `gtest`.

### 2.2 Library Incompatibilities

- Ensure consistent compiler, compiler flags, and runtime library settings between your test and GoogleTest/GoogleMock libraries.
- Mixing debug and release builds or static vs shared runtimes (especially on Windows) often cause linker errors.

### 2.3 Duplicate Symbols or Multiple Definition Errors

- Avoid linking the same library twice in different forms (e.g., static and shared).
- If using shared libraries, ensure `GTEST_LINKED_AS_SHARED_LIBRARY=1` is defined appropriately.

### 2.4 Missing Headers or Incorrect Include Paths

- Verify include directories point to GoogleTest and GoogleMock headers.
- GoogleMock’s CMake config will include GoogleTest source if found.

---

## 3. Diagnostic Strategies

### 3.1 Verify CMake Build Setup

If you are using CMake, confirm the following:

- Subdirectory inclusion uses the correct relative paths for GoogleTest and GoogleMock source directories.
- Link your test executables against the correct targets: `gtest`, `gmock`, or `gmock_main`.
- Check for definitions such as `BUILD_SHARED_LIBS` and `GTEST_LINKED_AS_SHARED_LIBRARY` compatibility.
- Make sure the compiler and linker flags are consistent with GoogleTest's recommended settings (see `config_compiler_and_linker()` in `googletest/cmake/internal_utils.cmake`).

### 3.2 Enable Verbose Build Logs

- Use verbose mode in your build system to reveal the exact compiler and linker commands.
- Check for missing library links or incorrect paths.

### 3.3 Check for Platform-Specific Nuances

- On Windows/MSVC, mismatched runtime linkage (static vs dynamic CRT) is a common issue.
- On POSIX, missing `-pthread` may cause linking errors.

### 3.4 Build and Test Minimal Examples

- Create the smallest test code linking only to essential libraries to isolate problems.

---

## 4. Typical CMake Configuration Patterns

Here is a recommended pattern for integrating GoogleMock (which includes GoogleTest) using CMake:

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyTests)

# Optionally set BUILD_SHARED_LIBS ON or OFF
# add_subdirectory(path/to/googletest)

add_subdirectory(path/to/googlemock)  # GoogleMock includes GoogleTest

add_executable(my_tests test_main.cc my_tests.cc)

# Link against gmock_main to get mocks and main() auto-included
target_link_libraries(my_tests PRIVATE gmock_main)
```

**Important:**

- Link **either** `gmock_main` OR **both** `gmock` and `gtest`. Linking only one but not the other leads to missing symbols.
- `gmock_main` includes `gmock` and `gtest` plus a `main()`;
  link `gmock_main` if you do not supply your own main.

---

## 5. Tips for Common Issues

### 5.1 Missing `main()` Symbol

- Link with `gmock_main` or `gtest_main` to get the GoogleTest main function.
- Alternatively, provide your own main function calling `::testing::InitGoogleMock` or `::testing::InitGoogleTest` followed by `RUN_ALL_TESTS()`.

### 5.2 Link Errors About pthread

- Add `Threads::Threads` to your target’s linking libraries in CMake.
- Ensure `-pthread` is being passed to both compiler and linker.

### 5.3 Static vs Shared Libraries

- Consistent `BUILD_SHARED_LIBS` option across all build components.
- If using shared libraries, define `GTEST_LINKED_AS_SHARED_LIBRARY=1` when compiling your tests.

### 5.4 Conflicting Compiler Flags

- Use the flag configuration from `googletest/cmake/internal_utils.cmake` for warnings, exceptions, and RTTI.

---

## 6. Example Build Command

Here’s an example to build a GoogleMock test executable using CMake:

```bash
mkdir build && cd build
cmake .. -DBUILD_GMOCK=ON -DBUILD_SHARED_LIBS=OFF
make
```

Then link your executable to `gmock_main`. If you encounter linking errors, double-check the library dependencies and your own compile flags.

---

## 7. Additional Diagnostic Tools

- Use `ctest` to run and filter tests, which helps confirm link correctness.
- Run GoogleMock’s own suite tests (enable `gmock_build_tests` in CMake) to validate the build environment.

---

## 8. Summary Checklist

- [x] Correctly include GoogleMock and GoogleTest source directories.
- [x] Link test executables against `gmock_main` or `gmock` + `gtest`.
- [x] Ensure compiler flags and runtime linkage (static/dynamic) are consistent.
- [x] Define `GTEST_LINKED_AS_SHARED_LIBRARY` if using shared libraries.
- [x] Add `Threads::Threads` (or `-pthread`) when needed.
- [x] Avoid mixed library types (static/shared).
- [x] Provide or link to a `main` function.
- [x] Use verbose build output and compiler diagnostics to spot missing dependencies.
- [x] Use minimal example targets to isolate build issues.

---

## 9. References

- [GoogleMock CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt) — official CMake build script
- [Configuring compiler and linker](https://github.com/google/googletest/blob/main/googletest/cmake/internal_utils.cmake) — recommended compiler flag settings
- [Getting Started - Installation with CMake](../getting_started/requirements_installation/installing_via_cmake)
- [GoogleTest Primer](../overview/getting-started-intro/what-is-googletest)
- [Quick Validation & Troubleshooting](../getting_started/configuration_initial_success/quick_validation_troubleshooting)

---

## 10. Troubleshooting Examples

<AccordionGroup title="Common Build and Link Error Scenarios">
<Accordion title="Undefined reference to gtest symbols when linking to gmock">
This happens when you link only `gmock` but not `gtest`.

**Fix:** Link with both `gmock` and `gtest` or switch to using `gmock_main`.
</Accordion>
<Accordion title="Multiple definition errors for GoogleTest symbols">
Likely caused by linking against both static and dynamic versions of the libraries or including sources multiple times.

**Fix:** Ensure your build links either static libraries or shared consistently, avoid duplicate object files in link commands.
</Accordion>
<Accordion title="Link errors about pthread or threading symbols">
Often the pthread library is missing from your linker command.

**Fix:** In CMake, link with `Threads::Threads` or manually add `-pthread` to both compiler and linker flags.
</Accordion>
<Accordion title="Missing main() symbol errors">
Occurs if your test binary does not link against `gtest_main` or `gmock_main` and you did not provide your own main.

**Fix:** Link with `gmock_main` or provide a main function that calls `INIT` and `RUN_ALL_TESTS()`.
</Accordion>
</AccordionGroup>

---

## 11. Summary

Build and linking errors in GoogleTest and GoogleMock setups usually stem from incorrect library linking, mixing incompatible compiler or linker flags, missing pthread linkage, or duplicated/missing `main()` functions. Careful configuration of build system (preferably CMake with recommended scripts), consistent compile/link settings, and linking against proper targets (`gmock_main` or `gmock + gtest`) are essential to resolving these issues. Use verbose build outputs and minimal test binaries for isolating problems.

---