---
title: "Mocking Basics and Best Practices"
description: "Covers frequent questions about using mock objects, setting up expectations, and understanding mock syntax. Guides users on how to define mock methods and use them effectively in tests."
---

# Mocking Basics and Best Practices

This FAQ page covers essential questions and guidance for writing and using mock objects in GoogleTest and GoogleMock. It specifically addresses how to define mock methods, set expectations, use mock syntax properly, and best practices for effective mocking.

---

## Frequently Asked Questions

### What is a Mock Object, and How Do I Define One?
A mock object simulates the behavior of a real object in tests, enabling you to verify interactions and control behavior. To define mocks, inherit from an interface (abstract class) and use the `MOCK_METHOD` macro to declare the methods you want to mock in public scope, even if the original methods are protected or private.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Transform, (Gadget* g), (override));
  MOCK_METHOD(void, Resume, (), (override));  // Must be public
  MOCK_METHOD(int, GetTimeOut, (), (override));
};
```

### How Should I Handle Mock Methods with Complex Arguments Containing Commas?
When argument types contain commas (e.g., `std::pair<bool, int>`), you must wrap that type with extra parentheses or use a type alias to prevent parsing errors by the `MOCK_METHOD` macro.

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

### How Can I Mock Overloaded Methods?
GoogleMock lets you mock overloaded functions by declaring `MOCK_METHOD` for each overload with the exact signature and qualifiers. If you mock only some overloads, use `using BaseClass::MethodName;` to bring others into scope and avoid hiding them.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));
  using Foo::Add;  // To avoid hiding other overloads
};
```

### What Is the Recommended Practice for Uninteresting Calls?
If you do not care about some mock methods being called, do not specify expectations for them. By default, an uninteresting call generates a warning but does not fail the test. To suppress warnings, use `NiceMock<MockClass>` which silences uninteresting call warnings, or specify `.Times(AnyNumber())` for those methods.

### When Should I Use `ON_CALL` vs `EXPECT_CALL`?
`ON_CALL` sets the default behavior of mock methods but does NOT expect any calls to be made. Use it for setting up harmless defaults.
`EXPECT_CALL` sets an expectation that the method **will be called** with specified arguments and timesâ€”it verifies the interaction.

Use `ON_CALL` to establish defaults in the setup phase and write selective `EXPECT_CALL`s in your tests to verify calls. Avoid overusing `EXPECT_CALL` as it can make tests brittle.

### How Are Multiple Expectations with Overlapping Matchers Resolved?
GoogleMock evaluates matching expectations in **reverse order** of their declaration, selecting the latest matching expectation first. This lets you define broad catch-all expectations early and more specific ones later.

Example:
```cpp
EXPECT_CALL(turtle, GoTo(_, _)).Times(AnyNumber());
EXPECT_CALL(turtle, GoTo(0, 0)).Times(2);
```
Here, calls to `GoTo(0, 0)` will match the second expectation first, which expects exactly two calls.

### How Do I Control the Number and Order of Expected Calls?
Use the following clauses with `EXPECT_CALL` to fine tune:

- `.Times(n|AnyNumber()|AtLeast(n)|Between(m, n))` to specify call counts.
- `.InSequence(seq...)` or create an `InSequence` object to enforce call order.
- `.After(expectations...)` to require calls happen after specified ones.
- `.WillOnce(action)` and `.WillRepeatedly(action)` to define behaviors for each call.

### What Are Nice, Naggy, and Strict Mocks?
- **NaggyMock (default):** Warns on uninteresting calls but does not fail the test.
- **NiceMock:** Suppresses warnings on uninteresting calls.
- **StrictMock:** Treats any uninteresting call as a test failure.

Use **NiceMock** to keep test output clean, **NaggyMock** for debugging, and reserve **StrictMock** only if you want to enforce strict interaction contracts.

### How Do I Return Different Values or Perform Different Actions on Multiple Calls?
Chain multiple `WillOnce()` clauses to specify the behavior on successive calls, optionally followed by a `WillRepeatedly()` clause for all further calls.

```cpp
EXPECT_CALL(foo, Bar())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### How Can I Delegate to Real or Fake Implementations?
If you already have a fake or real implementation for an interface, you can delegate mock calls to it using `ON_CALL` with lambda expressions.

```cpp
ON_CALL(mock_foo, DoThis).WillByDefault([&real_foo](int n) { return real_foo.DoThis(n); });
```

### What Are Common Pitfalls to Avoid?
- Not declaring virtual destructors on base classes.
- Defining mock methods in non-public sections.
- Over-specifying expectations causing brittle tests.
- Forgetting to set expectations before calling mocked methods.

---

## Best Practices Tip

- Favor simplicity in expectations; verify only what's necessary.
- Use `ON_CALL` to set default behaviors and `EXPECT_CALL` to verify specific calls.
- To avoid noisy warnings, use `NiceMock` when you don't care about all calls.
- Use sequences to specify required call ordering.
- Annotate mocks with descriptive `Description()` to improve test diagnostics.
- Always confirm that your mock methods are declared `override` when overriding.

---

## Troubleshooting Common Issues

### My Mock Method Is Called But I Get Unexpected Call Errors
- Confirm expectations were set before calls.
- Match argument matchers correctly; use wildcards (`_`) if unsure.
- Check call order constraints if such are set.
- Use the `--gmock_verbose=info` flag to see detailed call matching logs.

### I Get Warnings About Uninteresting Calls
- This means calls are made on mock methods without expectations.
- Use `NiceMock` to suppress warnings if these calls are acceptable.
- Alternatively, add `.Times(AnyNumber())` expectations to declare you allow these calls.

### How Do I Mock Const Methods or Overloads?
- Use `MOCK_METHOD` with `(const, override)` qualifiers for const methods.
- Specify full argument lists to disambiguate overloads.
- Use `Const()` wrapper to set expectations on const overloads.

### My Mock Fails to Compile When Overloading Methods
- Use `using BaseClass::MethodName;` inside your mock class to bring hidden base methods into scope.

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Practical mocking recipes and detailed explanations.
- [Mocking Reference](reference/mocking.md): Detailed API information on mocks, expectations, and actions.
- [Matchers Reference](api_reference/core_assertions_matchers/matchers_reference.mdx): List of argument matchers to use in expectations.
- [Actions and Invocations](api_reference/mocking_framework/actions_and_invocations.mdx): Actions to define mock behavior.
- [Keyword Summary and Cheat Sheet](docs/gmock_cheat_sheet.md): Quick reminders of mock-related macros and idioms.

---

For related learning, users may start with:
- [Introduction to Mocking](guides/getting-started/introduction-to-mocking.mdx)
- [Effective Mocking Techniques](guides/core-workflows/mocking-techniques.mdx)
- [Writing Your First Test](guides/getting-started/writing-first-test.mdx)

---

<Note>
Always declare your mock methods in the public section, even when mocking protected or private methods from base classes.
</Note>
<Check>
Verify you set expectations before invoking mock methods. Setting expectations after the call leads to undefined behavior.
</Check>
<Tip>
Use `NiceMock` to suppress uninteresting call warnings in tests where you do not want to verify all calls.
</Tip>