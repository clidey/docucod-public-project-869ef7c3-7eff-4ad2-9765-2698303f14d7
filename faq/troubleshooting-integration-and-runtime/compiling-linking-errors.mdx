---
title: "How do I fix compiling or linking errors with GoogleTest/GoogleMock?"
description: "Explains common causes and solutions for build problems, such as missing headers, ABI mismatches, and undefined references during linking. Provides direction on integrating with various build systems."
---

# How do I fix compiling or linking errors with GoogleTest/GoogleMock?

This page addresses common build issues encountered when compiling or linking GoogleTest and GoogleMock, such as missing headers, ABI mismatches, and undefined references. It guides you through typical causes and offers actionable solutions to ensure smooth integration with CMake and other build systems.

---

## Common Causes of Build Errors

### 1. Missing Headers or Source Files

Build failures often occur because the compiler cannot locate GoogleTest/GoogleMock headers or sources. This happens if your build system isn’t correctly pointed to the installed or included directories.

### 2. ABI Incompatibilities

Link errors may arise due to mismatch in how GoogleTest libraries and your project are built, especially on Windows when mixing static/dynamic runtimes or different compiler flags.

### 3. Undefined References to GoogleTest/GoogleMock Symbols

If the linker complains about missing symbols, it usually means that the necessary GoogleTest/GoogleMock libraries are not linked or linked in the wrong order.

### 4. Multi-threading Support Issues

GoogleTest’s pthread support (on *nix) or threading setup can cause linking failures if the pthread flags are missing or incorrectly specified.

---

## Step-by-Step Solutions

<Steps>
<Step title="Set Up Your Build System to Find Headers and Sources">
Make sure your build system includes the GoogleTest and GoogleMock headers and source files properly. For example, with CMake:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # On Windows: to avoid static/dynamic CRT conflicts
FetchContent_MakeAvailable(googletest)

add_executable(my_tests my_tests.cpp)
target_link_libraries(my_tests gtest_main gmock)  # Link with GoogleTest and GoogleMock
add_test(NAME my_tests COMMAND my_tests)
```

This integrates GoogleTest and GoogleMock from source and configures linkage automatically.

</Step>
<Step title="Check Compiler and Runtime Flags Compatibility">
On Windows:

- Use `gtest_force_shared_crt` option to match the runtime library linkage (static vs dynamic) between your project and GoogleTest/GoogleMock.

- Ensure C++ standard version is set to at least C++17 (`set(CMAKE_CXX_STANDARD 17)`).

On all platforms:

- Confirm that exception support and RTTI settings match those used when building GoogleTest.

</Step>
<Step title="Ensure Linking with Required Libraries">

Link your test executable against the following libraries depending on usage:

| Usage                    | Libraries to Link                      |
|--------------------------|-------------------------------------|
| GoogleTest only          | `gtest` or `gtest_main`              |
| GoogleMock (mock support)| `gmock` or `gmock_main` (includes gtest)|

Also, link with `Threads::Threads` or `-lpthread` on platforms where pthread support is needed.

</Step>
<Step title="Resolve Undefined Reference Errors">

Common linker errors such as:

```plaintext
undefined reference to `testing::...`
```

Mean you likely forgot to link necessary libraries or mixed static/dynamic libraries incorrectly.

- Verify that you link to `gtest_main` or provide your own `main()`.
- For GoogleMock, link to `gmock_main` or implement your own main.
- Confirm that libraries are linked in the correct order: dependencies last.

</Step>
<Step title="Check Pthread and Threading Support">

On Linux and similar:

- Make sure `-pthread` (or equivalent) compiler and linker flags are set in your build.

- CMake `FindThreads` module adds this automatically when using `Threads::Threads`.

If you see errors about missing pthread symbols, add these flags explicitly.

</Step>
</Steps>

---

## Practical Tips and Best Practices

- **Use CMake’s FetchContent or add_subdirectory for integration:** This ensures consistent compiler flags and reduces linker mismatches.

- **Avoid mixing Debug and Release builds:** Linking a debug build with a release version of GoogleTest may lead to errors.

- **On Windows, prefer dynamic CRT linkage for GoogleTest:** Set `gtest_force_shared_crt=ON` in CMake to align runtimes.

- **If you want GoogleTest or GoogleMock as shared libraries (DLLs):** Use the compile definitions `GTEST_CREATE_SHARED_LIBRARY` and `GTEST_LINKED_AS_SHARED_LIBRARY` as appropriate. Then compile your tests with matching flags.

- **Avoid macro clashes:** If `TEST` or other GoogleTest macros conflict with other code, compile with flags like `-DGTEST_DONT_DEFINE_TEST=1` and use prefixed macros (e.g., `GTEST_TEST`).

---

## Troubleshooting Common Errors

<AccordionGroup title="Common Build Issues and Fixes">
<Accordion title="Linker errors: `undefined reference to testing::InitGoogleTest`">
- **Cause:** Missing linkage to `gtest` or `gtest_main`.
- **Fix:** Link your test executable with `gtest_main` (recommended) or provide your own `main()` that initializes GoogleTest explicitly.
</Accordion>
<Accordion title="RuntimeLibrary mismatch error on Visual Studio">
 - **Cause:** Mismatched runtime libraries between GoogleTest and your project (static vs dynamic CRT).
 - **Fix:** Set `gtest_force_shared_crt=ON` in your CMake build to force GoogleTest to use dynamic CRT matching your project settings.
</Accordion>
<Accordion title="Missing pthread symbols on Linux">
 - **Cause:** Compiler and linker flags missing `-pthread`.
 - **Fix:** Add `find_package(Threads REQUIRED)` and link with `${CMAKE_THREAD_LIBS_INIT}` or `Threads::Threads`.
</Accordion>
<Accordion title="Include file not found: gtest/gtest.h">
 - **Cause:** Header search paths not set correctly.
 - **Fix:** Add GoogleTest include directories to your build system (usually handled automatically with CMake targets like `gtest` or via `include_directories`).
</Accordion>
</AccordionGroup>

---

## Integrating with Other Build Systems

Although this page focuses on CMake, the core principles apply to other build tools:

- **Bazel:** Use the provided `googletest` and `googlemock` targets and ensure test binaries depend on them.

- **Makefiles or custom scripts:** Manually include `-I` flags to GoogleTest headers and link against compiled GoogleTest/GoogleMock static or shared libraries, passing any required platform-specific link flags (e.g., pthread).

Refer to the [Build System Integration Guide](/guides/practical-integrations/build-system-integration) for detailed platform-specific instructions.

---

## Additional Resources

- [Installation & Build Integration Guide](https://github.com/google/googletest/tree/main/docs/getting_started/essentials_setup/installation.md) — Step-by-step install and build instructions.
- [Build System Integration Guide](/guides/practical-integrations/build-system-integration) — Details embedding GoogleTest/GoogleMock in your build system.
- [Troubleshooting Common Issues](/getting_started/first_steps_usage/common_issues) — More general troubleshooting advice.
- [GoogleTest & GoogleMock GitHub](https://github.com/google/googletest) — Source repository with issues and wiki.

<Tip>
Ensuring consistent compiler flags, especially runtime library, C++ standard version, and threading support, between your project and GoogleTest libraries is crucial to avoid most linking errors.
</Tip>

<Note>
Using CMake's modern targets `gtest`, `gtest_main`, `gmock`, and `gmock_main` simplifies header paths, compiler flags, and linking dependencies management automatically.
</Note>