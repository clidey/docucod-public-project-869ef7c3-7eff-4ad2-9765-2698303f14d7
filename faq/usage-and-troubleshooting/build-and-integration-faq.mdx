---
title: "Build & Integration FAQ"
description: "Responds to questions about integrating GoogleTest and GoogleMock into various build environments, including CMake, Bazel, and cross-platform setups. Covers resolving build issues, dependency conflicts, and integration with existing codebases."
---

# Build & Integration FAQ

This FAQ answers your questions about integrating GoogleTest and GoogleMock into various build environments, such as CMake, Bazel, and cross-platform setups. It focuses on practical guidance for resolving build issues, managing dependency conflicts, and smoothly incorporating GoogleTest/GoogleMock into your existing codebases.

---

## 1. How do I integrate GoogleTest and GoogleMock into my CMake project?

To integrate GoogleTest (and GoogleMock) into your CMake-based project, the recommended approach is to add GoogleTest as a dependency using CMake's `FetchContent` or by including it as a subdirectory. Here is a typical user workflow:

### Steps for Integration

<Steps>
<Step title="Add FetchContent for GoogleTest">
Include the `FetchContent` module and declare google test in your `CMakeLists.txt`:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
FetchContent_MakeAvailable(googletest)
```
</Step>
<Step title="Link Against GoogleTest Libraries">
For your test executable, link with `gtest_main` and/or `gmock_main`:
```cmake
target_link_libraries(your_test_target PRIVATE gtest_main gmock_main)
```
This provides a ready-made `main()` function for running tests.
</Step>
<Step title="Enable Tests">
Optionally, enable testing and add test commands:
```cmake
enable_testing()
add_test(NAME your_test COMMAND your_test_target)
```
</Step>
</Steps>

### Common Pitfalls

- Ensure that CMake version is sufficiently recent (>=3.14) to use `FetchContent_MakeAvailable()`.
- Avoid mixing incompatible compiler or runtime library flags across your project and GoogleTest/GoogleMock builds.
- Confirm that the C++ standard is set to at least C++17 with `set(CMAKE_CXX_STANDARD 17)`.
- When linking with `gmock_main`, the `gmock_main.cc` provides a standard `main()` that initializes GoogleMock and GoogleTest together.

---

## 2. What if I want to build GoogleTest/GoogleMock separately and include prebuilt binaries?

You can build GoogleTest and GoogleMock separately as static or shared libraries using their provided CMake scripts, and then link against them. Key points:

- Build GoogleTest and GoogleMock via their CMakeLists.txt with optional flags like `-DBUILD_GMOCK=ON` to build GoogleMock.
- Install to system paths or a custom prefix.
- Use `find_package(GTest CONFIG REQUIRED)` in your CMakeLists to locate installed GoogleTest.
- Link with imported targets like `GTest::gtest` and `GTest::gmock`.

Refer to the [googletest/README.md](https://github.com/google/googletest/blob/main/README.md) and [googletest/README.md#generic-build-instructions](https://github.com/google/googletest/blob/main/README.md#generic-build-instructions) for more detailed build instructions.

---

## 3. How do I resolve common build problems, such as missing dependencies or linker errors?

### Common Causes

- **C++ Standard Mismatch:** GoogleTest requires at least C++17 standard.
- **Runtime Library Incompatibility (Windows):** When using MSVC, ensure consistent runtime library settings for your project and GoogleTest (e.g., dynamic vs static CRT). Use the CMake option `gtest_force_shared_crt=ON` to align runtimes.
- **Pthreads Not Found:** On POSIX platforms, GoogleTest uses pthreads. If missing, pthread linking issues appear.
- **Linking Order Issues:** Link your test target with GoogleTest and GoogleMock libraries in the correct order.

### Troubleshooting Steps

<Steps>
<Step title="Check C++ Standard">
Verify `CMAKE_CXX_STANDARD` is set to 17 or above.
</Step>
<Step title="Adjust MSVC Runtime Settings">
For Visual Studio, consider setting `gtest_force_shared_crt=ON` in CMake to unify CRT linkage.
</Step>
<Step title="Verify pthread Availability">
Make sure pthreads are installed and linkable on your system.
In CMake, it is detected automatically but can be forced using `-DGTEST_HAS_PTHREAD=1`.
</Step>
<Step title="Order of Linkage">
Ensure your test executable is linked with `gmock_main` or `gtest_main` last.
</Step>
<Step title="Check for Multiple GoogleTest Versions">
Avoid multiple conflicting versions of GoogleTest or GoogleMock in the linker path.
</Step>
</Steps>

---

## 4. Can I use Bazel to build projects with GoogleTest and GoogleMock?

Yes. GoogleTest and GoogleMock are provided with Bazel build rules that you can incorporate into your Bazel build.

### Key Points

- Define GoogleTest and GoogleMock as external dependencies.
- Use Bazel's `cc_test` targets to specify tests linked with GoogleTest/GoogleMock.
- Follow the Bazel integration landscape in the [Integration Landscape](https://github.com/google/googletest/blob/main/docs/overview/core-concepts/integration-landscape.mdx).

For detailed usage, see the [Integration with Build Systems](https://github.com/google/googletest/blob/main/guides/integration_and_effectiveness/build_system_integration.mdx) manual.

---

## 5. What are best practices for integrating GoogleTest into complex, cross-platform projects?

- **Use the official CMake scripts or Bazel rules** to manage dependencies consistently.
- **Shared main() function:** Prefer linking with `gtest_main` or `gmock_main` libraries for the standard entry point.
- **Isolate GoogleTest dependencies:** Use interfaces or targets to avoid polluting your main project build settings.
- **Standardize build flags:** Ensure consistent C++ standard and compiler flags for the whole build to avoid compatibility issues.
- **Use `FetchContent` or submodules:** Avoid copying source code manually; instead rely on tools for better maintainability.
- **Automate tests:** Integrate test runs into your CI pipelines using CTest, Bazel test runs, or other tools.

---

## 6. How can I diagnose and fix dependency conflicts?

Dependency conflicts typically arise when:

- Multiple versions of GoogleTest or GoogleMock libraries exist in your build environment.
- Your project and GoogleTest/GoogleMock were built with different compiler toolchains or incompatible runtime settings.

### Resolution Tips

- Review your project dependencies to confirm only one GoogleTest/GoogleMock is used.
- Clean old build files and caches when upgrading or changing GoogleTest versions.
- Match compiler flags, especially on Windows related to runtime (`/MD`, `/MT` etc).
- Use verbose build outputs and linker diagnostics to identify duplicated symbols or missing symbols.

---

## 7. How to integrate GoogleMock into an existing GoogleTest environment?

- GoogleMock is part of the Googletest repository and designed to integrate seamlessly.
- When building with CMake, enable `BUILD_GMOCK` to `ON`.
- Link with `gmock` and `gmock_main` libraries.
- Include `<gmock/gmock.h>` for GoogleMock macros and features.
- Ensure `testing::InitGoogleMock` is called instead of `InitGoogleTest` if you provide a custom `main()`.

---

## 8. What are common errors users encounter with build integration?

### Linker Errors

- **Undefined references to GoogleTest symbols:** Usually caused by missing linkage of `gtest` or `gmock` libraries.
- **Conflicting symbols:** Multiple incompatible GoogleTest versions linked together.

### Compiler Errors

- **MOCK_METHOD parsing errors:** When mocking methods with parameter types containing commas, wrap the types in an extra pair of parentheses or use type aliases.

Example:
```cpp
MOCK_METHOD((std::pair<bool,int>), GetPair, ());
using BoolIntPair = std::pair<bool,int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```

### Runtime Errors

- **Tests not discovered or run:** Check that you call `RUN_ALL_TESTS()` after proper initialization.
- **Unresolved dependencies on threading libraries:** Make sure pthread or Windows threading libs are linked correctly.

---

## 9. How do I write a custom CMakeLists.txt using GoogleTest and GoogleMock from source?

Here is a minimal example:

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.tar.gz
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)

target_link_libraries(my_tests PRIVATE gtest_main gmock_main pthread)
enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

This setup builds GoogleTest and GoogleMock together, compiles your tests, provides the main function, and allows running via CTest.

---

## 10. What is the difference between linking with `gtest_main` and `gmock_main`?

- **gtest_main:** Provides a main function that initializes GoogleTest.
- **gmock_main:** Provides a main function that initializes both GoogleMock and GoogleTest.

If you use GoogleMock in your tests, link against `gmock_main`. Otherwise, `gtest_main` is sufficient.

---

## Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) - Guide on writing tests and test fixtures.
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md) - Detailed usage of mocking API.
- [Build System Integration Guide](https://github.com/google/googletest/blob/main/guides/integration_and_effectiveness/build_system_integration.mdx) - For deep dive on CMake and Bazel builds.
- [Troubleshooting Common Issues](https://github.com/google/googletest/blob/main/getting-started/troubleshooting-getting-started/common-setup-issues.mdx) - Common setup errors and fix tips.

---

Should you encounter issues not covered here, consider checking out the [Getting Started & Basic Usage FAQ](/faq/usage-and-troubleshooting/getting-started-faq) or the [Troubleshooting Common Errors FAQ](/faq/usage-and-troubleshooting/troubleshooting-common-errors) for more insights.


