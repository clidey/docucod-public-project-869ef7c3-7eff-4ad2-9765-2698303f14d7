---
title: "Build, Linking, and Integration Problems"
description: "Covers solutions for common linking errors and integration pitfalls when building complex projects. Provides guidance on correct project setup, dealing with multiple build systems, and incorporating GoogleTest/GoogleMock into larger codebases."
---

# Build, Linking, and Integration Problems FAQ

This page addresses common challenges encountered when building, linking, and integrating GoogleTest and GoogleMock into complex projects. It guides you through correctly setting up your project environment, resolving linking errors, handling multiple build systems, and correctly incorporating testing frameworks like GoogleTest and GoogleMock.

---

## Frequently Asked Questions

### Why am I getting linking errors with GoogleTest or GoogleMock?
Linking errors often occur due to:
- Missing or misconfigured GoogleTest/GoogleMock libraries in your build system.
- Incompatible runtime library settings, especially on Windows with MSVC, leading to CRT linkage mismatches.
- Omitting necessary pthreads linkage on POSIX systems.

**What to do:**
- Ensure your build system correctly finds and links the GoogleTest and GoogleMock libraries.
- Match runtime library flags (static vs dynamic) between your project and GoogleTest. On Windows, use the `gtest_force_shared_crt` CMake option to align runtimes.
- Add pthread linkage explicitly if not using CMake or if your environment lacks automatic detection.

### How should I set up my build when using multiple build systems like CMake and Bazel?
GoogleTest and GoogleMock support seamless integration with both CMake and Bazel.

- **With CMake:** Use the provided `find_package(GTest REQUIRED)` or add GoogleTest source using `add_subdirectory()` to ensure consistent compiler and linker settings.
- **With Bazel:** Follow the Bazel integration guidelines to add GoogleTest and GoogleMock as dependencies and configure targets accordingly.

Avoid mixing build systems for the same components to prevent configuration conflicts.

### How do I incorporate GoogleTest and GoogleMock into a large codebase?

- Prefer building GoogleTest as part of your project's build to ensure consistent compiler and linker flags.
- Use `FetchContent` or Git submodules in CMake to integrate GoogleTest source for easier maintenance and updates.
- Explicitly include headers `<gtest/gtest.h>` and `<gmock/gmock.h>` where needed.
- Link against target libraries such as `GTest::gtest`, `GTest::gmock`, or `GTest::gmock_main` depending on whether you use the built-in main function.

### When should I use `gmock_main` vs `gmock` libraries?
- Use `gmock_main` when you want GoogleMockâ€™s main function (`main()`) linked into your test executable. This is convenient if you want to avoid writing your own `main()`.
- Use `gmock` (without `_main`) if your project manages its own `main()` function.

### How do I avoid Visual Studio runtime mismatch errors?
By default, Visual Studio links runtime libraries dynamically, but GoogleTest often links statically by default. This mismatch causes errors like:

```
gtest.lib : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

**Fix:**
- Set `gtest_force_shared_crt` to `ON` in your CMake configuration to align runtime linkage with your project.

### How do I handle pthread missing dependency issues?
- GoogleTest requires pthread support for thread-safe tests on POSIX systems.
- When using CMake, pthread detection is automatic.
- If you encounter linking errors related to pthread, ensure you link `-lpthread` explicitly in your build scripts.

---

## Common Issues & Solutions

### Linker cannot find `gtest` or `gmock` libraries
- Verify the libraries are built and installed correctly.
- Check your library search paths and linking statements.
- For CMake: confirm `find_package(GTest REQUIRED)` finds the installed GoogleTest.

### Multiple definitions of `main()` function
- Occurs when linking both your own `main()` and `gmock_main` library.
- Choose either to use GoogleMock's main (link with `gmock_main`) or your own `main()`, not both.

### CRT linkage mismatch on Windows
- Ensure your project and GoogleTest build use the same runtime flags.
- Use the CMake flag `gtest_force_shared_crt=ON` to enable dynamic runtime linkage.

### Compatibility issues with MSVC warnings about const parameters
- Remove unnecessary top-level `const` qualifiers on virtual function parameters.
- This avoids compiler warnings caused by MSVC's incomplete const/volatile handling.

### Macros like `ASSERT_*` conflict with other libraries
- Use `-DGTEST_DONT_DEFINE_*` flags (for example, `-DGTEST_DONT_DEFINE_ASSERT=1`) to rename GoogleTest macros and avoid conflicts.

---

## Best Practices for Build and Integration

- **Build GoogleTest/GoogleMock as part of your main build** to prevent mismatches and ease dependency management.
- **Use CMake's `FetchContent` or add_subdirectory()** for reproducible and easy integration.
- Ensure consistent compiler flags and C++ standard (C++17 required).
- **Link pthreads properly** on POSIX systems.
- On Windows, match the CRT linkage between GoogleTest and your code.
- Link only what you need: `gtest_main`, `gmock_main`, or plain `gtest`/`gmock` depending on your `main()` implementation.

---

## Troubleshooting Typical Linking Errors

<AccordionGroup title="Common Linking Errors and Solutions">
<Accordion title="Undefined reference to gtest or gmock symbols">
Most errors come from missing library linkage. Check that you link with:

```bash
-lgtest -lgtest_main -lgmock -lgmock_main
```

Or in CMake:

```cmake
find_package(GTest REQUIRED)
target_link_libraries(your_test_target GTest::gmock_main)
```

Ensure library paths are correctly set.
</Accordion>
<Accordion title="Multiple definition of main function">
Avoid linking both GoogleMock's provided main (via `gmock_main`) and your own `main()` in the same executable.
Choose one:
- Link against `gmock_main` (provides default main()) if you don't want to write your own.
- Provide your own `main()` and link against `gmock` and `gtest` only.
</Accordion>
<Accordion title="CRT mismatch errors on Visual Studio">
Set the CMake option:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

to make GoogleTest link runtime dynamically matching your project settings.
</Accordion>
<Accordion title="Pthread-related linker errors">
Ensure your linker includes pthread library.
On Linux or Mac, add `-lpthread` explicitly if not done automatically.
If using CMake, verify pthread support is detected via `find_package(Threads)`.
</Accordion>
</AccordionGroup>

---

## Common Pitfalls

- Forgetting to include GoogleMock headers and link against the right libraries leads to build failures.
- Using mismatched compiler or runtime options between GoogleTest and your code (e.g., debug vs release, static vs dynamic CRT).
- Omitting the `override` qualifier in mocks can cause subtle bugs.
- Mixing build systems or using GoogleTest prebuilt binaries inconsistent with your compiler or flags.

---

## Troubleshooting Steps When Facing Linking Issues

<Steps>
<Step title="Verify GoogleTest and GoogleMock libraries are built">
Check if libraries like `libgtest.a`, `libgmock.a`, or their Windows equivalents exist.
</Step>
<Step title="Check include and linker paths">
Make sure your compiler can find GoogleTest headers and your linker can find the libraries.
</Step>
<Step title="Confirm consistent compiler and runtime options">
Especially for MSVC, run CMake with `gtest_force_shared_crt` to match your code project's choices.
</Step>
<Step title="Review your build system configuration">
For CMake, verify usage of `find_package(GTest)` or `add_subdirectory()` is correct.
For Bazel, check WORKSPACE and BUILD.bazel dependencies.
</Step>
<Step title="Use verbose build output">
Enable verbose flags in your build system to trace what libraries are linked and what options are passed.
</Step>
</Steps>

---

## Incorporating GoogleTest/GoogleMock into a Project Using CMake

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For MSVC runtime matching
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test.cpp)
target_link_libraries(my_tests GTest::gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

This method builds GoogleTest inside your build, ensuring consistent flags.

---

## Additional Tips

- If you encounter unusual linker errors, clean your build and rebuild everything.
- Avoid modifying standard GoogleTest source or build scripts unless you understand the impact.
- Consider building GoogleTest with static libraries unless your project requires dynamic linkage.
- On Windows, carefully manage Unicode and UNICODE macro definitions to avoid conflicts.

---

## Related Documentation

- [Configuring Includes and Linking](/getting-started/configuration-validation/include-and-link)
- [Troubleshooting Common Setup Issues](/getting-started/troubleshooting-help/common-issues)
- [Quick Integration with Build Systems](/guides/getting-started/quick-integration)
- [GoogleMock: Mocking and Expectations Clarified](/faq/troubleshooting-and-advanced-faq/mocking-usage-faq)
- [System Requirements](/getting-started/prerequisites-installation/system-requirements)

Visit the [Ecosystem & Integrations Overview](/overview/integration-ecosystem/ecosystem-integrations) for broader context on tooling around GoogleTest.

---

## Support Resources

For help with persistent build or linking problems, consult the community forums, GitHub issues, and official GoogleTest README. Detailed build instructions, examples, and advanced troubleshooting tips are all available in the online docs.

<Tip>
Always strive to build GoogleTest and GoogleMock with the same compiler and flags as your project to reduce complications.
</Tip>