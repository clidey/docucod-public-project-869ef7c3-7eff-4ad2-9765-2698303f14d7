---
title: "GoogleMock: Mocking and Expectations Clarified"
description: "Provides clear answers on using the GoogleMock framework, especially around common misunderstandings such as uninteresting calls, expectation failures, and best practices for defining and organizing mocks."
---

# GoogleMock: Mocking and Expectations Clarified

GoogleMock is Google's C++ mocking framework designed to help you declare, use, and verify mocks efficiently in your tests. This documentation focuses on clarifying common misunderstandings, explaining core concepts and best practices around mock usage such as expectation management, uninteresting calls, and strictness policies to empower you to write robust, maintainable tests.

---

## 1. Understanding Mock Objects and Calls

### 1.1 What Is a Mock Object?
A mock object simulates the behavior of a real class or interface in a controlled way. It allows you to:

- Specify which methods are expected to be called, with what arguments.
- Define what these methods should return or how they should behave.
- Verify at test completion that expectations were met.

Mocks are fundamental in isolation testing, ensuring interaction correctness.

### 1.2 Types of Calls to Mock Methods

- **Expected Calls:** Calls to mock methods explicitly specified with `EXPECT_CALL`. These calls must occur as described.
- **Uninteresting Calls:** Calls to mock methods that were not specified with any `EXPECT_CALL`.
- **Unexpected Calls:** Calls to mock methods with expectations set, but which do not match any active expectation. These are always errors.

### 1.3 Default Behavior and Uninteresting Calls

By default, uninteresting calls:
- Return default values (zero, false, null, or default-constructed objects).
- Print warnings (called Naggy behavior).

You can suppress warnings on uninteresting calls using `NiceMock` or fail on such calls with `StrictMock`.

### 1.4 Strictness Modes

- **NaggyMock:** Prints warnings on uninteresting calls. This is the current default.
- **NiceMock:** Suppresses warnings on uninteresting calls.
- **StrictMock:** Treats uninteresting calls as test failures.

Example usage:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock;
EXPECT_CALL(mock, DoThis());
// Uninteresting calls to other methods won't warn.
```

```cpp
using ::testing::StrictMock;
StrictMock<MockFoo> mock;
EXPECT_CALL(mock, DoThis());
// Uninteresting calls will cause test failures.
```

> Note: All strictness modes only affect *uninteresting* calls, not unexpected calls.

---

## 2. Defining and Using Expectations

### 2.1 Defining Expectations with `EXPECT_CALL`

Expectations tell the mock framework what calls, with which arguments, are expected during the test. Basic syntax:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- The `matchers` specify argument constraints with matchers like `_` (wildcard), `Eq()`, `Gt()`, etc.
- `Times()` controls the allowed number of invocations.
- `WillOnce()` and `WillRepeatedly()` define behavior (return values, side effects).

### 2.2 Order and Precedence of Expectations

GoogleMock evaluates expectations in *reverse order*: the last declared matching expectation is used. This allows you to declare general fallback expectations first, and override with specific ones later.

Example:

```cpp
EXPECT_CALL(mock, Foo(_)).Times(AnyNumber());  // General fallback
EXPECT_CALL(mock, Foo(5)).Times(2);           // Overrides last
```

Any call matching `Foo(5)` uses the second expectation; others use the first.

### 2.3 Uninteresting Calls and Suppressing Warnings

If you do not set an `EXPECT_CALL` on a method, calls to it are considered uninteresting and cause warnings unless:

- You use `NiceMock` to silence warnings.
- You explicitly specify `EXPECT_CALL(...).Times(AnyNumber())` to indicate calls are expected.

### 2.4 Handling Return Values for Unexpected Calls

Unexpected calls (calls without any matching expectation) return default values but always generate errors.

If a mock function's return type is not default constructible, unhandled calls will throw or cause test termination. Use `ON_CALL` or `EXPECT_CALL` to provide suitable default actions.

### 2.5 Default Actions with `ON_CALL`

`ON_CALL(mock, Method(...)).WillByDefault(action);` specifies a fallback behavior when there's no matching expectation for that call. 

`ON_CALL` does *not* assert the method is called and does not imply an expectation.

### 2.6 Using Matchers and Custom Actions

Use GoogleMock's extensive matchers to specify argument constraints, e.g., `_`, `Ge(5)`, `NotNull()`, or custom matchers.

Define what a mock method should do using built-in actions like `Return()`, `Invoke()`, `SetArgPointee()`, or custom actions.

---

## 3. Managing Expectations and Ordering

### 3.1 Ordering Calls

By default, calls can occur in any order matching their expectations.

- Use `InSequence` to require strict order of calls.
- Use `After` clauses or multiple `Sequence` objects to specify partial ordering constraints.

Example strict ordering:

```cpp
using ::testing::InSequence;
{
  InSequence s;
  EXPECT_CALL(mock, A());
  EXPECT_CALL(mock, B());
}
// A() must be called before B()
```

Example partial ordering using sequences:

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, A()).InSequence(s1, s2);
EXPECT_CALL(mock, B()).InSequence(s1);
EXPECT_CALL(mock, C()).InSequence(s2);
```

### 3.2 Retiring Expectations

Expectations can retire automatically when saturated by calling `.RetiresOnSaturation()`. This means the expectation becomes inactive when its call count is reached, allowing other expectations to handle matching calls afterward.

---

## 4. Common Issues and Best Practices

### 4.1 Expectation Not Satisfied Failures

Tests fail when method calls do not meet the declared expectations in:

- Arguments not matching.
- Too few or too many calls.
- Calls out of order (when sequences or After clauses are used).

Use `--gmock_verbose=info` to get detailed tracing of expectations and calls.

### 4.2 Uninteresting Call Warnings

Warnings indicate calls to mock methods with no expectations. Fix by:

- Adding appropriate `EXPECT_CALL` if intended.
- Using `NiceMock` to suppress warnings if calls are not of interest.
- Using `ON_CALL` to set sensible default actions.

### 4.3 Matching Overloaded Methods

To avoid ambiguities with overloaded methods:

- Specify all overloads you want to mock.
- Use `Const()` wrapper for const methods.
- Use explicit overload resolution if necessary.

### 4.4 Mocking Methods with Move-only Types

GoogleMock supports mock methods accepting or returning move-only types (e.g., `std::unique_ptr`). Use lambdas or callable actions for complex behaviors.

### 4.5 Mock Destructors

You cannot mock destructors directly. Instead, add a mock method (e.g., `Die()`) and call it in the destructor to verify destruction ordering.

---

## 5. Tips for Defining Mocks

- Place `MOCK_METHOD` macros in public sections regardless of the base method's access specifier.
- Use parentheses around argument types with commas inside `MOCK_METHOD`.
- Be cautious of nesting `NiceMock`, `NaggyMock`, or `StrictMock`; nesting is not supported.
- Use `ON_CALL` for default behaviors and `EXPECT_CALL` for expected calls.

Example mock class:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};
```

Wrap as nice or strict mock:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

---

## 6. Controlling GoogleMock Verbosity

GoogleMock outputs messages about mock calls controlled by the `--gmock_verbose=LEVEL` flag:

- `info`: verbose logs including matches, uninteresting calls with stack traces.
- `warning` (default): warnings and errors, minimal info logs.
- `error`: only errors.

Control verbosity to balance information and noise during test runs.

---

## 7. Verifying and Clearing Expectations

- Use `Mock::VerifyAndClearExpectations(&mock)` to verify that expectations are met **before** mock destruction.
- Use `Mock::VerifyAndClear(&mock)` to verify and reset both expectations and default actions.
- Avoid setting new expectations after verifying and clearing a mock, as behavior is undefined.

---

## 8. Summary

GoogleMock provides a powerful yet flexible way to mock objects in C++:

- Use `EXPECT_CALL` to specify expected calls, argument constraints, and behaviors.
- Understand uninteresting versus unexpected calls and use strictness modes (`NiceMock`, `NaggyMock`, `StrictMock`) to control warnings and failures.
- Use sequences and ordering modifiers to control call order.
- Manage default behaviors with `ON_CALL`.
- Use verbosity flags to get detailed diagnostics for debugging.
- Follow best practices regarding mock class authoring and expectation lifecycle.

**For further reading and hands-on examples, see:**

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking-framework.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)

---

### Example: Using NiceMock

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
};

TEST(FooTest, WorksWithNiceMock) {
  NiceMock<MockFoo> mock;

  EXPECT_CALL(mock, DoThis());
  mock.DoThis();  // No warnings for other uninteresting calls.
}
```

---

## Appendix: Troubleshooting

<AccordionGroup title="Common Troubleshooting Topics">
<Accordion title="Uninteresting Calls Warning">
Uninteresting calls occur when mock methods are invoked without matching `EXPECT_CALL`. If these warnings are unexpected, consider:
- Adding explicit expectations.
- Using `NiceMock` to suppress warnings.
- Defining default behavior via `ON_CALL`.

Always check if calls are truly needed or indicate a test bug.
</Accordion>
<Accordion title="Failed Expectations and Unexpected Calls">
Failures mean calls did not match expectations. Troubleshoot by:
- Running tests with `--gmock_verbose=info` to trace matching.
- Verifying argument matcher correctness.
- Checking call order if sequences or `After` clauses are used.
- Confirming `Times()` values.
</Accordion>
<Accordion title="Order of Expectations Matters">
Remember GoogleMock searches expectations in reverse declaration order. Place specific expectations after general fallbacks.
</Accordion>
<Accordion title="Mocking Non-Virtual or Overloaded Methods">
- Non-virtual methods require special handling (see gMock Cookbook).
- For overloaded methods, specify each overload explicitly and use `Const()` for const methods.
</Accordion>
<Accordion title="Mocking Methods with Move-Only Types">
Use lambdas or callable actions for mocking methods with move-only parameters or return types.
</Accordion>
<Accordion title="Mocking Destructor Call Timing">
Mock the destructor by defining and calling an explicit method like `Die()`. Expect and verify calls to `Die()` instead.
</Accordion>
</AccordionGroup>


---

*This document is part of the GoogleTest and GoogleMock documentation ecosystem and complements related guides and references.*
