---
title: "Defining and Using Mocks"
description: "Answers to recurring questions about creating mock classes, using mock methods, and setting up expectations. Explains macro usage and resolving common issues in creating or maintaining mocks."
---

# Defining and Using Mocks FAQ

This FAQ page addresses common questions regarding creating mock classes, using mock methods, and setting up expectations using GoogleMock (gMock). It explains how to effectively define mocks with macros like `MOCK_METHOD`, set expectations with `EXPECT_CALL`, configure default behaviors with `ON_CALL`, and manage strictness using wrappers. Troubleshooting tips and solutions to frequent issues encountered in mock creation and maintenance are also covered.

---

## Frequently Asked Questions

### 1. What is a mock, and why should I use one?

A *mock object* implements the same interface as a real object but lets you specify its expected behavior at runtime. Mocks are primarily used in testing to simulate dependencies and verify interactions such as method calls, call order, arguments passed, and returned results.

Mocks differ from *fakes*:
- Fakes provide a working, simplified implementation.
- Mocks explicitly specify expected calls and behaviors.

Using mocks makes your tests faster, more reliable, easier to read, and better at verifying how your code interacts with collaborators.

---

### 2. How do I define a mock class?

To create a mock class for an interface:

1. Inherit from the interface.
2. Use the `MOCK_METHOD` macro inside the **public** section for each virtual function you want to mock.

Example:

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

**Important:** Always place `MOCK_METHOD` in a `public:` section even if the base class method is protected or private.

---

### 3. How do I use mock objects in tests?

Typical usage flow:

1. Include the gMock macros and types.
2. Create mock instances.
3. Specify expectations with `EXPECT_CALL` before exercising the code.
4. Exercise the tested code that interacts with the mock.
5. GoogleMock automatically verifies if expectations are met at mock destruction.

Example:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

If the method `PenDown()` is not called at least once, the test fails at the mock call.

**Note:** Set expectations **before** calling any mock methods; otherwise, behavior is undefined.

---

### 4. How do I set expectations on mock methods?

Use `EXPECT_CALL(mock_object, Method(matchers...))` to specify expected calls:

```cpp
EXPECT_CALL(turtle, Forward(100));          // Expects Forward(100)
EXPECT_CALL(turtle, GoTo(50, _));            // Expects GoTo with x=50, any y
EXPECT_CALL(turtle, GetX())                   // GetX with no arguments
    .Times(5)                                // called 5 times
    .WillOnce(Return(100))                   // returns 100 first time
    .WillOnce(Return(150))                   // returns 150 second time
    .WillRepeatedly(Return(200));            // returns 200 thereafter
```

- Use `_` matcher to accept any argument.
- If method is overloaded, specify argument types or use disambiguation helpers.
- The order of chained clauses matters.

---

### 5. What are `ON_CALL` and `WillByDefault`?

`ON_CALL(mock_object, Method(matchers...))` defines how your mock behaves when the method is called but does not set an *expectation* that the call must occur.

Example:

```cpp
ON_CALL(turtle, Forward(_))
    .WillByDefault(Return());  // By default, Forward does nothing.
```

Use `ON_CALL` to set default behavior for mock methods when you don't want to write explicit expectations with `EXPECT_CALL`.

---

### 6. What are NiceMock, NaggyMock, and StrictMock?

GoogleMock offers 'strictness' wrappers controlling how *uninteresting* calls (calls without explicit `EXPECT_CALL` expectations) are handled:

- **NaggyMock**: Default mock behavior producing warnings on uninteresting calls.
- **NiceMock**: Suppresses warnings on uninteresting calls, allowing quiet tests.
- **StrictMock**: Treats uninteresting calls as test failures.

Example:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
```

These wrappers inherit constructors, so you can construct them just like the base mock. Use strictness wrappers to tailor how strictly you want to monitor unexpected calls.

---

### 7. How do I mock overloaded methods?

Define a mock method for each overload separately using `MOCK_METHOD`. The syntax is the same; specify argument types to disambiguate:

```cpp
MOCK_METHOD(int, Add, (int x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));
```

For const overloads:

```cpp
MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

Use the `Const()` helper to set expectations on const overloads:

```cpp
EXPECT_CALL(Const(foo), GetBar());
```

---

### 8. How do I simplify mocking methods with many arguments?

If a method has many arguments but you're only interested in some, implement helper/mock methods with simplified signatures and redirect the original method. For example:

```cpp
void send(..., const char* message, size_t len) override {
  Log(severity, file_name, std::string(message, len));
}
MOCK_METHOD(void, Log, (LogSeverity severity, const std::string& file, const std::string& message));
```

This makes test code cleaner without modifying the original interface.

---

### 9. Where should I put mock classes?

- If you own the interface, define mocks alongside or in test files.
- For third-party interfaces, place mocks in their own test-only directories accessible to consumers.
- Avoid mocking classes you don't own directly; consider wrapping them in adapters you control.

---

### 10. What are common pitfalls when defining mocks?

- Not declaring destructors of base classes as virtual leads to leaks or undefined behavior.
- Setting expectations after mock methods are called results in undefined behavior.
- Overly strict expectations can cause fragile tests.
- Ignoring to specify expectations for overloaded methods causes ambiguity.
- Misusing `Return()` with move-only types without lambdas leads to runtime issues.

---

## Common Issues & Solutions

### Q: Why does my mock method call trigger the real method?

Because the method to be mocked is not declared `virtual`. Only virtual methods can be mocked unless using advanced techniques.

### Q: How to mock methods with move-only arguments/returns?

You can mock methods taking or returning move-only types using `MOCK_METHOD` normally. For return values, use lambdas in actions instead of `Return()` with `std::move`:

```cpp
EXPECT_CALL(mock, MakeBuzz("hello"))
    .WillOnce([](StringPiece) { return std::make_unique<Buzz>(); });
```

For arguments, simply accept them normally; some built-in actions might not support move-only types.

### Q: How to verify a mock before it is destroyed?

Use `Mock::VerifyAndClearExpectations(&mock_obj);` to verify all expectations and clear them before destruction.

### Q: Why am I seeing warnings about "Uninteresting mock function call"?

This means a mock method without `EXPECT_CALL` was invoked. It's a warning that might indicate missing expectations. You can:

- Add a catch-all expectation with `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`
- Use a `NiceMock` wrapper to suppress warnings.
- Adjust `ON_CALL` default actions adequately.

### Q: How do I test sequences and call order?

Use the `InSequence` class to expect calls in strict order:

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, MethodA());
  EXPECT_CALL(mock, MethodB());
}
```

Use `Sequence` objects with `EXPECT_CALL(...).InSequence(seq1, seq2)` for more complex partial orders.

### Q: What if I want to ignore uninteresting calls?

Use `NiceMock` or set an `EXPECT_CALL(...).Times(AnyNumber());` for those methods.

### Q: How to delegate calls to a fake or real object in a mock?

Use `ON_CALL` with lambdas that call the underlying fake or real instance:

```cpp
ON_CALL(mock, Method).WillByDefault([&real](Args... args) {
  return real.Method(args...);
});
```

---

## Troubleshooting Tips

- Always set `EXPECT_CALL` before exercising mocks.
- Use `--gmock_verbose=info` during test runs to gain insight into mock call matching.
- Check virtual destructors on interfaces.
- Ensure correct use of mocking macros and qualifiers.
- Use `RetiresOnSaturation()` to manage expectations that should be inactive after saturation.

---

## Additional Notes

- Avoid mocking methods in base classes not directly defined in the mock class when using `NiceMock` or `StrictMock`, as behavior may not be affected.
- The wrapping macros `NiceMock`, `NaggyMock`, and `StrictMock` inherit constructors from the base mock class, permitting seamless construction.
- Unprotected commas in types within `MOCK_METHOD` need either parenthetical wrapping or type aliases to compile.

---

## Related Documentation

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) â€” Beginner-friendly introduction
- [Mocking Reference](reference/mocking.md) â€” Detailed reference on mocking API
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) â€” Practical recipes and advanced usage
- [Strictness Wrappers](api-reference/mocking-apis/strictness-wrappers.md) â€” Guide on `NiceMock`, `NaggyMock`, and `StrictMock`
- [Matchers Reference](reference/matchers.md) â€” Comprehensive matcher list and examples
- [Actions Reference](reference/actions.md) â€” Built-in actions and custom action creation
- [Understanding Uninteresting vs Unexpected Calls](gmock_cook_book.md#uninteresting-vs-unexpected)

---

For a stepwise user journey, start by [Defining Mock Classes](gmock_for_dummies.md#writing-the-mock-class), then progress to [Setting Expectations](gmock_for_dummies.md#setting-expectations), and master handling of call order, strictness, and custom behaviors.


---