---
title: "How do I install and set up GoogleTest/GoogleMock?"
description: "Step-by-step guidance for installing GoogleTest and GoogleMock, covering build system integration, initial configuration, and recommendations for both CMake and Bazel workflows. Addresses common setup errors and provides solutions to typical pitfalls new users encounter."
---

# How do I install and set up GoogleTest/GoogleMock?

GoogleTest and GoogleMock are powerful C++ testing frameworks designed to help you write robust unit tests and mock dependencies effectively. This guide provides step-by-step instructions to install both frameworks, integrate them into your build system using CMake or Bazel, configure initial settings, and address common setup pitfalls.

---

## 1. Installing GoogleTest and GoogleMock

GoogleTest and GoogleMock are bundled together and can be installed from source or via package managers where available. You can either embed the source into your project or build and link against installed libraries.

### Recommended Prerequisites
- C++17 compliant compiler
- Threading support (pthread or equivalent)
- CMake (>= 3.14) for build configuration

### Installation Methods

#### A. Using CMake FetchContent

A convenient way to integrate GoogleTest/GoogleMock into your CMake project is using FetchContent. Here is a minimal example:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.13.0.tar.gz
)

FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main gmock_main pthread)
```

This will download, build, and link GoogleTest and GoogleMock automatically.

#### B. Standalone Build and Install

1. Clone the repository:
   ```bash
git clone https://github.com/google/googletest.git
cd googletest
mkdir build && cd build
```

2. Configure and build:
   ```bash
cmake .. -DCMAKE_BUILD_TYPE=Release
make
sudo make install
```

3. Link your tests with `-lgtest_main -lgmock_main -lpthread` and include `gmock/gmock.h`.

#### C. Bazel Integration

GoogleTest/GoogleMock are supported via official Bazel targets. Add the following to your WORKSPACE:

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.13.0.tar.gz"],
    strip_prefix = "googletest-release-1.13.0",
)
```

And in your BUILD file:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

---

## 2. Build System Integration

### CMake

1. **Include Headers:** Make sure your test sources include `#include <gmock/gmock.h>`.
2. **Link Libraries:** Link your tests with `gtest_main` and `gmock_main` targets.
3. **Add Required Dependencies:** On UNIX-like systems, link with pthread using `${CMAKE_THREAD_LIBS_INIT}`.

Recommended targets in CMake projects:
- `gmock` - GoogleMock core
- `gmock_main` - GoogleMock with a main() function
- `gtest` - GoogleTest core
- `gtest_main` - GoogleTest with a main() function

Example:

```cmake
target_link_libraries(my_test PRIVATE gmock_main)
```

Use the `InitGoogleMock()` function in your test main or test runner as demonstrated in `gmock_main.cc` to initialize GoogleMock and GoogleTest.

### Bazel

GoogleTest and GoogleMock can be easily loaded and linked in Bazel. Use official external dependencies and link against `gmock_main` to get `main()` and test functionalities.

---

## 3. Initial Test Configuration

GoogleMock requires initialization before running tests to parse command line flags and prepare the testing environment.

**Basic initialization snippet:**

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This is provided by default in the `gmock_main` target, so you may not need to define `main()` yourself if linked properly.

---

## 4. Common Pitfalls & Solutions

### 4.1. Linking Issues
- **Undefined references to pthread:** Ensure that the threading library is linked, especially on POSIX platforms using `-lpthread` or `${CMAKE_THREAD_LIBS_INIT}`.
- **Multiple `main()` functions errors:** Link only one main from either your test executable or `gmock_main`/`gtest_main` libraries. Avoid adding both.

### 4.2. Incorrect Include Paths
- Make sure your compiler's include paths reference the installed or fetched GoogleMock and GoogleTest headers, usually under `include/` with headers like `gmock/gmock.h` and `gtest/gtest.h`.

### 4.3. Initialization Missing
- If tests report unrecognized flags or behave unpredictably, verify that `InitGoogleMock()` is called before tests run.

### 4.4. Threading Support
- On some systems (like Windows or embedded platforms), threading support differs. The library macros such as `GTEST_HAS_PTHREAD` determine thread-related capabilities. Review platform-specific guides if you encounter threading errors.

### 4.5. Macros and Compiler Warnings
- Define mock methods using `MOCK_METHOD` macros appropriately in the public section of your mock classes.
- Wrap complex template parameters or types with commas inside additional parentheses to avoid macro parsing errors.

### 4.6. Using GoogleMock in Embedded or Arduino
- See platform-specific startup examples in `gmock_main.cc` found in the source. Initialization usually involves calling `InitGoogleMock()` with no parameters.

---

## 5. Best Practices

- Use **CMake FetchContent** for the simplest integration.
- Link against `gmock_main` to avoid writing your own main unless you have special requirements.
- Ensure your mocks are defined with `MOCK_METHOD` macros in the public section.
- Verify thread support and link pthread on POSIX platforms.
- Call `testing::InitGoogleMock` at startup.
- Use verbose flags (`--gmock_verbose=info`) while troubleshooting setup issues.

---

## 6. Helpful References

- [GoogleMock Source `gmock_main.cc`](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc): Example demonstrating the typical main() bootstrapping.
- [Mocking Reference](reference/mocking.md): Detailed macro and API documentation for mocks.
- [gMock Cookbook](gmock_cook_book.md): Recipes on writing mocks and setting expectations.
- [Troubleshooting Common Setup Issues](getting-started/troubleshooting-validation/common-setup-issues.md): For frequent setup errors.
- [Integration with Bazel and CMake](guides/integration-solutions/build-integration.md): To help with build system setups.

---

By following this guide, you will have GoogleTest and GoogleMock properly installed and integrated into your build environment, well-configured for writing and running tests confidently.


<Check>
Remember to check your compiler version supports C++17 and that you consistently call `InitGoogleMock()` before running tests. Linking the correct libraries (`gmock_main`, `gtest_main`, and threading libs) as per your platform is crucial to avoid runtime/link errors.
</Check>

<Warning>
Avoid mixing multiple versions of GoogleTest or GoogleMock binaries within your build; doing so causes subtle linking and runtime failures.
</Warning>

---

For further insights on usage, mocking techniques, and troubleshooting, consult the comprehensive guides such as [gMock for Dummies](gmock_for_dummies.md) and the [Mocking FAQ](gmock_faq.md).


---