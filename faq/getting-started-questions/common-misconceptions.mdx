---
title: "Common Misconceptions and Pitfalls"
description: "Identifies and clarifies typical misunderstandings about test registration, test discovery, assertion behavior, and the relationship between GoogleTest and GoogleMock so users can avoid wasted effort and confusion."
---

# Common Misconceptions and Pitfalls

This FAQ clarifies frequent misunderstandings related to test registration, test discovery, assertion behavior, and the interaction between GoogleTest and GoogleMock. Avoid common traps that can lead to wasted effort or confusing test outcomes by understanding these key points.

---

## Test Registration and Discovery

### Why aren’t my tests running?

Tests may not run if they are not properly registered with the framework. GoogleTest automatically registers tests defined via the `TEST()`, `TEST_F()`, and related macros before entering your `main()` test execution.

- **Ensure tests use proper macros:** Only tests defined with these supported macros will be discoverable.
- **Verify linkage:** Your test object files must be linked into the test executable.
- **Confirm visibility:** Tests defined in source files *not* compiled or linked into the test executable will be invisible.

**Tip:** Use the test runner output or `--gtest_list_tests` flag to confirm which tests are registered.

### What happens when tests have the same name?

GoogleTest requires test case and test names to be unique within the executable. Duplicate names may cause unexpected behavior or prevent discovery.

- Always check your test suite and test names for uniqueness.

### Why are some tests ignored?

Tests may be disabled either explicitly by prefixing test case or test names with `DISABLED_`, or implicitly by test filters (`--gtest_filter`). Confirm neither is unintentionally set.

---

## Assertions and Failures

### What’s the difference between `EXPECT_` and `ASSERT_`?

- **`EXPECT_`**: Non-fatal failures. Test continues executing after failure, reporting all assertion failures.
- **`ASSERT_`**: Fatal failures. Test stops at the failed assertion immediately.

Use `ASSERT_` when further execution makes no sense (e.g., setup failures), and use `EXPECT_` when you want to check multiple conditions before ending the test.

### Why don’t my failed assertions cause the test to stop?

`EXPECT_` assertions report failure but continue test execution. If you want the test to abort after failure, use an appropriate `ASSERT_` macro.

### Are multiple failures reported?

Yes. GoogleTest reports all assertion failures in a test unless a fatal failure (via `ASSERT_`) stops further execution.

---

## GoogleMock Specific Challenges

### When do mock methods get called on the real object instead of the mock?

**Cause:** Only virtual methods can be mocked. If a method isn’t declared `virtual` in the base class, GoogleMock cannot override it.

**Solution:**
- Confirm that methods you want to mock are virtual.
- Use alternative patterns for non-virtual methods, such as dependency injection with templates or adapters.

### Why do I get warnings like “uninteresting function call encountered”?

This means a mock method was called without an `EXPECT_CALL` expectation. This is treated as an "uninteresting call."

- **NaggyMock (default):** prints a warning on uninteresting calls.
- **NiceMock:** suppresses these warnings.
- **StrictMock:** treats these as failures.

If the call is expected but you don’t want to verify it explicitly, suppress warnings by using a `NiceMock` or by adding a catch-all expectation with `EXPECT_CALL(mock, method(_)).Times(AnyNumber());`.

**Important:** Do not add meaningless `EXPECT_CALL`s to silence warnings; only suppress warnings when calls are legitimately expected but not worth verifying.

### Why do "uninteresting" calls print stack traces sometimes and sometimes not?

The verbosity level, controlled by `--gmock_verbose` flag, affects this:
- `info`: full stack trace included
- `warning` (default): warning without stack trace
- `error`: no warnings printed at all

Adjust the verbosity flag to control log noise.

### Why do expectations sometimes seem overridden unexpectedly?

GoogleMock matches expectations in **reverse order** they are declared, with newer rules taking priority.

**Best Practice:**
- Place more general expectations first.
- Place specific expectations later.
- Use sequences or `.RetiresOnSaturation()` where call order matters.

### How do I correctly sequence expected calls?

Use `InSequence` or define `Sequence` objects and associate expectations explicitly with `.InSequence()` to enforce call order.

Example:

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Foo());
  EXPECT_CALL(mock, Bar());
}
```

This ensures `Foo()` is called before `Bar()`.

### Why do I get "actions ran out" warnings?

`WillOnce()` actions specify exactly what happens on sequential calls. If a mock method is called more times than `WillOnce()` actions available and no `WillRepeatedly()` action is specified, GoogleMock reverts to the default action and warns.

**Solution:** Specify a `WillRepeatedly()` action to handle calls beyond the `WillOnce()` count, or add `.RetiresOnSaturation()` to expectations that should retire once exhausted.

### How to avoid "leaked mock objects" errors?

GoogleMock expects mock objects to be destructed to verify expectations. Leaking mocks causes incomplete verification.

- Delete mocks when tests finish.
- If intentional leak occurs, suppress errors with `Mock::AllowLeak(&mock_object);`.

### Can I mock methods that take or return move-only types?

Yes. Simply use `MOCK_METHOD` to declare such methods. Use lambdas for specifying actions that produce new move-only objects on each call, as `Return(std::move(...))` can only be called once.

Example:

```cpp
EXPECT_CALL(mock_buzzer_, MakeBuzz("hello"))
    .WillRepeatedly([](StringPiece) { return std::make_unique<Buzz>(); });
```

### How can I mock overloaded methods?

Define a mock for each overload in your mock class. If some overloads are not mocked, bring them into scope with `using BaseClass::Method;` to avoid hiding them unintentionally.

### Why am I getting errors when mocking methods with commas in template types?

`MOCK_METHOD` macro requires any types containing commas (such as `std::pair<bool, int>`) to be enclosed in an additional pair of parentheses or replaced by type aliases.

Example:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```

### Why should I prefer `ON_CALL` over `EXPECT_CALL` for default behavior?

`ON_CALL` specifies *what* a mock does on calls, without setting expectations. Use it to define default behavior shared by multiple tests.

`EXPECT_CALL` combines behavior with expectation that a call occurs.

Overusing `EXPECT_CALL` can lead to brittle tests and maintenance overhead. Use `ON_CALL` liberally for default behavior setups and `EXPECT_CALL` sparingly for verifying specific interactions.

---

## GoogleTest and GoogleMock Relationship

### Can I use GoogleMock without GoogleTest?

GoogleMock requires GoogleTest infrastructure to run. They are tightly integrated as part of the same framework.

### Are GoogleTest and GoogleMock separate libraries?

Functionally yes, but they are distributed together and configured in tandem.

### What if my project only needs assertion checking without mocks?

Use GoogleTest for assertions and lightweight unit tests; integrate GoogleMock only when you need mock functionality.

### How do mocks integrate with test discovery?

Mocks add no additional steps to test discovery; tests using mocks register normally with GoogleTest macros.

### Why do mock verification failures sometimes print multiple error messages?

GoogleMock prints detailed diagnostics on each failure; repeated messages represent different points during test execution, helping pinpoint issues precisely.

---

## Practical Tips and Best Practices

- **Set expectations before exercising the mock.** Setting `EXPECT_CALL` after calling a mock method leads to undefined behavior.
- **Use sequences or `.RetiresOnSaturation()` to manage sticky expectations carefully.**
- **Use `NiceMock` by default** to avoid noisy uninteresting call warnings unless strict verification is required.
- **Explicitly suppress warnings for uninteresting calls only when the calls are legitimately allowed.**
- **Define virtual destructors for interfaces you mock** to avoid memory leaks.
- **Use default actions in `ON_CALL` to define typical mock behaviors.** Refrain from overly complex behavior definitions in every test.
- **Debug unexpected calls by running with `--gmock_verbose=info` to get detailed call tracing.**

---

## Troubleshooting Common Errors

### "Uninteresting function call encountered - default action taken..."

Means a call happened with no expectation but was allowed by default. If unexpected, add explicit expectation or suppress warnings properly.

### "Mock function called more times than expected..."

Check the cardinality in `Times()`. If you want to allow more calls, adjust `Times()` or add a catch-all expectation.

### "Expected call match failed due to argument mismatch"

Use appropriate matchers or relax argument verification where strict equality is not necessary.

### "Unexpected mock function call"

The function was called with argument values not covered by any active expectation.

### "Leaked mock objects found at program exit"

Ensure you properly delete dynamically allocated mocks or use `Mock::AllowLeak()` if intentional.

### Mocking methods with move-only types causes compile errors

Use lambdas or functors to specify actions instead of hardcoded `Return()` with move-only values.

---

## Additional Resources

- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook (Nice, Strict, Naggy)](https://google.github.io/googletest/gmock_cook_book.html#The-Nice,-the-Strict,-and-the-Naggy)
- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-apis/using-matchers.md)
- [Actions Reference](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-apis/actions-and-side-effects.md)
- [Understanding Uninteresting vs Unexpected Calls](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#uninteresting-vs-unexpected)

---