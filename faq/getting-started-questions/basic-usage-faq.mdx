---
title: "How do I write and run my first test or mock?"
description: "Answers frequent questions about writing simple tests, defining test cases, using basic assertions, and employing key GoogleMock macros. Helps users overcome roadblocks in writing and running their earliest tests."
---

# How do I write and run my first test or mock?

This FAQ addresses common questions and challenges users face when writing simple tests, defining test cases, employing basic assertions, and using key GoogleMock macros for mocking. It is designed to help you successfully create and run your earliest tests and mocks with clarity and confidence.

---

## Frequently Asked Questions

### What is the simplest way to write my very first test using GoogleTest?

Start by including the GoogleTest header and use the `TEST` macro to define a test case and test:

```cpp
#include <gtest/gtest.h>

TEST(ExampleTest, BasicAssertions) {
  // Expect that 1 + 1 equals 2
  EXPECT_EQ(1 + 1, 2);
}
```

Compile and run your test binary, and GoogleTest will automatically discover and run your test, reporting the results clearly.

---

### How do I define and write my first mock class with GoogleMock?

1. Create a mock class by inheriting the interface or base class you want to mock.
2. Use the `MOCK_METHOD` macro in the `public:` section of your mock class to mock virtual methods.

Example:

```cpp
#include <gmock/gmock.h>

// Assume this is the interface:
class Turtle {
 public:
  virtual ~Turtle() = default;
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
};

// Define the mock class:
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};
```

This mock can be used in your tests to set expectations and control behavior.

---

### How do I set expectations and specify behavior on my mock methods?

Use the `EXPECT_CALL` macro to indicate which calls you expect, how often, and what they should do. Example:

```cpp
using ::testing::AtLeast;
using ::testing::Return;

MockTurtle turtle;
EXPECT_CALL(turtle, PenDown())
    .Times(AtLeast(1));  // Expect PenDown to be called at least once
EXPECT_CALL(turtle, Forward(100))
    .WillOnce(Return());  // If Forward returns a value, you can specify it
```

This creates an expectation on the mock method before exercising the code that uses it.

---

### What if I want to define default behavior for mock methods without strict expectations?

Use `ON_CALL` to define a mock method’s default behavior without setting an expectation that it must be called. This prevents warnings for uninteresting calls:

```cpp
ON_CALL(turtle, GetX())
    .WillByDefault(Return(42));
```

This means if `GetX()` is called but no `EXPECT_CALL` matches, it returns 42 by default.

---

### How do I handle methods with multiple calls returning different results?

Chain multiple `WillOnce` and optionally a `WillRepeatedly` for the default after those:

```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));
```

This means `GetX()` returns 10 on the first call, 20 on the second, and 30 thereafter.

---

### How do I deal with methods that have overloaded versions?

Mock each overload separately by specifying the full method signature and qualifiers:

```cpp
MOCK_METHOD(int, Describe, (const char* name), (override));
MOCK_METHOD(int, Describe, (int type), (override));
```

Use `EXPECT_CALL(mock, Describe(arg))` specifying arguments or matchers appropriate to each overload.

---

### What are matchers and how do I use them in expectations?

Matchers specify constraints on method arguments in expectations, allowing flexible verification:

- Use `_` to match any value.
- Use predefined matchers like `Eq()`, `Ge()`, `NotNull()`, etc.

Examples:

```cpp
EXPECT_CALL(turtle, Forward(Ge(100)));  // Forward should be called with a value >= 100
EXPECT_CALL(turtle, GoTo(50, _));       // GoTo called with first arg 50, second any
```

Omitting arguments matches any arguments (only for non-overloaded methods):

```cpp
EXPECT_CALL(turtle, PenUp);  // Expects any call to PenUp()
```

---

### How do I handle uninteresting or unexpected method calls in mocks?

- Uninteresting calls: Calls to mock methods without any expectations set. These cause warnings but do not fail tests by default.
- Unexpected calls: Calls that do not match any expectation. These always cause test failures.

To suppress warnings for uninteresting calls, use `NiceMock`:

```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> nice_turtle;
```

To make uninteresting calls fail (strict checking), use `StrictMock`.

---

### What are cardinalities and how do I specify how many times a method is expected to be called?

Cardinalities describe the expected number of calls and are set via `.Times()` in `EXPECT_CALL`:

| Cardinality          | Description                            |
|---------------------|------------------------------------|
| `Times(1)` (default) | Exactly once                        |
| `AtLeast(n)`          | At least `n` calls                 |
| `AtMost(n)`           | At most `n` calls                  |
| `Between(m, n)`       | Between `m` and `n` calls inclusive|
| `AnyNumber()`         | Any number of calls                |
| `Times(0)`            | Method should not be called        |

Examples:

```cpp
EXPECT_CALL(turtle, PenUp()).Times(0);  // No calls expected
EXPECT_CALL(turtle, Forward(_)).Times(AnyNumber());  // Any number okay
```

---

### How do I ensure calls happen in a specific order?

Use `InSequence` to enforce ordering among expectations within its scope:

```cpp
{
  ::testing::InSequence seq;

  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

Calls must occur in this order or the test will fail.

For more complex partial orders, use `.After()` clauses and `Sequence` objects.

---

### How do I handle calls with side effects or output parameters in mocks?

Use predefined actions such as `SetArgPointee<N>(value)` to set output arguments:

```cpp
EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(SetArgPointee<1>(42));  // Sets second argument pointed value to 42
```

Combine side effects and return values with `DoAll`:

```cpp
EXPECT_CALL(mock, MutateInt(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

---

### How to debug failing tests due to mock expectation mismatches?

- Run the test with `--gmock_verbose=info` to get detailed call tracing.
- Check for mismatches in method arguments and call counts.
- Verify order constraints if using sequences or `.After()`.
- Ensure all expectations are set *before* exercising the mock.

---

## Common Issues & Tips

- **Unprotected commas in types**:
  When mocking methods with comma-containing types (e.g., `std::pair<bool, int>`), wrap the type in parentheses or define a type alias to avoid compile errors.

- **Expectations set after calls**:
  Always set `EXPECT_CALL` before invoking the mock method. Setting them after leads to undefined behavior.

- **Missing virtual destructors**:
  Interfaces to be mocked must have a virtual destructor to avoid undefined behaviors when deleting through base pointers.

- **Expectations “stickiness”**:
  Expectations remain active even if their call count upper bound is reached, potentially causing failures on subsequent calls unless `RetiresOnSaturation()` is used.

- **Handling move-only types**:
  GoogleMock supports mocking methods that take or return move-only types (like `std::unique_ptr`) using `MOCK_METHOD` as usual.

- **Suppressing uninteresting call warnings**:
  Use `NiceMock<T>` to suppress warnings for calls that have no expectations.

- **Using lambdas and callables in actions**:
  You can specify complex behavior using lambdas with `WillOnce()` and `WillRepeatedly()`.

---

## Sample Workflow: Writing and Running Your First Test and Mock

<Steps>
<Step title="Define a simple test">
Write a test function using the `TEST` macro with basic assertions.
</Step>
<Step title="Create a mock class">
Define a mock class inheriting from your interface, using `MOCK_METHOD` to mock methods.
</Step>
<Step title="Set expectations">
Before exercising code, use `EXPECT_CALL` to specify method calls, arguments, call counts, and behaviors.
</Step>
<Step title="Run the test">
Compile and run your tests; GoogleTest will discover and execute them, verifying mock expectations.
</Step>
<Step title="Debug failures">
If failures occur, enable `--gmock_verbose=info` and analyze messages to find mismatches or sequence violations.
</Step>
</Steps>

---

## Troubleshooting Tips

- **Test fails unexpectedly due to uninteresting calls:** Use `NiceMock` or add catch-all `EXPECT_CALL` with `Times(AnyNumber())`.
- **Compiler errors with `MOCK_METHOD`:** Check for unprotected commas in type signatures and use parentheses or typedef replies.
- **Multiple `WillOnce` and `WillRepeatedly` clauses incorrect order:** Follow the correct clause order to avoid runtime enforcement errors.
- **Over-specified expectations causing brittle tests:** Avoid overly strict argument matchers when not necessary.

---

For a comprehensive dive, refer to the [Mocking Reference](docs/reference/mocking.md), [gMock Cookbook](docs/gmock_cook_book.md), and [gMock for Dummies](docs/gmock_for_dummies.md).

---

## See Also

- [gMock for Dummies](docs/gmock_for_dummies.md) — A basic introduction
- [Mocking Reference](docs/reference/mocking.md) — Macro details and deeper concepts
- [gMock Cookbook](docs/gmock_cook_book.md) — Practical recipes for mocking
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) — Quick macro and usage guide
- [Writing Your First Test](getting-started/first-test-run/writing-first-test.md) — For GoogleTest basics
- [Running and Validating Tests](getting-started/first-test-run/running-tests.md) — Test execution

---

<Tip>
Remember: The key to effective mock testing is to set expectations that match your test's intent—no more, no less—and to define default behaviors with `ON_CALL` to avoid unnecessary failures and warnings.
</Tip>

<Tip>
Always place your `EXPECT_CALL` before the code being tested to ensure predictable behavior.
</Tip>