---
title: "Why do my assertions or matchers behave unexpectedly?"
description: "Addresses misunderstandings with assertions, expectation syntax, and matcher behaviors in both GoogleTest and GoogleMock. Includes troubleshooting steps for unexpected failures or surprising test outcomes."
---

# Why Do My Assertions or Matchers Behave Unexpectedly?

Understanding unexpected behavior in GoogleTest assertions and GoogleMock expectations can save you time and help you create robust, maintainable tests. This FAQ addresses common misunderstandings with assertions, expectation syntax, and matcher behaviors in both GoogleTest and GoogleMock, and provides practical troubleshooting guidance for surprising test outcomes.

---

## 1. Common Causes of Unexpected Assertion or Matcher Behavior

### Incorrect Argument Matching in EXPECT_CALL
An expectation such as `EXPECT_CALL(mock, Method(arg_matchers))` only matches calls where arguments satisfy these matchers exactly. If the actual arguments differ, GoogleMock flags the call as unexpected.

**Example:**
```cpp
EXPECT_CALL(foo, Bar2(0, _));
foo.Bar2(1, 0);  // This call fails because arg #0 is 1, not 0.
```

### Sticky Expectations and Call Counts
Expectations remain active until they are explicitly *retired* or go out of scope. If you expect a call to occur *exactly once* but it happens multiple times, GoogleMock reports a failure.

**Tip:** Use `.RetiresOnSaturation()` to make an expectation retire as soon as it's satisfied.

### Insufficient or Excessive Actions
Mismatches between `.WillOnce()` actions and expected call counts cause warnings:
- Too few `.WillOnce()` actions for the expected calls leads to default actions taking effect unexpectedly.
- More `.WillOnce()` actions than allowed triggers warnings.

### Misuse Between ON_CALL and EXPECT_CALL
- `ON_CALL` sets *default behavior* without expectations.
- `EXPECT_CALL` sets *expectations* and behavior.

Adding `EXPECT_CALL`s where you don't intend to enforce calls can make tests brittle and noisy.

### Uninteresting vs Unexpected Calls

- **Uninteresting calls**: Methods without an `EXPECT_CALL` but called. Usually print warnings but don't fail tests.
- **Unexpected calls**: Calls that don't match any active `EXPECT_CALL`. Always treated as errors.

Consider using `NiceMock` to suppress warnings on uninteresting calls when appropriate.

### Over-specification Leading to Fragile Tests
Tests with over-specified matchers or strict call orders may break due to internal changes that don’t affect contract.

Strive to specify only necessary constraints, and use loose matchers (`_`) where appropriate.


## 2. Best Practices to Avoid Surprising Behavior

### Use Matchers Thoughtfully
Use wildcard matcher `_` when you don’t care about specific arguments:
```cpp
EXPECT_CALL(mock, Method(_, _));  // Accept any arguments
```

Use specific matchers like `Eq()`, `Ge()`, `Ref()` etc. only when necessary.

### Use Action Clauses Correctly
- Chain `.WillOnce()` and `.WillRepeatedly()` carefully. The order matters.
- Avoid specifying fewer actions than expected calls.
- Retire expectations after use if calls are expected in sequence.

### Control Call Ordering Explicitly
Use `InSequence` or `After` clauses to constrain call order only if necessary, to keep tests resilient.

### Handle Overloaded Methods Explicitly
Disambiguate overloaded mock methods by specifying signatures or using `Const()` wrapper:
```cpp
EXPECT_CALL(mock, GetBar()).WillOnce(ReturnRef(bar1));
EXPECT_CALL(Const(mock), GetBar()).WillOnce(ReturnRef(bar2));
```

### Avoid Leaking Mocks
Properly manage lifetimes of your mocks to ensure expectations are verified. Use `Mock::AllowLeak()` to suppress errors only when intentional.

### Suppress Uninteresting Call Warnings Intentionally
If some methods are called but not verified, suppress warnings via `NiceMock` or add catch-all expectations:
```cpp
EXPECT_CALL(mock, Method(_)).Times(AnyNumber());
```


## 3. Troubleshooting Unexpected Failures

### Enable Verbose Logging
Run tests with `--gmock_verbose=info` to trace matching of mock calls:
```bash
your_test_binary --gmock_verbose=info
```
This shows which expectations matched or failed, with argument detail and call stack.

### Verify Matchers Against Actual Arguments
Read failure messages carefully to see which argument didn’t match.

### Check Cardinality Constraints
Ensure your `.Times()` clauses match the actual number of calls.

### Review Sequencing and Prerequisites
Validate that prerequisites (`.After()`, `.InSequence()`) are satisfied before calls occur.

### Confirm Default Actions Are Set When Needed
If an unexpected call occurs, verify if `ON_CALL` or default return values are properly configured.


## 4. Examples of Common Failure Scenarios

### Unexpected Call Due to Argument Mismatch
```
EXPECT_CALL(foo_, Bar2(0, _));
foo_.Bar2(1, 0);  // Fails: arg #0 is 1, expected 0
```

### Excessive Call Without Retiring Expectation
```
EXPECT_CALL(foo_, Bar2(0, _));
foo_.Bar2(0, 0);  // OK
foo_.Bar2(0, 1);  // Fails: too many calls
```

### Too Few `.WillOnce()` Actions Specified
```
EXPECT_CALL(foo_, Bar2(_, _)).Times(2).WillOnce(Return(false));
foo_.Bar2(2, 2);  // OK
foo_.Bar2(1, 1);  // Default action used with warning
```

### Uninteresting Calls Trigger Warnings
```
foo_.Bar2(0, 1);  // Warns since no EXPECT_CALL matches
```

### Retired Expectations Not Matching
```
EXPECT_CALL(foo_, Bar2(_, _)).RetiresOnSaturation();
EXPECT_CALL(foo_, Bar2(0, 0));

foo_.Bar2(1, 1);  // Fails: matched retired expectation
```


## 5. Summary of Key Concepts

| Concept                         | Description                                                     |
| -------------------------------|----------------------------------------------------------------|
| `EXPECT_CALL`                  | Set an expectation and action for a mock method call           |
| `ON_CALL`                     | Set default behavior without expectation                        |
| Matchers (e.g., `_`, `Eq()`)   | Specify argument matching criteria                             |
| Cardinality (`Times()`)        | Specify how many times a method is expected to be called        |
| Actions (`WillOnce()`, `WillRepeatedly()`) | Define method return/behavior                                   |
| Uninteresting Calls            | Calls without expectations triggering warnings                 |
| Unexpected Calls              | Calls violating expectations causing test failures             |
| Retiring Expectations          | Using `.RetiresOnSaturation()` to disable expectation after calls|
| Sequences (`InSequence`, `After`) | Control call order                                            |


## 6. Additional Resources

- [GoogleMock Mocking Reference](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#UseOnCall)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
- [Common Setup Issues](https://google.github.io/googletest/getting-started/setup-troubleshooting/common-setup-issues.html)


---

<Tip>
Use `ON_CALL` to set a mock method's *default behavior* without requiring the method to be called, and use `EXPECT_CALL` only to specify calls you intend to verify. This prevents overly brittle tests and unexpected failures.
</Tip>

<Warning>
Do not silently add `EXPECT_CALL`s to suppress uninteresting call warnings unless you truly want to enforce those calls — this can make your tests fragile and high-maintenance.
</Warning>

<Check>
If you see unexpected failures, run tests with `--gmock_verbose=info` to track how GoogleMock matches calls to expectations.
</Check>