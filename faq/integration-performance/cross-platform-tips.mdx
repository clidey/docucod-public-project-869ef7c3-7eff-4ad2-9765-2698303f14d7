---
title: "Tips for Cross-Platform and Embedded Use"
description: "Provides best practices and known workarounds for running tests on different operating systems and embedded platforms, covering environment configuration, platform-specific flags, and feature limitations."
---

# Tips for Cross-Platform and Embedded Use

This page presents essential best practices and known workarounds when running GoogleTest and GoogleMock tests across various operating systems and embedded platforms. It addresses environment configurations, platform-specific compiler and linker flags, features availability, and limitations encountered in constrained or specialized environments.

---

## 1. Cross-Platform Support Overview

GoogleTest and GoogleMock are designed with portability in mind and support a wide range of platforms including mainstream desktop operating systems and select embedded platforms. The frameworks detect the target environment at compile time using platform macros, enabling adaptions per operating system or architecture.

Common supported platforms include:

- Windows (Desktop, Mobile, MinGW)
- Linux (including Android variants)
- macOS and iOS
- Embedded platforms such as ESP8266, ESP32, and NRF52

---

## 2. Platform Detection Macros

Platform-specific code and configurations often use predefined macros such as:

| Macro Name               | Description                                |
|--------------------------|--------------------------------------------|
| `GTEST_OS_WINDOWS`       | Running on Windows OS                      |
| `GTEST_OS_LINUX`         | Running on Linux                           |
| `GTEST_OS_MAC`           | Running on macOS                          |
| `GTEST_OS_ESP8266`       | Embedded ESP8266 platform                 |
| `GTEST_OS_ESP32`         | Embedded ESP32 platform                   |
| `GTEST_OS_NRF52`         | Nordic NRF52-based embedded platform     |

These macros are automatically set in the build environment and are available for conditional compilation to adapt to platform constraints or requirements.

---

## 3. Environment Configuration for Embedded Platforms

Embedded platforms such as ESP8266, ESP32, and NRF52 have unique requirements and limited resources, so GoogleTest provides tailored integration helpers:

- **Arduino Setup and Loop Functions:**
  - On these embedded targets, typical `main()` entry points do not apply. Instead, tests run inside Arduino's `setup()` and `loop()` functions.
  - GoogleMockâ€™s `gmock_main.cc` defines `setup()` to initialize GoogleMock and `loop()` to repeatedly invoke `RUN_ALL_TESTS()`.

Example (automatic for ESP platforms):

```cpp
void setup() {
  testing::InitGoogleMock();
}
void loop() {
  RUN_ALL_TESTS();
}
```

- **No explicit call to `InitGoogleTest()` needed:**
  GoogleMock initialization covers GoogleTest initialization internally.

- **Note:** Continuous invocation in `loop()` can be customized as needed.

---

## 4. Platform-Specific Compiler and Linker Flags

### Windows

- GoogleTest uses a standard `main()` function for Windows desktop.
- Visual Studio projects should set **runtime linkage** consistently (static or dynamic). Use `gtest_force_shared_crt` CMake option to ensure shared runtime linkage for compatibility.

### Unix-like Systems

- GoogleTest auto-detects pthread availability. You may need to explicitly define `-DGTEST_HAS_PTHREAD=1` and link pthread manually if your build environment does not do so automatically.

### Embedded Platforms

- May require disabling threading with `-DGTEST_HAS_PTHREAD=0` due to lack of threading or pthread support.
- Some system calls used by GoogleTest are stubbed or unsupported; code adapts accordingly.

### C++ Standard

- GoogleTest requires **C++17 or later**. Ensure your compiler flags include setting the standard, e.g., `-std=c++17`.

---

## 5. Feature and Limitation Flags

GoogleTest exposes macros to conditionally compile code based on platform capabilities:

| Macro                      | Description                            | Typical Value on Embedded Platforms |
|----------------------------|--------------------------------------|------------------------------------|
| `GTEST_HAS_PTHREAD`        | Whether pthreads are supported        | `0`                                |
| `GTEST_HAS_STD_WSTRING`    | Availability of `std::wstring`        | Often `0` for limited STL          |
| `GTEST_HAS_FILE_SYSTEM`    | Availability of file system APIs      | Often `0` on bare-metal devices    |
| `GTEST_HAS_STREAM_REDIRECTION` | Support for stdout/stderr capture | Often `0` on embedded platforms    |
| `GTEST_HAS_EXCEPTIONS`     | Whether C++ exceptions are enabled    | May be `0` if disabled             |

Adjust your test code or build scripts to exclude features not supported on your target.


---

## 6. Best Practices for Embedded and Specialized Platforms

- **Customizing Temporary Directory:**
  - Override `testing::TempDir()` if default file system paths are unavailable.
  - Define `GTEST_CUSTOM_TEMPDIR_FUNCTION_` macro for custom temp directory logic.

- **Handling Limited I/O:**
  - Stdout and stderr capture features may not be available.
  - Consider redirecting logging outputs to serial ports or platform-specific logs.

- **Threading Considerations:**
  - Disable threading support if unavailable with `-DGTEST_HAS_PTHREAD=0`.
  - Avoid multi-threaded tests on platforms without threading APIs or use cooperative tasking.

- **Reducing Binary Size:**
  - Build GoogleTest and GoogleMock as static libraries with essential flags.
  - Disable unused features with control macros such as `GTEST_HAS_DEATH_TEST` if not needed.

- **Linking and Runtimes:**
  - Match compiler flags for GoogleTest and your application.
  - For Windows, ensure consistent runtime linkage as per [README.md](https://github.com/google/googletest/blob/main/README.md).

- **Continuous Integration:**
  - Automate environment variable or flag settings based on target platforms.
  - Avoid test reliance on unavailable OS features.

---

## 7. Common Issues and Workarounds

### Issue: GoogleTest fails to run tests on ESP8266/ESP32

**Cause:** Platform expects setup/loop instead of `main()`.

**Solution:**
- Link with `gmock_main.cc` which provides correct `setup()`/`loop()` implementations.
- Ensure `testing::InitGoogleMock()` is called inside `setup()` as per built-in logic.

### Issue: Missing pthread or threading support errors

**Cause:** Target platform has no pthread or threading APIs.

**Solution:**
- Add `-DGTEST_HAS_PTHREAD=0` to your compiler flags.
- Avoid code paths relying on threads or mutexes in tests.

### Issue: Linking errors with runtime libraries on Windows

**Cause:** Mixing static and dynamic CRT runtimes.

**Solution:**
- Use CMake option `gtest_force_shared_crt` to align runtimes for GoogleTest library.
- Review user project compiler runtime flags to match.

### Issue: Limitations in `std::wstring` support

**Cause:** Embedded platforms often lack full wide string support.

**Solution:**
- Avoid using tests that require wide strings on unsupported targets.
- Wrap wide string tests with conditional compilation macros.

---

## 8. Summary and Helpful Links

- GoogleTest provides robust cross-platform macros and abstractions detecting OS and environment capabilities for seamless portability.
- Embedded platforms require special setup, especially concerning the program entry point and feature availability.
- Compiler flags for threading, runtime linkage, and C++ standard versions are crucial to successful builds.

For further information, consult:

- [GoogleTest Primer - Platform Portability](https://github.com/google/googletest/blob/main/docs/primer.md#platform-portability)
- [README.md - Build Instructions and Environmental Configuration](https://github.com/google/googletest/blob/main/README.md)
- References for platform macro definitions and configuration flags in `gtest-port.h` and `gmock-port.h` (internal headers)
- CMake build options for embedded environments and flag overrides

---

## 9. Example: Minimal Embedded Test Integration

```cpp
#include <gmock/gmock.h>

#if defined(GTEST_OS_ESP8266) || defined(GTEST_OS_ESP32) || \
    (defined(GTEST_OS_NRF52) && defined(ARDUINO))

extern "C" {
void setup() {
    testing::InitGoogleMock();
}

void loop() {
    RUN_ALL_TESTS();
}
}

#else

int main(int argc, char** argv) {
    testing::InitGoogleMock(&argc, argv);
    return RUN_ALL_TESTS();
}

#endif
```

This pattern leverages GoogleMock's integrated entry points for embedded platforms while providing a normal `main()` for desktop and server targets.

---

## 10. Troubleshooting Tips

- Always verify the effective defines and platform macros after project configuration; incorrect or missing defines can cause build failures.
- Use verbose GoogleTest flag `--gtest_verbose` to debug initialization and environment-related issues.
- Confirm the C++ standard compliance of your compiler toolchain.
- On embedded systems, test your output stream redirection separately if using custom handlers.



---

*This page helps ensure your GoogleTest and GoogleMock tests run successfully across all target platforms by applying the right flags, abiding by platform conventions, and using provided abstractions.*

---

### Related Documentation

- [System Requirements & Supported Platforms](https://github.com/google/googletest/blob/main/getting-started/gs-prerequisites-installation/gs-system-requirements.md)
- [Building with CMake](https://github.com/google/googletest/blob/main/README.md#build-with-cmake)
- [GoogleMock Main Integration for Embedded](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc)
- [Platform Macros Reference](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port-arch.h)
- [GoogleMock Port and Flags](https://github.com/google/googletest/blob/main/googlemock/include/gmock/internal/gmock-port.h)

---