---
title: "Integrating with CMake, Bazel, and Other Build Systems"
description: "Clarifies the supported ways to integrate GoogleTest and GoogleMock with popular build tools, how to handle dependencies, and common pitfalls during integration."
---

# Integrating with CMake, Bazel, and Other Build Systems

GoogleTest and GoogleMock offer flexible integration options with popular C++ build systems like CMake and Bazel. This page guides you through supported approaches to incorporating these frameworks into your projects, managing dependencies, and avoiding common integration pitfalls.

---

## Overview

Integrating GoogleTest and GoogleMock properly is crucial to building reliable, maintainable, and performant test suites that fit your development workflow. Whether you are starting a new project or adding testing to an existing one, this guide sets out practical workflows for the most common build systems, emphasizing user-focused tasks such as configuration, linking, and dependency management.

---

## Integrating with CMake

CMake is the officially supported build tool for GoogleTest and GoogleMock, favored for its cross-platform capabilities and wide adoption.

### Standalone GoogleTest Build

The simplest approach is to build GoogleTest/GoogleMock as a standalone project and then link to its installed libraries:

<Steps>
<Step title="Clone the Repository">
Run:

```bash
git clone https://github.com/google/googletest.git -b main
default-directory
```

This retrieves the latest GoogleTest including GoogleMock.
</Step>

<Step title="Create and Enter Build Directory">

```bash
mkdir build
cd build
```

This keeps build artifacts separate.
</Step>

<Step title="Generate Build Files with CMake">

```bash
# Build both GoogleTest and GoogleMock by default
cmake ..
```

For building only GoogleTest, omit GoogleMock by specifying:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

</Step>

<Step title="Build and Install">

```bash
make
sudo make install
```

Installs headers and libraries to system locations, typically `/usr/local/`.
</Step>
</Steps>

### Using GoogleTest from Installed Libraries

Once installed, integrate GoogleTest into your project by using `find_package` and linking against the imported targets:

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main GTest::gmock)
add_test(NAME my_tests COMMAND my_tests)
```

This approach automatically handles include paths and library dependencies.

### Incorporating GoogleTest as a Subdirectory

For tighter integration and to ensure consistent compiler settings:

- Add GoogleTest as a git submodule or download it into your project tree.
- In your `CMakeLists.txt`, add:

```cmake
add_subdirectory(googletest)
add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests PRIVATE gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

This builds GoogleTest and GoogleMock as part of your build.

### Important Configuration Notes

- **C++ Standard:** GoogleTest requires C++17 or higher. Set this in your project:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

- **Runtime Library Compatibility on Windows:** If using MSVC, match runtime libraries by enabling `gtest_force_shared_crt`:

  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```

- **Threads:** GoogleTest detects and links pthreads on *nix platforms when available. No special action is needed unless your platform requires manual specification.

---

## Integrating with Bazel

Bazel users benefit from rules curated for building, testing, and managing dependencies of GoogleTest and GoogleMock.

### Setup

- Add GoogleTest and GoogleMock dependencies in your `WORKSPACE` file with appropriate `http_archive` or use Bazel Central Registry packages.

### BUILD Targets

- Define test targets that depend on `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` for mocking capabilities.

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cpp"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"]
)
```

### Helpful Practices

- Use Bazel's native dependency management to isolate test code and dependencies.
- Leverage Bazel's sandboxing and caching for faster incremental builds.

---

## Managing Dependencies and Linking

Whether with CMake, Bazel, or other build tools, managing dependencies and linking correctly is key to avoiding typical failures.

### Use `gtest_main` or `gmock_main` Libraries

- Prefer linking with `gtest_main` or `gmock_main` which provide an appropriate `main()` function:

  - Use `gtest_main` if you only use GoogleTest.
  - Use `gmock_main` if you use GoogleMock.

- Alternatively, provide your own `main()` that calls `testing::InitGoogleTest()` or `testing::InitGoogleMock()`, then `RUN_ALL_TESTS()`.

### Link Order and Transitive Dependencies

- Always link test executables against GoogleTest libraries after your test and production code objects.
- Include GoogleMock (`gmock`/`gmock_main`) after GoogleTest if mocking is used.
- For multithreaded environments, ensure platform threading libraries (e.g., pthreads on Linux) are linked.

---

## Common Integration Pitfalls

<AccordionGroup title="Troubleshooting Common Integration Issues">
<Accordion title="Linker Errors due to Missing Symbols">

**Symptom:** Unresolved external symbols related to GoogleTest or GoogleMock.

**Possible Causes & Fixes:**
- Did you link against `gtest_main` or `gmock_main`?
- Are `gtest` and `gmock` libraries properly linked?
- In CMake, verify `find_package(GTest REQUIRED)` succeeded and targets are linked.

</Accordion>

<Accordion title="Mismatch of Runtime Libraries on Windows">

**Symptom:** LNK2038 runtime library mismatch error.

**Fix:** Set `gtest_force_shared_crt` to `ON` in your CMake configuration to align runtimes.

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

</Accordion>

<Accordion title="C++ Standard Not Set Correctly">

**Symptom:** Compiler errors related to C++ features.

**Fix:** Ensure your project enables at least C++17:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

</Accordion>

<Accordion title="Incorrect Include Paths">

**Symptom:** Compilation errors about missing headers (`gtest/gtest.h` or `gmock/gmock.h`).

**Fix:** Confirm that include directories from GoogleTest and GoogleMock are added to your build system.
- With CMake, imported targets handle this.
- With other systems, you may need to manually add include directories.

</Accordion>
</AccordionGroup>

---

## Best Practices for Smooth Integration

- Prefer using GoogleTestâ€™s official `CMakeLists.txt` and Bazel build files as models.
- Avoid mixing different compiler or runtime library flags between GoogleTest and your project.
- Use subdirectory inclusion (`add_subdirectory`) in CMake for seamless builds and configuration consistency.
- Link against the exact libraries you need; avoid redundant linking that can cause conflicts or bloat.
- When contributing to larger projects or CI, automate dependency fetching with CMake `FetchContent` or Bazel WORKSPACE rules.

---

## Summary Diagram: CMake Integration Workflow

```mermaid
flowchart TD
  A[Start: User Project] --> B[Add googletest as Subdirectory or Install]
  B --> C{Choose Integration Method}
  C -->|Subdirectory| D[add_subdirectory(googletest)]
  C -->|Find Installed| E[find_package(GTest CONFIG REQUIRED)]
  D --> F[Link target to gtest_main / gmock_main]
  E --> F
  F --> G[Write Test Source Files]
  G --> H[Build Test Executable]
  H --> I[Run Tests with CTest or Directly]
```

---

## Additional Resources

- [GoogleTest Primer](/overview/introduction-getting-started/what-is-googletest)
- [Installing with CMake](/getting-started/gs-prerequisites-installation/gs-install-cmake)
- [Installing with Bazel](/getting-started/gs-prerequisites-installation/gs-install-bazel)
- [Troubleshooting Common Setup Issues](/faq/getting-started-faq/common-setup-issues)
- [Integrating Build Systems Guide](/guides/integration-advanced/integrating-build-systems)

---

<Tip>
If you want to customize the behavior of GoogleTest or GoogleMock, such as enabling shared runtimes or disabling specific warnings, leverage CMake configuration options and verify your build log for applied flags.
</Tip>

<Note>
For projects with complex or legacy build systems, consider gradually migrating tests to a modern build system (e.g., CMake or Bazel) for improved stability and support.
</Note>

<Warning>
Mixing debug and release runtime libraries between GoogleTest, GoogleMock, and your code can cause subtle runtime crashes and link errors. Always align build configurations consistently.
</Warning>

---

By following these guidelines, you will ensure reliable integration of GoogleTest and GoogleMock with your build system, setting a solid foundation for robust automated testing in your C++ projects.
