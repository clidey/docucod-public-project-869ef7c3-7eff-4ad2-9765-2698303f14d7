---
title: "Build System & IDE Integration"
description: "Answers to frequent questions about using GoogleTest with CMake, Bazel, and other build systems; includes advice for integrating with popular IDEs."
---

# Build System & IDE Integration FAQ

This FAQ provides practical answers and guidance for integrating and using GoogleTest with common build systems such as CMake and Bazel, as well as with popular Integrated Development Environments (IDEs). It covers key aspects of configuration, linking, troubleshooting, and best practices to ensure smooth build and test workflows.

---

## 1. Using GoogleTest with CMake

### How do I include GoogleTest or GoogleMock in my CMake project?

To use GoogleTest (and GoogleMock) in your CMake-based project, the simplest and most robust approach is to either:

- Use `find_package(GTest CONFIG REQUIRED)` if GoogleTest is installed on your system.
- Add GoogleTest as a submodule or download its source and include it directly into your project using `add_subdirectory()`.

For example, using FetchContent to integrate GoogleTest and GoogleMock automatically:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Visual Studio runtime consistency
FetchContent_MakeAvailable(googletest)

add_executable(MyTest test.cpp)
target_link_libraries(MyTest GTest::gtest_main GTest::gmock)
add_test(NAME MyTest COMMAND MyTest)
```

This ensures your tests link against the correct GoogleTest and GoogleMock libraries with consistent compiler and linker settings.

### What should I link against to use GoogleMock's main function?

If you prefer to use the built-in `main()` function provided by GoogleMock instead of writing your own, link with the `gmock_main` target:

```cmake
target_link_libraries(MyTest GTest::gmock_main)
```

This variant includes GoogleMock and GoogleTest with the included `main()`.

If you want to write your own `main()`, link with `gmock` and `gtest_main` instead.

### How to handle compiler/runtime library conflicts on Windows?

Visual Studio projects often default to dynamic runtime linkage (`MD`, `MDd`), but GoogleTest by default uses static linkage (`MT`, `MTd`). This can cause linker errors:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

To resolve this:

- Enable `gtest_force_shared_crt` option in your CMake to force GoogleTest to link dynamically.
- Make sure your project and GoogleTest use consistent runtime linkage.

Example:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

Also, for MSVC, GoogleMock enables stricter compiler warnings to avoid common build issues.

---

## 2. Using GoogleTest with Bazel

### How do I add GoogleTest dependencies in Bazel BUILD files?

GoogleTest and GoogleMock are available as Bazel external repositories. To use them, add the following to your `WORKSPACE`:

```starlark
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.12.1.tar.gz"],
    strip_prefix = "googletest-release-1.12.1",
)
```

Then in your `BUILD` file:

```starlark
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//googletest:googletest_main",
            "@com_google_googletest//googlemock:googlemock_main"],
)
```

This links your test target to GoogleTest and GoogleMock with main included.

### Can I customize the test runner or main function with Bazel?

Yes, you can omit `googlemock_main` and instead link with `gmock` and `gtest_main` individually and provide your own `main()` if desired.

---

## 3. IDE Integration Tips

### How can I run GoogleTest tests inside Visual Studio or CLion?

- **Visual Studio:**
  - Use the Visual Studio Test Explorer which automatically detects GoogleTest-based tests if the tests are built with correct GoogleTest linkage.
  - Link your test binary with `gtest_main` or `gmock_main`.
  - Use CMake integration in Visual Studio 2019+.

- **CLion:**
  - CLion has built-in support for GoogleTest test discovery.
  - Configure your CMake project to include GoogleTest and build test targets.
  - Run/debug tests directly from the IDE's test runner panel.

### How do I enable debugging in IDEs for GoogleTest tests?

Build your test binary with debug symbols enabled by setting

```cmake
set(CMAKE_BUILD_TYPE Debug)
```

in your CMake configuration or the equivalent debug mode in your IDE.

Launch tests in debug mode from your IDE. The debugger will stop on assertions or breakpoints inside tests or mocks.

### Are there any known common pitfalls integrating with IDEs?

- Ensure all GoogleTest and GoogleMock dependencies are correctly found and linked by your IDE.
- On Windows, verify runtime library consistency as explained above.
- Some IDEs may not correctly parse custom macros or advanced template code. Keep mock definitions simple when rapid iteration is needed.
- Use `gmock_main` if you don't want to define a custom `main()` in test binaries.

---

## 4. Common Errors & Their Fixes

### Error: Undefined reference to `main` when linking tests

This usually means you linked with `gmock` or `gtest` libraries without linking their respective `_main` variant or without defining your own `main()`.

**Solution:** Link with `gmock_main` or `gtest_main` to get the built-in main function, or write your own `main` in your test executable.

### Warning: Multiple definitions of `main`

If you define your own `main()` and also link to `gmock_main` or `gtest_main`, you will get duplicate symbol errors.

**Solution:** Link either:

- With `gmock` and `gtest` (no `_main`) if you provide your own `main()`, or
- With `gmock_main` or `gtest_main` and **do not** define `main()` yourself.

### Linking fails on pthread symbols on Linux

If you see errors about pthread functions, it means the pthread library was not linked.

**Solution:**

- Add `find_package(Threads REQUIRED)` and link with `${CMAKE_THREAD_LIBS_INIT}` in your CMakeLists.txt.
- The gtest CMake scripts generally handle this if used properly.

### Tests don't run or no output from RUN_ALL_TESTS()

Make sure `testing::InitGoogleTest()` or `testing::InitGoogleMock()` is called before running tests, usually in your `main()`.

Example:

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 5. Best Practices

- Prefer using CMake integration with FetchContent or git submodules to keep GoogleTest and GoogleMock in sync with your project.
- Use `gmock_main` or `gtest_main` libraries to simplify your test binary if you don’t want to write your own `main()`.
- On Windows, always verify your runtime linkage (static/dynamic CRT) consistency.
- When working with IDEs, ensure debug mode builds for better test debugging experience.
- Use GoogleMock’s macros consistently to avoid linker and compilation errors.

---

## 6. Additional Resources

- [GoogleTest CMake Build Instructions](https://github.com/google/googletest/blob/main/README.md#build-with-cmake)
- [GoogleTest and GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest C++ API Reference](https://google.github.io/googletest/api/)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)

---

This page is part of the broader documentation suite including the [Integration with Tools & Extensions](../overview/integration-and-ecosystem/ecosystem-integrations.md) and [Prerequisites & Supported Platforms](../getting-started/setup-requirements-installation/prerequisites-supported-platforms.md).

If you encounter issues beyond build integration, consult the [Troubleshooting Installation Issues](../getting-started/first-run-validation/installation-troubleshooting.md) and [Basic Usage & Troubleshooting FAQ](../faq/getting-started-faq/basic-usage-troubleshooting.md).

---

### Example CMake Minimal Test Setup

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)

FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)

target_link_libraries(my_test 
                      GTest::gtest_main 
                      GTest::gmock)

enable_testing()
add_test(NAME my_test COMMAND my_test)
```

This minimal setup downloads and uses the latest GoogleTest and GoogleMock sources automatically.

---

### Troubleshooting Compilation with Custom Runtimes and Flags

If your build system or platform has custom requirements (e.g., embedded OS, unusual compilers), ensure that GoogleMock’s internal utility scripts are configured correctly for these environments.

For example, the internal CMake helper (`internal_utils.cmake`) manages compiler flags consistently.

Consult the `googlemock/cmake/internal_utils.cmake` file if you need to adjust flag defaults.

---

For direct source review or further exploration, see the implementation of the `gmock_main.cc` source file, which provides the standard test entry point:

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

(Found in `googlemock/src/gmock_main.cc`)

---

<Check>
Follow this FAQ for effective integration of GoogleTest and GoogleMock with your build system and IDE to avoid common pitfalls and enhance your test development workflow.
</Check>