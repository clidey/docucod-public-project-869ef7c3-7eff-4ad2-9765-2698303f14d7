---
title: "Build System & CI/CD Troubleshooting"
description: "Steps through resolving common integration issues with CMake, Bazel, and other build environments, including CI/CD errors and platform-specific configuration tips."
---

# Build System & CI/CD Troubleshooting

This documentation guides you through resolving common integration issues encountered when building GoogleTest and GoogleMock with popular build systems like CMake and Bazel, along with troubleshooting CI/CD pipeline errors and platform-specific configuration tips. Whether you're setting up your `main()` entry point, linking correctly, or dealing with platform quirks, this page equips you to effectively diagnose and fix build and integration hurdles.

---

## 1. Common Integration Issues with Build Systems

### 1.1 Setting Up the Main Function

GoogleMock includes a provided `main()` function in the `gmock_main` library, which initializes GoogleMock and GoogleTest, then runs all tests. Using this library simplifies test binaries by avoiding manual `main()` implementation.

- **Use Case:** Link your test executable against `gmock_main` to get the default main function.
- **When to Write Your Own `main()`:** Only if you require custom initialization or special command line handling before running tests.

<Steps>
<Step title="Linking with gmock_main">
Link your test executable to `gmock_main` instead of just `gmock`:
```cmake
target_link_libraries(your_test_target PRIVATE gmock_main)
```
This provides the default `main()`:
```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This is implemented in `gmock_main.cc` and ensures that GoogleMock and GoogleTest are initialized together.
</Step>
<Step title="Custom main Function">
If you write your own `main()`, be sure to call `testing::InitGoogleMock()` before `RUN_ALL_TESTS()`:
```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```
Failure to call the initialization function may result in command line flags not being parsed correctly, leading to unexpected test behavior.
</Step>
</Steps>

<Tip>
For embedded platforms such as ESP8266, ESP32, and NRF52 with Arduino, GoogleMock provides `setup()` and `loop()` functions instead of `main()`. You do not call `RUN_ALL_TESTS()` manually; the tests run in the Arduino event loop.
</Tip>

### 1.2 Linking and Compiler Flags

- Ensure your build system includes the GoogleTest and GoogleMock headers and links against the appropriate static or shared libraries.
- GoogleTest requires C++17 or later. Make sure your compiler flags specify this.
- For Windows builds, especially with Visual Studio, watch out for C runtime mismatches (static vs dynamic). Use the `gtest_force_shared_crt` CMake option to align runtimes.

Example CMake snippet:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp test1.cpp)
target_link_libraries(my_tests PRIVATE gtest_main gmock)
set_target_properties(my_tests PROPERTIES CXX_STANDARD 17 CXX_STANDARD_REQUIRED ON)
```

<Warning>
Not aligning CRT linkage between your project and GoogleTest libraries on Windows will cause linker errors such as:
```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```
Always verify and coordinate your runtime library settings.
</Warning>

### 1.3 Bazel Integration

- GoogleTest supports Bazel integration with dedicated Bazel BUILD files.
- The typical workflow involves loading GoogleTest as a dependency and declaring test targets that reference it.

Refer to the [Integration & Supported Workflows](/overview/arch-diagram-integration/integration-and-workflows) page for detailed Bazel setup steps.


## 2. CI/CD Pipeline Troubleshooting

### 2.1 Failing Tests in CI

- Confirm that GoogleTest is properly initialized by the main function or that your custom `main()` calls `testing::InitGoogleMock()`.
- Ensure that all GoogleTest and GoogleMock libraries are linked and available in the CI environment.
- Check that the CI build environment supports C++17 or later.

<Tip>
Use GoogleTest's XML output to integrate test results into CI dashboards. Pass the flag `--gtest_output=xml:report.xml` to the test executable.
</Tip>

### 2.2 Build Failures Related to Threading

- GoogleTest detects pthread availability automatically. If detection fails in your CI, manually define `-DGTEST_HAS_PTHREAD=1` or `0` as appropriate in compiler flags.

### 2.3 Platform-Specific Issues in CI

- Windows agents might require explicit settings for runtime linkage and environment variables.
- Embedded platforms using ESP processors require custom setup with `setup()` and `loop()` functions as entry points.

<Check>
Validate your CI environment toolchain versions and environment variables to ensure compatibility.
</Check>

## 3. Platform-Specific Configuration Tips

### 3.1 Cross-Platform Best Practices

- Use GoogleTest macros and platform detection utilities to conditionally compile tests specific to platforms.
- Use `GTEST_OS_*` macros to detect OS in code for platform-specific tweaks.

### 3.2 Visual Studio Runtime and Build Configuration

- For VS builds, use project properties to match CRT linkage mode with GoogleTest.
- Enable `gtest_force_shared_crt` in CMake projects to simplify this.

### 3.3 Embedded Environments

- Refer to the special definitions in `gmock_main.cc` for platforms such as ESP8266 where `setup()` and `loop()` provide test execution flow.

## 4. Troubleshooting Common Build and Link Errors

### 4.1 Missing `main()` Symbol

- This usually happens if you link against `gmock` but not `gmock_main`.
- Solution: Link against `gmock_main` to use the default main function.

### 4.2 Linker Errors on Visual Studio

- Runtime library conflicts (static vs dynamic CRT).
- Mismatched compilation flags (Exception handling, RTTI must match).

### 4.3 Compiler Errors with `MOCK_METHOD`

- When mocking methods with complex argument types involving commas (e.g., templates), wrap argument types in parentheses or use type aliases.

Example:
```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

## 5. Best Practices and Tips

- Prefer linking with `gmock_main` to reduce boilerplate.
- Always specify C++17 or later standard in your build system (`CMAKE_CXX_STANDARD` etc.).
- Use official CMake build scripts and options provided with GoogleTest and GoogleMock.
- Consult the [Getting Started](https://github.com/google/googletest) and [Integration & Workflows] documentation for sample configurations.

---

## Related Documentation

- [System Requirements & Supported Platforms](/getting-started/prerequisites-installation/requirements-overview)
- [Installing GoogleTest](/getting-started/prerequisites-installation/installation-methods)
- [Configuring Your Project for GoogleTest](/getting-started/configuration-first-test/project-setup)
- [Integrating with Continuous Integration Systems](/guides/real-world-scenarios/continuous-integration)
- [Platform and Toolchain Compatibility](/concepts/integration-patterns/platform-compatibility)
- [Troubleshooting Installation and Configuration](/getting-started/troubleshooting-validation/common-setup-issues)

<Tip>
For further help, consult the official GitHub repository and community forums or report issues with detailed build logs.
</Tip>
