---
title: "How can I improve the performance of my tests?"
description: "Practical strategies for making GoogleTest-based tests run faster, handle larger codebases, and utilize value-parameterized and type-parameterized tests efficiently. Includes advice on parallelization, test isolation, and reducing overhead."
---

# How can I improve the performance of my tests?

GoogleTest supports various practical strategies to help you make your tests run faster, handle larger codebases effectively, and use advanced parameterized testing efficiently. This guide walks you through concrete tips on parallelizing test execution, isolating tests to minimize side effects, optimizing test fixtures, and harnessing value-parameterized and type-parameterized tests to reduce code redundancy and improve execution time.

---

## 1. Speeding Up Test Execution

### Parallelizing Tests

To leverage multiple CPU cores and reduce wall-clock test time:

- **Run tests in parallel processes:** GoogleTest supports *sharding*, where the full test suite can be split across multiple machines or processes. Use the environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` to specify the total shards and the index of the shard to run. Each shard runs a subset of tests independently.

- **Shuffle test order:** Use the `--gtest_shuffle` flag to randomize test execution order. This uncovers hidden dependencies between tests, which is crucial for safely parallelizing them.

- **Repeat tests:** With the `--gtest_repeat=N` flag, run tests multiple times to detect flaky or timing-sensitive failures that often surface under concurrent or repeated execution.

<Tip>
Combine parallelization flags with sharding and shuffling to maximize test throughput while ensuring reliability.
</Tip>

### Minimizing Test Overhead

- **Avoid expensive per-test setup:** Use `SetUpTestSuite()` and `TearDownTestSuite()` for expensive shared resources rather than per-test `SetUp()` and `TearDown()`. This avoids repeated resource initialization.

- **Disable unnecessary logging:** Controlling verbosity with flags such as `--gtest_brief=1` (show only failures) and disabling elapsed time printing (`--gtest_print_time=0`) reduces output processing overhead.

- **Optimize test filters:** Use `--gtest_filter` to run only relevant subsets of tests during development.

### Isolating Tests to Avoid Flakiness

Tests that share or compete for resources can slow down or cause flaky failures. To overcome this:

- Use GoogleMock to isolate dependencies and mock out expensive or shared components.
- Avoid global/static mutable state that crosses test boundaries; ensure tests are independent and rerunnable in any order.
- Use the `GTEST_SKIP()` macro to skip tests early when prerequisites are not met, saving time on irrelevant or unsupported tests.

<Note>
Proper test isolation not only speeds up tests but also improves reliability and maintainability.
</Note>

---

## 2. Efficient Use of Parameterized Tests

GoogleTest provides two powerful features to run the same test logic with different inputs or types without code duplication:

### Value-Parameterized Tests

- Define tests that take parameters (`TEST_P` macros) and instantiate them with various input values using `INSTANTIATE_TEST_SUITE_P`.
- This lets you test comprehensive input ranges with a single test definition, significantly reducing code duplication and minimizing maintenance.
- Combine with smart test naming to keep reports readable.

Example:

```cpp
class FooTest : public testing::TestWithParam<int> { };

TEST_P(FooTest, IsEven) {
  auto n = GetParam();
  EXPECT_EQ(n % 2, 0);
}

INSTANTIATE_TEST_SUITE_P(EvenNumbers, FooTest, testing::Values(2, 4, 6, 8));
```

<Tip>
Use custom parameter name generators for better readable test output, especially when parameters are complex types.
</Tip>

### Typed and Type-Parameterized Tests

- Use `TYPED_TEST_SUITE` and `TYPED_TEST` to repeat tests across multiple types where the test behavior depends on type rather than runtime parameters.
- Use `TYPED_TEST_SUITE_P` and `INSTANTIATE_TYPED_TEST_SUITE_P` for type-parameterized tests where the type list is defined separately from test definition.

These approaches improve compile-time test coverage and reduce repetitive manual coding.

---

## 3. Best Practices to Reduce Mock Overhead

Using GoogleMock effectively can bring speed benefits:

- Use `ON_CALL()` to specify default behavior without strict expectations, so only the interesting calls are checked with `EXPECT_CALL()`. This reduces overhead on irrelevant method calls.

- Use `NiceMock<T>` to suppress warnings on uninteresting calls, keeping test logs clean.

- Move large mock class implementations out of headers to `.cc` files to reduce compilation times.

- Prefer to mock interfaces rather than concrete classes to avoid tight coupling and recompilation.

- Delegate default behaviors in mocks to fakes or real objects if the behavior is complex but predictable, reducing the need for excessive expectations.

---

## 4. Additional Tips and Flags

- Use `--gtest_break_on_failure` to stop test execution when the first failure occurs, helping focus on fixing issues before re-running the full suite.

- Generate XML or JSON test reports via `--gtest_output=xml:<file>` or `--gtest_output=json:<file>` for integration with CI tools, which can also enable more advanced test parallelization by parsing which tests have passed/failed.

- Set `--gtest_fail_fast` to stop the entire test program upon first failure to save time during debugging sessions.

- Control mock verbosity with `--gmock_verbose=[info|warning|error]` depending on the level of logging desired.

- Cache and share expensive test resources using static members in test fixtures with `SetUpTestSuite()` to save test initialization time.

---

## 5. Troubleshooting Performance Issues

If tests are slow, consider these diagnostic steps:

- Profile test executable to identify bottlenecks.
- Check for tests that are not well isolated and cause side effects or deadlocks.
- Look for oversized mock setups or overly strict expectations slowing down the matcher engine.
- Validate that `EXPECT_CALL()` are ordered properly and do not cause redundant match attempts.
- Minimize use of global shared state that forces serialization or extensive locking.

---

## Summary

By combining parallel test execution, optimized use of parameterized tests, best mocking practices, and effective resource sharing, you can dramatically improve the speed and scalability of your GoogleTest suites. Use the recommended flags and strategies to tailor your test runs for fast feedback during development and robust coverage in CI.

---

## Related Documentation

- [Getting Started with GoogleTest and GoogleMock](/guides/core-workflows/getting-started)
- [Writing and Running Unit Tests](/guides/core-workflows/writing-tests)
- [Using Mocks for Dependency Isolation](/guides/core-workflows/using-mocks)
- [Parameterized and Typed Tests](/guides/advanced-patterns/parameterized-tests)
- [Best Practices for Large and Scalable Test Suites](/guides/advanced-patterns/scaling-best-practices)
- [Test Execution & Configuration API](/api-reference/core-testing-apis/test-execution-and-configuration-api)

---

## External Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)

---

## Example: Running Tests in Parallel with Sharding

```sh
# Total shards = 4, this machine runs shard index 0
GTEST_TOTAL_SHARDS=4 GTEST_SHARD_INDEX=0 ./my_test_binary

# Run on machine 1
GTEST_SHARD_INDEX=1 ./my_test_binary
```

This way, each machine runs only a subset of tests, speeding up the overall job.

<Check>
Remember to ensure your tests are order-independent and isolated before using sharding.
</Check>

---

## Example: Parameterized Test for Multiple Inputs

```cpp
class MyParamTest : public testing::TestWithParam<int> {};

TEST_P(MyParamTest, IsPositive) {
  int value = GetParam();
  ASSERT_GT(value, 0);
}

INSTANTIATE_TEST_SUITE_P(PositiveValues, MyParamTest, testing::Values(1, 2, 42));
```

This runs the test 3 times with the specified values.

---

## Troubleshooting Common Performance Pitfalls

### Large Mock Classes Compiling Slowly

- Move mock class constructor and destructor definitions to `.cc` files.
- Reduce number of `MOCK_METHOD` on large classes if possible.

### Tests Not Running in Parallel Effectively

- Ensure tests do not share global state or resources.
- Use proper isolation with mocks and fixtures.
- Use `--gtest_shuffle` to detect order dependencies.

### Test Overhead Due to Excessive Logging

- Limit log verbosity with `--gtest_brief=1`.
- Disable elapsed time printing with `--gtest_print_time=0`.

---

For a deeper dive into test performance and scaling, see the [Best Practices for Large and Scalable Test Suites](https://google.github.io/googletest/scaling-best-practices.html).
