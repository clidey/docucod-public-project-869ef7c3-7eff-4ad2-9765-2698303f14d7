---
title: "Common Build and Link Issues"
description: "Explains how to diagnose and fix the most frequent build and linking issues, such as unresolved symbols, missing headers, or ABI incompatibilities. Offers guidance tailored for both mono-repo and external project integrations."
---

# Common Build and Link Issues

This page helps you diagnose and fix the most frequent build and linking problems encountered when integrating GoogleTest and GoogleMock into your projects. Whether you are working within a mono-repo or integrating into an external project, learning to quickly resolve issues such as unresolved symbols, missing headers, or Application Binary Interface (ABI) incompatibilities will save you valuable development time and frustration.

---

## Contents

- [Common Build Errors](#common-build-errors)
- [Linker Issues and Resolution](#linker-issues-and-resolution)
- [ABI Incompatibility Troubleshooting](#abi-incompatibility-troubleshooting)
- [Integration Tips for Mono-Repos](#integration-tips-for-mono-repos)
- [Integration Tips for External Projects](#integration-tips-for-external-projects)
- [Practical Best Practices](#practical-best-practices)

---

## Common Build Errors

### Missing Headers or Includes

**Problem:**
Your build fails because it cannot find `gmock/gmock.h` or other GoogleTest/GoogleMock header files.

**Why It Happens:**
- The include directory for GoogleTest/GoogleMock is not properly set in your project configuration.
- When using CMake, the include directories for GoogleTest and GoogleMock are missing or incorrectly specified.

**Solution:**
1. Ensure that your build setup includes the GoogleTest and GoogleMock header paths.
2. When using CMake, confirm that you call:
   ```cmake
   include_directories(${gmock_SOURCE_DIR}/include ${gmock_SOURCE_DIR} ${gtest_INCLUDE_DIRS})
   ```
3. If integrating GoogleTest as a submodule or external dependency, verify that your include paths correctly point to the cloned source.

### Unresolved Symbols and Link Errors

**Problem:**
Linker errors such as `undefined reference to 'testing::...'` or missing symbols occur when linking the test executable.

**Why It Happens:**
- The GoogleMock and GoogleTest libraries are not linked or linked in the wrong order.
- Mixing static and shared library linkage incorrectly.
- Using conflicting runtime library settings (especially on MSVC).

**Solution:**
1. Ensure proper linkage of either `gmock` or `gmock_main` (which includes a main function) and `gtest` libraries.
2. For CMake projects, your target linking should look like:
   ```cmake
   target_link_libraries(your_test_target PRIVATE gmock gtest)
   ```
   or if you want a self-contained executable:
   ```cmake
   target_link_libraries(your_test_target PRIVATE gmock_main)
   ```
3. On Windows with MSVC, ensure your compiler runtime settings for your project and the gmock/gtest libraries match (e.g., all use Dynamic or Static CRT).

### Errors with Multiple Definitions or Duplicate Symbols

**Problem:**
Linker errors due to duplicate symbols occur.

**Why It Happens:**
- Including source files or object files multiple times.
- Mixing library versions or multiple conflicting binaries.

**Solution:**
1. Avoid including GoogleTest or GoogleMock source files directly in multiple parts of the build.
2. Use the libraries provided by your build system rather than compiling source multiple times.
3. If your project depends on both `gmock` and `gtest`, link GoogleMock first, then GoogleTest.

---

## Linker Issues and Resolution

Linker problems are among the most common headaches during build integration. Here is how to systematically resolve them:

### Step 1: Identify Missing Symbols

- Look carefully at the undefined symbols in the linker output.
- Symbols starting with `testing::` usually mean GoogleTest or GoogleMock is not properly linked.

### Step 2: Check Library Linking Order

- GoogleMock depends on GoogleTest; in traditional linkers, later libraries can resolve symbols from earlier ones.
- Link `gmock` before linking `gtest` or link with `gmock_main` (which links both internally).

### Step 3: Verify Build Flags and Multiple ABI Versions

- When mixing compiled objects, incompatible C++ ABI or different compiler flags may cause hidden mismatches.
- Always compile your user code and GoogleTest/GoogleMock with the same compiler and ABI settings.

### Step 4: Test with a Minimal Example

- Try building a minimal test with GoogleMock in isolation.
- This helps to isolate whether the problem is with your environment or your project configuration.

---

## ABI Incompatibility Troubleshooting

ABI incompatibilities may cause confusing build or runtime failures that are tough to diagnose.

### Symptoms

- Link errors about missing symbols that should exist.
- Runtime crashes or undefined behavior.

### Causes

- Mixing libraries compiled with different STL implementations or compiler versions.
- Using different compiler flags (like `_GLIBCXX_USE_CXX11_ABI` for GCC).

### Solutions

- Ensure consistent compiler and standard library versions across all compiled components.
- For GCC, review and unify the `_GLIBCXX_USE_CXX11_ABI` macro settings.
- Prefer rebuilding all dependencies (including GoogleTest) with your project's exact compiler environment.

---

## Integration Tips for Mono-Repos

In mono-repo environments, it is common to build GoogleTest and GoogleMock as part of your entire repository.

### Best Practices

- Use CMake's `add_subdirectory(googletest)` or `add_subdirectory(gmock)` to include GoogleTest/GoogleMock sources.
- Avoid building GoogleTest/GoogleMock separately outside your main build.
- Reference GoogleTest and GoogleMock targets (`gmock`, `gmock_main`, and `gtest`) directly in your targets.
- Apply consistent compile and link flags project-wide to avoid ABI conflicts.

### Practical Tips

- Set `option(gmock_build_tests OFF)` if you do not want GoogleMock's internal tests in your build.
- Use `target_include_directories()` and `target_link_libraries()` to properly propagate include paths and linkage.

---

## Integration Tips for External Projects

When using GoogleTest/GoogleMock as an external dependency:

### Recommended Approaches

- Use package managers or fetch GoogleTest on demand (e.g., through CMake `FetchContent` or `ExternalProject`).
- Link against pre-built or installed GoogleTest and GoogleMock binaries where possible.

### Important Considerations

- Match compiler toolchains and versions exactly.
- Confirm the installed package matches your expected API version.
- Always configure include and library paths correctly.

### Troubleshooting

- Confirm your project's build system picks up the correct GoogleTest/GoogleMock version.
- Use verbose build outputs to trace paths, compiler flags, and linker commands.

---

## Practical Best Practices

- **Always include the GoogleMock headers properly before use**: Typically `#include <gmock/gmock.h>` in your test files.
- **Initialize GoogleMock in your tests correctly:**

  ```cpp
  int main(int argc, char** argv) {
    testing::InitGoogleMock(&argc, argv);
    return RUN_ALL_TESTS();
  }
  ```

- **Link with `gmock_main` for easiest test executable creation, unless you supply your own `main()`.**
- **Avoid mixing debug and release builds of GoogleTest/GoogleMock with your code.**
- **Use consistent C++ standard settings (C++17 recommended) throughout all compiled components.**
- **Use the recommended GoogleTest CMake integration scripts when possible, as these handle details like include paths and linking order.**

---

## Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest) — Source and latest build instructions.
- [Installing with CMake](https://github.com/google/googletest/blob/main/googletest/README.md#building-with-cmake) — Detailed build and installation guide.
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md) — Detailed guide on mocking APIs, helpful if build errors relate to mocking.
- [GoogleMock for Dummies](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md) — Introductory tutorial for mock usage.
- [Troubleshooting Common Setup Issues](https://github.com/google/googletest/blob/main/docs/getting-started/configuration-troubleshooting/common-issues-troubleshooting.md) — Helpful for build issues.

---

By mastering these troubleshooting and configuration techniques, you ensure smooth integration of GoogleTest and GoogleMock into your build and development workflow, empowering robust and maintainable C++ test suites.


<Check>
Tip: When you encounter build or linker errors, enabling verbose compilation (`-v` or build system equivalent) helps you see include paths, compiler, and linker flags used, making it easier to spot missing or misplaced settings.
</Check>

<Warning>
Beware of ABI mismatches caused by mixing compiler versions or incompatible STL implementations. Always rebuild dependencies if you upgrade compilers or change critical flags.
</Warning>
