---
title: "Build System & Tool Integration"
description: "Covers integration with popular build systems (CMake, Bazel), setting up continuous integration, and linking GoogleTest/GoogleMock with your own code and third-party projects."
---

# Build System & Tool Integration FAQ

This FAQ addresses common questions and key guidance for integrating GoogleTest and GoogleMock with popular build systems, setting up continuous integration (CI), linking them with your own code, and using third-party libraries effectively. It walks you through actionable advice, troubleshooting tips, and best practices to ensure smooth build and test workflows.

---

## 1. Frequently Asked Questions

### General Integration

**Q: How do I incorporate GoogleTest and GoogleMock into my CMake project?**  
A: You can incorporate GoogleTest and GoogleMock easily using CMake's `FetchContent` or by adding GoogleTest/GoogleMock as a subdirectory. The recommended approach is to add the following snippet to your `CMakeLists.txt`:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Visual Studio runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(your_test your_test.cc)
target_link_libraries(your_test gtest_main gmock_main)
add_test(NAME your_test COMMAND your_test)
```
This sets up GoogleTest and GoogleMock correctly and links the main functions.

**Q: What are `gtest_main` and `gmock_main` and when should I use them?**  
A: Both `gtest_main` and `gmock_main` provide a ready-made `main()` function so you don’t have to write your own test driver. Use `gtest_main` if you only need GoogleTest, or `gmock_main` if you use GoogleMock features. Linking with these libraries simplifies startup initialization and test execution.

**Q: Can I write my own `main()` function instead?**  
A: Absolutely. Writing a custom `main()` allows integration of specific setup code or customized test initialization. Your `main()` should call `testing::InitGoogleTest(&argc, argv)` or `testing::InitGoogleMock(&argc, argv)` before `RUN_ALL_TESTS()`. Example:
```cpp
int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);  // Initializes GoogleTest as well
  return RUN_ALL_TESTS();
}
```

### Bazel Integration

**Q: How do I add GoogleTest and GoogleMock to my Bazel workspace?**  
A: Use the `MODULE.bazel` file to declare dependencies on GoogleTest. You can then write tests like `hello_test.cc` and build them with Bazel's rules for C++.

**Q: How to run tests and link properly in Bazel?**  
A: Define a `cc_test` in your `BUILD` files pointing to your test sources, with `deps` including `@com_google_googletest//:gmock` or `@com_google_googletest//:gtest`. Use `bazel test //...` to run all tests.

### Continuous Integration (CI) Setup

**Q: How can I automate tests using CI tools?**  
A: Since GoogleTest and GoogleMock tests provide an exit code reflecting success or failure, integrate your CI system to run test binaries and check exit statuses. Use options like `--gtest_output=xml` for test reports consumable by CI dashboards.

**Q: What are best practices for multi-threaded or parallel test execution?**  
A: Use GoogleTest’s test sharding (`--gtest_shard_index` and `--gtest_total_shards`) or parallel test execution features in your CI tooling. Organize tests into smaller suites for faster parallel runs with Bazel or CMake-based test runners.

### Linking and Build Issues

**Q: Why do I get linker errors involving multiple main functions or missing gtest symbols?**  
A: Ensure you link with exactly one main library: either `gtest_main`, `gmock_main`, or provide your own `main()`. Mixing these leads to duplicate symbols. Also confirm the library path and link order are correct.

**Q: How to handle runtime library incompatibilities on Windows?**  
A: Use the CMake option `gtest_force_shared_crt` to force GoogleTest libraries to link dynamically and match your project settings, avoiding the common `RuntimeLibrary` mismatch errors.

**Q: How do I link GoogleMock with GoogleTest?**  
A: Link your test executable with `gmock_main` which depends on `gmock` and `gtest`. Alternatively, link separately to `gmock` and `gtest` libraries if you provide your own `main()`.

### Third-party Dependencies

**Q: How do I integrate GoogleTest with third-party libraries in my project?**  
A: Ensure all libraries are built with compatible compiler flags and C++ standard versions (C++17 or above). Link them coherently in your build system and keep GoogleTest’s headers and sources visible to avoid conflicts.

**Q: Can GoogleTest coexist with other testing or mocking frameworks?**  
A: Yes, but watch for macro conflicts and naming collisions. GoogleTest supports renaming its macros using `-DGTEST_DONT_DEFINE_TEST=1` and similar compiler flags to avoid clashes.


## 2. Common Issues & Gotchas

- **Double Main Function Conflict:** When linking, ensure you do not combine `gtest_main` and `gmock_main` or define your own `main()` alongside them.
- **Build Failures Due to C++ Standard:** GoogleTest requires C++17; confirm all build targets follow this standard.
- **Link Order Importance:** Libraries such as `gmock_main` must appear after your object files in link commands.
- **Visual Studio Runtime Mismatch:** Use `gtest_force_shared_crt` option to align runtimes.
- **Source and Test Version Mismatch:** Using headers and libraries from different GoogleTest versions can cause symbol errors.

## 3. Error Messages & Debugging

- **Common Linker Errors:** Undefined references to `InitGoogleTest()`, multiply defined `main()`.
- **Initialization Errors:** Calling `RUN_ALL_TESTS()` without initializing GoogleTest or GoogleMock.
- **Multi-threading Warnings:** GoogleTest uses pthreads on supported platforms; ensure linker flags include pthread when needed.

## 4. Troubleshooting Procedures

### Diagnosing Linker Errors
1. Check whether multiple `main` functions are linked.
2. Confirm linking to either `gtest_main` or `gmock_main` matches your use.
3. Verify the build system includes the right source directories and libraries.

### Fixing Runtime Issues
1. Confirm `testing::InitGoogleTest(&argc, argv)` or `testing::InitGoogleMock(&argc, argv)` is called.
2. Check for missing or incorrectly linked dependencies.

### Verification Steps
- Run sample tests included with GoogleTest (`gtest/src/gtest_main.cc`) to confirm environment.
- Use verbose build output to check link lines.

## 5. Performance & Optimization

- Leverage incremental builds in CMake or Bazel.
- Use test filtering flags to run subsets of tests faster.
- Employ parallel test execution in CI environments.

## 6. Security & Access Issues

- GoogleTest and GoogleMock do not impose security controls but rely on your development environment permissions.
- Ensure your build environment has access rights to all required source files, libraries, and tools.

## 7. Data & Storage Issues

- Not applicable to build system integration.

## 8. Getting Help & Support

- Use the [googletest GitHub repository](https://github.com/google/googletest) for bug reports and issues.
- Consult the [GoogleTest Primer](https://google.github.io/googletest/primer.html) for basic concepts.
- Explore guides on [Build System Integration](https://google.github.io/googletest/guides/real-world-integration/build-system-integration.html).
- Participate in community forums and Stack Overflow tagged `googletest`.

---

## Additional Resources
- [GoogleTest CMake Installation Guide](https://google.github.io/googletest/quickstart-cmake.html)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [Integration Ecosystem Overview](https://google.github.io/googletest/overview/features-integration/integration-ecosystem.html)
- [GoogleTest FAQ on Test Discovery](https://google.github.io/googletest/faq/#test-discovery)

---

## Example: Custom `main()` Function for Integration

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);  // Handles GoogleTest init as well

  // Place your custom startup code here, e.g., logging setup

  return RUN_ALL_TESTS();
}
```

Use this approach if you need more control over test initialization or need to integrate additional framework setups.

---

## Summary Diagram of Integration Flow

```mermaid
flowchart TD
  A[User Test Code] --> B[Includes GoogleTest & GoogleMock Headers]
  B --> C[Build System (CMake/Bazel)]
  C --> D[Compile & Link with gtest_main/gmock_main or own main()]
  D --> E[Test Binary with Init & RUN_ALL_TESTS()]
  E --> F[Test Execution & Reporting]
  F --> G[CI Automation/Developer Feedback]
```

This concise flow illustrates how your test code integrates into your build system and flows through testing and reporting phases.

---

<Tip>
Always keep GoogleTest and GoogleMock source/tree consistent, and ensure your build system uses the same C++ standard across all targets to avoid incompatibility and linking issues.
</Tip>

<Check>
Link with `gmock_main` if using mocking features to avoid writing your own `main()`.
</Check>

<Warning>
Mixing multiple `main()` implementations will cause linker errors. Link with only one main function provider.
</Warning>

---

For detailed build steps and troubleshooting, see the related [Build System Integration Guide](/guides/real-world-integration/build-system-integration).

---

