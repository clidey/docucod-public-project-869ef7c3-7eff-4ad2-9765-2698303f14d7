---
title: "Integration with Build Systems"
description: "Answers questions on using GoogleTest and GoogleMock with common build systems, including Bazel, CMake, and pkg-config. Provides troubleshooting tips for linking, configuration, and project layout issues."
---

# FAQ: Integration with Build Systems

This FAQ provides clear and actionable answers to common questions about integrating GoogleTest and GoogleMock with popular build systems such as Bazel, CMake, and pkg-config. It addresses common challenges with linking, configuration, project structuring, and troubleshooting, helping you successfully build, link, and run your test suites.

---

## Frequently Asked Questions

### 1. How do I integrate GoogleTest and GoogleMock with CMake?

To integrate GoogleTest and GoogleMock in your CMake project, you typically use `add_subdirectory` to include their sources or find installed packages using `find_package`.

**Basic Setup Example:**

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyProject)

# Fetch or locate googletest
add_subdirectory(path/to/googletest)

add_executable(my_test test/my_test.cc)
target_link_libraries(my_test PRIVATE gtest_main gmock)

include(GoogleTest)
gtest_discover_tests(my_test)
```

Ensure you link against `gtest_main` or `gmock_main` if you want the default `main()` provided by the frameworks.

**Tips:**
- Use the official GoogleTest CMake sources within your project or installed system packages.
- Prefer the targets `gtest`, `gmock`, `gtest_main`, and `gmock_main` when linking.
- Set the C++ standard to at least C++17 using `set(CMAKE_CXX_STANDARD 17)`.

### 2. How can I build GoogleMock tests using Bazel?

Bazel has native support for GoogleTest and GoogleMock tests via `cc_test` rules.

**Typical BUILD file snippet:**

```starlark
cc_test(
    name = "my_mock_test",
    srcs = ["my_mock_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

Make sure that the external Bazel dependency for googletest includes GoogleMock and the main library.

### 3. What common linking issues should I avoid?

- **Missing GoogleTest/GoogleMock Libraries:** Make sure to link your test targets explicitly with `gtest_main` or `gmock_main` (which includes GoogleTest).

- **Repeated Linking of Static Libraries:** Avoid linking GoogleTest and GoogleMock multiple times across targets in a way that causes duplicate symbols.

- **Mismatch of Runtime or Compiler Flags:** Ensure all your project and dependency targets use consistent compiler and linker flags, especially regarding C++ standard, visibility, and runtime linkage.

- **Forgetting to Build Tests:** If building GoogleMock's own tests (for validation), ensure the build option `gmock_build_tests` is enabled in CMake or relevant build scripts.

### 4. How do I use pkg-config with GoogleTest/GoogleMock?

GoogleTest/GoogleMock provides `.pc` files such as `gmock_main.pc` for `pkg-config`.

**Example usage:**

```bash
pkg-config --cflags gmock_main
pkg-config --libs gmock_main
```

Use the output to configure your compiler and linker flags. This requires you to have installed GoogleTest/GoogleMock properly with the PC files generated.

**Note:** Some systems or installation methods might not install `.pc` files by default.

### 5. How should I organize my project layout to avoid build and linkage issues?

- Keep source files for your tests separate from production code.
- Link your test executables **only** against testing libraries (`gtest`, `gmock`, `gtest_main`, `gmock_main`).
- Compile GoogleTest and GoogleMock sources with consistent compiler flags.
- Use interface include directories provided by GoogleMock's CMake targets to ensure proper header resolution.

### 6. What is the recommended way to handle GoogleMock initialization in custom `main()`?

Usually, link your test executable with `gmock_main` which provides a `main()` initializing both GoogleTest and GoogleMock.

If you need a custom `main()`, initialize GoogleMock explicitly:

```cpp
#include "gmock/gmock.h"
int main(int argc, char** argv) {
    testing::InitGoogleMock(&argc, argv);
    return RUN_ALL_TESTS();
}
```

For embedded or specialized platforms, see the custom entry point patterns in `gmock_main.cc`.


### 7. How can I force GoogleMock to verify expectations even if mock objects are leaked?

Enable the flag `--gmock_catch_leaked_mocks` either from command line or programmatically:

```cpp
GMOCK_FLAG_SET(catch_leaked_mocks, true);
```

This helps detect mock leaks during test runs.

### 8. What compiler versions and platforms are supported?

GoogleTest and GoogleMock require at least C++17 support. They support major platforms such as Linux, Windows, macOS, and some embedded systems. Consult the [System Requirements & Supported Platforms](../getting-started/prerequisites-installation/system-requirements) for detailed platform compatibility and recommended compilers.

---

## Troubleshooting Tips

### Linking errors: `undefined reference to 'testing::...` or similar

- Confirm you have linked your test target with `gtest`, `gmock`, and/or `gmock_main`.
- Check for inconsistent compiler flags or C++ standard versions.
- Avoid mixing static and shared libraries improperly.
- For CMake, ensuring proper target dependency propagation helps:

```cmake
target_link_libraries(my_test PRIVATE gmock_main)
``` 


### Build fails with errors about missing header files like `gmock/gmock.h`

- Verify GoogleMock include directories are added to your compiler include path.
- For CMake, use target include directories of `gmock` or `gmock_main`:

```cmake
target_link_libraries(my_test PRIVATE gmock_main)
# this transitively sets include directories
```

### Tests compile but fail at runtime due to initialization issues

- Ensure you call `testing::InitGoogleMock()` before running tests.
- If using `gmock_main`, this is already done for you.
- If tests are embedded or use custom `main()`, add this call explicitly.

### GoogleMock tests produce warnings about uninteresting calls

- Use `NiceMock<MockClass>` if you want to suppress these warnings.
- Alternatively, adjust expected calls to include `.Times(AnyNumber())` on less critical methods.

### Slow compilation when mocking many methods

- Move mock class constructor and destructor definitions out of header files into `.cc` files.
- This prevents repeated compilation of boilerplate code.

---

## Related Documentation

- [Installing with CMake](/getting-started/prerequisites-installation/installation-cmake)
- [Common Setup Issues](/getting-started/troubleshooting-support/common-setup-issues)
- [Mocking Cookbook](docs/gmock_cook_book.md)
- [Mocking Reference](docs/reference/mocking.md)
- [Test Runner Entry Points](api_reference/configuration_and_main_api/runner_entry_points.mdx)
- [System Requirements & Supported Platforms](/getting-started/prerequisites-installation/system-requirements)

---

## Summary

Integrating GoogleTest and GoogleMock into your build system requires proper linkage, consistent flags, and initialization. This FAQ guides you through utilizing CMake, Bazel, and pkg-config effectively, covering common pitfalls related to linking, header inclusion, test initialization, and runtime warnings. Keep your project layout organized, leverage provided CMake targets or Bazel dependencies, and use `gmock_main` for simplified entry point management.

<Tip>
Keep your tests maintainable by only adding expectations for calls you truly want to verify and setting default actions via `ON_CALL`. This aids in avoiding brittle and noisy test failures.
</Tip>

---

