---
title: "How can I speed up my tests or run them in parallel?"
description: "Outlines practical strategies for improving test performance, including running tests in parallel, filtering, and optimizing slow test cases. Mentions available tools and settings to maximize speed without sacrificing reliability."
---

# How can I speed up my tests or run them in parallel?

GoogleTest provides practical strategies and built-in mechanisms to significantly improve the performance of your test suite. This page outlines approaches including running tests in parallel, filtering tests efficiently, and optimizing slow or expensive test cases.

---

## 1. Running Tests in Parallel (Sharding)

Running tests across multiple machines or processes can drastically reduce total execution time by distributing the workload. GoogleTest supports *test sharding*, which divides tests into shards — subsets of the entire test suite — that can run independently.

### How Sharding Works

- Set `GTEST_TOTAL_SHARDS` to the total number of shards you want.
- Set `GTEST_SHARD_INDEX` to the zero-based index of this particular shard.
- Run the same test binary on each shard machine or process.

GoogleTest calculates which tests belong in each shard based on their unique test IDs, ensuring each test runs exactly once across all shards.


### Example Environment Setup
```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0 # For machine/process 0
./my_tests &
export GTEST_SHARD_INDEX=1 # For machine/process 1
./my_tests &
# ... and so on for other shards
```

### Benefits

- Linear speedup proportional to the number of shards (up to limits imposed by test dependencies, machine hardware, and suite size).
- Easy to integrate with distributed CI environments.

### Limitations

- Tests should be independent and not rely on shared global state.
- Each test must be able to run in any shard without conditions.


## 2. Running Tests in Parallel Within a Single Machine

While GoogleTest does not internally run tests concurrently in a single process, it can be combined with external tooling and parallel runners.

### Practical Approaches

- **Parallel Test Runners**: Use tools like `gtest-parallel` or CI platforms that spawn multiple processes running the test binary concurrently with different shard settings.

- **Test Filtering**: Use `--gtest_filter` to split tests across parallel runs manually.

- **Sharding Support**: GoogleTest's built-in sharding environment variables allow easy integration with these runners.


## 3. Filtering Tests Effectively

To avoid unnecessarily running all tests during development or within shards, use test filtering.

- Use the `--gtest_filter` flag or `GTEST_FILTER` environment variable to specify patterns of tests to run.
- Filters support wildcards `*` and `?`, positive and negative filters.

### Example
```bash
./my_tests --gtest_filter=FooTest.*-FooTest.Bar
```

This runs all `FooTest` tests except the test named `Bar`.

### Sharding Behavior

Filtering also respects sharding settings and runs only selected tests per shard.


## 4. Minimizing Test Setup Overhead

Expensive setup and teardown often bottleneck test performance.

### Best Practices

- Use **per-test-suite shared setup and teardown** with `SetUpTestSuite()` and `TearDownTestSuite()` to reuse resources:

```cpp
class FooTest : public testing::Test {
 public:
  static void SetUpTestSuite() {
    shared_resource_ = new ResourceExpensiveToCreate();
  }
  static void TearDownTestSuite() {
    delete shared_resource_;
    shared_resource_ = nullptr;
  }
protected:
  static ResourceExpensiveToCreate* shared_resource_;
};

ResourceExpensiveToCreate* FooTest::shared_resource_ = nullptr;
```

This avoids repeating costly setup for each test.

- Avoid initialization in test fixture constructors that can fail or cause assertions; instead, use `SetUp()` and `TearDown()`.


## 5. Identifying and Optimizing Slow Tests

To speed up test runs, locate slow or flaky tests with:

- **Timing Information**: Use the built-in GoogleTest elapsed time output for each test to identify slow tests.
- **Test-level Fixes**:
  - Optimize slow tests' logic.
  - Mock or stub external dependencies.
  - Avoid heavy I/O or network calls.


## 6. Additional Flags to Control Test Execution Speed

GoogleTest includes various flags that can impact performance and test execution.

| Flag                                | Purpose                                                                                     |
|------------------------------------|---------------------------------------------------------------------------------------------|
| `--gtest_repeat=N`                 | Repeat tests N times (good for detecting flaky tests; note that repeated runs increase time). |
| `--gtest_shuffle`                  | Runs tests in a random order to surface order-dependencies.                                 |
| `--gtest_fail_fast`                | Stop all tests on the first failure (save cycles but lose full result).                     |
| `--gtest_also_run_disabled_tests` | Run disabled tests in addition to enabled ones (usually slower).                           |


## 7. Summary Checklist to Speed Up Tests

- **Run tests in parallel or distribute with sharding.**
- **Use test filters to run only relevant tests.**
- **Use shared setup/teardown at the test suite level.**
- **Profile test times and optimize slow tests.**
- **Leverage CI environment parallelism with environment variables.**


## 8. Troubleshooting Common Parallelization Issues

<AccordionGroup title="Common Issues and How to Address Them">
<Accordion title="Tests Sharing Global State and Causing Flakiness">
If tests depend on shared global data or static state, running them in parallel or on shards can cause unpredictable results. Refactor tests to avoid shared state or reset it in `SetUpTestSuite` and `TearDownTestSuite`.
</Accordion>
<Accordion title="Tests Failing to Run in Some Shards">
Ensure each test is independent and does not rely on ordering. Confirm that the number of shards does not exceed the test count excessively.
</Accordion>
<Accordion title="Slow Setup in Each Shard"
>
Avoid expensive global initialization in every shard by utilizing shared resources, or consider changing sharding granularity.
</Accordion>
<Accordion title="Difficulty Debugging Parallel and Sharded Runs">
Use test filters (`--gtest_filter`) to run tests individually or in smaller groups locally before scaling up to shards.
</Accordion>
</AccordionGroup>


## 9. Tools and Resources

- [GoogleTest Primer](primer.md) — Learn basic test writing and usage.
- [Advanced GoogleTest Topics](advanced.md) — Deep dive into test optimizations and advanced tests.
- [GoogleTest Reference - Testing Macros](reference/testing.md) — Understand test macros and fixtures.
- [Performance Tips Guide](guides/integration-advanced/performance-tips.mdx) — For advanced performance improvement strategies.
- External tools like [gtest-parallel](https://github.com/google/gtest-parallel) if you want process-level parallelism.


---

*Note:* This page is focused on test execution strategy and performance. For full understanding of GoogleTest features including test writing, assertions, and fixtures, visit the core documentation and related guides.

---

For complete details on GoogleTest flags that control filtering and sharding, refer to [Advanced GoogleTest Topics - Running Test Programs: Advanced Options](advanced.md#running-test-programs-advanced-options).

