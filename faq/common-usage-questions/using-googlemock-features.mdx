---
title: "Using GoogleMock Features"
description: "Clarifies how to use GoogleMock within the GoogleTest suite, including usage of mock methods, expectations, matchers, and strictness levels. Answers common doubts about mocking techniques and provides links to additional cheat sheets and cookbooks."
---

# Using GoogleMock Features

This page clarifies how to use GoogleMock within the GoogleTest suite, including how to define and use mock methods, set expectations, apply argument matchers, control call order and frequency, and manage mock strictness levels. It answers common questions about mocking techniques and links to additional cheat sheets and cookbooks for deeper mastery.

---

## Table of Contents

1. [Introduction to GoogleMock](#introduction-to-googlemock)
2. [Defining Mock Classes and Methods](#defining-mock-classes-and-methods)
3. [Setting Expectations with EXPECT_CALL](#setting-expectations-with-expect_call)
4. [Using Argument Matchers](#using-argument-matchers)
5. [Managing Call Order and Frequency](#managing-call-order-and-frequency)
6. [Default Behaviors with ON_CALL](#default-behaviors-with-on_call)
7. [Mock Strictness Modes: Nice, Naggy, and Strict](#mock-strictness-modes-nice-naggy-and-strict)
8. [Advanced Mocking Techniques](#advanced-mocking-techniques)
9. [Tips and Best Practices](#tips-and-best-practices)
10. [Additional Resources](#additional-resources)

---

## Introduction to GoogleMock

GoogleMock (gMock) is a powerful framework integrated within GoogleTest for creating and controlling mock objects to facilitate interaction-based testing in C++. A mock object imitates a real class or interface, allowing you to specify and verify function call expectations, argument values, call order, and return behaviors.

Using GoogleMock, you can:
- Define mock classes automatically from interfaces
- Specify _expectations_ on method calls using expressive macros
- Control method return values and side effects
- Verify call sequences and cardinalities
- Handle complex argument matching and return behaviors

---

## Defining Mock Classes and Methods

To create mocks, derive a mock class from the interface or base class you want to mock, and use the `MOCK_METHOD` macro to declare mock methods. The typical form is:

```cpp
class MockFoo : public FooInterface {
 public:
   MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
};
```

### Key points:

- Place all `MOCK_METHOD` declarations inside the `public:` section, even for mocking protected or private methods in the base class.
- Use `(const)`, `(override)`, `(const, override)`, or other qualifiers as the fourth argument when the original method is qualified.
- If method arguments have commas (e.g., templates), enclose the argument list in extra parentheses or use `using` type alias to avoid macro parsing errors.

Example:

```cpp
class MockTurtle : public Turtle {
 public:
   MOCK_METHOD(void, PenUp, (), (override));
   MOCK_METHOD(void, Forward, (int distance), (override));
   MOCK_METHOD(int, GetX, (), (const, override));
};
```

---

## Setting Expectations with EXPECT_CALL

The heart of using GoogleMock is specifying what calls you expect on mock objects using `EXPECT_CALL`. This macro sets:

- Which mock object and method are expected
- How many times it should be called (`Times` clause)
- What arguments are expected (matchers)
- The return behavior and actions
- Ordering constraints

Basic syntax:

```cpp
EXPECT_CALL(mock_object, Method(argument_matchers))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

### Important notes:

- If `Times` is omitted, GoogleMock infers the call count based on presence of `WillOnce` and `WillRepeatedly`.
- Setting `Times(0)` disallows the call entirely.
- Multiple `EXPECT_CALL`s for the same method are searched in reverse order, allowing more specific expectations to override more general ones.

Example:

```cpp
EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1))
    .WillRepeatedly(Return());
```

---

## Using Argument Matchers

Argument matchers specify properties that arguments should satisfy. Instead of hardcoding specific values, matchers add flexibility and readability.

### Common kinds:

- `_` matches any argument value
- `Eq(value)`, or just raw values like `5` mean exact match
- Numeric comparisons like `Ge(5)` (greater or equal), `Lt(10)` (less than)
- Pointer checks like `NotNull()`, `IsNull()`
- Container contents `ElementsAre(...)`, `UnorderedElementsAre(...)`
- Custom predicates via `Truly()` or user-defined matchers

Example:

```cpp
EXPECT_CALL(foo, SetValue(Ge(0), NotNull()));
EXPECT_CALL(foo, Process(ElementsAre(1, 2, 3))); 
```

Match multiple arguments as a tuple using `.With()`, enabling complex relations (e.g. first arg < second).

---

## Managing Call Order and Frequency

By default, expectations can be invoked in any order. Control call order explicitly with:

- **`InSequence`**: groups expectations so calls must occur in order declared
- **`Sequence` objects with `.InSequence()`**: to specify partial orders and share sequences among expectations
- **`.After()` clause**: to specify expectations must occur after others

Example - strict order:

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Init());
  EXPECT_CALL(mock, Run());
  EXPECT_CALL(mock, Cleanup());
}
```

For call frequency, `Times()` supports cardinalities like:

- `Exactly(n)`: called exactly n times
- `AtLeast(n)`, `AtMost(n)`
- `AnyNumber()`

Example:

```cpp
EXPECT_CALL(mock, Process(_)).Times(3);
```

---

## Default Behaviors with ON_CALL

`ON_CALL` specifies the _default behavior_ for a mock method when it is called without an explicit expectation.

Syntax:

```cpp
ON_CALL(mock_object, Method(argument_matchers))
    .With(multi_argument_matcher)  // optional
    .WillByDefault(action);
```

Unlike `EXPECT_CALL`, it does not set an expectation that the call _must_ occur.

Use `ON_CALL` to establish common mock behaviors for all tests or to specify default returns.

Example:

```cpp
ON_CALL(turtle, GetX()).WillByDefault(Return(42));
```

The default actions are overridden by any matching `EXPECT_CALL`.

---

## Mock Strictness Modes: Nice, Naggy, and Strict

GoogleMock supports three modes that control what happens when unexpected or uninteresting calls happen:

| Mode         | Description                                                                                   |
|--------------|-----------------------------------------------------------------------------------------------|
| `NiceMock`   | Suppresses warnings for uninteresting calls (calls with no `EXPECT_CALL`).                    |
| `NaggyMock`  | Default mode: warns about uninteresting calls but does not fail the test.                     |
| `StrictMock` | Treats any uninteresting call as a test failure.                                             |

Example of usage:

```cpp
NiceMock<MockFoo> nice_foo;
StrictMock<MockFoo> strict_foo;
NaggyMock<MockFoo> naggy_foo;  // Default mock type
```

**Warnings:**

- The modes work only for mocks whose methods are declared using `MOCK_METHOD` directly in the subclass. If mock methods are inherited, behavior may be inconsistent.
- Virtual destructor required for reliable strictness behavior.

**Recommendation:** Use `NiceMock` in most cases to reduce test noise, use `StrictMock` sparingly when you want precise verification.

---

## Advanced Mocking Techniques

### Mocking Overloaded Methods

For overloaded functions, mock each overload explicitly with `MOCK_METHOD`. To avoid hiding overloads, use `using Base::MethodName;` to expose unmocked overloads.

### Mocking Move-Only Types

GoogleMock supports mocking methods that accept or return move-only types like `std::unique_ptr`. Use lambdas or `WillOnce` with move returns carefully:

```cpp
EXPECT_CALL(mock, MakeBuzz(_))
    .WillRepeatedly([](StringPiece text) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

### Delegating to Fakes or Real Implementations

You can delegate default behaviors to a fake object inside your mock:

```cpp
ON_CALL(*this, DoThis).WillByDefault([this](int n) { return fake_.DoThis(n); });
```

This combines real implementation benefits with call verification.

### Ignoring Uninteresting Calls

To silence warnings on methods you do not care about, use `NiceMock`, or add a catch-all expectation:

```cpp
EXPECT_CALL(mock, Method(_)).Times(AnyNumber());
```

### Custom Matchers and Actions

Define complex argument validations with user-defined matchers (`MATCHER`, `MATCHER_P*`). Write custom actions as lambdas or structs with call operators, and use them with `WillOnce()` or `WillRepeatedly()`.

---

## Tips and Best Practices

- **Set expectations before exercising the code under test**. Setting expectations afterwards results in undefined behavior.
- **Avoid overspecification** by carefully selecting matchers and expectations.
- Use **`RetiresOnSaturation()`** with multiple `WillOnce()` actions to prevent sticky expectations from causing upper bound errors.
- Prefer **`ON_CALL`** to define common default behaviors, reserving `EXPECT_CALL` for those calls you want to strictly verify.
- Use verbosity flag `--gmock_verbose=info` to debug why expectations fail or calls are uninteresting.
- Avoid mocking concrete classes or non-virtual methods unless necessary. Prefer coding to interfaces.

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical recipes and best practices for complex mocking scenarios
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for macros and concepts
- [Using Mocks in Unit Tests Guide](../guides/mocking-and-advanced-testing/using-mocks-in-unit-tests) — Tutorial on mocking basics
- [Setting Expectations and Actions Guide](../guides/mocking-and-advanced-testing/setting-expectations-and-actions) — Advanced usage
- [Matchers Reference](../api-reference/assertions-and-matchers/core-matchers) — Built-in argument matchers
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) — Common questions and troubleshooting

---

By mastering the features documented here, you will be fully equipped to write expressive, maintainable, and robust tests leveraging GoogleMock's advanced mocking capabilities.