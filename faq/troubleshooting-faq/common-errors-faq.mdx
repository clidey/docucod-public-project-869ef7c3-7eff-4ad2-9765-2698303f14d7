---
title: "Common errors and how to resolve them"
description: "Covers frequently encountered build, runtime, and linking errors, explains typical causes, and provides step-by-step solutions. Targets misunderstandings around header inclusion, test discovery, or mock class setup. Includes relevant troubleshooting files and links."
---

# Common Errors and How to Resolve Them

This page highlights frequently encountered errors during building and running tests with GoogleTest and GoogleMock. It explains typical causes and provides clear, step-by-step solutions. This documentation primarily targets misunderstandings related to header inclusion, test discovery, mock class setup, and test execution. Relevant troubleshooting links and files are also included to assist users in rapid diagnosis and fixes.

---

## Frequently Encountered Errors

### 1. Missing or Incorrect Header Inclusions

**Problem:** Test code fails to compile due to missing GoogleTest or GoogleMock headers.

**Typical Symptoms:**
- Compiler errors about undefined macros like `TEST` or `EXPECT_CALL`.
- Types like `testing::Test` or `testing::NiceMock` are not found.

**Cause:**
- Not including `<gtest/gtest.h>` for GoogleTest or `<gmock/gmock.h>` for GoogleMock.

**Solution:**
- Always include `#include <gtest/gtest.h>` to use GoogleTest macros and assertions.
- For mocking features, add `#include <gmock/gmock.h>`.
- If using both testing and mocking, only including `gmock.h` suffices as it includes `gtest.h`.

<Tip>
Include these headers at the top of your test source files to gain full access to GoogleTest and GoogleMock functionalities.
</Tip>

---

### 2. Undefined Test Cases or Tests Not Running

**Problem:** Test binaries build without error but running them does not execute your tests, or reports zero tests run.

**Typical Symptoms:**
- Output shows `0 tests run` or no test output at all.

**Cause:**
- Your tests are not registered properly, usually due to missing `TEST` or `TEST_F` macros, or custom main function not calling `RUN_ALL_TESTS()`.

**Solution:**
<Steps>
<Step title="Use GoogleTest Macros Correctly">
Define tests using `TEST(TestSuiteName, TestName)` or `TEST_F(TestFixture, TestName)` macros. Do not define tests as regular functions without these macros.
</Step>
<Step title="Define Main Properly or Link With gtest_main">
Most users should link with `gtest_main` to get a default main() that initializes and runs tests.
If writing your own `main()`, ensure it calls `testing::InitGoogleTest(&argc, argv);` and returns `RUN_ALL_TESTS();`.
</Step>
<Step title="Verify Test Discovery">
Confirm that your test source files are compiled and linked into your test binary.
Use GoogleTest’s test listing flag: `--gtest_list_tests`.
</Step>
</Steps>

<Note>
GoogleTest automatically registers all tests declared with `TEST` or `TEST_F`. Avoid manual test registration.
</Note>

---

### 3. Linking Errors for Mock Classes or Tests

**Problem:** Linker errors related to undefined references to mock methods or `RUN_ALL_TESTS()`.

**Typical Symptoms:**
- Undefined reference to `testing::Test::Test()` or mock method implementations.
- Errors about missing `main()` or multiple `main()` definitions.

**Cause:**
- Mock classes declared but not correctly included or linked.
- Missing linking to GoogleTest or GoogleMock libraries.
- Incorrect test binary configuration.

**Solution:**
<Steps>
<Step title="Define MOCK_METHODS in Public Section">
Ensure that mock methods are declared using the `MOCK_METHOD` macro **inside the public section** of your mock class.
</Step>
<Step title="Provide Definitions for Mock Methods">
`MOCK_METHOD` generates inline method definitions, so ensure your mocks are fully included in your test sources.
If the mock class is in a header, include it where needed.
</Step>
<Step title="Link with GoogleTest / GoogleMock Libraries">
Link against the appropriate libraries, typically `-lgmock -lgtest -lpthread` (or via CMake targets).
</Step>
<Step title="Link Once to gtest_main or Provide main">
Link once to `gtest_main` for default `main()`, or provide your own that calls `RunAllTests()`.
</Step>
</Steps>

---

### 4. Test Failures Due to Misconfigured Expectations or Mock Setup

**Problem:** Tests fail unexpectedly with error messages about unmet expectations or unexpected calls.

**Typical Symptoms:**
- Warnings or errors like "Uninteresting mock function call", "Unexpected mock function call", or unmet call count errors.

**Cause:**
- Expectations (`EXPECT_CALL`) not set before exercising mocks.
- Missing expectations for method calls that occur.
- Incorrect matcher or cardinality specifications.

**Solution:**
<Steps>
<Step title="Set Expectations Before Use">
Always write `EXPECT_CALL(mock, Method(...))` before calling the code under test that uses the mock.
</Step>
<Step title="Use Wildcard Matchers for Uninteresting Calls">
If some mock method calls are irrelevant, use wildcard matchers `_` and/or `Times(AnyNumber())` to allow them.
</Step>
<Step title="Suppress Uninteresting Warnings Using NiceMock">
If warnings about uninteresting calls are distracting, wrap your mock in `NiceMock<YourMock>`.
</Step>
<Step title="Check Call Argument Matchers Carefully">
Ensure matchers match the actual arguments during test execution, or the call will be considered unexpected.
</Step>
</Steps>

<Warning>
Ignoring or suppressing warnings without understanding may hide real bugs.
Use `ON_CALL` for default behavior and `EXPECT_CALL` for verification.
</Warning>

---

### 5. Common Runtime Errors and Crashes

**Problem:** Tests crash or behave unpredictably.

**Typical Causes & Solutions:**
- **Virtual Destructor Missing:** If mocking a class with no virtual destructor, destruction through base pointer causes undefined behavior.
  - **Solution:** Make sure that all classes you mock have virtual destructors.

- **Calling Mock Methods after Object Destruction:** Using objects after they have been deleted or not properly managed.
  - **Solution:** Use proper ownership semantics; often stack allocation ensures timely destruction.

- **Incorrect Test Fixture Setup/Teardown:** Premature exit or resource leaks.
  - **Solution:** Use `SetUp()` and `TearDown()` correctly.

---

## Troubleshooting Tips

- **Use `--gtest_list_tests`** to verify test registration.
- **Run tests with `--gmock_verbose=info`** to see detailed mock call logs and understand expectation matches or failures.
- **Enable heap checker/tools** to detect leaks or use GoogleTest's setup with heap checking enabled.
- **Review mock method signatures** to ensure they match the base interfaces exactly, including `const` and noexcept qualifiers.
- **Use `Mock::VerifyAndClearExpectations(&mock)`** if manually managing mock lifetime.

<Info>
Detailed diagnostic outputs are invaluable for debugging failing or silent tests.
</Info>

---

## Example: Diagnosing an Unexpected Call

Suppose your test prints a warning:

```text
GMOCK WARNING:
Uninteresting mock function call - returning directly.
    Function call: Foo(42)
```

You may have forgotten to tell gMock to expect `Foo(42)`. You can fix it like this:

```cpp
EXPECT_CALL(mock_object, Foo(42));
```

To silence all such warnings for Foo(), but allow the calls, use:

```cpp
EXPECT_CALL(mock_object, Foo).Times(AnyNumber());
```

If these do not resolve the issue, run your test with `--gmock_verbose=info` to trace all mock calls and expectations.

---

## Further Reading and Resources

- [Assertions Reference](https://google.github.io/googletest/reference/assertions.html) — Detailed explanations of assertion macros used in tests.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Complete guide on mock creation and expectations.
- [gMock FAQ](https://google.github.io/googletest/gmock_faq.html) — Common questions and answers around mocking problems.
- [Writing Your First Test](https://google.github.io/googletest/primer.html#writing-the-first-test) — How to write basic tests correctly.
- [Installation Guide](https://google.github.io/googletest/quickstart-cmake.html) — For build and linking setup.

---

## Summary

Proper inclusion of headers, correct use of macros, and appropriate linking are essential to avoiding build and linking errors. Setting expectations correctly and managing mock lifetimes prevents unexpected runtime failures. Thorough diagnostic tools and verbose logging augment troubleshooting capabilities.

For complex issues, consult the official GoogleTest and GoogleMock documentation and community forums for up-to-date best practices and solutions.
