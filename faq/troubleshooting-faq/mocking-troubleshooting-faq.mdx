---
title: "Why are my mock expectations or actions not working as expected?"
description: "Explains how to debug and resolve problems where mock objects do not behave as expected, including unmet expectations, uninteresting calls, and misunderstood matchers or actions. Covers the use of NiceMock, StrictMock, and configuration details."
---

# Why are my mock expectations or actions not working as expected?

This page helps you understand and debug the common problems that arise when mock objects do not behave as expected in GoogleMock. It covers scenarios such as unmet expectations, uninteresting calls, unexpected calls, and incorrect matcher or action specifications. You will also learn how to use `NiceMock`, `StrictMock`, and other configuration details to control warnings and failures related to mock calls.

---

## Common Issues with Mock Expectations and Actions

When GoogleMock's mock objects silently misbehave or report unexpected failures, it usually relates to how expectations and actions are specified and applied.

### 1. Unmet Expectations: Calls Not Happening as Expected

- **Problem:** Your test fails indicating that an expected call to a mock method was never made or was called fewer times than specified.
- **Cause:**
  - `EXPECT_CALL` was not set before the call to the mock method.
  - Call arguments didn't match the matchers, so expectation was never triggered.
  - The number of times expected (`Times()`) does not match actual calls.
  - The call ordering constraints were violated, especially when using sequences or `.After()` clauses.

- **How to Fix:**
  - Set `EXPECT_CALL` **before** exercising the code that calls the mock.
  - Use appropriate [matchers](reference/matchers.md) such as `_` if you are flexible on argument values.
  - Verify you correctly specified the expected cardinality with `.Times()` or allow gMock to infer it properly.
  - Use sequences (`InSequence`) or `.After()` correctly to model call order dependencies.

### 2. Uninteresting Calls: Warnings About Unexpected Method Calls

- **Problem:** When a method without any `EXPECT_CALL` is called, GoogleMock emits warnings about "Uninteresting mock function call" but test does not fail.
- **Cause:**
  - You didn't specify any expectations on this method.
  - By default, gMock treats such calls as "naggy" and emits warnings.
- **How to Fix or Manage:**
  - If these calls are expected and unimportant to your test, consider using `NiceMock<YourMockClass>` to suppress warnings.
  - Alternatively, add a catch-all expectation with `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());` to explicitly allow any calls without warnings.
  - Use `ON_CALL` to set default behaviors without creating expectations.

### 3. Unexpected Calls: Test Failures Due to Calls That Don't Match Expectations

- **Problem:** Your test fails because a call happened with arguments that don't match any `EXPECT_CALL` statements.
- **Cause:**
  - You have expectations on that mock method, but the actual call's argument values don't meet any.
  - The cardinality has been exceeded or the expectation has retired.
- **How to Fix:**
  - Check the actual call arguments versus your matchers.
  - Use diagnostic output with `--gmock_verbose=info` to see detailed call matching.
  - Add broader expectations with wildcards if some calls are acceptable.
  - Use `.RetiresOnSaturation()` to retire an expectation after it's fulfilled to avoid stale matches.

### 4. Actions Not Behaving as You Think

- **Problem:** The mock method's return values or side effects do not occur as specified.
- **Cause:**
  - The ordering of `.WillOnce()` and `.WillRepeatedly()` clauses are incorrect.
  - Overriding previous actions inadvertently by multiple calls to `.WillByDefault()` or chaining mistakes.
  - The `WillOnce` actions are exhausted but no repeated action is specified.
- **How to Fix:**
  - Specify all `.WillOnce()` clauses in correct order, ending with `.WillRepeatedly()` if needed.
  - Confirm that `.WillByDefault()` appears exactly once per `ON_CALL()`.
  - Use lambdas or functors for more complex or state-dependent actions.

---

## Using `NiceMock`, `NaggyMock`, and `StrictMock`

To control warnings and failures on uninteresting calls (methods with no expectations set), gMock provides wrappers:

- **`NiceMock<YourMock>`**: Suppresses warnings on uninteresting calls. Use this to reduce noise when some mock calls are irrelevant.

- **`NaggyMock<YourMock>`**: Default mock behavior; warns on uninteresting calls.

- **`StrictMock<YourMock>`**: Treats uninteresting calls as failures (errors), making the test stricter and more paranoid.

**Example:**
```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;  // Suppresses uninteresting call warnings.
StrictMock<MockFoo> strict_mock;  // Makes uninteresting calls failures.
```

> <Note>
> `NiceMock` and `StrictMock` only affect *uninteresting* calls, not unexpected calls.
> They must be used carefully as strict mocks may cause brittle tests.
> </Note>

---

## Tips for Troubleshooting Mock Expectations and Actions

### Use `--gmock_verbose=info`

Enabling verbose output will show which expectations are being registered and which mock calls are matched to which expectations, including stack traces. This is invaluable when figuring out why an expectation is not being met.

Example:
```bash
your_test --gmock_verbose=info
```

### Verify Call Ordering

If using sequences (`InSequence`) or `.After()`, ensure call order constraints you specified align with actual calls. Violations cause failures.

### Avoid Over-Specification

Don't specify matchers too strictly unless necessary; use wildcards (`_`) where argument values are unimportant to avoid brittle tests.

### Use `.RetiresOnSaturation()` Appropriately

If you have multiple `EXPECT_CALL`s on the same method that apply sequentially, use `.RetiresOnSaturation()` to deactivate expectations after saturation.

### Setting Default Actions with ON_CALL

Use `ON_CALL` to specify default behavior for calls that do not match any `EXPECT_CALL`, particularly to avoid unexpected call failures.

### Clear Expectations Confidently

If you verify and clear expectations mid-test using `::testing::Mock::VerifyAndClearExpectations(&mock_object);`, do not add any new expectations afterwards.

---

## Examples

### Suppressing Uninteresting Call Warnings with NiceMock

```cpp
using ::testing::NiceMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoSomething, (), ());
  MOCK_METHOD(int, GetValue, (), ());
};

TEST(SomeTest, IgnoresUninterestingCalls) {
  NiceMock<MockFoo> mock;

  EXPECT_CALL(mock, DoSomething());

  // Calls to GetValue() won't trigger warnings even with no EXPECT_CALL.
  mock.GetValue();  // No warning
  mock.DoSomething();  // Expected call
}
```

### Setting Expectations in a Sequence with Actions

```cpp
using ::testing::InSequence;
using ::testing::Return;

MockFoo mock;
{
  InSequence s;
  EXPECT_CALL(mock, GetX()).WillOnce(Return(10));
  EXPECT_CALL(mock, GetX()).WillOnce(Return(20));
  EXPECT_CALL(mock, GetX()).WillRepeatedly(Return(30));
}

EXPECT_EQ(10, mock.GetX());
EXPECT_EQ(20, mock.GetX());
EXPECT_EQ(30, mock.GetX());
EXPECT_EQ(30, mock.GetX());
```

---

## Troubleshooting Checklist

- **Have you declared `EXPECT_CALL`s before invoking the mock method?**
- **Are your matchers aligned with the actual call arguments? Use `_` to allow flexibility.**
- **Have you typed the method name and argument list correctly, especially with overloaded or const methods?**
- **Are sequence and ordering clauses (`InSequence`, `.After()`) aligned with the actual call order?**
- **Have you handled uninteresting calls appropriately with `NiceMock` or catch-all expectations?**
- **Do your `WillOnce` and `WillRepeatedly` clauses cover all expected calls?**
- **Use `--gmock_verbose=info` to diagnose call matches and expectation hits.**

---

## Further Reading and Helpful Links

For more comprehensive information and examples, please consult:

- [Mocking Reference](reference/mocking.md) - For full API description of mocking macros and classes.
- [gMock for Dummies](gmock_for_dummies.md) - Beginner-friendly introduction to mocks and expectations.
- [gMock Cookbook](gmock_cook_book.md) - Recipes and best practices for mocking.
- [gMock Cheat Sheet](gmock_cheat_sheet.md) - Quick reference for matchers, actions, and expectations.
- [Mock Object Behaviors](api-reference/mocking-and-stubbing/mock-object-behaviors.md) - Managing warnings and behaviors with `NiceMock`, `StrictMock`, and `NaggyMock`.
- [Setting Expectations](api-reference/mocking-and-stubbing/setting-expectations.md) - Detailed guide to usage of `EXPECT_CALL` and `ON_CALL`.

Explore related troubleshooting and FAQ sections for help on build, linking, and test output issues.

---

## Summary

By understanding the lifecycle of mock expectations, the distinction between uninteresting and unexpected calls, and the correct use of matchers and actions, you can ensure your mocks behave as intended and tests pass reliably. When issues arise, employing verbose debugging, sequences, and proper mock wrappers assists in uncovering mismatches and configuration errors early.

---