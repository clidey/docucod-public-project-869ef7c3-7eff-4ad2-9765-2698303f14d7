---
title: "How can I resolve linker errors, test failures, or unexpected crashes?"
description: "Provides guidance for diagnosing and fixing common linking issues, assertion failures, and process crashes during test runs, including platform and compiler-specific caveats. Directs users to relevant documentation and test files for further insight."
---

# How can I resolve linker errors, test failures, or unexpected crashes?

This guide helps you diagnose and fix common problems encountered during the build and runtime of GoogleTest and GoogleMock tests, including linker errors, assertion failures, and process crashes. It covers typical scenarios, platform and compiler-specific considerations, and provides practical tips and references to deepen your understanding.

---

## 1. Diagnosing Linker Errors

Linker errors often surface after compiling your tests, indicating unresolved symbols or duplicate definitions. In the context of GoogleTest and GoogleMock, these are commonly caused by incorrect build configurations or missing source files.

### Common Root Causes and Solutions

- **Missing GoogleTest/GoogleMock Source Files:** GoogleTest and GoogleMock require linking against their compiled libraries or compiled source files. Ensure that your build system:
  - Includes `googletest` and `googlemock` libraries or source files properly.
  - Links the correct files, especially when using CMake, Bazel, or manual compilation.

- **Incorrect Macro Usage:** Some mocks or test code may depend on macros (`GTEST_` or `GMOCK_`) that are mishandled. Verify that:
  - Your test files include the correct headers such as `<gtest/gtest.h>` and `<gmock/gmock.h>`.
  - The macros like `MOCK_METHOD` and `EXPECT_CALL` are used as described in [Mock Class and Method Macros](../api-reference/mocking-matching-actions/mock-class-macros.mdx).

- **Duplicate Symbols:** If you define mock classes or tests in multiple translation units without proper include guards or inline definitions for mock methods, linker errors can occur.
  - Move mock class constructors and destructors into `.cc` files to speed up compilation and avoid duplicate symbols, as recommended in the [Mocking Patterns and Best Practices](../guides/mocking-techniques/mocking-patterns-and-best-practices.mdx).

- **Platform or Compiler Specific Issues:** Some platforms (particularly Windows with MSVC) may require specific macro qualifiers or calling conventions. Check the use of qualifiers like `Calltype(STDMETHODCALLTYPE)` with `MOCK_METHOD` on platforms requiring them.

### Steps to Resolve Linker Errors

<Steps>
<Step title="Verify Your Build Setup">
Ensure that GoogleTest and GoogleMock libraries or source files are properly included and linked. For multi-platform scenarios, review the installation instructions in [Installation on Multiple Platforms](../getting-started/setup-installation/installation-multiplatform.mdx).
</Step>
<Step title="Check Mock Definitions">
Confirm that all mock classes use `MOCK_METHOD` in the public section, and that complex signatures (with commas) are correctly parenthesized or use type aliases as described in the [Mock Class Macros](../api-reference/mocking-matching-actions/mock-class-macros.mdx).
</Step>
<Step title="Separate Constructor and Destructor">
If linker errors complain about multiple definitions, move the constructor and destructor implementations of your mock classes from the header into a cpp file, following the example in [Mocking Patterns and Best Practices](../guides/mocking-techniques/mocking-patterns-and-best-practices.mdx).
</Step>
<Step title="Use Correct Calling Conventions">
On Windows, if needed, specify the method call type in `MOCK_METHOD` using the `Calltype()` qualifier to match platform conventions.
</Step>
</Steps>

<Tip>
Building and linking GoogleTest/GoogleMock with your project can be streamlined with CMake or Bazel. Properly leverage existing setup scripts and follow [Integration with Build Systems](../guides/real-world-examples/integrating-with-build-systems.mdx).
</Tip>

---

## 2. Handling Test Failures and Assertion Errors

Test failures occur when assertions fail or expectations on mocks are unmet. GoogleTest and GoogleMock provide rich diagnostics. Here’s how you approach and resolve these issues.

### Understanding Test Failure Messages

- **Assertion Failures:** These indicate that your test's `EXPECT_` or `ASSERT_` assertions evaluated to false. To understand them:
  - Read messages carefully: they include the expected value, the actual value, and sometimes subtle details on why the comparison failed.
  - Leverage [Using Assertions Effectively](../guides/core-workflows/using-assertions-effectively.mdx) to write clearer assertions.

- **Mock Expectation Failures:** These occur if:
  - A mocked method is called more or fewer times than expected.
  - Arguments to mock methods do not match the expectations.
  - Calls occur out-of-order or violate sequencing constraints.

GoogleMock outputs detailed messages showing what was expected and what was called, including call stacks when verbosity is enabled.

### Common Mock Failures and Resolutions

- **Unmatched Expectations:** If the test output shows unexpected or unsatisfied calls, investigate whether the `EXPECT_CALL` matchers and cardinalities match the code under test behavior.
  - Use `EXPECT_CALL` with wildcards (`_`) where appropriate to avoid over-specification.

- **Uninteresting Calls:** These occur when a mock method is called with no `EXPECT_CALL` set.
  - By default, GoogleMock emits warnings.
  - Suppress them by using `NiceMock<T>`, or specifically allow calls with `EXPECT_CALL(...).Times(AnyNumber())`.

- **Unexpected Calls:** Occur when calls do not match any expectation.
  - Check your expectations and make sure all expected calls are declared before exercising the test code.

- **Ordering Problems:** Use `InSequence` or `After` clauses to enforce call orders as necessary.

### Using Verbosity to Gain Insights

Run your tests with the flag `--gmock_verbose=info` to see detailed traces of mock method calls and expectation matching. This helps identify why a call matched or did not match an expectation.

### Steps to Fix Test Failures

<Steps>
<Step title="Read Failure Message">
Analyze the GoogleTest or GoogleMock failure output carefully to identify which assertion or expectation failed, what was expected, and what was received.
</Step>
<Step title="Review Expectations and Matchers">
Review your `EXPECT_CALL` and `ON_CALL` statements to ensure they properly reflect what the tested code should do (correct methods, argument matchers, cardinalities, and call sequences).
</Step>
<Step title="Run with Verbose Logging">
Execute your tests using `--gmock_verbose=info` to obtain detailed information about matches and calls for debugging matcher failures.
</Step>
<Step title="Suppress or Allow Uninteresting Calls">
If warnings over uninteresting calls clutter logs, consider using `NiceMock` or explicitly add expectations with `.Times(AnyNumber())` to those calls.
</Step>
<Step title="Check Call Order Constraints">
Confirm sequence rules and `.After()` clauses are correctly set if call order is important.
</Step>
</Steps>

<Info>
GoogleMock’s philosophy is to catch problems early by requiring expectations to be declared before method calls. Reordering your setup to fit this model greatly improves test reliability.
</Info>

---

## 3. Debugging Unexpected Crashes and Runtime Errors

Crashes during tests can derive from many causes including memory corruption, invalid mock usage, or undefined behavior in test or tested code.

### Common Causes of Crashes

- **Dereferencing Null or Invalid Pointers:** Ensure your mocks and test code do not dereference null pointers.

- **Returning Non-Default-Constructible Objects Without Specifying Return:** Mock methods returning non-default-constructible objects *must* have explicit return actions (`WillOnce`, `WillRepeatedly`) set; otherwise, runtime crashes or exceptions occur.

- **Deleting Mock Objects Prematurely:** If a mock deletes itself during an expectation action, make sure the test handles this scenario properly.

- **Improper Mock Setup:** Avoid setting expectations or default actions after the mock method has been called. GoogleMock commands like `EXPECT_CALL` and `ON_CALL` must precede any calls.

- **Threading Issues:** Running tests concurrently without proper synchronization may cause race conditions leading to crashes. Run your test logic on a single thread if possible.

### Troubleshooting Steps

<Steps>
<Step title="Enable Debugging Symbols and Run in Debug Mode">
Compile your tests with debug symbols and run under a debugger to pinpoint crash location.
</Step>
<Step title="Use GoogleTest and GoogleMock Diagnostic Output">
Increase logging verbosity (`--gmock_verbose=info`) to capture call traces prior to the crash, aiding in root cause analysis.
</Step>
<Step title="Validate Mock Return Actions">
For methods returning complex or move-only types (e.g., unique_ptr), ensure explicit return actions are specified to avoid runtime errors. See [Mocking Move-Only Types](../docs/gmock_cook_book.md#Mocking-move-only-types).
</Step>
<Step title="Check for Self-Deletion in Actions">
If your mock deletes itself in a mock method action, ensure that no subsequent calls or operations are done on it in your test.
</Step>
<Step title="Isolate the Problematic Test Case">
Try running the tests one at a time to identify which test triggers the crash.
</Step>
<Step title="Review Threading and Concurrency">
Ensure your mocks aren't being accessed concurrently unless protected by synchronization.
</Step>
</Steps>

<Warning>
Undefined behavior arising from C++ language constructs (e.g., use-after-free, buffer overruns) will cause crashes indistinguishable from mock framework faults. Carefully use sanitizers and static analysis tools to detect such issues.
</Warning>

---

## 4. Additional Tips and Best Practices

- Always initialize GoogleMock and GoogleTest properly before running tests using `InitGoogleMock(&argc, argv);`.
- Use `Mock::AllowLeak(mock_ptr);` if you intentionally want to leak a mock object to avoid false positives in leak detection.
- Avoid nesting `NiceMock`, `StrictMock`, or `NaggyMock` wrappers; apply only one strictness modifier.
- When mocking methods with complex signatures, particularly those with commas, use parentheses or type aliases to ensure correct `MOCK_METHOD` macro parsing.
- If you see warnings related to uninteresting calls, consider if you want to make your mock nice or if you need to add explicit expectations for those methods.
- Use sequences (`Sequence`) and scopes of `InSequence` to control call order deterministically.

---

## 5. Useful References and Further Reading

- [Mock Class and Method Macros](../api-reference/mocking-matching-actions/mock-class-macros.mdx): Detailed macro reference for mock definitions.
- [Expectations, Calls, and Cardinalities](../api-reference/mocking-matching-actions/expectations-calls.mdx): How to precisely specify and control expectations.
- [Mocking Patterns and Best Practices](../guides/mocking-techniques/mocking-patterns-and-best-practices.mdx): Advice and patterns for robust mocking.
- [Testing Legacy and Complex Code](../guides/real-world-examples/testing-legacy-and-complex-code.mdx): Strategies for managing testing in complex environments.
- [Troubleshooting Installation and Setup](../getting-started/first-steps-validation/troubleshooting-setup.mdx): Covers build problems including linker errors.
- [Running Tests and Understanding Results](../guides/getting-started/running-tests-and-understanding-results.mdx): Guide on interpreting test outputs.

---

This page is part of the Troubleshooting and Error Resolution FAQ collection. For discovering why tests might not run or be found, see [Why aren’t my tests running or being discovered?](../faq/troubleshooting-faq/test-discovery-errors.mdx).

---

## Example Quick Fix Scenario

**Problem:** Linker error such as `undefined reference to vtable for MockFoo`.

**Resolution:**

1. Declare the constructor and destructor of the `MockFoo` mock class in the header but provide the implementation in a `.cc` file. This ensures that the compiler/linker generates these symbols only once.

```cpp
// mock_foo.h
class MockFoo : public Foo {
 public:
  MockFoo();
  virtual ~MockFoo();

  MOCK_METHOD(void, DoThis, (), (override));
};

// mock_foo.cc
#include "mock_foo.h"

MockFoo::MockFoo() {}
MockFoo::~MockFoo() {}
```

2. Rebuild your project ensuring the `.cc` file is compiled and linked.

---

## Summary

Diagnosing and resolving linking errors, test failures, and crashes during test execution requires thorough build verification, careful mock definition, and close attention to expectation specifications. Leveraging GoogleMock's verbosity flags, sequences, and best coding practices will help maintain stable and reliable test suites.

---