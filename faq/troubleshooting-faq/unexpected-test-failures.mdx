---
title: "Unexpected Test Failures"
description: "Helps diagnose and resolve situations where tests fail without clear reasons, including assertion failures, test discovery issues, and flaky tests. Offers a step-by-step checklist for debugging failed tests."
---

# Unexpected Test Failures

This page helps you diagnose and resolve situations where tests fail without clear reasons, such as assertion failures, test discovery issues, and flaky tests. It provides a structured, step-by-step checklist for debugging failed tests effectively to minimize frustration and improve test reliability.

---

## Frequently Asked Questions

### Why did my test fail even though I didn't expect it to?
Tests can fail unexpectedly because of multiple reasons such as incorrect assertions, uninitialized state, or flaky conditions caused by timing or environment issues. GoogleTest reports precise failure messages and stack traces to guide you.

### What does a fatal failure mean?
A fatal failure is an assertion failure that aborts the current test function immediately. It prevents further steps in the test from running and marks the test as failed.

### How can I identify flaky tests?
Flaky tests sometimes pass and sometimes fail on the same code due to timing, resource contention, or order dependencies. Use the `--gtest_repeat` flag to rerun tests multiple times and detect flakiness.

### Why are some tests not discovered or run?
Tests may be disabled by prefixing their names with `DISABLED_` or filtered out using `--gtest_filter`. Also, uninstantiated parameterized tests without proper `INSTANTIATE_TEST_SUITE_P` calls won't run.

### What are skipped tests?
Tests that are intentionally not run at this time, often because of unmet preconditions signaled via `GTEST_SKIP()`. They appear as skipped in test reports.

---

## Common Issues & Gotchas

### Assertion Failures Without Clear Messages
- Ensure your assertion macros (`EXPECT_` or `ASSERT_`) include meaningful failure messages using stream operators (`<<`).
- Use predicate assertions or predicate-format assertions to get clearer diagnostics.

### Test Discovery Issues
- Check that test names and suites are correctly spelled and not accidentally prefixed with `DISABLED_`.
- Verify you have instantiated all parameterized tests with `INSTANTIATE_TEST_SUITE_P`.
- If no tests run, try `--gtest_list_tests` to see what GoogleTest recognizes.

### Flaky Tests
- Use `--gtest_repeat=N` to run tests multiple times to identify non-deterministic failures.
- Consider using `--gtest_break_on_failure` when debugging flaky tests under a debugger.

### Mixing Test Fixture Types in the Same Test Suite
- GoogleTest requires all tests in the same suite to use the same test fixture class. Mixing `TEST` and `TEST_F` in the same suite causes failures.

### Skipped Tests in Setup or Teardown
- If a fatal or non-fatal failure occurs in `SetUpTestSuite()`, `SetUp()`, or other lifecycle functions, tests might be skipped or aborted. Check logs carefully.

---

## Understanding Test Failure Messages

GoogleTest test failures include detailed information:

- The **file name** and **line number** where the failure occurred.
- The **type of failure**: non-fatal or fatal.
- The **assertion message**, often including expected and actual values.
- The **stack trace**, if enabled.

Use this information to locate and understand the cause of the failure.

---

## Step-by-Step Checklist for Debugging Failed Tests

<Steps>
<Step title="Review the Failure Output">
Carefully read the failure message printed by GoogleTest. Look for the file name, line number, and assertion message to pinpoint the failure.
</Step>
<Step title="Run the Failing Test in Isolation">
Use the `--gtest_filter` flag with the failing test's full name (e.g., `TestSuite.TestName`) to run only that test. This simplifies diagnosing the issue without noise from other tests.
</Step>
<Step title="Add Diagnostic Messages to Assertions">
If the failure message is insufficient, add custom messages via `<<` operators to the assertions to clarify what each check was validating.
</Step>
<Step title="Check Test Fixture Setup and TearDown">
Verify that the test fixture `SetUp()` and `TearDown()` methods correctly prepare and clean resources. Unexpected state here commonly causes test failures.
</Step>
<Step title="Check for Disabled or Skipped Tests">
Ensure that the test or its suite is not disabled by the `DISABLED_` prefix or unintentionally skipped via `GTEST_SKIP()`.
</Step>
<Step title="Verify Parameterized Test Instantiations">
Ensure all parameterized tests using `TEST_P` are properly instantiated with `INSTANTIATE_TEST_SUITE_P`. Omissions cause tests not to run but may not be obvious.
</Step>
<Step title="Repeat Tests to Detect Flakiness">
Use `--gtest_repeat` to run tests multiple times. Flaky tests can be identified if failures happen intermittently.
</Step>
<Step title="Enable Stack Traces on Failures">
Ensure the `--gtest_stack_trace_depth` flag is set appropriately to show stack traces for failures. Stack traces clarify failure origin.
</Step>
<Step title="Check Test Ordering and Sharding">
If tests fail intermittently, investigate if test order affects state. Use `--gtest_shuffle` to randomize order and environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` if using distributed test sharding.
</Step>
<Step title="Run GoogleTest with Break-On-Failure">
Use `--gtest_break_on_failure` to cause a debugger breakpoint on failures, facilitating interactive debugging.
</Step>
</Steps>

---

## Troubleshooting Procedures

### How to Handle Assertion Failures

1. **Examine the assertion message and values** to understand what was expected and what actually happened.
2. **Check related fixture setup** for state that might invalidate the test.
3. **Add logging or diagnostic messages** to assertions using streaming operators.
4. **Isolate the failing test** with `--gtest_filter` for focused debugging.

### What to Do When No Tests Are Run

1. Use `--gtest_list_tests` to list recognized tests.
2. Make sure tests are not disabled or filtered out.
3. Confirm all parameterized tests are instantiated.
4. Check environment variables affecting sharding.

### Diagnosing Flaky Tests

1. Repeat tests with `--gtest_repeat=N`.
2. Enable shuffle (`--gtest_shuffle`) to detect order-dependent failures.
3. Use `--gtest_break_on_failure` to break on first failure.
4. Inspect test isolation and shared resource usage.

---

## Tips and Best Practices

- Use `ASSERT_*` macros when subsequent test steps depend on critical conditions.
- Use `EXPECT_*` macros to continue testing even after failures to detect multiple problems in one run.
- Use `SCOPED_TRACE` to add helpful context when calling shared test subroutines.
- Name test suites containing death tests with the suffix `DeathTest` to ensure they run first for safety.
- Use `RecordProperty` to add custom metadata to tests for richer reports.
- Ensure stack trace depth is sufficient (via `--gtest_stack_trace_depth`) for easier diagnosis.
- Avoid mixing `TEST()` and `TEST_F()` in the same suite.
- Use `GTEST_SKIP()` in `SetUp()` methods to skip tests based on dynamic conditions.

---

## Further Reading & Related Documentation

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — Introduction and basics
- [Assertions Reference](../reference/assertions.md) — Detailed assertion macros and usage
- [Parameterized & Typed Tests](../reference/testing.md#parameterized-tests) — Managing tests with parameters
- [Advanced GoogleTest Topics](../advanced.md) — Techniques for complex testing scenarios
- [Running Tests and Flags](../advanced.md#running-test-programs-advanced-options) — Control test execution and output
- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting/common-errors) — Fixes for typical installation and runtime problems

For community support and advanced help, see [Finding Further Help & Community Resources](../getting-started/troubleshooting/finding-support).

---

This page is part of the FAQ section related to troubleshooting and helps users understand and debug unexpected test failures effectively.