---
title: "Integration and Build Failures"
description: "Provides solutions for issues integrating GoogleTest/GoogleMock into large codebases or with custom build systems. Covers linker errors, missing symbols, build flags, and mixed-language (C/C++) integration."
---

# Integration and Build Failures FAQ

This page addresses common issues users face when integrating GoogleTest and GoogleMock into large codebases or complex build systems. It focuses on practical solutions for linker errors, missing symbols, required build flags, and challenges encountered when mixing C and C++ code.

---

## 1. Common Integration and Build Problems

### 1.1 Why am I getting linker errors about missing GoogleTest or GoogleMock symbols?

Linker errors often occur because the GoogleTest or GoogleMock libraries are not linked correctly into your test binary. Large projects and custom build systems may require explicit steps to ensure:

- The GoogleTest and GoogleMock static libraries (or shared libraries) are included in your link command.
- All necessary compilation flags, such as those for C++17, are active.
- Source files from GoogleTest or GoogleMock are compiled as part of your build.

<Tip>
Always verify that your build system includes the appropriate GoogleTest/GoogleMock libraries and that no symbols are hidden. For example, when using CMake, ensure `target_link_libraries` includes `gtest` and `gmock`.
</Tip>

### 1.2 How do I add the necessary build flags for GoogleTest/GoogleMock?

- GoogleTest requires compiling with at least C++17 (or later) standard enabled.
- Define any necessary macros only if instructed by your build or integration guide.
- When mixing C and C++ files, ensure C++ linkage is properly handled (see section 2.3).

<Note>
GoogleTest and GoogleMock header files are C++-only. Include them only in C++ source files to avoid linkage and compilation errors.
</Note>

### 1.3 What should I do if my project mixes C and C++ code with GoogleTest?

- Wrap `#include` directives for `gtest/gtest.h` and `gmock/gmock.h` inside extern "C++" when used in mixed-language projects.
- Compile GoogleTest source files as C++.
- When calling C code from your tests, use `extern "C"` in your C headers to ensure correct linkage.

<Tip>
Ensure consistent application of language linkage between your test code and production code to prevent undefined symbols or name mangling issues.
</Tip>

### 1.4 How do I integrate GoogleTest/GoogleMock into a custom build system?

- Compile GoogleTest/GoogleMock source files or link against precompiled libraries.
- Use the official CMake or Bazel build instructions as a reference for flags, include directories, and libraries.
- Explicitly include `-pthread` or equivalent threading flags as GoogleTest uses threads.
- Use `InitGoogleTest(&argc, argv)` early in your test main to initialize framework flags and filters.

<Warning>
Avoid skipping essential source files or build flags; missing these can cause errors only apparent during linking or at test runtime.
</Warning>

## 2. Troubleshooting Common Failures

### 2.1 Missing Symbols or Undefined References to GoogleTest Functions

**Problem:**
Your linker outputs errors such as "undefined reference to `testing::InitGoogleTest(...)`".

**Solution:**

- Make sure to link your test executable with GoogleTest and GoogleMock libraries.
- If you compile GoogleTest/GoogleMock from source, confirm object files are part of the link step.
- On Linux, include `-pthread` during compilation and linking.

### 2.2 Build Flags and Compiler Compatibility Issues

**Problem:**
Compilation fails with errors about language features or missing standard library parts.

**Solution:**

- Verify you compile with C++17 support (e.g., `-std=c++17` flag).
- Check your compiler version meets GoogleTest requirements.
- Avoid mixing incompatible ABI settings between GoogleTest libraries and your code.

### 2.3 Language Linkage Issues in Mixed C/C++ Environments

**Problem:**
Linker errors caused by symbol name mismatches due to C versus C++ linkage.

**Solution:**

- Use `extern "C"` guards in C headers included by C++ test sources.
- Avoid including C++ headers in pure C code.
- Compile GoogleTest source files as C++.

### 2.4 Linking GoogleMock Dependencies

**Problem:**
Undefined symbols related to GoogleMock when mocking in your tests.

**Solution:**

- Include and link GoogleMock libraries explicitly.
- Confirm that `-lgmock` and `-lgmock_main` (if used) appear in your linker flags.
- For the main function, if using GoogleMock's `gmock_main`, link that instead of writing your own.

## 3. Best Practices

- Always keep your GoogleTest and GoogleMock versions synchronized.
- Follow the official build instructions for your build system, especially for CMake and Bazel.
- Use the provided `InitGoogleTest(&argc, argv)` in the `main` function to enable command line flags.
- When adding custom test event listeners, remove the default event listener to avoid duplicate outputs.
- Use verbose output (`--gtest_output=xml:path`) to aid diagnosing test failures related to integration.

## 4. Example: Custom Test Runner Initialization

This example shows how to initialize GoogleTest, customize the output format by replacing the default listener, and run all tests:

```cpp
#include "gtest/gtest.h"

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);

  // Replace the default listener with a custom listener if needed.
  ::testing::TestEventListeners& listeners =
      ::testing::UnitTest::GetInstance()->listeners();
  delete listeners.Release(listeners.default_result_printer());
  listeners.Append(new CustomListener());  // Your custom listener derived from EmptyTestEventListener

  return RUN_ALL_TESTS();
}
```

## 5. Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — A starting point to use GoogleTest.
- [Integration with Build Systems](guides/advanced-practices/integration-build-systems.md) — Guide to integrate with CMake and others.
- [Troubleshooting Common Setup Issues](getting-started/troubleshooting/common-errors.md) — For detailed setup problem solving.
- [Assertions Reference](reference/assertions.md) — Details on how to use assertions effectively.

---

<Tip>
Carefully review your build scripts to ensure all necessary GoogleTest components are included and correctly configured before running tests. Misconfiguration is the root cause of most integration failures.
</Tip>

