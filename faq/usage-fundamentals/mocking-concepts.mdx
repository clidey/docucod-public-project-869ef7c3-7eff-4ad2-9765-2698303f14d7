---
title: "Using GoogleMock: Mocking Essentials"
description: "Addresses key questions about creating and using mocks, including setting expectations, defining actions, handling uninteresting calls, and leveraging the NiceMock, StrictMock, and NaggyMock wrappers. Empowers users to confidently mock dependencies in C++ code."
---

# Using GoogleMock: Mocking Essentials

This page addresses essential user questions about creating and using mocks in GoogleMock. It guides users through the process of setting expectations, defining mock behaviors, handling uninteresting calls, and using special wrappers like `NiceMock`, `StrictMock`, and `NaggyMock` to control mock call strictness. By mastering these concepts, users will confidently mock their dependencies in C++ testing.

---

## 1. Defining Mock Methods and Classes

- Use the `MOCK_METHOD` macro to define mock methods in the `public:` section of your mock class.
  
- Syntax:

  ```cpp
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
  ```

- Example mocking a simple interface:

  ```cpp
  class Turtle {
   public:
    virtual ~Turtle() {}
    virtual void PenUp() = 0;
    virtual void PenDown() = 0;
    virtual void Forward(int distance) = 0;
    virtual int GetX() const = 0;
  };

  class MockTurtle : public Turtle {
   public:
    MOCK_METHOD(void, PenUp, (), (override));
    MOCK_METHOD(void, PenDown, (), (override));
    MOCK_METHOD(void, Forward, (int distance), (override));
    MOCK_METHOD(int, GetX, (), (const, override));
  };
  ```

- To handle return types or arguments with commas (e.g., template types like `std::pair`), either wrap the type in parentheses or use type aliases.

- Mock methods **must** be declared public even if the original method is protected or private to allow `EXPECT_CALL` and `ON_CALL` access.

- For overloaded methods, define a mock method for each overload explicitly, adding `const` qualifier if needed.

- Class templates can be mocked similarly.


## 2. Setting Expectations with `EXPECT_CALL`

- The `EXPECT_CALL(mock, Method(args))` macro defines an expectation that the mock's method will be called with matching arguments.

- Typical usage:

  ```cpp
  EXPECT_CALL(turtle, Forward(100))
      .Times(3)
      .WillOnce(Return())
      .WillRepeatedly(Return());
  ```

- Key clauses in order: `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, `.RetiresOnSaturation()`.

- `Times()` specifies how many calls are expected and supports exact, at least, at most, or any number of times. If omitted, GoogleMock infers the cardinality based on the presence of actions.

- Use `_` matcher to match any argument when you don't care about argument values.

- If multiple `EXPECT_CALL`s are set for the same method, the *last* matching one takes precedence.

- You can sequence expectations to control call order using `InSequence` or `After`.

- To retire expectations once saturated (i.e., prevent them from matching further calls), use `.RetiresOnSaturation()`.


## 3. Defining Default Behaviors with `ON_CALL`

- `ON_CALL(mock, Method(args))` defines default behavior without setting expectations that the method *must* be called.

- Must specify `.WillByDefault(action)` clause to define behavior for matching calls.

- Default actions are overridden by matching `EXPECT_CALL` actions.

- Use `ON_CALL` to reduce test brittleness by specifying default mock behaviors that apply unless overridden.


## 4. Controlling Mock Strictness: NiceMock, NaggyMock, and StrictMock Wrappers

- Mock objects are by default *naggy*: uninteresting calls (calls without expectations) emit warnings but do not fail tests.

- **`NiceMock<MockClass>`** suppresses warnings on uninteresting calls.

- **`NaggyMock<MockClass>`** (default behavior) warns on uninteresting calls.

- **`StrictMock<MockClass>`** treats uninteresting calls as errors, causing test failures.

- Usage:

  ```cpp
  NiceMock<MockFoo> nice_mock;
  NaggyMock<MockFoo> naggy_mock;
  StrictMock<MockFoo> strict_mock;
  ```

- These wrappers inherit constructors of the original mock, so you can pass construction arguments normally.

- Caveats: They only affect methods mocked via `MOCK_METHOD` directly in the mock class, and may not work properly if the mock destructor is non-virtual.


## 5. Using Matchers to Specify Arguments

- Use matchers like `_` for any value, `Eq(value)`, `Ge(n)`, or custom matchers in `EXPECT_CALL` or `ON_CALL` to specify how argument values are matched.

- For multiple arguments, you can also use `.With()` with multi-argument matchers.


## 6. Defining Mock Method Behavior via Actions

- Actions describe what a mock method does when called.

- Use `.WillOnce(action)` to specify behavior for one call, and `.WillRepeatedly(action)` for all subsequent calls.

- Built-in actions include `Return(value)`, `ReturnRef(variable)`, `SetArgPointee<N>(value)`, `Invoke()`, etc.

- Be cautious with side effects: the action expressions are evaluated once at expectation setup, not at call time. Use lambdas or custom actions if dynamic behavior is needed.

- For example:

  ```cpp
  EXPECT_CALL(turtle, GetX())
      .WillOnce(Return(100))
      .WillRepeatedly(Return(200));
  ```

- You can chain multiple actions with `DoAll()` if your mock method affects outputs and returns values.


## 7. Common Usage Patterns and Best Practices

- Define mocks for interfaces or abstract classes you own.

- Place mock class definitions in dedicated headers or test-only libraries to centralize maintenance.

- Use `EXPECT_CALL` only to verify that calls are expected; use `ON_CALL` to set default behaviors.

- Avoid setting expectations after the mock method has been called, to prevent undefined behavior.

- Use `RetiresOnSaturation()` to make expectations non-sticky and avoid upper-bound errors.

- Use sequences (`InSequence`) or `After()` to control the temporal order of expected calls.

- Use `NiceMock` during development or when warnings on uninteresting calls are distracting.

- Use `StrictMock` when you want to catch unexpected mock interactions explicitly as failures.


## 8. Troubleshooting Mock Behavior

- If a mock method is unexpectedly calling the real method, ensure it is declared `virtual` and mocked correctly.

- Use `--gmock_verbose=info` to trace mock calls and understand expectation matching.

- If you get uninteresting call warnings but expect calls, ensure you have proper `EXPECT_CALL` or adjust mock strictness.

- For mocking methods with move-only types, use lambdas to generate return values rather than `Return(std::move(...))`.

- If you need to verify mock expectations before destruction, use `Mock::VerifyAndClearExpectations(&mock)`.


## 9. Example: Writing and Using a Mock Class

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

using ::testing::AtLeast;
using ::testing::_;
using ::testing::Return;

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  // Expect PenDown to be called at least once.
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  // Default behavior for GetX().
  ON_CALL(turtle, GetX()).WillByDefault(Return(0));

  // Code to test, which uses turtle.
  Painter painter(&turtle);

  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```


## 10. Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](reference/mocking.md)
- [Matchers Reference](reference/matchers.md)
- [Actions Reference](reference/actions.md)

---

This document empowers users to create and use mocks effectively in their C++ tests, focusing on clear, expected behaviors and managing mock call strictness.


<AccordionGroup title="Frequently Asked Questions">
<Accordion title="Why do I need to put MOCK_METHOD declarations in the public section?">
Because GoogleMock needs access to mock methods for setting expectations and defining behaviors. Even if the real method is protected or private, the mock methods must be public to allow EXPECT_CALL and ON_CALL to work.
</Accordion>
<Accordion title="How does GoogleMock match calls to expectations?">
GoogleMock searches matching EXPECT_CALL expectations in reverse order of declaration, stopping at the first that matches the call and is active. This lets newer expectations override older ones.
</Accordion>
<Accordion title="What happens if a mock method is called without expectation or ON_CALL?">
If no expectation is set, this is called an uninteresting call. By default, a warning is emitted but it won't fail the test unless using StrictMock.
</Accordion>
<Accordion title="How do I change the behavior of a mock method without expecting it to be called?">
Use ON_CALL() to specify default actions. These act as fallback behavior when no matching EXPECT_CALL is triggered.
</Accordion>
<Accordion title="How do I mock methods that take or return move-only types like std::unique_ptr?">
Use the standard MOCK_METHOD syntax. When returning move-only types, use lambdas in WillOnce/WillRepeatedly to create fresh objects on each call.
</Accordion>
<Accordion title="Can I control the order in which mock calls are expected?">
Yes, use InSequence blocks or the InSequence() clause or After() clause to enforce call ordering.
</Accordion>
<Accordion title="What are NiceMock, NaggyMock, and StrictMock?">
They are wrappers that control how uninteresting calls are handled: NiceMock suppresses warnings, NaggyMock (default) warns, and StrictMock treats as errors.
</Accordion>
</AccordionGroup>
