---
title: "Using Advanced Features"
description: "Offers help for leveraging advanced functionality such as custom assertions, parameterized tests, and death tests. Explains scenarios where these features are useful, common pitfalls, and best practices."
---

# Using Advanced Features

This page helps you leverage advanced GoogleMock functionality such as custom assertions, parameterized tests, and death tests. It explains practical scenarios where these features provide value, points out common pitfalls, and shares best practices.

---

## 1. Custom Assertions

When writing tests, sometimes your test logic requires conditions beyond simple equality or built-in matcher checks. Custom assertions let you extend GoogleTest/GoogleMock with domain-specific validations and richer diagnostics.

### Why Use Custom Assertions?
- To clarify test intent by capturing complex checks in dedicated functions.
- To produce meaningful failure messages that explain *why* an argument or condition failed.
- To reuse validation logic across multiple tests, improving maintainability.

### How to Write Custom Assertions
You can write *assertion functions* or *matchers*:

- **Assertion Functions:** Return `testing::AssertionResult` and generate readable messages.
- **Matchers:** Implement the matcher interface or use `MATCHER` macros to create reusable expression-based matchers.

Example of a simple assertion function:

```cpp
::testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0) return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << n << " is not even";
}

// Usage
EXPECT_TRUE(IsEven(value));
```

Example of a custom matcher using `MATCHER` macro:

```cpp
MATCHER(IsDivisibleBy3, "checks if value is divisible by 3") {
  return (arg % 3) == 0;
}

// Usage
EXPECT_CALL(mock, Foo(IsDivisibleBy3()));
```

### Best Practices
- Keep matchers and assertions pure (no side-effects).
- Report detailed failure explanations for quicker debugging.
- Use parameterized custom matchers (`MATCHER_P`) when the validation requires parameters.

For more information about matchers and assertions, see [Custom Matchers and Actions](concepts/extensibility-matchers-actions/customization-interfaces.md).

---

## 2. Parameterized Tests

Parameterized tests help you write a single test logic executed with multiple input parameters, improving test coverage and reducing code duplication.

### When to Use
- When the same test case should run with different data sets or configurations.
- When you want to validate behavior across a range of inputs.

### How It Works
GoogleTest provides `TEST_P` and `INSTANTIATE_TEST_SUITE_P` macros:

```cpp
class MyTest : public ::testing::TestWithParam<int> {};

TEST_P(MyTest, IsEvenTest) {
  int n = GetParam();
  EXPECT_EQ(n % 2, 0);
}

INSTANTIATE_TEST_SUITE_P(EvenNumbers,
                         MyTest,
                         ::testing::Values(2, 4, 6, 8));
```

Each value provided to `Values()` runs the test once with that parameter.

### Integration with Mocking
You can use parameterized tests with mocks to:
- Test interactions with varying input values cleanly.
- Combine with custom matchers to validate argument ranges or properties.

### Best Practices
- Name test instances clearly.
- Use input sets reflecting realistic and boundary conditions.
- Avoid overly large parameter spaces that slow down test runs.

For more, see [Parameterized and Type-Parameterized Tests](api-reference/core-testing-apis/parameterized-and-typed-tests.md).

---

## 3. Death Tests

Death tests verify that your program terminates (or crashes) under certain conditions, ensuring correct handling of fatal errors or invalid inputs.

### Typical Use Cases
- Validating that invalid parameters cause the program to abort.
- Ensuring invariant violations trigger proper termination.
- Checking that assertions, fatal errors, or `abort()` calls happen as expected.

### How to Write Death Tests
Use `EXPECT_DEATH` or `ASSERT_DEATH` macros:

```cpp
EXPECT_DEATH(
  { CallFunctionWithInvalidArgument(); },
  "error message regex or substring"
);
```

- The second argument is a regex or substring expected in stderr.
- GoogleTest runs the code in a separate process and confirms it exits as expected.

### Tips
- Death tests run slower as they fork subprocesses.
- Keep their scope narrow.
- Use conservative regex patterns to avoid flakiness.

For detailed guidelines, see [Death Tests](api-reference/core-testing-apis/assertions-reference.md#death-tests).

---

## 4. Common Pitfalls with Advanced Features

### Over-specification in Expectations
Avoid setting expectations that are too strict (e.g., exact argument values or call counts), which can make tests brittle and break with unrelated changes.

### Misuse of `WillOnce` and `WillRepeatedly`
Remember that `WillOnce` actions are used in order and exhausted, then the default action or `WillRepeatedly` is used. If you specify fewer `WillOnce` than calls expected, default actions kick in unexpectedly.

### Ignoring Uninteresting Calls
Uninteresting calls (methods with no `EXPECT_CALL`) produce warnings by default. Use `NiceMock` to silence these if calls are truly unimportant, or explicitly add expectations with `Times(AnyNumber())` if they are allowed.

### Custom Matchers Must be Pure
Side effects inside matchers cause unpredictable behavior and obscure test results. Keep matchers pure and deterministic.

---

## 5. Best Practices

- **Use `ON_CALL` vs `EXPECT_CALL` appropriately:** `ON_CALL` sets default behavior without expecting a call, while `EXPECT_CALL` sets behavioral expectations to verify.
- **Leverage sequences and `InSequence` for ordered calls:** Explicitly define call ordering when necessary to test complex interaction patterns.
- **Use `RetiresOnSaturation()` to avoid sticky expectations:** Prevent exhausted expectations from blocking other matching calls.
- **Wrap complex checks in custom matchers or assertions:** Improves readability and diagnostics.
- **Use `NiceMock` during development:** To avoid noisy warnings, switch to stricter mock wrappers when ready.

---

## 6. Resources and Further Reading

- [Mocking Reference](docs/reference/mocking.md) — official macro and class references.
- [gMock for Dummies](docs/gmock_for_dummies.md) — beginner-friendly introduction.
- [gMock Cookbook](docs/gmock_cook_book.md) — recipes and advanced usage patterns.
- [Legacy gMock FAQ](docs/gmock_faq.md) — answers to common concerns and edge cases.
- [Matchers Reference](api-reference/mocking-apis/matchers-reference.md) — extensive matcher usage.
- [Actions and Custom Behaviors](api-reference/mocking-apis/actions-and-custom-behaviors.md) — control how mocks behave.

Explore these to build mastery in using GoogleMock’s powerful capabilities with confidence and correctness.

---

**Example Snippet: Using Custom Matcher with Parameterized Test**

```cpp
MATCHER_P(IsWithinRange, range, "Checks if value is within range") {
  return abs(arg) <= range;
}

class RangeTest : public ::testing::TestWithParam<int> {};

TEST_P(RangeTest, ValuesAreSmallEnough) {
  int val = GetParam();
  EXPECT_THAT(val, IsWithinRange(10));
}

INSTANTIATE_TEST_SUITE_P(
    SmallValues, RangeTest,
    ::testing::Values(0, 5, -7, 10));
```

**This code tests that all parameters are within 10 using a custom matcher.**

---

This documentation page empowers you to harness GoogleMock’s advanced features effectively by combining deep understanding, practical guidance, and best practices to craft robust and maintainable tests.