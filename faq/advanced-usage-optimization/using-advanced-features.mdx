---
title: "Using Advanced Features (Mocking, Death Tests, Parameterized Tests)"
description: "FAQ entries for leveraging advanced framework capabilities like mocking, death tests, parameterized and typed tests. Helps users include sophisticated testing strategies and maximize feature use."
---

# Frequently Asked Questions: Using Advanced Features (Mocking, Death Tests, Parameterized Tests)

This FAQ helps you master sophisticated testing strategies with GoogleTest and GoogleMock's advanced capabilities, enabling you to write robust, maintainable, and precise tests.

---

## Mocking Advanced Behaviors

### How can I perform multiple side effects and return a value in a mock method?
Use the `DoAll` action to combine multiple actions. All but the last must return `void`, and the last action determines the return value.

```cpp
EXPECT_CALL(mock, Method(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```
Here, argument 0 is set to 5 as a side effect, then the method returns `true`.


### How do I delete a pointer argument passed to a mock method?
Use `DeleteArg<N>()`, where `N` is the zero-based argument index:

```cpp
EXPECT_CALL(mock, Method(_))
    .WillOnce(DeleteArg<0>());  // Deletes the pointer at argument 0
```


### I want my mock method to do different things based on argument values. How?
Set multiple `EXPECT_CALL`s with matchers specifying argument constraints. The last matching expectation wins.

```cpp
EXPECT_CALL(foo, Func(_)).WillRepeatedly(Return(false)); // Default
EXPECT_CALL(foo, Func(Lt(5))).WillRepeatedly(Return(true)); // More specific
```

The call with argument `< 5` returns `true`; others return `false`.


### How can I invoke a real function, functor, or lambda as the action of a mock method?
Use `Invoke()` or `InvokeWithoutArgs()`. Examples:

```cpp
// Using a free function
EXPECT_CALL(mock, Calculate(_, _))
    .WillOnce(Invoke(&RealCalculate));

// Using a member function
EXPECT_CALL(mock, Check(_))
    .WillOnce(Invoke(&obj, &Obj::Check));

// Using a lambda
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int x) { return x * 2; });
``` 


### How do I invoke a function that is passed as an argument to the mock method?
Use `InvokeArgument<N>(args...)` to invoke the Nth argument (0-based) as a callable.

```cpp
EXPECT_CALL(mock, AsyncMethod(_, _))
    .WillOnce(InvokeArgument<1>(42));  // Invokes argument #1 (callback) with 42
```
If some arguments to the callable should be passed by reference, wrap them with `std::ref()`.


### What does `ReturnPointee()` do?
When your mock method returns the value pointed to by an argument or external pointer at call time, use `ReturnPointee(ptr)`:

```cpp
int x = 5;
EXPECT_CALL(mock, GetVal())
    .WillRepeatedly(ReturnPointee(&x));
// Changes to `x` are reflected in return values.
```


### Can I set default actions on mock methods that behave differently based on arguments?
Yes! Use `ON_CALL` with matchers assigning default behaviors:

```cpp
ON_CALL(mock, Func(_))
    .WillByDefault(Return(false));
ON_CALL(mock, Func(Lt(10)))
    .WillByDefault(Return(true));
```
The last matching `ON_CALL` takes precedence, just like with `EXPECT_CALL`.


## Death Tests Basics

### What are death tests?
Death tests verify that code crashes or exits in expected ways under error conditions, ensuring the program handles fatal errors correctly.


### How do I write a basic death test?
Use GoogleTest macros `EXPECT_DEATH(statement, regex)` or `ASSERT_DEATH(statement, regex)`, where `statement` triggers the crash and `regex` matches the expected output message.

```cpp
EXPECT_DEATH(DangerousFunction(), "fatal error");
```


### What styles of death tests does GoogleTest support?
* **Fast Death Tests**: run the death test in a separate process. Recommended for speed and safety.
* **Thread-Safe Death Tests**: useful when your program is multi-threaded.

Configure styles using `--gtest_death_test_style`.


### How can I debug failing death tests?
* Run with `--gtest_death_test_style=threadsafe` or `fast` to see which is more reliable.
* Use `--gtest_internal_run_death_test=1` for verbose logs.
* Ensure regex matches the error message exactly.


## Parameterized Tests

### What is a parameterized test?
A test that runs multiple times with different input values or types, avoiding code duplication and enabling coverage over a range of inputs.


### How do I create value-parameterized tests?
Use `TEST_P` to define the test, `INSTANTIATE_TEST_SUITE_P` to supply parameters. Example:

```cpp
class MyTest : public ::testing::TestWithParam<int> {};

TEST_P(MyTest, HandlesValue) {
  int param = GetParam();
  EXPECT_TRUE(FunctionUnderTest(param));
}

INSTANTIATE_TEST_SUITE_P(MyGroup, MyTest, ::testing::Values(1, 2, 3));
```


### How do I create typed-parameterized tests?
Use `TYPED_TEST` with a test fixture template:

```cpp
template <typename T>
class MyTypedTest : public ::testing::Test {};

TYPED_TEST_SUITE(MyTypedTest, MyTypes);

TYPED_TEST(MyTypedTest, DoesSomething) {
  TypeParam value;
  EXPECT_TRUE(FunctionUnderTest(value));
}
```


### Can I combine parameterized tests with mocks?
Absolutely! You can instantiate tests with different mock configurations or pass parameters that affect mock behaviors.


## Best Practices and Tips

### When to use `ON_CALL` vs `EXPECT_CALL`?
* Use `ON_CALL` to specify default actions without enforcing call counts.
* Use `EXPECT_CALL` to verify that calls occur with specific arguments and counts.
* Avoid over-specification: prefer `ON_CALL` unless you need to assert the call.


### How to manage uninteresting calls?
* By default, they generate warnings.
* Use `NiceMock` to suppress warnings.
* Use `StrictMock` to make uninteresting calls errors.
* To silence warnings on specific methods, add `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.


### How to handle overloaded methods in expectations?
Disambiguate using full signatures or use `Const()` for const-qualified overloads:

```cpp
EXPECT_CALL(mock, OverloadedMethod(_));      // Non-const
EXPECT_CALL(::testing::Const(mock), OverloadedMethod(_));  // Const
```


### How to deal with move-only types?
`MOCK_METHOD` supports move-only arguments and returns. Use lambdas or callables for `WillOnce`/`WillRepeatedly` to produce new objects each call.


### How to verify that all expectations are met before mock destruction?
Use `Mock::VerifyAndClearExpectations(&mock)` to explicitly verify and clear expectations when you control mock lifetime manually.

---

## Additional Resources

- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) – Practical recipes and examples.
- [Actions Reference](../reference/actions.md) – Detailed descriptions of built-in actions.
- [Mocking Reference](../reference/mocking.md) – Core mock concepts and usage.
- [Death Tests Guide](../guides/advanced-and-integrations/death-tests-and-error-handling.md) – Writing and debugging death tests.
- [Parameterized Tests Reference](../api-reference/core-testing-apis/parameterized-and-typed-tests.md) – Comprehensive guide to parameterized test usage.

For deeper learning, consult the related topics in the navigation map or the full GoogleTest and GoogleMock documentation.

---

This FAQ is part of the Advanced Usage & Optimization FAQ series, empowering you to unlock full power and precision in your C++ testing efforts.
