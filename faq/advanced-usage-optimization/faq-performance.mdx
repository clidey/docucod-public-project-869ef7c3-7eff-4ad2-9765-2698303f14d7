---
title: "Performance and Scalability Tips"
description: "Addresses questions about speeding up test execution, reducing overhead, and scaling large test suites. Includes tips for running tests in parallel, minimizing test runtime, and understanding test discovery behavior."
---

# Performance and Scalability Tips

This page provides focused guidance on speeding up test execution, minimizing overhead from test runs, and effectively scaling large GoogleTest and GoogleMock test suites. Whether you are maintaining a small project or managing thousands of tests across CI pipelines, these tips help you achieve fast, reliable feedback.

---

## 1. Running Tests in Parallel

### Why Run Tests in Parallel?
Modern codebases can have thousands of test cases taking significant build and test time. Running tests in parallel, across cores or machines, drastically reduces total runtime and improves productivity.

### Strategies to Parallelize Tests
- **Divide by Test Executables:** Build multiple test binaries, each containing a subset of tests to run independently.
- **Use Test Runners:** Leverage tools like `gtest-parallel` or CI systems that support test sharding.
- **Test Filtering:** Use GoogleTest's filtering flags (e.g., `--gtest_filter`) to select tests per shard.

<Tip>
To run subsets of tests in parallel, build logically grouped test binaries and invoke them simultaneously with filtered test sets.
</Tip>

### Practical Example
```bash
# Run all tests matching FooTest.* in parallel with 4 shards
for SHARD in $(seq 0 3); do
  ./my_test_binary --gtest_filter=FooTest.* \
                  --gtest_shard_count=4 \
                  --gtest_shard_index=$SHARD &
done
wait
```

### Best Practices
- Avoid global shared state or ensure tests isolate external data/resources to prevent race conditions.
- Use synchronization primitives or fixtures carefully with parallel runs.
- Validate tests behave identically in serial and parallel.

## 2. Minimizing Test Runtime

### Key Areas to Optimize
- **Fixture Setup and Teardown:** Minimize expensive setup; prefer `SetUpTestSuite` over `SetUp` when appropriate.
- **Avoid Flaky Tests:** Flakiness wastes CI time; identify and stabilize flaky tests.
- **Mock Dependencies:** Replace slow or external resources (e.g., DB, network) with mocks/fakes.

<Tip>
Optimize fixtures by moving once-per-suite setup operations to static setup methods.
</Tip>

### Example: Optimizing Fixture Setup
```cpp
class DatabaseTest : public ::testing::Test {
protected:
  static void SetUpTestSuite() {
    // Connect to test DB and initialize schema once per test suite
  }

  void SetUp() override {
    // Prepare transaction or reset state before each test
  }
};
```

### Other Tips
- Cache expensive computations or data within the fixture.
- Use GoogleMock to mock slow dependencies, specifying minimal expectations.

## 3. Understanding and Controlling Test Discovery Behavior

### How GoogleTest Discovers Tests
GoogleTest automatically registers tests defined with `TEST()` and related macros at program startup, before `main()` runs. Tests are discoverable by their suite and test names.

### Filtering Tests
Use `--gtest_filter` to select tests by name with wildcard support:

```bash
./my_test_binary --gtest_filter=MySuite.MyTest
./my_test_binary --gtest_filter=MySuite.*
./my_test_binary --gtest_filter=-MySuite.FailingTest
```

### Running Tests Multiple Times
Control repeated execution with `--gtest_repeat=N` for reruns to catch flaky tests.

### Randomizing Test Order
Use `--gtest_shuffle` and seed it with `--gtest_random_seed` to detect inter-test dependencies.

<Note>
Running tests in a different order or multiple times helps identify flaky or state-dependent tests that impact scalability and reliability.
</Note>

## 4. Avoiding Common Performance Pitfalls

### Unnecessary Work per Test
- Avoid costly operations repeated unnecessarily in each test case.
- Place code common to many tests in suite-level setup.

### Large Shared Objects
- Minimize use of large global/shared objects accessed by multiple tests.
- Ensure thread-safe access or proper isolation.

### Excessive Mocking Overhead
- Excessive detailed mock expectations can slow tests.
- Use `NiceMock` to suppress warnings for uninteresting calls and reduce verification overhead.

### Resource Leaks
- Leaked mocks or resources slow tests or cause spurious failures.
- Use `Mock::VerifyAndClearExpectations()` to verify explicitly when needed.

## 5. Tips for Scaling Large Test Suites

- **Modularize Tests:** Group tests logically into smaller binaries.
- **Incremental Test Runs:** Run only changed or relevant tests in local development.
- **Continuous Integration Practices:** Integrate test runs with CI sharding and parallel execution.
- **Monitor Performance:** Track test durations and flaky tests over time for targeted improvements.

<Tip>
Consider using `--gtest_break_on_failure` to stop testing early when a failure occurs, saving time in large slow suites.
</Tip>

## 6. Troubleshooting Slow or Unscalable Test Runs

If test runs are slower than expected:

- Profile test execution to identify slow tests or fixtures.
- Check for implicit serialization due to shared resources.
- Verify parallel runs do not cause contention.
- Use `--gtest_print_time` to see tests' running times.

Example to print timing:

```bash
./my_test_binary --gtest_print_time
```

## 7. Additional Resources

- [GoogleTest Parallel Test Execution Guide](https://google.github.io/googletest/parallel_tests.html)
- [Using GoogleMock to Speed Up Tests](https://google.github.io/googletest/gmock_cook_book.html#advanced-mock-usage)
- [Continuous Integration and Scalability](../guides/best-practices-integration/continuous-integration.mdx)
- [Performance Optimization & Scaling Test Suites](../guides/best-practices-integration/performance-and-scaling.mdx)

---

For a full understanding of test lifecycle, discovery and execution control, please refer to [Test Discovery and Execution Lifecycle](../concepts/testing-architecture/test-discovery-lifecycle.mdx) and [Test Runtime & Integration](../api-reference/platform-tools-runtime/test-runtime-integration.mdx).


---

<Check>
Always balance your test granularity for effective parallel execution.
Avoid overusing expectations that can slow down GoogleMock verification.
Use profiling and timing outputs to detect slow tests and optimize accordingly.
</Check>

<Info>
Use `--gtest_help` and `--gmock_help` to explore advanced flags controlling test execution and discovery.
</Info>

---