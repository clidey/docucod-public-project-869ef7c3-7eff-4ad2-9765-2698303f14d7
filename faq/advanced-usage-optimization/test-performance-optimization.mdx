---
title: "Improving Test Performance"
description: "Common questions and answers about speeding up test suites, minimizing build times, and reducing test flakiness. Includes advice on test selection, parallel execution, and best practices for fast feedback."
---

# Improving Test Performance

This FAQ page addresses practical questions and best practices for accelerating your test suites, minimizing build and execution time, and reducing test flakiness. Whether you want faster feedback in continuous integration or smoother local development testing cycles, this guide delivers concrete advice on test selection, parallel execution, and other strategies.

---

## Frequently Asked Questions

### How can I speed up my test suite execution?

- **Run only relevant tests:** Use filtering via the `--gtest_filter` flag to run only the tests related to the recent changes or debugging session.
- **Parallelize tests:** Leverage GoogleTest's built-in sharding support or external test runners to execute tests in parallel across multiple CPUs or machines.
- **Avoid slow tests in critical workflows:** Isolate slow integration or system tests into separate test suites that don't run on every code change.

### What is test sharding and how do I use it?

Test sharding splits tests into multiple groups (shards) that run independently in parallel. Set the environment variables `GTEST_TOTAL_SHARDS` (total number of shards) and `GTEST_SHARD_INDEX` (index of the current shard) before running a test binary to enable sharding.

```shell
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0  # Run on the first shard
./my_test_binary
```

Each shard will execute a subset of the tests, ensuring all tests run exactly once across all shards.

### How can I reduce test flakiness?

- **Avoid shared mutable state:** Use test fixtures properly and ensure tests are isolated.
- **Prefer deterministic test data and ordering:** Avoid hidden dependencies on test execution order. Use `--gtest_shuffle` for detecting order dependencies.
- **Limit external dependencies:** Mock external services where possible using GoogleMock to reduce variability.
- **Manage concurrency carefully:** When testing multithreaded code, synchronize interactions and use GoogleMock's thread safety features.

### Does GoogleTest support running tests in parallel within the same binary?

GoogleTest does not internally execute tests in parallel threads within a single binary. Parallelism is achieved by running multiple test executables or shards concurrently. You can use external tools or test runners to distribute multiple test binaries or shard indices to parallel workers.

### How do I selectively run tests for faster feedback?

Use `--gtest_filter` with positive and negative wildcards matching test suite and test name patterns.

```shell
# Run all tests in MySuite
./test_binary --gtest_filter=MySuite.*

# Run tests with names containing "Fast"
./test_binary --gtest_filter=*.Fast*

# Run everything except tests containing "Slow"
./test_binary --gtest_filter=-*Slow*
```

Combine this with `--gtest_repeat` to detect and debug flaky tests by running them multiple times.

### What best practices help keep tests fast?

- **Limit expensive setup/teardown:** Use `SetUpTestSuite()` and `TearDownTestSuite()` to set shared expensive resources once per suite.
- **Prefer small, focused unit tests:** Smaller tests run quickly and isolate failures better.
- **Cache expensive fixtures or resources:** Avoid recomputing or recreating objects unnecessarily.
- **Mock external interactions:** Avoid real network, database, or file system calls in unit tests.

### How do I ensure my test suite scales as codebase grows?

- Organize tests hierarchically into test suites by feature or component.
- Use parameterized and typed tests to avoid duplicating similar tests with different data or types.
- Adopt test sharding and parallel execution in CI systems.
- Monitor test execution times and flakiness via reporting and adjust accordingly.

### Are there recommended flags or environment variables to optimize test execution timeliness?

- `--gtest_fail_fast=1` stops the test run immediately on the first failure.
- `--gtest_shuffle` randomizes test execution order to detect dependencies.
- `--gtest_repeat=N` reruns tests N times to find flaky tests.
- Use `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` for parallel distribution.

### How to minimize build times related to tests?

- Move large mock class constructors/destructors out of header files into `.cc` files.
- Avoid recompiling all tests when only some tests or production code has changed.
- Use precompiled headers and incremental builds.
- Prefer `NiceMock` to reduce warnings and improve build performance related to mocking.

---

## Tips and Best Practices

- Filter and shard tests aggressively during development to get quick feedback.
- Isolate slow tests in separate suites or CI lanes.
- Invest in effective mocking to isolate tests and reduce external dependencies.
- Use `INSTANTIATE_TEST_SUITE_P` wisely to cover multiple parameters without redundant code.
- Employ `SCOPED_TRACE` for easier diagnosis when tests fail due to complex setups or parameterized iterations.
- Utilize thread-safe testing and synchronizations for concurrent tests.

---

## Troubleshooting Common Performance Issues

### My test suite is slow and timing out in CI. What do I do?

- Profile test execution to identify slow tests.
- Break up slow tests into smaller, more focused tests.
- Isolate slow or flaky tests into separate jobs.
- Use test sharding or distributed runs.

### Why are my tests flaky despite seeming deterministic?

- Check for hidden shared state or dependencies among tests.
- Confirm all resources are properly cleaned up in fixtures.
- Investigate timing issues or race conditions if using concurrency.
- Run tests repeatedly with `--gtest_repeat` to catch non-deterministic failures.

### How do I check test execution times?

GoogleTest prints test execution durations by default. You can disable it with `--gtest_print_time=0`, or review timings to identify the slowest tests.

### How can I debug test selection and filtering?

Run the test binary with `--gtest_list_tests` to see available test suites and tests. This helps in crafting filters.

---

## Additional Resources

- [GoogleTest Primer](../primer.md) for foundational understanding of test writing.
- [Value-Parameterized & Typed Tests](../api-reference/core-testing-apis/parameterized-and-typed-tests.mdx) to reduce test duplication.
- [GoogleMock Documentation](../api-reference/mocking-and-matchers/mock-classes-and-methods.mdx) for mocking external dependencies.
- [Sharding and Parallel Runs](../advanced.md#distributing-test-functions-to-multiple-machines) for parallelization tactics.
- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting/common-setup-issues.mdx) for environment and build-related fixes.

---

For a detailed explanation of all related concepts, refer to the [GoogleTest Primer](../primer.md) and the [Advanced Topics](../advanced.md).

All commands, flags, and environment variables mentioned here are applicable to the GoogleTest and GoogleMock C++ testing frameworks.


