---
title: "Build and Integration Troubleshooting"
description: "Resolves common integration and build errors, addressing linking issues, compiler compatibility (including C++17 requirements), and how to set up GoogleTest and GoogleMock with popular build systems. Includes advice for resolving platform-specific challenges."
---

# Build and Integration Troubleshooting

GoogleTest is a robust C++ testing framework widely used across platforms and projects. However, setting it up and integrating it into your build environment can occasionally lead to issues, especially related to linking, compiler compatibility, or platform-specific peculiarities.

This guide helps you systematically resolve common build and integration errors, offering practical tips and clarity to get your GoogleTest and GoogleMock usage up and running smoothly.

---

## 1. Common Build and Linking Issues

### Why Am I Getting "Undefined Reference" Errors?

This is the most common problem new users encounter when linking tests with GoogleTest.

- **Cause:** Typically, it means that your linker cannot find the GoogleTest or GoogleMock libraries or source files.
- **Resolution Steps:**
  1. **Ensure GoogleTest is built properly:** Build GoogleTest as a static or shared library before linking.
  2. **Link Against Correct Targets:** Link your test binaries against the `gtest` and possibly `gmock` libraries, e.g., `-lgtest -lgmock`.
  3. **Include GoogleTest Sources:** When building manually or integrating sources directly, make sure you include `gtest-all.cc` or `gmock-all.cc` in your build.
  4. **Consistent Build Modes:** Ensure that all parts of your build use the same runtime library options (e.g., static vs dynamic CRT on Windows).
- **Example using CMake:**

  ```cmake
  find_package(GTest REQUIRED)
  target_link_libraries(my_test PRIVATE GTest::gtest GTest::gtest_main)
  ```

### Linking Errors about `main()`

- When you get linker errors about missing `main`, when using GoogleTest, you either:
  - Forgot to link against `gtest_main` which provides a default main.
  - Or you need to write your own `main()` calling `testing::InitGoogleTest()` and `RUN_ALL_TESTS()`.

### Symbol Visibility and Macro Definitions

- When building GoogleTest as a shared library, define
  `-DGTEST_CREATE_SHARED_LIBRARY=1` while building GoogleTest.
- When linking against a shared GoogleTest library, define
  `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` in your test project.
- These flags ensure symbols are exported and imported correctly.

### Avoid Macro Clashes

If you encounter macro definition conflicts with other libraries:

- Disable conflicting macros by defining `-DGTEST_DONT_DEFINE_<MACRO_NAME>=1`.
- For example, `-DGTEST_DONT_DEFINE_TEST=1` will avoid defining the `TEST` macro.


## 2. Compiler Compatibility & Requirements

### C++17 Requirement

GoogleTest requires a C++17-compatible compiler environment. If you get build or compiler errors:

- Confirm your compiler supports C++17.
- Add compiler flags such as `-std=c++17` or `/std:c++17`.
- When using CMake, specify:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

### Default Constructors for Test Fixtures

- GoogleTest expects test fixtures to have default constructors.
- If your fixture declares non-default constructors or contains `const` members, provide an explicit default constructor.

### Exception Support

- GoogleTest can be built with or without exception handling.
- If exceptions are disabled, `ASSERT_*` macros cannot be used in functions returning non-void.
- Check your project settings if you encounter error messages related to exceptions or fatal assertions.


## 3. Setting Up GoogleTest with Popular Build Systems

### Using CMake

GoogleTest provides a ready-made CMake project.

- **Standalone Build:**

  ```bash
  git clone https://github.com/google/googletest.git
  cd googletest
  mkdir build && cd build
  cmake .. -DBUILD_GMOCK=OFF  # Optional: skip GoogleMock
  make
  sudo make install  # Optional
  ```

- **Integrating with Your Project:**

  You can add GoogleTest as a subdirectory for seamless integration:

  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
  )
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # On Windows
  FetchContent_MakeAvailable(googletest)

  add_executable(my_test test.cpp)
  target_link_libraries(my_test PRIVATE gtest_main)
  add_test(NAME my_test COMMAND my_test)
  ```


### Using Other Build Systems

- For Bazel and similar, consult your environment's best practices for integrating external C++ libraries.
- Always ensure that compile flags like C++17 standard and linked runtime libraries match GoogleTest's build.


## 4. Platform-Specific Challenges and Tips

### Windows

- If you get linking errors related to the CRT mismatch (`MTd` vs `MDd`), use the CMake option `gtest_force_shared_crt`:

  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```

- Make sure to open your command prompt using a Visual Studio Developer Command Prompt to set environment variables for your compiler and linker.

- When writing `main()`, GoogleTest supports Unicode (wide-char) arguments, so you can use `InitGoogleTest(int*, wchar_t**)` if needed.

### Linux/macOS

- Ensure proper pthread flags are set if using threading:

  - Use `-pthread` on GCC/Clang.

- Address any permissions issues when compiling or installing.

- For faster death tests, set the flag:

  ```cpp
  GTEST_FLAG_SET(death_test_style, "fast");
  ```

### Dealing with Death Tests

- Death tests run the test statement in a subprocess to verify expected crashes.
- **Common pitfall:** Death tests should be run in a single-threaded context to avoid undefined behavior.
- Use `--gtest_death_test_style=threadsafe` for platforms with heavy threading but expect slower test runs.


## 5. Troubleshooting Tips and Best Practices

### Installation Validation

- After building and integrating, run example or sample tests to verify everything works:

  ```bash
  ./my_test
  ```

- Use `--gtest_list_tests` flag to list available tests.

### Managing Disabled Tests

- Prefix test names with `DISABLED_` to temporarily disable failing or incomplete tests without removing them.
- To run disabled tests, pass `--gtest_also_run_disabled_tests`.

### Fixing Test Naming Issues

- Avoid underscores (`_`) in test suite and test names to prevent collisions and naming errors due to internal class naming rules.
- Ensure unique names for tests to avoid unexpected runtime failures.


## 6. Common Errors and Their Solutions

| Symptom                              | Cause                                      | Solution                                         |
|------------------------------------|-------------------------------------------|-------------------------------------------------|
| Undefined references to GoogleTest | Missing library in link step               | Link with `-lgtest`, `gtest_main`, or include sources directly |
| Linker missing `main`               | Not linking `gtest_main` or missing own `main()` | Link with `gtest_main` or write appropriate `main()` |
| Tests not running or skipped        | Incorrect test naming or filter flags      | Check test names and filters, avoid disallowed underscores |
| Compiler errors Non-copyable        | Attempting to copy tests                    | Avoid copying test fixtures or test classes


## 7. Useful Commands and Flags

- **List tests:**

  ```bash
  ./my_test --gtest_list_tests
  ```

- **Run specific tests:**

  ```bash
  ./my_test --gtest_filter=MySuite.MyTest
  ```

- **Run disabled tests:**

  ```bash
  ./my_test --gtest_also_run_disabled_tests
  ```

- **Enable colored output:**

  ```bash
  ./my_test --gtest_color=yes
  ```

- **Fail fast (stop on first failure):**

  ```bash
  ./my_test --gtest_fail_fast
  ```

- **Repeat tests (for flaky tests):**

  ```bash
  ./my_test --gtest_repeat=100
  ```


## 8. Further Help and Resources

- Comprehensive related documentation includes:
  - [Installation Instructions](/getting-started/setup-basics/installation-instructions)
  - [Configuration & Initial Setup](/getting-started/setup-basics/configuration-setup)
  - [Troubleshooting Installation & Setup](/getting-started/troubleshooting-and-help/troubleshooting-installation)
  - [Using GoogleMock and Writing Tests](/guides/core-testing-workflows/writing-your-first-test)

- Join the community and report issues or get help [on GitHub](https://github.com/google/googletest)

---

<Tip>
For complex build or integration errors, verifying that GoogleTest and GoogleMock libraries are correctly built for your compiler and platform is crucial. Mismatched runtime libraries or C++ standards are underlying causes of many cryptic errors.
</Tip>

<Note>
If your death tests hang or crash unexpectedly, enabling the "threadsafe" death test style or minimizing thread creation outside death tests is recommended.
</Note>

<Warning>
Do not ignore the return value of `RUN_ALL_TESTS()`. Your program's exit code determines the test success status in automated systems.
</Warning>

