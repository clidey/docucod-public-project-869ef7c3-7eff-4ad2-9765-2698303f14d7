---
title: "Performance Optimization Tips"
description: "Shares advice on speeding up test execution, using test filters, running tests in parallel, and minimizing test binary size. Provides expert tips for maintaining fast, scalable test suites."
---

# Performance Optimization Tips

GoogleTest empowers you to maintain robust, scalable, and efficient C++ test suites. This page focuses specifically on optimizing test performance by leveraging filters, parallel execution, and minimizing test binary size. Implementing the strategies shared here will help you keep your testing fast and responsive, even as your codebase grows.

---

## 1. Speeding Up Test Execution

Tests should be as fast as possible to enable frequent runs and rapid feedback. GoogleTest offers several ways to trim test runtime without sacrificing test coverage or quality.

### Use Test Filters to Run Only What Matters

By default, GoogleTest runs all discovered tests, which can be costly in large projects. Narrow down test execution by specifying filters using the `--gtest_filter` flag:

```bash
./my_tests --gtest_filter=MyTestSuite.MyTestCase
```

- Use wildcards `*` and `-` to include or exclude tests.
- Filter by test suite or test case names.

**Example:**

```bash
# Run only tests starting with Foo
./my_tests --gtest_filter=Foo*

# Run all except test Bar in suite Foo
./my_tests --gtest_filter=Foo.*-Foo.Bar
```

**Tip:** Use filters to focus on specific components or recently changed functionality during development.

### Repeat and Shuffle Tests for Better Coverage

While shuffling tests (`--gtest_shuffle`) and repeating (`--gtest_repeat`) can catch flaky tests and increase confidence, use them wisely as they prolong runtime.

### Disable Slow or Expensive Tests

Mark non-critical or long-running tests with the `DISABLED_` prefix. GoogleTest will skip these by default but allows selective runs when needed.

```cpp
TEST(MySuite, DISABLED_ExpensiveTest) {
  // slow test code
}
```

Run explicitly:

```bash
./my_tests --gtest_filter=MySuite.DISABLED_ExpensiveTest
```

---

## 2. Running Tests in Parallel

GoogleTest supports parallel test execution via sharding, helping you leverage multi-core architectures and speed up total test time.

### Test Sharding

Divide tests into shards by setting environment variables:

- `GTEST_TOTAL_SHARDS`: The total number of shards.
- `GTEST_SHARD_INDEX`: The zero-based index of the shard to run.

**Example:** To run 4 shards in parallel on 4 cores:

```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0
./my_tests &
export GTEST_SHARD_INDEX=1
./my_tests &
... and so on for indexes 2, 3
wait
```

Sharding partitions the test suite automatically so each shard runs a subset of tests.

**Best Practices:**
- Use exact multiples of shards and cores.
- Balance test runtimes across shards to avoid uneven bottlenecks.

### Use CI/CD Pipeline Parallelism

Configure your continuous integration system to launch multiple test shard jobs concurrently. This maximizes throughput with minimal resource contention.

---

## 3. Minimizing Test Binary Size

Smaller binaries load and start faster, helping overall test cycles.

### Link Only Needed Components

- Use selective linking to include only necessary GoogleTest components.
- Avoid including unused test cases or dependencies.

### Compile with Optimization Flags

- Use `-O2` or higher optimization levels in release builds of tests.
- Disable debug symbols in frequent runs (but keep them when debugging test failures).

### Use Header-Only or Static GoogleTest

- If possible, use GoogleTest as a header-only library to reduce linking overhead.
- Alternatively, link statically for stability and speed.

---

## 4. Practical Tips and Common Pitfalls

- Avoid running all tests every time during iterative development; use filters and sharding.
- Balance the number of shards to your hardware capabilities.
- Avoid overly complex expectations that slow down mock verification.
- Periodically profile your test execution with timers or CI metrics.
- Use `EXPECT_CALL` judiciously — overuse can slow down mocks.

---

## 5. Additional Resources

For deeper performance tuning, explore:

- [GoogleTest Test Discovery and Execution](https://github.com/google/googletest/blob/main/docs/guides/getting-started-testing/test-discovery-execution.md) — learn about filtering and controlling test runs.
- [Performance and Test Suite Optimization Guide](https://github.com/google/googletest/blob/main/docs/guides/integration-and-patterns/performance-and-optimization.md) — strategies for large-scale test performance.
- [GoogleMock Best Practices](https://github.com/google/googletest/blob/main/docs/guides/mocking-with-gmock/best-mocking-practices.md) — optimize mocks for speed.

---

**Remember:** Effective performance optimization is about selecting the right subsets of tests to run, parallelizing intelligently, and avoiding unnecessary test overhead — all while preserving test reliability and maintenance ease.

---