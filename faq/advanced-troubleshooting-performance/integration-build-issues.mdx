---
title: "Integration with Build Systems and CI"
description: "Answers common integration questions related to CMake, Bazel, and CI tools. Covers environment configuration, test discovery in larger codebases, and integration troubleshooting steps."
---

# Integration with Build Systems and Continuous Integration (CI)

This FAQ page addresses common questions and troubleshooting advice related to integrating GoogleTest and GoogleMock into build systems like CMake and Bazel, as well as running tests efficiently in Continuous Integration (CI) environments. It covers environment configuration, test discovery in complex codebases, and guidance for diagnosing integration issues.

---

## Frequently Asked Questions (FAQ)

### How do I configure GoogleTest and GoogleMock with CMake?

GoogleTest and GoogleMock provide official CMake build scripts that make incorporating them into your existing CMake projects straightforward.

**Standalone Build:**

1. Clone the repository:

```bash
  git clone https://github.com/google/googletest.git -b v1.17.0
  cd googletest
  mkdir build
  cd build
  cmake ..
  make
```

2. The default build includes GoogleMock. To build only GoogleTest:

```bash
  cmake .. -DBUILD_GMOCK=OFF
  make
```

3. For installation:

```bash
  sudo make install
```

**Embedding in Existing CMake Projects:**

You can either:

- Use `find_package(GTest CONFIG REQUIRED)` if pre-installed, linking with `GTest::gtest` and `GTest::gmock`.
- Add GoogleTest’s source code as a subdirectory via `add_subdirectory()`, ensuring consistent compiler flags.
- Use CMake’s `FetchContent` module to download and build GoogleTest during configuration.

Example snippet for fetch content:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # for Windows dynamic runtime
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example gtest_main)
add_test(NAME example_test COMMAND example)
```

Make sure your CMake version is 3.14 or higher to use `FetchContent_MakeAvailable()`.

---

### How do I set up GoogleTest with Bazel?

To use GoogleTest in Bazel:

1. Configure your workspace with the necessary dependencies, including the `googletest` .bzl rules.
2. Add `googletest` as a dependency in your `BUILD` files.
3. Write your tests as usual with `cc_test` targets.

Detailed instructions and examples are documented in the Getting Started section under Bazel Installation.

---

### How can I make sure tests are discovered and run properly in large codebases?

GoogleTest automatically discovers tests at runtime by registering tests declared with the `TEST()`, `TEST_F()`, and similar macros.

**Key integration points:**

- Properly initialize the framework in `main()` via `::testing::InitGoogleTest(&argc, argv);` or `InitGoogleMock` if using mocking.
- When using CMake or Bazel, make sure your test binaries link against `gtest_main` or provide your own `main()`.
- For large test suites, you can filter the tests run with the `--gtest_filter` flag.
- Use environment variables or CI configuration to specify focused test runs.

**Troubleshooting Test Discovery:**

- Ensure test source files are compiled and linked properly.
- Verify your `main()` calls the appropriate init function.
- Enable verbose output with `--gtest_verbose=info` to see test registration logs.

For more details, see the troubleshooting FAQ on [Test Discovery & Execution](https://github.com/google/googletest/blob/main/faq/getting-started-common-issues/first-test-troubleshooting.md).

---

### What environment variables or command-line flags help with CI integration?

**gtest and gmock flag examples:**

- `--gtest_filter`: Runs a specific subset of tests.
- `--gtest_output=xml:<path>`: Generates XML test reports consumable by CI systems.
- `--gmock_verbose=info|warning|error`: Controls verbosity of mock-related output.

**CI best practices:**

- Use XML outputs to upload test results to CI dashboards.
- Filter tests to run subsets in parallel builds.
- Use the `--gtest_break_on_failure` flag for early failure signals.
- Clean and isolate test environments to avoid flaky tests.

---

### How do I troubleshoot common integration issues?

**Common issues:**

- **Linker errors:** Ensure GoogleTest and GoogleMock libraries are correctly linked. Use `gtest_main` for main function if you do not provide your own.
- **Missing tests at runtime:** Check that `main()` is calling `InitGoogleTest()` or `InitGoogleMock()`. Verify proper macros (`TEST`, `TEST_F`) are used.
- **Compiler or environment incompatibilities:** Confirm minimum compiler support (C++17) and platform compatibility.
- **Threading problems:** If using threads in tests, verify that GoogleTest’s thread-safety macros are enabled (`-DGTEST_HAS_PTHREAD=1` if needed).

**Steps for effective troubleshooting:**

1. Build and run a minimal example test outside your project.
2. Increase verbosity of GoogleMock and GoogleTest to see detailed logs.
3. Isolate configuration changes or environment differences.
4. Review compiler and linker flags.

Consult the Troubleshooting Common Issues guide in Getting Started and the Platform Abstractions reference for platform-specific tips.

---

## Additional Tips & Best Practices

- Prefer to declare mock methods in the `public:` section of your mock classes to avoid access problems.
- When integrating with CMake, use `FetchContent` or add GoogleTest as a git submodule to maintain version synchronization.
- Use `NiceMock`, `StrictMock`, or `NaggyMock` wrappers to control how uninteresting mock calls are reported during tests.
- For large projects, consider configuring parallel test execution to reduce CI build times.

---

## Useful Links

- [GoogleTest README with CMake Build Instructions](https://github.com/google/googletest/blob/main/googletest/README.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) (Mocking and testing recipes)
- [Test Discovery and Execution Troubleshooting FAQ](https://github.com/google/googletest/blob/main/faq/getting-started-common-issues/first-test-troubleshooting.md)
- [GoogleTest Platform Abstractions](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h) (for platform-specific adjustments)
- [Integration & Dependencies Overview](https://github.com/google/googletest/blob/main/overview/architecture-concepts/integration-and-dependencies.md)

---

GoogleTest and GoogleMock are designed for smooth integration with popular build systems and CI tools. Following the guidelines above ensures your tests integrate robustly into your development lifecycle, enabling fast feedback and high quality assurance.