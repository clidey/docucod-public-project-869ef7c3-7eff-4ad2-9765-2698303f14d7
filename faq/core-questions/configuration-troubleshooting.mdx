---
title: "Configuration & Environment Troubleshooting"
description: "Guides users through resolving build, configuration, and environment setup issues. Covers topics such as compiler errors, platform compatibility, and build toolchain integration, empowering users to establish a reliable and maintainable testing environment."
---

# Configuration & Environment Troubleshooting

This page guides you through resolving common issues that arise during the setup, build, and configuration of GoogleTest and GoogleMock. It focuses specifically on build errors, environment compatibility, platform-specific quirks, compiler flag management, and integrating GoogleTest smoothly into your toolchain.

---

## 1. Common Build & Compiler Issues

### 1.1 Compiler Compatibility
- GoogleTest requires a C++17-compatible compiler. Ensure your compiler supports this standard by checking your compiler version.
- For Microsoft Visual C++, GoogleMock requires at least Visual Studio 2015 (MSVC 14.0). Earlier versions will not compile.

<Tip>
If you encounter errors related to language features, validate your build environment uses the right compiler version and that C++17 is enabled (e.g., with `-std=c++17` flag in GCC or Clang).
</Tip>

### 1.2 Linking Errors
- Linking errors may happen if GoogleTest or GoogleMock is not linked properly, or if there are conflicts in runtime libraries.
- On Windows, you might face runtime library mismatches (e.g., dynamic vs static CRT linkage). GoogleTest provides the `gtest_force_shared_crt` option to help synchronize this across your project and GoogleTest.

```cmake
# Enable dynamic CRT linkage on Windows to resolve linking mismatches
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### 1.3 Slow Compilation Speed
- If your mock classes have many mock methods, compiling them can be slow.
- To speed up build times, declare constructors and destructors of your mock classes in the header and define them out-of-line (e.g., in `.cc` files).

```cpp
// In mock_foo.h
class MockFoo : public Foo {
 public:
  MockFoo();
  virtual ~MockFoo();
  MOCK_METHOD(int, DoSomething, (), (override));
};

// In mock_foo.cc
MockFoo::MockFoo() {}
MockFoo::~MockFoo() {}
```

---

## 2. Environment and Platform Compatibility

### 2.1 Platform Detection and Portability
GoogleTest and GoogleMock include layered portability adapters to detect and support various platforms including Windows, Linux, Mac, and embedded systems.

- Platform-specific macros, such as `GTEST_OS_WINDOWS` or `GTEST_OS_LINUX`, are internally used for adaptations.
- If you notice odd platform behavior or missing support, verify your environment triggers correct platform detection and macro settings.

### 2.2 Multi-threaded Testing Support
- GoogleTest is thread-safe where pthread is available.
- To control detection, define the macro `GTEST_HAS_PTHREAD` to `1` or `0` when building.

```bash
-DGTEST_HAS_PTHREAD=1
```

- On custom platforms, you may need to add compiler or linker flags to link against pthread (e.g., `-pthread`).

### 2.3 Shared Library (DLL) Usage
- GoogleTest is typically linked statically, but you can build it as a shared library.
- To compile GoogleTest as a shared library and adjust test binaries accordingly, use these defines:

```bash
-DGTEST_CREATE_SHARED_LIBRARY=1
-DGTEST_LINKED_AS_SHARED_LIBRARY=1
```

Note that some environments might require additional linker flags to create DLLs.

---

## 3. Build Toolchain Integration

### 3.1 CMake Integration
- GoogleTest comes with a `CMakeLists.txt` to facilitate building standalone or as part of a larger project.
- To build with GoogleMock included (default):

```bash
cmake ..
make
```

- To build only GoogleTest (without GoogleMock):

```bash
cmake .. -DBUILD_GMOCK=OFF
make
```

- For integration into an existing project, you can add it as a subdirectory, or use `FetchContent` to pull it during CMake configuration.

### 3.2 Build Flags and Macro Controls
GoogleTest accepts several macros controlling feature enablement and behavior:

- `GTEST_HAS_PTHREAD` controls pthread support.
- `GTEST_CREATE_SHARED_LIBRARY` and `GTEST_LINKED_AS_SHARED_LIBRARY` control shared library builds.
- `DGTEST_DONT_DEFINE_<MACRO>` can rename GoogleTest macros to avoid conflicts (e.g., rename `TEST` to `GTEST_TEST`).

Define these macros in your compiler invocation to customize your build.

<Tip>
Use compiler definitions (e.g., `-D`) or CMake `add_definitions()` to pass flags consistently.
</Tip>

---

## 4. Initialization and Runtime Configuration

### 4.1 Initializing GoogleMock / GoogleTest
- Always invoke `testing::InitGoogleMock(&argc, argv)` before calling `RUN_ALL_TESTS()`.
- `InitGoogleMock()` parses GoogleMock-specific flags from command line and removes them from `argv`.

Example `main()`:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 4.2 Command Line Flag Parsing
- GoogleMock supports flags like `--gmock_verbose`, `--gmock_catch_leaked_mocks`, and `--gmock_default_mock_behavior` to control runtime behavior.
- Example:

```bash
./my_test --gmock_verbose=info
```

- Unrecognized flags are left untouched for other parsers or your own code.

### 4.3 Verbose Mode
- `--gmock_verbose=info|warning|error` controls logging granularity.
- Use `info` for detailed trace of mock expectations and calls.

---

## 5. Common Environment Pitfalls & Resolutions

### 5.1 Conflicting Macros or Naming Collisions
- GoogleTest macros like `TEST`, `ASSERT_*`, `EXPECT_*` can collide with other libraries.
- Use `DGTEST_DONT_DEFINE_TEST=1` (and similarly for other macros) to avoid conflicts and use `GTEST_TEST` explicitly.

### 5.2 Flags Not Being Passed or Recognized
- If command-line flags are ignored, verify `InitGoogleMock()` is called properly.
- Make sure your test executable is passing `argc` and `argv` correctly.

### 5.3 Runtime Errors with Unrecognized Flags
- Unrecognized flags are passed through untouched.
- To avoid interfering with other flags, always place GoogleMock flags before others or parse them after.

<Tip>
Design your test runners to accommodate GoogleMock flags by using `InitGoogleMock` early on.
</Tip>

### 5.4 Problem Using GoogleMock on Embedded Platforms
- Embedded OSes like ESP8266 require special setup with `setup()` and `loop()` functions.
- GoogleMock's main file includes conditional code for these platforms.

Example (ESP8266):

```cpp
void setup() {
  testing::InitGoogleMock();
}
void loop() {
  RUN_ALL_TESTS();
}
```

Ensure this pattern is followed on such platforms.

---

## 6. Troubleshooting Workflow

<Steps>
<Step title="Verify Compiler and Environment">
Confirm compiler version supports C++17 and related flags are enabled.
</Step>
<Step title="Validate Build Configuration">
Check CMake or build scripts for appropriate flags, linked libraries, and definitions.
</Step>
<Step title="Confirm Linking Correctness">
Ensure GoogleTest/GoogleMock libraries are linked and runtime libraries are compatible.
</Step>
<Step title="Test Initialization">
Use `InitGoogleMock` in your `main()` to initialize flags and runtime properly.
</Step>
<Step title="Run Basic Sample Tests">
Run simple pre-built tests or examples to verify environment correctness.
</Step>
<Step title="Adjust Verbosity for Debugging">
Enable `--gmock_verbose=info` to get insight into mock calls and expectations.
</Step>
<Step title="Consult Logs and Errors">
Use detailed output to identify missing dependencies, flag parsing issues, or other errors.
</Step>
</Steps>

---

## 7. Additional Tips & Best Practices

- Prefer `ON_CALL()` for setting default mock behaviors and `EXPECT_CALL()` only where call verification is needed.
- Use strictness modifiers (`NiceMock`, `StrictMock`) to control warnings and test failure behaviors.
- When using mocks with move-only types, use lambdas or `WillOnce` with appropriate return semantics.
- Delegate mock creation and configuration in test fixtures for clearer test code.

---

## 8. Related Documentation

- [Getting Started - Configuration and Initialization](/getting-started/setup-intro/configuration-and-initialization)
- [Common Setup Issues and Solutions](/getting-started/troubleshooting-support/common-issues-fixes)
- [Mocking Reference](api-reference/mocking-framework/defining-mocks)
- [Strictness & Mock Behavior Modifiers](api-reference/mocking-framework/strictness-and-behavior-modifiers)
- [gMock Cookbook](guides/mocking-scenarios/gmock_cook_book)

---

For in-depth understanding and further troubleshooting, explore the related guides and references linked throughout this document.

---

###### Source files relevant to gMock configuration and initialization:
- [gmock_main.cc](googlemock/src/gmock_main.cc) - contains example main() function initialization
- [gmock/test/gmock_test.cc] - tests flag parsing and visibility
- [gmock/internal/gmock-port.h] - macro definitions controlling flag handling

---