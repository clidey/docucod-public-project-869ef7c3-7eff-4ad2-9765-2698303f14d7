---
title: "What is GoogleMock and how does it integrate with GoogleTest?"
description: "Clarifies the difference between GoogleTest and GoogleMock, explains when to use mocking, and provides resources to help users start writing and running mock-based tests."
---

# What is GoogleMock and How Does It Integrate with GoogleTest?

GoogleMock (often called gMock) is Google's C++ framework for creating mock classes and methods that help you write better, more focused unit tests by simulating and verifying interactions between components. It extends GoogleTest’s testing capabilities by enabling precise control over dependencies and their behaviors in tests.

---

## Understanding GoogleMock vs GoogleTest

**GoogleTest** is a powerful unit testing framework that focuses on defining and running tests with rich assertion support.

**GoogleMock** complements GoogleTest by providing tools for mocking objects—allowing you to specify expected function calls, control return values, and verify that certain interactions occur between your components without relying on real implementations.

In simple terms:
- Use **GoogleTest** to write tests that verify the correctness of your code’s outputs and state.
- Use **GoogleMock** when you want to isolate units and test *interactions* or *side effects* with mock objects.

---

## When to Use Mocking

Mocking is appropriate when you want to:

- Replace complex or unavailable dependencies with lightweight mocks.
- Verify *how* a component interacts with others, including call order, call count, and argument values.
- Simulate error conditions or rare edge cases that are hard to reproduce with real objects.
- Decouple tests from performance-heavy or non-deterministic subsystems like databases, networks, or hardware.

Avoid mocking when:

- You just need to verify outputs or states without caring about the interaction details.
- The dependency is trivial, stable, or does not affect the test significantly.

---

## Key Features of GoogleMock

- **Declarative Mock Definitions:** Use the `MOCK_METHOD` macro to declare mock methods in your mock classes.
- **Flexible Mock Behavior:** Control expected calls with `EXPECT_CALL`, set default behaviors with `ON_CALL`.
- **Rich Argument Matching:** Use built-in and custom matchers to specify which arguments you expect.
- **Call Sequencing and Cardinality:** Specify call counts, call order with sequences or `After()` clauses.
- **Actions on Calls:** Define what mock functions return or do using `WillOnce()`, `WillRepeatedly()`, custom lambdas and more.
- **Support for Complex C++ Features:** Handles overloaded, const, noexcept, and template methods as well as move-only types.
- **Three Strictness Modes:** `NiceMock` suppresses warning on uninteresting calls, `NaggyMock` warns (default), `StrictMock` fails on uninteresting calls.

---

## Typical Workflow with GoogleMock

<Steps>
<Step title="Define Your Mock Class">
Derive a mock class from your interface or base class and use `MOCK_METHOD` to declare methods you want to mock.
</Step>
<Step title="Set Up Mock Objects">
Create instances of your mock class (or wrap with `NiceMock`/`StrictMock`) to prepare for the test.
</Step>
<Step title="Configure Expectations and Behaviors">
Use `EXPECT_CALL` to define expected calls and verify interactions.
Use `ON_CALL` to specify default behaviors without enforcing call requirements.
</Step>
<Step title="Run Your Test Code">
Invoke the code under test that uses your mocks. GoogleMock verifies that all expected calls occurred as specified.
</Step>
<Step title="Verify and Clean Up">
GoogleMock automatically verifies expectations when mocks are destructed; you may also call `Mock::VerifyAndClearExpectations()` to check earlier.
</Step>
</Steps>

---

## Defining Mock Classes and Methods

GoogleMock uses the `MOCK_METHOD` macro to declare mocked methods within your mock class. This macro requires:
- The return type
- The method name
- The argument types (enclosed in parentheses)
- Optional qualifiers like `const`, `override`, `noexcept`, or calling conventions

Example:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Tips:**
- Always put `MOCK_METHOD`s in the `public:` section regardless of original access levels.
- Use parentheses around argument types that contain commas (e.g., `std::pair<int, int>`).
- When mocking overloaded methods, declare all overloads you want to mock.
- For non-virtual methods, consider templated dependency injection or manually switch implementations.

---

## Setting Expectations with EXPECT_CALL

`EXPECT_CALL(mock_obj, Method(matchers...))` establishes which calls the mock object should expect during the test, including:
- Arguments constraints with matchers (`_` matches anything)
- Call count cardinality (e.g., `Times(2)`, `AtLeast(1)`)
- Ordering constraints using `InSequence` or `After`

Example:

```cpp
EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1));
```

### Chained Clauses (in order):
- `.With(multi_arg_matcher)`: match all args as a tuple
- `.Times(cardinality)`: expected call count
- `.InSequence(seq1, seq2, ...)`: constrain order
- `.After(expectation1, expectation2, ...)`: specify dependencies
- `.WillOnce(action)`: behavior on first call matching
- `.WillRepeatedly(action)`: default behavior after all `WillOnce`s
- `.RetiresOnSaturation()`: deactivate expectation after called maximum times

**Important:** Use `EXPECT_CALL` before exercising the mock! Setting expectations after calls are undefined.

---

## Default Behaviors with ON_CALL

`ON_CALL(mock_obj, Method(matchers...))` specifies the default behavior for calls *without* setting expectations on call count or order. This is useful when you want the method to respond in a certain way but do not care how often or when it is called.

Example:

```cpp
ON_CALL(turtle, GetX())
    .WillByDefault(Return(42));
```

The action specified with `ON_CALL` applies only if no `EXPECT_CALL` matches the call.

---

## Using Matchers to Specify Expected Arguments

Matchers let you specify detailed argument constraints:

- Exact values: `EXPECT_CALL(foo, Bar(5))`
- Wildcard: `EXPECT_CALL(foo, Bar(_))`
- Relational: `EXPECT_CALL(foo, Bar(Ge(10)))`
- Composite: `EXPECT_CALL(foo, Bar(AllOf(Ge(5), Ne(10))))`
- Argument properties: `Field(&Foo::x, Eq(7))`, `Pointee(Le(20))`
- Custom predicates: `EXPECT_CALL(foo, Bar(Truly(IsPrime)))`

---

## Controlling Call Counts with Cardinalities

GoogleMock offers flexible cardinalities to specify how many times a method should be called:

- `Exactly(n)`: exactly n times
- `AtLeast(n)`: minimum n times
- `AtMost(n)`: maximum n times
- `Between(m, n)`: between m and n times
- `AnyNumber()`: zero or more times

If unspecified, GoogleMock infers:
- If no actions are specified, `Times(1)`
- If n `WillOnce()` calls exist, `Times(n)`
- If `WillRepeatedly()` is used, `Times(AtLeast(n))`

---

## Actions: Specifying What Mocks Do

GoogleMock supports multiple action types governing what mock methods do when called:

- `Return(value)`: return a fixed value
- `ReturnRef(var)`: return a reference
- `ReturnPointee(pointer)`: return the value pointed to
- `Invoke(function or functor)`: invoke user-defined code
- `DoAll(action1, action2, ...)`: perform multiple actions in order
- `SetArgPointee<N>(value)`: modify an output argument
- `InvokeArgument<N>(args...)`: invoke callback argument
- `IgnoreResult(action)`: ignore return value

Actions can be chained with `WillOnce()` for sequential behaviors or `WillRepeatedly()` for default repeating behavior.

---

## Mock Strictness Levels

GoogleMock lets you control warnings and errors from uninteresting calls:

- **NaggyMock (default):** Warns about calls to mock methods without expectations.
- **NiceMock:** Suppresses warnings for uninteresting calls, making the mock "quiet".
- **StrictMock:** Treats uninteresting calls as test failures.

Use strict mocks cautiously, as they can make tests brittle; nice mocks are generally recommended for maintainability.

Example:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

---

## Practical Tips and Best Practices

- Always mock interfaces or abstract classes rather than concrete classes to reduce test brittleness.
- Use `ON_CALL` to set default behaviors shared by many tests; use `EXPECT_CALL` to verify specific call expectations.
- Group ordered expectations inside `InSequence` to enforce call order.
- To avoid silent failures, enable `--gmock_verbose=info` for detailed mock call logs.
- Remember to verify expectations either implicitly (mock destruction) or explicitly using `Mock::VerifyAndClearExpectations`.
- For complex mocking scenarios, explore delegating to fakes, real objects, or parent class implementations.
- For mocking std::function callbacks, use `MockFunction` to easily set expectations.

---

## Getting Started Resources

For practical guidance on writing your first mock, setting expectations, and using GoogleMock with GoogleTest:

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): beginner-friendly tutorial.
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): recipes and advanced usage.
- [Mocking Reference](docs/reference/mocking.md): detailed API documentation.
- [Using Mocks Guide](/guides/core-testing-workflows/using-mocks): step-by-step workflows.

---

## Summary

GoogleMock extends GoogleTest by enabling C++ developers to write interaction-based tests through powerful mocking capabilities, offering flexible expectation setting, rich argument matching, behavior specification, and verification tools. It integrates tightly with GoogleTest for seamless test management and result reporting.

---

_For comprehensive understanding, see also related documentation on [Defining & Using Mock Methods](api-reference/mocking-api/mock-methods), [Setting Expectations & Call Sequences](api-reference/mocking-api/expectations-and-sequencing), and [Actions API](api-reference/mocking-api/actions-api)._