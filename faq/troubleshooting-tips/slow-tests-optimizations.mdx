---
title: "How can I diagnose and speed up slow tests?"
description: "Shares strategies for identifying test bottlenecks, using test filters, running tests in parallel, and configuration tricks to reduce test suite runtimes. Helpful for teams scaling test coverage and looking to optimize CI cycles."
---

# How can I diagnose and speed up slow tests?

GoogleTest offers powerful features and strategies to help you **diagnose test execution bottlenecks** and **optimize slow test suites**. Whether you are running tests locally or in Continuous Integration, leveraging these approaches will help reduce feedback time and scale your test coverage effectively.

---

## 1. Identifying Slow Tests

### Why Diagnose?
Slow tests delay development cycles and disrupt CI pipelines. Diagnosing bottlenecks allows you to focus optimization efforts on the most impactful tests.

### Methods to Identify Slow Running Tests
- **Verbose Test Output:** Use the `--gtest_print_time` flag when running tests to print how long each test takes.

```bash
./my_test_binary --gtest_print_time
```

- **Filter Slow Tests:** Run subsets of tests selectively with `--gtest_filter` to isolate slow performers.

- **Profiling & Tracing:** Attach profilers or tracing tools to investigate tests that have high CPU or I/O usage.

### What to Look For
- Tests with unusually long runtimes relative to others.
- Tests with flaky or non-deterministic durations.

<Tip>
Leverage your build system and CI metrics to automatically track and highlight tests with increasing execution times.
</Tip>

---

## 2. Test Filtering to Reduce Test Suite Runtime

### Use Case
When working on a specific feature or fix, you don't need to run all tests all the time.

### How to Filter Tests
- Use the `--gtest_filter` flag with specific test patterns:

```bash
./my_test_binary --gtest_filter=MyTestSuite.MyTest
```

- Support wildcards to include or exclude tests:

```bash
./my_test_binary --gtest_filter=MyTestSuite.*-MyTestSuite.SlowTest*
```

   This runs all tests in `MyTestSuite` except those containing `SlowTest` in their name.

### Practical Tips
- Organize your tests into meaningful test suites and name tests descriptively to leverage filtering effectively.
- Combine with test sharding features for parallel test runs across machines.

---

## 3. Running Tests in Parallel

### Benefits
Parallel test execution is the most straightforward way to speed up large test suites by utilizing multi-core CPUs or distributed CI resources.

### How to Setup
- GoogleTest supports **test sharding** via environment variables or command line flags.

- Use the `GTEST_SHARD_INDEX` and `GTEST_TOTAL_SHARDS` environmental variables at runtime to split your tests:

```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0
./my_test_binary
```

- Repeat for each shard index in `[0..TOTAL_SHARDS-1]` on different machines or processes.

### CI Integration
Many CI systems support running parallel tasks â€” integrate GoogleTest sharding with CI parallel jobs to accelerate feedback.

<Tip>
Try to keep your tests stateless and independent. This makes them safe to run in parallel without interference.
</Tip>

---

## 4. Optimizing Tests

### Strategies
- **Reduce Setup and Teardown Times:** Use test fixtures smartly to share expensive setup across multiple tests when possible.

- **Mock Expensive Dependencies:** Use GoogleMock mock objects to replace real modules that are slow or have side effects (database calls, network requests).

- **Minimize Mock Expectations and Actions:** Overly strict or too many `EXPECT_CALL`s and heavy actions can slow tests dramatically.

- **Parallelize Expensive Test Steps:** Where applicable, use threads or async approaches inside your tests if they can safely run concurrently.

### Advanced Tips
- Use the `ON_CALL` macro to set shared default behavior, and limit `EXPECT_CALL` usage only to interactions that must be verified, reducing verification overhead.

- Avoid memory or resource leaks in tests, which can slow down test suites or cause flaky behavior.

- Regularly run profiling tools on your slowest tests to find hidden inefficiencies such as repeated resource initialization.

<Note>
The [Performance and Best Practices guide](/guides/advanced-and-integrations/performance-and-best-practices) offers comprehensive tips on optimizing GoogleTest & GoogleMock suites.
</Note>

---

## 5. Practical Example: Diagnosing and Improving a Slow Test

```bash
# Run the test binary with timing info
./test_binary --gtest_print_time > timing.log

# Look for tests taking longer than expected
grep ' ms' timing.log | sort -k 2 -nr | head -n 10
```

- Identify test cases with highest milliseconds output.
- Review those tests' code to spot heavy setup or dependency calls.
- Use mocks or refactor to reduce runtime.

---

## 6. Troubleshooting Slow or Flaky Tests

### Common Issues & Solutions
- **Unintentional Sleep or Waits:** Make sure no test or fixture is sleeping or waiting unnecessarily.
- **External Dependencies:** Replace or mock dependencies that require network, disk, or database.
- **Memory Leaks:** Use tools like Valgrind or sanitizers to detect leaks affecting test runtime.
- **Global State:** Ensure test independence to avoid deadlocks or contention.

### Debugging Techniques
- Use `--gmock_verbose=info` to get detailed traces about mock usage impacting performance.

- Use `--gtest_repeat=<N>` to run tests multiple times to detect flakiness and isolate performance issues.

<Tip>
For persistent slow tests, consider splitting them into smaller focused tests or moving them to integration/e2e test suites.
</Tip>

---

## 7. References and Further Reading

- [Running Tests in Parallel - GoogleTest Guide](/guides/advanced-and-integrations/performance-and-best-practices#running-tests-in-parallel)
- [Mocking Dependencies with GoogleMock - Best Practices](/guides/core-testing-workflows/mocking-with-googlemock)
- [Test Filtering and Sharding - GoogleTest Primer](/guides/getting-started/test-structure-and-discovery)
- [Diagnosing Common Test Issues](/guides/advanced-and-integrations/troubleshooting-common-issues)

---

## Summary
This document equips you with the strategies to diagnose slow tests by profiling with timing flags, running targeted test filters, and analyzing mocks. It guides you through running tests in parallel and optimizing test design, including mocks and fixtures, to reduce test suite runtimes and flaky behaviors. Practical tips, troubleshooting techniques, and cross-references to related guides help you sustainably scale your testing practice.