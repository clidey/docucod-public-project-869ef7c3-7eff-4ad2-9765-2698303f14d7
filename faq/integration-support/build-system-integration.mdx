---
title: "Build System & Tool Integration"
description: "Answers questions on integrating GoogleTest/GoogleMock with common build systems like CMake and Bazel, and with external tools such as IDEs and CI pipelines. Outlines troubleshooting steps for configuration issues in complex builds."
---

# Build System & Tool Integration FAQ

This FAQ page addresses common questions and challenges that users encounter when integrating GoogleTest and GoogleMock into their build systems (such as CMake and Bazel) and external tools including IDEs and CI pipelines. It provides actionable advice to achieve a smooth setup and troubleshoot complex build or configuration issues.

---

### 1. Build System Integration

#### How do I integrate GoogleTest/GoogleMock with CMake?

GoogleTest provides official CMake support with a flexible and portable build script, enabling two main approaches:

- **Standalone build**: Clone the repository, configure and build GoogleTest independently. This is useful if you want GoogleTest installed globally or maintained separately.

- **Embedded build**: Include GoogleTest directly in your project via `add_subdirectory()`, ensuring consistent compiler flags across your project and tests.

**Typical standalone workflow:**
```bash
git clone https://github.com/google/googletest.git -b v1.17.0
mkdir build
cd build
cmake ..           # Builds GoogleTest (+ GoogleMock by default)
make               # Compile the library and tests
sudo make install  # Optional installation
```

If you want to build only the GoogleTest library without GoogleMock, use:
```bash
cmake .. -DBUILD_GMOCK=OFF
```

**Embedding GoogleTest in your existing CMake project:**

Add the following to your `CMakeLists.txt` to fetch and build GoogleTest during your project build:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# Force dynamic CRT on Windows to match your project
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(MyTest test.cpp)
target_link_libraries(MyTest GTest::gtest_main)
add_test(NAME MyTest COMMAND MyTest)
```

This guarantees proper compiler flag consistency, easier updater management, and seamless cross-platform support.

#### How do I use GoogleTest with Bazel?

GoogleTest supports Bazel integration via workspace rules. You need to set up the Bazel `WORKSPACE` to declare GoogleTest and add dependencies in your `BUILD` files. This FAQ focuses primarily on CMake, but please see the official Bazel documentation and samples in the GoogleTest repo for precise instructions.

#### What should I watch out for when linking GoogleTest libraries?

- Link your test executables to either `gtest` (without a main function) or `gtest_main` (with a default `main()`). The same applies to GoogleMock's `gmock` or `gmock_main`.
- When using shared libraries (DLLs on Windows), define the macros `GTEST_CREATE_SHARED_LIBRARY=1` when building GoogleTest itself and `GTEST_LINKED_AS_SHARED_LIBRARY=1` when building your tests.
- Ensure consistent compiler flag settings, especially regarding runtime libraries (static vs dynamic CRT) on Visual Studio. Use the `gtest_force_shared_crt` option to align these.

#### How does GoogleTest detect pthread availability and threading support?

GoogleTest auto-detects pthread support during build configuration (especially when using CMake). When pthread is available and not disabled, multithreaded test safety is enabled. If pthread detection fails, you can force it on or off manually by defining `-DGTEST_HAS_PTHREAD=1` or `-DGTEST_HAS_PTHREAD=0` respectively in your build flags. This is important if you encounter linking errors related to threads.

---

### 2. Tool Integration

#### How do I run tests from an IDE?

- Most modern IDEs (Visual Studio, CLion, Eclipse) support CMake projects and can detect GoogleTest tests automatically if your GoogleTest targets are integrated via CMake.
- If using Bazel, configure your IDE to use Bazel commands to build and run tests.
- You can also generate GoogleTest XML output using the flag `--gtest_output=xml:<path>` for IDEs that consume test reports.

#### How do I integrate GoogleTest into CI/CD pipelines?

- Build your test binaries using your build system (CMake or Bazel).
- Run tests via `ctest`, `bazel test`, or direct invocation of test executables.
- Pass GoogleTest flags such as `--gtest_filter` to select tests, or `--gtest_shuffle` to randomize test execution order.
- Use `--gtest_output=xml:<file>` to generate test reports consumable by CI tools (Jenkins, GitLab CI, etc).
- Leverage test sharding and filtering flags to run large test suites in parallel across multiple nodes.

Refer to the [Integrating GoogleTest with CI/CD](https://github.com/google/googletest/blob/main/docs/guides/best-practices-integration/ci-integration.mdx) guide for detailed steps.

---

### 3. Troubleshooting Build and Configuration Issues

#### Why am I getting linker errors for GoogleTest symbols?

- Verify that you have correctly linked against the `gtest` or `gtest_main` libraries.
- Check that the `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` flag is defined if linking against shared libraries on Windows.
- Make sure that the runtime libraries (CRT) are consistent between your project and GoogleTest. Use the `gtest_force_shared_crt` CMake option to help align this.
- Confirm that GoogleTest source files are compiled with a compatible compiler version and settings.

#### Tests are not being discovered or run – what could be wrong?

- Ensure that tests are linked into your test executable and are registered (using `TEST()` or `TEST_F()` macros).
- Double-check that the test binary is executed with the GoogleTest runner.
- Confirm you have called `testing::InitGoogleTest(&argc, argv);` before `RUN_ALL_TESTS()` in your `main()` if you use a custom main.
- If using filters, verify that your filter setting matches the test names.

#### How to fix issues with exceptions or RTTI during build?

- GoogleTest requires exception handling and RTTI in most builds.
- CMake configuration provides flags such as `cxx_exception_flags` and `cxx_no_exception_flags`. Align your project compiler options accordingly.
- Use provided build macros and options to toggle exception and RTTI support as needed, but be aware some GoogleTest features may not work correctly without them.

#### What compiler flags does GoogleTest recommend?

- GoogleTest employs warnings and stricter compiler flags to promote high-quality builds.
- It overrides some compiler defaults (e.g., `/MD` to `/MT` on MSVC when static CRT is preferred).
- Take advantage of the CMake build scripts (`config_compiler_and_linker` macro) that fix and adjust flags appropriately.

---

### 4. Practical Tips & Best Practices

- Prefer embedding GoogleTest into your project's CMake build to ensure consistent compilation flags and ease of use.
- Use the `gtest_main` or `gmock_main` libraries to avoid writing your own `main()` unless customization is needed.
- When building shared libraries (DLLs), always define `GTEST_CREATE_SHARED_LIBRARY=1` for GoogleTest and `GTEST_LINKED_AS_SHARED_LIBRARY=1` for your tests.
- Use test output XML reports to integrate with CI tools and IDEs.
- Employ test filters and sharding for scalable test execution in large projects.
- Refer to GoogleTest’s CMake scripts for advanced build customizations and compiler adjustments.

---

### 5. Additional Resources

- [Installation Methods Guide](https://github.com/google/googletest/blob/main/docs/getting-started/setup-and-installation/installation-methods.mdx) — Step-by-step instructions for CMake, Bazel, and manual integration.
- [Integrating GoogleTest with CI/CD](https://github.com/google/googletest/blob/main/docs/guides/best-practices-integration/ci-integration.mdx) — Practical examples and best practices.
- [Supported Platforms FAQ](https://github.com/google/googletest/blob/main/docs/faq/core-questions/supported-platforms.mdx) — Compilers and OS considerations.
- [Common Setup Issues FAQ](https://github.com/google/googletest/blob/main/docs/getting-started/troubleshooting-and-faq/common-setup-issues.mdx) — Troubleshooting tips.

For further technical detail on build internals and CMake functions, refer to the internal utility macros defined in `googletest/cmake/internal_utils.cmake`.

---

By addressing these points and following the documented workflows, users will experience a streamlined process incorporating GoogleTest and GoogleMock into their build and test automation environments.


<Check>
  Always verify that your build system’s compiler flags match GoogleTest’s recommended settings.
</Check>

<Warning>
  Mismatched runtime libraries or missing linkages are the most common causes of build failures.
</Warning>

<Info>
  Use `--gtest_help` with your test executable to discover available runtime test filter and output options.
</Info>
