---
title: "How do I integrate with my build system (CMake, Bazel, Make, etc.)?"
description: "Outlines recommended best practices and common pitfalls for integrating GoogleTest with different build systems, referencing example configurations and troubleshooting tips for CMake and Bazel in particular."
---

# How do I integrate with my build system (CMake, Bazel, Make, etc.)?

Integrating GoogleTest into your C++ project involves configuring your build system to build and link the framework alongside your tests efficiently and reliably. This guide outlines best practices, common pitfalls, and example configuration tips for popular build systems, including CMake and Bazel. It also includes troubleshooting tips for smoother integration.

---

## 1. General Integration Principles

GoogleTest is designed to be portable and flexible, which allows you to use it with various build systems such as CMake, Bazel, Make, and others. Your integration steps should aim to achieve these key outcomes:

- **Reliable Dependency Management:** Your build scripts must find GoogleTest headers and libraries correctly.
- **Consistent Compiler and Linker Settings:** Ensure GoogleTest and your code are compiled with compatible settings (e.g., C++17 standard, runtime library linkage).
- **Efficient Test Builds:** Avoid unnecessary rebuilds by properly specifying dependencies and target organization.
- **Ease of Test Execution:** Set up test targets so you can easily run your tests from your build tools.

### Basic User Goals

- Build GoogleTest library (or use installed binaries)
- Build your test executable(s) linking against GoogleTest
- Run tests with `RUN_ALL_TESTS()` entry point (usually via `gtest_main` or `gmock_main`)

---

## 2. CMake Integration

CMake is the most common build system for GoogleTest. GoogleTest provides comprehensive CMake support to simplify usage.

### 2.1 Use GoogleTest as a Subdirectory

The recommended approach is to add GoogleTest as part of your main project using CMake's `add_subdirectory()`. This ensures:

- Single consistent build configuration,
- Compatibility between GoogleTest and your project,
- Simplified dependency management.

Example snippet for your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Visual Studio runtime compatibility.
FetchContent_MakeAvailable(googletest)

add_executable(my_tests tests/main_test.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

This example fetches GoogleTest at configure time, builds it as part of your project, links your tests against the `gtest_main` library (providing a `main()` function), and registers the test executable for CTest.


### 2.2 Use Installed GoogleTest

If GoogleTest is already installed on your system (e.g., via package manager or manual install), `find_package` is the preferred way:

```cmake
find_package(GTest REQUIRED)
add_executable(my_tests tests/main_test.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

This method requires your system to have the headers and libs properly installed.

### 2.3 Build Settings & Options

- Ensure your project uses C++17 or later: `set(CMAKE_CXX_STANDARD 17)`.
- On Windows with Visual Studio, if you encounter runtime library mismatches, use `gtest_force_shared_crt` option.
- GoogleTest supports both static and shared libraries. By default, it builds static libraries.

### 2.4 Custom `main()` and Entry Points

- Prefer using `gtest_main` or `gmock_main` libraries that provide a standard `main()`.
- If custom initialization is needed, write your own `main()` but call `testing::InitGoogleTest(&argc, argv);` before `RUN_ALL_TESTS()`.

Example:

```c++
int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 2.5 Build & Run

Typical workflow after generating build files with CMake:

```shell
cmake --build .
ctest
```

This compiles targets and runs tests.

---

## 3. Bazel Integration

GoogleTest can be integrated into Bazel via WORKSPACE dependencies and BUILD files.

### 3.1 Adding GoogleTest as a Dependency

Example `WORKSPACE` entry to add GoogleTest:

```starlark
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.tar.gz"],
    strip_prefix = "googletest-release-1.17.0",
)
```

### 3.2 Defining Build Targets

In your `BUILD` file:

```starlark
cc_test(
    name = "my_tests",
    srcs = ["main_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

Bazel provides `gtest` and `gtest_main` targets to link against GoogleTest and the main entry point.

### 3.3 Running Tests

Execute tests with:

```shell
bazel test //path/to:my_tests
```

---

## 4. Make and Other Build Systems

For custom or legacy makefiles, integrate GoogleTest by:

- Downloading or installing GoogleTest source or binaries,
- Adding the appropriate include paths (`-I`) and linking libraries (`-L -lgtest` or `-lgtest_main`) in your compiler and linker flags,
- Define your test executables to include `RUN_ALL_TESTS()` as entry point,
- Write a custom `main()` or link with `gtest_main` if prebuilt.

Sample linking flags in `Makefile`:

```makefile
CXXFLAGS += -isystem /usr/local/include
LDFLAGS += -L/usr/local/lib -lgtest_main -lpthread
```

Then compile and link normally.

---

## 5. Common Integration Pitfalls

### 5.1 Runtime Library Mismatch (Windows)

Visual Studio projects commonly incur runtime library conflicts when GoogleTest defaults to static CRT but your project uses dynamic CRT.

**Solution:** Set `gtest_force_shared_crt` to `ON` when using CMake or ensure matching runtime library settings.

### 5.2 Missing `main()` Link Error

If you define tests but forget to link `gtest_main` or provide your own `main()`, linker errors may appear.

**Solution:** Link with `gtest_main` or implement a proper `main()` calling `InitGoogleTest` and `RUN_ALL_TESTS()`.

### 5.3 Compiler Flags Compatibility

Make sure GoogleTest is built with the same compiler settings and standards as your project to avoid ABI incompatibilities.

### 5.4 Header and Source File Paths

When adding GoogleTest source files directly (not via libraries), ensure the include directories are set correctly to avoid compilation errors.

---

## 6. Troubleshooting Tips

- Run `ctest --verbose` or Bazel test commands with verbose flags to observe test execution details.
- Confirm GoogleTest libraries and includes are present and picked up by your build system.
- Check that your compiler supports C++17 or higher.
- Avoid mixing debug and release builds between your project and GoogleTest.

---

## 7. Additional Resources

- [Installing with CMake](../installation-and-configuration/installing-googletest-cmake) — Detailed instructions for CMake setup.
- [Installing with Bazel](../installation-and-configuration/installing-googletest-bazel) — Step-by-step Bazel integration.
- [Platform-Specific Setup](../installation-and-configuration/platform-specific-setup) — Handling OS and compiler-specific quirks.
- [Organizing and Managing Test Suites](../guides/core-testing-workflows/organizing-test-suites) — Guide to structure tests efficiently.
- [Troubleshooting Common Issues](../guides/advanced-and-integrations/troubleshooting-common-issues) — Tips for resolving build and runtime problems.

---

This documentation provides a clear path to effectively integrating GoogleTest with popular build systems, guiding users from initial setup to advanced troubleshooting, ensuring a smooth development workflow and reliable automated testing environment.
