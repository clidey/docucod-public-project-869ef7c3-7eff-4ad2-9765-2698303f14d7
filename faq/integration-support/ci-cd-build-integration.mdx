---
title: "How do I integrate GoogleTest with my build system or CI/CD pipeline?"
description: "Guides for common integrations using CMake, Bazel, pkg-config, and samples of using GoogleTest in various CI environments, with troubleshooting for build automation."
---

# Frequently Asked Questions: Integrating GoogleTest with Build Systems and CI/CD Pipelines

GoogleTest offers flexible and robust options to integrate automated testing into your build and continuous integration (CI) workflows. Whether you're using CMake, Bazel, or custom build setups, and whether you're orchestrating builds on local machines or complex CI/CD pipelines, GoogleTest provides clear methods and best practices to streamline your test automation.

---

## 1. How do I integrate GoogleTest with CMake?

### Standalone GoogleTest build with CMake

To build GoogleTest independently and use it for your tests:

1. Clone the repo:

    ```bash
    git clone https://github.com/google/googletest.git -b v1.17.0
    cd googletest
    mkdir build
    cd build
    ```

2. Configure the build:

    - For full GoogleTest and GoogleMock:

      ```bash
      cmake ..
      ```

    - To build only GoogleTest (without GoogleMock):

      ```bash
      cmake .. -DBUILD_GMOCK=OFF
      ```

3. Build and optionally install:

    ```bash
    make
    sudo make install   # installs to /usr/local/ by default
    ```

4. On Windows or Mac, CMake generates suitable project files (`.sln`, `.vcproj` or `.xcodeproj`) to build via IDEs.

### Incorporating GoogleTest into an Existing CMake Project

You have two main integration strategies:

- **Use Installed GoogleTest:**

  Import the package with `find_package(GTest CONFIG REQUIRED)`, then link your test executable to `GTest::gtest` or `GTest::gtest_main`.

  Example:

  ```cmake
  find_package(GTest CONFIG REQUIRED)
  add_executable(my_tests test.cpp)
  target_link_libraries(my_tests GTest::gtest_main)
  add_test(NAME my_tests COMMAND my_tests)
  ```

- **Build GoogleTest as Part of Your Project:**

  This method ensures consistent compiler and linker settings, especially critical on Windows.

  You can:

  - Add GoogleTest source as a git submodule or copy
  - Or dynamically download during configure via `FetchContent`

  Example using `FetchContent` (requires CMake 3.14+):

  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
  )

  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # Windows: match CRT linkage

  FetchContent_MakeAvailable(googletest)

  add_executable(example example.cpp)
  target_link_libraries(example gtest_main)
  add_test(NAME example_test COMMAND example)
  ```

### Best Practices

- Use `gtest_main` to link tests with a predefined main(), unless you need custom main() logic.
- Specify `C++17` standard explicitly in your `CMakeLists.txt`:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

- On Visual Studio, if you encounter runtime library mismatches (`RuntimeLibrary` LNK2038), enable `gtest_force_shared_crt`.

---

## 2. How can I integrate GoogleTest with Bazel?

GoogleTest and GoogleMock are available as Bazel targets:

- Add dependencies to `@com_github_google_googletest//:gtest` and `@com_github_google_googletest//:gmock` in your `BUILD` files.

- Write your test targets with appropriate `cc_test` or `cc_binary` rules.

- Ensure you declare `gtest_main` as a dependency if you do not provide your own main.

Bazel integration provides fast build and excellent caching for test runs, widely used in Google and beyond.

---

## 3. How do I run GoogleTest within CI/CD pipelines?

### Typical Workflow

1. **Configure your build system** to build test binaries with GoogleTest support.
2. **Build the tests** as part of the pipeline.
3. **Run tests with your test runner**, usually invoking test executables which internally call `RUN_ALL_TESTS()`.
4. **Collect results and exit codes:** `RUN_ALL_TESTS()` returns `0` on success, `1` if any test fails.

Example GitHub Actions / CI snippet:

```bash
mkdir build && cd build
cmake ..
make
ctest --output-on-failure
``` 

or directly:

```bash
./my_tests
``` 

### Using XML Output for Test Reporting

Add command line flag:

```bash
./my_tests --gtest_output=xml:results.xml
```

This produces a JUnit-compatible XML report suitable for CI tools.

---

## 4. What troubleshooting should I be aware of when automating builds with GoogleTest?

**Common problems and solutions:**

- **Build failed due to missing pthread:**
  - On Linux/unix systems, ensure you link with pthreads. Using CMake scripts manages this automatically.

- **Runtime errors on Windows related to CRT mismatch:**
  - Enable `gtest_force_shared_crt` in CMake to align runtimes.

- **Test executable not running or no tests discovered:**
  - Confirm test functions are defined using `TEST()` or `TEST_F()` macros.
  - Ensure `RUN_ALL_TESTS()` is called in `main()` or that you link against `gtest_main`.

- **Conflicts due to macro names:**
  - Use compile flags like `-DGTEST_DONT_DEFINE_TEST=1` if your project uses macros that clash with GoogleTest macros.

- **Custom main() needed but tests not executing:**
  - Always call `testing::InitGoogleTest(&argc, argv);` before `RUN_ALL_TESTS()`.

---

## 5. Can GoogleTest be linked as a shared library in builds?

Yes. To create and use GoogleTest as a shared library:

- Compile GoogleTest with `-DGTEST_CREATE_SHARED_LIBRARY=1`.
- Link your test binaries with `-DGTEST_LINKED_AS_SHARED_LIBRARY=1`.

Note this is optional and mostly useful if you want faster link times or shared binaries. Static linkage remains the recommended simple default.

---

## 6. How do I handle multi-threaded test builds?

- GoogleTest is thread-safe on platforms that provide `pthread`.
- If your build system doesn’t detect pthread automatically, manually add `-DGTEST_HAS_PTHREAD=1` and link with pthread.

CMake scripts automatically handle pthread linkage.

---

## 7. Where can I find sample configurations or example CI integrations?

- The GoogleTest [googletest/README.md](https://github.com/google/googletest/blob/main/googletest/README.md) provides CMake examples.
- Official documentation includes typical `CMakeLists.txt` snippets leveraging `add_subdirectory` or `FetchContent`.
- Community repositories and CI samples often demonstrate GitHub Actions, Jenkins, Travis, and other pipelines.

---

# Summary

Integrating GoogleTest into your build system or CI/CD pipeline is a straightforward process with clear options for CMake and Bazel users. Using CMake, you can either build GoogleTest standalone or embed it directly in your project with `FetchContent` or submodules for consistent builds. Be sure to handle platform peculiarities like pthread on *nix and CRT linkage on Windows. In CI pipelines, run your test binaries and handle results through exit codes or XML reports for test reporting.

<Tip>
Always verify your test executables call `RUN_ALL_TESTS()` and initialize GoogleTest via `InitGoogleTest()` - this is crucial for correct test discovery and execution.
</Tip>

---

# Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — Learn how to write and organize tests.
- [Getting Started with CMake](googletest/README.md) — Official instructions on building and integration.
- [Integration with Build Systems & Platforms Guide](https://google.github.io/googletest/integrating-with-build-systems.html) — Detailed integration approaches.
- [Continuous Integration Pipeline Patterns](https://google.github.io/googletest/integration-pipelines.html) — Concepts for CI automation.
- [Mocking and Setting Expectations](https://google.github.io/googletest/mocking-and-expectations.html) — How to mock dependencies.

---

# Related FAQ Topics

- How to install and configure GoogleTest/GoogleMock
- Handling test discovery failures
- Configuring cross-platform builds
- Managing runtime library conflicts on Windows


