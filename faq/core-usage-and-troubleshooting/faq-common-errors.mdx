---
title: "Resolving Common Errors"
description: "A guide to typical setup, compilation, or runtime errors users encounter when working with GoogleTest or GoogleMock, along with straightforward, practical solutions and links to relevant error messages."
---

# Resolving Common Errors

This guide is dedicated to helping users identify, understand, and resolve typical setup, compilation, and runtime errors encountered when working with GoogleTest and GoogleMock. Each section addresses common failure scenarios, provides straightforward solutions, and points to references for deeper insights.

---

## Table of Contents

- [Common Errors During Setup and Compilation](#common-errors-during-setup-and-compilation)
- [Mocking Errors and Troubleshooting](#mocking-errors-and-troubleshooting)
- [Expectation and Call Verification Failures](#expectation-and-call-verification-failures)
- [Warnings About Uninteresting Calls](#warnings-about-uninteresting-calls)
- [Strictness Wrappers: NiceMock, NaggyMock, and StrictMock](#strictness-wrappers-nicemock-naggymock-and-strictmock)
- [Resolving Linker Issues](#resolving-linker-issues)
- [Additional Resources and References](#additional-resources-and-references)

---

## Common Errors During Setup and Compilation

### Problem:
You encounter compiler errors when attempting to build tests using GoogleTest or GoogleMock.

### Root Causes and Solutions:

- **Non-Virtual Methods Mocked:** Only virtual methods can be mocked by GoogleMock directly. Attempting to mock non-virtual functions leads to errors.
  - *Solution:* Use interfaces with virtual methods or apply templates for non-virtual methods as described in [Mocking Non-virtual Methods](https://google.github.io/googletest/gmock_cook_book.html#MockingNonVirtualMethods).

- **Unprotected Commas in MOCK_METHOD:** Types with commas (e.g., `std::pair<bool, int>`) need wrappers.
  - *Solution:* Wrap such types with parentheses or use type aliases in `MOCK_METHOD` declarations.

- **Missing Virtual Destructor:** Mocked classes must have virtual destructors to prevent heap errors.
  - *Solution:* Add `virtual ~ClassName() = default;` to base classes.

- **Old MOCK_METHOD Macros Usage:** Using deprecated `MOCK_METHODn` macros can cause unexpected compilation issues.
  - *Solution:* Migrate to the modern `MOCK_METHOD` macro format.

- **Overloaded Methods Ambiguity:** For overloaded functions, mocks must correctly specify signatures to avoid hiding base class methods.
  - *Solution:* Use the `using` directive to bring base class methods into scope alongside mocking all overloaded variants.

### Notes:
- Compiler warnings about `const` parameters often relate to top-level `const` being ignored and can generally be addressed by removing unnecessary `const`.

---

## Mocking Errors and Troubleshooting

### Issue: Mock method calls invoke real method or cause unexpected behavior.

### Explanation:
- For a method to be mocked, it must be virtual unless using the [high-performance dependency injection](https://google.github.io/googletest/gmock_cook_book.html#MockingNonVirtualMethods) technique.

### Fix:
- Ensure methods to mock are marked `virtual`.
- For non-virtual methods, consider templates or interfaces.

### Issue: Error messages related to `EXPECT_CALL` or `ON_CALL` chain misuse.

### Explanation & Tips:
- `.With()` must appear at most once and as the first clause.
- `.Times()` can appear at most once and must occur before `.InSequence()` or `.After()` clauses.
- `.WillOnce()` clauses must precede `.WillRepeatedly()`, and `.RetiresOnSaturation()` must be the last clause.

### Tip:
Always check the order of modifiers in your `EXPECT_CALL`.

### Setting Default Actions (`ON_CALL`):
- Use `ON_CALL` to define default behavior without setting call expectations.
- `ON_CALL` must end with `.WillByDefault(action)`.

---

## Expectation and Call Verification Failures

### Symptoms:
- Failures indicating that expected calls did not occur or occurred too many times.

### Reasons and Solutions:

- **Lower Bound Violations:** Calls happen fewer times than expected.
  - Verify that your code exercises all expected calls.

- **Upper Bound Violations:** Calls happen more than expected.
  - Relax call cardinalities using `Times(AnyNumber())` if appropriate, or refine expectations.

- **Calls Arriving Out of Order:** When order is enforced, out-of-sequence calls cause failures.
  - Use `InSequence` or `After` clauses to specify order accurately.

- **Sticky Expectations:** Expectations remain active after saturation, unexpectedly blocking similar calls.
  - Use `.RetiresOnSaturation()` to deactivate expectations after they have been fulfilled.

---

## Warnings About Uninteresting Calls

GoogleMock warns about calls to mock methods without explicit expectations.

### Understanding:
- **Uninteresting calls:** Calls that have no matching `EXPECT_CALL`.
- **Warnings are notifications:** They inform you that calls happened but were not expected.

### How to resolve or suppress:
- Explicitly allow such calls with `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`
- Use `NiceMock` to silence warnings without causing test failures.
- Treat them as errors using `StrictMock` if desired for stricter testing.

### Useful Flag:
- Use `--gmock_verbose=info|warning|error` to control verbosity of these warnings.

---

## Strictness Wrappers: NiceMock, NaggyMock, and StrictMock

GoogleMock provides wrappers to control how uninteresting calls are handled.

| Wrapper      | Behavior on Uninteresting Calls               | When to Use                                   |
| ------------ | --------------------------------------------- | --------------------------------------------- |
| **NiceMock** | Suppresses warnings, calls allowed silently   | When warnings clutter output but calls are fine |
| **NaggyMock**| Issues warnings (default behavior)            | Default; to catch unexpected calls during development |
| **StrictMock**| Treats warnings as errors, fails tests        | When you want to strictly enforce mock usage |

### Usage Example:
```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoThis());

mock_foo.DoThis(); // No warnings for other called methods
```

### Important:
- These wrappers must be applied to mock classes directly defining `MOCK_METHOD`s.
- They inherit constructors, allowing use with non-default constructors.

---

## Resolving Linker Issues

### Common Causes:
- GoogleTest/GoogleMock not properly linked.
- Missing `gtest_main` or `gmock_main` libraries when using main.
- Missing or mismatched symbols due to incorrect include paths or library versions.

### Solutions:
- Link against the appropriate libraries (`gtest`, `gtest_main`, `gmock`, `gmock_main`).
- Verify library paths and versions.
- Ensure consistent compiler and standard library flags.

---

## Additional Resources and References

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) for fundamental test writing.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick reference on mocks, matchers, and actions.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for detailed macro and class usage.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for practical example-driven guidance.
- [Nice, Naggy, and Strict Mocks](https://google.github.io/googletest/advanced.html#behavior-strictness) deeper dive into mock strictness.
- Use the `--gmock_verbose` flag to adjust log verbosity.

---

With this guide, users can approach common GoogleTest and GoogleMock errors confidently, understanding why they occur, how to interpret them, and what steps to take to resolve or mitigate them effectively.