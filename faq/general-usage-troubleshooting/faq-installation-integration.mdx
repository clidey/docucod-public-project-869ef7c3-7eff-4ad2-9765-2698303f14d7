---
title: "Installation & Integration Problems"
description: "Troubleshoots typical problems encountered during installation or when integrating GoogleTest/GoogleMock into existing build systems (CMake, Bazel, etc.). Offers guidance on environment setup, linking libraries, and integrating with different platforms."
---

# FAQ: Installation & Integration Problems

This FAQ addresses typical challenges encountered during the installation and integration of GoogleTest and GoogleMock into existing build systems such as CMake, Bazel, and others. It guides you through environment setup, correct linking of libraries, and common platform-specific issues.

---

## 1. Common Setup and Integration Issues

### Why am I getting linker errors related to GoogleTest or GoogleMock?

Linker errors usually occur because the GoogleTest/GoogleMock libraries aren't linked properly with your test binaries.

**Solution Steps:**
- Verify you have linked against `gtest`, `gtest_main`, `gmock`, and/or `gmock_main` libraries as appropriate.
- For CMake, ensure you use `target_link_libraries(your_test PRIVATE gtest gmock)` or the equivalent imported targets.
- On Windows with Visual Studio, be especially cautious about mismatched runtime libraries (e.g., mixing `/MT` and `/MD`).
- Consult the platform-specific installation documentation to confirm the correct linkage procedure.

### How do I integrate GoogleTest/GoogleMock into alternative build systems like Bazel or pkg-config?

- For Bazel, add the necessary dependencies using BUILD files following official guidance. See the [Alternative Build Systems guide](https://github.com/google/googletest/tree/main/docs#getting-started/prerequisites-installation/alternative-build-systems) for detailed instructions.
- For pkg-config, ensure the environment paths include GoogleTest and GoogleMock, and use `pkg-config` flags for compilation and linkage.

### I built GoogleTest but get errors about missing pthread or compiler errors related to C++17

- GoogleTest requires a compiler with C++17 support and pthreads on Unix-like systems.
- On Linux/macOS, ensure you link with `-pthread`.
- Check your compiler version meets the minimum requirement.
- See the [System Requirements](https://github.com/google/googletest/tree/main/docs#getting-started/prerequisites-installation/system-requirements) for details.

## 2. Platform-Specific Issues

### Windows: Visual Studio build fails or runtime errors happen

- Use the [Installing on Windows](https://github.com/google/googletest/tree/main/docs#getting-started/prerequisites-installation/installing-on-windows) guide.
- Address runtime library mismatches explicitly (e.g., using `/MD` consistently).
- Make sure CMake is configured to generate the appropriate Visual Studio project files.

### Unix-like systems: Problems with shared libraries or linking

- Confirm that you are linking GoogleTest and GoogleMock statically or dynamically as intended.
- Shared library builds require proper `rpath` or equivalent setup.
- Linking order matters: typically, the `-lgmock -lgtest -lpthread` order is required.

## 3. Common Pitfalls & Best Practices

### Don't mix old and new mock macros

GoogleMock supports both the older `MOCK_METHODn` macros and the newer `MOCK_METHOD`. Mixing them can cause subtle linker or behavior issues. For modern usage, prefer `MOCK_METHOD` with the proper signature.

### Always mock virtual functions and ensure virtual destructors

Methods you wish to mock must be `virtual`. Also, ensure your mocked classes have virtual destructors to avoid crashes or memory leaks.

### Order of `EXPECT_CALL()` matters

- More specific expectations should be declared after general ones since later expectations override earlier ones.
- To enforce call order, use `InSequence` or `After()` clauses.

### Use `ON_CALL()` for setting default behavior and `EXPECT_CALL()` only when verifying call expectations

This distinction is key to avoid over-constraining tests and producing brittle failures.

### Prevent uninteresting call warnings

- Use `NiceMock<T>` to suppress warnings on uninteresting calls.
- If uninteresting calls should be failure conditions, use `StrictMock<T>`.
- Alternatively, explicitly allow calls with `.Times(AnyNumber())` in `EXPECT_CALL`.

## 4. Troubleshooting Steps

### Verifying installation

Run the provided GoogleTest and GoogleMock internal tests to ensure the installation is correct and libraries are linked properly.

### Enable verbose logging

Use the `--gmock_verbose=info` flag to trace mock function calls and verify expectations.

### Heap check failures related to mocks

Check that mocked interfaces have virtual destructors and that mock objects are properly destroyed to enable correct verification.

### Debugging linker errors

- Verify build and link flags.
- Confirm library search paths.
- Check for name clashes or macro redefinitions interfering with mock method names.

## 5. Sample CMake Integration Snippet

```cmake
# Assuming Googletest and GoogleMock added via FetchContent or installed
find_package(GTest REQUIRED)
add_executable(my_test my_test.cc)
target_link_libraries(my_test PRIVATE GTest::gtest GTest::gmock_main)
include(GoogleTest)
gtest_discover_tests(my_test)
```

## 6. Additional Resources

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - An approachable intro to mocking
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) - Detailed API and best practices
- [Troubleshooting Setup Issues](https://github.com/google/googletest/tree/main/docs#getting-started/troubleshooting-faq/troubleshooting-setup-issues) - Common installation problems
- [Using GoogleTest with Bazel or Alternative Build Systems](https://github.com/google/googletest/tree/main/docs#getting-started/prerequisites-installation/alternative-build-systems)

---

<Tip>
When you run into persistent installation or integration errors, try building and running GoogleTest’s own test binaries first to isolate the problem, then integrate into your project.
</Tip>

<Warning>
Do not set expectations on mock methods after calling them; always declare `EXPECT_CALL()` before exercising mocks to ensure well-defined behavior.
</Warning>

<Info>
Use `NiceMock<YourMockClass>` or `StrictMock<YourMockClass>` to control warning and failure behavior on unexpected or uninteresting calls.
</Info>

## 7. Troubleshooting Common Error Messages

<AccordionGroup title="Common Error Messages and Resolutions">
<Accordion title="Linker errors: undefined references to GoogleTest/GoogleMock symbols">
Check linking of `gtest`, `gmock`, or their `_main` libraries. Verify build system is configured correctly.
</Accordion>
<Accordion title="Warning: Uninteresting mock function call encountered">
This means a mock method was called without an `EXPECT_CALL`. Use `NiceMock` to suppress, or add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` if appropriate.
</Accordion>
<Accordion title="Heap check failures related to mocked objects">
Ensure the interfaces you mock have virtual destructors and that mock objects are properly deleted so GoogleTest can verify expectations.
</Accordion>
<Accordion title="Compiler warnings about overriding virtual functions with const parameters">
Visual Studio may warn erroneously; remove top-level `const` from parameters in both base and mock classes to resolve.
</Accordion>
</AccordionGroup>

## 8. Best Practices

- Always mock pure virtual functions or those you explicitly want to replace.
- Avoid mocking classes you don’t own unless necessary; prefer interface adaptors.
- Use `ON_CALL` to setup common behavior in test fixtures.
- Favor clear and maintainable `EXPECT_CALL` declarations with well-defined cardinalities.
- Regularly verify and clear mock expectations in complex tests.
- Leverage `InSequence` and `After` to specify call order only when required to avoid fragile tests.

---

For more detailed usage and error handling guidance, consult the official [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) provided in the GoogleTest documentation portal.

---

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/gmock_faq.md", "range": "1-150"},{"path": "docs/reference/mocking.md", "range": "1-245"},{"path": "docs/gmock_for_dummies.md", "range": "1-185"}]} />
