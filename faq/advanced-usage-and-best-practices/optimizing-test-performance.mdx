---
title: "How can I optimize the performance of my tests?"
description: "Practical strategies for speeding up large test suites, such as parallelization, fixture reuse, minimizing unnecessary setup/teardown, and leveraging build system features for efficient test execution."
---

# How can I optimize the performance of my tests?

GoogleTest caters to projects of all sizes, from small modules to large-scale systems with thousands of tests. But as your test suite grows, running tests sequentially and using expensive setup/teardown for each can dramatically increase test execution time, affecting developer feedback cycles and CI throughput.

This page provides practical strategies to help you speed up large test suites without sacrificing test reliability or correctness.

---

## 1. Parallelizing Test Execution

One of the most effective ways to reduce total test time is to run tests in parallel across multiple CPU cores or machines.

### How to Parallelize Your Tests

- **Shard Tests Across Machines:**
  - Use environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` to divide the test suite.
  - Each shard runs a subset of tests exactly once, enabling distributed test execution.
  - Set these variables in your CI or test runner environment before invoking the test executable.

- **Run Multiple Test Executables in Parallel:**
  - If your tests are split into multiple binaries (e.g., by component or test suite), execute them concurrently.
  - This approach leverages your build system or CI parallelism, improving overall throughput.

- **Use GoogleTest's Shuffle and Repeat Flags Carefully:**
  - `--gtest_shuffle` randomizes test execution order, helping uncover order-dependent failures.
  - Combine with repeat (`--gtest_repeat`) to stress-test flaky behavior.

### Best Practices

- Ensure tests are **isolated** and do not share global or static state that can cause test interference when run in parallel.
- Avoid race conditions by using proper synchronization or test-specific mocks.
- If tests are not thread-safe or have external dependencies, consider segregating them into separate executable groups.

---

## 2. Efficient Fixture Usage: Reusing Setup and Teardown

Test fixtures can be costly if set up and torn down for every individual test. When your tests share expensive resources, GoogleTest provides mechanisms to share them efficiently.

### Per-Test-Suite Setup and Teardown

- Define `static void SetUpTestSuite()` and `static void TearDownTestSuite()` in your test fixture class to allocate and free expensive resources **once per suite** rather than once per test.

- Use `static` members to hold shared resources.

- Example:

```c++
class DatabaseTest : public testing::Test {
 protected:
  static DatabaseConnection* db_;  // Shared resource across tests

  static void SetUpTestSuite() {
    db_ = new DatabaseConnection("my_db_connection_string");
  }

  static void TearDownTestSuite() {
    delete db_;
    db_ = nullptr;
  }

  void SetUp() override { /* ... */ }
  void TearDown() override { /* ... */ }
};

DatabaseConnection* DatabaseTest::db_ = nullptr;

TEST_F(DatabaseTest, QueryWorks) {
  ASSERT_TRUE(db_->ExecuteQuery("SELECT ..."));
}
```

This approach significantly reduces overhead when many tests operate on the same data or service.

### When to Use Per-Test Setup (Constructor/SetUp) vs Per-Suite

- Use per-test setup (constructors, `SetUp()`) for lightweight, independent test state.
- Use per-suite setup for expensive resources like databases, large data loading, or network connections.

Remember: GoogleTest always creates a fresh fixture object for each test. Do **not** rely on state mutations preserved between tests unless managed via `static` resources.

---

## 3. Minimize Unnecessary Setup and Teardown

Many test slowdowns come from redundant setup and teardown work executed repeatedly.

### Tips for Minimizing Overhead

- **Avoid Deep Copying:**
  - If your fixture copies large objects per test, prefer pointers or references to shared immutable data.

- **Lazy Initialization:**
  - Only initialize resources if the test requires them.

- **Lightweight Fixtures:**
  - Avoid heavy constructors or initializations; defer work to `SetUpTestSuite` or test body when possible.

- **Clean Up Only What You Allocate:**
  - Avoid unnecessary resource release if it adds overhead without benefit.

- **Disable Disabled Tests:**
  - Mark unstable or slow tests as disabled using the `DISABLED_` prefix to exclude them from runs.


---

## 4. Use Build System Features to Enhance Testing Efficiency

Leveraging your build and CI systems can amplify test performance gains.

### Incremental Test Selection

- Use `--gtest_filter` to run only affected tests relevant to changes.
- Combine `--gtest_list_tests` with filtering to identify and selectively run related tests.

### Caching & Dependency Tracking

- Configure your build system (e.g., Bazel, CMake) to avoid rerunning tests when dependencies haven't changed.
- Split large test binaries into smaller logical units to optimize parallel build and test execution.

### Integration with CI Pipeline

- Split test execution across multiple jobs and agents.
- Aggregate and consolidate results using GoogleTest's XML or JSON output formats.

---

## 5. Troubleshooting Performance Bottlenecks

If tests remain slow, analyze the following:

- **Test Isolation Issues:**
  Tests inadvertently depend on shared global state, resulting in retries or flaky failures.

- **Expensive External Dependencies:**
  Network calls, disk I/O, and database interactions are classic slowdowns; mock or stub them where feasible.

- **Test Data Bloat:**
  Excessive fixtures or test data objects can inflate memory usage and allocation overhead.

- **Inefficient Assertions:**
  Complex predicates or expensive string formatting in assertion messages can cost time.

- **Death Tests Complexity:**
  Death tests fork or spawn subprocesses, which can slow runs; limit and isolate them.

Use profiling tools to measure test runtime and identify hotspots precisely.

---

## Summary of Best Practices

| Strategy                         | Benefit                                    | Key GoogleTest Feature                  |
| -------------------------------- | ------------------------------------------ | --------------------------------------- |
| Parallelize tests                | Run tests faster using multiple cores/devices | Test sharding with `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` |
| Use per-test-suite setup        | Share expensive resources among tests         | `SetUpTestSuite` and `TearDownTestSuite` static methods |
| Minimize redundant setup/teardown | Reduce overhead per test                        | Lightweight fixtures, lazy init, disabled tests (
`DISABLED_`) |
| Use build system integration    | Incremental testing, parallel execution         | `--gtest_filter`, `--gtest_list_tests`, XML/JSON outputs |

---

## Additional Resources

- [GoogleTest Primer](primer.md) - Learn the fundamentals of writing tests with GoogleTest.
- [Advanced GoogleTest Topics](advanced.md#sharing-resources-between-tests-in-the-same-test-suite) - Details on fixture reuse and shared resources.
- [Best Practices & Patterns: Improving Test Performance](guides/best-practices-patterns/performance-optimization) - Detailed advice on speeding up test suites.
- [Integration with Build & CI Systems](overview/audience-usecases-integration/integration-points) - How to integrate GoogleTest efficiently with your build and CI environment.

---

## Troubleshooting Tips

<AccordionGroup title="Performance Troubleshooting Tips">
<Accordion title="Tests Run Much Slower Than Expected">
- Check for global state or static variables shared between tests causing serialization.
- Verify if fixtures are unnecessarily expensive and consider moving setup to per-suite.
- Profile to identify if assertions or logging create bottlenecks.
</Accordion>
<Accordion title="Parallel Tests Result in Failures or Flakiness">
- Ensure tests are properly isolated and side-effect free.
- Use synchronization primitives or mocks to stabilize shared resource access.
- Separate non-thread-safe tests into a different executable or shard.
</Accordion>
<Accordion title="Death Tests Slow Down the Test Suite">
- Limit death tests to critical validation only.
- Use thread-safe death test style flag `--gtest_death_test_style=threadsafe` when stability issues arise.
- Avoid heavy setup inside death tests.
</Accordion>
</AccordionGroup>

---

## How to Get More Help

If you encounter issues or want personalized guidance on optimizing your tests:

- Use the [Community Resources](faq/support-and-community/where-can-i-get-help) to engage with GoogleTest users.
- Review the [FAQ: How can I optimize the performance of my tests?](faq/advanced-usage-and-best-practices/optimizing-test-performance) for related questions.
- Report issues or feature requests on [GoogleTest GitHub](https://github.com/google/googletest/issues).

---