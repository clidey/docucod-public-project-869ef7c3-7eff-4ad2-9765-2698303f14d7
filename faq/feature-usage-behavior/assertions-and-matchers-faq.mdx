---
title: "Assertions, Expectations & Matchers"
description: "Clarifies differences between assertions and expectations, how to use custom and built-in matchers, and what to expect from test outcome reporting. Tackles common confusions about assertion macros, fatal vs non-fatal failures, and advanced matching."
---

# Assertions, Expectations & Matchers

Welcome to the comprehensive guide focused on clarifying how GoogleTest and GoogleMock handle assertions, expectations, and matchers. This page will help you understand the distinctions, usage patterns, and behaviors involved in crafting precise test validations and mock method controls. We'll untangle common confusions, empower you to leverage built-in and custom matchers, and ensure you know what to expect from test outcome reporting.

---

## Table of Contents

- [Understanding Assertions and Expectations](#understanding-assertions-and-expectations)
- [Assertion Macros: Fatal vs Non-Fatal Failures](#assertion-macros-fatal-vs-non-fatal-failures)
- [Using Matchers in Assertions and Expectation Calls](#using-matchers-in-assertions-and-expectation-calls)
- [Custom and Built-in Matchers](#custom-and-built-in-matchers)
- [Test Outcome Reporting and Failure Messages](#test-outcome-reporting-and-failure-messages)
- [Common Confusions and How to Avoid Them](#common-confusions-and-how-to-avoid-them)

---

## Understanding Assertions and Expectations

An essential part of GoogleTest's testing framework is the notion of **assertions** and how they govern test success or failure, while GoogleMock extends these ideas to **expectations** on mock object method calls.

### Assertions in GoogleTest

- Assertions (`ASSERT_*` and `EXPECT_*` macros) are statements that verify conditions in your tests.
- A failed assertion triggers a test failure. With `ASSERT_*`, failure aborts the current function immediately (a *fatal failure*). With `EXPECT_*`, the test continues despite failure (a *non-fatal failure*).
- Assertions report the location and reason for failures, helping you diagnose what went wrong.

### Expectations in GoogleMock

- Expectations are set on mock object methods using `EXPECT_CALL` and define how many times and with which arguments a mock method should be called.
- Expectations **also** define the behaviour of mock methods when invoked.
- Expectations differ from assertions by focusing on **mock interactions** rather than direct test conditions.

<Tip>
Remember: Assertions verify test code conditions, while expectations specify expected behavior and interactions of mocks.
</Tip>

## Assertion Macros: Fatal vs Non-Fatal Failures

GoogleTest offers assertions in pairs:

| Macro Prefix | Behavior on Failure              | Use Case                                  |
|--------------|--------------------------------|-------------------------------------------|
| `ASSERT_`    | Fatal failure; abort current function | Use when subsequent code depends on this check |
| `EXPECT_`    | Non-fatal failure; continue test | Use when you want to collect multiple failures in one test run |

For example:

```cpp
ASSERT_EQ(x.size(), y.size()) << "Vectors x and y must be equal length.";
for (int i = 0; i < x.size(); ++i) {
  EXPECT_EQ(x[i], y[i]) << "Mismatch at index " << i;
}
```

Here, if the sizes differ, the test aborts early to prevent invalid memory access, while individual element mismatches report failure but continue to check all elements.


## Using Matchers in Assertions and Expectation Calls

Matchers make assertions and expectations expressive, flexible, and informative by describing the expected properties of values and arguments.

### Matchers in Assertions

GoogleTest provides `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` to make assertions on values using matchers instead of plain Boolean expressions.

Example:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
ASSERT_THAT(my_number, AllOf(Gt(0), Lt(10)));
```

Matchers come from GoogleMock and provide a rich vocabulary for describing complex conditions.

### Matchers in Expectations

In `EXPECT_CALL(mock, Method(matcher1, matcher2, ...))`, matchers specify which arguments to expect for each method call. For example:

```cpp
EXPECT_CALL(foo, DoThis(Ge(0), _))  // first argument >= 0, second argument anything
    .WillOnce(Return(true));
```

This flexibility allows fine-grained control of the mock's behaviour and validation.

<Check>
Matchers empower tests to be precise yet maintainable. Use them instead of hard-coding literal values or writing scattered Boolean expressions.
</Check>

## Custom and Built-in Matchers

### Built-in Matchers

GoogleMock offers an extensive set of built-in matchers, including:

- Wildcard matcher `_` (matches anything)
- Comparison matchers like `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- Container matchers like `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`
- Pointer matchers like `IsNull()`, `NotNull()`, `Pointee()`
- String matchers like `HasSubstr()`, `StartsWith()`, `EndsWith()`
- Regex matchers like `MatchesRegex()` 
- And many more

### Writing Custom Matchers

When built-in matchers don't fit your needs, you can define your own matcher quickly using the `MATCHER` macros:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_THAT(value, IsDivisibleBy7());
```

For more complex logic and descriptive messages, you can stream failure info and implement `MatchAndExplain` interface.

### Matching Multiple Arguments Together

Use `.With()` to match all arguments as a tuple, for example:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // first argument less than second
```

You can combine individual argument matchers with composite matchers like `AllOf()`, `AnyOf()`, and `Not()` to build readable yet powerful expectations.

## Test Outcome Reporting and Failure Messages

### What Happens When Tests Fail

- A failing `ASSERT_*` aborts the current test function but allows other tests to continue running.
- A failing `EXPECT_*` reports a non-fatal failure and continues running the test.
- Detailed failure messages display the source file, code location, and evaluated values.
  - Custom messages can be streamed into assertions using `<<` operator.

Example failure message:

```
path/to/test.cc:42: Failure
Expected equality of these values:
  foo.size()
  bar.size()
    Which is: 4 vs 5
Custom message: Vectors x and y differ in length
```

### Behavior in Mock Expectations

If an expected mock call is not made, or made with incorrect arguments, GoogleMock reports an expectation failure with details explaining which expectation was unsatisfied or which call was unexpected.

### Statistical Overview

GoogleTest aggregates and reports test results grouped by test suites,
indicating passes, failures, and test durations.

### XML and JSON Reports

GoogleTest can output structured XML or JSON files summarizing test results for integration with CI systems.

## Common Confusions and How to Avoid Them

### 1. Difference between Assertions and Expectations

- Assertions (`EXPECT_*`, `ASSERT_*`) verify conditions within a test.
- Expectations (`EXPECT_CALL`) specify and verify expected mock method calls.

### 2. Fatal vs Non-Fatal Failures

- Use `ASSERT_*` if continuing after failure doesn't make sense (e.g. dereferencing a null pointer).
- Prefer `EXPECT_*` to maximize error reporting within a single test run.

### 3. When to Use `ON_CALL` vs `EXPECT_CALL`

- `ON_CALL` defines mock behavior without requiring an expectation that the method is called.
- `EXPECT_CALL` defines both behavior and an expectation the method is called with given args.
- Avoid using `EXPECT_CALL` just to suppress warnings about uninteresting calls; prefer `ON_CALL` with `NiceMock` or `.Times(AnyNumber())` when appropriate.

### 4. Matching Overloaded Methods

- Use `Const()` wrapper or specify explicit matcher types to disambiguate among overloads.

### 5. Streaming Messages and Evaluation

- Beware that assertion arguments are evaluated exactly once.
- Use streaming of custom messages judiciously to enhance failure reports without clutter.

### 6. Using Predicate Assertions for Complex Conditions

- Use `EXPECT_PRED*` or `EXPECT_PRED_FORMAT*` to assert complex Boolean conditions with better failure messages.

### 7. Avoid Using Fatal Assertions in Non-Void Functions

- Fatal assertions abort the current function, so they are only legal in `void` functions.
- Prefer non-fatal assertions or restructure functions accordingly.

### 8. Understanding Failure of `EXPECT_EQ(NULL, ptr)` vs `EXPECT_NE(NULL, ptr)`

- The macros fully support `EXPECT_EQ(NULL, ptr)` for backward compatibility but not `EXPECT_NE(NULL, ptr)`. Use `nullptr` for clearer intent.

## Practical Examples

### Assertion Macros

```cpp
EXPECT_TRUE(foo.IsReady()) << "Expected foo to be ready";
ASSERT_EQ(expected_value, actual_value);
```

### Expectation with Matchers

```cpp
EXPECT_CALL(mock_obj, ProcessData(Ge(0), _))
    .WillOnce(Return(true));
```

### Custom Matcher

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_THAT(my_val, IsEven());
```

### Predicate-Formatter Assertion

```cpp
testing::AssertionResult IsSorted(const std::vector<int>& v) {
  for (size_t i = 1; i < v.size(); ++i) {
    if (v[i-1] > v[i]) {
      return testing::AssertionFailure() << "Element at " << i << " is smaller than previous";
    }
  }
  return testing::AssertionSuccess();
}

EXPECT_PRED_FORMAT1(IsSorted, my_vector);
```

## Summary

This page demystifies GoogleTest's assertion macros, GoogleMock expectations, and matcher usage. It clarifies fatal vs non-fatal assertions, the role of matchers in enriching both assertion and expectation semantics, how to create custom matchers, and what failure messages convey.

<Callout><strong>Key takeaways:</strong></Callout>

- Prefer `EXPECT_*` macros for soft assertions and `ASSERT_*` for critical checks.
- Use matchers both in assertions (`EXPECT_THAT`) and mock expectations (`EXPECT_CALL`) for flexible and expressive tests.
- Define custom matchers to encapsulate reusable validation logic.
- Clearly understand the difference between uninteresting and unexpected mock calls.
- Stream custom failure messages for improved debugging.

For deeper mastery and examples, see related topics and references next.

---

## Related Documentation and Next Steps

- [Assertions Reference](reference/assertions.md): Full list and syntax for all assertions.
- [Matchers Reference](reference/matchers.md): Overview and list of built-in matchers.
- [Mocking Reference](reference/mocking.md): Details on mocking macros and usage.
- [GoogleTest Primer](primer.md): How to write basic tests.
- [GoogleMock Cookbook](gmock_cook_book.md): Advanced mocking recipes and best practices.
- [Advanced Topics](advanced.md#more-assertions): Covers predicate assertions and other advanced assertion features.
- [FAQ on Assertions](faq/feature-usage-behavior/assertions-and-matchers-faq): Answers to common questions.

Explore these to refine your testing maturity and create robust, maintainable test suites.

---