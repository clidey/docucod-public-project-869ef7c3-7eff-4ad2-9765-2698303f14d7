---
title: "Assertion and Matcher Questions"
description: "Provides answers to common questions about assertions and matchers, including correct usage patterns, troubleshooting assertion failures, and how to extend or customize assertions for specific code scenarios."
---

# Assertion and Matcher Questions FAQ

This FAQ page addresses common questions and clarifications regarding the use of assertions and matchers within GoogleTest. Designed to help you confidently write, troubleshoot, and extend your test assertions, this page focuses strictly on assertion and matcher usage, providing clear, actionable guidance and pragmatic examples. 

---

## 1. What Are Assertions and How Do They Differ?

- **Assertions** are macros that verify conditions in your test code. They can be **fatal** (`ASSERT_*`) or **non-fatal** (`EXPECT_*`), defining whether the test should abort immediately or continue after failure.

- **Matchers** provide a rich, readable syntax for expressing expectations about values and arguments in assertions and mock expectations, making failure messages informative.

### Example
```cpp
EXPECT_EQ(5, result);                // Basic assertion
EXPECT_THAT(result, Ge(3));         // Matcher-based assertion
EXPECT_CALL(mock, Func(Lt(10)));  // Expectation with matcher
```

## 2. How Do I Use Predicate Assertions for Complex Conditions?

When your test condition cannot be easily expressed with built-in assertions, predicate assertions provide a clear solution:

- Use `EXPECT_PREDn(pred, ...)` or `ASSERT_PREDn(pred, ...)` where `pred` returns a `bool`. The macro will print the argument values on failure.

- Use `EXPECT_PRED_FORMATn(pred_formatter, ...)` or `ASSERT_PRED_FORMATn(pred_formatter, ...)` where `pred_formatter` returns a `testing::AssertionResult` allowing customized failure messages.

### Practical Use
```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, value);

// With better messages
AssertionResult IsEvenFmt(const char* expr, int n) {
  if (IsEven(n)) return AssertionSuccess();
  return AssertionFailure() << expr << " is not even, actual: " << n;
}
EXPECT_PRED_FORMAT1(IsEvenFmt, value);
```

## 3. How Can I Assert That Floating-Point Values Are Approximately Equal?

Due to rounding errors, exact equality comparisons for floating points are unreliable. GoogleTest offers specialized matchers and assertion macros:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ` for `float` comparison within 4 ULPs.
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ` for `double` similarly.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR` for custom absolute error bounds.

For more flexible comparisons, use predicate-format functions like `FloatLE` or `DoubleLE` with `EXPECT_PRED_FORMAT2`.

### Example
```cpp
EXPECT_FLOAT_EQ(3.14f, computed_value);
EXPECT_NEAR(expected, actual, 0.01);
EXPECT_PRED_FORMAT2(FloatLE, val1, val2);  // val1 <= val2 approx.
```

## 4. What Are the Matcher Macros and How Are They Used?

- `MATCHER` and `MATCHER_P` macros allow you to create simple and parameterized custom matchers.

- Inside a matcher, the value being tested is accessed via `arg`. Return `true` if matching, `false` otherwise.

- Describe your matcher using a descriptive string for failure explanations.

### Example
```cpp
MATCHER(IsEven, "is an even number") {
  return (arg % 2) == 0;
}
EXPECT_THAT(value, IsEven());

MATCHER_P(HasAbsValue, abs_val, "has absolute value") {
  return abs(arg) == abs_val;
}
EXPECT_THAT(value, HasAbsValue(10));
```

## 5. How Can I Explain Why a Matcher Passed or Failed?

Matchers can provide explanations with `MatchAndExplain`, streaming details to a `MatchResultListener`. This enhances failure messages.

Use the `ExplainMatchResult` utility to retrieve the explanation as a string for debugging or further processing.

### Example
```cpp
std::string explanation = testing::Explain(my_matcher, value);
std::cout << explanation << "\n";
```

## 6. Can I Combine Multiple Matchers in Assertions?

Yes. GoogleTest supports combining matchers:

- `AllOf(m1, m2, ...)` to require all matchers to match.
- `AnyOf(m1, m2, ...)` to require any matcher to match.
- Negation via `Not(matcher)`.

These can be passed to `EXPECT_THAT` or `ASSERT_THAT`.

### Example
```cpp
EXPECT_THAT(value, AllOf(Gt(5), Lt(10)));
EXPECT_THAT(value, Not(Eq(0)));
EXPECT_THAT(value, AnyOf(StrEq("foo"), StrEq("bar")));
```

## 7. What Are Common Causes of Assertion Failures?

- Incorrect test logic or expectations.

- Passing by pointer vs. by value mismatch.

- Floating-point comparison without using approximate matchers.

- Comparing C strings with `EXPECT_EQ` instead of `EXPECT_STREQ`.

- Matchers that do not match the argument types.

### Troubleshooting Tips
- Use matcher-friendly macros like `EXPECT_THAT` for expressive errors.
- For floating-point, always prefer `EXPECT_FLOAT_EQ` or `EXPECT_NEAR`.
- Use streamable types or provide `PrintTo` or `AbslStringify` to improve printed values.

## 8. How Do I Record Additional Information In Test Reports?

Use `RecordProperty(key, value)` inside tests or test fixtures to add extra metadata.

- Last value recorded for a key is used in XML/JSON reports.
- Keys cannot be reserved attribute names like `name`, `time`, or `status`.

### Example
```cpp
TEST(MyTest, Example) {
  RecordProperty("MeanTimeMs", "123");
  EXPECT_TRUE(DoSomething());
}
```

## 9. Can I Define Matchers for Complex Objects?

Yes. Use matchers such as:

- `Field(&Class::field, matcher)`: checks a member field matches.
- `Property(&Class::getter, matcher)`: checks a property getter matches.
- Combine with `AllOf` or `FieldsAre` to verify multiple fields.

This lets you write expressive assertions on structured objects.

## 10. How Do I Write Assertions with Messages?

All assertion macros accept streamed messages appended with `<<`. They appear in failure reports to aid debugging.

### Example
```cpp
EXPECT_EQ(5, Calculate()) << "Calculation failed for input 7";
ASSERT_TRUE(IsValid(x)) << "Invalid value: " << x;
```

## 11. When Should I Use Fatal vs. Non-Fatal Assertions?

- Use `ASSERT_*` when failure should abort the current function immediately (e.g., necessary preconditions).
- Use `EXPECT_*` when allowing the test to continue despite failure.

Note: `ASSERT_*` macros must be used only in void-returning functions.

## 12. How Do I Skip a Test at Runtime?

Use `GTEST_SKIP()` to skip a test or skip tests from fixture `SetUp()`:

```cpp
TEST(TestName, TestCase) {
  if (!FeatureAvailable()) {
    GTEST_SKIP() << "Feature not available";
  }
  // Test continues if not skipped.
}
```

## 13. How Do I Use Assertions With Mock Objects?

- Use `EXPECT_CALL(mock, Method(matchers))` to set expectations with argument matchers.
- Use `ON_CALL(mock, Method(matchers)).WillByDefault(action)` to specify default behavior.

Matchers are used heavily here for specifying argument conditions.

## 14. How Can I Write Custom Matchers Easily?

Use the `MATCHER` family of macros to define simple matchers with inline code.

For more control, implement `MatcherInterface<T>`.

Ensure your matcher:
- Returns `true` or `false` for the match.
- Streams user-friendly descriptions via `DescribeTo` and `DescribeNegationTo`.

## 15. How Can I Verify Exceptions Are Thrown?

Use exception assertions:

- `EXPECT_THROW(statement, exception_type)` verifies the statement throws the exception.
- `EXPECT_NO_THROW(statement)` verifies no exception is thrown.
- `EXPECT_ANY_THROW(statement)` verifies any exception is thrown.

Custom exception matching can be done via `EXPECT_THAT` and matchers on the thrown exception.

## 16. Troubleshooting Assertion Failures

### Common Issues:
- Using the wrong assertion macro for string pointer comparisons (`EXPECT_EQ` vs `EXPECT_STREQ`).
- Forgetting to use approximate comparison for floating-point values.
- Incorrect matcher parameter types.
- Not specifying expected call counts properly with `EXPECT_CALL`.

### Tips:
- Use `EXPECT_THAT` and built-in matchers for more reliable failure messages.
- Confirm overload resolution does not cause unexpected matcher instantiation.
- Verify the order and number of arguments in `EXPECT_CALL` matchers.

---

## Related Topics

- [Assertions Reference](reference/assertions.md) — In-depth details on all assertion macros.
- [Matchers Reference](matchers.md) — Comprehensive guide on existing matchers.
- [Mocking Reference](reference/mocking.md) — Details on mocks and expectations.
- [Writing Custom Matchers Quickly](gmock_cook_book.md#NewMatchers) — Learn to define custom matchers.
- [Advanced GoogleTest Topics](guides/advanced-usage-integration/custom-assertions-matchers.md) — Extending assertions and matchers.
- [Boolean and Predicate Assertions](docs/advanced.md#More Assertions) — Techniques for complex assertions.

---

This FAQ is designed for progressive mastery, helping you move from basic assertion use to advanced custom matcher definitions and effective troubleshooting strategies. Your journey to robust C++ testing continues here!