---
title: "How can I resolve common build and runtime errors?"
description: "Guidance for diagnosing and fixing frequent compilation, linker, and runtime errors users face when integrating or running test suites. Includes actionable steps for dependency mismatches, environmental issues, and usage of strict/nice mocks."
---

# How can I resolve common build and runtime errors?

This guide addresses frequent compilation, linker, and runtime errors encountered while integrating and running GoogleTest and GoogleMock test suites. It provides clear, actionable steps to diagnose and fix issues related to environment setup, dependency conflicts, and test usage patterns involving mocks.

---

## 1. Compilation Errors

### Common Causes

- **Unsupported C++ Standard**: GoogleTest requires **C++17** or higher. Ensure your build system and compiler flags use `-std=c++17` or equivalent.
- **Missing or Incorrect Headers**: Confirm that `#include <gtest/gtest.h>` or `#include <gmock/gmock.h>` is properly included.
- **Name Conflicts with Macros**: Avoid macro collisions with function or method names, especially on Windows.
- **Unprotected Commas in MOCK_METHOD**: When mocking methods with argument or return types containing commas (e.g., `std::pair<bool, int>`), wrap the type in parentheses or use a type alias.

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ()); // Correct
  // Or define a type alias:
  using BoolIntPair = std::pair<bool, int>;
  MOCK_METHOD(BoolIntPair, GetPair, ());
};
```

### Solutions

- Check and add appropriate compiler flags for **C++17**.
- Ensure build includes path for GoogleTest/GoogleMock headers.
- Wrap complex types in parentheses or use aliases for `MOCK_METHOD`.
- Avoid const modifiers on parameters that cause warnings, especially for MSVC.

---

## 2. Linker Errors

### Frequent Issues

- **Missing GoogleTest/GoogleMock Libraries**: Your build might not link against the correct static or shared libraries.
- **Multiple Definitions or Conflicts**: Linking against multiple versions of GoogleTest or GoogleMock can cause conflicts.
- **Non-virtual Destructors**: If a base class lacks a virtual destructor, destruction of derived mocks may cause leaks or undefined behavior.

### Fixes

- Verify linking against `gtest` and `gmock` libraries correctly.
- Avoid mixing different versions of GoogleTest or GoogleMock.
- Make sure interfaces that you mock have **virtual destructors**.

---

## 3. Runtime Errors

### Common Problems and Guidance

#### Unexpected Calls and Mock Warnings

GoogleMock generates warnings or errors if mock methods are called unexpectedly or without expectations set.

- **Uninteresting Calls**: Occur when a mock method without an `EXPECT_CALL` is invoked. By default, this produces a warning.

- **Unexpected Calls**: Occur when there are `EXPECT_CALL`s, but none matches the actual call. This results in an error.

**Resolution:**

- Use `EXPECT_CALL(mock, Method(...)).Times(AnyNumber())` to allow calls without warnings.
- Replace mocks with `NiceMock<T>` to suppress warnings for uninteresting calls.
- Use `StrictMock<T>` to treat uninteresting calls as errors if strict behavior is needed.

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock;  // Suppresses uninteresting call warnings
EXPECT_CALL(mock, Foo()).Times(AnyNumber());
```

#### Heapcheck Failures

Often caused by **non-virtual destructors** on mocked interfaces or leaks due to mocks not being deleted.

- Ensure all mock base classes have a virtual destructor.
- Use `Mock::AllowLeak(mock_ptr);` if the mock intentionally leaks, e.g., due to interaction with death tests.

#### Mock Expectation Failures

- Verify that `EXPECT_CALL` statements are set **before** calling mock methods.
- Use `--gmock_verbose=info` flag when running tests to generate a trace of mock calls and expectations to diagnose unexpected matches or misses.

#### Mocks Destroyed Prematurely

- Avoid deleting mocks while expectations are still in use.
- Use smart pointers or proper ownership semantics to manage mock lifetimes.

---

## 4. Best Practices to Avoid Errors

- Always **define expectations (`EXPECT_CALL`) before exercising mocks**.
- Use `ON_CALL` for default behaviors without verifying call frequency.
- Prefer `NiceMock` during early development to reduce noise, switch to `StrictMock` when needing strict test coverage.
- Check that mock classes are defined in the `public:` section for method visibility.
- Confirm all mocked methods are **virtual** in the base class.

---

## 5. Diagnosing Specific Flag Settings

- Use `--gtest_list_tests` to list the tests compiled into your executable.
- Use `--gtest_filter` to run a subset of tests.
- If tests silently do not run or report no tests, verify your test registration and that `RUN_ALL_TESTS()` is called.

---

## 6. Handling Special Build Environments

- When integrating with Bazel or CMake, ensure GoogleTest/GoogleMock dependencies are defined correctly and your C++ standard is consistent across targets.
- Address platform-specific issues by referencing the [Platform Support & Configuration](../api_reference/configuration_integration/platforms_config.md) page.

---

## 7. Additional Resources

- [Setting Up GoogleTest & GoogleMock](../getting-started/setup-prerequisites/installation-platforms.md)
- [Using Mocks and Setting Expectations](../guides/mocking-and-advanced-techniques/creating-and-using-mocks.md)
- [Troubleshooting & Quick Validation](../getting-started/first-run-usage/troubleshooting-quick-validation.md)
- [Understanding Uninteresting vs Unexpected Calls](../guides/mocking-and-advanced-techniques/defining-custom-matchers-actions.md#NiceStrictNaggy)

---

## Troubleshooting Checklist

- ✅ **Compilation:** Confirm C++17 support and no unprotected commas in mock methods.
- ✅ **Linking:** Verify correct libraries linked and no conflicts.
- ✅ **Runtime:** Use `EXPECT_CALL` before mock usage; fix uninteresting call warnings.
- ✅ **Mocks:** Ensure destructors are virtual; manage mock lifetimes properly.
- ✅ **Flags:** Use `--gmock_verbose=info` to trace expectation handling.

---

### Example: Suppressing Uninteresting Call Warnings

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(void, Bar, (), ());
};

TEST(FooTest, Example) {
  ::testing::NiceMock<MockFoo> mock_foo;  // Suppresses uninteresting warnings

  EXPECT_CALL(mock_foo, Bar()).Times(AnyNumber());

  mock_foo.Bar();  // No warnings now
}
```

---

### Final Tips

- If a mock method crash or leaks happen, check destructor virtuality.
- Always set expectations early; unordered calls can confuse gMock.
- Use diagnostic flags and verbose output to gain insights.
- Isolate mocking logic and prefer minimal expectations.

---

For complex issues, consider running tests with:

```shell
./my_test --gmock_verbose=info --gtest_color=yes
```

This will produce detailed diagnostics aiding root cause analysis.


---

<Check>
If you face runtime errors related to unexpected calls, investigate expectation setup order.
If linker errors appear, verify your linking and virtual destructors.
</Check>


---

For further support, see the [FAQ on common errors](../faq/general-usage/common-errors.md) or reach out to the community at the [GoogleTest GitHub Issues](https://github.com/google/googletest/issues).

---

_End of guide._