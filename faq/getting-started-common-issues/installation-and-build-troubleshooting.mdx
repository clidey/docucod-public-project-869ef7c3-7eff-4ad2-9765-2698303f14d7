---
title: "How do I install and build GoogleTest/GoogleMock? What if I encounter an error?"
description: "Guides users through typical installation (CMake, Bazel) and setup for both frameworks. Highlights common build errors and their solutions, such as missing dependencies, misconfigured toolchains, or platform-specific gotchas."
---

# How do I install and build GoogleTest/GoogleMock? What if I encounter an error?

This documentation page guides you through the typical installation and build processes for both **GoogleTest** and **GoogleMock** frameworks using the two most common build systems: **CMake** and **Bazel**. It also provides troubleshooting tips for common build errors such as missing dependencies, toolchain misconfigurations, and platform-specific issues.

---

## 1. Installation Overview

Before starting installation, ensure your system meets the [System Requirements](../getting-started/setup-overview/system-requirements.md), including supported operating systems, compatible compilers (with C++17 support), and required build tools.

GoogleTest and GoogleMock source codes are distributed together. Building GoogleTest automatically includes GoogleMock unless explicitly disabled.

---

## 2. Building with CMake

### Typical Workflow

1. Clone the GoogleTest repository and check out the desired version or branch:

```bash
git clone https://github.com/google/googletest.git -b main
download zipped source for a specific version.
cd googletest
```

2. Create and enter a build directory:

```bash
mkdir build
cd build
```

3. Configure the build with CMake. To build both GoogleTest and GoogleMock:

```bash
cmake ..
```

If you want to build **only GoogleTest** (disabling GoogleMock), add:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

4. Build the project:

```bash
make
```

or on Windows with Visual Studio, open the generated solution and build.

5. (Optional) Install GoogleTest and GoogleMock to your system:

```bash
sudo make install
```

This will install libraries, headers, and pkg-config files, typically under `/usr/local`.

### Incorporating GoogleTest into Your CMake Project

Instead of building GoogleTest standalone, you can include it as part of your project’s build:

- Use `FetchContent` module in your `CMakeLists.txt` to download and build GoogleTest automatically:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Windows compatibility
FetchContent_MakeAvailable(googletest)
```

- Link your test executables against `gtest` or `gtest_main` targets:

```cmake
add_executable(my_test my_test.cc)
target_link_libraries(my_test GTest::gtest_main)
```

- Enable testing and test discovery:

```cmake
enable_testing()
include(GoogleTest)
gtest_discover_tests(my_test)
```

### Practical Tips

- Windows users may need to set `gtest_force_shared_crt` to `ON` to avoid runtime library conflicts.
- Ensure your C++ compiler supports at least C++17. You can enforce this by setting:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- To customize build flags or disable pthread usage, use CMake options like `gtest_disable_pthreads`.

---

## 3. Building with Bazel

GoogleTest and GoogleMock support Bazel as a build system. For Bazel users:

- Add GoogleTest as an external dependency in your `WORKSPACE` file.
- Import the appropriate Bazel targets for `googletest` and `googlemock`.
- Use Bazel rules to build and run tests.

Refer to the [Quickstart for Bazel](quickstart-bazel.md) for detailed instructions.

---

## 4. Common Build Errors & Solutions

### 4.1 Missing Dependencies or Headers

- **Problem:** Compiler errors about missing header files (`gtest/gtest.h`) or `gmock/gmock.h`.

- **Cause:** Build system is not pointed to the GoogleTest/GoogleMock include directories.

- **Solution:**
  - Confirm that your CMake or Bazel configuration correctly references the GoogleTest include paths.
  - For CMake, ensure `FetchContent` or `find_package(GTest REQUIRED)` locates the libraries.
  - If installed system-wide, check your pkg-config path (`PKG_CONFIG_PATH`) includes the directory with `gtest.pc` and `gmock.pc` files.

### 4.2 Linker Errors

- **Problem:** Linker errors like unresolved symbols for GoogleTest or GoogleMock functions.

- **Cause:** 
  - Linking against the wrong libraries or missing linking flags.
  - Mismatch in runtime library options (especially on Windows).

- **Solution:**
  - Link your targets with `gtest`, `gtest_main`, and optionally `gmock` libraries properly.

  - If on Windows, use the CMake option `gtest_force_shared_crt=ON` if your project uses dynamic runtime libraries.

  - Check your compiler and linker flags to ensure consistency.

### 4.3 Platform-Specific Quirks

- Linux and macOS:
  - Missing or incorrect pthread flags (`-pthread`) can cause build or runtime failures.
  - Use CMake’s `find_package(Threads REQUIRED)` and link with `${CMAKE_THREAD_LIBS_INIT}`.

- Windows:
  - If you get runtime mismatch errors (e.g. in MSVC: `RuntimeLibrary` mismatch), use `gtest_force_shared_crt=ON`.

  - Make sure Visual Studio projects correctly link to runtime libraries.

### 4.4 Cross-compilation Issues

- When cross-compiling, ensure that pkg-config files include the correct sysroot paths.
- Properly set environment variables `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` to help pkg-config locate appropriate headers and libs

### 4.5 Known CMake Warnings or Behavior

- The GoogleTest CMake support is community-maintained and may not cover every edge case.
- You may need to tweak or add options in your build configuration to align with your toolchain.

---

## 5. Troubleshooting Checklist

<AccordionGroup title="Common Setup and Build Issues">
<Accordion title="Cannot find gtest.h or gmock.h">
Check that your build system includes GoogleTest source or installed includes in its header search paths. Confirm environment variables like `PKG_CONFIG_PATH` for pkg-config aware builds.
</Accordion>
<Accordion title="Linker errors related to GoogleTest functions">
Ensure you link against the right libraries (`gtest`, `gtest_main`, optionally `gmock`). On Windows, check for runtime library compatibility (`gtest_force_shared_crt` flag).
</Accordion>
<Accordion title="Build failure with pthread errors">
On POSIX systems, ensure the pthread library is linked (`-pthread` flag). Use CMake’s `find_package(Threads)` to automate this.
</Accordion>
<Accordion title="Runtime errors after build">
Confirm that your compiled test binaries are linked properly and run with the necessary environment variables. Check platform-specific notes for peculiarities.
</Accordion>
</AccordionGroup>

---

## 6. Additional Tips & Best Practices

- **Linking:** Prefer to link with `gtest_main` if you do not need to write a custom main() function.

- **Version Pinning:** When using `FetchContent` or similar mechanisms, pin the GoogleTest version to a specific commit or release to maintain reproducible builds.

- **Verbose Build Output:** If encountering problems, build with increased verbosity (`cmake --build . --verbose` or equivalent).

- **Using pkg-config:** If you manually installed GoogleTest, set `PKG_CONFIG_PATH` environment variable so pkg-config can locate `.pc` files.

- **Platform Differences:** Consult the [Platform-specific Notes](../getting-started/installation/platform-specific-notes.md) for caveats and special setup instructions across Linux, Windows, and macOS.

---

## 7. Useful References

- [GoogleTest Primer](../docs/primer.md) — for getting started with writing and running tests.
- [Integration Workflow](../overview/integration-adoption/integration-workflow.md) — detailed guides on integrating GoogleTest with your build and CI systems.
- [Common Setup Issues](../getting-started/support/common-setup-issues.md) — help for troubleshooting installation, linking, and runtime errors.
- [Platform-specific Notes](../getting-started/installation/platform-specific-notes.md) — to learn platform-focused tips and solutions.

---

## 8. Example: Minimal CMake Setup for GoogleTest

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject)

# Require C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
# On Windows, avoid DLL runtime mismatches
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(tests tests.cpp)
target_link_libraries(tests GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(tests)
```

Build and run:

```bash
mkdir build
cd build
cmake ..
cmake --build .
ctest
```

This builds and runs your test binary with GoogleTest properly linked.

---

## 9. When to Seek Further Help

If you encounter persistent problems that are not resolved by the guidance above:

- Review the build output logs carefully for specific error messages.
- Check relevant GitHub issues on the [GoogleTest repository](https://github.com/google/googletest/issues).
- Visit community forums.
- Check [Getting Help & Further Resources](../getting-started/support/finding-help.md).
- Report issues with reproducible steps, build system details, platform info, and error messages.

---

Successfully installing and building GoogleTest and GoogleMock will empower you to write, integrate, and run robust C++ tests efficiently across supported platforms with confidence.


---

### Related Documentation

- [Quickstart: Building with CMake](../docs/quickstart-cmake.md)
- [Quickstart for Bazel](../docs/quickstart-bazel.md)
- [Common Setup Issues](../getting-started/support/common-setup-issues.md)
- [Platform-specific Notes](../getting-started/installation/platform-specific-notes.md)

---

For the latest source and build guidance, visit the official GoogleTest GitHub repository:

[https://github.com/google/googletest](https://github.com/google/googletest)