---
title: "Test Performance & Optimization Tips"
description: "Provides actionable advice and answers about improving test execution speed, managing large test suites, and leveraging test runners or CI for maximum efficiency. Highlights common pitfalls that slow tests down and shows how to mitigate them."
---

# Test Performance & Optimization Tips

This FAQ page provides practical advice and answers to common questions about improving test execution speed, managing large test suites, and effectively using test runners and continuous integration tools to maximize testing efficiency. It highlights frequent pitfalls that can slow tests down and offers proven strategies to mitigate them.

---

## Frequently Asked Questions

### How can I make my tests run faster?

- **Run Tests in Parallel:** Leverage GoogleTest's support for parallel test execution by using sharding (`GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`) to distribute tests across multiple processes or machines. This drastically reduces total test time, especially for large suites.

- **Structure Tests Efficiently:** Group related tests into well-organized test suites and use shared setup (`SetUpTestSuite`) when possible to minimize expensive initialization overhead.

- **Use Value-Parameterized Tests:** Reuse test logic with multiple inputs via parameterized tests (`TEST_P` and `INSTANTIATE_TEST_SUITE_P`) to avoid redundant code and exploit shared setup.

- **Avoid Over-Specifying Expectations in Mocks:** Use `ON_CALL` for common behavior and add only necessary `EXPECT_CALL`s. Overly strict expectations slow down tests unnecessarily.

- **Leverage `WillRepeatedly` and `WillOnce`:** Define actions carefully on mocks to avoid redundant or costly computations on each call.


### How do I manage very large test suites without slowing down development?

- **Shard the Tests:** As mentioned, split your tests via sharding to run them on different machines or processes.

- **Use Filtering:** Run only selected tests during development by using `--gtest_filter` to focus on the subset relevant to your changes.

- **Disable Long-Running or Flaky Tests Temporarily:** Use the `DISABLED_` prefix on tests or test suites to exclude them from frequent runs without losing them.

- **Organize Tests Logically:** Place long-running or integration-heavy tests in separate suites to allow quick execution of fast unit tests.

- **Avoid Test Interdependencies:** Independent tests enable safe parallelization and easier failures isolation.


### How should I use test runners or Continuous Integration (CI) for optimal test speed?

- **Run Tests in Sharded Environments:** Configure CI pipelines to shard test runs across multiple parallel jobs.

- **Cache Test Artifacts:** Where possible, cache build outputs and test data to avoid expensive rebuilds.

- **Capture and Analyze Performance Metrics:** Use GoogleTest's XML or JSON output (`--gtest_output=xml:path` or `json:path`) to identify slow tests and optimize them.

- **Repeat Tests as Needed:** Use `--gtest_repeat` to run flaky tests multiple times in CI to catch intermittent failures.

- **Use `RUN_ALL_TESTS` Properly:** Ensure your test binary calls `RUN_ALL_TESTS()` only once, following recommended GoogleTest patterns.


### What are common pitfalls that slow down tests, and how can I avoid them?

- **Expensive Setup/TearDown in Each Test:** Avoid recreating heavy resources for every test; instead, use `SetUpTestSuite` and `TearDownTestSuite` for shared expensive initialization.

- **Overly Specific Expectations on Mocks:** Expecting too many calls or very strict call orders can make mock verification costly and brittle.

- **Unintended Overlaps in Expectations:** Placing catch-all expectations (`EXPECT_CALL(obj, Method(_))`) after more specific ones can mask expected behavior and cause unnecessary failures or slowdowns.

- **Not Using `RetiresOnSaturation()` When Appropriate:** Not retiring expectations after saturation keeps them active, causing more complex and slower matching logic.

- **Excessive Logging at High Verbosity:** Running tests with `--gmock_verbose=info` causes detailed logging of each mock call, slowing tests.

- **Running Unnecessary Disabled or Flaky Tests Unconditionally:** Use filters and disable long-running tests during active development.


### How can I profile and debug slow tests?

- **Use Built-in Test Timing:** GoogleTest reports elapsed time per test. Look for tests consuming disproportionate time.

- **Generate XML/JSON Reports:** Use `--gtest_output` to produce report files and analyze test performance over time.

- **Apply `SCOPED_TRACE` for Complex Tests:** Use tracing to pinpoint where delays or failures occur inside nested calls.

### Can mock objects affect test performance?

Yes. Mock methods that have many expectations or overly complex matchers can slow down test execution. To optimize:

- Prefer `ON_CALL` for default behavior and limit `EXPECT_CALL` to necessary expectations.
- Use `RetiresOnSaturation()` to retire expectations appropriately.
- Avoid unnecessary deep matchers on frequently called mock methods.
- Group mock expectations using sequences or partial orders carefully to avoid excess overhead.


---

## Common Issues & Gotchas

### Setup Overhead

Heavy fixture setup for each test can slow down entire test runs. Consider moving expensive setup to `SetUpTestSuite()` and `TearDownTestSuite()` to share resources.

### Test Ordering Dependencies

Tests that unintentionally depend on order or perform side effects cause flakiness and prevent safe parallel execution.

### Excessive Mock Expectations

Do not overuse `EXPECT_CALL()` unnecessarily; it adds runtime cost and increases fragility.

Use `NiceMock` to suppress warnings about uninteresting calls, and consider strictness modes only when needed.

### Large Parameterized Test Suites

While powerful, very large parameterized tests may increase run time due to combinatorial growth. Choose parameters judiciously.


---

## Tips for Performance Optimization

- Use test sharding via `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` environment variables.
- Run tests in parallel on CI with sharding or separate jobs.
- Profile tests using XML/JSON outputs and focus optimization effort on slow tests.
- Review mock configurations to remove redundant expectations and use actions efficiently.
- Suppress unnecessary logging by setting `--gmock_verbose=warning` or `error`.
- Manage test dependencies and fixture lifetimes carefully.

---

## Troubleshooting

### Tests Running Too Slowly

- Verify if heavy setup is repeated per test; refactor to use per-test-suite setup if so.
- Check for flaky or retry-heavy tests eating time; isolate and disable if needed.
- Review mock expectations, especially multiple overlapping ones.
- Reduce verbosity of test and mock logging.
- Use `--gtest_filter` to isolate and test performance of individual suites or tests.

### Tests Flaking Under Parallel Execution

- Ensure tests are independent and do not share mutable global state.
- Use synchronization or refactor tests to avoid race conditions.
- Verify that mocks and expectations are thread-safe according to guidelines.

---

## Additional Resources

- [Scaling, Performance, and Test Optimization Guide](https://github.com/google/googletest/blob/main/docs/guides/integration_and_effectiveness/scaling_and_optimization.md)
- [Mocking Framework - Using Expectations and Actions](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-framework/expectations-actions.mdx)
- [Test Lifecycle and Execution Flow](https://github.com/google/googletest/blob/main/docs/concepts/core-testing-model/test-lifecycle.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleTest Advanced Topics](https://github.com/google/googletest/blob/main/docs/advanced.md)


---

<Check>
Ensure tests are organized for scalability and performance by:
- Running tests in parallel and/or in shards.
- Using parameterized tests effectively to reduce code duplication.
- Using mock expectations sparingly to limit overhead.
- Avoiding heavy setup per test by employing shared test fixture setup.

Optimize your CI for test speed by distributing tests across jobs and caching builds.
</Check>
