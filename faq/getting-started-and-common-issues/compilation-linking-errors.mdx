---
title: "Solving Compilation and Linking Errors"
description: "Practical tips for fixing common compilation and linking errors that appear when integrating GoogleTest or GoogleMock into your project, including header inclusion patterns, symbol errors, and typical mistakes."
---

# Solving Compilation and Linking Errors

This page provides practical guidance for resolving common compilation and linking errors encountered when integrating GoogleTest or GoogleMock into your C++ projects. It specifically focuses on issues related to header inclusion, symbol resolution, and typical user mistakes during build configuration.

---

## Common Compilation Errors and How to Fix Them

### 1. Header File Inclusion Patterns

**Problem:** Compiler fails to find GoogleTest or GoogleMock headers.

**Solution:**
- Always include the primary headers as `#include <gmock/gmock.h>` or `#include <gtest/gtest.h>`. These headers internally include necessary dependencies and set up namespaces properly.
- Ensure your build system's include paths point to the root directory containing these headers.
- Avoid including internal or private headers directly (e.g., `gmock-port.h`), as these are subject to change and may be omitted from your include paths.

**Example:**
```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>
```

<Tip>
Verify your build system is configured to include GoogleTest and GoogleMock header directories. If using CMake, link the target with the appropriate targets (e.g., `GTest::gmock`, `GTest::gtest`) to automatically configure the include paths.
</Tip>

---

### 2. Macro Usage Errors with `MOCK_METHOD`

**Problem:** Compilation failure when using `MOCK_METHOD` macro with complex method signatures that include commas.

**Cause:** The macro parses arguments naïvely, so types containing commas (e.g., `std::pair<bool, int>`) need special handling.

**Solutions:**

- **Wrap return or argument types containing commas in extra parentheses:**
  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

- **Define type aliases to simplify declarations:**
  ```cpp
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());

  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
  ```

**Note:** This behavior is documented in the [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#MOCK_METHOD). Always use `MOCK_METHOD` in the `public:` section of the mock class, even if mocking methods originally declared as `protected` or `private`.

---

### 3. Linking Errors Due to Missing Symbols

**Problem:** Linker errors such as "undefined reference to`gmock_*` or `gtest_*` symbols." 

**Common Causes:**
- The GoogleTest/GoogleMock libraries are not linked correctly.
- Mixing static and dynamic runtime libraries inconsistently.
- Not building GoogleMock or GoogleTest sources.

**Solutions:**
- Ensure you link your test executable against the appropriate libraries (e.g., when using CMake, link with `GTest::gmock` or `gmock_main` and `gtest_main`).
- Verify that GoogleMock is built and included. If you only built GoogleTest (`-DBUILD_GMOCK=OFF`), symbols related to mocks won’t be available.
- Align runtime libraries and compiler flags between your project and GoogleTest. For example, Visual Studio users should be aware of [`gtest_force_shared_crt`](https://github.com/google/googletest#visual-studio-dynamic-vs-static-runtimes) option.

---

### 4. Compiler Warnings About Virtual Methods and Overriding

**Typical Warning:**

When mocking methods with certain parameter const qualifiers, MSVC may report warnings like:

```
warning C4301: overriding virtual function only differs by const/volatile qualifier
```

**Explanation:**
- This is a known compiler bug on some MSVC versions.
- In C++, the top-level `const` on parameters is ignored in method declarations, so beware using `const int` vs `int` as parameter types.

**Recommended Approach:**
- Remove unnecessary top-level `const` qualifiers from parameters when declaring virtual methods, especially on mocks.

---

## Best Practices to Avoid Compilation and Linking Problems

- **Use CMake Integration:** Let CMake manage include paths and linking by using `find_package(GTest REQUIRED)` and target linking.

- **Keep Mock Methods `public`:** Place all `MOCK_METHOD`s in the public area of the mock class, even if mocking protected or private members.

- **Prefer the Modern `MOCK_METHOD` Macro:** Avoid legacy `MOCK_METHODn` macros unless necessary for legacy code.

- **Control Strictness Modes:** To prevent warnings on uninteresting calls during development, use `NiceMock<YourMockClass>`. For stricter enforcement, use `StrictMock`.

---

## Troubleshooting Steps for Build Integration

<Steps>
<Step title="Verify Include Paths">
Make sure your compiler includes the GoogleTest and GoogleMock include directories. Try compiling a small test file with just `#include <gmock/gmock.h>` and see if it passes.
</Step>
<Step title="Confirm Linked Libraries">
Ensure that your test executable links with the GoogleTest and GoogleMock static or shared libraries. In CMake, this usually means linking against `GTest::gmock` and/or `GTest::gtest`.
</Step>
<Step title="Check Macro Usage">
Audit your mock classes to confirm that `MOCK_METHOD` macros are in public scope and any complex method signatures use parentheses or type aliases to handle template commas.
</Step>
<Step title="Clean and Rebuild">
Remove all old object files and binaries. Rebuild the entire project including GoogleTest and GoogleMock to avoid stale build artifacts causing linking failures.
</Step>
<Step title="Enable Verbosity">
Build and run tests with the flag `--gmock_verbose=info` to get detailed logging which might hint at missing symbols or incorrect calls.
</Step>
</Steps>

---

## Example: Correct Use of MOCK_METHOD with Complex Types

```cpp
#include <gmock/gmock.h>
#include <map>
#include <utility>

class MockFoo {
 public:
  // Wrapping return type with parentheses due to comma.
  MOCK_METHOD((std::pair<bool, int>), GetPair, (), ());

  // Using type alias simplifies handling complex argument types.
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool), ());
};
```

---

## Summary

Following correct header inclusion patterns, proper usage of `MOCK_METHOD`, and ensuring correct linking with GoogleTest and GoogleMock libraries resolves the majority of common compilation and linking errors. Leveraging build system features (like CMake’s targets) simplifies integration and reduces errors.

---

## Further Resources

- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) — detailed recipes for mocking techniques.
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md) — complete macro and API reference.
- [Legacy gMock FAQ](https://github.com/google/googletest/blob/main/docs/gmock_faq.md) — answers to common problems.
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) — basics of GoogleTest usage.
- [System Requirements](https://github.com/google/googletest/blob/main/docs/getting-started/prerequisites-installation/system-requirements.md) — build prerequisites.

---

For a holistic understanding of build and test workflow, consider reviewing the [Project Setup & Configuration](https://github.com/google/googletest/blob/main/docs/getting-started/configuration-first-use/project-setup.md) guide.

---

*This documentation focuses exclusively on compilation and linking error solutions encountered during GoogleTest and GoogleMock integration, aiming to empower developers to achieve successful build and test execution.*
