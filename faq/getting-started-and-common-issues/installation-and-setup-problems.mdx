---
title: "How do I install and set up GoogleTest/GoogleMock?"
description: "Walks through resolving common installation and configuration headaches, including CMake/Bazel setup, compiler requirements, and environment issues. Helps users get their tests building and running as quickly as possible."
---

# How do I install and set up GoogleTest/GoogleMock?

This guide helps you quickly navigate the common hurdles and practical steps involved in installing and configuring GoogleTest and GoogleMock for your C++ projects. Whether you are using CMake or Bazel as your build system, or working on different platforms and compilers, this document steers you from setup to successful test execution with confidence.

---

## 1. Preparing Your Environment: Prerequisites

Before diving into the installation, ensure your system meets the following minimum requirements:

- **Supported Operating Systems:** Linux, Windows, macOS
- **Compiler Support:** A compiler with at least full C++11 compatibility. Recommended compilers include GCC (5.0+), Clang (3.3+), and MSVC (2015+).
- **Build Tools:** CMake (3.14 or later) for building GoogleTest natively or as a subdirectory; Bazel if using Bazel build integration.

<Tip>
If you encounter strange compiler errors, verify your compiler version and confirm C++11 support by compiling a simple test snippet with `constexpr`, `auto`, or lambdas.
</Tip>

## 2. Installing with CMake

GoogleTest and GoogleMock come bundled and offer flexible build options.

### 2.1 Standalone GoogleTest Build

Use this flow when you want GoogleTest as its own project:

```bash
# Clone with the desired tag or branch
git clone https://github.com/google/googletest.git -b v1.17.0
d
cd googletest
mkdir build
cd build

# Generate native build files; default builds GoogleMock as well
cmake ..

# To build only GoogleTest (without GoogleMock), disable gmock
# cmake .. -DBUILD_GMOCK=OFF

# Build
make

# Optionally install system-wide (requires administrator privileges)
sudo make install
```

- On Windows, Visual Studio solution (`gtest.sln`) and project files are generated instead.
- On macOS, Xcode project files (`.xcodeproj`) are generated.

### 2.2 Integrating GoogleTest into Your CMake Project

For projects already using CMake, the recommended method is adding GoogleTest as a subdirectory or fetching during configure time:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows: Use dynamic CRT for compatibility
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test my_test.cpp)
target_link_libraries(my_test gtest_main gmock_main)
add_test(NAME my_test COMMAND my_test)
```

This approach ensures build consistency, compiler flag alignment, and avoids ABI mismatches.

<Tip>
Always use `gtest_main` or `gmock_main` as the linked libraries to avoid the need to write `main()` yourself, unless customization is required.
</Tip>

## 3. Installing with Bazel

If your project uses Bazel, GoogleTest and GoogleMock are available as external dependencies. Follow your Bazel workspace and build configuration instructions to add GoogleTest dependencies accordingly.

Please refer to [Build System Integration Guide](/guides/practical-integrations/build-system-integration) for detailed Bazel setup instructions.

## 4. Handling Compiler and Platform Nuances

- **Visual Studio Runtime Linking:**
  Use the CMake option `-Dgtest_force_shared_crt=ON` to ensure GoogleTest links dynamically to the CRT on Windows, avoiding runtime mismatch errors.

- **Threading Support:**
  GoogleTest is thread-safe with pthread support. If your environment doesn't detect pthread automatically, force it with `-DGTEST_HAS_PTHREAD=1` or disable it with `-DGTEST_HAS_PTHREAD=0`.

- **C++ Standard:**
  Enforce at least C++17 globally in your CMake project or pass appropriate compiler flags, as GoogleTest requires this since recent versions.

## 5. Linking the Main Function

GoogleMock provides a ready-to-use main function in the `gmock_main` library, which initializes both GoogleTest and GoogleMock and runs all tests. Link against it:

```cmake
target_link_libraries(my_test gmock_main)
```

If you prefer customizing `main()` (for example, to process command-line flags or setup logging), you can write your own and call:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

> Note: You must call `InitGoogleMock()` **once** before running tests, which also initializes GoogleTest internally.

## 6. Verifying the Installation

### 6.1 Build and Run a Minimal Test

Create a simple test file, e.g., `sample_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(ExampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
}
```

Compile and link it with GoogleTest/GoogleMock libraries, then run:

```bash
./sample_test
```

You should see output like:

```
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from ExampleTest
[ RUN      ] ExampleTest.BasicAssertions
[       OK ] ExampleTest.BasicAssertions (0 ms)
[----------] 1 test from ExampleTest (0 ms total)

[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

### 6.2 Troubleshooting Common Setup Issues

<AccordionGroup title="Common Installation and Setup Problems">
<Accordion title="Tests Not Being Discovered or Run">
Ensure you called `testing::InitGoogleMock(...)` before `RUN_ALL_TESTS()`. Check linkage against `gmock_main` or `gtest_main`.
</Accordion>
<Accordion title="Linker Errors Related to Runtime Libraries">
Try setting `gtest_force_shared_crt` to `ON` in CMake on Windows to fix runtime mismatch issues.
</Accordion>
<Accordion title="Compiler Version or Flags Not Supported">
Upgrade your compiler or explicitly set compiler flags for at least C++11. Verify correct compiler for your system.
</Accordion>
<Accordion title="Missing Pthreads on Unix-like OSes">
Ensure pthread development libraries are installed. On Linux, install `libpthread` or equivalent.
</Accordion>
</AccordionGroup>

<Tip>
For detailed command-line options and environment configurations, see the [Test Configuration and Environment Guide](/api-reference/core-testing-api/test-configuration).
</Tip>

## 7. Best Practices and Tips

- **Use the pre-built `gmock_main` library** to minimize boilerplate in your projects.
- **Add GoogleTest as a subdirectory or FetchContent in CMake** for easier maintenance and integration.
- **Avoid mismatched debug and release libraries** by ensuring consistent build configurations across all modules.
- **Compile mock classes with out-of-line constructors and destructors** to reduce compile time impact if your mocks get large.

## 8. Additional Resources

- [Installation & Build Integration Guide](/getting_started/essentials_setup/installation)
- [Build System Integration Guide](/guides/practical-integrations/build-system-integration)
- [Prerequisites & Supported Platforms](/getting_started/essentials_setup/prerequisites)
- [Writing Your First Test](/guides/getting-started/writing-your-first-test)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)

---

For troubleshooting specific error messages during setup or compilation, consult the [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) or reach out via community forums and GitHub issues.


---