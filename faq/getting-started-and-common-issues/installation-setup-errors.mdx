---
title: "Installation and Setup Errors"
description: "Answers common questions and provides solutions for installation woes, build failures, and common platform pitfalls when setting up GoogleTest and GoogleMock on various systems."
---

# Installation and Setup Errors FAQ

This page addresses common questions and practical solutions related to installing and setting up GoogleTest and GoogleMock, especially focusing on build failures, linking issues, and platform-specific pitfalls. Whether you are building from source using CMake on various platforms or integrating GoogleTest/GoogleMock into your projects, this FAQ guides you through troubleshooting common obstacles.

---

## 1. Common Installation and Build Issues

### Why am I experiencing linker errors related to `main()` when building my tests with GoogleMock?
Linker errors involving `main()` often happen due to confusion between `gmock` and `gmock_main` libraries. 

- **`gmock`** contains GoogleMock but does *not* provide a `main()` function.
- **`gmock_main`** provides GoogleMock *with* a pre-defined `main()` function.

**Solution:**

- Link your test executable to `gmock_main` if you want to use the default main() provided.
- If you link only to `gmock`, you must define your own main() function that calls `testing::InitGoogleMock()` before running tests.

This distinction is also reflected in the `gmock_main.pc` and `gmock.pc` pkg-config files:

```bash
# gmock_main.pc
Libs: -L${libdir} -lgmock_main ...

# gmock.pc
Libs: -L${libdir} -lgmock ...
```

If you link improperly or omit `gmock_main` when expecting it, linking will fail.

### What is the recommended way to build and install GoogleMock and GoogleTest using CMake?

GoogleTest and GoogleMock provide community-based CMake build scripts. To build and install:

1. Clone the repo and create a build directory.
2. Run `cmake ..` to generate build files. The default includes GoogleMock.
3. Run `make` (or build using your native platform's tools).
4. (Optional) Run `make install` to install headers and libraries.

To build only GoogleTest without GoogleMock:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

Note these flags and paths must be correct for your environment. The CMakeLists.txt also supports options like `gmock_build_tests` to enable internal tests, which are off by default.

### Why do I get errors related to Visual Studio runtime mismatches?

By default, Visual Studio projects and GoogleTest may link to different C runtime libraries (dynamic vs static).

**Error example:**

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

**Solution:** Set the `gtest_force_shared_crt` CMake option ON to make GoogleTest use the dynamic runtime, matching typical Visual Studio defaults.

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

This prevents linker conflicts and ensures consistent runtime linkage.

### What C++ standard version is required to build GoogleTest and GoogleMock?

GoogleTest and GoogleMock require a compiler supporting **C++17** or later.

Make sure your build system sets the C++ standard appropriately, for example in CMake:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Or add compiler flags manually.

---

## 2. Platform-Specific Setup Pain Points

### How do I handle GoogleTest and GoogleMock integration on embedded platforms like ESP8266, ESP32, or NRF52?

On these Arduino-like platforms, `main()` is not the program entry point. Instead, `setup()` and `loop()` functions are used.

GoogleMock provides specialized entry points in `gmock_main.cc`:

```cpp
void setup() {
  testing::InitGoogleMock();
}
void loop() { RUN_ALL_TESTS(); }
```

You should not call `testing::InitGoogleTest()` separately because `InitGoogleMock()` initializes both GoogleMock and GoogleTest.

### What workaround should I use on Windows with MSVC where `_tmain` causes a link error?

Due to a known Visual Studio linker bug, GoogleMock uses `main()` instead of `_tmain`.

If you are targeting Windows Mobile platforms require `_tmain`, the GoogleMock source switches to it internally.

On desktop Windows builds, stick to `main()` to avoid linker errors.


### Are there any CMake quirks I should be aware of when building GoogleMock on MinGW or Cygwin?

Yes. These platforms require the `-Wa,-mbig-obj` compile flag for some tests due to large object files.

This flag is added automatically in the internal tests if you enable `gmock_build_tests`.

If you see link errors related to big objects, confirm this flag is set.

---

## 3. Troubleshooting Build and Link Failures

### Why do I get unresolved symbols from GoogleTest or GoogleMock when linking?

Common causes:

- You forgot to link required libraries: link against `gtest`, `gmock`, or `gmock_main` as needed.
- Mismatched compiler settings or debug/release builds between your code and GoogleTest libraries.
- Not building or installing GoogleTest/GoogleMock correctly.

**How to fix:**

- Make sure to link your test target with `-lgmock_main` if you want the default main() function.
- Confirm your C++ standard is consistent.
- Rebuild GoogleTest/GoogleMock with the same compiler and flags.

### Headers Not Found or Include Errors?

Ensure the include directories are set correctly in your build system.

GoogleMock’s include directories usually include:

- `googlemock/include`
- `googletest/include`

When using CMake, these directories are added automatically through `target_include_directories`.

If you are integrating manually, add these include paths to your compiler flags.

---

## 4. Configuration and Flag Issues

### How do I ensure multithreading support is enabled and pthread is linked?

GoogleTest detects pthread support automatically, but if it fails:

- Define the macro `GTEST_HAS_PTHREAD=1` explicitly when compiling.
- Ensure your linker is adding pthread using `-lpthread` or equivalent.

GoogleMock’s CMake scripts handle this automatically.

### How do I avoid macro name clashes with GoogleTest macros?

If a macro defined by GoogleTest conflicts with another library (e.g., `TEST`, `ASSERT_EQ`), you can disable the definition of these macros and use prefixed versions.

Pass compiler flags like `-DGTEST_DONT_DEFINE_TEST=1` to rename `TEST` to `GTEST_TEST`, and similarly for other macros.

This avoids name collisions in complex code bases.

---

## 5. Best Practices to Prevent Installation Errors

- Always use the provided main functions (`gmock_main` or `gtest_main`) or implement your own correctly initializing test main.
- Match runtime libraries and compiler flags between GoogleTest/GoogleMock and your project.
- Use CMake as recommended to simplify dependencies and threading settings.
- On embedded or special platforms, use the appropriate entry point overrides.
- Read GoogleTest and GoogleMock version compatibility notes.

---

## 6. Additional Resources

- [GoogleTest Home Repository](https://github.com/google/googletest)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [GoogleMock Build with CMake Instructions](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [Common Setup Issues and Workarounds](../../getting-started/troubleshooting-validation/common-setup-issues.md)
- [API Reference: Main Entry Points](../../api-reference/integration-examples/main-entry-points.md)

---