---
title: "Dealing With Platform-Specific Issues"
description: "Guidance for users running into issues on Windows, Linux, or macOS, such as environment setup, file system differences, or unique compiler flags. Helps users quickly find platform-relevant advice."
---

# Dealing With Platform-Specific Issues

GoogleTest and GoogleMock aim to provide a consistent, reliable testing and mocking framework across diverse operating systems and environments. However, platform-specific differences such as environment setup, filesystem behaviors, compiler flags, and threading models may affect your experience. This page offers practical guidance to help you navigate and resolve common platform issues on Windows, Linux, and macOS.

---

## 1. Understanding Platform Differences

GoogleTest automatically detects your platform and environment to adjust feature availability and behavior accordingly. However, these detections are not flawless, and manual overrides may be needed.

- **Platform Macros:** Internally, GoogleTest defines macros like `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, and variations above them to tailor behavior.
- **Feature Macros:** Flags such as `GTEST_HAS_PTHREAD`, `GTEST_HAS_EXCEPTIONS`, `GTEST_HAS_STREAM_REDIRECTION`, and others signal platform capabilities.

> You usually donâ€™t need to define or alter these macros unless your environment has unique requirements or detection fails.

For detailed platform list and support information, see the [Supported Platforms](https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md).

---

## 2. Common Platform-Specific Issues and Solutions

### 2.1 Windows-Specific Guidance

- **Environment Setup:**
  - Ensure environment variables and paths are properly set, particularly for compiler, linker, and runtime libraries.
  - Microsoft Visual Studio projects default to dynamic runtime linking, but GoogleTest defaults to static linking. Enable `gtest_force_shared_crt` in CMake to harmonize runtimes.

- **Compiler Flags:**
  - GoogleTest uses `/W4`, `/WX`, and `/utf-8` flags with MSVC for strict diagnostics and UTF-8 encoding.
  - If you encounter warnings about deprecated functions (e.g., `snprintf`), GoogleTest uses safe wrappers internally; no changes are usually needed.

- **Filesystem Considerations:**
  - Path separators are set to `\\`.
  - Wide-character versions of file APIs (`_wfopen`) are used internally to handle Unicode paths.

- **Threading & Synchronization:**
  - GoogleTest uses Windows native synchronization primitives when available.
  - For MinGW, pthreads support is limited; GoogleTest falls back accordingly.

- **Linking Errors:**
  - When building GoogleTest as a DLL, define `-DGTEST_CREATE_SHARED_LIBRARY=1` for the library and `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` for your tests to ensure proper symbol visibility.

### 2.2 Linux-Specific Guidance

- **Requirements:**
  - GoogleTest requires C++17 support and pthreads.
  - When building with the typical toolchains, ensure linking with `-pthread`.

- **Clone Support:**
  - On Linux, `clone()` syscall support is detected and used for death tests for process isolation.

- **Regex Library:**
  - POSIX regex is used by default unless Abseil and RE2 are enabled.

- **Filesystem:**
  - Uses POSIX path separator `/` and standard POSIX filesystem calls.

- **Stream Redirection:**
  - Stream redirection for stdout/stderr capture is supported except on some embedded platforms.

- **Common Pitfalls:**
  - Missed `-pthread` flag can cause linking or runtime failures.
  - On Android, some features (like POSIX regex) are limited depending on API level.

### 2.3 macOS and iOS Guidance

- **Platform Flags:**
  - `GTEST_OS_MAC` and optionally `GTEST_OS_IOS` are set automatically.

- **Filesystem and Paths:**
  - Standard POSIX filesystem APIs are used.
  - Path separator is `/`.

- **Threading:**
  - POSIX threads are used.

- **Stream Redirection:**
  - Fully supported on macOS desktop.
  - Limited or unavailable on iOS.

- **Exceptions and RTTI:**
  - Apple Clang enables exceptions and RTTI by default. GoogleTest detects and adjusts accordingly.

- **Important:**
  - For iOS projects, especially with limited filesystem or process isolation, some GoogleTest features (like death tests) may be unavailable or require special setup.

---

## 3. Overriding Platform Detection

If GoogleTest's auto-detection of platform features does not correctly match your environment, you may manually override macros in your build configuration:

- `-DGTEST_HAS_PTHREAD=0` or `1` to forcibly disable or enable pthread support.
- `-DGTEST_HAS_EXCEPTIONS=0` or `1` if exception support detection is incorrect.
- `-DGTEST_CREATE_SHARED_LIBRARY=1` when building GoogleTest as a DLL/shared library.

> These overrides should only be used when necessary and carefully tested, as improper settings can cause compilation issues or runtime errors.

---

## 4. Handling Filesystem Differences

GoogleTest abstracts most filesystem interactions; however, some platform quirks require attention:

- **Path Separators:** Use `/` on Unix-like systems and `\\` on Windows.
- **Unicode Paths:** Windows uses wide-character APIs internally to handle non-ASCII paths.
- **Availability:** Embedded platforms or older systems may lack a full filesystem (e.g., Windows Mobile, some embedded Linux). Features relying on filesystem may be disabled.
- **Functions:** GoogleTest wraps filesystem calls with platform-specific implementations to hide differences.

### Practical Tip

For tests that rely on file creation or manipulation, verify your platform support for file I/O. Use `testing::TempDir()` to get a safe temporary directory compatible with your platform.

---

## 5. Threading and Synchronization Across Platforms

GoogleTest adapts to the availability of threading:

- **Thread Safety:** If pthreads or Windows threading primitives are available, GoogleTest uses mutexes and thread-local storage internally.
- **Fallback:** On platforms without threading support, dummy implementations are used, and concurrency safety is limited.
- **Death Tests:** Platforms with process isolation (fork or clone) support the full death test feature set.

### User Impact

When running multi-threaded tests, ensure your platform supports the threading model GoogleTest relies on. On embedded or limited environments, avoid tests that require concurrency.

---

## 6. Common Troubleshooting Scenarios

### Issue: Tests fail to compile or link due to missing pthread

**Solution:** Add `-pthread` to both compiler and linker flags. On CMake, this happens automatically when you link to `Threads::Threads`.

### Issue: GoogleTest does not detect exceptions or RTTI correctly

**Solution:** Manually define `-DGTEST_HAS_EXCEPTIONS=1` or `0` and `-DGTEST_HAS_RTTI=1` or `0` as needed. Match your compiler and build settings.

### Issue: Death tests fail or are disabled

**Cause:** Death tests need filesystem access and process isolation.

**Solution:** Verify your platform supports these and that GoogleTest's detection macros reflect that (`GTEST_HAS_DEATH_TEST=1`). On constrained platforms, death tests may be disabled.

### Issue: Unicode or path issues on Windows

**Solution:** Use Unicode-aware paths and ensure your source files and project settings use UTF-8. GoogleTest internally converts path strings appropriately.

### Issue: Symbol visibility or DLL import/export problems on Windows

**Solution:** Use the correct macros `GTEST_CREATE_SHARED_LIBRARY` and `GTEST_LINKED_AS_SHARED_LIBRARY` when building and linking shared libraries.

---

## 7. Best Practices for Cross-Platform Testing

- **Use Stable API Macros:** Always include `<gtest/gtest.h>` instead of internal headers.
- **Check Macro Values:** Use `GTEST_IS_THREADSAFE`, `GTEST_HAS_PTHREAD`, and other macros to write platform-aware code if necessary.
- **Avoid Platform-Specific Assumptions:** Write tests that work irrespective of line-ending, path separator, or threading support.
- **Leverage Temporary Directory Facilities:** Use `testing::TempDir()` for file operations instead of hardcoded paths.
- **Define Overrides Judiciously:** Only override detection macros when clearly necessary and document the change.

---

## 8. Where to Get Help and Additional Resources

- **Supported Platforms:** [Supported Platforms Matrix](https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md)
- **Platform Portability Utilities:** See the API reference section on [Portability & Platform Utilities](/api-reference/advanced-apis-config/portability-platform-utils)
- **Troubleshooting Common Setup Issues:** [Troubleshooting Setup Guide](/getting-started/first-steps-validation/troubleshooting-setup)
- **GoogleTest README:** Contains build and integration tips, including platform-specific notes ([GoogleTest README](https://github.com/google/googletest/blob/main/googletest/README.md))
- **Community Support:** Reach out on the GoogleTest user groups via googletestframework@googlegroups.com

---

## 9. Summary Mind Map of Platform Factors

```mermaid
flowchart TD
  A[Start: Build Tests] --> B{Detect Platform}
  B -->|Windows| W[Windows Platform]
  B -->|Linux| L[Linux Platform]
  B -->|macOS| M[macOS Platform]
  B -->|Other/Embedded| O[Other or Embedded]

  W --> W1[Configure MSVC flags / UTF-8 paths]
  W --> W2[Ensure runtime linkage consistency]
  W --> W3[Use Windows threading primitives]

  L --> L1[Check pthread support and add -pthread]
  L --> L2[Enable clone() for death tests]
  L --> L3[POSIX filesystem and regex]

  M --> M1[Check POSIX threading and filesystem]
  M --> M2[Adjust for iOS limitations]

  O --> O1[Minimal threading]
  O --> O2[Limited filesystem]
  O --> O3[Disable features like death tests]

  W1 --> End[Build and run]
  W2 --> End
  W3 --> End
  L1 --> End
  L2 --> End
  L3 --> End
  M1 --> End
  M2 --> End
  O1 --> End
  O2 --> End
  O3 --> End
```

---

> This page guides you through recognizing and resolving common platform-specific issues when working with GoogleTest and GoogleMock. By following the recommendations here, you can achieve a robust, cross-platform testing setup that maximizes GoogleTest's capabilities on Windows, Linux, and macOS.

---

## See Also

- [Supported Platforms](https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md)
- [Troubleshooting Setup](../../getting-started/first-steps-validation/troubleshooting-setup.md)
- [GoogleTest README](https://github.com/google/googletest/blob/main/googletest/README.md)
- [Portability & Platform Utilities API Reference](/api-reference/advanced-apis-config/portability-platform-utils)
- [Death Tests Guide](/guides/advanced-testing-patterns/death-test-guide)

---

<Tip>
Always monitor your platform detection macros (`GTEST_OS_*`, `GTEST_HAS_*`) to understand how GoogleTest configures itself for your build environment. Overriding these should be a last resort.
</Tip>

<Note>
For embedded or constrained platforms, some GoogleTest features like death tests and stream redirection may be unavailable. Design your tests accordingly.
</Note>