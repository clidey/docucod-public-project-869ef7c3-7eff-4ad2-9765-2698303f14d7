---
title: "How do I integrate GoogleTest with my C++ project?"
description: "Step-by-step guidance for adding GoogleTest to an existing or new C++ project. Explains key steps for CMake and Bazel users, import strategies, and how to structure your test files and build process."
---

# How do I integrate GoogleTest with my C++ project?

This page offers clear, actionable, step-by-step guidance for integrating GoogleTest into your existing or new C++ project. Whether you use CMake or Bazel as your build system, this guide helps you import GoogleTest correctly, structure your test files, and configure your build process to compile and run tests efficiently.

---

## 1. Getting Started with Basic Integration

Integrating GoogleTest lets you write and run tests that check your C++ code for correctness. The goal is to add GoogleTest as a dependency and set up your project so you can write tests easily and run them consistently.

### Why integrate GoogleTest properly?

- To reuse a widely supported, robust testing infrastructure.
- To leverage GoogleTest's features such as fixtures, assertions, parameterized tests.
- To enable test discovery, build performance, and maintainability.

---

## 2. Preparation: Organizing Your Tests

Before integration, organize your test code base:

- Place your test files in a dedicated directory, e.g., `tests/` or `test/`.
- Follow naming conventions (e.g., files named `foo_test.cc`).
- Structure tests around modules or components for clarity.

GoogleTest encourages keeping test suites logically grouped. Use proper naming in the `TEST()` or `TEST_F()` macros without underscores:

```cpp
TEST(MyComponentTest, HandlesEdgeCase) {
  ...
}

class MyFixture : public ::testing::Test { ... };
TEST_F(MyFixture, TestFeature) {
  ...
}
```

---

## 3. Integrating GoogleTest in CMake Projects

CMake users typically have two options: use an installed GoogleTest package or include GoogleTest source directly as a subdirectory.

### Option A: Using an Installed GoogleTest Package

1. Make sure GoogleTest is installed on your system (via package manager or built manually).
2. In your `CMakeLists.txt`, add:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test_executable test/foo_test.cc)
target_link_libraries(your_test_executable GTest::gtest_main)
add_test(NAME YourTest COMMAND your_test_executable)
```

Here you link against `gtest_main` so you don't write a separate `main()`.

### Option B: Incorporating GoogleTest Source Directly

1. Download or include GoogleTest's source in your project, e.g., as a `googletest/` folder.
2. In your `CMakeLists.txt`, add:

```cmake
add_subdirectory(googletest)

add_executable(your_test_executable test/foo_test.cc)
target_link_libraries(your_test_executable gtest_main)
add_test(NAME YourTest COMMAND your_test_executable)
```

This method guarantees compatibility as GoogleTest is built with your project's settings.

### Notes for CMake Integrations

- Use C++17 or later, as GoogleTest requires it.
- If you want to build only GoogleTest without GoogleMock, set `-DBUILD_GMOCK=OFF` when configuring.

---

## 4. Integrating GoogleTest with Bazel

For Bazel users, GoogleTest integration uses Bazel’s native support:

1. Add GoogleTest as an external dependency in your `WORKSPACE` file.
2. Declare targets and use Bazel’s `cc_test` rules to define tests.

Example snippet in `BUILD`:

```python
cc_test(
    name = "your_test",
    srcs = ["foo_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

- Bazel automatically handles compilation and linking.
- You can use the standard GoogleTest macros in your test code.

Refer to Bazel's official GoogleTest integration section for setup details.

---

## 5. Writing Your Test Files and Test Structure

- Test files include `#include <gtest/gtest.h>`.
- For simple tests, use `TEST(TestSuiteName, TestName)`.
- For tests requiring shared setup, use fixtures and `TEST_F(TestFixtureName, TestName)`.

Example:

```cpp
#include <gtest/gtest.h>

// Simple test
TEST(MathTest, FactorialOfZero) {
  EXPECT_EQ(Factorial(0), 1);
}

// Test fixture example
class QueueTest : public ::testing::Test {
 protected:
  void SetUp() override {
    // Setup code here
  }
};

TEST_F(QueueTest, EnqueueAddsElement) {
  queue.Enqueue(5);
  EXPECT_EQ(queue.size(), 1);
}
```

Remember to use the standard naming convention: test suites and test names should have no underscores.

---

## 6. Building and Running Tests

### Building

- For CMake:
  - Configure your project with GoogleTest dependency.
  - Build the test target.
- For Bazel:
  - Use `bazel test //path:your_test` to build and run.

### Running Tests

- Executables linked with `gtest_main` use the built-in `main()` that initializes GoogleTest:

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Usually, no custom main is needed.
- Use standard command-line flags to control test execution, e.g., `--gtest_filter`.

---

## 7. Import Strategies and Linking

- Link against `gtest` or `gtest_main` as your build system requires.
- Prefer linking `gtest_main` when you do not need a custom `main()`.
- For custom entry points, link only `gtest` and provide your own `main()`.

### Including Headers

Ensure your project includes GoogleTest headers by setting `include_directories()` or `target_include_directories()` in CMake or equivalent in Bazel.

---

## 8. Best Practices and Common Pitfalls

- Keep test code in a separate source folder from production code.
- Avoid underscores in test and suite names to prevent naming collisions.
- Always check the return value of `RUN_ALL_TESTS()` in your `main()`.
- Use test fixtures (`TEST_F`) for grouping related tests sharing setup.
- Use the built-in `gtest_main` library when possible to reduce boilerplate.
- Incrementally integrate GoogleTest and validate compilation and linking.

<Tip>
If you face link errors related to multiple `main()` definitions, verify you're not linking both `gtest_main` and defining your own `main()`.
</Tip>

---

## 9. Troubleshooting Integration Issues

### Common Issues

- **Build system cannot find GoogleTest:** Verify correct installation or source inclusion.
- **Linker errors for undefined GoogleTest symbols:** Confirm libraries are correctly linked.
- **Tests not running:** Ensure `RUN_ALL_TESTS()` is called and `InitGoogleTest()` is invoked before.
- **Underscore in test names causing errors:** Remove underscores as per GoogleTest naming rules.

For troubleshooting, consult the [Troubleshooting & Common Pitfalls](https://google.github.io/googletest/getting-started/first-test-usage/troubleshooting-setup) guide.

---

## 10. Further Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer) — Comprehensive tutorial for writing tests.
- [Integrating into CMake and Bazel Builds](https://google.github.io/googletest/guides/integration-examples-and-best-practices/integrating-into-cmake-bazel-builds) — Detailed integration examples.
- [Writing Your First Test](https://google.github.io/googletest/getting-started/first-test-usage/write-first-test) — Start writing tests once integrated.
- [GoogleTest Testing Reference](https://google.github.io/googletest/reference/testing) — Macro API reference.

---

For an example C++ project's minimal test integration with GoogleTest in CMake:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

# Add GoogleTest (optionally from local source or installed package)
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests
  test/foo_test.cc
  test/bar_test.cc
)

target_link_libraries(my_tests GTest::gtest_main)

enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

Then build and run:

```shell
mkdir build && cd build
cmake ..
cmake --build .
ctest
```

---

This approach maximizes compatibility, maintainability, and leverages GoogleTest's powerful features.


<Check>
Always call `InitGoogleTest()` before `RUN_ALL_TESTS()` to ensure the test framework is initialized correctly.
</Check>



