---
title: "How do I set up GoogleTest and GoogleMock?"
description: "Learn the essential steps to download, install, and integrate GoogleTest and GoogleMock into your C++ project. This page covers supported platforms, build systems (like CMake and Bazel), and first-compile tips."
---

# How do I set up GoogleTest and GoogleMock?

Learn the essential steps to download, install, and integrate GoogleTest and GoogleMock into your C++ project. This page covers supported platforms, build systems like CMake and Bazel, and tips for compiling your first tests.

---

## Overview

GoogleTest and GoogleMock form a powerful, integrated suite for writing C++ tests and mocks. GoogleMock extends GoogleTest by providing a declarative syntax for creating mock classes, supporting hybrid mocks, overloaded functions, and extensive matchers.

Setting up GoogleTest and GoogleMock involves obtaining the libraries, building them for your platform, and integrating them properly with your project's build system. This page guides you through these key steps with practical examples and best practices.

---

## Supported Platforms and Requirements

Before starting, ensure your development environment meets the following prerequisites:

- **C++17 support**: GoogleTest requires a compiler that supports at least C++17.
- **Operating Systems**: Linux, Windows, macOS, and popular BSD variants are supported.
- **Build tools**:
  - CMake (recommended version 3.14 or later)
  - Bazel (optional alternative)
- **Thread library support**: If your environment uses pthreads, GoogleTest will detect and use it for thread safety.

For details on supported compilers and system configurations, refer to the [Platform & Toolchain Support](https://github.com/google/googletest/blob/main/docs/overview/integration-and-ecosystem/platform-support.md).

---

## Downloading GoogleTest and GoogleMock

GoogleMock is distributed as part of the GoogleTest repository, so you only need to clone or download one repository.

```bash
# Clone the repository (using stable tag v1.17.0 as an example)
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
```

GoogleMock sources are located within this repo, so you can build and link both frameworks from the same source tree.

---

## Building with CMake

### Standalone Build

The simplest build flow uses CMake to configure and build GoogleTest and GoogleMock as standalone projects.

Steps:

<Steps>
  <Step title="Create build directory">
  ```bash
  mkdir build && cd build
  ```
  </Step>
  <Step title="Generate native build files">
  ```bash
  cmake ..
  ```
  This step includes GoogleMock by default.
  </Step>
  <Step title="Build the libraries">
  ```bash
  make
  ```
  On Windows, you can open the generated `.sln` file in Visual Studio and build from there.
  </Step>
  <Step title="Optional: Install libraries">
  ```bash
  sudo make install
  ```
  Installs GoogleTest and GoogleMock headers and libraries (usually under `/usr/local/`).
  </Step>
</Steps>

### Building Only GoogleTest

If you want only GoogleTest without GoogleMock, configure with:

```bash
cmake .. -DBUILD_GMOCK=OFF
make
```

### Integrating into Existing CMake Projects

You may prefer to integrate GoogleTest and GoogleMock into your own CMake project to build both simultaneously, ensuring consistent compiler settings.

Example:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# Prevents runtime library conflicts on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest gmock gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

Make sure your `CMakeLists.txt` includes `gtest` and `gmock` targets.

---

## Building with Bazel

If you prefer Bazel, GoogleTest and GoogleMock are designed for seamless Bazel integration.

You can add dependencies on `@com_google_googletest` and use the provided Bazel build files. See the `WORKSPACE` and `BUILD` files within the [`googletest`](https://github.com/google/googletest) repo for examples.

---

## Setting up the Test Main Function

GoogleTest provides default main functions to initialize the test framework and run tests.

- **gtest_main** provides a default `main()` entry point for GoogleTest.
- **gmock_main** builds on top of gtest_main to initialize both GoogleTest and GoogleMock.

For most cases, linking your test binary against `gmock_main` will suffice. This automatically initializes GoogleMock and GoogleTest before running tests.

Example main entry point (if you need custom main):

```cpp
#include "gmock/gmock.h"
#include "gtest/gtest.h"

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Notice `InitGoogleMock()` initializes both GoogleMock and GoogleTest.

On embedded platforms with Arduino-like runtimes (e.g., ESP8266, ESP32), the setup differs; GoogleTest provides special `setup()` and `loop()` functions to integrate with their execution model.

---

## Integrating GoogleMock in Tests

Once GoogleMock is built and linked, include the header:

```cpp
#include <gmock/gmock.h>
```

Then define mock classes using the `MOCK_METHOD` macro inside your test fixtures.

Example:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (int x), (const));
};

TEST(FooTest, UsesMock) {
  MockFoo mock;
  EXPECT_CALL(mock, Bar(5))
      .Times(1)
      .WillOnce(::testing::Return(10));

  ASSERT_EQ(mock.Bar(5), 10);
}
```

See the [Mocking Reference](../docs/reference/mocking.md) and the [Mocking Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for detailed usage patterns.

---

## First Compile Tips

- Make sure your build system is correctly pointing to GoogleTest and GoogleMock include directories.
- Link against the appropriate libraries: `gtest`, `gmock`, `gtest_main`, `gmock_main` as needed.
- Use consistent compiler settings (debug vs release, runtime linkage) between your project and GoogleTest to avoid linker issues.
- If you encounter runtime failures related to threading, verify that your environment supports pthread or equivalent.
- Run a minimal test first to verify setup:

```cpp
#include <gtest/gtest.h>

TEST(SimpleTest, Success) {
  EXPECT_EQ(1, 1);
}
```

Build and execute to confirm that testing infrastructure works correctly.

---

## Troubleshooting Common Setup Issues

<AccordionGroup title="Common Setup Issues"> 
<Accordion title="Linker Errors: Undefined References to GoogleTest/GoogleMock Symbols">
Ensure your linker includes `gmock` and `gtest` libraries.
Verify library paths and order; `gmock` generally requires `gtest` linked afterward.
Check that your build uses the matching build type (Debug vs Release) for library and test code.
</Accordion>

<Accordion title="Compiler Errors with MOCK_METHOD">
Make sure you compile with C++17 or newer. `MOCK_METHOD` requires full C++17 support.
Verify that all parentheses and commas in `MOCK_METHOD` argument lists are correctly matched.
Use parentheses around complex types with commas (e.g., `MOCK_METHOD((std::pair<int, int>), Foo, ());`).
</Accordion>

<Accordion title="Tests Not Running or Found">
Confirm you call `testing::InitGoogleMock()` or `testing::InitGoogleTest()` before `RUN_ALL_TESTS()`.
Ensure your test files are compiled and linked into the test executable.
Avoid underscore characters in test suite and test names; GoogleTest restricts them.
Check filters set via `--gtest_filter` do not exclude your tests unintentionally.
</Accordion>

<Accordion title="Build System Integration Problems">
Double-check include and library paths.
For CMake, prefer using `FetchContent` or `find_package` to add GoogleTest.
For Bazel, ensure dependencies are correctly defined in BUILD files.
Avoid mixing static and shared runtimes between GoogleTest and your test code.
</Accordion>
</AccordionGroup>

---

## Additional Resources

- [GoogleTest Primer](../docs/primer.md): Get started writing tests.
- [Mocking for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Learn mocking basics.
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Advanced mocking patterns.
- [Mocking Reference](../docs/reference/mocking.md): API details.
- [CMake Integration Guide](../getting_started/requirements_installation/installing_via_cmake.md)
- [Bazel Integration Guide](https://docs.bazel.build)

By following the steps in this page, you'll be equipped to build and run your first GoogleTest and GoogleMock test with confidence.

---

*Happy Testing!*