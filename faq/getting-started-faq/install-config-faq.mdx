---
title: "Installation and Configuration"
description: "Answers to frequently asked questions about installing GoogleTest and GoogleMock, supported compilers and platforms, and initial configuration steps. Includes guidance for resolving common setup issues."
---

# Installation and Configuration FAQ

This page provides detailed answers to common questions about installing GoogleTest and GoogleMock, supported compilers and platforms, initial configuration steps, and best practices to resolve common setup issues. Whether you're setting up a new project or troubleshooting build problems, this FAQ guides you through the essential workflows to get up and running quickly and reliably.

---

## 1. How do I install GoogleTest and GoogleMock on my system?

GoogleTest and GoogleMock are typically built and installed using CMake, which supports multiple platforms and compilers.

### Standalone Build Instructions:

1. Clone the repository (example uses version 1.17.0):

   ```bash
   git clone https://github.com/google/googletest.git -b v1.17.0
   cd googletest
   mkdir build
   cd build
   ```

2. Generate build files:

   - To build **both** GoogleTest and GoogleMock (default):

     ```bash
     cmake ..
     ```

   - To build **only GoogleTest** (without GoogleMock):

     ```bash
     cmake .. -DBUILD_GMOCK=OFF
     ```

3. Build the libraries:

   - On Unix-like systems (Linux/macOS), run:

     ```bash
     make
     sudo make install  # installs to /usr/local/ by default
     ```

   - On Windows with Visual Studio installed, open the generated `gtest.sln` file and build via Visual Studio IDE.

   - On macOS with Xcode, an `.xcodeproj` file will be created to use with Xcode.

### Incorporating GoogleTest into an Existing CMake Project:

- Use `find_package(GTest CONFIG REQUIRED)` to import installed libraries as `GTest::gtest` or `GTest::gmock`.
- Alternatively, add GoogleTest source as a subdirectory with `add_subdirectory()` for consistent compiler/linker settings.
- To automate downloading GoogleTest during your build configuration, use CMake's `FetchContent` module.

Example snippet for integrating GoogleTest into your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows runtime consistency
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example gtest_main)
add_test(NAME example_test COMMAND example)
```

> **Tip:** CMake 3.14 or newer is required to use `FetchContent_MakeAvailable()`.

---

## 2. What compilers and platforms does GoogleTest support?

- **Compilers:**
  - Must support at least C++17.
  - Commonly supported compilers include GCC, Clang, MSVC (Visual Studio 2015 or later).
- **Platforms:** Linux, Windows, macOS.

To ensure compatibility, add to your top-level CMakeLists:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

This globally enforces the C++ standard version.

---

## 3. How do I handle Visual Studio dynamic vs static runtime library conflicts?

Microsoft Visual Studio projects commonly link the C runtime dynamically by default, but GoogleTest uses static linking by default for runtimes. This mismatch can cause linker errors like:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

To align runtimes, enable the option `gtest_force_shared_crt` in CMake:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

This makes GoogleTest link the runtime dynamically, matching your Visual Studio project's default.

---

## 4. How do I configure GoogleTest and GoogleMock after installation?

### Setting Compiler Flags and Macros

GoogleTest can be customized via compiler macros defined on the command line. Some useful configuration flags include:

- Enforce pthread support if detection fails:

  ```bash
  -DGTEST_HAS_PTHREAD=1  # Enable
  -DGTEST_HAS_PTHREAD=0  # Disable
  ```

- Compile GoogleTest as a shared library (DLL) instead of static:

  ```bash
  -DGTEST_CREATE_SHARED_LIBRARY=1
  ```

- When linking tests against the shared GoogleTest library:

  ```bash
  -DGTEST_LINKED_AS_SHARED_LIBRARY=1
  ```

- Avoid macro name clashes with other libraries by prefixing GoogleTest macros:

  For example, to rename the `TEST` macro:

  ```bash
  -DGTEST_DONT_DEFINE_TEST=1
  ```

  You must then use `GTEST_TEST(SomeTest, TestName)` instead of `TEST(SomeTest, TestName)`.

### Multi-threaded Tests

GoogleTest is thread-safe on platforms that support pthreads. The `GTEST_IS_THREADSAFE` macro is defined to 1 if thread safety is enabled.

If the auto-detection fails, force it via `-DGTEST_HAS_PTHREAD=1`.

> **Note:** If you build outside CMake or autotools, you might need to add compiler and linker flags to link the pthread library explicitly (e.g., `-pthread` on Linux).

---

## 5. How do I initialize GoogleMock in my test applications?

Call `InitGoogleMock()` at the start of your test program before running tests. This function:

- Also initializes GoogleTest internally.
- Parses command-line flags specific to GoogleMock.
- Removes recognized flags from `argv`.

### Usage examples:

```c++
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For Windows UNICODE builds, use the wide-character overload:

```c++
int main(int argc, wchar_t** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For embedded or Arduino platforms without command-line args:

```c++
testing::InitGoogleMock();
```

This function also handles flags such as:

- `--gmock_catch_leaked_mocks`
- `--gmock_verbose`
- `--gmock_default_mock_behavior`

which control runtime behaviors and verbosity of GoogleMock.

---

## 6. What common issues arise during installation and how do I troubleshoot them?

### Build Failures

- Ensure **C++17 support** is enabled and your compiler version meets requirements.
- Verify `cmake` version is recent enough for the used features.
- If linking errors appear, check runtime library linkage consistency (especially on Windows).

### pkg-config Issues

If `pkg-config` cannot find GoogleTest after manual installation:

- Confirm you have set the `PKG_CONFIG_PATH` environment variable to include the directory where `.pc` files were installed, e.g.,

  ```bash
  export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
  ```

- For cross-compilation, also set `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` appropriately.

### Linking Errors Regarding pthread

- When building without CMake autogenerated flags, ensure to link against pthread explicitly (`-pthread`).

### Macro Name Conflicts

- If other libraries define macros like `TEST`, `ASSERT_EQ`, etc., consider using the `-DGTEST_DONT_DEFINE_<MACRO>=1` flags to rename GoogleTest macros.

---

## 7. Best practices for integrating GoogleTest and GoogleMock

- Use CMake’s FetchContent to automatically manage GoogleTest dependencies within your project.
- Align compiler and linker flags between your project and GoogleTest/GoogleMock to avoid compatibility issues.
- Prefer linking with pre-built libraries through `find_package()` where possible for simpler dependency management.
- Always call `InitGoogleMock()` or `InitGoogleTest()` early in your test binary’s `main()`.
- Use the provided `gtest_main` or `gmock_main` libraries when possible, which come with a default `main()` function.

---

## 8. Additional Resources

- [GoogleTest Installation Instructions](https://github.com/google/googletest/blob/main/googletest/README.md)
- [GoogleMock Overview & Setup](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [CMake FetchContent Usage Examples](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- [Pkg-config for GoogleTest](https://github.com/google/googletest/blob/main/docs/pkgconfig.md)

---

## Troubleshooting Quick Tips

<AccordionGroup title="Common Setup Issues and Solutions">
<Accordion title="Linker errors related to runtime mismatch on Visual Studio">
Use the CMake flag `-Dgtest_force_shared_crt=ON` to unify runtime linkage.
</Accordion>
<Accordion title="pthread not detected or linker errors on Linux">
Make sure to link tests with `-pthread` or use GoogleTest’s CMake configuration which handles this automatically.
</Accordion>
<Accordion title="`pkg-config` cannot find gtest_main.pc after installation">
Set the environment variable `PKG_CONFIG_PATH` to the directory containing the `.pc` files.
</Accordion>
<Accordion title="Macro name collisions with other libraries">
Use compiler definitions such as `-DGTEST_DONT_DEFINE_TEST=1` to rename GoogleTest macros and avoid conflicts.
</Accordion>
</AccordionGroup>

---

This FAQ provides the necessary steps to successfully install, configure, and resolve initial issues with GoogleTest and GoogleMock. By following the recommended workflows, you can ensure a stable and maintainable test environment.

For deep dives into writing tests and mocks, see the [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) and the [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html).
