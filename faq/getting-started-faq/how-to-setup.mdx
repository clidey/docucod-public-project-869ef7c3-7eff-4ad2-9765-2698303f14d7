---
title: "How do I install and set up GoogleTest/GoogleMock?"
description: "Step-by-step answers on downloading, building, and integrating the framework into your C++ projects. Examples are provided for different build systems (CMake, Bazel). This page addresses frequent installation stumbling blocks."
---

# How do I install and set up GoogleTest/GoogleMock?

This FAQ provides clear, step-by-step instructions to download, build, and integrate GoogleTest and GoogleMock into your C++ projects. Whether you use CMake or Bazel, or want to understand how to handle common installation pitfalls, this page guides you through each stage with practical examples and troubleshooting tips.

---

## 1. Downloading GoogleTest and GoogleMock

GoogleTest and GoogleMock are distributed together in the googletest GitHub repository. To get started:

```bash
# Clone the repository at a specific release tag for stability
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
```

This repository includes both GoogleTest and GoogleMock.

---

## 2. Building with CMake

GoogleTest and GoogleMock come with a ready-made CMake build system that supports various platforms and compilers.

### Standalone Build

1. Navigate to the cloned directory and create a build folder:

   ```bash
   mkdir build
   cd build
   ```

2. Generate build files. By default, this also builds GoogleMock:

   ```bash
   cmake ..
   ```

   To build only GoogleTest and skip GoogleMock:

   ```bash
   cmake .. -DBUILD_GMOCK=OFF
   ```

3. Build and install:

   - On Unix-like systems:
     ```bash
     make
     sudo make install
     ```

   - On Windows with Visual Studio, open the generated `gtest.sln` and build from the IDE.


### Integrating into Your Own CMake Project

You can either link against installed libraries or build GoogleTest/GoogleMock as part of your build.

**Example using FetchContent:**

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_tests tests.cpp)
target_link_libraries(my_tests gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

**Tips:**
- Use `gtest_main` or `gmock_main` to avoid writing your own main() function.
- Use at least C++17 standard to build successfully.

### Handling Visual Studio Runtime Issues

When mixing runtime libraries (dynamic vs static), enable `gtest_force_shared_crt` option in CMake to match your project's runtime linkage.

---

## 3. Building with Bazel

GoogleTest has official Bazel build support (not covered in this page's depth but noteworthy).

You can add GoogleTest/GMock as dependencies in Bazel WORKSPACE and BUILD files.

Refer to the [GoogleTest Bazel Integration](https://github.com/google/googletest/tree/main/googletest#bazel-support) documentation for detailed instructions.

---

## 4. Integrating GoogleMock in Your Tests

GoogleMock depends on GoogleTest and extends it with powerful mocking capabilities.

### Including Headers

In your test source file, include:

```cpp
#include <gmock/gmock.h>  // GoogleMock header, includes GoogleTest
```

### Linking

Link against `gmock` and `gmock_main` libraries to get GoogleMock features and default `main()`:

- When built as standalone, link with `-lgmock -lgmock_main`.
- When integrated via CMake FetchContent, link with `gmock` and `gmock_main` targets.

---

## 5. Writing Your Own main() Function (Optional)

Most users can link with `gtest_main` or `gmock_main` that provide a default `main()`. If you need custom setup, write your own `main()` as follows:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This initialization:

- Parses and removes GoogleMock/GoogleTest command-line flags.
- Initializes GoogleTest.
- Runs all registered tests and mocks.

For platforms like Arduino or embedded systems, initialization and test running may happen in functions like `setup()` and `loop()`, as shown in the source `gmock_main.cc`.

---

## 6. Common Installation and Setup Issues

### Problem: Build Fails Due to C++ Standard

**Cause:** Your compiler isn't set to at least C++17.

**Solution:** Add `-DCMAKE_CXX_STANDARD=17` and `-DCMAKE_CXX_STANDARD_REQUIRED=ON` to your CMake command or configure your build system appropriately.

### Problem: Linker Errors Due to Runtime Library Mismatch on Windows

**Cause:** Static vs dynamic runtime conflict between your project and GoogleTest/GMock.

**Solution:** Use the `gtest_force_shared_crt` CMake option to align runtimes:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

### Problem: Missing `main()` Entry Point

**Cause:** You linked against `gtest` or `gmock` instead of `gtest_main` or `gmock_main`.

**Solution:** Link with `gtest_main` or `gmock_main` if you want the default main function, or provide your own as shown above.

### Problem: Thread-Safety Issues or Missing pthread

**Cause:** Your system does not indicate pthread availability correctly.

**Solution:** Define the macro during compilation:

- To force enable pthread: `-DGTEST_HAS_PTHREAD=1`
- To disable pthread: `-DGTEST_HAS_PTHREAD=0`

Add appropriate linker flags (`-lpthread`) if required by your build environment.

### Problem: Flags Are Not Parsed or Recognized

Ensure you pass `argc` and `argv` properly to `InitGoogleMock()`. This allows the framework to parse its command-line flags and remove recognized flags to avoid conflicts.

---

## 7. Verifying Your Setup

After building and linking, run your test executable. You should see output similar to:

```
Running main() from gmock_main.cc
[==========] Running X tests from Y test suites.
...
[  PASSED  ] X tests.
```

If tests discover and run successfully, your setup is correct.

---

## 8. Additional Resources

- [GoogleTest README](https://github.com/google/googletest/blob/main/README.md) for detailed build instructions.
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md) for mocking framework specifics.
- [GoogleTest Primer](primer.md) for learning how to write tests.
- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for beginner-friendly mocking usage.
- [Troubleshooting Installation and Build Issues](https://github.com/google/googletest/blob/main/docs/getting-started/troubleshooting-faq/common-install-issues.mdx) for common setup problems.

---

<Tip>
Always ensure your environment supports C++17 and the compiler flags are correctly set prior to building.
Linking with `gmock_main` or `gtest_main` saves you from writing a main function for your tests.
</Tip>

<Warning>
Avoid mixing static and dynamic runtimes in your build; this is a common source of linker errors.
</Warning>

---

If you encounter unique build environments or embedded platforms, refer to specific platform integration guides or the source code comments in `gmock_main.cc` and `gtest_main.cc` for platform-specific entry points.

---

# End of FAQ
