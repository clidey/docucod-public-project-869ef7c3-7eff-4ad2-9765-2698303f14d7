---
title: "Why isn't my first test or mock running or compiling?"
description: "Quick troubleshooting checklist for common pitfalls when writing or running your first test, such as missing dependencies, incorrect includes, C++ version issues, or linking errors."
---

# Why isn't my first test or mock running or compiling?

When getting started with GoogleTest and GoogleMock, it's common to encounter issues that prevent your first test or mock from compiling or running correctly. This troubleshooting guide will help you identify and resolve common pitfalls, so your testing workflow gets up and running smoothly.

---

## 1. Verify Dependencies and Includes

- **Include the Correct Headers**
  - For GoogleTest, include:  
    ```cpp
    #include <gtest/gtest.h>
    ```
  - For GoogleMock features, include:  
    ```cpp
    #include <gmock/gmock.h>
    ```
  - Ensure that your include paths point to where GoogleTest and GoogleMock headers are located.

- **Use Proper Namespaces**
  - GoogleTest and GoogleMock symbols reside primarily in the `testing` namespace. You should access them with either:
    ```cpp
    using namespace testing;
    ```
    or by qualifying names explicitly,
    ```cpp
    testing::EXPECT_CALL(...);
    ```

## 2. Check Compiler and C++ Version

- **Minimum Required C++ Version**
  - GoogleTest and GoogleMock require C++11 or later. Many recent versions expect C++17.
  - Verify your compiler's C++ language standard setting (e.g., `-std=c++17` for GCC/Clang).

- **Supported Compilers**
  - Confirm your compiler version supports the needed features. Officially supported compilers include recent versions of GCC, Clang, and MSVC.

## 3. Ensure Proper Linking

- **Link Against GoogleTest and GoogleMock Libraries**
  - When building your tests, you must link against the GoogleTest and GoogleMock libraries.
  - For example, when using CMake:
    ```cmake
    target_link_libraries(your_test_target gmock gtest pthread)
    ```
  - If these libraries are missing in the linking stage, you will get linker errors.

- **Use Provided Main Functions**
  - GoogleTest provides `gtest_main` and GoogleMock provides `gmock_main` libraries which contain main functions.
  - Linking your test executable with one of these libraries automatically provides an entry point, simplifying test execution.

## 4. Validate Mock Definitions

- **Mock Methods Must Be Virtual**
  - To mock a method with GoogleMock, the method must be declared virtual in the base class unless you use advanced patterns (see [Mocking Non-virtual Methods](https://google.github.io/googletest/gmock_cook_book.html#MockingNonVirtualMethods)).

- **Correct Use of MOCK_METHOD Macro**
  - Use the `MOCK_METHOD` macro to declare mock methods as follows:
    ```cpp
    class MockFoo : public Foo {
     public:
      MOCK_METHOD(ReturnType, MethodName, (Args...), (Specifiers));
    };
    ```
  - Make sure `MOCK_METHOD`s are declared in the `public:` section of your mock class.
  - For example:
    ```cpp
    class MockTurtle : public Turtle {
     public:
      MOCK_METHOD(void, Forward, (int distance), (override));
      MOCK_METHOD(int, GetX, (), (const, override));
    };
    ```

- **Wrap Argument Types with Commas Carefully**
  - If argument or return types contain commas (e.g., templates), wrap them in parentheses or use type aliases.

## 5. Write Proper Test Functions and Register Tests

- **Define Tests Using GoogleTest Macros**
  - Each test should be declared with `TEST` or `TEST_F` macros:
    ```cpp
    TEST(TestSuiteName, TestName) {
      ...
    }
    ```

- **Declare Expectations Before Exercising Mocks**
  - Set expectations on mock objects upfront, before the code under test uses them.
  - Example:
    ```cpp
    MockFoo mock;
    EXPECT_CALL(mock, DoSomething());
    codeUnderTest(mock);
    ```

- **Initialize GoogleTest and GoogleMock**
  - Initialize the framework in your main function:
    ```cpp
    int main(int argc, char** argv) {
      ::testing::InitGoogleMock(&argc, argv);
      return RUN_ALL_TESTS();
    }
    ```
  - GoogleMock initialization also initializes GoogleTest.

## 6. Check for Common Compilation and Runtime Errors

- **Missing Virtual Destructors**
  - Base classes should have virtual destructors to avoid undefined behavior and heap checker failures.

- **Ambiguous or Overloaded Methods**
  - When mocking overloaded methods, mock all overloaded versions or bring base overloads into scope using `using` declarations.

- **Compiler Warnings and Errors in Mock Methods**
  - Some compilers warn if `const` parameters are declared oddly; remove unnecessary `const` in value parameters.

- **Linker Errors on Undefined Symbols**
  - If you get errors related to `MOCK_METHOD` implementations, check that you are not missing linking GoogleMock library or definitions.

## 7. Verify Environment Setup

- **Run Minimal Sample Tests**
  - To confirm setup, try a minimal test program with a simple mock and test to isolate environment/configuration issues.

- **Use Verbose Output to Debug**
  - Run tests with `--gmock_verbose=info` to get detailed tracing of mock calls, which can help diagnose unexpected behaviors.

---

## Example: Minimal Working Mock Test

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetValue() const = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
};

TEST(FooTest, ReturnsExpectedValue) {
  MockFoo mock_foo;
  EXPECT_CALL(mock_foo, GetValue())
      .WillOnce(testing::Return(42));

  EXPECT_EQ(mock_foo.GetValue(), 42);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Make sure you build and link it with GoogleTest and GoogleMock correctly.

---

## Additional Tips

- **Use Official Sample Code and Guides**
  - Refer to [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for a gentle introduction.

- **Control Mock Behavior Strictness**
  - Use `NiceMock`, `NaggyMock` or `StrictMock` wrappers to manage warnings/errors on uninteresting calls.

- **Leverage Mock Object Lifetime**
  - Ensure mocks are destructed to automatically verify expectations.

- **Keep Mocks in Public Section**
  - Always declare mock methods publicly, regardless of base class access levels.

- **Define Mock Methods with Qualifiers**
  - Match base class method qualifiers like `const`, `override`, `noexcept`, and reference qualifiers.

---

By following this checklist and best practices, you will resolve most issues interfering with your first GoogleTest and GoogleMock test executions.


---

## Useful References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mock Object Definition](https://google.github.io/googletest/api/gmock-reference.html#mock-object-definition)
- [Setting Expectations](https://google.github.io/googletest/api/gmock-reference.html#expectations-and-behavior-specification)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)

---

<Tip>
If you do not see tests running or compiling correctly, double-check your build and linking setup and ensure all dependencies are configured properly; issues in setup are the most common blockers.
</Tip>