---
title: "How do I write and run my first test or mock?"
description: "Step-by-step guidance for creating a basic unit test and mock using the framework's core features. Covers the required header inclusions, basic test/mocking syntax, and running your test executable. Includes tips for discovering and organizing test suites."
---

# How do I write and run my first test or mock?

Welcome to the exciting journey of writing your first unit test and mock using GoogleTest and GoogleMock! This guide walks you through creating a simple test, defining a mock class, setting expectations, and running your tests with confidence. By the end, you'll have a solid grasp of the basic workflow for validating your C++ code effectively.

---

## 1. Setting Up Your Test Environment

Before diving into code, make sure your project is configured to include GoogleTest and GoogleMock:

- Include the header `<gtest/gtest.h>` for basic test macros.
- Include `<gmock/gmock.h>` when using mocks.

Typically, your build should link against the GoogleTest and GoogleMock libraries.


## 2. Writing a Simple Unit Test

The fundamental building block of GoogleTest is the `TEST` macro which defines a test case.

### Basic Test Structure

```cpp
#include <gtest/gtest.h>

// Defines a test named "AdditionTest" with the test case "Simple".
TEST(AdditionTest, Simple) {
  int sum = 2 + 2;
  EXPECT_EQ(sum, 4);
}
```

- `test_suite_name` is traditionally a noun or a module name.
- `test_name` describes what aspect is tested.

### Running Your Tests

Compile your program and run the resulting binary. GoogleTest will automatically discover all tests and execute them.

If your test passes, you'll see an output summary indicating success. On failure, detailed messages including the file and line number will help you diagnose the issue.


## 3. Creating Your First Mock Class

In many cases, you want to isolate parts of your code for testing by mocking dependencies. GoogleMock simplifies this with an easy syntax to define mock classes.

### Defining an Interface to Mock

```cpp
class Widget {
 public:
  virtual ~Widget() {}
  virtual int GetValue() const = 0;
  virtual void SetValue(int) = 0;
};
```

### Writing the Mock Class

To mock `Widget`:

```cpp
#include <gmock/gmock.h>

class MockWidget : public Widget {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int), (override));
};
```

Explanation:
- Use `MOCK_METHOD(return_type, method_name, (args), (qualifiers))`.
- Include `(const)` if mocking a `const` method.
- Add `(override)` to ensure you are overriding a virtual function.


## 4. Using Mocks in Your Tests

Once you have a mock class, you can now write tests to specify expected behavior and verify interactions.

### Example: Testing Interaction with a Mock

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;

TEST(WidgetUserTest, GetsValueFromWidget) {
  MockWidget mock_widget;

  // Expect GetValue() to be called and return 5
  EXPECT_CALL(mock_widget, GetValue())
      .Times(1)
      .WillOnce(Return(5));

  int result = mock_widget.GetValue();

  // Verify the returned value
  EXPECT_EQ(result, 5);
}
```

### Key Concepts:
- `EXPECT_CALL(object, method(args))` sets an expectation.
- `.Times(n)` specifies how many times the method is expected to be called.
- `.WillOnce(action)` specifies the action to perform when the call happens, e.g., return a value.


## 5. Best Practices for your First Test and Mock

- **Define Virtual Destructors in Interfaces:** Always define a virtual destructor in your base interfaces to avoid undefined behavior when deleting derived mock objects.

- **Put MOCK_METHODs in `public:` Section:** Mock methods must be declared as public regardless of original access level to allow `EXPECT_CALL` access.

- **Set Expectations Before Use:** Call `EXPECT_CALL` before exercising the mock to ensure that violations are caught immediately.

- **Use Matchers for Arguments:** Use `_` (wildcard matcher) when you don't care about specific arguments.

- **Use `NiceMock` or `StrictMock` if Needed:** To alter the behavior for uninteresting calls (warnings or failures), see GoogleMock's documentation on mock strictness.


## 6. Running and Verifying Your Tests

- Compile your tests linking with GoogleTest and GoogleMock libraries.
- Run your test binary; GoogleTest will run all registered tests automatically.
- Failed expectations will produce detailed messages indicating the cause.

### Example Command (Linux, CMake-based)
```bash
mkdir build && cd build
cmake ..
make
./my_tests  # test executable
```


## 7. Organizing Your Test Suites

To maintain clarity as your project grows:

- Group related tests under the same test suite.
- Use descriptive test suite and test names.
- Write unit tests to cover a single behavior per test case.
- Place mock classes close to tests that use them or in shared `testing` directories.


## 8. Troubleshooting Tips

- **Test Not Running?** Ensure your test binary includes `InitGoogleMock(&argc, argv);` or `InitGoogleTest(&argc, argv);`.

- **Missing Mock Methods?** Check that the mocked functions are virtual and you have included `MOCK_METHOD` declarations correctly.

- **Unexpected Call Failures?** Ensure expectations are set *before* the calls occur.

- **Linker Errors?** Verify your build includes Google's testing libraries for gtest and gmock.


## 9. Next Steps and Further Learning

- Explore the [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) for advanced mocking techniques.
- Learn to use argument matchers and specify call sequences.
- Dive into [Using Mocks Correctly](../guides/core-workflows/using-mocks-correctly) to master best practices for mocks in larger test suites.
- Check out the [GoogleTest Primer](../overview/product-intro/what-is-googletest) for foundational test writing guidance.

---

## References

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](../api-reference/mocking-and-stubbing/defining-mocks)
- [Using Mocks Correctly Guide](../guides/core-workflows/using-mocks-correctly)
- [Your First Test: Quick Success](../getting-started/core-setup/first-test)
- [Supported Platforms & Build Systems](../overview/integration-ecosystem/supported-platforms)

---

By following this tutorial, you will jumpstart your testing workflow and prepare to harness the full power of GoogleTest and GoogleMock in your C++ projects.