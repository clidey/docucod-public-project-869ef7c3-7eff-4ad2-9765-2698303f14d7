---
title: "Understanding Assertions and Mock Behaviors"
description: "Clarifies the differences between GoogleTest assertions and GoogleMock expectations and the proper usage of various macros, including how to interpret assertion output and debug mismatches between expected and actual results."
---

# Understanding Assertions and Mock Behaviors

This page clarifies the differences between GoogleTest assertions and GoogleMock expectations. It explains how to properly use various GoogleMock macros, how to interpret assertion and expectation output messages, and strategies to diagnose and debug mismatches between expected and actual mock interactions.

---

## 1. Key Differences Between Assertions and Mock Expectations

- **Assertions (GoogleTest)** verify correctness of values or states within your tests, such as `EXPECT_EQ`, `ASSERT_TRUE`, and `EXPECT_THAT`. They check test logic outcomes.
- **Expectations (GoogleMock)** specify how mock methods should be called — their arguments, call counts, order, and behaviors.

Understanding these scopes helps in writing clear and effective tests.

<Callout>
**Tip:** Use GoogleTest assertions to validate the result of your code under test and GoogleMock expectations to verify that your code interacts correctly with its dependencies.
</Callout>

## 2. Using Core GoogleMock Macros

### MOCK_METHOD
Define mock methods inside mock classes. Use this in the `public:` section.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, Process, (int x, std::string y), (override));
};
```

> Wrapping types with commas (e.g., `std::pair<int, int>`) inside parentheses or using type aliases avoids syntactic issues.

### EXPECT_CALL
Set an expectation on a mock method call, specifying matchers, call cardinality, ordering, and behavior.

```cpp
EXPECT_CALL(mock_obj, MethodName(matchers...))
    .Times(cardinality)
    .InSequence(seq)
    .After(other_expectations)
    .WillOnce(action)
    .WillRepeatedly(action);
```

Key points:
- Must be declared *before* exercising mocks.
- Later expectations override earlier ones.
- Unmatched calls cause failures.

### ON_CALL
Specify default behavior without expectation on call count.

```cpp
ON_CALL(mock_obj, MethodName(matchers...))
    .WillByDefault(action);
```

Useful for common default behaviors shared across tests.

## 3. Reading Expectation Output Messages

When GoogleMock reports assertion failures, understanding the message is crucial:

- **Uninteresting Calls:** Calls to mock methods with *no* expectations. Usually prints a **warning**.
- **Unexpected Calls:** Calls that do not match *any* active expectations. Always treated as **errors**.
- **Excessive Calls:** Calls exceeding the specified call count, produce errors.
- **Unsatisfied Expectations:** Expected calls that did not happen.

Example message when a call doesn't match any expectation:

```
Unexpected mock function call - returning default value.
    Function call: Foo(5)
Google Mock tried the following expectations, but none matched:
  Expected arg #0: is equal to 3
           Actual: 5
```

This tells you which expectation was checked and why it failed.

## 4. Controlling Verbosity of Mock Call Logs

GoogleMock's verbosity can be controlled via the `--gmock_verbose=LEVEL` flag or programmatically with `GMOCK_FLAG_SET(verbose, LEVEL)`. Levels are:

| Level   | Description                                   |
|---------|-----------------------------------------------|
| `info`  | Prints all messages, including stack traces. | 
| `warning` | Prints warnings/errors without stack traces. (Default) |
| `error` | Prints only errors (quietest).                 |

Using `info` during test debugging helps trace calls and expectation matches effectively.

## 5. Understanding Uninteresting, Unexpected, and Excessive Calls

- **Uninteresting Calls:** No matching `EXPECT_CALL`. Actions from `ON_CALL` or default return values are executed. Warning issued by default unless `NiceMock` or `StrictMock` alters behavior.
- **Unexpected Calls:** A call matches no expectation even though ones exist for that method. Always error.
- **Excessive Calls:** Call count exceeds the declared cardinality; always error.

### Strictness Wrappers

Mock behavior regarding uninteresting calls can be adjusted:

- `NiceMock<T>`: Suppresses warnings for uninteresting calls.
- `NaggyMock<T>` (default): Warns on uninteresting calls.
- `StrictMock<T>`: Treats uninteresting calls as test failures.

These wrappers subclass your mock class and preserve constructors.

## 6. Best Practices for Using `EXPECT_CALL` and `ON_CALL`

- Use `ON_CALL()` to specify default mock behaviors without enforcing the call.
- Use `EXPECT_CALL()` to specify which calls *must* happen and their expected behavior.
- Avoid excessive `EXPECT_CALL()`s; overly strict tests break easily on refactoring.
- Use wildcard matcher `_` to catch uninteresting calls if you want to silence warnings.
- Explicitly mark disallowed calls via `.Times(0)`.
- Always place `EXPECT_CALL()` statements before exercising the mocks.

## 7. Diagnosing Common Mocking Errors

<AccordionGroup title="Common Assertion Failures with GoogleMock">
<Accordion title="Unsatisfied Expectations">
- Happens when expected calls are not executed the required number of times.
- Check that your test actually triggers the expected calls.
- Use `--gmock_verbose=info` to trace expectation matching.
</Accordion>
<Accordion title="Unexpected Calls">
- Occurs when a call doesn't match any active expectation.
- Look for argument mismatches or missing `EXPECT_CALL`.
- Adding a catch-all expectation with `.Times(AnyNumber())` can help.
</Accordion>
<Accordion title="Excessive Calls">
- More calls have been made than specified by `.Times()`.
- Use `.RetiresOnSaturation()` to deactivate expectation after saturation.
</Accordion>
<Accordion title="Uninteresting Call Warnings">
- Default for mock methods with no expectations called unexpectedly.
- Suppress with `NiceMock` or add `.Times(AnyNumber())` expectations.
- Check you don’t have mistaken or missing `EXPECT_CALL`s.
</Accordion>
</AccordionGroup>

## 8. Example: Setting Expectations and Default Actions

```cpp
using ::testing::Return;
using ::testing::_;
using ::testing::NiceMock;

class MockFoo {
 public:
  MOCK_METHOD(int, Calculate, (int x), ());
};

TEST(CalcTest, Example) {
  NiceMock<MockFoo> mock;

  // Default return value for all calls matching the pattern.
  ON_CALL(mock, Calculate(_))
      .WillByDefault(Return(-1));

  // Expect Calculate(5) to be called exactly twice and return 10 and 12 in order.
  EXPECT_CALL(mock, Calculate(5))
      .WillOnce(Return(10))
      .WillOnce(Return(12));

  EXPECT_EQ(10, mock.Calculate(5));
  EXPECT_EQ(12, mock.Calculate(5));
  EXPECT_EQ(-1, mock.Calculate(3));  // Uses the ON_CALL default
}
```

## 9. Interpreting Mock Output: Typical Scenarios

- **Call Matches Expectation:** Usually silent unless verbosity is `info`.
- **Unexpected Call:** Prints a failure with details of tried expectations.
- **Too Few Calls:** Prints failure on mock destruction with count summary.
- **Too Many Calls:** Prints failure immediately on extra call.

## 10. Troubleshooting Mismatch Between Expected and Actual Calls

- Use `--gmock_verbose=info` to trace exact matching and call sequences.
- Check argument types and matcher correctness.
- Confirm matchers are pure functions without side effects.
- Verify ordering constraints like `.InSequence` or `.After`.
- If overloading is involved, use `Const()` or explicit matchers to disambiguate.

## 11. Glossary of Key Terms

| Term              | Meaning |
|-------------------|---------|
| Expectation       | A requirement set with `EXPECT_CALL` specifying how mocks should be called.
| Matcher           | A predicate that checks argument values in mock method calls.
| Cardinality       | Specifies call count expectations (e.g., `Times(1)`, `AtLeast(2)`).
| Action            | What mock method does when called (e.g., `Return(value)`).
| Uninteresting Call| Call to a mock method with no expectations set.
| Unexpected Call   | Call to a mock method with expectations but arguments don't match.

## 12. Helpful Links and Further Reading

- [GoogleMock Cheatsheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — quick overview of mocking macros and idioms.
- [Mocking Reference (docs/reference/mocking.md)](https://google.github.io/googletest/reference/mocking.md) — detailed API and examples.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — tutorial for beginners.
- [Advanced Mocking Patterns](https://google.github.io/googletest/gmock_cook_book.html) — recipes and idioms for complex scenarios.
- Related documentation:
  - [Basic Configuration](../getting-started/initial-configuration-validation/basic-configuration.md)
  - [Writing Your First Test](../getting-started/initial-configuration-validation/writing-first-test.md)
  - [Understanding Test Discovery and Execution](../googletest-guides/getting-started/navigating-the-framework.md)

---