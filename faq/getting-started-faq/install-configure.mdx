---
title: "How do I install and configure GoogleTest/GoogleMock?"
description: "Step-by-step answers on how to acquire, build, and set up GoogleTest and GoogleMock in your projects, covering common methods (CMake, Bazel, manual) and platform-specific considerations."
---

# How do I install and configure GoogleTest/GoogleMock?

This guide provides clear, step-by-step instructions on acquiring, building, and configuring GoogleTest and GoogleMock for your C++ projects. Whether you use CMake, Bazel, or manual build methods, or need platform-specific guidance, this FAQ helps you smoothly integrate these testing frameworks into your workflow.

---

## 1. Acquiring GoogleTest and GoogleMock

Both GoogleTest and GoogleMock are hosted in the same repository:

```bash
https://github.com/google/googletest
```

They are distributed together, so when you clone or download GoogleTest, you get GoogleMock included.

---

## 2. Installation Methods

### 2.1 Using CMake (Recommended)

GoogleTest provides native CMake support, simplifying builds across platforms.

#### Standalone Build

**Typical workflow:**

```bash
git clone https://github.com/google/googletest.git -b main
git checkout main
cd googletest
mkdir build
cd build
cmake ..
```

- To build **GoogleTest + GoogleMock** together, use the above commands.

- To build **only GoogleTest**, disable GoogleMock explicitly:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

#### Building and Installing

- On Linux/macOS:

```bash
make
sudo make install
```

- On Windows with Visual Studio:

- CMake generates `.sln` files, which can be opened and built in Visual Studio.

- On macOS with Xcode:

- An `.xcodeproj` file will be created to open in Xcode.

#### Incorporating Into Your Existing CMake Project

You have two main options:

- **Find the installed package:**

```cmake
find_package(GTest CONFIG REQUIRED)
target_link_libraries(my_test_target GTest::gtest GTest::gmock)
```

- **Build GoogleTest as part of your project:** Utilize CMake's FetchContent:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows runtime
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main gmock_main)
add_test(NAME MyTest COMMAND my_test)
```

> **Tip:** Setting `gtest_force_shared_crt` ON matches the runtime library to your project on Windows, avoiding common linker errors.

#### Compiler Requirements

- GoogleTest requires a compiler with C++17 support.
- You can specify C++17 in your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

---

### 2.2 Using Bazel

- GoogleTest supports Bazel builds out-of-the-box.
- You can include it as a dependency in your Bazel workspace.

Refer to [Integration & Ecosystem](https://github.com/google/googletest/tree/main) for Bazel-specific examples.

---

### 2.3 Manual Download and Build

Alternatively, you can:

- Download sources manually from the GitHub releases.
- Add the source files to your project.
- Link against static or shared libraries built from GoogleTest/GoogleMock.

This approach is less flexible and more prone to integration issues, so it is not generally recommended.

---

## 3. Setting Up Your Test Environment

### Including Headers

In your test source files, include the following:

```cpp
#include <gtest/gtest.h>   // For GoogleTest
#include <gmock/gmock.h>   // For GoogleMock
```

### Linking Libraries

Link against the correct libraries depending on how you built/installed GoogleTest:

- `gtest` and `gtest_main` for GoogleTest core
- `gmock` and `gmock_main` for GoogleMock

If using CMake's imported targets, link directly with `GTest::gtest_main` and `GTest::gmock_main`.

---

## 4. Using Provided Main Functions

GoogleTest and GoogleMock provide ready-made `main()` implementations, reducing boilerplate.

- **GoogleTest main():** Link with `gtest_main` to use `gtest/src/gtest_main.cc`, which calls `testing::InitGoogleTest()` and `RUN_ALL_TESTS()`.

- **GoogleMock main():** Link with `gmock_main` to use `googlemock/src/gmock_main.cc`, which calls `testing::InitGoogleMock()` (also initializes GoogleTest) and runs tests.

If you do not want to write your own `main()`, link with these libraries for instant test executables.

---

## 5. Platform-Specific Notes

### Windows

- By default, Visual Studio projects link C++ runtimes dynamically but GoogleTest uses static linking.
- Use the `gtest_force_shared_crt` CMake option to link dynamically and avoid runtime conflicts.

### Embedded / Arduino / IoT Devices

- GoogleTest and GoogleMock support Arduino-like platforms with custom entrypoints `setup()` and `loop()` instead of `main()`.
- In such cases, the initialization calls differ and are handled internally by provided main sources.

Refer to the source files `gtest_main.cc` and `gmock_main.cc` for platform-specific entrypoints.

---

## 6. Common Pitfalls and How to Avoid Them

### Mismatched Build Settings

- Ensure your project and GoogleTest/GoogleMock use the same compiler settings, especially runtime library linkage and debug/release variants.
- Mixing static and dynamic runtimes leads to linking errors or runtime crashes.

### C++ Standard Compatibility

- Always compile both your code and GoogleTest with at least C++17 support.
- Setting `CMAKE_CXX_STANDARD` properly resolves this.

### Namespace Issues

- Include `gtest/gtest.h` and `gmock/gmock.h` in your test files.
- Avoid defining macros that conflict with GoogleTest, or use the `-DGTEST_DONT_DEFINE_*` flags to rename assertion macros if conflicts occur.

---

## 7. Verifying Your Installation

- After building and linking, write a minimal test:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Build and run this test to confirm setup correctness.

- For mocks, include `gmock/gmock.h` and verify mock method declarations and basic expectations.

---

## 8. Additional Configuration Options

### Tweaking GoogleTest behavior with macros

Control GoogleTest features by defining macros such as:

- `GTEST_HAS_PTHREAD` - force-enable or disable pthread support.
- `GTEST_CREATE_SHARED_LIBRARY` - build gtest as shared library.
- `GTEST_LINKED_AS_SHARED_LIBRARY` - compile test code with shared gtest.

These are set in your compiler flags or CMake configuration.

### Suppressing Macro Name Clashes

If you encounter macro conflicts, you can suppress specific macro definitions:

```bash
-DGTEST_DONT_DEFINE_TEST=1
```

and call GoogleTest macros with the `GTEST_` prefix, e.g., `GTEST_TEST()`.

---

## 9. Getting Help and Next Steps

- Consult the [GoogleTest Primer](../guides/getting-started/primer.md) to learn how to write tests.
- Use the [Mocking Guide](../guides/core-testing-workflows/mocking-and-expectations.md) to start creating mock objects.
- Visit [Troubleshooting Common Setup Issues](../getting-started/running-first-test/troubleshooting-setup.md) for help on build problems.
- Explore build system integration examples in [Integrating with Build Systems & Platforms](../guides/real-world-patterns/integrating-with-build-systems.md).

---

## 10. References

- [GoogleTest README on GitHub](https://github.com/google/googletest/blob/main/README.md)
- [CMake Build Instructions](https://github.com/google/googletest/blob/main/README.md#build-with-cmake)
- [GoogleMock README](https://github.com/google/googletest/tree/main/googlemock/README.md)
- [GoogleTest Main Source (`gtest_main.cc`)](https://github.com/google/googletest/blob/main/googletest/src/gtest_main.cc)
- [GoogleMock Main Source (`gmock_main.cc`)](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc)

---

This documentation ensures you have everything needed to acquire, build, and integrate GoogleTest and GoogleMock efficiently and reliably.


---

<Check>
Always check that your test executable links to the appropriate `main()` implementation (`gtest_main` or `gmock_main`) to avoid missing entry point errors.
</Check>

<Tip>
Use CMake's `FetchContent` to effortlessly include GoogleTest as a dependency in your projects, ensuring compatibility and keeping your dependencies up to date.
</Tip>

<Warning>
Do not mix incompatible compiler/run-time settings between your project and GoogleTest/GoogleMock - this will cause build and runtime failures.
</Warning>
