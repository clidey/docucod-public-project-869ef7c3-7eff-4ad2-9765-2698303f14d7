---
title: "Assertions, Matchers, and Mocking Basics"
description: "Addresses frequent questions on writing assertions, using matchers, and the basics of mocking with GoogleMock—including when and how to use mocks in your projects."
---

# Assertions, Matchers, and Mocking Basics

This FAQ page addresses frequent questions on writing assertions, using matchers, and covers the basics of mocking with GoogleMock—including when and how to use mocks effectively in your projects.

---

## Frequently Asked Questions

### What are assertions in GoogleTest and how do I write them?

Assertions are the primary means to verify conditions within your tests. They come in two flavors:

- **EXPECT_ assertions**: Generate nonfatal failures and allow test execution to continue.
- **ASSERT_ assertions**: Generate fatal failures and abort the current function.

Common assertions include `EXPECT_EQ`, `EXPECT_TRUE`, `EXPECT_FALSE`, `EXPECT_THAT` (for matchers), and `EXPECT_DEATH` (for death tests).

Example:

```cpp
TEST(MyTestSuite, SampleTest) {
  EXPECT_EQ(42, ComputeAnswer());  // Test that `ComputeAnswer()` returns 42
  ASSERT_TRUE(IsValid());         // If false, aborts the test function immediately
}
```

### How do I use GoogleMock's matchers in assertions?

Matchers allow you to specify more expressive and flexible conditions on arguments passed to mocked methods or on expectations.

The `EXPECT_THAT(value, matcher)` assertion verifies that the `value` satisfies the `matcher` condition.

Example:

```cpp
using ::testing::HasSubstr;
using ::testing::MatchesRegex;

EXPECT_THAT(my_string, HasSubstr("needle"));
EXPECT_THAT(code_output, MatchesRegex("\\w*\\d+"));
```

GoogleMock provides a broad library of built-in matchers, including:

- Wildcard `_` matcher that matches any value
- Comparison matchers like `Eq()`, `Ge()`, `Lt()`, etc.
- Container matchers like `ElementsAre()`, `UnorderedElementsAre()`, `Pointee()`, and `Pair()`
- String matchers such as `StartsWith()`, `EndsWith()`, `HasSubstr()`

You can combine matchers logically using `AllOf()`, `AnyOf()`, and negate with `Not()`.

### When should I use ON_CALL vs EXPECT_CALL with mocks?

- **ON_CALL** sets the default behavior of a mock method but does **not** establish an expectation that the method will be called.
  It is useful to provide behavior for calls your tests are not explicitly verifying.

- **EXPECT_CALL** both sets an expectation (verifies the method is called with specified arguments, number of calls, and order) and allows you to specify the action.

Best practice is to use `ON_CALL` to configure standard behavior shared by all tests, and `EXPECT_CALL` sparingly to specify and verify meaningful expectations in individual tests.

Example:

```cpp
ON_CALL(mock_obj, Foo(_)).WillByDefault(Return(42));  // Default action
EXPECTED_CALL(mock_obj, Foo(5)).Times(1).WillOnce(Return(100));  // Expect call
```

### How do I define a mock method?

Use the `MOCK_METHOD` macro inside a mock class to define mocked virtual methods. The syntax is:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- `ReturnType`: The return type of the method.
- `MethodName`: Name of the mocked method.
- `Args...`: Argument list in parentheses.
- `Specs...`: Optional qualifiers like `const`, `override`, `noexcept`.

Example:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

If argument or return types contain commas, you may need to wrap them in extra parentheses or use type aliases to help the macro parse correctly.

### How do I set expectations on mock methods?

Use `EXPECT_CALL()` followed by optional clauses:

```cpp
EXPECT_CALL(mock_obj, Method(matchers...))
    .With(multi_arg_matcher)
    .Times(cardinality)
    .InSequence(seq1, seq2,...)
    .After(expectation1,...)
    .WillOnce(action)
    .WillRepeatedly(action)
    .RetiresOnSaturation();
```

- **Matchers** specify argument matching.
- **With()** applies a matcher on the whole argument tuple.
- **Times()** specifies how many times the call is expected.
- **InSequence()** and **After()** control call order.
- **WillOnce()** and **WillRepeatedly()** specify return actions or side effects.
- **RetiresOnSaturation()** deactivates the expectation after saturation.

Example:

```cpp
using ::testing::AtLeast;
EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
EXPECT_CALL(turtle, GetX()).WillOnce(Return(100)).WillRepeatedly(Return(200));
```

### What are matchers and how can I create my own?

Matchers are predicates used to determine whether a value satisfies a condition.

You can create simple custom matchers using the `MATCHER` and `MATCHER_P` macros:

```cpp
MATCHER(IsEven, "Checks if a number is even") { return (arg % 2) == 0; }

EXPECT_CALL(mock, Foo(IsEven()));
```

For parameterized matchers, use `MATCHER_P` with a parameter:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "") { return arg % divisor == 0; }

EXPECT_CALL(mock, Foo(IsDivisibleBy(3)));
```

Custom matchers help produce meaningful error messages and improve test readability.

### How do I verify that a mock object's expectations have been met?

gMock automatically verifies expectations when mock objects are destructed, producing failures if any are unmet or violated.

If your mock object is heap-allocated or managed externally, use:

```cpp
::testing::Mock::VerifyAndClearExpectations(mock_ptr);
```

to force verification manually.

Never set new expectations after calling this function for the same mock.

### What are NiceMock, NaggyMock, and StrictMock, and when should I use them?

These decorators control the behavior of mock objects regarding **uninteresting calls** (calls to mock methods without explicit expectations):

- **NiceMock<T>**: Suppresses warnings for uninteresting calls.
- **NaggyMock<T>** (default): Prints warnings on uninteresting calls.
- **StrictMock<T>**: Treats uninteresting calls as test failures.

Choose **NiceMock** when you want quiet logs and don't care about unspecified calls.
Choose **StrictMock** to catch any unexpected calls strictly.

Example:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

### How do I control the order of expected mock calls?

Use **sequences** and the `InSequence` helper:

```cpp
using ::testing::InSequence;
{
  InSequence seq;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

All expectations declared inside the `InSequence` scope must be satisfied in order.

For more complex partial orders, combine `InSequence` with `After()` clauses on expectations.

### How can I set default/mock behaviors without strict expectations?

Use `ON_CALL()` to specify default behavior of mock methods without verifying invocation counts.

```cpp
ON_CALL(mock, Foo(_)).WillByDefault(Return(42));
```

`EXPECT_CALL()` takes precedence when present and sets verified expectations.

### What are actions and how do I use them?

Actions specify what a mock method should do when invoked. Common built-in actions include:

- `Return(value)` — return a value
- `ReturnRef(variable)` — return a reference
- `Invoke(function_or_lambda)` — call a function
- `SetArgPointee<N>(value)` — set the pointed-to value of the N-th argument
- `DoAll()` — perform multiple actions in sequence

Example:

```cpp
EXPECT_CALL(mock, GetValue()).WillOnce(Return(42));
EXPECT_CALL(mock, Mutate(_)).WillOnce(SetArgPointee<0>(5));
```

### How do I deal with move-only types when mocking?

GoogleMock supports move-only arguments and return types (e.g., `std::unique_ptr`). Use the normal `MOCK_METHOD` macro. When specifying return actions for move-only types, lambdas or `WillOnce()` returning newly created objects are recommended over `Return(std::move(...))`.

Example:

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
...
EXPECT_CALL(mock, MakeBuzz(_))
    .WillRepeatedly([](StringPiece) { return std::make_unique<Buzz>(...); });
```

### How do I test private or protected class methods?

- You can mock protected methods by defining mock methods as `public` in a derived mock class.
- To access private members, declare your test fixture or individual tests as `friend` in the class.

### Can I mock non-virtual methods?

You can mock non-virtual methods using a separate mock class with the same method signatures, and specialize your production code to depend on the mock class template or via interfaces.

### How to write death tests involving mocks?

Death tests verify that a piece of code exits or aborts as expected. Use macros like `EXPECT_DEATH(statement, matcher)` to assert death with specified stderr output.

Note when your death test includes mocks and expects specific exit codes, use `Mock::AllowLeak(mock_object)` to avoid false-positive leak detections.

### How to get detailed output on mock calls and failures?

Run your tests with the flag `--gmock_verbose=info` to see detailed logs of mock expectations, calls, and stack traces to aid debugging.


## Common Pitfalls & Best Practices

- Always call `EXPECT_CALL` before exercising mocks to set expectations.
- Don't overly constrain `EXPECT_CALL` with strict argument matchers unless needed.
- Use `_` matcher to ignore arguments when they are unimportant.
- Avoid setting expectations after the mock has been used or verified.
- Use `RetiresOnSaturation()` to deactivate saturated expectations to avoid unexpected call errors.
- Use `NiceMock` or `NaggyMock` appropriately to control verbosity of warnings on unexpected calls.
- For complex call sequences, use sequences (`InSequence`) or `After()` clause for precise call ordering.

## Troubleshooting

### Why am I seeing "Uninteresting mock function call" warnings?

This warning means a mock method was called without a matching `EXPECT_CALL`. To remedy:

- Add an explicit `EXPECT_CALL(...).Times(AnyNumber())` for calls you want to ignore.
- Use a `NiceMock` to suppress such warnings globally.

### My test is failing because an expected call was not made. What now?

- Check your call arguments; they must match the specified matchers exactly.
- Verify call order if sequences or `After()` are used.
- If expectations use cardinalities like `Times(2)`, ensure the method is called that many times.

### My mock returns the wrong value or default value unexpectedly.

- Make sure you specify a `WillOnce()`, `WillRepeatedly()`, or `ON_CALL()` with `.WillByDefault()` for your mock methods.
- Remember `EXPECT_CALL` can override default `ON_CALL` behavior.

### How to avoid compilation errors when mocking methods with complex arguments?

- Wrap argument or return types that contain commas in extra parentheses in `MOCK_METHOD`.
- Alternatively, define type aliases for complicated types and use those in `MOCK_METHOD`.

### Why are multiple expectations for the same method matching unexpectedly?

gMock matches the newest matching expectation first. Write more specific `EXPECT_CALL`s after more general ones.


## Related Documentation

- [GoogleTest Assertions Reference](reference/assertions.md) — Full list of assertions.
- [GoogleMock Matchers Reference](reference/matchers.md) — Comprehensive matcher library.
- [GoogleMock Mocking Reference](reference/mocking.md) — Mocking APIs and macros.
- [gMock for Dummies](gmock_for_dummies.md) — Beginner friendly guide to mocking.
- [gMock Cookbook](gmock_cook_book.md) — Advanced mocking recipes and best practices.
- [GoogleTest Advanced Topics](advanced.md) — For complex assertion and test control.

---

<Tip>
Consider placing common mock setup code and default `ON_CALL` behaviors in your test fixtures' `SetUp()` methods, and reserve `EXPECT_CALL` for method calls whose occurence you need to verify explicitly.
</Tip>

<Note>
Always align your mock strictness policy (`NiceMock`, `NaggyMock`, or `StrictMock`) with your testing goals: stricter mocks catch more unexpected calls but might increase test maintenance overhead.
</Note>

<Warning>
Do not attempt to mock destructors directly with `MOCK_METHOD`; instead, mock a `Die()` function called from the destructor to check object lifetime behavior.
</Warning>

---

For detailed tutorials and examples, visit the [GoogleMock GitHub page](https://github.com/google/googletest/tree/main/googlemock) and explore the sample tests provided with the framework.

---