---
title: "Test Discovery and Organization"
description: "Explains how GoogleTest discovers and organizes tests, common reasons why tests may not be detected, and best practices for structuring test files and suites."
---

# Test Discovery and Organization FAQ

This documentation explains how GoogleTest discovers and organizes tests within your test binaries. It addresses common reasons why your tests might not be detected, offers best practices for structuring test files and suites, and guides you on effectively using GoogleTest’s filtering and naming conventions.

---

## 1. How does GoogleTest discover tests?

GoogleTest discovers tests automatically at runtime by registering all tests defined via the `TEST()`, `TEST_F()`, `TEST_P()`, and `TYPED_TEST()` macros or by manual registration through the `RegisterTest()` API. When `RUN_ALL_TESTS()` is called, the framework scans this registration list and executes the tests that meet user-selection criteria such as filters.

**Key points:**
- Tests are registered globally before test execution starts.
- Each test has a fully qualified name in the form `TestSuiteName.TestName`.
- Tests defined with parameterization macros generate multiple test instances.


## 2. Why might some tests not be detected or run?

### Common causes include:

- **Test is disabled:**
  - If the test or test suite name starts with `DISABLED_`, it is compiled but not run.
  - Disabled tests can be enabled using the flag `--gtest_also_run_disabled_tests`.

- **Filter excludes the test:**
  - GoogleTest applies filters specified via `--gtest_filter` flag or `GTEST_FILTER` environment variable.
  - If your test's full name doesn't match the filter, it will not run.

- **Test is in another shard:**
  - When using sharding (`GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`), tests are divided; tests assigned to other shards won’t run.

- **Not linked into the binary:**
  - If a test source file is not linked into the test binary, tests defined within won't be detected.
  - This is common when using libraries without forcing linkage.

- **Failure to call `InitGoogleTest`:**
  - Tests won’t be discovered or run unless `testing::InitGoogleTest()` is called before `RUN_ALL_TESTS()`.


## 3. How should I structure test suites and test naming?

- **Test Suites:**
  - Group logically related tests into test suites by using the same first argument in `TEST()` or the same test fixture class in `TEST_F()`.

- **Naming conventions:**
  - Avoid underscores `_` in test suite or test names to prevent issues with test filtering.
  - Keep test suite and test names valid as C++ identifiers.
  - Use meaningful names reflecting the tested features or classes.

- **Use fixtures to share setup:**
  - When multiple tests require common setup, use `TEST_F()` with a fixture class derived from `testing::Test`.

- **Use parameterized tests for varying input:**
  - Use `TEST_P()` alongside `INSTANTIATE_TEST_SUITE_P()` to test common logic across multiple inputs.


## 4. How can I programmatically register tests?

GoogleTest allows dynamic registration of tests at runtime through the `::testing::RegisterTest` API. This is an advanced use case useful when test cases depend on runtime data.

Example:

```cpp
class MyFixture : public testing::Test {
 public:
  static void SetUpTestSuite() { /* Setup shared resources */ }
  static void TearDownTestSuite() { /* Cleanup */ }
};

class MyTest : public MyFixture {
 public:
  explicit MyTest(int data) : data_(data) {}
  void TestBody() override {
    // Test logic using data_
  }
 private:
  int data_;
};

void RegisterMyTests(const std::vector<int>& data_values) {
  for (int val : data_values) {
    testing::RegisterTest(
        "MyFixture",                   // Test suite name
        ("Test" + std::to_string(val)).c_str(), // Test name
        nullptr,                       // Type param (none)
        std::to_string(val).c_str(),   // Value param
        __FILE__, __LINE__,            // Source location
        [=]() -> MyFixture* { return new MyTest(val); });
  }
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  std::vector<int> values = {1, 2, 3};
  RegisterMyTests(values);
  return RUN_ALL_TESTS();
}
```

This flexibility can be leveraged to generate tests based on configuration files or dynamic conditions.


## 5. How can I run only specific tests?

- Use the command line option `--gtest_filter=PositivePatterns[-NegativePatterns]`.
  - Supports `*` wildcard matching.
  - Example: `--gtest_filter=MySuite.*` runs all tests in `MySuite`.
  - Example: `--gtest_filter=-*Disabled*` excludes all tests with `Disabled` in their names.

- List available tests with `--gtest_list_tests`.


## 6. What is test sharding and how does it affect test discovery?

Sharding allows distributing tests across multiple machines or processes, running subsets in parallel to speed up test execution.

- Set `GTEST_TOTAL_SHARDS` to the total number of shards.
- Set `GTEST_SHARD_INDEX` to the index of the current shard (zero-based).

GoogleTest internally assigns tests to shards.

Tests outside the current shard won’t run.


## 7. Best Practices for organizing tests

- Organize tests into meaningful suites that reflect your code structure.
- Use fixtures (`TEST_F`) to share expensive setup and keep tests independent.
- Avoid disabling tests; prefer using filters if you want to skip tests temporarily.
- Use parameterized tests to avoid code duplication.
- Always call `testing::InitGoogleTest()` with the command-line parameters to properly initialize the framework.
- Name tests clearly, avoid underscores in names to simplify filtering.


## 8. Running Tests with or without main()

GoogleTest provides a default `main()` in `gtest_main` or `gmock_main`, so often you don’t need to write your own.

If your environment requires a custom `main()`, ensure your setup includes:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```


## 9. Additional help and references

- See the [GoogleTest Primer](https://google.github.io/googletest/primer.html) for beginner-friendly introductions.
- For advanced usage, explore [GoogleTest Advanced](https://google.github.io/googletest/advanced.html).
- Use the [Test Macros and Test Cases Reference](https://google.github.io/googletest/reference/testing_8h.html) to understand available test macros.
- For integration and build setup, refer to the [Build System Integration Guide](https://google.github.io/googletest/integration.html).

---

<Tip>
Always verify test discovery by running your test binary with `--gtest_list_tests` to confirm which tests are available.
</Tip>

<Tip>
Remember that tests are isolated; each test runs with a fresh fixture instance to avoid side effects between tests.
</Tip>

<Tip>
If you rely on parameterized tests, ensure you instantiate the test suites correctly to avoid empty or unrun test sets.
</Tip>

<AccordionGroup title="Frequently Encountered Issues with Test Discovery">
<Accordion title="Tests Not Running Despite Being Defined">
Check if your test executable:
- Is linked with the correct test files.
- Calls `InitGoogleTest` before running tests.
- Does not filter out tests unintentionally via `--gtest_filter`.
- Has tests disabled by prefixing with `DISABLED_`.
</Accordion>

<Accordion title="Disabled Tests Behavior">
Tests prefixed with `DISABLED_` are compiled but skipped in execution. Use `--gtest_also_run_disabled_tests` to include them during runs.
</Accordion>

<Accordion title="Test Suites or Tests with Underscores in Names Don’t Show Up in Filters">
Underscores in test or suite names complicate filter matching. It is a best practice to avoid underscores in test suite and test names.
</Accordion>
</AccordionGroup>

---

### Example: Running a subset of tests

To run only tests in `MyComponentTest` test suite:

```bash
./my_test_binary --gtest_filter=MyComponentTest.*
```

To run all tests except those named `MyComponentTest.FlawedTest`:

```bash
./my_test_binary --gtest_filter=MyComponentTest.*-MyComponentTest.FlawedTest
```

To include disabled tests as well:

```bash
./my_test_binary --gtest_also_run_disabled_tests
```


---

### Architecture Insight: Test Discovery and Execution Lifecycle

```mermaid
flowchart TD
  Init["Call testing::InitGoogleTest()"]
  RegisterTests["All TEST/TEST_F macros register tests before main"]
  RUN_ALL_TESTS["Invoke RUN_ALL_TESTS()"]
  FilterTests["Tests filtered by --gtest_filter"]
  IterateTests["Iterate selected tests"]
  ForEachTest["For each test:"]
  SetupFixture["Create test fixture and call SetUp"]
  RunTestBody["Run TestBody() method"]
  TearDownFixture["Call TearDown and delete fixture"]
  RecordResult["Record test result"]
  Report["Report summary and return"]

  Init --> RegisterTests
  RegisterTests --> RUN_ALL_TESTS
  RUN_ALL_TESTS --> FilterTests
  FilterTests --> IterateTests
  IterateTests --> ForEachTest
  ForEachTest --> SetupFixture
  SetupFixture --> RunTestBody
  RunTestBody --> TearDownFixture
  TearDownFixture --> RecordResult
  RecordResult --> IterateTests
  IterateTests -->|when done| Report

  classDef mainfill fill:#bbf,stroke:#006,stroke-width:2px;
  Init,RUN_ALL_TESTS,Report class mainfill;
```

This flow illustrates how tests are discovered, filtered, executed, and reported.


---

### Useful Commands and Flags

| Command/Flag                         | Purpose                                              |
|------------------------------------|------------------------------------------------------|
| `--gtest_list_tests`                | List all registered tests without running them       |
| `--gtest_filter=<pattern>`          | Run only tests matching the filter                    |
| `--gtest_also_run_disabled_tests`  | Include disabled tests in runs                        |
| `--gtest_repeat=N`                  | Repeat all tests N times (N=-1 for infinite repeats)  |
| `GTEST_TOTAL_SHARDS`, `GTEST_SHARD_INDEX` | Run subset of tests when sharding                  |


---

### Additional Resources

- [Writing and Running Your First Test](../getting-started/configuration-first-test/writing-first-test.md)
- [Organizing and Running Tests Guide](../guides/getting-started/test-organization-running.md)
- [Test Macros and Classes Reference](../api_reference/core_test_api/test_macros_and_classes.md)
- [Test Execution and Control](../api_reference/core_test_api/test_execution_control.md)

---

<Note>
This page focuses exclusively on test discovery and organization; for detailed mock usage, see GoogleMock documentation.
</Note>

---

## Summary

This FAQ guides users through how GoogleTest discovers, organizes, and runs tests. It explains common issues that prevent tests from running, best practices for naming and structuring tests, and advanced features like dynamic test registration and test sharding. This page equips users to effectively structure their tests and troubleshoot discovery challenges.
