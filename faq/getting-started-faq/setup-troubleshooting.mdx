---
title: "How do I set up GoogleTest/GoogleMock in my project?"
description: "Addresses initial installation and integration issues for different platforms and build systems (CMake, Bazel). Offers stepwise instructions, links to more detailed quickstart guides, and solutions to the most frequent errors seen during environment setup."
---

# How do I set up GoogleTest/GoogleMock in my project?

Setting up GoogleTest and GoogleMock in your project involves installing the frameworks, integrating them with your build system, and correctly initializing and linking the necessary libraries. This guide walks you through the steps to get started confidently, helping you avoid the common pitfalls encountered across different platforms and build tools.

---

## 1. Installation Overview

GoogleTest and GoogleMock are bundled together within the [googletest](https://github.com/google/googletest) repository. Typically, you will need to:

- Download or clone the repository.
- Build the libraries using your preferred build system (typically CMake or Bazel).
- Link these libraries in your test projects.

For detailed instructions on installation with popular build systems, see our [Installation with CMake](https://github.com/google/googletest/blob/main/docs/GettingStarted.md) and [Installation with Bazel](https://github.com/google/googletest/blob/main/docs/Bazel.md) guides.


## 2. Building with CMake

GoogleMock provides community-maintained support for CMake.

### Basic Steps

1. **Obtain the Sources**
   - Clone the googletest repository or download a release.

2. **Configure the Build**
   - GoogleMock locates GoogleTest internally; you don't need separate builds.

3. **Build Targets**
   - The `gmock` and `gmock_main` libraries are provided. Link your tests against `gmock_main` if you want to use GoogleMock’s provided main function.

4. **Run Tests**
   - You can build and run GoogleMock’s own tests by enabling the `gmock_build_tests` option.

### Sample CMake Usage

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyTestProject)

add_subdirectory(path/to/googletest)

add_executable(my_tests test/test_example.cc)
target_link_libraries(my_tests gmock_main)

enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

### Notes
- By default, GoogleMock’s tests are disabled (`gmock_build_tests` is `OFF`). Enable them for validation.
- GoogleMock uses stricter compiler warnings to ensure code quality.

## 3. Building with Bazel

If you prefer Bazel, `googletest` supports it out-of-the-box.

- Include `@com_google_googletest` dependency in your WORKSPACE.
- Declare dependencies on `@com_google_googletest//:gmock` or `@com_google_googletest//:gmock_main` in your `BUILD` files.
- Use Bazel's standard build and test commands.

Refer to the official Bazel guide for exact setup details.

## 4. Linking GoogleTest and GoogleMock in Your Test Code

You can choose whether to provide your own custom `main` function or use the provided one.

- **Using the provided main:** Link with `gmock_main`. It initializes both GoogleMock and GoogleTest.

  ```cpp
  int main(int argc, char **argv) {
    testing::InitGoogleMock(&argc, argv);
    return RUN_ALL_TESTS();
  }
  ```

- **Providing your own main:** Link with `gmock` and implement the main function similar to above.

  ```cpp
  int main(int argc, char **argv) {
    testing::InitGoogleMock(&argc, argv);
    return RUN_ALL_TESTS();
  }
  ```

*Note:* On certain embedded platforms and Arduino-like boards (ESP8266, ESP32, NRF52 with Arduino), the `main` is replaced with `setup()` and `loop()` functions that call GoogleMock tests accordingly.

## 5. Basic Setup for Mocking

- Include GoogleMock headers in your test source files:

  ```cpp
  #include <gmock/gmock.h>
  #include <gtest/gtest.h>
  ```

- Derive mock classes using `MOCK_METHOD` to define mock methods.
- Use `EXPECT_CALL` and `ON_CALL` macros to set expectations and default behaviors.

For detailed usage, refer to our [Mocking Reference](https://google.github.io/googletest/gmock_reference.html) and [Mocking Patterns Guides](https://google.github.io/googletest/gmock_for_dummies.html).

## 6. Common Setup Issues and Troubleshooting

### Missing or Incorrect Linking Errors

- Ensure you link your test executable with `gmock_main` or at least `gmock` and `gtest`.
- Verify the include directories point to both GoogleMock and GoogleTest includes.
- For CMake, confirm `add_subdirectory()` is set for the GoogleTest/Mock source.

### Build Failures on Different Compilers or Platforms

- GoogleMock uses modern C++ standards (C++17 minimum). Verify compiler version compatibility.
- On MSVC, watch for warnings related to overriding virtual methods with `const` parameters — remove `const` in parameters if necessary.
- For embedded or specialized platforms, confirm support by consulting the platform-specific Initialization sections.

### Tests Fail to Run or Initialize

- Confirm you call `testing::InitGoogleMock()` before running tests.
- For tests requiring command-line flags, make sure relevant flags are passed correctly.
- When tests do not run, check that registration macros like `TEST()` or `TEST_F()` are correctly used.

### Verbosity and Output Control

- Use the `--gmock_verbose` flag with levels (`info`, `warning`, `error`) to trace mock call handling and expectation evaluation.

Example:

```
./my_tests --gmock_verbose=info
```

This can help diagnose unexpected or missing calls.

## 7. Next Steps and Learning Resources

- Start with the [GoogleTest Primer](https://google.github.io/googletest/primer.html) for test basics.
- Explore [Mocking Reference](https://google.github.io/googletest/gmock_reference.html) for mock details.
- Advance to guides like [Defining and Using Mocks](guides/mocking-patterns/defining-using-mocks) and [Setting Expectations and Actions](guides/mocking-patterns/setting-expectations-actions) to master mocking techniques.
- Validate your installation quickly by running the included GoogleMock tests or your own simple test suite, following [Validating Setup](getting-started/configuration/validating-setup).

---

<AccordionGroup title="Additional Tips & Troubleshooting">
<Accordion title="Using GoogleMock with Shared Libraries">
Due to platform and linker intricacies, linking GoogleMock as a shared library requires careful attention. Use the CMake option `BUILD_SHARED_LIBS=ON` when configuring and confirm that your build environment supports shared libraries.
</Accordion>
<Accordion title="Handling Unexpected or Uninteresting Calls">
If you encounter warnings about uninteresting calls even after setting behaviors with `ON_CALL`, consider using `EXPECT_CALL` with `WillRepeatedly(...)` for explicit expectations.
</Accordion>
<Accordion title="Avoiding Common Mistakes in MOCK_METHOD">
Remember to declare `MOCK_METHOD` inside the `public:` section of your mock classes. Wrap argument types with commas (e.g., `std::pair<int, int>`) in parentheses when necessary to avoid parsing errors.
</Accordion>
</AccordionGroup>

<Tip>
To get up and running quickly, link your tests against `gmock_main` and include `gmock/gmock.h`. Write a simple test with `TEST` or `TEST_F` macros and call `RUN_ALL_TESTS()` in your `main`. This minimal setup works on all supported platforms.
</Tip>

<Tip>
Leverage the verbosity flag `--gmock_verbose=info` during early testing phases to gain detailed insights about mock function calls and expectation validations.
</Tip>


## Related Topics

- [Quickstart Workflow](https://google.github.io/googletest/overview/features-workflows/quickstart-workflow)
- [GoogleTest Primer](https://google.github.io/googletest/docs/primer.html)
- [Mocking Reference](https://google.github.io/googletest/gmock_reference.html)
- [Mock Strictness and Object Lifecycle](https://google.github.io/googletest/guides/mocking-patterns/mock-strictness-lifecycle)
- [Validating Your Setup](https://google.github.io/googletest/getting-started/configuration/validating-setup)

---

## Summary

Proper setup of GoogleTest and GoogleMock in your project involves configuring the build system to include and link against the appropriate libraries, initializing the test framework in your code, and writing tests leveraging mocks. Most common issues during setup stem from linking errors, missing header paths, or improper initialization steps. Server or embedded platform nuances require specialized handling as documented.

This guide aims to quickly guide users through these essential steps, linking to more detailed handbooks and pointing out key pitfalls and verification practices to ensure a successful start with GoogleTest and GoogleMock.

---