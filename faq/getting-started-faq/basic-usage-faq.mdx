---
title: "Basic Usage and Test Writing"
description: "Frequently asked questions about writing and running tests, understanding test discovery, and core usage patterns in GoogleTest and GoogleMock. Clarifies best practices for structuring and executing tests."
---

# Frequently Asked Questions: Basic Usage and Test Writing

This FAQ page addresses common questions related to writing and running tests using GoogleTest and GoogleMock. It guides users through core usage patterns, test discovery mechanisms, structuring tests effectively, and highlights best practices for successful test development.

---

## 1. Writing and Running Your First Tests

### Q: How do I start writing tests with GoogleTest?

Start by including the `<gtest/gtest.h>` header. Define test cases using the `TEST` macro, specifying a test suite name and a test name. Inside the test, use assertions like `EXPECT_EQ` or `ASSERT_TRUE` to verify expected behavior. Build and run your test binary; GoogleTest automatically discovers and executes all tests.

```cpp
#include <gtest/gtest.h>

TEST(MathTest, Addition) {
  EXPECT_EQ(1 + 1, 2);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Run the compiled test binary to see results.

### Q: How do I write tests with GoogleMock?

First, create mock classes with the `MOCK_METHOD` macro to define mocked methods. Then, in your tests, instantiate mock objects, set up expectations using `EXPECT_CALL`, and exercise your code. GoogleMock verifies if calls match expectations at object destruction.

```cpp
#include <gmock/gmock.h>

class MockTurtle {
 public:
  MOCK_METHOD(void, PenDown, (), ());
  MOCK_METHOD(void, PenUp, (), ());
};

TEST(DrawingTest, DrawCircle) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(1);

  // ... code that uses turtle ...
}
```

### Q: How do I run my tests?

After building your test executable, simply run it. GoogleTest/GoogleMock shows test results, failures, and summaries. Use command-line flags (e.g., `--gtest_filter`) to select specific tests.

---

## 2. Understanding Test Discovery and Structure

### Q: How does GoogleTest discover tests?

GoogleTest registers tests declared with `TEST` and related macros automatically at runtime before `RUN_ALL_TESTS()` is called. This means adding a new `TEST` automatically integrates it into the test suite without extra registration.

### Q: How should I structure tests?

Group related tests within test suites (using the first parameter in `TEST`). Use test fixtures (`TEST_F`) for shared setup and teardown logic.

Example:

```cpp
class StackTest : public ::testing::Test {
 protected:
  void SetUp() override {
    stack_.push(1);
  }

  std::stack<int> stack_;
};

TEST_F(StackTest, HasSizeOneInitially) {
  EXPECT_EQ(stack_.size(), 1);
}
```

This promotes reuse and clearer organization.

### Q: Can I write tests without matchers or expectations?

Yes. You can write simple tests with assertions only. However, for interaction-based testing where you need to verify calls to collaborators, GoogleMock’s matchers and expectations provide powerful tools.

---

## 3. Setting Expectations and Default Behavior in Mocks

### Q: How do I set expectations on mock methods?

Use `EXPECT_CALL(mock_object, Method(matchers))` before exercising the code that uses the mock. Use matchers like `_` (wildcard), `Eq()`, or relational matchers to specify argument constraints.

Example:

```cpp
EXPECT_CALL(mock_foo, Process(Eq(42))).Times(1).WillOnce(Return(true));
```

### Q: What if I don’t care about certain calls on a mock?

Use `ON_CALL` to specify default behavior without requiring the call:

```cpp
ON_CALL(mock_foo, Process(_)).WillByDefault(Return(false));
```

Or, you can suppress warnings about uninteresting calls by using `NiceMock`:

```cpp
NiceMock<MockFoo> nice_mock;
```

### Q: What do `NiceMock`, `NaggyMock`, and `StrictMock` mean?

- `NiceMock`: suppresses warnings on uninteresting calls.
- `NaggyMock` (default): warns on uninteresting calls.
- `StrictMock`: treats uninteresting calls as failures.

Use according to how strict you want test enforcement to be.

### Q: How do I specify the number or order of calls?

Use the `.Times()` clause to specify how many times the method is expected. Use `InSequence` or `.After()` clauses to enforce call order.

Example:

```cpp
{
  testing::InSequence s;
  EXPECT_CALL(mock, Foo(1));
  EXPECT_CALL(mock, Foo(2));
}
```

### Q: What happens if a call doesn’t match any expectation?

GoogleMock reports an error for unexpected calls. If a mock method is called with no expectation at all (uninteresting call), the outcome depends on the mock’s strictness (warn, ignore, or fail).

---

## 4. Tips and Best Practices

- **Set expectations before exercising mocks.** Changing expectations after calling mock methods leads to undefined behavior.
- **Use `ON_CALL` and `EXPECT_CALL` judiciously.** Avoid over-constraining tests; verify only what’s essential.
- **If you see "Uninteresting mock function call" warnings,** consider if you need a catch-all `EXPECT_CALL` with `.Times(AnyNumber())`, or switch to `NiceMock`.
- **Mock only interfaces you own or control.** Avoid mocking concrete classes where possible.
- **Name your tests and expectations clearly** to communicate intent.

---

## 5. Troubleshooting Common Issues

### Q: My mock method returns a non-default-constructible type and causes error on unexpected calls. What should I do?

Provide explicit behavior using `ON_CALL` or `EXPECT_CALL` with an action that returns a valid value. Otherwise, GoogleMock cannot generate a proper default return and will throw exceptions or terminate.

### Q: Why do I get warnings about uninteresting calls even when I set `ON_CALL`?

Because `ON_CALL` sets default behaviors but does not set expectations that a call must occur. Uninteresting calls are those with no expectations set (`EXPECT_CALL`). You can suppress warnings by using `NiceMock` or adding a catch-all `EXPECT_CALL`.

### Q: My mock object leaks and its expectations are never verified. How to fix this?

Ensure mocks are properly destroyed at test end so their expectations are verified. If you intentionally want to leak a mock, use `Mock::AllowLeak(mock_ptr)`.

### Q: How can I debug why an expectation isn’t satisfied?

Run the tests with `--gmock_verbose=info` to see detailed traces of mock call matching and expectation activity.

### Q: Why do newer EXPECT_CALL statements override older ones?

GoogleMock matches expectations in reverse order to let you write a general default expectation early and then more specific ones later, improving test clarity.

---

## 6. Useful Code Examples

### Defining a Mock Class

```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
  MOCK_METHOD(int, DoThat, (bool flag), ());
};
```

### Using NiceMock to Suppress Warnings

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, DoThis());
nice_foo.DoThat(true);  // No warning even though no EXPECT_CALL set for DoThat
```

### Expecting and Controlling Behavior

```cpp
MockFoo foo;
ON_CALL(foo, DoThat(_)).WillByDefault(Return(42));
EXPECT_CALL(foo, DoThis());
foo.DoThis();
int val = foo.DoThat(true);  // val == 42
```

---

## 7. Where to Go Next

- Explore the "[Mocking Basics](../guides/core-testing-workflows/mocking-basics.md)" guide to deepen your understanding of mock class creation and expectations.
- Consult the "[Writing Your First Test](../getting-started/initial-setup-usage/writing-your-first-test.md)" page for more step-by-step onboarding.
- Visit the "[Matchers Reference](../api-reference/matchers-actions-api/argument-matchers.md)" to explore argument matching techniques.
- Learn about advanced topics like custom matchers and actions in the "[Advanced Patterns](../guides/advanced-patterns/custom-matchers-actions.md)".

---

## Related Documentation Links

- [Product Introduction](../overview/introduction-and-value/product-introduction.md)
- [Mocking Basics](../guides/core-testing-workflows/mocking-basics.md)
- [Writing Effective Assertions](../guides/core-testing-workflows/writing-assertions.md)
- [Supported Platforms & Ecosystem](../overview/introduction-and-value/supported-platforms-and-ecosystem.md)
- [Installation and Configuration FAQ](../faq/getting-started-faq/installation-troubleshooting.md)

---

<Tip>
Always create your mock expectations *before* you use the mock in code. This ensures GoogleMock can correctly verify behaviors and report errors precisely.
</Tip>

<Note>
Use `NiceMock` wrappers to avoid distractions from uninteresting call warnings while focusing on your critical test expectations.
</Note>

<Warning>
Be cautious with overly strict mocks (`StrictMock`) as unexpected uninteresting calls will cause test failures.
</Warning>

---