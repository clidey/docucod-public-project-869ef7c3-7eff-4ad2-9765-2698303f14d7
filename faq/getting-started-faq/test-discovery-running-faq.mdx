---
title: "Test Discovery & Execution"
description: "Clarifies how tests are automatically discovered and run, how to control test execution, test shuffling, and common confusion around main entry points and integration (with reference to gtest_main.cc and gmock_main.cc)."
---

# Test Discovery & Execution

GoogleTest streamlines the process of identifying and running your tests with automatic test discovery. This page clarifies how GoogleTest locates tests, how it executes them, controls you have over execution, test shuffling, and integration nuances related to the main function entry points provided by `gtest_main.cc` and `gmock_main.cc`.

---

## Automatic Test Discovery

GoogleTest automatically discovers all tests defined using macros such as `TEST()`, `TEST_F()`, `TEST_P()`, and typed/test-parameterized test macros. You do not need to manually register tests or keep track of them.

### How Discovery Works

- When you define tests with the standard macros, GoogleTest creates and registers them at static initialization time.
- These tests are collected into **test suites**, reflecting test organization.
- The discovery includes regular tests, test fixtures, value-parameterized tests, typed tests, and type-parameterized tests.

This means once your test source files are linked into your test executable, all their tests are automatically known to GoogleTest.

### Impact on Test Execution

- Calling `RUN_ALL_TESTS()` runs *all* registered tests.
- You can selectively run subsets of tests using filters (e.g., `--gtest_filter=MySuite.*`).

<Tip>
You never have to manually enumerate your tests; GoogleTest does this for you automatically.
</Tip>

## Controlling Which Tests Run

Execution control is possible through command-line flags or environment variables:

- **Run All Tests**: Default behavior when running the executable.
- **Filter Tests**: Use `--gtest_filter` to run only tests matching a pattern.
- **Disabled Tests**: Prefix tests or suites with `DISABLED_` to exclude them from runs; use `--gtest_also_run_disabled_tests` to include them.
- **Repeat Tests**: `--gtest_repeat=N` runs tests N times—useful to detect flaky tests.
- **Fail Fast**: `--gtest_fail_fast` stops on first failure.
- **Sharding**: Distribute test execution across multiple machines with `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`.


## Test Shuffling and Seeding

GoogleTest enables running tests in a randomized order to detect test interdependencies:

- Use `--gtest_shuffle` to randomize test execution order.
- By default, the random seed is generated from the current time.
- Provide a fixed seed with `--gtest_random_seed=SEED` to reproduce specific orders.
- Shuffling works across repetitions (with `--gtest_repeat`) by getting a new random seed each run.

<Tip>
Shuffling tests regularly is a best practice that uncovers hidden dependencies between tests.
</Tip>

## The Main Function Entry Points

Most users do not write their own `main()` function. Instead, you simply link against GoogleTest-provided libraries that supply a `main()`:

- **`gtest_main`**: Provides a default `main()` that initializes and runs tests.
- **`gmock_main`**: Similar, but also initializes GoogleMock support.

### What these mains do:

1. Call `testing::InitGoogleTest()` with command-line arguments.
2. Run `RUN_ALL_TESTS()`.
3. Return the result (0 if all tests pass, else 1).

### When you need your own main:

- To run custom setup code *before* tests
- To integrate test execution in larger frameworks or runtimes
- To customize command-line parsing or environment setup

In such cases, you write your own `main()`, and inside it:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);  // Parse and remove test flags
  // Your setup code here
  return RUN_ALL_TESTS();  // Run all registered tests
}
```

<Tip>
Always ensure `InitGoogleTest()` is called before `RUN_ALL_TESTS()`. It initializes flags and removes recognized arguments.
</Tip>

## Understanding Test Execution Flow

Each time `RUN_ALL_TESTS()` is called (normally once per test program):

1. GoogleTest resets all test state.
2. Calls registered global test environment setup if any.
3. For each test suite:
   - Calls `SetUpTestSuite()` once before the first test of the suite.
   - Runs each test:
     - Constructs a fresh test fixture instance.
     - Calls `SetUp()` for the instance.
     - Runs the actual test code.
     - Calls `TearDown()`.
     - Deletes the fixture instance.

4. Calls test suite teardown `TearDownTestSuite()` after all tests in the suite finished.
5. Calls global test environment teardown.
6. Reports test results.

<Tip>
Each test runs on a fresh instance of its fixture, making tests independent and repeatable.
</Tip>

## Frequently Asked Questions on Test Discovery & Execution

<AccordionGroup title="FAQs on Test Discovery and Execution">
<Accordion title="Why don't I see my tests when running my test executable?">

Make sure your source files containing the tests are linked in.

Most test definitions occur at static initialization time, so if the linker omits your test object files, they won’t register any tests.

Also check for:

- Disabled test naming with `DISABLED_` prefix.
- Misconfigured filters that exclude your tests.

</Accordion>
<Accordion title="Can I run a single test or a group of tests?">

Yes. Use the `--gtest_filter` flag to specify which tests to run.

Example:

```
--gtest_filter=MySuite.MyTest
```

Supports wildcards:

```
--gtest_filter=MySuite.*
```

Negative filters are supported to exclude tests.

</Accordion>
<Accordion title="What is the difference between `gtest_main` and `gmock_main`?">

- `gtest_main` provides a main() sufficient to run GoogleTest tests only.
- `gmock_main` provides main() that initializes both GoogleTest and GoogleMock features.

Use `gmock_main` if you use GoogleMock in your tests.

</Accordion>
<Accordion title="Why am I getting linker errors related to main?">

If you link against GoogleTest but not `gtest_main` or `gmock_main`, you must provide your own `main`.

Otherwise, linking will fail because the standard entry-point for test execution is missing.

</Accordion>
<Accordion title="How does GoogleTest ensure tests run independently?">

GoogleTest constructs a fresh test fixture instance for each test and calls setup/teardown routines independently.

This guarantees no shared state between tests unless explicitly using shared static resources and careful synchronizations.

</Accordion>
<Accordion title="Can I shuffle tests to detect dependencies?">

Yes, use `--gtest_shuffle` to randomize test order.

Use `--gtest_random_seed` to specify a seed for repeatable shuffles.

Shuffling combined with test repeats is an effective way to detect hidden order dependencies.

</Accordion>
<Accordion title="What happens if I call RUN_ALL_TESTS() multiple times?">

GoogleTest does not support calling `RUN_ALL_TESTS()` more than once per executable.

Doing so can interfere with features such as death tests and is unsupported behavior.

</Accordion>
</AccordionGroup>

## Troubleshooting Common Test Discovery & Execution Issues

### Tests Not Running or Not Discovered

- Confirm the test object files are correctly linked into the executable.
- Remove `DISABLED_` prefixes or use `--gtest_also_run_disabled_tests` to include disabled tests.
- Verify you are not accidentally filtering out all tests with `--gtest_filter`.

### Command-Line Flag Parsing Issues

- Ensure `testing::InitGoogleTest()` is called with correct `argc`/`argv` before `RUN_ALL_TESTS()`.
- Flags set after initialization have no effect.

### Linking Multiple Test Mains

- Only link one entry-point: either write your own `main()` or use one library (`gtest_main` or `gmock_main`).

### Flaky Tests

- Use `--gtest_repeat` combined with `--gtest_shuffle` and `--gtest_random_seed` to reproduce failures.

## Additional Control and Advanced Features

### Listing All Available Tests

To see all tests your executable would run without running them, use:

```
./your_test_executable --gtest_list_tests
```

This prints a hierarchical list of test suites and tests.

### Output Formatting Controls

Customize output using flags such as:

- `--gtest_color` to enable or disable colored output.
- `--gtest_brief` to suppress passed test logging.
- `--gtest_output=xml:<file>` or `json:<file>` to produce machine-readable test reports.

### Skipping and Disabling Tests

- Use `GTEST_SKIP()` macro within tests to skip them during execution.
- Prefix tests or suites with `DISABLED_` to exclude them from runs permanently.

### Running Tests in Parallel

GoogleTest supports sharding using environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`, distributing tests across machines.

## Summary

GoogleTest automatically detects and runs your C++ tests from macros you use. You control execution with command-line options to filter, repeat, shuffle, or disable tests. Default `main()` functions are provided in GoogleTest libraries, simplifying setup, but you can customize with your own `main()` when necessary. Proper linking and calling `InitGoogleTest()` before running tests is crucial for seamless operation.

---

For detailed syntax of test macros and parameterized tests, see the [Testing Reference](reference/testing.md).

Explore the [GoogleTest Primer](primer.md) for a holistic introduction and examples.

Learn about integrating tests into your build with guides such as [Setup Your Test Project](guides/getting_started/setup_project.md).

Troubleshoot test execution and linking with the [Common Installation Issues](getting-started/troubleshooting-common-issues/common-installation-issues.md) guide.

---

### Code Example: Minimal Custom `main()`
```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Code Example: Running Only Specific Tests
```bash
./your_test_executable --gtest_filter=MyTestSuite.MyTestName
```

### Listing Tests Output Sample
```
MyTestSuite1.
  Test1
  Test2
MyTestSuite2.
  TestA
  TestB
```

---

### Troubleshooting Tip: Missing Tests
If you run `--gtest_list_tests` and the expected tests do not appear, confirm:
- Tests are linked into the binary.
- No `DISABLED_` prefixes hide tests.
- Filters or shards do not exclude desired tests.

---

<Check>
Link with `gtest_main` or `gmock_main` for auto main entry point.
</Check>

<Check>
Always call `testing::InitGoogleTest()` before `RUN_ALL_TESTS()`.
</Check>

<Check>
Use filtering and sharding flags to control what tests run.
</Check>

<Note>
Calling `RUN_ALL_TESTS()` more than once is unsupported.
</Note>

<Info>
`DISABLED_` prefix excludes tests from execution but keeps them compiled.
</Info>

---

## Further Reading and References

- [GoogleTest Primer](primer.md) - An introduction to writing tests and fixtures.
- [Testing Reference](reference/testing.md) - API details for test macros and fixtures.
- [Advanced GoogleTest Topics](advanced.md#running-test-programs-advanced-options) - Flags for test running customization.
- [Common Installation Issues](getting-started/troubleshooting-common-issues/common-installation-issues.md) - Resolve frequent setup problems.

---