---
title: "Basic Integration & Common Issues"
description: "Resolve early stumbling blocks encountered while adding GoogleTest or GoogleMock to a new or existing project, including CMake/Bazel support, linking, and typical integration quirks."
---

# Basic Integration & Common Issues FAQ

This FAQ page helps you overcome common hurdles when integrating GoogleTest and GoogleMock into new or existing C++ projects. It focuses on practical, actionable guidance related specifically to build system support (CMake/Bazel), linking correctly, and resolving typical integration quirks that users encounter early in adoption.

---

## Frequently Asked Questions

### 1. How do I integrate GoogleTest and GoogleMock in my CMake project?

- **Answer:**
  - Add GoogleTest and GoogleMock as dependencies either by downloading their source or using available packages.
  - In your `CMakeLists.txt`, link your test executable to `gtest` and `gmock` libraries appropriately.
  - Ensure you specify include directories for headers.
  - For example:
  ```cmake
  find_package(GTest REQUIRED)
  add_executable(my_test test_main.cpp)
  target_link_libraries(my_test PUBLIC GTest::gtest GTest::gmock)
  ```
- **Common Pitfalls:**
  - Missing linking to `gmock` alongside `gtest`.
  - Not enabling C++17 standard which is required.
  - Mixing different libc++ STL versions causing linkage problems.

---

### 2. How do I add GoogleTest and GoogleMock to a Bazel workspace?

- **Answer:**
  - Declare `googletest` dependencies in your WORKSPACE file using the official Bazel modules or git rules.
  - Reference the required BUILD targets from GoogleTest and GoogleMock in your test targets.
  - Define test targets with dependencies on `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock`.
  - For example:
  ```bazel
  cc_test(
      name = "my_test",
      srcs = ["my_test.cc"],
      deps = ["@com_google_googletest//:gmock_main"],
  )
  ```
- **Notes:**
  - Ensure your Bazel version supports C++17 features.
  - Follow the Bazel-specific installation guides for exact setup.

---

### 3. Why do I get linking errors for GoogleMock symbols when building test targets?

- **Causes:**
  - Not linking `gmock` alongside `gtest`.
  - Mixing static and shared libraries inconsistently.
  - Build system misconfiguration causing missing paths or targets.

- **Solutions:**
  - Explicitly link both `gtest` and `gmock` in your test target.
  - Confirm the search paths for libraries and headers are correct.
  - Use consistent compiler and linker flags for both GoogleTest/Mock and your tests.
  - Verify that you compile with C++17 support as required by the framework.

---

### 4. How do I avoid runtime errors related to multiple GoogleMock versions or symbols?

- **Best Practices:**
  - Use a single version of GoogleTest and GoogleMock across your project.
  - Avoid mixing your own compiled GoogleMock with a system-installed version.
  - Prefer vendored or embedded copies in your repository or consistent package managers.

- **Troubleshooting:**
  - Check for multiple GoogleMock instances in your build and runtime paths.
  - Use verbose linker output to identify symbol conflicts.

---

### 5. What are common build or runtime integration quirks I should watch out for?

- ***C++ Standard:*** Always compile your tests and GoogleTest/GoogleMock with C++17 or higher.

- ***Virtual Destructors:*** Classes you mock **must** have virtual destructors to avoid undefined behavior.

- ***Macro Conflicts:*** On Windows, Windows API headers may macros that clash with method names (e.g., `Method` redefined). Use careful include order or `#undef` macros if needed.

- ***Order of EXPECT_CALL:*** Set expectations with `EXPECT_CALL` *before* invoking mock methods. Mixing calls and expectations leads to undefined behavior.

- ***Default Actions and ON_CALL***: Use `ON_CALL` to specify default behaviors when call arguments don't match expectations. This makes tests more robust.

- ***Leaked Mocks:*** If mocks are leaked (not deleted), GoogleMock will report errors unless you explicitly tell it to allow leaks using `testing::Mock::AllowLeak(mock_ptr);`.

- ***Strictness Levels:*** Understand the difference among `NiceMock`, `NaggyMock` (default), and `StrictMock` to control warnings and failures on uninteresting calls.

---

## Troubleshooting Common Issues

### Problem: Tests compile but crash or abort at runtime

- Check that mock classes and your tested classes use virtual destructors.
- Verify that your mocks are properly constructed and destructed.
- Use heap checkers to detect lifetime or memory errors.

### Problem: GoogleMock outputs warnings about uninteresting calls

- This means a mock method was called without an `EXPECT_CALL` set on it.
- Suppress warnings by using `NiceMock<MockClass>` or add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`.
- Avoid suppressing silently; understand if the call should be allowed.

### Problem: Actions or expectations run out, causing tests to fail

- Use `.Times()` or ensure your `WillOnce()` and `WillRepeatedly()` clauses match the expected number of calls.
- Apply `.RetiresOnSaturation()` to expectations that should stop matching after their call count is reached.

### Problem: Overloaded methods cause ambiguous expectations

- Use `MOCK_METHOD` specifying exact qualifiers and parameter types.
- Use `Const()` wrapper in expectations for const methods.
- Utilize type aliases or casting matchers when needed.

### Problem: Build errors related to commas in mock method signatures

- Wrap template-comma types inside extra parentheses in `MOCK_METHOD`.
- Alternatively, define type aliases for complex types used in mock methods.

---

## Recommended Best Practices

- Set expectations before exercising the code under test.
- Use sequences or `InSequence` when call order matters.
- Rely on `ON_CALL` for default behaviors, `EXPECT_CALL` for actual call verification.
- Group complex expectations into sequences or use `.After()` for partial order.
- Use `NiceMock` or `StrictMock` for controlling uninteresting call warnings.
- Verify and clear mocks early if leaks are a concern.

---

## Getting Help and Further Documentation

- Explore the [GoogleTest & GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick reference.
- Consult the [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) guide for approachable learning.
- Use the [Google Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for detailed macro and API info.
- Check the [Integration & Build Systems Guide](https://google.github.io/googletest/integration-build-systems.html) for platform-specific setup.
- Seek community support via GitHub issues and Stack Overflow.

---

## Additional Resources

- [Installation, Requirements & Compatibility FAQ](https://google.github.io/googletest/faq/getting-started-faq/installation-compatibility.html)
- [Mocking Best Practices and Pitfalls](https://google.github.io/googletest/faq/troubleshooting-workarounds/mocking-pitfalls.html)
- [Build, Linker, and Integration Troubleshooting](https://google.github.io/googletest/faq/troubleshooting-workarounds/build-integration-issues.html)

---

## Example Integration Snippet for CMake

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)

# Download and unpack googletest at configure time
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gtest gmock gtest_main)

gtest_discover_tests(my_tests)
```

---

## Example of Proper Mock Setup and Usage

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Interface {
 public:
  virtual ~Interface() = default;
  virtual int Compute(int) = 0;
};

class MockInterface : public Interface {
 public:
  MOCK_METHOD(int, Compute, (int), (override));
};

TEST(ComputeTest, ReturnsExpectedValue) {
  MockInterface mock;
  EXPECT_CALL(mock, Compute(42)).WillOnce(testing::Return(99));

  int result = mock.Compute(42);
  EXPECT_EQ(result, 99);
}
```

This test verifies the `Compute` method returns the expected value when called with 42.
