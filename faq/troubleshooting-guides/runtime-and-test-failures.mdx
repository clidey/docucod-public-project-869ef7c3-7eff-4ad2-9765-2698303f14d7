---
title: "Resolving Runtime & Test Issues"
description: "Covers the most common symptoms and solutions for test failures, assertion errors, segfaults, and platform-specific behavior differences. Helps users identify the root causes and steps to debug and fix test-time problems."
---

# Resolving Runtime & Test Issues

This documentation covers the most common symptoms and solutions for runtime and test issues in GoogleTest, including test failures, assertion errors, segmentation faults (segfaults), and platform-specific behavior differences. It guides you through identifying root causes and provides clear steps to debug and resolve test-time problems efficiently.

---

## Frequently Asked Questions on Runtime and Test Issues

### Why is my test failing with an assertion error?
- Assertion errors occur when an `EXPECT_*` or `ASSERT_*` macro condition evaluates to false.
- **Action**: Review the failure message to identify which check failed and examine the input and expected values.
- Use `EXPECT_*` to allow tests to continue after failure or `ASSERT_*` for fatal failures to abort early.

### What causes segmentation faults (segfaults) during a test?
- Common causes include dereferencing null or invalid pointers, especially after failed fatal assertions where the code continues to run unexpectedly.
- **Solution**: Use `ASSERT_NE(pointer, nullptr)` before dereferencing pointers.
- Check test fixture constructors and `SetUp()` methods for failures, since fatal failures in constructors do not abort tests as expected.

### How do I diagnose why a test crashes instead of failing gracefully?
- Ensure your test uses `ASSERT_*` assertions to abort on critical failure points.
- Use the [death test](../advanced.md#death-tests) macros (`EXPECT_DEATH`, `ASSERT_DEATH`) to verify code crashes when expected.
- Enable the `--gtest_break_on_failure` flag to debug failures interactively under a debugger.

### Why does GoogleTest sometimes continue after a fatal failure?
- Fatal failures abort only the current function, not the entire test. If assertions are inside helper functions, the test continues.
- **Workarounds:**
  - Use `ASSERT_NO_FATAL_FAILURE(statement);` to assert no fatal failures occur within `statement`.
  - Check the result of `HasFatalFailure()` after calling subroutines and return early to prevent segfaults.
  - Alternatively, enable throw-on-failure mode with the `throw_on_failure` flag to treat fatal failures as exceptions.

### What are common platform-specific issues affecting test behavior?
- Differences in threading, signal handling, and process forking can cause inconsistent test outcomes across Linux, Windows, and Mac.
- Windows does not support thread-safe assertions concurrently; beware of multithreaded assertions on that platform.
- Death tests use different spawn methods (`fork()`, `clone()`, or `CreateProcess()`) depending on the platform.
- Check platform-specific documentation if your test exhibits unstable or unexpected behavior.

### How can I skip tests or test suites at runtime?
- Use `GTEST_SKIP()` within test bodies or `SetUp()` methods of fixtures or environments to skip tests conditionally.
- You can also disable tests or test suites by prefixing their names with `DISABLED_` to exclude them from normal runs.

### How do I catch and test failures generated inside helper functions or subroutines?
- Use `EXPECT_NO_FATAL_FAILURE()` or `ASSERT_NO_FATAL_FAILURE()` around calls to subroutines.
- Use `HasFatalFailure()` to detect if previous assertions aborted a subroutine prematurely and handle accordingly.
- Alternatively, implement a failure listener to convert fatal failures into exceptions.

---

## Common Issues & Gotchas

### Assertion Failures Leading to Segfaults
- Fatal assertions abort the current function but donâ€™t unwind the stack. Failure to check pointers after assertions can cause dereferencing invalid pointers.
- **Best practice:** Always combine `ASSERT_*` to guard critical pointer dereferences.

### Failed Setup or Constructor Crashes
- Fatal failures in constructors or test fixture constructors are tricky; they do not abort the entire test properly.
- Use `SetUp()` instead of constructors for initialization logic that can fail.

### Mixing `TEST()` and `TEST_F()` in the Same Suite
- GoogleTest enforces consistent use of test fixture classes in test suites.
- Mixing `TEST` and `TEST_F` under the same test suite leads to failures.
- Refactor to use either or separate suites.

### Uninstantiated Parameterized Tests
- Defining parameterized tests (`TEST_P`) without properly instantiating them via `INSTANTIATE_TEST_SUITE_P` leads to no tests running and warnings/errors.
- Use `GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST(TestSuiteName)` to suppress warnings for optional cases.

### Running Subsets of Tests with Filters
- Filters (`--gtest_filter`) might exclude all tests not matching the pattern.
- Use `--gtest_list_tests` to inspect available tests and names.

### Disabling and Enabling Tests
- Disable tests temporarily with `DISABLED_` prefix; re-enable via `--gtest_also_run_disabled_tests` flag.

### Handling Multi-threading in Tests
- GoogleTest assertions are thread-safe on POSIX systems with pthreads, but may not be on Windows.
- Death tests run in separate processes; test bodies should avoid undefined behavior from concurrent modifications.

---

## Debugging Test Crashes and Failures

### Using `SCOPED_TRACE` to Add Context
- Use `SCOPED_TRACE("message")` to add context to assertion failures inside helper functions.
- This adds informative trace messages with file and line numbers to failure reports.

### Using `EXPECT_FATAL_FAILURE` and `EXPECT_NONFATAL_FAILURE`
- These macros help test that a certain statement generates an expected fatal or non-fatal failure.

### Inspecting Test Output Logs
- Check test output, including assertion messages, stack traces, and failure details.
- Swap in a minimal event listener to customize output if needed.

### Break On Failure
- Enable `--gtest_break_on_failure` to halt test at first failure, useful when running under a debugger.

### Repeat Tests to Reproduce Flakiness
- Use `--gtest_repeat=N` to run tests multiple times to reproduce intermittent failures.

### Analyze Test Result XML or JSON Reports
- Generate XML or JSON reports via `--gtest_output=xml:path` or `--gtest_output=json:path`.
- Parsing these reports helps with CI pipelines and automated failure analysis.

---

## Platform-Specific Behavior and Troubleshooting

### Death Tests Differences
- On Linux, death tests use `clone()` or `fork()`. Mac uses `fork()`. Windows uses `CreateProcess()`.
- Choose the death test style with `GTEST_FLAG_SET(death_test_style, "threadsafe" or "fast");`

### Thread Safety
- Thread-safe death tests are slower but safer with multithreaded code.
- GoogleTest warns when running death tests with multiple active threads.

### Wide String Support
- On Windows, wide strings (`wchar_t*`) in assertions are converted to UTF-8.

### Signal Handlers
- GoogleTest installs signal handlers to catch fatal signals and produce stack traces.

---

## Step-by-Step: Diagnosing and Fixing a Test-Time Failure

<Steps>
<Step title="Identify Failure Type">
Check the output log: Is it an assertion failure, a crash, or unexpected termination?
</Step>
<Step title="Check Assertion Messages">
Analyze assertion failure message for expected vs. actual values, and source location.
</Step>
<Step title="Use SCOPED_TRACE for Context">
Add `SCOPED_TRACE` in helper functions to determine which call caused assertions.
</Step>
<Step title="Review Test Fixture Setup">
Confirm that constructors do not have fatal assertions; move setup logic to `SetUp()`.
</Step>
<Step title="Guard Pointer Dereferencing">
Use `ASSERT_NE(ptr, nullptr)` before dereferencing to prevent segfaults.
</Step>
<Step title="Run Tests with Debugger and Break On Failure">
Use `--gtest_break_on_failure` and debugger to catch exact failure site.
</Step>
<Step title="Verify Platform-Specific Behavior">
Check for differences in threading, exit codes, or signals on your OS.
</Step>
<Step title="Isolate Flaky Tests">
Repeat tests with `--gtest_repeat` to catch intermittent failures.
</Step>
</Steps>

---

## Troubleshooting Checklist

### Test Fails Immediately
- Verify any failed `ASSERT_*` statements and error messages.
- Confirm test fixture setup and teardown do not contain failing assertions.

### Segfault During Test
- Check for pointer dereference after failed assertions.
- Use tools like AddressSanitizer for memory errors.

### Test Crashes Unexpectedly
- Inspect death tests and signal handlers.
- Check platform-specific limitations, e.g., thread safety on Windows.

### Test Does Not Run or Is Skipped
- Verify test naming conventions; disabled tests use the `DISABLED_` prefix.
- Check filters (`--gtest_filter`) and environment variables.

### Parameterized or Typed Tests Not Executing
- Confirm every `TEST_P` has an `INSTANTIATE_TEST_SUITE_P` unless explicitly allowed.
- Use `GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST` to suppress warnings if needed.

---

## Best Practices to Prevent and Resolve Issues

- **Use ASSERT_* checks before pointer usage** to prevent unexpected crashes.
- **Favor `SetUp()` over constructors** for initialization that might fail.
- **Leverage `SCOPED_TRACE`** to add meaningful debug context.
- **Isolate failing tests with `--gtest_filter`** to reduce noise.
- **Run test repeats with `--gtest_repeat`** to diagnose flaky issues.
- **Understand platform-specific nuances** and consult platform documentation.
- **Use death tests to validate fatal failure scenarios.**
- **Do not mix `TEST` and `TEST_F` in the same test suite.**
- **Always check the return code of `RUN_ALL_TESTS()`.**

---

## Related Documentation

- [GoogleTest Primer](primer.md): Getting started with test writing and execution.
- [Advanced GoogleTest Topics](advanced.md): Detailed assertions, death tests, parameterized tests.
- [Assertions Reference](reference/assertions.md): Comprehensive assertion macros guide.
- [Writing and Running Tests](reference/testing.md#writing-tests): Core test macros and usage.
- [Using SCOPED_TRACE](advanced.md#adding-traces-to-assertions): Debugging with trace contexts.
- [Death Tests](advanced.md#death-tests): Testing process termination scenarios.
- [Test Fixtures and Parameterized Tests](primer.md#same-data-multiple-tests,advanced.md#value-parameterized-tests): Best practices for reusable test code.
- [Troubleshooting Installation & Build Problems](getting-started/support-and-troubleshooting/troubleshooting-setup)

---

## Additional Tips

<Tip>
Always keep your tests independent and concise. Break complex tests into smaller units to facilitate easier debugging.
</Tip>

<Tip>
Use the GoogleTest XML/JSON output feature for integration with CI systems, to get detailed failure insights.
</Tip>

<Tip>
For flaky tests, consider using `--gtest_break_on_failure` with repeated runs to capture the exact failure environment.
</Tip>

---

## Conclusion

Resolving runtime and test issues in GoogleTest involves understanding the nature of assertion failures, crashes, and platform-specific idiosyncrasies. By following the recommended debugging steps, using the powerful GoogleTest features like death tests, `SCOPED_TRACE`, and `HasFatalFailure()`, and adhering to framework best practices, you can efficiently identify root causes and stabilize your test suite.

<Info>
For advanced scenarios, see the [Advanced GoogleTest Topics](advanced.md) and [Debugging Test Failures Guide](guides/real-world-integrations/complex-test-scenarios).
</Info>

---

## Example: Handling a Fatal Assertion to Prevent Segfault

```cpp
void ProcessPointer(int* p) {
  ASSERT_NE(p, nullptr) << "Pointer p should not be null.";
  // Safe to dereference 'p' here.
  *p = 10;
}

TEST(ExampleTest, HandlesNullPointer) {
  int* valid_ptr = new int(5);
  ProcessPointer(valid_ptr);
  delete valid_ptr;

  int* null_ptr = nullptr;
  // This test will abort immediately if ProcessPointer detects null.
  ASSERT_NO_FATAL_FAILURE(ProcessPointer(null_ptr));  // Should abort
}
```

This pattern ensures your test does not crash in case of invalid pointers and reports meaningful failures.

---

## Example: Skipping Tests Based on Conditions

```cpp
TEST(FeatureTest, SkipOnUnsupportedPlatform) {
  if (!IsPlatformSupported()) {
    GTEST_SKIP() << "Skipping test on unsupported platform.";
  }
  EXPECT_TRUE(FeatureFunction());
}
```

This is useful when certain tests are only valid on selected environments.

---