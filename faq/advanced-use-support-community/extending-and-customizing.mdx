---
title: "Can I extend or customize assertions and test behaviors?"
description: "Explains extensibility points in the frameworks for advanced users—including creating custom assertions, parameterized tests, and matchers—while clarifying where to find sample code and advanced guides."
---

# Can I extend or customize assertions and test behaviors?

GoogleTest and GoogleMock provide advanced extensibility points allowing you to create custom assertions, parameterized tests, and matchers tailored precisely to your testing needs. This page explains how you can extend and customize these core behaviors, empowering you to verify complex conditions, simulate nuanced interactions, and express expectations matching your domain logic.

---

## 1. Creating Custom Matchers

Matchers define the criteria by which mock method arguments are validated. While GoogleMock includes many built-in matchers, you may need domain-specific predicates or complex validations that built-in matchers do not cover.

### Approaches for Custom Matchers

- **Matcher Macros (`MATCHER`, `MATCHER_P`, etc.):** Quick and concise way to define custom matchers inline.

  ```cpp
  MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }

  EXPECT_CALL(mock, Bar(IsDivisibleBy7()));
  ```

- **Implementing Matcher Classes:** For more control, especially for polymorphic behavior or to add explanatory messages.

  ```cpp
  class DivisibleBy7Matcher {
   public:
    using is_gtest_matcher = void;

    bool MatchAndExplain(int n, std::ostream* os) const {
      const int remainder = n % 7;
      if (remainder != 0 && os != nullptr) {
        *os << "the remainder is " << remainder;
      }
      return remainder == 0;
    }

    void DescribeTo(std::ostream* os) const {
      *os << "is divisible by 7";
    }

    void DescribeNegationTo(std::ostream* os) const {
      *os << "is not divisible by 7";
    }
  };

  Matcher<int> DivisibleBy7() {
    return DivisibleBy7Matcher();
  }

  EXPECT_CALL(mock, Bar(DivisibleBy7()));
  ```

- **Polymorphic Matchers:** Create matchers usable with multiple argument types.

  ```cpp
  PolymorphicMatcher<NotNullMatcher> NotNull() {
    return MakePolymorphicMatcher(NotNullMatcher());
  }

  EXPECT_CALL(mock, Func(NotNull()));
  ```

### Best Practices for Matchers

- Keep matchers *pure*: no side effects.
- Provide meaningful descriptions to aid failure diagnostics.
- Use the `MATCHER*` macros for simple cases and class implementations for complex logic.

---

## 2. Defining Custom Actions

Actions describe what a mock method should do when invoked. If built-in actions (`Return()`, `Invoke()`, `DoAll()`, etc.) don’t suffice, you can write custom actions.

### Creating Custom Actions

- **Using Lambdas or Callable Objects:** Define the custom behavior concisely.

  ```cpp
  EXPECT_CALL(mock, Foo(_))
      .WillOnce([](int x) { return x * 10; });
  ```

- **Using Legacy Macros (`ACTION`, `ACTION_P`, ...):**

  ```cpp
  ACTION_P(IncrementBy, n) { return arg0 + n; }

  EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementBy(5));
  ```

- **Implementing `ActionInterface<F>`:** For advanced polymorphic actions.

  ```cpp
  template <typename F>
  class MyAction : public ActionInterface<F> {
   public:
    Result Perform(const ArgumentTuple& args) override {
       // Your implementation
    }
  };
  ```

- **Using `MakePolymorphicAction()`:** Wrap polymorphic actions for multiple function signatures.

### Predefined Techniques

- **Invoke function or method:** Call an existing function, method, or functor.
- **InvokeArgument<N>(...):** Invoke the N-th argument of a mock function if it itself is a callable, with arguments.
- **DoAll(...):** Sequence multiple actions where only the last returns a value.
- **IgnoreResult():** Use when you want to discard an action's return value.
- **WithArg, WithArgs, WithoutArgs:** Pass only selected arguments to inner actions.

---

## 3. Parameterized and Typed Tests Integration

GoogleTest supports parameterized and typed tests, enabling you to write test logic once and run it against multiple input values or types. Custom assertions and actions complement this by allowing flexible validation and behavior specification:

- Define custom matchers and actions that work uniformly across parameters.
- Combine parameterized tests with mocks to extensively verify behavior.
- Utilize value and type-parameterized fixtures for reusable tests.

Refer to the [Parameterized and Typed Tests Guide](../guides/writing-effective-tests/test-parameterization) for detailed usage patterns.

---

## 4. Where to Find Examples and Advanced Guides

- Sample code and test cases demonstrating custom matchers and actions come bundled with GoogleTest.
- The [gMock Cookbook](guides/gmock_cook_book.md) contains numerous recipes for creating and applying custom matchers and actions.
- The [Actions Reference](docs/reference/actions.md) details built-in actions and provides syntax examples.
- The [Mocking Reference](docs/reference/mocking.md) elaborates on matching arguments, setting expectations, and customizing mock behaviors.

---

## 5. Practical Tips and Common Pitfalls

- **When to Use Custom Matchers:** If your argument validation logic is complex, repetitive, or specific to your domain, custom matchers keep your tests concise and readable.
- **When to Write Custom Actions:** Use custom actions to simulate complex behaviors or side effects not supported by built-in actions.
- **Avoid Side Effects in Matchers:** Side effects can cause flaky tests and are hard to debug.
- **Beware of Action Sharing:** Sharing stateful actions across expectations can lead to surprising behavior.
- **Use `RetiresOnSaturation()` for Non-Sticky Expectations:** Prevent expectation reuse when it shouldn't happen.

---

## 6. Summary

Extending GoogleTest and GoogleMock via custom matchers, actions, and parameterized tests greatly increases the expressiveness and effectiveness of your tests. Use macros and class-based interfaces to build reusable components that articulate your testing intent clearly and concisely.

For step-by-step instructions, code snippets, and advanced patterns, explore the linked guides and references.

---

## See Also

- [gMock Cookbook](guides/gmock_cook_book.md#NewMatchers)
- [Actions Reference](docs/reference/actions.md)
- [Mocking Reference](docs/reference/mocking.md)
- [Parameterized and Typed Tests](guides/writing-effective-tests/test-parameterization)

---

<Info>
To extend assertions and behaviors, start simple with the `MATCHER` and `ACTION` macros, then progress to class-based implementations for polymorphic matchers and actions. Always test custom components thoroughly to ensure failure messages are clear and behaviors align with expectations.
</Info>
