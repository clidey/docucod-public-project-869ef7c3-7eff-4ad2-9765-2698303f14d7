---
title: "Performance & Scaling Tips"
description: "Recommendations for speeding up tests, handling large test suites efficiently, and leveraging GoogleTest’s built-in options for parallelization and filtering to optimize workflow and resource usage."
---

# Performance & Scaling Tips

GoogleTest and GoogleMock provide powerful tools for writing unit tests and mocks, but large or complex test suites can sometimes lead to slow test executions and resource strain. This page offers practical recommendations to help you speed up tests, efficiently manage large test suites, and leverage GoogleTest’s parallelization and filtering options to optimize your testing workflow.

---

## 1. Speeding Up Test Runs

### Run Tests in Parallel

GoogleTest supports running tests in parallel to utilize multiple CPU cores, dramatically reducing overall test time.

- Use `--jobs=N` (or `-j=N`) where `N` is the number of parallel jobs.
- When using `ctest`, pass `--parallel N` to run tests concurrently.

**Best Practices:**
- Choose a concurrency level matching your CPU count to avoid oversubscription.
- Ensure tests do not share global mutable state or resources without synchronization.

### Filter Tests to Run Only What You Need

Running the full test suite every time can be costly. Use filters to run only relevant tests:

```shell
--gtest_filter=TestSuiteName.TestName
```

- Supports wildcards, e.g., `--gtest_filter=FooTest.*` runs all `FooTest` tests.
- Combine positive and negative filters using `-`.

### Avoid Heavy Setup/TearDown if Possible

Optimize your test fixtures by minimizing expensive operations in `SetUp()` and `TearDown()`.

---

## 2. Handling Large Test Suites Efficiently

### Organize Tests Logically

Segment your large test suite into smaller, focused test cases and test suites. This aids selective execution and maintainability.

### Use Parameterized Tests

Reduce test code duplication by using parameterized tests, which also improve run-time efficiency by consolidating test logic.

### Cache Expensive Computations

Where feasible, cache files, database connections, or state across tests run in the same process to reduce overhead.

---

## 3. Leveraging GoogleTest Options for Optimization

### Test Filtering

The `--gtest_filter` flag lets you specify which tests or suites to run, skipping irrelevant ones.

- Supports colon (`:`) separator for multiple filters.
- Use `*` wildcard for pattern matching.

### Sharding (Splitting Tests Across Machines or Processes)

Split your test set into shards using environment variables:

- `GTEST_TOTAL_SHARDS`: total number of shards
- `GTEST_SHARD_INDEX`: which shard to run (0-indexed)

Within your CI pipeline, run each shard in parallel on different workers.

### Setting Default Test Timeout

Though GoogleTest doesn’t provide a built-in timeout per test, consider using your CI or scripting environment to abort long-running tests.

---

## 4. GoogleMock-Specific Performance Tips

### Minimize Excessive Expectations

Avoid setting too many expectations or overly specific expectations which can slow down matching and verification.

### Use NiceMock for Uninteresting Calls

Mark mocks as `NiceMock` to suppress warnings from uninteresting calls, which can reduce console output clutter and improve test execution speed.

Example:

```cpp
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, Foo()).Times(AtLeast(1));
```

### Avoid Excessive WillOnce Chains

Too many consecutive `WillOnce()` clauses on the same expectation may cause overhead. Use `WillRepeatedly()` when the behavior is uniform after a certain point.

---

## 5. Troubleshooting Performance Bottlenecks

<AccordionGroup title="Common Performance Pitfalls">
<Accordion title="Slow Test Due to Shared State or Resource Contention">
Tests accessing shared global state or external resources can serialize execution and cause bottlenecks.

**Solution:** Use mocks to isolate dependencies or refactor tests to reduce contention.
</Accordion>
<Accordion title="Excessive Logging During Tests">
Verbose logging in tests slows them down.

**Solution:** Use appropriate verbosity levels with `--gmock_verbose` or disable unnecessary logs in production tests.
</Accordion>
<Accordion title="Large Number of Mock Expectations on a Single Object">
Having many expectations on one mock can degrade performance.

**Solution:** Simplify expectations, combine where possible, or split the logic into multiple mocks.
</Accordion>
</AccordionGroup>

---

## 6. Summary of Key Flags and Options

| Flag / Option                 | Purpose                                                      |
|------------------------------|--------------------------------------------------------------|
| `--gtest_filter=PATTERN`      | Runs only selected tests matching the pattern                |
| `--gtest_repeat=N`            | Repeat tests N times to measure stability and performance     |
| `--gtest_shuffle`             | Randomize test execution order to catch inter-test dependencies |
| `--gtest_break_on_failure`    | Stop on first failure to reduce unnecessary test execution    |
| `--gtest_output=xml:[file]`   | Generate XML report for CI systems                            |
| `--jobs=N` or `-j=N`          | Run tests in parallel, using N cores                          |
| `GTEST_TOTAL_SHARDS` & `GTEST_SHARD_INDEX` | Split tests across shards for distributed testing    |

---

## 7. Practical Workflow to Optimize Test Performance

<Steps>
<Step title="Start Small">
Run a filtered subset of tests related to your changes for quick feedback.
</Step>
<Step title="Run Tests in Parallel">
Configure build or test runner to use multiple cores.
</Step>
<Step title="Use Mock Objects Wisely">
Replace expensive dependencies with mocks using GoogleMock.
</Step>
<Step title="Profile and Identify Slow Tests">
Use timing tools or test framework logs to find slow tests or setup code.
</Step>
<Step title="Refactor or Cache Expensive Operations">
Minimize expensive resource usage in setup or across tests.
</Step>
<Step title="Scale with CI Integration">
Shard tests in CI to distribute load and reduce wall time.
</Step>
</Steps>

---

## Additional Resources

- [gtest Help: Test Filtering](https://github.com/google/googletest/blob/main/googletest/docs/AdvancedGuide.md#running-a-subset-of-the-tests)
- [GoogleTest Parallel Tests Integration](https://github.com/google/googletest/blob/main/googlemock/docs/parallel_tests.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#Performance)
- [Core Concepts on Scaling](https://google.github.io/googletest/concepts/extension-and-scalability/scaling-and-integration.html)

> Optimize your test suite to provide faster feedback without compromising coverage or test quality. Leveraging GoogleTest and GoogleMock options smartly ensures efficient use of your development resources.

---