---
title: "Performance and Advanced Usage"
description: "Addresses frequently asked questions about running tests in parallel, optimizing large test suites, and leveraging advanced features like death tests, parameterized and type-parameterized tests."
---

# FAQ: Performance and Advanced Usage

This page addresses common questions about maximizing the efficiency of your tests and unlocking advanced GoogleMock features such as running test suites in parallel, optimizing the performance of large test collections, and using specialized test types like death tests and parameterized tests.

---

## Frequently Asked Questions

### 1. How can I run tests in parallel to speed up execution?

GoogleTest and GoogleMock support parallel test execution by leveraging test runners that create multiple processes running tests concurrently. This strategy is especially beneficial for large test suites, significantly reducing overall testing time.

**Key points to remember:**
- Tests must be independent and isolated, with no shared mutable state that can cause race conditions.
- Avoid relying on global variables or shared resources without proper synchronization.
- Use the `--jobs` or equivalent flag in your test runner or build system to specify the number of parallel jobs.

If you notice ordering dependencies or flaky failures during parallel execution, consider redesigning your tests to be more isolated or use test fixtures cautiously.


### 2. What are best practices for optimizing large test suites?

Running many tests efficiently requires careful management of overhead and dependencies:

- **Minimize setup and teardown costs:** Use test fixtures to share common setup steps.
- **Use `NiceMock` to avoid unnecessary warnings:** This reduces noise from uninteresting calls.
- **Retire expectations once saturated:** Use `.RetiresOnSaturation()` to prevent sticky expectations from causing overhead.
- **Limit verbose logging:** Adjust `--gmock_verbose` flag to `warning` or `error` to reduce output.
- **Leverage selective test execution:** Run subsets of tests when possible during development.

Profiling your test runtime can help identify specific bottlenecks.


### 3. What are Death Tests and when should I use them?

Death tests verify that a piece of code terminates the program (e.g., via `assert`, `exit`, or fatal errors) under certain conditions. They are critical for checking error-handling paths.

**Using death tests effectively:**
- Mark death tests with `TEST_F` and `EXPECT_DEATH` using suitable predicates.
- Keep death tests isolated as they can fork child processes which have significant overhead.
- Avoid overusing death tests; use them only when you must verify program termination.


### 4. How do I write Parameterized Tests and Type-Parameterized Tests?

Parameterized tests let you run the same test logic with different input data or types.

- **Parameterized Tests:** Use `TEST_P` and `INSTANTIATE_TEST_SUITE_P` macros.
- **Type-Parameterized Tests:** Use `TYPED_TEST` and `TYPED_TEST_SUITE` macros to run tests for multiple types.

These features help reduce boilerplate code and increase test coverage by systematic variation.


### 5. How can I handle unexpected or excessive mock calls efficiently?

Use mock strictness wrappers:

- `NaggyMock`: Reports warnings on unexpected calls.
- `NiceMock`: Suppresses warnings for uninteresting calls.
- `StrictMock`: Fails tests on unexpected calls.

In large test suites, prefer `NiceMock` by default and escalate to `StrictMock` for critical checks.

Also, using `.RetiresOnSaturation()` on expectations helps retire them once fulfilled to improve performance.


### 6. How do I leverage advanced features like `.With()`, `.After()`, and `.InSequence()`?

- `.With()` lets you specify a condition that must hold across all arguments together.
- `.After()` enforces call order dependenciesâ€”ensuring some calls happen only after others.
- `.InSequence()` groups multiple expectations to enforce strict call ordering.

Together, these enable precise specification of interaction behaviors and ordering constraints, aiding robust tests that reflect complex real-world usage.


### 7. How do I control mock function behavior for complex use cases?

Use chaining of actions like `WillOnce()`, `WillRepeatedly()`, `DoAll()`, and custom actions via lambdas or `ACTION` macros. You can:

- Return different values on sequential calls
- Set output arguments
- Invoke callbacks
- Delegate to real or fake objects

Advanced control improves expressiveness but balance complexity to keep tests maintainable.


### 8. Can I mock non-virtual or static functions?

Direct mocking of non-virtual or static functions is not supported. Workarounds include:

- Refactoring code to introduce interfaces with virtual functions
- Using dependency injection

GoogleMock provides advanced techniques for mocking non-virtual methods via templates, but static function mocking requires design changes.


### 9. How can I debug issues related to mock expectations?

Run tests with `--gmock_verbose=info` to get detailed tracing of expectation matching.

Check:
- Are expectations set before mock methods are called?
- Do matchers and cardinalities align with your calls?
- Are you handling sequences and ordering constraints properly?

Use the verbose output to identify which expectation matched or failed.


### 10. How to prevent slow compilation when using GoogleMock?

Large mock classes incur compilation overhead due to mocking constructors and destructors.

**Optimization tips:**
- Define constructors and destructors of mock classes outside header files in `.cc` files.
- Reduce the number of mock methods in a single class if possible.
- Avoid `/clr` flag in MSVC when compiling mocks.

---

## Common Issues & Gotchas

- **Sticky Expectations:** Expectations stay active after saturation by default, potentially causing unexpected failures. Use `.RetiresOnSaturation()` if necessary.
- **Uninteresting Calls:** Warnings may appear when mock methods without expectations are called. Use `NiceMock` to suppress if intended.
- **Ordering Problems:** Inconsistent ordering of `EXPECT_CALL` and calls leads to failures; always set expectations before exercising mocks.
- **Default Actions Misuse:** Use `ON_CALL` for default behaviors and `EXPECT_CALL` for expectations; mixing them carefully avoids unexpected behaviors.

---

## Troubleshooting Procedures

If failures occur:

1. Enable `--gmock_verbose=info` for detailed call tracing.
2. Verify that mock objects have virtual destructors to avoid silent memory issues.
3. Check if you over-specified matchers leading to brittle tests.
4. For unexplained failures, narrow down the test inputs and isolate behaviors.

Contact support or community forums if issues persist after basic debugging.


---

## Additional Tips & Best Practices

- Set expectations early and clearly; tests fail fast on violations.
- Avoid over-constraining tests to allow refactoring without excessive test breakage.
- Use sequences and `.After()` to document relative call order explicitly.
- Consider delegating mock behavior to real or fake implementations for complex side effects.
- Use parameterized tests to reduce duplication and improve coverage.
- Regularly profile and measure test suite performance for improvement opportunities.

---

## Related Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Using Built-in Matchers](https://google.github.io/googletest/api/gmock_matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
- [Building and Running Tests](https://google.github.io/googletest/quickstart-cmake.html)

For a holistic understanding, consider exploring the guides on [Test Optimization and Scalability](https://google.github.io/googletest/guides/integration-advanced-optimization/test-optimization-tips.html) and [Test Patterns and Best Practices](https://google.github.io/googletest/guides/best-practices-and-real-world-usage/).


---

##### Last update: GoogleMock FAQ on Performance and Advanced Usage


