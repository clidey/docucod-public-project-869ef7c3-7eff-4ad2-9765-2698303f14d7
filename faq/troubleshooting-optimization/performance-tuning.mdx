---
title: "How can I improve the performance of my test suites?"
description: "Shares strategies for minimizing test execution time and resource consumption, including targeted test selection, parallelization options, and guidelines for writing efficient mocks and assertions."
---

# How Can I Improve the Performance of My Test Suites?

Optimizing the performance of your GoogleTest and GoogleMock test suites is essential to speeding up your development cycle, reducing resource usage, and maintaining stable CI builds. This guide shares practical strategies and guidelines focused specifically on minimizing test execution time and resource consumption.

---

## Targeted Test Selection

Reducing unnecessary test execution is the fastest way to improve overall test suite performance.

- **Run only relevant tests:** Use the `--gtest_filter` flag or the `GTEST_FILTER` environment variable to run subsets of tests matching specific suites or test names. For example:

  ```shell
  ./my_tests --gtest_filter=MySuite.*
  ./my_tests --gtest_filter=*FastTests*
  ./my_tests --gtest_filter=-*Flaky*
  ```

- **Leverage test sharding:** Distribute test execution across multiple machines or shards using `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` environment variables. GoogleTest automatically selects different tests per shard, preventing duplicate work and enabling parallel test runs.

- **Disable flaky or slow tests temporarily:** Prefix test or test suite names with `DISABLED_` to skip them during runs without removing source code.

---

## Parallel Test Execution

GoogleTest natively runs tests sequentially to preserve determinism, but you can achieve parallelism at higher levels.

- **Run multiple test executables concurrently:** Break your tests into multiple smaller executables, each with a focused set of tests, then run them in parallel across CPU cores.

- **Leverage test sharding with CI tools:** Combine the sharding environment variables with your CI system to run shards in parallel.

- **Use test filters and repeat options:** Run only the tests relevant for your changes and repeat them multiple times in parallel to detect flakiness early.

<Tip>
Although GoogleTest does not provide built-in parallel test execution, parallelism can be maximized effectively at the process and CI orchestration levels.
</Tip>

---

## Writing Efficient Tests

### Keep Tests Small and Focused

- Each test should verify one specific behavior or feature. This reduces unnecessary setup and teardown, enabling tests to run faster and easier to understand.

- Avoid overly complex setups in test fixtures if they are not needed for all tests.

### Use Test Fixtures Wisely

- Shared expensive resources across tests in a test suite using `SetUpTestSuite()` and `TearDownTestSuite()` to perform initialization and cleanup once per suite instead of per test.

- Avoid stateful fixtures that cause dependencies between tests, which complicate isolated execution and caching.

### Simplify Assertions and Mocks

- Write lightweight mock objects using GoogleMock that simulate only the essential behavior you need for the tests.

- Avoid heavy computations, I/O, or unnecessary allocations in mocks.

- Use `EXPECT_CALL` and `ON_CALL` judiciously—limit complex matcher or action chains that can slow down the mock dispatch.

- Where possible, avoid over-constraining mocks which may trigger expensive verification logic.

---

## Parallelization and Resource Optimization

### Use Shared Resources Conservatively

- Prefer sharing expensive read-only resources rather than duplicating them.

- When dealing with resources like large data structures, use `SetUpTestSuite()` to initialize once.

- Release resources in `TearDownTestSuite()` to prevent memory leaks and resource exhaustion.

### Optimize Mocks and Assertions

- Use simple matchers and avoid heavy predicates that lead to slower matcher evaluation.

- Keep `WillOnce()` and `WillRepeatedly()` actions simple and avoid complex side-effects in mock method implementations.

- Use `RetiresOnSaturation()` when defining multiple ordered expectations to reduce matcher overhead.

### Minimize Test Dependencies

- Avoid global state and static variables shared between tests that can cause unwanted serialization.

- Design your test suite to allow tests to run independently and in any order.

---

## Guidelines for Writing Efficient Mocks and Assertions

### Keep Expectations Clear and Minimal

- Set only necessary expectations that reflect what is strictly required for the test.

- Use `_` (wildcard matcher) sparingly to avoid unnecessary computational overhead.

- Avoid chaining multiple complex matchers in `EXPECT_CALL` if a simpler matcher suffices.

### Use Actions Efficiently

- Avoid expensive computations in `WillOnce()` or `WillRepeatedly()` clauses.

- Prefer returning simple values or references instead of creating new objects in actions.

- For sequences of actions, use `RetiresOnSaturation()` to retire expectations early and prevent costly repeated checks.

### Measure and Profile

- Use test timing reports (e.g., generated via `--gtest_output=xml:<file>`) to identify slow tests.

- Continuously monitor your test suite to detect performance regressions.

<Tip>
Focus on fast feedback by running a minimal set of fast tests during development and the full suite in CI.
</Tip>

---

## Troubleshooting Performance Bottlenecks

- **Slow initialization:** Profile fixture setup and global environment setups with `SetUp()` and `SetUpTestSuite()`.

- **Flaky or hanging tests:** Isolate and fix tests that occasionally delay progress—flakiness multiplies test duration due to retries.

- **Excessive memory usage:** Use memory tools to detect leaks and reduce mock and fixture resource footprints.

- **Inefficient mock matchers or actions:** Simplify matchers or mock behavior.

- **Tests interfering with each other:** Use test filtering, isolation, and `DISABLED_` prefix to narrow testing scope.

---

## Best Practices Summary

- Use `--gtest_filter` and sharding to target tests narrowly.
- Break large test suites into smaller executables to enable parallel runs.
- Use test suite level fixtures to share expensive setup/teardown.
- Write focused, small tests with minimal mock complexity.
- Prefer simple mock matchers and actions.
- Regularly profile and measure test performance.

---

For comprehensive guidance, consult the [Performance Optimization and Troubleshooting guide](./guides/advanced-usage/performance-optimize) and explore related topics such as [Setting Expectations and Actions](./guides/mocking-patterns/setting-expectations-actions) and [Mock Strictness and Object Lifecycle](./guides/mocking-patterns/mock-strictness-lifecycle).

---

## Additional Resources

- [GoogleTest Flag Reference](https://github.com/google/googletest/blob/main/docs/advanced.md#running-test-programs-advanced-options) - flags controlling filtering, sharding, repetition
- [gMock Best Practices](https://google.github.io/googletest/gmock_cook_book.html) - tips for efficient mocking
- [Test Organization and Integration](./guides/advanced-usage/test-organization-integration) - managing integration points for scalability

---

By carefully applying these strategies, you will ensure your GoogleTest test suites run swiftly and reliably, delivering fast feedback and facilitating continuous integration success.
