---
title: "Frequently Asked Usage Questions"
description: "Provides answers to recurring user queries about writing and running tests with GoogleTest and using the main assertion and mock features. Clarifies expected behaviors and points to the best places in the documentation for further learning."
---

# Frequently Asked Usage Questions

This page addresses common user questions about writing and running tests using GoogleTest with a focus on the main assertion and mocking features. It clarifies expected behaviors, common user challenges, and points to relevant documentation for deeper understanding.

---

## Table of Contents

1. [Common Questions About Writing Tests](#common-questions-about-writing-tests)
2. [Mocking and Expectations FAQs](#mocking-and-expectations-faqs)
3. [Understanding Uninteresting and Unexpected Calls](#understanding-uninteresting-and-unexpected-calls)
4. [Proper Usage of MOCK_METHOD](#proper-usage-of-mock_method)
5. [Handling Overloaded and Special Cases](#handling-overloaded-and-special-cases)
6. [Best Practices and Troubleshooting Tips](#best-practices-and-troubleshooting-tips)
7. [Further Reading and Resources](#further-reading-and-resources)

---

## Common Questions About Writing Tests

### What is the difference between `EXPECT_CALL` and `ON_CALL`?

- `ON_CALL` sets a **default behavior** for mock methods when you don't need to verify specific calls. It does not establish a requirement that the method must be called.
- `EXPECT_CALL` sets both an **expectation** that the method will be called (possibly with certain arguments and cardinalities) *and* optionally its behavior.

**Use `ON_CALL`** for default stubbing and `EXPECT_CALL` when you want to verify interaction.

### How does GoogleTest verify expectations?

- GoogleTest automatically verifies all expectations on mock objects when they are destructed.
- You can manually verify earlier by calling `::testing::Mock::VerifyAndClearExpectations(&mock_object)`.

### What happens if I call a mocked method for which no expectations are set?

- This is an *uninteresting call*. By default, GoogleMock issues a warning but allows it.
- To suppress warnings, use `NiceMock<YourMockClass>` or set an expectation with `.Times(AnyNumber())` explicitly.

---

## Mocking and Expectations FAQs

### Where should I place the `MOCK_METHOD` macro in my mock class?

- Always place `MOCK_METHOD` declarations in the `public:` section of your mock, regardless of the method's access specifier in the base class.
- This allows GoogleMock to access and intercept calls properly.

### How do I mock methods with argument types containing commas (e.g., `std::pair`, `std::map`)?

- Wrap the argument type in parentheses inside `MOCK_METHOD`. For example:

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

- Alternatively, use `using` declarations to create type aliases.

### Can I mock non-virtual methods with GoogleMock?

- Yes, but only via *Hi-perf dependency injection*: create mock classes unrelated to the real class but with matching method signatures.
- This requires using templates or other compile-time polymorphism for dependency injection.

### Can I mock overloaded methods?

- Yes. Mock each overload explicitly using the `MOCK_METHOD` macro with the appropriate signature.
- To resolve ambiguities when setting expectations, you may need to specify the overload explicitly using casting or helper wrappers like `Const()` for const overloads.

---

## Understanding Uninteresting and Unexpected Calls

### What are "uninteresting" and "unexpected" calls?

- An *uninteresting call* is a method call not covered by any `EXPECT_CALL` (no expectation set). GoogleMock issues a warning for these by default.
- An *unexpected call* is a method call that does not match any existing active expectation. This is always an error.

### How do `NiceMock`, `NaggyMock`, and `StrictMock` differ in handling these calls?

| Mock Type   | Behavior on Uninteresting Calls                | Behavior on Unexpected Calls   |
|-------------|------------------------------------------------|-------------------------------|
| `NaggyMock` | Prints warning (default mock behavior)          | Test failure                   |
| `NiceMock`  | Suppresses warnings on uninteresting calls     | Test failure                   |
| `StrictMock`| Treats uninteresting calls as errors (failures)| Test failure                   |

### How can I ignore uninteresting calls without warnings?

- Use `NiceMock` wrapper:

  ```cpp
  NiceMock<MockClass> mock;
  ```

- Or add a catch-all expectation:

  ```cpp
  EXPECT_CALL(mock, Method(_)).Times(AnyNumber());
  ```

---

## Proper Usage of MOCK_METHOD

### What qualifiers can I specify for `MOCK_METHOD`?

- You can specify `const`, `override`, `noexcept`, `Calltype(...)`, and reference qualifiers like `ref(&)`, `ref(&&)`.

- Syntax example:

  ```cpp
  MOCK_METHOD(int, GetValue, (int x) , (const, override, noexcept));
  ```

### Are old `MOCK_METHODn` macros supported?

- Yes, but `MOCK_METHOD` (generic macro) is recommended.
- Old macros differ in argument order and naming.

### How to write `MOCK_METHOD` for template classes?

- Define your mock class as a template and use `MOCK_METHOD` normally inside:

  ```cpp
  template <typename T>
  class MockStack : public StackInterface<T> {
    MOCK_METHOD(void, Push, (const T& item), (override));
  };
  ```

---

## Handling Overloaded and Special Cases

### How to set expectations on overloaded methods?

- Use matchers or static casts to select the overload unambiguously.
- For const overloads, use `Const()` helper:

  ```cpp
  EXPECT_CALL(Const(mock), GetValue()); // for const method
  ```

### Can I mock free functions or static methods?

- Direct mocking is not possible.
- Workaround: wrap free functions in interfaces with virtual methods, then mock those interfaces.

---

## Best Practices and Troubleshooting Tips

### How to avoid "Uninteresting mock function call" warnings?

- Add relevant `EXPECT_CALL` with `.Times(AnyNumber())` for calls you want to ignore but not fail.
- Use `NiceMock` to suppress all such warnings on a mock.

### How to verify expectations before mock destruction?

- Use `::testing::Mock::VerifyAndClearExpectations(&mock_object)` to force verification explicitly.

### What to do when expectations seem not met but test passes?

- Ensure `EXPECT_CALL`s are set **before** exercising the tested code.
- Use `--gmock_verbose=info` to get detailed output on mock method matches.

### How to avoid brittle tests due to ordering of expectations?

- Use `InSequence` or `Sequence` objects to specify call order constraints when necessary.
- Avoid over-specifying call orders unless required.

### How to handle expectations that only apply a limited number of times?

- Use `.RetiresOnSaturation()` to automatically retire expectations when saturated to avoid “sticky” expectation errors.

---

## Further Reading and Resources

For deeper understanding and advanced scenarios, see these key references:

- [Mocking Reference](../reference/mocking.md): detailed API and macro explanations.
- [gMock Cookbook](../gmock_cook_book.md): practical recipes and how-to guides.
- [gMock Cheat Sheet](../gmock_cheat_sheet.md): quick syntax and common patterns.
- [gMock for Dummies](../gmock_for_dummies.md): user-friendly tutorial-style introduction.
- [Strictness and Uninteresting Calls](../mocking-apis/strictness-and-uninteresting-calls.md): handling mock behavior strictness.

Additionally, users should consult the guides on [Creating and Using Mock Objects](../guides/mocking-guide/mocking-basics.md) and [Advanced Mocking Patterns](../guides/mocking-guide/advanced-mocking.md).

---

For help running tests and interpreting output, consult the [Running and Interpreting Your Tests](../../guides/gtest-core-guides/running-tests.md) page.


<Tip>
Always set expectations before running the code under test to ensure accurate test behavior verification.
</Tip>

<Note>
Uninteresting calls are not failures by default but may indicate missing or incomplete expectations.
</Note>

<Warning>
Over-specifying call orders or matchers can lead to brittle tests; prefer verifying only what matters.
</Warning>

<Info>
Using `--gmock_verbose=info` is the fastest way to diagnose inattentive mock expectation matches.
</Info>

---

### Example Scenario: Using `EXPECT_CALL` and `ON_CALL`

```cpp
using ::testing::Return;
using ::testing::_;

class MockFoo {
 public:
   MOCK_METHOD(int, GetValue, (), (override));
};

TEST(FooTest, Example) {
  MockFoo mock_foo;

  // Set default behavior for GetValue
  ON_CALL(mock_foo, GetValue()).WillByDefault(Return(10));

  // Expect GetValue to be called exactly twice
  EXPECT_CALL(mock_foo, GetValue()).Times(2);

  // Exercise code
  EXPECT_EQ(10, mock_foo.GetValue());
  EXPECT_EQ(10, mock_foo.GetValue());
}
```

This test sets a default behavior and a strict expectation on the number of calls.

---

### Common Pitfall: Sticky Expectations Without `.RetiresOnSaturation()`

If you write multiple `EXPECT_CALL` statements on the same method without retiring each expectation after saturation, the latter calls may unexpectedly fail. To avoid this, chain `.RetiresOnSaturation()` or combine all calls in one expectation with multiple `.WillOnce()` clauses inside a sequence.

```cpp
using ::testing::InSequence;
using ::testing::Return;

{
  InSequence s;
  EXPECT_CALL(mock, Foo()).WillOnce(Return(1)).RetiresOnSaturation();
  EXPECT_CALL(mock, Foo()).WillOnce(Return(2)).RetiresOnSaturation();
}
```

---