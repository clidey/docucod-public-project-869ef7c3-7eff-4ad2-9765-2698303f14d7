---
title: "How can I speed up test execution?"
description: "Discusses strategies for optimizing test execution—from parallel test running to minimizing setup/teardown overhead and using best practices for large test suites."
---

## How Can I Speed Up Test Execution?

When working with extensive C++ test suites, especially large-scale projects, reducing test execution time is crucial for maintaining development velocity and continuous integration efficiency. GoogleTest provides several strategies and best practices to optimize your test execution, from parallelization techniques to resource sharing and minimizing overhead.

This guide highlights practical ways to accelerate your test runs without sacrificing test reliability or coverage.

---

### 1. Parallel Test Execution Using Sharding

GoogleTest supports *test sharding*, a method to split tests across multiple machines or processes to run concurrently, dramatically reducing total execution time.

**How it works:**
- The test suite is divided into *shards*.
- Environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` determine the number of shards and the current shard index.
- Each shard runs a different subset of tests, ensuring every test is run exactly once across all shards.

**Setup steps:**

```shell
# Example: distribute across 3 shards on 3 machines
export GTEST_TOTAL_SHARDS=3

# Machine 0
export GTEST_SHARD_INDEX=0
./your_test_binary

# Machine 1
export GTEST_SHARD_INDEX=1
./your_test_binary

# Machine 2
export GTEST_SHARD_INDEX=2
./your_test_binary
```

<Info>
The test runner must be responsible for launching tests on the shards with the appropriate environment variables set before running the test binary.
</Info>

**Benefits:**
- Tests run in parallel without needing internal test modifications.
- Maintains test isolation and correctness.

**Caveats:**
- You must ensure any shared state is compatible with sharding.
- Sharding is designed for separate machines or isolated processes.

See the [Running Test Programs: Advanced Options](advanced.md#distributing-test-functions-to-multiple-machines) for detailed usage.

---

### 2. Sharing Expensive Resources Among Tests

By default, GoogleTest creates a fresh test fixture object for each test, calling `SetUp()` and `TearDown()` before and after each test, respectively. This guarantees isolation but can become expensive if these setup or teardown steps allocate or initialize costly resources.

**Optimize by sharing resources at the test suite level instead of the individual test level:**

- Declare shared resources as `static` members in your test fixture class.
- Implement `static void SetUpTestSuite()` and `static void TearDownTestSuite()` for setting up and cleaning these shared resources.

Example:

```cpp
class FooTest : public testing::Test {
 protected:
  static ExpensiveResource* shared_resource_;

  static void SetUpTestSuite() {
    shared_resource_ = new ExpensiveResource(...);
  }

  static void TearDownTestSuite() {
    delete shared_resource_;
    shared_resource_ = nullptr;
  }

  void SetUp() override {
    // Use shared_resource_ as needed
  }
  void TearDown() override {
    // Clean up per-test state if needed
  }
};

ExpensiveResource* FooTest::shared_resource_ = nullptr;

TEST_F(FooTest, TestOne) {
  // Use shared_resource_
}

TEST_F(FooTest, TestTwo) {
  // Use shared_resource_
}
```

<Check>
Ensure your tests don't modify the shared resources or if they do, restore the prior state before finishing so other tests are not adversely affected.
</Check>

---

### 3. Minimizing Setup/TearDown Overhead

- Avoid performing heavy setup in per-test `SetUp()` and prefer `SetUpTestSuite()` when sharing is feasible.
- Keep `TearDown()` lightweight to prevent bottlenecks.
- Use test fixtures judiciously—avoid unnecessarily complex fixtures that slow down test instantiation.

---

### 4. Test Ordering and Shuffling

GoogleTest can *shuffle* test execution order with the `--gtest_shuffle` flag. While shuffling is intended to uncover test interdependencies (which is valuable), it can lead to slower runs due to randomization overhead.

If you want to optimize for speed, consider disabling shuffling for routine test execution.

```shell
./your_test_binary --gtest_shuffle=0
```

If enabled, GoogleTest outputs the random seed used so that failures can be reproduced by specifying `--gtest_random_seed`.

---

### 5. Test Repetition and Flakiness Detection

Using `--gtest_repeat=N` runs all tests N times. While this can increase time, it helps detect flaky tests that may interfere with reliable test execution and thus prevent wasted debugging time.

To speed up your workflow:
- Use repeat runs selectively.
- Adjust your environment to avoid rebuilding or resetting if the setup is costly, by using `--gtest_recreate_environments_when_repeating=false`.

---

### 6. Skipping Tests Programmatically

If certain tests are slow or environment-dependent, use `GTEST_SKIP()` at runtime to skip them:

```cpp
TEST(MyTestSuite, SlowTest) {
  if (!EnvironmentSupportsFeature()) {
    GTEST_SKIP() << "Skipping because feature not supported";
  }
  // Test code here
}
```

Skipping tests rather than disabling allows the rest of the suite to run fast while keeping skipped tests visible.

---

### 7. Best Practices and Tips

- **Design tests to be independent and fast:** Avoid sharing state that serializes test execution.
- **Use value-parameterized and typed tests:** Consolidate repetitive test logic while covering multiple inputs or types efficiently.
- **Avoid unnecessary global resources:** Use fixtures responsibly to prevent contention.
- **Monitor test suite performance:** Take advantage of GoogleTest's XML or JSON output to identify slow tests.
- **Consider selective test filtering:** Use `--gtest_filter` to run only subsets during development.

---

### 8. Troubleshooting Common Performance Issues

- **Setup/TearDown is slow:** Profile your test fixture setup and teardown logic.
- **Test ordering causes dependencies:** Use shuffling to detect inter-test dependencies and fix them.
- **Flaky tests:** Use repeating runs to identify non-deterministic tests.
- **Parallel execution problems:** When using sharding, ensure your tests and environment are thread-safe and shard-safe.

Refer to the [Performance and Scaling Guide](guides/advanced-patterns-integration/performance-and-scaling.mdx) for in-depth strategies and to the [Troubleshooting Guide](faq/troubleshooting-and-integration/test-failures-debugging.mdx) for diagnosing failures that can impact overall test runtime.

---

### Additional Resources

- [Advanced GoogleTest Topics](advanced.md): Further coverage of test execution flags, death tests, and performance tuning.
- [Test Macros and Test Registration](api-reference/core-apis/test-macros.md): Learn about different test definition macros.
- [Parameterized Tests](api-reference/advanced-features/parameterized-tests.md): Writing reusable tests over data and types.
- [Global Set-Up and Tear-Down](advanced.md#global-set-up-and-tear-down): Managing expensive resources shared across the entire test run.

---

With these strategies, you can tailor your GoogleTest suite to maximize speed and scalability while maintaining robust and reliable test coverage.