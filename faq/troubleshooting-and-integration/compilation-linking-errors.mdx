---
title: "How do I fix common compilation or linking errors?"
description: "Solutions for typical build and linker errors when using GoogleTest/GoogleMock with various compilers and platforms, such as missing headers, ABI incompatibilities, or undefined references."
---

# How do I fix common compilation or linking errors?

GoogleTest and GoogleMock are robust and widely used C++ testing frameworks, but integrating them can sometimes lead to typical build and linker errors. This guide walks you through practical solutions to common issues such as missing headers, ABI incompatibilities, and undefined references, helping you troubleshoot and resolve them efficiently.

---

## 1. Common Compilation Errors

### Missing Headers or Files

**Problem:** Your compiler reports errors like `fatal error: gtest/gtest.h: No such file or directory`.

**Why It Happens:** Your build system is unable to locate the GoogleTest headers.

**Solution:**

- Verify that the include paths in your build configuration correctly point to the GoogleTest installation or source directory.
- If using CMake, ensure you have configured `target_include_directories` properly or imported GoogleTest via `find_package(GTest REQUIRED)`.
- When building GoogleTest from source, include the `googletest/include` directory.

<Check>
Always confirm your build system can resolve the include path for GoogleTest headers.
</Check>

---

### Incompatible or Missing C++ Standard Support

**Problem:** Errors such as `error: invalid use of 'auto'` or similar syntax-related errors.

**Why It Happens:** GoogleTest requires C++17 or higher to build.

**Solution:**

- Set your compiler to use at least C++17 standard. For example, with GCC/Clang:
  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```
- Verify your build flags include appropriate `-std=c++17` (or equivalent).

<Note>
If you’re embedding GoogleTest in a C project or legacy setup, ensure the build flags explicitly enable C++17 for the test components.
</Note>

---

### Macro Name Conflicts

**Problem:** Compilation errors due to macro redefinition, especially with assertions like `ASSERT_EQ`.

**Why It Happens:** Macros do not obey namespaces and can clash with other libraries.

**Solution:**

- Use the macro control flags to rename conflicting macros. For instance, add to your compiler flags:
  ```
  -DGTEST_DONT_DEFINE_ASSERT_EQ=1
  ```
- Then use the renamed macro `GTEST_ASSERT_EQ` instead of `ASSERT_EQ`.

---

## 2. Linker Errors

### Undefined References to GoogleTest Symbols

**Problem:** Linker errors such as `undefined reference to 'testing::Test::Run()'` or `undefined reference to 'RUN_ALL_TESTS'`.

**Why It Happens:**

- GoogleTest libraries are not linked properly.
- Missing `main()` function or incorrect linkage.

**Solution:**

- If you do _not_ define your own `main()` function, link your test executable against `gtest_main` instead of `gtest`:
  ```cmake
  target_link_libraries(your_test_executable gtest_main)
  ```
  This provides a ready-made main function.
- If you need a custom `main()`, link with `gtest` only and define your own `main()` that initializes and runs all tests.

### ABI Incompatibility

**Problem:** Linker or runtime errors caused by ABI mismatches, such as linking with libraries compiled with different compiler or debug/release flags.

**Why It Happens:** Different parts of your project are compiled with inconsistent settings.

**Solution:**

- Ensure GoogleTest and your test code are compiled with the exact same compiler and flags, including runtime library options (e.g., static vs dynamic CRT on Windows).
- For Visual Studio, set the `gtest_force_shared_crt` CMake option if your project uses dynamic CRT to align GoogleTest’s CRT linkage.
- Verify that both GoogleTest and your test code use the same debug or release configuration.

<Check>
Run `cmake .. -DGTEST_FORCE_SHARED_CRT=ON` when generating build files to match the CRT linkage if needed.
</Check>

### Missing GoogleMock Symbols

**Problem:** Link errors relating to `gmock` symbols or undefined references to mock methods.

**Why It Happens:**

- GoogleMock source or library is not linked in your test executable.

**Solution:**

- Include GoogleMock sources or link explicitly to `gmock` and `gmock_main` when using mocks.
- If using CMake, add:
  ```cmake
  target_link_libraries(your_test_executable gmock_main)
  ```
  or separately `gmock` and a main if custom entry point is provided.

---

## 3. Platform-Specific Considerations

### Windows Specific Issues

- **Issue:** Runtime mismatch errors such as `mismatch detected for 'RuntimeLibrary'`.

- **Fix:** Make sure that all modules, including GoogleTest, are built with matching runtime options (static `MT` vs dynamic `MD`). Use the `gtest_force_shared_crt` CMake option to enforce dynamic CRT linkage if your application requires it.

### Linux/macOS Specific Issues

- Make sure `pthread` is linked when building tests that leverage thread features. For example, add `-pthread` in your compiler and linker flags or let CMake handle it automatically.

---

## 4. Practical Troubleshooting Workflow

Follow this step-by-step approach to efficiently identify and fix build issues:

<Steps>
<Step title="Verify Header Inclusion">
Confirm your project’s build system correctly includes the GoogleTest headers paths.
</Step>
<Step title="Check Compiler Flags">
Ensure C++17 is enabled and all related flags align with your environment.
</Step>
<Step title="Link Required Libraries">
Link to the correct GoogleTest libraries (`gtest` or `gtest_main`, `gmock` if needed).
</Step>
<Step title="Inspect Runtime Library Conflicts">
Check and resolve differences in debug/release and static/dynamic CRT settings.
</Step>
<Step title="Build Incrementally">
Build GoogleTest standalone and link test executables incrementally to isolate errors.
</Step>
<Step title="Search for Conflicting Macros">
If macro conflicts arise, use the `GTEST_DONT_DEFINE_FOO` macros in compiler flags.
</Step>
<Step title="Utilize Verbose Build Logs">
Enable verbose compiler/linker output to catch missing link flags or incorrect paths.
</Step>
<Step title="Consult GoogleTest Documentation and Source">
Review the official GoogleTest Primer and README for build guidance.
</Step>
</Steps>

---

## 5. Helpful Tips and Best Practices

- **Use CMake:** Leverage GoogleTest’s built-in CMake scripts for a consistent build environment across platforms.

- **Prefer `gtest_main` for Entry-Point:** For most cases, link against `gtest_main` to avoid writing your own `main()` function.

- **Define Custom Macros Only When Necessary:** Avoid macro name conflicts with third-party libraries by configuring or renaming macros during compilation.

- **Build GoogleTest as Part of Your Project:** Embedding GoogleTest source in your codebase reduces ABI mismatches and compiler flag discrepancies.

- **Check Compiler and Linker versions:** Some older compilers or toolchains might not support required language or linking features.

---

## 6. Example CMake Setup Snippet for Common Use Case

```cmake
# Add GoogleTest sources
add_subdirectory(googletest)

# Your test executable
add_executable(MyTest test_main.cpp my_class_test.cpp)
target_link_libraries(MyTest gtest_main)  # or gmock_main if using mocks

# Use C++17 standard
set_target_properties(MyTest PROPERTIES CXX_STANDARD 17 CXX_STANDARD_REQUIRED ON)
```

---

## 7. Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest Build Instructions (googletest/README.md)](https://github.com/google/googletest/blob/main/googletest/README.md)
- [Testing Reference (docs/reference/testing.md)](https://github.com/google/googletest/blob/main/docs/reference/testing.md)
- [Supported Platforms](https://github.com/google/googletest/blob/main/docs/platforms.md)

For more complex or platform-specific issues, consult your compiler or platform documentation alongside GoogleTest’s guides.

<Tip>
Remember: consistent tooling and build settings across GoogleTest and your own codebase are key to hassle-free compilation and linking.
</Tip>

---

If you remain stuck, please consider seeking help in the [GoogleTest community](https://groups.google.com/g/googletestframework) or opening an issue after confirming your setup with the guides provided.