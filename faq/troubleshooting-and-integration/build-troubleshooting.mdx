---
title: "How do I troubleshoot build and linking problems?"
description: "Solutions to common issues related to building and linking GoogleTest and GoogleMock libraries, such as resolving undefined references, ABI or compiler conflicts, and proper usage of main functions for test runners."
---

# How do I troubleshoot build and linking problems?

This page provides solutions to common issues related specifically to building and linking the GoogleTest and GoogleMock libraries in your projects. These problems often manifest as undefined references, ABI incompatibilities, or conflicts with your compiler setup, and can prevent you from successfully running your tests.

---

## Frequently Asked Questions

### Why am I getting undefined references to GoogleTest or GoogleMock symbols during linking?

Undefined references typically indicate that your linker cannot find the implementations of GoogleTest or GoogleMock functions. This happens when:

- The GoogleTest/GoogleMock libraries are not linked correctly to your test executable.
- The build system configuration does not properly include or link the necessary static or shared libraries.

**Solution:**

- Ensure you have linked the `gtest` and `gmock` libraries explicitly in your build scripts (e.g., CMake, Bazel).
- For CMake, confirm you are linking against the correct targets, such as `gtest`, `gmock`, and optionally `gmock_main` if you want the GoogleTest main() integration.
- Verify that the compiled library files exist and your linker search paths include their locations.

### I get ABI or compiler compatibility errors when linking. What should I check?

GoogleTest and GoogleMock are sensitive to compiler versions and ABI compatibility. Using different compilers or mismatched standard library versions between your project and the GoogleTest/GoogleMock binaries can cause linking or runtime errors.

**What to do:**

- Confirm that your project and GoogleTest/GoogleMock are compiled with the same compiler and with consistent flags (especially the C++ standard version; GoogleTest requires at least C++17).
- Rebuild GoogleTest/GoogleMock from source using the same compiler and flags as your project.
- Check platform support and compiler compatibility in the [Supported Platforms & Integrations](https://github.com/google/googletest/blob/main/docs/FAQ.md#supported-platforms) sections.

### How do I handle the GoogleTest main function when linking multiple test files?

GoogleTest provides a main() function to run tests, commonly included by linking to the `gtest_main` or `gmock_main` library. Conflicts can occur if:

- You have multiple definitions of main(), perhaps because you define your own main and also link `gtest_main`.
- You fail to link to any main function, resulting in undefined reference errors.

**Recommendations:**

- If you want to use GoogleTest’s provided main(), link your test executables against `gtest_main` (or `gmock_main` if using mocks).
- If you define your own main(), do **not** link `gtest_main` or `gmock_main`.
- Make sure only one main() is defined in your test executable.

### What about build system integration best practices?

Integrating GoogleTest and GoogleMock correctly into your build system is key to avoiding build and linking problems.

**For CMake:**

- Use `FetchContent` or external project commands to download and build GoogleTest/GoogleMock.
- Link test executables with targets `gtest`, `gmock`, and `gmock_main` as needed.
- Include the GoogleTest include directories properly.

**For Bazel:**

- Use the official [Bazel build rules](https://github.com/bazelbuild/rules_googletest) for GoogleTest and GoogleMock.
- Declare the appropriate `deps` on `@com_google_googletest//:gtest` or `@com_google_googletest//:gmock`.

**Always:**

- Ensure you call `testing::InitGoogleMock()` or `testing::InitGoogleTest()` properly in your main function or test setup.
- Validate that the compiler flags for C++17 are set consistently for both your code and GoogleTest/GoogleMock.

### What flags or options can help during troubleshooting?

- Use the `--gmock_verbose` flag to get more detailed logs when running tests, which can shine a light on linking or runtime issues:
  - `--gmock_verbose=info` for detailed logs,
  - `warning` (default) for warnings,
  - `error` for errors only.

- Enable verbose logging in your build system (e.g., `make VERBOSE=1`, or CMake's `--trace` options) to track compiler and linker commands.

---

## Common Build and Linking Issues

### 1. Missing library linkage

**Issue:** Undefined references to `testing::InitGoogleMock()`, `testing::Test`, or mock method symbols.

**How to fix:**

- Link with `-lgmock -lgtest -lpthread` (or the equivalent targets in your system).
- When using CMake, link your executable with `gtest`, `gmock`, and `gmock_main` targets.

### 2. Multiple main() definitions

**Issue:** Linker error about multiple `main` functions.

**How to fix:**

- Link against only one main function provider: either use GoogleTest’s `gtest_main` or define your own.
- Avoid linking `gmock_main` and defining your own `main()`.

### 3. ABI incompatibilities

**Issue:** Errors caused by mixing different compiler settings or versions.

**How to fix:**

- Rebuild GoogleTest and GoogleMock from source with the exact compiler and flags used by your project.
- Use consistent standard library versions and C++ standards (e.g., C++17).

### 4. Order of linking libraries

**Issue:** Linker fails to resolve symbols when the order of libraries is incorrect.

**How to fix:**

- Place the GoogleTest and GoogleMock libraries after your object files and any dependencies.
- For gcc/clang, ensure `-lgtest` and `-lgmock` occur after your source objects on the linker command line.

---

## Tips and Best Practices

- Prefer modular build integration techniques like CMake `FetchContent` to keep GoogleTest/GoogleMock versions consistent with your project.
- Avoid linking in multiple versions of GoogleTest or GoogleMock (e.g., one from your system and one from vendored source).
- Apply strict compiler flags uniformly including the `-std=c++17` requirement, as GoogleTest requires C++17 or newer.
- When using mocks, link with `gmock` and `gmock_main` as needed, and remember to initialize GoogleMock.
- Leverage the extensive logging flags (`--gmock_verbose`) during test runtime to identify linking or runtime problems referencing mocks.

---

## Troubleshooting Step-by-Step

<Steps>
<Step title="Verify Compiler and C++ Standard">
Ensure your compiler supports at least C++17 and that both your project and GoogleTest/GoogleMock code are compiled with the same standard.
</Step>
<Step title="Check Library Locations and Linkage">
Confirm the presence of `libgtest.a`, `libgmock.a`, or their dynamic equivalents, and make sure your linker includes them.
</Step>
<Step title="Review Build System Script">
Inspect your CMakeLists.txt or Bazel BUILD files for proper GoogleTest/GoogleMock inclusion and linking.
</Step>
<Step title="Avoid Multiple main() Definitions">
Verify that only one main() function exists, either provided by GoogleTest/GoogleMock or your own.
</Step>
<Step title="Clean and Rebuild Dependencies">
Rebuild GoogleTest/GoogleMock sources cleanly with your compiler configuration to avoid ABI problems.
</Step>
<Step title="Run Tests with Verbose Logging">
Use the `--gmock_verbose=info` flag for detailed runtime insights.
</Step>
</Steps>

---

## Troubleshooting Common Error Messages

| Error Message | Meaning | Resolution |
|---------------|---------|------------|
| Undefined reference to `testing::InitGoogleMock()` | Missing GoogleMock library linkage | Link against `gmock` and `gmock_main` libraries |
| Multiple definition of `main` | Conflicting main functions | Use either your own `main()` or GoogleTest/GoogleMock's `gtest_main`/`gmock_main`, not both |
| ABI incompatibility errors | Compiler or stdlib version mismatch | Rebuild GoogleTest/GoogleMock with your compiler, standard, and flags |
| Unrecognized option for C++ version | Compiler does not support required C++17 | Upgrade compiler or set correct flags |

---

## Useful References and Further Reading

- [GoogleTest and GoogleMock Installation and Setup](https://github.com/google/googletest/blob/main/docs/FAQ.md#how-do-i-install-and-set-up-googletestgooglemock)
- [Build Integration with CMake and Bazel](https://google.github.io/googletest/integration.html)
- [Supported Platforms & Compilers](https://github.com/google/googletest/blob/main/docs/FAQ.md#which-platforms-and-compilers-are-supported)
- [Using Mocks: Best Practices and Common Errors](https://google.github.io/googletest/gmock_for_dummies.html)
- [GoogleMock's Verbosity Flag Documentation](https://google.github.io/googletest/gmock_cook_book.html#controlling-how-much-information-gmock-prints)

---

<Note>
If you need help with resolving linking errors, enabling verbose build and test logs often reveals missing or misconfigured link commands. Always validate your build environment for consistent tools, flags, and library versions.
</Note>

---

For comprehensive guides on writing tests and mocks, consult the [Writing and Running Unit Tests](../guides/core-workflows/writing-tests.md) and [Using Mocks for Dependency Isolation](../guides/core-workflows/using-mocks.md) documentation.

---

_Last updated: Branch `main` of GoogleTest repository_

# End of Troubleshooting Guide
