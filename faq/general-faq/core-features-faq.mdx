---
title: "Working with Assertions, Matchers, and Mocks"
description: "Explains typical questions on using assertions, parameterized tests, death tests, and the basics of defining and using mocks (MOCK_METHOD, EXPECT_CALL). Helps users understand the framework vocabulary, setup patterns, and key capabilities."
---

# Frequently Asked Questions: Working with Assertions, Matchers, and Mocks

This page clarifies common questions and practical guidance regarding the use of assertions, parameterized and death tests, as well as defining and using mock objects with GoogleTest and GoogleMock. It empowers you to write effective tests by mastering core vocabulary, setup patterns, and capabilities without overwhelming technical details.

---

## 1. GoogleTest Assertions: Core Concepts

### What is the difference between `EXPECT_` and `ASSERT_` assertions?

- **`EXPECT_` assertions** record a failure if the check fails but allow the test to continue.
- **`ASSERT_` assertions** abort the current function immediately on failure.

Use `EXPECT_` when you want to verify multiple conditions in a test and `ASSERT_` when subsequent code depends on a condition being true.

### How can I use parameterized tests to run the same test logic for many inputs?

GoogleTest supports **parameterized tests** allowing you to run a test case with different values.

- Define the test fixture deriving from `::testing::TestWithParam<Type>`.
- Use `TEST_P` macro instead of `TEST_F`.
- Register parameter instances (values) with `INSTANTIATE_TEST_SUITE_P`.

Example:

```cpp
class MyParamTest : public ::testing::TestWithParam<int> {};

TEST_P(MyParamTest, IsEven) {
  int value = GetParam();
  EXPECT_EQ(value % 2, 0);
}

INSTANTIATE_TEST_SUITE_P(EvenNumbers, MyParamTest, ::testing::Values(2, 4, 6, 8));
```

### What are death tests and when should I use them?

**Death tests** verify that a piece of code terminates (dies) as expected, usually in response to a fatal error.

- Use macros like `EXPECT_DEATH(statement, regex)` where `statement` is expected to crash and `regex` matches the error output.
- Useful for testing error handling, assertion failures, or fatal conditions.

Be aware death tests run in a separate process and may be slower.

---

## 2. Introduction to Mocking with GoogleMock

### What is a mock and why do I need mock methods?

A **mock object** simulates behavior of real objects for interaction-based testing:

- Allows verifying which methods are called, how many times, and with what arguments.
- Helps isolate the code under test from dependencies.

You define mock methods using the `MOCK_METHOD` macro inside a mock class.

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x), (override));
};
```

### How do I define mock methods correctly?

- Mock methods must be placed in the `public:` section of the mock class, **even if the base class methods are protected or private**.
- The `MOCK_METHOD` macro takes the return type, method name, arguments (in parentheses), and optional specifiers like `const` and `override`.
- When argument or return types have commas (e.g., templates), either wrap the type with parentheses or create a type alias.

Example:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

### How can I handle overloaded methods?

- Mock all overloads you want with `MOCK_METHOD` specifying the proper signature.
- For overloads you don't want to mock, use `using` to bring base class methods into scope and prevent hiding.

Example:

```cpp
MOCK_METHOD(int, Add, (int x), (override));
MOCK_METHOD(int, Add, (int times, int x), (override));
using Foo::Add;  // Bring in other overloads
```

### How do I specify expectations on mock methods?

Use `EXPECT_CALL(mock_object, Method(matchers))` before exercising the code under test.

- `EXPECT_CALL` both sets an expectation that the method will be called matching specified arguments and optionally defines the behavior for calls.
- Use argument matchers like `_` (wildcard), `Eq(value)`, or complex matchers to specify what arguments to expect.

Example:

```cpp
EXPECT_CALL(mockFoo, Bar(Eq(5)))
    .Times(1)
    .WillOnce(Return(10));
```

### What’s the difference between `ON_CALL` and `EXPECT_CALL`?

- **`ON_CALL`** sets default behavior for calls but does *not* require or verify that the calls occur.
- **`EXPECT_CALL`** sets an expectation that calls must occur according to the specification and also sets the behavior.

Use `ON_CALL` for common default behavior and `EXPECT_CALL` when you want to enforce call expectations.

### How do I suppress warnings about uninteresting calls?

- **Uninteresting calls** are calls to mock methods without an expectation set.
- By default, GoogleMock warns about these but does not fail the test.
- To suppress warnings, use `NiceMock<T>` or explicitly add `EXPECT_CALL` with `.Times(AnyNumber())`.

Example:

```cpp
NiceMock<MockFoo> mockFoo;
```

or

```cpp
EXPECT_CALL(mockFoo, Bar(_)).Times(AnyNumber());
```

---

## 3. Advanced Expectations and Actions

### How can I specify the number of expected calls (cardinality)?

GoogleMock supports many cardinalities in `Times()`:

| Cardinality       | Meaning                          |
|-------------------|--------------------------------|
| `AnyNumber()`     | Method can be called any number |
| `AtLeast(n)`      | Called at least n times          |
| `AtMost(n)`       | Called at most n times           |
| `Between(m, n)`   | Called between m and n times     |
| `Exactly(n)` or `n` | Called exactly n times        |

If `Times()` is omitted, it is inferred from the number of `WillOnce()` and `WillRepeatedly()` clauses.

### How do I specify the order of expected calls?

- Use `InSequence` to make a set of expectations run in order.

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Foo(1));
  EXPECT_CALL(mock, Bar(2));
}
```

- Use `EXPECT_CALL().After()` to specify an expectation must happen after others.

- You can combine multiple `Sequence` objects to express partial orders.

### What if I want to combine multiple actions or define custom behavior?

- Use built-in actions like `Return()`, `ReturnRef()`, `SetArgPointee()`, and `DoAll()` to combine multiple behaviors.
- Use lambda functions or callable objects with `Invoke()` to customize behavior.

Example:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));

EXPECT_CALL(mock, Bar(_))
    .WillOnce([](int x) { return x + 42; });
```

### How do I control mock behavior for uninteresting calls?

- By default, uninteresting calls trigger warnings.
- Use wrappers `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>` to control verbosity and test strictness.

---

## 4. Common Issues and Pitfalls

### Why am I getting warnings about uninteresting calls even though I set `ON_CALL`?

`ON_CALL` sets default behaviors but does **not** declare expectations. Uninteresting calls do not violate test success but trigger warnings.

To avoid warnings, either:

- add `EXPECT_CALL` with `.Times(AnyNumber())` to explicitly expect those calls, or
- wrap your mock in `NiceMock`.

### What if my test fails because calls happen more or fewer times than expected?

- Carefully specify `Times()` with appropriate cardinalities.
- Use `.RetiresOnSaturation()` if you want an expectation to become inactive after the specified calls.

### Why does my test produce errors mentioning “mock function called more times than expected”?

You probably have an expectation with an upper bound cardinality that is exceeded by the code under test.

Consider relaxing the constraint with `AtLeast()`, `AnyNumber()`, or adding additional expectations.

### What if my mock class compilation is slow?

- Move constructors and destructors of mock classes to `.cc` files instead of inline to reduce compile times.

### Can I mock non-virtual or free functions?

- GoogleMock can mock only virtual or overridable methods.
- For non-virtual or free functions, consider introducing interfaces or wrappers that can be mocked.
- For non-virtual functions, high-performance dependency injection via templates can be used.

---

## 5. Practical Tips & Best Practices

- Always place `MOCK_METHOD` declarations in `public:`.
- Use `EXPECT_CALL` sparingly to verify behavior you care about.
- Use `ON_CALL` to set default mock behavior shared across tests.
- Prefer `NiceMock` over the default to reduce clutter from uninteresting call warnings.
- Use `InSequence` or `After` clauses to express call ordering when it reflects real usage.
- Wrap complex argument matching with built-in or custom matchers rather than exact values.
- Remember expectations must be set **before** the code under test calls the mock methods.

---

## 6. References and Further Reading

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical recipes and examples
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner friendly introduction
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Full API details including macros and classes
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) — Comprehensive matcher list
- [Actions and Macros](https://google.github.io/googletest/reference/actions.html) — How to customize mock behaviors
- [Expectations Guide](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL) — How to write expectations

Also consult the following for contextual understanding:

- "Supported Platforms & Requirements" (installation pre-requisites)
- "Create Your First Test"
- "Troubleshooting Setup Issues"

---

This FAQ equips you with the understanding to confidently write, configure, and troubleshoot tests based on assertions, matchers, and mocks in GoogleTest and GoogleMock, fostering robust, maintainable test suites.