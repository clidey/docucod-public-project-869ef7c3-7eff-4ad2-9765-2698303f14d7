---
title: "Extending and Customizing the Framework"
description: "Explains how to write custom assertions, matchers, and test utilities. Highlights points of extensibility with code references."
---

# Extending and Customizing the Framework

GoogleTest and GoogleMock offer powerful extensibility points that enable users to tailor test assertions, matchers, and utilities to better reflect their domain-specific needs. This page guides you through creating custom assertions, matchers, and test utilities, empowering you to write expressive and maintainable tests that deliver precise feedback.

---

## 1. Custom Assertions

Custom assertions provide a clean way to encapsulate complex verification logic into reusable functions or macros that produce informative test failures.

### Writing Custom Assertions

- Define a function that returns `::testing::AssertionResult`. It should return `::testing::AssertionSuccess()` if the check passes, or `::testing::AssertionFailure()` with an explanatory message otherwise.

Example:
```cpp
#include <gtest/gtest.h>

::testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << n << " is not even";
}

TEST(CustomAssertionTest, CheckEven) {
  int x = 4;
  EXPECT_PRED_FORMAT1(IsEven, x);
}
```

### Predicate Format Assertions

Use `EXPECT_PRED_FORMATn` macros for more complex assertions, where you can pass multiple parameters and fine control over output.

### Benefits

- Keep test logic DRY.
- Generate clear failure messages tailored to your domain.

---

## 2. Custom Matchers

Matchers are the core expressive toolset in GoogleMock for validating argument values passed to mock methods. Custom matchers extend built-in matchers with user-defined semantics.

### Defining Matchers Quickly with Macros

GoogleMock provides convenient macros to define matchers succinctly:

- `MATCHER(name, description) { ... }` creates a unary matcher.
- `MATCHER_P(name, param, description) { ... }` creates a parameterized matcher.

Example:
```cpp
MATCHER(IsDivisibleBy3, "checks if a number is divisible by 3") {
  return (arg % 3) == 0;
}

// Usage in test:
EXPECT_CALL(mock, Method(IsDivisibleBy3()));
```

### Implementing Matcher Classes

For complex cases, define a matcher class implementing:

- `bool MatchAndExplain(const T&, std::ostream*) const` – returns true if match succeeds, optionally explains mismatch.
- `void DescribeTo(std::ostream*) const` – describes the expected condition.
- `void DescribeNegationTo(std::ostream*) const` – describes the negated condition.
- Add `using is_gtest_matcher = void;` to signal the matcher interface.

Example:
```cpp
class IsPositiveMatcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    if (n > 0) return true;
    if (os) *os << "which is not positive";
    return false;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is positive";
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not positive";
  }
};

::testing::Matcher<int> IsPositive() {
  return ::testing::Matcher<int>(new ::testing::internal::TemplateMatcher<IsPositiveMatcher>(IsPositiveMatcher()));
}

// Usage:
EXPECT_CALL(mock, Method(IsPositive()));
```

### Creating Polymorphic Matchers

To support multiple argument types, define `MatchAndExplain` as a template.

### Best Practices for Custom Matchers

- Ensure matchers are pure functions with no side-effects.
- Provide informative descriptions for easier debugging.
- Use sub-matchers to compose complex logical conditions.

---

## 3. Custom Actions

Actions specify what a mock method will do when invoked, beyond simply returning values.

### Common Use Cases for Custom Actions

- Invoking callbacks passed as arguments.
- Modifying output parameters.
- Maintaining internal state during mock calls.

### Defining Actions Using Lambdas, Functors, or Classes

Example: Invoking a callback argument:
```cpp
EXPECT_CALL(mock, InvokeCallback(_))
    .WillOnce([](std::function<void(int)> cb) { cb(42); });
```

For complex actions, implement a class with a call operator:
```cpp
class IncrementCounter {
  int* counter_;
 public:
  explicit IncrementCounter(int* counter) : counter_(counter) {}
  void operator()() const { ++(*counter_); }
};

EXPECT_CALL(mock, Foo())
    .WillOnce(IncrementCounter(&count));
```

### Using `ACTION`, `ACTION_P`, and `ACTION_TEMPLATE` Macros

Legacy macro-based actions help simplify repetitive action boilerplate.

### Chaining Actions with `DoAll()`

Combine multiple side effects and a return value into one action.

---

## 4. Custom Matchers and Actions with Templates

For advanced users:

- Use `ACTION_TEMPLATE` macro to define templated or parameterized actions.
- Extend `ActionInterface<F>` to implement monomorphic actions when more control is needed.

This approach provides granular control over invocation semantics.

---

## 5. Utilities for Writing Test Helpers

GoogleTest supports building helper functions and fixtures to improve test readability and maintainability. Examples include:

- Helper functions to create complex mock objects with common setups.
- Parameterized matcher factories.
- Reusable sequences and expectation sets.

Proper modularization of test logic promotes consistency and reuse.

---

## 6. Debugging and Diagnostics

Custom matchers and actions should emit clear diagnostic messages.

Use GoogleMock's verbosity flags to trace expectation matching and action execution.

Tips:

- Implement detailed `DescribeTo` and `DescribeNegationTo` for matchers.
- Use `MatchAndExplain` to provide failure reason details.

---

## 7. References and Further Reading

- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - practical recipes for matchers and actions.
- [Matchers Reference](../api-reference/matchers-and-actions/argument-matching.md) - comprehensive built-in matchers and usage.
- [Actions Reference](../api-reference/matchers-and-actions/actions-for-mocks.md) - core API for actions.
- [Mocking Reference](docs/reference/mocking.md) - defining and using mocks.

---

For more details on extending GoogleMock, visit the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and explore examples of custom matchers and actions.


<Check>
Remember to always test your custom matchers and actions thoroughly to ensure they behave as expected and provide meaningful feedback.
</Check>
