---
title: "How can I extend or customize GoogleTest/GoogleMock?"
description: "Guides users wishing to create custom assertions, matchers, or integrate with other tools and frameworks. Provides entry points for writing user-defined functionality or contributions."
---

# Extending and Customizing GoogleTest and GoogleMock

This guide helps users enhance their GoogleTest and GoogleMock experience by creating custom matchers, assertions, actions, and adapting the framework to specialized needs. It also outlines how to integrate GoogleTest/GoogleMock with external tools, frameworks, or user-defined extensions.

---

## 1. Creating Custom Matchers

Custom matchers allow you to precisely specify argument constraints beyond the built-in matchers, improving test expressiveness and maintainability.

### 1.1 Quick Matcher Creation with `MATCHER` Macros

Use the `MATCHER`, `MATCHER_P`, and their variants for quick crafting of matchers.

```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
```

Example usage:

```cpp
EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

This matcher elegantly verifies the passed value satisfies a particular property.

### 1.2 Parameterized Matchers

Parameterized matchers support runtime parameters:

```cpp
MATCHER_P(InRange, range_limit, "") {
  return arg <= range_limit;
}
```

Usage:

```cpp
EXPECT_CALL(mock, Foo(InRange(10)));
```

### 1.3 Advanced Matcher Classes

Defining full matcher classes lets you write reusable and richly descriptive matchers that provide detailed failure messages.

```cpp
class PositiveMatcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    if (n > 0) return true;
    *os << "which is not positive";
    return false;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is positive";
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is non-positive";
  }
};

::testing::Matcher<int> IsPositive() {
  return ::testing::Matcher<int>(new ::testing::MatcherInterface<int>(PositiveMatcher()));
}
```

For most users, `MATCHER` macros suffice, but matcher classes give maximum control.

### 1.4 Best Practices

- Keep matchers pure and side-effect free.
- Provide meaningful descriptions and failure outputs.
- Use existing built-in matchers as building blocks whenever possible.

---

## 2. Creating Custom Assertions

Custom assertions integrate your matchers into GoogleTestâ€™s assertion framework to produce clear test failures.

```cpp
EXPECT_THAT(value, IsDivisibleBy7());
```

Use `EXPECT_THAT` with your custom matchers to get expressive assertion failures.

---

## 3. Defining Custom Actions

Actions specify what a mock method does when invoked. When built-in actions are insufficient, define your own.

### 3.1 Using Lambdas and Functors

The simplest way to create an action is a lambda or function object:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int x) { return x * 2; });
```

### 3.2 Simple Macro-Based Actions

For small custom actions, use legacy macros:

```cpp
ACTION(DoubleArg0) { return arg0 * 2; }
EXPECT_CALL(mock, Foo(_)).WillOnce(DoubleArg0());
```

### 3.3 Template Actions for Maximum Flexibility

Implement the `ActionInterface<F>` for actions that must work across different function signatures.

### 3.4 Polymorphic Actions

Create actions that can be used with multiple function signatures using `MakePolymorphicAction`.

Example:

```cpp
class ReturnSecondArgAction {
 public:
  template <typename R, typename Tuple>
  R Perform(const Tuple& args) const {
    return std::get<1>(args);
  }
};

PolymorphicAction<ReturnSecondArgAction> ReturnSecondArg() {
  return MakePolymorphicAction(ReturnSecondArgAction());
}
```

Used as:

```cpp
EXPECT_CALL(mock, SomeFunc).WillOnce(ReturnSecondArg());
```

---

## 4. Extending Mock Classes

### 4.1 Simplifying Mock Interfaces

You may want to define user-friendly mock methods that internally delegate to the full method signatures, especially with complex or cumbersome argument sets.

Example:

```cpp
class MockLogSink : public LogSink {
 public:
  void send(LogSeverity severity, const char* filename,
            const char* base_filename, int line, const tm* time,
            const char* msg, size_t msg_len) override {
    Log(severity, filename, std::string(msg, msg_len));
  }

  MOCK_METHOD(void, Log, (LogSeverity, const std::string&, const std::string&), (override));
};
```

### 4.2 Delegating to Fakes or Real Objects

If you have a fake or real class implementation, your mock can forward calls to them by defining default actions using lambdas and `ON_CALL`:

```cpp
class MockFoo : public Foo {
 public:
  MockFoo() {
    ON_CALL(*this, DoThis).WillByDefault([this](int n) {
      return real_.DoThis(n);
    });
  }

  MOCK_METHOD(char, DoThis, (int), (override));
 private:
  Foo real_;
};
```

This facilitates tests that verify interactions but rely on real implementations as fallback.

### 4.3 Mocking Non-Virtual Methods

While GoogleMock requires virtual methods to mock directly, you can mock non-virtual methods using templated classes and compile-time dependency injection by matching the method signature in an unrelated mock class.

### 4.4 Mocking Overloaded Methods

Mock all overloaded variants explicitly. If you mock only some, you must bring the others into scope using `using Base::MethodName;` to avoid hiding issues.

---

## 5. Integrating with Other Tools and Frameworks

While GoogleTest and GoogleMock directly offer no built-in external tool integrations, users can extend the framework by:

- Creating custom matchers and actions for domain-specific logic.
- Writing adapters to integrate with other test runners or coverage systems.
- Using `MockFunction<R(Args...)>` to mock std::function interfaces for callback testing.

GoogleTest's design and open API encourage user extensions and incorporation into custom workflows.

---

## 6. Best Practices for Extension

- Use `ON_CALL` to specify default mock behavior, and `EXPECT_CALL` to express verifications explicitly.
- Make mocks "nice" or "strict" judiciously to control uninteresting call behavior.
- Delegate to real or fake implementations when appropriate to minimize duplication.
- Avoid tight coupling by coding to interfaces, not concrete classes.
- Always use `MOCK_METHOD` in the public section regardless of original method access.

---

## 7. Troubleshooting Tips

- If custom matchers behave unexpectedly, verify they are pure functions without side effects.
- Use `--gmock_verbose=info` to trace mock calls and matchers with detailed logs.
- If mocking non-virtual methods, verify your design fits the dependency injection patterns.
- When delegating mock calls, be careful to avoid infinite recursion by qualifying base class method calls.
- If having slow mock compilation, consider moving mock class definitions' constructors and destructors to .cc files.

---

## 8. Further Resources

- [gMock Cookbook](../api-reference/mocking-apis/mock-classes) for recipes on mocking class features.
- [gMock for Dummies](../docs/gmock_for_dummies.md) for beginner-friendly introduction to mocking.
- [Matchers Reference](../api-reference/matchers-assertions/core-matchers) and [Actions Reference](../api-reference/mocking-apis/actions-invocations) for built-in and extended capabilities.
- [Custom Matchers and Assertions Guide](/guides/advanced-testing/custom-matchers-and-assertions) for deep learning on user-defined matchers.

---

For code examples, usage patterns, and detailed extension strategies, see the official [GoogleMock documentation](https://google.github.io/googletest/gmock_cook_book.html) linked above.


<Note>
Extensibility is a core strength of GoogleTest and GoogleMock, empowering users to tailor testing to highly specific scenarios while leveraging the robust verification engine. Focus on writing clear, testable interfaces and use mocks, matchers, and actions complementarily for the best results.
</Note>
