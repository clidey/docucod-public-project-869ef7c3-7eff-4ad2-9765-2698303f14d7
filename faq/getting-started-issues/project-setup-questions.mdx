---
title: "Project Setup and Configuration Questions"
description: "Covers frequently asked questions on integrating GoogleTest and GoogleMock into new or existing projects, including CMake and Bazel quickstarts, directory structure expectations, and best practices for maintaining test organization."
---

# Project Setup and Configuration Questions

This FAQ page addresses common questions and best practices specifically related to integrating GoogleTest and GoogleMock into new or existing projects. It focuses on setup, build system integration, directory organization, and maintaining a clean, maintainable testing environment.

---

## Frequently Asked Questions

### How do I quickly get started with GoogleTest and GoogleMock in my project?
To start quickly, incorporate GoogleTest and GoogleMock as external dependencies using your preferred build system like CMake or Bazel. For CMake, add GoogleTest as a submodule or fetch it during the build, then link your test targets with `gtest`, `gmock`, and optionally `gtest_main` or `gmock_main`. For Bazel, use the pre-defined GoogleTest rules and dependencies. Ensure you initialize GoogleTest/GMock properly in your main function or link with `gtest_main`/`gmock_main` which provide a suitable entry point.

### What directory structure should I follow for my tests and mocks?
Organize your test code close to the code it tests: typically, place production code in `src/` or `lib/` directories, and put tests under `test/` or `tests/`. Keep mock classes either in the same directory as tests or in dedicated subdirectories such as `test/mocks/` or `src/testing/`. If you mock third-party or external interfaces, define mocks in a `testing` subdirectory near the external code if you can, to reduce duplication and ease maintenance.

### How should I configure my build system to compile and link tests?
For CMake, you should enable testing with `enable_testing()`, add test executables with `add_executable()`, and link them against GoogleTest and GoogleMock libraries, like `target_link_libraries(my_test PRIVATE gtest gmock)`. Use `gmock_main` or provide your own `main` if you want control over test initialization. For Bazel, use `cc_test` rules and specify dependencies on `@com_google_googletest//:gtest_main` and `@com_google_googletest//:gmock`.

### What are best practices for integrating GoogleTest and GoogleMock into CI/CD pipelines?
Make sure your CI system installs dependencies or uses cached builds for GoogleTest and GoogleMock to speed up test runs. Run tests with `--gtest_output=xml` to generate test reports for CI dashboards. Use `--gmock_verbose` flags if you need detailed diagnostics. Parallelize tests when possible, considering thread safety and mock object lifecycle management. Always fail the build if any tests fail.

### Can I customize how GoogleMock behaves with uninteresting or unexpected calls?
Yes. You can wrap your mock classes in `NiceMock`, `NaggyMock`, or `StrictMock` wrappers to control how uninteresting calls are handled — silence them, warn about them, or treat them as test failures respectively. Choose based on your test stability and verbosity needs.

### How do I manage compilation speed when mocking many methods?
To speed up compilation, declare the mock class constructor and destructor in the header but define them in a `.cc` file to avoid recompiling them repeatedly. This reduces redundant compilation across multiple translation units.

### What should I know about linking when using GoogleMock?
Ensure your test targets link both GoogleTest and GoogleMock libraries. If you use `gmock_main`, link against it to get the main function automatically. If your environment has threading requirements, link against the appropriate thread libraries to avoid linker errors.

### How do I structure my mock class definitions?
Define mock methods using `MOCK_METHOD` macros inside the public section of mock classes regardless of the original method's access level. This allows `EXPECT_CALL` and `ON_CALL` to work correctly. For overloaded methods, mock all overloads or use `using BaseClass::method;` to avoid hiding.

### Can I mock move-only types?
Yes. GoogleMock fully supports mocking methods that accept or return move-only types such as `std::unique_ptr`. Use `MOCK_METHOD` macros as usual. When specifying actions, prefer lambdas or functors if `Return()` won't work due to move-only semantics.

---

## Common Pitfalls & Tips

- **Set expectations before exercising mock methods:** Always write `EXPECT_CALL` before calling the code that uses the mock to avoid undefined behavior.
- **Use `ON_CALL` for default behaviors:** Reserve `EXPECT_CALL` for interactions you want to verify explicitly. Use `ON_CALL` to specify default behaviors without setting expectations.
- **Avoid over-constraining arguments:** Use wildcard matchers (`_`) or partial matchers when appropriate to prevent brittle tests.
- **Retire expectations when saturated:** Use `.RetiresOnSaturation()` to avoid “sticky” expectations when mocking sequences of calls.
- **Use sequences or `InSequence` to order expected calls** when order matters.
- **Keep mocks close to the code you own:** Avoid mocking code you don't own unless necessary. Use adaptors or interfaces to isolate dependencies and ease mock management.

---

## Related Documentation Sections

- [Mocking Reference](../docs/reference/mocking.md): Complete detailed API and usage guidance for mocks.
- [gMock for Dummies](../docs/gmock_for_dummies.md): Beginner-friendly tutorial on mocking fundamentals.
- [Mocking Cookbook](../docs/gmock_cook_book.md): Advanced recipes and best practices.
- [Using Assertions and Matchers Effectively](../guides/core-workflows/using-assertions-and-matchers.mdx): Guidance on verifying expectations.
- [Configuring Projects with GoogleTest](../getting-started/setup-prerequisites-installation/configuring-projects-with-googletest.mdx): How to setup your build system.

---

## Sample CMake Snippet to Integrate GoogleTest and GoogleMock

```cmake
# Add GoogleTest and GoogleMock as external dependencies
find_package(GTest REQUIRED)

# Add your test executable
add_executable(my_test test_my_code.cc)

# Link your test with GoogleTest and GoogleMock
target_link_libraries(my_test PRIVATE GTest::gtest GTest::gmock GTest::gmock_main)

# Enable testing and add test
enable_testing()
add_test(NAME MyTest COMMAND my_test)
```

---

## Sample Bazel BUILD Snippet

```python
cc_test(
    name = "my_test",
    srcs = ["test_my_code.cc"],
    deps = [
        "@com_google_googletest//:gmock_main",
        "@com_google_googletest//:gmock",
        "@com_google_googletest//:gtest",
    ],
)
```

---

<Tip>
For in-depth guidance on writing tests and mocks, always refer to the foundational Getting Started guides and Mocking Cookbook. Using discussed best practices will ensure that your test code remains maintainable and robust as your project evolves.
</Tip>