---
title: "Mocking FAQ"
description: "Explains the most common issues when creating and using mock objects in GoogleMock, such as defining mock methods, setting expectations, and handling corner cases. Helps users understand mocking syntax and the error messages they may encounter."
---

# Mocking FAQ

This FAQ answers common questions and addresses typical issues developers encounter when creating and using mock objects with GoogleMock. It focuses on understanding the syntax, defining mocks, setting expectations, controlling behavior, and troubleshooting common errors. Whether you are just starting out or looking to master GoogleMock's mocking approach, this guide helps you gain clarity and avoid pitfalls.

---

## 1. Defining Mock Methods

### How do I define a mock method for my class?
You use the `MOCK_METHOD` macro inside your mock class definition. It expands to generate a mock version of your method.

Example:
```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```
Place `MOCK_METHOD` declarations in the `public:` section, regardless of the base class method's access level.

### What if my method is overloaded?
You can define each overloaded version with its exact signature:
```cpp
MOCK_METHOD(int, Add, (int x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));
```
If you want to mock only some overloads, use `using` to bring other overloads into scope to avoid hiding them.

### How can I mock methods with non-copyable or move-only arguments (like `std::unique_ptr`)?
Simply define the mock method with the move-only types as normal:
```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
```
Use lambdas or `WillOnce` with move semantics to provide return values or behavior.

### Where should I put the mock class?
If you own the interface, define mocks close to it in headers and implementation files. Otherwise, place mock classes in a `testing` subdirectory or dedicated mock libraries, so tests share one copy and are easier to maintain.

---

## 2. Setting Expectations with EXPECT_CALL

### How do I specify that a mock method should be called with certain arguments?
Use `EXPECT_CALL(mock_object, Method(matchers))`. If you omit matchers, the expectation matches any arguments for non-overloaded methods.

Example:
```cpp
EXPECT_CALL(turtle, GoTo(50, _));  // Expect calls where X == 50
EXPECT_CALL(turtle, PenDown());     // Expect calls to PenDown()
```

### What are matchers and can I create my own?
Matchers specify conditions on arguments (e.g., `Eq(5)`, `_` for anything, or more complex ones like `Gt(10)`). You can create custom matchers using the `MATCHER` macros or classes.

### How do I expect a method to be called a certain number of times?
Use the `.Times()` clause with cardinalities such as:

| Cardinality       | Meaning                           |
|-------------------|---------------------------------|
| `AnyNumber()`     | Any number of times (including 0) |
| `AtLeast(n)`      | At least `n` times               |
| `AtMost(n)`       | At most `n` times                |
| `Between(m, n)`   | Between `m` and `n` times       |
| `Exactly(n)`      | Exactly `n` times                |

If omitted, cardinality is inferred from `.WillOnce()` and `.WillRepeatedly()` clauses.

### What do `.WillOnce()` and `.WillRepeatedly()` do?
They specify the action the mock method takes for matching calls:
- `.WillOnce(action)` – defines behavior for individual calls.
- `.WillRepeatedly(action)` – defines behavior for subsequent calls after all `WillOnce` actions are used.

Example:
```cpp
EXPECT_CALL(foo, GetNumber())
    .WillOnce(Return(1))
    .WillRepeatedly(Return(0));
```

### How can I specify order between expectations?
- **Sequences**: Use `Sequence` objects with `.InSequence(seq)` to impose strict call order.
- **Partial order**: Use `.After()` clauses or multiple sequences to express partial ordering.

Example:
```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Foo()).InSequence(s1);
EXPECT_CALL(mock, Bar()).After(foo_expectation).InSequence(s2);
```

### What does `.RetiresOnSaturation()` do?
It marks an expectation to become inactive as soon as it has been called the expected number of times (saturated), allowing later expectations to match.

---

## 3. Using ON_CALL for Default Behavior

### What's the difference between `ON_CALL` and `EXPECT_CALL`?
- `ON_CALL` defines **default behavior** for a mock method but **doesn't** create any expectation.
- `EXPECT_CALL` sets an expectation that a method **will be called**, defining behavior **and** verifying call count/order.

Use `ON_CALL` to specify behaviors for uninteresting calls (calls without expectations).

Example:
```cpp
ON_CALL(mock, GetValue(_))
    .WillByDefault(Return(42));
```

### When should I use `ON_CALL`?
To set common default behaviors in your test setup or mock object's constructor, especially when you don't care to enforce call counts or orders.

---

## 4. Handling Uninteresting and Unexpected Calls

### What is an uninteresting call?
A call to a mock method with no prior `EXPECT_CALL` set for it.

### Will uninteresting calls cause test failures?
By default, uninteresting calls print warnings but do not fail the test. This can be changed by:
- Using `NiceMock` to suppress warnings.
- Using `StrictMock` to treat them as errors.

### What is an unexpected call?
A call to a mock method that has expectations, but no matching expectation applies to this specific call's arguments or order. This always causes a test failure.

### How can I ignore uninteresting calls on a specific mock object?
Construct your mock as `NiceMock<YourMockClass>`.

Example:
```cpp
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoSomething()); // Only DoSomething warnings reported
```

### How can I treat uninteresting calls as errors?
Use `StrictMock<YourMockClass>`, which treats any uninteresting call as a failure.

---

## 5. Troubleshooting Common Issues

### My `EXPECT_CALL` is not matching the call I think it should.
- Ensure the matchers correspond exactly to the argument values.
- Use `--gmock_verbose=info` when running tests to see detailed logs of mock method calls and expectation matches.
- Check the order of expectations; newer expectations override older ones for matching.

### Why am I getting "Too many actions specified in EXPECT_CALL" warnings?
You specified more `.WillOnce()` actions than the number of expected calls (cardinality). Adjust `.Times()` or `.WillRepeatedly()` accordingly.

### How do I verify my mock expectations have been satisfied before the mock object is destroyed?
Call `Mock::VerifyAndClearExpectations(&mockObject)` manually. Do not set any new expectations after.

### My mock objects seem to leak, causing test failures.
- Ensure your mocks have virtual destructors.
- Use `Mock::AllowLeak(&mockObject)` if intentional, which suppresses leak reports.

### How do I test destructor calls on mocks?
Add a `MOCK_METHOD(void, Die, ())` to your mock and call it inside the destructor.
Set expectations on `Die()` to validate mock destruction order.

### My mock method returns a reference, but I get errors with `Return()`.
Use `ReturnRef(variable)` to return references from mock methods.

### How do I mock const methods?
Use `(const, override)` in the `MOCK_METHOD` qualifier list.
Example:
```cpp
MOCK_METHOD(int, GetX, (), (const, override));
```

### How can I mock methods with parameters containing commas?
Wrap the parameter types in extra parentheses or create type aliases.

Example:
```cpp
MOCK_METHOD((std::pair<int, bool>), GetPair, ());
// or
using IntBoolPair = std::pair<int, bool>;
MOCK_METHOD(IntBoolPair, GetPair, ());
```

---

## 6. Best Practices

- **Set expectations before exercising the mock.** Interleaving mock calls and setting expectations leads to undefined behavior.
- **Use sequences or `.After()`** to enforce call order when needed, instead of relying on expectation declaration order.
- **Set default behavior with `ON_CALL`** when you only want to define what should happen for uninteresting calls.
- **Use `NiceMock` and `StrictMock`** wisely to control how uninteresting calls are handled.
- **Use `--gmock_verbose=info`** to debug expectation matching problems.
- **Avoid over-specifying expectations.** Specify only what is necessary to keep tests maintainable.

---

## 7. Additional Resources and References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Beginner-friendly gMock tutorial.
- [Mocking Reference](../reference/mocking.md) - Detailed documentation of gMock mocking APIs.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Recipes and practical guidance.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) - Quick syntax and usage guide.
- [Actions Reference](../reference/actions.md) - List of built-in actions for specifying mock behavior.

---

## Glossary of Key Terms

| Term              | Description |
|-------------------|-------------|
| Mock Object       | A test double that simulates an interface with expectations.
| Matcher           | A predicate to specify argument constraints in expectations.
| Expectation       | A specification that a mock method will be called with certain arguments, behavior, order, and number of times.
| Default Action    | Behavior of a mock method when there is no matching expectation.
| Uninteresting Call| A call to a mock method without a matching `EXPECT_CALL`.
| Unexpected Call   | A call that matches no active expectations.
| Cardinality       | Specifies how many times a method is expected to be called.
| Sequence          | An ordered chain of expectations.
| `ON_CALL`         | Defines default behavior for calls without expectations.
| `EXPECT_CALL`     | Defines behavior and sets expectations on mock method calls.

---

## Common Error Messages Explained

- **"Uninteresting mock function call...":** Indicates a call has been made on a mock method without an expectation. Usually a warning unless using `StrictMock`.
- **"Too many actions specified in EXPECT_CALL...":** You declared more `.WillOnce()` actions than expected by `.Times()` or default cardinality.
- **"Mock function call count doesn't match EXPECT_CALL...":** The actual call count does not align with the specified expectation.
- **"Unexpected mock function call...":** The mock was called with arguments or in an order that no expectation covers.

---

## Troubleshooting Steps

1. Confirm your mock methods are declared correctly with `MOCK_METHOD`.
2. Ensure expectations (`EXPECT_CALL`) are set before exercising the mocks.
3. Use `--gmock_verbose=info` to view detailed mock call matching logs.
4. Validate that your matchers and cardinalities accurately reflect your expected calls.
5. Use sequences and `.After()` to specify call order explicitly when necessary.
6. If calls are unexpectedly uninteresting, consider if `ON_CALL` defaults or a `NiceMock` wrapper is appropriate.
7. For unexpected calls, check argument matchers for accuracy and completeness.
8. Verify mocks have virtual destructors to avoid leaks.

---

## Example: Mocking and Expectation Setup

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::_; 
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
};

TEST(PaintTest, DrawsLine) {
  MockTurtle turtle;

  ON_CALL(turtle, GoTo(_, _))
      .WillByDefault(Return());

  EXPECT_CALL(turtle, PenDown()).Times(1);
  EXPECT_CALL(turtle, GoTo(0, 0)).Times(AtLeast(1));

  Painter painter(&turtle);
  painter.DrawLine(0, 0, 10, 10);
}
```

In this test, `ON_CALL` sets a default action for all `GoTo` calls, while `EXPECT_CALL`s specify required calls to `PenDown` and a specific `GoTo`.

---