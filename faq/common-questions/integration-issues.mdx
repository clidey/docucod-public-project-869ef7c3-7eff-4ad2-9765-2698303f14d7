---
title: "Integration FAQs: Build Systems and Platforms"
description: "Guidance for solving the most common integration issues when using GoogleTest and GoogleMock with CMake, Bazel, or custom build systems. Highlights platform-specific caveats and environmental setup, helping you run tests reliably across a wide range of development environments."
---

# Integration FAQs: Build Systems and Platforms

This FAQ provides targeted guidance to help you resolve the most common integration challenges when using GoogleTest and GoogleMock with various build systems like CMake, Bazel, or custom solutions. It also highlights platform-specific issues and environmental setup tips to ensure your tests run reliably across diverse development environments.

---

## General Integration Questions

### How do I integrate GoogleTest and GoogleMock into my CMake project?
To integrate GoogleTest and GoogleMock in a CMake-based project, follow these key steps:

1. Use `add_subdirectory()` in your `CMakeLists.txt` to include the googletest source if you have it as a submodule or local copy.
2. Link your test target against `gmock_main` for a pre-built main function that automatically initializes GoogleTest and GoogleMock.
3. Include relevant headers in your test source files, typically `#include <gmock/gmock.h>`.

Example minimal CMake snippet:

```cmake
add_subdirectory(external/googletest)  # or the path to the googletest repo

add_executable(unit_tests test_main.cc foo_test.cc)
target_link_libraries(unit_tests gmock_main)
```

Make sure your compiler and linker flags are set appropriately to support C++11 or higher.

### How do I configure Bazel to build and run GoogleTest and GoogleMock tests?
Bazel provides native rules to build and run GoogleTest and GoogleMock:

- Use `cc_test` rule in your `BUILD` file to define a test target.
- Include `deps` on `@com_google_googletest//:gmock_main` or equivalent.

Example:

```python
cc_test(
    name = "foo_test",
    srcs = ["foo_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

Run the test using `bazel test //your/package:foo_test`.

Ensure your workspace is set up with the appropriate external dependencies for googletest.

### What are some best practices for integrating GoogleTest/GoogleMock into a custom or legacy build system?

- Keep test sources and mock definitions well-organized, preferably in dedicated directories.
- Use compiler and linker flags to enable C++11 or above, as GoogleMock relies on C++11 features.
- Link test binaries with the full GoogleMock library (`gmock` and `gmock_main`) and GoogleTest (`gtest`).
- Enable verbose output flags at runtime (`--gtest_verbose`, `--gmock_verbose`) for troubleshooting.
- Ensure proper initialization and shutdown sequences in your tests, ideally by using `gmock_main` or calling `testing::InitGoogleMock()`.

### How do I pass command-line flags to control GoogleMock's verbosity and mock behavior?

Use runtime flags to control GoogleMock behavior:

- `--gmock_verbose=LEVEL`, where LEVEL can be `info`, `warning`, or `error`.
  - `info`: Logs all messages including detailed mock call traces.
  - `warning`: Logs warnings and errors. This is the default.
  - `error`: Only errors are logged.

Example:

```sh
./unit_tests --gmock_verbose=info
```

This is helpful for debugging unexpected or uninteresting mock calls.


---

## Platform-Specific Caveats

### Are there any known compiler or platform issues I should watch out for?

- **MS Visual C++ (MSVC) Warnings on Const Parameters:**
  You may encounter warnings like `C4301` or `C4373` when defining mock methods with const parameters due to a known MSVC compiler bug. The const top-level qualifier for parameters is ignored by the language, so the workaround is to remove the const qualifier from parameters both in the base class and mock class.

- **Heap Check Failures on Mock Objects:**
  Make sure all classes you mock have virtual destructors. Otherwise, deleting an object via a base class pointer can cause memory leaks and heap check failures.

- **Compiling Large Mock Classes in MSVC:**
  Avoid compiling large mock classes with the `/clr` flag as it increases memory usage dramatically.

- **Uninteresting Call Warnings:**
  By default, uninteresting mock function calls cause warnings. Use `NiceMock` to suppress such warnings, or `StrictMock` to treat them as errors.

- **Platform Support:**
  GoogleTest and GoogleMock support Linux, macOS, Windows, and embedded platforms. Always verify that your build environment includes proper support for threading and C++11.

---

## Common Integration Issues and Solutions

<AccordionGroup title="FAQs on Build and Runtime Issues">
<Accordion title="My mock object's method calls the real method instead. What causes this?">
This happens if the method you're trying to mock is not declared `virtual`. GoogleMock requires methods be virtual to override them for mocking. Alternatively, you can use advanced techniques like the high-performance dependency injection to mock non-virtual methods. See the gMock Cookbook's section on MockingNonVirtualMethods for details.
</Accordion>
<Accordion title="Why am I getting warnings about uninteresting calls when my mock is called?">
By default, GoogleMock warns when a mock method is called but there is no `EXPECT_CALL` set — these are uninteresting calls. To eliminate these warnings you can:

- Use `NiceMock<YourMock>` instead of `YourMock`.
- Add an `EXPECT_CALL(your_mock, Method(_)).Times(AnyNumber())` to explicitly allow calls without warnings.

Avoid suppressing the warning by indiscriminately adding `EXPECT_CALL`s to methods you are not interested in testing.
</Accordion>
<Accordion title="Building a large mock class takes too long or runs out of memory in MSVC. What can I do?">
Try moving the constructor and destructor of the mock class out-of-line into a `.cc` file. This will reduce compile time and memory usage substantially.

Also, avoid enabling the `/clr` option when compiling native C++ mocks in MSVC.
</Accordion>
<Accordion title="I see duplicate failure messages about unmet expectations; is this a bug?">
GoogleMock may print expectation mismatch information multiple times at different points during test execution. This duplication is intentional, as each report corresponds to a different call or phase, helping to provide context for debugging.
</Accordion>
<Accordion title="How can I suppress warnings about uninteresting calls but still detect unexpected calls?">
Use `NiceMock` to suppress uninteresting calls, which are calls to mock methods with no expectations. Unexpected calls — that is, calls that don't match any existing expectation but where expectations exist for the method —are always errors and cannot be suppressed.
</Accordion>
<Accordion title="Why is my MSVC compiler warning about overriding a virtual function with a const parameter?">
MSVC versions prior to Visual Studio 2008 SP1 trigger warnings because they do not properly handle top-level const qualifiers in function parameters during overriding. The best practice is to remove the top-level const qualifier from parameters in both the base class and the mock class, as C++ treats `int` and `const int` parameters equivalently in declarations.
</Accordion>
</AccordionGroup>

---

## Best Practices for Build and Test Integration

- **Set Up Expectation Before Calling Mocks:** Always set your `EXPECT_CALL` expectations before exercising the code that calls the mock methods, otherwise mock behavior is undefined.

- **Control Mock Strictness Appropriately:** Use `NiceMock` for tests where you don’t want to be noisy about uninteresting calls, `NaggyMock` (default) when debugging, and `StrictMock` when you want to enforce expectations tightly.

- **Manage Complex Call Sequences with `Sequence` and `.After()`:** Use sequences to order expectations in complex interaction scenarios.

- **Use `ON_CALL` for Setting Default Mock Behavior:** To set generic mock method behavior without asserting call expectations, prefer `ON_CALL`. Use `EXPECT_CALL` only when you want to verify calls.

- **Tune Verbosity for Debugging:** Increase verbosity using the `--gmock_verbose` flag to get detailed trace info when diagnosing failures.

- **Avoid Mocking Non-Virtual or Static Methods Directly:** Instead, introduce interfaces or wrappers to improve testability and mockability.

- **Use `Mock::VerifyAndClearExpectations()` When Needed:** Especially if mocks have complex lifetimes or are heap-allocated outside the test scope.

- **Monitor for Leaked Mocks:** Enable GoogleMock's leak detection to ensure mocks are destroyed and verified properly to avoid silent test errors.

---

## Troubleshooting Tips

- **Enable Verbose Output for Insight:** Run tests with `--gmock_verbose=info` to trace all mock calls and improve visibility into expectation matching.

- **Diagnose Unmatched Calls:** Look at the output to find which expectations were tried and why they failed to match.

- **Check Object Lifetimes:** Ensure mocks are properly destroyed at test end so that expectations are verified.

- **Read Compiler Warnings Carefully:** Especially on MSVC, warnings about mock methods often signal signature mismatches or missing `virtual` keywords.

- **Understand Expectation Order:** Expectation matching is done from last specified to first — newer expectations take precedence.

- **Watch out for Over-saturated Calls:** Too many calls to a mock method beyond the specified `Times()` cause errors — use `RetiresOnSaturation()` or adjust cardinalities if needed.

- **Suppress Uninteresting Call Warnings Intentionally:** Use `NiceMock` or explicit `EXPECT_CALL(...).Times(AnyNumber())` over quiet suppression with no intent.

---

## Additional Resources and Links

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) – Recipes and patterns for common mocking tasks.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) – API details for mocking macros and classes.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) – Beginner friendly tutorial for mocks.
- [Integration with Build Systems & Tools](https://google.github.io/googletest/overview/architecture_and_integration/integration_points.html) – How to link and run test suites.
- [Troubleshooting Common Installation Issues](https://google.github.io/googletest/getting-started/first-run-validation/troubleshooting-common-issues.html) – Helps with common environment problems.

---

Follow these guidelines and diagnostic steps to build a stable integration with GoogleTest and GoogleMock for your projects, ensuring smooth development and reliable test runs across platforms and build systems.
