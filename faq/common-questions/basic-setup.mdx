---
title: "How do I set up and use GoogleTest/GoogleMock?"
description: "Step-by-step guidance on setting up GoogleTest and GoogleMock in your C++ project, including build system integration and first test creation. Covers CMake, Bazel, and manual build integration."
---

# How do I set up and use GoogleTest/GoogleMock?

Step-by-step guidance on setting up GoogleTest and GoogleMock in your C++ project, including build system integration and first test creation. This guide covers building with CMake, Bazel, and manual build integration methods.

---

## 1. Overview

GoogleTest and GoogleMock provide a powerful C++ testing and mocking framework. Before you dive into writing tests and mocks, you need to integrate these libraries properly into your project’s build system and understand how to initialize and run your tests.

This guide walks you through the complete setup process to get you started quickly and correctly.

---

## 2. Setting up GoogleTest and GoogleMock with CMake

GoogleTest and GoogleMock come with ready CMake support to make integration straightforward.

### 2.1 Standalone Build of GoogleTest/GoogleMock

If you want to build GoogleTest and GoogleMock as a standalone project:

1. Clone the GoogleTest repository (tag or branch as desired):

```bash
$ git clone https://github.com/google/googletest.git -b v1.17.0
d $ cd googletest
```

2. Create and enter a build directory:

```bash
$ mkdir build
$ cd build
```

3. Generate native build scripts (includes GoogleMock by default):

```bash
$ cmake ..
```

   - To build only GoogleTest and exclude GoogleMock, run:

```bash
$ cmake .. -DBUILD_GMOCK=OFF
```

4. Build the libraries:

```bash
$ make      # On Unix-like systems
```

5. Optionally install system-wide:

```bash
$ sudo make install
```

On Windows, the CMake generation produces Visual Studio solution and project files (`gtest.sln`), ready to build within Visual Studio. On macOS, Xcode project files are generated.

### 2.2 Integrate GoogleTest/GoogleMock into Your Existing CMake Project

For seamless integration and consistent compiler options between your project and GoogleTest/GoogleMock, it’s best to include GoogleTest as a subdirectory.

In your project’s `CMakeLists.txt`, add:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# On Windows, to match project's dynamic CRT
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

Then add your test executable and link it to GoogleTest/GoogleMock:

```cmake
add_executable(my_test test.cpp)
target_link_libraries(my_test GTest::gtest_main GTest::gmock_main)
include(GoogleTest)
gtest_discover_tests(my_test)
```

### 2.3 Compiler and Language Requirements

GoogleTest requires an environment supporting at least C++17. You can enforce this in your CMake project:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

---

## 3. Setting up GoogleTest and GoogleMock with Bazel

GoogleTest and GoogleMock also provide native Bazel support to integrate easily into Bazel-managed projects.

- Add the GoogleTest repository to your `WORKSPACE` file as a dependency.
- Use the provided Bazel `cc_test` targets to build and run tests.
- Refer to Google's official Bazel documentation and Googletest Bazel examples for setup details.

---

## 4. Manual Build System Setup (Non-CMake, Non-Bazel)

If you manage your own build scripts or use a different build system, follow these steps:

1. **Include Headers**:
   - Add the `googletest/include` and `googlemock/include` directories to your compiler's include paths.

2. **Build or Link the Libraries**:
   - Compile GoogleTest and GoogleMock source files (found under `googletest/src/` and `googlemock/src/`) together with your tests.
   - Alternatively, build static or shared libraries from the sources and link them.

3. **Link with pthread on Linux/UNIX if needed**:
   - If your environment uses pthreads, add the `-lpthread` linker flag.

4. **Initialize Framework in Test Executable**:
   - Your test's `main()` function should call `testing::InitGoogleMock()` or `testing::InitGoogleTest()`, passing in `argc` and `argv`.

5. **Use the `RUN_ALL_TESTS()` macro** to run your registered tests.

Example minimal main function using both GoogleMock and GoogleTest:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This initializes both GoogleMock and GoogleTest in one call.

---

## 5. Writing and Running Your First Test

Once set up, create a simple test to verify your installation:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

Compile and link with `gtest_main` (or `gmock_main`) to use provided `main()` entry points or write your own `main()`.

Run the resulting executable. Passing tests print summaries indicating success.

---

## 6. Important Tips and Best Practices

- **Use `gmock_main` when using GoogleMock:** This library contains a main function that initializes both GoogleMock and GoogleTest (`testing::InitGoogleMock()`) and runs the tests, so you do not need to write your own main routine.
- **Only call `RUN_ALL_TESTS()` once:** Calling this function multiple times can cause conflicts and erratic behavior.
- **Enable C++17 standard support:** Both GoogleTest and GoogleMock require a minimum of C++17.
- **Thread safety:** GoogleTest is thread-safe if pthreads are available; otherwise, assertions must be called only from one thread.

---

## 7. Troubleshooting Common Setup Issues

<AccordionGroup title="Common Setup Issues">
<Accordion title="Build fails to find GoogleMock headers or libraries">
Ensure the include paths point to GoogleMock’s `include` directory and the link paths point to the compiled library locations. Check that you link `gmock` and `gmock_main` if you want the main function provided.
</Accordion>
<Accordion title="Tests fail to link due to missing pthread">
On Unix-like systems, link with `-lpthread`. If using CMake, the provided scripts handle this automatically.
</Accordion>
<Accordion title="GoogleMock/GoogleTest initialization errors">
Always initialize your test executable by calling `testing::InitGoogleMock(&argc, argv);` or `testing::InitGoogleTest(&argc, argv);` before running tests.
</Accordion>
<Accordion title="Visual Studio runtime mismatch errors">
Set CMake option `gtest_force_shared_crt` to `ON` to align your project’s runtime settings with GoogleTest/GoogleMock.
</Accordion>
</AccordionGroup>

---

## 8. Example CMakeLists.txt for a Project Using GoogleTest and GoogleMock

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(my_test
  tests/my_test.cpp
)
target_link_libraries(my_test
  GTest::gtest_main
  GTest::gmock_main
)

include(GoogleTest)
gtest_discover_tests(my_test)
```

This file fetches the latest GoogleTest/GoogleMock source, builds it, builds your test executable, and connects the tests to CTest.

---

## 9. Understanding the Main Functions Provided by GoogleTest and GoogleMock

GoogleTest provides a default `main` function in `gtest_main`, which calls `testing::InitGoogleTest()` before `RUN_ALL_TESTS()`.

GoogleMock extends this in `gmock_main` by calling `testing::InitGoogleMock()`, which initializes GoogleMock and GoogleTest together.

You can write your own `main`, or link to one of these libraries to avoid the boilerplate.

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);  // Initializes both GoogleTest and GoogleMock
  return RUN_ALL_TESTS();
}
```

This is especially important on platforms like Windows where Unicode or Windows Mobile specifics exist.

---

## 10. Additional Resources

- [GoogleTest Primer](primer.md) — Learn to write simple tests.
- [gMock for Dummies](gmock_for_dummies.md) — Step-by-step mocking introduction.
- [GoogleMock Reference](docs/reference/mocking.md) — Detailed mocking API.
- [Quickstart with CMake](docs/quickstart-cmake.md) — Guided build setup.
- [GoogleTest and GoogleMock README](https://github.com/google/googletest/blob/main/README.md) on GitHub.

---

## Troubleshooting Summary

- Always ensure your compiler supports C++17.
- Initialize GoogleTest/GoogleMock properly in `main()`.
- For CMake projects, use `FetchContent` or `add_subdirectory()` to avoid mismatches.
- Link with `gmock_main` when using GoogleMock for main() function.
- Link pthread on Unix when using multi-threaded tests.

---

This guide enables you to confidently set up GoogleTest and GoogleMock with flexible build systems, empowering you to write robust and maintainable C++ tests and mocks efficiently.

---

<Info>
For platform-specific initialization details, see `gmock_main.cc` and `gtest_main.cc` source files in the repository, which provide examples of entry points for Arduino-like platforms, Windows, and others.
</Info>
