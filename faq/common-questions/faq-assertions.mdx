---
title: "What assertions and matchers should I use for effective testing?"
description: "Introduces the core and advanced assertions and matchers available, clarifying how and when to use various types (equality, exceptions, parameterized, etc.) and offering pointers for writing custom matchers."
---

# What Assertions and Matchers Should I Use for Effective Testing?

GoogleTest and GoogleMock offer a rich set of assertions and matchers that enable you to write clear, expressive, and precise tests for your C++ code. This documentation introduces core and advanced assertions, explains how to select the best tools to verify behavior, and provides guidance on writing custom matchers for specialized needs.

---

## 1. Understanding Assertions in GoogleTest

Assertions verify expectations about your code's behavior in tests. GoogleTest provides a comprehensive suite of assertion macros, primarily divided into:

- **EXPECT_** macros: Generate non-fatal failures; test continues after failure.
- **ASSERT_** macros: Generate fatal failures; abort the current test flow immediately.

### Key Assertion Types

- **Boolean checks**: `EXPECT_TRUE()`, `EXPECT_FALSE()` verify conditions.
- **Binary comparisons**: `EXPECT_EQ()`, `EXPECT_NE()`, `EXPECT_LT()`, `EXPECT_LE()`, `EXPECT_GT()`, `EXPECT_GE()` compare values.
- **String comparisons**: Specialized macros like `EXPECT_STREQ()` for C strings; use `EXPECT_EQ` for `std::string`.
- **Floating-point comparisons**: Use `EXPECT_FLOAT_EQ()`, `EXPECT_DOUBLE_EQ()`, or `EXPECT_NEAR()` to account for rounding and precision.
- **Exception assertions**: `EXPECT_THROW()`, `EXPECT_ANY_THROW()`, `EXPECT_NO_THROW()` check for exception behavior.
- **Predicate and matcher-based assertions**: `EXPECT_PRED*` and `EXPECT_THAT()` allow checking complex conditions and using matchers.

### Example: Using Basic Assertions
```cpp
EXPECT_TRUE(IsReady());
EXPECT_EQ(expected_value, actual_value);
EXPECT_STREQ("hello", CStr);
EXPECT_FLOAT_EQ(3.14f, actual_float);
EXPECT_THROW(MyFunction(), std::runtime_error);
```

### Stream Custom Failure Messages
You can add explanation texts using streaming syntax:
```cpp
EXPECT_EQ(x, y) << "x and y should be equal after processing";
```

---

## 2. Using Matchers to Simplify Argument Verification in Mocks

Matchers in GoogleMock allow you to specify flexible and expressive criteria for mock method arguments and automated assertions.

### What Are Matchers?
Matchers are predicates used to verify if an argument or value meets a condition, documented by informative messages when mismatches occur.

- **Basic matchers:** `Eq()`, `Ne()`, `Gt()`, `Lt()`, `Le()`, `Ge()`.
- **Wildcard matcher:** `_` matches any value.
- **String matchers:** `HasSubstr()`, `StartsWith()`, etc.
- **Container matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `Pairs()`.

### Inline Example
```cpp
EXPECT_CALL(mock, Foo(Ge(5), HasSubstr("error")));
EXPECT_THAT(container, ElementsAre(1, _, 3));
```

### Combining Matchers
Compose complex expectations using:

- `AllOf()`: all predicates must hold
- `AnyOf()`: any predicate may hold
- `Not()`: negation

Example:
```cpp
EXPECT_CALL(mock, Bar(AllOf(Gt(5), Ne(10))));
```

### Matching Multiple Arguments at Once
Use `.With()` combined with tuple matchers or `Args<>` to match argument tuples:
```cpp
EXPECT_CALL(mock, Func(_, _)).With(Lt());  // First arg less than second arg
EXPECT_CALL(mock, Func()).With(AllArgs(Lt()));
```

### Special Matchers
- `Field()` and `Property()`: Check a member variable or a const methodâ€™s return value on an argument object.
- `Pointee()`: Dereference a pointer argument and match its value.

### Using Predicates as Matchers
Use `Truly()` to wrap any unary predicate for fine-grained control:
```cpp
EXPECT_CALL(mock, Foo(Truly(IsEven)));
```

### Reference Matchers
When matching arguments that cannot be copied, use `std::ref()` to avoid copies:
```cpp
EXPECT_CALL(mock, Foo(Eq(std::ref(bar))));
```

---

## 3. Setting Expectations with `EXPECT_CALL` and Behavior with Actions

Besides verifying call counts and arguments, you instruct mock behavior using `EXPECT_CALL` with clauses:

- `.Times()`: Specify how many times the expectation should be met (see cardinalities next).
- `.WillOnce()`: Specify the action(s) for individual calls.
- `.WillRepeatedly()`: Specify behavior for calls after `WillOnce()` actions are exhausted.
- `.InSequence()`: Ensure calls occur in a specified order.
- `.After()`: Specify dependencies indicating that a call must follow other expectations.
- `.RetiresOnSaturation()`: Automatically retire an expectation after it is fulfilled.

### Actions You Can Use
- `Return(value)`: Return a value.
- `ReturnRef(var)`: Return a reference.
- `ReturnPointee(ptr)`: Return what a pointer points to at call time.
- `Invoke(function_or_lambda)`: Call any callable object.
- `SetArgPointee<N>(value)`: Assign a value to an output argument.
- `DoAll(...)`: Chain multiple actions.
- `InvokeArgument<N>(args...)`: Invoke an argument callable.

### Example: Mocking a Method
```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(5))
    .WillRepeatedly(Return(10));
```

### Ordering Calls
To enforce call order:
```cpp
{
  InSequence s;
  EXPECT_CALL(mock, StepOne());
  EXPECT_CALL(mock, StepTwo());
}
```

### Partial Ordering With `InSequence` and `After`
Create sequences to specify partial orders for complex call dependencies.

### Sticky Expectations
Expectations remain active after their upper bounds are hit until explicitly retired or exceeded. Use `.RetiresOnSaturation()` to retire as soon as saturated.

---

## 4. Cardinalities: Specifying Call Count Expectations

Cardinalities define the expected number of times a method should be called within a test.

Built-in cardinalities include:

| Cardinality      | Meaning                                |
|------------------|----------------------------------------|
| `AnyNumber()`    | Method can be called any number of times |
| `AtLeast(n)`     | Called at least `n` times                |
| `AtMost(n)`      | Called at most `n` times                 |
| `Between(m, n)`  | Called between `m` and `n` times        |
| `Exactly(n)`     | Called exactly `n` times                 |

If omitted, GoogleMock infers the cardinality based on presence of `WillOnce()` and `WillRepeatedly()`.

### Example
```cpp
EXPECT_CALL(mock, Foo()).Times(AtLeast(2));
mock.Foo();
mock.Foo();  // Passes.
```

### Custom Cardinalities
You can define your own cardinality by implementing the `CardinalityInterface`.

---

## 5. Custom Matchers for Advanced Verification

When built-in matchers don't suffice, gMock makes it easy to write custom matchers:

- Use `MATCHER`, `MATCHER_P`, `MATCHER_P2`, ..., `MATCHER_P10` macros for quick declaration.
- Implement matcher interface classes for more control.

### Example: Simple Matcher
```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}
EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

### Parameterized Matcher
```cpp
MATCHER_P(InRange, range, "") {
  return range.first <= arg && arg <= range.second;
}
EXPECT_THAT(value, InRange(std::make_pair(1, 10)));
```

### Matcher Composition
Combine matchers using `AllOf()`, `AnyOf()`, `Not()` for expressive and readable checks.

### Providing Helpful Diagnostics
Use the `result_listener` argument in matcher definitions to give detailed failure info.

---

## 6. Troubleshooting Assertion and Matcher Issues

- **Uninteresting** calls: Methods with no expectation; by default generate warnings but are allowed.
- **Unexpected** calls: Calls that don't match any active expectation; cause an error.

Use `NiceMock` to suppress uninteresting call warnings, or `StrictMock` to treat them as errors.

Enable verbose output with `--gmock_verbose=info` to see detailed mock call tracing for debugging mismatches.

Verify expectations are set before exercising mocks, or behavior is undefined.

---

## 7. Practical Tips and Best Practices

- Use `ON_CALL()` to specify default behaviors without enforcing call counts.
- Use `EXPECT_CALL()` sparingly to verify important call expectations.
- Avoid over-specifying expectations to reduce brittle tests.
- Use wildcard `_` matcher or omit matchers when argument values are irrelevant.
- Retire saturated expectations to avoid sticky expectation errors where appropriate.
- Compose matchers and actions for cleaner, reusable test code.
- Use `EXPECT_THAT()` combined with matchers for rich assertions beyond basic equality.

---

## 8. Related Resources

- [GoogleTest Assertions Reference](../api-reference/test-and-assertion-api/assertions-api)
- [Matchers API](../api-reference/mocking-and-matcher-api/matcher-api)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [gMock for Dummies](docs/gmock_for_dummies.md)

---

By mastering GoogleTest assertions and GoogleMock matchers, you can write expressive tests that clearly communicate intended behavior and robustly verify your code, balancing precision and flexibility for maintainable test suites.
