---
title: "Improving Test Performance"
description: "Practical tips for reducing test execution time, managing large test suites, and using parallel execution utilities. Includes references to useful third-party tools and extensions."
---

# Improving Test Performance

This page provides practical tips to help you reduce test execution time, manage large test suites effectively, and leverage parallel execution utilities in GoogleTest and GoogleMock. It also points to valuable third-party tools and extensions that can boost your testing productivity.

## Why Focus on Performance?

In real-world projects, as your test suite grows to hundreds or thousands of tests, maintaining reasonable test execution time is crucial. Slow tests impact developer productivity, continuous integration latency, and feedback cycles. This page guides you through actionable strategies to speed up tests without compromising test quality.

---

## Frequently Asked Questions

### How can I reduce the execution time of my tests?

- **Use Parallel Test Execution:** GoogleTest supports running tests in parallel processes, which significantly reduces wall time on multi-core systems.
- **Avoid Expensive Setup in Fixtures:** Minimize initialization in `SetUp()` and `TearDown()` especially for tests that run often. Share resource initialization efficiently via the test suite setup.
- **Filter Tests to Run Subsets:** Use command-line flags like `--gtest_filter` to run only relevant tests while developing.
- **Shard Tests Across Machines or Processes:** Use test sharding to distribute tests evenly, maximizing resource utilization.

### What tools does GoogleTest provide for parallel execution?

- GoogleTest's own support for parallel tests is primarily through external wrappers and scripts that invoke multiple test instances concurrently.
- For example, [`gtest-parallel`](https://github.com/google/gtest-parallel) is a popular Python-based wrapper that distributes tests across CPU cores.
- Bazel build system integration can also help by parallelizing test executions as part of CI pipelines.

### How do I manage large test suites efficiently?

- **Organize tests logically:** Use test suites and test fixtures wisely to share setup and tear down.
- **Use test filtering and repetition:** Run only the tests you need using filters, and repeat flaky tests to identify issues.
- **Monitor and identify slow tests:** Use verbose logging or profiling wrappers to find tests with high execution time.
- **Consider splitting large test binaries:** Breaking down test executables can help parallelize execution and isolate slow or flaky tests.

### Are there recommended third-party tools to enhance test performance?

- **gtest-parallel:** Runs tests in parallel processes, balancing CPU load.
- **Bazel:** When used as your build and test system, it handles test discovery and parallel execution efficiently.
- **CTest:** CMake's test driver supports parallel test execution with the `--parallel` option.
- **Custom scripts:** Some organizations write their own wrappers to shard and distribute tests.

### How do I enable and configure parallel test runs?

- While GoogleTest itself doesn't provide built-in parallel test execution within a single binary, you can run multiple instances of your test executable concurrently.
- Use tools like `gtest-parallel` which will:
  - Discover all tests in your suite.
  - Spawn multiple processes to run tests in parallel.
  - Aggregate and report results.
- Configure your CI system to invoke such wrappers, passing the appropriate executable and environment variables.

### Can I use GoogleMock mocks safely in parallel or multi-threaded environments?

- GoogleMock is designed to be thread-safe when the underlying system supports pthreads.
- However, creating and setting expectations on mocks should be done in a single thread before exercising the code under test.
- Mock method calls from multiple threads are safely handled (see the `StressTest` in GoogleMock's own tests demonstrating multi-thread safety).

### What are common pitfalls that slow down my tests?

- **Heavy setup/teardown per test:** Expensive resource allocation or database setups in individual tests.
- **Running all tests unnecessarily:** Not filtering tests during iterative development.
- **Using strict mocks excessively:** Strict mocks add overhead to validate unexpected calls, consider using `NiceMock` to reduce noise and overhead.
- **Sequential test execution in CI:** Not parallelizing tests in CI pipelines wastes available resources.

### How do I identify slow tests?

- Run tests with verbose output enabled using `--gtest_print_time` flag to list execution time per test.
- Use profiling tools or add custom timers within your test fixtures.
- Run subsets of tests incrementally to isolate slow tests.

---

## Practical Tips and Best Practices

### 1. Parallelize Test Runs

- Use `gtest-parallel` or equivalent wrappers to run multiple test processes concurrently.
- Ensure your tests are independent; avoid shared global state that causes race conditions.
- Combine test sharding with parallel execution for maximum throughput.

### 2. Optimize Fixtures

- Avoid expensive setup in `SetUp()` unless necessary.
- Use shared resource fixtures at the test suite level (`SetUpTestSuite`) instead of per-test setup.
- Clean up resources promptly in `TearDownTestSuite`.

### 3. Selective Test Execution

- Use `--gtest_filter` to run only the changing parts while developing.
- Combine filters with `--gtest_repeat` to test flaky behaviors.

### 4. Split Large Test Suites

- Break down monolithic test executables into smaller binaries scriptable in CI.
- Enables parallelism and quicker test failure feedback.

### 5. Control Mock Strictness

- Use `NiceMock` for mocks where you are not interested in all method calls; reduces overhead.
- Reserve `StrictMock` for scenarios where unexpected calls are significant errors.

### 6. Continuous Profiling

- Regularly profile your tests to catch regressions in performance.
- Track historical test durations in CI to detect slowdowns.

### 7. Use Third-Party Extensions Wisely

- Integrate `gtest-parallel` for desktop or server builds.
- Use Bazel in builds where applicable to leverage its parallelism.
- Consider custom runners for embedded or constrained platforms.

### 8. Monitor Resource Usage

- Watch for memory, CPU, and disk usage spikes that elongate test runs.
- Use sampling and tracing tools if available.

---

## Troubleshooting Common Performance Issues

<AccordionGroup title="Troubleshooting Common Issues">
<Accordion title="Tests Running Sequentially Despite Parallel Setup">
Ensure you are using a parallel test runner like `gtest-parallel`. Just running `RUN_ALL_TESTS()` runs tests sequentially in one process.
</Accordion>
<Accordion title="Fixtures Causing Slowdowns">
Analyze your fixtures for unnecessary resource allocations. Move heavy setup to `SetUpTestSuite()` to reuse across tests.
</Accordion>
<Accordion title="Mock Strictness Causing Overhead">
Replace `StrictMock` with `NiceMock` if the strictness is not essential to reduce call monitoring overhead.
</Accordion>
<Accordion title="Flaky Tests Increasing Test Time via Retries">
Identify and fix flaky tests using repeated and shuffled runs instead of blindly retriggering.
</Accordion>
</AccordionGroup>

---

## Quick Reference

| Concept               | Tool / Feature              | Notes                                    |
|-----------------------|----------------------------|------------------------------------------|
| Parallel Execution    | `gtest-parallel`            | External tool, Python-based               |
| Test Filtering        | `--gtest_filter`             | Runs subset of tests                      |
| Test Sharding         | Custom + environment setups  | Runs separate shards of tests             |
| Mocks Strictness      | `NiceMock`, `NaggyMock`,`StrictMock` | Control warnings/errors on uninteresting calls  |
| Execution Profiling   | `--gtest_print_time`         | Prints individual test durations          |

---

## Additional Resources

- [gtest-parallel GitHub Repository](https://github.com/google/gtest-parallel) - A popular parallel test runner wrapper.
- [Performance and Scalability Strategies Guide](https://google.github.io/googletest/guides/advanced-usage-integration/performance-strategies.html) - In-depth strategies for test performance.
- [Troubleshooting Test Failures](../faq/troubleshooting/test-failures.md) - Complementary guide focusing on test correctness.
- [Mocking Best Practices](../guides/testing-patterns/mocking-best-practices.md) - Recommendations to optimize mock usages.
- CI Integration Guidelines: Refer to your CI platform for native parallelism support.

---

## Summary

Improving test performance involves strategic parallelization, test filtering, smart fixture design, and choosing the right mock strictness levels. Leveraging GoogleTest-compatible third-party tools like `gtest-parallel` or build systems like Bazel can dramatically reduce test execution times, especially with large suites. Regular profiling and monitoring uncover bottlenecks before they impact your workflow.

<Tip>
For best results, start by optimizing your test organization and fixture usage before adding parallel execution. This ensures your tests are stable and isolated, which is essential for safe parallelism.
</Tip>

---

## Example: Running Tests in Parallel Using `gtest-parallel`

```bash
# Install gtest-parallel via pip (if needed).
pip install gtest-parallel

# Run tests in parallel, auto-detecting number of CPU cores.
gtest-parallel path/to/your_test_binary

# To run a subset of tests, combine with --gtest_filter
# Passing --gtest_filter effectively filters which tests to run in parallel.
gtest-parallel path/to/your_test_binary -- --gtest_filter=FactorialTest.*
```

---

## Key Flags Relevant to Performance

- `--gtest_filter=<pattern>`: Run only tests matching the pattern.
- `--gtest_print_time`: Prints execution time for each test.
- `--gtest_repeat=<count>`: Repeat tests multiple times (useful for diagnosing flaky performance).

---

## Related Documentation

- [Performance and Scalability Strategies](../../guides/advanced-usage-integration/performance-strategies.md)
- [Mocking Patterns and Best Practices](../../guides/testing-patterns/mocking-best-practices.md)
- [Test Fixtures and Setup Optimization](../../api-reference/core-testing-api/test-fixtures-api.md)
- [Integrating with CI and Build Systems](../../guides/advanced-usage-integration/integration-ci-build.md)

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "gtest-parallel/README.md"}]} />