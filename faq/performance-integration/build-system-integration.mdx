---
title: "Build System and CI Integration Troubleshooting"
description: "Answers to common integration questions for CMake and Bazel users, including troubleshooting linker errors, package discovery failures, and best practices for integrating tests into CI workflows."
---

# Build System and CI Integration Troubleshooting

This FAQ page provides answers to common integration challenges encountered when using GoogleTest and GoogleMock with popular build systems, particularly CMake and Bazel. It focuses specifically on troubleshooting linker errors, package discovery failures, and best practices for incorporating tests into Continuous Integration (CI) workflows.

---

## Frequently Asked Questions

### Why am I getting linker errors when building tests with GoogleMock and GoogleTest?

Linker errors often arise when the test binary isn't correctly linked against the necessary GoogleMock or GoogleTest libraries.

**What to do:**
- Ensure you link with either `gmock_main` or `gmock` plus `gtest` libraries.
- If you rely on the default `main()` function for GoogleMock tests, link against `gmock_main`. For custom main functions, link against `gmock` and `gtest` explicitly.
- Verify your build system is providing the correct library paths and names.

**Example (CMake):**
```cmake
add_executable(my_tests test_suite.cpp)
target_link_libraries(my_tests gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

### How do I correctly set up GoogleTest and GoogleMock in a CMake project?

GoogleTest and GoogleMock provide CMake scripts for easy integration.

**Steps:**

1. Use `FetchContent` module for automatic download and configuration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test my_test.cpp)
target_link_libraries(my_test gtest_main gmock)
add_test(NAME my_test COMMAND my_test)
```

2. If GoogleMock is part of the project, add it as a subdirectory.
3. Confirm you are compiling with **C++17 or newer**.

### How can I resolve package discovery failures in Bazel?

When Bazel cannot find GoogleTest or GoogleMock packages:

- Confirm your `WORKSPACE` has external repository definitions for `googletest`.
- Keep the package versions consistent.
- Use official GoogleTest/Bazel rules to import dependencies.
- Double-check your `BUILD` files to properly reference the external targets.

### What compiler requirements are necessary for building GoogleTest and GoogleMock?

- A compiler supporting at least **C++17** standard is required.
- Minimum MSVC version is Visual C++ 2015 (14.0).

### How do I avoid runtime errors related to threading and exceptions during CI build?

- Verify the build environment supports pthreads if threading tests are enabled.
- For environments without pthread support, disable pthread by setting `-DGTEST_HAS_PTHREAD=0`.
- For shared libraries, ensure appropriate compiler flags `-DGTEST_CREATE_SHARED_LIBRARY=1` and `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` are set.

### What are best practices to integrate GoogleTest/GoogleMock tests in CI workflows?

- **Link tests properly:** Use `gmock_main` or `gmock` + `gtest` targets.
- **Use CTest or Bazel test runner:** CMake's `ctest` integrates seamlessly.
- **Isolate test failures:** Run tests separately and report results with standard formats.
- **Use compiler and linker flags consistently:** Avoid mixing debug and release builds.
- **Cache dependencies:** Use CMake's `FetchContent` to automatically manage source code dependencies.
- **Parallel Test Execution:** Configure test runners to run tests in parallel to reduce feedback time.

### How do I fix runtime errors caused by missing or wrong GoogleMock initialization?

- Always call `testing::InitGoogleMock(&argc, argv);` at the start of your `main()`.
- When using GoogleMock on embedded platforms, use the platform-specific main setup routines.

---

## Common Issues & Gotchas

### Linker Errors
- **Symptoms**: Undefined references to GoogleMock or GoogleTest symbols.
- **Cause**: Missing or incorrect linkage to `gmock`, `gmock_main`, `gtest`, or `gtest_main` libraries.
- **Fix**: Confirm linking libraries in your build system and order of linkage.

### Package Discovery Failures
- Missing `find_package(GTest CONFIG REQUIRED)` or incorrect Bazel BUILD file references.
- Solution is to ensure your environment points to the installed libraries or correctly adds the external repositories.

### Compiler Version Compatibility
- Using a compiler older than required may cause build failures.
- Always use a compiler supporting at least C++17.

### Mixing Static and Shared Libraries
- Linking GoogleTest or GoogleMock static libraries with shared libraries using different CRT (C runtime) settings leads to runtime crashes or errors.
- Use the `gtest_force_shared_crt` option in CMake or equivalent compiler flags to synchronize CRT linkage.

---

## Error Messages & Debugging

| Error Message                        | Meaning                                           | Resolution                                                              |
|------------------------------------|---------------------------------------------------|-------------------------------------------------------------------------|
| `undefined reference to gmock_main` | Missing linkage to the gmock_main library          | Link test executable with `gmock_main` as shown in CMake examples       |
| `mismatch detected for 'RuntimeLibrary'` | CRT linkage mismatch in MSVC                        | Use `-Dgtest_force_shared_crt=ON` or synchronize CRT linkage            |
| Package not found (CMake)           | Cannot find GoogleTest/GoogleMock in CMake paths  | Set CMAKE_PREFIX_PATH or install GoogleTest properly before find_package |

### Debugging Tips

- Use verbose build flags (`make VERBOSE=1` or equivalent) to inspect actual compile/link commands.
- Check that include directories for GoogleTest/GoogleMock are set correctly.
- Verify that threading libraries (`pthread`) are linked if multi-threading is enabled.
- For Bazel, run `bazel query //...` and inspect dependencies.

---

## Troubleshooting Procedures

### Step-by-step for Fixing Linker Errors in CMake

<Steps>
<Step title="Confirm Library Targets">
Ensure your `CMakeLists.txt` targets link against correct libraries: `gmock_main`, `gmock`, and `gtest`.
</Step>
<Step title="Check Compiler Flags">
Verify compiler is set to C++17 standard with `set(CMAKE_CXX_STANDARD 17)`.
</Step>
<Step title="Check Runtime Library Settings">
On MSVC, ensure consistent runtime linkage using `gtest_force_shared_crt` flag.
</Step>
<Step title="Run Clean Build">
Delete existing build artifacts and run a clean build using CMake and your chosen build tool.
</Step>
<Step title="Use Verbose Output">
Build with verbose flags to capture detailed error logs.
</Step>
</Steps>

### Bazel Troubleshooting

- Verify external dependencies and their versions in `WORKSPACE`.
- Use Bazel build and test output logs for diagnostics.
- Run `bazel query` to visualize linked dependencies and detect missing packages.

---

## Performance & Optimization Tips for CI

- Cache compiled GoogleTest and GoogleMock libraries between CI runs.
- Run tests in parallel using options like `ctest -j` or Bazel's test parallelism flags.
- Limit verbosity unless debugging to improve test output speed.
- Use filtering (`--gtest_filter`) to run relevant test subsets for quicker feedback.

---

## Security & Access Issues

- Ensure CI environment can access all required build resources and dependencies.
- Check file permissions for installed include and lib directories.

---

## Getting Help & Support

- **Official GitHub Repository:** <https://github.com/google/googletest>
- **Community Forums and Groups:** GoogleTest mailing lists and GitHub Discussions.
- **Documentation:** Main docs at <https://github.com/google/googletest/tree/main/docs>
- **Reporting Bugs:** Use GitHub Issues with clear reproduction steps.

---

## References and Further Reading

- [GoogleTest Installation and Setup Guide](../guides/getting-started/installation-setup)
- [GoogleMock README](../googlemock/README.md)
- [Build with CMake](../googletest/README.md#build-with-cmake)
- [First Steps and Troubleshooting](../getting-started/first-steps-usage/troubleshooting-setup.md)
- [Test Discovery and Execution FAQ](../faq/common-issues-solutions/test-discovery-running.md)
- [Performance Optimization FAQ](../faq/performance-integration/performance-best-practices.md)
- [Mocking Failures FAQ](../faq/common-issues-solutions/mocking-failures.md)

---