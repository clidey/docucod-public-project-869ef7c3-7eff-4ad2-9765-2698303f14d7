---
title: "Integrating with CI/CD Systems"
description: "Guidance on integrating GoogleTest/GoogleMock into popular CI/CD pipelines. Covers key environment variables, test output formats, and status reporting for automation systems."
---

# Integrating with CI/CD Systems

This page provides detailed guidance on integrating GoogleTest and GoogleMock into popular Continuous Integration and Continuous Deployment (CI/CD) pipelines. It covers environment variables, test output formats, and status reporting mechanisms essential for automation systems to run tests efficiently and reliably.

---

## 1. Overview of CI/CD Integration

Integrating GoogleTest/GoogleMock into your CI/CD pipeline ensures automated build verification, fast feedback on code health, and traceable test outcomes. This document focuses specifically on the *integration aspect* of GoogleTest and GoogleMock with CI systems — enabling smooth automation of test discovery, execution, and reporting.

Key outcomes for users:

- Run test binaries automatically and have results reliably consumed by CI tools
- Use environment variables to control test sharding and filtering
- Generate test reports in widely supported formats like XML and JSON
- Interpret exit codes for pass/fail status

---

## 2. Environment Variables for Automation

GoogleTest supports environment variables that enable precise control over test execution in CI environments.

### 2.1 Sharding Variables

GoogleTest supports *test sharding* where tests can be distributed across multiple machines or jobs.

- `GTEST_TOTAL_SHARDS`: Total number of shards to split the tests into.
- `GTEST_SHARD_INDEX`: The zero-based index of the shard that this test invocation is responsible for.

When these variables are set, GoogleTest automatically partitions tests so that each shard runs a disjoint subset of tests, covering all tests once across shards.

### 2.2 Filtering and Selection

- `GTEST_FILTER`: Restricts tests to run matching the specified pattern(s).

This lets CI jobs run subsets of tests, enabling targeted runs or faster testing cycles.

### 2.3 Other Useful Environment Variables

- `GTEST_OUTPUT`: Directs GoogleTest to produce output reports.
  - Use the syntax `xml:<file-path>` to generate XML reports.
  - Use `json:<file-path>` for JSON reports.
  - Omitting `<file-path>` saves to `test_detail.xml` or `test_detail.json` in the current directory.

- `GTEST_SHARD_STATUS_FILE`: When sharding is enabled, this points to a file where GoogleTest writes status updates. CI systems may use it to track health.

- `GTEST_FAIL_FAST`: If set (any non-zero value), causes the test run to stop immediately after a failure.

- `GTEST_COLOR`: Enables or disables color output; useful for readability in some environments.

---

## 3. Test Output Formats Supported

For integration with CI systems, GoogleTest supports generating detailed test result files that can be parsed and reported by automation servers.

### 3.1 XML Output (JUnit Compatible)

- Accessed via `--gtest_output=xml[:path]` or `GTEST_OUTPUT=xml[:path]`.
- Generates a report compatible with the JUnit format used by many CI tools.
- The XML report contains timing, status, and failure details per test.

Example invocation:

```bash
./my_tests_binary --gtest_output=xml:results/test_results.xml
```

### 3.2 JSON Output

- Activated with `--gtest_output=json[:path]` or `GTEST_OUTPUT=json[:path]`.
- Provides a structured JSON summary of the test run.
- Useful for CI systems or dashboards that consume JSON.

Example invocation:

```bash
./my_tests_binary --gtest_output=json:results/test_results.json
```

### 3.3 Console Output

- Human-readable logs with color support.
- Color behavior can be customized with `GTEST_COLOR`.
- Flooded output can be filtered or suppressed via `--gtest_brief` flag.

### 3.4 Exit Codes

- `0`: All tests passed.
- `1`: Some tests failed or an error occurred.

Always check the test executable exit code in your CI scripts to detect failures reliably.

---

## 4. Automating Test Execution Workflow

A typical CI runner integration with GoogleTest encompasses:

<Steps>
<Step title="Initialize the Test Environment">
Set necessary environment variables such as `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` if distributing tests.
</Step>
<Step title="Invoke Test Binary with Parameters">
Pass relevant flags to the test executable:
- `--gtest_output=xml:<file>` for report generation.
- Custom `--gtest_filter` to run subsets.
- Other flags like `--gtest_fail_fast` depending on pipeline requirements.
</Step>
<Step title="Capture Test Output and Exit Code">
Use your CI’s logging to record console output and capture the exit code for pass/fail decisions.
</Step>
<Step title="Publish Test Reports">
Upload or parse the generated XML/JSON report files into your CI system’s test result dashboard.
</Step>
</Steps>

---

## 5. Best Practices for CI/CD Integration

- **Always initialize GoogleTest using `InitGoogleTest()`**: This parses known flags and environment variables correctly.

- **Use `gtest_output` to generate structured reports**: Structured output enables test result insights and historical trend tracking.

- **Leverage sharding to speed up test execution**: Distribute tests across multiple executors via shard environment variables.

- **Respect exit codes in your pipelines**: The exit code accurately reflects test success or failure.

- **Avoid mixing disabled and enabled tests without control**: Use filtering flags to manage runs consistently.

- **Track flaky tests separately**: Use `--gtest_repeat` to identify and triage flaky tests effectively.

- **Control verbosity via flags/environment variables** for clear and concise CI logs.

- **Handle test failures gracefully**: Use `GTEST_FAIL_FAST` judiciously to balance early failure feedback versus full test reports.

---

## 6. Troubleshooting CI Integration Issues

### Problem: Test Runner Does Not Detect Failures

- Confirm the test binary returns the exit code from `RUN_ALL_TESTS()`.
- Set explicit environment variables or flags: `--gtest_fail_fast`, `GTEST_FAIL_FAST`.

### Problem: Sharded Tests Are Not Distributed Correctly

- Verify `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` are set correctly on each shard.
- Confirm that test binary is the same version on all shards.
- Check that `GTEST_SHARD_STATUS_FILE` is writeable if used.

### Problem: No XML or JSON Report Produced

- Ensure `--gtest_output` flag or `GTEST_OUTPUT` variable is specified correctly.
- Verify writable path for output files.
- Check that no errors occur early that might prevent report generation.

### Problem: Output Files are Overwritten or Missing

- Avoid specifying output paths that already exist without versioning.
- GoogleTest appends unique suffixes if files exist, but verify file naming if your CI cannot pick them up.

---

## 7. Example: Running GoogleTest in a Jenkins Pipeline

Here is a simplified shell snippet to run tests with XML output for Jenkins:

```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=${SHARD_INDEX}  # set per parallel job 0..3

./my_tests_binary --gtest_output=xml:results/test_results_${GTEST_SHARD_INDEX}.xml --gtest_color=yes

EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
  echo "Tests failed in shard ${GTEST_SHARD_INDEX}."
  exit $EXIT_CODE
fi
```

In Jenkins, accumulate all `test_results_*.xml` files into the JUnit test report for aggregate status.

---

## 8. Additional Resources

- [GoogleTest Primer](primer.md) — foundational knowledge for writing and running tests
- [Integration and Platform Support](overview/features-integration/integration-and-platforms) — details on environment support
- [Running Test Programs: Advanced Options](docs/advanced.md#running-test-programs-advanced-options) — deep dive on flags/environment
- [Mocking Cookbook](gmock_cook_book.md) — if using GoogleMock in your tests
- [FAQ: Integrating with CI/CD Systems](faq/performance-integration/ci-integration) — further troubleshooting and tips

---

For further assistance, review CI system documentation on test result consumers (JUnit XML, TAP parsing) and consult GoogleTest community forums.


---

**This page focuses solely on integrating GoogleTest and GoogleMock into CI/CD workflows and automation tools, supplementing other documentation that covers writing tests, mocking, and build system integration.**

---