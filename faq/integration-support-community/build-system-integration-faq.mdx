---
title: "Build System & Tool Integration"
description: "Explains how to integrate GoogleTest and GoogleMock into various build environments, highlights pkg-config usage, and covers common third-party CI/CD system queries."
---

# Build System & Tool Integration

This page explains how to integrate GoogleTest and GoogleMock into various build environments. It highlights using `pkg-config` for discovery and linking, and addresses common queries related to third-party Continuous Integration (CI) and Continuous Deployment (CD) systems.

---

## 1. Integrating GoogleTest and GoogleMock with Your Build System

GoogleTest and GoogleMock are designed to be easily integrated into diverse build environments, from simple Makefiles to advanced systems such as CMake, Bazel, and Visual Studio. The goal is to enable seamless compilation, linking, and test execution without complex setup.

### 1.1 Using CMake

GoogleTest provides built-in support for CMake, the widely used cross-platform build system. You can build GoogleTest and GoogleMock as standalone projects or incorporate them into existing CMake projects, enabling consistent compiler flags and settings across the codebase.

**Standalone Build:**

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
mkdir build
cd build
cmake ..  # Generates native build scripts including GoogleMock
make      # Builds the libraries
sudo make install  # (Optional) installs to system paths
```

To build GoogleTest *without* GoogleMock, add the option:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

**Including in Your Existing CMake Project:**

Use `find_package` or embed GoogleTest sources via `add_subdirectory`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # On Windows, match runtime linkage
FetchContent_MakeAvailable(googletest)

add_executable(MyTests test.cpp)
target_link_libraries(MyTests GTest::gtest_main GTest::gmock_main)
add_test(NAME MyTests COMMAND MyTests)
```

> **Pro Tip:** When embedding GoogleTest to your project, C++17 support must be defined (e.g., `set(CMAKE_CXX_STANDARD 17)`), ensuring compatibility across your build.

---

### 1.2 Using pkg-config

GoogleMock provides a `pkg-config` file (`gmock_main.pc`) which can be used to discover compile and link flags easily in environments where `pkg-config` is supported.

To check for GoogleMock, run:

```bash
pkg-config --cflags gmock_main
pkg-config --libs gmock_main
```

This retrieves all necessary compiler and linker flags, including threading dependencies. You can incorporate these flags into your Makefile or build scripts like so:

```makefile
GMOCK_CFLAGS := $(shell pkg-config --cflags gmock_main)
GMOCK_LIBS := $(shell pkg-config --libs gmock_main)

my_test: my_test.o
	$(CXX) -o $@ $^ $(GMOCK_LIBS)

my_test.o: my_test.cpp
	$(CXX) $(CXXFLAGS) $(GMOCK_CFLAGS) -c $<
```

---

### 1.3 Other Build Systems

#### Bazel

GoogleTest and GoogleMock are supported with dedicated Bazel build rules, facilitating integration into large scale projects with Bazel.

#### Visual Studio

A Visual Studio solution (`.sln`) is provided that can be used to build on Windows with IDE support.

#### Manual/Makefile Builds

Users working with ad-hoc or legacy build systems can place headers and source files directly in their project's include and source directories and link the compiled GoogleTest/GoogleMock static libraries accordingly.

---

## 2. Linking Against GoogleTest and GoogleMock Libraries

To use GoogleTest and GoogleMock correctly:

- Link against the appropriate libraries: `gtest`, `gtest_main`, `gmock`, and/or `gmock_main`.
- The `gtest_main` and `gmock_main` libraries provide the default `main()` function setup for tests.
- On most Unix-like platforms, linking with `-lpthread` or equivalent threading libraries is required. The provided `pkg-config` automatically adds these.

Example linking with CMake:

```cmake
target_link_libraries(my_test GTest::gtest_main GTest::gmock)
```

Example linking with manual compilation:

```bash
g++ my_test.o -lgmock_main -lgmock -lgtest -lpthread -o my_test
```

---

## 3. GoogleMock's `gmock_main` Integration

GoogleMock ships with the `gmock_main` library containing a default `main()` function that calls `testing::InitGoogleMock()` and executes all tests.

- Use `gmock_main` if you want to avoid providing your own `main` function.
- This library depends on `gmock` (the core GoogleMock library).

In many cases, linking against `gmock_main` replaces linking against `gtest_main`.

---

## 4. Common Integration Questions for Third-Party CI/CD Systems

**Q: How do I ensure GoogleTest and GoogleMock tests are discovered and run in CI pipelines?**

- Most CI systems detect tests based on executable output.
- GoogleTest produces detailed test results and supports reporting in XML via the `--gtest_output=xml` flag, which many CI dashboards consume.
- Configure your CI job to execute the test binaries and collect these reports.

**Q: Can GoogleTest run tests in parallel within a CI?**

- GoogleTest supports running tests in parallel by partitioning test runs (e.g., splitting tests by shard indices).
- Some CI systems offer native parallel execution or test sharding. Combine these with GoogleTest's filter flags for segmented execution.

**Q: Does GoogleMock require special configuration in CI environments?**

- No additional configuration is needed beyond the standard GoogleTest setup.
- Ensure your CI environment meets prerequisites such as compiler version and C++17 support.

**Q: Why does my CI runner fail to find GoogleTest or GoogleMock?**

- Ensure build configuration installs or provides GoogleTest and GoogleMock libraries.
- Use `pkg-config` or configured CMake options to specify library locations.
- Validate environment variables and paths within the CI environment.

---

## 5. Troubleshooting Integration Issues

**Common issues and solutions:**

| Issue                                   | Cause                                | Resolution                         |
|-----------------------------------------|------------------------------------|----------------------------------|
| Linker errors referencing `gtest` symbols | Mismatched or missing libraries     | Link with `gtest`, `gtest_main`, `gmock`, and `gmock_main` appropriately. Check order.
| Missing pthread linking                  | Threaded tests require pthread support | Link with `-lpthread` or use pkg-config flags.
| Duplicate symbols or conflicting runtime | Mixing static/dynamic runtimes      | On Windows, set `gtest_force_shared_crt` option in CMake to match your project.
| Tests not discovered or run              | Improper main function or missing test registration | Use `gtest_main` or `gmock_main` or provide your own `main()`. Ensure `InitGoogleTest` or `InitGoogleMock` is called properly in your main.

---

## 6. Summary of Best Practices

- Prefer using CMake integration when possible for smooth build and linkage.
- Use `pkg-config` to simplify compiler and linker flag retrieval.
- Link to `gmock_main` if you want automatic `main()` setup; otherwise provide your own.
- Always verify your CI environment supports your compiler and C++17.
- Use GoogleTest's built-in XML test reporting for better CI integration.

---

## 7. Example: Basic CMake Configuration Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Fetch googletest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_my_code.cpp)

target_link_libraries(my_tests GTest::gtest_main GTest::gmock)
add_test(NAME my_tests COMMAND my_tests)
```

---

## 8. Additional Resources

- [GoogleTest Primer](../overview/product-intro-and-value/what-is-googletest)
- [Installing GoogleTest and GoogleMock](../getting_started/setup_requirements_install/installing_framework)
- [GoogleMock Cheat Sheet](../docs/gmock_cheat_sheet.md)
- [Continuous Integration and Test Automation Guide](../guides/real-world-scenarios/ci-integration)
- [GoogleTest CMake Build Instructions](https://cmake.org/)

---

By following this documentation, you will confidently integrate GoogleTest and GoogleMock into your build environment and Continuous Integration pipeline, achieving reliable, repeatable automated testing.
