---
title: "How do I integrate GoogleTest/GoogleMock with my existing tools and CI?"
description: "Guidance for incorporating test frameworks into various build systems and CI pipelines. Lists integration considerations for CMake, Bazel, and other common environments, and links to practical samples and references."
---

# How do I integrate GoogleTest/GoogleMock with my existing tools and CI?

Integrating GoogleTest and GoogleMock effectively into your existing build systems, continuous integration (CI) pipelines, and development tools ensures smooth test execution, maintainability, and reliability. This guidance focuses on integration considerations for popular build systems like CMake and Bazel, outlines Continuous Integration-friendly practices, and provides links to practical examples and key references.

---

## 1. Supported Build Systems Overview

GoogleTest and GoogleMock support several widely used build systems to facilitate easy integration into your project:

- **CMake:** The recommended build configuration system. Most users embed GoogleTest as an external project or directly include `googletest` source trees.
- **Bazel:** Fully supported with official rules for testing and mocking.
- **Manual Builds:** Possible by compiling sources and linking, though not typically recommended in modern workflows.

Each build system requires particular considerations during setup detailed below.

---

## 2. Integrating GoogleTest/GoogleMock with CMake

### Basic Integration Steps

1. **Include GoogleTest Sources:**
   - Clone or download the googletest repository.
   - Add the GoogleTest source directory via `add_subdirectory()` in your `CMakeLists.txt`.

2. **Link against the `gtest` and `gmock` Targets:**
   - Link your test targets to `gtest`, `gtest_main`, `gmock`, and `gmock_main` as appropriate.

3. **Set Compiler and Linker Flags:**
   - Ensure necessary compiler flags are set.
   - GoogleTest requires at least C++17.

4. **Example CMake Snippet:**

```cmake
# Include GoogleTest (assumes googletest is downloaded in external/gtest)
add_subdirectory(external/gtest)

# Define your test executable
add_executable(my_tests test_file.cc)

# Link with gtest and gmock
target_link_libraries(my_tests gtest gmock pthread)

# Enable testing and register tests
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

### Best Practices

- Prefer using `gtest_main` and `gmock_main` for auto-provision of `main()`.
- Use `FetchContent` or ExternalProject to manage dependencies to keep builds reproducible.
- Pass necessary compile definitions or options via `target_compile_definitions`.

### Common Pitfalls

- Not including GoogleTest before defining your tests results in undefined references.
- Forgetting to link with pthread on Unix-like systems may cause linkage errors.

---

## 3. Integrating with Bazel

GoogleTest and GoogleMock have official Bazel support with first-class rules.

### Setup Overview

- Declare `@com_google_googletest` external repository in your `WORKSPACE`.
- Use Bazel `cc_test` and `cc_library` rules for your tests and mocks.
- Link appropriately to `@com_google_googletest//:gtest` and `//:gmock`.

### Example BUILD Snippet

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"],
)
```

### Best Practices

- Define mocks and their dependencies clearly in BUILD files.
- Use `testonly = True` for test-related libraries.
- Structure mocks in dedicated packages to minimize impact on production code.

---

## 4. Continuous Integration Considerations

### Seamless Test Execution

- Ensure your CI environment includes necessary build tools, compilers, and dependencies.
- Run tests via standard test runners (`RUN_ALL_TESTS()` for GoogleTest).
- Use CTest with CMake or Bazel test commands (`bazel test //...`) to integrate easily.

### Output and Reporting

- Generate XML output using GoogleTest's `--gtest_output=xml:path` for CI reporting.
- Adjust verbosity (`--gtest_verbose`) for test runs to expose test discovery or mocking issues.

### Best Practices

- Cache built GoogleTest/GoogleMock binaries or source trees to speed up CI builds.
- Use environment variables or flags to customize test execution (e.g., filter tests, adjust logs).
- Avoid mixing multiple gMock versions or conflicting dependencies.

---

## 5. Integration Samples and References

For concrete examples and configuration snippets, consult:

- [GoogleTest Primer](getting-started/first-steps-usage/writing-your-first-test.md) - foundational test writing.
- [gMock for Dummies](docs/gmock_for_dummies.md) - mock object basics.
- [gMock Cookbook](docs/gmock_cook_book.md) - advanced mocking patterns and best practices.
- [Getting Started Installation Guide](getting-started/preparation-installation/installation-methods.md) - build and dependency management details.
- [Integration & Extensibility Overview](overview/architecture-core-concepts/integration-overview.md) - conceptual integration guidance.

---

## 6. Troubleshooting and Tips

### Common Integration Issues

- **Tests not discovering or running:**
  - Confirm that you call `InitGoogleTest()` and/or `InitGoogleMock()` in your `main()`.
  - Verify test executables are linked with `gtest_main` or provide your own `main()`.
  - Check filtering flags or command-line arguments that might exclude tests.

- **Linker errors:** 
  - Link against both `gtest` and `gmock` libraries.
  - Ensure compatibility of compiler versions and flags.

### Tips for Successful Mock Usage

- Set expectations (`EXPECT_CALL`) before code exercises mocks.
- Use `ON_CALL` to set default mock behavior without enforcing expectations.
- Prefer `NiceMock` or `StrictMock` wrappers to control how uninteresting calls are handled in tests.

### Monitoring and Verbose Logs

- Run tests with `--gmock_verbose=info` to trace mock call matching and failures.
- Combine with `--gtest_stack_trace_depth` to control stack trace verbosity.

---

## 7. Additional Resources and Links

- [GoogleMock README](googlemock/README.md)
- [gMock FAQ](docs/gmock_faq.md)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [GoogleTest Primer](docs/primer.md)

---

## Summary Diagram

```mermaid
flowchart TD
  subgraph Build System
    A[CMake] --> B[Include googletest sources]
    C[Bazel] --> D[Declare & depend on googletest rules]
    E[Manual] --> F[Compile & Link sources manually]
  end

  subgraph CI Pipeline
    G[CI Environment] --> H[Run tests via test runners]
    H --> I[Collect Test Outputs & Reports]
  end

  B --> J[Compile & Link Tests]
  D --> J
  F --> J
  J --> H

  end

  %% Relationships
  J --> |Links| K[GoogleTest & GoogleMock Libraries]
```
