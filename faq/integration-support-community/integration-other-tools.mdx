---
title: "How do I integrate GoogleTest with my build and CI tools?"
description: "Answers questions about integrating the framework with different build systems (CMake, Bazel) and continuous integration environments. Highlights common configuration patterns and references to sample integrations."
---

# How do I integrate GoogleTest with my build and CI tools?

Integrating GoogleTest and GoogleMock into your development workflow effectively involves configuring your build system to compile and link the testing libraries, and embedding test execution within your Continuous Integration (CI) pipeline. This page addresses common questions and provides practical guidance on how to set up GoogleTest and GoogleMock with popular build systems like **CMake** and **Bazel**, and best practices for running tests in CI environments.

---

## 1. Integrating with CMake

GoogleTest provides first-class support for integration with CMake, which is widely used for C++ projects.

### 1.1 Building Standalone or as Subproject

- **Standalone Build:** You can clone the GoogleTest repository and build it independently.
  
  ```bash
  git clone https://github.com/google/googletest.git -b v1.17.0
  cd googletest
  mkdir build && cd build
  cmake ..
  make
  sudo make install  # installs GoogleTest on your system
  ```

- **As part of your project:** Incorporate GoogleTest directly into your existing CMake project using `add_subdirectory()`:

  ```cmake
  add_subdirectory(path/to/googletest)
  
  add_executable(my_tests test1.cpp test2.cpp)
  target_link_libraries(my_tests gtest_main gmock)
  add_test(NAME MyTests COMMAND my_tests)
  ```

  This ensures that GoogleTest is built using the same compiler settings as your project, avoiding runtime and ABI incompatibilities.

### 1.2 Using FetchContent to Download GoogleTest

For cleaner repository management, you can use CMake's `FetchContent` module, which downloads and configures GoogleTest during the configure step:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Windows runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test.cpp)
target_link_libraries(my_tests gtest_main gmock)
add_test(NAME MyTests COMMAND my_tests)
```

> **Tip:** Use `gtest_force_shared_crt` to fix runtime linkage differences on Windows between dynamic and static CRTs.

### 1.3 C++ Standard Version and Platform Requirements

- GoogleTest requires C++17 or newer.
- Specify `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)` in your `CMakeLists.txt` to ensure compatibility.

### 1.4 Running Tests

Use CTest or invoke the test binary directly:

```bash
ctest --verbose
# or
./my_tests --gtest_output=xml:report.xml
```

Include these commands in your CI pipeline to automate test execution and reporting.

---

## 2. Integrating with Bazel

Bazel support is included, facilitating scalable, hermetic builds.

### 2.1 Setup Workspace

Add GoogleTest and GoogleMock as `http_archive` dependencies in your `WORKSPACE`:

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.11.0.tar.gz"],
    sha256 = "<correct sha256>",
    strip_prefix = "googletest-release-1.11.0",
)
```

### 2.2 Define Your Test Target

In your `BUILD` files, reference GoogleTest and GoogleMock targets:

```starlark
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = [
        "@com_google_googletest//:gtest_main",
        "@com_google_googletest//:gmock",
    ],
)
```

Use `bazel test //path:my_test` to compile and run tests.

### 2.3 Running Tests in CI

Invoke Bazel tests as part of CI jobs. Bazel's output can be configured to produce XML reports for integration with tools like Jenkins or GitHub Actions.

---

## 3. Best Practices for CI Integration

### 3.1 Automate Test Runs

- Add test execution commands in your CI pipeline config.
- Capture and upload test reports (e.g., JUnit XML).

### 3.2 Manage Dependencies

- Pin GoogleTest and GoogleMock versions to avoid unexpected changes.
- Use reproducible builds with FetchContent or Bazel archives.

### 3.3 Isolate Test Environments

- Run tests in clean environments to avoid side effects.
- Use sanitized builds (AddressSanitizer, ThreadSanitizer) when possible.

### 3.4 Control Test Behavior with Flags

- Use GoogleTest/GMock runtime flags to adjust verbosity, filter tests, or control behavior.
- Initialize tests properly with `testing::InitGoogleTest(&argc, argv)` or `testing::InitGoogleMock(&argc, argv)` depending on your needs.

---

## 4. Common Configuration Patterns

### 4.1 Linking with gtest_main

When your test executable links against `gtest_main` or `gmock_main`, you don't need to provide your own `main()`:

```cmake
add_executable(test_runner test.cpp)
# Links gtest_main which supplies main()
target_link_libraries(test_runner gtest_main gmock)
```

### 4.2 Custom Main for Initialization

If you need to customize test initialization (for example to process custom flags), provide your own `main()`:

```cpp
#include <gmock/gmock.h>
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Remember to always return the result of `RUN_ALL_TESTS()` to signal test success or failure.

### 4.3 Verbosity and Flag Handling

- Use `--gmock_verbose=[info|warning|error]` to control logging verbosity.
- Flags recognized by GoogleMock are removed from argv during initialization.

---

## 5. References to Sample Integrations

- See the [Standalone CMake Project example](https://github.com/google/googletest/blob/main/CMakeLists.txt) for detailed integration.
- Check out the GoogleTest and GoogleMock `README.md` files for guidance on CMake and Bazel.
- Browse [GoogleTest's Quickstart Installation Guide](https://github.com/google/googletest/blob/main/docs/primer.md) for complete installation and running tests.

---

## 6. Troubleshooting Tips

### 6.1 Compilation and Linking Issues

- Verify the C++ standard is set to at least C++17.
- Ensure all source files and dependencies are included correctly.
- On Windows, confirm `gtest_force_shared_crt` is set if mixing CRT runtimes.

### 6.2 Test Discovery Fails

- Confirm test executables are linked with `gtest_main` or have a `main()` initializing GoogleTest.
- Check that your test targets are added correctly as tests in your build system.

### 6.3 CI Execution Failures

- Validate that test command outputs are compatible with CI test reporting tools.
- If tests hang, try running them with increased verbosity to identify issues.
- Use toolchain caching and sandboxing as recommended by your CI provider.

<Tip>
Before running tests in your CI environment, always verify local test execution with the same commands and flags you plan to use. This prevents surprises and facilitates debugging.
</Tip>

---

## 7. Related Documentation

- [GoogleTest Primer](primer.md) — Learn how to write and run your first tests.
- [Integration with Build Systems](overview/integration-feature-overview/integration-build-systems.md) — Overview of GoogleTest integration patterns.
- [Quickstart Installation Guide](guides/getting-started/quickstart-installation.md) — Step-by-step install and setup.
- [Troubleshooting Setup Issues](getting_started/first_test_and_validation/troubleshooting_setup.md) — Common build and runtime errors.
- [gMock Cookbook](gmock_cook_book.md) — Advanced mocking patterns useful when integrating with build and CI workflows.

---

By following the guidance and patterns outlined here, you will effectively integrate GoogleTest and GoogleMock into your build systems and CI pipelines, ensuring reliable automated testing and streamlined development workflows.

---

_For source code and additional files related to integration examples, refer to the official GoogleTest GitHub repository: https://github.com/google/googletest_  

---

<Source url="https://github.com/google/googletest" paths={[{"path": "googletest/CMakeLists.txt", "range": "1-80"},{"path": "googletest/README.md", "range": "1-110"}]} />
<Source url="https://github.com/google/googletest" paths={[{"path": "googletest/README.md", "range": "1-50"}]} />

