---
title: "Build System and Environment Integration"
description: "Answers frequent questions about integrating GoogleTest and GoogleMock with different build tools (Bazel, CMake, etc.), using pkg-config, adjusting configuration for different platforms, and linking best practices."
---

# Build System and Environment Integration

This page addresses frequently asked questions and practical guidance on integrating GoogleTest and GoogleMock with various build tools and environments. It covers building with CMake and Bazel, using `pkg-config` files, platform-specific configuration, linking strategies, and best practices to avoid common integration pitfalls.

---

## Table of Contents

- [Supported Build Systems](#supported-build-systems)
- [Using GoogleTest and GoogleMock with CMake](#using-googletest-and-googlemock-with-cmake)
- [Integrating GoogleTest in Bazel Projects](#integrating-googletest-in-bazel-projects)
- [Using pkg-config Files](#using-pkg-config-files)
- [Platform-Specific Configuration Tips](#platform-specific-configuration-tips)
- [Linking Best Practices](#linking-best-practices)
- [Common Issues & Troubleshooting](#common-issues--troubleshooting)

---

## Supported Build Systems

- **CMake:** Officially supported via provided `CMakeLists.txt` files in the repository.
- **Bazel:** Widely used in projects inside and outside Google with native integration.
- **Other Build Systems:** Can integrate GoogleTest/GoogleMock by including sources or linking to installed libraries.

When choosing a build system, consider your projectâ€™s existing infrastructure and platform targets.

---

## Using GoogleTest and GoogleMock with CMake

GoogleTest comes with a community-supported CMake build script under the root directory.

### Getting Started

```bash
git clone https://github.com/google/googletest.git
cd googletest
mkdir build && cd build
cmake ..
make
```

- To build only GoogleTest without GoogleMock, use:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

- To build GoogleMock's own tests (disabled by default), enable the option `-Dgmock_build_tests=ON`.

### Included Targets

- **gmock:** The GoogleMock library.
- **gmock_main:** GoogleMock library including a main() function.
- **gtest:** The GoogleTest library.

### Adding GoogleTest and GoogleMock to your Project

In your `CMakeLists.txt`, add:

```cmake
find_package(GTest REQUIRED)
add_subdirectory(path/to/googletest)
include_directories(${gtest_SOURCE_DIR}/include ${gmock_SOURCE_DIR}/include)

add_executable(your_test your_test.cc)
target_link_libraries(your_test gtest_main gmock_main pthread)
```

### Notes and Best Practices

- Use `gmock_main` when you want GoogleMock's main function for tests.
- The `gmock_build_tests` option controls building the GoogleMock test suite.
- The build script configures strict warning flags by default for GoogleMock.

### Troubleshooting CMake Builds

- Verify CMake version 3.13 or above.
- Ensure compiler supports C++17.
- On Windows, be mindful of runtime library mismatches.

See the [CMakeLists.txt documentation](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt) for details.

---

## Integrating GoogleTest in Bazel Projects

Bazel users can leverage the BUILD files and rules provided under `googletest/`:

- Use the `cc_test` rule to build and run GoogleTest-based tests.
- GoogleMock is integrated and is available alongside GoogleTest.

Example `BUILD` snippet:

```python
cc_test(
    name = "your_test",
    srcs = ["your_test.cc"],
    deps = ["@com_google_googletest//googletest:core",
            "@com_google_googletest//googlemock"]
)
```

Bazel handles dependency resolution internally, so no extra linking is needed.

---

## Using pkg-config Files

GoogleMock provides `.pc` files for pkg-config to simplify build integration:

- `gmock.pc` for the core GoogleMock library (without main()).
- `gmock_main.pc` for GoogleMock including a main() function.

Example usage:

```bash
pkg-config --cflags gmock
pkg-config --libs gmock
```

Include `gmock.pc` in your `PKG_CONFIG_PATH` to let your build system discover it.

This approach helps in projects using Autotools, Meson or other build systems supporting pkg-config.

---

## Platform-Specific Configuration Tips

- **Windows:**
  - Mind the distinction between static and shared runtime libraries.
  - Use CMake option `gtest_force_shared_crt` if mixing dynamic runtimes.

- **Linux/macOS:**
  - Verify pthread support as GoogleTest requires it for thread safety.
  - Use CMake or Bazel defaults to handle linking pthread when necessary.

- **Cross-compilation:**
  - Adjust compiler and linker flags accordingly.
  - Ensure C++17 support and proper library discovery in the cross-build environment.

Refer to [Supported Platforms & Integration Points](https://github.com/google/googletest/blob/main/overview/architecture-audience-integration/platforms-and-integration-points.mdx) for detailed compatibility information.

---

## Linking Best Practices

- Link your test binaries with `gtest_main` or `gmock_main` to get a suitable `main()` function.
- If you provide your own `main()`, link only with `gtest` and/or `gmock`.
- Link with pthread library explicitly if required (usually handled by CMake or Bazel).
- For shared libraries, use `BUILD_SHARED_LIBS=ON` CMake option.

---

## Common Issues & Troubleshooting

### Uninteresting Mock Function Call Warnings

- Caused by calls to mock methods without explicit expectations.
- Use `NiceMock<T>` to suppress warnings for uninteresting calls.
- Use `StrictMock<T>` to treat uninteresting calls as errors.
- Alternatively, add `EXPECT_CALL(...).Times(AnyNumber())` for methods called freely.

### Linking Errors

- Missing symbols or duplicate symbols often relate to incorrect linking order.
- On Windows, ensure consistent runtime linkage (static vs dynamic).
- Verify `CMAKE_CXX_STANDARD` is set to at least 17.

### Build Failures in CMake

- Make sure the GoogleTest sub-directory is added before your targets.
- Check the availability of GoogleTest libraries paths.
- Enable `gmock_build_tests` only if you want to build GoogleMock's own tests.

### Compiler Compatibility

- GoogleTest requires a C++17 compatible compiler.
- Use recent versions of GCC, Clang, or MSVC with the required C++ support.

### Using GoogleMock and Threads

- GoogleMock is thread-safe and supports multi-threaded tests if the platform supports pthreads.
- Avoid setting expectations while the mock is accessed concurrently.

---

## Additional Resources

- [GoogleTest Getting Started Guide](https://github.com/google/googletest/blob/main/guides/getting-started/setup-installation.md)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Supported Platforms & Integration Points](https://github.com/google/googletest/blob/main/overview/architecture-audience-integration/platforms-and-integration-points.mdx)
- [CMakeLists.txt for GoogleMock](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)

---

With these guidelines, you can confidently integrate GoogleTest and GoogleMock into your build environment, ensuring smooth, reliable test builds and execution across platforms and build tools.

<Check>
Ensure your compiler supports C++17 and pthreads for thread safety.
Use `gmock_main` for main() implementations when appropriate.
Manage mock strictness modes (`NiceMock`, `StrictMock`) to control uninteresting call warnings.
</Check>

---

*This document is part of the broader GoogleTest documentation set. For more on writing tests and mock usage, see [GoogleTest Primer](../docs/primer.md) and [gMock for Dummies](../docs/gmock_for_dummies.md).*