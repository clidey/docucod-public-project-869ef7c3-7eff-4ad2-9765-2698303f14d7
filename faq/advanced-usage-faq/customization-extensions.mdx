---
title: "Customization & Extension"
description: "Answers for topics related to advanced usage, such as writing custom assertions, extending test discovery, or using GoogleTest/GoogleMock in non-standard setups."
---

# Customization & Extension

This documentation page addresses advanced usage topics to help you customize and extend GoogleMock’s capabilities. It covers writing custom matchers and actions, controlling mock behavior modes, and tailoring GoogleMock to suit domain-specific test requirements or non-standard testing setups.

---

## 1. Creating Custom Matchers

Custom matchers allow you to express complex argument validations when built-in matchers fall short. They empower your tests to precisely capture domain-specific properties and establish richer contracts on mock interactions.

### Quick Definition Using MATCHER Macros

GoogleMock provides a family of macros (`MATCHER`, `MATCHER_P`, etc.) which let you rapidly define new matchers.

```cpp
MATCHER(IsEven, "Checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

You can also stream additional information to the output to help with debugging failures.

### Writing Custom Matcher Classes

If you need more control or polymorphism, define a matcher class implementing:

- `bool MatchAndExplain(arg_type arg, std::ostream* os) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

For polymorphic matchers, template on the argument type:

```cpp
class NotNullMatcher {
 public:
  using is_gtest_matcher = void;

  template <typename T>
  bool MatchAndExplain(T* ptr, std::ostream*) const {
    return ptr != nullptr;
  }

  void DescribeTo(std::ostream* os) const { *os << "is not NULL"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }
};

inline PolymorphicMatcher<NotNullMatcher> NotNull() {
  return MakePolymorphicMatcher(NotNullMatcher());
}
```

### Tips for Custom Matchers

- Avoid side effects inside matchers; they may be called multiple times.
- Provide rich `DescribeTo` and `DescribeNegationTo` for clearer failure messages.
- Use parameterized macros like `MATCHER_P` for reusable parameterized matchers.

For extensive guidance, see the [`Custom Matchers`](reference/actions-matchers-and-customization/custom-actions-matchers.md#custom-matchers) section.

---

## 2. Writing Custom Actions

Actions define what a mock method does when called. When built-in actions like `Return`, `Invoke`, or `SetArgPointee` don’t fit your needs, define your own.

### Using Lambdas or Functors

The simplest way is to use lambdas or callable objects compatible with the mock method signature:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int x) { return x * 2; });
```

### Defining Actions with ACTION Macros

For reusable actions, GoogleMock supports macro-based definitions:

```cpp
ACTION_P(IncrementBy, n) {
  return arg0 + n;
}

EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementBy(5));
```

Note: These macros don’t specify argument types explicitly and can produce cryptic errors if misused.

### Implementing ActionInterface

For advanced cases or better type safety, implement the `ActionInterface<F>` template:

```cpp
template <typename F>
class IncrementAction : public ActionInterface<F> {
 public:
  Result Perform(const std::tuple<int>& args) override {
    return std::get<0>(args) + 1;
  }
};

Action<int(int)> Increment() {
  return MakeAction(new IncrementAction<int(int)>);
}
```

### Polymorphic Actions

To create an action usable across multiple mock function signatures, create an implementation class with a templated `Perform` method and wrap it with `MakePolymorphicAction`:

```cpp
class ReturnFirstArgumentAction {
 public:
  template <typename Result, typename Args>
  Result Perform(const Args& args) const { return std::get<0>(args); }
};

inline PolymorphicAction<ReturnFirstArgumentAction> ReturnFirstArgument() {
  return MakePolymorphicAction(ReturnFirstArgumentAction());
}
```

### Combining Actions

Use utilities like `DoAll()`, `IgnoreResult()`, and `InvokeArgument<>` to compose multiple behaviors in a single expectation.

### Recommendations

- Prefer lambdas or `Invoke` to quickly express custom behaviors.
- Use ACTION macros for simple reusable actions.
- Use ActionInterface and polymorphic actions for maximum flexibility and type safety.

For full details, refer to the [`Custom Actions`](reference/actions-matchers-and-customization/custom-actions-matchers.md#custom-actions) documentation.

---

## 3. Controlling Mock Behavior Modes

GoogleMock supports different mock *behavior modes* that control how uninteresting calls (calls with no explicit expectations) are handled.

- **NaggyMock**: Default mode. Prints warnings on uninteresting calls.
- **NiceMock**: Suppresses warnings on uninteresting calls. Useful when you want cleaner test output without false alarms.
- **StrictMock**: Turns uninteresting call warnings into test failures. Useful for strict enforcement of interface usage.

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;       // Warns suppressed.
NaggyMock<MockFoo> naggy_mock;     // Default mode.
StrictMock<MockFoo> strict_mock;   // Fail on unexpected calls.
```

### Runtime Control

You can also change behavior programmatically using the `Mock::AllowUninterestingCalls()`, `Mock::WarnUninterestingCalls()`, and `Mock::FailUninterestingCalls()` APIs.

These modes help balance between noisy test output and strict interface contract enforcement.

For more, see the [`Mock Behavior Modes`](concepts/mocking-models/mock-behavior-modes.md) and [`Nice, Naggy, Strict`](gmock_cook_book.md#NiceStrictNaggy) sections.

---

## 4. Advanced Test Discovery and Custom Test Setups

While not covered extensively in standard GoogleMock APIs, you can extend test discovery and customize GoogleMock's integration into unusual or non-standard setups by:

- Implementing custom matchers and actions to extend expressiveness.
- Using GoogleMock’s low-level internals (e.g., mock object registries) carefully if needed.
- Integrating mocks properly with your build and test frameworks to ensure test discovery compatibility.

Refer to guides on [Creating and Using Mocks](guides/mocking-and-advanced-techniques/creating-and-using-mocks.md) and [Advanced Mocking Patterns](guides/mocking-and-advanced-techniques/advanced-mocking-patterns.md) for details.

---

## 5. Troubleshooting Custom Extensions

When extending GoogleMock with custom matchers or actions, keep these in mind:

- Ensure that custom matchers are pure functions without side effects.
- Provide meaningful descriptions for clarity in test failure messages.
- Avoid undefined behavior by not calling mock methods from inside matchers.
- Verify action signatures match mock method signatures.
- Use `--gmock_verbose=info` to trace mock calls and diagnose unexpected matcher or action behaviors.

If you face complexity, consult the `gmock-spec-builders_test.cc` and `gmock_cook_book.md` files as practical reference points.

---

## 6. Practical Examples

### Custom Matcher Example

```cpp
MATCHER_P(IsInRange, range, "Checks if number is in range") {
  return arg >= range.first && arg <= range.second;
}

EXPECT_CALL(mock, GetValue()).WillOnce(Return(10));
EXPECT_CALL(mock, SetValue(IsInRange(std::make_pair(5, 15))));
```

### Custom Action Example

```cpp
ACTION(LogAndReturn) {
  std::cout << "Function called with arg: " << arg0 << std::endl;
  return arg0 * 2;
}

EXPECT_CALL(mock, Double(_)).WillOnce(LogAndReturn());
```

### Delegating Calls to Real Object

```cpp
class RealFoo { public: int DoIt(int x) { return x + 1; } };
class MockFoo : public RealFoo {
 public:
  MOCK_METHOD(int, DoIt, (int x), (override));

  MockFoo() {
    ON_CALL(*this, DoIt).WillByDefault([this](int x) { return RealFoo::DoIt(x); });
  }
};
```

This combo lets you mix mocking and real behavior flexibly.

---

## 7. Related Documentation

- [gMock Cookbook](guides/mocking-and-advanced-techniques/gmock_cook_book.md) for recipes and patterns.
- [Mocking Reference](api-reference/mocking-and-behavior-specification/mocking.md) for API details of mocking interfaces.
- [Matchers Reference](api-reference/actions-matchers-and-customization/builtin-matchers.md) for built-in matchers.
- [Actions Reference](api-reference/actions-matchers-and-customization/builtin-actions.md) for built-in actions.
- [Mock Behavior Modes Guide](concepts/mocking-models/mock-behavior-modes.md).

---

For source code and implementation details, consult the internal `gmock-spec-builders.cc` and tests `gmock-spec-builders_test.cc`.

---