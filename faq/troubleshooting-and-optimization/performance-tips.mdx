---
title: "Improving Test Performance"
description: "Offers practical suggestions for speeding up test execution, optimizing test design, and using parallelism or focused builds. Ideal for larger or growing codebases where testing speed matters."
---

# Improving Test Performance

This page offers practical suggestions for speeding up test execution, optimizing test design, and leveraging parallelism or focused builds. It is ideal for projects with larger or growing codebases where testing speed directly impacts developer productivity.

---

## Key Strategies for Improving Test Performance

GoogleTest provides several approaches to enhance the speed and efficiency of your test suite. These strategies center on optimizing individual tests, restructuring test fixtures, running tests in parallel, and utilizing test filters or sharding.

### 1. Optimize Test Setup and TearDown

Expensive setup or teardown operations significantly slow down tests. To mitigate this:

- Use **per-test-suite setup and teardown** (`SetUpTestSuite()` and `TearDownTestSuite()`) to share expensive resources among all tests in a suite instead of recreating them for each test.
- Avoid global shared mutable state that requires costly resets between tests.
- Keep per-test setup small and fast.

#### Example of Sharing Resources Across Tests

```cpp
class ExpensiveResourceTest : public testing::Test {
 protected:
  static std::unique_ptr<ExpensiveResource> resource_;

  static void SetUpTestSuite() {
    resource_ = std::make_unique<ExpensiveResource>();
    resource_->Initialize();
  }

  static void TearDownTestSuite() {
    resource_.reset();
  }
};

std::unique_ptr<ExpensiveResource> ExpensiveResourceTest::resource_ = nullptr;

TEST_F(ExpensiveResourceTest, Test1) {
  EXPECT_TRUE(resource_->IsReady());
}

TEST_F(ExpensiveResourceTest, Test2) {
  EXPECT_TRUE(resource_->DoWork());
}
```

### 2. Use Test Fixtures Judiciously

GoogleTest creates a new fixture object for each test method, which ensures isolation but can carry overhead. Design your fixture to:

- Initialize only what's necessary per test.
- Use fixture member variables to cache expensive intermediates.
- Prefer the fixture constructor or `SetUp()` for quick preparation.

### 3. Take Advantage of Test Filtering

Run only selected tests relevant to the current development.

- Use the `--gtest_filter` flag to include or exclude tests based on name patterns.
- This practice speeds iterative development by focusing test runs.

### 4. Repeat Flaky Tests to Pinpoint Failures

Use the `--gtest_repeat` flag to run tests multiple times, helping identify sporadic failures that impact confidence and productivity.

### 5. Run Tests in Parallel with Sharding

GoogleTest supports sharding to distribute tests across multiple machines or processes.

- Set environment variables `GTEST_TOTAL_SHARDS` (total shards) and `GTEST_SHARD_INDEX` (current shard index).
- Each shard runs a portion of the tests, reducing total time.

Ensure your tests are safe to run concurrently without shared mutable state issues.

### 6. Use Disabled Tests to Manage Large Test Suites

Temporarily prefix tests with `DISABLED_` to exclude long-running or flaky tests while working on faster ones.

### 7. Optimize Assertions

Minimize expensive assertion sub-expressions. Prefer specific assertions over generic ones to avoid heavy computations when not needed.

---

## Best Practices and Common Pitfalls

### Best Practices

- Design tests for **independence and speed**.
- Prefer **sharing immutable test data** over heavy re-instantiations.
- Use **parameterized tests** to consolidate redundant tests.
- Clean up resources quickly to avoid leaks slowing subsequent tests.
- Regularly profile test execution times to identify bottlenecks.

### Common Pitfalls

- Overusing expensive setup in `SetUp()` causing slow tests.
- Mutating shared state across tests, leading to flaky and slow runs.
- Ignoring uninteresting tests in test filters, leading to unnecessarily long test runs.
- Not leveraging test sharding in CI pipelines.

---

## Troubleshooting Performance Issues

If your tests run slower than expected, consider the following checklist:

- Does your fixture do expensive work for every test? Move to `SetUpTestSuite()` if possible.
- Are there unnecessary global or static variables being reset repeatedly?
- Are you running all tests when you want to focus on a subset? Use filters.
- Are tests truly independent, or do side effects cause retries or timeouts?
- Is your environment configured to run tests in parallel or sharded?

Profiling your test suite runtime and CPU usage can highlight hotspots.

---

## Tools and Flags for Performance Optimization

| Tool / Flag                  | Description                                        |
|-----------------------------|--------------------------------------------------|
| `--gtest_filter`             | Run subset of tests selectively                    |
| `--gtest_repeat=N`           | Run all tests N times for flakiness detection      |
| `--gtest_shuffle`            | Run tests in randomized order to detect dependencies |
| `GTEST_TOTAL_SHARDS` & `GTEST_SHARD_INDEX` | Environment variables for test distribution across parallel machines |
| `DISABLED_` prefix           | Disable slow or flaky tests temporarily            |
| `SetUpTestSuite()` / `TearDownTestSuite()` | Shared setup and teardown per test suite         |

Deploy these tools effectively within CI/CD pipelines to balance coverage and speed.

---

## Further Reading and References

To deepen your understanding and explore advanced techniques on test performance and design, consult these related pages:

- [GoogleTest Primer](primer.md): Foundation for writing tests.
- [Advanced GoogleTest Topics](advanced.md): Detailed techniques including test fixtures and parameterized tests.
- [Running Tests Guide](getting-started/first-test-and-validation/running-tests): Flags and filters for test execution.
- [Continuous Integration Integration](overview/architecture-features-integration/integration-scenarios): Best practices using GoogleTest in CI.

For community tips and gathering further help, see [Where Can I Get Help?](faq/community-and-support/where-to-get-help) and [Contributing and Community](faq/community-and-support/contributing-and-community).

---

## Practical Tips to Get Started Now

- Profile your test run time to find bottlenecks.
- Move expensive initializations into `SetUpTestSuite()`.
- Use `--gtest_filter` for focused development cycles.
- Organize tests into well-named suites to enable effective filtering.
- Enable sharding in your build environment if you have resources to parallelize tests.

By systematically applying these steps, you can achieve much faster test turnaround and better developer productivity.

---

<Note>
Fast test execution is crucial for developer productivity and sustained code quality. Investing time in structuring your tests for efficient setup, leveraging GoogleTest's test filtering and sharding capabilities, and avoiding costly global states will yield immediate and ongoing benefits.
</Note>
