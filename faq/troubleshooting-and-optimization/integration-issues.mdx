---
title: "Integration Issues with Build Systems"
description: "Addresses problems that arise when integrating GoogleTest with build tools like CMake or Bazel, including configuration pitfalls, linking issues, and test target visibility."
---

# Integration Issues with Build Systems

This FAQ page specifically addresses challenges encountered when integrating GoogleTest with popular build systems such as **CMake** and **Bazel**. It highlights common pitfalls during configuration, linking errors, and visibility problems of test targets, guiding you toward smoother build and test workflows.

---

## Frequently Asked Questions

### Why do I get linking errors related to GoogleTest when using CMake or Bazel?
Linking errors typically arise when GoogleTest libraries are not linked correctly to your test targets. This can happen if:

- The GoogleTest dependency is missing in your `CMakeLists.txt` or Bazel `BUILD` file.
- The target visibility settings prevent your tests from accessing GoogleTest.
- In Bazel, the `deps` attribute on the test rule does not include the gtest library.

**How to fix:**
- Ensure you find and link GoogleTest explicitly (CMake example below).
- For Bazel, confirm your `deps` include `@com_google_googletest//:gtest` or equivalent.

```cmake
find_package(GTest REQUIRED)
target_link_libraries(my_test PRIVATE GTest::gtest GTest::gtest_main)
```

---

### My tests are not discovered or run despite being defined. Why?
This often happens due to incorrect source inclusion or build target definitions:

- In CMake, the test source files may not be added to the executable linked with gtest.
- In Bazel, test sources may not be specified correctly under your `cc_test` target.

**Resolution:**
Make sure test files are added properly and that the test target is linked against GoogleTest.

---

### What does `GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST` mean and when should I use it in build integration?
If you define **value-parameterized tests** with `TEST_P` but forget to instantiate them using `INSTANTIATE_TEST_SUITE_P`, your build may generate warnings or errors during test runs.

To suppress these when using GoogleTest with CMake or Bazel, add the macro `GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST(YOUR_TEST_SUITE);` in your test code. This is especially important for libraries that provide parameterized test fixtures meant to be instantiated externally.

---

### How can I ensure that death tests run correctly with my build system?
GoogleTest **death tests** (`EXPECT_DEATH`, `ASSERT_DEATH`) require special care:

- Naming conventions: Place death tests in test suites named ending with `*DeathTest`. This ensures they run before other tests.
- Test ordering: GoogleTest runs all death test suites first, so your build system must expose these tests correctly.
- Thread safety: If your environment creates threads early, consider setting the death test style to "threadsafe" to avoid hangs.

In CMake and Bazel, confirm that test targets with death tests are correctly marked and linked for execution order.


---

## Common Configuration Pitfalls

### 1. Forgetting to link `gtest_main` or `gtest` libraries
Your test executable should link to either `gtest_main` (which provides `main()`) or link `gtest` and supply your own `main()` function.

**Example with CMake:**
```cmake
target_link_libraries(my_test PRIVATE GTest::gtest_main)
```

### 2. Incorrect test source or target visibility
GoogleTest headers and libraries may be visible to your test target but not the actual test sources, or vice versa. Make sure source files and libraries are properly scoped and visible.

In Bazel, ensure the `visibility` attribute on rules allows test binaries to depend on the GoogleTest libraries.

### 3. Mixing `TEST` and `TEST_F` with inconsistent fixtures in the same test suite
This causes runtime linking errors and test failures:

```
All tests in the same test suite must use the same test fixture class.
```

Check your test suite definitions for inconsistent fixtures when integrating with your build system.

---

## Troubleshooting Linking Issues

### Undefined reference errors like `undefined reference to 'testing::InitGoogleTest'`
- This means the GoogleTest library is not linked.
- Check your link command to confirm `-lgtest` or equivalent is present.
- In Bazel, confirm `deps` in `cc_test` includes `@com_google_googletest//:gtest`

### Multiple definition errors
- Occur if GoogleTest source files are compiled in multiple targets.
- Avoid linking GoogleTest source files directly in multiple test targets.
- Use pre-compiled GoogleTest libraries or targets instead.

### Test executable runs but no tests are found
- Verify test source files are compiled and linked into the executable.
- Confirm your test functions are properly defined with `TEST` or `TEST_F` macros.
- Check command-line filters (`--gtest_filter`) do not exclude all tests.

---

## Test Target Visibility Issues

### What if I get "Undefined symbol" errors for tests defined in other libraries?
- Ensure test targets are linked against all required dependencies.
- Symbol visibility rules in CMake may restrict symbols; use `-fvisibility=default` or appropriate properties.

### How do I organize test targets when testing large codebases?
- Group tests by module or feature.
- Define shared test fixtures and link the fixtures as separate targets.
- Use interface libraries in CMake to manage GoogleTest dependencies efficiently.

---

## Best Practices

- Prefer linking against pre-built GoogleTest targets (`GTest::gtest`, `GTest::gtest_main`) instead of compiling sources yourself.
- For Bazel, always use the official GoogleTest Bazel rules and dependencies.
- Follow naming conventions for death tests and parameterized tests to avoid execution order problems.
- Use `GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST()` when appropriate to prevent failures related to uninstantiated parameterized tests.
- When adding new tests, ensure your build files are updated accordingly with sources and dependencies.

---

## Additional Help & Support

If you continue to experience integration issues:

- Review the [Integration Scenarios guide](../overview/architecture-features-integration/integration-scenarios) for practical examples.
- Consult [Quickstart with CMake](../guides/getting-started/quickstart-cmake) or [Quickstart with Bazel](../guides/getting-started/quickstart-bazel) for getting started instructions.
- Check the common errors section in the [Common Errors FAQ](../faq/troubleshooting-and-optimization/common-errors).
- Search or post questions on community forums like Stack Overflow or GoogleTest GitHub issues.

---

For detailed flag configurations and command-line options, see the [Running Test Programs: Advanced Options](../docs/advanced.md#running-test-programs) section.

---

## Summary
This page provides focused answers to problems encountered when integrating GoogleTest with CMake and Bazel, including linking errors, test discovery problems, and test target visibility. It offers targeted solutions, examples, and best practices to help you seamlessly build and run tests.

---