---
title: "How do I fix build or linker errors with GoogleTest/GoogleMock?"
description: "Explains the most common build and linking problems, including missing symbols, ABI incompatibilities, and shared/static library pitfalls. Provides user-friendly steps for diagnosis and resolution."
---

# How do I fix build or linker errors with GoogleTest/GoogleMock?

This page addresses the most common build and linking problems encountered when integrating GoogleTest and GoogleMock in your C++ projects. You will learn how to diagnose issues such as missing symbols, ABI incompatibilities, and shared/static library pitfalls, along with clear, user-friendly steps to resolve them.

---

## Common Build and Linking Problems Explained

### 1. Missing Symbols (Undefined References)

One of the typical errors during build or linking is encountering missing symbols for GoogleTest or GoogleMock functions or classes. This usually manifests as linker errors such as:

```shell
undefined reference to `testing::MockFoo::SomeMethod()'
```

**Root Cause:**
- GoogleMock or GoogleTest source files are not linked properly.
- Incorrect or incomplete linkage of the GoogleTest/GoogleMock static or shared libraries.
- Omitting required compilation units for mocks (e.g., missing mock implementation files).

**How to Fix:**
- Make sure you're linking against both GoogleTest and GoogleMock libraries if you are using mocks.
- When using GoogleMock, include its source or library explicitly, as it depends on GoogleTest.
- If building your tests with CMake or Bazel, ensure the build targets include `gmock` and `gtest` dependencies properly.
- Confirm that all mock classes generated with `MOCK_METHOD()` macros and their associated source files are compiled and linked.

<Tip>
Always compile and link both the `gtest` and `gmock` libraries in your project if you intend to use mocking features.
</Tip>

### 2. ABI Incompatibilities

ABI (Application Binary Interface) mismatches occur when GoogleTest/GoogleMock are built with different compiler flags or different compiler versions than your code.

**Common scenarios:**
- GoogleTest/GoogleMock built with a different C++ standard version (e.g., C++11 vs C++17)
- Mismatch in compiler flags related to exception handling, RTTI, or standard library versions

**Symptoms:**
- Linker errors for symbols that seem present but have incompatible signatures
- Runtime crashes or undefined behavior after linking successfully

**How to Fix:**
- Ensure GoogleTest/GoogleMock and your project use the same compiler version and flags.
- Specifically, set the C++ language standard consistently (commonly C++17 for GoogleTest).
- When building GoogleTest/GoogleMock from source, use the same build environment and options as your code.
- If you're using precompiled binaries, verify they match your platform and compiler version.

<Note>
GoogleTest and GoogleMock require at least C++11, with C++17 being recommended and widely supported.
</Note>

### 3. Shared vs Static Libraries

Linking errors can also stem from confusion between static and shared linking.

**Problems:**
- Static library missing object files that GoogleMock relies on
- Shared library linkage not specified correctly, resulting in unresolved external symbols

**How to Fix:**
- When linking statically, include all needed GoogleMock and GoogleTest objects.
- For shared libraries, ensure the dynamic libraries (`.dll`, `.so`, `.dylib`) are discoverable at runtime.
- Verify your build system passes the correct linker flags and includes library search paths.

<Tip>
Use CMake targets `gtest` and `gmock` properly to avoid manual linking issues.
</Tip>

### 4. Missing Virtual Destructor in Mocked Interfaces

A subtle cause of linker or runtime failures with mocks is when the interface you mock does not have a virtual destructor.

Without a virtual destructor, deleting a mock object through a base class pointer leads to undefined behavior and can cause heap corruption or silent leaks.

**How to Fix:**
- Ensure your base class (interface) that you mock has a **virtual destructor**.

```cpp
class Foo {
 public:
  virtual ~Foo() = default;  // Must be virtual to avoid leaks.
  virtual void DoSomething() = 0;
};
```

### 5. Linking to Compiler-Generated Symbols for Move-Only and Template Mocks

When mocking functions with move-only types (e.g., `std::unique_ptr`) or complex templates, compilation can fail or generate linker errors if the mock method definitions are spread across several translation units or if inline constructors/destructors get duplicated.

**How to Fix:**
- Define mock class constructors and destructors in `.cc` files, instead of header-only, to reduce compilation overhead and linkage errors.
- For complex mocks, avoid inline definitions of constructors/destructors when possible.

<Tip>
See the [Mocking Best Practices](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#making-the-compilation-faster) for guidance on faster compilation and linking.
</Tip>

### 6. Duplicate or Conflicting Mock Symbols

If you link against multiple conflicting versions of GoogleTest/GoogleMock, you can have duplicate symbols, causing multiple definition errors.

**How to Fix:**
- Clean your build to remove stale object files.
- Only link to a single consistent version of GoogleTest/GoogleMock.
- Ensure third-party libraries you use don't embed conflicting versions.

<Tip>
Use tools like `ldd` or `otool` to check runtime dependencies on shared libraries.
</Tip>

---

## Step-by-Step Diagnosis and Resolution Workflow

<Steps>
<Step title="Check Linker Error Messages">
Review the exact symbols missing or duplicated in linker errors. This helps pinpoint the affected mock method or component.
</Step>
<Step title="Verify Build and Link Parameters">
Check your compiler and linker flags for consistency, especially C++ standard versions, exceptions, and RTTI.
</Step>
<Step title="Confirm GoogleTest/GoogleMock Sources or Libraries Are Included">
Ensure `gtest` and `gmock` are included properly in your build system, either as sources or prebuilt libraries.
</Step>
<Step title="Ensure Virtual Destructors in Base Interfaces">
Inspect all base classes you mock to confirm they have virtual destructors.
</Step>
<Step title="Clean and Rebuild">
Delete intermediate artifacts and rebuild everything from scratch to avoid stale binaries.
</Step>
<Step title="Use Verbose Build Output for Clues">
Enable verbose mode in your build tool (e.g., CMake VERBOSE=1) to spot missing or incorrect link steps.
</Step>
<Step title="Check for ABI Mismatch">
Confirm that GoogleTest/GoogleMock and your project compile with compatible compilers and flags.
</Step>
<Step title="Consider Using `NiceMock` or `StrictMock` Correctly">
For uninteresting call warnings or errors related to mocking, ensure you use appropriate wrappers like `NiceMock` to suppress unwanted warnings, or `StrictMock` for stricter validations.
</Step>
</Steps>

---

## Practical Tips and Best Practices

- **Use CMake Targets**: When possible, depend on `gmock` and `gtest` via their official CMake targets to handle compilation and linkage automatically.
- **Mock Methods with `MOCK_METHOD`**: Always use the `MOCK_METHOD` macro to define mock methods correctly.
- **Enable Heap Checking**: To avoid memory leaks related to mocks, enable heap checking tools or flags in your tests.
- **Isolate Mock Interfaces**: Only mock interfaces you own or control, to reduce breakage when upstream code changes.
- **Avoid Repeated Linking**: Link GoogleTest/GoogleMock static libraries only once per executable to prevent symbol duplication.
- **Check Compiler Warnings**: Pay attention to warnings related to const qualifiers, calling conventions, and function signaturesâ€”especially with MSVC.

---

## Troubleshooting Specific Scenarios

<AccordionGroup title="Common Build and Linker Issues">
<Accordion title="Missing symbol errors for mock methods">
This happens when you forget to link GoogleMock or mock implementation sources. Confirm you build and link `gmock_main` or equivalent.
</Accordion>
<Accordion title="Unmatched method signatures causing linker errors">
Check that your mock method declarations match the virtual method precisely, including const, noexcept, and reference qualifiers.
</Accordion>
<Accordion title="Warning C4301 or C4373 on MSVC for const parameters">
This is a known MSVC compiler bug. Remove `const` from top-level parameters in your mock methods to avoid the warning.
</Accordion>
<Accordion title="Unresolved symbols due to mismatched C++ standards">
Rebuild GoogleTest/GoogleMock with the same C++ standard version used by your project.
</Accordion>
</AccordionGroup>

---

## Additional Resources

- [GoogleTest and GoogleMock Download & Build Guide](https://github.com/google/googletest/blob/main/docs/README.md)
- [Common Setup Issues Documentation](https://github.com/google/googletest/blob/main/docs/getting-started/setup-troubleshooting/common-setup-issues.mdx)
- [Mocking Best Practices](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#mocking-best-practices)
- [GoogleMock FAQ](https://github.com/google/googletest/blob/main/docs/gmock_faq.md)
- [GoogleMock Spec Builders Detail](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-spec-builders.h)

For comprehensive setup guidance, also consider the [Installing with CMake](https://github.com/google/googletest/blob/main/docs/getting-started/installation-and-configuration/install-cmake.mdx) and [Installing with Bazel](https://github.com/google/googletest/blob/main/docs/getting-started/installation-and-configuration/install-bazel.mdx) documentation.

---

## Related Documentation

- [Common Setup Issues](../getting-started/setup-troubleshooting/common-setup-issues.mdx) - For installation pitfalls
- [Strict, Nice, and Naggy Mocking Modes](../api-reference/gmock-api/strictness-and-mock-behavior.mdx) - To understand error versus warning behaviors on uninteresting calls
- [Mock Methods](../api-reference/gmock-api/mock-methods.mdx) - How to declare and use mock methods correctly
- [Using Mocks in Tests](../docs/gmock_for_dummies.md) - Foundational guide to mocking

---

If you continue to encounter blocker errors, consider reaching out via community channels such as GitHub issues or Stack Overflow with detailed logs and your build configuration.
