---
title: "Integration with CMake, Bazel, and Other Build Tools"
description: "Guides users through common integration problems and compatibility questions with CMake, Bazel, and other build systems. Offers troubleshooting tips to ensure smooth setup and upgrades in your preferred development workflow."
---

# Integration with CMake, Bazel, and Other Build Tools

This guide assists you in integrating GoogleTest and GoogleMock with common build systems such as CMake and Bazel, addressing frequent integration challenges and compatibility questions. It provides troubleshooting tips and best practices to ensure a smooth setup and upgrade experience within your specific development workflow.

---

## Table of Contents

- [Integrating GoogleTest with CMake](#integrating-googletest-with-cmake)
- [Using GoogleMock with CMake](#using-googlemock-with-cmake)
- [Managing Dependencies and Linking](#managing-dependencies-and-linking)
- [Common Integration Challenges & Troubleshooting](#common-integration-challenges--troubleshooting)
- [Integrating with Bazel](#integrating-with-bazel)
- [Tips for Other Build Tools](#tips-for-other-build-tools)
- [Best Practices and Recommendations](#best-practices-and-recommendations)

---

## Integrating GoogleTest with CMake

GoogleTest provides a comprehensive CMake build script that supports diverse platforms. Although maintainers do not use CMake internally, the scripts are community-supported and robust for general use.

### Standalone Build

To build GoogleTest standalone using CMake:

1. Clone the GoogleTest repository:

   ```bash
   git clone https://github.com/google/googletest.git -b main
   cd googletest
   mkdir build
   cd build
   cmake ..
   make
   ```

2. By default, this also builds GoogleMock. To build only GoogleTest, disable GoogleMock:

   ```bash
   cmake .. -DBUILD_GMOCK=OFF
   ```

3. Install GoogleTest (optional, for system-wide usage):

   ```bash
   sudo make install
   ```

### Incorporating into Your Existing CMake Project

The recommended integration approach is to add GoogleTest as a subdirectory in your main project CMake build, which ensures compiler and linker consistency:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Visual Studio dynamic CRT
FetchContent_MakeAvailable(googletest)

add_executable(your_tests your_tests.cpp)
target_link_libraries(your_tests GTest::gtest_main)
add_test(NAME your_tests COMMAND your_tests)
```

This approach supports all major platforms, avoids incompatibility issues, and allows straightforward version management.

### Key Recommendations

- Use `gtest_main` for linking if you want to avoid defining your own `main()` function.
- For Visual Studio users, use the `gtest_force_shared_crt` option to align runtime linkage.
- Ensure C++17 (or a compatible standard) is enabled in your project to match GoogleTest's requirements.

---

## Using GoogleMock with CMake

GoogleMock's CMake build is included alongside GoogleTest. The `CMakeLists.txt` file:

- Automatically locates GoogleTest sources, usually in the sibling `googletest` directory.
- Defines options like `gmock_build_tests` to toggle building GoogleMock's own test suite.
- Provides the libraries `gmock` and `gmock_main` for user code linkage.

### Linking Libraries in Your Project

You should link your tests against either `gmock` or `gmock_main`:

- `gmock` requires you to provide your own `main()` function.
- `gmock_main` provides a built-in `main()` that initializes GoogleMock and requests running tests.

Example linking snippet:

```cmake
add_executable(my_tests my_tests.cpp)
target_link_libraries(my_tests gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

### Building GoogleMock's Internal Tests

The internal GoogleMock tests are not built by default. To build and run them (mainly for GoogleMock contributors or advanced users), set:

```bash
cmake -Dgmock_build_tests=ON ..
make
ctest
```

This enables comprehensive internal verification of GoogleMock's functionality.

---

## Managing Dependencies and Linking

### Include Directories

The CMake build scripts exposed include directories automatically to user targets when linking to `gmock` or `gmock_main`. The include directories cover both GoogleMock's and GoogleTest's headers, avoiding manual path configurations.

### Compiler and Linker Flags

The GoogleMock CMake setup configures stricter warnings to ensure high code quality. When integrating, your project may:

- Need to align warning levels and compiler flags.
- Use `config_compiler_and_linker()` to set sane defaults.

### Handling Shared vs Static Libraries

By default, GoogleTest and GoogleMock build static libraries. To build shared libraries (DLLs), set:

```bash
cmake -DBUILD_SHARED_LIBS=ON ..
```

Note:

- Some platforms and configurations will require installing shared libraries appropriately.
- On Windows, matching runtimes with your project (dynamic vs static) avoids linker conflicts.

---

## Common Integration Challenges & Troubleshooting

### Build Failures

- Ensure your compiler supports C++17 or newer, as it’s required.
- Check that all required dependencies like pthreads (on POSIX) are available.
- For Visual Studio, use `gtest_force_shared_crt=ON` when your project uses dynamic CRT.

### Linking Errors

- Verify you link against `gtest`, `gtest_main`, `gmock`, or `gmock_main` libraries as appropriate.
- Match the linkage type (static/shared) with your project and GoogleTest build.
- If using FetchContent, ensure GoogleTest was added before your test targets are defined.

### Unresolved Symbols

Occurs when linking against GoogleMock but missing GoogleTest linkage. Always ensure `gmock` links against `gtest` internally.

### Unexpected Behavior with `main()`

- If you define your own `main()`, link against `gmock`.
- If you want to use GoogleMock's provided `main()`, link against `gmock_main` but do not provide your own `main()`.

### CMake Version

GoogleTest requires CMake 3.13 or higher for GoogleMock support and recommends 3.14+ for FetchContent convenience.

---

## Integrating with Bazel

Bazel users can integrate GoogleTest and GoogleMock via [rules_cc](https://github.com/bazelbuild/rules_cc) or community-maintained Bazel rules. While GoogleTest itself doesn’t provide official Bazel build files, many projects maintain Bazel targets for GoogleTest.

To get started:

- Use `http_archive` or similar to fetch GoogleTest sources.
- Define `cc_library` targets for GoogleTest and GoogleMock.
- Link your test binaries with these targets.

Please consult your organization's Bazel guidelines or Bazel community documentation for details on maintaining and updating GoogleTest dependencies.

---

## Tips for Other Build Tools

For projects using build systems other than CMake or Bazel, such as Make, Ninja, or custom solutions:

- Include GoogleTest and GoogleMock sources in your build tree or as submodules.
- Compile the GoogleTest/gtest-all.cc and GoogleMock/gmock-all.cc sources with consistent flags.
- Link the resulting objects into your test executables.
- Be meticulous with include paths to avoid conflicting versions.

Consult platform-specific or build system-specific instructions and adapt accordingly.

---

## Best Practices and Recommendations

- Prefer adding GoogleTest and GoogleMock as a subproject using CMake's `FetchContent` or equivalent. This keeps dependency management clean and consistent.

- Link against `gtest_main` or `gmock_main` when you want to avoid writing your own test entry point.

- Use consistent compiler flags across your project and the test framework to avoid subtle bugs related to ABI or linkage.

- During upgrades, read the [Release Notes and Breaking Changes](https://github.com/google/googletest/blob/main/CHANGELOG.md) carefully to identify integration-impacting modifications.

- For customized testing flows, write your own `main()` function and link against `gtest` or `gmock` (not the `_main` variants).

- Build and run GoogleMock's internal tests (`gmock_build_tests`) when contributing or if you suspect integration issues.

- Leverage CTest (`ctest`) for running tests within CMake projects in an automated and controlled manner.

---

## Additional Resources

- [GoogleTest README](https://github.com/google/googletest/blob/main/googletest/README.md) – General build instructions and installation guidance.
- [GoogleMock CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt) – Reference for GoogleMock's CMake configuration.
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) – Overview of test writing and execution.
- [Troubleshooting Setup Issues](https://github.com/google/googletest/blob/main/getting-started/first-steps-usage/troubleshooting-setup.md) – Help with common problems during integration.

---