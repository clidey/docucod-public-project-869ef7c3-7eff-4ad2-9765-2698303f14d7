---
title: "How can I reduce the runtime of my test suite?"
description: "Tips and strategies for diagnosing and resolving performance bottlenecks in your test suite, including guidance on running tests in parallel, using parameterized tests efficiently, and proper test filtering."
---

# How can I reduce the runtime of my test suite?

Optimizing the runtime of your test suite is crucial for maintaining developer productivity and enabling frequent, fast feedback. GoogleTest and GoogleMock offer several strategies and best practices to help you diagnose and mitigate performance bottlenecks in your tests. This document guides you through practical tips to run tests efficiently, manage resource consumption, and leverage parallelism and filtering.

---

## 1. Run Tests in Parallel

### Why Parallelism Matters
Running tests in parallel leverages multi-core CPUs to significantly reduce overall test execution time. Many environments and build systems support parallel test execution.

### Best Practices:
- Use your test runner's parallel execution feature (e.g., `--gtest_parallel` or build system integration).
- Ensure tests are isolated without shared global state to avoid flaky behavior.
- Design mocks and fixtures to be thread-safe or to run in single-threaded contexts.

### Example
```bash
# Run tests in parallel with 8 workers
./my_test_binary --gtest_parallel=8
```

### Notes
- GoogleMock supports multi-threaded tests; see the [Using gMock and Threads](https://google.github.io/googletest/gmock_cook_book.html#UsingThreads) section for guidelines.
- Verify that mocks and test dependencies handle concurrency correctly.

---

## 2. Use Parameterized Tests Efficiently

### What Are Parameterized Tests?
Parameterized tests allow you to run the same test logic with different inputs, avoiding code duplication.

### Tips for Performance
- Avoid heavy setup within parameterized tests; put expensive setup in the test fixture `SetUpTestSuite()` instead of `SetUp()`.
- Limit the number of parameters to necessary cases; avoid exhaustive combinatorial parameters unless critical.
- Use custom test framework filters to selectively run subsets of parameters.

### Example
```cpp
class MyTest : public ::testing::TestWithParam<int> {
  // Shared costly setup can go here
  static void SetUpTestSuite() {
    // Expensive one-time initialization
  }
};

TEST_P(MyTest, WorksForVariousInputs) {
  int param = GetParam();
  EXPECT_TRUE(FunctionUnderTest(param));
}

INSTANTIATE_TEST_SUITE_P(VariousParams, MyTest, ::testing::Values(1, 2, 3));
```

---

## 3. Filter Tests to Run Only What You Need

### Using Test Filters
Use GoogleTest's `--gtest_filter` flag to run only relevant test cases or test suites.

### Examples
```bash
# Run tests whose names start with FooTest
./my_test_binary --gtest_filter=FooTest.*

# Exclude slow tests
./my_test_binary --gtest_filter=-*Slow*
```

### Benefits
- Quickly iterate on a subset of tests.
- Avoid running long or flaky tests during development runs.

---

## 4. Minimize and Optimize Mocking Overhead

### Best Practices
- Only mock what is necessary to support focused tests.
- Use `NiceMock` when you want to ignore uninteresting calls and reduce warning overhead.
- Avoid overly complex expectations that can slow down test execution.
- Leverage `ON_CALL` to define default behavior without enforcing calls unless verification is needed.

### Resources
- See [Creating and Using Mocks](https://google.github.io/googletest/guides/mocking.html) for efficient mock usage.
- For advanced performance tuning of mocks, consult the [Mocking Best Practices](https://google.github.io/googletest/guides/mocking-best-practices.html).

---

## 5. Use `SetUp` and `TearDown` Wisely

### Tips
- Keep `SetUp()` and `TearDown()` lightweight to avoid repeated costly operations.
- Use `SetUpTestSuite()` and `TearDownTestSuite()` for one-time initialization and cleanup.

### Example
```cpp
class MyFixture : public ::testing::Test {
 public:
  static void SetUpTestSuite() {
    // Initialize shared expensive resource once.
  }

  void SetUp() override {
    // Lightweight setup per test.
  }
};
```

---

## 6. Profile and Diagnose Slow Tests

### Enable Verbose Logging
Use `--gtest_verbose=info` and `--gmock_verbose=info` to get detailed logs tracing test and mock calls, useful to identify slow or unexpected invocations.

### Use Test Timing
Many test runners report time taken per test. Identify the slow tests and focus on optimizing them first.

### Debugging Mock Performance
- Check for excessive or complex expectations.
- Avoid nesting mocks unnecessarily.

---

## 7. Avoid Over-Specification in Tests

### Why It Matters
Tests with overly strict or redundant expectations can slow down execution and make maintenance harder.

### Strategy
- Focus expectations on critical interactions.
- Use `ON_CALL` for common default behavior instead of `EXPECT_CALL` where call count is not critical.

---

## 8. Clean Up Mock Objects

### Ensure Mock Lifetime
GoogleMock verifies expectations on mock object destruction. If mocks live too long or are leaked, the system spends extra cycles managing them.

### Tips
- Delete mock objects promptly after use.
- Use `Mock::AllowLeak()` judiciously only if intentional.

---

## 9. Practical Tips and Example Workflow

<Steps>
<Step title="Define Mock and Tests">
Create mock classes with `MOCK_METHOD` macros and write test cases with focused expectations.
</Step>
<Step title="Set Default Behavior">
Use `ON_CALL` to define default mock behaviors that allow tests to pass without needing every call to be explicitly expected.
</Step>
<Step title="Write Specific Expectations">
Add `EXPECT_CALL` only for interactions that must be verified.
</Step>
<Step title="Run with Filters and Parallelism">
Use `--gtest_filter` to target tests, and run tests in parallel using your build tool or test runner.
</Step>
<Step title="Measure and Profile">
Monitor test execution times and increase verbosity if required to diagnose performance bottlenecks.
</Step>
</Steps>

---

## Additional Resources

- **GoogleTest & GoogleMock Guides**: [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html), [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html), [Mocking Best Practices](https://google.github.io/googletest/guides/mocking-best-practices.html)
- **Flags and Options**: `--gtest_filter=`, `--gtest_parallel`, `--gmock_verbose=info`
- **Google Test Main Documentation**: [GoogleTest Overview](https://google.github.io/googletest/overview.html)

---

<Tip>
Parallelization and filtering are your strongest levers for reducing test suite runtimes effectively. Combine these with efficient mocking and well-structured tests to achieve fast, reliable feedback.
</Tip>

<Warning>
Avoid overusing `EXPECT_CALL` for every mock method call; excessive constraints increase test maintenance and can degrade performance.
</Warning>

<Check>
Always make sure your mocked methods are thread-safe and tests are isolated for parallel execution.
</Check>
