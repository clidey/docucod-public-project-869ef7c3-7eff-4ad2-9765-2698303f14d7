---
title: "How do I integrate GoogleTest/GoogleMock with my CI pipeline?"
description: "Covers best-practice recommendations for setting up and troubleshooting continuous integration with GoogleTest, including environment setup for Linux, MacOS, and Windows, and hints for automating test discovery and reporting."
---

# How do I integrate GoogleTest/GoogleMock with my CI pipeline?

Integrating GoogleTest and GoogleMock into your Continuous Integration (CI) pipeline is a strategic step to ensure code quality, maintainability, and rapid feedback during development. This document provides best-practice recommendations and practical tips to set up and troubleshoot continuous integration workflows involving GoogleTest and GoogleMock across Linux, macOS, and Windows environments.

---

## 1. Preparing Your Environment for Continuous Integration

Before integrating tests into your CI pipeline, ensure that your test environment is fully set up on all target platforms.

### Supported Platforms
- **Linux:** Most distributions with modern toolchains support GoogleTest and GoogleMock smoothly.
- **macOS:** Ensure Xcode command line tools and modern C++ compilers are installed.
- **Windows:** Use Visual Studio or compatible build tools supporting C++17 and above.

### Common Prerequisites
- C++17 or higher compliant compiler.
- Build system configured (e.g., Bazel, CMake) with GoogleTest and GoogleMock added as dependencies.
- Network access for cloning or pulling updated test frameworks, if needed.

<Check>
Always run a local verification build and test run mimicking CI platform settings before automation.
</Check>

## 2. Automating Discovery and Execution of Tests

GoogleTest automatically discovers tests defined with `TEST()` and `TEST_F()` macros. This feature is crucial for reliable CI execution without extra configuration.

### Test Discovery
- Your test binaries will include all registered tests.
- Using `--gtest_list_tests` command-line flag lists all available tests, useful for debugging.

### Running Tests in CI
- Invoke test executables with `RUN_ALL_TESTS()` in your main function.
- Capture exit code (`RUN_ALL_TESTS()` returns 0 if all tests succeed, non-zero otherwise).

### Integration Tips
- Use GoogleMock's `InitGoogleMock()` for initialization, which also initializes GoogleTest.
- Include GoogleMock and GoogleTest dependencies appropriately in your build system to be linked into test executables.

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### CI Scripts
- Schedule test runs via scripts that invoke your test binaries.
- Employ flags such as `--gtest_output=xml:report.xml` to generate machine-readable reports.
- Collect artifacts logs and results for analysis.

<Tip>
Consider running tests in parallel if supported by your CI system to speed up feedback.
</Tip>

## 3. Managing Test Dependencies and Build Integration

Proper build system configuration is key to smooth CI integration.

### Build System Setup
- **Bazel:** Add GoogleTest and GoogleMock as workspace dependencies. Import and link test targets properly.
- **CMake:** Include `FindGTest.cmake` or equivalent, and link `${GTEST_BOTH_LIBRARIES}` to test targets.

### Dependency Versioning
- Lock to specific GoogleTest and GoogleMock versions to prevent CI breakages due to upstream changes.
- Use submodules or vendored code as needed.

### Environment Consistency
- Use containerized environments or reproducible VM images ensuring consistent compiler and library versions

<Warning>
Unmanaged changes in GoogleTest or GoogleMock versions may cause unexpected test failures.
</Warning>

## 4. Automating Test Reporting and Feedback

To make your CI pipeline effective, you need clear reporting of test outcomes.

### Common Practices
- Generate XML reports using `--gtest_output=xml:<file>`.
- Use CI tools like Jenkins, GitHub Actions, or GitLab CI to parse these reports.
- Enable verbosity when investigating flaky or failing tests with `--gmock_verbose=info`.

### Fail-Fast and Retry Strategies
- Configure your CI system to fail builds as soon as critical tests fail.
- Implement retry mechanisms for flaky tests with proper tracking.

### Notifications
- Tie test results to email/slack notifications.
- Include failure logs and stack traces from GoogleTest for quick diagnosis.

## 5. Best Practices for CI with GoogleTest and GoogleMock

### Code and Test Organization
- Group related tests into test suites for easy filtering.
- Use test fixtures (`TEST_F()`) for shared setup/teardown.

### Expectation Management in GoogleMock
- Set `EXPECT_CALL` before exercising mocks to ensure proper verification.
- Use `ON_CALL` for default mock behaviors without strict expectations.
- Avoid overly strict expectations to reduce maintenance overhead and false failures.

### Handling Platform Specifics
- Use platform-specific macros or conditional compilation for test sections if needed.
- Ensure your CI builds and tests run on all supported target platforms.

### Debugging and Verbosity
- Run tests locally with `--gmock_verbose=info` to see detailed mock interactions.
- Use `--gtest_filter` to isolate failing tests.

<Note>
Consider integrating static analysis and code quality tools along with your CI tests for comprehensive quality checks.
</Note>

## 6. Troubleshooting CI Integration Issues

### Common Problems
- **Tests not discovered or run:** Verify test registration and naming conventions. Make sure CI runs the correct executable.
- **Linker errors:** Check that GoogleTest and GoogleMock libraries are linked correctly.
- **Flaky tests:** Analyze logs for intermittent failure causes. Use retries or isolation.
- **Environment mismatches:** Ensure consistent compiler versions and environment variables.

### Diagnostic Tips
- Use GoogleTest flags like `--gtest_list_tests`, `--gtest_filter`, `--gtest_repeat`.
- Use GoogleMock verbose flags (`--gmock_verbose=info` or `--gmock_verbose=warning`) to see mock call traces.
- Validate your build and test commands locally on platforms matching CI.

<Check>
Keep your CI logs and artifacts accessible and retained for adequate periods to support failure analysis.
</Check>

## 7. Example CI Steps for Linux, macOS, and Windows

```bash
# Example for Linux/macOS in a Bash script
# Setup environment (install compiler, dependencies, etc.)
cmake -S . -B build
cmake --build build --target my_tests
./build/my_tests --gtest_output=xml:results.xml

# Example for Windows Powershell
cmake -S . -B build -G "Visual Studio 16 2019"
cmake --build build --config Release --target my_tests
build\Release\my_tests.exe --gtest_output=xml:results.xml
```

## 8. Automating Test Discovery and Filtering

Utilize GoogleTest's inbuilt filtering:

```bash
./my_tests --gtest_filter=MyTestSuite.*
```

Use this to run subsets of tests in your CI pipeline when needed.

---

## Additional Resources & Links

- [GoogleTest Primer](docs/primer.md)
- [gMock for Dummies](docs/gmock_for_dummies.md)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Integration and Troubleshooting Guides](guides/integration-and-real-world-scenarios/troubleshooting-common-issues.mdx)
- [Running Tests & Main Entry Points](api_reference/configuration_integration/running_tests_entrypoints.mdx)

---

Ensure you regularly keep your CI environment updated and validate new GoogleTest/GoogleMock releases locally before rolling out across your CI infrastructure. A well-integrated CI pipeline is your assurance toward consistently delivering robust, tested C++ code.
