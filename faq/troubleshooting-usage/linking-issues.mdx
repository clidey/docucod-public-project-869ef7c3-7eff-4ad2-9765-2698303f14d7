---
title: "Troubleshooting Linking and Build System Integrations"
description: "Guidance for resolving linking errors and build configuration problems when integrating with diverse project build systems. Covers usage of pkg-config and common integration options."
---

# Troubleshooting Linking and Build System Integrations

GoogleTest and GoogleMock are powerful C++ testing libraries widely used across platforms and build environments. However, when integrating these libraries with your project's build system, especially for linking and configuration, you may encounter common errors and integration hurdles. This guide offers clear, practical solutions to address linking errors and build configuration problems, focusing on diverse build systems and the usage of `pkg-config` and other common integration options.

---

## Understanding Linking Issues with GoogleTest and GoogleMock

Linking errors arise when your build system can't properly find or link against the GoogleTest/GoogleMock libraries or their dependencies. These errors typically manifest during the linker stage with messages about unresolved symbols or missing references.

### Why Linking Errors Occur

- **Incorrect library or include paths:** Your build system might not know where the GoogleTest/GoogleMock headers or compiled libraries are located.
- **Mismatched build options:** Mixing static and shared libraries, or mismatched compiler flags (like RTTI, exceptions, or C++ standards), can prevent linking.
- **Missing dependencies:** GoogleMock depends on GoogleTest; failing to link both properly causes errors.
- **Threading library not linked:** If using pthreads, failing to link with the correct threading library causes unresolved symbols.

<Tip>
Ensure your build configuration specifies the correct include directories, libraries, and compiler flags consistent with how GoogleTest and GoogleMock were built.
</Tip>

---

## Common Build Systems and Linking Integration

### CMake Integration

GoogleTest comes with a comprehensive CMake build script supporting various configurations. To integrate GoogleTest and GoogleMock into your project using CMake:

1. **Fetch or clone GoogleTest:** You can add it via `add_subdirectory()` or fetch within your build.
2. **Link the appropriate targets:** Use `gtest`, `gtest_main`, `gmock`, or `gmock_main` imported targets for linkage.
3. **Set proper compile features:** GoogleTest uses C++17. Ensure your project specifies `CMAKE_CXX_STANDARD 17`.
4. **Use the provided CMake options:** For example, `BUILD_SHARED_LIBS` to build as shared libraries, and `gtest_force_shared_crt` on Windows when necessary.

Example linkage in `CMakeLists.txt`:

```cmake
find_package(GTest REQUIRED)
add_executable(my_test test.cpp)
target_link_libraries(my_test PRIVATE GTest::gtest_main GTest::gmock)
```

Common pitfalls:

- Not linking both GoogleTest and GoogleMock when using mocks.
- Conflicting flags when mixing shared and static builds.
- Forgetting to link pthreads on Linux/macOS (CMake usually manages this).

### pkg-config Usage

`pkg-config` can simplify build configuration by providing compiler and linker flags. GoogleTest installs `.pc` files for `gtest`, `gmock`, `gmock_main`, etc.

Example use with pkg-config:

```bash
pkg-config --cflags gmock
pkg-config --libs gmock
```

In your build system, set the compiler and linker flags obtained from `pkg-config`. This ensures consistency with installed versions.

<Tip>
Verify the `.pc` files’ installation location and ensure `PKG_CONFIG_PATH` includes that directory.
</Tip>

---

## Step-by-Step Guide to Fix Linking Errors

<Steps>
<Step title="Verify Installation and Paths">
Confirm that GoogleTest/GoogleMock is properly installed on your system, with headers and libraries accessible.
</Step>
<Step title="Use pkg-config (If Available)">
Run `pkg-config --cflags --libs gmock_main` (or `gmock`) to get the right compiler and linker flags.
Incorporate these flags into your build scripts or IDE settings.
</Step>
<Step title="Configure Your Build System">
For CMake:
- Use `find_package(GTest REQUIRED)`
- Link targets `GTest::gtest_main` and `GTest::gmock`
For other build systems, add include paths and link libraries appropriately.
</Step>
<Step title="Match Compiler Flags">
Ensure your project and GoogleTest/GoogleMock are built with the same C++ standard (C++17) and compatible exception and RTTI settings.
</Step>
<Step title="Link Thread Libraries">
On POSIX systems, link with pthreads if required using `-lpthread`.
</Step>
<Step title="Check Library Order">
Link libraries carefully; on some linkers, order matters. For instance, `-lgmock -lgtest -lpthread`.
</Step>
<Step title="Rebuild and Test">
Clean your build and rebuild. Run your test executable to verify linking is successful.
</Step>
</Steps>

---

## Common Linking and Build System Integration Issues

<AccordionGroup title="Common Problems and Solutions">
<Accordion title="Unresolved Symbols for gmock Functions">
This happens if GoogleMock is not linked properly.

**Solution:** Link both `gmock` and `gtest` libraries. For example, in CMake, link to `GTest::gmock` to bring both in.
</Accordion>
<Accordion title="Missing pthread Symbols">
If your system uses pthreads, missing pthread references occur.

**Solution:** Link pthread library explicitly (`pthread` or via CMake's `Threads::Threads`).
</Accordion>
<Accordion title="Link Errors Due to Static vs Shared Libraries Mix">
Mixing static GoogleTest into dynamic project or vice versa can cause issues.

**Solution:** Make sure to set `BUILD_SHARED_LIBS` consistently across your project and GoogleTest build.
</Accordion>
<Accordion title="Compiler Flag Mismatches Leading to ABI Conflicts">
If GoogleTest was built with different compiler options (e.g., exceptions disabled) than your project, linking may fail or crash.

**Solution:** Match compile options like RTTI, exceptions, C++ standard across your builds.
</Accordion>
<Accordion title="Incorrect Usage of Main Libraries">
Linking to `gmock` instead of `gmock_main` (or vice versa) can cause missing main entry points or duplicate symbols.

**Solution:** Choose appropriately:
- Use `gmock_main` for libraries providing `main()`.
- Use `gmock` when you provide your own `main()` function.
</Accordion>
</AccordionGroup>

---

## Tips for Smooth Build Integration

- **Prefer CMake integration where possible:** It handles dependencies, compiler flags, and threading cleanly.
- **Use pkg-config in Makefiles or custom scripts:** It reduces manual errors.
- **Keep GoogleTest/GoogleMock versions consistent:** Use the same version throughout your dependencies.
- **Follow GoogleTest’s recommended compiler and linker flags:** They enforce strict warnings and clean builds.
- **Use provided `gmock_main` if you don't have your own `main()`:** It initializes GoogleMock and GoogleTest proper setup.

<Note>
The GoogleMock CMake scripts are community maintained. If you customize build options, be aware of potential side effects.
</Note>

---

## Troubleshooting Checklist

- Confirm that GoogleTest and GoogleMock source or libraries are properly present and accessible.
- Use `find_package` or `pkg-config` to obtain accurate build flags.
- Check your build scripts for consistent compiler standards (`-std=c++17`).
- Ensure both `gmock` and `gtest` libraries are properly linked.
- Verify threading libraries inclusion, especially `pthread` on Linux/macOS.
- Check for duplicate or missing `main()` definitions.
- Rebuild both the test libraries and your test executable cleanly.

---

## Additional Resources

- [GoogleTest CMakeLists.txt source](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt) for build configuration details.
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md) for overview.
- [GoogleTest pkg-config template files](https://github.com/google/googletest/blob/main/googlemock/cmake/gmock.pc.in) to understand pkg-config usage.
- [GoogleTest Getting Started Guide](https://your-doc-url/guides/getting-started/setup-and-installation) for setup.
- [Common Build & Runtime Errors FAQ](https://your-doc-url/faq/troubleshooting-usage/common-errors) for related issues.

---

By following these guidelines and checks, you can resolve and prevent linking and build system integration issues with GoogleTest and GoogleMock, enabling smooth, reliable test builds across your project environments.
