---
title: "How do I resolve common linking and build errors?"
description: "Find solutions for unresolved symbols, multiple definition errors, or issues caused by improper library linkage. Steps for CMake and Bazel integration included."
---

# How do I resolve common linking and build errors?

This guide helps you diagnose and fix common build and linking errors encountered when integrating GoogleTest and GoogleMock in your C++ projects. It focuses on issues such as unresolved symbols, multiple definition errors, and improper library linkage. It also provides step-by-step instructions for setting up GoogleTest and GoogleMock with CMake and Bazel build systems to ensure smooth compilation and linking.

---

## Common Linking and Build Errors

### 1. Unresolved Symbol Errors

**Problem:** You get linker errors stating that certain GoogleTest or GoogleMock symbols are missing.

**Cause:** This usually means that the GoogleTest or GoogleMock libraries are either not linked properly in your build, or you are mixing incompatible versions of libraries or runtimes.

**Solutions:**
- Ensure you link against the correct GoogleTest and/or GoogleMock libraries, e.g., `-lgtest` and/or `-lgmock` for static linking, or their dynamic equivalents.
- If using `gmock_main` (GoogleMock's main with `main()` function), link against `-lgmock_main`.
- Confirm the library search paths are correct.
- Confirm that your build configuration (debug/release) matches that of the linked libraries.
- Verify proper initialization by calling `testing::InitGoogleMock(&argc, argv);` before running tests.

### 2. Multiple Definition Errors

**Problem:** Linking fails showing multiple definitions of GoogleTest or GoogleMock symbols.

**Cause:** This commonly happens when you link against both the GoogleMock main library and your own test main function simultaneously, or when the GoogleMock or GoogleTest static library is linked multiple times.

**Solutions:**
- Use either `gmock_main` library that provides the `main()` function or define your own main function calling `InitGoogleMock()` and `RUN_ALL_TESTS()`.
- Avoid linking both `gmock_main` and a separate `main` source file.
- Check for duplicate static libraries linked.

### 3. Incompatible Runtime or Compiler Settings

**Problem:** Linker or compiler errors, or runtime crashes with messages about mismatched runtimes or missing symbols.

**Cause:** GoogleTest and GoogleMock libraries must be compiled with the same runtime and compiler settings as your test program.

**Solutions:**
- Configure your build system to ensure the same C++ standard version (C++17 or later) is used.
- Make sure runtime library linkage matches (e.g., static vs dynamic CRT on MSVC).
- For MSVC, set CMake option `gtest_force_shared_crt` appropriately to match your project.
- Avoid mixing debug and release builds.

### 4. Build Setup Mistakes

**Problem:** Your build system cannot find GoogleTest or GoogleMock headers or source files.

**Cause:** Build scripts are not referencing GoogleTest or GoogleMock correctly.

**Solutions:**
- For CMake projects, use `find_package(GTest REQUIRED)` if GoogleTest is installed system-wide.
- Alternatively, embed GoogleTest source and use `add_subdirectory(googletest)` to build alongside your project.
- For Bazel projects, include GoogleTest and GoogleMock as dependencies in your `BUILD` files.

---

## Setting Up GoogleTest and GoogleMock with CMake

GoogleTest provides official support for CMake builds. To avoid build and linking issues, follow these steps.

### Standalone Build

```bash
# Clone the repository and checkout a stable release tag.
git clone https://github.com/google/googletest.git -b v1.17.0
git checkout v1.17.0
mkdir build && cd build
# Configure the build to include GoogleMock (default behavior).
cmake ..
# or to build only GoogleTest:
cmake .. -DBUILD_GMOCK=OFF
make
make install  # Optional: installs headers and libs system-wide.
```

### Integrate into Your CMake Project

Add these lines to your own `CMakeLists.txt` to use GoogleTest and GoogleMock as a subdirectory:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows, force dynamic runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

> **Note:** This requires CMake 3.14 or later.

### Key Configuration Points

- Always link test executables with `gtest_main` or `gmock_main` if you do not define your own `main()`.
- Call `testing::InitGoogleMock(&argc, argv);` in your `main()` if you define it yourself.
- For MSVC users, set `gtest_force_shared_crt` appropriately.
- Ensure consistent C++ standards and compiler flags between your project and GoogleTest.

---

## Setting Up GoogleTest and GoogleMock with Bazel

When using Bazel, add dependencies in your `BUILD` files:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

- Use `//:gmock_main` as a dependency if you want the built-in test `main()`.
- Define your own `main()` in `my_test.cc` and depend on `//:gmock` if desired.

---

## Troubleshooting Tips

- **Verify virtual destructors in your mocks:** Missing virtual destructors cause undefined behavior and linking issues.
- **Match compiler and linker flags:** Confirm build flags match those used for the GoogleTest libraries.
- **Use verbose output for diagnostics:** Run tests with `--gmock_verbose=info` to get detailed mock call traces.
- **Avoid mixing mock main libraries:** Do not link both `gmock_main` and supply your own test `main()`.
- **Check for unresolved symbols related to threading:** If linking fails on pthread symbols, verify your platform supports pthread and link with pthread if required.

---

## Summary

To resolve linking and build errors:
- Link correctly with `gtest`, `gmock`, `gmock_main` as appropriate.
- Follow CMake or Bazel integration examples precisely.
- Use consistent build settings across your project and GoogleTest.
- Read error messages carefully for clues on missing symbols or duplicates.

By carefully configuring your build and linking steps as explained, you can avoid and fix common build and linker problems using GoogleTest and GoogleMock.

---

## Additional Resources

- [GoogleTest System Requirements & Supported Platforms](https://github.com/google/googletest/tree/main/docs/getting-started/prerequisites-installation-setup/system-requirements-supported-platforms)
- [Installation with CMake and Bazel](https://github.com/google/googletest/tree/main/docs/getting-started/prerequisites-installation-setup/installation-cmake-bazel)
- [gMock Cookbook](https://github.com/google/googletest/tree/main/docs/gmock_cook_book.md)
- [Mocking API Reference](https://github.com/google/googletest/tree/main/api-reference/core-apis/gmock-mocking-api)
- [GoogleTest FAQ on Linking Errors](https://github.com/google/googletest/tree/main/faq/troubleshooting-integration/linking-errors)

---

Remember, build issues with GoogleTest and GoogleMock are often caused by simple misconfigurations in linking and runtime settings. Taking a stepwise approach to set up and troubleshooting will lead to swift resolution and a robust testing environment.
