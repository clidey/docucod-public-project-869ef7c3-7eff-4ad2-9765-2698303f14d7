---
title: "How can I customize or extend mocking behavior?"
description: "Explore available options for controlling mock class behavior, configuring warning/error handling with NiceMock, NaggyMock, and StrictMock, and integrating custom actions or matchers."
---

# How Can I Customize or Extend Mocking Behavior?

Explore the various options you have for controlling and refining the behavior of mock classes in GoogleMock. This includes configuring how uninteresting calls are handled with `NiceMock`, `NaggyMock`, and `StrictMock`, as well as integrating custom actions and matchers to tailor mocks to your test scenarios.

---

## Understanding Mock Behavior Control

By default, GoogleMock treats calls to mock methods without explicit expectations (`EXPECT_CALL`s) as "uninteresting calls." While these calls do not cause test failures, GoogleMock issues **warnings** to alert you of potential missing expectations. Sometimes, however, you may want to customize how these uninteresting calls are handled to adjust test feedback verbosity or to enforce stricter controls.

### Using `NiceMock`, `NaggyMock`, and `StrictMock`

GoogleMock provides three wrappers that modify the handling of uninteresting calls on mock objects:

- **NaggyMock** (default behavior): Prints a warning when an uninteresting call is made but continues the test.
- **NiceMock**: Suppresses all warnings about uninteresting calls, making tests less noisy.
- **StrictMock**: Treats uninteresting calls as test failures, enforcing all calls to have explicit expectations.

All three decorators are template wrappers you use by applying them to your mock class type:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // Ignores uninteresting calls
NaggyMock<MockFoo> naggy_foo;    // Warns about uninteresting calls (default)
StrictMock<MockFoo> strict_foo;  // Fails on uninteresting calls
```

### Important Considerations

- These wrappers only affect **uninteresting calls** (methods with no expectations).
- They do **not** affect **unexpected calls**, i.e., calls that have expectations but whose arguments don’t match — these will always fail.
- Wrappers must be used on the actual mock class (the one with `MOCK_METHOD` macros) directly. Those layers do not automatically influence mock methods declared in base classes.
- The mock class must have a **virtual destructor** for these wrappers to work correctly.

<Tip>
Use `NiceMock` to reduce noise when your test code calls many uninteresting methods, `NaggyMock` when you want moderate feedback, and `StrictMock` when you want exhaustive mock call verification.
</Tip>

---

## Defining and Using Custom Actions

Mock methods by themselves have no implementations; instead, you control what happens when they are called by specifying **actions**. GoogleMock provides a rich set of built-in actions (e.g., `Return()`, `Invoke()`, `SetArgPointee()`), but sometimes none directly suits your needs.

### Writing Custom Actions with Lambdas or Functors

You can provide any callable (such as a lambda, function pointer, or functor) compatible with the mock method's signature as an action:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int n) { return n * 2; });
```

This flexibility allows you to implement arbitrary, user-defined behaviors inline.

### Using `Invoke` and `InvokeWithoutArgs`

To call an existing function, method, or functor when a mock method is invoked, use:

- `Invoke(f)`: Calls `f` passing the original mock method arguments.
- `InvokeWithoutArgs(f)`: Calls `f` without any arguments.

Example:

```cpp
int Add(int a, int b) { return a + b; }

EXPECT_CALL(mock, Sum(_, _))
    .WillOnce(Invoke(Add));
```

### Chaining Multiple Actions with `DoAll`

You can combine multiple actions, performing them sequentially, using `DoAll`. The last action's return value is used as the mock method’s return value:

```cpp
EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(42), Return(true)));
```

### Defining Parameterized Actions Using ACTION Macros

GoogleMock provides macros to define reusable custom actions:

- `ACTION(name) { ... }`
- `ACTION_P(name, param) { ... }`
- `ACTION_Pk(name, p1, ..., pk) { ... }`

These macros generate callable classes that can access mock method arguments as `arg0`, `arg1`, etc., and the action parameters. For example:

```cpp
ACTION(IncrementArg0) {
  return ++arg0;
}

EXPECT_CALL(mock, Foo(_))
    .WillOnce(IncrementArg0());
```

---

## Specifying Default Actions with `ON_CALL`

`ON_CALL` allows you to set **default behaviors** for mock methods when you do not require explicit call count verification.

```cpp
ON_CALL(mock, GetValue())
    .WillByDefault(Return(42));
```

Default actions set by `ON_CALL` are overridden by actions defined in `EXPECT_CALL`.

---

## Defining Custom Matchers

To refine how arguments are matched in expectations, you can define **custom matchers**. GoogleMock offers several ways to create them:

- **MATCHER macros** for quick, readable matchers:

  ```cpp
  MATCHER(IsEven, "checks if the argument is even") { return (arg % 2) == 0; }

  EXPECT_CALL(mock, Foo(IsEven()));
  ```

- **Matcher classes** for advanced cases, implementing the `MatchAndExplain` interface.

Custom matchers must be *pure* and produce clear failure messages.

---

## Controlling Expectation Ordering

You can control the order in which mock methods must be called using:

- `InSequence` objects to enforce sequential call ordering.

- `.After()` clauses to define dependencies between expectations.

Example:

```cpp
Sequence s;
EXPECT_CALL(mock, First()).InSequence(s);
EXPECT_CALL(mock, Second()).InSequence(s);
```

Or:

```cpp
Expectation first = EXPECT_CALL(mock, First());
EXPECT_CALL(mock, Second()).After(first);
```

---

## Verifying and Resetting Mocks

You can explicitly verify mock expectations and clear them before mock destruction:

```cpp
EXPECT_TRUE(Mock::VerifyAndClearExpectations(&mock));
```

This is useful when your mock object has a longer lifetime than your test.

You can also allow a mock to leak and skip verification (not recommended):

```cpp
Mock::AllowLeak(&mock);
```

---

## Practical Tips and Best Practices

- Set expectations with `EXPECT_CALL` **before** exercising the code under test to avoid undefined behavior.
- Use `NiceMock` to suppress noisy warnings in tests not interested in all calls.
- Use explicit "catch-all" expectations with wildcards `_` and `.Times(AnyNumber())` to allow unexpected but harmless calls.
- Use `StrictMock` for tests that demand strict control over calls to detect any unplanned invocations.
- When creating custom actions or matchers, keep them side-effect free and transparent to enable easier debugging.

---

## Example: Using StrictMock With Custom Actions

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (int val), (override));
};

using ::testing::StrictMock;
using ::testing::Return;

StrictMock<MockFoo> mock;

EXPECT_CALL(mock, Compute(5))
    .WillOnce([](int val) { return val * 2; });

int result = mock.Compute(5);  // returns 10
```

If `Compute` is called on `mock` with any argument other than 5, the test will fail.

---

## Additional Resources

For various advanced uses, see:

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for mocking syntax.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes including delegation to fakes and real objects.
- [Actions Reference](https://google.github.io/googletest/reference/actions.html) — Comprehensive list of built-in actions.
- [Mocking API](https://google.github.io/googletest/api/gmock_mocker_8h.html) — Details on `EXPECT_CALL`, `ON_CALL`, and modifiers.
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) — For argument matching.

Explore these to deepen your mastery of customizing and extending mocking behavior effectively.
