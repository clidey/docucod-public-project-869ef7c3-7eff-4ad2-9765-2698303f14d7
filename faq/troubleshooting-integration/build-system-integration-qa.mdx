---
title: "Build System & Platform Integration FAQ"
description: "Provides answers to challenges users face when building or integrating the framework using Bazel, CMake, or custom build tools. Highlights frequent pitfalls, includes linker error fixes, and refers to platform compatibility sections."
---

# Build System & Platform Integration FAQ

This FAQ addresses common challenges users face when building or integrating GoogleTest and GoogleMock using various build systems like Bazel, CMake, or custom scripts. It highlights typical pitfalls, provides solutions to linker errors, and points users to platform compatibility guidance.

---

## Frequently Asked Questions (FAQs)

### 1. How do I properly build GoogleMock and GoogleTest with CMake?

GoogleTest includes GoogleMock by default when built with CMake. To build both, use the main CMakeLists.txt script without modifications.

**Example standalone build commands:**
```shell
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
mkdir build && cd build
cmake ..            # Includes GoogleMock and GoogleTest by default
make
```
To build only GoogleTest (excluding GoogleMock), explicitly disable GoogleMock:
```shell
cmake .. -DBUILD_GMOCK=OFF
```

On Windows, Visual Studio project files will be generated automatically, which you can open and build.

<Tip>
Use CMake 3.14 or later to access the FetchContent module for easier integration into existing projects.
</Tip>

### 2. How can I integrate GoogleTest and GoogleMock into my existing CMake project?

There are two main approaches:

- **Using find_package:** Once GoogleTest is installed, you can import it with `find_package(GTest REQUIRED)` and link libraries like `GTest::gtest` or `GTest::gmock`.

- **Embedding source in your build:** Use CMake's `FetchContent` to download and add GoogleTest as a subdirectory. This keeps compiler and linker flags consistent and avoids runtime incompatibilities.

Example snippet for `CMakeLists.txt`:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows CRT compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main gmock_main)
add_test(NAME my_test COMMAND my_test)
```

### 3. I get linker errors related to unresolved symbols from GoogleMock or GoogleTest. How do I fix this?

Linker errors usually mean you missed linking with one or more GoogleTest / GoogleMock libraries.

**Fixes:**
- Ensure you link against `gmock_main` or `gtest_main` if your test binary does not provide `main()`.
- For CMake projects, link the `gtest_main` and `gmock_main` targets.
- If you use custom build scripts, explicitly add both GoogleMock and GoogleTest static or shared libraries.
- On Windows, verify that your runtime library setting (static/dynamic CRT) matches between your code and GoogleTest/GoogleMock. Use the CMake option `gtest_force_shared_crt` to align CRT linkage.

<Tip>
Linker errors mentioning symbols like `InitGoogleMock` or missing `main` often indicate missing linkage with `gmock_main` or `gtest_main`.
</Tip>

### 4. How do I initialize GoogleMock and GoogleTest in my test program?

GoogleMock depends on GoogleTest, so initialization must prepare both frameworks.

Use `testing::InitGoogleMock(&argc, argv);` in your main function before calling `RUN_ALL_TESTS()`.

Example main function:
```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For embedded platforms without `argc`/`argv`, use the no-argument `InitGoogleMock()`.

<Tip>
Do not call both `InitGoogleTest()` and `InitGoogleMock()`; just call `InitGoogleMock()`.
</Tip>

### 5. Can I use GoogleMock flags in my project? How do I pass them?

GoogleMock defines the following flags:

- `--gmock_verbose=LEVEL` - controls verbosity level (`info`, `warning`, `error`).
- `--gmock_catch_leaked_mocks=0|1` - enables or disables reporting of leaked mock objects.

These flags are processed by `InitGoogleMock()` and removed from `argv`. Pass them as part of your program's command-line arguments.

Example:
```shell
./my_test --gmock_verbose=info
```

### 6. Are there platform-specific considerations when integrating GoogleTest and GoogleMock?

Yes. GoogleTest supports Linux, Windows, macOS, and several embedded platforms, but differences exist:

- On Windows, be mindful of CRT linkage (static vs dynamic) to avoid linker errors.
- Thread safety depends on availability of `pthread` or equivalents.
- Certain features like wide-string flag parsing (`InitGoogleMock` overload) help on Windows Unicode builds.

For a detailed matrix, see **Supported Platforms & Compatibility** documentation.

### 7. How to handle building GoogleTest and GoogleMock on embedded platforms?

On supported embedded platforms (e.g., ESP8266, ESP32), GoogleMock provides an entry point via customized `setup()` and `loop()` functions.

Example from `gmock_main.cc`:
```cpp
void setup() {
  testing::InitGoogleMock();
}
void loop() {
  RUN_ALL_TESTS();
}
```

This facilitates integration without the normal argc/argv interface.

### 8. Can Bazel be used to build and integrate GoogleMock and GoogleTest?

Yes, Bazel support exists via official workspace rules. You can fetch GoogleTest and GoogleMock as dependencies.

Common pitfalls:
- Ensure correct dependencies for `cc_test` or `cc_binary` rules.
- Link rules with `@com_google_googletest//:gmock_main` or `:gtest_main` as required.

Refer to Bazel's official GoogleTest and GoogleMock guidelines.

### 9. My tests build and link correctly but fail because of macros or flag conflicts. What should I check?

- Avoid macro name clashes by using CMake flags to rename problematic macros (e.g., `-DGTEST_DONT_DEFINE_TEST=1`).
- Ensure you call the appropriate initialization function (`InitGoogleMock`).
- Make sure test macros (`TEST`, `TEST_F`) are used correctly according to your project setup.

### 10. Where can I find more detailed platform compatibility information?

Please consult the [Supported Platforms & Compatibility](https://google.github.io/googletest/overview/integration-ecosystem/supported-platforms) page for comprehensive information on supported OSes, compilers, and threading models.

---

## Common Issues & Gotchas

### Linker Errors
- **Unresolved symbols from GoogleMock/GoogleTest:** Verify library linkage.
- **RuntimeLibrary mismatch on Windows:** Use `gtest_force_shared_crt` CMake option.

### Build Failures
- **Missing C++17 standard support:** GoogleTest requires at least C++17.
- **Mismatched versions:** Ensure GoogleMock and GoogleTest versions match.

### Initialization Errors
- Forgetting to call `InitGoogleMock()` before `RUN_ALL_TESTS()` causes unexpected behavior.

<Tip>
Verify your build and link steps carefully, and ensure consistent runtime library settings especially on Windows.
</Tip>

---

## Troubleshooting Steps

<Steps>
<Step title="Verify Build and Linkage">
Ensure your build system compiles all required source files and links against GoogleTest and GoogleMock libraries.
</Step>
<Step title="Check Runtime Library Settings">
On Windows, verify that your project's runtime settings (`MT`, `MD`, etc.) match GoogleTest's settings.
</Step>
<Step title="Use CMake Integration">
Prefer CMake's official support to avoid manual linkage errors; use FetchContent or find_package.
</Step>
<Step title="Initialize GoogleMock Correctly">
Always call `testing::InitGoogleMock()` early in your main() function or embedded platform setup.
</Step>
<Step title="Consult Platform Compatibility Documentation">
Check platform-specific notes and known issues for your OS and compiler.
</Step>
</Steps>

---

## Best Practices & Recommendations

- Use the official CMake scripts included with GoogleTest for easy and consistent builds.
- If using Visual Studio on Windows, enable the `gtest_force_shared_crt` to prevent CRT linkage mismatches.
- Link your test executables against `gmock_main` or `gtest_main` unless you provide your own `main()`.
- Pass GoogleMock flags via command line to control verbosity and leak detection.
- On embedded platforms, use the provided initialization patterns.
- Ensure your build environment supports C++17 or later.
- Cross-reference with the Supported Platforms documentation for platform-specific setup.

---

## Related Documentation

- [Supported Platforms & Compatibility](https://google.github.io/googletest/overview/integration-ecosystem/supported-platforms)
- [Configuring Your Project](https://google.github.io/googletest/getting-started/setup-prerequisites-installation/configuring-your-project)
- [Getting Started & Common Issues FAQ](https://google.github.io/googletest/faq/general-usage/getting-started-common-issues)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)

---

For complex build environments or custom build systems, thoroughly verifying library paths, compiler flags, and environment settings is essential to avoid integration problems.