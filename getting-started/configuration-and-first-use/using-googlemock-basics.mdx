---
title: "Basic Mocking with GoogleMock"
description: "Introduces users to creating a simple mock object and expectations using GoogleMock, covering the foundational workflow for mocking dependencies and verifying function calls."
---

# Basic Mocking with GoogleMock

This guide introduces you to creating simple mock objects and setting up expectations using GoogleMock (gMock). It covers the fundamental workflow for mocking dependencies and verifying function calls in your C++ tests.

---

## 1. Prerequisites & Setup

Before starting with mocks, ensure your project is set up for GoogleTest and GoogleMock:

- Include the GoogleMock headers in your test files.
- Link against the `gmock` and `gmock_main` libraries.
- Use a C++ compiler compliant with C++11 or later.

For detailed setup instructions, see [Project Configuration](/getting-started/configuration-and-first-use/project-configuration).

---

## 2. Defining a Mock Class

Mock classes simulate the behavior of real classes in your tests. To define one:

1. Derive a class from your target interface or class.
2. For each virtual method you want to mock, use the `MOCK_METHOD` macro inside the `public:` section.

### Example: Mocking a Simple Interface

Given an interface:

```cpp
class Foo {
 public:
  virtual ~Foo() = default;
  virtual void DoThis() = 0;
  virtual int DoThat(bool flag) = 0;
};
```

You define a mock like this:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};
```

**Note:**
- `MOCK_METHOD` parameters are: `return_type`, `method_name`, `(args)`, and optional qualifiers like `(override)`.
- Mock methods must be declared `public`, even if the original is `protected` or `private`.

---

## 3. Creating and Using Mock Objects

Once your mock class is ready:

### Step 1: Instantiate the Mock

```cpp
MockFoo mock_foo;
```

You can also construct mocks with constructor arguments if your mock class has such constructors.

### Step 2: Set Default Actions (Optional)

Use `ON_CALL` to specify how the mock behaves by default when a method is called without explicit expectations.

```cpp
ON_CALL(mock_foo, DoThat(::testing::_))
  .WillByDefault(::testing::Return(42));
```

### Step 3: Set Expectations

Use `EXPECT_CALL` to specify what calls you expect, how many times, and what actions to perform.

```cpp
EXPECT_CALL(mock_foo, DoThis())
    .Times(1);

EXPECT_CALL(mock_foo, DoThat(true))
    .WillOnce(::testing::Return(100));
```

This tells gMock to verify that:
- `DoThis()` is called exactly once.
- `DoThat(true)` returns 100 when invoked.

If the expectations are violated, your test will fail.

---

## 4. Running Your First Mock Test

Here’s a complete example that puts it all together:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;
using ::testing::_;

class Foo {
 public:
  virtual ~Foo() = default;
  virtual void DoThis() = 0;
  virtual int DoThat(bool flag) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};

TEST(FooTest, BasicMockingExample) {
  MockFoo mock_foo;

  ON_CALL(mock_foo, DoThat(_)).WillByDefault(Return(0));

  EXPECT_CALL(mock_foo, DoThis()).Times(1);
  EXPECT_CALL(mock_foo, DoThat(true)).WillOnce(Return(42));

  // Exercising the mock
  mock_foo.DoThis();  // Should be called once
  int result = mock_foo.DoThat(true);  // Returns 42

  EXPECT_EQ(result, 42);
}
```

### How it works:

1. `MockFoo` implements the interface `Foo` with mock methods.
2. The test sets the default action for `DoThat()` to return 0.
3. It expects `DoThis()` to be called once.
4. It expects `DoThat(true)` to return 42 when called once.
5. It exercises the mock methods and verifies the output.

---

## 5. Using NiceMock, NaggyMock, and StrictMock

GoogleMock provides three wrappers for mocks to control behavior around uninteresting (unexpected but not explicitly forbidden) calls:

- `NiceMock<T>`: Suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: (Default) Prints warnings on uninteresting calls.
- `StrictMock<T>`: Fails tests on uninteresting calls.

### Using NiceMock Example

```cpp
#include <gmock/gmock.h>

using ::testing::NiceMock;

NiceMock<MockFoo> nice_mock_foo;
EXPECT_CALL(nice_mock_foo, DoThis());

// Uninteresting calls to other methods won't generate warnings.
nice_mock_foo.DoThat(false);
```

### Using StrictMock Example

```cpp
#include <gmock/gmock.h>

using ::testing::StrictMock;

StrictMock<MockFoo> strict_mock_foo;
EXPECT_CALL(strict_mock_foo, DoThis());

// Any uninteresting call causes test failure.
// strict_mock_foo.DoThat(false);  // Will fail
```

All these wrappers inherit constructors from the mock class, so you can pass constructor parameters as usual.

---

## 6. Best Practices and Tips

- **Always mock virtual methods:** Only virtual methods can be mocked.
- **Set expectations before exercising mocks:** `EXPECT_CALL` must precede usage to avoid undefined behavior.
- **Use `_` matcher for arguments you don't care about:** Helps avoid over-specification.
- **Use `ON_CALL` for default mock behavior without expecting calls:** Minimizes fragile tests.
- **Use sequences (`InSequence`) for enforcing call order:** Useful when order matters.
- **Use `RetiresOnSaturation()` to automatically retire saturated expectations:** Simplifies managing multiple calls.
- **Use `Mock::AllowLeak(mock_obj)` if the mock intentionally lives beyond test scope:** Prevents false leak reports.

---

## 7. Troubleshooting Common Issues

### Why does gMock warn about "Uninteresting mock function call?"
This means a mock method was called without an `EXPECT_CALL` for that method. Consider adding an `EXPECT_CALL` with `.Times(AnyNumber())` or use a `NiceMock`.

### Why is my mock method not called as expected?
- Check that the method is virtual.
- Ensure the mock method signatures exactly match the base class.
- Confirm the correct overload is mocked (use `Const()`, explicit typing if necessary).
- Verify that `EXPECT_CALL` is set before exercising the mock.

### Unexpected calls fail my test.
Add matching `EXPECT_CALL` statements with appropriate matchers or relax expectations as needed.

### How to mock methods with non-default constructors?
You can use `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>`, passing necessary constructor arguments, e.g. `NiceMock<MockBar> nice_bar("init");`.

### How do I mock methods returning types without default constructors?
Use `ON_CALL` or `EXPECT_CALL` to set actions that return valid instances explicitly. Accessing them without explicit actions leads to exceptions.

---

## 8. Additional Resources

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Handy syntax reference.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly usage guide.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Comprehensive API reference.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Advanced usage recipes and tips.

---

## Summary
This page guides you through the basics of mocking with GoogleMock, from defining your mock classes with `MOCK_METHOD` to creating, configuring, and verifying mock objects. It introduces the concept of mock wrappers (`NiceMock`, `NaggyMock`, and `StrictMock`) to control warning or error behaviors and provides troubleshooting pointers for common pitfalls.

---

For foundational setup, also consult our [Project Configuration](/getting-started/configuration-and-first-use/project-configuration) and [Writing and Running Your First Test](/getting-started/configuration-and-first-use/writing-first-test).

---

# Appendix: Quick Example - Basic Mocking

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;

class Foo {
 public:
  virtual ~Foo() {}
  virtual void DoThis() = 0;
  virtual int DoThat(bool flag) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};

TEST(FooTest, Example) {
  MockFoo mock;

  ON_CALL(mock, DoThat(::testing::_)).WillByDefault(Return(0));

  EXPECT_CALL(mock, DoThis())
      .Times(1);

  EXPECT_CALL(mock, DoThat(true))
      .WillOnce(Return(42));

  mock.DoThis();
  int result = mock.DoThat(true);
  EXPECT_EQ(result, 42);
}
```

This example demonstrates core steps: mock class creation, expectation setting, mock usage, and verification.

---