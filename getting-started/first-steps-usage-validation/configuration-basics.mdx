---
title: "Configuring Your First Test Project"
description: "Guidance for linking GoogleTest and GoogleMock to a new or existing C++ project using CMake or Bazel. Covers key configuration files and lays out the minimum steps for integration."
---

# Configuring Your First Test Project

Welcome to your journey toward integrating GoogleTest and GoogleMock into your C++ project. This guide lays out the essential configuration steps to help you link these powerful testing frameworks to your new or existing project, focusing on setup using common build systems such as CMake and Bazel.

---

## 1. Understanding What You Need to Configure

Before diving into configuration, it's crucial to understand the key components involved:

- **GoogleTest** provides the fundamental testing framework.
- **GoogleMock** extends GoogleTest with mocking capabilities, allowing interaction testing.
- Your C++ project must be linked against these libraries correctly.

Configuration primarily revolves around including the GoogleTest/GoogleMock headers and linking their libraries during build.

<Info>
Ensure your project is using a modern C++ compiler (C++17 or higher) and your build system supports adding external libraries like GoogleTest and GoogleMock.
</Info>

---

## 2. Core Configuration Files and Settings

### Key Header Files to Include

- Use `#include <gtest/gtest.h>` to include GoogleTest capabilities.
- Use `#include <gmock/gmock.h>` to enable mocking features.

Including these headers correctly in your source files is essential to access the full testing and mocking API.

### Initialization

You will need to initialize GoogleMock at the start of your test executable using:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This prepares both GoogleTest and GoogleMock and processes command line flags.

### Flags and Macros

Common initialization flags you can control programmatically include:

- `GMOCK_FLAG_SET(catch_leaked_mocks, true);` to detect leaked mock objects.
- `GMOCK_FLAG_SET(verbose, "warning");` to control output verbosity.

---

## 3. Linking GoogleTest and GoogleMock with Build Systems

This section covers the minimum steps to integrate with two prevalent build tools.

### Using CMake

1. **Add GoogleTest and GoogleMock as Dependencies**

If you downloaded GoogleTest source (which includes GoogleMock):

```cmake
add_subdirectory(<path_to_googletest>)
```

2. **Link Your Test Target Against the Libraries:**

```cmake
target_link_libraries(your_test_target gtest gmock)
```

3. **Include Directories:**

You generally do not need to add include directories manually if you link against `gtest` and `gmock` targets properly.

4. **Example CMakeLists.txt Snippet:**

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyTests)

add_subdirectory(googletest)  # path to GoogleTest source

add_executable(MyTest my_test.cc)

target_link_libraries(MyTest gtest gmock pthread)
```

> On some systems the `pthread` library is needed explicitly.

### Using Bazel

1. **Add GoogleTest and GoogleMock Dependencies**

- Use the `@com_google_googletest` workspace to import GoogleTest and GoogleMock.

2. **Define Test in BUILD File:**

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

3. **Use `gmock_main` for Convenient Linking:**

The `gmock_main` target provides the required main function to initialize and run tests.

---

## 4. Minimum Steps for Integration

Follow these sequential steps to configure and run your first test:

<Steps>
  <Step title="Prepare your build system">
    - Add GoogleTest and GoogleMock as dependencies as described above.
    - Ensure your compiler supports C++17 or higher.
  </Step>
  <Step title="Create a test source file">
    - Write your test code, including necessary headers like `#include <gmock/gmock.h>`.
    - Define mock classes using `MOCK_METHOD` macro to mock virtual methods.
  </Step>
  <Step title="Initialize GoogleMock in main()">
    - Define the `main` function to call `::testing::InitGoogleMock(&argc, argv);` and `RUN_ALL_TESTS();`.
  </Step>
  <Step title="Build your test executable">
    - Run your build tool (e.g., cmake + make, bazel build) to compile and link the test.
  </Step>
  <Step title="Run and verify your test">
    - Execute your test binary.
    - Confirm that GoogleTest and GoogleMock initialize successfully and run your tests.
  </Step>
</Steps>

<Check>
Running the test executable should finish with a summary showing tests passed or failed.
Ensure no linking errors or unresolved symbols related to gtest/gmock appear.
</Check>

---

## 5. Practical Tips and Best Practices

- **Mocking classes:**
  - Always place `MOCK_METHOD` declarations in the `public` section of your mock classes regardless of method access level.
  - Specify method qualifiers (e.g., `const`, `override`) properly in the macro for accurate mocking.

- **Default behaviors:**
  - Use `ON_CALL` to specify default mock behaviors that don't require method call expectations.
  - Use `EXPECT_CALL` to set precise expectations and behaviors for test verification.

- **Test executable configuration:**
  - Remember to initialize GoogleMock (which also initializes GoogleTest).
  - You can adjust verbosity and leaked mock detection using available macros.

- **Handling multiple expectations:**
  - Define sequences and ordering using `InSequence` or `After(...)` clauses.
  - Use `.RetiresOnSaturation()` for expectations that should deactivate after the specified number of calls.

- **Managing includes and dependencies:**
  - Modern build tools usually handle include paths if you link properly against GoogleTest and GoogleMock.
  - Check platform-specific instructions for more detailed setup (Linux, macOS, Windows).

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Configuration Problems">
  <Accordion title="Linker errors related to GoogleTest or GoogleMock symbols">
    - Check if your build system properly links against `gtest` and `gmock`.
    - Ensure the order of libraries is correct; some linkers are order-sensitive.
    - For CMake, verify `target_link_libraries` includes all necessary dependencies.
  </Accordion>
  <Accordion title="GoogleMock initialization errors or missing main function">
    - Use `::testing::InitGoogleMock(&argc, argv);` in `main()` to initialize properly.
    - When using Bazel, link your test against the `gmock_main` target, which includes the main function.
  </Accordion>
  <Accordion title="Tests not running or reporting zero tests">
    - Make sure test source files contain at least one test case (TEST or TEST_F macros).
    - Confirm your test executable runs the `RUN_ALL_TESTS()` macro.
    - Verify no build errors or misconfigurations prevent test discovery.
  </Accordion>
  <Accordion title="Warnings about uninteresting mock function calls">
    - This means a mock method was called without an `EXPECT_CALL` expectation.
    - Use `ON_CALL` to set default behavior or `NiceMock` wrapper to suppress warnings if appropriate.
    - Alternatively, explicitly allow calls using `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`.
  </Accordion>
</AccordionGroup>

---

## 7. Next Steps

- Explore writing your first unit and mock tests to put your configuration to work.
- Read the [Writing Your First Unit and Mock Tests guide](../guides/getting_started/writing_first_tests) for hands-on tutorials.
- If integrating into CI pipelines, refer to the integration guides for smooth test automation.

---

## References & Resources

- [GoogleMock main header (`gmock.h`)](googlemock/include/gmock/gmock.h) – The primary inclusion point for mocking.
- [Mocking Reference](docs/reference/mocking.md) – Comprehensive details on mocking macros and API.
- [gMock Cookbook](docs/gmock_cook_book.md) – Recipes and best practices for mocking.
- [Platform-Specific Setup](getting-started/prerequisites-installation/platform-specific-instructions.mdx) – Tailored instructions per OS.
- [Installation Overview](getting-started/prerequisites-installation/installation-overview.mdx) – Installation methods and tips.

---

**Happy testing with GoogleTest and GoogleMock!**

---

<Source url="https://github.com/google/googletest" paths={[{path: "googletest/CMakeLists.txt", range: "1-50"}, {path: "googletest/README.md", range: "1-100"}, {path: "googlemock/include/gmock/gmock.h", range: "1-100"}]} />