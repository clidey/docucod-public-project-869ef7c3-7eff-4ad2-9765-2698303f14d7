---
title: "Troubleshooting Common Setup Issues"
description: "Practical solutions for frequent installation, configuration, and linking errors. Learn where things typically go wrong and how to quickly get back on track."
---

# Troubleshooting Common Setup Issues

Practical solutions for frequent installation, configuration, and linking errors. Learn where things typically go wrong and how to quickly get back on track.

---

## 1. Installation Problems

### 1.1 Missing Dependencies or Compiler Errors

- **Cause:** Your environment might lack the required compiler version, platform support, or thread libraries such as pthread.
- **Solution:**
  1. Confirm that your system meets the minimum [System Requirements](/getting-started/installation-prerequisites/system-requirements).
  2. Ensure your compiler supports C++17 standard.
  3. Verify pthread support on your platform.

<Tip>
Refer to the "Supported Platforms & Integrations" guide for specific instructions related to your OS and compiler.
</Tip>

### 1.2 Linking Errors Related to GoogleMock or GoogleTest Libraries

- **Cause:** Incorrect linkage or missing libraries when building your tests.
- **Solution:**
  1. Ensure you have linked against both GoogleTest and GoogleMock libraries properly.
  2. If using CMake, link using `target_link_libraries(your_target gtest gmock)`.
  3. Check for runtime linkage conflicts especially on Windows where mixing static and dynamic CRTs can cause issues.

<Warning>
Avoid partial linking without the necessary dependencies; always build or link complete packages.
</Warning>

### 1.3 Build Failures Due to Incorrect Headers or Macro Conflicts

- **Cause:** Sometimes, macro redefinitions (e.g., Windows headers) can cause compilation to fail.
- **Solution:**
  1. Include `<gmock/gmock.h>` after system headers.
  2. Temporarily undefine conflicting macros before including GoogleMock headers.
  3. Use namespaces carefully to avoid symbol clashes.

## 2. Configuration Issues

### 2.1 Mock Classes Not Responding or Unexpected Method Calls Calling Real Methods

- **Cause:** Mocked methods are not declared `virtual`, or mocking non-virtual methods without proper technique.
- **Solution:**
  1. Ensure all methods you want to mock are declared `virtual` in the base class.
  2. For non-virtual methods, use the [high-perf dependency injection technique](https://google.github.io/googletest/gmock_cook_book.html#MockingNonVirtualMethods).
  3. Confirm you are correctly using the `MOCK_METHOD` macro in the **public** section of your mock class.

### 2.2 Unexpected Calls or Uninteresting Call Warnings

- **Cause:** You called a method on a mock object without setting the corresponding expectation or default action.
- **Guidance:**
  1. To specify behavior without setting expectations, use `ON_CALL(mock, Method()).WillByDefault(...)`.
  2. To set expectations and behavior, use `EXPECT_CALL(mock, Method()).Times(...).WillOnce(...)`.
  3. If uninteresting calls are frequent but expected, wrap your mock in `NiceMock`.

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, ExpectedMethod());
```

### 2.3 Strict vs Nice vs Naggy Mock Behavior

- **NaggyMock** (default behavior): Prints warnings for uninteresting calls.
- **NiceMock**: Suppresses warnings for uninteresting calls.
- **StrictMock**: Treats uninteresting calls as errors.

Use the variant appropriate for your test's strictness needs to avoid unnecessary warnings or failures.

<Tip>
Be cautious using StrictMocks as they may make your tests brittle by failing on less relevant calls.
</Tip>

### 2.4 Mock Class Construction Failures

- Mock classes with non-default constructors require explicit construction in their nice/strict/naggy wrappers.

```cpp
NiceMock<MockBar> nice_bar("arg1", 42);
```

## 3. Linking & Runtime Errors

### 3.1 Multiple Definition or Symbol Conflicts

- Ensure you have **one and only one** instance of GoogleTest/GoogleMock libraries linked.
- Avoid mixing static and dynamic library variants.

### 3.2 Heap Checking and Memory Leak Failures

- GoogleMock automatically verifies expectations when mock objects are destroyed.
- If mocks are leaked (never destroyed), verification will be skipped, causing false positives.
- Use `Mock::AllowLeak(&mock_object)` if intentional.

### 3.3 Debugging Verbosity and Messages

- Use command-line flags:
  - `--gmock_verbose=info` to get detailed mock call tracing.
  - `--gmock_verbose=warning` (default) for warning-level verbosity.
  - `--gmock_verbose=error` to suppress all but error messages.


## 4. Common Pitfalls and How to Avoid Them

### 4.1 Forgetting to Set Expectations Before Calling Mock Methods

Always set your `EXPECT_CALL` statements before exercising mocks to avoid undefined behavior.

### 4.2 Incorrect Use of `MOCK_METHOD`

- Ensure correct macro usage, especially with complex parameters that may contain commas; wrap types in extra parentheses or use type aliases.

```cpp
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, (), (override));
```

### 4.3 Overlapping or Conflicting Expectations

- Newer `EXPECT_CALL` statements override older ones if they match the same method and arguments.
- Order specificity matters; place more specific expectations after more general ones.

### 4.4 Misuse of Return Values in Actions

- For methods returning references, use `ReturnRef()` instead of `Return()`.
- If returning move-only types like `std::unique_ptr`, use lambdas or `Return()` with `std::move` carefully.

```cpp
EXPECT_CALL(mock, GetPtr())
    .WillOnce([]() { return std::make_unique<Foo>(); });
```

## 5. Verification & Clearing

### 5.1 Forcing Expectations Verification Early

Use `Mock::VerifyAndClearExpectations(&mock_obj)` to force immediate verification if destruction timing is uncertain.

<Tip>
Wrap with `ASSERT_TRUE()` to stop if verification fails.
</Tip>

### 5.2 Resetting Mocks for Reuse

After verification and clearing, you can reuse mocks by setting new expectations.

## 6. Helpful Diagnostic Tips

- Run tests with `--gmock_verbose=info` to observe detailed mock invocation logs.
- Utilize `EXPECT_NONFATAL_FAILURE` assertions in tests to confirm failure scenarios.
- Use Emacs integration or similar IDE features to quickly locate failure lines from test output.

---

## References

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — recipes and in-depth usage patterns.
- [Mocking Reference](../reference/mocking.md) — detailed API and semantic explanations.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — beginner-friendly introduction.
- [Strict, Nice, and Naggy Mocks](https://google.github.io/googletest/guides/advanced#strict-nice-and-naggy-mocks) — guidance on choosing mocking behavior.

---

## Example: Using NiceMock to Avoid Uninteresting Call Warnings

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
  MOCK_METHOD(int, GetValue, (), ());
};

int main() {
  NiceMock<MockFoo> mock;

  // No need to expect all calls explicitly.
  mock.DoThis();  // No warning generated.

  EXPECT_CALL(mock, GetValue())
    .WillOnce(testing::Return(42));

  int x = mock.GetValue();
  return 0;
}
```

This approach reduces noise during tests without losing verification power.

---

## Quick Troubleshooting Checklist

- Verify compiler and platform meet the requirements.
- Confirm all mock methods are virtual and declared properly.
- Set `EXPECT_CALL` before exercising mocks.
- Use `ON_CALL` for default behavior when no strict expectations.
- Choose appropriate mock strictness (`NiceMock`, `NaggyMock`, or `StrictMock`).
- Check linking for duplicate or missing GoogleTest/Mock libraries.
- Use verbose mode flags for deeper diagnosis.

---

<Check>
Having difficulty with your mock setup? Ensure you have:
- Verified system and build environment
- Correctly defined and linked mocks
- Set expectations before mock calls
- Used the right mock strictness level
- Enabled verbose logging for unexpected behaviors
</Check>

---

For more detailed diagnostic techniques, visit [Troubleshooting and Validation](../getting-started/troubleshooting-validation/common-setup-issues).
