---
title: "Writing and Running Your First Test"
description: "Demonstrates creating a simple test case and test suite, covering both GoogleTest assertions and GoogleMock mock object basics. Walks through compiling and executing the test binary."
---

# Writing and Running Your First Test

Welcome to your first step into writing automated tests with GoogleTest and GoogleMock. This guide will walk you through creating a simple test case and test suite, introducing both basic GoogleTest assertions and an overview of GoogleMock's mock objects. By the end, you'll know how to compile and run your test binary to verify that everything works as expected.

---

## 1. Understanding Test Components

Before diving into code, it's important to understand the building blocks of a GoogleTest unit test:

- **Test Function**: Each test is a function that contains assertions verifying code behavior.
- **Test Suite**: A collection of related test functions grouped logically.
- **Assertions**: The checks within a test that validate expected outcomes (e.g., `EXPECT_EQ`).
- **Mock Objects**: (With GoogleMock) Objects that simulate real collaborators to verify interactions.

---

## 2. Creating a Basic Test

### Step 1: Include GoogleTest Headers

Make sure your source file includes the GoogleTest headers:

```cpp
#include <gtest/gtest.h>
```

If you plan to use GoogleMock for mocking, also include:

```cpp
#include <gmock/gmock.h>
```

### Step 2: Write a Simple Test Function

Use the `TEST` macro to define a test. It takes two arguments: the test suite name and the test name.

```cpp
// A simple function to test
int Factorial(int n) {
  return (n <= 1) ? 1 : n * Factorial(n - 1);
}

// Define a test suite "FactorialTest" and a test "HandlesZeroInput"
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);  // Checks Factorial(0) returns 1
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(4), 24);
}
```

### Explanation
- `TEST` creates an independent test.
- `EXPECT_EQ` asserts that two values are equal; test fails if not.

---

## 3. Writing a Test Fixture for Shared Setup

If multiple tests need common data or setup, use a test fixture.

### Step 1: Define a Fixture Class

```cpp
class QueueTest : public ::testing::Test {
 protected:
  // Setup that runs before each test
  void SetUp() override {
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  // You can define TearDown() to clean resources after each test

  Queue<int> q0_;
  Queue<int> q1_;
  Queue<int> q2_;
};
```

### Step 2: Write Tests Using the Fixture

Use `TEST_F` (Test Fixture) macro instead of `TEST`:

```cpp
TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
}
```

---

## 4. Using GoogleMock to Create Mock Objects

Mocks let you specify expected interactions with dependencies.

### Step 1: Include GoogleMock

```cpp
#include <gmock/gmock.h>
```

### Step 2: Define a Mock Class

Given an interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual int GetX() const = 0;
};
```

Define a mock:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Step 3: Use the Mock in a Test

```cpp
using ::testing::AtLeast;
using ::testing::Return;

TEST(MockTurtleTest, MoveActions) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(AtLeast(1));
  EXPECT_CALL(turtle, GetX())
      .WillOnce(Return(100));

  turtle.PenDown();
  EXPECT_EQ(turtle.GetX(), 100);
}
```

---

## 5. Compiling and Running Your Tests

### Step 1: Compile

Ensure your build includes the GoogleTest and GoogleMock libraries, and your source includes their headers. A minimal command-line example using `g++` might look like:

```bash
# Assuming gtest and gmock are installed and pkg-config is configured
g++ -std=c++17 -pthread your_test.cc -lgtest -lgmock -o your_test
```

If using CMake, link your test executable against `gtest` and `gmock` targets.

### Step 2: Run the Test Binary

Run the compiled program:

```bash
./your_test  # Runs all tests
```

You will see output indicating which tests passed or failed.

---

## 6. Verifying Test Success

- A test suite passes if all assertions succeed.
- If any `EXPECT_*` fails, GoogleTest continues running the current test but marks it failed.
- If an `ASSERT_*` fails, the current test aborts immediately.
- The final output summarizes success/failure with filenames and line numbers.

---

## 7. Common Tips for Success

- **Always specify expectations before code exercising mocks.** Setting expectations after calls leads to undefined behavior.
- **Use `EXPECT_CALL` to specify calls you intend to verify.** Use `ON_CALL` for default behaviors without strict call expectations.
- **Use wildcards `_` when argument values are unimportant to avoid brittle tests.**
- **In case of warnings about uninteresting calls, consider using `NiceMock` to suppress them if intentional.**
- **Name your tests and test suites clearly and consistently for maintainability.**

---

## 8. Troubleshooting

If your tests don't behave as expected:

- Ensure all virtual methods you want to mock are *virtual* and declared correctly.
- Use `--gmock_verbose=info` for detailed call traces and diagnostics.
- Confirm the test binary links against the correct versions of `gtest` and `gmock`.
- Use assertions’ failure messages and stack traces to pinpoint issues.

---

## 9. Next Steps

- Explore the [GoogleTest Primer](primer.md) for a deep dive into writing effective tests.
- Dive into [Adding Mocks to Your Tests](gmock_for_dummies.md) to master mock usage.
- Review [Mocking Reference](reference/mocking.md) for detailed API docs.
- Understand advanced topics in [gMock Cookbook](gmock_cook_book.md) for real-world mocking scenarios.

---

Congratulations! You are ready to write, run, and verify your first tests with GoogleTest and GoogleMock.

---

<Check>
Remember: Every `TEST` or `TEST_F` is independently run, so keep tests isolated.
</Check>

<Check>
Keep your mock expectations simple to catch what matters—avoid over-specifying.
</Check>

---

### Example Full Test Program Example

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

// Function to test
int Factorial(int n) {
  return (n <= 1) ? 1 : n * Factorial(n - 1);
}

TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(4), 24);
}

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

using ::testing::AtLeast;
using ::testing::Return;

TEST(MockTurtleTest, MoveActions) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(AtLeast(1));
  EXPECT_CALL(turtle, GetX())
      .WillOnce(Return(100));

  turtle.PenDown();
  EXPECT_EQ(turtle.GetX(), 100);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Execute to confirm all tests pass.
