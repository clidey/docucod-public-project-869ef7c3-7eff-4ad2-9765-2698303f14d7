---
title: "Configuring Your Project"
description: "Explains how to integrate GoogleTest and GoogleMock into existing or new C++ projects, covering required header inclusions and linking practices for CMake and Bazel-based workflows."
---

# Configuring Your Project with GoogleTest and GoogleMock

This guide explains how to integrate GoogleTest and GoogleMock into your existing or new C++ projects. It focuses on the necessary header inclusions and how to correctly link libraries in environments using CMake and Bazel build systems.

---

## Prerequisites

Before configuring your project to use GoogleTest and GoogleMock, ensure the following prerequisites are met:

- Your project must be compiled with a compiler supporting at least the C++17 standard.
- Both [GoogleTest](https://github.com/google/googletest) and GoogleMock source or pre-built libraries should be available either locally or via package managers.
- You should have basic familiarity with your build system, particularly CMake or Bazel.


## 1. Include GoogleTest and GoogleMock Headers

To use GoogleTest and GoogleMock features, include the appropriate headers in your test source files:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

- `gtest/gtest.h` provides the testing core APIs, including assertions and test fixtures.
- `gmock/gmock.h` enables mocking functionalities that complement GoogleTest.


## 2. Linking GoogleTest and GoogleMock Libraries

Your project must link against the proper GoogleTest and GoogleMock libraries. These libraries wrap the test runner and mock functionality along with helper main functions.

### With CMake

There are two common ways to integrate GoogleTest and GoogleMock into your CMake project:

#### A. Using Installed Packages with `find_package`

If GoogleTest and GoogleMock are already installed on your system, you can use `find_package` to locate them.

Add this to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test_executable your_test_file.cpp)
target_link_libraries(your_test_executable GTest::gmock_main)

add_test(NAME YourTest COMMAND your_test_executable)
```

- `GTest::gmock_main` links the GoogleMock library including a ready-to-use `main()` function.
- If you require a custom `main()` function, link against `GTest::gmock` instead.


#### B. Adding GoogleTest/GoogleMock as a Subdirectory

For tighter integration and to avoid linker compatibility issues, embed GoogleTest and GoogleMock as a subdirectory within your main project.

Example snippet to add in your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.16.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Visual Studio dynamic runtimes
FetchContent_MakeAvailable(googletest)

add_executable(your_test_executable your_test_file.cpp)
target_link_libraries(your_test_executable gmock_main)

add_test(NAME YourTest COMMAND your_test_executable)
```

This ensures your project and GoogleTest/GoogleMock build with the same compiler flags and runtime libraries.


### Notes on Linking

- `gmock_main` contains both GoogleMock and GoogleTest libraries plus a default `main()` function that calls `RUN_ALL_TESTS()`.
- If you want to write your own `main()`, link with `gmock` and `gtest` libraries instead of `gmock_main`.
- Always verify your project and GoogleTest/GoogleMock use the same standard library settings, especially on Windows (e.g., use `gtest_force_shared_crt` option with CMake).


## 3. Bazel Integration

GoogleTest and GoogleMock can also be integrated using Bazel build system.

This typically involves:

- Adding `@com_google_googletest` and `@com_google_googlemock` external dependencies in your `WORKSPACE` file.
- Adding dependencies in your `BUILD` files on the relevant Bazel test targets.

Due to Bazel's structured nature, connecting these libraries revolves around properly setting `deps` in your test `cc_binary` or `cc_test` rules.

Refer to the [Bazel Build System Integration guide](/guides/integration-scenarios/build-system-integration) for detailed Bazel examples.


## 4. Example: Minimal CMake Project Setup

Assuming your test source files are in `tests/` directory, here is a minimal `CMakeLists.txt` example:

```cmake
cmake_minimum_required(VERSION 3.16)
project(MyProjectTests CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Fetch GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.16.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Windows dynamic runtime
FetchContent_MakeAvailable(googletest)

# Add test executable
add_executable(my_tests tests/my_tests.cpp)

# Link with gmock_main (includes main() function)
target_link_libraries(my_tests gmock_main)

# Enable testing and add test
include(CTest)
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```


## 5. Writing Your Own main() Function

If your project requires a custom main function (for example, to initialize resources before tests run), link against `gmock` or `gtest` libraries instead of `gmock_main` or `gtest_main`.

Example `main.cpp`:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

int main(int argc, char **argv) {
  ::testing::InitGoogleMock(&argc, argv);
  // Custom setup code here if needed
  return RUN_ALL_TESTS();
}
```

Compile and link this manually with `gmock` and `gtest` libraries.


## 6. Troubleshooting Common Build Issues

<Tip>
**Mismatch of Runtime Libraries on Windows:**
Linking errors like `LNK2038` may result from mixing dynamic and static runtimes.
Use the CMake option `gtest_force_shared_crt` to align runtime linkage.
</Tip>

<Warning>
**Linker Errors Missing `main`:**
Make sure either you link with `gmock_main` or provide your own `main` function.
</Warning>

<Note>
**Include and Link Directories:**
When building GoogleTest and GoogleMock as part of your project or as dependencies,
ensure your build system correctly locates their `include` directories and libraries.
</Note>

## 7. Summary

By following this configuration workflow, your project will be able to use GoogleTest and GoogleMock seamlessly:

- Include `<gtest/gtest.h>` and `<gmock/gmock.h>` in test files.
- Link your test executables with `gmock_main` for standard setup or `gmock` + `gtest` if you need a custom `main()`.
- Use CMake `find_package` or FetchContent to integrate the test libraries.
- Ensure consistent compiler and runtime settings between your project and the test libraries.
- Refer to Bazel integration documents if using Bazel build systems.

This prepares your project for writing and running comprehensive unit and mock-based tests with GoogleTest and GoogleMock.


---

## Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) — Learn how to write basic tests
- [Integration with Build & CI Systems](/overview/audience-usecases-integration/integration-points) — Overview of common build system integration
- [GoogleMock CMake Build Script Reference](googlemock/CMakeLists.txt) — Understanding library targets
- [GoogleTest and GoogleMock GitHub Repository](https://github.com/google/googletest) — Source and latest updates

---

For detailed troubleshooting and advanced configuration options, refer to the [Troubleshooting Setup Issues](../project-setup-validation/troubleshooting-setup) page.