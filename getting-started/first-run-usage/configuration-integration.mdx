---
title: "Configuring & Integrating GoogleTest"
description: "Learn how to add GoogleTest and GoogleMock as dependencies in your project and configure your build system to make the headers and libraries available for your tests."
---

# Configuring & Integrating GoogleTest

Learn how to add GoogleTest and GoogleMock as dependencies in your project and configure your build system to make the headers and libraries available for your tests.

---

## 1. Add GoogleTest and GoogleMock as Dependencies

GoogleTest integrates seamlessly with GoogleMock, letting you test C++ code with mocks. Before you write your tests, you need to add both libraries to your project.

### 1.1 Clone or Acquire the Source

If you havenâ€™t yet installed GoogleTest and GoogleMock, clone the repository or download the sources. You typically obtain both from the [GoogleTest GitHub](https://github.com/google/googletest).

### 1.2 Include Headers

Make sure your build system can find the headers:

- **GoogleTest headers:** Usually under `googletest/include/gtest`.
- **GoogleMock headers:** Usually found in `googlemock/include/gmock`.

Your test source files should include these headers:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

These headers provide all the testing and mocking facilities.

---

## 2. Build System Configuration

To use GoogleTest and GoogleMock in your project, you must configure your build system to:

- Locate the headers.
- Link against the compiled GoogleTest and GoogleMock libraries.

Below are the common ways to do this.

### 2.1 Using CMake

GoogleTest and GoogleMock provide CMake configuration files. Here are the basic steps:

1. **Add GoogleTest as a subdirectory or external project:**

```cmake
# Add the GoogleTest directory to your project
add_subdirectory(path/to/googletest)
```

2. **Link your test executable against `gtest` and `gmock` libraries:**

```cmake
add_executable(my_tests test_main.cpp my_test1.cpp)
target_link_libraries(my_tests gtest gmock gtest_main gmock_main)
```

- `gtest_main` and `gmock_main` provide ready-to-use `main()` functions for test execution.

3. **Include directories are set automatically by CMake targets.**

### 2.2 Manual Build or Other Systems

If you build GoogleTest/GoogleMock separately:

- Include the `include` directories for headers in your compiler's include paths.
- Link your tests against the binaries:
  - `libgtest.a` or `gtest.lib` 
  - `libgmock.a` or `gmock.lib`
  - Corresponding main entry point libraries (e.g., `gmock_main`)

Refer to your platform's instructions to properly link and compile.

---

## 3. Integrating GoogleTest & GoogleMock in Your Tests

With dependencies added and your build system configured, follow these steps to integrate:

### 3.1 Include Headers in Test Files

In your test source files, include the GoogleTest and GoogleMock headers:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

This provides access to the full testing and mocking APIs.

### 3.2 Use the Initialization Function

In your test executable's `main()` function, initialize GoogleMock (which also initializes GoogleTest):

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- This sets up the test environment and discovers your test cases.
- If you link against `gmock_main` library, a default `main()` is provided, and you don't need to define your own.

### 3.3 Linking to `gmock_main` (Optional)

If you prefer to use GoogleMock's main function, link your test executable against `gmock_main` (and `gmock`, `gtest`), and omit your own `main()`. This eases startup, especially in simple test projects.

---

## 4. Practical Configuration Example

Below is a simple example demonstrating how you might setup a mock class and integrate GoogleTest and GoogleMock.

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Return;

class FooInterface {
 public:
  virtual ~FooInterface() = default;
  virtual int GetValue() const = 0;
};

class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
};

TEST(FooTest, ReturnsExpectedValue) {
  MockFoo mock;
  ON_CALL(mock, GetValue()).WillByDefault(Return(42));
  EXPECT_CALL(mock, GetValue()).Times(1);

  EXPECT_EQ(mock.GetValue(), 42);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- This example shows mocking an interface, setting a default return value with `ON_CALL`, and expecting a call with `EXPECT_CALL`.
- Your build script must include the compiled GoogleTest and GoogleMock libraries.

---

## 5. Tips and Best Practices

- **Header Ordering:** Include `gmock/gmock.h` after `gtest/gtest.h` is acceptable but including `gmock.h` suffices as it includes `gtest.h`.
- **Use `gmock_main` when possible:** It simplifies your test code by providing a `main()` function.
- **Consistent Linkage:** Link against both `gtest` and `gmock` libs, along with their corresponding main libs.
- **Watch out for multiple definitions:** If you provide your own `main()`, do not link `gmock_main`.
- **Use CMake targets:** Leverage CMake's imported targets (`gtest::gtest`, `gmock::gmock`) if available for hassle-free integration.

---

## 6. Common Pitfalls & Troubleshooting

### 6.1 Linking Errors

- **Multiple main functions:** Occur if you link against `gmock_main` and also provide your own `main()`.
  - Solution: Either define your own `main()` or link only `gmock_main` for main.

- **Missing symbols:** Headers aren't found or libraries aren't linked
  - Ensure include paths and libraries are correctly specified in your build.

### 6.2 Header Conflicts or Macro Collisions

- Windows system headers can cause problems with certain names defined as macros.
  - Protect your test code includes with preprocessor directives or carefully order includes.

### 6.3 Test Execution Fails to Discover Tests

- Make sure you call `InitGoogleMock(&argc, argv);` before running tests.

---

## 7. Resources & Related Documentation

- [GoogleTest Installation Guide](../setup-prerequisites/installation-platforms)
- [Writing Your First Test](../first-run-usage/writing-first-test)
- [Mocking in GoogleTest](../../reference/mocking.md)
- [Integrating GoogleTest with your Build System](../../guides/integration-and-real-world-scenarios/integrating-with-build-systems)
- [Troubleshooting Guide](../first-run-usage/troubleshooting-quick-validation)

---