---
title: "Configuring GoogleTest in Your Project"
description: "Learn how to add GoogleTest as a dependency in your existing codebase, set up your test target or executable, and properly reference the needed headers and source files. Covers configuration for both CMake and Bazel, with practical examples."
---

# Configuring GoogleTest in Your Project

This guide walks you through the essential steps to add GoogleTest as a dependency to your existing C++ codebase, configure your test targets or executables, and correctly reference necessary headers and source files. We cover configuration approaches for both **CMake** and **Bazel**, including practical examples to help you get started quickly and reliably.

---

## 1. Prerequisites & Preparation

Before starting, ensure you have the following in place:

- A C++17 compatible compiler and build environment.
- Your project is already using either CMake or Bazel as a build system.
- GoogleTest source code available locally or configured as a dependency (e.g., via git submodule or package manager).
- Basic familiarity with your build system's syntax and conventions.


## 2. Adding GoogleTest to Your Build with CMake

GoogleTest provides a ready-made CMakeLists.txt and instructions to integrate easily into your existing CMake-based project.

### 2.1 Fetching GoogleTest Source

You can include GoogleTest as a git submodule or download and place it in your project.

Alternatively, use CMake's [`FetchContent`](https://cmake.org/cmake/help/latest/module/FetchContent.html) module to download during configuration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows: Use dynamic runtime linking
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

### 2.2 Defining Your Test Executable

After GoogleTest is available, you need to create an executable that includes your tests and links against GoogleTest:

```cmake
add_executable(my_tests
  test/my_test_file.cpp
  # Add additional source files with tests here
)

# Link the 'gtest_main' library, which provides a main() function
target_link_libraries(my_tests PRIVATE gtest_main)

# Add testing support
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```


### 2.3 Recommended Compiler Options

Use `target_compile_features()` to request C++17:

```cmake
target_compile_features(my_tests PRIVATE cxx_std_17)
```

GoogleTest handles most flags internally, but ensure `-pthread` or equivalent is included if your platform requires it (usually automatic).


### 2.4 Building and Running Tests

After configuring and building your project:

```bash
cmake -S . -B build
cmake --build build
ctest --test-dir build
```

Your tests will run, with results reported in the console.


## 3. Adding GoogleTest to Your Build with Bazel

GoogleTest includes native Bazel support. You can easily add GoogleTest dependency and test targets.

### 3.1 Setting Up GoogleTest as a Workspace Dependency

In your `WORKSPACE` file, include the GoogleTest Bazel repository. For example:

```bazel
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.11.0.tar.gz"],
    strip_prefix = "googletest-release-1.11.0",
)
```

### 3.2 Defining Your Test Target

Create a `BUILD` file in your test directory to declare your test executable.

```bazel
cc_test(
    name = "my_tests",
    srcs = ["my_test_file.cc"],
    deps = ["@com_google_googletest//googletest:googletest", "@com_google_googletest//googletest: gtest_main"],
    copts = ["-std=c++17"],
)
```

- `deps` includes the GoogleTest libraries.
- `copts` ensures C++17 standard compilation.

### 3.3 Building and Running Tests

Use Bazel commands:

```bash
bazel test //path/to/tests:my_tests
```

You will see your test results within Bazel's output.


## 4. Referencing Headers and Source Files

- GoogleTest headers are found under `googletest/include/gtest` and `googlemock/include/gmock`.
- When including in your tests, add `#include <gtest/gtest.h>`.
- Linking against `gtest_main` provides the default `main()` entry point, so you usually don't define `main()` yourself.
- For custom main functions, link only against `gtest`.


## 5. Best Practices and Tips

- **Use gtest_main when possible**: This avoids having to write your own main function.
- **Control threading flags**: Ensure your build system passes `-pthread` or platform equivalent if required.
- **Keep GoogleTest version consistent**: To avoid conflicts or compatibility issues, keep the GoogleTest version uniform across your environment.
- **Separate test sources clearly**: Organize your tests in easy-to-find directories and files.


## 6. Common Issues and Troubleshooting

### 6.1 Missing GoogleTest Packages or Headers

- Ensure the source code or package is correctly downloaded and referenced.
- For CMake, check if `FetchContent` or submodule path is correct.

### 6.2 Linker Errors

- Verify you link against `gtest` or `gtest_main` libraries correctly.
- On Linux and some platforms, confirm `-pthread` is included.

### 6.3 Wrong C++ Standard

- GoogleTest requires C++17; ensure your build flags specify this.

### 6.4 Running Tests with Custom Main

- If you provide your own `main()`, link only with `gtest` instead of `gtest_main`.


## 7. References and Next Steps

- See the [GoogleTest Primer](docs/primer.md) for foundational concepts and test writing.
- For integrating with other build tools, review [Using GoogleTest from various build systems](docs/pkgconfig.md).
- Once set up, move on to [Writing & Running Your First Test](getting-started/first-run-validation/your-first-test).


---

### Example: Minimal CMake `CMakeLists.txt` Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.11.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test/my_test.cc)
target_link_libraries(my_tests PRIVATE gtest_main)
target_compile_features(my_tests PRIVATE cxx_std_17)

enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

### Example: Minimal Bazel `BUILD` File Snippet

```bazel
cc_test(
    name = "my_tests",
    srcs = ["my_test.cc"],
    deps = [
        "@com_google_googletest//googletest:googletest",
        "@com_google_googletest//googletest:gtest_main",
    ],
    copts = ["-std=c++17"],
)
```

---

# Summary Diagram

```mermaid
flowchart TD
  A[Your Project's Test Sources] -->|Includes| B[GoogleTest Headers (gtest/gtest.h)]
  B --> C[GoogleTest Libraries (gtest, gtest_main)]
  subgraph Build Systems
    D[CMake]
    E[Bazel]
  end
  D -->|Links against| C
  E -->|Depends on| C
  C -->|Provides| F[Test Executable with Tests]
  F -->|Run Tests| G[Test Framework Execution & Reporting]
```

---

<Check>
Make sure to call `testing::InitGoogleTest(&argc, argv)` in your `main()` before calling `RUN_ALL_TESTS()` if creating a custom main.
</Check>