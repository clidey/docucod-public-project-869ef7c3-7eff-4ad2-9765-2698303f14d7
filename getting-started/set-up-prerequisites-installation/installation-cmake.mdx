---
title: "Installing with CMake"
description: "Step-by-step instructions for installing GoogleTest and GoogleMock using CMake, covering add_subdirectory, FetchContent, and package-based integrations. Walks through acquiring source, configuring, and building, making this the recommended approach for most C++ projects."
---

# Installing with CMake

This guide provides a clear, step-by-step path to install and integrate GoogleTest and GoogleMock in your C++ projects using CMake. It covers methods to add GoogleTest/GoogleMock as part of your build, either by including source code directly, using CMake's `FetchContent` module, or discovering installed packages. This is the recommended approach to build, link, and run tests with GoogleTest and GoogleMock in a consistent, cross-platform manner.

---

## 1. Prerequisites & Requirements

Before proceeding, ensure your environment meets these conditions:

- **C++ Standard Support:** Your compiler must support C++17 or later.
- **CMake Version:** Use CMake 3.14 or newer (required for `FetchContent` usage).
- **Build Tools:** Supported tools include Make, Ninja, Visual Studio, Xcode, etc.
- **Platform Compatibility:** Linux, macOS, and Windows are supported.
- **Threading Support:** Pthread or equivalent threading support is recommended for multi-threaded tests.

For detailed platform and system requirements, see [System Requirements & Supported Platforms](/getting-started/set-up-prerequisites-installation/system-requirements).

---

## 2. Installing GoogleTest and GoogleMock with CMake

There are three main patterns to integrate GoogleTest and GoogleMock:

### A. Using `add_subdirectory()` with Source Code

This method builds GoogleTest/GoogleMock from source inside your existing project build.

<Steps>
<Step title="Clone the GoogleTest repository">
Run:
```bash
$ git clone https://github.com/google/googletest.git -b main
$ cd googletest
```
</Step>
<Step title="Create and enter a build directory">
```bash
$ mkdir build
$ cd build
```
</Step>
<Step title="Generate build files with CMake">
For building both GoogleTest and GoogleMock:

```bash
$ cmake ..
```

To build only GoogleTest (without GoogleMock), add the option:

```bash
$ cmake .. -DBUILD_GMOCK=OFF
```
</Step>
<Step title="Build the libraries">
```bash
$ cmake --build .
```
</Step>
<Step title="(Optional) Install libraries system-wide">
```bash
$ sudo cmake --install .
```

This installs libraries and headers to default locations like `/usr/local/`.
</Step>
</Steps>

<Note>
On Windows, the build step generates Visual Studio solutions. Open them in Visual Studio and build the targets.
</Note>

---

### B. Adding GoogleTest to Your Project with `FetchContent`

This is the most flexible method to automatically download and build GoogleTest/GoogleMock as part of your project, ensuring consistent versions.

<Steps>
<Step title="Create or open your CMake project directory">
```bash
$ mkdir my_project && cd my_project
```
</Step>
<Step title="Create or edit `CMakeLists.txt`">
Add the following snippet to your `CMakeLists.txt` file:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Enforce C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
# On Windows, prevent runtime conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

This declares GoogleTest as a dependency and downloads it automatically.
</Step>
<Step title="Add a test executable and link libraries">
For example, add these lines:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)
target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

Adjust the source files and target names as needed.
</Step>
</Steps>

<Tip>
Make sure your `hello_test.cc` includes GoogleTest headers and test cases.
</Tip>

### C. Using Installed GoogleTest Packages (`find_package`)

If GoogleTest is already installed on your system (e.g., via package manager), you can find and link it using CMake's `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_test my_test.cc)
target_link_libraries(my_test GTest::gtest_main)
```

This requires the system to have the correct `.cmake` configuration files for GoogleTest.

---

## 3. Example: Building and Running a Basic Test with FetchContent

Follow these steps to quickly setup and run your first test.

<Steps>
<Step title="Create simple test file:
`hello_test.cc`">
Create `hello_test.cc` with:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```
</Step>
<Step title="Configure your build">
From your project root:

```bash
$ cmake -S . -B build
```

This generates build files in the `build/` directory.
</Step>
<Step title="Build the test executable">

```bash
$ cmake --build build
```
</Step>
<Step title="Run the tests">

```bash
$ cd build && ctest
```
Expected output:

```text
Test project .../build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```
</Step>
</Steps>

Congratulations! You have built and executed your first GoogleTest test binary.

---

## 4. Understanding the CMake Integration

- **Targets Provided:** 
  - `GTest::gtest` — GoogleTest without main(), link if you provide your own main.
  - `GTest::gtest_main` — GoogleTest with main() included for running tests.
  - Similar targets exist for GoogleMock (`gmock` and `gmock_main`).

- **Handling Threads:** GoogleTest automatically links with system threading libraries.

- **Build Options:**
  - `BUILD_SHARED_LIBS` to build shared libraries.
  - `gtest_force_shared_crt` to address runtime conflicts on Windows.

- **Installation:** `sudo cmake --install .` installs headers, libraries, and pkg-config files.

---

## 5. Troubleshooting Tips

<AccordionGroup title="Common Installation Issues">
<Accordion title="CMake version too old">
If your CMake version is less than 3.14, `FetchContent` may not be available. Upgrade CMake.
</Accordion>
<Accordion title="Compiler does not support C++17">
Ensure your compiler supports at least C++17. Update your compiler or use a supported one.
</Accordion>
<Accordion title="Linking errors related to pthread">
Make sure your build links against pthreads or an equivalent threading library. This is usually automatic with CMake and GoogleTest.
</Accordion>
<Accordion title="Runtime library mismatch on Windows">
Set `gtest_force_shared_crt` to ON in your CMakeLists to match the runtime library settings.
</Accordion>
</AccordionGroup>

---

## 6. Next Steps

- Learn to [Write and Run Your First Tests](/getting-started/configuration-first-run-validation/first-test).
- Explore [GoogleMock integration](/googletest-guides/core-workflows/mocking-basics).
- Review advanced build integration examples in [Integration Build Systems](/overview/workflow-integration/integration-build-systems).

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Documentation on FetchContent](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- [System Requirements & Supported Platforms](/getting-started/set-up-prerequisites-installation/system-requirements)
- [Writing and Running Your First Test](/getting-started/configuration-first-run-validation/first-test)
- [GoogleMock CMake Integration](googlemock/CMakeLists.txt)

---

For a quick visual on typical CMake integration flow:

```mermaid
flowchart TD
  A[Start Project Setup] --> B[Create CMakeLists.txt]
  B --> C{Choose Integration Method}
  C -->|FetchContent| D[Declare googletest with FetchContent]
  C -->|add_subdirectory| E[Add googletest source as subdirectory]
  C -->|System Installed| F[find_package(GTest CONFIG REQUIRED)]
  D & E & F --> G[Add Test Executables]
  G --> H[Link Against GoogleTest Targets]
  H --> I[Build & Run Tests]
  I --> J[Review Test Results]
```