---
title: "Installing with CMake"
description: "Step-by-step instructions to build and install GoogleTest and GoogleMock using CMake, the most widely supported and recommended build system. Includes tips for integrating into an existing CMake project and validating the installation."
---

# Installing with CMake

Step-by-step instructions to build and install GoogleTest and GoogleMock using CMake, the most widely supported and recommended build system. This guide also includes how to integrate GoogleTest into your existing CMake project and verify the installation.

---

## 1. Prerequisites & System Requirements

Before starting, ensure your development environment meets these requirements:

- **Operating System**: Linux, macOS, Windows
- **Compiler**: Must support at least C++17 (e.g., GCC 7+, Clang 5+, MSVC 2017+)
- **CMake Version**: Minimum 3.16 (3.14 or higher forFetchContent in your own projects)
- **Build Tools**: Compatible with Make, Ninja, Visual Studio, or Xcode
- **Network Access**: Required if you use FetchContent to download GoogleTest

<Tip>
If you’re unsure about your compiler or OS compatibility, see the [System Requirements](../requirements-installation/system-requirements) page.
</Tip>

---

## 2. Building and Installing GoogleTest with CMake

GoogleTest includes a CMake script (`CMakeLists.txt`) for building and installation. Follow these steps to build and install GoogleTest (including GoogleMock by default).

### 2.1 Clone the Repository

```bash
$ git clone https://github.com/google/googletest.git -b v1.17.0
$ cd googletest
```

### 2.2 Create and Enter a Build Directory

Create a dedicated directory for out-of-source builds to keep things clean.

```bash
$ mkdir build
$ cd build
```

### 2.3 Configure the Build with CMake

Run CMake to generate native build files for your platform.

- To build **both GoogleTest and GoogleMock** (default):

```bash
$ cmake ..
```

- To build **GoogleTest only**, disable GoogleMock explicitly:

```bash
$ cmake .. -DBUILD_GMOCK=OFF
```

### 2.4 Build the Libraries

On Unix-like systems with Makefiles, simply run:

```bash
$ make
```

On Windows, open the generated Visual Studio solution (`.sln`) in Visual Studio and build from there. On macOS, open the Xcode project if generated.

### 2.5 (Optional) Install Libraries and Headers

If you want to install GoogleTest system-wide (
`/usr/local/` by default) and have admin rights:

```bash
$ sudo make install  # or run as administrator on Windows
```

<Tip>
The installation step places libraries, headers, and pkg-config files (if enabled) into standard system locations, making GoogleTest available for use in other projects.
</Tip>

---

## 3. Integrating GoogleTest into Your CMake Project

You can incorporate GoogleTest into your own CMake project using two main methods:

### 3.1 Using Installed GoogleTest via `find_package`

If GoogleTest is installed on your system, your project’s `CMakeLists.txt` can detect it using:

```cmake
find_package(GTest CONFIG REQUIRED)
...
target_link_libraries(your_test_target GTest::gtest_main)
```

This method assumes GoogleTest and GoogleMock are installed and discoverable on your system.

### 3.2 Build GoogleTest as Part of Your Project with `FetchContent`

For more control and consistency, you can make GoogleTest part of your build by downloading it during CMake configuration.

#### Example `CMakeLists.txt` snippet:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows: Avoid overriding compiler/linker settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

# Make GoogleTest available for use
FetchContent_MakeAvailable(googletest)

# Enable testing to use GoogleTest's CMake test support
enable_testing()

add_executable(hello_test hello_test.cc)

target_link_libraries(hello_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

Replace `03597a01ee50ed33e9dfd640b249b4be3799d395` with the commit hash you want.

---

## 4. Running Your First Test with CMake

Follow this example to create, build, and run your first GoogleTest-based test binary.

### 4.1 Example Test Source (`hello_test.cc`)

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

This simple test checks string inequality and arithmetic equality.

### 4.2 Build the Test Executable

Add the following to your `CMakeLists.txt` as shown in Section 3.2, or your existing file:

```cmake
add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

### 4.3 Configure, Build, and Run Tests

Run these commands from your project root:

```bash
$ cmake -S . -B build
$ cmake --build build
$ cd build
$ ctest
```

Expected output upon success:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
```

<Tip>
You can also run the test binary directly with `./hello_test` to see detailed test output.
</Tip>

---

## 5. Verifying and Troubleshooting Installation

### 5.1 Verify Installation

- After building, confirm the presence of `libgtest.a` or `libgmock.a` in your build directory.
- Running `ctest` reports your tests and their statuses.
- Use `find_package(GTest)` in your project to detect installed libraries.

### 5.2 Common Issues

<AccordionGroup title="Troubleshooting Common Build Issues">

<Accordion title="Compiler or C++ Standard Version Errors">
Ensure your compiler supports C++17 or higher. Set `CMAKE_CXX_STANDARD` to 17 explicitly in your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

</Accordion>

<Accordion title="Linker Errors Related to Runtime Library Mismatches on Windows">
Enable `gtest_force_shared_crt` to match runtime libraries:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

</Accordion>

<Accordion title="GoogleTest Not Found Using `find_package`">
Make sure GoogleTest is installed and pkg-config or CMake config files are in known locations. Alternatively, embed GoogleTest source with `FetchContent`.

</Accordion>

<Accordion title="Pthreads Not Detected Correctly">
Force GoogleTest’s pthreads detection with compiler flags:

```bash
-DGTEST_HAS_PTHREAD=1
```

or disable if unsupported:

```bash
-DGTEST_HAS_PTHREAD=0
```

</Accordion>
</AccordionGroup>

<Tip>
Consult the [System Requirements](../requirements-installation/system-requirements) and [FAQ](../../faq/getting-started-faq/installation-compatibility) for deeper troubleshooting.
</Tip>

---

## 6. Next Steps & Recommended Reading

- Start writing tests by visiting the [GoogleTest Primer](../../guides/getting-started/writing-basic-tests).
- Learn advanced mocking techniques in the [gMock Cookbook](../../guides/mocking-and-test-doubles/mock-basics).
- Explore GoogleTest and GoogleMock integration strategies in the [Integration with Build & Dev Toolchains](../../overview/adoption-and-integration/integration-touchpoints).

---

For complete references and further guidance, visit the [GoogleTest User's Guide homepage](../../docs/index.md).

---

Congratulations! You have successfully built and installed GoogleTest with CMake and run your first test binary.

---