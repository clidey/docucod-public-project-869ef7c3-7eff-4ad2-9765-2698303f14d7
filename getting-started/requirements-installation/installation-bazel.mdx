---
title: "Installing with Bazel"
description: "Explains how to add GoogleTest and GoogleMock as dependencies and build them with Bazel. Walks users through fetching, including, and validating the frameworks in Bazel-driven environments."
---

# Installing with Bazel

This guide explains how to add GoogleTest and GoogleMock as dependencies in Bazel projects, build them using Bazel, and verify that the frameworks are set up correctly within a Bazel-driven development environment.

---

## 1. Prerequisites & System Requirements

Before proceeding, ensure the following prerequisites are met:

- **Operating System**: Linux, macOS, or Windows supported.
- **Compiler**: A C++ compiler with support for C++17 or later.
- **Bazel Version**: Bazel 7.0 or above installed on your system.
- **Network Access**: Internet connectivity to fetch dependencies from the Bazel Central Registry (optional if dependencies are vendored).

### Access Requirements

- Your workspace should be able to manage external dependencies via `MODULE.bazel`.

---

## 2. Adding GoogleTest and GoogleMock to Your Bazel Workspace

Bazel 7.0 introduced the preferred mechanism to consume GoogleTest via the Bazel Central Registry.

### Step 1: Create or navigate to your Bazel workspace directory

```bash
$ mkdir my_workspace && cd my_workspace
```

### Step 2: Add the `MODULE.bazel` file with GoogleTest dependency

Create a file named `MODULE.bazel` in the root of your workspace with the following content:

```python
# MODULE.bazel

# Specify the GoogleTest module dependency
bazel_dep(name = "googletest", version = "1.17.0")
```

**Note:** Replace `1.17.0` with the latest stable version available at [Bazel Central Registry googletest module](https://registry.bazel.build/modules/googletest).

This inclusion automatically fetches both GoogleTest and GoogleMock as they are bundled together in the Bazel module.

---

## 3. Creating a Test Binary Using GoogleTest and GoogleMock

Once GoogleTest and GoogleMock are available in your workspace, you can start writing tests and build them with Bazel.

### Step 1: Create a test source file

Create a C++ test file, for example `hello_test.cc`:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>  // Optional: include if using GoogleMock features

// A simple GoogleTest test case
TEST(HelloTest, BasicAssertions) {
  EXPECT_NE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}

// Optional: Example GoogleMock usage
class MockInterface {
 public:
  MOCK_METHOD(void, DoSomething, (), ());
};

TEST(MockTest, Verification) {
  MockInterface mock;
  EXPECT_CALL(mock, DoSomething()).Times(1);
  mock.DoSomething();
}
```

### Step 2: Create a Bazel BUILD file describing the test

In the same directory, add a `BUILD` file with the following content:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
        "@googletest//:gmock",           # GoogleMock dependency
        "@googletest//:gmock_main",      # GoogleMock main if needed
    ],
)
```

This rule defines a test binary named `hello_test`:
- It depends on GoogleTest (`gtest`, `gtest_main`) and GoogleMock (`gmock`, `gmock_main`).
- `gtest_main` and `gmock_main` provide the main entry point to run tests.

---

## 4. Building and Running Your First Test

### Step 1: Build the test with Bazel

Execute the following Bazel command to compile and run your test:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

- `--cxxopt=-std=c++17` ensures compliance with the C++17 standard required by GoogleTest.
- `--test_output=all` displays all test output.

### Step 2: Verify test output

You should see output similar to:

```
INFO: Analyzed target //:hello_test
INFO: Found 1 test target...
[==========] Running 2 tests from 2 test suites.
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions
[ RUN      ] MockTest.Verification
[       OK ] MockTest.Verification
[  PASSED  ] 2 tests.
```

This confirms that GoogleTest and GoogleMock are correctly fetched, built, and linked.

---

## 5. Understanding Bazel Dependencies for GoogleTest and GoogleMock

The Bazel build rules for GoogleTest and GoogleMock define distinct targets to optimize usage:

- `@googletest//:gtest`
- `@googletest//:gtest_main` (provides a `main()` function for simple tests)
- `@googletest//:gmock` (includes GoogleMock sources and headers)
- `@googletest//:gmock_main` (GoogleMock with a `main()` method)

These targets appear in the dependency list in your `BUILD` file to suit your needs.

---

## 6. Best Practices & Tips

- Always specify C++17 standard compilation flags (`--cxxopt`) to ensure compatibility.
- Use `gtest_main` or `gmock_main` for tests unless you supply your own `main()`.
- Leverage GoogleMock by including `@googletest//:gmock` and `@googletest//:gmock_main`.
- Keep your `MODULE.bazel` synchronized with available latest stable releases.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Bazel Installation and Build Issues">
<Accordion title="Test Fails to Build Due to Missing C++17 Support">
Ensure your compiler supports C++17. Pass `--cxxopt=-std=c++17` or equivalent for MSVC (`/std:c++17`) when invoking Bazel to enforce the standard.
</Accordion>
<Accordion title="Cannot Find googletest Module in MODULE.bazel">
Make sure you have added the correct `bazel_dep` with the appropriate name and version. Confirm your internet connection to fetch dependencies or verify if dependencies are vendored locally.
</Accordion>
<Accordion title="Linker Errors Related to Threads or pthreads">
Verify your platform supports pthread and that Bazel has proper linkopts. On Windows, ensure correct compiler and link settings.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps

- Explore writing more advanced tests with GoogleTest and GoogleMock.
- Learn to integrate these frameworks with your existing Bazel C++ projects.
- Check the [Writing and Running Your First Test](../configuration-validation/writing-first-test) guide for building test logic.
- Review the [Validating Setup & Troubleshooting](../configuration-validation/validation-troubleshooting) guide for detailed troubleshooting.
- Dive deeper into GoogleMock via the [Creating and Using Basic Mocks](../../guides/mocking-and-test-doubles/mock-basics) guide.


---

For additional help, visit the official Bazel documentation at [bazel.build](https://bazel.build) and the GoogleTest GitHub repository at [https://github.com/google/googletest](https://github.com/google/googletest).

---

## References

- [GoogleTest Bazel Quickstart](docs/quickstart-bazel.md)
- [GoogleTest BUILD.bazel file](BUILD.bazel)
- [GoogleMock CMakeLists.txt (reference for GoogleMock integration)](googlemock/CMakeLists.txt)
- [System Requirements](system-requirements)
- [Writing Your First Test](../configuration-validation/writing-first-test)

---