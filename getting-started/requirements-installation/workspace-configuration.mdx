---
title: "Workspace & Project Configuration"
description: "Configure your project to use GoogleTest smoothly. Learn how to update your build files, link against the correct libraries, and validate compiler flags. Discover essential configuration details to avoid integration pitfalls."
---

# Workspace & Project Configuration

Configure your development workspace and project to integrate GoogleTest seamlessly. This guide focuses on updating your build files, linking against the correct GoogleTest libraries, and configuring compiler flags for smooth compilation and execution.

---

## 1. Set Up Your Project Source Structure

Start by ensuring your project repository has a clear source layout that accommodates GoogleTest, either by including GoogleTest as an external dependency or integrating it within your project source tree.

- **Option A: Include GoogleTest as a git submodule or external dependency**
  - Clone GoogleTest into a subdirectory, such as `third_party/googletest/`.
  - This method keeps your codebase clean and lets you update GoogleTest independently.

- **Option B: Embed source directly in your project**
  - Copy the `googletest` folder inside your project’s source tree.
  - This allows easy modification but requires manual updates from the GoogleTest repository.

---

## 2. Update Your Build Configuration

GoogleTest supports multiple build environments, but CMake is the recommended build tool due to its wide adoption and robust integration. Here’s how to configure your `CMakeLists.txt`.

### 2.1 Adding GoogleTest to Your CMake Project

##### a. Add GoogleTest source as a subdirectory

Place the GoogleTest source in your project or point to it, then add this to your `CMakeLists.txt`:

```cmake
add_subdirectory(third_party/googletest)
```

Replace the path with the relative path to where GoogleTest source is located.

##### b. Link your test targets against GoogleTest libraries

When defining your test executable, link it to `gtest` or `gtest_main` as follows:

```cmake
add_executable(my_test_exe test_main.cpp my_test_cases.cpp)
target_link_libraries(my_test_exe PRIVATE gtest_main)
```

- `gtest_main` includes a main() function useful for standalone tests.
- Use `gtest` if you provide your own `main()` function.

##### c. Enable C++17 standard if not already set

GoogleTest requires C++17. Confirm by adding:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```


### 2.2 Using GoogleTest with FetchContent (Recommended for External Projects)

Instead of manually downloading or submoduling, you can use CMake’s `FetchContent` module to grab GoogleTest at configure time:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/v1.17.0.tar.gz
)
FetchContent_MakeAvailable(googletest)

add_executable(my_test_exe test_main.cpp my_test_cases.cpp)
target_link_libraries(my_test_exe PRIVATE gtest_main)
```

---

## 3. Configure Compiler and Linker Flags

GoogleTest provides internal utilities to configure compiler flags properly, which ensures compatibility and thread safety.

### 3.1 Threading Support Configuration

GoogleTest detects and leverages pthread support if available.

- If your environment does not correctly auto-detect pthread support, force it by adding:

```cmake
add_compile_definitions(-DGTEST_HAS_PTHREAD=1)
```

- When building manually (not via CMake), ensure your compiler and linker flags include pthread, e.g., `-pthread` (Linux/macOS).

### 3.2 Shared vs Static Runtime Libraries (Windows Specific)

Windows users often face linker errors due to mismatches in runtime linkage between GoogleTest and their projects.

- Use the CMake option `gtest_force_shared_crt` to align GoogleTest’s runtime linkage with your project:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "Use shared C++ runtime")
```

- This ensures GoogleTest links against dynamic runtime libraries (MD/MDd) matching Visual Studio projects.

### 3.3 Building GoogleTest as a Shared Library

If you need a shared GoogleTest library, define:

```cmake
add_compile_definitions(-DGTEST_CREATE_SHARED_LIBRARY=1)
```

And to build your tests linking against the shared library:

```cmake
add_compile_definitions(-DGTEST_LINKED_AS_SHARED_LIBRARY=1)
```

---

## 4. Integrating GoogleMock (Optional)

GoogleMock is integrated by default when you include GoogleTest’s repository unless you specify otherwise.

### 4.1 Enable or Disable GoogleMock

- To build only GoogleTest without GoogleMock:

```cmake
cmake .. -DBUILD_GMOCK=OFF
```

- Otherwise, GoogleMock targets `gmock` and `gmock_main` can be linked similarly to GoogleTest:

```cmake
target_link_libraries(my_test_exe PRIVATE gmock_main)
```

### 4.2 Include Directories

CMake automatically manages include directories for GoogleMock and GoogleTest. If manual setup is required, include paths are usually:

```
/path/to/googletest/include
/path/to/googlemock/include
```

But prefer linking targets in CMake which handle this automatically.

---

## 5. Validation and Verification

Once configuration is done, build your test executables and confirm:

- **Build Success**: No compiler or linker errors related to GoogleTest dependencies.
- **Running Tests**: Run your test binary. You should see GoogleTest’s test runner output.

```bash
./my_test_exe
```

Successful output will look like:

```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from MyTestSuite
[ RUN      ] MyTestSuite.MyTestCase
[       OK ] MyTestSuite.MyTestCase (0 ms)
[----------] 1 test from MyTestSuite (0 ms total)
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

<Tip>
If tests do not run or fail to link, ensure that:
- Correct library targets are linked.
- Compiler flags include required definitions.
- For multi-threading, pthread support is properly configured.
</Tip>

---

## 6. Common Pitfalls & Troubleshooting

<AccordionGroup title="Common Configuration Issues">
<Accordion title="Linker errors related to pthread or threading">
Ensure your compiler/linker uses pthread flags (e.g., `-pthread` on Linux/macOS).
If using CMake, the script handles this, but check if `GTEST_HAS_PTHREAD` is set correctly.
</Accordion>
<Accordion title="Runtime Library Mismatch on Windows">
Check that `gtest_force_shared_crt` is set to `ON` if your main project uses dynamic runtime.
Mismatch between static and dynamic runtimes causes LNK2038 errors.
</Accordion>
<Accordion title="GoogleTest Symbols Undefined at Link Time">
Verify you are linking against `gtest`/`gtest_main` targets.
If GoogleMock is used, link against `gmock` or `gmock_main`.
Ensure subdirectory or FetchContent includes the GoogleTest source properly.
</Accordion>
<Accordion title="C++ Standard Compatibility">
GoogleTest requires C++17 or newer. Set `CMAKE_CXX_STANDARD` to 17 or above.
</Accordion>
</AccordionGroup>

---

## 7. Additional Configuration Tips

- **Customization Macros**: Advanced users can define macros that influence GoogleTest behavior, such as `GTEST_HAS_PTHREAD`, `GTEST_CREATE_SHARED_LIBRARY`, and `GTEST_LINKED_AS_SHARED_LIBRARY`. These should be used in the compiler command line or in CMake’s `add_compile_definitions`.

- **Customizing Temporary Directory**: Override temporary directory behaviors with `GTEST_CUSTOM_TEMPDIR_FUNCTION_` if needed (advanced use case).

- **Logging & Threading Configurations**: For environments with custom logging or threading models, refer to GoogleTest internal macro definitions documented under `gtest-port.h`.


---

## 8. Summary

By properly configuring your workspace and project files, you enable a smooth GoogleTest integration ensuring consistent, thread-safe, and efficient unit testing.

Ensure:

- GoogleTest source is available via subdirectory or FetchContent
- Your `CMakeLists.txt` links test targets correctly
- Compiler flags and definitions accommodate platform-specific needs
- Validation by building and running sample tests

This foundational setup allows you to move confidently to writing, running, and expanding your test suites with GoogleTest.

---

## Useful Links

- [GoogleTest CMake Build Script](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [Writing Your First Test Case](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [CMake FetchContent Documentation](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- [Threading and Compiler Flags notes](https://github.com/google/googletest/blob/main/googletest/cmake/internal_utils.cmake)


<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "CMakeLists.txt", "range": "1-68"},{"path": "googletest/README.md", "range": "40-130"},{"path": "googletest/cmake/internal_utils.cmake", "range": "1-138"},{"path": "googlemock/CMakeLists.txt", "range": "1-130"}]} />

---

**End of Workspace & Project Configuration Guide**
