---
title: "Troubleshooting Common Setup Issues"
description: "Solve frequent setup problems, from compiler errors to linking issues and misconfigurations. Find links to platform-specific troubleshooting and guidance for contributing reliable bug reports."
---

# Troubleshooting Common Setup Issues

GoogleTest and GoogleMock offer powerful tools for C++ testing and mocking. However, setup problems like compiler errors, linker issues, or misconfigurations can prevent your tests from running as expected. This guide focuses explicitly on solving frequent setup issues to help you get GoogleTest and GoogleMock up and running smoothly.

---

## 1. Common Compiler and Build Issues

### 1.1 Method Invocation Calls the Real Function Instead of Mock

**Cause:** The mocked method is not declared as `virtual` in the base class.

**Resolution:**
- Ensure that all methods you mock with gMock are `virtual` in the base class. gMock requires virtual methods to override.
- For non-virtual methods, consider applying the [Hi-perf dependency injection](https://google.github.io/googletest/gmock_cook_book.html#MockingNonVirtualMethods) pattern where you mock unrelated interfaces.

### 1.2 MSVC Complains about Const Parameter in Mock Method

**Cause:** MSVC bug with const qualification on parameters.

**Resolution:**
- Remove `const` qualifiers from value parameters in both base and mock method declarations (e.g., change `void Bar(const int i)` to `void Bar(int i)`). Pointers or references to const remain valid.

### 1.3 Overloaded Methods Cause Ambiguity or Errors

**Resolution:**
- Use `Const()` wrapper to disambiguate const vs. non-const versions.
- When mocking overloaded methods, fully specify argument types or use `using BaseClass::MethodName` in your mock to bring hidden overloads back into scope.

### 1.4 Unprotected Commas in MOCK_METHOD

**Cause:** Return types or arguments contain commas (e.g., `std::pair<int, int>`).

**Resolution:**
- Wrap types with commas inside extra parentheses:

  ```cpp
  MOCK_METHOD((std::pair<int, int>), GetPair, ());
  ```
  
- Or define type aliases and use them.

### 1.5 Slow Compilation of Mock Classes

**Tip:**
- Move the constructor and destructor definitions of mock classes out of the header file into a `.cc` when you have many mocked methods, to reduce compile time.

---

## 2. Linking Issues

### 2.1 Symbol Not Found for GoogleTest or GoogleMock Symbols

**Cause:** Missing linking against GoogleTest/GoogleMock libraries or incorrect order.

**Resolution:**
- Link your test binaries against `gtest` and `gmock` libraries.
- Use the recommended linking flags from the [Installation Guide](/getting-started/prereq-install/installation-guide).
- Verify you're using compatible ABI and compiler versions.

### 2.2 Multiple Definitions or Linker Conflicts

**Resolution:**
- Avoid including implementation files (*.cc) in multiple compilation units.
- Use appropriate include guards.

---

## 3. Expectation and Runtime Behavior Issues

### 3.1 "Uninteresting Mock Function Call" Warnings

**Cause:** Calls to mocked methods that have no corresponding `EXPECT_CALL`.

**Explanation:**
- By default, methods without expectations generate warnings when called.

**Resolutions:**
- Add `EXPECT_CALL(mock, Method(...)).Times(AnyNumber())` to declare calls as expected but uninteresting.
- Use `NiceMock<MockClass>` wrapper to suppress these warnings.
- Alternatively, specify default actions using `ON_CALL(...)` to customize behavior.

### 3.2 "Unexpected Mock Function Call" Errors

**Cause:** Calls that do not match any set expectations (`EXPECT_CALL`).

**Resolution:**
- Add appropriate `EXPECT_CALL`s to cover all legitimate calls.
- Check argument matchers for correctness.

### 3.3 Multiple Failures for a Single Expectation Noticed Twice

**Explanation:**
- gMock emits failure messages multiple times at different execution points.
- This is intentional to give accurate context on failures.

### 3.4 Mock Objects Not Verifying Expectations

**Cause:** Mock objects created on heap and not destroyed properly.

**Resolution:**
- Ensure mocks are destroyed at end of test to trigger verification.
- Use `Mock::VerifyAndClearExpectations(&mock_object)` to force verification early.
- Use heap checkers with `gtest_main` for automatic leak detection.

---

## 4. Configuring Verbosity and Debug Output

### 4.1 Adjusting gMock Verbosity for Troubleshooting

Control the verbosity of gMockâ€™s messages at runtime:

- Use the command-line flag `--gmock_verbose=LEVEL` where `LEVEL` is:
  - `info`: log all calls, including stack traces for uninteresting calls.
  - `warning` (default): warnings and errors with less stack trace info.
  - `error`: errors only, suppressing info and warnings.

Example:
```bash
./my_test --gmock_verbose=info
```

### 4.2 Interpreting Call Matching Logs

Running tests at `info` verbosity will show which `EXPECT_CALL` matches each mock call. This helps debug argument matching and ordering problems.

---

## 5. Recommended Debugging Techniques

### Enable Stack Traces on Failures

- Use `--gtest_stack_trace_depth=N` to control how many stack frames are printed. This helps trace the origin of unexpected calls.

### Use SCOPED_TRACE for Context

- Wrap complex assertions or loops inside `SCOPED_TRACE` to annotate failures with contextual information.

### Run Tests with `--gtest_break_on_failure`

- Stops execution on first failure and allows debugger inspection.

---

## 6. How to Submit Reliable Bug Reports

If you encounter issues that seem to be bugs with GoogleTest or GoogleMock setup:

- Include your exact environment:
  - Operating system and version
  - Compiler and version
  - gTest/gMock version
- Provide a minimal reproducible example:
  - Source code demonstrating the problem
- Provide your build system setup and commands run
- Include outputs and error messages

See [How to get support or ask questions](/faq/support-community-faq/find-help-community) for community and issue tracker links.

---

## 7. Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Beginner-friendly introduction
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md): Quick syntax reference
- [Mocking Reference](docs/reference/mocking.md): Full detailed API reference
- [Installation Guide](/getting-started/prereq-install/installation-guide): Setup instructions
- [gMock FAQ](docs/gmock_faq.md): Answers to common questions

<Tip>
When encountering setup issues with mock expectations, remember to check that your mocked methods are virtual and that your `EXPECT_CALL` statements match all calls. Consider starting with simple passing mocks using `NiceMock` to suppress warnings while figuring out your real expectations.
</Tip>

<Note>
Use `Mock::VerifyAndClearExpectations()` before destroying mock objects if you suspect tests pass due to mocks not being destroyed.
</Note>

<Warning>
Strict mocks (`StrictMock`) cause tests to fail on uninteresting calls, so use them only after your expectations cover all mock calls.
</Warning>

---

## Example: Fixing an Unexpected Call Issue

Suppose your test fails because a mock method call isn't matched:

```cpp
EXPECT_CALL(mock_turtle, PenDown()).Times(1);
// Code calls mock_turtle.PenDown();
// ... but also calls mock_turtle.PenUp() without expectation!
```

Add a permissive catch-all expectation for other methods to avoid warnings:

```cpp
using ::testing::AnyNumber;
EXPECT_CALL(mock_turtle, PenUp()).Times(AnyNumber());
EXPECT_CALL(mock_turtle, PenDown()).Times(1);
```

Alternatively, wrap the mock in `NiceMock` to silence calls to uninteresting methods:

```cpp
NiceMock<MockTurtle> mock_turtle;
EXPECT_CALL(mock_turtle, PenDown()).Times(1);
```

---

## Getting Help

- Visit the [FAQ](https://github.com/google/googletest/blob/main/docs/faq.md)
- Explore the [GoogleTest Primer](primer.md) if new to testing with GoogleTest
- Join community forums or file issues on the [GitHub repository](https://github.com/google/googletest)

---

For further onboarding, see [Writing Your First Test](/getting-started/first-test-run/create-first-test) and [Building and Running Tests](/getting-started/first-test-run/run-test).


<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_for_dummies.md", "range": "1-270"},{"path": "docs/gmock_faq.md", "range": "1-300"},{"path": "docs/gmock_cheat_sheet.md", "range": "1-235"},{"path": "docs/reference/mocking.md", "range": "1-525"}]} />