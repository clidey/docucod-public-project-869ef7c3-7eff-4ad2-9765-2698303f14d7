---
title: "Troubleshooting Common Issues"
description: "Address the most frequent installation and configuration problems users might encounter. Includes error messages, causes, and actionable resolutions for a smooth onboarding experience."
---

# Troubleshooting Common Issues

This guide addresses the most frequent problems users encounter during installation, configuration, and usage of GoogleMock, helping you resolve errors quickly and maintain a smooth workflow with your mock objects.

---

## 1. Mock Method Calls Invoking Real Methods

**Symptom:** When calling a method on a mock object, the original method on the real object is called instead of the mocked one.

**Cause:** The method being mocked is not declared `virtual` in the base class.

**Resolution:**
- Ensure you mock only virtual methods.
- If you need to mock non-virtual methods, refer to the [High-Perf Dependency Injection](gmock_cook_book.md#MockingNonVirtualMethods) technique.

---

## 2. Cannot Mock Variadic Functions

**Symptom:** Attempts to mock a variadic function (with `...` arguments) fail or produce errors.

**Cause:** gMock cannot infer variadic arguments because their count and types are unknown.

**Resolution:**
- Avoid variadic functions in interfaces you want to mock.
- Provide overloaded versions of the function with explicit arguments to replace variadic ones.

---

## 3. MSVC Compiler Warnings on Const Parameters in Mock Methods

**Symptom:** Microsoft Visual C++ shows warnings C4301 or C4373 when defining mock methods with const parameters.

**Cause:** MSVC has a known bug treating top-level `const` parameters differently in overrides.

**Resolution:**
- Remove `const` qualifiers from top-level parameters in both base and mock method declarations since `const int` and `int` parameters are equivalent.
- Retain `const` qualifiers when applied to pointers or references (e.g., `const int* p`).

---

## 4. Expectations Not Satisfied

**Symptom:** Tests fail indicating that some expectations on your mocks are not met even though you believe calls were made correctly.

**Tools & Tips:**
- Run tests with the flag `--gmock_verbose=info` to get detailed call traces from gMock.
- Investigate the mismatch in arguments or call order shown in verbose output.

**Common Causes:**
- Missing or incorrect `EXPECT_CALL` specifications.
- Arguments in calls do not match expected matchers.
- Calls occur out of order when sequences are used.
- Expectations retire too early (see RetiresOnSaturation below).

---

## 5. Handling Uninteresting Calls and Warnings

**Symptom:** You see warnings like "Uninteresting mock function call - returning default value" in test output.

**Cause:** Calls are made to mock methods without corresponding `EXPECT_CALL` expectations.

**Recommendations:**
- Use `NiceMock<T>` to suppress warnings when you don’t care about some mock methods.
- Explicitly add catch-all expectations:

  ```cpp
  EXPECT_CALL(mock_object, MethodName(_)).Times(AnyNumber());
  ```

- Avoid suppressing these warnings by creating irrelevant `EXPECT_CALL`s—this leads to fragile tests.

---

## 6. Duplicate or Unexpected Failures Reported

**Symptom:** Some failed expectations are reported multiple times.

**Explanation:** gMock reports failures as they arise at different points in test execution. Duplicate-looking messages correspond to distinct failure occurrences.

**Action:** Review all failure points; they provide useful context.

---

## 7. Heap Check Failures When Using Mock Objects

**Symptom:** Heap checking tools report errors when using mock objects, but not with real objects.

**Cause:** Mock classes lack a virtual destructor.

**Resolution:**
- Always declare destructors in base classes as `virtual` to ensure proper cleanup.

```cpp
class Base {
 public:
  virtual ~Base() { /* ... */ }  // Must be virtual
  // ...
};
```

---

## 8. Writing Expectations with Ordered Return Values

**Symptom:** Expectations for multiple calls with different return values seem awkward or do not behave as expected.

**Cause:** Expectations are "sticky" by default, causing conflicts in repeated calls.

**Best Practice:**
- Use `.RetiresOnSaturation()` to retire expectations after they are satisfied.
- Use `InSequence` to enforce expected call order.

Example:

```cpp
using ::testing::InSequence;
using ::testing::Return;
{
  InSequence s;
  EXPECT_CALL(mock, Method())
      .WillOnce(Return(1))
      .RetiresOnSaturation();
  EXPECT_CALL(mock, Method())
      .WillOnce(Return(2))
      .RetiresOnSaturation();
}
```

---

## 9. Unexpected Calls Despite ON_CALL Defaults

**Symptom:** Warnings or failures when calls occur without matching `EXPECT_CALL` even though `ON_CALL` is set.

**Explanation:** `ON_CALL` specifies default behavior but **does not** set expectations. Calls not matched by any `EXPECT_CALL` are considered unexpected by default.

**Resolution:**
- If calls are expected but their number or arguments are flexible, add a catch-all `EXPECT_CALL` with `Times(AnyNumber())`.
- Adjust verbosity or use `NiceMock` if appropriate.

---

## 10. Leaked Mock Objects Detected at Program Exit

**Symptom:** Errors like `this mock object should be deleted but never is` are printed at program exit.

**Cause:** Mock objects were dynamically allocated but never deleted, so their expectations remain unverified.

**Remedies:**
- Ensure all heap-allocated mock objects are deleted properly.
- If leaking is intentional, suppress errors using:

```cpp
testing::Mock::AllowLeak(mock_object);
```

- Prefer stack allocation or smart pointers where possible to automatically clean up.

---

## Additional General Tips

- Always place `EXPECT_CALL` statements before exercising the mock method.
- Beware setting expectations after mock calls have been made; behavior is undefined.
- Use the `--gmock_verbose` flag to control the verbosity of the mock output:
  - `info` - detailed output including stack traces.
  - `warning` (default) - warnings without stack traces.
  - `error` - only errors.

---

For deeper troubleshooting and examples, see:

- [gMock FAQ](docs/gmock_faq.md)
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [Understanding Uninteresting vs Unexpected Calls](docs/gmock_cook_book.md#uninteresting-vs-unexpected)

---

## Quick Reference Table

| Symptom                                | Cause                                              | Resolution                                               |
|--------------------------------------|----------------------------------------------------|----------------------------------------------------------|
| Mock calls real method                | Method is not `virtual`                            | Declare method `virtual`                                 |
| Can't mock variadic functions         | Variadic args unsupported                          | Use overloaded functions instead                         |
| MSVC warnings on const params         | MSVC bug on top-level const                        | Remove top-level `const` qualifiers                      |
| Expectations not met                   | Mismatched args or ordering                         | Use `--gmock_verbose=info` and check matchers           |
| Uninteresting call warnings           | Method called without `EXPECT_CALL`                | Use `NiceMock` or add catch-all `EXPECT_CALL(...).Times(AnyNumber())` |
| Leaked mocks at exit                   | Dynamically allocated mocks not deleted            | Delete mocks or `Mock::AllowLeak()`                      |

---

## Troubleshooting Common Error Messages

### "Uninteresting mock function call - returning default value"

This warning means your mock method was called but no expectation (`EXPECT_CALL`) was set for it.

**What to do:**
- Add an `EXPECT_CALL` with `Times(AnyNumber())` if the method can be called but you don't care how many times.
- Suppress warnings by using `NiceMock` mocks.

### "Unexpected mock function call"

This error means your code called a mock method in a way not matched by any `EXPECT_CALL`.

**What to do:** 
- Add or fix `EXPECT_CALL` statements with correct matchers.
- Verify call order and argument values.

### "Mock function called more times than expected"

Your `EXPECT_CALL` specified a cardinality that was exceeded.

**What to do:**
- Adjust `Times()` to allow more calls.
- Use `.RetiresOnSaturation()` to retire expectations after use.

### "too few actions specified in EXPECT_CALL"

There are fewer actions provided (via `WillOnce`) than expected calls.

**What to do:**
- Add more `WillOnce` actions or use `WillRepeatedly` for behavior after the initial calls.

### "leaked mock objects"

Some mocks weren't deleted, and their expectations won't be verified.

**What to do:**
- Delete all heap-allocated mocks explicitly.
- Use smart pointers or stack allocation.
- Use `testing::Mock::AllowLeak()` if leaking is intentional.

---

## Useful Troubleshooting Commands

Run tests with increased verbosity:

```bash
./your_test_binary --gmock_verbose=info
```

Enable heap checking to detect leaks (depending on your environment):

```bash
valgrind --leak-check=full ./your_test_binary
```

---

## Where to Get More Help

- [gMock Cookbook](docs/gmock_cook_book.md): Practical recipes and advanced usage.
- [gMock FAQ](docs/gmock_faq.md): Detailed answers to frequent mock questions.
- [GoogleTest Primer](guides/getting-started/primer-basics): For understanding basic testing concepts.

---

For a guided setup and usage, refer to the [Project Setup & Configuration](getting-started/configuration-first-use/project-setup.mdx) page, then proceed to write your first tests following [Write and Run Your First Test](getting-started/configuration-first-use/write-and-run-first-test.mdx).