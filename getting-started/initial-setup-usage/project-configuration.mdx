---
title: "Configuring Your Project"
description: "Learn how to add GoogleTest and GoogleMock to your CMake or Bazel project. This page details configuration best practices and troubleshooting build issues, enabling reliable integration with your existing codebase."
---

# Configuring Your Project

Learn how to add GoogleTest and GoogleMock to your CMake or Bazel project. This guide walks you through practical configuration steps, best practices, and troubleshooting tips to integrate Google's C++ testing frameworks reliably into your existing codebase.

---

## 1. Prerequisites

Before configuring your project, ensure the following prerequisites are fulfilled:

- **C++ Compiler**: Support for C++17 or later (GCC 7.1+, Clang 5.0+, MSVC 2015 Update 3+).
- **Build System**: CMake 3.13+ is recommended for integration. Bazel users need to add the appropriate `BUILD` file entries referencing GoogleTest/GoogleMock.
- **Threading Support**: Pthread support is recommended for thread-safe tests; GoogleTest auto-detects this but you can explicitly enable or disable it.

<Tip>
Configuring GoogleTest with `-DGTEST_HAS_PTHREAD=1` enables thread-safe test runs where pthread is available. If using custom build setups or targeting systems without pthread, explicitly disable it to avoid build failures.
</Tip>

## 2. Adding GoogleTest and GoogleMock in CMake

GoogleTest comes with community-based CMake support. Including it in your CMake project requires either linking to an installed version or embedding the source.

### 2.1. Using Installed GoogleTest Libraries

If you have installed GoogleTest (e.g., system-wide or via manual build), you can use `find_package` or `pkg-config` to link libraries.

#### Using `find_package`

Add the following to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test test/example_test.cpp)
target_link_libraries(your_test PRIVATE GTest::gtest_main)
enable_testing()
add_test(NAME your_test COMMAND your_test)
```

This approach ensures you link to the installed GoogleTest and GoogleMock libraries with correct compiler flags.

#### Using `pkg-config` (alternative)

For projects using pkg-config,

```cmake
find_package(PkgConfig REQUIRED)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(your_test test/example_test.cpp)
target_link_libraries(your_test PRIVATE ${GTEST_LDFLAGS})
target_compile_options(your_test PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(NAME your_test COMMAND your_test)
```

<Tip>
If pkg-config does not find `gtest_main`, ensure the environment variable `PKG_CONFIG_PATH` includes the directory containing GoogleTest's `.pc` files (e.g., `/usr/local/lib/pkgconfig`).
</Tip>

### 2.2. Integrating GoogleTest as a Subdirectory

A robust approach is to add GoogleTest source as a subdirectory in your project, which allows consistent compiler and linker settings.

Example flow:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
# For Windows: prevent overriding parent project's runtime settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(your_test test/example_test.cpp)
target_link_libraries(your_test PRIVATE gtest_main)
enable_testing()
add_test(NAME your_test COMMAND your_test)
```

This fetches GoogleTest during configuration and builds it alongside your code.

### 2.3. CMake Options to Control Builds

GoogleTest provides several CMake options to tailor the build:

| Option                | Description                                                           | Default |
|-----------------------|-----------------------------------------------------------------------|---------|
| `BUILD_GMOCK`         | Build GoogleMock along with GoogleTest                                | ON      |
| `INSTALL_GTEST`       | Enable installation of GoogleTest libraries and headers              | ON      |
| `gtest_force_shared_crt` | Use shared runtime library on Windows (align with your project)      | OFF     |
| `gtest_disable_pthreads` | Disable pthread support in GoogleTest                               | OFF     |

Set options during CMake configure step, e.g.: 

```bash
cmake -DBUILD_GMOCK=ON -Dgtest_force_shared_crt=ON ..
```

<Tip>
If your Windows build complains about mismatched runtime libraries (errors like `LNK2038: mismatch detected for 'RuntimeLibrary'`), set `gtest_force_shared_crt` to ON to align GoogleTest with your project's runtime linkage.
</Tip>

## 3. Key Configuration Details

### 3.1. Compiler and Linker Flags

GoogleTest configures compiler and linker flags automatically to match its internal needs. These include:

- Enforcing C++17 standard.
- Setting warning levels more strictly than defaults.
- Adjusting runtime library linkage for static vs dynamic builds.
- Defining macros like `GTEST_HAS_PTHREAD` to enable thread-safety.

If you embed GoogleTest as a subdirectory, these settings are managed for you. When linking installed libraries, rely on CMake package config or pkg-config to provide these flags.

### 3.2. Linking GoogleMock

GoogleMock depends on GoogleTest and is already built when you build GoogleMock.

- Link your tests to `gmock_main` if you want GoogleMock's main function.
- Alternatively, link against `gtest_main` if you only use GoogleTest.

Example:

```cmake
target_link_libraries(your_test PRIVATE gmock_main)
```

### 3.3. Installation Considerations

If you install GoogleTest and GoogleMock, their headers and pkg-config files should be installed to standard locations (e.g., `/usr/local/include` for headers, `/usr/local/lib/pkgconfig` for `.pc` files).

- You can toggle installation with `INSTALL_GTEST` CMake option.
- Ensure your system's `PKG_CONFIG_PATH` includes the install directory for pkg-config recognition.

## 4. Troubleshooting Build and Integration Issues

### Problem: `pkg-config` cannot find GoogleTest

**Symptoms:**

```text
CMake Error: None of the required 'gtest_main' found
```

**Solutions:**

- Ensure you installed GoogleTest with pkg-config files.
- Set `PKG_CONFIG_PATH` environment variable:

```bash
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig
```

- For cross-compilation, also set:

```bash
export PKG_CONFIG_SYSROOT_DIR=/path/to/sysroot
export PKG_CONFIG_LIBDIR=${PKG_CONFIG_SYSROOT_DIR}/usr/lib/pkgconfig
```

### Problem: Runtime library mismatch on Windows (MSVC linker errors)

**Symptoms:** Link errors with messages like

```text
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

**Solutions:**

- Enable `gtest_force_shared_crt` in CMake:

```bash
cmake -Dgtest_force_shared_crt=ON ..
```

- Rebuild GoogleTest and your project to use the same runtime linkage.

### Problem: Tests not found or not running

- Ensure you call `RUN_ALL_TESTS()` in your `main` function or link against `gtest_main` / `gmock_main` which provide a main function:

Example main from GoogleMock:

```cpp
#include "gmock/gmock.h"
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Problem: Missing pthread flags on Linux

- When building with your own scripts, add `-pthread` to both compile and link flags.
- Using provided CMake scripts or pkg-config will automatically add these.

## 5. Running Your First Operation

Once integrated, you can write test files and build your test binary with GoogleTest or GoogleMock linked.

### Step-by-step example:

1. Create a test source file `example_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SimpleTest, Addition) {
  EXPECT_EQ(2 + 2, 4);
}
```

2. Add a target in your `CMakeLists.txt`:

```cmake
add_executable(example_test example_test.cpp)
target_link_libraries(example_test PRIVATE gtest_main)
enable_testing()
add_test(NAME example_test COMMAND example_test)
```

3. Build your project:

```bash
cmake -S . -B build
cmake --build build
```

4. Run your tests:

```bash
./build/example_test
```

You should see output indicating tests ran and their status.

## 6. Best Practices & Tips

- Prefer integrating GoogleTest source under your build tree to avoid ABI and configuration mismatches.
- Always build with the same compiler settings as your application to ensure compatibility.
- Use `gtest_force_shared_crt` on Windows if you encounter runtime linkage errors.
- Use `pkg-config` variables (`GTEST_CFLAGS`, `GTEST_LDFLAGS`) to safely obtain compile and link flags.
- For cross-platform projects, automated fetching with CMake's `FetchContent` keeps your dependencies consistent.

## 7. Additional Resources

- [GoogleTest README](https://github.com/google/googletest/blob/main/README.md) for detailed build instructions.
- [GoogleTest pkg-config details](docs/pkgconfig.md) for advanced library flag management.
- [Troubleshooting Installation and Build Issues](/getting-started/troubleshooting-faq/common-install-issues) for common build problems.
- [Writing and Running Your First Test](/getting-started/initial-setup-usage/writing-first-test) to learn test creation.
- [GoogleMock Main Function Details](googlemock/src/gmock_main.cc) for understanding default test runner implementations.

---

This concludes your guide to configuring GoogleTest and GoogleMock in your CMake or Bazel project, ensuring a smooth integration for C++ testing.

---

## FAQ

> **Q:** Can I build only GoogleTest without GoogleMock?

> **A:** Yes, add `-DBUILD_GMOCK=OFF` during the CMake configure step.

> **Q:** How do I link to GoogleMock's main function?

> **A:** Link your test binary against `gmock_main` instead of `gtest_main`.

> **Q:** What C++ standard is required?

> **A:** C++17 or later is required for all GoogleTest builds.

<Tip>
Make sure your build environment satisfies C++17 and threading requirements for optimal compatibility.
</Tip>

<Warning>
Running tests on Windows may require careful handling of runtime library linkage. Use `gtest_force_shared_crt=ON` to prevent linker errors.
</Warning>

<Info>
For projects using Bazel, see corresponding build file configurations to include `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock`.
</Info>

---

{/* End of Configuring Your Project */}