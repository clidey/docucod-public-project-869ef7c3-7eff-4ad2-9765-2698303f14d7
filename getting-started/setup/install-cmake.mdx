---
title: "Installation with CMake"
description: "Provide step-by-step instructions for installing and integrating GoogleTest into C++ projects using CMake, including fetching, building, and linking practices. Highlight key configuration patterns and common pitfalls."
---

# Installation with CMake

This guide walks you through installing and integrating GoogleTest into your C++ project using CMake. You will learn how to fetch the source, build GoogleTest along with GoogleMock, link the libraries, and configure your project for successful testing. Along the way, you'll find tips on configuration patterns and guidance to avoid common pitfalls.

---

## 1. Prerequisites

Before starting, ensure you meet the following requirements:

- **CMake Version:** 3.16 or later (required for full FetchContent support and recommended minimum for GoogleTest build).
- **C++ Compiler:** Supports C++17 standard (e.g., GCC 7+, Clang 5+, MSVC 2017+).
- **Git:** To clone the GoogleTest repository if fetching manually.
- **System Requirements:** Compatible OS such as Linux, Mac OS, or Windows.

<Tip>
Setting `CMAKE_CXX_STANDARD` to 17 in your project ensures consistent C++17 usage required by GoogleTest.
</Tip>

---

## 2. Cloning and Building GoogleTest as a Standalone Project

This approach builds GoogleTest separately before using it in projects.

### Step 1: Clone the GoogleTest Repository

```bash
git clone https://github.com/google/googletest.git -b main
directory_name=googletest
cd $directory_name
```

### Step 2: Create and Enter a Build Directory

```bash
mkdir build
cd build
```

### Step 3: Configure the Build with CMake

By default, this includes GoogleMock. To build only GoogleTest, add `-DBUILD_GMOCK=OFF`.

```bash
cmake .. 
# Or for only GoogleTest:
# cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Build the Libraries

On Linux/macOS:

```bash
make
```

On Windows (Visual Studio generated project):
- Open the generated `.sln` file in Visual Studio and build the solution.

### Step 5 (Optional): Install the Libraries

If you want GoogleTest and GoogleMock installed system-wide:

```bash
sudo make install
```

This installs GoogleTest headers and libraries typically under `/usr/local`.

<Note>
Building/downloaded GoogleTest includes GoogleMock by default. Set `-DBUILD_GMOCK=OFF` if GoogleMock is not needed.
</Note>

---

## 3. Integrating GoogleTest into Your Existing CMake Project

The recommended approach is to add GoogleTest as a build dependency directly.

### Option A: Use `FetchContent` to Download and Build GoogleTest Automatically

Add this snippet to the top of your `CMakeLists.txt` before your targets:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# Prevent GoogleTest from overriding your runtime library settings on Windows.
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Example: Linking your test executable
add_executable(example_test example_test.cpp)
target_link_libraries(example_test gtest_main)
add_test(NAME example_test COMMAND example_test)
```

This approach ensures GoogleTest is downloaded and built at configure time, with no manual cloning.

<Tip>
Update the URL to point to the desired commit or release tag to ensure reproducible builds.
</Tip>

### Option B: Add GoogleTest as a Git Submodule or Locally Added Directory

Alternatively, you can include GoogleTest source into your project repository:

- Add GoogleTest as a git submodule
- Use `add_subdirectory(googletest)` within your `CMakeLists.txt`

Then link your test targets against `gtest` or `gtest_main` as usual.

---

## 4. Key CMake Configuration Patterns and Practices

### Enable Testing and Add Tests

Be sure to enable testing support and add your test executable as shown:

```cmake
enable_testing()
add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest_main)
add_test(NAME MyTests COMMAND my_tests)
```

### Link Libraries Correctly

- Use `gtest` if you want to provide your own main.
- Use `gtest_main` to use GoogleTest-defined main function.

Example:

```cmake
target_link_libraries(my_tests PRIVATE gtest_main)
```

### Set C++ Standard

Set the C++ standard explicitly to C++17 or higher:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

This ensures consistent compilation flags.

<Warning>
For Visual Studio users, GoogleTest links the C runtime statically by default, which may conflict with your project settings causing LNK2038 errors. Use:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This forces GoogleTest to use dynamic CRT linking, matching Visual Studio defaults.
</Warning>

### Pthreads and Threading Support

- GoogleTest detects pthread support automatically.
- No special action needed in CMake; the build scripts handle linking.

---

## 5. Common Pitfalls and How to Avoid Them

### 1. Runtime Library Mismatches on Windows

Mismatch of static vs dynamic CRT can cause linking errors.

<Solution>
Set `gtest_force_shared_crt` to `ON` when building or integrating GoogleTest.
</Solution>

### 2. C++ Standard Compatibility Issues

Ensure your project uses C++17 or newer to avoid compilation errors due to language features.

### 3. Missing Includes or Link Errors

- When manually adding GoogleTest, make sure include directories are accessible.
- Link explicitly against `gtest` or `gtest_main`.

### 4. Build Failures Due to Unsupported CMake Versions

<Warning>
GoogleTest requires CMake 3.16 or above for the best FetchContent support. Using older versions may break the build.
</Warning>

---

## 6. Verification: Running Your First GoogleTest Build

Once setup is done, confirm by building and running a simple test.

### Sample `example_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, Truth) {
  EXPECT_TRUE(true);
}

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Build and Run

```bash
mkdir build
cd build
cmake .. 
make
./example_test
```

Expected output:

```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from SampleTest
[ RUN      ] SampleTest.Truth
[       OK ] SampleTest.Truth (0 ms)
[----------] 1 test from SampleTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

---

## 7. Additional Tips and Advanced Usage

- You can disable GoogleMock if only GoogleTest is needed by configuring with `-DBUILD_GMOCK=OFF`.
- For embedded or CI systems, consider vendoring GoogleTest source or using submodules to reduce external dependencies.
- Use `FetchContent_MakeAvailable` for seamless integration and automatic updates.
- Customize build flags and options via CMake variables (`gtest_build_tests` for building GoogleTest tests, `BUILD_SHARED_LIBS`, etc.).

---

## 8. Troubleshooting Common Issues

<AccordionGroup title="Common Issues and Resolutions">
<Accordion title="Linker error LNK2038 on Visual Studio">

**Cause**: Runtime library mismatch between GoogleTest static libraries and your project's dynamic runtime.

**Solution**:
- Add the following to your CMake file:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
- Rebuild GoogleTest.

</Accordion>
<Accordion title="GoogleTest not found by find_package() or pkg-config">

**Cause**: GoogleTest is not installed system-wide or pkg-config paths missing.

**Solution**:
- Make sure GoogleTest is installed (`sudo make install` after building).
- Set `PKG_CONFIG_PATH` to the pkgconfig directory where GoogleTest `.pc` files are installed.
- Alternatively, use `FetchContent` to embed GoogleTest instead of relying on system installation.

</Accordion>
<Accordion title="Build fails due to older CMake version">

**Cause**: GoogleTest requires at least CMake 3.16 for recommended integration methods.

**Solution**:
- Upgrade your CMake to version 3.16 or above.
- Alternatively, fallback to manually cloning and building GoogleTest.

</Accordion>
</AccordionGroup>

---

## 9. Next Steps and Related Documentation

- Proceed to [Configuring Your Test Project](/getting-started/configuration/configuring-test-project) to set up test files and build integration.
- Learn [Building and Running Your First Test](/getting-started/configuration/running-tests) for full test execution flow.
- For troubleshooting, consult [Quick Validation and Troubleshooting](/getting-started/configuration/validating-setup).
- Explore the [Feature Summary](/overview/features-workflows/feature-summary) to understand capabilities.
- Reference the official [GoogleTest GitHub Repository](https://github.com/google/googletest) for latest updates and examples.

---

This completes the step-by-step guide to installing and integrating GoogleTest using CMake.


---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path":"googletest/README.md","range":"1-156"},{"path":"googletest/CMakeLists.txt","range":"1-180"},{"path":"googlemock/CMakeLists.txt","range":"1-147"}]} />
