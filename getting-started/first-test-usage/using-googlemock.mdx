---
title: "Getting Started with GoogleMock"
description: "Learn how to add a simple mock and assertion using GoogleMock, demonstrating powerful test doubles for C++ code."
---

# Getting Started with GoogleMock

Learn how to add a simple mock and assertion using GoogleMock, demonstrating powerful test doubles for C++ code.

---

## 1. Introduction to GoogleMock

GoogleMock (gMock) is a powerful C++ framework for creating mock classes used in unit tests. Mock objects can simulate interactions, verify expected calls, and specify behaviors, enabling thorough testing of complex systems with dependencies.

This guide walks you through the essential steps to create a simple mock class, set expectations, invoke mocked methods, and verify interactions.

---

## 2. Prerequisites & Setup

Before you begin, ensure you have:

- A working GoogleTest and GoogleMock environment. GoogleMock ships with GoogleTest.
- Include path configured to reference `<gmock/gmock.h>`
- Basic familiarity with C++ and unit testing concepts

> If you have not set up GoogleTest and GoogleMock, refer to the [Installation and Setup](https://google.github.io/googletest/guides/getting-started.html) guide.

---

## 3. Writing Your First Mock Class

A mock class mimics an interface or class to be tested. Here's how to write one using GoogleMock:

### Step 1: Define an interface or base class

This class should contain virtual methods you want to mock. For example:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

### Step 2: Create a mock class inheriting the interface

Use the `MOCK_METHOD` macro to mock each virtual method. Place mocks in the `public:` section to make them accessible for expectations.

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Notes:

- Use `(override)` to mark the method as overriding a virtual method.
- Use `(const, override)` for const-qualified methods.
- The macro accepts return type, method name, and argument list.

---

## 4. Setting Up Expectations and Default Actions

GoogleMock provides two primary macros and concepts:

- `ON_CALL` - Defines default actions (without expectations)
- `EXPECT_CALL` - Sets expectations on mocked calls

### Basic `ON_CALL` Usage

Specify the behavior of a mock method when it is called, without enforcing call count.

```cpp
MockTurtle turtle;
ON_CALL(turtle, GetX()).WillByDefault(testing::Return(42));
```

### Basic `EXPECT_CALL` Usage

Set expectations on how many times a method should be called and what to return.

```cpp
EXPECT_CALL(turtle, PenDown()).Times(1);
EXPECT_CALL(turtle, Forward(testing::_)).Times(testing::AtLeast(1));
EXPECT_CALL(turtle, GetX()).WillOnce(testing::Return(100));
```

- Use matchers like `_` to match any value.
- Use cardinality clauses like `Times(n)`, `AtLeast(n)`, `AnyNumber()` to specify call counts.

### Combining with Actions

You can chain multiple actions to specify return values or side-effects.

```cpp
EXPECT_CALL(turtle, Forward(_))
    .WillOnce(testing::Invoke([](int distance) {
        std::cout << "Moving " << distance << " units." << std::endl;
    }));
```

---

## 5. Running and Verifying Your First Mocked Operation

Here's a simple example illustrating usage:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::_;
using ::testing::Return;
using ::testing::AtLeast;

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Test that turtle moves forward at least once and pen goes down
TEST(PaintTest, DrawsLine) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown()).Times(1);
  EXPECT_CALL(turtle, Forward(_)).Times(AtLeast(1));
  ON_CALL(turtle, GetX()).WillByDefault(Return(10));

  // Code under test uses turtle mock
  turtle.PenDown();
  turtle.Forward(100);
  int pos = turtle.GetX();

  EXPECT_EQ(pos, 10);
}
```

### Expected Outcome

- The `PenDown()` method must be called exactly once.
- The `Forward()` method must be called at least once with any integer.
- The mocked `GetX()` returns 10.
- If any expectation is violated, the test fails immediately with detailed error messages.

---

## 6. Practical Tips and Best Practices

- Put `MOCK_METHOD` in the `public:` section, regardless of original access modifiers.
- Use matchers like `_` if you don't care about specific argument values.
- Use `ON_CALL` for default behavior and `EXPECT_CALL` to verify actual calls.
- Chain `.WillOnce()` and `.WillRepeatedly()` to define sequences of behaviors.
- Use `.RetiresOnSaturation()` when you want expectations to stop matching after upper bounds.
- For overloaded methods, specify full signature in `MOCK_METHOD` and disambiguate expectations with matchers or using helper functions.
- Use `NiceMock` to suppress warnings on uninteresting calls.
- Use `StrictMock` to fail on uninteresting calls, helping detect unintended interactions.

---

## 7. Common Pitfalls and Troubleshooting

### Issue: Uninteresting Mock Function Call Warnings

If a method is called on a mock but no `EXPECT_CALL` matches it, gMock issues a warning. To address:
- Use `NiceMock<YourMock>` to suppress warnings.
- Add a catch-all expectation with `.Times(AnyNumber())` if uninteresting calls are allowed.

### Issue: Unexpected Call Failures

If a call doesn't match any `EXPECT_CALL`, it results in test failure. To fix:
- Verify that your expectations match the argument values.
- Add appropriate matchers or relax expectations.

### Issue: Mock Methods Not Called

If your test fails with "expected call never happened":
- Ensure the system under test is correctly using the mock.
- Make sure expectations are set before the system code runs.

### Issue: Compiling Errors with Commas in Method Signatures

When signatures contain commas (e.g., templated types), wrap the type in additional parentheses or use type aliases:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

---

## 8. Next Steps

- Explore [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes.
- Learn about matchers and how to combine them for expressive expectations.
- Familiarize yourself with [NiceMock, NaggyMock, StrictMock](https://google.github.io/googletest/gmock_nice_strict.html) for controlling mock behavior.
- Dive into actions for customizing how mocks behave on method calls.
- Consult the [API Reference](https://google.github.io/googletest/reference/mocking.html) for detailed macro, class, and function documentation.

---

## 9. Reference Material

- `#include <gmock/gmock.h>` — Main GoogleMock header to include
- [`MOCK_METHOD`](https://google.github.io/googletest/reference/mocking.html#MOCK_METHOD) — Macro to define mocked methods
- [`EXPECT_CALL`](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL) — Expectation setting macro
- [`ON_CALL`](https://google.github.io/googletest/reference/mocking.html#ON_CALL) — To set default behaviors
- [Matchers](https://google.github.io/googletest/reference/matchers.html) — For argument matching
- [Actions](https://google.github.io/googletest/reference/actions.html) — For specifying mock method behaviors

---

## 10. Additional Example: Mocking a Class with Const and Overloaded Methods

```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int Add(int x) = 0;
  virtual int Add(int x, int y) = 0;
  virtual int GetValue() const = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int x, int y), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
};

TEST(ExampleTest, MockOverloadedAndConst) {
  MockFoo mock;

  // Expect Add(int) to be called with any int.
  EXPECT_CALL(mock, Add(_)).WillRepeatedly(Return(5));

  // Expect Add(int, int) to be called with specific args.
  EXPECT_CALL(mock, Add(3, 4)).WillOnce(Return(7));

  // Expect GetValue() const method.
  ON_CALL(mock, GetValue()).WillByDefault(Return(10));

  EXPECT_EQ(mock.Add(1), 5);
  EXPECT_EQ(mock.Add(3, 4), 7);
  EXPECT_EQ(mock.GetValue(), 10);
}
```

---

## 11. Summary

You have learned to:

- Define mock classes with `MOCK_METHOD`
- Set default behaviors with `ON_CALL`
- Set expectations with `EXPECT_CALL`
- Use matchers and cardinality to verify interactions
- Handle overloaded and const methods
- Write tests that verify behavior through mocks

This foundation enables powerful, maintainable, and expressive unit tests in C++.


<Check>
Make sure you set expectations before the tested code exercises the mock.
Use matchers to be precise about arguments or `_` as a wildcard.
Set default actions with `ON_CALL` to handle uninteresting calls gracefully.
</Check>

---

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Issue: Mocked Method Not Called">
Ensure the system under test is using the mock object correctly.
Also, confirm expectations are set before exercising the code.
</Accordion>
<Accordion title="Issue: Compile Errors with Commas in Signatures">
Wrap template return or argument types containing commas with extra parentheses or use type aliases.
</Accordion>
<Accordion title="Issue: Unexpected Calls in Tests">
Relax matchers in `EXPECT_CALL`, or add a catch-all `EXPECT_CALL(mock, method(_)).Times(AnyNumber())`.
</Accordion>
</AccordionGroup>

---

<Info>
See the official GoogleMock documentation at https://google.github.io/googletest/gmock_for_dummies.html and the gMock Cookbook for in-depth examples and advanced techniques.
</Info>

---

## Source Code Reference

To see GoogleMock source files relevant to mocking expectations and default actions, visit:

- [spec builders header](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-spec-builders.h)
- [spec builders implementation](https://github.com/google/googletest/blob/main/googlemock/src/gmock-spec-builders.cc)

These files implement the core ON_CALL and EXPECT_CALL logic.


---