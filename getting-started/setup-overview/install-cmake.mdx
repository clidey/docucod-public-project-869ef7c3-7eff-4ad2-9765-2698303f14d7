---
title: "Installing with CMake"
description: "Step-by-step instructions for building and integrating GoogleTest using CMake. Includes fetching the source, configuring with CMake, building, and adding GoogleTest to existing projects, with practical commands and validation tips."
---

# Installing with CMake

This guide provides you with step-by-step instructions to build and integrate GoogleTest using CMake. Whether you want to build GoogleTest as a standalone project or incorporate it directly into your existing CMake build, this guide walks you through fetching the source, configuring the build, compiling, installing, and linking GoogleTest smoothly.

---

## 1. Prerequisites & System Requirements

Before you start, ensure the following prerequisites are met:

- **Operating System:** Linux, Windows, or macOS.
- **C++ Compiler:** Must support at least C++17 standard (e.g., GCC 7+, Clang 5+, MSVC 2017+).
- **CMake Version:** Minimum 3.14 for modern FetchContent support; 3.16 or later recommended.
- **Build tools:** Compatible build system like Make, Ninja, or Visual Studio.

<Tip>
GoogleTest requires C++17 features. Make sure your compiler is configured accordingly.
</Tip>

---

## 2. Building GoogleTest as a Standalone Project

### Step 1: Clone the GoogleTest Repository

Download the latest stable release of GoogleTest from GitHub.

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
```

### Step 2: Create a Build Directory

It's best practice to separate source and build files.

```bash
mkdir build && cd build
```

### Step 3: Configure the Project with CMake

By default, GoogleMock (which includes GoogleTest) is built.

```bash
cmake ..
```

If you want to build only GoogleTest (without GoogleMock), disable it explicitly:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Build the Libraries

On *nix systems:

```bash
make
```

On Windows with Visual Studio:
Open `googletest.sln` and build the solution.

### Step 5: (Optional) Install the Libraries

If you have administrator privileges and want to install GoogleTest system-wide:

```bash
sudo make install
```

By default, this installs headers to `/usr/local/include` and libraries to `/usr/local/lib`.

<Warning>
If you plan to embed GoogleTest in your project directly, consider disabling installation (`-DINSTALL_GTEST=OFF`) to avoid conflicts.
</Warning>

---

## 3. Incorporating GoogleTest into an Existing CMake Project

You have two primary ways to integrate GoogleTest into your project.

### Option A: Use Installed GoogleTest via `find_package`

If GoogleTest is installed on your system (using the steps above), add this to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

<Tip>
Ensure that your `PKG_CONFIG_PATH` and environment variables include the paths where GoogleTest's `.pc` files and CMake config files are installed.
</Tip>

### Option B: Build GoogleTest as Part of Your Project Using `add_subdirectory()`

This method ensures GoogleTest compiles with the same compiler and linker settings as your project, reducing incompatibility issues.

1. Download GoogleTest source into your project tree or add it as a Git submodule.
2. Add to your `CMakeLists.txt`:

```cmake
add_subdirectory(path/to/googletest)

add_executable(my_tests test.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

<Tip>
This approach is ideal for continuous integration where dependencies are managed centrally.
</Tip>

---

## 4. Fetching GoogleTest Automatically Using CMake's FetchContent

For a fully automated setup, you can declare GoogleTest as a dependency directly in your `CMakeLists.txt`.

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)

# On Windows, prevent overriding compiler/linker settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

<Tip>
Replace the URL with the commit hash or release tag you prefer. Updating it regularly ensures you have the latest fixes.
</Tip>

---

## 5. Building and Running Your First Test with CMake

### Example: Simple Test Setup

In your project directory, create `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

Add the following to your `CMakeLists.txt` (if not already present):

```cmake
enable_testing()

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test PRIVATE gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

### Build and Run

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

Expected Output:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

Congratulations! Your GoogleTest setup with CMake is functioning correctly.

---

## 6. Important Configuration Options & Tips

- **Dynamic vs Static Runtimes on Windows:**
  Visual Studio defaults to dynamic CRTs, but GoogleTest links statically by default, possibly causing LNK2038 errors.

  Fix this by setting in your CMakeLists:

  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```

- **Build Shared Libraries:**
  To build GoogleTest and GoogleMock as shared libraries (DLLs), configure:

  ```bash
  cmake .. -DBUILD_SHARED_LIBS=ON
  ```

- **Multi-threading Support:**

  GoogleTest uses pthreads where available and sets `GTEST_HAS_PTHREAD` accordingly. If detection fails, force it by adding compile definitions:

  ```cmake
  add_compile_definitions(GTEST_HAS_PTHREAD=1)
  ```

- **Avoiding Macro Name Conflicts:**
  If macro names from GoogleTest conflict with your code or other libraries, disable defining conflicting macros by:

  ```cmake
  add_compile_definitions(DGTEST_DONT_DEFINE_TEST=1)
  ```

  Afterwards, you must use the prefixed macro names like `GTEST_TEST` instead of `TEST`.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Installation Issues and Solutions">
<Accordion title="CMake cannot find GoogleTest after installation">
Check that your systemâ€™s `PKG_CONFIG_PATH` or CMake module path includes the directory where GoogleTest installs its config files (commonly `/usr/local/lib/pkgconfig` or `/usr/local/lib64/pkgconfig`). Set environment variables if necessary:

```bash
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH
```

For CMake, ensure `find_package(GTest CONFIG REQUIRED)` is directed to the correct location by modifying `CMAKE_PREFIX_PATH`:

```bash
cmake -DCMAKE_PREFIX_PATH=/usr/local ..
```

</Accordion>
<Accordion title="RuntimeLibrary mismatch errors on Windows">
If you encounter linker errors about mismatched runtime libraries (`MTd` vs `MDd`), enable shared CRT linkage by adding this CMake flag:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

Then reconfigure and rebuild your project.
</Accordion>
<Accordion title="Tests not discovered or running during ctest">
Make sure you called `enable_testing()` and used `gtest_discover_tests()` after adding your test executable.

Example:

```cmake
enable_testing()
include(GoogleTest)
gtest_discover_tests(my_test_executable)
```

Also verify your test executable runs standalone without errors.
</Accordion>
</AccordionGroup>

---

## 8. Additional Resources & Next Steps

- [GoogleTest Primer](primer.md): Learn how to write effective tests.
- [Quickstart CMake Guide](docs/quickstart-cmake.md): Step-by-step beginner tutorial.
- [Using GoogleMock](gmock-for-dummies.md): Extend your testing with mocks.
- For advanced build strategies or Bazel users, see [Installing with Bazel](getting-started/setup-overview/install-bazel).

---

Empowered with this guide, you can confidently build and integrate GoogleTest into your C++ projects using CMake, ensuring a robust testing environment that scales with your development needs.

For issues or customized scenarios, consult the official [GoogleTest GitHub repository](https://github.com/google/googletest) and community discussions for the latest updates and support.