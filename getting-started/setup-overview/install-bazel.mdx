---
title: "Installing with Bazel"
description: "Covers using Bazel to set up and build GoogleTest projects, referencing WORKSPACE and BUILD files. Walks users through project structure and provides sample commands to compile and run tests with Bazel."
---

# Installing with Bazel

This guide walks you through setting up and building GoogleTest projects using Bazel, Google's fast build system. Bazel manages your project dependencies, build rules, and test execution, providing a reproducible and scalable way to compile and run your C++ tests with GoogleTest and GoogleMock.

---

## 1. Prerequisites & Environment Setup

Before you begin, ensure your system meets the following requirements:

- **Operating System:** Linux, macOS, Windows
- **C++ Compiler:** Supports at least C++17 standard
- **Bazel:** Version 7.0 or higher installed on your machine. If Bazel is not installed, see the [Bazel Installation Guide](https://bazel.build/install).

> Bazel leverages BUILD files and a WORKSPACE file at the project root to manage dependencies and build rules.

---

## 2. Setting Up Your Bazel Workspace

To integrate GoogleTest into your Bazel project, you'll set up a workspace that declares the dependencies and build targets.

### Step 1: Create a New Workspace Directory

```sh
$ mkdir my_workspace && cd my_workspace
```

### Step 2: Create the `MODULE.bazel` File

Bazel uses this file to manage dependencies (Bzl modules). Add the following content to declare the googletest dependency:

```python
# MODULE.bazel

# Specify the googletest version from Bazel Central Registry
bazel_dep(name = "googletest", version = "1.17.0")
```

This method uses Bazel's Central Registry for managing dependencies and allows easy versioning and upgrades.

### Step 3: Create the `WORKSPACE` File

If not already present, create a `WORKSPACE` file to load necessary Bazel rules and manage external dependencies. A minimal `WORKSPACE` referencing GoogleTest is already handled with the above `MODULE.bazel`. Additional rules such as Python support and platform definitions are often included (see the provided `WORKSPACE` content in the GoogleTest repository).

> **Tip:** The GoogleTest project repository includes a comprehensive `WORKSPACE` with dependencies like `rules_python` and platform configuration. You can use or adapt it as needed.

---

## 3. Declaring Build Targets in `BUILD` Files

Bazel uses `BUILD` files to declare how different components are built.

### Example: Simple Test Target

Create a `BUILD` file in your workspace directory with the following content:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

This rule defines a test binary named `hello_test`:

- `srcs` specifies source files for the test.
- `deps` links against GoogleTest's core library and its main() function provided by `gtest_main`.

### Incorporating GoogleMock Tests

If your test source uses GoogleMock, your `BUILD` file might depend on additional targets similarly defined in the GoogleMock `BUILD.bazel`:

```python
cc_test(
    name = "my_gmock_test",
    srcs = ["my_gmock_test.cc"],
    deps = ["@googletest//:gmock_main"],
)
```

The GoogleMock target `gmock_main` includes GoogleTest and the GoogleMock extensions.

---

## 4. Writing a Sample Test Source File

Create a file `hello_test.cc` in your workspace directory:

```cpp
#include <gtest/gtest.h>

// A simple test case demonstrating basic assertions
TEST(HelloTest, BasicAssertions) {
  // Check that two strings are not equal
  EXPECT_STRNE("hello", "world");
  // Check that an arithmetic expression equals 42
  EXPECT_EQ(7 * 6, 42);
}
```

This example uses GoogleTest's macros for asserting test expectations.

---

## 5. Building and Running Tests with Bazel

### Step 1: Build Your Tests

Run the following command in your workspace root:

```sh
$ bazel build //:hello_test
```

This compiles your test binary along with required GoogleTest dependencies.

### Step 2: Run Your Tests

Use `bazel test` to build and run tests with output visible:

```sh
$ bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

Key flags:

- `--cxxopt=-std=c++17` ensures compilation with C++17 standard.
- `--test_output=all` displays full test logs.

You will see output similar to:

```
INFO: Running tests...
[==========] Running 1 test from 1 test suite.
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions
[  PASSED  ] 1 test.
```

---

## 6. Understanding Bazel Build and Test Files in GoogleTest

The GoogleTest repository provides comprehensive `BUILD.bazel` and `googlemock/test/BUILD.bazel` files that define:

- Library targets for GoogleTest (`gtest`, `gtest_main`)
- GoogleMock targets (`gmock`, `gmock_main`)
- Test targets for self-validation of GoogleTest and GoogleMock
- Python test support

You can reference these files when integrating or extending your build setup.

> For detailed reference, see the [GoogleTest BUILD.bazel](https://github.com/google/googletest/blob/main/BUILD.bazel) and [GoogleMock BUILD.bazel](https://github.com/google/googletest/blob/main/googlemock/test/BUILD.bazel) files.

---

## 7. Tips and Best Practices

- **Use Version Pinning:** Pin your GoogleTest version explicitly in `MODULE.bazel` to maintain build reproducibility.
- **Test Size Labels:** Use Bazel's `size` attribute (`small`, `medium`, etc.) for test categorization and selective running.
- **Leverage `gtest_main`:** Link against `gtest_main` or `gmock_main` to include the GoogleTest main() function unless you provide your own.
- **Keep Dependencies Updated:** Regularly update Bazel dependencies to benefit from bug fixes and performance improvements.

---

## 8. Troubleshooting Common Issues

<AccordionGroup title="Common Bazel Setup Issues">
<Accordion title="Build Fails Due to Missing `WORKSPACE` or `MODULE.bazel`">
Make sure you have a `WORKSPACE` or `MODULE.bazel` file in your project root with appropriate dependency declarations. Without this, Bazel cannot resolve external dependencies like GoogleTest.
</Accordion>
<Accordion title="Tests Not Running or Detected">
Verify that test targets are correctly declared as `cc_test` rules, and that the source files contain valid GoogleTest test cases using the `TEST` macros.
Run `bazel test` at the workspace root and check test logs with `--test_output=all` for diagnostic information.
</Accordion>
<Accordion title="Compiler or Linking Errors">
Make sure you use a supported C++17 compliant compiler.
Confirm build options include `--cxxopt=-std=c++17` or equivalent.
Check that your `deps` in BUILD files include necessary GoogleTest or GoogleMock libraries.
</Accordion>
</AccordionGroup>

---

## 9. Next Steps

* Explore the [GoogleTest Primer](primer.md) to learn writing tests.
* Visit [Quickstart: Building with CMake](quickstart-cmake.md) if you prefer CMake.
* Review the [GoogleMock BUILD.bazel](googlemock/test/BUILD.bazel) for adding mocks to your tests.
* Consult [Integration & Ecosystem Connectivity](overview/architecture-and-core-concepts/integration-and-dependencies.mdx) for advanced build integration.

---

Congratulations! You now know how to set up and run GoogleTest projects using Bazel successfully.

---

## References

- Bazel Official Site: https://bazel.build/
- GoogleTest GitHub: https://github.com/google/googletest
- GoogleTest Quickstart Bazel: [docs/quickstart-bazel.md]
- GoogleTest BUILD Files:
  - [BUILD.bazel](https://github.com/google/googletest/blob/main/BUILD.bazel)
  - [googlemock/test/BUILD.bazel](https://github.com/google/googletest/blob/main/googlemock/test/BUILD.bazel)

---

For more detailed documentation on GoogleTest and GoogleMock, visit their [official documentation website](https://github.com/google/googletest).
