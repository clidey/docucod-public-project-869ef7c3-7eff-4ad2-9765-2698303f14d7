---
title: "Configuration Setup"
description: "Configure your project to use GoogleTest and GoogleMock with practical guidance on including headers, linking libraries, and adjusting build settings. Learn how to tailor the setup for single-project or multi-project environments and manage dependencies effectively."
---

# Configuration Setup

Configure your project to use GoogleTest and GoogleMock with practical guidance on including headers, linking libraries, and adjusting build settings. This guide helps tailor the setup for single-project or multi-project environments, focusing on efficient dependency management.

---

## 1. Overview

Setting up GoogleTest and GoogleMock involves more than just building the libraries. You must correctly include the header files, link against the proper libraries, and adjust your build system settings to integrate these testing tools effectively within your project architecture.

This guide specifically covers configuration considerations related to:

- Including GoogleTest and GoogleMock headers
- Linking the appropriate libraries
- Adjusting CMake build options
- Managing setup for different project layouts (single or multi-project)

---

## 2. Including Headers

GoogleTest organizes its headers so that your test code can include them consistently regardless of whether GoogleTest is built standalone or integrated into a larger project.

### Step-by-step:

1. **Set Include Directories**

   Add these directories to your compiler's include path:

   ```plaintext
   /path/to/googletest/include
   /path/to/googletest
   ```

   Replace `/path/to/googletest` with the root directory of your GoogleTest source.

2. **Include Headers in Test Code**

   In your test source files, include GoogleTest or GoogleMock headers as:

   ```cpp
   #include <gtest/gtest.h>       // For GoogleTest
   #include <gmock/gmock.h>       // For GoogleMock
   ```

   This ensures your tests have access to the full API and macros.

> <Note> These include paths are set automatically if you use CMake’s integration methods described below.</Note>

---

## 3. Linking Libraries

Depending on how you build or incorporate GoogleTest, you will link your tests with either static or shared libraries provided by GoogleTest.

### Libraries Defined by GoogleTest's Build

- **gtest**: GoogleTest testing framework core library.
- **gtest_main**: GoogleTest core plus a default main() function.
- **gmock**: GoogleMock library (included when building with GoogleMock).
- **gmock_main**: GoogleMock plus default main() function.

### Typical Linkage

- Link your test targets against `gtest_main` or `gmock_main` (if you want GoogleTest’s default main).
- If you want to provide a custom main(), link against `gtest` or `gmock` instead.

### Example in CMake:

```cmake
add_executable(my_test test_file.cpp)
target_link_libraries(my_test GTest::gtest_main)
add_test(NAME MyTest COMMAND my_test)
```

If using GoogleMock:

```cmake
add_executable(my_mock_test test_mock_file.cpp)
target_link_libraries(my_mock_test GTest::gmock_main)
add_test(NAME MyMockTest COMMAND my_mock_test)
```

> <Tip>Using the imported targets (`GTest::gtest`, `GTest::gmock_main`, etc.) properly configures include dirs and linking under the hood.</Tip>

---

## 4. Adjusting Build Settings

GoogleTest’s CMake build offers several configuration options to tweak its compilation and linking behavior.

### Important Build Options:

| Option                   | Description                                                                                      | Default |
|--------------------------|------------------------------------------------------------------------------------------------|---------|
| `gtest_force_shared_crt` | Use shared runtimes (DLL) on Windows instead of static linking. Useful when your project uses shared CRT. | OFF     |
| `BUILD_SHARED_LIBS`      | Build GoogleTest as shared libraries (DLLs) instead of static libraries.                        | OFF     |
| `gtest_build_tests`      | Build GoogleTest’s own test programs (not required for use).                                   | OFF     |
| `gtest_build_samples`    | Build sample programs demonstrating usage.                                                    | OFF     |

### Setting options with CMake command line

```bash
cmake .. -Dgtest_force_shared_crt=ON -DBUILD_SHARED_LIBS=ON
```

### Visual Studio Runtimes

If linking errors occur related to runtime library mismatches (e.g., errors LNK2038), enable `gtest_force_shared_crt` to ensure consistent CRT linkage.

---

## 5. Configuration for Single-Project vs Multi-Project Builds

### Single-Project Setup

Build GoogleTest as part of your own project tree with `add_subdirectory()`:

```cmake
add_subdirectory(path/to/googletest)
add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main)
```

This setup ensures that GoogleTest uses the same compiler and linker settings as your project, avoiding incompatibilities.

### Multi-Project Setup

Install GoogleTest separately and link against imported targets. Use `find_package`:

```cmake
find_package(GTest REQUIRED)
add_executable(my_test test.cpp)
target_link_libraries(my_test GTest::gtest_main)
```

This requires GoogleTest to be installed properly on your system (e.g., via `make install` or package manager).

> <Info>You can also embed GoogleTest as a git submodule or arrange CMake to download it during the configuration phase, improving user convenience and integration fidelity.</Info>

---

## 6. Managing Dependencies Effectively

- If you embed GoogleTest source, ensure you do not create multiple conflicting versions.
- Align your C++ standard requirements with GoogleTest's minimum of C++17.
- Pass compiler flags to match GoogleTest and your project to avoid binary incompatibility issues.
- When building GoogleTest yourself, carefully select options like `gtest_force_shared_crt` and `BUILD_SHARED_LIBS` to fit your project’s needs.

---

## 7. Verification and Good Practices

- Confirm include directories and libraries are correctly visible to your build system.
- Build a simple test program linking with `gtest_main` or `gmock_main` to verify your configuration.
- Use `RUN_ALL_TESTS()` in your test `main()` and check it runs successfully.
- If you encounter issues linked to runtime mismatches or missing pthreads, revisit build options and system requirements.

---

## 8. Troubleshooting Common Configuration Issues

<AccordionGroup title="Common Setup Problems and Solutions">
<Accordion title="Runtime Library Mismatch Errors on Windows">
If the linker emits errors like:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

Enable `gtest_force_shared_crt`:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

This causes GoogleTest to use DLL CRT linking, matching many Visual Studio project defaults.
</Accordion>
<Accordion title="Missing Pthreads on MinGW or Linking Errors Related to Threads">
GoogleTest uses pthreads for thread safety by default on some Unix-like environments. On MinGW, pthread support is disabled.

Make sure to pass `-DGTEST_HAS_PTHREAD=0` or disable pthreads explicitly if you experience linking errors.

Alternatively, apply the appropriate linker flags for pthreads if your environment supports it.
</Accordion>
<Accordion title="Cannot Find GoogleTest Headers or Libraries">
Check your include and link path configuration in the build system:
- Verify `include_directories` in CMake include the path to `googletest/include`.
- Use `find_package(GTest REQUIRED)` or include subdirectory properly.
- Ensure libraries `gtest` or the CMake target `GTest::gtest` are found.
</Accordion>
</AccordionGroup>

---

## 9. Example: Minimal CMake Configuration Including GoogleTest

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTests LANGUAGES CXX)

# Enable C++17 explicitly
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows DLL runtimes
FetchContent_MakeAvailable(googletest)

add_executable(example_test example_test.cpp)
target_link_libraries(example_test gtest_main)
add_test(NAME example_test COMMAND example_test)
```

This example downloads GoogleTest, builds it, and links it to `example_test`.

---

## 10. Additional Resources

- [GoogleTest CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt) — Community CMake support source
- [GoogleTest README](https://github.com/google/googletest/blob/main/README.md) — General information with build instructions
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) — Introductory guide
- Official CMake Documentation — Advanced and platform-specific build configurations

---

For detailed build configuration and troubleshooting, consult the [Troubleshooting Common Issues](/getting-started/troubleshooting-getting-started/common-setup-issues) and [Installation Instructions (All Platforms)](/getting-started/setup-overview/installation-multi-platform) pages.


---

# Summary

This guide walks you through configuring your project to effectively use GoogleTest and GoogleMock. It covers how to include necessary headers, link libraries appropriately, adjust key CMake build options, and tailor configurations for single or multi-project layouts. The documentation also includes practical tips for managing dependencies and handling common configuration issues with actionable examples. Users are empowered to integrate testing suites seamlessly and avoid runtime or build mismatches.

**Key sections covered:**
- Including Headers
- Linking Libraries
- CMake Build Options and Flags
- Single vs Multi-Project Configuration
- Dependency Management
- Troubleshooting Common Configuration Issues
- Example Minimal CMake Setup

**Important links:**
- [GoogleTest CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [GoogleTest README](https://github.com/google/googletest/blob/main/README.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- Related docs on [Installation Instructions](../installation-multi-platform) and [Troubleshooting](../troubleshooting-getting-started/common-setup-issues)

**Cross-references:**
- See the [Prerequisites and System Requirements](/getting-started/setup-overview/system-prerequisites) for environment needs
- Use [First Test Write and Run Guides](/getting-started/first-test-run/writing-running-first-test) after setup

**Next Steps:**
- Build and run your first test as shown in the Primer
- Explore advanced configuration options as needed
- Consult troubleshooting docs if errors arise

---