---
title: "Initial Configuration"
description: "Explains how to configure GoogleTest within your project's build system, set up include paths, and verify proper linking. Provides sample configuration snippets for CMake and Bazel."
---

# Initial Configuration

Configure GoogleTest in your project’s build system to enable seamless integration, ensure proper include paths, and verify correct linking. This page guides you through setting up GoogleTest with example configurations for CMake and Bazel, the two most commonly used build systems.

---

## 1. Overview

GoogleTest requires integrating its headers and compiled libraries into your build environment before you can use its testing and mocking features. Proper initial configuration involves:

- Adding GoogleTest source or installed headers to your include paths
- Linking against the GoogleTest and GoogleMock libraries
- Setting compiler flags and definitions if needed

This configuration ensures your project can build and link tests that depend on GoogleTest and GoogleMock reliably across platforms.

---

## 2. Configuring with CMake

GoogleTest ships with CMake support enabling easy integration in CMake-based projects. Follow these steps to configure GoogleTest correctly.

### 2.1. Using GoogleTest as a Subdirectory

If you have cloned the GoogleTest repository or downloaded its source, add it as a subdirectory to your project’s `CMakeLists.txt`:

```cmake
# Download or clone GoogleTest somewhere accessible
add_subdirectory(path/to/googletest)

# Add your test executable
add_executable(my_test test_main.cpp)

target_link_libraries(my_test GTest::gtest_main)

# Register the tests
include(GoogleTest)
gtest_discover_tests(my_test)
```

This approach builds GoogleTest as part of your build, ensuring matching compiler settings.

### 2.2. Using FetchContent to Download GoogleTest

For a more flexible approach, especially in continuous integration setups, use CMake's `FetchContent`:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)

# Prevent overriding the parent project's compiler/linker settings on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_test test_main.cpp)
target_link_libraries(my_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(my_test)
```

This automatically downloads and makes GoogleTest available at configure time.

### 2.3. Linking Required Libraries

- Link test binaries to either `GTest::gtest_main` to use GoogleTest’s main function or to `GTest::gtest` if you provide your own.
- Link to `GTest::gmock` and `GTest::gmock_main` if using GoogleMock features.

### 2.4. Compiler Standards

GoogleTest requires C++17 or later. Ensure the standard is set:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```


### 2.5. Verifying Include Paths

Confirm that your compiler can find GoogleTest headers. The CMake targets automatically propagate include directories:

```plaintext
/path/to/googletest/include
/path/to/googletest
```

Some projects explicitly add include directories if not using CMake targets.

---

## 3. Configuring with Bazel

GoogleTest can be integrated with Bazel by adding it as a workspace dependency.

### 3.1. Adding GoogleTest to WORKSPACE

Include GoogleTest as an external repository, for example:

```bazel
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.tar.gz"],
    strip_prefix = "googletest-release-1.17.0",
)
```

### 3.2. Adding to BUILD Files

Reference GoogleTest targets in your `BUILD` files:

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

This ensures your test binary links against GoogleTest and its dependencies.

---

## 4. Verifying Your Configuration

Once configured, verify the setup:

1. **Build your tests** to confirm compilation and linking succeed.
2. **Run your test executable** - it should print test results without errors.
3. **Use verbose mode** to check GoogleMock messages ``--gmock_verbose=info`` if debugging.

Example of a successful test run:

```shell
$ ./my_test
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from MyTestSuite
[ RUN      ] MyTestSuite.MyTest
[       OK ] MyTestSuite.MyTest (0 ms)
[----------] 1 test from MyTestSuite (0 ms total)

[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

---

## 5. Practical Tips & Best Practices

- Use CMake targets (`GTest::gtest`, `GTest::gtest_main`) wherever possible for cleaner dependency management.
- Set the C++ standard explicitly to at least C++17.
- When using GoogleMock features, link `GTest::gmock` or `GTest::gmock_main` appropriately.
- In Bazel, keep workspace and build file dependencies current with GoogleTest releases.
- For complex projects, prefer including GoogleTest as a submodule or with `FetchContent` to avoid version drift.

---

## 6. Common Pitfalls

- **Missing Standard Version:** Failing to set C++17 will cause build errors.
- **Incorrect Linking:** Linking against only GoogleTest but not GoogleMock if mocks are used will trigger unresolved symbols.
- **Include Path Issues:** Missing includes cause compiler failures; verify that target include directories are propagated.
- **Multiple Versions:** Conflicting GoogleTest versions in different dependencies can cause runtime problems.

---

## 7. Troubleshooting

### Issue: Linker Errors for GoogleTest Symbols

- Confirm the `target_link_libraries` includes GoogleTest targets.
- For GoogleMock usage, link against `gmock` libraries.

### Issue: Tests Compile but Don't Run or Segfault

- Verify GoogleTest is initialized properly, typically via `testing::InitGoogleMock()`.
- Use the recommended main function or link against `gtest_main`/`gmock_main`.

### Issue: Compiler Errors About Missing Headers

- Check include directories propagated via CMake targets.
- Manually add include paths if necessary, although this is discouraged.

---

## 8. Next Steps

After configuring successfully, proceed to:

- [Writing Your First Test](../your-first-test/create-first-test)
- [Running and Validating Tests](../your-first-test/running-tests)
- [Getting Started with GoogleMock (Optional)](../your-first-test/first-mock-test)
- [Common Setup Issues & Solutions](../troubleshooting-and-validation/common-issues)

For advanced usage, explore [Build System Integration](../../guides/integration-and-patterns/build-system-integration) for deeper build system configuration and optimization.

---

# Example CMakeLists.txt Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test_main.cpp test_example.cpp)

target_link_libraries(my_test PRIVATE GTest::gtest_main)

include(GoogleTest)  # Enables gtest_discover_tests command

gtest_discover_tests(my_test)
```

# Example Bazel BUILD Snippet

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

---

For source code and further details, visit the [GoogleTest GitHub repository](https://github.com/google/googletest).
