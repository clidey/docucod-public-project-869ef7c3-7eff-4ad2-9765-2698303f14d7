---
title: "Getting Started with Mocks (GoogleMock)"
description: "Introduces basic mocking concepts and the essential steps to create and use a mock object in a test. Shows the simplest setup to verify function calls and expectations using GoogleMock."
---

# Getting Started with Mocks (GoogleMock)

Welcome to the world of GoogleMock (gMock), Google's C++ mocking framework. This guide will walk you through the fundamental concepts of mocking and the essential steps to create and use a mock object in your tests. By the end, you'll understand how to define mock classes, set expectations, and verify interactions with your mocks to write robust and maintainable unit tests.

---

## 1. Understanding Mocking Basics

### What is a Mock Object?

A *mock object* is a test double that mimics the behavior of a real object by implementing the same interface. Instead of providing a full implementation, a mock object lets you specify what method calls are expected, with what arguments, how often, and what should happen when these methods are called. This enables you to test *interactions* between components instead of just their outputs.

### Why Use Mocks?

Mocks help isolate the unit under test by simulating its dependencies, making tests faster, more reliable, and easier to diagnose when they fail. They enable verifying that specific methods are called in particular ways, which is essential when testing complex workflows and side effects.


## 2. Creating a Mock Class

To start using mocks, you must define a mock class that inherits from the interface you want to mock. gMock provides the powerful `MOCK_METHOD` macro to simplify this declaration.

### Step-by-Step Mock Class Definition

<Steps>
<Step title="Derive Your Mock Class">
Create a class that inherits from the interface or base class you want to mock.
</Step>
<Step title="Use MOCK_METHOD Macros">
For each virtual method you want to mock, add a `MOCK_METHOD` declaration in the `public:` section of your mock class. Syntax:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specifiers));
```

Example:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```
</Step>
<Step title="Handle Commas in Types">
If a return type or argument contains commas (like `std::pair<int, int>`), wrap it in parentheses or use `using` aliases:

```cpp
using Pair = std::pair<int, int>;
MOCK_METHOD(Pair, GetPair, (), (override));
```
</Step>
<Step title="Add Qualifiers as Needed">
Use `(const, override)`, `(noexcept)`, or reference qualifiers `(ref(&))` as the fourth parameter when mocking overridden methods with such modifiers.
</Step>
</Steps>

<Note>
All `MOCK_METHOD` declarations must be in the public section, even if the original method was protected or private. This allows test code to set expectations and behaviors.
</Note>

## 3. Setting Up Expectations

Once you have defined your mock class, you can create mock objects in your tests and set *expectations* using `EXPECT_CALL`. Expectations specify which methods are expected to be called, with what arguments, how often, and with what result.

### Basic Syntax

```cpp
EXPECT_CALL(mock_object, MethodName(matchers))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `mock_object`: Your mock instance.
- `MethodName`: The mocked method.
- `matchers`: Argument matchers, e.g., specific values or `_` for "anything".
- `.Times()`: How many times the method is expected to be called.
- `.WillOnce()`, `.WillRepeatedly()`: Defines the behavior (return value, side effects).

### Example: Expect a Method Call Once

```cpp
using ::testing::_;
using ::testing::Return;

MockTurtle turtle;
EXPECT_CALL(turtle, Forward(100))   // Expect Forward(100) once
    .Times(1);

// Exercise code that calls turtle.Forward(100)
```

### Matchers

If you don't care about a particular argument, use `_` (wildcard matcher).

```cpp
EXPECT_CALL(turtle, GoTo(50, _));  // x must be 50, y can be anything
```

### Actions

Specify what the mock should do when a method is called. Common actions include:

- `Return(value)`: Return a value.
- `ReturnRef(variable)`: Return a reference.

Example:

```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(10))
    .WillRepeatedly(Return(5));
```

This means the first call to `GetX()` returns 10, subsequent calls return 5.

### Cardinalities

Common options:

- `Times(1)`: Exactly once (default if omitted).
- `Times(AnyNumber())`: Any number of times.
- `Times(AtLeast(n))`: At least n times.

### Ordering

To enforce call order, use an `InSequence` scope:

```cpp
{
  InSequence s;
  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

Calls must happen in the above order.

## 4. Using the Mock in Your Tests

With the mock class defined and expectations set, you use the mock object wherever the original interface is expected.

### Basic Workflow

1. Include gMock headers:

```cpp
#include <gmock/gmock.h>
```

2. Create your mock object:

```cpp
MockTurtle turtle;
```

3. Set expectations:

```cpp
EXPECT_CALL(turtle, PenDown()).Times(1);
```

4. Exercise the code under test, passing the mock:

```cpp
Painter painter(&turtle);
painter.DrawCircle(0, 0, 10);
```

5. GoogleMock will automatically verify expectations when mock objects go out of scope.

## 5. Tips and Best Practices

- **Set expectations before exercising the code.** Setting expectations after calling mock methods leads to undefined behavior.

- **Use `ON_CALL` for default behavior** when you don't want to require a method to be called, but want it to behave in a certain way if it is.

- **Use `NiceMock` to suppress warnings on uninteresting calls,** and `StrictMock` to treat uninteresting calls as test failures.

- **Wrap complex argument types** in parentheses or use typedefs to avoid parsing errors in `MOCK_METHOD`.

- **Retire expectations explicitly with `.RetiresOnSaturation()`** if you want them to be inactive after matching the specified number of times.

- **Use matchers from `testing` namespace** like `Eq()`, `Ge()`, `_` for flexible argument matching.

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Issues with GoogleMock">
<Accordion title="Method Not Mocked and Real Method Called">
Ensure the method is `virtual`. Only virtual functions can be mocked.
</Accordion>
<Accordion title="Compilation Errors with Comma-containing Types">
Wrap such types in parentheses or use `using` aliases in `MOCK_METHOD`.
</Accordion>
<Accordion title="Uninteresting Calls Warning">
Either add an `EXPECT_CALL` that covers the call, or use `NiceMock` to suppress warnings.
</Accordion>
<Accordion title="Upper Bound Violated Errors">
Check if you set `.Times()` correctly or if expectations should retire with `.RetiresOnSaturation()`.
</Accordion>
<Accordion title="Order of Expectations Matters">
Remember gMock matches the last matching expectation set first, so add catch-all expectations first, more specific ones later.
</Accordion>
</AccordionGroup>

## 7. Further Learning & Resources

For deeper understanding and advanced mocking techniques, consider the following:

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Beginner-friendly introduction and concepts.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Complete API and macros detail.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Practical recipes for real-world mocking.
- [GoogleTest Primer](overview/introduction-getting-started/what-is-googletest): Core concepts of testing with GoogleTest.

---

### Example Complete Minimal Mock and Test

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

// Interface to mock.
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

// Mock class.
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Production code that uses Turtle.
class Painter {
 public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}

  bool DrawCircle(int x, int y, int radius) {
    turtle_->PenDown();
    turtle_->Forward(radius);
    return true;
  }

 private:
  Turtle* turtle_;
};

// Test example
TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;
  Painter painter(&turtle);

  EXPECT_CALL(turtle, PenDown()).Times(1);
  EXPECT_CALL(turtle, Forward(5)).Times(1);

  painter.DrawCircle(0, 0, 5);
}
```

---

With this guide, you now have the building blocks of using mocks with GoogleMock. Start mocking your dependencies today to write clearer, faster, and more reliable tests.
