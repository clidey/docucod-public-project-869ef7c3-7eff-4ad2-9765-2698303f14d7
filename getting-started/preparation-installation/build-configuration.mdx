---
title: "Configuring Your Build"
description: "Learn how to integrate GoogleTest with your own project's build process using CMake, Bazel, or manual integration. Includes tips for linking libraries and adjusting configurations for common environments."
---

# Configuring Your Build

Integrating GoogleTest and GoogleMock into your project’s build process is a foundational step to enabling effective C++ testing. This guide walks you through configuring your build environment using CMake, Bazel, or manual integration, providing clear instructions for linking the correct libraries and adjusting settings for common scenarios.

---

## 1. Prerequisites & Setup

Before configuring your build, confirm the following:

- **CMake Version:** At least 3.13 is required to properly process GoogleMock and GoogleTest build files.
- **C++ Standard:** Ensure your compiler supports C++17 or later, as GoogleTest requires this minimum standard.
- **Source Tree Structure:** GoogleMock expects GoogleTest's source directory nearby or at `../googletest`. If you have a custom layout, update paths accordingly in your build scripts.

---

## 2. Using CMake for Build Configuration

GoogleMock includes community-supported CMake scripts that set up GoogleMock and GoogleTest for compilation and linking.

### Step 1: Add GoogleTest and GoogleMock Sources

Include GoogleTest as a subdirectory in your CMake project. GoogleMock's CMakeLists will internally reference GoogleTest, handling path detection automatically:

```cmake
# Add googletest and googlemock as subdirectories
add_subdirectory(path/to/googletest)  # Adjust to your structure
add_subdirectory(path/to/googlemock)
```

> If you place GoogleTest alongside GoogleMock following the default repository layout, GoogleMock will locate it automatically.

### Step 2: Configure Build Options

You can choose to build GoogleMock’s own tests or disable them for faster builds:

```cmake
option(gmock_build_tests "Build Google Mock's own tests." OFF)
```

If you want to build tests for GoogleMock itself (not usually necessary for downstream projects), set this to ON.

### Step 3: Link Your Tests against GoogleMock or GoogleTest

Link your test executables against the appropriate libraries:

- Use `gmock_main` if you want GoogleMock’s default main() function.
- Use `gmock` with your own main() if you prefer more control.

Example:

```cmake
add_executable(my_test test/my_test.cpp)
target_link_libraries(my_test PRIVATE gmock_main)
```

### Step 4: Compiler and Linking Flags

The CMake scripts handle compiler flags, threading, and linker settings internally. In particular:

- `config_compiler_and_linker()` adjusts strict compiler warnings and threading definitions.
- The build accommodates shared or static linkage through the standard CMake variable `BUILD_SHARED_LIBS`.
- Windows MSVC-specific flags are applied automatically to match runtime libraries.

> For advanced control, you can override or extend compiler flags after calling `add_subdirectory`.

### Step 5: Include Directories

The build system automatically adds GoogleMock and GoogleTest include directories:

```cmake
include_directories(
  ${gmock_SOURCE_DIR}/include
  ${gmock_SOURCE_DIR}
  ${gtest_include_dirs}
)
```

No additional include path setup is required in most cases.

---

## 3. Bazel Integration

GoogleTest and GoogleMock support Bazel build environments out-of-the-box.

- Fetch GoogleTest and GoogleMock repositories using Bazel's `http_archive` or `git_repository` rules.
- Refer to Bazel BUILD and WORKSPACE files in the repositories for exact target names.
- Link your test targets against `@com_google_googletest//:gmock` or `:gtest` as needed.

> For detailed Bazel integration and examples, consult the Bazel rules in the GoogleTest GitHub repository.

---

## 4. Manual Integration

If you do not use CMake or Bazel, you can manually configure your build:

### Step 1: Source Files

Compile the following source files in your project:

- GoogleTest Core: `googletest/src/gtest-all.cc`
- GoogleMock Core: `googlemock/src/gmock-all.cc` and optionally `googlemock/src/gmock_main.cc` (if you want GoogleMock's main).

### Step 2: Include Paths

Add these include directories to your compiler options:

- `<googlemock-root>/include`
- `<googletest-root>/include`

These paths ensure headers and internal files are found.

### Step 3: Linking Libraries

- Link with pthread library for multi-threading support (typically `-lpthread` on Linux).
- On Windows, ensure linking against appropriate runtime libraries.

### Step 4: Compiler Flags

Add the following compiler flags as needed:

- Define `GTEST_HAS_PTHREAD=1` if pthreads are used.
- Enable C++17 standard (`-std=c++17` or equivalent).
- Apply stricter warning flags (`-Wall`, `-Wextra`, `-Werror`, etc.) as recommended.

> Refer to internal_utils.cmake for insight on compiler flag adjustments.

---

## 5. Common Build Configurations and Tips

- **Shared vs Static Libraries:** Use `-DBUILD_SHARED_LIBS=ON` to build shared (DLL) versions of GoogleMock and GoogleTest. Otherwise, build static libraries by default.
- **Threading Support:** Confirm that your environment supports pthreads; CMake scripts automatically detect this.
- **Windows Runtime Flags:** On MSVC, `gtest_force_shared_crt` can be enabled to align runtime linkage with your project.
- **Building Tests:** By default, GoogleMock’s own tests are not built; enable `gmock_build_tests` option if desired.

---

## 6. Verifying Configuration

To validate your build setup:

1. **Compile a simple test executable** linked against `gmock_main`.
2. **Run the executable;** it should initialize GoogleTest and GoogleMock correctly.
3. **Check for linkage errors or missing symbols;** missing pthreads or misaligned runtime libraries typically cause build failures.

Example minimal C++ test linking snippet:

```cmake
add_executable(example_test example_test.cpp)
target_link_libraries(example_test PRIVATE gmock_main)
```

Run with:

```bash
./example_test
```

If output shows a successful test execution framework initialization, your build configuration is correct.

---

## 7. Troubleshooting Build Issues

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="GoogleMock Can’t Find GoogleTest">

Make sure the `gtest` directory exists adjacent to `gmock`, or adjust the path in GoogleMock’s `CMakeLists.txt`:

```cmake
if (EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/gtest/CMakeLists.txt")
  set(gtest_dir gtest)
else()
  set(gtest_dir ../googletest)
endif()
```

Verify the path references to point to your GoogleTest sources.

</Accordion>
<Accordion title="Linker Errors About pthread on Linux">

Ensure the pthread library is linked by:

- Using the CMake scripts which automatically find and add Threads::Threads.
- Manually linking with `-lpthread` if compiling outside CMake.

You can check with:

```bash
ldd your_test_binary | grep pthread
```

</Accordion>
<Accordion title="MSVC Runtime Conflicts">

If you encounter runtime mismatch errors, enable `gtest_force_shared_crt` when using GoogleTest/GoogleMock as a submodule in your project’s CMakeLists.txt:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This aligns GoogleTest's runtime with your project’s settings.

</Accordion>
<Accordion title="Building GoogleMock Tests Requires Extra Flags">

To build and run GoogleMock’s internal tests, enable the option:

```cmake
-Dgmock_build_tests=ON
```

Then run `make test` or `ctest` to execute them.

Note that on Windows, special compile options like `-Wa,-mbig-obj` may be applied.

</Accordion>
</AccordionGroup>

---

## 8. References and Further Reading

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleTest Installation Methods](https://github.com/google/googletest/blob/main/README.md)
- [Using GoogleTest with CMake](https://github.com/google/googletest/blob/main/README.md#using-cmake)
- [Pkg-config support for GoogleTest](docs/pkgconfig.md)
- [GoogleMock Customization and Flags](googlemock/include/gmock/internal/custom/README.md)

---