---
title: "Writing Your First Test"
description: "Create a basic unit test using GoogleTest and GoogleMock. This introduction demonstrates how to set up test cases, use assertions, and mock dependencies, guiding you through all the essentials for your first success."
---

# Writing Your First Test

Create a basic unit test using GoogleTest and GoogleMock. This introduction demonstrates how to set up test cases, use assertions, and mock dependencies, guiding you through all the essentials for your first success.

---

## 1. Prerequisites & Setup

Before writing your first test, ensure the following:

- **GoogleTest Framework Installed**: Confirm you have GoogleTest and GoogleMock integrated into your build system. See the [Installation on Linux, macOS, and Windows](../../getting-started/prerequisites-installation/installation-platforms.md) guide for details.
- **Include Headers**: Your test files should include the necessary headers:
  ```cpp
  #include <gtest/gtest.h>
  #include <gmock/gmock.h>
  ```
- **Understand Your Code**: Have a clear understanding of the classes or functions you intend to test.

<Tip>
If you are new, start with simple functions or classes to test. As you gain confidence, you can move to more complex scenarios with mocks.
</Tip>

---

## 2. Writing a Basic Test Case (Using GoogleTest)

GoogleTest defines tests using the `TEST` macro, which declares a test suite and a test name.

### Steps:

1. **Define the test with `TEST(TestSuiteName, TestName)`**
2. **Write assertions inside the test body to verify expected behavior**
3. **Compile and run your test executable**

### Example:

Suppose you have a function `Factorial(int n)` to compute factorials. You want to test that it works correctly.

```cpp
// Declare the function under test
int Factorial(int n);

// Tests factorial of zero
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1) << "Factorial of zero should be 1";
}

// Tests factorial of positive numbers
TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(8), 40320);
}
```

### Key Points:

- The first parameter `FactorialTest` is the test suite name grouping related tests.
- The second parameter (e.g., `HandlesZeroInput`) is the specific test name.
- Assertions such as `EXPECT_EQ` verify conditions; failures are reported but remaining tests still run.

---

## 3. Using Test Fixtures for Repeated Setup

When multiple tests require the same preparation, use *test fixtures*.

### Steps:

1. Define a class derived from `testing::Test`.
2. Initialize common objects in the constructor or `SetUp()` method.
3. Use `TEST_F` instead of `TEST` to write tests using this fixture.

### Example:

Testing a queue class:

```cpp
#include <queue>
#include <gtest/gtest.h>

template <typename T>
class Queue {
 public:
  void Enqueue(const T& element) { q_.push(element); }
  T* Dequeue() {
    if (q_.empty()) return nullptr;
    T& val = q_.front();
    q_.pop();
    return &val;
  }
  size_t size() const { return q_.size(); }

 private:
  std::queue<T> q_;
};

class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    // q0_ is empty
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  Queue<int> q0_;
  Queue<int> q1_;
  Queue<int> q2_;
};

TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q0_.Dequeue();
  EXPECT_EQ(n, nullptr);

  n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  EXPECT_EQ(q1_.size(), 0);

  n = q2_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 2);
  EXPECT_EQ(q2_.size(), 1);
}
```

### Notes:

- Each test runs with a fresh fixture, so tests are independent.
- Use `ASSERT_*` assertions if subsequent operations depend on successful checks.

---

## 4. Introducing GoogleMock: Basic Mocking

Mocks are used to simulate dependencies and observe interactions in your tests.

### Key Steps to Create a Mock Class:

1. Define an interface (abstract class with virtual methods).
2. Derive a mock class from the interface.
3. Use the `MOCK_METHOD` macro to mock each virtual method.

### Example Interface and Mock Class:

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};
```

### Using Mock Objects in a Test:

1. Create a mock object.
2. Set expectations using `EXPECT_CALL`.
3. Exercise code that uses the mock.
4. GoogleMock verifies that expectations were met on destruction.

```cpp
TEST(PainterTest, CanDrawCircle) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  // ... code using turtle ...
  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

### Notes:

- `EXPECT_CALL` must be placed before the mock method is called.
- Use `_` matcher to indicate arguments you don't care about.

---

## 5. Asserting Outcomes

GoogleTest provides various assertion macros to verify expected results.

- Use `EXPECT_*` for nonfatal assertions that let tests continue.
- Use `ASSERT_*` for fatal assertions that abort the current function.

Examples:

```cpp
EXPECT_EQ(result, expected_value) << "Result did not match expectation";
ASSERT_NE(pointer, nullptr) << "Pointer should not be null";
EXPECT_TRUE(condition);
```

### Tips on Assertions:

- Choose `ASSERT_*` when the test cannot proceed meaningfully if the assertion fails.
- Always provide a custom message when clarity on failure is critical.

---

## 6. Running Your Tests

- Link your test executable with `gtest_main` if you don't want to write your own `main`.
- If writing your own `main`, initialize GoogleTest and call all tests:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Run your test binary from the command line; it will execute all registered tests.

<Tip>
Tests group results by test suite. If a test fails, GoogleTest shows line numbers and messages to help you debug.
</Tip>

---

## 7. Troubleshooting Common Issues

- **No tests run?** Ensure your test files are compiled and linked into the executable.
- **Test fails unexpectedly?** Check assertion messages carefully and verify expectations set on mocks.
- **Mock methods not verifying?** Ensure mock objects are destructed or manually call verification functions.

---

## Summary

This guide walked you through writing your first basic unit test using GoogleTest and introduced GoogleMock for mocking dependencies. You learned how to write test cases, define fixtures for reusable setup, and create mock classes with expectations on method calls. Finally, you saw how to assert conditions and run your tests.

For more complete information and advanced techniques, explore the following documentation:

- [GoogleTest Primer](../../primer.md) for detailed fundamentals.
- [gMock for Dummies](../../gmock_for_dummies.md) for deep mocking insights.
- [Mocking Reference](../../reference/mocking.md) for API details.
- [Assertions Reference](../../reference/assertions.md) for full assertion macros.

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/primer.md", "range": "1-200"},{"path": "docs/gmock_for_dummies.md", "range": "1-140"},{"path": "docs/reference/testing.md", "range": "1-300"},{"path": "docs/reference/mocking.md", "range": "1-250"}]} />
