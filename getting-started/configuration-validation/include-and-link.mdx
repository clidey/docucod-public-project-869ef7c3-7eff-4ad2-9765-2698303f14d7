---
title: "Configuring Includes and Linking"
description: "Explain how to include GoogleTest and GoogleMock headers properly and how to link the necessary libraries within the user's build system, featuring examples for different platforms and project types."
---

# Configuring Includes and Linking

This guide explains how to properly include GoogleTest and GoogleMock headers and link the necessary libraries within your build system. You will find practical examples for different platforms and project types, helping you integrate GoogleTest and GoogleMock smoothly and avoid common pitfalls.

---

## 1. Including GoogleTest and GoogleMock Headers

To write tests with GoogleTest and mock objects with GoogleMock, your source files must include the appropriate headers:

- For GoogleTest features (test macros, assertions):

```cpp
#include <gtest/gtest.h>
```

- For GoogleMock features (mock classes, mocks helpers):

```cpp
#include <gmock/gmock.h>
```

### Best Practice

Always include `gmock/gmock.h` only if your test uses mocking functionalities. For basic unit tests, including only `gtest/gtest.h` is sufficient and avoids unnecessary dependencies.


## 2. Linking GoogleTest and GoogleMock Libraries

Linking correctly ensures your tests compile and run properly. The exact linking depends on your build system and platform.

### Using CMake

GoogleTest and GoogleMock provide comprehensive CMake support. You can either build them as standalone projects or integrate them directly into your project.

#### Standalone Build Example

Clone GoogleTest and GoogleMock repositories (GoogleMock depends on GoogleTest):

```bash
# Clone GoogleTest (which includes GoogleMock in a separate directory)
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
mkdir build && cd build
cmake ..         # Generates native build files including GoogleMock
make             # on Linux/macOS, or build the generated solution/project on Windows
sudo make install  # Optional: install system-wide
```

This builds and installs `gtest`, `gmock`, and their respective main libraries. By default, GoogleMock's CMake build includes GoogleTest automatically.

#### Integrating in Your CMake Project

**Method 1: Use installed libraries**

If GoogleTest and GoogleMock are installed on your system, import them with CMake's `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock)
```

**Method 2: Add GoogleTest/GoogleMock directly as part of your build**  
This method guarantees consistent compiler settings and avoids runtime issues (e.g., mismatched CRT linkage on Windows).

Add the following to your `CMakeLists.txt` to download and build GoogleTest/GoogleMock during your project’s configuration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# On Windows, force shared CRT linkage to match your project
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests PRIVATE gtest_main gmock)
add_test(NAME my_tests COMMAND my_tests)
```

> **Note:** This requires CMake 3.14 or later.

#### Visual Studio Considerations

Visual Studio projects default to dynamic CRT linkage (`MD`), while GoogleTest/Mock link statically by default, causing CRT mismatch errors. To fix this, set `gtest_force_shared_crt` to `ON` before building GoogleTest/Mock to match dynamic linkage.

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```


### Manual Linking (Non-CMake or Custom Build Systems)

If you're not using CMake, you need to:

- Add the GoogleTest and GoogleMock headers directory to your compiler include paths. Usually:

  - `googletest/include`
  - `googlemock/include`

- Link against the compiled `gtest` and `gmock` static or shared libraries.

- Link to `pthread` on POSIX systems if using threading (add `-pthread` or `-lpthread`).


### Linking Libraries Overview

| Library          | Description                                | Link Example (GCC)            |
|------------------|--------------------------------------------|------------------------------|
| `gtest`          | GoogleTest core testing framework          | `-lgtest`                    |
| `gtest_main`     | `main()` entry point for GoogleTest        | `-lgtest_main`               |
| `gmock`          | GoogleMock core mocking framework           | `-lgmock`                    |
| `gmock_main`     | `main()` entry point for GoogleMock         | `-lgmock_main`               |

You typically link with either `gtest_main` or `gmock_main`, or provide your own `main()`.


## 3. Examples: Including and Linking

### Example 1: Simple GoogleTest (CMake)

```cmake
add_executable(my_test test.cpp)
target_link_libraries(my_test PRIVATE GTest::gtest_main)
add_test(NAME my_test COMMAND my_test)
```

### Example 2: GoogleMock with Custom `main()` (CMake)

If you write your own `main()` for initialization:

```cmake
add_executable(my_mock_test mock_test.cpp main.cpp)
target_link_libraries(my_mock_test PRIVATE gtest gmock)
add_test(NAME my_mock_test COMMAND my_mock_test)
```

### Example 3: Including Headers in Test Source

```cpp
// Use GoogleTest
#include <gtest/gtest.h>

// Use GoogleMock
#include <gmock/gmock.h>

TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1, 1);
}

class MockMyInterface : public MyInterface {
 public:
  MOCK_METHOD(int, Foo, (int x), (override));
};
```


## 4. Common Pitfalls and Tips

### Pitfall: CRT Linkage Mismatch on Windows

- The error `mismatch detected for 'RuntimeLibrary'` usually means your project and GoogleTest/Mock are linking different C runtimes.
- Fix it by enabling `gtest_force_shared_crt` in your CMake before building GoogleTest/Mock.

### Tip: Use `add_subdirectory()` Integration Carefully

- Adding GoogleTest as a subdirectory to your project ensures consistent compiler and linker settings.
- Avoid mixing GoogleTest built from source with precompiled GoogleTest binaries of different configurations (debug vs release).

### Tip: Specify C++17 or Later

- GoogleTest requires a compiler with C++17 support.
- Use `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)` in your root CMakeLists.

### Tip: Linking Thread Libraries

- On POSIX platforms, ensure `pthread` is linked to avoid linker errors.
- This is often handled automatically when using GoogleTest’s CMake scripts.


## 5. Summary

Including GoogleTest and GoogleMock headers and correctly linking against their libraries is essential for compiling and running tests. The recommended approach is to use GoogleTest’s CMake scripts to handle dependencies, linkage, and compatibility across platforms. Always verify that your project and GoogleTest share consistent compiler options, especially runtime linkage on Windows.


---

## Additional Resources

- [GoogleTest GitHub Repository - README](https://github.com/google/googletest/blob/main/README.md)
- [GoogleTest CMake Build Docs](https://github.com/google/googletest/blob/main/googletest/README.md#build-with-cmake)
- [GoogleMock Cookbook](https://github.com/google/googletest/blob/main/googlemock/docs/cook_book.md)
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)


<Check>
Make sure your build system includes GoogleTest and GoogleMock headers and libraries.
Verify no runtime linkage conflicts exist, especially on Windows.
</Check>

<Warning>
Link errors or runtime mismatches often stem from inconsistent CRT linkage settings.
Always align these settings between your project and GoogleTest/Mock.
</Warning>

---

This completes the guide on configuring your project to include and link GoogleTest and GoogleMock properly.