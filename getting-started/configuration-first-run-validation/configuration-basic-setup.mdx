---
title: "Configuring Your Project"
description: "Describes how to include GoogleTest and GoogleMock headers, link libraries, and structure test source files. Covers key CMake and Bazel configurations and placement of test code relative to production code."
---

# Configuring Your Project

This guide helps you set up your C++ project to use GoogleTest and GoogleMock by including the right headers, linking the necessary libraries, and organizing your test source files properly. Whether you use CMake or Bazel as your build system, this documentation explains how to integrate the frameworks seamlessly into your workflow.

---

## 1. Including Headers

To use GoogleTest and GoogleMock in your tests, include their respective headers in your test source files. They provide the macros and classes necessary to write powerful and readable tests.

- **Basic includes for a test file:**

  ```cpp
  #include <gtest/gtest.h>    // GoogleTest core header
  #include <gmock/gmock.h>    // GoogleMock header for mocks
  ```

- **Order matters:**

  Include `<gtest/gtest.h>` before `<gmock/gmock.h>` to ensure proper setup.

- **What these headers provide:**

  - `gtest/gtest.h` enables assertions, test suite definitions, and test fixtures.
  - `gmock/gmock.h` provides mocking macros like `MOCK_METHOD` and expectation macros like `EXPECT_CALL`.

<Tip>
Always include `gmock/gmock.h` only after including `gtest/gtest.h` unless you specifically mock non-test code.
</Tip>

## 2. Linking Libraries

Link your test target against GoogleTest and GoogleMock libraries to resolve symbols and enable test execution.

### 2.1. Common Libraries

- **gtest**: Core GoogleTest testing framework
- **gtest_main**: Provides a default `main()` function to run all tests
- **gmock**: GoogleMock library
- **gmock_main**: Provides a default `main()` function including GoogleMock

Depending on which `main()` function you want to use, you link these libraries accordingly.

### 2.2. Linking with CMake

A minimal `CMakeLists.txt` snippet illustrates inclusion and linking:

```cmake
find_package(GTest REQUIRED)

add_executable(my_test test_file.cc)

target_link_libraries(my_test
  GTest::gtest
  GTest::gtest_main
  GTest::gmock
  GTest::gmock_main
)

# Optional: enable C++17 standard
set_target_properties(my_test PROPERTIES
  CXX_STANDARD 17
  CXX_STANDARD_REQUIRED ON
  CXX_EXTENSIONS OFF
)
```

### 2.3. Linking with Bazel

Set up your `BUILD` file to pull in GoogleTest and GoogleMock dependencies:

```python
cc_test(
    name = "my_test",
    srcs = ["test_file.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

Use the `gmock_main` target if you want Bazel to provide the `main()` automatically.

### 2.4. Notes on Linking

- Linking against `gmock_main` suffices for most tests using mocks as it includes `gtest_main`.
- If you want your own `main()` function, link only `gtest` and `gmock`.
- Ensure that the linked GoogleTest and GoogleMock versions match your headers to avoid runtime issues.

## 3. Structuring Test Source Files

Organizing your test code enhances maintainability and clarity.

### 3.1. Placement

- Place tests in directories separate from production code (e.g., `test/`, `tests/`).
- Keep your mock class definitions close to the tests that use them, or in shared `testing/` subdirectories for reuse.
- Avoid mocking classes you don’t own directly; instead, mock interfaces or adaptors you control.

### 3.2. Test File Content Outline

Each test file typically follows this structure:

1. Include relevant headers (`gtest/gtest.h`, `gmock/gmock.h`, and your own headers).
2. Use mock class definitions if needed.
3. Declare namespaces and test fixture classes.
4. Write test cases using `TEST()` or `TEST_F()`.
5. Optionally, provide a `main()` if not using `gtest_main` or `gmock_main`.

Example test file snippet:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

#include "my_project/my_class.h"

using ::testing::Return;

// Define a mock class
class MockMyInterface : public MyInterface {
 public:
  MOCK_METHOD(int, Compute, (int), (override));
};

TEST(MyClassTest, ComputeReturnsExpectedValue) {
  MockMyInterface mock;
  EXPECT_CALL(mock, Compute(5)).WillOnce(Return(42));

  MyClass obj(&mock);
  EXPECT_EQ(obj.DoWork(5), 42);
}
```

## 4. Key Best Practices

- **Prefer `gmock_main` or `gtest_main` for easy test runner integration.**
- **Mock only interfaces or adapter classes you own.** Modifying production classes directly for mocking can lead to brittle tests.
- **Use namespaces to avoid name collisions and improve clarity.**
- **Keep `MOCK_METHOD` declarations in the public section** of mock classes, even to mock protected/private methods, enabling proper `EXPECT_CALL` usage.
- **Match C++ standards and compilers** across your project and GoogleTest for compatibility.

## 5. Troubleshooting Integration Issues

- **Linker errors:** Check library names and linking order.
- **Header not found:** Verify include paths and dependencies are correctly set.
- **Multiple definitions of `main()`:** Avoid linking both `gtest_main` and defining your own `main()`.
- **Version mismatches:** Ensure you use compatible versions of GoogleTest and GoogleMock headers and libraries.

## 6. Next Steps

After configuring your project, proceed to:

- [Writing and Running Your First Test](../configuration-first-run-validation/first-test.md) - create basic tests and run them.
- [Quick Validation & Sample Projects](../configuration-first-run-validation/quick-validation.md) - verify setup with example projects.
- Explore build system-specific integration details:
  - [Installing with CMake](../set-up-prerequisites-installation/installation-cmake.md)
  - [Installing with Bazel](../set-up-prerequisites-installation/installation-bazel.md)

---

For detailed guidance, also consult:

- [GoogleTest Primer](../../primer.md) – Introduction to writing simple tests.
- [Mocking for Dummies](../../gmock_for_dummies.md) – Learn how to create and use mock objects.
- [gMock Cookbook](../../gmock_cook_book.md) – Tips and best practices for mocking.
- [Mocking Reference](../../reference/mocking.md) – API level details on mocking constructs.


---

<CardGroup cols={2}>
<Card title="CMake Integration">
  <ul>
    <li><a href="../set-up-prerequisites-installation/installation-cmake.md">Installing with CMake</a></li>
    <li><a href="../overview/workflow-integration/integration-build-systems.md">Build Systems Overview</a></li>
  </ul>
</Card>
<Card title="Bazel Integration">
  <ul>
    <li><a href="../set-up-prerequisites-installation/installation-bazel.md">Installing with Bazel</a></li>
    <li><a href="../overview/workflow-integration/integration-build-systems.md">Build Systems Overview</a></li>
  </ul>
</Card>
</CardGroup>

<CardGroup cols={2}>
<Card title="Writing Tests">
  <ul>
    <li><a href="../configuration-first-run-validation/first-test.md">Writing and Running Your First Test</a></li>
    <li><a href="../../gmock_for_dummies.md">Mocking for Dummies</a></li>
  </ul>
</Card>
<Card title="Troubleshooting">
  <ul>
    <li><a href="../troubleshooting-common-issues/troubleshooting-setup-errors.md">Troubleshooting Common Setup Errors</a></li>
  </ul>
</Card>
</CardGroup>

