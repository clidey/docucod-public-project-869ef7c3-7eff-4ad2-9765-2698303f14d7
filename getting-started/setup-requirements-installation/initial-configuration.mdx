---
title: "Initial Configuration"
description: "Configure GoogleTest for your project—be it a new or existing codebase. You'll learn how to include headers, arrange your build scripts, and set up your initial test environment so GoogleTest is ready to use from day one."
---

# Initial Configuration

Configure GoogleTest for your project—be it a new or existing codebase. This guide will walk you through how to include the necessary headers, arrange your build scripts, and set up your initial test environment so GoogleTest (with GoogleMock) is ready to use from day one.

---

## 1. Include GoogleTest and GoogleMock Headers

Before writing tests or mocks, you need to include GoogleTest and GoogleMock headers in your source files.

- Include GoogleTest core header:

  ```cpp
  #include <gtest/gtest.h>
  ```

- Include GoogleMock header when using mocks:

  ```cpp
  #include <gmock/gmock.h>
  ```

These headers provide all macros, classes, and functions necessary to define and use tests and mock classes.

<Check>
Always include `gmock/gmock.h` if you plan to write mocks, as it brings in all GoogleMock functionality.
</Check>

## 2. Arrange Your Build Scripts for GoogleTest

To use GoogleTest and GoogleMock you must correctly configure your build system to:

- Link against GoogleTest and GoogleMock libraries
- Include their headers
- Define necessary compiler flags to enable C++17

### Example CMake Setup

```cmake
# Add googletest as a subdirectory or find_package if installed
add_subdirectory(googletest)

# Your test executable
add_executable(my_test my_test.cc)

# Link with gmock and gtest libraries
# gmock depends on gtest, so link both
target_link_libraries(my_test gmock gtest pthread)

# Set C++ standard
set_target_properties(my_test PROPERTIES CXX_STANDARD 17 CXX_STANDARD_REQUIRED YES)
```

Ensure that the include directories for GoogleTest/GoogleMock are set correctly, either via your build system or manually.

<Warning>
If building on Windows, verify runtime library consistency between GoogleTest and your test executable to avoid linker/runtime errors.
</Warning>

## 3. Writing Your First Mock Class with Initial Configuration

GoogleMock enables you to define mock classes effortlessly using the `MOCK_METHOD` macro. Here's how to configure your first mock class:

### Defining a Mock Class

1. Derive your mock class from the interface or base class you want to mock.
2. Use `MOCK_METHOD` in the `public` section to declare mock methods.

```cpp
class MyInterface {
 public:
  virtual int GetValue() const = 0;
  virtual void SetValue(int val) = 0;
  virtual ~MyInterface() {}
};

class MockMyInterface : public MyInterface {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int val), (override));
};
```

<Check> MOCK_METHOD declarations must always be in the `public:` section regardless of the original method's access level. This allows the GoogleMock macros and functions to access the mock methods correctly. </Check>

### Handling Return Types with Commas

If your methods return types with commas such as `std::pair`, wrap the entire return type in parentheses or use type aliases to avoid macro parsing errors.

```cpp
using BoolIntPair = std::pair<bool, int>;

class MockFoo {
 public:
  MOCK_METHOD(BoolIntPair, GetPair, (), ());
};
```

## 4. Setup Your Initial Test Environment

After your mock class is defined and your build system is set up, configure the test environment to initialize GoogleMock and write test cases.

### Initialize GoogleMock in Your Test Main

The GoogleMock initialization also initializes GoogleTest. If you have your own `main()`, call:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

If you do not define a `main()`, link with `gtest_main` or `gmock_main` to use the provided one.

### Writing a Simple Test

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

TEST(SimpleTest, Example) {
  MockMyInterface mock;
  EXPECT_CALL(mock, GetValue())
      .WillOnce(::testing::Return(123));

  EXPECT_EQ(mock.GetValue(), 123);
}
```

This basic test sets an expectation that `GetValue()` will be called once and will return 123.

<Note>
GoogleMock requires expectations to be set before calling the mock methods. Setting expectations after the call or interleaved between calls leads to undefined behavior.
</Note>

## 5. Best Practices and Tips

- **Use ON_CALL and EXPECT_CALL appropriately:** Use `ON_CALL` for setting default behaviors without requiring the call to occur, and use `EXPECT_CALL` for specifying call expectations with verification.

- **Leverage NiceMock and StrictMock as needed:**
  - `NiceMock` suppresses warnings about uninteresting calls.
  - `StrictMock` treats uninteresting calls as failures.

- **Remove unused or redundant expectations:** Over-specifying expectations can make tests fragile.

- **Use Sequences or After clauses** to specify call ordering if your logic depends on call order.

- **New to mocking?** Review the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for conceptual understanding and recipes.

## 6. Troubleshooting Common Initial Configuration Issues

<AccordionGroup title="Common Issues During Initial Configuration">
<Accordion title="Missing gmock headers">
Make sure you have included `<gmock/gmock.h>` if you plan to use mocks. Check your include paths in your build system.
</Accordion>
<Accordion title="Linker errors on gtest or gmock symbols">
Confirm your test target is linked with `gmock` and `gtest` libraries, and the correct runtime is used on Windows.
</Accordion>
<Accordion title="Expectations not verified at test end">
Ensure your mock object is destroyed before `RUN_ALL_TESTS()` returns or explicitly call `::testing::Mock::VerifyAndClearExpectations(&mock)`.
</Accordion>
</AccordionGroup>

---

This configuration will set you on the right path to start writing tests with GoogleTest and GoogleMock with robust, maintainable tests and mocks.

For detailed guidance on mocking syntax, expectations, and advanced usage, please refer to the [Mocking Reference](../reference/mocking.md) and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

---

<Info>
Remember that GoogleTest is designed for easy integration and rapid test development. Getting your initial configuration right pays off by enabling you to write expressive and maintainable tests from day one.
</Info>
