---
title: "Configuration Basics"
description: "Explains how to set up build configurations for GoogleTest and GoogleMock, including integrating the libraries into a user project, basic settings for CMake and Bazel, and any necessary environment or compiler options for a successful build."
---

# Configuration Basics

Efficiently configuring your build environment is crucial to successfully integrate GoogleTest and GoogleMock into your C++ projects. This guide walks you through setting up build configurations, focusing on CMake and Bazel, the two primary build systems used with GoogleTest. It covers how to incorporate the GoogleTest and GoogleMock source and libraries, essential compiler and environment options, and modular integration tips to get your test builds working seamlessly.

---

## 1. Integrating GoogleTest and GoogleMock Libraries

Before configuring your build, ensure you have access to the source and headers of GoogleTest and GoogleMock. Both libraries are included in the GoogleTest repository by default.

- GoogleTest foundational headers reside under `googletest/include/gtest/`.
- GoogleMock headers reside under `googlemock/include/gmock/`.
- Source files are in the corresponding `src/` directories.

The typical approach is to build or link these libraries and include their headers to enable test compilation and execution.

<Callout type="info">
If you are building only GoogleTest without GoogleMock, configure the build accordingly (see CMake section below).
</Callout>

---

## 2. Basic Build Configuration with CMake

CMake is the recommended and widely supported build system for GoogleTest.

### 2.1. Building GoogleTest (and GoogleMock) Standalone

The simplest form of integration is to build GoogleTest as a standalone project and use the resulting libraries in your project.

1. Clone the repository:

   ```bash
   git clone https://github.com/google/googletest.git -b main
   cd googletest
   mkdir build && cd build
   ```

2. Configure CMake. To include GoogleMock (default behavior):

   ```bash
   cmake ..
   ```

   To build only GoogleTest without GoogleMock:

   ```bash
   cmake .. -DBUILD_GMOCK=OFF
   ```

3. Build the libraries:

   ```bash
   make
   ```

4. Optional: install the built libraries and headers system-wide (requires admin privileges):

   ```bash
   sudo make install
   ```

### 2.2. Incorporating GoogleTest into Existing CMake Projects

You can incorporate GoogleTest directly into your project’s build for tighter integration and consistent compiler and linker settings. This avoids common pitfalls like runtime mismatches.

**Recommended approach:** Use `FetchContent` to download GoogleTest automatically during your build configuration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For VS dynamic runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests PRIVATE gtest_main gmock_main)
enable_testing()
add_test(NAME MyTestSuite COMMAND my_tests)
```

This ensures GoogleTest and GoogleMock are built with your project’s compiler flags.

<Tip>
Remember to set the C++ standard to at least C++17 in your `CMakeLists.txt` to meet GoogleTest requirements:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

</Tip>

### 2.3. Important Compiler and Environment Considerations

- **C++17 Support**: GoogleTest requires a compiler that supports C++17. Specify this explicitly as shown above.
- **Threading Support**: Ensure your compiler and linker link the pthread library if building on POSIX platforms. The CMake scripts detect this automatically.
- **Static vs Shared Runtime on Windows**: On Windows, avoid runtime mismatches by setting `gtest_force_shared_crt` to `ON` if your project uses the dynamic runtime.
- **Compile Definitions**: GoogleTest uses some macros such as `GTEST_HAS_PTHREAD` which are set automatically by the CMake scripts but may need manual definition if you build without CMake.

<Warning>
Building outside of CMake requires careful manual setup of include paths and linking, such as adding `-pthread` on Linux during compile and link stages.
</Warning>

---

## 3. Basic Build Configuration with Bazel

GoogleTest and GoogleMock can also be built and integrated using Bazel, commonly used in larger Google-affiliated projects.

### 3.1. Using GoogleTest in Bazel

- GoogleTest is generally configured as external dependencies or imported in your `WORKSPACE` and `BUILD` files.
- Use Bazel rules to declare `cc_test` targets that depend on `@com_google_googletest//googletest` or `@com_google_googletest//googlemock`.

Example `BUILD` snippet:

```starlark
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//googletest", "@com_google_googletest//googlemock"],
)
```

### 3.2. Environment Variables and Flags

- Bazel passes some environment variables (such as `TESTBRIDGE_TEST_ONLY`) to control filtering.
- Bazel builds GoogleTest with correct options; ensure your Bazel environment supports C++17.

For detailed Bazel integration, consult your project's Bazel workspace configuration.

<Tip>
GoogleTest supports sharding and parallel test execution in Bazel seamlessly.
</Tip>

---

## 4. Compiler and Environment Flags

GoogleTest defines control macros to tweak its behavior, usually via compile-time definitions:

- `GTEST_HAS_PTHREAD=1` or `0`: Overrides pthread detection.
- `GTEST_CREATE_SHARED_LIBRARY=1`: To build GoogleTest as a shared library.
- `GTEST_LINKED_AS_SHARED_LIBRARY=1`: Used when linking tests to a shared gtest.
- `-DGTEST_DONT_DEFINE_TEST=1`: When you want to avoid GoogleTest defining `TEST` macros that may conflict.

These macros are managed automatically when building via CMake or Bazel but must be hand-applied when building GoogleTest manually.

---

## 5. Verifying and Troubleshooting Your Build

- Verify that your test binary links against `gtest` or `gtest_main` (and `gmock` libraries if used).
- Check include paths for GoogleTest and GoogleMock headers.
- Running your test executable with `--gtest_list_tests` will list all test cases discovered, confirming integration.
- If linking or include errors occur, ensure your build environment flags and paths include the necessary `-I`, `-L`, and `-l` options.

---

## 6. Summary

Setting up build configurations for GoogleTest and GoogleMock requires:

- Integrating libraries and headers appropriately in your project.
- Using CMake or Bazel to simplify building and linking, leveraging provided build scripts.
- Setting necessary compiler flags and environment macros.

Following best practices ensures that you can focus on writing and running tests without build-time issues.

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Build Instructions](../googletest/README.md#build-with-cmake)
- [Pkg-config Integration](../docs/pkgconfig.md)
- [GoogleTest Primer](../docs/primer.md)
- [Testing Reference for Detailed API and Macros](../docs/reference/testing.md)
- [Integration Examples](../guides/integration-examples-and-best-practices/integrating-into-cmake-bazel-builds.md)

---

For troubleshooting build issues and deeper customization, refer to the [Troubleshooting & Common Pitfalls](../getting-started/first-test-usage/troubleshooting-setup.md) and [Advanced Topics](../docs/advanced.md) sections.

