---
title: "Installation: CMake & Bazel"
description: "Step-by-step instructions for installing GoogleTest and GoogleMock using CMake and Bazel. Provides guidance tailored to Windows, Linux, and Mac, helping users integrate the framework directly into their own project workflows."
---

# Installation: CMake & Bazel

This guide provides clear, step-by-step instructions to install and integrate GoogleTest and GoogleMock in your C++ projects using **CMake** and **Bazel** build systems. Tailored for Windows, Linux, and Mac environments, this documentation ensures you smoothly incorporate the framework into your workflow to start writing and running tests efficiently.

---

## 1. Prerequisites

Before proceeding, ensure your system meets these requirements:

- **Operating System**: Linux, macOS, or Windows.
- **Compiler**: A C++ compiler supporting C++17 or later (e.g., GCC, Clang, MSVC).
- **Build Tools**:
  - **For CMake**: CMake 3.13 or higher.
  - **For Bazel**: Bazel 7.0 or higher.
- **Dependencies**:
  - pthreads (for multi-thread support on supported platforms).
  - Optional: Abseil and RE2 if you require integration with those libraries.

> For platform-specific nuances and detailed prerequisites, see the [Prerequisites & System Requirements](../setup-installation/prerequisites-requirements) page.

---

## 2. Installing GoogleTest and GoogleMock with CMake

GoogleTest and GoogleMock come with CMake build scripts allowing you to build them as standalone projects or embed them within your existing CMake projects.

### 2.1 Standalone GoogleTest Build

Follow these steps to clone, build, and optionally install GoogleTest and GoogleMock:

```bash
# Clone the repository with the desired release tag
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest

# Create a separate build directory
mkdir build
cd build

# Generate native build files for GoogleTest + GoogleMock
cmake ..

# To build only GoogleTest without GoogleMock, use:
# cmake .. -DBUILD_GMOCK=OFF

# Build the libraries
make

# (Optional) Install libraries and headers system-wide
sudo make install
```

#### Notes by Platform:

- **Linux/macOS**:
  - The `make` command will build the libraries.
  - Use `sudo make install` to install to `/usr/local/` by default.
- **Windows with Visual Studio**:
  - CMake generates `.sln` and `.vcproj` files which you can open and build using Visual Studio.
- **macOS with Xcode**:
  - A `.xcodeproj` file will be generated for building using Xcode.

### 2.2 Embedding GoogleTest Into an Existing CMake Project

You can incorporate GoogleTest directly into your project build process for compatibility and convenience:

1. **FetchContents method (recommended for CMake 3.14+):**

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows, enforce dynamic runtime linkage to avoid conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

# Use the targets in your project
add_executable(example example.cpp)
target_link_libraries(example gtest_main)
add_test(NAME example_test COMMAND example)
```

2. You can also add GoogleTest as a subdirectory if you have it within your source tree:

```cmake
add_subdirectory(googletest)
```

> This approach ensures GoogleTest uses the exact same compiler and linker settings, avoiding runtime and debug/release mismatches.

### 2.3 Compiler and Language Standard

Ensure your project or build specifies C++17 or later, for example in `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

---

## 3. Installing GoogleTest and GoogleMock with Bazel

Bazel is GoogleTest’s preferred build system. This section explains how to set up a Bazel workspace and integrate GoogleTest.

### 3.1 Set Up Bazel Workspace

1. Create a new workspace directory:

```bash
mkdir my_workspace && cd my_workspace
```

2. Create a `MODULE.bazel` file in the workspace root to declare GoogleTest as a dependency:

```python
# MODULE.bazel

bazel_dep(name = "googletest", version = "1.17.0")
```

### 3.2 Create a Test Source File

Create `hello_test.cc` as a sample test:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### 3.3 Write Bazel Build File

Create a `BUILD` file alongside your test source:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

### 3.4 Build and Run Your Test

Run Bazel with C++17 standard enabled and full test output:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

You should see output indicating your tests ran successfully.

---

## 4. Verification

Ensure the installation is successful by confirming:

- **CMake builds** generate the static or shared GoogleTest and GoogleMock libraries without errors.
- **Bazel builds** compile and link the test binary (`hello_test`) and all tests pass as shown by Bazel’s output.
- Test files can `#include <gtest/gtest.h>` and compile correctly.

<Tip>
If you see linker errors related to pthread or runtime symbols on Linux, make sure to have pthread development libraries installed and link with proper compiler flags (often handled automatically by CMake).
</Tip>

<Warning>
On Windows, mismatched runtime settings (static vs dynamic CRT) can cause linker errors. When embedding into your projects, use the `gtest_force_shared_crt` option in CMake to ensure consistent runtime linkage.
</Warning>

---

## 5. Troubleshooting Common Issues

<AccordionGroup title="Common Installation Pitfalls and Solutions">
<Accordion title="C++17 Standard Not Recognized">
Make sure your compiler supports C++17 and the project or build system explicitly requests this standard. For Bazel, pass `--cxxopt=-std=c++17`.
</Accordion>
<Accordion title="Linker Errors Related to pthread">
Verify that pthread development libraries are installed on your system. On Linux, use your package manager to install `libpthread` or `pthread-devel`.
</Accordion>
<Accordion title="Runtime Library Mismatch on Windows">
Set `gtest_force_shared_crt` to ON in your CMake invocation or project settings. This aligns GoogleTest’s runtime linkage to your project’s settings.
</Accordion>
<Accordion title="Bazel Dependency Resolution Fails">
Ensure you use Bazel 7.0 or later and that your `MODULE.bazel` declares the correct version of googletest dependencies.
</Accordion>
</AccordionGroup>

---

## 6. Next Steps

- Start writing your own tests using GoogleTest’s expressive assertions. See [Create Your First Test](../quickstart-validation/first-test-creation).
- Learn how to run and validate tests effectively on your platform in [Running and Validating Tests](../quickstart-validation/run-validate-tests).
- For more advanced integration or troubleshooting, consult the [Configuration & Environment Setup](../setup-installation/configuration-setup) and [Troubleshooting Common Setup Issues](../quickstart-validation/troubleshooting-common-issues) pages.


---

## Reference Links

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [Bazel Build System](https://bazel.build/)
- [CMake Official Website](https://cmake.org/)
- [GoogleTest Supported Platforms](platforms.md)
- [Bazel Central Registry for GoogleTest](https://registry.bazel.build/modules/googletest)

---

## Diagram: Installation Flow Overview

```mermaid
flowchart TD
  A[Start Installation]
  A --> B{Choose Build System}
  B -->|CMake| C[Clone googletest repo]
  C --> D[Create build directory]
  D --> E[Run cmake .. (or with options)]
  E --> F[Build with make or IDE]
  F --> G[Optional: Install libraries system-wide]
  B -->|Bazel| H[Create Bazel workspace]
  H --> I[Create MODULE.bazel with googletest dependency]
  I --> J[Add test sources and BUILD files]
  J --> K[Run bazel test with C++17 flag]
  G --> L[Verify build and run tests]
  K --> L
  L --> M[Start writing tests & integration]
```
