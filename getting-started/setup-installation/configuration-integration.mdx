---
title: "Configuration & Integration"
description: "Explains how to configure your project's build system to link with GoogleTest and GoogleMock. Includes basic setup in CMake and integration with project sources and dependencies."
---

# Configuration & Integration

This guide helps you configure your project's build system to correctly link with GoogleTest and GoogleMock. It focuses on setting up CMake, integrating GoogleTest/GoogleMock into your project sources, and managing dependencies and compiler options for seamless use.

---

## 1. Prerequisites

Before proceeding with configuration, ensure you have:

- GoogleTest/GoogleMock source or installed libraries available.
- CMake version 3.14 or higher.
- A C++17 compliant compiler.
- Basic familiarity with your project's CMake build system.


## 2. Configuring Your CMake Project

GoogleTest and GoogleMock provide CMake support primarily through their provided CMake scripts. This allows you to integrate them either as external projects or through source inclusion.

### 2.1 Using `find_package` to Locate Installed GoogleTest

If you have installed GoogleTest and GoogleMock system-wide (or to a known location), you can locate them with:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests GTest::gtest GTest::gmock GTest::gmock_main)
```

- `GTest::gtest` links the GoogleTest test framework.
- `GTest::gmock` links GoogleMock (without `main()`). Use this if you provide your own test `main()`.
- `GTest::gmock_main` links GoogleMock with the provided `main()` function, simplifying test executables.

### 2.2 Incorporating GoogleTest/GoogleMock Source with `add_subdirectory`

For tight integration ensuring matched compiler flags and speedy development iteration, add GoogleTest/GoogleMock as a subdirectory:

```cmake
# Assuming googletest source is in external/googletest
add_subdirectory(external/googletest)

add_executable(my_tests test_main.cpp)
# Link to google mock main library
target_link_libraries(my_tests gmock_main)
```

This builds GoogleTest and GoogleMock with your project, reusing the same toolchain and settings.

### 2.3 Using `FetchContent` for On-demand Download and Build

CMake 3.14+ supports FetchContent, which downloads GoogleTest/GoogleMock at configure time.

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gmock_main)
```

This method allows always up-to-date dependencies without manual cloning.

## 3. Linking and Compiler Options

### 3.1 Linking Libraries

Depending on your use case:

- Link `gmock_main` to use the default GoogleMock `main()` function.
- Link `gmock` if you define your own `main()` or integrate with custom test runners.
- Also link `gtest` if you use GoogleTest features beyond mocking.

Example:

```cmake
target_link_libraries(my_tests gmock_main)
```

or

```cmake
# Custom main
target_link_libraries(my_tests gmock gtest)
```

### 3.2 Include Directories

GoogleMock and GoogleTest headers are included automatically with the libraries above. If manual include paths are needed, add:

```cmake
target_include_directories(my_tests PRIVATE
  ${gmock_SOURCE_DIR}/include
  ${gtest_SOURCE_DIR}/include
)
```

But typically, linking the targets is sufficient.

### 3.3 Threading and Pthread Support

GoogleTest/GoogleMock detect and enable pthread support automatically via CMake's `Threads` package.

If you encounter linking issues related to pthreads, ensure your compiler and linker flags include pthread, e.g., add explicit linking:

```cmake
find_package(Threads REQUIRED)
target_link_libraries(my_tests Threads::Threads)
```

### 3.4 Visual Studio Runtime Compatibility

If using Visual Studio, GoogleTest links statically to the runtime by default. To match your project's dynamic runtime linkage, enable:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "Force GoogleTest to use shared CRT")
```

before including GoogleTest source or FetchContent.

## 4. Example CMakeLists.txt Snippet

Here is a minimal CMake configuration example integrating GoogleMock with the main():

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProjectTests LANGUAGES CXX)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Option 1: Using installed package
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_main.cpp)

# Link GoogleMock main library
target_link_libraries(my_tests GTest::gmock_main)

# Optionally add threads
find_package(Threads REQUIRED)
target_link_libraries(my_tests Threads::Threads)

# Enable CTest integration
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

Or if using source inclusion:

```cmake
add_subdirectory(googletest)
add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gmock_main)
```

## 5. Running Your Tests

After building your test executable:

```bash
./my_tests
```

You will see output similar to:

```
Running main() from gmock_main.cc
[==========] Running 3 tests from 1 test suite.
...
[  PASSED  ] 3 tests.
```

This confirms your tests are properly integrated and linked.

## 6. Troubleshooting Tips

<AccordionGroup title="Common Issues and Fixes">
<Accordion title="Linker errors for pthread or Threads::Threads">
Make sure your CMakeLists includes:

```cmake
find_package(Threads REQUIRED)
target_link_libraries(my_tests Threads::Threads)
```

and your compiler supports pthreads.
</Accordion>
<Accordion title="Undefined reference to main or multiple main functions">
- Link only one of `gmock` or `gmock_main`, not both.
- Use `gmock_main` if you want the built-in main() function.
- Use `gmock` if you provide your own main().
</Accordion>
<Accordion title="Compiler standard version issues">
Ensure your compiler supports at least C++17. Set in CMake:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```
</Accordion>
<Accordion title="Header files not found">
Link with the targets or manually add include directories as:

```cmake
target_include_directories(my_tests PRIVATE ${gmock_SOURCE_DIR}/include)
```
Usually, linking the targets handles this.
</Accordion>
</AccordionGroup>

## 7. Frequently Asked Questions

### Why choose `gmock_main` over `gmock`?

`gmock_main` provides a ready-to-use `main()` function that initializes GoogleMock and GoogleTest automatically, simplifying test executables. Use `gmock` if you need custom initialization or integration with another test framework.

### How do I customize GoogleMock's behavior?

GoogleMock supports flag macros customizable via header `gmock-port.h`, allowing you to customize verbose logging, default mock behavior, and more. See the [Customization Points](googlemock/include/gmock/internal/custom/README.md) documentation.

### Can I use GoogleMock's flags in my tests?

Yes, flags like `--gmock_verbose` or `--gmock_default_mock_behavior` can be passed to your test binary, and GoogleMock parses them automatically on `InitGoogleMock()`.

## 8. Additional Resources

- [Getting Started: Installation Methods](getting-started/setup-installation/installation-methods)
- [Writing Your First Test](getting-started/first-test-execution/writing-your-first-test)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Customization Points](googlemock/include/gmock/internal/custom/README.md)

---

By following this guide, you will integrate GoogleTest and GoogleMock smoothly into your CMake-based projects, enabling robust and maintainable C++ testing workflows.

---

<Check>
Ensure your project sets the required C++17 standard and properly links all threading dependencies.
Use `gmock_main` for straightforward test executables or `gmock` if custom test runners are needed.
Consult GoogleMock's customization documentation to adapt the framework to your needs.
</Check>

<Info>
For detailed build options and platform-specific notes, see the [CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt).
</Info>
