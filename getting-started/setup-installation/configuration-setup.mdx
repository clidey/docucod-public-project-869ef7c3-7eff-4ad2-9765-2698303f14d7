---
title: "Configuration & Initial Project Setup"
description: "Set up your project for first use, including linking GoogleTest libraries, integrating headers, and configuring your build files. Also covers basic test binary structure and any required environment variables or project scaffolding."
---

# Configuration & Initial Project Setup

This guide walks you through setting up your C++ project to use GoogleTest. You will learn how to link GoogleTest libraries, include necessary headers, configure your build system, and understand the basic structure of the test binary. This essential setup enables you to write, build, and run your first tests successfully.

---

## 1. Linking GoogleTest Libraries and Including Headers

Before writing any tests, your project must link against GoogleTest libraries and include its headers.

### Link GoogleTest Libraries

GoogleTest provides two primary libraries:

- `gtest`: The core testing framework.
- `gtest_main`: The core framework plus a ready-to-use `main()` function.

You generally want to link `gtest_main` if you do not need a custom entry point.

### Include GoogleTest Headers

Add the include directory for GoogleTest headers to your compiler's include paths. Typically, include `<gtest/gtest.h>` in your test source files:

```cpp
#include <gtest/gtest.h>
```

This single header covers the main GoogleTest functionality needed in your tests.

---

## 2. Configuring Your Build Files

Integration with your build system is crucial to compile and link your test binaries correctly.

### Using CMake

GoogleTest recommends CMake and provides build scripts to ease integration. You can link GoogleTest using the `find_package` or via its pkg-config files.

#### Basic CMake Integration Example Using Pkg-Config

```cmake
find_package(PkgConfig REQUIRED)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(your_test_exe your_test.cc)
target_sources(your_test_exe PRIVATE your_test.cc)
target_link_libraries(your_test_exe PRIVATE ${GTEST_LDFLAGS})
target_compile_options(your_test_exe PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(NAME your_test COMMAND your_test_exe)
```

**Note:**
- Use `target_compile_options` with `${GTEST_CFLAGS}` to ensure all required macros and flags are set (this includes threading macros and `-pthread`).
- `${GTEST_LDFLAGS}` contains the required library and pthread linking information.

#### Handling pkg-config Failures

If pkg-config can't find GoogleTest, ensure the `.pc` files are located and include their directory in your `PKG_CONFIG_PATH` environment variable. For example:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Adjust the path depending on your installation prefix.

### Manual Integration

If you do not use CMake, manually add the appropriate include paths, macro definitions, and link flags that correspond to GoogleTest. Use pkg-config or review your platform’s developer documentation to obtain these flags.

---

## 3. Understanding Test Binary Structure

A GoogleTest test binary typically has the following characteristics:

- Multiple test suites containing multiple test functions.
- Tests are automatically discovered and registered during linkage.
- By linking with `gtest_main`, a `main()` function is provided, calling `::testing::InitGoogleTest()` to initialize the framework and then `RUN_ALL_TESTS()` to execute all tests.

### Custom main() Function (Optional)

If you need special test program initialization or handling before tests run, define your own `main()` as follows:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Remember to call `InitGoogleTest()` before `RUN_ALL_TESTS()`, otherwise command-line flags won't be recognized.

---

## 4. Scaffolding Your Project

Typically, your project includes one or more test source files following this pattern:

- Include GoogleTest headers.
- Define test suites with `TEST()` or test fixtures with `TEST_F()`.
- Write assertion checks to validate code behavior.

### Example Test File

```cpp
#include <gtest/gtest.h>

// Sample function to test
int Factorial(int n) {
  return n <= 1 ? 1 : n * Factorial(n - 1);
}

// Test case
TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(8), 40320);
}
```

---

## 5. Required Environment Variables and Flags

For special environments and advanced build configurations, such as cross-compilation, setting environment variables correctly is key.

### Cross-Compilation Considerations

When cross-compiling GoogleTest, you should:

- Build and install GoogleTest with `CMAKE_INSTALL_PREFIX` matching the target sysroot, e.g.: 

  ```bash
  mkdir build
  cd build
  cmake -DCMAKE_INSTALL_PREFIX=/usr ..
  make install DESTDIR=/path/to/sysroot
  ```

- Set the following environment variables to inform pkg-config about the sysroot and search paths:

  ```bash
  export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
  export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
  export PKG_CONFIG_SYSROOT_DIR=/path/to/sysroot
  export PKG_CONFIG_LIBDIR=$PKG_CONFIG_SYSROOT_DIR/usr/lib64/pkgconfig
  ```

This ensures compilation and linking flags reflect the target environment correctly.

### Threading Macros

GoogleTest requires `-DGTEST_HAS_PTHREAD=1` and `-pthread` (or platform equivalent) for thread-safety and should be included automatically via pkg-config or CMake targets.

---

## 6. Tips and Best Practices

- Always link with `gtest_main` unless you need a custom main function.
- Use `target_compile_options` over `target_include_directories` to capture all required compiler flags (includes macros and pthread flags).
- For cross-compilation or custom installs, verify your `PKG_CONFIG_PATH` or `PKG_CONFIG_LIBDIR` and environment variables to avoid linking errors.
- Keep test source files separate from production code for clarity and maintainability.

---

## 7. Troubleshooting

### Common Issues

- **Error: pkg-config cannot find gtest_main**
  - Solution: Set `PKG_CONFIG_PATH` to include the pkgconfig directory of your GoogleTest installation.

- **Linker errors related to pthread**
  - Solution: Ensure `-pthread` flag is included during compile and link. CMake pkg-config integration handles this.

- **Tests not discovered or run**
  - Solution: Confirm that your test executable links against the GoogleTest libraries and includes the source files with tests.

---

## 8. Next Steps

Once your project is configured and the test binary builds successfully, proceed to:

- [Writing Your First Test](../first-steps-validation/write-your-first-test) to learn test creation.
- [Building and Running Tests](../first-steps-validation/build-run-tests) to execute and validate your tests.

For complex build systems, refer to the [Installation Guide](../setup-installation/installation-guide) and advanced integration documentation in the Guides section.

---

## References

- [GoogleTest Primer](../primer) — Understand the basic concepts behind test writing.
- [Installation Guide](../setup-installation/installation-guide) — Detailed steps for installing and integrating GoogleTest.
- [Troubleshooting Common Setup Issues](../first-steps-validation/troubleshooting-common-issues) — For resolving setup problems.
- [Pkg-config Integration](../../docs/pkgconfig) — Detailed usage of pkg-config with GoogleTest.
- [CMake Build Instructions](../../googletest/README.md#generic-build-instructions) — Learn about building GoogleTest with CMake.

---

_Start configuring your project now to empower your C++ development with comprehensive testing._