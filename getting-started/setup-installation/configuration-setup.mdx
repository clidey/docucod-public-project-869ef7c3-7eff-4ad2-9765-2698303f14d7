---
title: "Configuration & Environment Setup"
description: "Outlines how to add GoogleTest/GoogleMock to a project, configure build files, and verify correct linking and inclusion. Covers integration with popular IDEs/build systems, and setting up the workspace for smooth development."
---

# Configuration & Environment Setup

This guide walks you through adding **GoogleTest/GoogleMock** to your C++ project, configuring your build environment and files, and verifying that everything is linked and included correctly. It covers integration approaches for popular build systems and IDEs, ensuring a smooth developer workspace setup.

---

## 1. Prerequisites for Configuration

Before integrating GoogleTest and GoogleMock, confirm you have the following:

- **C++17 Compatible Compiler**: GoogleTest requires C++17 support. Specify `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)` in your CMakeLists to enforce this.
- **Build System**: CMake (version 3.14 or later) is recommended to leverage FetchContent for flexible inclusion.
- **Source Access**: Local GoogleTest source or Git repository access for submodule or embedded configurations.


## 2. Adding GoogleTest/GoogleMock to Your Project

You have multiple ways to integrate GoogleTest and GoogleMock in your project. Choose based on your workflow:

### A. Using CMake `FetchContent` to Download and Build Automatically

This modern approach downloads GoogleTest during your build configuration.

Add the following to your root `CMakeLists.txt`:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# Optionally force shared CRT on Windows to avoid runtime conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Example: create an executable and link against gtest_main
add_executable(your_test_executable test_main.cpp)
target_link_libraries(your_test_executable gtest_main)
add_test(NAME your_test COMMAND your_test_executable)
```

### B. Adding GoogleTest as a Git Submodule

To keep GoogleTest up-to-date and in sync with your project:

```bash
git submodule add https://github.com/google/googletest.git external/googletest
git submodule update --init --recursive
```

In your `CMakeLists.txt`:

```cmake
add_subdirectory(external/googletest)
add_executable(your_test_executable test_main.cpp)
target_link_libraries(your_test_executable gtest_main)
add_test(NAME your_test COMMAND your_test_executable)
```

### C. Embedding GoogleTest Source Code Directly

You can manually copy GoogleTest sources into your project and add it as a subdirectory, but this method requires manual updates and is less flexible.

### D. Using Installed GoogleTest Libraries

If you have installed GoogleTest globally (e.g., via package manager), import it using:

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(your_test_executable test_main.cpp)
target_link_libraries(your_test_executable GTest::gtest_main)
add_test(NAME your_test COMMAND your_test_executable)
```


## 3. Configuring Build Files

### Key CMake Configuration Points

- **Compiler Flags**: GoogleTest configures compilation with strict warnings and appropriate platform-specific flags automatically.
- **Visual Studio Runtime Matching**: Use the option `gtest_force_shared_crt ON` in CMake to ensure consistent CRT linkage with your project.
- **Pthread Support**: On POSIX platforms, GoogleTest detects and uses pthread by default. Disable with `-Dgtest_disable_pthreads=ON` if needed.
- **Shared vs Static Libraries**:
  - Static libraries are default.
  - To build GoogleTest as a shared library, in your CMake define `-DGTEST_CREATE_SHARED_LIBRARY=1` and link test executables with `-DGTEST_LINKED_AS_SHARED_LIBRARY=1`.

### Example Minimal CMakeLists.txt snippet for your test executable

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test/my_test.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```


## 4. Integration with IDEs and Build Systems

- **Visual Studio**: When generating projects using CMake, a `gtest.sln` is available when building GoogleTest standalone. When embedded, just build and run your test executable as usual.
- **Linux/macOS**: Run builds through `make` or the native build tool generated by CMake.
- **Bazel**: Refer to the Bazel integration guide for configuring GoogleTest within Bazel workspaces.


## 5. Verifying Correct Linking and Inclusion

To confirm GoogleTest and GoogleMock are correctly integrated:

1. Ensure your test source includes the headers:

    ```cpp
    #include <gtest/gtest.h>
    #include <gmock/gmock.h>
    ```

2. Your compiler command includes the GoogleTest include directories and your linker links to `gtest` or `gtest_main` (and similarly for `gmock`).
3. Compile and link your test executable. It should link cleanly without missing symbols.
4. Run the test executable; it should output something like:

```
Running main() from gmock_main.cc
[==========] Running 2 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 2 tests from ExampleTest
[ RUN      ] ExampleTest.TestSomething
[       OK ] ExampleTest.TestSomething (0 ms)
[ RUN      ] ExampleTest.TestAnotherThing
[       OK ] ExampleTest.TestAnotherThing (0 ms)
[----------] 2 tests from ExampleTest (0 ms total)

[----------] Global test environment tear-down
[==========] 2 tests from 1 test suite ran. (0 ms total)
[  PASSED  ] 2 tests.
```


## 6. Troubleshooting Common Configuration Issues

<AccordionGroup title="Common Configuration Issues and How to Fix Them">
<Accordion title="Linker Errors Related to Missing GoogleTest Symbols">
Verify linkage to `gtest` or `gtest_main` libraries in your build files. If using CMake, ensure `target_link_libraries` is set.

Also check that the include directories are correctly set to Google's headers.
</Accordion>
<Accordion title="Runtime Crashes or Mismatched Runtime Libraries on Windows">
Set the CMake option `gtest_force_shared_crt` to `ON` to align your test and GoogleTest's runtime linkage.

Example:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

</Accordion>
<Accordion title="Pthreads Not Found or Multithreading Not Working">
GoogleTest detects pthread on Unix systems automatically. If your environment lacks pthreads or detection fails, you can manually disable with `-Dgtest_disable_pthreads=ON` or enable with `-DGTEST_HAS_PTHREAD=1`.
</Accordion>
<Accordion title="Build Failures Due to Compiler Flags">
GoogleTest applies strict compiler flags. Customize your build system if needed (e.g., setting `CMAKE_CXX_STANDARD 17` explicitly and ensuring your compiler supports C++17).
</Accordion>
</AccordionGroup>


## 7. Next Steps

- Proceed to the [Installation: CMake & Bazel](https://github.com/google/googletest/tree/main/docs/getting-started/setup-installation/installation-cmake-bazel.mdx) guide to build and compile GoogleTest.
- After configuration, move on to [Create Your First Test](https://github.com/google/googletest/tree/main/docs/getting-started/quickstart-validation/first-test-creation.mdx) for test creation workflow.
- Consult the [Troubleshooting Common Setup Issues](https://github.com/google/googletest/tree/main/docs/getting-started/quickstart-validation/troubleshooting-common-issues.mdx) page for in-depth problem solving.

---

## Additional Resources

- Official repository: [GoogleTest on GitHub](https://github.com/google/googletest)
- CMake documentation: [cmake.org](https://cmake.org/)
- GoogleMock overview: [gMock docs](https://github.com/google/googletest/tree/main/googlemock)

---

## Summary Diagram of Integration Workflow

```mermaid
flowchart TD
  A[Start: Your Project's CMakeLists.txt] --> B{Choose Integration Method}
  B -->|FetchContent| C[Include FetchContent in CMakeLists]
  B -->|Git Submodule| D[Add googletest as Submodule]
  B -->|Embed Source| E[Copy GoogleTest Source Code]
  B -->|Installed Library| F[Use find_package(GTest)]

  C --> G[Fetch & Configure Googletest Automatically]
  D --> H[Add_subdirectory(googletest)]
  E --> H
  F --> I[Link Against Installed GTest Targets]

  G & H & I --> J[Define Your Test Executable]
  J --> K[Link test executable with gtest_main or gmock_main]
  K --> L[Build & Run Tests]
  L --> M{Tests pass?}
  M -->|Yes| N[Success]
  M -->|No| O[Troubleshoot Configuration]

  style A fill:#f9f,stroke:#333,stroke-width:2px
  style N fill:#6f9,stroke:#333,stroke-width:2px
  style O fill:#f66,stroke:#333,stroke-width:2px
```
