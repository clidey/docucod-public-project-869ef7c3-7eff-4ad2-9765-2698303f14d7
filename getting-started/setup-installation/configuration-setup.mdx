---
title: "Initial Configuration"
description: "Guides users through linking and configuring the framework in their C++ project after installation. Details on integrating GoogleTest/GoogleMock headers and libraries, with recommendations for organizing tests within your codebase and references to configuration files."
---

# Initial Configuration

Welcome to the Initial Configuration guide for GoogleTest and GoogleMock. This page helps you seamlessly link and configure the framework in your C++ projects after completing the installation phase. It focuses on integrating the headers and libraries, setting up your project files, and following best practices for organizing your test code.

---

## 1. Integrating GoogleTest & GoogleMock into Your C++ Project

To begin using GoogleTest and GoogleMock, you need to correctly link their headers and library files into your build system or project environment. The following steps guide you through this process with CMake and manual build setups.

### 1.1 Include Paths

Make sure your C++ compiler knows where to find GoogleTest and GoogleMock headers. These are typically located under your installation directories at:

- `<install_dir>/include/gtest/` for GoogleTest headers
- `<install_dir>/include/gmock/` for GoogleMock headers

If you built GoogleMock from source, the include directories are:

```shell
/path/to/googletest/include
/path/to/googlemock/include
```

**Example CMake include setting:**

```cmake
include_directories(${gmock_SOURCE_DIR}/include)
include_directories(${gtest_SOURCE_DIR}/include)
```

### 1.2 Linking Libraries

GoogleMock depends on GoogleTest, so you must link against both libraries.

- If using CMake, link your test targets like this:

```cmake
target_link_libraries(your_test_target gmock_main)
```

The `gmock_main` target conveniently links with both GoogleMock and GoogleTest main libraries.

- For manual builds or other systems:

```shell
-lgmock_main -lgmock -lgtest -lpthread
```

Make sure the linker can locate these libraries via library search paths.

### 1.3 Compiler Flags and C++ Standard

GoogleTest and GoogleMock require a compiler with C++17 support. Ensure your build uses appropriate flags:

- For GCC/Clang:

```shell
-std=c++17 -pthread
```

- For MSVC (Visual Studio 2017 or later): Enable C++17 standard.

### 1.4 Build System Setup with CMake

If you integrate GoogleTest and GoogleMock as submodules or external projects, use CMake's `add_subdirectory()` to bring them into your build:

```cmake
# Add googletest and googlemock sources
add_subdirectory(${PATH_TO_GTEST_SOURCE} googletest_build)
add_subdirectory(${PATH_TO_GMOCK_SOURCE} googlemock_build)

# Include directories
include_directories(
  ${PATH_TO_GTEST_SOURCE}/include
  ${PATH_TO_GMOCK_SOURCE}/include
)

# Link the libraries
add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gmock_main)
```

This ensures consistent compiler flags and dependencies.

---

## 2. Recommended Project Organization for Tests

Well-organized tests improve readability and maintainability. Follow these guidelines:

- **Create a dedicated `tests/` or `test/` directory** in your project root.
- **Separate tests by component or module**, grouping related test files.
- Use consistent file naming conventions, e.g., `foo_test.cc` for the tests for `foo.cc`.
- Use `main()` from GoogleMock's main library `gmock_main` or define your own test main function using `InitGoogleMock()`.

### Example Directory Structure

```
project-root/
  src/
    foo.cc
    bar.cc
  include/
    foo.h
    bar.h
  tests/
    foo_test.cc
    bar_test.cc
    CMakeLists.txt
```

### Example `tests/CMakeLists.txt`

```cmake
add_executable(foo_tests foo_test.cc)
target_link_libraries(foo_tests gmock_main)

add_executable(bar_tests bar_test.cc)
target_link_libraries(bar_tests gmock_main)
```

---

## 3. Configuration Files and Macros

GoogleMock allows configuration via macros and custom headers to control its behavior.

- **Customization Point:** The `gmock/internal/custom/gmock-port.h` file can be used to declare or define flags and macros that modify GoogleMock behavior.

### Important Macros Related to Flags Include:

| Macro                          | Purpose                                                         |
|-------------------------------|-----------------------------------------------------------------|
| `GMOCK_DECLARE_bool_(name)`    | Declare a boolean flag                                            |
| `GMOCK_DEFINE_bool_(name, default_val, doc)`| Define a boolean flag with default and documentation description |
| `GMOCK_FLAG_GET(flag_name)`    | Retrieve the current value of a gmock flag                       |
| `GMOCK_FLAG_SET(flag_name, value)` | Set a gmock flag programmatically                              |

### Common Flags You Can Configure:

| Flag Name                | Behavior                                                                            |
|--------------------------|-------------------------------------------------------------------------------------|
| `verbose`                | Controls the verbosity of GoogleMock output (values: `info`, `warning`, `error`)     |
| `default_mock_behavior`  | Controls default mock strictness: `0` for NiceMocks, `1` for NaggyMocks, `2` for StrictMocks |
| `catch_leaked_mocks`     | Whether to report leaked mocks as failures                                         |

### Example: Defining a Flag in `gmock-port.h`

```cpp
GMOCK_DEFINE_bool_(verbose, "warning", "Controls GoogleMock verbosity level.");
```

You can override these at compile-time or dynamically control their behavior via command line flags such as `--gmock_verbose=info`.

---

## 4. Initializing GoogleMock in Your Test Main

Before running tests, initialize GoogleMock (which also initializes GoogleTest) properly in your test program's main function.

```cpp
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  // Initializes GoogleMock and GoogleTest with command line arguments.
  testing::InitGoogleMock(&argc, argv);

  // Runs all tests.
  return RUN_ALL_TESTS();
}
```

This initialization parses flags recognized by GoogleMock and removes them from `argv`.

### Special Cases

- For Windows programs compiled in Unicode mode, use `wchar_t** argv` and corresponding overload:

```cpp
int main(int argc, wchar_t** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- On embedded platforms or where `argc/argv` are unavailable, use the parameterless version:

```cpp
int main() {
  testing::InitGoogleMock();
  return RUN_ALL_TESTS();
}
```

This will use a dummy argument vector internally.

---

## 5. Practical Tips & Best Practices

- Always call `InitGoogleMock()` *before* `RUN_ALL_TESTS()`.
- When integrating in larger projects, prefer linking the `gmock_main` library which provides an appropriate main entrypoint.
- Customize verbosity and mock behaviors using flags or macros for more control.
- Organize your tests logically and ensure build paths are correctly set in your build system.
- Use the command line flags to control test execution, such as `--gmock_verbose` for detailed output or `--gmock_default_mock_behavior` to switch mock strictness.

---

## 6. Troubleshooting Common Setup Issues

<AccordionGroup title="Common Configuration Issues">  
<Accordion title="Headers Not Found">  
If your compiler fails to find GoogleTest or GoogleMock headers, verify your include directories. Ensure `-I` or equivalent flags point to the correct paths where the libraries were installed or built.
</Accordion>  
<Accordion title="Linker Errors">  
Make sure to link against `gmock_main`, `gmock`, and `gtest` libraries. Also, confirm that your linker paths include the directories where these libraries reside.
</Accordion>  
<Accordion title="Wrong C++ Standard">  
GoogleTest requires C++17. Building with older standards will cause compilation and runtime failures. Adjust your compiler flags accordingly.
</Accordion>  
<Accordion title="Flag Parsing Problems">  
Ensure your test main calls `testing::InitGoogleMock()` to parse recognized flags properly, or command line flags might not be interpreted.
</Accordion>  
</AccordionGroup>

---

## 7. Additional Resources and Next Steps

- For detailed installation instructions, visit [Installing GoogleTest & GoogleMock](https://github.com/google/googletest/blob/main/README.md).
- To learn how to write and run your first tests, see the guide: [Writing and Running Your First Test](https://github.com/google/googletest/blob/main/docs/primer.md).
- Explore configuration flags and best practices in the [GoogleMock Portability and Configuration](https://github.com/google/googletest/blob/main/googlemock/include/gmock/internal/gmock-port.h) documentation.

---

By following this configuration guide, youâ€™ll set a strong foundation for leveraging GoogleTest and GoogleMock in your C++ testing workflow, enabling effective unit testing and mocking capabilities.

---

# References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleMock Documentation: Customization Points](https://github.com/google/googletest/blob/main/googlemock/include/gmock/internal/custom/README.md)
- [GoogleMock Portability and Flags](https://github.com/google/googletest/blob/main/googlemock/include/gmock/internal/gmock-port.h)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleTest CMake Build Instructions](https://github.com/google/googletest/blob/main/README.md#build-with-cmake)
