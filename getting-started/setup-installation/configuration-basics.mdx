---
title: "Basic Configuration & Project Setup"
description: "Guides users through adding test targets, linking GoogleTest/GoogleMock libraries, and configuring build scripts for typical C++ projects. Covers initial flag setup and the essential include paths to ensure the test framework is discoverable and functional."
---

# Basic Configuration & Project Setup

This guide helps you configure your C++ project to use GoogleTest and GoogleMock effectively. It covers how to add test targets, link against the necessary libraries, and set up include paths and flags so the testing framework is discoverable and fully functional in your build environment.

---

## 1. Add GoogleTest and GoogleMock to Your Build

Before you write tests or mocks, you must make sure your build system knows where to find the GoogleTest and GoogleMock libraries and headers.

### Step 1: Include GoogleTest and GoogleMock Headers

Ensure your project sources can include GoogleTest and GoogleMock headers by adding the following include directories to your compiler's search paths.

```cmake
# Assuming you have fetched or installed gtest and gmock sources
include_directories(
  ${gmock_SOURCE_DIR}/include
  ${gmock_SOURCE_DIR}
  ${gtest_SOURCE_DIR}/include
)
```

> **Tip:** These paths are usually provided by CMake if you add GoogleTest as a subdirectory or find it as a package.

### Step 2: Link Test Targets Against gtest and gmock

When defining your test executable, link it to the `gtest` and `gmock` libraries, or preferably their `gmock_main` variant if you want GoogleMock to provide a main function.

For example, in CMake:

```cmake
add_executable(MyTest test.cpp)
target_link_libraries(MyTest gmock_main)  # Links gmock, gtest, and main()
```

- Use `gmock_main` if you want to run tests without writing your own `main()`.
- Use `gmock` if you want to define a custom `main()` (for example, to customize initialization).


### Step 3: Configure Compiler Flags for Threading

GoogleTest and GoogleMock use platform threads where available. The build scripts automatically handle this. If you configure manually, ensure your compiler and linker flags enable threading support.

Example:

```cmake
# pthread flag for POSIX
set(THREADS_PREFER_PTHREAD_FLAG ON)
find_package(Threads REQUIRED)
target_link_libraries(MyTest Threads::Threads)
```


## 2. Initial Flag Setup and Command Line Configuration

GoogleMock provides several runtime flags to customize behavior during test execution. These flags are parsed during initialization.

- Flags include `--gmock_verbose`, `--gmock_default_mock_behavior`, and more.
- They are automatically recognized and cleaned from `argv` during `InitGoogleMock()`.

Typically, your test executable will call `testing::InitGoogleMock(&argc, argv);` to initialize the framework and parse flags.

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- If linking with `gmock_main`, this `main()` is already provided.


## 3. Sample Complete CMakeLists.txt Configuration

This example configures a test executable named `MyTest` using GoogleMock with automatic initialization:

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyProject CXX)

# Fetch or add GoogleTest and GoogleMock
add_subdirectory(googletest)  # or your path to googletest sources

# Specify your test executable
add_executable(MyTest test.cpp)

# Link against gmock_main to get main() function and all mocks
target_link_libraries(MyTest gmock_main)

# Include path settings (usually automated by target_link_libraries)
include_directories(
  ${gmock_SOURCE_DIR}/include
  ${gmock_SOURCE_DIR}
  ${gtest_SOURCE_DIR}/include
)

# Enable C++17 standard
set_target_properties(MyTest PROPERTIES CXX_STANDARD 17 CXX_STANDARD_REQUIRED ON)

# Link threading libraries if necessary
find_package(Threads REQUIRED)
target_link_libraries(MyTest Threads::Threads)
```


## 4. Best Practices and Tips

- **Choose the right library to link:** Use `gmock_main` if you want the included `main()`; otherwise, link with `gmock` and define your own.
- **Keep includes ordered and minimal:** Only include `gmock/gmock.h` in your test/mocking source files.
- **Use CMake targets where possible:** Modern versions of GoogleTest export targets (`GTest::gtest`, `GTest::gmock`) for smoother integration.
- **Set appropriate compiler standards:** GoogleTest and GoogleMock require C++17 support.
- **Pass your command-line flags correctly:** Let `InitGoogleMock` parse flags so it removes any GoogleMock-specific arguments.


## 5. Troubleshooting Common Setup Issues

<AccordionGroup title="Common Issues & Solutions">
<Accordion title="Undefined Reference to GoogleMock Functions">
This happens if you forget to link your test target with the `gmock` or `gmock_main` library.

**Solution:** Add the appropriate libraries in your build settings.
</Accordion>
<Accordion title="Missing Header Files">
If your compiler can't find `gmock/gmock.h`, check your include directories.

**Solution:** Verify that the GoogleMock include paths are set properly in your project or CMakeLists.
</Accordion>
<Accordion title="Thread-related Link Errors">
If you see errors related to pthread or threads, ensure you link to the platform threads library.

**Solution:** For CMake, use `find_package(Threads REQUIRED)` and link `Threads::Threads`.
</Accordion>
<Accordion title="Multiple Definitions of main()">
Occurs if you link both `gmock_main` and also define your own `main()`.

**Solution:** Link only one `main()`. Remove your custom `main()` or do not link `gmock_main`.
</Accordion>
</AccordionGroup>


## 6. Additional Resources

For more detailed installation and build instructions, refer to:

- [Installation: CMake, Bazel, and Manual Integration](https://your-docs-path/getting-started/setup-installation/installation-modes)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest CMake Build Guide](https://github.com/google/googletest/blob/main/README.md#building-and-running-tests)

---

By following this basic configuration and setup workflow, you ensure your tests can build and run successfully using GoogleTest and GoogleMock, unlocking powerful testing capabilities for your C++ codebase.

---

<Check>
Ensure your build can successfully compile and link a minimal test that includes `gmock/gmock.h` and runs `RUN_ALL_TESTS()`.
</Check>


---

# Quick Reference

| Step                      | Action                                    | Purpose                             |
|---------------------------|-------------------------------------------|-----------------------------------|
| 1. Include Paths           | Add GoogleMock and GoogleTest include dirs| Locate headers in your project     |
| 2. Link Libraries          | Link `gmock_main` or `gmock` + `gtest`   | Provide implementation libraries   |
| 3. Add Compiler Flags      | Enable threading and C++17 standard       | Ensure compatibility and threading |
| 4. Call InitGoogleMock()   | In `main()` or use `gmock_main`          | Initialize framework and parse flags |

