---
title: "Project Configuration"
description: "Essential project setup steps—linking libraries, creating a test directory, and preparing build files. Ensures GoogleTest and GoogleMock are correctly configured in your build system."
---

# Project Configuration

Essential project setup steps—linking libraries, creating a test directory, and preparing build files. Ensures GoogleTest and GoogleMock are correctly configured in your build system.

---

## 1. Overview

This page guides you through configuring your C++ project to use GoogleTest and GoogleMock effectively. You'll link required libraries, set up your test directory, and prepare build files, focusing primarily on configuring CMake-based builds. These steps are crucial to ensure your tests compile, link, and run correctly with GoogleTest and GoogleMock.

> **Note:** If you haven't installed GoogleTest/GoogleMock yet, see the [Installation Instructions](../prerequisites-installation/installation-cmake.md).

---

## 2. Prerequisites

- **C++17 or later**: Your compiler must support C++17, as GoogleTest and GoogleMock require it.
- **CMake 3.13 or later**: Minimum CMake version to work with the provided build scripts.
- **GoogleTest and GoogleMock source or installed libraries**: Either downloaded sources or system-installed packages.

> <Check>
> Confirm your environment meets these prerequisites before proceeding with setup.
> </Check>

---

## 3. Directory and Build Setup

### Step 1: Create a Test Directory

Start by structuring your project to include a dedicated directory for tests, typically named `test` or `tests`. This keeps test sources organized separately from production code.

**Example:**
```
/my_project
  /src
  /include
  /test
    test_main.cc
    sample_test.cc
```

### Step 2: Prepare Your `CMakeLists.txt`

In your project's root `CMakeLists.txt`, you need to:

- Include GoogleTest and GoogleMock as subdirectories or find packages if installed.
- Define test executables that link against GoogleTest/GoogleMock.
- Enable CTest support for running tests with `make test` or `ctest`.

Here is a minimal example illustrating essential setup:

```cmake
cmake_minimum_required(VERSION 3.16)
project(MyProject CXX)

# Set C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Optionally add GoogleTest as a subdirectory (replace path as needed)
add_subdirectory(googletest)

# Create executable for your tests
add_executable(my_test test/sample_test.cc)

# Link GoogleTest and GoogleMock libraries
target_link_libraries(my_test PRIVATE gtest_main gmock)

# Enable testing
enable_testing()

# Register test with CTest
add_test(NAME MyTest COMMAND my_test)
```

<Note>
Replace `googletest` in `add_subdirectory` with the relative path to your local GoogleTest folder if embedding it in your project.
</Note>

---

## 4. Linking GoogleTest and GoogleMock

### GoogleTest Libraries

- `gtest`: Core GoogleTest framework library.
- `gtest_main`: Provides a default `main()` function, so you don’t have to write your own.

### GoogleMock Libraries

- `gmock`: GoogleMock mocking framework.
- `gmock_main`: Includes GoogleMock and GoogleTest plus a main function.

### Linking Rules

- To write basic tests without mocks, link with `gtest_main`.
- To use mocking features, link with `gmock_main`.
- If you provide your own `main()`, link against `gtest` or `gmock` without `_main`.

> <Tip>
> Prefer linking with `gtest_main` or `gmock_main` to simplify your test binaries.
> </Tip>

---

## 5. Configure Build Files for Tests

### Build Targets

Create test targets in CMake by associating test source files and linking the necessary libraries.

Example of building a test executable with strict compiler flags for GoogleMock:

```cmake
# Use GoogleMock with stricter compiler flags
add_executable(advanced_mock_tests test/advanced_mock_test.cc)

target_link_libraries(advanced_mock_tests PRIVATE gmock_main)
```

### Compiler Flags and Threading

GoogleTest's CMake build system automatically configures compiler flags, including threading support. Ensure these flags are preserved in your project to avoid linkage errors:

- `-DGTEST_HAS_PTHREAD=1` (on systems supporting pthreads)
- Compiler flags for C++17 standard enforcement

---

## 6. Example Build Process

Assuming you have cloned GoogleTest/GoogleMock, configured your `CMakeLists.txt` as above, and your test sources are ready:

```bash
mkdir build
cd build
cmake ..
cmake --build . --target my_test
ctest
```

- This will compile GoogleTest, GoogleMock, your tests, and run them.
- `ctest` runs registered tests and reports results.

<Info>
If the build or tests fail, verify that GoogleTest and GoogleMock source directories are correctly referenced and that your compiler supports C++17.
</Info>

---

## 7. Best Practices and Tips

- **Keep test code and production code separate.** Use dedicated directories to organize source files.
- **Link only what you need.** If you do not use mocking, avoid linking `gmock` for simplicity.
- **Use `gtest_main` / `gmock_main` libraries** to avoid writing your own `main()` unless customization is required.
- **Ensure consistent compiler flags.** Using GoogleTest’s provided CMake helper functions ensures flag compatibility and thread safety.
- **Avoid mixing static and shared runtimes**, especially on Windows. Use the `gtest_force_shared_crt` option if needed.

---

## 8. Troubleshooting

### Problem: Undefined references to GoogleTest symbols

- Verify that your test target links against `gtest` or `gtest_main`.
- Ensure that GoogleTest source or binaries are correctly added to your build.

### Problem: Compiler complains about missing C++17 features

- Check CMake variable `CMAKE_CXX_STANDARD` is set to at least `17`.
- Confirm your compiler version supports C++17.

### Problem: Tests not discovered or running

- Confirm `enable_testing()` is called in your `CMakeLists.txt`.
- Make sure tests are registered with `add_test()`.

<AccordionGroup title="Common Build Issues & Solutions">
<Accordion title="Linker Errors with Missing Symbols">
Usually caused by forgetting to link against `gtest` or `gmock`. Confirm your CMake linking using `target_link_libraries()` includes the necessary libraries.
</Accordion>
<Accordion title="Compiler Flags Not Applied">
Ensure that the GoogleTest compiler settings are included via `config_compiler_and_linker()` in GoogleTest CMake build or that you pass proper flags like `-std=c++17` in your own build.
</Accordion>
<Accordion title="Multi-threading Issues on Windows">
Set the `gtest_force_shared_crt` option if you get runtime conflicts related to CRT linkage.
</Accordion>
</AccordionGroup>

---

## 9. Next Steps

After configuring your project:

- Move on to [Writing and Running Your First Test](../first-test-setup/writing-running-first-test.md) to learn how to author tests.
- Explore [Test Discovery and Execution](../first-test-setup/test-discovery-execution.md) to understand running and managing test suites.
- Consult [Troubleshooting Common Issues](../../validation-troubleshooting/common-issues.md) for deeper problem-solving.

---

## 10. References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMakeLists.txt for GoogleTest](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [GoogleMock CMake Setup](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [GoogleTest Build Internals](https://github.com/google/googletest/blob/main/googletest/cmake/internal_utils.cmake)
- [System Requirements](../prerequisites-installation/system-requirements.md)

---

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "name": "Project Configuration",
  "description": "Step-by-step configuration for integrating GoogleTest and GoogleMock into your CMake-based C++ project.",
  "url": "https://github.com/google/googletest/tree/main",
  "softwareRequirements": [
    "C++17 compiler",
    "CMake 3.13+",
    "GoogleTest/GoogleMock source or installed packages"
  ],
  "author": {
    "@type": "Person",
    "name": "GoogleTest Documentation Team"
  }
}
</script>
