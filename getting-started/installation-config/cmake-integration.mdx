---
title: "CMake Integration"
description: "Follow focused directions for integrating GoogleTest into your CMake-based project. Explains how to add and configure GoogleTest as a dependency using real-world CMakeLists and sample commands."
---

# CMake Integration

Integrating GoogleTest into your CMake-based project is straightforward and allows you to seamlessly incorporate robust C++ testing capabilities. This guide provides focused instructions on adding GoogleTest as a dependency using CMake's native tools, configuring your project to build tests with GoogleTest, and running your first test suite.

---

## 1. Prerequisites & Environment Setup

Before integrating GoogleTest with CMake, ensure the following:

- **CMake Version:** At least 3.14 is required to use the FetchContent module for automatic download and inclusion.
- **Compiler:** Your C++ compiler must support C++17 or later.
- **Build Tools:** Supported build systems (e.g., Make, Ninja, Visual Studio) compatible with your platform.

If you need details on installation or system requirements, see the [System Requirements](../../getting-started/setup-basics/system-requirements) and [Prerequisites](../../getting-started/setup-basics/prerequisites) pages.

---

## 2. Declaring GoogleTest as a Dependency

The recommended method to add GoogleTest is to use CMake's [`FetchContent`](https://cmake.org/cmake/help/latest/module/FetchContent.html) module. This approach downloads GoogleTest during the configure stage, making maintenance and updates easy.

### Step-by-Step Instructions

1. Create or open your `CMakeLists.txt` in your project root.
2. Add the following snippet at the top of the file to declare GoogleTest:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Include FetchContent module
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# On Windows, force using shared runtime to avoid compiler incompatibilities
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

> Replace the URL commit hash with the latest as needed to stay current.

<Tip>
Setting `gtest_force_shared_crt ON` on Windows ensures GoogleTest uses the same C runtime library as your project, preventing linker errors related to runtime mismatches.
</Tip>

---

## 3. Configuring Your Test Targets

After declaring GoogleTest as a dependency, you need to define your test executables and link against GoogleTest libraries.

### Example: Adding a Test Executable

1. Add this snippet to your `CMakeLists.txt` after the FetchContent section:

```cmake
# Enable testing support in CMake
enable_testing()

# Define your test executable
add_executable(
  hello_test
  hello_test.cc
)

# Link your test executable with GoogleTest main library
# gtest_main provides a main() function for you
target_link_libraries(
  hello_test
  GTest::gtest_main
)

# Use GoogleTest's CMake module to auto-discover tests
include(GoogleTest)
gtest_discover_tests(hello_test)
```

2. Place your test source files, such as `hello_test.cc`, alongside your `CMakeLists.txt` or in subdirectories.

3. Your test source example:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

---

## 4. Building and Running Tests

### Build Steps
From your project root directory, run:

```bash
cmake -S . -B build
cmake --build build
```

This configures and builds your project and all test binaries.

### Run Tests

To run tests and see results:

```bash
cd build
ctest
```

Expected output:

```
Test project /path/to/your/project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
```

---

## 5. Best Practices & Tips

- **Version Pinning:** Regularly update the commit hash or URL to fetch the latest GoogleTest version.
- **Windows Runtime Matching:** Always use `gtest_force_shared_crt ON` on Windows to prevent runtime conflicts.
- **Separate Test Targets:** Define one executable per test suite or logical grouping for easier maintenance.
- **Use `gtest_discover_tests()`:** This CMake function automatically registers your tests with CTest and enables filtered runs.
- **Customize Build Options:** Options such as `gtest_build_samples` or `gtest_build_tests` can be enabled in advanced setups if needed.

---

## 6. Troubleshooting

### Common Issues

| Problem                                        | Solution                                                 |
|------------------------------------------------|----------------------------------------------------------|
| Linker errors about runtime libraries on Windows | Set `gtest_force_shared_crt ON` in your CMakeLists.txt to align runtimes. |
| Tests not being discovered by CTest            | Ensure `include(GoogleTest)` and `gtest_discover_tests()` are called after target creation.
| CMake version too old to use `FetchContent`    | Upgrade to CMake 3.14 or higher.
| Compiler errors about C++ standard              | Make sure to set `CMAKE_CXX_STANDARD 17` and required ON.

<Tip>
If you encounter Windows-specific build issues, check the Visual Studio runtime configuration and GoogleTest's `gtest_force_shared_crt` option.
</Tip>

---

## 7. Next Steps

- Explore the [Primer and Hello Test](../../getting-started/first-run-validation/primer-quickstart) to write and run your first real tests.
- Dive into [Setting Up & Writing Your First Test](../../guides/getting-started/setup-and-first-test) for practical test writing patterns.
- Review the [CMake Integration](./cmake-integration) section regularly for updates and best practices.

---

## References

- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [GoogleTest Official GitHub](https://github.com/google/googletest)
- [CMake FetchContent Documentation](https://cmake.org/cmake/help/latest/module/FetchContent.html)


---

You now have everything to confidently integrate GoogleTest via CMake, build and run tests with minimal effort.

Happy testing!