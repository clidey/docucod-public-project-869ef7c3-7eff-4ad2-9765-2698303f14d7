---
title: "Configuration Basics"
description: "Configure your GoogleTest environment for your project—set required flags, manage dependencies, and tailor initial settings to your workflows for optimal test performance."
---

# Configuration Basics

Configure your GoogleTest environment for your project—set required flags, manage dependencies, and tailor initial settings to your workflows for optimal test performance.

---

## 1. Prerequisites for Configuration

Before diving into configuration, ensure you have the following ready:

- **GoogleTest and GoogleMock Source**: The source code or binaries should be accessible to your project.
- **C++17 Compatible Compiler**: GoogleTest requires a C++17-compliant compiler.
- **Build System Access**: You should be able to configure your build system (e.g., CMake, Bazel) to integrate GoogleTest.

<Tip>
It is best practice to verify your build environment supports C++17 and threading to ensure GoogleTest and GoogleMock operate correctly.
</Tip>

---

## 2. Setting Up GoogleTest Configuration Flags

GoogleTest utilizes several runtime flags to tailor its behavior and integrate smoothly into diverse projects. Configuring these appropriately improves test reliability and diagnostics.

### Essential Runtime Flags

| Flag                                | Purpose                                                         | Default Value |
|------------------------------------|-----------------------------------------------------------------|---------------|
| `--gtest_catch_leaked_mocks`       | Enables catch of leaked mocks to prevent silent test flaws.    | `true`        |
| `--gmock_verbose`                  | Controls Google Mock's message verbosity: `info`, `warning`, `error`. | `warning`     |
| `--gmock_default_mock_behavior`   | Controls default mock object behavior on uninteresting calls.   | `warning`     |

### How to Use Flags

Add these flags when running your test executable, or set them programmatically before running your tests:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  ::testing::GMOCK_FLAG(catch_leaked_mocks) = true;   // Enable leak detection
  ::testing::GMOCK_FLAG(verbose) = "warning";        // Default verbosity

  return RUN_ALL_TESTS();
}
```

<Tip>
Adjust `--gmock_verbose` to `info` during test debugging for detailed call logs; set to `error` for minimal output in CI environments.
</Tip>

---

## 3. Integrating GoogleTest Dependencies

GoogleTest depends on some components that operate best when properly linked and configured.

### Build Dependencies

- **pthread Library:** Required on Unix-like systems for threading support (default in most build environments).
- **Standard C++ Library:** Ensure your compiler's standard library supports C++17 or the features GoogleTest requires.
- **GoogleMock:** When using mocks, include GoogleMock which comes bundled with GoogleTest.

### Configuring with Build Systems

#### Using CMake

1. Add GoogleTest as a subdirectory or find package if installed:

```cmake
add_subdirectory(googletest)  # or find_package(GTest REQUIRED)
```

2. Link your test targets against `gtest` and `gmock`:

```cmake
target_link_libraries(your_test_target PRIVATE gtest gmock pthread)
```

3. Set necessary compile options if needed:

```cmake
set_target_properties(your_test_target PROPERTIES CXX_STANDARD 17)
```

#### Using Bazel

- Use the provided `cc_test` rules with `@com_google_googletest` dependencies.
- Make sure to include `googletest` and `googlemock` repos.

---

## 4. Tailoring Initial Settings for Your Workflows

### Recommended Test Environment Configuration

- **Leak Checks:** Enable `--gtest_catch_leaked_mocks` to catch mock leaks, which usually indicate missing verification or incorrect ownership.
- **Logging Level:** Adjust `--gmock_verbose` depending on your stage:
  - `info`: verbose output for understanding mock invocation and expectation matching.
  - `warning`: default level with essential warnings.
  - `error`: minimal output for CI/logging efficiency.

- **Default Mock Behavior:** By default, mocks warn on uninteresting calls. You can make them strict or nice depending on test strictness needs:
  - `NaggyMock<YourMock>`: warns on unexpected calls.
  - `NiceMock<YourMock>`: suppresses uninteresting call warnings.
  - `StrictMock<YourMock>`: treats unexpected calls as test failures.

<Tip>
Use `NiceMock` in early development to reduce noise, and `StrictMock` when you need rigorous inspection of mock interactions.
</Tip>

---

## 5. Practical Configuration Example

Here is a minimal setup example demonstrating integrating and configuring GoogleTest with GoogleMock in your test suite.

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;
using ::testing::NiceMock;

class MyInterface {
 public:
  virtual ~MyInterface() = default;
  virtual int Compute(int x) = 0;
};

class MockMyInterface : public MyInterface {
 public:
  MOCK_METHOD(int, Compute, (int x), (override));
};

TEST(MyTestSuite, SampleTest) {
  NiceMock<MockMyInterface> mock_obj;

  ON_CALL(mock_obj, Compute).WillByDefault(Return(42));

  EXPECT_CALL(mock_obj, Compute(10)).Times(1).WillOnce(Return(100));

  EXPECT_EQ(mock_obj.Compute(10), 100);  // Uses EXPECT_CALL
  EXPECT_EQ(mock_obj.Compute(20), 42);   // Uses ON_CALL default
}

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);

  // Customize flags as needed
  ::testing::GMOCK_FLAG(catch_leaked_mocks) = true;
  ::testing::GMOCK_FLAG(verbose) = "warning";

  return RUN_ALL_TESTS();
}
```

This setup establishes the default and expected behavior with configuration flags enhancing leak detection and verbosity.

---

## 6. Troubleshooting Configuration Issues

<AccordionGroup title="Common Configuration Pitfalls and Solutions">
<Accordion title="Unrecognized Command Line Flags">
Ensure you invoke `InitGoogleMock` (or `InitGoogleTest` which includes mocks) in your main before running tests. Missing this call means flags won't be parsed properly.
</Accordion>

<Accordion title="Compiler Does Not Support C++17">
Verify that your compiler version supports C++17 features. Many earlier versions result in hard-to-trace errors.
</Accordion>

<Accordion title="Mock Object Leak Warning">
If you see warnings about leaked mock objects, confirm that all mock instances are properly destroyed before test exit. Use `testing::Mock::AllowLeak(mock_ptr)` to suppress intentional leaks, but prefer fixing ownership.
</Accordion>

<Accordion title="Multithreading Issues">
GoogleMock expects you to set expectations before exercising mocks and not to alter expectations from multiple threads simultaneously. Avoid race conditions by properly synchronizing test code.
</Accordion>

<Accordion title="Incorrect Linker or Build Setup">
Check that you link against all required libraries: gtest, gmock, pthread (where applicable) to avoid run-time errors.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps

- Proceed to [Writing Your First Test](../first-test-run/create-first-test) to write your first test with GoogleTest and GoogleMock.
- Refer to the [Installation Guide](../prereq-install/installation-guide) for detailed build system integration and validation.
- Study the [Mocking Reference](../reference/mocking.md) and [gMock Cookbook](../gmock_cook_book.md) for advanced mocking techniques.
- Explore [Troubleshooting Common Setup Issues](../troubleshooting-qa/common-issues) if facing environment problems.

<Check>
Configuration basics are essential for harnessing GoogleTest and GoogleMock efficiently. This guide equips you to set up runtime flags, dependency management, and custom initial settings to ensure smooth testing workflows.
</Check>

---

### References

- [GoogleTest Official Repository](https://github.com/google/googletest)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Mocking Reference](../reference/mocking.md)
- [gMock Cookbook](../gmock_cook_book.md)
- [Installation Guide](../prereq-install/installation-guide)
- [Writing Your First Test](../first-test-run/create-first-test)

---

### Related Diagrams

```mermaid
flowchart TD
  A[Start: Prepare Environment]
  B[Set Compiler to Support C++17]
  C[Include GoogleTest and GoogleMock Sources]
  D[Configure Build system (CMake or Bazel)]
  E[Set Runtime Flags (--gmock_verbose, --gtest_catch_leaked_mocks)]
  F[Write your Mock Classes and Tests]
  G[Run & Verify Tests]
  H[Debug or Adjust Configuration]
  I[Proceed to Writing Your First Test]

  A --> B --> C --> D --> E --> F --> G
  G -->|Success| I
  G -->|Fail| H --> E
```

