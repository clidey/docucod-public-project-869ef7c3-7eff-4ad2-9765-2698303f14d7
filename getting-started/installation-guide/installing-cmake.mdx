---
title: "Installing with CMake"
description: "Step users through acquiring the source, configuring, and building GoogleTest and GoogleMock using CMake, including any post-build environment configuration. Highlight key points for integrating with an existing or new project."
---

# Installing with CMake

This guide walks you through acquiring, configuring, and building GoogleTest and GoogleMock with CMake. Whether you want to build the libraries standalone or integrate them into an existing project, you will find practical, clear steps here.

---

## 1. Prerequisites & Environment Setup

Before starting, ensure your system meets these requirements:

- **Operating System:** Linux, macOS, Windows (all supported)
- **Compiler:** Must support at least C++17. Examples include GCC 7.4+, Clang 5.0+, MSVC 2017+
- **Build Tools:** CMake (minimum 3.13 for building GoogleTest and 3.14+ for FetchContent usage), Make or Ninja or corresponding IDE build system support
- **Network:** Internet access to clone or download libraries

<Tip>
If you don't have CMake installed, download it from [https://cmake.org/](https://cmake.org/) and install according to your OS.
</Tip>


## 2. Acquiring Source Code

You can get the source code by cloning the official repository:

```bash
# Clone the entire googletest repo, which includes GoogleMock
git clone https://github.com/google/googletest.git -b main googletest
cd googletest
```

GoogleMock is included within the repository, so you don't need separate sources.


## 3. Building GoogleTest and GoogleMock Using CMake

### Standalone Build

Follow these steps to build and optionally install GoogleTest and GoogleMock:

<Steps>
<Step title="Create a build directory">

Create an isolated directory for building to keep source files clean:

```bash
mkdir build && cd build
```

</Step>
<Step title="Run CMake configuration">

Generate native build files (Makefile, Visual Studio project, etc). This command by default builds both GoogleTest and GoogleMock:

```bash
cmake ..
```

If you want to build **only GoogleTest** (no GoogleMock), run:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

</Step>
<Step title="Build the libraries">

Use your chosen build tool to compile the binaries. For Make, run:

```bash
make
```

On Windows with Visual Studio, open the generated solution and build.

</Step>
<Step title="Run tests (optional)">

To verify the build, you can run the tests:

```bash
make test
# or alternatively
ctest
```

</Step>
<Step title="Install libraries (optional, requires admin)">

If you want to install the libraries system-wide (default `/usr/local` on Unix):

```bash
sudo make install
```

</Step>
</Steps>

<Note>
On Windows, Visual Studio handles runtime library linkage differently. If you experience runtime library mismatch errors, enable the `gtest_force_shared_crt` option during configuration to use dynamic runtimes:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

</Note>


## 4. Integrating GoogleTest & GoogleMock into Existing CMake Projects

Rather than standalone builds, GoogleTest code can be incorporated directly into your project for better compatibility.

There are two common approaches:

### 4.1 Using Installed Libraries

If GoogleTest and GoogleMock are installed (via `make install` or package manager), import them using `find_package`: 

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_test example_test.cc)
target_link_libraries(my_test PRIVATE GTest::gtest_main GTest::gmock_main)
```

This method depends on proper installation and `pkg-config` or CMake config files being available.

### 4.2 Adding as a Subdirectory Using FetchContent

For tight integration ensuring matching compiler settings, add GoogleTest as a dependency using CMake's `FetchContent` module:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
# Enable dynamic runtime for Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test example_test.cc)
target_link_libraries(my_test PRIVATE gtest_main gmock_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(my_test)
```

Replace the commit hash with the version you want to pin. This downloads GoogleTest & GoogleMock at configure time and builds them as part of your project.

<Tip>
Use this method when you want consistent build definitions (flags, runtime linkage, warnings) across your tests and main project.
</Tip>


## 5. Post-Build Environment Configuration

After building GoogleTest with CMake:

- GoogleMock includes GoogleTest automatically; no extra linking needed aside from `gmock_main` or `gmock`.
- Include directories for both GoogleTest and GoogleMock are exposed via targets (`gtest`, `gmock`) or can be manually added if integrating custom builds.
- If you build shared libraries (DLLs), set `BUILD_SHARED_LIBS=ON` when configuring CMake. Note that linking against shared GoogleTest/GMock requires defining `GTEST_LINKED_AS_SHARED_LIBRARY=1` during compilation, which the CMake files set automatically.


## 6. Verifying Your Build

After building, confirm:

- The expected binaries (`libgtest.a`, `libgmock.a` or `.dll` files) exist in the build output directories.
- Running `ctest` or `make test` runs GoogleTest and GoogleMock's own tests and that all pass.
- Your test executable links and runs successfully against these libraries.

<Tip>
If tests fail or linking errors occur:
- Check that you are using the same C++ standard (C++17) across all builds.
- On Windows, verify runtime library consistency using the `gtest_force_shared_crt` option.
- Confirm thread support is detected correctly; CMake integrates pthread flags as needed.
</Tip>


## 7. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting CMake Build Issues">
<Accordion title="CMake cannot find GoogleTest or GoogleMock after installation">
Make sure you installed the project (`make install`) and that the install paths are in your system's search path. You may need to set `CMAKE_PREFIX_PATH` or `PKG_CONFIG_PATH` to point to the installation directory so that `find_package` or `pkg-config` can locate the `.cmake` or `.pc` files.
</Accordion>
<Accordion title="Linker errors related to missing pthread or threading libraries">
Ensure your system supports pthreads and that CMake found and linked against them automatically. Check for errors during the configuration step about pthreads. On Windows with MinGW, pthreads are disabled by defaultâ€”GoogleTest will use native Windows threading.
</Accordion>
<Accordion title="Runtime library mismatch errors on Windows">
Use the `-Dgtest_force_shared_crt=ON` option when configuring CMake to enforce consistent runtime linkage between your tests and GoogleTest/GMock libraries.
</Accordion>
<Accordion title="Build fails with incompatible C++ standard settings">
Ensure that your project and GoogleTest are using at least C++17 by setting `CMAKE_CXX_STANDARD 17` and `CMAKE_CXX_STANDARD_REQUIRED ON` in your `CMakeLists.txt`.
</Accordion>
</AccordionGroup>

## 8. Summary

You now have everything to download, configure, build, and integrate GoogleTest and GoogleMock using CMake. This setup supports:

- Building both frameworks standalone for testing or installation
- Embedding the source directly into your CMake projects
- Running GoogleTest and GoogleMock's internal tests to verify your build
- Correct threading, compiler, and linker configurations for robust operation

For next steps, see the [Writing Your First Test](../first-test-experience/writing-first-test.md) guide to start creating and running your own tests.

---

## Useful References and Links

- [GoogleTest Repository](https://github.com/google/googletest)
- [GoogleTest CMakeLists.txt (Source)](https://github.com/google/googletest/blob/main/googletest/CMakeLists.txt)
- [GoogleMock CMakeLists.txt (Source)](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [Quickstart with CMake](../quickstart-cmake.md)
- [Using pkg-config with GoogleTest](../docs/pkgconfig.md)
- [FAQ on Build Installation Issues](/faq/troubleshooting/build-install-issues)


# Example Minimal Standalone Build Commands

```bash
git clone https://github.com/google/googletest.git
cd googletest
mkdir build
cd build
cmake ..
make
make test
sudo make install  # optional
```

# Example Integration Snippet for Your Project's CMakeLists.txt

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test my_test.cc)
target_link_libraries(my_test PRIVATE gtest_main gmock_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(my_test)
```

---

This guide ensures you are set up for success with GoogleTest and GoogleMock when using CMake.

---

<Check>
Did you remember to use compatible compiler versions supporting C++17?
Is your build tool compatible with the generated build files?
</Check>

<Info>
If you run into any issues, see the Troubleshooting section or the online community forums.
</Info>
