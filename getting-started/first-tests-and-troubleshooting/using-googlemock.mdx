---
title: "Getting Started with GoogleMock"
description: "Dive into mocking with a basic example that shows how to set up and use GoogleMock alongside GoogleTest. Learn how to define mock classes, set expectations, and verify interactions—with all guidance focused on a first working scenario."
---

# Getting Started with GoogleMock

Welcome to your first step into using **GoogleMock**, GoogleTest's integrated mocking framework. This guide takes you through a basic example that demonstrates how to create your first mock class, set expectations on it, and verify interactions using GoogleMock alongside GoogleTest.

---

## 1. What You'll Achieve Here

By following this guide, you'll:

- Define a mock class for an interface
- Understand how to instantiate mock objects
- Set behaviors and expectations using `ON_CALL` and `EXPECT_CALL`
- Use mocks in a test case and verify interactions automatically

This hands-on approach gets you running your first GoogleMock scenario quickly and correctly.

## 2. Prerequisites

Before you start:

- You have GoogleTest and GoogleMock installed and available in your build system.
- You're familiar with basic C++ and have written simple tests using GoogleTest.
- Your project links against gMock and gTest libraries.

> For installation instructions, see [Setup & Installation](https://google.github.io/googletest/getting-started/setup-and-installation/prerequisites-system-requirements).

## 3. Defining a Mock Class

Mock classes replace real dependencies by mimicking their interfaces and letting you control their behavior.

### Step 1: Declare the Interface (Abstract Class)

Imagine you have an interface you want to mock:

```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(int type) = 0;
};
```

- Note the virtual destructor, a must-have for interfaces to avoid memory leaks.

### Step 2: Create the Mock Class

Derive a new class from your interface and use `MOCK_METHOD()` to mock each virtual method.

```cpp
#include <gmock/gmock.h>  // Pull in GoogleMock macros

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
};
```

- `MOCK_METHOD` parameters are: return type, method name, argument list (in parentheses), and optional qualifiers.
- Mark const and override where required.

## 4. Writing a Test Using the Mock

GoogleMock integrates with GoogleTest. Here's a step-by-step example to see your mock in action.

### Step 1: Include Required Headers

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

### Step 2: Import GoogleMock Symbols

```cpp
using ::testing::Return;
```

### Step 3: Write Your Test

```cpp
TEST(FooTest, DescribeCalledWithExpectedArgument) {
  MockFoo foo;  // Create mock object

  // Set default behavior for GetSize()
  ON_CALL(foo, GetSize())
      .WillByDefault(Return(5));

  // Expect Describe to be called with 42 exactly once and return "Answer"
  EXPECT_CALL(foo, Describe(42))
      .Times(1)
      .WillOnce(Return("Answer"));

  // Code under test uses foo
  EXPECT_EQ(foo.GetSize(), 5);             // Default action
  std::string desc = foo.Describe(42);     // Expected call
  EXPECT_EQ(desc, "Answer");
}
```

### What Happens Here?

- `ON_CALL` specifies default behavior when you don’t need to strictly expect a call.
- `EXPECT_CALL` sets an expectation and specifies what to return when the method is called.
- gMock verifies that all `EXPECT_CALL` expectations are met when the mock object is destroyed.

## 5. Running Your First GoogleMock Test

- Compile with GoogleTest and GoogleMock linked.
- Run the test executable.

If the test passes, it verifies that your mock method was called as expected and behaved accordingly.

If it fails, GoogleMock will report which expectations were unmet or violated.

## 6. Best Practices & Tips

- **Always place `EXPECT_CALL` before exercising the mocked object.** Expectation order matters.
- Use `_` matcher when argument values are not important.

  ```cpp
  EXPECT_CALL(foo, Describe(_))
      .WillRepeatedly(Return("Default"));
  ```

- Use `NiceMock` to suppress uninteresting call warnings:

  ```cpp
  using ::testing::NiceMock;
  NiceMock<MockFoo> nice_foo;
  ```

- To enforce strict checking where any unexpected call fails the test, use:

  ```cpp
  using ::testing::StrictMock;
  StrictMock<MockFoo> strict_foo;
  ```

- When mocking overloaded methods, mock **all** overloads to avoid hiding base class methods.

  ```cpp
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  ```

## 7. Troubleshooting

### Common Issues

- **Expectations not met:** Ensure that `EXPECT_CALL` is set before method invocation.
- **Unexpected calls warnings:** Use `NiceMock` or explicitly add `EXPECT_CALL(...).Times(AnyNumber())`.
- **Missed mock method due to const correctness:** Make sure you add `(const)` qualifier when mocking const methods.
- **Compiler errors about parsing argument lists with commas:** Wrap complex argument types with extra parentheses or use type aliases.

### Verification

Mocks automatically verify expectations on destruction. To verify manually before then:

```cpp
using ::testing::Mock;
Mock::VerifyAndClearExpectations(&foo);
```

Avoid setting new expectations after this call.

## 8. Next Steps

- Explore [Mocking Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes and advanced usage.
- Learn about matchers to specify complex argument matching.
- Dive into [GoogleTest Primer](https://google.github.io/googletest/primer.html) to master test writing.
- Investigate integration with your build system for efficient test automation.

---

Happy mocking! You're now equipped to write your first GoogleMock-powered test.

---

## References

- [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [GoogleTest Setup & Installation](https://google.github.io/googletest/getting-started/setup-and-installation/prerequisites-system-requirements)
- [Mocking for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)


---

## Sample Code Block for Copy-Paste

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Return;

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(int type) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
};

TEST(FooTest, BasicUsage) {
  MockFoo foo;

  ON_CALL(foo, GetSize())
      .WillByDefault(Return(42));

  EXPECT_CALL(foo, Describe(7))
      .Times(1)
      .WillOnce(Return("Seven"));

  EXPECT_EQ(foo.GetSize(), 42);
  EXPECT_EQ(foo.Describe(7), "Seven");
}

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```
