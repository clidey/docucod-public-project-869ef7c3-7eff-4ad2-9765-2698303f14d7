---
title: "Installing with CMake"
description: "Guides users through building and integrating GoogleTest using CMake, including adding to their own project's build setup. Ensures the library is properly built and linked."
---

# Installing with CMake

This guide walks you through building and integrating GoogleTest using CMake. You'll learn how to configure, build, and link GoogleTest properly within your project, ensuring seamless test compilation and execution.

---

## 1. Prerequisites & System Requirements

Before you begin, make sure your environment meets the following requirements:

- **C++ Standard:** Your compiler must support **C++17** or later.
- **Operating System:** GoogleTest supports Linux, macOS, Windows, and other Unix-like platforms.
- **CMake Version:** Minimum **3.13** (ideally 3.14 or later for `FetchContent` features).
- **Build Tools:** Compatible with Make, Ninja, Visual Studio, Xcode, and others supported by CMake.
- **Threads:** pthread support is enabled by default unless explicitly disabled.

<Tip>
If your environment lacks pthreads or has special threading constraints, adjust the `gtest_disable_pthreads` option during configuration.
</Tip>

---

## 2. Setting Up GoogleTest with CMake

GoogleTest can be built either as a standalone project or integrated directly into your existing CMake-based project. This section covers both scenarios.

### 2.1 Standalone Build

Follow these steps to clone, configure, build, and optionally install GoogleTest independently.

<Steps>
<Step title="Clone the Repository">
Run the following commands to obtain GoogleTest source code:

```bash
git clone https://github.com/google/googletest.git -b main
d
```
Navigate to the repository's root:

```bash
cd googletest
```
</Step>

<Step title="Create a Build Directory">
To keep build files organized, create and enter a dedicated directory:

```bash
mkdir build
cd build
```
</Step>

<Step title="Configure with CMake">
Generate your native build system using CMake:

```bash
cmake ..
```
By default, this includes GoogleMock along with GoogleTest. To build only GoogleTest:

```bash
cmake .. -DBUILD_GMOCK=OFF
```
</Step>

<Step title="Build the Libraries">
Build GoogleTest (and GoogleMock if enabled) with:

```bash
make
```
Or on Windows, open the generated solution file (`.sln`) in Visual Studio and build.
</Step>

<Step title="(Optional) Install GoogleTest">
If you want to install the libraries and headers system-wide (requires admin permissions):

```bash
sudo make install
```
Installation places files under `/usr/local` by default; adjust with `CMAKE_INSTALL_PREFIX` if needed.
</Step>
</Steps>

### 2.2 Incorporating GoogleTest into Your CMake Project

Embedding GoogleTest in your existing CMake project ensures consistent compiler and linker settings, avoiding runtime conflicts.

#### Preferred Integration Workflow Using `FetchContent`

Add the following snippet at the top of your `CMakeLists.txt`:

```cmake
cmake_minimum_required(VERSION 3.14)
project(your_project_name)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)

# For Windows: Ensure consistent runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

This downloads and makes GoogleTest available in your build automatically.

#### Linking GoogleTest in Your Targets

After including GoogleTest, link it to your test executable:

```cmake
add_executable(your_test_executable test_source_file.cc)
target_link_libraries(your_test_executable GTest::gtest_main)

# Enable CTest integration for test discovery
include(GoogleTest)
gtest_discover_tests(your_test_executable)
```

<Tip>
Using `GTest::gtest_main` automatically provides a `main()` function, simplifying your test binaries.
</Tip>

---

## 3. Configuration and Custom Build Options

GoogleTest offers several options to tailor the build process:

| Option                      | Description                                         | Default   |
|-----------------------------|-----------------------------------------------------|-----------|
| `BUILD_SHARED_LIBS`          | Build libraries as shared (DLL) or static           | OFF       |
| `gtest_force_shared_crt`     | On Windows, link CRT dynamically (matches project) | OFF       |
| `gtest_build_tests`          | Build GoogleTest's own tests                         | OFF       |
| `gtest_disable_pthreads`     | Disable pthread support                              | OFF       |
| `gtest_hide_internal_symbols`| Hide internal symbols in shared libs                | OFF       |

Modify these during CMake configuration, for example:

```bash
cmake .. -DBUILD_SHARED_LIBS=ON -Dgtest_build_tests=ON
```

<Tip>
If building on Windows with Visual Studio, enabling `gtest_force_shared_crt` avoids common runtime conflicts.
</Tip>

---

## 4. Verifying Your Build

### 4.1 Confirm Build Artifacts

After building, you should see:

- `libgtest.a` or equivalent static/shared library
- `libgtest_main.a` including the `main()` function
- Binaries for sample tests if `gtest_build_samples` is enabled

On Windows, `.lib` and `.dll` files will be produced if building shared libraries.

### 4.2 Run Built-In Tests

If you enabled `gtest_build_tests`, verify by running:

```bash
ctest
```

You should see output that your tests have passed, confirming a valid build.

<Tip>
If `ctest` is unavailable, you can manually run test executables from the `build` directory.
</Tip>

---

## 5. Using GoogleTest in Your Project

Once built and integrated, you use GoogleTest by including its headers:

```cpp
#include <gtest/gtest.h>
```

Compile your test binaries linking to `GTest::gtest` or `GTest::gtest_main` (for automatic main).

The recommended workflow in CMake is:

1. Define your test binaries with `add_executable()`.
2. Link with GoogleTest libraries.
3. Use `gtest_discover_tests()` to integrate with CTest.

This setup lets you build and run all your tests seamlessly.

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Installation and Build Issues">
<Accordion title="Mismatch in Runtime Libraries on Windows">
If you encounter errors like `mismatch detected for 'RuntimeLibrary'`:

- Use the `-Dgtest_force_shared_crt=ON` option to align CRT linkage with your project.
- Ensure your project and GoogleTest share the same runtime linkage (dynamic/static).
</Accordion>

<Accordion title="Pthread Not Found or Link Errors">
- If pthread support is missing or causing link errors, disable it with:

```
-DBUILD_GMOCK=OFF -Dgtest_disable_pthreads=ON
```

- Alternatively, ensure your build environment supports pthreads or the equivalent threading library.
</Accordion>

<Accordion title="C++ Standard Compatibility">
- GoogleTest requires at least C++17.
- If you use an earlier standard, update your compiler or explicitly set `set(CMAKE_CXX_STANDARD 17)` in your `CMakeLists.txt`.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps

- Explore the [Getting Started & Next Steps](https://github.com/google/googletest/blob/main/docs/getting-started.md) guide to learn how to write your first tests.
- Review the [Integration with C++ Environments](https://github.com/google/googletest/blob/main/overview/integration-getting-started/integration-with-environments.mdx) to optimize build system compatibility.
- Consult the [GoogleTest Primer](primer.md) for usage patterns and best practices.


---

## References

- Official GoogleTest Repository: https://github.com/google/googletest
- CMake Documentation: https://cmake.org/documentation/
- GoogleTest Build CMakeLists.txt: [CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- `FetchContent` module: https://cmake.org/cmake/help/latest/module/FetchContent.html


---

If you want to dive deeper into configuring features or building samples/tests, consult the official CMake scripts or extend your `CMakeLists.txt` accordingly.

---

*This guide is focused solely on the installation and build setup using CMake to get you started with GoogleTest quickly and reliably.*
