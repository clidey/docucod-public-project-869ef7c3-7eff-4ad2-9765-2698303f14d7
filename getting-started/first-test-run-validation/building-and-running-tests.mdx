---
title: "Building and Running Tests"
description: "Explains the steps to compile and link test code, execute test binaries, and interpret output. Includes coverage of platform-specific commands, automation with presubmit scripts, and advice on main entry points."
---

# Building and Running Tests

This guide explains how to compile, link, and execute your GoogleTest and GoogleMock test binaries. It will help you build test code from source, run the resulting test executables, interpret the output, and understand platform-specific considerations and automation options.

---

## 1. Prerequisites and Overview

Before building and running tests, ensure you have:

- A compatible C++17 compiler (GCC, Clang, MSVC) and build tools installed.
- GoogleTest and GoogleMock sources configured in your build system (typically CMake).
- Your test source files written using GoogleTest/GoogleMock APIs.

Your objective in this phase is to compile your test code, link against GoogleTest and GoogleMock libraries (e.g., `gmock_main`), and generate executable test binaries.

---

## 2. Building Tests

### 2.1 Link against GoogleMock Libraries

When linking your test program, link against `gmock_main` if you want to use the default `main()` function provided by GoogleMock, which initializes the test framework and runs all tests automatically.

```cmake
# In your CMakeLists.txt
add_executable(my_test my_test.cc)
target_link_libraries(my_test PRIVATE gmock_main)
```

**Tip:** If you want to define a custom `main()`, link against `gmock` instead and implement your own initialization with `testing::InitGoogleMock()`.

### 2.2 Typical Build Steps

If using CMake from the command line:

```bash
mkdir -p build && cd build
cmake ..
cmake --build .
```

This compiles all tests and produces test executables.

---

## 3. Running Test Binaries

### 3.1 Execute the Test

Run your test binary directly from the command line:

```bash
./my_test
```

On Windows, double-click the `.exe` file or run it from the command prompt.

### 3.2 What Happens When You Run Tests

- The program initializes GoogleMock (which also initializes GoogleTest).
- `RUN_ALL_TESTS()` runs all registered tests discovered during linking.
- Test results are printed to standard output.
- The return code is `0` if all tests pass; otherwise, non-zero.

### 3.3 Interpreting Test Output

The output shows each test case and test name with a pass/fail status. Failures provide detailed information, including the source file, line number, and the failed assertion.

Example output snippet:

```
[ RUN      ] FactorialTest.HandlesZeroInput
[       OK ] FactorialTest.HandlesZeroInput (0 ms)
[ RUN      ] FactorialTest.HandlesPositiveInput
...output...
[  FAILED  ] FactorialTest.HandlesPositiveInput (1 ms)

...number of tests...

SUMMARY: Passed 1 test, Failed 1 test.
```

### 3.4 Exit Status

Your program's exit code should always be used to determine test success for automated systems. Return the value of `RUN_ALL_TESTS()` in your `main()` function.

---

## 4. Platform-Specific Notes

### 4.1 Windows Considerations

- GoogleMock uses `main()` by default unless you provide a custom entry point.
- The MSVC compiler has known issues with `_tmain` entry points in static libraries. `gmock_main` handles this internally.

### 4.2 Embedded and Arduino-Like Platforms

For platforms like ESP8266 or ESP32, GoogleMock hooks into Arduino lifecycle functions:

```cpp
void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

This integration enables GoogleMock on embedded systems that lack traditional `main()`.

---

## 5. Automation with Presubmit and Continuous Integration

To integrate tests into automation pipelines:

- Run test binaries post-build and validate exit codes.
- Use test output for log inspection and debugging.
- Implement test filtering and sharding via command-line flags to distribute tests.

Example running tests with filtering:

```bash
./my_test --gtest_filter=MySuite.*
```

Integrating into presubmit scripts typically involves adding commands to execute your test binaries with flags and checking results.

---

## 6. Best Practices

- **Always initialize GoogleMock** or GoogleTest in your `main()` or equivalent before running tests.
- **Use provided `gmock_main` library** for straightforward setup with `main()`.
- **Verify test binaries exit cleanly with code 0** on all tests passing.
- **Inspect test failures in output** to debug expected vs. actual results.
- **Filter tests during development** to speed up iteration.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Problems and Solutions">
<Accordion title="Linker Errors with Multiple 'main' Definitions">
When you link your tests, avoid including multiple definitions of `main()`. Use `gmock_main` or `gtest_main` libraries, but not both.

**Solution:** Link only with `gmock_main` if you want the GoogleMock `main()`. Provide a custom `main()` when linking with `gmock` alone.
</Accordion>
<Accordion title="Test Binaries Run but No Output Is Visible">
If your test binary runs but produces no output:

- Verify that `RUN_ALL_TESTS()` is called.
- Ensure that `testing::InitGoogleMock()` or `testing::InitGoogleTest()` is invoked before running tests.
- On some embedded platforms, check the integration with event loops.
</Accordion>
<Accordion title="Tests Fail to Run or Return Unexpected Exit Code">
- Confirm all test files are compiled and linked.
- Check that the environment supports multithreading if required.
- Look for exceptions or crashes that cause abnormal termination.
</Accordion>
</AccordionGroup>

---

## 8. Example `main()` Function

For cases where you want a custom entry:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  // Initialize GoogleMock (also initializes GoogleTest)
  testing::InitGoogleMock(&argc, argv);

  // Run all tests registered with the framework
  return RUN_ALL_TESTS();
}
```

This is equivalent to what `gmock_main` library provides.

---

## 9. Additional Resources

- [Writing Your First Test](https://google.github.io/googletest/quickstart.html)
- [Configuring Projects with GoogleTest](https://google.github.io/googletest/faq.html#how-do-i-use-googletest-in-my-own-project)
- [GoogleMock Reference](https://google.github.io/googletest/gmock_for_dummies.html)
- [GoogleTest Primer](../getting-started/first-test-run-validation/writing-your-first-test.md)

Use these to deepen your understanding and extend your testing capabilities.

---

_Last updated: branch `main`_

---

<Check>
Remember: Always return the result of `RUN_ALL_TESTS()` from your `main()` function to correctly signal test success or failure to external tools.
</Check>

<Note>
Using the default `main()` provided by `gmock_main` simplifies setup but you can customize test initialization if needed.
</Note>

---