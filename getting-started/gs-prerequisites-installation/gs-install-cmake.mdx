---
title: "Installing with CMake"
description: "Step-by-step instructions for integrating GoogleTest with your CMake workflow. Highlights fetching and building as an external project, using CMake's FetchContent or add_subdirectory, and validating the static/shared library targets."
---

# Installing with CMake

This guide takes you through integrating GoogleTest into your CMake-based C++ projects. You'll learn how to fetch and build GoogleTest as an external project, configure your test targets, and validate the library targets.

---

## 1. Prerequisites & System Requirements

- **Operating System**: Linux, macOS, Windows, or other supported platforms.
- **Compiler**: Must support at least C++17.
- **CMake Version**: Minimum version 3.14 recommended (due to use of `FetchContent_MakeAvailable`).
- **Build Tools**: Make, Ninja, or other tools compatible with your CMake generator.

<Note>
Ensure your compiler and build toolchain fully support C++17 features as GoogleTest relies on them.
</Note>

---

## 2. Fetching and Building GoogleTest in Your CMake Project

### Step 1: Create Your Project Directory

Open your terminal and create a new directory for your project. Then navigate into it:

```bash
mkdir my_project && cd my_project
```

### Step 2: Create a Basic `CMakeLists.txt`

Create the CMake configuration to fetch and make GoogleTest available at configure time.

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Include FetchContent to automatically download dependencies
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# On Windows, enforce shared CRT linkage to match runtime
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

<Info>
The URL points to a specific Git commit for version consistency. Update this hash regularly to use the latest GoogleTest version.
</Info>

---

## 3. Adding a Test Executable

To demonstrate how to use GoogleTest, you will build a simple test executable.

### Step 1: Create a Test Source File

Create a file named `hello_test.cc` in your project directory with the following content:

```cpp
#include <gtest/gtest.h>

// Basic test example
TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");  // Expect strings to differ
  EXPECT_EQ(7 * 6, 42);              // Expect equality
}
```

### Step 2: Extend Your `CMakeLists.txt`

Add the build instructions for your test binary and link it to GoogleTest.

```cmake
# Enable testing functionality
enable_testing()

# Define the executable target
add_executable(hello_test hello_test.cc)

# Link with GoogleTest's main library
target_link_libraries(hello_test GTest::gtest_main)

# Enable CTest discovery of GoogleTest cases
include(GoogleTest)
gtest_discover_tests(hello_test)
```

---

## 4. Building and Running Your Tests

### Step 1: Generate Build Files

Run CMake to configure your build in a separate directory:

```bash
cmake -S . -B build
```

You should see compiler and project information confirming successful configuration.

### Step 2: Build the Project

Build your test executable:

```bash
cmake --build build
```

This will compile GoogleTest as an external project, compile your test, and link them together.

### Step 3: Run Your Tests

Invoke the test runner to execute all discovered tests:

```bash
cd build
ctest
```

You should see output like:

```
Test project /path/to/my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

Congratulations! Your GoogleTest integration with CMake is working.

---

## 5. Alternative: Incorporating GoogleTest Using `add_subdirectory()`

If you prefer building GoogleTest directly from source as part of your project (e.g., using a git submodule), you can add the GoogleTest source tree and link your tests directly.

### Example `CMakeLists.txt`

```cmake
cmake_minimum_required(VERSION 3.16)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Assume googletest source is in subdirectory 'googletest'
add_subdirectory(googletest)

enable_testing()

add_executable(hello_test hello_test.cc)

# Link with gtest_main target provided by googletest
target_link_libraries(hello_test gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

This approach ensures GoogleTest and your project are built with consistent compiler flags.

---

## 6. Validating Library Targets

When building via CMake, GoogleTest defines the following targets:

- `GTest::gtest` — The main GoogleTest library without `main()`.
- `GTest::gtest_main` — GoogleTest library including a `main()` function.

Use `GTest::gtest_main` for most cases where you want to build a test executable easily.

You can verify these targets exist after fetching GoogleTest by running:

```bash
cmake --build build --target help
```

Look for `GTest::gtest` and `GTest::gtest_main` in the available targets.

---

## 7. Best Practices

- **Keep C++17 as minimum standard level.** GoogleTest requires modern C++ to function correctly.
- **Use `FetchContent` for automatic dependencies.** This keeps your build self-contained and easy to configure.
- **On Windows, set `gtest_force_shared_crt` ON.** Avoids runtime conflicts between static and dynamic CRT libraries.
- **Use `gtest_discover_tests()` to enable flexible test discovery.** Without it, tests may not be automatically found by CTest.

---

## 8. Troubleshooting

<AccordionGroup title="Common Issues When Installing with CMake">
<Accordion title="GoogleTest Not Found by CMake">
If CMake can't find GoogleTest, ensure your `FetchContent` setup is correct and your CMake version is 3.14 or later. Also verify you have network access to GitHub.
</Accordion>
<Accordion title="Linker Errors Related to CRT Mismatch on Windows">
On Windows, mismatches between static and dynamic runtimes cause linker errors.
Make sure to set `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` in your `CMakeLists.txt`.
</Accordion>
<Accordion title="Tests Are Not Discovered by CTest">
Confirm you have called `include(GoogleTest)` and `gtest_discover_tests()` after creating your test executable target.
</Accordion>
</AccordionGroup>

---

## 9. Next Steps

- Explore writing more tests with advanced GoogleTest features.
- Visit [Writing and Running Your First Test](../gs-configuration-first-test/gs-first-test) for test authoring guidance.
- Learn about mocking with [Getting Started with Mocks (GoogleMock)](../gs-configuration-first-test/gs-mock-first-steps).

---

## References and Related Documentation

- Official GoogleTest repository: https://github.com/google/googletest
- [GoogleTest Primer](../overview/introduction-getting-started/what-is-googletest)
- [CMake Tutorial](https://cmake.org/cmake/help/latest/guide/tutorial/index.html)
- [pkg-config usage with GoogleTest](../docs/pkgconfig.md)
- [Integrating GoogleTest/GoogleMock with Your Build System](../../guides/integration-advanced/integrating-build-systems)

---

Your application is now ready for robust, automated C++ testing using GoogleTest and CMake. Happy testing!
