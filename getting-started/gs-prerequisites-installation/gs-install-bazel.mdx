---
title: "Installing with Bazel"
description: "Guides users through adding GoogleTest and GoogleMock as Bazel dependencies. Includes WORKSPACE setup, MODULE.bazel, and example BUILD.bazel files for defining and linking test targets."
---

# Installing with Bazel

This guide walks you through adding GoogleTest and GoogleMock to your Bazel build system. You will learn how to configure your `WORKSPACE` and `MODULE.bazel` files to declare dependencies, create example `BUILD.bazel` files for test targets, and run your first test binary using Bazel.

---

## 1. Prerequisites & System Requirements

Before proceeding, ensure your environment meets the following requirements:

- **Operating System**: Linux, macOS, or Windows supported.
- **Compiler**: A C++ compiler supporting at least C++17.
- **Bazel Version**: Bazel 7.0 or later installed.
  
If Bazel is not installed, visit the [Bazel installation guide](https://bazel.build/install).

<Tip>
Commands shown here assume a Unix-like shell but work similarly on Windows command line.
</Tip>

---

## 2. Setting Up Your Bazel Workspace

A Bazel workspace is the root directory where your source files, dependencies, and build configuration reside.

### Step 1: Create Your Workspace Directory

Open a terminal and execute:

```sh
mkdir my_workspace && cd my_workspace
```

### Step 2: Define Your Dependencies in `MODULE.bazel`

Starting with Bazel 7.0, GoogleTest is best used through the Bazel Central Registry. In your workspace root, create a file named `MODULE.bazel` with the following content:

```python
# MODULE.bazel

# Specify the latest tested GoogleTest version.
bazel_dep(name = "googletest", version = "1.17.0")
```

<Note>
Always check [Bazel Central Registry for GoogleTest](https://registry.bazel.build/modules/googletest) to use the most recent stable version.
</Note>

---

## 3. Creating & Linking Your Test Target

With dependencies declared, you can write test code and let Bazel know how to build it.

### Step 1: Create a Sample Test File

Inside `my_workspace`, create a file named `hello_test.cc` with the following simple GoogleTest example:

```cpp
#include <gtest/gtest.h>

// Simple test that checks basic assertions.
TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");  // Strings should not be equal.
  EXPECT_EQ(7 * 6, 42);               // Numeric equality.
}
```

### Step 2: Define the Test Target in `BUILD.bazel`

Create a file named `BUILD.bazel` in the same directory with the following content:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

- `cc_test` declares a C++ test binary.
- `deps` links against GoogleTest libraries that provide the testing framework and the main entry.

<Info>
If your compiler defaults to a version older than C++17, explicitly instruct Bazel to use C++17 by adding the `--cxxopt=-std=c++17` flag during build and test.
</Info>

---

## 4. Building and Running Your First Test

### Step 1: Build and Run Tests

Use the following command to build and run your test, showing detailed output:

```sh
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

### Expected Output Summary:

- Bazel analyzes your test target and dependencies.
- Your test binary runs, showing GoogleTest’s standard test run output.
- The test should pass for the provided example.

<Tip>
If the test fails to run or compile, verify your Bazel version (`bazel version`) is 7.0 or higher, and confirm that your system C++ compiler supports C++17.
</Tip>

---

## 5. Adding GoogleMock with Bazel

GoogleMock extends GoogleTest for mock object support.

### Step 1: Add GoogleMock Dependency

GoogleMock is included within the `googletest` module distributed via Bazel Central Registry, so including `googletest` as above suffices.

### Step 2: Link GoogleMock in Your Test Targets

In your `BUILD.bazel` file, add dependencies for GoogleMock:

```python
cc_test(
    name = "mock_example_test",
    srcs = ["mock_example_test.cc"],
    deps = [
        "@googletest//:gmock",
        "@googletest//:gmock_main",
    ],
)
```

- `@googletest//:gmock` links the core GoogleMock library.
- `@googletest//:gmock_main` links the main function supporting GoogleMock tests.

<Tip>
Ensure your test source (`mock_example_test.cc`) includes the GoogleMock headers and initializes GoogleMock appropriately (calling `testing::InitGoogleMock()`).
</Tip>

---

## 6. Best Practices

- **Version Pinning:** Always specify an exact version in `MODULE.bazel` to ensure reproducible builds.
- **Consistent Compiler Flags:** Pass `--cxxopt=-std=c++17` consistently for build and test to avoid standard mismatches.
- **Use Bazel Central Registry:** Avoid managing GoogleTest/GoogleMock source code manually when possible.
- **Separate Test Targets:** Define different test targets for GoogleTest and GoogleMock-based tests for clarity and modularity.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Bazel Dependency Resolution Issues">
<Accordion title="Bazel Fails to Fetch googletest Module">
- Verify Internet connectivity.
- Check syntax in `MODULE.bazel` for typos.
- Confirm Bazel version is 7.0 or higher, as module support improved significantly in 7.0.
</Accordion>
<Accordion title="Compilation Errors Relating to C++ Standard">
- Always add `--cxxopt=-std=c++17` to your `bazel build` and `bazel test` commands.
- Check your compiler supports C++17 or later.
</Accordion>
<Accordion title="Linking Errors for gtest_main or gmock_main">
- Ensure you depend on `@googletest//:gtest_main` or `@googletest//:gmock_main` respectively in your `BUILD.bazel` file.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps

- Explore writing more comprehensive tests with [GoogleTest Primer](primer.md).
- Learn about mock objects and advanced mocking patterns with [GoogleMock Getting Started](gs-mock-first-steps.md).
- Study the [Bazel C++ Tutorial](https://docs.bazel.build/versions/main/tutorial/cpp.html) for deeper Bazel usage.

<Check>
You have successfully set up GoogleTest and GoogleMock with Bazel, built your first test, and ran it with detailed output. You’re ready to expand your test suite!
</Check>

---

## Appendix: Example Workspace Structure

```
my_workspace/
  ├── MODULE.bazel           # Bazel module dependencies
  ├── BUILD.bazel            # Build rules for tests
  ├── hello_test.cc          # Sample GoogleTest test file
  ├── mock_example_test.cc   # Sample GoogleMock test file (optional)
```


---

## Reference
- [Bazel Central Registry - googletest](https://registry.bazel.build/modules/googletest)
- [Bazel Modules Documentation](https://docs.bazel.build/versions/main/modules/index.html)
- [GoogleTest Primer](primer.md)
- [Bazel C++ Tutorial](https://docs.bazel.build/versions/main/tutorial/cpp.html)
