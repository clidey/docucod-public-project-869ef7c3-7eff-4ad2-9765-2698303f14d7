---
title: "Project Setup and Configuration"
description: "A walk-through for configuring your project to use GoogleTest, including linking, include paths, and environment settings. Learn how to structure project files and ensure GoogleTest and GoogleMock are correctly referenced in your build process."
---

# Project Setup and Configuration

Welcome to the configuration guide for integrating **GoogleTest** and **GoogleMock** into your C++ project. This document walks you through structuring your project files, linking against GoogleTest and GoogleMock, and setting up your environment so your tests build and run smoothly.

---

## 1. Overview

Setting up GoogleTest and GoogleMock requires correct linking, including headers, and properly referencing the libraries in your build process. This page focuses on practical instructions that enable your project to fully leverage GoogleTest and GoogleMock's powerful mocking and testing capabilities.

---

## 2. Prerequisites

- You must have **GoogleTest** installed or vendored in your project. GoogleMock is bundled with GoogleTest.
- Your build system should support linking against GoogleTest and GoogleMock libraries.
- Your compiler should support the appropriate C++ standard (typically C++11 or later).
- Ensure your tested interfaces have virtual destructors to avoid runtime errors.

See [Prerequisites and System Requirements](../getting-started/essentials/prerequisites-requirements) for detailed platform and compiler requirements.

---

## 3. Structuring Your Project

A well-structured project simplifies integration and future maintenance.

### Typical Layout Example

```text
project_root/
├── include/               # Project headers
│   └── your_code/         # Your interface and implementation headers
├── src/                   # Source files
│   └── ...
├── tests/                 # Test source files
│   ├── mocks/             # Mock classes headers and sources
│   │   └── mock_foo.h     # Example mock class header
│   └── your_code_test.cc  # Test files using GoogleTest and GoogleMock
├── CMakeLists.txt         # Or other build config
└── third_party/           # Vendored dependencies (optional)
    └── googletest/        # GoogleTest/GoogleMock sources (if vendored)
```

### Where to Put Your Mocks

- Define mock classes in the `tests/mocks/` directory or close to the tests that use them.
- Ideally, mock classes should be in headers if consumed by multiple test targets.
- Define mocks close to the code under test's ownership boundary to reduce maintenance overhead.

---

## 4. Including GoogleTest and GoogleMock

To use GoogleTest and GoogleMock in your test files:

1. Include the main GoogleMock header:

```cpp
#include <gmock/gmock.h>  // Includes GoogleTest as well
```

2. Use the relevant namespaces or import names for convenience:

```cpp
using ::testing::Test;
using ::testing::NiceMock;
using ::testing::StrictMock;
using ::testing::_;
```

---

## 5. Linker Configuration and Build Setup

Your build tool must:

- Include GoogleTest and GoogleMock headers in your compiler include paths.
- Link with GoogleTest and GoogleMock libraries.

### Build System Instructions

#### Using CMake

1. **Find GoogleTest Package**

If installed system-wide or via package managers:

```cmake
find_package(GTest REQUIRED)
```

2. **Add Executable and Link**

```cmake
add_executable(your_tests tests/your_code_test.cc)
target_link_libraries(your_tests GTest::gmock_main GTest::gtest_main pthread)  # pthread for Linux
```

3. **Include Directories**

CMake target dependencies transitively add include directories.

4. **Enable C++11 or Later**

```cmake
set_target_properties(your_tests PROPERTIES
    CXX_STANDARD 11
    CXX_STANDARD_REQUIRED YES
)
```

#### Using Bazel

- Declare dependencies on `@com_google_googletest` targets in your `BUILD` files.
- Use `cc_test` rules and specify `deps` on GoogleTest and GoogleMock.

#### Manually With Make or Other Tools

- Add the GoogleTest and GoogleMock include paths to `-I` compiler flags.
- Link against `libgmock.a` and `libgtest.a` (or their shared equivalents).
- Link against pthread if on Linux.

### Common Pitfalls

- Forgetting to mark tested classes with virtual destructors leads to memory leaks.
- Mismatched C++ standards between your code and GoogleTest cause compilation errors.
- Missing linking to pthread on Linux causes linking failures.

---

## 6. Environment Settings

- Ensure your environment variables include your compiler and linker paths.
- Disable any compiler flags incompatible with GoogleTest/GoogleMock.

---

## 7. Example Mock Class Setup

Suppose you have an interface `Foo`:

```cpp
class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetSize() const = 0;
  virtual bool IsEmpty() const = 0;
};
```

Define a mock class in a header (e.g., `mock_foo.h`) in your `tests/mocks/` directory:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(bool, IsEmpty, (), (const, override));
};
```

Use this mock in your test:

```cpp
#include "mocks/mock_foo.h"
#include <gtest/gtest.h>

TEST(FooTest, BasicTest) {
  MockFoo mock_foo;
  EXPECT_CALL(mock_foo, GetSize()).WillRepeatedly(testing::Return(5));
  EXPECT_CALL(mock_foo, IsEmpty()).WillOnce(testing::Return(false));

  EXPECT_EQ(mock_foo.GetSize(), 5);
  EXPECT_FALSE(mock_foo.IsEmpty());
}
```

---

## 8. Verification and Best Practices

- GoogleMock automatically verifies expectations when mocks are destroyed.
- Use `Mock::VerifyAndClearExpectations(&mock_obj);` if you want early verification.
- Prefer `NiceMock` to suppress warnings about uninteresting calls in large mocks.
- Use strict mocks (`StrictMock`) only when you want to fail on any unexpected calls.

---

## 9. Troubleshooting Common Issues

### Linking Errors

- Ensure libraries are linked in correct order.
- Verify your build system detects GoogleTest and GoogleMock correctly.

### Compiler Errors

- Confirm virtual destructors defined for interfaces.
- Verify C++ standard compatibility.

### Runtime Failures

- Check for missing `EXPECT_CALL` leading to uninteresting or unexpected calls.

Refer to [Troubleshooting Common Setup Issues](../getting-started/first-run-validation/troubleshooting-common-issues) for deeper diagnosis.

---

## 10. Next Steps

- After setup, write and run your first test with mocks.
- Explore [Writing and Running Your First Test](../../guides/getting-started-workflows/writing-your-first-test) for test patterns.
- Learn about advanced mocking in [Getting Started with Mocks](../../guides/getting-started-workflows/mocking-basics).

---

## Additional References

- [GoogleMock for Dummies](../docs/gmock_for_dummies.md) — Beginner-friendly guide to mocks
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) — Quick syntax reference
- [Mocking Reference](../docs/reference/mocking.md) — Detailed API and idioms
- [gMock Cookbook](../docs/gmock_cook_book.md) — Recipes for advanced features

---

For your convenience, here is a quick checklist:

- [x] Your project includes GoogleTest and GoogleMock headers.
- [x] Your build links with GoogleTest and GoogleMock libraries.
- [x] Your mock classes define mock methods with `MOCK_METHOD` in public scope.
- [x] Virtual destructors are present where needed.
- [x] Compiler and linker flags match project and GoogleTest requirements.
- [x] Tests include proper `EXPECT_CALL`s to set expectations.

<Tip>
If you use mock objects extensively, consider defining them where ownership and maintenance are easiest—often near the code's interface or in dedicated mock headers to ease reuse across multiple tests.
</Tip>

<Note>
Ensure to consistently update `EXPECT_CALL`s if the underlying interface changes to avoid unexpected test failures.
</Note>