---
title: "Project Configuration"
description: "Guide to linking GoogleTest into your project, setting include paths, and preparing your test runner. Learn best practices for organizing test code and integrating GoogleTest headers."
---

# Project Configuration

This guide helps you link GoogleTest into your C++ project, set up include paths correctly, and prepare your test runner. Follow these actionable steps to organize your test code effectively and seamlessly integrate GoogleTest headers and libraries.

---

## 1. Preparing Your Project to Use GoogleTest

### 1.1 Understanding Your Build Environment

Before integrating GoogleTest, confirm which build system your project uses (CMake, Makefiles, Bazel, or others). GoogleTest supports various build systems with tailored integration methods.

> For CMake users, refer to the [Installation via CMake](../getting-started/setup-and-installation/installation-via-cmake.md) guide for full build instructions.

### 1.2 Setting Include Paths

GoogleTest headers (`gtest/gtest.h` and `gmock/gmock.h`) must be accessible in your project's include search paths.

- If GoogleTest is installed system-wide (e.g., via `make install`), standard include paths usually suffice.
- If built alongside your project or embedded as a submodule, explicitly add the GoogleTest include directories.

#### Best Practice with CMake

Add GoogleTest's include directories using CMakeâ€™s `target_include_directories` or `include_directories` commands. For example:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gtest_main)  # gtest_main provides main() function
```

This ensures your test targets automatically pick up the necessary headers and libraries.


## 2. Linking GoogleTest Libraries

### 2.1 Choosing the Right Library

- **`gtest`**: Core GoogleTest library without a main() entry point.
- **`gtest_main`**: GoogleTest library that includes a standard main() function which initializes GoogleTest and runs all tests.


Unless you need a custom `main()`, linking against `gtest_main` is recommended.

### 2.2 Linking in Your Build System

- **CMake** example:

```cmake
add_executable(your_test test_example.cpp)
target_link_libraries(your_test gtest_main)
add_test(NAME your_test COMMAND your_test)
```

- **Makefiles or manual build**: Pass the appropriate `-I` flags for includes and link with `-lgtest_main` or `-lgtest` depending on the libraries built.


## 3. Organizing Your Test Code

### 3.1 Test Source File Structure

- Place your tests under a dedicated directory such as `tests/` or `test/` within your project.
- Name test source files clearly, e.g., `foo_test.cpp` for tests related to `foo`.

### 3.2 Recommended Include at Test Files

Start your test files by including the GoogleTest header:

```cpp
#include <gtest/gtest.h>
```

If you use GoogleMock features, include:

```cpp
#include <gmock/gmock.h>
```

This provides access to assertion macros, test fixtures, mocks, and more.

### 3.3 Test Fixtures

Use `TEST_F` macros and fixture classes to share setup or common objects:

```cpp
class FooTest : public testing::Test {
protected:
  void SetUp() override {
    // Common setup code
  }

  Foo foo_; // member accessible across tests
};

TEST_F(FooTest, DoesSomething) {
  EXPECT_TRUE(foo_.DoWork());
}
```

This approach improves maintainability and clarity.


## 4. Preparing the Test Runner

### 4.1 Using the Provided `main()`

GoogleTest provides a built-in `main()` function inside the `gtest_main` library. Linking with `gtest_main` means you generally do not need to write your own `main` function.

### 4.2 Writing a Custom `main()`

If your project requires some initialization before tests run, write your own `main()` like this:

```cpp
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This initializes GoogleTest with command-line arguments and runs all registered tests.

> Ensure that `InitGoogleTest()` is called before `RUN_ALL_TESTS()`.

### 4.3 Integration with GoogleMock

If you use GoogleMock alongside GoogleTest, initialize using:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);  // Initializes both gMock and gTest
  return RUN_ALL_TESTS();
}
```

Otherwise, the behavior is the same.


## 5. Common Best Practices

- Use `gtest_main` whenever possible to avoid boilerplate code.
- Keep tests and mocks close to the source code they test, but separated enough for clarity.
- Use `add_subdirectory()` in CMake to incorporate GoogleTest source to avoid dependency mismatches.
- On Windows, consider setting the `gtest_force_shared_crt` CMake flag to ensure runtime compatibility.
- Always set your project to use at least C++17 standard (`set(CMAKE_CXX_STANDARD 17)`).


## 6. Troubleshooting

<AccordionGroup title="Troubleshooting Common Linking and Include Issues">
<Accordion title="Cannot find gtest/gtest.h">
Verify your include directories are set correctly. If GoogleTest is in a subdirectory, add:

```cmake
include_directories(path/to/googletest/include)
```

Double-check paths and installation locations.
</Accordion>
<Accordion title="Linker errors related to 'main' function">
Ensure you link against `gtest_main` if you don't provide your own `main()`. Alternatively, write a custom `main()` as shown above.
</Accordion>
<Accordion title="Mismatch of runtime libraries on Visual Studio">
Set the `gtest_force_shared_crt` option to ON in CMake to fix CRT linkage mismatches:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

Ensure all libraries use consistent runtime settings.
</Accordion>
</AccordionGroup>


## 7. Next Steps

After successfully linking and configuring your project for GoogleTest:

- Write your first tests as described in the [Writing Your First Unit Test](../getting-started/configuration-and-first-test/writing-your-first-unit-test.md) guide.
- Verify your setup by running your tests, following the [Verifying Your Setup](../getting-started/configuration-and-first-test/verifying-your-setup.md) page.
- Explore integration with GoogleMock if mocking is needed.


---

For the most seamless experience, consult the related sections on installation and test writing to build a robust and maintainable test suite.


---

## References

- [GoogleTest Installation via CMake](../getting-started/setup-and-installation/installation-via-cmake.md)
- [Writing Your First Unit Test](../getting-started/configuration-and-first-test/writing-your-first-unit-test.md)
- [GoogleMock Overview](https://google.github.io/googletest/gmock_for_dummies.html)
- [GoogleTest Primer](../docs/primer.md)
- [GoogleTest README on GitHub](https://github.com/google/googletest/blob/main/googletest/README.md)

---

<Check>
Make sure you have C++17 support enabled and consider embedding GoogleTest source in your project for consistent builds.
</Check>

<Info>
Use `target_link_libraries(your_test_target gtest_main)` for effortless startup with GoogleTest's default main.
</Info>
