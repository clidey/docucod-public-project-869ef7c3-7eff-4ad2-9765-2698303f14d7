---
title: "Project Configuration"
description: "Explains how to add GoogleTest to an existing C++ project. Includes CMake and Bazel configuration instructions and tips for linking, header inclusion, and basic test discovery."
---

# Project Configuration

Configure your existing C++ project to use GoogleTest by integrating it into your build system. This page provides practical instructions for adding GoogleTest and GoogleMock with CMake and Bazel, including linking, header inclusion, and enabling basic test discovery.

---

## 1. Overview

Adding GoogleTest to your existing project lets you write and run unit tests seamlessly within the same build environment. Proper configuration ensures compatibility between your project and GoogleTest libraries and enables automatic test discovery and execution.

This guide covers:

- Incorporating GoogleTest with CMake via installed packages or as part of your project source.
- Bazel configuration snippets for GoogleTest and GoogleMock.
- Linking test executables against GoogleTest libraries.
- Including GoogleTest headers correctly.
- Enabling test discovery and registering tests.

---

## 2. Integrating GoogleTest with CMake

GoogleTest supports flexible integration into CMake-based projects. You can choose either to use an installed version of GoogleTest or build it as part of your project.

### 2.1 Using Installed GoogleTest

If GoogleTest is installed on your system (for example, via package manager or built/installed manually), you can find and link it using `find_package`.

```cmake
cmake_minimum_required(VERSION 3.14)  # Required for FetchContent
project(MyProject)

find_package(GTest CONFIG REQUIRED)  # Looks for installed GoogleTest with config file

add_executable(my_test
  test/my_test.cpp
  ...
)

target_link_libraries(my_test PRIVATE GTest::gtest_main)

# Enables CTest test discovery
include(CTest)
enable_testing()
add_test(NAME my_test COMMAND my_test)
```

> **Note**: `GTest::gtest_main` provides a main() function for tests. If you want to define your own main, link with `GTest::gtest` instead.

### 2.2 Building GoogleTest from Source with Your Project

Building GoogleTest as part of your project avoids version conflicts and ensures consistent compiler settings.

Add the GoogleTest source as a subdirectory, then link the targets:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)

FetchContent_MakeAvailable(googletest)

add_executable(my_test
  test/my_test.cpp
  ...
)

target_link_libraries(my_test PRIVATE gtest_main)

include(CTest)
enable_testing()
add_test(NAME my_test COMMAND my_test)
```

This way, GoogleTest and your tests are built with matching settings, improving compatibility.

### 2.3 GoogleMock Integration

GoogleMock is part of the GoogleTest repository and can be enabled alongside GoogleTest.

When building GoogleTest with GoogleMock, link test executables with `gmock_main`:

```cmake
add_executable(my_mock_test
  test/my_mock_test.cpp
  ...
)

target_link_libraries(my_mock_test PRIVATE gmock_main)

include(CTest)
enable_testing()
add_test(NAME my_mock_test COMMAND my_mock_test)
```

If you use installed packages, ensure your package provides `GMock::gmock_main` or equivalent.

---

## 3. Including GoogleTest Headers

Include GoogleTest headers in your test source files to use its testing and mocking facilities:

```cpp
#include <gtest/gtest.h>   // For standard testing
#include <gmock/gmock.h>  // For mocking abilities
```

Add the corresponding include directories in your build system if not using `find_package` or FetchContent.

---

## 4. Linking and Runtime Considerations

- Link test executables against the appropriate GoogleTest or GoogleMock targets (`gtest_main`, `gmock_main`, or the `GTest::` and `GMock::` targets).
- Specify C++17 compiler standard in your CMakeLists.txt to satisfy GoogleTest requirements:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- For Windows users, ensure runtime linkage compatibility using the `gtest_force_shared_crt` option if you face runtime conflicts between GoogleTest and your project.

---

## 5. Test Discovery and Registration

GoogleTest automatically discovers and registers tests defined with `TEST()` and `TEST_F()` macros. After compiling your test executable:

- Use `gtest_main` or `gmock_main` libraries to provide a `main()` function.
- Call `RUN_ALL_TESTS()` in your `main()` if you supply your own test runner.
- Integrate with CTest or other runners by adding:

```cmake
include(CTest)
enable_testing()
add_test(NAME my_test COMMAND my_test_executable)
```

This enables running `ctest` to execute and report on your tests.

---

## 6. Example CMakeLists.txt Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Include GoogleTest via FetchContent
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_test
  test/my_test.cpp
)

target_link_libraries(my_test PRIVATE gtest_main)

include(CTest)
enable_testing()
add_test(NAME my_test COMMAND my_test)
```

---

## 7. Integrating GoogleTest with Bazel

If your project uses Bazel, configure your `BUILD` files to include GoogleTest and GoogleMock:

```starlark
load("@rules_cc//cc:defs.bzl", "cc_binary", "cc_test")

cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

- Use `@com_google_googletest//:gtest_main` for tests with the main()
- Use `@com_google_googletest//:gmock_main` if using GoogleMock features.

Refer to [GoogleTest Bazel integration](https://github.com/google/googletest/tree/main/googletest/bazel) for advanced usage.

---

## 8. Tips and Best Practices

- Prefer using `gtest_main` or `gmock_main` libraries to avoid writing your own main function.
- Always specify C++17 in your project to prevent compatibility issues.
- Build GoogleTest as part of your project for consistent flags and easier CI integration.
- Use CTest (`enable_testing()` and `add_test()`) to automate running tests.
- On Windows, adjust runtime library linkage to match GoogleTest defaults or enable `gtest_force_shared_crt`.
- For mocking, link tests with `gmock_main` and include `<gmock/gmock.h>`.

---

## 9. Common Issues and Troubleshooting

<AccordionGroup title="Common Configuration Issues">
<Accordion title="Linker Errors Related to Runtime Mismatches">
On Windows, linking errors like `mismatch detected for 'RuntimeLibrary'` are caused by runtime linkage conflicts between your project and GoogleTest libraries.

**Solution:**

Add this before fetching GoogleTest:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

It makes GoogleTest link against the dynamic runtime library matching typical Visual Studio projects.
</Accordion>

<Accordion title="Tests Not Being Discovered">
If CTest does not discover or run your tests:

- Verify you call `enable_testing()` and add tests with `add_test()`.
- Ensure your test executable links `gtest_main` or has a `main()` that calls `RUN_ALL_TESTS()`.
- Confirm test source files contain valid GoogleTest `TEST()` macros.
</Accordion>

<Accordion title="Undefined Reference to gtest Functions">
This indicates missing linkage to GoogleTest libraries.

Check your `target_link_libraries` and make sure you link with `gtest`, `gtest_main`, `gmock`, or `gmock_main` as needed.
</Accordion>
</AccordionGroup>

---

## 10. Next Steps

- Write your first test suite and test cases (see [Your First Unit Test](../configuration-initial-run/first-test)).
- Explore mocking with GoogleMock to isolate dependencies in tests.
- Learn how to customize test configurations and flags.
- Integrate tests into your continuous integration pipeline.

---

## References

- [GoogleTest Installation Instructions](../prerequisites-installation/installation-instructions)
- [GoogleTest System Requirements & Platforms](../prerequisites-installation/system-requirements)
- [GoogleMock Documentation and Usage](../../docs/reference/mocking.md)
- [GoogleTest Primer](../../docs/primer.md)
- [CMake Documentation](https://cmake.org/cmake/help/latest/)
- [Bazel GoogleTest Integration](https://github.com/google/googletest/tree/main/googletest/bazel)

---

For a visual understanding of GoogleTest integration flow, and further architecture insights, see the High-Level Architecture page in the Overview tab.
