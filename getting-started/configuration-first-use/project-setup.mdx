---
title: "Project Setup & Configuration"
description: "Integrate GoogleTest with your codebase, configure the build system, and ensure all dependencies are satisfied. Includes tips for working with CMake, Bazel, or custom builds, as well as importing necessary headers."
---

# Project Setup & Configuration

Integrate GoogleTest with your C++ codebase by configuring your build system and dependencies correctly. This guide walks you through essential steps and best practices for working with CMake, Bazel, or custom build environments, as well as how to include necessary headers. By following these instructions, you'll ensure a smooth setup that allows you to write and run tests effectively.

---

## 1. Prerequisites & Dependencies

Before integrating GoogleTest, ensure your development environment meets the following requirements:

- **C++17 Compiler:** GoogleTest requires a compiler supporting the C++17 standard.
- **Build Tools:** CMake (version 3.14 or later recommended) or Bazel for build orchestration.
- **System Requirements:** Refer to [System Requirements](https://github.com/google/googletest/tree/main/docs) for platform-specific details.
- **GoogleTest Source or Installed Libraries:** Obtain GoogleTest sources or prebuilt libraries.

> <Tip>
> For comprehensive details on prerequisites, consult the [System Requirements](https://github.com/google/googletest/tree/main/docs/getting-started/prerequisites-installation/system-requirements) documentation.
> </Tip>


## 2. Adding GoogleTest to Your Build

### Using CMake

GoogleTest provides native CMake support with options for standalone or embedded integration.

#### 2.1: Standalone GoogleTest Project

1. Clone the repository or download a release version:

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
mkdir build && cd build
```

2. Configure CMake generation:

- To build GoogleTest and GoogleMock together (default):

```bash
cmake ..
```

- To build GoogleTest only:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

3. Build and optionally install:

```bash
make
sudo make install  # For system-wide installation
```

4. In your CMake project, use `find_package` to locate installed GoogleTest:

```cmake
find_package(GTest CONFIG REQUIRED)
target_link_libraries(your_test_target GTest::gtest GTest::gtest_main)
```

#### 2.2: Embedding GoogleTest into Your Project

Alternatively, embed GoogleTest directly using `add_subdirectory`:

```cmake
add_subdirectory(path/to/googletest)
add_executable(your_test your_test.cpp)
target_link_libraries(your_test gtest gtest_main)
```

> <Tip>
> Embedding ensures no incompatibilities with compiler or linker settings across projects.
> </Tip>


### Using Bazel

1. Add GoogleTest as a dependency using its Bazel rules.
2. Update your `WORKSPACE` and `BUILD` files per GoogleTest's Bazel integration guidelines.

> Refer to the [Integration & Ecosystem](https://github.com/google/googletest/tree/main/docs/overview/feature-overview-integration/integration-points) page for detailed Bazel instructions.


### Custom Builds

If you do not use CMake or Bazel:

- Download GoogleTest source code and include it in your project.
- Link against the compiled GoogleTest libraries.
- Make sure to define the required compiler flags for C++17.


## 3. Including GoogleTest Headers

To write tests, include GoogleTest headers in your source files.

At a minimum, include:

```cpp
#include <gtest/gtest.h>
```

To use GoogleMock features (mocking), include:

```cpp
#include <gmock/gmock.h>
```

> <Note>
> Including `<gmock/gmock.h>` automatically includes GoogleTest headers.
> </Note>


## 4. Configuring test entry points

GoogleTest provides default main() implementations to simplify test setup; choose how to handle `main()` based on your needs.

### 4.1 Linking With gtest_main or gmock_main

- Use `gtest_main` to link a main function that initializes GoogleTest:

```cmake
target_link_libraries(your_test_target gtest_main)
```

- For projects using GoogleMock, link `gmock_main` instead, which initializes both GoogleMock and GoogleTest:

```cmake
target_link_libraries(your_test_target gmock_main)
```

This lets you avoid writing your own main, simplifying test execution.

### 4.2 Writing a Custom main() Function

If your tests require custom setup, write your own `main()` like this:

```cpp
#include "gtest/gtest.h"
#include "gmock/gmock.h" // if using mocks

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv); // Initializes GoogleTest and GoogleMock
  return RUN_ALL_TESTS();
}
```

> <Tip>
> Always call `testing::InitGoogleMock` before `RUN_ALL_TESTS()`. This processes GoogleTest/GoogleMock flags correctly.
> </Tip>


## 5. Common Configuration Tips

- GoogleTest supports wide platforms, but platform-specific compiler options might be needed.
- When using Windows with UNICODE builds, `InitGoogleMock(int* argc, wchar_t** argv)` overload is available.
- If your build system is multi-threaded, ensure proper threading flags or macros, e.g., `-DGTEST_HAS_PTHREAD=1`.
- Avoid multiple calls to `RUN_ALL_TESTS()`. It must be called exactly once.


## 6. Importing GoogleMock Into Your Project

GoogleMock is distributed inside GoogleTest and can be enabled with CMake options.

- Enable GoogleMock via CMake variable `-DBUILD_GMOCK=ON`.
- Include the header:

```cpp
#include <gmock/gmock.h>
```

- Link against `gmock` or `gmock_main` as appropriate.

> <Warning>
> GoogleMock depends on GoogleTest. Initializing GoogleMock will also initialize GoogleTest.
> </Warning>


## 7. Troubleshooting Configuration Issues

<AccordionGroup title="Common Configuration Problems and Solutions">
<Accordion title="Build System Can't Find GoogleTest Headers or Libraries">
- Verify installation path of GoogleTest.
- If using CMake, ensure `find_package(GTest REQUIRED)` locates the correct version.
- Use `message(STATUS "GTest_INCLUDE_DIRS: ${GTEST_INCLUDE_DIRS}")` to debug paths.
</Accordion>
<Accordion title="Linker Errors Involving main()">
- If you define your own `main()`, do NOT link with `gtest_main` or `gmock_main`.
- If you want to use default main, do not define it explicitly in your code.
- On Windows, link errors with `_tmain` may require switching to `main()` implementation as done in `gmock_main.cc`.
</Accordion>
<Accordion title="Compiler Flags or Threading Issues">
- Use `-DGTEST_HAS_PTHREAD=1` if your environment supports pthreads but GoogleTest did not detect it.
- Check your compiler's C++ standard version flag; ensure at least C++17.
</Accordion>
</AccordionGroup>

---

## References & Next Steps

- [GoogleTest Primer: Authoring Your First Test](https://github.com/google/googletest/tree/main/docs/guides/getting-started/primer-basics)
- [Quickstart with CMake](https://github.com/google/googletest/tree/main/docs/guides/getting-started/quickstart-cmake)
- [Introduction to Mocking](https://github.com/google/googletest/tree/main/docs/guides/getting-started/mocking-primer)
- [Mocking Reference](https://github.com/google/googletest/tree/main/docs/api-reference/core-mocking-apis/)
- [Integration & Ecosystem](https://github.com/google/googletest/tree/main/docs/overview/feature-overview-integration/integration-points)


---

This page guides you through correctly configuring your project to use GoogleTest and GoogleMock, maximizing compatibility and easing test development. Once configured, proceed to writing and running your first tests to validate your setup.