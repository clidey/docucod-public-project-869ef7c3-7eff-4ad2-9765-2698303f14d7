---
title: "Add Your First Mock (Optional)"
description: "Quickly see GoogleMock in action: add a mock class, specify expectations, and validate mock interactions within your first test case for deeper C++ testing scenarios."
---

# Add Your First Mock (Optional)

Harness the power of GoogleMock by adding your first mock class to your C++ tests. This guide walks you through defining a mock class, specifying behavior with expectations, and validating interactions—unlocking deeper test coverage and precision.

---

## Why Add a Mock?

When testing your code, especially when it depends on external components or complex interfaces, relying on real implementations can make tests slow, fragile, or hard to control. Mocks allow you to simulate these dependencies, validate how your code interacts with them, and test edge cases reliably.

Adding a mock is optional, but it empowers you to write more precise and efficient tests.

---

## 1. Defining Your Mock Class

Start by creating a mock class that inherits from the interface or base class your production code uses. Use the `MOCK_METHOD()` macro for each virtual method you want to mock.

### Basic Usage

Given a simple interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}  // Must be virtual
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

You mock it like this:

```cpp
#include <gmock/gmock.h>  // Include GoogleMock macros

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Key Points:**
- `MOCK_METHOD` takes the return type, method name, argument list, and optionally qualifiers like `const` or `override`.
- Always place `MOCK_METHOD` inside the `public:` section even if overriding protected/private methods.
- Mark virtual methods with `override` for clarity and correctness.

### Handling Commas in Types

If your method signature contains commas (e.g., in template types), wrap the return type or argument type in parentheses:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, (), (override));
```

Alternatively, use a type alias:

```cpp
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, (), (override));
```

---

## 2. Using Your Mock in Tests

Once the mock class is ready, instantiate it in your test and set expectations to specify what calls you expect and how the mock should respond.

### Setting Expectations

Use the `EXPECT_CALL` macro to describe your expectations before exercising the code.

Example:

```cpp
using ::testing::Return;
using ::testing::_;  // Wildcard matcher

TEST(PainterTest, DrawsLine) {
  MockTurtle turtle;

  // Expect PenDown() to be called once
  EXPECT_CALL(turtle, PenDown()).Times(1);

  // Expect Forward() to be called with 100 or more units
  EXPECT_CALL(turtle, Forward(testing::Ge(100))).WillOnce(Return());

  // Use the mock with your real code
  Painter painter(&turtle);
  painter.Draw();
}
```

### Matchers

Matchers describe argument constraints:
- `_` matches any value.
- `Ge(100)` matches values greater or equal 100.

Find more [matchers here](https://google.github.io/googletest/reference/matchers.html).

### Actions

Specify mock method behavior with actions:
- `Return(value)` returns a value.
- `.WillOnce(Return(value))` specifies behavior for one call.
- `.WillRepeatedly(Return(value))` specifies behavior for all subsequent calls.

---

## 3. Understanding Mock Strictness Levels

GoogleMock supports three mock flavors controlling warnings and failures on uninteresting calls:

- **NaggyMock (default):** Warns if a method is called without an expectation.
- **NiceMock:** Silences warnings for uninteresting calls.
- **StrictMock:** Treats unexpected calls as test failures.

### Using a Nice or Strict Mock

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockTurtle> nice_mock;     // Ignores uninteresting calls
StrictMock<MockTurtle> strict_mock; // Fails on uninteresting calls
```

Use these when you want to tune mock verbosity and strictness.

---

## 4. Tips and Best Practices

- **Expect calls before exercising code.** GoogleMock requires expectations to be set *prior* to method calls for predictable results.
- **Avoid over-specifying expectations.** Specify only meaningful constraints to prevent brittle tests.
- **Use sequences** to enforce calling order with `InSequence`.
- **Mock only interfaces or abstract classes you own.** For third-party or concrete classes, prefer adapting via interfaces.
- **Use type aliases to simplify complex types in `MOCK_METHOD`.**

---

## 5. Common Pitfalls & Troubleshooting

- **Uninteresting call warnings:** Occurs when a mock method is called without an `EXPECT_CALL`. Use `NiceMock` or add `EXPECT_CALL(...).Times(AnyNumber())` to suppress.

- **Method not mocked?** Confirm the method is virtual. GoogleMock can only mock virtual methods unless special templating techniques are used.

- **Compilation errors in `MOCK_METHOD`:** Parenthesize complex return or argument types that include commas.

- **Destructor warnings or leaks:** Ensure the interface has a virtual destructor.

- **Setting expectations after calls:** Leads to undefined behavior. Always set up all expectations first.

---

## 6. How to Learn More

Explore the following documentation for deeper understanding and advanced use cases:

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — A beginner-friendly tutorial.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for advanced mocking needs.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Complete API details.

---

## 7. Example: Complete Mock Setup

```cpp
#include <gmock/gmock.h>
#include "turtle_interface.h"  // Your interface

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(TurtleTest, MovesForward) {
  MockTurtle mock_turtle;
  EXPECT_CALL(mock_turtle, PenDown()).Times(1);
  EXPECT_CALL(mock_turtle, Forward(testing::Ge(0))).Times(1);

  Painter painter(&mock_turtle);
  painter.DrawLine(10);
}
```

This simple test ensures your code calls mock methods as expected.

---

For more information and community support, check the main project's repositories and documentation portals.

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/gmock_cook_book.md"},{"path": "docs/gmock_for_dummies.md"},{"path": "docs/reference/mocking.md"}]} />

