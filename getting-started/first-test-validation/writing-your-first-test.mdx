---
title: "Writing Your First Test Case"
description: "See GoogleTest in action by creating a basic test. Follow a guided walkthrough to create, build, and explain a minimal example. This establishes foundational testing concepts and jump-starts your work with the framework."
---

# Writing Your First Test Case

Welcome to the hands-on introduction to GoogleMock, where you'll see how to write your first test case using mock objects in C++. This guide walks you through creating a mock class, setting expectations, and running a basic test to understand interaction-based testing with gMock.

---

## 1. Understanding the Role of Mock Objects

Mock objects simulate dependencies your code interacts with, allowing you to verify how those dependencies are used. You define **expectations** on mock objects describing which methods should be called, with what arguments, and how many times.

> In this guide, we'll use a simple example to solidify the concept.

## 2. Defining a Mock Class

Before writing a test, you need a mock class that mimics an interface or an abstract class your production code depends on.

### Example Interface

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};
```

### Mock Class Using gMock

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

**Tips:**
- Always put mock methods in the `public` section.
- Include the virtual destructor in the base interface.
- Use `override` to catch signature mismatches.

## 3. Setting Up Your Test Case

Create a test that uses the mock and sets expectations on how the mock methods should be called.

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Return;
using ::testing::_;

TEST(MyTestSuite, FirstTest) {
  MockFoo foo;  // Step 1: Create mock object

  // Step 2: Specify default action (optional)
  ON_CALL(foo, GetSize()).WillByDefault(Return(42));

  // Step 3: Set expectations
  EXPECT_CALL(foo, Describe("test"))
      .Times(1)
      .WillOnce(Return("Mocked Description"));

  // Step 4: Exercise code under test (simplified here)
  std::string desc = foo.Describe("test");

  // Step 5: Verify results
  EXPECT_EQ(desc, "Mocked Description");
}
```

### Explanation:
- `ON_CALL` sets the default behavior for calls that aren't explicitly expected.
- `EXPECT_CALL` sets an expectation that the method will be called with specific arguments and specifies the behavior when it is called.
- `Times(1)` says the call must happen exactly once.

## 4. Running Your First Operation: Test Execution

- Build your test with your build system ensuring that both GoogleTest and GoogleMock are linked.
- Run the test executable.
- gMock automatically verifies that all expectations set by `EXPECT_CALL` have been met when the mock object is destructed.

If expectations fail, gMock prints clear messages indicating what call was missing or unexpected.

## 5. Best Practices and Common Pitfalls

- **Set expectations _before_ exercising the code.** gMock's behavior is undefined if you call `EXPECT_CALL` after invoking the mock.
- **Use `_` to match any argument** when you don't care about restrictions.
- **When mocking overloaded methods, specify the exact overload** either by providing argument types or using `Const()` for const-qualified methods.
- To suppress warnings about uninteresting calls (mock methods called without expectations), use `NiceMock` to quiet them.

## 6. Troubleshooting

- **Unexpected calls:** If you see errors stating unexpected calls, check that your `EXPECT_CALL`s match the arguments.
- **Unmet expectations:** gMock reports when expected calls weren't made; verify test flow and timing.
- **Leaked mocks warnings:** Always manage the lifecycle of mock objects correctly or use `Mock::AllowLeak()` if intentional.

## 7. Next Steps

- Explore more about **Matchers** to refine argument matching.
- Learn how to control call order with **Sequences** and **InSequence**.
- Understand different **Actions** to specify complex behaviors.
- Look into advanced topics such as Delegating to Fakes or Real Objects.

---

For a deeper dive, see the related sections in the GoogleMock documentation and the gMock Cookbook.

---

## Additional Example: Minimal Test Program

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};

TEST(FooTest, Simple) {
  MockFoo foo;
  ON_CALL(foo, GetSize()).WillByDefault(::testing::Return(5));
  EXPECT_CALL(foo, Describe("hello"))
      .Times(1)
      .WillOnce(::testing::Return(std::string("mocked")));

  EXPECT_EQ(5, foo.GetSize());
  EXPECT_EQ("mocked", foo.Describe("hello"));
}

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

In this example:
- We define the `MockFoo` class mocking the `Foo` interface.
- We set default behavior for `GetSize`.
- We set an expectation that `Describe` is called with a specific argument.
- The test verifies that the mocked methods behave as expected.

---