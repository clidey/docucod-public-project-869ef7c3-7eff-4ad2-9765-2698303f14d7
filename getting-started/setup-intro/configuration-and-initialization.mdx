---
title: "Configuration and Initialization"
description: "Covers initial configuration steps after installation, including project integration, linking instructions, and initializing the framework within a C++ test project. Prepares the user to compile and link their first tests successfully."
---

# Configuration and Initialization

Configure and initialize GoogleTest in your C++ project after installation to successfully compile, link, and run your tests. This guide walks you through integrating GoogleTest with your build system, linking the required libraries, and setting up the test framework in your test source code.

---

## 1. Project Integration

### Using GoogleTest in a CMake Project

GoogleTest can be integrated into your project as either an installed library or as part of your build. Choose the integration method based on your project setup:

#### a. Linking to Installed GoogleTest Libraries

Once GoogleTest is installed on your system, you can import it with `find_package` and link against its targets:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_code.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

- `GTest::gtest` is the core testing library.
- `GTest::gtest_main` provides a default `main()` implementation to run all tests.

#### b. Building GoogleTest as part of Your Project

To ensure consistent compiler and linker settings, add GoogleTest as a subdirectory in your project:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_code.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

This avoids library conflicts and ensures synchronized builds.

### Linking Instructions

- Link your test executables against `gtest` or `gtest_main` for GoogleTest support.
- If you prefer a custom `main()`, link against `gtest` only and provide your own `main()`.
- For GoogleMock support, link against `gmock` or `gmock_main` similarly.

### Visual Studio Runtime Compatibility

If using Visual Studio, beware of mismatches between dynamic and static runtimes. Use `gtest_force_shared_crt` CMake option if needed:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This aligns runtime library linking between your tests and GoogleTest.

---

## 2. Initializing the Framework in Test Code

Your test source files must initialize GoogleTest before running tests. This is essential for parsing command-line flags and setting up the framework.

### Basic Initialization

Include GoogleTest header and call `InitGoogleTest()` at the start of your `main()` function:

```cpp
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);  // Parses flags
  return RUN_ALL_TESTS();                // Runs all defined tests
}
```

- `InitGoogleTest()` parses testing-related command-line flags and removes them from `argv`.
- `RUN_ALL_TESTS()` executes all registered tests and returns 0 if successful.

### Using GoogleMock (Optional)

If your tests use GoogleMock, include `<gmock/gmock.h>` instead, and initialize with `InitGoogleMock()`:

```cpp
#include <gmock/gmock.h>

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- `InitGoogleMock()` initializes both GoogleMock and GoogleTest.
- If you link with `gmock_main`, this initialization is already provided.

### Arduino and Embedded Platforms

On Arduino platforms like ESP8266 or ESP32, initialization happens in `setup()`:

```cpp
void setup() {
  testing::InitGoogleTest();  // Or InitGoogleMock() if using mocks
}

void loop() {
  RUN_ALL_TESTS();
}
```

This accommodates platforms without a traditional `main()` entry.

---

## 3. Sample Integration Example

Here is a minimal working example to integrate GoogleTest in your C++ project:

### Simple Test File: `example_test.cpp`

```cpp
#include <gtest/gtest.h>

// A simple test case named "ExampleTest" with a test named "BasicCheck"
TEST(ExampleTest, BasicCheck) {
  EXPECT_EQ(2 + 2, 4);
}
```

### Custom `main()` (optional if not linking with `gtest_main`)

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.14)
project(ExampleProject CXX)

# Download and integrate GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

# Add test target
add_executable(example_test example_test.cpp)
target_link_libraries(example_test PRIVATE gtest_main)

# Enable testing
enable_testing()
add_test(NAME example_test COMMAND example_test)
```

Build and run your tests with:

```bash
mkdir build && cd build
cmake ..
cmake --build .
ctest
```

---

## 4. Best Practices and Tips

- Always call `InitGoogleTest()` or `InitGoogleMock()` before running tests to ensure flag processing.
- Prefer linking with `gtest_main` or `gmock_main` to avoid writing your own `main()`.
- Use CMake's FetchContent to keep GoogleTest version controlled and synchronized with your project.
- Align compiler settings between your project and GoogleTest (especially on Windows).
- When mixing GoogleMock, use `InitGoogleMock()` to handle both frameworks seamlessly.

---

## 5. Troubleshooting

### Tests Do Not Run or Show "No tests found"

- Verify that you defined at least one test with `TEST()` or `TEST_F()` macros.
- Confirm linking against `gtest_main` or providing a proper `main()`.
- Ensure `InitGoogleTest` or `InitGoogleMock` is called before running.

### Linking Errors on Visual Studio

- Check that runtime libraries between GoogleTest and your project match.
- Use `gtest_force_shared_crt` CMake option to force consistent dynamic linking.

### Command Line Flags Not Recognized

- Make sure `InitGoogleTest(&argc, argv)` is called early in `main`.
- Confirm no conflicting flags or build issues alter `argc` or `argv` before initialization.

---

## 6. Next Steps

After successful configuration and initialization:

- Write your first tests using the [Writing Your First Test](/getting-started/first-test-validation/writing-your-first-test) guide.
- Build and run tests; explore [Building and Running Tests](/getting-started/first-test-validation/building-and-running-tests).
- For mocking, see [Creating and Using Mocks](/guides/mocking-scenarios/creating-and-using-mocks).

---

## References

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleMock Overview](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [CMake Integration Examples](https://github.com/google/googletest/blob/main/googletest/README.md#incorporating-into-an-existing-cmake-project)
- [GoogleTest API Reference](https://github.com/google/googletest/tree/main/googletest/include/gtest)

---

This page prepares you confidently to integrate GoogleTest into your project and initialize the framework correctly, setting a strong foundation for your testing journey.