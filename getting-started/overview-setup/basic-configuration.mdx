---
title: "Basic Configuration & Project Setup"
description: "Covers integrating GoogleTest and GoogleMock into a user's own C++ project. Explains how to configure build files, include main test headers, and organize test and mock files for first use."
---

# Basic Configuration & Project Setup

This guide explains how to integrate GoogleTest and GoogleMock into your own C++ project. It details the essential configuration steps for your build system, setting up includes, organizing test files, and preparing mock classes so you can write and execute your first tests with confidence.

---

## 1. Include GoogleTest and GoogleMock Headers

To get started with writing tests and mocks, include the core headers in your test source files:

```cpp
#include <gtest/gtest.h>  // Main GoogleTest functionality
#include <gmock/gmock.h>  // GoogleMock mocking features
```

- Include `<gtest/gtest.h>` in every test file to gain access to test macros and assertions.
- Include `<gmock/gmock.h>` in files that define mock classes or use mocking features.

This sets up the environment so you can use GoogleTest’s test framework and GoogleMock’s mocking capabilities seamlessly.

<Note>
Do not include internal headers directly; rely only on these public headers to avoid breaking changes and maintain portability.
</Note>

## 2. Configure Your Build System to Link GoogleTest and GoogleMock

Your build configuration must link against the GoogleTest and GoogleMock libraries. The common approaches depend on your build tools:

- **CMake**: Use `find_package(GTest REQUIRED)` and add `GTest::gtest` and `GTest::gmock` targets as dependencies, or add the GoogleTest source tree as a subdirectory.

- **Bazel**: Add `@com_google_googletest//:gtest`, `@com_google_googletest//:gmock` as dependencies in your `cc_test` or `cc_library` targets.

- **Other Build Systems**: Add appropriate compiler and linker flags for include directories and libraries.

Example (CMake):

```cmake
find_package(GTest REQUIRED)
enable_testing()

add_executable(my_tests test_main.cc my_test.cc)
target_link_libraries(my_tests GTest::gtest GTest::gmock)
add_test(NAME MyTests COMMAND my_tests)
```

<Info>
Refer to the [Integration with Build Systems & Tools](/overview/architecture_and_integration/integration_points) page for detailed platform-specific guidance.
</Info>

## 3. Organize Your Test and Mock Sources

Adopt a clear structure in your project to facilitate maintainability and scalability:

- **Test Files**: Place all your test cases in files named with a `_test.cc` suffix or similar convention.
- **Mock Classes**: Define mock classes in dedicated headers (e.g., `mock_foo.h`) inside a `test` or `mocks` directory.

Example directory layout:

```
/project-root
    /src
      foo.cc
      bar.cc
    /include
      foo.h
      bar.h
    /tests
      foo_test.cc
      mock_foo.h
```

### Writing Mock Classes

- Derive mock classes from the interfaces or base classes you wish to mock.
- Use the `MOCK_METHOD` macro to define mocked methods in the `public:` section of your mock class.

Example mock class definition:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoSomething, (int count), (override));
  MOCK_METHOD(int, Calculate, (const std::string& input), (const, override));
};
```

<Warning>
Always declare mock methods in `public:` regardless of the access level of the original methods. This ensures you can use `ON_CALL` and `EXPECT_CALL` with them.
</Warning>

## 4. Initialize GoogleMock in Your Test Executable

Every test executable must initialize GoogleMock and GoogleTest before running tests.

At the start of your `main` function, call:

```cpp
int main(int argc, char** argv) {
    testing::InitGoogleMock(&argc, argv);
    return RUN_ALL_TESTS();
}
```

- This sets up command-line flags, the GoogleTest framework, and the mocking environment.

- Use `InitGoogleMock()` instead of `InitGoogleTest()` to ensure mocks are fully initialized.

<Tip>
Call `InitGoogleMock()` even if you plan to use only GoogleTest features, to avoid subtle issues.
</Tip>

## 5. Writing Your First Tests and Mocks

With mocks defined and configured, write tests using GoogleTest’s `TEST` or `TEST_F` macros and specify mock expectations as follows:

```cpp
#include <gtest/gtest.h>
#include "mock_foo.h"  // Your mock definitions

using ::testing::Return;
using ::testing::_;

TEST(FooTest, UsesMock) {
    MockFoo mock_foo;

    // Set up behavior and expectations
    ON_CALL(mock_foo, Calculate(_)).WillByDefault(Return(42));
    EXPECT_CALL(mock_foo, DoSomething(5)).Times(1);

    // Exercise code that uses mock_foo
    SomeFunctionUnderTest(&mock_foo);

    // Assertions can follow here
}
```

- Use `ON_CALL` to specify default mock method behavior without enforcing calls.
- Use `EXPECT_CALL` to set expectations on method calls (arguments, times, sequence).

<Note>
Set all expectations before the code under test uses the mocks to avoid undefined behavior.
</Note>

## 6. Best Practices for Configuration and Setup

- **Prefer automated mocking:** Use `MOCK_METHOD` macros for ease and consistency.
- **Use namespaces:** Import `testing` namespace scoped via `using` for conciseness.
- **Isolate mocks:** Keep mock definitions close to interfaces but separate from production code.
- **Manage mock strictness:** Use `NiceMock`, `StrictMock`, or `NaggyMock` wrappers to control warnings and errors on uninteresting calls.

Example:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
```

- **Link against GoogleTest and GoogleMock correctly:** Avoid multiple conflicting versions.
- **Structure tests for clarity:** Group related tests in classes, leverage fixtures for common setup.

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Configuration Issues">
<Accordion title="Missing Symbols or Linker Errors">
- Ensure GoogleTest and GoogleMock libraries are correctly linked.
- Check for multiple versions or conflicting includes.
- Confirm `InitGoogleMock` is called before running tests.
</Accordion>
<Accordion title="Compilation Failures on MOCK_METHOD">
- Verify `MOCK_METHOD` usage matches method signatures exactly.
- Wrap types containing commas in extra parentheses or use type aliases.
- Confirm overridden methods are declared `virtual`.
</Accordion>
<Accordion title="Tests Not Running or Detected">
- Confirm test files are correctly registered with the test runner.
- Ensure main test executable calls `RUN_ALL_TESTS()`.
- Check that test functions use the proper `TEST` or `TEST_F` macros.
</Accordion>
</AccordionGroup>

---

By following these configuration and project setup steps, you enable reliable and maintainable usage of GoogleTest and GoogleMock in your C++ projects. Your tests will be structured, your mocks effective, and your builds stable.

For further integration details, see the [Integration with Build Systems & Tools](/overview/architecture_and_integration/integration_points) page.

For mock writing guidelines and examples, refer to [gMock for Dummies](docs/gmock_for_dummies.md) and the [Mocking Reference](/api-reference/mocking-framework/mock-definition).

---