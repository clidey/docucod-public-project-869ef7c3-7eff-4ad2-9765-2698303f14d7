---
title: "Installing with CMake"
description: "A step-by-step guide to installing and integrating GoogleTest/GoogleMock using CMake, including configuration tips and build instructions for both local and system setups."
---

# Installing with CMake

A step-by-step guide to installing and integrating GoogleTest and GoogleMock using CMake. This guide covers setup, build instructions, configuration tips, and troubleshooting for both standalone and integrated project builds.

---

## 1. Prerequisites & System Requirements

Before starting, ensure your environment meets these requirements:

- **Operating System:** Compatible with Linux, macOS, or Windows.
- **Compiler:** C++ compiler supporting at least C++17 (e.g., GCC, Clang, MSVC).
- **Build System:** CMake (minimum version 3.13, ideally ≥3.14).
- **Build Tools:** 
  - On Unix: Make, Ninja, or other supported CMake generators.
  - On Windows: Visual Studio or MSBuild.
- **Permissions:** For system-wide installation, administrative or sudo privileges may be required.

> For CMake installation, see the official site: [https://cmake.org/install](https://cmake.org/install).

---

## 2. Building GoogleTest with CMake

GoogleTest includes a native CMake build script ([CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt)), supporting flexible build and integration options.

### 2.1 Building as a Standalone Project

Get started quickly by building GoogleTest standalone:

<Steps>
<Step title="Clone the Repository">
Run:
```bash
git clone https://github.com/google/googletest.git -b v1.17.0
data
googletest
```
Change to the source directory:
```bash
cd googletest
```
</Step>
<Step title="Create and Enter Build Directory">
```bash
mkdir build
cd build
```
Creating a separate `build` directory keeps build files isolated.
</Step>
<Step title="Configure the Build">
To include GoogleMock (the default), run:
```bash
cmake ..
```
To build only GoogleTest, run:
```bash
cmake .. -DBUILD_GMOCK=OFF
```
This generates native build files for your environment.
</Step>
<Step title="Build GoogleTest">
On Unix/Linux/macOS:
```bash
make
```
On Windows with Visual Studio:
Open the generated `gtest.sln` and build.

On macOS with Xcode:
Open the generated `.xcodeproj` and build.
</Step>
</Steps>

### 2.2 Installing GoogleTest

If you want to install GoogleTest system-wide (typically `/usr/local`), run:

```bash
sudo make install
```

> Ensure you have the necessary privileges to install.

---

## 3. Incorporating GoogleTest into Your Existing CMake Project

You have two recommended approaches to use GoogleTest with your own project:

### 3.1 Using Installed GoogleTest Libraries

After installing GoogleTest, import it in your `CMakeLists.txt` via `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_test test_main.cpp)
target_link_libraries(my_test GTest::gtest GTest::gtest_main)
```

This approach requires GoogleTest to be present and correctly installed.

### 3.2 Building GoogleTest as a Subdirectory

For tighter integration and consistent compiler/linker settings, you can embed GoogleTest directly in your project:

- Add GoogleTest source directory as a git submodule or download it manually.
- Add this to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows: Prevent runtime conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test_main.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

This method requires CMake 3.14 or later and ensures your tests build with the same settings as your project.

<Tip>
Fixing Visual Studio Runtime Mismatch: Set the `gtest_force_shared_crt` option to `ON` to avoid static/dynamic runtime conflicts.
</Tip>

---

## 4. Building and Running Your First Test

Once GoogleTest is integrated, build and test your code with these steps.

<Steps>
<Step title="Configure Your Build">
From your project root, run:

```bash
cmake -S . -B build
```

This generates the build files in the `build` directory.
</Step>
<Step title="Build Your Tests">
Build the test executable:

```bash
cmake --build build
```

Watch for successful compilation and linking, especially messages indicating GoogleTest libraries.
</Step>
<Step title="Run Your Tests">
Run tests using CTest:

```bash
cd build
ctest
```

Example expected output:

```
Test project /path/to/build
    Start 1: MyTestSuite.MyTest
1/1 Test #1: MyTestSuite.MyTest ..........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```
</Step>
</Steps>

<Note>
You can also run the test executable directly to see detailed output:

```bash
./my_test
```
</Note>

---

## 5. Configuring GoogleTest Builds

### 5.1 C++ Standard

GoogleTest requires at least C++17. Configure your project accordingly:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### 5.2 Threading Support

GoogleTest supports multi-threaded tests on platforms with pthread. It auto-detects pthread availability, but you can force it:

- To enable pthread explicitly:

  ```cmake
  add_compile_definitions(GTEST_HAS_PTHREAD=1)
  ```

- To disable pthread:

  ```cmake
  add_compile_definitions(GTEST_HAS_PTHREAD=0)
  ```

### 5.3 Shared Library Builds

If you want GoogleTest as a shared library (DLL on Windows):

- Add the compiler flag:

  ```cmake
  add_compile_definitions(GTEST_CREATE_SHARED_LIBRARY=1)
  ```

- And when compiling tests:

  ```cmake
  add_compile_definitions(GTEST_LINKED_AS_SHARED_LIBRARY=1)
  ```

---

## 6. Tweaking Build Options

GoogleTest provides several compile-time macros to control features. For example:

- Prevent macro name clashes with other libraries:

  ```cmake
  add_compile_definitions(GTEST_DONT_DEFINE_TEST=1)
  ```

  This requires using `GTEST_TEST` instead of `TEST` in your tests.

- For a complete set of macros, see [gtest-port.h](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h).

---

## 7. Troubleshooting Common Build Issues

- **Runtime Mismatch (MSVC users):**

  Errors about 'RuntimeLibrary' mismatch indicate static vs dynamic CRT conflicts. Fix by setting `gtest_force_shared_crt=ON`.

- **Missing pthread linker errors:**

  Ensure your compiler adds `-pthread` or equivalent linker flags, or define `GTEST_HAS_PTHREAD=0` to disable threading.

- **CMake version too low:**

  The fetch content method requires CMake ≥ 3.14; upgrade if necessary.

- **Permission denied on install:**

  Use `sudo` (Linux/macOS) or run as administrator (Windows).

---

## 8. Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Official Site](https://cmake.org/)
- [Quickstart: Building with CMake](docs/quickstart-cmake.md)
- [Common Setup Issues](getting-started/setup-troubleshooting/common-setup-issues.md)

---

With this guide, you can confidently install, configure, and build GoogleTest and GoogleMock using CMake, enabling reliable, automated testing in your C++ projects.

<Source url="https://github.com/google/googletest" branch="main" paths='[{"path":"googletest/README.md","range":"1-105"},{"path":"googletest/CMakeLists.txt","range":"1-120"},{"path":"docs/quickstart-cmake.md","range":"1-121"},{"path":"googlemock/CMakeLists.txt","range":"1-130"}]' />