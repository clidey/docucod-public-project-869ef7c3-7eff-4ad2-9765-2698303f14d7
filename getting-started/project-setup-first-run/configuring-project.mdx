---
title: "Configuring Your Project"
description: "Demonstrates how to link GoogleTest into a new or existing C++ project, set up CMake or Bazel configuration files, and ensure the framework is referenced correctly. This establishes the technical foundation for building and running tests."
---

# Configuring Your Project

This guide walks you through the essential steps to integrate GoogleTest (and GoogleMock) into your C++ project. It covers how to correctly reference the testing framework in your build system, primarily focusing on CMake and Bazel, to enable building and running your tests with confidence.

---

## 1. Understanding the Purpose of Configuration

Before you write your first test, GoogleTest must be linked into your project. This process ensures your test code and the GoogleTest framework co-compile and link correctly, providing the test runner, assertions, and mocking facilities.

This page specifically shows you how to configure your project to:

- Link against the GoogleTest and GoogleMock libraries
- Include the necessary headers
- Use build-system-specific configuration file setup (CMake and Bazel)

<Info>
Configuring your project correctly is the technical foundation upon which successful testing depends.
</Info>

---

## 2. Configuring with CMake

CMake is the most common build system supported by GoogleTest. Below is a practical setup for a new or existing CMake-based project.

### Step 2.1: Fetch or Install GoogleTest

You can integrate GoogleTest by including it as an external project or installing it system-wide. The [Installation Methods](../../getting-started/prerequisites-installation/installation-methods.md) guide offers details.

### Step 2.2: Adding GoogleTest to Your CMakeLists.txt

Here is a simple example that demonstrates how to add GoogleTest and GoogleMock to your project:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

# Find installed GoogleTest package
find_package(GTest REQUIRED)

# Add your library or executable
add_executable(my_tests tests/test_main.cc tests/my_test.cc)

# Link against GoogleTest and pthread
# GTest::gtest and GTest::gmock targets provided by find_package

target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock Threads::Threads)

target_include_directories(my_tests PRIVATE ${GTEST_INCLUDE_DIRS})

# Enable C++17 Standard
set_target_properties(my_tests PROPERTIES CXX_STANDARD 17 CXX_STANDARD_REQUIRED YES)
```

<Tip>
Ensure you link `Threads::Threads` on Linux/macOS to resolve threading dependencies.
</Tip>

### Step 2.3: Using GoogleMockâ€™s Main Function

GoogleMock provides a predefined main function for test programs in `gmock_main`.

To use it:

```cmake
find_package(GTest REQUIRED)
add_executable(my_tests tests/my_test.cc)
target_link_libraries(my_tests PRIVATE GTest::gmock_main Threads::Threads)
```

Linking with `gmock_main` provides an entry point that initializes GoogleTest and GoogleMock, so you don't have to define your own `main()`.

### Step 2.4: Your Own main() vs. gmock_main

If you prefer to define your own main, link against `gtest` and `gmock` directly:

```cmake
add_executable(my_tests tests/my_test.cc)
# Link with gtest and gmock; you must define main()
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock Threads::Threads)
```

Otherwise, use `gmock_main` which takes care of test runner initialization.

### Common Pitfalls and Troubleshooting

<Warning>
- Forgetting to link `Threads::Threads` can cause linker errors for `pthread` symbols.
- Mixing different GoogleTest versions or linking static and dynamic libraries simultaneously may lead to conflicts.
</Warning>

---

## 3. Configuring with Bazel

GoogleTest also integrates with Bazel. To configure Bazel correctly:

1. Declare `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` as dependencies in your Bazel targets.
2. Add these dependencies to your test target `deps`.

Example `BUILD` file snippet:

```starlark
cc_test(
    name = "my_tests",
    srcs = ["my_test.cc"],
    deps = [
        "@com_google_googletest//:gmock",
        "@com_google_googletest//:gtest_main",
    ],
)
```

Bazel will automatically set up the linking and inclusion paths.

<Note>
Ensure your workspace is configured to fetch GoogleTest via `WORKSPACE` declarations. Refer to the Bazel documentation for full details.
</Note>

---

## 4. Verifying Configuration

After setting up, confirm that:

- Your project builds successfully.
- The test executable links against GoogleTest/GoogleMock.
- Running the test executable lists and executes your tests.

You can add a simple test case to check your setup, for example:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, SanityCheck) {
  EXPECT_EQ(1, 1);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Compile and run it to verify the configuration.

---

## 5. Summary and Best Practices

- Prefer linking against `gmock_main` if you want standard test runner initialization.
- Use `Threads::Threads` on POSIX systems to handle threading properly.
- Keep GoogleTest and GoogleMock versions consistent.
- Configure your build system properly to avoid common pitfalls with linkage.

For advanced configuration options, including building GoogleTest from source, custom flags, and platform-specific tweaks, refer to the [Installation Methods](../../getting-started/prerequisites-installation/installation-methods.md) and [System Requirements](../../getting-started/prerequisites-installation/system-requirements.md) guides.

---

## 6. Troubleshooting Tips

<AccordionGroup title="Common Configuration Issues">
<Accordion title="Linker errors about pthread or threading">
Make sure to link your test executable with `Threads::Threads` in CMake. On Linux/macOS, use:

```cmake
target_link_libraries(your_test_target PRIVATE Threads::Threads)
```

On Windows, pthreads is not required.
</Accordion>
<Accordion title="Multiple definition errors or conflicting GoogleTest versions">
Ensure only one copy of GoogleTest/GoogleMock is linked. Avoid mixing shared and static libraries.
Check your dependencies and clean your build directory frequently.
</Accordion>
<Accordion title="Missing main function">
Link your executable either with `gmock_main` (recommended) or provide your own `main()` that calls `InitGoogleTest` or `InitGoogleMock`.
</Accordion>
</AccordionGroup>

---

## 7. Additional Resources

- [Installation Methods Guide](../../getting-started/prerequisites-installation/installation-methods.md) for detailed setup
- [System Requirements](../../getting-started/prerequisites-installation/system-requirements.md) for environment compatibility
- [Writing & Running Your First Test](../writing-running-first-test.md) to start authoring tests
- [Mocking Reference](../../../docs/reference/mocking.md) for advanced mocking configuration
- GoogleTest GitHub Repository: [https://github.com/google/googletest](https://github.com/google/googletest)

---

This configuration setup lays down the foundation enabling you to seamlessly build upon GoogleTest and GoogleMock, unlocking powerful and maintainable testing capabilities in your C++ projects.
