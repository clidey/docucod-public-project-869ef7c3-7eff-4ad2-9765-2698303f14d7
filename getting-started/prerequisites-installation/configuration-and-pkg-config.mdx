---
title: "Configuration and pkg-config"
description: "Explains basic configuration needed for integrating GoogleTest/GoogleMock (like include paths, linking, and environment variables), with guidance on leveraging pkg-config for easy setup."
---

# Configuration and pkg-config

This guide explains the essential steps to configure your environment for integrating GoogleTest and GoogleMock into your C++ projects. It covers setting include paths, linking libraries, defining required macros, and leveraging `pkg-config` to automate compiler and linker flags.

---

## 1. Understanding Basic Configuration for GoogleTest/GoogleMock

Before you compile and link your tests with GoogleTest or GoogleMock, you need to ensure your build system knows where to find the headers and libraries, and which macros to define. These configuration settings ensure compatibility, threading support, and correct linking.

### Key Configuration Elements

- **Include Paths**: Direct your compiler to GoogleTest/GoogleMock header files.
- **Linking Libraries**: Link your test binaries against the correct GoogleTest (`gtest`) or GoogleMock (`gmock`) libraries.
- **Compiler Macros**: Set necessary macros such as `GTEST_HAS_PTHREAD` to enable thread safety.

### When Using CMake

GoogleTest and GoogleMock provide CMake targets like `GTest::gtest`, `GTest::gtest_main`, `gmock`, etc. After installing or integrating these into your build environment, you can use `find_package` or add the source with `add_subdirectory()`.

Note that GoogleTest requires an environment compatible with C++17 and pthread support (or Windows threading equivalents).

---

## 2. Using pkg-config for Easy Setup

GoogleTest and GoogleMock provide standardized `.pc` (pkg-config) files on installation that encapsulate all necessary compilation and linking flags, including:

- Include directory (-I flags)
- Preprocessor macros (-D flags)
- Libraries to link (-L and -l)
- Additional flags such as `-pthread`

Using `pkg-config` simplifies configuration by letting you query all flags in one place.

### Example: Integrating pkg-config in a CMake Build

Here's how to use `pkg-config` to configure your CMake project to build a test executable:

```cmake
find_package(PkgConfig REQUIRED)
pkg_search_module(GTEST REQUIRED gtest_main)  # Finds GoogleTest pkg-config details

add_executable(testapp samples/sample3_unittest.cc)
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(NAME first_and_only_test COMMAND testapp)
```

> This method uses the full compiler and linker flags provided by pkg-config to ensure all necessary macros, include paths, and libraries (including threading flags) are set correctly.

---

## 3. Manually Configuring Include Paths and Linking (If Not Using pkg-config)

If you prefer or need to manually specify paths and flags, ensure the following:

### Include Paths

Add the GoogleTest/GoogleMock `include` directories to your compiler search paths, for example:

```bash
-I/usr/local/include
```

or in CMake:

```cmake
target_include_directories(your_target PRIVATE /usr/local/include)
```

### Linking Libraries

Link against the correct libraries depending on your use case:

- For GoogleTest only: link with `-lgtest` or `GTest::gtest` target
- For GoogleMock (which includes GoogleTest): link with `-lgmock` or `gmock` target

Example link flags:

```bash
-L/usr/local/lib -lgmock_main -lpthread
```

### Define Necessary Macros

GoogleTest uses the macro `GTEST_HAS_PTHREAD` to enable thread-safety features and requires it when pthreads are available. If pthread detection is tricky in your environment, define this macro explicitly:

```bash
-DGTEST_HAS_PTHREAD=1
```

CMake's pkg-config files automatically include this macro in the `Cflags`.

---

## 4. Environment Variables for pkg-config

If pkg-config cannot find the GoogleTest `.pc` files, you need to inform it where to look.

### Set `PKG_CONFIG_PATH`

If you installed GoogleTest in a custom location like `/usr/local`, set:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

or the appropriate pkgconfig directory for your system.

### Cross-Compilation Considerations

In cross-compilation environments, you may need to set:

```bash
export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
export PKG_CONFIG_SYSROOT_DIR=/path/to/sysroot
export PKG_CONFIG_LIBDIR=$PKG_CONFIG_SYSROOT_DIR/usr/lib64/pkgconfig
```

This ensures that include and library paths reflect the target system rather than the build system.

---

## 5. Tips and Best Practices

<AccordionGroup title="Configuration Best Practices and Common Pitfalls">
<Accordion title="Use pkg-config Where Possible">
Leveraging pkg-config simplifies build system integration, automatically sets necessary flags, and reduces manual errors.
</Accordion>
<Accordion title="CMake Targets and FetchContent"> 
Use GoogleTest's CMake targets or FetchContent features to integrate GoogleTest directly into your projects, ensuring matching compiler options and reducing configuration overhead.
</Accordion>
<Accordion title="Windows Runtime Linking">
On Windows, conflicts between static and dynamic CRT linking can cause errors. The `gtest_force_shared_crt` CMake option forces GoogleTest to link dynamically, matching typical Visual Studio default behavior.
</Accordion>
<Accordion title="Explicitly Define Pthread Macro If Needed">
In environments where pthread detection fails, manually define `-DGTEST_HAS_PTHREAD=1` or `0` as appropriate.
</Accordion>
</AccordionGroup>

---

## 6. Summary

Following these configuration steps will establish a solid foundation for compiling and linking your tests against GoogleTest and GoogleMock. Whether through pkg-config or manual settings, the key aspects are ensuring header paths, libraries, and macros are properly set to enable full functionality, including thread safety.

---

## 7. Troubleshooting Common Configuration Issues

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="pkg-config Can't Find GoogleTest">
Ensure that `PKG_CONFIG_PATH` includes the directory where `gtest.pc` or `gmock.pc` files reside.

Example:
```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Then rerun your build.
</Accordion>
<Accordion title="Linker Errors Related to pthread">
If linking fails due to missing pthread libraries, verify that the pthreads library is available and linked. If using CMake, the scripts handle this; otherwise, add `-lpthread` manually.
</Accordion>
<Accordion title="Windows Runtime Library Mismatch">
Enable the CMake option `gtest_force_shared_crt` to align GoogleTest's runtime with your project's dynamic runtime linkage.
</Accordion>
</AccordionGroup>

---

## 8. Additional Resources and References

- [GoogleTest README (CMake build instructions)](https://github.com/google/googletest/blob/main/README.md)
- [Using pkg-config in cross-compilation](https://autotools.io/pkgconfig/cross-compiling.html)
- [GoogleTest Supported Platforms & Requirements](../getting-started/prerequisites-installation/supported-platforms-requirements)
- [Integrating GoogleTest into your build system](../overview/audience-use-cases-and-integration/integration-and-compatibility)

---

Feel confident that with this configuration knowledge, your environment will be correctly set up to compile, link, and run GoogleTest and GoogleMock based tests efficiently and reliably.
