---
title: "Installing with Bazel"
description: "Guide users to add GoogleTest and GoogleMock to their Bazel build environment, covering necessary workspace and buildfile configuration for different project layouts."
---

# Installing with Bazel

This guide helps you integrate GoogleTest and GoogleMock into your Bazel build environment. You'll learn how to configure your workspace and `BUILD` files correctly to use GoogleTest for testing C++ projects. This covers different project layouts and provides actionable, straightforward examples.

---

## 1. Prerequisites

Before you begin, ensure your environment meets the following requirements:

- **Operating System**: Linux, macOS, Windows
- **C++ Compiler**: Supports at least C++17 (e.g., GCC, Clang, MSVC)
- **Bazel Version**: 7.0 or higher

If you haven't installed Bazel yet, follow the official [Bazel installation guide](https://bazel.build/install).

For detailed platform compatibility and compiler specifics, see the [Supported Platforms](../platforms.md) page.

<Note>
Make sure your Bazel version is at least 7.0, as earlier versions may not support required features or GoogleTest's recommended integration.
</Note>

---

## 2. Setting Up Your Bazel Workspace

A Bazel workspace is the root directory containing your project alongside your `MODULE.bazel` file that declares external dependencies.

### 2.1 Create Your Workspace Directory

Open a terminal and run:

```bash
mkdir my_workspace && cd my_workspace
```

### 2.2 Configure `MODULE.bazel`

To add GoogleTest as a dependency, create a file named `MODULE.bazel` in your workspace root with the following content:

```python
# MODULE.bazel

# Specify the GoogleTest version you want to use. Update the version to the latest labeled release from
# https://registry.bazel.build/modules/googletest
bazel_dep(name = "googletest", version = "1.17.0")
```

This ensures your Bazel build fetches the GoogleTest and GoogleMock libraries correctly.

<Warning>
If your project already contains a `WORKSPACE` file, note that if you enable Bazel's Bzlmod module system with `MODULE.bazel`, the traditional `WORKSPACE` is ignored. Make sure to migrate dependencies accordingly.
</Warning>

---

## 3. Creating Your First Test Target

To use GoogleTest within Bazel, you need to write your test source files and declare a `cc_test` target that depends on GoogleTest libraries.

### 3.1 Write a Sample Test File

Create a file named `hello_test.cc` with this content:

```cpp
#include <gtest/gtest.h>

// Sample test demonstrating basic assertions.
TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### 3.2 Create a Bazel Build File

Next, create a `BUILD` file in the same directory with the following:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

This configures the test binary, linking it with GoogleTest and its `main()` function.

---

## 4. Building and Running Your Test

Run the following command to build and execute your test:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

### Expected Outcome

You should see output similar to:

```
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions (0 ms)
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

This confirms your Bazel environment is correctly set up to build and run GoogleTest tests.

<Check>
Ensure to include the `--cxxopt=-std=c++17` flag (or `/std:c++17` on MSVC) to enforce the C++17 standard, as GoogleTest requires it.
</Check>

---

## 5. Best Practices and Tips

- **Keep your `MODULE.bazel` up to date:** Periodically update the GoogleTest version to leverage bug fixes and improvements.
- **Use `@googletest//:gtest_main` for simpler tests:** It supplies the `main()` function, so you don't need to write one yourself.
- **Modularize your tests:** Structure Bazel targets per component for easier maintenance and faster incremental builds.

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Bazel Installation and Build Issues">
<Accordion title="Bazel reports missing dependencies or can't find GoogleTest">
Ensure your `MODULE.bazel` has the correct `bazel_dep` entry for GoogleTest and you have run `bazel sync` to update dependencies.
</Accordion>
<Accordion title="Compilation fails due to C++ standard version">
Always specify C++17 with the `--cxxopt=-std=c++17` flag for GCC/Clang or equivalent `/std:c++17` for MSVC. Without this, GoogleTest will fail to compile.
</Accordion>
<Accordion title="Errors related to multiple definitions of main()">
Check that only one target is linking `gtest_main`. If you provide your own `main()`, link only with `@googletest//:gtest`.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps

* Explore the [Writing and Running Your First Test](../configuration-validation/first-test.md) guide to deepen your understanding.
* Advance to [Configuring Includes and Linking](../configuration-validation/include-and-link.md) for complex projects.
* Use the [Quick Validation Checklist](../configuration-validation/quick-validation.md) to verify your setup.
* For CMake users, see [Installing with CMake](../prerequisites-installation/installation-cmake.md).

---

## Appendix: Example Project Layout

```
my_workspace/
├── MODULE.bazel       # Declares GoogleTest dependency
├── BUILD             # Bazel build file declaring your test
└── hello_test.cc     # Your test source file
```

This simple structure aligns with Bazel's expectations and works across platforms.

---

For further information about Bazel's module system and GoogleTest integration, consult:

- [Bazel Module System Documentation](https://bazel.build/external/migration)
- [GoogleTest GitHub Repository](https://github.com/google/googletest)


---

### Example `MODULE.bazel` content:
```python
bazel_dep(name = "googletest", version = "1.17.0")
```

### Example `BUILD` file content:
```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

---

By following this guide, you will have successfully added GoogleTest and GoogleMock to your Bazel environment, ready to write, build, and run tests with confidence.
