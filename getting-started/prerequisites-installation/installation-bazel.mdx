---
title: "Installation with Bazel"
description: "Provides concise instructions for incorporating GoogleTest and GoogleMock into Bazel-based workflows. Covers adding the repository, build dependencies, and build/test invocation, helping Bazel users avoid common integration pitfalls."
---

# Installation with Bazel

This guide provides clear, step-by-step instructions for integrating GoogleTest and GoogleMock into your Bazel-based C++ projects. By following these instructions, you will be able to include the necessary repositories, declare build dependencies correctly, and invoke build and test commands to run your first operation with confidence.

---

## 1. Prerequisites & System Requirements

Before integrating GoogleTest with Bazel, ensure your environment meets the following requirements:

- **Operating System**: Linux, macOS, Windows (supported platforms)
- **Compiler**: C++ compiler with support for at least C++17
- **Bazel Version**: Bazel 7.0 or higher (required for native support of module dependencies)

> See the [Supported Platforms](../prerequisites-installation/system-requirements) page for full details on compatibility.

---

## 2. Adding GoogleTest Dependency to Your Bazel Workspace

GoogleTest support in Bazel is best handled through the Bazel Central Registry using Bazel modules. This approach simplifies dependency management and ensures compatibility.

### Step 2.1: Create or Edit `MODULE.bazel`

In the root of your Bazel workspace, create a file named `MODULE.bazel` if it doesn't exist already. Declare the `googletest` dependency by specifying the version you want. Example:

```starlark
# MODULE.bazel

bazel_dep(name = "googletest", version = "1.17.0")
```

> **Tip:** Check the [Bazel Central Registry](https://registry.bazel.build/modules/googletest) for the latest stable release versions to keep GoogleTest up to date.

### Step 2.2: Synchronize Dependencies

With the `MODULE.bazel` file configured, Bazel will automatically fetch GoogleTest dependencies when you build or test your project.

---

## 3. Declaring GoogleTest in Your Build Files

To use GoogleTest in your test binaries, declare the appropriate dependencies in your Bazel `BUILD` file.

### Step 3.1: Sample `BUILD` file for a Test Target

Create a `BUILD` file alongside your test source file (e.g., `hello_test.cc`) with the following content:

```starlark
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

- `@googletest//:gtest` includes the GoogleTest testing framework.
- `@googletest//:gtest_main` provides a default `main()` entry point for your tests.

### Step 3.2: Writing a Basic Test

Here is an example `hello_test.cc` to verify setup:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

---

## 4. Building and Running Your Tests

### Step 4.1: Build and Test Using Bazel

Run the following command in your workspace root to build and run the tests:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

- `--cxxopt=-std=c++17` ensures the compiler uses C++17 standard.
- `--test_output=all` shows full test output for debugging.

### Step 4.2: Expected Output

Successful test runs will include lines similar to:

```
[==========] Running 1 test from 1 test suite.
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions (0 ms)
[  PASSED  ] 1 test.
```

---

## 5. Best Practices and Common Pitfalls

- Always specify the C++ standard explicitly for consistency.
- Use the Bazel Central Registry to manage GoogleTest versions and dependencies.
- Link both `gtest` and `gtest_main` for test binaries that need a main function.
- On Windows, be mindful of compiler flags; use `/std:c++17` for MSVC.

---

## 6. Troubleshooting Tips

- **Build fails due to missing dependencies:** Verify `MODULE.bazel` is correctly configured and rerun Bazel to fetch dependencies.
- **Linker errors related to pthread:** Ensure your platform and compiler settings add pthread support (usually handled by Bazel on Unix).
- **Tests not discovered or running:** Confirm that your `cc_test` rule includes the correct `deps` on `@googletest//:gtest` and `gtest_main`.
- **Long Windows paths causing build issues:** Use Bazel flags such as `--output_user_root` to a shorter path to avoid Windows path length limitations.

---

## 7. Next Steps

After you have successfully integrated and run a basic GoogleTest with Bazel, consider exploring:

- [Writing Your First Test](../configuration-first-run/write-first-test) to understand test authoring best practices.
- [Quick Start: Using GoogleMock](../configuration-first-run/quick-start-mocking) for incorporating mock objects.
- [Troubleshooting Common Setup Issues](../troubleshooting-validation/common-setup-issues) for resolving integration issues.

---

## Additional Resources

- [GoogleTest Bazel Central Registry Module](https://registry.bazel.build/modules/googletest)
- [Bazel C++ Tutorial](https://docs.bazel.build/versions/main/tutorial/cpp.html)
- [Supported Platforms for GoogleTest](../prerequisites-installation/system-requirements)


<Check>
Make sure Bazel is installed and updated to at least version 7.0 before proceeding.
</Check>

<Check>
Always keep your `MODULE.bazel` file in sync with the recommended GoogleTest version to avoid compatibility issues.
</Check>