---
title: "Installation with Bazel"
description: "Learn how to set up GoogleTest and GoogleMock with Bazel, including dependency declarations, expected workspace layout, and basic Bazel invocation patterns. Suitable for users working in modern, large-scale, or cloud-native C++ environments."
---

# Installation with Bazel

Learn how to set up GoogleTest and GoogleMock with Bazel, including dependency declarations, expected workspace layout, and basic Bazel invocation patterns. This guide is tailored for users working in modern, large-scale, or cloud-native C++ development environments.

---

## 1. Prerequisites & System Requirements

Before starting, ensure your environment meets these requirements:

- **Operating System:** Linux, macOS, or Windows
- **C++ Compiler:** Compatible compiler supporting at least **C++17** (for example, GCC 7+, Clang 5+, MSVC 2015+)
- **Bazel:** Version **7.0** or later installed and configured

If Bazel is not installed, please follow the [Bazel installation guide](https://bazel.build/install).


<Note>
Although command examples mostly show Unix shell prompts (`$`), these commands work on Windows command prompt and PowerShell as well.
</Note>

---

## 2. Setting Up Your Bazel Workspace

A Bazel workspace is the root directory to manage your source files and dependencies.

### Step 1: Create a workspace directory

Open your terminal and run the following commands:

```bash
$ mkdir my_workspace && cd my_workspace
```

### Step 2: Declare GoogleTest dependency

In your workspace root, create a file named `MODULE.bazel`. This file declares external dependencies for Bazel to consume.

Add the following content to `MODULE.bazel`:

```python
# MODULE.bazel

# Declare GoogleTest dependency using the Bazel Central Registry.
bazel_dep(name = "googletest", version = "1.17.0")
```

You should update the version to the latest stable release available at [Bazel Central Registry for Googletest](https://registry.bazel.build/modules/googletest).

This step ensures Bazel fetches GoogleTest for your builds automatically.

---

## 3. Creating Your First Test Binary

Let’s walk through adding your first test source, configuring the build, and running it.

### Step 1: Write a basic test

Create a file named `hello_test.cc` in your workspace root and add this C++ code:

```cpp
#include <gtest/gtest.h>

// Basic example tests demonstrating assertions.
TEST(HelloTest, BasicAssertions) {
  // Expect these two strings to be different.
  EXPECT_STRNE("hello", "world");
  // Expect numeric equality.
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 2: Define the Bazel build rule

Create a `BUILD` file in the workspace root with this content:

```starlark
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

Explanation:

- `cc_test`: Bazel rule to build and run C++ tests.
- `name`: Target name.
- `srcs`: Source files.
- `deps`: GoogleTest libraries required to link the binary.

Refer to the [Bazel C++ Tutorial](https://docs.bazel.build/versions/main/tutorial/cpp.html) for deeper details on `BUILD` file syntax.

### Step 3: Build and run the test

Run the following command to build and execute the test:

```bash
$ bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

Flags explained:

- `--cxxopt=-std=c++17`: Ensures the C++17 standard is used.
- `--test_output=all`: Prints all test output.
- `//:hello_test`: Specifies the test target at workspace root.

### Expected output snippet:

```plaintext
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[----------] 1 test from HelloTest
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions (0 ms)
[----------] 1 test from HelloTest (0 ms total)
[  PASSED  ] 1 test.
```

Successful output confirms GoogleTest and Bazel are correctly set up and your test runs.

---

## 4. Best Practices and Tips

- **Keep your `MODULE.bazel` updated** with the latest GoogleTest versions to benefit from improvements and bug fixes.
- **Specify the C++ standard consistently** across your project by passing `--cxxopt` flags or configuring your Bazel toolchain.
- **Use `@googletest//:gtest_main` when you want to use GoogleTest’s built-in main() function** to simplify test binaries.
- For advanced test definitions, learn more about Bazel's `BUILD` file syntax to refine your test rules.

---

## 5. Troubleshooting Common Issues

### Issue: Bazel cannot find GoogleTest dependency

- Verify your `MODULE.bazel` contains the correct `bazel_dep` entry.
- Ensure internet access for Bazel to fetch dependencies.
- Run `bazel clean --expunge` and retry to clear cached invalid downloads.

### Issue: Test fails to compile due to missing C++17 support

- Confirm your compiler version supports C++17.
- Use `--cxxopt=-std=c++17` flag explicitly in your Bazel commands.
- On MSVC, replace with `--cxxopt=/std:c++17`.

### Issue: Test output is empty or not visible

- Add `--test_output=all` to Bazel test commands.

### Issue: Linking errors related to pthread

- Most Linux/macOS environments require linking with pthread.
- Bazel normally handles this via `@googletest` configuration, but check your compiler/linker setup if issues persist.

---

## 6. Next Steps

- Explore the [GoogleTest Primer](primer.md) to learn core testing concepts and advanced assertions.
- Check out [Writing and Running Your First Test](../setup-usage-validation/writing-first-test.md) for detailed test authoring.
- Integrate GoogleMock for mock object support; see the GoogleMock documentation.

---

## Summary Diagram of the Workflow

```mermaid
flowchart TD
  A[Create Workspace Directory] --> B[Add MODULE.bazel with googletest dependency]
  B --> C[Add Test Source (hello_test.cc)]
  C --> D[Create BUILD file with cc_test rule]
  D --> E[Run bazel test to build and execute]
  E --> F{Test Passed?}
  F -->|Yes| G[Success: Start writing more tests]
  F -->|No| H[Troubleshoot setup and build issues]
```

---