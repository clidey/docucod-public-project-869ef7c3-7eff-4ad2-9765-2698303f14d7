---
title: "Initial Configuration"
description: "Concise walkthrough on configuring your development environment to use GoogleTest and GoogleMock in a new or existing project. Covers include paths, linking libraries, and example minimum CMake/Bazel configs."
---

# Initial Configuration

Configure your development environment to seamlessly use GoogleTest and GoogleMock in your new or existing C++ project. This guide covers setting include paths, linking the required libraries, and crafting minimal example configurations for CMake and Bazel build systems.

---

## 1. Prerequisites

Before configuring GoogleTest and GoogleMock:

- Ensure you have installed GoogleTest and GoogleMock sources or binaries as per the [Installation Methods](../getting-started/prerequisites-installation/installation-methods.md) guide.
- Confirm your build environment supports C++17 since GoogleTest requires it (see [System Requirements](../getting-started/prerequisites-installation/system-requirements.md)).
- Access to your project's build configuration files for customization (e.g., `CMakeLists.txt` or Bazel `BUILD` files).

---

## 2. Setting Include Paths

Your build system must know where to find the GoogleTest and GoogleMock headers.

- Typically, the include paths point to the directories containing the `gtest` and `gmock` folders that house the headers.
- Ensure both GoogleTest and GoogleMock includes are added, especially if you plan to use mocking features.

### Example for CMake:

```cmake
# Assuming googletest is under external/googletest
include_directories(${PROJECT_SOURCE_DIR}/external/googletest/include)
```

### Example for Bazel:

- Define `includes` or `hdrs` appropriately in your `BUILD` file for the GoogleTest repository or workspace.

---

## 3. Linking Libraries

Linking is essential to provide GoogleTest and GoogleMock implementation binaries.

- Link against the `gtest` and `gmock` static or shared libraries you have built or installed.
- If using prebuilt or embedded sources, adjust link targets accordingly.
- Link `gtest_main` or `gmock_main` if you prefer to use their provided main functions.

### Example for CMake:

```cmake
# If you built gtest and gmock as part of the project or installed them
find_package(GTest REQUIRED)

add_executable(my_test test.cpp)
target_link_libraries(my_test GTest::gtest GTest::gmock GTest::gtest_main GTest::gmock_main pthread)
```

> Note: Linking `pthread` is required on POSIX systems.

### Example for Bazel:

- Add dependencies on `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` targets.

- Declare test targets in your `BUILD` file including these dependencies.

---

## 4. Minimal Configuration Examples

Here are practical minimal snippets demonstrating usage within CMake and Bazel.

### Minimal CMakeLists.txt Example:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Locate or add GoogleTest
find_package(GTest REQUIRED)

add_executable(my_test test.cpp)
# Link GoogleTest and GoogleMock libraries and pthread
target_link_libraries(my_test GTest::gtest GTest::gmock GTest::gtest_main GTest::gmock_main pthread)

# Enable testing
enable_testing()
add_test(NAME my_test COMMAND my_test)
```

### Minimal Bazel BUILD File Example:

```bazel
cc_test(
    name = "my_test",
    srcs = ["test.cpp"],
    deps = [
        "@com_google_googletest//:gtest",
        "@com_google_googletest//:gmock",
    ],
)
```

---

## 5. Using the Provided Main Function

GoogleTest and GoogleMock provide a ready-to-use `main()` in `gtest_main` and `gmock_main`.

- Prefer linking with `gtest_main` or `gmock_main` if your test driver does not need custom initialization.
- This removes the need to write your own `main()` function.

If you require special setup before tests run, define your own `main()` where:

```c++
int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Use `testing::InitGoogleMock` instead if you also want to initialize GoogleMock features.

---

## 6. Verifying Configuration

After setting include paths and linking libraries, verify:

- Your test executable compiles without missing headers or unresolved symbols.
- When running the test binary, it discovers and runs all defined tests.
- There are no runtime errors related to GoogleTest or GoogleMock initialization.

---

## 7. Tips, Best Practices, and Common Pitfalls

- **Consistent Naming:** Avoid underscores (`_`) in test suite and test names to prevent macros expansion issues (see [FAQ](../docs/faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore)).
- **Linking Order:** Ensure that `gtest_main` or `gmock_main` is linked last in your command to avoid unresolved references.
- **Thread Support:** Link to `pthread` on Linux/macOS to ensure multithreading support.
- **Custom Build Environments:** If you encounter compiler or linker errors, verify the C++ standard and compiler flags are compatible with C++17 and the build instructions.
- **Use Subdirectories:** When embedding GoogleTest source in your project, consider adding it as a CMake subdirectory for unified builds.

---

## 8. Troubleshooting Common Issues

<AccordionGroup title="Common Setup Issues">
<Accordion title="Compiler cannot find gtest/gtest.h">
Verify the include directories in your build system point to the GoogleTest source or installed include path.
</Accordion>
<Accordion title="Linker errors for gtest symbols">
Ensure you link against the correct libraries: `gtest`, `gmock`, and optionally `gtest_main` or `gmock_main`. On POSIX, also link `pthread`.
</Accordion>
<Accordion title="Multiple definitions of main()">
Do not link both your own main() and `gtest_main` or `gmock_main` simultaneously. Choose one.
</Accordion>
<Accordion title="Tests are not discovered or run">
Call `testing::InitGoogleTest` in your main function before `RUN_ALL_TESTS()`.
Check your test suite and test names follow valid conventions.
</Accordion>
</AccordionGroup>

---

## 9. Next Steps & Resources

- Write and build your first test as shown in [Create Your First Test](../getting-started/first-test-run/create-first-test.md).
- Run your tests and filter as described in [Running Your Tests](../getting-started/first-test-run/run-tests.md).
- Explore integration with build systems for more complex setups at [Integration with Build Systems](../../overview/use-cases-integration/integration-with-build-systems.md).
- Extend your testing with GoogleMock by consulting [Extending with GoogleMock](../../overview/use-cases-integration/extending-with-googlemock.md).

---

## References

- [GoogleTest Primer](../primer.md)
- [GoogleTest FAQ](../docs/faq.md)
- [GoogleTest User's Guide](../index.md)
- [Installation Methods](../prerequisites-installation/installation-methods.md)
- [System Requirements](../prerequisites-installation/system-requirements.md)

---

For complete source code, visit the official repository: [GoogleTest GitHub](https://github.com/google/googletest)

---

## Summary

The Initial Configuration guide helps set up your project to use GoogleTest and GoogleMock by specifying include paths, correctly linking libraries, and providing minimal example configurations for CMake and Bazel. It emphasizes leveraging provided main functions, ensuring environment compatibility, and avoiding common pitfalls. Practical troubleshooting tips and references to related documentation promote smooth onboarding.

---