---
title: "Configuration and Environment Setup"
description: "Introduces users to any environment variables, configuration files, or build flags needed for optimal integration with their development tools and running tests across platforms."
---

# Configuration and Environment Setup

This guide introduces you to the essential environment variables, configuration files, and build flags you need to configure GoogleTest effectively. Proper setup ensures smooth integration with your development tools and reliable test execution across diverse platforms.

---

## 1. Environment Variables and Command-Line Flags

GoogleTest supports a variety of environment variables and flags that control its behavior before and during test execution. These influence test discovery, output formatting, filtering, and runtime features.

### Essential Environment Variables

- **GTEST_FILTER**: Runs only tests that match the provided filter pattern, allowing you to focus on specific test suites or test names. Use this to quickly isolate areas for testing.

- **GTEST_REPEAT**: Repeats the entire test program the specified number of times (or indefinitely if negative). Useful for catching flaky tests.

- **GTEST_SHARD_INDEX** and **GTEST_TOTAL_SHARDS**: Use these to split tests across multiple shards (machines or processes) for parallel test execution.

- **GTEST_OUTPUT**: Defines output file format and location for test results, such as XML or JSON reports.

### Common Command-Line Flags

GoogleTest parses several flags via `testing::InitGoogleTest(&argc, argv);`, including but not limited to:

- `--gtest_filter=`: Controls which tests to run.
- `--gtest_list_tests`: Lists all available tests without running them.
- `--gtest_repeat=`: Repeats test execution.
- `--gtest_shuffle`: Randomizes the order of tests.
- `--gtest_color=`: Configures colored terminal output.
- `--gtest_fail_fast`: Stops test execution after first failure.
- `--gtest_also_run_disabled_tests`: Includes disabled tests in the run.

Use `--help` with your test binary to see all flags.

<Note>
Always call `testing::InitGoogleTest()` early in your `main()` function; it is responsible for parsing the flags and must precede `RUN_ALL_TESTS()`.
</Note>

---

## 2. Configuration Files and Customization Macros

GoogleTest provides customization points allowing you to configure internal behaviors, temporary directory locations, logging behaviors, and threading checks via macros.

### Custom Macros

Set these macros at compile time (e.g., via `-D` flags) or in a config header for advanced customization:

| Macro                         | Purpose                                                                      |
|-------------------------------|------------------------------------------------------------------------------|
| `GTEST_OS_STACK_TRACE_GETTER_`| Replaces the implementation used to obtain stack traces.                    |
| `GTEST_CUSTOM_TEMPDIR_FUNCTION_` | Overrides the default temporary directory path used by `testing::TempDir()`. |
| `GTEST_HAS_PTHREAD`            | Enable or disable pthread support (default auto-detected).                   |
| `GTEST_API_`                  | Controls symbol exporting for shared libraries.                              |
| `GTEST_LOG_(severity)`        | Customize logging outputs.                                                    |

You can learn more about these customization points in [Customizations](googletest/include/gtest/internal/custom/README.md).

### Configuration Files

GoogleTest does not rely on an external configuration file. Instead, it uses environment variables, command-line flags, and these compile-time macros for configuration.

---

## 3. Recommended Build Flags

GoogleTest requires C++17. Setting the appropriate compiler flags ensures compatibility and optimal behavior.

### Compiler Flags

- **C++17 Support**: Ensure `-std=c++17` (or equivalent) is enabled.

- **Threading and Exception Flags**: GoogleTest detects threads via `pthread` when available, controlled by `GTEST_HAS_PTHREAD`. You may need to add `-lpthread` or equivalent during linking.

- **Shared vs Static Runtime on Windows**:

  - By default, GoogleTest prefers static CRT linkage (`-MT`), which can cause conflicts with projects using dynamic CRT.
  - Pass `-Dgtest_force_shared_crt=ON` in CMake or `-DGTEST_CREATE_SHARED_LIBRARY=1` to switch to shared CRT.

- **Warning and Strictness Flags**: GoogleTest sets stricter warnings (`-Wall -Wextra`), so make sure your project is compatible.

### Using CMake

When building with CMake, use the official instructions, which automatically handle many configuration details:

```shell
cmake .. -DBUILD_GMOCK=OFF
make
sudo make install
```

Incorporate GoogleTest into your project with the FetchContent module or as a subdirectory for consistent flags.

<Info>
Link tests against `gtest_main` if you don't want to write your own `main()` function; it initializes GoogleTest and calls `RUN_ALL_TESTS()`.
</Info>

---

## 4. Setting Up Your Development Environment

To run GoogleTest seamlessly across platforms and different development tools, consider the following setup:

### Environment Setup Tips

- **Add GoogleTest to Include Paths**: Ensure the compiler can find `gtest/gtest.h`.

- **Link Properly**: Link against GoogleTest libraries; with CMake, use `target_link_libraries(my_test gtest_main)`, which also provides the main function.

- **Initialize GoogleTest in Main**:

  ```cpp
  int main(int argc, char** argv) {
    testing::InitGoogleTest(&argc, argv);
    return RUN_ALL_TESTS();
  }
  ```

- **Avoid Ignoring `RUN_ALL_TESTS()` Return Value**:

  The return value reflects test pass/fail; ignoring it leads to incorrect exit status.

- **Configure Build Tools for Thread Support**: Some platforms need explicit threading flags; verify your build system passes them.

### Handling Platform Specifics

- Windows requires special care with threading and runtime flags; use CMake's `gtest_force_shared_crt` flag if encountering CRT mismatch errors.

- On embedded platforms (ESP8266, ESP32, NRF52 with Arduino), GoogleTest provides custom `setup()` and `loop()` functions for testing.

- If your build system complains about missing symbols or macros, ensure all macros like `GTEST_CREATE_SHARED_LIBRARY` are set appropriately.

---

## 5. Best Practices and Common Pitfalls

- **Avoid Underscores in Test and Suite Names**: Underscores (`_`) in `TEST` and `TEST_F` names can cause problems with generated identifiers. Choose simple, underscore-free names.

- **Use `nullptr` Instead of `NULL`**: Explicit `nullptr` avoids template issues with assertion macros.

- **Use Test Fixtures to Manage Test State**: Avoid globals to keep tests isolated.

- **Never Ignore the Return of `RUN_ALL_TESTS()`**: Your test runner depends on it.

- **Be Careful with `ASSERT_*` in Constructors/Destructors**: Assertions that abort tests can only be used in void functions; prefer `SetUp()`/`TearDown()` methods.

- **Configure Death Tests with Care**: Death tests run in subprocesses; thread safety and test ordering matter.

- **Use Scoped Traces (`SCOPED_TRACE`)** for improving failure diagnostics in nested or repeated checks.

<Warning>
Improper environment or flag setup can cause flaky or silently ignored tests. Always verify your configuration early.
</Warning>

---

## 6. Troubleshooting Common Issues

### Problem: Tests won't run or are not discovered

- Verify `testing::InitGoogleTest()` is called before `RUN_ALL_TESTS()`.
- Check filters set by `--gtest_filter` or `GTEST_FILTER` environment variables.

### Problem: Linker errors regarding missing `main`

- Link against `gtest_main` for automatic `main`.
- If writing your own `main`, ensure it returns `RUN_ALL_TESTS()`.

### Problem: CRT mismatch on Windows

- Use CMake flag `-Dgtest_force_shared_crt=ON` to match dynamic CRT.

### Problem: Threading errors or deadlocks in death tests

- Avoid creating threads outside death tests.
- Use death test style "threadsafe" by setting `GTEST_FLAG_SET(death_test_style, "threadsafe")`.

### Problem: Macro clashes with other libraries

- Use `-DGTEST_DONT_DEFINE_TEST=1` to rename macros like `TEST` to `GTEST_TEST`.

---

## 7. Next Steps and References

- Explore the [GoogleTest Primer](primer.md) to learn basic test writing.
- Learn about [Advanced GoogleTest Topics](advanced.md) for parameterized tests, typed tests, and death tests.
- Understand [Test Macros and Suite Framework](api-reference/core-testing-api/test-macros-framework).
- Use [Common Installation and Setup Issues](getting-started/troubleshooting-common-issues/common-installation-issues) for deeper troubleshooting.

---

## Example: Basic Environment Setup

```cpp
#include <gtest/gtest.h>

TEST(FactorialTest, HandlesZeroInput) {
    EXPECT_EQ(1, Factorial(0));
}

int main(int argc, char **argv) {
    testing::InitGoogleTest(&argc, argv);
    return RUN_ALL_TESTS();
}
```

Build with:

```shell
mkdir build && cd build
cmake ..
make
./your_test_binary
```

Pass flags to run specific tests:

```shell
./your_test_binary --gtest_filter=FactorialTest.*
```

<Check>
Ensure consistent compiler flags and link against `gtest` or `gtest_main` as appropriate.
</Check>