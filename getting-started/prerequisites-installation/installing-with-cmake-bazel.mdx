---
title: "Installing with CMake and Bazel"
description: "Comprehensive installation instructions for GoogleTest and GoogleMock using CMake and Bazel, the primary supported build systems. Walks users through cloning, building, and integrating the libraries into their project."
---

# Installing with CMake and Bazel

This guide provides comprehensive, step-by-step instructions for installing GoogleTest and GoogleMock using the two primary build systems supported: **CMake** and **Bazel**. Whether you want to build GoogleTest standalone or integrate it directly into your projects, this page guides you through cloning the repository, building the libraries, and preparing them for use.

---

### 1. Installing with CMake

CMake is a cross-platform tool that generates native build files for your compiler environment. GoogleTest offers community-supported CMake scripts to help you build and install the libraries on most platforms.

#### Prerequisites
- **CMake 3.14 or newer** (for best compatibility; minimum required is 3.16 in GoogleTest sources)
- **C++17-compliant compiler** (GCC 7+, Clang 5+, MSVC 2017+, or equivalent)
- Compatible build tool such as Make, Ninja, Visual Studio, or Xcode

#### Step 1: Clone the GoogleTest Repository

Open a terminal and run:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
gotest_dir=googletest
cd ${gotest_dir}
```

This clones the stable 1.17.0 release. Replace the tag if you want a specific commit.

#### Step 2: Create and Enter Build Directory

It's best practice to build out-of-source:

```bash
mkdir build
cd build
```

#### Step 3: Configure the Build

By default, GoogleMock and GoogleTest are built together.

To build both:

```bash
cmake ..
```

To build only GoogleTest (disable GoogleMock):

```bash
cmake .. -DBUILD_GMOCK=OFF
```

Optionally, on Windows, force GoogleTest to use shared C runtime libraries by adding:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

#### Step 4: Build the Libraries

On Unix-like systems with a Makefile generator:

```bash
make
```

On Windows with Visual Studio, open the generated `.sln` solution file and build within the IDE.

If using Ninja:

```bash
ninja
```

#### Step 5: (Optional) Install the Libraries

If you have administrative permissions and want to install the libraries system-wide:

```bash
sudo make install
```

By default, this installs headers to `/usr/local/include` and libraries to `/usr/local/lib`.

#### Step 6: Verify Installation

Check the installed include directory contains `gtest/gtest.h` and (if installed) the library files like `libgtest.a` or `libgtest.so`.

##### Using GoogleTest in Your CMake Project

###### Method 1: Use Installed Libraries

```cmake
find_package(GTest CONFIG REQUIRED)
target_link_libraries(your_test_target PRIVATE GTest::gtest_main)
```

###### Method 2: Embed GoogleTest Source Code

Add GoogleTest inside your project via `add_subdirectory`:

```cmake
add_subdirectory(path/to/googletest)
target_link_libraries(your_test_target PRIVATE gtest_main)
```

Typically preferred for consistent build settings.

##### Minimal Example `CMakeLists.txt`

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)
include(GoogleTest)
gtest_discover_tests(hello_test)
```

#### Troubleshooting Tips

- **Runtime library mismatches on Windows:** Enable `gtest_force_shared_crt=ON` to match Visual Studio's runtime.
- **Missing pthread on Unix:** Ensure your system has pthread development libraries; CMake normally handles this.
- **Build errors due to C++ standards:** Enforce `CMAKE_CXX_STANDARD 17`.

---

### 2. Installing with Bazel

Bazel is Google's own build system, well-suited for large projects needing reproducible builds.

#### Prerequisites
- Install Bazel from https://bazel.build/
- Compatible C++ compiler supporting C++17

#### Step 1: Clone the Repository

```bash
git clone https://github.com/google/googletest.git
gotest_dir=googletest
cd ${gotest_dir}
```

#### Step 2: Build GoogleTest and GoogleMock Libraries

Build `gtest` and `gtest_main` libraries:

```bash
bazel build :gtest :gtest_main
```

To build the GoogleMock variants:

```bash
bazel build :gmock :gmock_main
```

This compiles the libraries with default Bazel settings.

#### Step 3: Integrate into Your Bazel Project

In your `BUILD` files, add dependencies on `@googletest//:gtest` or `@googletest//:gmock` depending on needs.

Example `BUILD` snippet for a test:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@googletest//:gtest_main"],
)
```

#### Step 4: Running Tests

Run tests with:

```bash
bazel test //path/to:my_test
```

#### Troubleshooting Tips

- **Link errors with `-pthread`:** Bazel handles this internally; ensure you use the Bazel provided toolchain.
- **Platform-specific build errors:** Review Bazelâ€™s platform config and constraints specified in `BUILD.bazel`.

---

### 3. pkg-config Support and Configuration

GoogleTest and GoogleMock provide `pkg-config` files to simplify compiler and linker flags usage once installed.

- For GoogleTest without `main()`: `gtest.pc`
- For GoogleTest with `main()`: `gtest_main.pc`
- For GoogleMock without `main()`: `gmock.pc`
- For GoogleMock with `main()`: `gmock_main.pc`

These files include necessary `-I` and `-L` flags along with threading flags.

To use pkg-config, after installing GoogleTest:

```bash
pkg-config --cflags gtest
pkg-config --libs gtest
```

This helps configure your build system easily.

---

### Summary
You have now learned:

- How to clone and build GoogleTest and GoogleMock using **CMake** including standalone and integration approaches
- How to build and use GoogleTest with **Bazel** including dependency declarations
- How to leverage provided **pkg-config** files for easy integration

For detailed test writing guidance and advanced usage, see related docs on creating your first test, running tests, and troubleshooting.

---

### Additional Resources
- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleTest CMakeLists.txt Source](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [GoogleMock CMakeLists.txt Source](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [CMake FetchContent Documentation](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- [GoogleTest Quickstart - CMake](quickstart-cmake.md)
- [GoogleTest Quickstart - Bazel](quickstart-bazel.md)

---

If unexpected issues arise during build or integration, consult the [Troubleshooting Setup Issues](/getting-started/first-test-validation/troubleshooting-setup) guide.

Congratulations on successfully installing GoogleTest and GoogleMock with your preferred build system!
