---
title: "Installing with CMake"
description: "Detailed instructions for integrating GoogleTest using CMake, including fetching sources, configuring the project, and linking to your own builds. Explains the role of `CMakeLists.txt` and demonstrates its application in real-world projects."
---

# Installing with CMake

GoogleTest integrates seamlessly with CMake, offering flexible options to fetch, configure, build, and link it within your C++ projects. This guide walks you through detailed instructions for incorporating GoogleTest using CMake, explaining the role of `CMakeLists.txt` files and demonstrating real-world usage.

---

## 1. Prerequisites & System Requirements

Before proceeding, ensure your environment meets the following:

- **CMake version:** 3.14 or later (required for `FetchContent_MakeAvailable`)
- **C++ compiler:** Must support C++17 or later
- **Supported platforms:** Linux, macOS, Windows (see [Supported Platforms & Environments](../overview/integration-and-ecosystem/platforms-environments.md))
- **Build tools:** Compatible with `make`, `ninja`, Visual Studio, Xcode, or others supported by your platform

<Check>
Confirm CMake is installed and available by running:

```bash
cmake --version
```

You should see output indicating your CMake version.
</Check>

---

## 2. Fetching and Including GoogleTest in Your CMake Project

There are two common approaches to include GoogleTest in your project:

### a. Using `FetchContent` to Download at Configure Time

This method downloads and builds GoogleTest automatically when you configure your project.

**Step-by-step:**

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)

# On Windows, ensure consistent runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

**Notes:**

- Update the `URL` to a specific commit or release tag for stability.
- The flag `gtest_force_shared_crt` addresses Visual Studio runtime mismatches.

### b. Adding GoogleTest as a Subdirectory

If you maintain a copy of GoogleTest sources within your repo or as a git submodule, add it directly:

```cmake
add_subdirectory(path/to/googletest)
```

This method ensures all compile settings are consistent with your project and avoids potentially mismatched binaries.

---

## 3. Configuring Your Project to Use GoogleTest

After including GoogleTest, you'll need to update your `CMakeLists.txt` to build your tests.

**Example `CMakeLists.txt` snippet:**

```cmake
# Enable testing support in CMake
enable_testing()

# Define the test executable
add_executable(hello_test hello_test.cc)

# Link test executable with GoogleTest's main library
# Use GTest::gtest_main if using FetchContent or find_package
target_link_libraries(hello_test PRIVATE GTest::gtest_main)

# Enable automatic test discovery
include(GoogleTest)
gtest_discover_tests(hello_test)
```

**Explanation:**

- `enable_testing()` activates CTest support
- `add_executable` defines your test binary
- Linking `GTest::gtest_main` provides GoogleTest's main function implementation
- `gtest_discover_tests()` lets CTest find and run your tests automatically

---

## 4. Building and Running Tests

### Build Process

Run the following commands from your project root directory:

```bash
cmake -S . -B build
cmake --build build
```

- `cmake -S . -B build` configures the project and fetches GoogleTest if using `FetchContent`
- `cmake --build build` compiles your test binary

### Run Tests

Execute tests with CTest:

```bash
cd build
test
```

Expected output for a simple test:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.01 sec

100% tests passed, 0 tests failed out of 1
```

---

## 5. Understanding `CMakeLists.txt` and Build Targets

### Role of the `CMakeLists.txt`

- Defines project configuration
- Specifies C++ standard and required variables
- Incorporates GoogleTest via FetchContent or subdirectory
- Declares test executables and links against GoogleTest
- Enables automatic test discovery and CTest reporting

### GoogleTest Targets

- `GTest::gtest` – GoogleTest without `main()`
- `GTest::gtest_main` – GoogleTest including `main()`

Use `gtest_main` if you do not provide your own main function.

---

## 6. Customizing and Troubleshooting

### Common Options

- **Build GoogleMock**: Use `-DBUILD_GMOCK=ON` to include GoogleMock libraries
- **Shared vs Static Libraries**: Control with `BUILD_SHARED_LIBS` in your CMake cache

### Visual Studio Runtime Mismatches

If using Visual Studio, enable:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

in your `CMakeLists.txt` to align runtime linkage.

### Multi-threading Support

GoogleTest detects pthread support automatically in CMake. If detection fails, control manually using:

```cmake
-DGTEST_HAS_PTHREAD=1
```

### Debugging Build Issues

- Ensure CMake version is 3.14 or higher
- Confirm C++17 support in your compiler
- Check for mismatched GoogleTest versions when using prebuilt installs
- Use verbose build logs for troubleshooting:

```bash
cmake --build build -- VERBOSE=1
```

---

## 7. Real-World Example

Putting it all together, here is a minimal `CMakeLists.txt` example:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(
  hello_test
  hello_test.cc
)
target_link_libraries(
  hello_test
  PRIVATE
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

Run these commands to build and validate:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

---

## 8. Next Steps & Additional Resources

- Dive into [Writing and Running Your First Test](../getting-started/first-test-validation/writing-running-first-test.md) to explore test creation.
- Learn about [Configuring GoogleTest in Your Project](../getting-started/configuration-troubleshooting/configuration-basics.md) for advanced setup.
- Explore [Integration with C++ Ecosystem](../overview/integration-and-ecosystem/integration-with-cpp-systems.md) for IDEs and CI pipelines support.
- For alternative build systems like Bazel, see the [Installing with Bazel](../getting-started/prerequisites-installation/install-bazel.md) guide.

---

<Tip>
To keep your GoogleTest dependency stable and avoid unexpected changes, specify a fixed commit hash or release in your `FetchContent_Declare` URL.
</Tip>

<Warning>
Building GoogleTest as a shared library on Windows requires care with runtime linkage. Use `gtest_force_shared_crt` to avoid linker errors.
</Warning>

---

# Summary
This page delivers comprehensive instructions on integrating GoogleTest into your C++ projects using CMake. It covers initial prerequisites, fetching the library with `FetchContent`, configuring your `CMakeLists.txt`, building and running tests, and troubleshooting common issues. Example configurations illustrate practical setup and usage to get you testing confidently and efficiently.

---

For more details, see the following:
- [System Requirements](../getting-started/prerequisites-installation/system-requirements.md)
- [Quickstart: Building with CMake](../docs/quickstart-cmake.md)
- [Configuring GoogleTest in Your Project](../getting-started/configuration-troubleshooting/configuration-basics.md)

Use this page as your primary reference to incorporate GoogleTest robustly and ensure smooth build integration via CMake.