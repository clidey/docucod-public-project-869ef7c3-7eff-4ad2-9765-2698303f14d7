---
title: "Install with CMake"
description: "Step-by-step instructions for installing GoogleTest and GoogleMock using CMake, covering fetching the source, configuring, building, and linking to your project for out-of-the-box usage."
---

# Install with CMake

This guide provides clear, step-by-step instructions to install and integrate **GoogleTest** and **GoogleMock** into your C++ projects using **CMake**. You'll learn how to fetch the source, configure the build, compile the libraries, and link them to your project for immediate use.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure your environment meets the following:

- **Supported Platform:** Linux, macOS, Windows, or any CMake-compatible system.
- **Compiler:** A C++ compiler that supports C++17 or higher.
- **Tools:**
  - [CMake](https://cmake.org/) version 3.13 (minimum), ideally 3.14+ for best compatibility.
  - A native build tool compatible with CMake such as Make or Ninja.
- **Network Access:** Internet connection to download GoogleTest sources when using fetching.

<Tip>
Ensure your development environment also supports linking against pthread if on Linux or Unix-like systems, as GoogleTest uses threading where supported.
</Tip>

## 2. Cloning and Building GoogleTest and GoogleMock

### Step 1: Clone the repository

Open a terminal and clone the official GoogleTest repository:

```bash
git clone https://github.com/google/googletest.git
cd googletest
```

>*Tip:* To build a specific release version for stability, clone with a tag, e.g., `-b v1.17.0`.

### Step 2: Create a separate build directory

```bash
mkdir build
cd build
```

>This separation keeps build files organized and lets you maintain source code clean.

### Step 3: Configure the build with CMake

Run CMake to generate native build files.

- To build **GoogleTest and GoogleMock** together (default):

```bash
cmake ..
```

- To build **only GoogleTest** (without GoogleMock):

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Compile the libraries

On Unix-like systems:

```bash
make
```

On Windows with Visual Studio, open the generated solution file (`.sln`) and build from the IDE.

### Step 5: Install (optional)

If you want to install GoogleTest and GoogleMock system-wide or to a custom location:

```bash
sudo make install
```

By default, this installs libraries and headers under `/usr/local/`.

<Tip>
You can customize the install location using `cmake .. -DCMAKE_INSTALL_PREFIX=/your/install/path` during configuration.
</Tip>

## 3. Incorporating GoogleTest and GoogleMock in Your Project with CMake

You have two main approaches:

### Option A: Link against installed GoogleTest/GoogleMock libraries

If you installed the libraries, simply find and link them in your project `CMakeLists.txt`:

```cmake
find_package(GTest REQUIRED)
add_executable(my_tests test_file.cc)
target_link_libraries(my_tests PRIVATE GTest::gtest_main)
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

This method requires the libraries and `.pc` files (pkg-config) to be discoverable.

### Option B: Build GoogleTest from source as part of your project

For tighter integration and consistent build settings, add GoogleTest as a subdirectory:

1. Either embed or add GoogleTest as a git submodule under your project.
2. In your `CMakeLists.txt`, add:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
# For Windows: Link runtimes dynamically to avoid conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_file.cc)
target_link_libraries(my_tests PRIVATE gtest_main)
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

This automatically downloads and builds GoogleTest along with your tests.

<Tip>
`FetchContent_MakeAvailable` requires CMake 3.14 or later.
</Tip>

## 4. Configuring and Building Your First Test

Once GoogleTest/GoogleMock is available, here is how to set up your first test.

### Step 1: Create a simple test source file

`hello_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 2: Add test executable in your project's `CMakeLists.txt`

If using `FetchContent`:

```cmake
add_executable(hello_test hello_test.cpp)
target_link_libraries(hello_test PRIVATE gtest_main)
enable_testing()
add_test(NAME HelloTest COMMAND hello_test)
```

### Step 3: Build and run tests

```bash
cmake -S . -B build
cmake --build build
ctest --test-dir build
```

Expected output:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.01 sec

100% tests passed, 0 tests failed
```

Congratulations! Your first CMake-driven build with GoogleTest is successful.

## 5. Linking Your Project Against GoogleMock

When you built GoogleMock (default), link your test executables with `gmock_main` instead of `gtest_main` to include mocking support:

```cmake
target_link_libraries(my_mock_tests PRIVATE gmock_main)
```

This provides the full GoogleMock functionality automatically.

## 6. Practical Tips and Best Practices

- Always set the C++ standard to 17 or higher in your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- On Windows with Visual Studio, use the option to force shared C runtime with:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

- Use `enable_testing()` and `add_test()` to integrate tests into CTest.

- For continuous integration, use the `ctest` command after building.

- If pkg-config fails to find GoogleTest, set `PKG_CONFIG_PATH` to where GoogleTest `.pc` files are installed.

## 7. Troubleshooting Common Issues

### Issue: CMake cannot find GoogleTest

- Verify installation path matches where pkg-config looks.
- Set environment variable:

```bash
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig
```

- Ensure CMake version is at least 3.13.

### Issue: Linking errors related to pthread

- Make sure your compiler and linker flags include pthread (usually handled by CMake automatically).

### Issue: Runtime library mismatch on Windows

- Use the `gtest_force_shared_crt ON` CMake flag to align runtimes.

<Tip>
Check the [GoogleTest GitHub repository](https://github.com/google/googletest) for community issues and additional help.
</Tip>

## 8. Next Steps

- Explore the [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) to write more advanced tests.
- Check the [GoogleMock for Dummies](https://github.com/google/googletest/blob/main/docs/googlemock_for_dummies.md) to start using mocks.
- Review [Integration Overview](../overview/architecture-core-concepts/integration-overview) to understand better integration with your build systems.

---

By following this guide, you have built and linked GoogleTest and GoogleMock using CMake, enabling you to write and run unit tests efficiently in your C++ projects.


---

# Quick Reference Code Snippet for Your Project's CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Enforce C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_file.cpp)
target_link_libraries(my_tests PRIVATE gmock_main)

enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

Build commands:

```bash
cmake -S . -B build
cmake --build build
ctest --test-dir build
```


<Check>
You have successfully built and linked GoogleTest and GoogleMock using CMake and ran your first test.
</Check>
