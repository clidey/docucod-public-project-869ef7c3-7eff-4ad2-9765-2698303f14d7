---
title: "Install with CMake"
description: "Provides practical, step-by-step guidance for installing GoogleTest using CMake, the primary build system used by C++ developers. Includes sample CMake configurations, important flags, and advice for common issues."
---

# Install with CMake

This guide walks you through installing GoogleTest (which includes GoogleMock) using CMake, the widely-adopted cross-platform build system favored by C++ developers. By following these clear, actionable steps, you will configure your environment, build the libraries, and verify the installation with minimal effort.

---

## 1. Prerequisites & System Requirements

Before installing GoogleTest with CMake, ensure your environment meets these requirements:

- **Operating System:** Linux, macOS, Windows (or other C++17-compatible OS).
- **Compiler:** Supports at least C++17 standard. Compatible compilers include GCC (>= 7), Clang, MSVC (Visual Studio 2017 or later).
- **CMake:** Version 3.13 or later is required. It manages build configuration and generates native project files.
- **Build Tools:** Compatible with Make, Ninja, Visual Studio, or other build tools supported by CMake.
- **Network Access:** Required if using CMake’s `FetchContent` module to download GoogleTest code.

<Tip>
Ensure your compiler environment is configured to compile C++17 code. You can enforce this via your project’s `CMakeLists.txt` using `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)`.
</Tip>

---

## 2. Downloading and Preparing GoogleTest

You can obtain the GoogleTest source code either by cloning the repository from GitHub or downloading a release archive.

### Step 1: Clone the Repository

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
googletest/
```

> Replace `v1.17.0` with your desired stable release tag or branch.

### Step 2: Create a Build Directory

Navigate into the downloaded source and create a separate folder for build artifacts:

```bash
cd googletest
mkdir build
cd build
```

Separating build files from source maintains a clean repository and simplifies rebuilds.

---

## 3. Configuring the Build with CMake

### Step 3: Generate Build Files

In the `build` directory, run CMake to configure your build system:

```bash
cmake ..
```

- This command scans source files and prepares native build files (e.g., Makefiles for Linux/macOS, Visual Studio projects for Windows).
- By default, this includes building both GoogleTest and GoogleMock.

If you prefer to build **only GoogleTest** (without GoogleMock), run:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Customizing Build Options

You can customize the build through CMake options:

- `BUILD_SHARED_LIBS`: Set to `ON` to build shared (.dll/.so) libraries instead of static (.lib/.a). Default is `OFF`.
- `gmock_build_tests`: Set to `ON` to build GoogleMock's own tests (disabled by default).

Example to enable test builds alongside shared libraries:

```bash
cmake .. -DBUILD_SHARED_LIBS=ON -Dgmock_build_tests=ON
```

<Tip>
Run `ccmake ..` or `cmake-gui` in the build directory for an interactive GUI to configure options conveniently.
</Tip>

---

## 4. Building GoogleTest

### Step 5: Compile the Libraries

To build the project, invoke your platform-specific build command from the build directory.

- On Linux/macOS (Make):

```bash
make
```

- Using Ninja:

```bash
ninja
```

- On Windows (Visual Studio):

Open the generated solution file (`.sln`) in Visual Studio and build the solution.

The build produces static/shared libraries and optional test executables based on your configuration.

### Step 6: (Optional) Run GoogleMock Tests

If you enabled `gmock_build_tests`, run the tests to verify the built components:

```bash
make test
# or
ctest
```

You can also filter tests with:

```bash
ctest -R <test_regex>
```

---

## 5. Installing GoogleTest onto Your System

### Step 7: Install Libraries and Headers

If you have administrator privileges and wish to install GoogleTest to your system (usually `/usr/local/`), run:

```bash
sudo make install
```

This copies headers and libraries to standard directories configured in the project.

<Tip>
Adjust the installation prefix by rerunning CMake with `-DCMAKE_INSTALL_PREFIX=/your/desired/path`.
</Tip>

### Step 8: Verifying Installation

Confirm that GoogleTest header files and libraries are installed correctly, typically in:

- Headers: `/usr/local/include/gtest/`
- Libraries: `/usr/local/lib/libgtest.a` or related shared libs

---

## 6. Incorporating GoogleTest into Your CMake Project

### Step 9: Using GoogleTest via FetchContent (Recommended)

In your own project’s `CMakeLists.txt`, incorporate GoogleTest using CMake’s `FetchContent` module for seamless dependency management:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows: Enable dynamic CRT linkage if needed
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test PRIVATE gtest_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(my_test)
```

Replace the URL with the current version URL or another commit hash to stay updated.

### Step 10: Link and Run Your Tests

Build and run your tests:

```bash
cmake -S . -B build
cmake --build build
ctest --output-on-failure
```

Success confirms GoogleTest is properly linked and ready for use.

---

## 7. Troubleshooting Common Issues

### Problem: CMake Version Too Low

- Ensure CMake is version 3.13 or higher for GoogleMock and 3.14 or higher for `FetchContent`.
- Upgrade via your package manager or download from https://cmake.org.

### Problem: Compiler Does Not Support C++17

- Verify the compiler version.
- Set C++17 explicitly in your `CMakeLists.txt` with `set(CMAKE_CXX_STANDARD 17)`.

### Problem: Runtime Library Mismatch on Windows

- If you see linker errors about runtime libraries (e.g., `MTd_StaticDebug` vs `MDd_DynamicDebug`), enable `gtest_force_shared_crt`:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### Problem: Tests Fail to Build

- Enable tests explicitly with `-Dgmock_build_tests=ON`.
- Confirm all dependencies and permissions are correct.

<Tip>
Refer to the [Troubleshooting Installation and Configuration guide](/getting-started/troubleshooting-support/common-troubleshooting) for a comprehensive list of solutions.
</Tip>

---

## 8. Additional Resources and Next Steps

- Explore the [Quickstart: Building with CMake guide](../guides/getting-started/quickstart-cmake.md) for running your first test.
- Visit the [Primer](../guides/getting-started/primer.md) to learn best practices for writing tests.
- See the [Integration Story](../../overview/getting-started-and-integration/integration-story.md) for advanced integration topics.


---

Congratulations! You have successfully installed GoogleTest and GoogleMock using CMake. You are now ready to write, build, and run robust C++ tests with confidence.


---

## Summary Diagram: Basic Build Flow

```mermaid
flowchart TD
  A[Clone googletest Repo] --> B[Create Build Directory]
  B --> C[Run CMake Configuration]
  C --> D[Build Libraries]
  D --> E[Run Tests] 
  E --> F{Build Successful?}
  F -->|Yes| G[Install (Optional)]
  F -->|No| H[Check Troubleshooting Guide]
```

---

## Example: Minimal Standalone `CMakeLists.txt`

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(test_sample sample_test.cpp)
target_link_libraries(test_sample PRIVATE gtest_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(test_sample)
```

Replace `sample_test.cpp` with your test source file.


---

## Best Practices

- Keep your build artifacts isolated in a dedicated build directory.
- Regularly update GoogleTest to benefit from the latest fixes and features.
- Use CMake’s `FetchContent` for simple, reproducible builds.
- For Windows users, pay careful attention to runtime linkage options.
- Build with strict compiler warnings to improve your code quality.

## Common Pitfalls

- Forgetting to enable testing via `enable_testing()` causes tests not to run.
- Omitting `set(CMAKE_CXX_STANDARD_REQUIRED ON)` can cause builds with unsupported standards.
- Sharing incompatible runtime library settings between your code and GoogleTest leads to link errors.

---

For comprehensive details on build flags, advanced configuration, and platform-specific notes, consult the [googlemock/CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt) directly or visit the [Quickstart: Testing with CMake](../guides/getting-started/quickstart-cmake.md).

---

<Check>
You have successfully installed and built GoogleTest using CMake and are ready for your first test.
</Check>
