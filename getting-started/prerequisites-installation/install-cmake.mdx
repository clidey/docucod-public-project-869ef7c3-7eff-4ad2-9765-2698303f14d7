---
title: "Installation: CMake"
description: "Guides users through installing GoogleTest with CMake, the primary and most portable build system. Includes commands, options, and how to integrate with your own project. Covers verification and common pitfalls for CMake integration."
---

# Installation: CMake

This guide walks you through installing and integrating **GoogleTest** using **CMake**, the primary and most portable build system for this framework. You'll learn how to build GoogleTest standalone, integrate it into your own CMake projects, verify the installation, and avoid common pitfalls.

---

## 1. Prerequisites & System Requirements

Before proceeding, ensure your system meets these requirements:

- **Operating System:** Linux, macOS, or Windows
- **Compiler:** Supports C++17 or later
- **CMake:** Version 3.13 or higher is recommended (3.14+ for FetchContent integration)
- **Build Tools:** Compatible with Make, Ninja, Visual Studio, or other native build tools supported by CMake

Ensure you have the necessary permissions to install software and create build directories.

---

## 2. Building GoogleTest as a Standalone Project with CMake

Follow these steps to build and install GoogleTest on your machine:

### Step 1: Clone the GoogleTest Repository

Open a terminal or command prompt and run:

```bash
git clone https://github.com/google/googletest.git -b main
git checkout v1.17.0  # Optional: checkout a stable release tag
cd googletest
```

### Step 2: Create and Enter a Build Directory

Create a separate build directory to keep build artifacts isolated:

```bash
mkdir build
cd build
```

### Step 3: Configure the Project with CMake

To build both **GoogleTest** and **GoogleMock** (default):

```bash
cmake ..
```

To build **GoogleTest** only, disable GoogleMock:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Build the Project

If using Make (Linux/macOS):

```bash
make -j$(nproc)
```

If using Ninja or Visual Studio, build with your preferred tools or via:

```bash
cmake --build . -- -j$(nproc)
```

On Windows with Visual Studio, open the generated `.sln` file to build.

### Step 5: Install (Optional but Recommended)

Install GoogleTest system-wide or to a custom location:

```bash
sudo make install
```

By default, this installs to `/usr/local`. Modify with `-DCMAKE_INSTALL_PREFIX` to change.

---

### Verification

Confirm `gtest` and `gmock` libraries are built and installed:

- Check `lib` directory inside your build folder for `libgtest.a` / `libgmock.a` (static) or shared libraries
- Installed include files should be under `/usr/local/include/gtest`
- Use `find_package(GTest REQUIRED)` in your project CMake to verify detection

---

## 3. Integrating GoogleTest into Your Own CMake Project

You have two main options for integrating GoogleTest into your project:

### Option 1: Use Installed GoogleTest Libraries

This method works after you install GoogleTest using the steps above.

**Steps:**

1. In your project's `CMakeLists.txt`, find GoogleTest:

```cmake
find_package(GTest REQUIRED)
```

2. Declare your test executable and link GoogleTest libraries:

```cmake
add_executable(my_test my_test.cc)
target_link_libraries(my_test PRIVATE GTest::gtest_main)
```

3. Enable test discovery:

```cmake
include(GoogleTest)
gtest_discover_tests(my_test)
```

4. Build and run tests using CMake:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

### Option 2: Add GoogleTest as a Subdirectory

This method compiles GoogleTest with your project, ensuring compiler/linker options are consistent.

**Steps:**

1. Download GoogleTest source into a subdirectory (e.g., `external/googletest`).
2. In your top-level `CMakeLists.txt`, add:

```cmake
add_subdirectory(external/googletest)

add_executable(my_test my_test.cc)
target_link_libraries(my_test PRIVATE gtest_main)

include(GoogleTest)
gtest_discover_tests(my_test)
```

3. Build normally using CMake. You don't need a separate install step.

---

## 4. Example: Minimal CMakeLists.txt with FetchContent

This sample `CMakeLists.txt` demonstrates automatic download and integration:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project LANGUAGES CXX)

# Require C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
# For Windows compatibility
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test PRIVATE gtest_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(hello_test)
```

Create `hello_test.cc` with your test cases and follow the typical CMake build workflow.

---

## 5. Common Pitfalls and How to Avoid Them

<AccordionGroup title="Common CMake Integration Issues">
<Accordion title="pkg-config Cannot Find GoogleTest">
If you install GoogleTest manually, the pkg-config `.pc` files may not be in standard locations. Fix this by setting the `PKG_CONFIG_PATH` environment variable:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Replace the path with where the `.pc` files reside on your system.

</Accordion>

<Accordion title="Build Errors on Windows with Visual Studio Runtime Mismatch">
By default, Visual Studio projects link to dynamic runtimes, but GoogleTest uses static C runtimes. Enable the `gtest_force_shared_crt` CMake option to align runtimes:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

</Accordion>

<Accordion title="Missing pthread Flags on Linux/macOS">
GoogleTest uses pthreads when available. If you get linker errors related to pthread, ensure you:

- Use the CMake build script which automatically adds necessary flags.
- If building manually, add `-pthread` to your compiler and linker commands.

</Accordion>

<Accordion title="Incompatible Compiler Options">
GoogleTest requires C++17 support. Ensure your compiler and CMake specify at least C++17:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

</Accordion>
</AccordionGroup>

---

## 6. Verification and Testing Your Installation

Create a simple test file, e.g., `sample_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(42, 6 * 7);
  EXPECT_STRNE("foo", "bar");
}
```

Add this to your `CMakeLists.txt`:

```cmake
add_executable(sample_test sample_test.cc)
target_link_libraries(sample_test PRIVATE gtest_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(sample_test)
```

Build and run tests:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

Expected output:

```
Test project /path/to/build
    Start 1: SampleTest.BasicAssertions
1/1 Test #1: SampleTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

Congratulations! This confirms your GoogleTest CMake installation is fully operational.

---

## 7. Next Steps

- Explore writing comprehensive tests in the [Writing Your First Test](../initial-configuration-validation/writing-first-test.md) guide.
- Review [Basic Configuration](../initial-configuration-validation/basic-configuration.md) for setting up test environment options.
- Check out [Common Installation & Build Issues](../troubleshooting-support/common-issues.md) for additional troubleshooting.

---

## Additional Resources

- [Official GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Official Documentation](https://cmake.org/documentation/)
- [GoogleTest Primer: Assertions and Basic Usage](../getting-started/initial-configuration-validation/writing-first-test.md)
- [GoogleTest Pkg-config Integration](../docs/pkgconfig.md)


<Tip>
Using the FetchContent module for GoogleTest integration simplifies dependency management and ensures your tests always build against the intended version of GoogleTest.
</Tip>

<Note>
Be sure to match the GoogleTest version in FetchContent URLs to the version you want to use; regularly updating this helps you benefit from the latest fixes and features.
</Note>