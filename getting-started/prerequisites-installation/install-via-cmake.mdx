---
title: "Installation with CMake"
description: "Guides users through obtaining, building, and integrating GoogleTest and GoogleMock using CMake, the most common modern build system for C++. Walks through adding GoogleTest to a CMake project, ensuring they can link and build seamlessly."
---

# Installation with CMake

This guide walks you through obtaining, building, and integrating GoogleTest and GoogleMock using CMake â€” the most common modern build system for C++. You'll learn how to add GoogleTest to your CMake project to link and build seamlessly.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure your environment meets the following:

- **CMake Version:** 3.14 or later (required for FetchContent support)
- **Compiler:** Must support C++17 (see [System Requirements](/getting-started/prerequisites-installation/system-requirements) for details)
- **Network:** Access to <https://github.com/google/googletest> if you fetch sources remotely
- **Permissions:** Ability to create directories and run build commands on your machine

<Tip>
Using C++17 is mandatory. Make sure your compiler is configured accordingly (e.g., add `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)` in your project).
</Tip>

---

## 2. Obtaining and Building GoogleTest with CMake

GoogleTest includes a built-in CMakeLists.txt and supports multiple ways to integrate. You can build it standalone or embed it into your project.

### 2.1 Building GoogleTest Standalone

Follow these steps to clone and build GoogleTest and GoogleMock as a separate project.

```bash
# Clone the official repository at a stable release version
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest

# Create a build directory
mkdir build && cd build

# Generate build files with CMake (includes GoogleMock by default)
cmake ..

# To build only GoogleTest, disable GoogleMock explicitly:
# cmake .. -DBUILD_GMOCK=OFF

# Build using the generated build system
make

# (Optional) Install system-wide (may require administrator privileges)
sudo make install
```

- On **Linux/macOS**, `make` builds the libraries.
- On **Windows**, a Visual Studio solution (`gtest.sln`) and project files (.vcproj) will be created automatically. Open with Visual Studio, then build.
- On **macOS with Xcode**, an `.xcodeproj` file will be generated.

<Note>
You can skip installing globally if you prefer linking directly from the build output.
</Note>

### 2.2 Incorporating GoogleTest Into Your Existing CMake Project

You have two main ways to add GoogleTest into an existing CMake project:

#### Option A: Linking to Installed GoogleTest

If GoogleTest is installed on your system (e.g., via `sudo make install`), use:

```cmake
find_package(GTest CONFIG REQUIRED)  # or use pkg_check_modules

add_executable(your_tests test_main.cpp)
target_link_libraries(your_tests PRIVATE GTest::gtest_main)
add_test(NAME your_tests COMMAND your_tests)
```

This method is simple but depends on system-wide installation.

#### Option B: Build GoogleTest as Part of Your Project

Embedding GoogleTest source code into your project ensures consistent compilation and linker settings, avoiding runtime incompatibilities especially on Windows.

There are several ways to do this:
- Download and place GoogleTest source at a known path.
- Add GoogleTest as a git submodule.
- Use CMake's FetchContent module to download at configure time (recommended).

Example using **FetchContent** (requires CMake >= 3.14):

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Windows: Use shared runtime matching main project
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Your test executable
add_executable(example example.cpp)

# Link against GoogleTest libraries as needed
target_link_libraries(example PRIVATE gtest_main)

add_test(NAME example_test COMMAND example)
```

This method ensures GoogleTest builds with your project's compiler and linker flags.

---

## 3. Configuration & Common Build Options

### 3.1 Handling Visual Studio Runtime Mismatches

By default, GoogleTest uses static runtime libraries `(/MT)` while new Visual Studio projects link dynamically `(/MD)`. This mismatch leads to linking errors such as:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary': 
value 'MTd_StaticDebug' doesn't match value 'MDd_DynamicDebug' in main.obj
```

**Solution:** Set the CMake option `gtest_force_shared_crt` to `ON`:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This forces GoogleTest to link against the dynamic runtime to match your project.

### 3.2 C++ Standard Version

GoogleTest requires C++17 or later. Set this in your main project `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

For projects without direct C++ code (e.g., C projects using GoogleTest only for testing), pass compiler flags using:

```bash
cmake -DCMAKE_CXX_FLAGS="-std=c++17" ..
```

### 3.3 Building as Shared or Static Library

By default, GoogleTest builds static libraries.

- To build shared libraries (DLLs on Windows), enable CMake's `BUILD_SHARED_LIBS` option:

```bash
cmake -DBUILD_SHARED_LIBS=ON ..
```

- Alternatively, add the compiler definition to create a shared library:

```bash
-DGTEST_CREATE_SHARED_LIBRARY=1
```

When using shared builds, add:

```bash
-DGTEST_LINKED_AS_SHARED_LIBRARY=1
```

to your test compile flags.

### 3.4 Tweaking GoogleTest Behavior

You can adjust GoogleTest by defining control macros (examples):

- To force pthread usage or disable it:

```bash
-DGTEST_HAS_PTHREAD=1   # force ON
-DGTEST_HAS_PTHREAD=0   # force OFF
```

- To rename GoogleTest macros and avoid clashes:

```bash
-DGTEST_DONT_DEFINE_TEST=1
```

This requires using `GTEST_TEST()` instead of `TEST()` macros.

---

## 4. Building and Running Your First Tests

### 4.1 Start the Build Process

After integrating GoogleTest, build your tests via CMake:

```bash
mkdir build
cd build
cmake ..
make
```

On Windows with Visual Studio, open the solution file and build from the IDE.

### 4.2 Running Tests

Once built, run tests with:

```bash
ctest
```

Or execute the test binary directly:

```bash
./example
```

Tests will run and output results clearly indicating success or failure.

---

## 5. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Build and Integration Issues">
<Accordion title="Build Failures due to C++ Standard Version">
If your build fails with unsupported flags or features, ensure your compiler supports C++17. Update compiler or set `CMAKE_CXX_STANDARD` accordingly.
</Accordion>

<Accordion title="Runtime Library Mismatch Errors on Windows">
Set `gtest_force_shared_crt` to `ON` to align runtime linkage between GoogleTest and your project.
</Accordion>

<Accordion title="GoogleTest Not Found via find_package()">
Confirm GoogleTest is installed and CMake can find its config files. If installed to a custom prefix, add it to `CMAKE_PREFIX_PATH` or install GoogleTest properly.
</Accordion>

<Accordion title="Linker Errors Related to pthreads on MinGW">
MinGW does not support pthreads in this context. Disable pthreads with `-Dgtest_disable_pthreads=ON` or use CMake's built-in thread handling.
</Accordion>
</AccordionGroup>

---

## 6. Next Steps

- Explore [Configuring Your Project](/getting-started/configuration-first-run/configure-project) to customize GoogleTest usage further.
- Write and run your first test with [Writing and Running Your First Test](/getting-started/configuration-first-run/write-first-test).
- Check out [Sample Tests and Common Workflows](/getting-started/configuration-first-run/test-samples) for practical examples.

---

## 7. Resources and References

- GoogleTest CMakeLists.txt and build scripting: [googletest/CMakeLists.txt](https://github.com/google/googletest/blob/main/googletest/CMakeLists.txt)
- GoogleMock CMake integration: [googlemock/CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- Using pkg-config with GoogleTest: [docs/pkgconfig.md](https://github.com/google/googletest/blob/main/docs/pkgconfig.md)
- System Requirements: [/getting-started/prerequisites-installation/system-requirements]
- Troubleshooting: [/getting-started/troubleshooting-validation/common-issues]

<Tip>
Leverage the FetchContent approach to ensure consistent and automated integration without manual steps or system-wide installs.
</Tip>

---

By following this guide, you will have GoogleTest and GoogleMock correctly integrated into your C++ project using CMake, enabling you to write, compile, and run tests efficiently with the powerful features provided by GoogleTest.