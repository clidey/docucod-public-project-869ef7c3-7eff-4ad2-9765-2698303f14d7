---
title: "Installing with CMake"
description: "Provides step-by-step instructions to install and configure GoogleTest using CMake, the recommended and most universal build system. Includes sample commands, expected outcomes, and guidance for integrating with C++ projects."
---

# Installing with CMake

This guide provides clear, step-by-step instructions to install and configure GoogleTest using CMake, the recommended and most universal build system. You'll learn how to build GoogleTest standalone or incorporate it into your existing C++ projects, with sample commands and expected outcomes for each step.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure your environment meets the following:

- **Operating System**: Compatible with Linux, macOS, Windows, or other supported platforms.
- **C++ Compiler**: Must support C++17 standard or greater.
- **CMake Version**: Minimum version 3.14 for FetchContent usage; 3.16+ recommended.
- **Build Tools**: Make, Ninja, Visual Studio, or other tools supported by CMake.

<Tip>
Verify your compiler supports C++17 by running `g++ --version` or equivalent.
Ensure CMake is installed by running `cmake --version`.
</Tip>

---

## 2. Installing GoogleTest as a Standalone Project

To install GoogleTest independently and build it with CMake, follow these steps:

### Step 1: Clone the GoogleTest repository

```bash
git clone https://github.com/google/googletest.git -b v1.16.0
cd googletest
```

This grabs the stable GoogleTest release.

### Step 2: Create and enter your build directory

```bash
mkdir build
cd build
```

Isolating build files keeps your source directory clean.

### Step 3: Generate build files with CMake

- To build both GoogleTest and GoogleMock (default):

```bash
cmake ..
```

- To build only GoogleTest (excluding GoogleMock):

```bash
cmake .. -DBUILD_GMOCK=OFF
```

You should see output indicating successful configuration.

### Step 4: Build the libraries

```bash
cmake --build .
```

On Unix-like systems, you can also run `make` inside the build directory.

### Step 5: (Optional) Install GoogleTest system-wide

If you have system administrator privileges and want to install GoogleTest:

```bash
sudo cmake --install .
```

By default, it will install under `/usr/local/` or your system's standard.

<Warning>
If you do not have root privileges, skip the install step and link your project directly against the built libraries.
</Warning>

### Verification

- Confirm built libraries are present, such as `libgtest.a` and `libgmock.a` (if built).
- Running tests provided by GoogleTest can be done via `ctest` inside the build directory:

```bash
ctest
```

You should see tests passing successfully.

---

## 3. Integrating GoogleTest into Your Existing CMake Project

Instead of installing GoogleTest system-wide, you can include it directly in your project's build.

### Step 1: Declare GoogleTest dependency using FetchContent

Add the following to your `CMakeLists.txt` at the root of your project:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows: prevent overriding parent compiler/linker settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

> Replace the URL hash with a current commit hash to keep GoogleTest up to date.

### Step 2: Add your test executable and link GoogleTest

At the bottom of your `CMakeLists.txt`, add:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)
target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

This setup builds your test binary linked against GoogleTest.

### Step 3: Write a simple test file

Create `hello_test.cc` with example assertions:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 4: Build and run your tests

Build your project with:

```bash
cmake -S . -B build
cmake --build build
```

Run tests with:

```bash
cd build
ctest
```

Expected output:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
```

<Tip>
Using `FetchContent` ensures your project and GoogleTest share the same compiler settings, preventing issues like runtime mismatches.
</Tip>

---

## 4. Configuration Options and Best Practices

### Key CMake options when building GoogleTest

- `BUILD_GMOCK` (default: ON): Build GoogleMock alongside GoogleTest.
- `INSTALL_GTEST` (default: ON): Controls whether GoogleTest is installed when running `make install`.
- `gtest_force_shared_crt` (default: OFF): On Windows, forces using the shared C runtime, matching Visual Studio defaults.

### Setting the C++ standard

Ensure your project explicitly sets:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

GoogleTest requires C++17 features.

### Avoiding Runtime Library Mismatches on Windows

If linking fails with runtime library mismatches (e.g., `_MTd_StaticDebug` vs `_MDd_DynamicDebug`), enable `gtest_force_shared_crt`:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### Multi-threaded Testing

GoogleTest automatically detects pthreads when building on supported platforms. You can override this detection with:

```cmake
-DGTEST_HAS_PTHREAD=1
```

if pthreads support is needed and not automatically detected.

---

## 5. Troubleshooting Common Issues

<AccordionGroup title="Common CMake Installation Issues">
<Accordion title="CMake version too low">
If `FetchContent_MakeAvailable` is not recognized, confirm you are using CMake >= 3.14.
Update CMake if necessary from https://cmake.org/install.
</Accordion>
<Accordion title="Runtime mismatches on Windows">
Enable `gtest_force_shared_crt` as shown above to fix linker errors related to runtime libraries.
</Accordion>
<Accordion title="Missing pthread during linking">
Ensure your environment has `pthread` library installed and CMake finds it.
On Linux, install with your package manager (e.g., `sudo apt install libpthread-stubs0-dev`).
</Accordion>
<Accordion title="Tests not discovered by CTest">
Confirm `include(GoogleTest)` is present after your test executable and `gtest_discover_tests()`.
Verify tests are correctly linked against `GTest::gtest_main`.
</Accordion>
</AccordionGroup>

<Note>
For detailed troubleshooting, see the [Troubleshooting Common Setup Issues](getting-started/troubleshooting/common-errors) page.
</Note>

---

## 6. Next Steps

- Explore writing your own tests in [Writing and Running Your First Test](getting-started/initial-configuration/first-test-case).
- Review and tweak advanced configuration options in CMake.
- Integrate GoogleMock if needed for mocking support.
- Consult [System Requirements](getting-started/prerequisites-installation/system-requirements) to verify compatibility.

---

## References and Additional Resources

- Official GoogleTest repository CMake files:
  - [CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt)
  - [googlemock CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- CMake official documentation: <https://cmake.org/documentation/>
- [Quickstart: Building with CMake](docs/quickstart-cmake.md)
- [Primer: Getting Started with Tests](primer.md)

---

Congratulations! You now have GoogleTest installed and configured using CMake and are set to begin writing and running tests in your C++ projects.
