---
title: "Installing with CMake"
description: "Step users through integrating GoogleTest into their projects using the CMake build system, including dependency setup and best practices for linking and configuring their build files."
---

# Installing with CMake

Integrating GoogleTest into your C++ projects using the CMake build system is straightforward and flexible. This guide leads you through fetching, building, linking, and configuring GoogleTest with your project, ensuring you can write and run tests quickly and reliably.

---

## 1. Prerequisites & System Requirements

Before integrating GoogleTest, confirm that your environment meets these requirements:

- **C++ Compiler:** Supports at least **C++17** standard.
- **CMake:** Version **3.14** or later is required to use the recommended modern integration (`FetchContent_MakeAvailable`).
- **Build Tool:** Compatible with generated build scripts (e.g., Make, Ninja, Visual Studio).
- **Network Access:** Required to download GoogleTest sources if you use `FetchContent` or git submodules.

Ensure you have [CMake installed](https://cmake.org/install) and your system can resolve HTTPS URLs to GitHub.

<Check>
Verify your CMake version:

```bash
cmake --version
```

Verify your compiler supports C++17:

```bash
your_compiler --version  # Check docs for specifying -std=c++17 or equivalent.
```
</Check>

---

## 2. Adding GoogleTest to Your Project with CMake

You have two common ways to integrate GoogleTest in your CMake project:

### A. Using `FetchContent` (Recommended)

This approach downloads and builds GoogleTest automatically during your project's build configuration. It guarantees consistent compiler and linker settings across your tests and main project.

### B. Using an Installed GoogleTest Package

If you already have GoogleTest installed system-wide, you can use `find_package()` to locate it.

### Step-by-step: Using `FetchContent`

1. **Create or open your project directory:**

   ```bash
   mkdir my_project && cd my_project
   ```

2. **Create your `CMakeLists.txt` file, or update it as follows:**

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Enforce C++17 for compatibility with GoogleTest
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# On Windows: Ensure consistent runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Define your executable and link GoogleTest
add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)

# Enable CTest for test discovery
enable_testing()
include(GoogleTest)
gtest_discover_tests(hello_test)
```

3. **Create a simple test source file `hello_test.cc`:**

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");  // Strings not equal
  EXPECT_EQ(42, 7 * 6);               // Numeric equality
}
```

### 3. Build and Run Your Tests

In your project directory, run:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

You should see output similar to:

```
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

---

## 3. Using GoogleTest Installed as a Package

If you have GoogleTest installed on your system (for example, installed via `make install` during a previous build), you can link against it by:

1. Adding the following to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(hello_test)
```

2. Building your project normally.

This method assumes your system's package manager or manual installation has placed the necessary files correctly.

---

## 4. Best Practices for Linking and Configuration

- **Match Compiler Options:** Using `FetchContent` ensures GoogleTest is built with the same compiler flags as your project, avoiding mismatch issues.

- **Use `gtest_main` library:** This library provides a main() function for your tests, simplifying test binaries.

- **Enable Testing:** Always call `enable_testing()` in your root `CMakeLists.txt` to enable CTest integration.

- **Discover Tests:** Use `gtest_discover_tests()` to automatically find and register tests built into your binary.

- **Windows Runtime Library:** Set `gtest_force_shared_crt` to `ON` on Windows to match the runtime of your project and avoid linker errors.

---

## 5. Troubleshooting Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="CMake version too old">
Make sure CMake is at least version 3.14 to use `FetchContent_MakeAvailable()`.
Update your CMake if necessary.
</Accordion>
<Accordion title="Missing pthread or threading issues on Linux">
Ensure pthread is installed and accessible. On Linux, use:

```bash
sudo apt-get install build-essential
```

CMake handles pthread linkage automatically if available.
</Accordion>
<Accordion title="Linker errors related to runtime mismatch on Windows">
Set `gtest_force_shared_crt` option to `ON` in your `CMakeLists.txt` before calling `FetchContent_MakeAvailable(googletest)`:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This helps synchronize runtime linkage between GoogleTest and your project.
</Accordion>
<Accordion title="Tests not discovered by CTest">
Ensure you call `include(GoogleTest)` and `gtest_discover_tests(your_test_target)` after defining your test executable.
</Accordion>
</AccordionGroup>

---

## 6. Additional Configuration Options

- To build only GoogleTest and exclude GoogleMock, adjust the build by passing `-DBUILD_GMOCK=OFF` when configuring GoogleTest separately.
- When building manually, use you can customize compiler and linker flags via `CMAKE_CXX_FLAGS` or define GoogleTest control macros.

---

## 7. Summary Diagram

```mermaid
flowchart TD
  A[User Project CMakeLists.txt] --> B[FetchContent_Declare(googletest)]
  B --> C[FetchContent_MakeAvailable(googletest)]
  C --> D[GoogleTest Source Code]
  D --> E[Compile GoogleTest Libraries]
  A --> F[add_executable(Tests)]
  F --> G[target_link_libraries(Tests GTest::gtest_main)]
  A --> H[enable_testing() & include(GoogleTest)]
  H --> I[gtest_discover_tests(Tests)]
  I --> J[CTest Test Runner]
  J --> K[Execute Tests & Report]
```

---

## 8. Next Steps

- Visit [Writing and Running Your First Test](../configuration-validation/first-test) to learn how to author your initial unit tests.
- Review [System Requirements](../prerequisites-installation/system-requirements) to ensure full environment compatibility.
- Explore [Troubleshooting Common Setup Issues](../troubleshooting-help/common-issues) for resolving frequent problems.

---

By following these clear steps, you integrate GoogleTest seamlessly with your CMake-based C++ projects, empowering you to develop robust, tested software with minimal setup overhead.

---

### Helpful links:

- [Quickstart: Building with CMake](../quickstart-cmake.md)
- [GoogleTest Primer and Samples](../primer.md)
- [CMake Official Documentation](https://cmake.org/documentation/)
- [GoogleTest GitHub Repository](https://github.com/google/googletest)
