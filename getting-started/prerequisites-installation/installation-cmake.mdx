---
title: "Installing with CMake"
description: "Clear, step-by-step instructions for adding GoogleTest to a C++ project using CMake. This includes using CMakeLists.txt, managing dependencies, and validating the installation. Ideal for users working with the most common C++ build system."
---

# Installing GoogleTest with CMake

This guide provides clear, step-by-step instructions to add GoogleTest to your C++ project using CMake. It covers downloading the source, configuring your build with `CMakeLists.txt`, managing dependencies, building the library, and validating your installation. These instructions are tailored for C++ developers using the most common and portable build tool — CMake.

---

## 1. Prerequisites & Requirements

Before you start, ensure the following prerequisites are met:

- **C++17 Support:** Your compiler must support C++17 or later. This is a hard requirement.
- **CMake Version:** Minimum CMake version required is 3.16 (3.13 for some internal configurations, but 3.16 recommended).
- **Platform:** Supported on Linux, Windows, and macOS.
- **Build Tools:** Make or an equivalent build system is required (Visual Studio on Windows, Xcode on macOS).
- **Network Access:** Required to clone or download the GoogleTest repository.


<Tip>
Ensure you have C++17 support enabled by adding the line `set(CMAKE_CXX_STANDARD 17)` in your project’s top-level `CMakeLists.txt` if needed.
</Tip>

---

## 2. Downloading GoogleTest Source

You can either clone the GoogleTest repository or download a release archive. For example, to get version 1.17.0:

```bash
# Clone the repository and switch to tag v1.17.0
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
```

---

## 3. Building GoogleTest Standalone

### Step 1: Create a separate build directory

```bash
mkdir build
cd build
```

### Step 2: Configure with CMake

By default, the build includes GoogleMock along with GoogleTest. If you want only GoogleTest without GoogleMock, explicitly disable it.

```bash
# To build both GoogleTest and GoogleMock (default)
cmake ..

# To build only GoogleTest
cmake .. -DBUILD_GMOCK=OFF
```

### Step 3: Build the project

```bash
# On Unix-like systems
make

# On Windows with Visual Studio
cmake --build .
```

### Step 4: (Optional) Install GoogleTest

Installing puts headers and libraries into standard system locations.

```bash
sudo make install
```

By default, this installs into `/usr/local`. Adjust `CMAKE_INSTALL_PREFIX` at configure time to change install location.

---

## 4. Incorporating GoogleTest Into Your Existing CMake Project

You have two main options:

### Option A: Link against installed libraries

1. Ensure GoogleTest is installed on your system (see above).
2. Use `find_package` to locate GoogleTest.

Example snippet in your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_tests test_main.cpp test_suite.cpp)
target_link_libraries(your_tests PRIVATE GTest::gtest_main)
enable_testing()
add_test(NAME your_tests COMMAND your_tests)
```

This approach requires that installed pkg-config or CMake configuration files are discoverable.

### Option B: Include GoogleTest source via `add_subdirectory()`

For tight integration and consistent compiler flags, add GoogleTest as a subdirectory:

1. Place the GoogleTest source code in a known location within your project, for example `external/googletest`.
2. Add the subdirectory in your `CMakeLists.txt`:

```cmake
add_subdirectory(external/googletest)

add_executable(your_tests test_main.cpp test_suite.cpp)
target_link_libraries(your_tests PRIVATE gtest_main)
enable_testing()
add_test(NAME your_tests COMMAND your_tests)
```

<Tip>
Building GoogleTest as part of your project ensures consistent compiler and linker settings, preventing common issues like incompatible runtime libraries.
</Tip>

---

## 5. Using pkg-config with CMake

GoogleTest provides `.pc` pkg-config files that include all necessary compiler and linker flags, including pthread-related flags.

Example CMake snippet using pkg-config:

```cmake
find_package(PkgConfig REQUIRED)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(testapp samples/sample3_unittest.cc)
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})

enable_testing()
add_test(NAME example_test COMMAND testapp)
```

<Tip>
Use `target_compile_options` and `target_link_libraries` with pkg-config variables for accurate inclusion of macro definitions, include paths, and threading flags like `-pthread`.
</Tip>

If you encounter errors during pkg-config discovery (e.g., missing `.pc` files), verify that environment variable `PKG_CONFIG_PATH` includes the directory with GoogleTest’s `.pc` files (usually `/usr/local/lib/pkgconfig` or `/usr/lib/pkgconfig`).

---

## 6. Validating Your Installation

Once built and installed or integrated, verify GoogleTest is working with this sample test program:

Create a file `sample_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
  EXPECT_FALSE(false);
}

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Build and run your test

If using installed GoogleTest:

```bash
clang++ -std=c++17 sample_test.cpp -lgtest_main -pthread -o sample_test
./sample_test
```

If using CMake with subdirectory integration, add this executable target similarly and build.

### Expected Output

```
[==========] Running 1 test from 1 test case.
[----------] Global test environment set-up.
[----------] 1 test from SampleTest
[ RUN      ] SampleTest.BasicAssertions
[       OK ] SampleTest.BasicAssertions (0 ms)
[----------] 1 test from SampleTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test case ran. (0 ms total)
[  PASSED  ] 1 test.
```

<Tip>
If you get undefined reference errors to `gtest_main` or other GoogleTest symbols, ensure your link libraries include `gtest_main` or `gtest` as appropriate.
</Tip>

---

## 7. Troubleshooting Common Issues

### 7.1 C++ Version Errors

If build fails indicating older C++ support, explicitly set your C++ standard:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### 7.2 Runtime Library Mismatch on Windows

When using Visual Studio, if you encounter runtime library conflicts (e.g., linking errors related to `/MD` vs `/MT`), enable dynamic CRT linking for GoogleTest by adding before fetching or subdirectory inclusion:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### 7.3 pthread Linker Errors

On Unix-like systems, missing pthread symbols can occur if `-pthread` is not specified during compile and link. Using CMake’s built-in configurations or pkg-config integration handles this automatically.

If building manually, add `-pthread` flags to both compiler and linker.

### 7.4 pkg-config Cannot Find gtest

Set the environment variable to directory containing GoogleTest’s `.pc` files:

```bash
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig:$PKG_CONFIG_PATH
```

---

## 8. Additional Tips and Best Practices

- **Enable Testing in Your CMake Project:** Always include `enable_testing()` if you want to integrate GoogleTest’s tests with CTest.
- **Consistent Compiler Flags:** Use `add_subdirectory` method to avoid issues stemming from inconsistent compiler flags between your code and GoogleTest.
- **Use gtest_main Target:** Linking against `gtest_main` automatically provides the main() function for your tests.
- **Update Regularly:** Keep your GoogleTest version up to date for bug fixes and improvements.
- **Cross-Compilation:** Configure sysroots and pkg-config variables carefully to match cross-compile environments.

---

## 9. Resources and Further Reading

- [main GoogleTest CMakeLists.txt on GitHub](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [GoogleTest README on GitHub with build instructions](https://github.com/google/googletest/blob/main/googletest/README.md)
- [GoogleMock CMake integration](https://github.com/google/googletest/tree/main/googlemock)
- [Using pkg-config with GoogleTest](https://github.com/google/googletest/blob/main/docs/pkgconfig.md)
- [GoogleTest Primer and First Test Writing Guides](../getting-started/first-test-configuration/writing-first-test.md)

---

This guide sets you on a clear path to efficiently add and validate GoogleTest in your C++ projects leveraging CMake’s power and flexibility.