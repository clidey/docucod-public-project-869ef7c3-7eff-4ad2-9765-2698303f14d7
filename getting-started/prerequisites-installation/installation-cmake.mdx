---
title: "Installing with CMake"
description: "Step-by-step guide to installing and integrating GoogleTest into your project using CMake, covering direct builds, external projects, and best practices for dependency management with CMake."
---

# Installing with CMake

Integrating GoogleTest into your C++ project using CMake is a seamless process that lets you build, install, and manage GoogleTest and GoogleMock libraries effectively. This guide walks you through step-by-step instructions to install GoogleTest with CMake—whether as a standalone project, as part of your existing CMake project, or using best practices for dependency management.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure your environment meets these requirements:

- **C++ Standard:** Your compiler must support C++17 or later.
- **CMake Version:** Minimum CMake 3.14 is recommended for advanced features like `FetchContent`.
- **Compiler Compatibility:** GCC, Clang, MSVC, or compatible compilers supported.
- **Threading Support:** pthreads (or equivalent) for thread safety in tests.
- **Network Access:** For online repository download if using FetchContent.

<Tip>
Verify you have a working C++17 compiler by running:
```bash
$ g++ --version
$ clang++ --version
```
Also verify CMake version:
```bash
$ cmake --version
```
</Tip>

## 2. Building and Installing GoogleTest Using CMake

You can build GoogleTest either as a standalone project or embedded within your project. Both methods yield fully functional test libraries.

### 2.1 Standalone Build and Install

Use this method if you want GoogleTest installed system-wide or to manage it independently.

<Steps>
<Step title="Clone the Repository">
Open a terminal and clone the GoogleTest repository at the version you want:
```bash
git clone https://github.com/google/googletest.git -b main
docfolder=$(pwd)/googletest
```
</Step>
<Step title="Create a Build Directory">
Navigate inside and create a build folder:
```bash
cd $docfolder
mkdir build
cd build
```
</Step>
<Step title="Run CMake Configuration">
Configure the build system:
```bash
cmake ..
```
By default, this builds both GoogleTest and GoogleMock. To build only GoogleTest:
```bash
cmake .. -DBUILD_GMOCK=OFF
```
</Step>
<Step title="Build the Libraries">
Run:
```bash
make
```
On Windows, open the generated solution or project files in Visual Studio and build accordingly.
</Step>
<Step title="Optional: Install GoogleTest">
Installing places libraries and headers in system locations (default `/usr/local/` on Unix systems):
```bash
sudo make install
```
</Step>
</Steps>

### 2.2 Incorporate GoogleTest into Your Existing CMake Project

GoogleTest’s CMake setup is designed to be integrated directly into your project, ensuring compiler and linker consistency.

#### Method A: Using Installed GoogleTest - `find_package`

If GoogleTest is installed, import the package:
```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(mytests test1.cpp test2.cpp)
target_link_libraries(mytests PRIVATE GTest::gtest_main)

enable_testing()
add_test(NAME mytests COMMAND mytests)
```

This method requires the package to be installed or otherwise discoverable.

#### Method B: Build GoogleTest as a Subdirectory

Embed GoogleTest sources or add it as a git submodule and include it in your project build:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
# Use the version that suits your stability needs
FetchContent_MakeAvailable(googletest)

add_executable(mytests test1.cpp test2.cpp)
target_link_libraries(mytests PRIVATE gtest_main)

enable_testing()
add_test(NAME mytests COMMAND mytests)
```

<Tip>
`FetchContent` requires CMake 3.14 or newer and downloads dependencies at configure time, ideal for CI pipelines.
</Tip>

## 3. Best Practices for Dependency Management with CMake

- Prefer **building GoogleTest together with your project** to avoid ABI mismatch and linking errors.
- Use `gtest_main` library to link your tests, which includes a default `main()` for test execution.
- Define `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)` in your root `CMakeLists.txt` to enforce C++17.
- If you require shared or static runtime linkage consistency on Windows, use the CMake option `gtest_force_shared_crt`:
  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "")
  ```

## 4. Using Pkg-Config Files with CMake

GoogleTest installs `.pc` pkg-config files that can simplify your build flags management.

Example using pkg-config in your `CMakeLists.txt`:

```cmake
find_package(PkgConfig REQUIRED)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(testapp samples/sample3_unittest.cc)
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(NAME first_test COMMAND testapp)
```

<Tip>
If pkg-config cannot find GoogleTest, set `PKG_CONFIG_PATH` to the directory where `.pc` files are installed (typically `/usr/local/lib/pkgconfig`).
</Tip>

## 5. Verifying Installation

After building or installing GoogleTest:

1. Compile a simple test executable linking with `gtest_main` (see the above example).
2. Run the executable and verify GoogleTest runs detected tests and shows results.

Example:
```bash
./testapp
```
Expected output shows test cases running with summary results.

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Problems During Installation">
<Accordion title="CMake Can't Find GoogleTest after Installation">
Ensure the install path is within search paths. Set environment variables:
```bash
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig
```
Also verify CMake variables and package paths.
</Accordion>
<Accordion title="Runtime Library Mismatch on Windows">
Enable `gtest_force_shared_crt` option in CMakeLists.txt to align GoogleTest's runtime with your project:
```cmake
set(gtest_force_shared_crt ON CACHE BOOL "")
```
</Accordion>
<Accordion title="Missing pthread Link Errors on Linux or macOS">
Ensure CMake finds pthreads and links properly. The default GoogleTest CMake setup handles this, but custom builds might require:
```cmake
find_package(Threads REQUIRED)
target_link_libraries(your_target PRIVATE Threads::Threads)
```
</Accordion>
</AccordionGroup>

## 7. Next Steps

- Proceed to [Environment Configuration](/getting-started/quickstart-usage/configuration-overview) to learn how to tailor GoogleTest to your environment.
- Explore [Writing and Running Your First Test](/getting-started/quickstart-usage/writing-first-test) to create and execute your first test cases.
- Review [Common Setup Issues](/getting-started/troubleshooting-support/common-setup-issues) for more troubleshooting strategies.

---

## Additional Resources

- GoogleTest GitHub repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- CMake official: [https://cmake.org/](https://cmake.org/)
- Pkg-config tutorial: [https://people.freedesktop.org/~dbn/pkg-config-guide.html](https://people.freedesktop.org/~dbn/pkg-config-guide.html)

---

By following this guide, you'll have a stable, maintainable integration of GoogleTest in your C++ projects powered by CMake, unlocking robust testing capabilities efficiently and with developer-friendly configurations.