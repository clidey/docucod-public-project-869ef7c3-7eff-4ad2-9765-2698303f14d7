---
title: "Install with CMake"
description: "Step-by-step guide for installing GoogleTest and GoogleMock using CMake—the recommended and most widely used approach. Includes download, build, and linking instructions, and highlights common pitfalls."
---

# Install with CMake: Step-by-Step Guide

This guide leads you through the recommended and most widely used approach to install **GoogleTest** and **GoogleMock** using **CMake**. You'll learn how to download, build, install, and link these testing libraries, along with vital tips to avoid common pitfalls. Follow these steps to quickly and reliably integrate GoogleTest/GoogleMock into your C++ projects.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure you meet the following prerequisites:

- **Operating System**: Linux, macOS, Windows.
- **C++ Compiler**: Supports at least **C++17** standard.
- **Build Tools**: 
  - [CMake](https://cmake.org/) version 3.14 or higher.
  - Compatible build tool such as Make, Ninja, Visual Studio, or Xcode.
- **Network access**: To download GoogleTest source code if fetching automatically.

If you do not have CMake installed, refer to [CMake installation guide](https://cmake.org/install).

<Check>
Ensure your compiler is configured to support C++17. For example, with GCC or Clang pass `-std=c++17` or appropriate CMake variables.
</Check>

---

## 2. Downloading and Building GoogleTest and GoogleMock with CMake

GoogleTest includes GoogleMock by default. You can build both together or opt to exclude GoogleMock.

### 2.1 Clone the GoogleTest Repository

Open your terminal and run:

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
```

This fetches the latest source code.

### 2.2 Create a Build Directory

Avoid building inside the source directory:

```bash
mkdir build
cd build
```

### 2.3 Configure the Build with CMake

- To build **both** GoogleTest and GoogleMock (default):

```bash
cmake ..
```

- To build **only GoogleTest** (excluding GoogleMock):

```bash
cmake .. -DBUILD_GMOCK=OFF
```

This step prepares native build files tailored to your platform and compiler.

### 2.4 Build the Libraries

Use your platform’s build command:

- On Unix-like systems:

  ```bash
  make
  ```

- On Windows (Visual Studio):

  Open the generated solution file in Visual Studio and build.

- Using Ninja:

  ```bash
  ninja
  ```

### 2.5 (Optional) Install Libraries to System

If you want to install GoogleTest/GoogleMock for system-wide usage:

```bash
sudo make install
```

By default, this installs into `/usr/local`.

<Warning>
Use `sudo make install` only if you have administrative rights and understand changes to system directories.
</Warning>

---

## 3. Linking GoogleTest into Your CMake Project

Integrate GoogleTest in your project either by linking to installed libraries or by incorporating GoogleTest source directly.

### 3.1 Using Installed GoogleTest Libraries

Add the following to your `CMakeLists.txt`:

```cmake
find_package(GTest REQUIRED)

add_executable(your_test_executable your_test_file.cc)
target_link_libraries(your_test_executable PRIVATE GTest::gtest_main)
enable_testing()
add_test(NAME your_test COMMAND your_test_executable)
```

This approach assumes GoogleTest is installed and pkg-config information is correctly located.

### 3.2 Using GoogleTest as a FetchContent Dependency

For an easy, self-contained setup that downloads GoogleTest at configure time:

```cmake
cmake_minimum_required(VERSION 3.14)
project(your_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
# For Windows: enable dynamic CRT compatibility
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(your_test_example your_test_file.cc)
target_link_libraries(your_test_example PRIVATE gtest_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(your_test_example)
```

This method ensures consistent build settings and easy version upgrades.

---

## 4. Common Pitfalls and Troubleshooting

### 4.1 pkg-config Can't Find GoogleTest

If you get errors like:

```
CMake Error at FindPkgConfig.cmake:XXX (message):
  None of the required 'gtest_main' found
```

It usually means pkg-config cannot locate the `.pc` files. 

To fix this, set the `PKG_CONFIG_PATH` environment variable to point to the directory containing GoogleTest pkg-config files:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Adjust the path to your actual install prefix.

### 4.2 Cross-Compilation Considerations

If cross-compiling, set the following variables so pkg-config uses paths relative to your sysroot:

```bash
export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
export PKG_CONFIG_DIR=
export PKG_CONFIG_SYSROOT_DIR=/path/to/sysroot
export PKG_CONFIG_LIBDIR=${PKG_CONFIG_SYSROOT_DIR}/usr/lib64/pkgconfig
```

Otherwise, `pkg-config` may report incorrect include and library paths.

### 4.3 Visual Studio Runtime Library Mismatch

By default, GoogleTest links the C runtime statically, but Visual Studio projects may link it dynamically, causing linker errors like:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

Fix this by enabling `gtest_force_shared_crt` in your `CMakeLists.txt`:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This forces GoogleTest to use the dynamic runtime and matches your project.

### 4.4 Compiler Support for C++17

GoogleTest requires at least C++17. Ensure you specify this in your CMake file:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

If your compiler does not support C++17, upgrade or switch to a compatible compiler.

---

## 5. Verifying Your GoogleTest Installation

Create a simple test file named `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

Update your `CMakeLists.txt` to build and run this test:

```cmake
enable_testing()

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test PRIVATE GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

Build and run:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

Expected output:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

Congratulations, you have successfully installed and run your first test using GoogleTest with CMake!

---

## 6. Next Steps

- Explore [GoogleTest Primer](primer.md) for writing more advanced tests.
- Examine [Core Workflow Guides](guides/core-workflows/) to master assertions and mocking.
- Visit [Test Discovery & Execution](getting-started/first-test-setup/test-discovery-execution) for automating your test suite.
- Consult [Common Issues Troubleshooting](getting-started/validation-troubleshooting/common-issues) if you encounter build or run errors.

---

## Appendix: Sample Minimal `CMakeLists.txt` to Build and Link GoogleTest

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test hello_test.cc)

target_link_libraries(my_test PRIVATE gtest_main)

enable_testing()
include(GoogleTest)
gtest_discover_tests(my_test)
```

Replace `hello_test.cc` with your own test source file(s).

---

## Tips

- Always build GoogleTest with the same compiler and compiler flags as your project to avoid ABI incompatibilities.
- Prefer `FetchContent` method for simpler dependency management within CMake projects.
- Use `target_compile_options` and `target_link_libraries` to propagate necessary compile and link flags.

## Summary
This page detailed a straightforward, practical approach to installing GoogleTest and GoogleMock with CMake, highlighting key steps from prerequisite checks through to verification and linking in your projects. Careful attention to environment setup, compiler requirements, and troubleshooting tips ensures a smooth experience incorporating GoogleTest into your C++ workflows.


---

<AccordionGroup title="Additional Resources">
<Accordion title="Official GoogleTest Repository">
https://github.com/google/googletest
</Accordion>
<Accordion title="CMake FetchContent Documentation">
https://cmake.org/cmake/help/latest/module/FetchContent.html
</Accordion>
<Accordion title="Common Issues & Troubleshooting">
See the [Troubleshooting Common Issues](getting-started/validation-troubleshooting/common-issues) page.
</Accordion>
</AccordionGroup>
