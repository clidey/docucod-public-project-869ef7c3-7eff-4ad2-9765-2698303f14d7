---
title: "Installation: CMake"
description: "Step-by-step guide for installing GoogleTest and GoogleMock using CMake, including configuration examples and best practices for integrating into your workflow."
---

# Installation: CMake

This guide walks you through installing GoogleTest and GoogleMock using CMake, showing practical steps, configuration examples, and best practices for integrating these testing frameworks into your project workflow.

---

## 1. Prerequisites & System Requirements

Before proceeding, ensure your environment meets the following:

- **CMake Version:** Minimum 3.16 for standalone builds; 3.14 or later is required for advanced features like `FetchContent`
- **Compiler:** A C++17-compliant compiler (e.g., GCC 7+, Clang 3.4.1+, MSVC 2017 Update 3+)
- **Operating System:** Any platform supported by CMake and your compiler
- **Build Tools:** Make or Ninja for Unix-like systems; Visual Studio or Xcode on Windows and macOS respectively
- **Network Access:** Required if fetching sources remotely (via Git or `FetchContent`)

<Tip>
Ensure your project’s C++ standard is set to C++17 or higher, either by specifying in your project `CMakeLists.txt` or passing appropriate compiler flags.
</Tip>

## 2. Installing GoogleTest and GoogleMock Using CMake

### Option A: Standalone Build
This method builds GoogleTest (and GoogleMock by default) independently.

<Steps>
<Step title="Clone the Repository">
Open a terminal and clone the repository for the specific release version you want:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
downloads the GoogleTest v1.17.0 sources.
```

Navigate into the cloned directory:

```bash
cd googletest
```
</Step>
<Step title="Create and Navigate to a Build Directory">
It's best practice to keep build files separate:

```bash
mkdir build
cd build
```
</Step>
<Step title="Generate Build Files with CMake">
Generate native build scripts:

```bash
cmake ..
```
> This will enable GoogleMock by default.

If you want GoogleTest only, disable GoogleMock:

```bash
cmake .. -DBUILD_GMOCK=OFF
```
</Step>
<Step title="Build the Project">
On Unix-like systems (Linux/macOS), use `make`:

```bash
make
```

On Windows, open the generated Visual Studio solution file (e.g., `gtest.sln`) and build from the IDE.
</Step>
<Step title="Install the Libraries (Optional)">
To install GoogleTest/GoogleMock system-wide (e.g., `/usr/local`), you need administrator permissions:

```bash
sudo make install
```

The install location can be changed by passing `-DCMAKE_INSTALL_PREFIX=/your/custom/path` during the CMake configure step.
</Step>
</Steps>

<Warning>
Running `sudo make install` installs the libraries into system directories and may require admin rights. Adjust the install prefix if you want a local installation.
</Warning>

### Option B: Integrate GoogleTest into Your Existing CMake Project

If your project already uses CMake, there are two recommended methods:

#### 1. Using Installed GoogleTest Libraries

After installing GoogleTest and GoogleMock, import them using `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main GTest::gmock)
enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

Ensure `CMAKE_PREFIX_PATH` or `PKG_CONFIG_PATH` includes the installation directory of GoogleTest for `find_package` and pkg-config to locate it.

#### 2. Building GoogleTest as Part of Your Project

Embedding GoogleTest source into your project ensures consistent compile and link settings.

Add the following snippet to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # On Windows to match shared CRT usage
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example PRIVATE gtest_main gmock)
add_test(NAME example_test COMMAND example)
```

Note: This requires CMake 3.14 or newer.

<Tip>
Use the `gtest_force_shared_crt` option on Windows to resolve runtime library conflicts between GoogleTest and your project.
</Tip>

## 3. Configuration & Build Options

GoogleTest’s CMake scripts provide options to customize your build:

| Option                 | Default | Description                                         |
|------------------------|---------|-----------------------------------------------------|
| `BUILD_GMOCK`          | ON      | Build GoogleMock along with GoogleTest              |
| `INSTALL_GTEST`        | ON      | Enable installation targets (use OFF if embedding) |
| `gtest_force_shared_crt`| OFF     | Use shared runtime libraries on Windows             |
| `gtest_build_tests`    | OFF     | Build GoogleTest’s own tests                         |
| `gtest_disable_pthreads`| OFF    | Disable pthread usage (rarely needed)               |

You can toggle these by passing `-D<option>=ON/OFF` to CMake.

### Compiler and Linker Settings

GoogleTest enforces certain compiler flags internally for best compatibility. You generally don’t need to modify these unless fixing specific build issues. It requires C++17 and prefers static CRT on Windows unless overridden.

## 4. Running Your First Operation

Once built and installed, validate your installation by compiling and running a simple test executable.

### Example: Minimal Test
Create `example.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, AssertTrue) {
  ASSERT_TRUE(true);
}

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Build and link this with GoogleTest:

```bash
cmake ..
make example
./example
```

Expected output:

```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from SampleTest
[ RUN      ] SampleTest.AssertTrue
[       OK ] SampleTest.AssertTrue
[----------] 1 test from SampleTest (0 ms total)

[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

This confirms GoogleTest is installed and functioning.

## 5. Best Practices & Tips

- **Use `add_subdirectory` for consistency:** Embedding GoogleTest in your project with `add_subdirectory` ensures consistency in compiler settings and library linkage.
- **Control runtime linkage on Windows:** Use `gtest_force_shared_crt` to avoid runtime mismatches.
- **Enable multi-threaded support explicitly if needed:** Set `-DGTEST_HAS_PTHREAD=1` if your environment does not autodetect pthread support.
- **Use standard C++17 in your `CMakeLists.txt`:**

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- **Disable building GoogleTest’s own tests unless needed:** It saves build time.

## 6. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Common Setup Issues">
<Accordion title="CMake cannot find GoogleTest or GoogleMock">
Verify `CMAKE_PREFIX_PATH` includes the install directory of GoogleTest. If using pkg-config, ensure `PKG_CONFIG_PATH` points to the directory containing the `.pc` files.

Example:

```bash
export PKG_CONFIG_PATH=/usr/local/lib/pkgconfig
```
</Accordion>
<Accordion title="Runtime library mismatch on Windows (LNK2038 error)">
This occurs when GoogleTest and your project use different CRT linkage.

- Enable the option `gtest_force_shared_crt` by adding `-Dgtest_force_shared_crt=ON` when configuring with CMake.
- Ensure your project uses the same runtime linkage.
</Accordion>
<Accordion title="Linker errors related to pthread">
If you see missing pthread symbols:

- Use GoogleTest's CMake support which handles pthread linking automatically.
- If manually linking, add `-pthread` to your compile and link flags.
- To force pthread usage, add `-DGTEST_HAS_PTHREAD=1` to compiler flags.
</Accordion>
<Accordion title="Using GoogleTest as a shared library issues">
If building or linking shared GoogleTest libs:

- Add `-DGTEST_CREATE_SHARED_LIBRARY=1` to compile flags when building GoogleTest.
- Add `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when compiling tests.
- Ensure your system supports shared libraries properly.
</Accordion>
</AccordionGroup>

## 7. Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — Quick start for writing tests
- [GoogleMock README](googlemock/README.md) — Details on integrating GoogleMock
- [Building and Integration](overview/integration-ecosystem/integration-with-build-and-ci) — Covers CMake specifics and CI setup
- [System Requirements](getting-started/prerequisites-installation/system-requirements) — To verify environment compatibility

---

By following these steps and tips, you will have GoogleTest and GoogleMock installed via CMake and ready to seamlessly integrate into your C++ project testing workflow.


---

<Note>
For comprehensive understanding, visit the main [GoogleTest README](googletest/README.md) for detailed explanations of build options and customizations.
</Note>

<Check>
Always verify your build environment meets the C++17 standard and CMake version requirements before starting.
</Check>

---

# End of Installation Guide

