---
title: "Installation with CMake"
description: "Guides users through installing GoogleTest/GoogleMock into their projects using CMake, the recommended and most widely used method. Explains steps for adding as a subproject or via external package, including dependencies, common commands, and verifying successful integration."
---

# Installation with CMake

This guide walks you through installing GoogleTest and GoogleMock into your CMake-based projects. CMake is the recommended, widely used build system for integrating these libraries, offering flexibility to add GoogleTest/GoogleMock as a subproject or as an external package.

---

### 1. Prerequisites & System Requirements

- **Operating System:** Compatible with Linux, macOS, Windows, and other platforms supported by CMake.
- **Compiler:** Must support C++17 standard or newer.
- **CMake:** Version 3.14 or higher is required for the recommended `FetchContent` method.
- **Build Tools:** Compatible native build tool such as Make, Ninja, or Visual Studio.

<Tip>
Ensure your development environment has a C++ compiler and CMake installed. You can verify your CMake version by running `cmake --version` in your terminal or command prompt.
</Tip>

### 2. Installing GoogleTest/GoogleMock into Your Project

GoogleTest supports several integration methods with CMake. This section covers two common approaches:

#### a. Adding GoogleTest as a Subproject

1. **Clone the GoogleTest repository:**

```bash
$ git clone https://github.com/google/googletest.git -b v1.17.0
$ cd googletest
```

2. **Create a build directory and generate build files:**

```bash
$ mkdir build && cd build
$ cmake ..
```

> By default, this builds GoogleTest **and** GoogleMock together.

3. **Build the libraries:**

```bash
$ cmake --build .
```

4. **(Optional) Install the libraries system-wide:**

```bash
$ sudo cmake --install .
```

> Installing places headers and library files in the default system location (usually `/usr/local`). Requires admin privileges.

#### b. Adding GoogleTest as an External Dependency Using `FetchContent`

This method is ideal if you want GoogleTest automatically downloaded and configured during your project's build.

1. **Create or update your project's `CMakeLists.txt` to include the following:**

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Use C++17 standard for compatibility
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Windows: Ensures runtime libraries match your project
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

2. **Configure your build:**

```bash
$ cmake -S . -B build
```

3. **Build:**

```bash
$ cmake --build build
```

<Tip>
Update the ZIP URL with the latest commit hash to keep GoogleTest up to date.
</Tip>

### 3. Configuring Your Build to Use GoogleTest and GoogleMock

After installation or adding GoogleTest as a subproject, configure your test executable as follows:

1. **Enable CTest and testing:**

```cmake
enable_testing()
```

2. **Declare your test executable and link with GoogleTest or GoogleMock:**

Example for GoogleTest:

```cmake
add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)
```

Example for GoogleMock:

```cmake
add_executable(mock_test mock_test.cc)
target_link_libraries(mock_test GMock::gmock_main)
```

3. **Discover tests so CTest can run them automatically:**

```cmake
include(GoogleTest)
gtest_discover_tests(hello_test)
```

### 4. Building and Running Your First Test

1. **Prepare a simple test source file, e.g., `hello_test.cc`:**

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

2. **Build your tests:**

```bash
$ cmake --build build
```

3. **Run tests using CTest:**

```bash
$ cd build
$ ctest
```

You should see output confirming all tests passed:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

### 5. Common Configuration Options and Best Practices

- **Build GoogleMock optionally:**

By default, building GoogleTest includes GoogleMock. To disable GoogleMock:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

- **Shared vs Static Libraries:**

Use `BUILD_SHARED_LIBS` option to control if libraries are built as shared (DLL on Windows) or static.

```bash
cmake .. -DBUILD_SHARED_LIBS=ON
```

- **Windows Runtime Library Compatibility:**

Set `gtest_force_shared_crt` to ON to ensure runtime library compatibility with your project.

- **Avoid version mismatches:**

When linking installed GoogleTest, always use `find_package(GTest CONFIG REQUIRED)` to get the correct CMake targets.

### 6. Troubleshooting Tips

- **Compilation errors related to C++17:** Ensure your compiler supports C++17 and that `CMAKE_CXX_STANDARD` is set correctly.
- **Linker errors (undefined references):** Make sure you link your test executables to `GTest::gtest_main` or `GMock::gmock_main` appropriately.
- **Tests not discovered by CTest:** Confirm that `include(GoogleTest)` and `gtest_discover_tests()` are called in your `CMakeLists.txt`.
- **Conflicts in multi-threading support:** GoogleTest detects pthreads automatically but sometimes requires manual configuration via `-DGTEST_HAS_PTHREAD` macro.

<Warning>
GoogleTest's CMake support is community-maintained. If you encounter issues, check for existing issues on the GitHub repository or seek community support.
</Warning>

---

### Additional Resources

- [GoogleTest Repository on GitHub](https://github.com/google/googletest)
- [Official CMake Documentation](https://cmake.org/documentation/)
- [GoogleTest Primer](primer.md) — Learn to write your first tests
- [Quickstart for Bazel](quickstart-bazel.md) — Alternative build integration
- [System Requirements](system-requirements.mdx) — Verify environment compatibility

---

By following this guide, you add robust, flexible testing with GoogleTest and GoogleMock to your CMake projects efficiently. Whether integrating as a subproject or external package, your setup is ready for modern, scalable C++ testing.
