---
title: "Installation with CMake"
description: "Step-by-step instructions for integrating GoogleTest into your C++ project using CMake, the recommended build system. Covers fetching, configuring, and linking GoogleTest, setting the user up for rapid development."
---

# Installation with CMake

Integrate GoogleTest into your C++ project seamlessly using CMake, the recommended build system. This guide walks you through fetching GoogleTest, configuring it with your project, and linking your tests for rapid development and execution.

---

## 1. Prerequisites & System Requirements

Before starting with the installation, ensure your environment meets these requirements:

- **CMake version 3.14 or higher**: Required for `FetchContent_MakeAvailable()`.
- **C++17 compatible compiler**: GoogleTest requires C++17 support.
- **Internet access** (optional): For FetchContent-based downloads.
- **Git** (optional): If cloning the repository manually.

Ensure your project is set up to use CMake as a build system and that you have access to modify your `CMakeLists.txt`.

---

## 2. Installation Methods

GoogleTest can be integrated with CMake in two primary ways:

- Build GoogleTest as a standalone external project.
- Embed GoogleTest into your project using CMake’s FetchContent.

### 2.1 Standalone Build and Installation

If you prefer building GoogleTest separately:

```bash
# Clone the GoogleTest repository (specify version tag as needed)
git clone https://github.com/google/googletest.git -b v1.17.0
downloaded_dir=googletest

# Enter the directory and create a build folder
cd $downloaded_dir
mkdir build && cd build

# Generate build files (build GoogleTest only, excluding GoogleMock if desired)
cmake ..                 # Includes GoogleMock by default
# or
cmake .. -DBUILD_GMOCK=OFF # Build only GoogleTest

# Build the libraries
make

# (Optional) Install system-wide (requires admin privileges)
sudo make install
```

> This approach installs GoogleTest on your system under `/usr/local` by default, making it accessible for multiple projects.

### 2.2 Embedding GoogleTest Directly Using FetchContent

For tighter integration and consistent build settings, use CMake’s FetchContent to download and build GoogleTest as part of your project.

Add the following to your project’s `CMakeLists.txt`:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# Use this option especially for Windows to ensure consistent runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Now create your test executable and link against gtest_main
add_executable(your_test_executable your_test_source.cc)
target_link_libraries(your_test_executable gtest_main)

# Enable CTest support
enable_testing()
add_test(NAME your_test COMMAND your_test_executable)
```

This ensures GoogleTest is downloaded once during the configure step and built with your project, keeping compiler flags consistent.

---

## 3. Configuring Your Project to Use GoogleTest

Once GoogleTest is either installed or embedded, link it into your test targets.

### 3.1 Using Installed GoogleTest

If GoogleTest is already installed system-wide or via package manager, add this to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED) # Use CONFIG mode when gtest is installed with package config files

add_executable(your_test_executable your_test_source.cc)
target_link_libraries(your_test_executable PRIVATE GTest::gtest_main)

enable_testing()
add_test(NAME your_test COMMAND your_test_executable)
```

> Note: On some systems you might have to set `PKG_CONFIG_PATH` if pkg-config cannot find GoogleTest installed `.pc` files.

### 3.2 Manual Include Directories and Link Libraries

Alternatively, you can manually specify include paths and libraries if needed:

```cmake
target_include_directories(your_test_executable PRIVATE /path/to/googletest/include)

target_link_libraries(your_test_executable PRIVATE /path/to/libgtest.a pthread)
```

But this method is harder to maintain and error-prone compared to package-aware approaches.

---

## 4. Example: Minimal `CMakeLists.txt` Including GoogleTest via FetchContent

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gtest_main)

enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

Replace `test_main.cpp` with your actual test source file(s).

---

## 5. Verifying Your Setup

To confirm that GoogleTest is properly integrated:

- Run `cmake` to configure your project.
- Build your tests using `make` or your IDE's build command.
- Execute tests via `ctest` or by running the test executable directly.

Successful test runs printing output like:

```
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test case.
[----------] Global test environment set-up.
[----------] 1 test from SampleTest
[ RUN      ] SampleTest.DoesSomething
[       OK ] SampleTest.DoesSomething (0 ms)
[----------] 1 test from SampleTest (0 ms total)

[==========] 1 test from 1 test case ran. (0 ms total)
[  PASSED  ] 1 test.
```

---

## 6. Troubleshooting

### 6.1 pkg-config Cannot Find GoogleTest

If you encounter errors like:

```
CMake Error at FindPkgConfig.cmake:...:
  None of the required 'gtest_main' found
```

Check your `PKG_CONFIG_PATH` environment variable and set it properly:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Adjust the path according to your installation prefix.

### 6.2 Linker Errors Related to pthread

GoogleTest requires linking with pthread on most Unix-like platforms.

- Use CMake threading support by including `find_package(Threads REQUIRED)` and linking with `${CMAKE_THREAD_LIBS_INIT}`.
- When using GoogleTest’s CMake scripts, this is normally handled automatically.

### 6.3 Runtime Library Mismatches on Windows with Visual Studio

If you see errors about runtime library mismatches (e.g., MTd_StaticDebug vs MDd_DynamicDebug), enable:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This forces dynamic runtime linkage to match typical Visual Studio project settings.

---

## 7. Best Practices

- Prefer FetchContent or system packages to embed GoogleTest instead of manually copying source.
- Always specify C++17 or higher to ensure compatibility.
- Enable testing in `CMakeLists.txt` with `enable_testing()` and register tests with `add_test()`.
- Keep GoogleTest version updated regularly for bug fixes and features.

---

## 8. Next Steps

- Explore [Writing and Running Your First Test](https://example.com/getting-started/configuration-first-test/writing-first-test) to write actual test cases.
- Review [System Requirements & Supported Platforms](https://example.com/getting-started/prerequisites-installation/requirements-platforms) to confirm compile and runtime environment.
- Check [Solving Common Setup Problems](https://example.com/getting-started/troubleshooting/common-errors) if you face installation issues.

---

For full details on advanced configuration, test fixtures, and using GoogleMock, visit the related guides linked in the documentation navigation.

---

## References

- [GoogleTest GitHub repository](https://github.com/google/googletest)
- [GoogleTest CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [GoogleMock CMake build](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [Pkg-config integration notes](https://github.com/google/googletest/blob/main/docs/pkgconfig.md)

---

<Tip>
For CI/CD workflows, embedding GoogleTest via FetchContent simplifies dependency management and ensures consistent builds across systems.
</Tip>

<Note>
Always remember to run `enable_testing()` before adding tests to ensure `ctest` discovers them.
</Note>

<Warning>
Avoid mixing debug and release runtimes especially on Windows; mismatches often cause obscure linker errors.
</Warning>

---