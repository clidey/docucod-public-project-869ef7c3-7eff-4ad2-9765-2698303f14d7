---
title: "Installing with CMake"
description: "Step-by-step instructions for fetching, building, and integrating GoogleTest and GoogleMock using CMake. Guides users through common workflows for adding the framework to new or existing CMake-based projects."
---

# Installing with CMake

This guide walks you through fetching, building, and integrating GoogleTest and GoogleMock using CMake. Whether you want to build GoogleTest standalone or incorporate it into an existing CMake project, this document provides clear, actionable steps to get started quickly and correctly.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure your environment meets the following:

- **Operating System**: Linux, macOS, Windows, or other supported platforms.
- **C++ Compiler**: Must support C++17 standard or later.
- **CMake**: Version 3.14 or higher.
- **Build Tools**: Compatible tools such as Make, Ninja, or Visual Studio.

<Check>
Make sure CMake is installed by running:

```bash
cmake --version
```
The version output should be 3.14 or later.
</Check>

For more details on prerequisites, see the [System Requirements & Prerequisites](https://github.com/google/googletest/blob/main/getting-started/prerequisites-installation/system-requirements.md) page.

---

## 2. Standalone Build with CMake

This approach builds GoogleTest (and GoogleMock by default) as an independent project.

### Step 1: Clone the Repository

Run the following commands to clone the official GoogleTest repository and check out a stable release tag:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
```

### Step 2: Create a Build Directory

Create a dedicated directory to isolate build files:

```bash
mkdir build
cd build
```

### Step 3: Generate Build Files with CMake

By default, this generates build scripts for both GoogleTest and GoogleMock:

```bash
cmake ..
```

If you prefer to build **only GoogleTest** (without GoogleMock), run:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Build the Libraries

On Linux or macOS, build using Make:

```bash
make
```

On Windows, open the generated `gtest.sln` solution file with Visual Studio and build the project.

### Step 5: Install the Libraries

If you have administrator privileges, you can install GoogleTest to your system's default path (`/usr/local` on Unix-like systems):

```bash
sudo make install
```

### Verification

Confirm the installation by checking header files and libraries at their installed locations:

- Headers: `/usr/local/include/gtest`
- Libraries: `/usr/local/lib/libgtest.a` or similar

<Note>
You may need to adjust your compiler and linker flags to find these locations if they are not standard.
</Note>

---

## 3. Incorporating GoogleTest Into an Existing CMake Project

To seamlessly integrate GoogleTest with your existing CMake project, follow one of these proven patterns.

### Option 1: Use Installed Libraries

If GoogleTest is already installed system-wide, import it using `find_package()`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test/my_test.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main)
```

This lets you link against prebuilt GoogleTest libraries.

### Option 2: Build GoogleTest as a Subdirectory

For tighter integration and consistent compiler/linker settings, add GoogleTest as a subdirectory within your project.

Steps:

1. Download or clone the GoogleTest source code inside your project tree, e.g. `third_party/googletest`.
2. Add the following to your `CMakeLists.txt`:

```cmake
add_subdirectory(third_party/googletest)

add_executable(my_tests test/my_test.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)
```

This approach builds GoogleTest together with your project using the same toolchain.

### Option 3: Fetch GoogleTest Automatically During Configure

Use CMake's `FetchContent` module to download and add GoogleTest at configure time. This is the most flexible and recommended method for continuous integration and frequent updates.

In your top-level `CMakeLists.txt`, add:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Windows users: match runtime library linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test/my_test.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)
```

<Info>
This requires CMake 3.14 or later due to `FetchContent_MakeAvailable()` usage.
</Info>

---

## 4. Visual Studio and Runtime Library Considerations

When using Visual Studio, GoogleTest links against static C runtimes by default. This might cause linker errors if your project uses dynamic runtimes.

To fix mismatched runtime linkage errors like:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

Enable the following CMake option:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This makes GoogleTest link dynamically to the CRT and match your main project settings.

---

## 5. C++ Standard

GoogleTest requires a build environment supporting C++17 or newer.

You can ensure this by specifying in your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Alternatively, pass the appropriate flags to CMake during configuration via:

```bash
cmake -DCMAKE_CXX_FLAGS="-std=c++17" ..
```

---

## 6. Building and Running Your First Test

Once your project is configured to link against GoogleTest, write a simple test.

Create a source file `hello_test.cc` with:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

Add the following to your `CMakeLists.txt`:

```cmake
enable_testing()

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test PRIVATE gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

Build your project:

```bash
cmake -S . -B build
cmake --build build
```

Run the tests:

```bash
cd build
ctest
```

You should see output like:

```
Test project /path/to/build
Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ...   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

Congratulations! Your first GoogleTest test built and ran successfully.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Setup Issues">
<Accordion title="CMake version too low">
Ensure your CMake version is 3.14 or later, especially when using automatic FetchContent. Older versions will cause errors.

```bash
cmake --version
```

Upgrade if necessary from https://cmake.org/install.
</Accordion>
<Accordion title="Missing Build Tools">
Make sure your system has the required build tools:
- On Linux, install `build-essential` or equivalent.
- On Windows, have Visual Studio with C++ workload.
- On macOS, install Xcode Command Line Tools (`xcode-select --install`).
</Accordion>
<Accordion title="Runtime mismatches on Visual Studio">
Enable dynamic CRT linkage to avoid linker errors using:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
</Accordion>
<Accordion title="Tests not running with ctest">
Verify that `enable_testing()` and `gtest_discover_tests()` are correctly included in your `CMakeLists.txt`. Without these, tests won't be discovered.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps & Further Reading

- Explore writing detailed test cases in the [Writing Your First Test](https://github.com/google/googletest/blob/main/guides/getting-started/writing-your-first-test.md) guide.
- Learn advanced mocking techniques using GoogleMock in [Writing Your First Mock](https://github.com/google/googletest/blob/main/guides/getting-started/writing-your-first-mock.md).
- Dive into integrating GoogleTest into complex CI pipelines in the [Continuous Integration & Test Automation](https://github.com/google/googletest/blob/main/guides/integration-and-best-practices/continuous-integration-automation.md) page.
- Consult the official [CMake Documentation](https://cmake.org/cmake/help/latest/) to master build configuration.

---

## 9. References

- GitHub repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- Official CMake website: [https://cmake.org/](https://cmake.org/)
- Quickstart tutorial with practical examples: [Quickstart: Building with CMake](https://github.com/google/googletest/blob/main/docs/quickstart-cmake.md)

---

This completes the step-by-step process to install, build, and run your first test using GoogleTest and CMake.

<Tip>
Regularly update your GoogleTest version to benefit from bug fixes and new features by updating the Git tag or commit in your CMake configuration.
</Tip>

<Note>
Make sure your compiler flags and project settings (like runtime linkage and C++ standard) are consistent across your project and GoogleTest to avoid build or runtime issues.
</Note>

<Warning>
Avoid mixing debug and release builds between your project and GoogleTest to prevent linking errors or runtime crashes.
</Warning>
