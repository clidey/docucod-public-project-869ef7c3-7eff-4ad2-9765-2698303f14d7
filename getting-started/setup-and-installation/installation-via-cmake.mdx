---
title: "Installation via CMake"
description: "Step-by-step guide to installing GoogleTest with CMake, the recommended and most portable method. Covers fetching the dependency, integrating with your CMakeLists.txt, and verifying the build for multiple platforms."
---

# Installation via CMake

This guide walks you through installing GoogleTest using CMake — the recommended and most portable method. You will learn how to fetch GoogleTest as a dependency, integrate it into your `CMakeLists.txt`, and verify the build across platforms including Linux, Windows, and macOS.

---

## 1. Prerequisites

Before starting the installation, ensure your environment meets these requirements:

- **C++ Compiler** that supports C++17 or later (e.g., GCC 7+, Clang 5+, MSVC 2017+).
- **CMake version 3.14 or higher** (required for `FetchContent_MakeAvailable()`).
- **Basic familiarity** with CMake commands and building C++ projects.

<Tip>
Confirm your CMake version by running:

```bash
cmake --version
```

Upgrade if the version is below 3.14.
</Tip>

## 2. Fetching GoogleTest Using CMake

The most flexible way to use GoogleTest in your project with CMake is to fetch it during the configure step via CMake’s built-in `FetchContent` module. This avoids manual cloning or installation and keeps GoogleTest updated.

### Steps:

<Steps>
<Step title="Modify Your CMakeLists.txt">
Open your top-level `CMakeLists.txt` file and add the following snippet near the top (after `project(...)`):

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows: Use shared runtime to avoid compiler mismatches
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

This declaration downloads the specified GoogleTest commit and makes it available to your project.
</Step>
<Step title="Link GoogleTest in Your Target">
To use GoogleTest, link your test executable with `gtest_main` (which includes the main function):

```cmake
add_executable(MyTests test/my_tests.cpp)
target_link_libraries(MyTests gtest_main)
add_test(NAME MyTests COMMAND MyTests)
```

Replace `test/my_tests.cpp` with the path to your test source files.
</Step>
</Steps>

<Tip>
Using `gtest_main` automatically provides a `main()` function to run your tests. If you want to provide your own main, link with `gtest` instead.
</Tip>

## 3. Building and Installing GoogleTest Standalone (Alternative)

If you prefer to build GoogleTest separately and install it system-wide, follow these steps:

1. **Clone the repository:**
   ```bash
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
```

2. **Create and enter the build directory:**
   ```bash
mkdir build && cd build
```

3. **Configure the build:**

   - To build **only GoogleTest** (without GoogleMock):
     ```bash
cmake .. -DBUILD_GMOCK=OFF
```

   - To build **GoogleTest with GoogleMock** (default):
     ```bash
cmake ..
```

4. **Build the libraries:**
   ```bash
make
```

5. **(Optional) Install to system:**
   ```bash
sudo make install
```
   This installs headers and libraries to `/usr/local` by default.

<Tip>
On Windows with Visual Studio, open the generated `.sln` file and build using Visual Studio. On macOS, an Xcode project is generated for use.
</Tip>

## 4. Integrating GoogleTest in Your Existing CMake Project

There are two common methods:

### Method A: Find Installed GoogleTest Package

After system-wide installation, use `find_package` to locate GoogleTest:

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(MyTests test/my_tests.cpp)
target_link_libraries(MyTests GTest::gtest_main)
add_test(NAME MyTests COMMAND MyTests)
```

### Method B: Add GoogleTest as a Subdirectory

Include GoogleTest sources directly in your build for tighter integration across build settings:

```cmake
add_subdirectory(path/to/googletest)
add_executable(MyTests test/my_tests.cpp)
target_link_libraries(MyTests gtest_main)
add_test(NAME MyTests COMMAND MyTests)
```

<Tip>
This method avoids runtime and configuration mismatches by compiling GoogleTest with the same compiler flags as your tests.
</Tip>

## 5. Verifying Your Build

After building your tests, run them with:

```bash
ctest
# or directly
./MyTests
```

You should see output indicating tests ran successfully, e.g.: 

```
Running main() from gmock_main.cc
[==========] Running 3 tests from 1 test suite.
[----------] Global test environment set-up.
[ RUN      ] MyTest.Foo
[       OK ] MyTest.Foo (0 ms)
[----------] 3 tests from MyTest
[==========] 3 tests from 1 test suite ran. (3 ms total)
[  PASSED  ] 3 tests.
```

<Tip>
If no tests run, verify that your test source files contain valid GoogleTest test cases and that they are compiled and linked correctly.
</Tip>

## 6. Using pkg-config with CMake (Optional Advanced)

GoogleTest installs `pkg-config` files (`.pc`) that describe compiler and linker flags. You can integrate them via CMake:

```cmake
find_package(PkgConfig)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(testapp samples/sample3_unittest.cc)
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(NAME first_and_only_test COMMAND testapp)
```

This method automatically handles threading macros, include paths, and linker flags such as `-pthread`.

<Note>
If `pkg-config` cannot find GoogleTest, ensure your `PKG_CONFIG_PATH` includes the directory where GoogleTest’s `.pc` files reside, for example:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```
</Note>

## 7. Platform-Specific Notes

- **Windows:** When fetching GoogleTest, set `gtest_force_shared_crt` to ON to avoid linker runtime conflicts.
- **macOS:** Building with Xcode is fully supported through generated projects.
- **Cross-Compiling:** Set environment variables such as `PKG_CONFIG_SYSROOT_DIR` for correct pkg-config behavior (refer to the pkg-config section above).

## 8. Common Pitfalls and Troubleshooting

<AccordionGroup title="Troubleshooting Installation via CMake">
<Accordion title="CMake Error: Could not find gtest_main">
Ensure you have installed GoogleTest or fetch it correctly with `FetchContent`.
Verify `PKG_CONFIG_PATH` if using pkg-config.
</Accordion>
<Accordion title="Linker errors related to pthread">
GoogleTest requires threading support. If you get undefined references to pthread functions:

- Using CMake, these are handled automatically.
- If using manual build systems, add `-pthread` to both compile and link flags.
</Accordion>
<Accordion title="Runtime mismatch errors on Windows">
Enable `gtest_force_shared_crt` option in your CMakeLists.txt to unify runtime linkage.
</Accordion>
</AccordionGroup>

---

## Additional Resources

- [GoogleTest Official GitHub Repository](https://github.com/google/googletest)
- [CMake Documentation](https://cmake.org/cmake/help/latest/)
- [Using pkg-config with CMake](https://autotools.io/pkgconfig/cross-compiling.html)

---

By following this guide, you will have GoogleTest installed and integrated via CMake, empowering you to start writing and running reliable unit tests across platforms.

---