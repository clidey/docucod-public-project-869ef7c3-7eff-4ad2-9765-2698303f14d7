---
title: "Installing with CMake"
description: "Step-by-step instructions for downloading, building, and integrating GoogleTest and GoogleMock with CMake-based C++ projects—covering both internal and external builds."
---

# Installing with CMake

Step-by-step instructions for downloading, building, and integrating GoogleTest and GoogleMock with CMake-based C++ projects—covering both internal and external builds.

---

## 1. Prerequisites & System Requirements

Before installing GoogleTest and GoogleMock with CMake, ensure your environment meets the following requirements:

- **Operating System:** Linux, macOS, Windows, or any platform supported by CMake and your compiler.
- **C++ Compiler:** Supports at least the C++17 standard.
- **CMake Version:** Minimum 3.16 for GoogleTest distribution builds; 3.13 is the minimum for internal googletest and googlemock CMake scripts.
- **Build Tools:** Compatible with GNU Make, Ninja, Visual Studio, or other supported build tools by CMake.
- **Threading Support:** Optional pthreads support for multithreaded tests. CMake scripts handle linking when pthreads are detected.

<Tip>
If you don’t have CMake installed, visit the [CMake installation guide](https://cmake.org/install) and install the appropriate version for your platform.
</Tip>

---

## 2. Downloading GoogleTest and GoogleMock

You can obtain GoogleTest with integrated GoogleMock in multiple ways depending on your workflow.

### Option A: Cloning the Repository for Standalone Build

```bash
$ git clone https://github.com/google/googletest.git -b main
$ cd googletest
```

This gives you both GoogleTest and GoogleMock sources ready for building.

### Option B: Embed Using CMake FetchContent (Recommended for Projects)

Include the following in your project's `CMakeLists.txt` to download and make GoogleTest available:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
# On Windows, prevent overriding compiler/linker settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

This approach keeps GoogleTest up-to-date and integrates seamlessly with your builds.

---

## 3. Building GoogleTest and GoogleMock with CMake

### Standalone Build

If building GoogleTest (and GoogleMock) as a standalone project:

1. Create a build directory:

   ```bash
   $ mkdir build && cd build
   ```

2. Generate build files with CMake:

   ```bash
   $ cmake ..
   ```

   By default, GoogleMock is included. To build only GoogleTest, run:

   ```bash
   $ cmake .. -DBUILD_GMOCK=OFF
   ```

3. Build the libraries:

   ```bash
   $ make
   ```

   or on Windows/Mac, use your IDE to build.

4. (Optional) Install the libraries in the system:

   ```bash
   $ sudo make install
   ```

### Integration into Existing Projects

To incorporate GoogleTest into your own CMake project directly:

- Use `add_subdirectory` to add GoogleTest sources within your build tree.

- Or better, use `FetchContent` as shown above.

---

## 4. Configuring Your Project's CMakeLists.txt

Below is a practical example to set up a simple test project that uses GoogleTest and GoogleMock.

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Use FetchContent to get GoogleTest and GoogleMock
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

# Enable testing
enable_testing()

# Add your test executable
add_executable(
  my_test
  test/my_test.cc
)

# Link with GoogleTest and GoogleMock libraries
# gmock_main includes gtest, so linking with gmock_main is enough
target_link_libraries(
  my_test
  GTest::gmock_main
)

# Discover tests automatically with CTest
include(GoogleTest)
gtest_discover_tests(my_test)
```

---

## 5. Sample Test File

Create a simple test source file to verify your setup. Save as `test/my_test.cc`:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Eq;

// Example test
TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
}

// Example mock class
class MockInterface {
 public:
  MOCK_METHOD(int, Foo, (int), ());
};

TEST(MockTest, SimpleMock) {
  MockInterface mock;
  EXPECT_CALL(mock, Foo(Eq(5))).WillOnce(::testing::Return(10));
  EXPECT_EQ(mock.Foo(5), 10);
}
```

---

## 6. Building and Running Tests

From your project root directory:

1. Create and go to a build directory:

   ```bash
   $ mkdir build && cd build
   ```

2. Generate build files:

   ```bash
   $ cmake ..
   ```

3. Build the test executable:

   ```bash
   $ cmake --build .
   ```

4. Run tests with CTest:

   ```bash
   $ ctest
   ```

You should see output indicating your tests ran and passed.

<pre>
Test project /path/to/build
    Start 1: SampleTest.BasicAssertions
1/1 Test #1: SampleTest.BasicAssertions ...........   Passed    0.01 sec

100% tests passed, 0 tests failed out of 1
</pre>

<Tip>
Use `ctest -V` to get verbose output showing detailed test run logs.
</Tip>

---

## 7. Common Build Options and Tweaks

GoogleTest CMake scripts provide several useful options:

- `BUILD_GMOCK` (default ON): Build GoogleMock along with GoogleTest.
- `INSTALL_GTEST` (default ON): Enable installing GoogleTest libraries.
- `gtest_build_tests` (default OFF): Build GoogleTest's own tests.
- `gtest_build_samples` (default OFF): Build GoogleTest sample programs.
- `gtest_disable_pthreads` (default OFF): Disable pthreads support.
- `gtest_force_shared_crt` (default OFF): On Windows, build with dynamic CRT linkage.

You can override these options when running CMake:

```bash
cmake .. -Dgtest_build_tests=ON -DBUILD_GMOCK=OFF
```

<Tip>
On Windows, enabling `gtest_force_shared_crt` avoids runtime library conflicts when linking dynamically.
</Tip>

---

## 8. Troubleshooting

<AccordionGroup title="Common Installation and Build Issues">
<Accordion title="CMake Version Too Low">
Ensure your CMake version meets the minimum required (3.16 for distribution builds). Run `cmake --version`.

Upgrade CMake if necessary from https://cmake.org/install.
</Accordion>

<Accordion title="Linker Errors Related to pthread">
If using pthread-based threading, CMake normally handles linking.

- On MinGW or some Windows environments, pthreads might not be available or supported.
- Use `-Dgtest_disable_pthreads=ON` to disable pthreads if necessary.
</Accordion>

<Accordion title="Runtime Library Mismatches on Windows">
Enable the `gtest_force_shared_crt` option when configuring CMake to match runtime linkage.

Example:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```
</Accordion>

<Accordion title="Tests Not Discovered by CTest">
Verify you included `include(GoogleTest)` and called `gtest_discover_tests(your_test_target)` in your CMakeLists.txt.

Make sure `enable_testing()` is called.
</Accordion>

</AccordionGroup>

---

## 9. Additional Tips & Best Practices

- Always specify at least C++17 in your projects to match GoogleTest requirements.
- Prefer `FetchContent` integration for streamlined dependency management.
- Keep GoogleTest updated to benefit from improvements and fixes.
- Link against `GTest::gtest_main` or `GTest::gmock_main` targets to avoid writing your own main() function.
- Use CTest to run and integrate your unit tests with CI pipelines.

---

## 10. Resources & Next Steps

- [Quickstart: Building with CMake](https://github.com/google/googletest/blob/main/docs/quickstart-cmake.md) - Starter tutorial with practical examples.
- [GoogleTest Primer](primer.md) - Learn to write basic tests.
- [Using Matchers and Mocking Basics](using-googlemock-basics.md) - For introducing GoogleMock in your tests.
- [Integration and CI Workflows](integration-other-systems.md) - Best practices for build and test automation.

Explore these to advance your testing setup and harness the full power of GoogleTest and GoogleMock.

---

_End of Installing with CMake Guide._

<Source url="https://github.com/google/googletest" paths={[{"path": "CMakeLists.txt", "range": "1-57"},{"path": "googletest/CMakeLists.txt", "range": "1-159"},{"path": "googlemock/CMakeLists.txt", "range": "1-141"},{"path": "docs/quickstart-cmake.md", "range": "1-95"}]} branch="main" />