---
title: "Configuration and Initial Setup"
description: "Learn how to configure and integrate GoogleTest into your project's workflow. This includes linking, initial CMake or Bazel setup, and organizing source files for test discovery and execution."
---

# Configuration and Initial Setup

Welcome to the guide on configuring and integrating GoogleTest into your project's workflow. This section will walk you through the essential steps to link GoogleTest, perform your initial CMake or Bazel setup, and organize your source files to enable smooth test discovery and execution.

---

## 1. Preparing Your Project for GoogleTest Integration

Before integrating GoogleTest, ensure your project has a clear structure for tests and a build system compatible with GoogleTest's requirements. GoogleTest works seamlessly with CMake and Bazel, supporting modern C++ standards (C++17 and later).

### Key Goals for This Setup
- Link GoogleTest libraries properly to your tests.
- Set up your build (CMake or Bazel) to compile and run tests.
- Organize test files following conventions to allow automatic test discovery.

---

## 2. Configuring GoogleTest with CMake

### Step 1: Add GoogleTest as a Subdirectory or Find Package

You have two common options:

#### Option A: Use Installed GoogleTest via `find_package`
If you have installed GoogleTest on your system (e.g., via package manager or manual installs), use:

```cmake
find_package(GTest CONFIG REQUIRED)
```

This imports `GTest::gtest`, `GTest::gmock`, and their variants as targets you can link against.

#### Option B: Include GoogleTest Sources Directly
For tighter integration and consistent compiler flags, include GoogleTest source as part of your project:

```cmake
add_subdirectory(path/to/googletest)
```

This builds GoogleTest within your build, ensuring compatibility.


### Step 2: Link your Test Executable

Create a test executable, for example:

```cmake
add_executable(my_tests tests/test_main.cpp tests/my_test.cpp)
```

Link against GoogleTestâ€™s libraries (replace sources and names accordingly):

```cmake
target_link_libraries(my_tests PRIVATE GTest::gtest_main)
```

*`gtest_main`* provides a default main function. If you want to define your own, link with *GTest::gtest* instead.

### Step 3: Enable Testing and Register Tests

Add:

```cmake
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

This allows you to run tests via `ctest` or supported IDEs.

### Step 4: Organize Source Files

Place your test files in a dedicated directory (e.g., `tests/`). Following conventions helps IDEs and build systems discover and build tests easily.

---

## 3. Configuring GoogleTest with Bazel

### Step 1: Add GoogleTest Dependency

Use the `gtest` and `gtest_main` targets defined in the GoogleTest workspace. Example in your Bazel BUILD file:

```python
cc_test(
    name = "my_tests",
    srcs = ["test_main.cc", "my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

- `gtest_main` supplies a main() function that runs all tests.

- Add your test source files as `srcs`.

### Step 2: Running Tests

Run from the command line:

```bash
bazel test //path/to:my_tests
```

Bazel will build and execute tests, reporting results.

### Step 3: Organizing Tests

Place tests in source directories aligned with Bazel packages to maintain clarity and scalability.

---

## 4. Linking GoogleTest and GoogleMock Libraries

GoogleTest and GoogleMock provide two main libraries relevant here:

| Library          | Description                                  | When to Use                    |
|------------------|----------------------------------------------|-------------------------------|
| `gtest`          | Core GoogleTest library                       | If you provide your own main() |
| `gtest_main`     | GoogleTest plus main() function               | When you want default main()   |
| `gmock`          | GoogleMock (without main)                      | For mocking without main()     |
| `gmock_main`     | GoogleMock plus main() function                | For mocking with main()        |

Link to whichever suits your project. Most often, `gtest_main` or `gmock_main` simplifies setup by handling the `main()` function.

---

## 5. Initializing GoogleTest in Your Code

You do **not** need to write your own `main()` function if you link against the provided `gtest_main` or `gmock_main`.

If you provide your own `main()`, initialize GoogleTest as follows:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For GoogleMock integration, use:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 6. Organizing Source Files for Test Discovery

GoogleTest discovers tests automatically by running all `TEST()` and `TEST_F()` declarations compiled into the test executable.

### Recommended Structure

```
/project-root
  /src
    ...regular source files
  /tests
    test_main.cpp   # Optional if using gtest_main
    my_test.cpp     # Contains TEST(...) or TEST_F(...) macros
```

- Each source file can contain multiple tests.

- Naming tests clearly helps visibility.

- Use fixtures (`TEST_F`) for shared setup/teardown.

---

## 7. Troubleshooting Common Configurations

<AccordionGroup title="Troubleshooting Common Setup Issues">
<Accordion title="Failure to Link gtest_main or gmock_main">
Make sure your executable links to the `gtest_main` or `gmock_main` target, or else provide your own main function.

Check your linker inputs if you encounter unresolved symbol errors.
</Accordion>
<Accordion title="Compiler Flags Mismatch in CMake">
GoogleTest requires C++17 standard. Ensure your project sets the flag:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Visual Studio users may need to set `gtest_force_shared_crt` option:

```cmake
-Dgtest_force_shared_crt=ON
```

This aligns the runtime libraries for GoogleTest and your project.
</Accordion>
<Accordion title="Test Executable Runs No Tests">
Verify that your test source files include GoogleTest headers and contain valid `TEST()` or `TEST_F()` macros.

Ensure those files are included in your test executable target.
</Accordion>
</AccordionGroup>

---

## 8. Best Practices and Tips

- **Leverage `gtest_main` or `gmock_main`**: Use these to skip writing boilerplate `main()`.
- **Keep tests modular**: Organize tests per feature or class for maintainability.
- **Consistent C++ standards**: Ensure your project and GoogleTest use the same C++ standard.
- **Use CMake `FetchContent` to integrate GoogleTest**: This automates downloading and building within your project.
- **Run tests via CMake's `ctest` or Bazel commands**: Enables integration with CI systems.

---

## 9. Next Steps

Once your project is configured and GoogleTest integrated:
- Visit **Writing Your First Test** to learn how to create your initial test cases.
- Explore **Running Tests** to understand executing tests in various environments.
- Check **Quick Validation and Troubleshooting** for tips on resolving issues.

---

For more detailed build system examples and troubleshooting, see:
- [Installation Guide](/getting-started/setup-and-installation/installation-guide)
- [Integrating with Your Build & CI](/overview/architecture-features-integration/integration-scenarios)
- The official [GoogleTest CMakeLists.txt](https://github.com/google/googletest/blob/main/googletest/CMakeLists.txt) and Bazel build files in the repository

---

## References
- [GoogleTest README](https://github.com/google/googletest/blob/main/googletest/README.md)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [CMake FetchContent Documentation](https://cmake.org/cmake/help/latest/module/FetchContent.html)

---

With this setup, you're ready to incorporate powerful and flexible testing in your C++ projects using GoogleTest and GoogleMock.