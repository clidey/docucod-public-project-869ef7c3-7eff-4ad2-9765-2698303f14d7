---
title: "Configuring Your Project"
description: "Learn how to integrate GoogleTest and GoogleMock into your project's build system. Covers typical configuration patterns for CMake projects and package configuration for rapid adoption."
---

# Configuring Your Project

Learn how to integrate GoogleTest and GoogleMock into your project's build system. This guide focuses on common patterns for configuring CMake projects and package-based setups to enable rapid adoption of these testing frameworks.

---

## 1. Prerequisites & System Requirements

Before configuring your project, ensure you have the following prerequisites satisfied:

- **C++17 Support**: GoogleTest and GoogleMock require a compiler with C++17 support.
- **CMake 3.13 or Later**: Minimum version to handle GoogleMock's build scripts.
- **Threads Support**: For multi-threaded tests, pthreads or equivalent must be available.


<Check>
Verify C++17 support and CMake version:
```bash
c++ --version
cmake --version
```

If your compiler or CMake is outdated, upgrade to meet these requirements.
</Check>

---

## 2. Configuring GoogleTest and GoogleMock with CMake

### 2.1. Option 1: Standalone Build of GoogleTest and GoogleMock

This approach builds the libraries separately and installs them system-wide or locally.

#### Step 1: Clone the repository

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
git clone https://github.com/google/googletest.git  # For latest main branch
cd googletest
```

#### Step 2: Create a build directory and configure with CMake

```bash
mkdir build
cd build
cmake ..
```

- By default, `gmock` is built along with GoogleTest. To disable GoogleMock, use:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

#### Step 3: Build and optionally install

```bash
make
sudo make install
```

- Installation places headers and libraries in system paths (usually `/usr/local/`).

<Tip>
On Windows or Mac, CMake generates Visual Studio or Xcode projects respectively.
Open those in the IDE to build and install.
</Tip>

---

### 2.2. Option 2: Integrate into Existing CMake Project

This method incorporates GoogleTest and GoogleMock directly into your project's build.

#### Step 1: Use CMake's `FetchContent` to automatically download GoogleTest & Mock

Add the following snippet at the top-level `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
# For Windows: ensure consistent runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```


#### Step 2: Link your tests or targets with GoogleTest and GoogleMock

```cmake
add_executable(my_test test.cpp)
target_link_libraries(my_test PRIVATE gtest_main gmock)
add_test(NAME my_test COMMAND my_test)
```

- `gtest_main` library provides a main() function that runs all tests.
- `gmock` provides mocking support.

---

### 2.3. Build Options and Important Flags

- `BUILD_SHARED_LIBS`: If ON, builds shared libraries (DLLs). Default OFF.
- `gmock_build_tests`: Build GoogleMock's own tests. Default OFF.
- `gtest_force_shared_crt`: Helps resolve runtime library conflicts on Windows.


---

## 3. Using GoogleTest and GoogleMock in Your Project

### 3.1. Include Paths

Include directories are automatically set for targets linking `gtest` or `gmock`. If manually specifying:

```cmake
include_directories(${gmock_SOURCE_DIR}/include ${gtest_SOURCE_DIR}/include)
```

### 3.2. Linking

- Link your test executable against `gtest_main` (if you want automatic test runner) or `gtest` with your own main.
- For mocking functionality, also link `gmock` or `gmock_main` (which includes main).

Example:

```cmake
target_link_libraries(my_test PRIVATE gmock_main)
```

### 3.3. Compiler Settings

GoogleTest's CMake scripts automatically apply strict warning flags and standard C++17.

If your project overrides these settings, ensure compatibility by explicitly requesting C++17:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

---

## 4. Typical CMakeLists.txt Configuration for Using GoogleMock

Integrate GoogleMock alongside your code with this minimal example:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test_my_code.cpp
  # other source files
)

target_link_libraries(my_test PRIVATE gmock_main)

enable_testing()
add_test(NAME my_test COMMAND my_test)
```

---

## 5. Using pkg-config Files

If you installed GoogleMock with CMake, `gmock.pc` and `gmock_main.pc` files are generated.
Use `pkg-config` to set compiler and linker flags in your project.

Example compile and link with pkg-config:

```bash
pkg-config --cflags gmock
pkg-config --libs gmock_main
```

You can incorporate these into your build toolchain to simplify dependency management.

---

## 6. Verification and Testing

- **Build Verification:** Ensure your project compiles and links without errors with `gtest` and `gmock`.
- **Test Execution:** Run `ctest` or your build's test command to execute tests.
- **Troubleshooting:** Common issues include C++ standard mismatch, missing thread libraries, or runtime library conflicts on Windows. Adjust compiler flags as needed using the documented options.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Problems and Solutions">
<Accordion title="Symbol Not Found for gmock_main">
This usually indicates missing linkage to `gmock_main`.

**Solution:** Link your test executable with `gmock_main` instead of `gmock` if you want automatic main():

```cmake
target_link_libraries(my_test PRIVATE gmock_main)
```
</Accordion>

<Accordion title="Mismatch of Runtime Libraries on Windows">
Linker errors such as mismatched runtime libraries (e.g. MT vs MD) arise from conflicting project and GoogleMock runtime settings.

**Solution:** Enable `gtest_force_shared_crt` in CMake as shown:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
</Accordion>

<Accordion title="C++ Standard Version Incompatibility">
Errors related to language features usually indicate an older compiler or default language level.

**Solution:** Enforce C++17 in your project and ensure the compiler supports it:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```
</Accordion>
</AccordionGroup>

---

## Summary

This page covered how to properly configure your project to include GoogleTest and GoogleMock.

You learned how to:

- Build GoogleTest and GoogleMock standalone with CMake
- Integrate them directly into an existing CMake project via FetchContent
- Manage dependencies and linking for test builds
- Handle typical build and runtime problems

For further help, consult the [Using Mocks in Unit Tests](../guides/mocking-and-advanced-testing/using-mocks-in-unit-tests.md) guide and the [Installation and Setup FAQ](../../faq/common-usage-questions/installation-and-setup.md).

---

## Additional Resources

- [GoogleMock CMakeLists.txt source](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [GoogleTest Generic Build Instructions](https://github.com/google/googletest/blob/main/googletest/README.md)
- [GoogleMock Mocking Reference](../docs/reference/mocking.md)
- [GoogleMock Cookbook](../docs/gmock_cook_book.md)

---

## Next Steps

- After configuring your project, proceed to [Writing Your First Test](../first-test-and-validation/writing-your-first-test.md) to start validating your setup by writing and running actual tests.
- For understanding how to use mocks in tests, review the guide on [Using GoogleMock: Basics](../first-test-and-validation/using-googlemock-basics.md).
- Troubleshooting scenarios related to build and runtime are covered in [Troubleshooting Common Setup Issues](../first-test-and-validation/troubleshooting-common-setup-issues.md).

---

