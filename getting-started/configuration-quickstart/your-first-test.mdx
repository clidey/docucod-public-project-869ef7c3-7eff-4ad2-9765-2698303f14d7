---
title: "Your First Test and Mock"
description: "A guided example that takes you from writing basic test cases with GoogleTest to creating and using a mock class with GoogleMock. Includes sample code, explanation of macros, and essential assertions to validate a working setup."
---

# Your First Test and Mock

## Overview
This guide walks you through writing your first test case using GoogleTest and creating a simple mock class with GoogleMock. You will learn how to use the essential testing macros, organize tests, and include assertions to verify your code behavior. By the end, you will have a working test and mock example to validate your setup.

---

## 1. Prerequisites

Before you start, ensure you have the following in place:

- **GoogleTest and GoogleMock installed and integrated** in your project. See the [Installation and Integration Options](../getting-started/prerequisites-installation/install-integration-options.md) for guidance.
- A compatible C++17 compiler.
- Basic familiarity with C++ syntax.

<Tip>
Make sure your build system links against `gtest_main` or you provide your own `main()` that calls `RUN_ALL_TESTS()`. This ensures tests are discovered and executed.
</Tip>

---

## 2. Writing Your First Basic Test

GoogleTestâ€™s `TEST` macro is the simplest way to write a test function. It requires a test suite name and a test name. Follow these steps to create a basic test:

<Steps>
<Step title="Define a test with `TEST()`">
Create a new C++ source file, e.g. `hello_test.cc`.

```cpp
#include <gtest/gtest.h>

// Define a simple test suite FooTest with two test cases.
TEST(FooTest, DoesBar) {
  EXPECT_EQ(7 * 6, 42);
}

TEST(FooTest, DoesBaz) {
  EXPECT_STRNE("hello", "world");
}
```

This defines two tests within the same suite `FooTest`.
</Step>

<Step title="Build and Run Your Test">
Make sure your build links against GoogleTest libraries, then build your test executable.

Run the test binary. You should see output indicating tests ran and passed.
</Step>

<Step title="Interpreting Results">
If all assertions hold, the test passes silently, else failures are reported with file and line details.
</Step>
</Steps>

---

## 3. Creating a Mock Class Using GoogleMock

GoogleMock allows you to create mock classes that simulate dependencies. Here's how to create a simple mock:

<Steps>
<Step title="Define an Interface">
Start with a pure virtual interface your code depends on, for example:

```cpp
class FooInterface {
 public:
  virtual ~FooInterface() = default;
  virtual int GetValue() = 0;
  virtual void SetValue(int val) = 0;
};
```
</Step>

<Step title="Create a Mock Class">
Derive a mock from the interface using the `MOCK_METHOD` macros from GoogleMock.

```cpp
#include <gmock/gmock.h>

class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(int, GetValue, (), (override));
  MOCK_METHOD(void, SetValue, (int val), (override));
};
```

- `MOCK_METHOD(return_type, MethodName, (argument_types), (modifiers))`

This macro generates mocked method definitions and expectations.
</Step>

<Step title="Write a Test Using the Mock">
Use your mock in a test to set expectations and control behavior:

```cpp
TEST(FooTest, MockExample) {
  MockFoo foo;
  EXPECT_CALL(foo, GetValue())
      .Times(1)
      .WillOnce(testing::Return(100));

  int val = foo.GetValue();
  EXPECT_EQ(val, 100);
}
```

This test sets the mock to expect exactly one call to `GetValue()` and returns 100.
</Step>

<Step title="Run and Verify">
Build and run your test. If the mock is called as expected, the test passes. If not, GoogleMock reports the mismatch.
</Step>
</Steps>

---

## 4. Understanding the Macros and Assertions

- **`TEST(test_suite_name, test_name)`** defines a test function.
- **`EXPECT_*` macros** generate non-fatal failures allowing tests to continue.
- **`ASSERT_*` macros** generate fatal failures that abort the current test function.
- **`EXPECT_CALL(mock, method())`** sets expectations on mock methods.

Use `EXPECT_*` when you want the test to check multiple assertions even after failure. Use `ASSERT_*` when continuing makes no sense after failure.

<Tip>
Prefer using `EXPECT_*` assertions within tests for richer diagnostics unless the next steps critically depend on the assertion.
</Tip>

---

## 5. Putting It All Together: Complete Example

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

// Interface
class FooInterface {
 public:
  virtual ~FooInterface() = default;
  virtual int GetValue() = 0;
  virtual void SetValue(int val) = 0;
};

// Mock class
class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(int, GetValue, (), (override));
  MOCK_METHOD(void, SetValue, (int val), (override));
};

// A basic functional test
TEST(FooTest, BasicAssertions) {
  EXPECT_EQ(2 + 2, 4);
  EXPECT_NE(10, 0);
}

// Test using mock
TEST(FooTest, MockUsage) {
  MockFoo foo;

  // Expect GetValue to be called once and return 123
  EXPECT_CALL(foo, GetValue())
      .Times(1)
      .WillOnce(testing::Return(123));

  int val = foo.GetValue();
  EXPECT_EQ(val, 123);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Build and run this code to verify your setup is correct.

---

## 6. Best Practices & Tips

- Tests in the same suite should be logically related.
- Avoid underscores in test suite and test names; use CamelCase instead.
- Use test fixtures (`TEST_F`) when you need shared setup or data.
- Use GoogleMock's rich `EXPECT_CALL` with cardinalities for precise mock verification.
- Always return the result of `RUN_ALL_TESTS()` from your `main()` to ensure proper exit codes.

<Warning>
Never ignore `RUN_ALL_TESTS()`'s return value. Doing so can cause false positives in CI environments.
</Warning>

---

## 7. Troubleshooting

<AccordionGroup title="Common Issues Running Tests">
<Accordion title="Linker errors when building tests">
Check that you link against `gtest_main` or provide a `main()` that calls `RUN_ALL_TESTS()`. Also, ensure your build includes GoogleMock libraries if you use mocks.
</Accordion>
<Accordion title="Tests not discovered or run">
Verify `InitGoogleTest()` is called before `RUN_ALL_TESTS()`. Avoid calling `RUN_ALL_TESTS()` multiple times.
</Accordion>
<Accordion title="Mock expectations not met">
Check that your `EXPECT_CALL`s match the actual calls in number and order.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps

- Explore [GoogleTest Primer](primer.md) to deepen your understanding of writing simple and fixture-based tests.
- Learn more about [Mocking Techniques](../guides/core-testing-workflows/mocking-techniques.md) to fully leverage GoogleMock features.
- Visit [Writing Assertions](../guides/core-testing-workflows/writing-assertions.md) to master validation in tests.
- Use the [GoogleTest Samples](samples.md) repository for concrete, example-rich insights.

<Tip>
Continuously running and extending tests while you develop ensures higher code quality and faster debugging cycles.
</Tip>
