---
title: "Installing with CMake"
description: "Detailed, step-by-step instructions for downloading, building, and linking GoogleTest/GoogleMock in C++ projects using CMake—the recommended and most common installation route."
---

# Installing with CMake

This guide provides detailed, step-by-step instructions for downloading, building, and integrating **GoogleTest** and **GoogleMock** into your C++ projects using CMake — the recommended and most common installation method.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure the following prerequisites are met:

- **Operating System:** Linux, macOS, Windows (officially supported platforms).
- **C++ Compiler:** Must support at least C++17 standard.
- **CMake Version:** Minimum required is 3.14 (recommended 3.16+ for best compatibility).
- **Build Tool:** Compatible with your platform — Make, Ninja, or Visual Studio.
- **Internet Access:** Needed to clone the GoogleTest repository or download releases.

<Tip>
If you do not have CMake installed, visit the [CMake installation guide](https://cmake.org/install) to set it up before continuing.
</Tip>

---

## 2. Clone the GoogleTest Repository

Start by cloning the official GoogleTest repository from GitHub. This repository includes both GoogleTest and GoogleMock.

```bash
$ git clone https://github.com/google/googletest.git -b main
$ cd googletest
```

This ensures you have the latest source code. You may also checkout a specific tagged release version if preferred for stability.

---

## 3. Configure the Build with CMake

Create a dedicated build directory to keep build files separate from source code:

```bash
$ mkdir build && cd build
```

Run CMake to configure the build system:

- To build both **GoogleTest** and **GoogleMock** (default):

```bash
$ cmake ..
```

- To build only **GoogleTest** (without GoogleMock), add the option:

```bash
$ cmake .. -DBUILD_GMOCK=OFF
```

This generates native buildfiles tailored to your system environment.

<Tip>
Use `-DCMAKE_INSTALL_PREFIX=/your/path` if you want to customize the installation directory.
</Tip>

---

## 4. Build the Libraries

After configuration, build the libraries using your platform-appropriate build tool.

- On Linux/macOS with Make:

```bash
$ make
```

- With Ninja:

```bash
$ ninja
```

- On Windows with Visual Studio:

Open the generated solution file (`googletest.sln`) and build from the IDE.

By default, this will build **gtest**, **gtest_main**, **gmock**, and **gmock_main** libraries.

<Check>
If you want to build GoogleMock's own tests as well, enable the option:

```bash
cmake .. -Dgmock_build_tests=ON
```

Then run the build again.

Note: Building GoogleMock tests is optional and mostly for library developers.
</Check>

---

## 5. Install Libraries and Headers

To make GoogleTest and GoogleMock available system-wide or in a custom location, run:

```bash
$ sudo make install
```

By default, this installs to `/usr/local/`.

Verify the install path or change it using `CMAKE_INSTALL_PREFIX` during the CMake configure step.

---

## 6. Integrate GoogleTest into Your CMake Project

GoogleTest provides CMake targets you can link against easily. Here’s a minimal example demonstrating how to add GoogleTest as a dependency with FetchContent and link your test executable to it.

### Project Setup Example:

Create a `CMakeLists.txt` in your project directory with:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

# Download GoogleTest during configuration
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/0323ad1ea311f4d9a8fb7a65f7b9e5f0f5f60231.zip
)

# For Windows: Use dynamic runtime to avoid conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Enable testing for CTest
enable_testing()

# Define your test executable
add_executable(hello_test hello_test.cc)

# Link against gtest_main for main() and GoogleTest libs
target_link_libraries(hello_test PRIVATE GTest::gtest_main)

# Register tests with CTest for discovery
include(GoogleTest)
gtest_discover_tests(hello_test)
```

### Sample Test Code (`hello_test.cc`):

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

---

## 7. Build and Run Your Tests

Use the following commands from your project root:

```bash
$ cmake -S . -B build
$ cmake --build build
$ cd build && ctest
```

Expected output:

```
Test project /path/to/my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) = 0.01 sec
```

Congratulations! Your first test built and ran successfully using GoogleTest.

---

## 8. Practical Tips and Best Practices

- **Linking Choices:**
  - Use `GTest::gtest_main` if you want GoogleTest to supply `main()`.
  - Use `GTest::gtest` if you provide your own `main()`.

- **Thread Safety:**
  GoogleTest automatically handles pthreads where supported.

- **Version Pinning:**
  Keep your GoogleTest dependency commit or release version up to date to benefit from fixes and features.

- **Custom Install Locations:**
  Use `-DCMAKE_INSTALL_PREFIX` to install in non-default directories.

- **Static vs Shared Libraries:**
  By default, GoogleTest builds static libraries. Set `-DBUILD_SHARED_LIBS=ON` if you prefer shared libraries.

---

## 9. Troubleshooting Common Issues

<AccordionGroup title="Common Problems While Installing with CMake">
<Accordion title="CMake Cannot Find a Compatible Compiler">
Ensure your compiler supports C++17. Update your compiler or specify it explicitly in CMake.
</Accordion>
<Accordion title="Linker Errors Related to pthread">
Make sure the pthread library is linked properly. Using the provided CMake scripts handles this automatically.
If you are building manually, add `-pthread` flag.
</Accordion>
<Accordion title="Version Mismatch or Missing Headers">
Confirm you cloned the full Googletest repository and did not partially download GoogleMock or GoogleTest sources. 
Clean your build directory and rerun CMake after any changes.
</Accordion>
<Accordion title="Visual Studio Runtime Library Conflicts">
Set `gtest_force_shared_crt` to `ON` in CMake to align runtime libraries on Windows and avoid linker mismatch errors.
</Accordion>
</AccordionGroup>

---

## 10. Next Steps

- Explore the [Writing and Running Your First Test](../first-steps-validation/creating-your-first-test) guide to learn test creation.
- Understand GoogleMock integration via [Getting Started with GoogleMock](../first-steps-validation/mocking-basics).
- Refer to [Supported Platforms](../environment-setup/supported-platforms) for environment compatibility.
- Check [Troubleshooting Common Setup Issues](../troubleshooting-resources/troubleshooting-common-issues) if you encounter problems.


---

## Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleTest Primer](primer.md) for learning assertions and basics
- [CMake Documentation](https://cmake.org/documentation/)


---

With these instructions, you now have a robust and repeatable workflow for integrating GoogleTest and GoogleMock into your C++ projects using CMake.

Enjoy writing reliable and testable code!
