---
title: "Using Bazel for Build & Test"
description: "Shows how to add GoogleTest and GoogleMock to your Bazel workspace, answering common integration questions and demonstrating a minimal WORKSPACE/BUILD setup for running your first tests."
---

# Using Bazel for Build & Test

This guide shows you how to add **GoogleTest** and **GoogleMock** to your Bazel workspace. It answers common integration questions and demonstrates a minimal `WORKSPACE` and `BUILD` setup to start running your first C++ tests immediately.

---

## 1. Prerequisites & Environment Setup

Before integrating GoogleTest and GoogleMock with Bazel, ensure your environment meets the following:

- **Bazel Installed:** Bazel must be installed and reachable in your system path.
- **C++ Compiler:** A working C++ compiler supported by your platform and Bazel.
- **Workspace Structure:** Your Bazel workspace should be initialized with a `WORKSPACE` file.

No additional manual installation of GoogleTest or GoogleMock is required since Bazel will fetch and build them as remote dependencies.

<Check>
Verify Bazel installation by running:

```sh
bazel --version
```

It should output the Bazel version without errors.

Verify your workspace has a `WORKSPACE` file in its root directory.
</Check>

## 2. Adding GoogleTest and GoogleMock to Your Bazel Workspace

GoogleTest and GoogleMock are distributed together and can be fetched via Bazel's `http_archive` rule.

### Step 1: Declare External Dependencies in `WORKSPACE`

Add the following snippet to your `WORKSPACE` file to download the latest stable release (adjust version/tag as needed):

```starlark
load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

http_archive(
    name = "com_google_googletest",
    url = "https://github.com/google/googletest/archive/release-1.17.0.tar.gz",
    strip_prefix = "googletest-release-1.17.0",
    sha256 = "94c634d499558a96d99a2402e65cefa2d3d99cf54ec814d8844600608e03a4f0",  # Update if version changes
)
```

This declares an external Bazel repository called `com_google_googletest` that Bazel will fetch automatically.


<Warning>
Ensure you update `url` and `sha256` to the desired GoogleTest release version. Using an outdated or incorrect SHA256 will lead to fetch failures.
</Warning>

### Step 2: Load Bazel Build Rules for GoogleTest

Add to your `WORKSPACE` a load directive so you can use GoogleTest's build rules:

```starlark
load("@com_google_googletest//:bazel/repositories.bzl", "gtest_repositories")
gtest_repositories()
```

*Note:* The above is the standard approach for more integrated usage if the repository supports it.

## 3. Minimal `BUILD` File Setup to Run Your First Test

Create a `BUILD` file in your test source directory (for example, `//my_project/tests`) with minimal test targets.

```starlark
cc_test(
    name = "my_first_test",
    srcs = ["my_first_test.cc"],  # Your test source file
    deps = ["@com_google_googletest//:gtest_main"],
)
```

- The `deps` attribute includes `gtest_main`, which provides a default `main()` to run tests.
- Your source test file should include the proper headers and use GoogleTest macros.

<Note>
If you want to use GoogleMock features, add the dependency on `@com_google_googletest//:gmock_main` instead:

```starlark
cc_test(
    name = "my_mock_test",
    srcs = ["my_mock_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

This provides GoogleMock initialization plus GoogleTest.
</Note>

## 4. Writing Your First Test

Use GoogleTest macros to write tests inside your `.cc` test source. For example:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, SimplePass) {
  EXPECT_EQ(1 + 1, 2);
}
```

When using mocks (`gmock_main`), include GoogleMock headers:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;

// Define mocks, set expectations, etc.

TEST(MockTest, SampleMock) {
  // ...
}
```

## 5. Building and Running Your Tests

Build and run tests with Bazel:

```sh
bazel test //my_project/tests:my_first_test
```

You should see output indicating test execution and results.

If the test passes, you are set up correctly.

## 6. Common Questions & Troubleshooting

<AccordionGroup title="Common Bazel Integration Questions">
<Accordion title="Why do I get unresolved symbol errors when linking?">
Verify that you depend on `:gtest_main` or `:gmock_main` in your `cc_test`. These targets provide the necessary `main()` function and link dependencies.
</Accordion>
<Accordion title="Can I use only GoogleTest and not GoogleMock?">
Yes. Depend only on `@com_google_googletest//:gtest_main` and include `<gtest/gtest.h>`. GoogleMock is optional.
</Accordion>
<Accordion title="How do I update GoogleTest version in Bazel?">
Update the `url` and `sha256` hashes in your `WORKSPACE` `http_archive` rule. Then run `bazel clean --expunge` before rebuilding.
</Accordion>
<Accordion title="My tests fail with runtime library mismatches on Windows Visual Studio builds. What should I do?">
C++ runtime mismatches often occur with different static/dynamic runtime linking. When using Bazel on Windows, ensure consistent runtime flags and consider passing appropriate `copts` to your Bazel targets. See the issue discussed in the official GoogleTest docs regarding `gtest_force_shared_crt` CMake option as a reference.
</Accordion>
</AccordionGroup>

---

## Summary

Adding GoogleTest and GoogleMock to your Bazel workspace involves declaring the external dependency via `http_archive` in your `WORKSPACE`, then defining Bazel `cc_test` targets that depend on `gtest_main` or `gmock_main` libraries. You then write tests using standard GoogleTest macros and run them through Bazel.

## References & Links

- [GoogleTest GitHub Repository](https://github.com/google/googletest) - Official repository for latest source
- [Bazel Documentation](https://docs.bazel.build/) - Bazel build system documentation
- [GoogleTest Primer](primer.md) - Guide on writing simple GoogleTest tests
- [GoogleMock Reference](docs/reference/mocking.md) - Details on mocking APIs
- [gMock Cookbook](docs/gmock_cook_book.md) - Advanced mocking usage
- [Using Bazel for Build & Test](https://github.com/google/googletest/tree/main/googletest#using-it-with-bazel) (from repo)

---

## Next Steps

After setting up your Bazel workspace as outlined, consider:

- Writing your first unit and mock-based tests
- Exploring mocking techniques with GoogleMock
- Learning best practices for test organization and expectation specification
- Consulting the [GoogleTest Installation Overview](getting-started/setup-requirements/installation-overview) for alternative build options

<Tip>
Start by adding the `http_archive` rule to your `WORKSPACE`, then add a simple `cc_test` in your source tree and run it with Bazel to confirm your setup.
</Tip>
