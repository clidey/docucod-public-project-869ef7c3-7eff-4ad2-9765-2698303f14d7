---
title: "Project Setup & Integration"
description: "Instructions for adding GoogleTest to existing or new C++ projects, with details on linking, directory structure, and required include paths. Clarifies how to structure your project to smoothly use GoogleTest as part of your workflow."
---

# Project Setup & Integration

This page provides practical guidance on integrating the GoogleTest and GoogleMock frameworks into your existing or new C++ project. It covers important setup aspects like linking libraries, directory structure, and required include paths, helping you smoothly incorporate these tools as part of your testing workflow.

---

## 1. Overview of Project Setup

GoogleTest and GoogleMock are distributed as source libraries that require integration with your build system and project layout. Proper project setup ensures reliable builds, correct linkage of test binaries, and easy maintenance of your test code.

This guide covers:

- Recommended directory structure for source and test code
- How to link GoogleTest and GoogleMock
- Essential include paths
- Usage of provided CMake package configuration files

---

## 2. Directory and Build Structure

### 2.1 Project Directory Layout

To integrate GoogleTest smoothly, organize your project with a clear separation of production code and test code. A common structure looks like:

```
project_root/
  src/               # Your production source files
  include/           # Your production headers
  tests/             # Your test source files
  third_party/       # External dependencies such as GoogleTest
    googletest/      # GoogleTest and GoogleMock source and binaries
  CMakeLists.txt     # Your main CMake build script
```

This separation helps isolate test dependencies and makes building tests maintainable.

### 2.2 Including GoogleTest

You can include GoogleTest either as a submodule in your `third_party/` directory or install it system-wide or via package managers if available.

- **Submodule or source inclusion**: Add `googletest` as a subproject and link your tests to it.
- **Installed packages**: Leverage `find_package(GTest)` to locate GoogleTest on your system.

### 2.3 Linking and Compilation

Make sure your test executables link against the GoogleTest and GoogleMock libraries.

If using CMake, this typically involves:

```cmake
find_package(GTest REQUIRED)

add_executable(my_tests tests/my_test.cc)
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock GTest::gmock_main pthread)
```

Note that connecting to `gmock_main` gives you an entry point (`main()`) for GoogleTest.

---

## 3. Include Paths and Compiler Configuration

Your test source files must include GoogleTest and GoogleMock headers. This requires configuring your project's include paths to point to GoogleTest's `include` directory.

Example include directive:

```cpp
#include <gmock/gmock.h>
```

In CMake, GoogleTest provides imported targets that carry include directories and compile options, so linking against these targets automatically configures the include paths.

If you manually add include directories, make sure the GoogleTest include path is set correctly, e.g.,

```cmake
target_include_directories(my_tests PRIVATE ${googletest_SOURCE_DIR}/include)
```

---

## 4. Using the gmock_main Package Configuration

GoogleMock provides a CMake package configuration file `gmock_main.pc.in` to assist linking and includes. The file provides variables for installed library and include directories, and can be used via pkg-config or CMake to obtain accurate build paths.

Typical usage in manual build scripts or CMake:

- Use pkg-config to query `gmock_main` package configuration.
- Link with `-lgmock_main` and its dependencies.
- Include the `includedir` from the package config to resolve headers.

This approach simplifies correct linkage especially when GoogleMock is installed system-wide.

---

## 5. Integrating GoogleMock with Your Tests

Once set up, you will:

1. Create mock classes using the `MOCK_METHOD` macros in your test code.
2. Include `<gmock/gmock.h>`.
3. Use `EXPECT_CALL` and `ON_CALL` macros to specify behavior and expectations on mocks.
4. Link test executables with `gmock_main` or provide your own `main()` that calls `testing::InitGoogleMock()`.

Example minimal main in your test executable when not using `gmock_main`:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 6. Tips and Best Practices

- **Link properly**: Always link with `gmock`, `gtest`, `gmock_main`, and `pthread` for POSIX systems.
- **Match versions**: Ensure that `gmock_main` and `gmock` are the same version to avoid runtime issues.
- **Virtual destructors**: Mock classes should have virtual destructors for safe polymorphic deletion.
- **Use provided targets**: When using CMake, prefer `GTest::gmock`, `GTest::gmock_main`, and `GTest::gtest` imported targets.
- **Avoid manual linking errors**: Use `pkg-config` or CMake package finding instead of hard-coding paths.

---

## 7. Troubleshooting

- **Linker errors**: Check that you link against all required libraries, including `pthread` on Linux.
- **Missing headers**: Verify that include paths are correctly set to GoogleTest's `include/` directory.
- **Multiple main() defined**: Use either `gmock_main` library or your own `main()` but not both.
- **Version mismatch**: Confirm that all googletest components are from the same version/release.

---

## 8. Next Steps

- Move on to [Writing Your First Test Case](/getting-started/configuring-using-tests/write-first-test-case) to learn how to write and organize simple tests using GoogleTest and GoogleMock.
- Review [Running Tests & Interpreting Output](/getting-started/configuring-using-tests/running-tests-validate-output) to understand test execution and results analysis.
- Consult [Installing GoogleTest (CMake & Bazel)](/getting-started/prep-requirements-installation/install-cmake-bazel) to master installation procedures.

---

## References

- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [gmock_main.pc.in](https://github.com/google/googletest/blob/main/googlemock/cmake/gmock_main.pc.in)
- [GoogleTest Primer](../overview/product-intro-core-concepts/what-is-googletest.md)

---

## Example CMake Snippet to Link GoogleTest and GoogleMock

```cmake
# Assuming googletest is added as a subdirectory or installed
find_package(GTest REQUIRED)

add_executable(my_test test/example_test.cc)
target_link_libraries(my_test PRIVATE
  GTest::gtest
  GTest::gmock
  GTest::gmock_main
  pthread  # POSIX systems
)
```

This minimal configuration sets up your test target with proper GoogleTest and GoogleMock linkage and includes the `main()` function via `gmock_main`.

---

## Minimal Example of Usage

```cpp
#include <gmock/gmock.h>

// Interface to mock
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetValue() const = 0;
};

// Mock class
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
};

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  MockFoo foo;
  EXPECT_CALL(foo, GetValue()).WillOnce(testing::Return(42));

  if (foo.GetValue() == 42) {
    return 0;  // Success
  }
  return 1;  // Failure
}
```

---

This page equips you with the foundational knowledge to integrate GoogleTest and GoogleMock into your project, setting the stage for writing robust and effective C++ tests.
