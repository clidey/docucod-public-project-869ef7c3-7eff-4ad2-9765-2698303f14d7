---
title: "Installing with CMake"
description: "Follow step-by-step instructions to install GoogleTest and GoogleMock using CMake, including fetching, configuring, and building the libraries. Tailored especially for projects using modern CMake workflows."
---

# Installing with CMake

Follow these step-by-step instructions to install GoogleTest and GoogleMock using CMake. This guide is tailored for projects adopting modern CMake workflows, enabling you to fetch, configure, build, and install the testing libraries smoothly.

---

## 1. Prerequisites & System Requirements

Before beginning, ensure your environment meets the following:

- **Operating System:** Linux, macOS, Windows, or other supported platforms.
- **C++ Compiler:** Must support at least C++17.
- **CMake Version:** Recommended at least 3.14 to use `FetchContent` module reliably.
- **Build Tool:** Make, Ninja, Visual Studio, Xcode, or any compatible CMake generator.
- **Network Access:** For downloading GoogleTest source via URL if not embedding locally.

<Tip>
Make sure your compiler and build tools are well configured before proceeding. See the [System Requirements & Supported Platforms](../getting-started/prerequisites-install/system-requirements) guide for detailed compatibility info.
</Tip>

---

## 2. Fetching GoogleTest and GoogleMock Source

You can integrate GoogleTest (and GoogleMock) into your project in multiple ways. The most flexible and recommended method is to use CMake's `FetchContent` module to download and configure the sources during the build configuration stage.

### Step 1: Create your project directory

```bash
mkdir my_project && cd my_project
```

### Step 2: Create a `CMakeLists.txt` with these contents

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Enforce C++17 as required by GoogleTest.
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Visual Studio users: prevent CRT mismatch issues.
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

<Tip>
Update the URL to the latest commit or release tag frequently to get the newest features and fixes. Using `FetchContent` ensures your build fetches GoogleTest sources automatically.
</Tip>

---

## 3. Configuring and Building

Once you have your `CMakeLists.txt` configured to fetch GoogleTest, proceed with the build:

```bash
cmake -S . -B build
cmake --build build
```

This configures and builds GoogleTest (and GoogleMock if enabled by default).

<Tip>
The configuration step downloads the GoogleTest sources and prepares them, while the build step compiles the source and libraries.
</Tip>

---

## 4. Installing GoogleTest and GoogleMock

If you want to install the built libraries and headers system-wide (or to your custom prefix), use:

```bash
cmake --install build --prefix /your/install/prefix
```

By default, installation places libraries and headers into standard system locations (e.g., `/usr/local/lib`, `/usr/local/include`). You can customize this with the `CMAKE_INSTALL_PREFIX` during configuration:

```bash
cmake -S . -B build -DCMAKE_INSTALL_PREFIX=/opt/gtest
```

### Notes on Installation Options

- The CMake option `INSTALL_GTEST` controls whether the install targets are active. It defaults to ON in the provided GoogleTest CMake scripts.
- You can build GoogleTest without GoogleMock by disabling `BUILD_GMOCK`:

```bash
cmake -S . -B build -DBUILD_GMOCK=OFF
```

---

## 5. Using GoogleTest in Your CMake Project

After fetching and building, you link your tests against GoogleTest libraries.

### Step 1: Add your test executable

Create your test source file, for example, `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 2: Update `CMakeLists.txt` to build and link the test

Append the following to your `CMakeLists.txt`:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)
target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

### Step 3: Build and run your tests

```bash
cmake --build build
cd build
ctest
```

Expected output:

```
Test project /path/to/my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
```

<Tip>
Including `gtest_discover_tests()` lets CMake automatically find and run all tests you add, simplifying test management.
</Tip>

---

## 6. Best Practices & Tips

- **Visual Studio CRT Compatibility:** Set `gtest_force_shared_crt` to ON to avoid runtime library mismatches.
- **C++17 Requirement:** Double-check your compiler supports C++17; otherwise builds will fail.
- **Building Tests or Samples:** GoogleTest CMake options like `gtest_build_tests` and `gtest_build_samples` are OFF by default; enable if needed.
- **Static vs Shared:** By default, GoogleTest builds as static libraries unless `BUILD_SHARED_LIBS` is ON.

---

## 7. Troubleshooting

### Problem: CMake canâ€™t find GoogleTest after installation

- Make sure you have installed GoogleTest correctly.
- Set `CMAKE_PREFIX_PATH` to the install directory so CMake can find the package.

### Problem: Linking errors on Windows related to runtime mismatch

- Ensure `gtest_force_shared_crt` is set to ON when using Visual Studio with dynamic runtimes.

### Problem: Tests not discovered by CTest

- Verify you included `include(GoogleTest)` and called `gtest_discover_tests()`.

### General

- Use `cmake --help` and `ctest --help` for command line options.
- Use verbose build logs: `cmake --build build -- VERBOSE=1` to debug compilation and linking issues.

---

## 8. Next Steps

- Explore the [Your First Test: Basic Usage](/getting-started/project-setup/first-test) guide to write effective tests.
- See [Integrating with Your Build System](/getting-started/project-setup/project-integration) for detailed setup instructions.
- Consult the [GoogleTest Primer](../guides/getting-started/first-test) to master writing assertions and structuring tests.

---

For broader context and alternative installation methods, see:
- [Quickstart: Building with CMake](../docs/quickstart-cmake.md)
- [Installing with Bazel](/getting-started/prerequisites-install/install-bazel)
- [Using pkg-config for integration](../docs/pkgconfig.md)

Ensure your development workflow follows recommended steps above to take full advantage of GoogleTest and GoogleMock in your projects.
