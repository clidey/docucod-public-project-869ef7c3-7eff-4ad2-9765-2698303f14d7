---
title: "Mocking Your First Class"
description: "Introduction to GoogleMock: define a mock class, set expectations, and check interactionsâ€”with clear code examples and explanations."
---

# Mocking Your First Class

Welcome to the first hands-on guide to creating and using mock classes with GoogleMock! This page introduces how to define a mock class, set expectations on its methods, and verify interactions with clear code examples and explanations. You will quickly gain practical skills for writing effective tests that use mocks to simulate dependencies.

---

## 1. Defining a Mock Class

At the heart of GoogleMock is the ability to create mock classes that simulate interfaces or classes your code depends on. To define a mock class:

- Derive your mock class from the interface or base class you want to mock.
- In the `public:` section, declare mock methods matching the virtual methods you want to override using the `MOCK_METHOD` macro.

### Syntax of `MOCK_METHOD`

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Qualifiers));
```

- The first parameter is the method's return type.
- The second is the method's name.
- The third is the argument list inside parentheses.
- The fourth is optional method qualifiers like `(const, override)`.

### Example: Mocking a `Turtle` Interface

Given this interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};
```

Define a mock class as:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

This macro generates method definitions and wiring automatically. No need to define these mock methods elsewhere.


<Info>
Always put `MOCK_METHOD` declarations in the `public:` section, even if the methods you mock are `protected` or `private` in the base class. This is required so `ON_CALL` and `EXPECT_CALL` can access them properly.
</Info>

---

## 2. Setting Expectations on Mock Methods

Once a mock class is defined and instantiated, you can set expectations on its methods using the `EXPECT_CALL` macro. This lets you specify:

- Which method is expected to be called.
- With what argument matchers.
- How many times (cardinality).
- What behavior or return value it should have.

### Basic Syntax

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)              // Optional
    .WillOnce(action)                // Optional
    .WillRepeatedly(action);        // Optional
```

If you omit matchers, the method is expected to be called with any arguments (only for non-overloaded methods).

### Example: Expect `PenDown` to be Called at Least Once

```cpp
using ::testing::AtLeast;

MockTurtle turtle;
EXPECT_CALL(turtle, PenDown())
    .Times(AtLeast(1));
```

This verifies that `PenDown()` is called at least once during the test.

### Setting Return Values

For methods that return values, you can specify what to return using `WillOnce` or `WillRepeatedly` and actions like `Return`:

```cpp
using ::testing::Return;

MockTurtle turtle;
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))              // return 100 first call
    .WillRepeatedly(Return(200));      // return 200 on subsequent calls
```

---

## 3. Using `ON_CALL` for Default Behavior

Use `ON_CALL` to specify default behaviors for mock methods that will be used when there are no matching `EXPECT_CALL`s.

### Syntax

```cpp
ON_CALL(mock_object, MethodName(matchers...))
    .WillByDefault(action);
```

This does **not** enforce that the method is called, only what happens if it is.

### Example

```cpp
ON_CALL(turtle, GetX()).WillByDefault(Return(0));
```

---

## 4. Running Your First Mock Interaction

Let's combine the parts:

### Step 1: Include Headers & Import Names

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>
using ::testing::_;         // Wildcard matcher
using ::testing::Return;
using ::testing::AtLeast;
```

### Step 2: Define a Mock Class (usually in header or test file)

(See the `MockTurtle` example in Section 1.)

### Step 3: Write a Test Case Using the Mock

```cpp
TEST(TurtleTest, DrawsLine) {
  MockTurtle turtle;

  // Expect PenDown to be called at least once
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  // Set default return value for GetX
  ON_CALL(turtle, GetX()).WillByDefault(Return(0));

  // Exercise the mock object (typically by injecting it into code under test)
  turtle.PenDown();
  EXPECT_EQ(turtle.GetX(), 0);
}
```

When this test runs, GoogleMock checks whether `PenDown()` is called as expected.

<Check>
If mock method calls violate expectations (called less or more times, called with wrong args), GoogleMock reports detailed error messages.
</Check>

---

## 5. Building More Complex Mocks and Expectations

### Mocking Overloaded Methods

If your interface has overloaded methods, mock **all** versions in the mock class.

Example:

```cpp
class Foo {
 public:
  virtual int Bar(int x) = 0;
  virtual int Bar(double x) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x), (override));
  MOCK_METHOD(int, Bar, (double x), (override));
};
```

### Using Matchers

You can specify exact argument matching or use matchers like `_` (wildcard), `Eq()`, `Ge()`, etc.

```cpp
EXPECT_CALL(mock, Foo(Ge(5), _));  // First arg >= 5, second any
```

### Controlling Call Order

Use `InSequence` or `Sequence` and `.InSequence()` clauses to expect calls in a specific order.

### Delegating Calls

Use `ON_CALL` to delegate calls to a fake or real object for default behavior.

---

## 6. Troubleshooting Common Issues

### Common Pitfalls

- **Forgetting virtual destructor:** Ensure the base interface has a virtual destructor.
- **Setting expectations after calls:** Set all `EXPECT_CALL` before exercising the mock.
- **Ignoring overloads:** Mock all overloaded methods to avoid ambiguity.
- **Over-specifying:** Use `ON_CALL` for default behavior and limit `EXPECT_CALL` to essential checks.

### Debugging Tips

- Run tests with `--gmock_verbose=info` to see detailed call traces.
- Use `NiceMock` to suppress warnings on uninteresting calls.
- Use `.RetiresOnSaturation()` to auto-retire expectations once fulfilled.

---

## 7. Next Steps

- Explore [Writing Your First Test Case](/getting-started/first-test/writing-basic-test).
- Deep dive into [Mocking Interfaces with GoogleMock](/guides/mocking-and-mocking-patterns/mocking-basics).
- Learn about [Actions and Matchers](docs/gmock_cook_book.md) for advanced test behaviors.

---

## Summary of Key Practices

- Always put mock method declarations (`MOCK_METHOD`) in `public:` even if the original method is `protected` or `private`.
- Use `EXPECT_CALL` to assert calls and behaviors; use `ON_CALL` for defining default behaviors.
- Set expectations before exercising the mock object.
- Use matchers to flexibly match arguments.
- Use test sequences to enforce call order.

---

## Complete Example

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;
using ::testing::Return;
using ::testing::_;

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};

TEST(TurtleTest, DrawsLine) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  ON_CALL(turtle, GetX()).WillByDefault(Return(0));

  turtle.PenDown();
  EXPECT_EQ(turtle.GetX(), 0);
}
```

This shows the core of mocking a class: defining the mock, setting expectations, providing default behaviors, and invoking the mock in tests.

---

For more advanced scenarios, visit [gMock Cookbook](docs/gmock_cook_book.md) and the [Mocking Reference](docs/reference/mocking.md).
