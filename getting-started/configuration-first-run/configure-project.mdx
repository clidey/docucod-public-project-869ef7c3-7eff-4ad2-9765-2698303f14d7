---
title: "Configure Your Project for Testing"
description: "Explains how to include GoogleTest/GoogleMock headers and link appropriate libraries within a userâ€™s own project. Covers project structure, relevant CMake or Bazel snippets, and best practices to avoid linkage or inclusion errors."
---

# Configure Your Project for Testing with GoogleTest and GoogleMock

This guide helps you seamlessly integrate GoogleTest and GoogleMock into your C++ project by including the right headers and linking against the appropriate libraries. You will learn how to structure your project, configure CMake or Bazel builds, and follow best practices to avoid common linkage or inclusion pitfalls.

---

## 1. Understanding Project Structure and Component Inclusion

To use GoogleTest and GoogleMock in your project, your code must be able to find their header files and link with their compiled libraries. This setup ensures the compiler recognizes the testing framework's APIs and the linker resolves symbols correctly.

### What You Need:

- Access to GoogleTest and GoogleMock source code or installed libraries.
- Proper inclusion of the following headers in your test source files:
  ```cpp
  #include <gtest/gtest.h>     // For GoogleTest functionalities
  #include <gmock/gmock.h>     // For GoogleMock functionalities
  ```
- Linking against GoogleTest and GoogleMock libraries.

> GoogleMock is part of the googletest repository and depends on GoogleTest, so both libraries typically need linking.


## 2. Including Headers in Your Code

### Minimal Header Includes

In your test source files, include the main GoogleTest and GoogleMock headers like so:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

This inclusion grants access to the full testing and mocking APIs, including assertions, test macros, mock class macros, and matchers.

### Best Practices

- Always include `<gtest/gtest.h>` before `<gmock/gmock.h>` if you use both.
- Ensure the include paths are visible to your compiler, which depends on your build configuration (explained in section 3).


## 3. Configuring Your Build System

The way you tell your build system to include headers and link libraries depends on the build system you're using. The two primary supported ways are **CMake** and **Bazel**.

---

### A. CMake Configuration

GoogleTest and GoogleMock provide CMake support to simplify integration.

#### 3.A.1. Adding GoogleTest/GoogleMock to Your Project

You can add GoogleTest/GoogleMock:

- As an **external dependency** (installed or fetched automatically)
- Or as a **subdirectory** in your source tree.

#### 3.A.2. Using FetchContent to Add googletest

Add the following to your `CMakeLists.txt`:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
# For Windows: Prevent overriding the parent project's compiler/linker settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

# Add your executable and link
add_executable(your_test_executable test_main.cpp)
target_link_libraries(your_test_executable gtest_main gmock_main)
# Add test
add_test(NAME YourTest COMMAND your_test_executable)
```

> Replace `release-1.17.0.zip` with the desired version or commit if needed.

#### 3.A.3. Using GoogleTest as Subdirectory

If you have the googletest repo cloned inside your project, add:

```cmake
add_subdirectory(googletest)
add_executable(your_test_executable test_main.cpp)
target_link_libraries(your_test_executable gtest_main gmock_main)
add_test(NAME YourTest COMMAND your_test_executable)
```

#### 3.A.4. Linking Libraries Explained

| Library Target    | Description                                        |
|-------------------|----------------------------------------------------|
| `gtest`           | GoogleTest core without main()                     |
| `gtest_main`      | GoogleTest plus a main() function                   |
| `gmock`           | GoogleMock core without main(), depends on gtest  |
| `gmock_main`      | GoogleMock with main(), depends on gmock and gtest |

For typical test binaries, linking against `gtest_main` or `gmock_main` is recommended as they provide a `main()` entry point.

#### 3.A.5. Include Directories

CMake's targets handle include directories transitively. You do not need to manually add include directories if linking properly.


### Troubleshooting CMake Linking

- If you see linker errors missing GoogleMock or GoogleTest symbols, verify that `target_link_libraries()` includes the correct libraries (`gmock_main` or `gtest_main`).
- On Windows, ensure `gtest_force_shared_crt` is set to match your runtime linkage.
- Check that the C++ standard is set to at least C++17 using:
  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

---

### B. Bazel Configuration

Bazel users add dependencies by referencing GoogleTest/GoogleMock targets.

#### 3.B.1. Declare Dependency in `MODULE.bazel`

Add googletest as a Bazel module dependency.

#### 3.B.2. Use in BUILD File

```bazel
cc_test(
    name = "your_test",
    srcs = ["your_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

---

## 4. Example CMakeLists.txt for a Project Using GoogleMock

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProjectTests LANGUAGES CXX)

# Set C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_mock_tests.cpp)
# Link against GoogleMock and GoogleTest main libraries
target_link_libraries(my_tests gmock_main gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

This will download googletest/GoogleMock, build them with your project, and produce a test executable that is ready to run.

---

## 5. Avoiding Common Pitfalls

- **Missing `main()` linker errors**: Link against `gtest_main` or `gmock_main` libraries instead of only `gtest` or `gmock`.

- **Include path errors**: Ensure your compiler knows where to find `<gtest/gtest.h>` and `<gmock/gmock.h>`. Using proper CMake targets covers this automatically.

- **Runtime library mismatches (Windows)**: Set `gtest_force_shared_crt` in CMake to align CRT linkage.

- **Multiple definitions or symbol clashes**: Avoid duplicating GoogleTest or GoogleMock source files in multiple targets.

- **Compiler C++ standard**: GoogleTest/GoogleMock requires at least C++17; ensure your project sets this explicitly.

- **Link order matters**: Always link `gmock_main` or `gmock` after your project libraries.


## 6. Verifying Your Setup

After configuration:

1. Build your test target successfully.
2. Run the test binary; you should see GoogleTest output indicating test discovery and execution.

Example command:
```bash
ctest
# or directly
./my_tests
```

Expected output snippet:
```
Running main() from gmock_main.cc
[==========] Running 3 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 3 tests from MyMockTests
[ RUN      ] MyMockTests.TestFunction
[       OK ] MyMockTests.TestFunction (0 ms)
[----------] 3 tests from MyMockTests (1 ms total)
[----------] Global test environment tear-down
[==========] 3 tests from 1 test suite ran. (1 ms total)
[  PASSED  ] 3 tests.
```


## 7. Additional Notes

- The GoogleMock and GoogleTest CMake files are community-maintained.
- GoogleTest and GoogleMock use strict compiler warnings; your code should be warning-clean.
- You can define GoogleMock-specific flags to customize behavior via macros (see `gmock-port.h`).


---

# Summary

| Task | Recommended Library to Link |
|-------|-----------------------------|
| Tests with main() provided | `gtest_main` or `gmock_main`|
| Tests without main()        | `gtest` or `gmock`           |

For integrating GoogleTest/GoogleMock, proper header inclusion and linking according to your build system is essential. CMake users benefit from built-in targets and convenient `FetchContent` usage, while Bazel users rely on explicit dependencies. Align compiler settings, especially the C++ standard (C++17), and avoid duplicate sources or incorrect link orders to ensure reliable builds and runs.

---

## References & Next Steps

- [GoogleTest Installation with CMake](../prerequisites-installation/installation-cmake)
- [GoogleMock Quick Start Guide](../configuration-first-run/quick-start-mocking)
- [Writing and Running Your First Test](../configuration-first-run/write-first-test)
- [GoogleMock Official Repo on GitHub](https://github.com/google/googletest)
- [GoogleMock Header Reference (`gmock.h`)](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock.h)

You should continue to the **Write and Run Your First Test** guide to validate your setup and begin writing meaningful tests with GoogleTest and GoogleMock.
