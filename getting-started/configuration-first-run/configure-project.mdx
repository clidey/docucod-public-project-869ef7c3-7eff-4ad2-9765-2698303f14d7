---
title: "Configuring Your Project"
description: "Covers how to add the necessary include paths, link against relevant libraries, handle dependencies, and set up the test runner. Ensures that build and execution environment is correctly configured for running tests."
---

# Configuring Your Project with GoogleTest and GoogleMock

This guide helps you configure your C++ project to use GoogleTest and GoogleMock effectively. By following these steps, you will set up the necessary include paths, link with the appropriate libraries, manage dependencies, and configure your test runner environment to build and execute your tests successfully.

---

## 1. Understanding Components to Link

GoogleTest and GoogleMock consist of several libraries. Your project must link against one of the GoogleTest libraries and optionally GoogleMock libraries if you need mocking features.

- **gtest:** Core GoogleTest library without a main() function.
- **gtest_main:** GoogleTest with a built-in main() function, which provides a default test runner.
- **gmock:** GoogleMock core library (requires linking with gtest).
- **gmock_main:** GoogleMock with main() included, which initializes both GoogleMock and GoogleTest and runs tests.

> **Tip:** Link against the `_main` version when you want to use the default test runner provided by the framework, otherwise link against the basic version if your project provides its own main function.


## 2. Setting Up Include Paths

GoogleTest and GoogleMock provide well-defined include directories containing header files needed to compile your tests.

### Basic Include Setup

Add the following include paths to your compiler options:

- For GoogleTest:
  - `<googletest_source_dir>/include`
  - `<googletest_source_dir>` (sometimes required for internal headers)

- For GoogleMock:
  - `<googlemock_source_dir>/include`
  - `<googlemock_source_dir>`
  - All GoogleTest include dirs from above

These directories are usually exposed as **interface include directories** on targets `gtest`, `gtest_main`, `gmock`, and `gmock_main`.

### Using pkg-config (Optional)

You can use the provided pkg-config files (`gtest.pc`, `gmock.pc`) to get the compile flags (including includes and macros). For example:

```bash
pkg-config --cflags gtest
pkg-config --cflags gmock
```

This way, you obtain all necessary include paths and defines.


## 3. Linking Against the Relevant Libraries

To build your test executable, link against the appropriate GoogleTest or GoogleMock libraries matching your needs.

| Use Case                         | Libraries to Link                 |
|---------------------------------|---------------------------------|
| Basic GoogleTest tests           | `gtest_main` or `gtest`          |
| Using GoogleMock mocking         | `gmock_main` or `gmock` + `gtest` |

> **Note:** Linking `gmock_main` implies linking `gmock` and `gtest` internally. Similarly, `gtest_main` implies `gtest`.


## 4. Handling Threading and Platform-Specific Flags

GoogleTest and GoogleMock detect threading support automatically and add flags accordingly, including `-pthread` if needed. This is handled in their CMake integration and `.pc` files.

If building manually, ensure you link with the threading system and add compiler flags such as `-DGTEST_HAS_PTHREAD=1` if your environment supports pthreads.


## 5. Integrating Into Your Build System

### Using CMake

If you are using CMake, the simplest way is to add GoogleTest and GoogleMock as subdirectories or use installed targets.

#### Example: Adding GoogleTest with FetchContent

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.16.0.zip
)

FetchContent_MakeAvailable(googletest)

add_executable(my_test test_my_code.cpp)
target_link_libraries(my_test PRIVATE gtest_main)
enable_testing()
add_test(NAME my_test COMMAND my_test)
```

#### Linking GoogleMock

```cmake
add_executable(my_mock_test test_mock.cpp)
target_link_libraries(my_mock_test PRIVATE gmock_main)
enable_testing()
add_test(NAME my_mock_test COMMAND my_mock_test)
```


### Using pkg-config In CMake

You may prefer pkg-config for compilation and linking flags. Here's how to integrate pkg-config in CMake:

```cmake
find_package(PkgConfig REQUIRED)
pkg_check_modules(GTEST REQUIRED gtest_main)

add_executable(test_executable test.cpp)
target_compile_options(test_executable PRIVATE ${GTEST_CFLAGS})
target_link_libraries(test_executable PRIVATE ${GTEST_LDFLAGS})
enable_testing()
add_test(NAME test_executable COMMAND test_executable)
```


## 6. Providing Your Own Test Runner (Optional)

If you want to customize test execution or have special setup codes, you can link against `gtest` or `gmock` directly rather than the `_main` variants, then provide your own `main()` function. Your main function should initialize the framework and run tests:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>  // If using GoogleMock features

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv); // This initializes both GoogleMock and GoogleTest
  return RUN_ALL_TESTS();
}
```


## 7. Common Pitfalls and Tips

- **Missing Include Paths:** Forgetting to include all required GoogleTest/GoogleMock include directories will lead to compilation errors.
- **Linker Errors:** If you see linker errors related to `main()`, verify you are linking against `_main` variants or provide your own `main()`.
- **Threading Support:** Ensure your environment supports threading or disable pthread usage via build options (`-Dgtest_disable_pthreads` in CMake).
- **Version Compatibility:** Match your GoogleTest and GoogleMock versions to avoid compatibility issues.


## 8. Verifying Your Configuration

After configuring your project, build your test executable and run it. On success, you should see output like:

```
Running main() from gmock_main.cc
[==========] Running 3 tests from 1 test suite.
[----------] Global test environment set-up.
[ RUN      ] SampleTest.DoesBlah
[       OK ] SampleTest.DoesBlah (0 ms)
[----------] 1 test from SampleTest.
[----------] Global test environment tear-down
[==========] 3 tests from 1 test suite ran. (3 ms total)
[  PASSED  ] 3 tests.
```


## 9. Further Reading and Next Steps

- [Writing and Running Your First Test](https://github.com/google/googletest/blob/main/docs/guides/core-workflows/getting-started-tests.md) — Learn how to write test cases and assertions.
- [Mocking Dependencies with GoogleMock](https://github.com/google/googletest/blob/main/docs/guides/core-workflows/mocking-basics.md) — Get started with mocking objects.
- [Using pkg-config](https://github.com/google/googletest/blob/main/docs/pkgconfig.md) — More about pkg-config integration.
- [Installation with CMake](https://github.com/google/googletest/blob/main/docs/getting-started/prerequisites-installation/install-via-cmake.md) — Complete installation instructions.

---

<Check>
Make sure your build system has access to GoogleTest and GoogleMock libraries and include paths before compiling tests.
</Check>

<Note>
If you want to customize compile or linker flags, examine `googletest/cmake/internal_utils.cmake` which defines the compiler settings used.
</Note>