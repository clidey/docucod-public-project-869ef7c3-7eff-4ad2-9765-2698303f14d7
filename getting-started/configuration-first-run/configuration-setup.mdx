---
title: "Setup and Project Integration"
description: "A hands-on walkthrough for integrating GoogleTest and GoogleMock with your C++ build system. Learn how to add the frameworks to your project, handle dependencies, and verify linkage."
---

# Setup and Project Integration

A hands-on walkthrough for integrating GoogleTest and GoogleMock with your C++ build system. Learn how to add the frameworks to your project, handle dependencies, and verify linkage.

---

## 1. Understanding Your Integration Needs

Before integrating GoogleTest and GoogleMock, consider your build environment and workflow. These frameworks are designed to work well with common C++ build systems, including CMake, Bazel, and manual builds.

- GoogleTest is a robust and portable testing framework for C++.
- GoogleMock complements GoogleTest with mocking capabilities.
- Both come with flexible build scripts and integration points.

Whether you want to build them standalone, embed into your project, or use pre-built libraries, this guide helps you achieve it.

---

## 2. Adding GoogleTest and GoogleMock to Your Project

### Option A: Use Pre-installed or Installed Libraries

If GoogleTest and GoogleMock are already installed on your system, you can simply link against their libraries.

- Find the installation paths of headers and libraries.
- Add include directories where `gtest/gtest.h` and `gmock/gmock.h` reside.
- Link to libraries `gtest`, `gmock`, or `gtest_main`, `gmock_main` as needed.

### Option B: Build from Source and Integrate

The recommended way, especially for custom or controlled versions, is to build GoogleTest and GoogleMock alongside your project.

#### Standalone Build Example Using CMake:

```bash
# Clone the repository and checkout a stable version
$ git clone https://github.com/google/googletest.git -b v1.17.0
$ cd googletest

# Create and enter the build directory
$ mkdir build
$ cd build

# Configure build for GoogleTest only
$ cmake .. -DBUILD_GMOCK=OFF

# Build the libraries
$ make

# (Optional) Install system-wide
$ sudo make install
```

> **Tip:** To build with GoogleMock included, omit `-DBUILD_GMOCK=OFF`.

#### Integrating in Your CMake Project:

You can add GoogleTest/GoogleMock sources to your project using `add_subdirectory()`:

```cmake
# In your project's CMakeLists.txt
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# This avoids overwriting your compiler flags on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Add your test executable
add_executable(mytests test1.cpp test2.cpp)

# Link against GoogleTest and GoogleMock libraries
target_link_libraries(mytests gtest_main gmock_main)

# Enable testing
enable_testing()
add_test(NAME mytests COMMAND mytests)
```

> **Best Practice:** Building as part of your project ensures consistent compiler settings and prevents linking issues related to runtime libraries.

### Option C: Manual Integration

- Download the GoogleTest source.
- Include `googletest/include` and `googlemock/include` in your compiler include paths.
- Compile the source files from the `googletest/src` and `googlemock/src` directories as part of your test target.

---

## 3. Handling Build Dependencies

GoogleTest requires:

- A C++ compiler supporting at least C++17 standard.
- On POSIX systems, pthread library (link with `-pthread` or equivalent).

GoogleMock depends on GoogleTest, so ensure both are included properly.

When using CMake, `FetchContent` or `add_subdirectory()` handles most dependencies automatically.

---

## 4. Configuring Your Test Program

### Using Existing Main Functions

- The GoogleTest `gtest_main` library provides a ready-made `main()` function that initializes the framework and runs all tests.
- Link your test executable with `gtest_main` (and `gmock_main` if using GoogleMock) instead of `gtest`.

### Writing a Custom main()

Write your own main only if you need to customize initialization steps.

```c++
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

> **Important:** Always call `InitGoogleTest()` before `RUN_ALL_TESTS()`. Passing command line arguments allows flag processing for test features.

---

## 5. Verifying the Integration

After building your test executable:

1. Run it without arguments to execute all tests.
2. You should see test run summaries such as:

```
[==========] Running 3 tests from 1 test suite.
[ RUN      ] FactorialTest.HandlesZeroInput
[       OK ] FactorialTest.HandlesZeroInput (0 ms)
[ RUN      ] FactorialTest.HandlesPositiveInput
[       OK ] FactorialTest.HandlesPositiveInput (0 ms)
[==========] 3 tests from 1 test suite ran. (1 ms total)
[  PASSED  ] 3 tests.
```

3. If using GoogleMock, also verify that mocks compile and that your mock expectations are respected.

---

## 6. Best Practices and Tips

- **Use CMake's `FetchContent`** to version control GoogleTest alongside your project for reproducible builds.
- **Build GoogleTest as part of your project** to avoid runtime mismatches and linker errors.
- **Link against `gtest_main`** unless you need custom initialization.
- Avoid mixing different versions or builds of GoogleTest in the same project.
- On Windows, if linking errors about runtime libraries occur, **use the `gtest_force_shared_crt` option** as shown to align runtime linkage.

---

## 7. Troubleshooting Common Issues

### Linker Errors Related to GoogleTest Symbols

- Confirm headers and libraries are correctly included and linked.
- Check that your project and GoogleTest use the same C++ standard (C++17 minimum).
- On Windows, make sure runtime linkage is consistent.

### Wrong or Missing `main()` Function

- If the linker complains about missing `main`, either link with `gtest_main` or add your own `main()` invoking `InitGoogleTest()` and `RUN_ALL_TESTS()`.

### Test Not Running or Discovered

- Ensure your tests use the `TEST()` or `TEST_F()` macros.
- Confirm that your test files are compiled and linked into your test executable.

---

## 8. Additional Resources

- [GoogleTest Primer](primer.md) - Learn how to write and structure tests.
- [Installation Methods](getting-started/prerequisites-installation/installation-methods.md) - More detailed installation steps.
- [Core Workflow Guides](guides/core-workflows/your-first-test.md) - Writing and running your first tests.
- GoogleTest GitHub Repo: https://github.com/google/googletest

---

## Summary

Set up GoogleTest and GoogleMock by building them standalone or embedding into your project using your preferred build system. Utilize the provided main functions or write custom ones with proper initialization. Confirm linkage, dependencies, and compatibility. Verify the test executable successfully runs all tests and troubleshoot linker or discovery issues by checking build configurations and runtime environments.

---

## Example: Minimal CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

# Enable testing
include(CTest)

# Fetch GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

# Add executable for tests
add_executable(mytests test_main.cpp my_test_source.cpp)

# Link with GoogleTest and GoogleMock
target_link_libraries(mytests gtest_main gmock_main)

enable_testing()
add_test(NAME mytests COMMAND mytests)
```

---

Feel confident following this guide to integrate GoogleTest and GoogleMock seamlessly into your C++ projects for reliable, maintainable testing.
