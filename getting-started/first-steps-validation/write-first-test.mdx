---
title: "Writing Your First Test"
description: "Introductory steps for creating and understanding a basic test using GoogleTest and GoogleMock. Includes code snippets, key concepts (like TEST macros and simple assertions), and references to ready-made samplesâ€”empowering users to write and run their first passing test case quickly."
---

# Writing Your First Test with GoogleTest and GoogleMock

Welcome to your first step into writing tests using GoogleTest and GoogleMock! This guide will walk you through creating, understanding, and running a simple test case that leverages the power of mocks and assertions to verify your C++ code behavior. By the end, you will have a basic passing test that demonstrates key GoogleTest macros and GoogleMock techniques.

---

## 1. Understanding the Basics

### What You Will Achieve

- Define a mock class with mocked methods using `MOCK_METHOD`.
- Write a test case using the `TEST` macro.
- Set expectations on mock methods using `EXPECT_CALL`.
- Use simple assertions inside your tests.
- Run the test and interpret the output.

### Key Concepts Introduced

- **`TEST` macro:** Defines a test function with a name and test case group.
- **Mock class:** A C++ class where methods are replaced by mock methods.
- **`EXPECT_CALL`:** Sets expectations on how mock methods are called.
- **Simple assertions:** Validate results within tests.

---

## 2. Preparing Your Mock Class

Mocks let you simulate the behavior of dependencies and verify interactions.

### Defining a Mock Class

Create a class that inherits from the interface or base class you want to mock. Then declare mock methods using the `MOCK_METHOD` macro.

```cpp
#include <gmock/gmock.h>  // Include GoogleMock

// Interface to mock
class Turtle {
 public:
  virtual ~Turtle() = default;
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void MoveForward(int distance) = 0;
};

// Mock class
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, MoveForward, (int distance), (override));
};
```

### Notes

- `MOCK_METHOD` parameters: `MOCK_METHOD(ReturnType, MethodName, (Args...), (qualifiers))`
- Always place `MOCK_METHOD` declarations in the `public` section.
- The `override` qualifier ensures correct overriding of virtual functions.

---

## 3. Writing Your First Test Case

Your test will verify the interaction with the mock.

### Step-by-Step Example

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::AtLeast;

// Your mock class from previous step
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, MoveForward, (int distance), (override));
};

// The code or component you are testing (example painter class)
class Painter {
 public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}

  bool DrawLine() {
    turtle_->PenDown();
    turtle_->MoveForward(100);
    turtle_->PenUp();
    return true;  // Simple success indication
  }

 private:
  Turtle* turtle_;
};

// Test case defines the behavior to expect and verifies it
TEST(PainterTest, DrawsLine) {
  MockTurtle mock_turtle;

  // Set expectations that PenDown and PenUp are called at least once
  EXPECT_CALL(mock_turtle, PenDown())
      .Times(AtLeast(1));
  EXPECT_CALL(mock_turtle, PenUp())
      .Times(AtLeast(1));

  // Expect MoveForward called exactly once with argument 100
  EXPECT_CALL(mock_turtle, MoveForward(100))
      .Times(1);

  Painter painter(&mock_turtle);

  // Exercise the method
  bool result = painter.DrawLine();

  // Assert expected outcome
  EXPECT_TRUE(result);
}
```

### What Happens in This Test?

- You create a mock object `mock_turtle`.
- Set expectations with `EXPECT_CALL` on its methods.
- Create `Painter` using your mock.
- Call `DrawLine`, which triggers calls on the mock.
- The mock checks if calls were made as expected.
- Use `EXPECT_TRUE` to assert that the drawing succeeded.

---

## 4. Running Your Test

### Compile and Link

Make sure you've linked with GoogleTest and GoogleMock. For example with `g++`:

```bash
g++ -std=c++17 -pthread my_test.cc -lgtest -lgmock -o my_test
```

### Running

Run your test binary:

```bash
./my_test
```

Expected Output Example:

```text
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from PainterTest
[ RUN      ] PainterTest.DrawsLine
[       OK ] PainterTest.DrawsLine (0 ms)
[----------] 1 test from PainterTest (0 ms total)
[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

If it passes, congratulations! Your test successfully verified the interactions.

### Common Failures

If a mock method is not called as expected, you will get immediate failure messages like:

```text
Actual function call count doesn't match this expectation.
Expected: to be called once
Actual: never called.
```

Use this feedback to adjust your test or implementation.

---

## 5. Tips, Best Practices, and Common Pitfalls

- **Set Expectations Before Invoking Methods:** Always add `EXPECT_CALL` before the mock method is called; otherwise behavior is undefined.
- **Use Wildcard Matcher _ When Appropriate:** If you don't care about an argument, use `_` to ignore it.
- **Avoid Over-Specifying:** Write only what you want to verify explicitly to avoid brittle tests.
- **Use Sequences (`InSequence`) to Enforce Order:** If order matters, wrap expectations in an `InSequence` block.
- **Suppress Noisy Warnings Using `NiceMock`:** If your mock generates many uninteresting call warnings, consider `NiceMock<T>`.
- **Retiring Expectations:** Use `.RetiresOnSaturation()` where you want an expectation to become inactive after the expected calls.

---

## 6. Resources and Next Steps

- **Explore More on Writing Mocks:** See the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced mocking techniques.
- **Learn About Matchers and Actions:** Visit the [Matchers](https://google.github.io/googletest/matchers.html) and [Actions](https://google.github.io/googletest/actions.html) references.
- **Understand Uninteresting vs Unexpected Calls:** Learn best practices from the [Nice, Strict, and Naggy Mocks section](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy).
- **Try Running Sample Tests:** Look into sample tests in the GoogleMock repo under `googlemock/test/`.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Troubleshooting Scenarios">
<Accordion title="Mock Methods Not Called as Expected">
Check that you have set `EXPECT_CALL` before the method call.
Verify argument matchers are correct.
Use `--gmock_verbose=info` flag to get detailed call traces.
</Accordion>
<Accordion title="Unexpected Warnings about Uninteresting Calls">
Try using `NiceMock<T>` to suppress warnings on uninteresting calls.
Check if you forgot to set an `EXPECT_CALL` or `ON_CALL`.
</Accordion>
<Accordion title="Compilation Errors with MOCK_METHOD and Commas in Arguments">
Wrap complex template arguments in extra parentheses.
Or define type aliases to simplify arguments.
</Accordion>
</AccordionGroup>

---

You are now ready to start adding tests with GoogleTest and GoogleMock. Remember, the balance between verifying behavior and keeping tests maintainable is the key to success.

Happy testing!
