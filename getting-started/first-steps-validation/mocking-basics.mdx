---
title: "Getting Started with GoogleMock"
description: "Introduces the essentials of using GoogleMock: defining mock classes, setting expectations, and validating mock interactions with a first working example."
---

# Getting Started with GoogleMock

Welcome to the essentials of using GoogleMock—GoogleTest's powerful mocking framework for C++. This guide will walk you through the fundamental concepts: defining mock classes, setting expectations on mock methods, and validating their interactions via a hands-on example to get you quickly comfortable with GoogleMock.

---

## 1. What You’ll Achieve

By the end of this guide, you will:
- Understand how to define a mock class using the `MOCK_METHOD` macro.
- Learn to set expectations on mock method calls using `EXPECT_CALL`.
- Validate that the mock’s behavior matches these expectations when executing your tests.
- Write and run a first simple, working mocking example.

---

## 2. Defining Mock Classes

Mock classes simulate real objects in tests, allowing you to observe and control interactions.

### Step-by-Step: Writing a Mock Class

1. **Inherit from the interface or base class you want to mock.**
2. **Declare mock methods using the macro `MOCK_METHOD` inside the public section.**
    The syntax is:
    ```cpp
    MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
    ```
3. **Use appropriate qualifiers:**
   - `(override)` if overriding a virtual method
   - `(const, override)` for const methods
   - Other qualifiers like `noexcept` or `ref` as necessary

### Example
Suppose you have an interface:
```cpp
class Turtle {
 public:
  virtual ~Turtle() = default;
  virtual void PenUp() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```
You define a mock class as:
```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Tips & Best Practices
- Always place `MOCK_METHOD` declarations in the **public** section.
- If any method is overloaded, mock each overload separately.
- For methods with complicated argument types containing commas (e.g., templates like `std::pair`), use parentheses or type aliases to avoid macro parsing errors (see the [Mocking Reference](reference/mocking.md#MOCK_METHOD) for details).

---

## 3. Setting Expectations on Mock Methods

GoogleMock lets you specify what calls you expect on your mock objects and their behavior.

### Using `EXPECT_CALL`

Set expectations on mock methods before exercising the code under test.

#### Basic Syntax
```cpp
EXPECT_CALL(mock_object, MethodName(Matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```
- `mock_object`: your mock instance
- `MethodName`: method you mock
- `Matchers`: argument matchers like `_` (anything), explicit values, or advanced matchers
- `Times()`: how many times the function is expected
- `WillOnce()`: action for a single call
- `WillRepeatedly()`: action for all calls after those in `WillOnce()`

#### Matchers
- Use `_` to match any argument
- Use values to expect equality: e.g. `10`, `'a'`
- Combine with more advanced matchers from GoogleTest’s matcher library (see [Matchers Reference](reference/matchers.md))

#### Cardinalities
| Cardinality          | Meaning                       |
|----------------------|-------------------------------|
| `AnyNumber()`        | Any number of calls accepted  |
| `AtLeast(n)`         | At least `n` calls expected   |
| `AtMost(n)`          | At most `n` calls expected    |
| `Between(m, n)`      | Between `m` and `n` calls     |
| `Exactly(n)` or `n`  | Exactly `n` calls expected    |
| `Times(0)`           | Call should never happen      |

If `Times` is omitted, GoogleMock infers it based on the presence of `WillOnce` and `WillRepeatedly` clauses.

#### Actions
- Choose what the mock method does: return a value, invoke a function, set output arguments, etc.
- Common action: `Return(value)` returns a specific value.

### Example
```cpp
using ::testing::Return;
using ::testing::_;

TEST(TurtleTest, MovesForward) {
  MockTurtle mock_turtle;

  EXPECT_CALL(mock_turtle, Forward(100))
      .Times(1);

  EXPECT_CALL(mock_turtle, GetX())
      .WillOnce(Return(100));

  // Code under test exercises mock_turtle.

  mock_turtle.Forward(100);
  EXPECT_EQ(100, mock_turtle.GetX());
}
```

### Best Practices
- Set expectations **before** exercising the code that uses the mock.
- Use `_` matcher to indicate "don't care" where argument values are irrelevant.
- Avoid over-specifying expectations to keep tests from being brittle.
- Use `NiceMock<MockTurtle>` if you want to suppress warnings from uninteresting calls.
- Use `.RetiresOnSaturation()` on expectations that should retire after their expected calls.

---

## 4. First Working GoogleMock Example

Let's tie these concepts together in a simple GoogleMock test. This example demonstrates mocking an interface, setting expectations, and verifying interactions.

### Define the Interface
```cpp
class Calculator {
 public:
  virtual ~Calculator() = default;
  virtual int Add(int a, int b) = 0;
};
```

### Create the Mock Class
```cpp
#include <gmock/gmock.h>

class MockCalculator : public Calculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
};
```

### Write Your Test
```cpp
#include <gtest/gtest.h>

using ::testing::Return;

TEST(CalculatorTest, AddsNumbers) {
  MockCalculator mock_calc;

  // Expect Add to be called with arguments 3 and 4 and return 7.
  EXPECT_CALL(mock_calc, Add(3, 4))
      .Times(1)
      .WillOnce(Return(7));

  // Exercise the mock.
  int result = mock_calc.Add(3, 4);

  // Validate the result.
  EXPECT_EQ(result, 7);
}
```

### Running the Test
Compile your test binary linking with GoogleTest and GoogleMock, then run it. If the expectations are met, the test passes; otherwise it fails with a clear error message.

### Expected Outcome
- The test verifies that the `Add` method is called exactly once with the expected arguments.
- The mocked `Add` returns the value `7` as specified.
- If the call doesn’t happen as expected, the test fails and reports the discrepancy.

---

## 5. Troubleshooting Common Issues

### Expectation Not Met or Test Fails Unexpectedly
- Make sure `EXPECT_CALL` precedes the mock method invocation.
- Check if the mock methods are virtual.
- Confirm argument matchers align with actual call arguments.

### Uninteresting Call Warnings
- This happens when a mock method is called with no expectation set.
- Use `NiceMock<YourMock>` to suppress warnings on uninteresting calls.
- Alternatively, set a catch-all expectation with `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());` to silence warnings.

### Parsing Errors in `MOCK_METHOD`
- For argument types with commas (e.g., templates), enclose the type in extra parentheses or use a type alias.

### Compilation Fails on Const or Override Specifiers
- Ensure method signatures exactly match the base class (const, noexcept, ref qualifiers).
- For MSVC warnings, try removing unnecessary top-level const on parameters.

### Mock Methods Not Called
- Check that the mock instance used is the same passed to the code under test.
- Verify that your mock methods are called with matching argument values.

---

## 6. Next Steps

- Explore **Writing and Running Your First Test** to get familiar with basic test creation.
- Dive into the [GoogleMock Cookbook](docs/gmock_cook_book.md) for advanced mocking scenarios.
- Consult the [Mocking Reference](docs/reference/mocking.md) for detailed API explanations.
- Use `NiceMock` and `StrictMock` for controlling warnings and errors from uninteresting calls.

---

## 7. Additional Resources & References

- [GoogleMock for Dummies](docs/gmock_for_dummies.md) — friendly introduction
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) — quick syntax and examples
- [Matchers Reference](reference/matchers.md) — argument matching tools
- [Actions Reference](reference/actions.md) — controlling mock behaviors
- Related Getting Started pages:
  - [Prerequisites & System Requirements](getting-started/environment-setup/prerequisites-and-requirements)
  - [Installing with CMake](getting-started/installation-integration/installing-via-cmake)
  - [Writing and Running Your First Test](getting-started/first-steps-validation/creating-your-first-test)

---

<Check>
Remember: Always place mock method declarations in the public section and match the method signatures exactly. Set your expectations before exercising the mock in tests. Use `NiceMock` to reduce noise when you aren't interested in all calls.
</Check>

<Info>
For a gentle start, consider reading the companion page "Writing and Running Your First Test" for foundational test construction before diving deeper into mocking.
</Info>
