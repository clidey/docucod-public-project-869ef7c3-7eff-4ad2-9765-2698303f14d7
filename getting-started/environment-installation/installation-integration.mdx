---
title: "Installation & Integration"
description: "Step-by-step instructions for installing GoogleTest and GoogleMock using common approaches such as CMake and Bazel, with guidance for integrating into both existing and new C++ projects."
---

# Installation & Integration Guide for GoogleTest and GoogleMock

Welcome to your step-by-step companion for installing and integrating GoogleTest and GoogleMock into your C++ projects. This guide will walk you through setting up these powerful testing frameworks using the most common build systems—CMake and Bazel—and provide clear advice on how to embed them into new or existing projects.

---

## 1. Prerequisites & System Requirements

Before you start the installation, ensure your environment meets these requirements:

- **Compiler compatibility**: Must support C++17 or newer
- **Supported platforms**: Linux, Windows, macOS
- **Build tools**: CMake (3.14+ recommended) or Bazel installed and configured
- **Threading support**: If you intend to use multi-threaded tests, your platform should support pthread or equivalent

> For details on setting up your environment and verifying compiler versions, see the [Prerequisites & System Requirements guide](https://github.com/google/googletest/blob/main/docs/prerequisites-requirements.md).

---

## 2. Installation Instructions

### 2.1 Standalone Installation with CMake

This approach builds GoogleTest (and GoogleMock by default) as a separate project.

<Steps>
<Step title="Clone the Repository">
```
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
```

This fetches the stable GoogleTest release source code.
</Step>

<Step title="Create a Build Directory">
```
mkdir build
cd build
```

We separate build files from sources for cleanliness.
</Step>

<Step title="Configure the Build">
```
cmake ..
```

To build GoogleMock alongside GoogleTest (default). To build only GoogleTest:
```
cmake .. -DBUILD_GMOCK=OFF
```

This generates platform-native build scripts (Makefile, Visual Studio solution, Xcode project).
</Step>

<Step title="Build the Project">
- On Unix/Linux/macOS:
```
make
```
- On Windows, open the generated `gtest.sln` in Visual Studio and build the solution.

This compiles the libraries.
</Step>

<Step title="Install Libraries (Optional)">
If you want system-wide installation (requires administrator rights):
```
sudo make install
```

This installs headers and libraries to `/usr/local/` by default.
</Step>

<Step title="Verify Installation">
- Ensure the `libgtest` and optionally `libgmock` libraries have been built.
- Confirm header files are accessible in the installed path.
</Step>
</Steps>

<Tip>
For users on Windows, make sure you match the runtime linkage between your project and GoogleTest libraries to avoid linker errors. Use the `-Dgtest_force_shared_crt=ON` CMake flag to enable dynamic runtime linkage.
</Tip>

---

### 2.2 Integrating GoogleTest and GoogleMock into an Existing CMake Project

Embedding the testing frameworks directly into your project build can simplify maintenance.

<Steps>
<Step title="Add GoogleTest Source as a Subdirectory">
Place the Googletest source inside your project repo or as a git submodule.

Then in your `CMakeLists.txt`:
```cmake
add_subdirectory(googletest)
```

This makes GoogleTest and GoogleMock targets available.
</Step>

<Step title="Link Your Test Executable With GoogleTest">
Example:
```cmake
add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gtest_main gmock)
add_test(NAME MyTests COMMAND my_tests)
```

Here, `gtest_main` provides a default `main()` function. If you want a custom `main()`, link only `gtest` or `gmock`.
</Step>

<Step title="Enable C++17 Standard">
```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Ensures compatibility.
</Step>
</Steps>

<Note>
If you build GoogleTest separately and install it system-wide, utilize `find_package(GTest CONFIG REQUIRED)` to locate the libraries, then link with `GTest::gtest`, `GTest::gmock`, or `GTest::gtest_main`.
</Note>

---

### 2.3 Using Bazel for Installation

GoogleTest and GoogleMock are well supported by Bazel. To include in a Bazel project:

<Steps>
<Step title="Add GoogleTest as a Dependency">
In your `WORKSPACE` file:
```starlark
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.zip"],
    strip_prefix = "googletest-release-1.17.0",
)
```
</Step>

<Step title="Update BUILD Files">
In your `BUILD` file, define your test binary with dependencies:
```starlark
cc_test(
    name = "my_test",
    srcs = ["my_test.cpp"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"]
)
```
</Step>

<Step title="Build and Run Tests">
```
bazel test //:my_test
```
</Step>
</Steps>

---

## 3. Configuration & Setup

### 3.1 Linking and Includes

- Add the include path for GoogleTest and GoogleMock headers (e.g., `googletest/include/` and `googlemock/include/`).
- Link your test executable to the correct libraries:
  - For pure GoogleTest: `gtest` and `gtest_main` or `GTest::gtest`, `GTest::gtest_main`
  - For GoogleMock and GoogleTest: `gmock`, `gmock_main`, and dependencies

### 3.2 Using a Custom `main()`

If you want custom behavior before or after running tests, write your own `main()`:

```cpp
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  // Custom setup here
  return RUN_ALL_TESTS();
}
```

Otherwise, link with `gtest_main` or `gmock_main` to provide a default entry point.

### 3.3 Threading and Shared Libraries

- To enable thread-safe tests, ensure your build links correctly with pthread or platform equivalent.
- For dynamic/shared library usage, set `-DGTEST_CREATE_SHARED_LIBRARY=1` on compilation and `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` on test binaries.

---

## 4. Running Your First Test

You have GoogleTest and GoogleMock installed and integrated. Now let's run a sample test.

### 4.1 Accessing the Test Framework

The framework headers are:
```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h> // when using GoogleMock
```

### 4.2 Sample Basic Test (GoogleTest only)

Create a file `sample_test.cpp`:

```cpp
#include <gtest/gtest.h>

// Simple function to test
int Square(int x) {
  return x * x;
}

TEST(SampleTestSuite, HandlesPositiveInput) {
  EXPECT_EQ(Square(3), 9);
  EXPECT_EQ(Square(5), 25);
}
```

Build and link this file with GoogleTest libraries as described.

### 4.3 Building and Executing the Test

- Build your test executable.
- Run the executable:

```
./my_test
```

Expected output:

```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from SampleTestSuite
[ RUN      ] SampleTestSuite.HandlesPositiveInput
[       OK ] SampleTestSuite.HandlesPositiveInput (0 ms)
[----------] 1 test from SampleTestSuite (0 ms total)
[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

You're successfully running your first GoogleTest!

### 4.4 Running a Simple Mock Object Test (GoogleMock)

Example:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class MockPrinter {
 public:
  MOCK_METHOD(void, Print, (const std::string& text), ());
};

TEST(MockTestSuite, VerifiesPrintCall) {
  MockPrinter printer;
  EXPECT_CALL(printer, Print("Hello"))
      .Times(1);

  printer.Print("Hello");
}
```

Build and run linking with GoogleMock (`gmock_main`) libraries.

---

## 5. Troubleshooting Common Issues

### Build and Link Failures

- **Mismatch in runtime linkage (Visual Studio)**: Use `-Dgtest_force_shared_crt=ON` to align runtimes.
- **Missing pthread on linking**: Manually add `-lpthread` to linker flags or use CMake’s `find_package(Threads)`.

### Tests Not Found or Not Running

- Ensure tests are registered via `TEST()` macros and `RUN_ALL_TESTS()` is called.
- Link against `gtest_main` or write your own `main()` that calls `InitGoogleTest()`.

### Installation Verification

- Check that the library files (`libgtest.a`, `libgmock.a`, etc.) exist in your build or install directory.
- Check that your compiler supports C++17; verify with `g++ --version` or similar.

### Platform-Specific Notes

- On embedded platforms (e.g., ESP8266), the entry point diverges to `setup()` and `loop()`. Refer to platform-specific source files.

---

## 6. Next Steps & Additional Resources

### After Installation:

- Write your first unit tests with the [GoogleTest Primer](primer.md).
- Explore mocking features using the [GoogleMock Beginner Tutorial](gmock_for_dummies.md).
- Integrate testing into your CI/CD pipeline as described in [Integration Overview](overview/architecture-concepts/integration-overview).

### Support and Community

- Visit [GoogleTest GitHub Repository](https://github.com/google/googletest) for source and issues.
- Join the community discussions and troubleshooting at [Community & Further Help](getting-started/troubleshooting/community-resources).

---

## References

- [GoogleTest Primer](primer.md)
- [Installing with CMake](https://github.com/google/googletest/blob/main/googletest/README.md)
- [GoogleMock Documentation](googlemock/README.md)
- [Mocking Reference](docs/reference/mocking.md)
- [Running Tests Reference](docs/reference/testing.md)
- [Prerequisites & System Requirements](getting-started/environment-installation/prerequisites-requirements.mdx)

---

By following this guide, you will have a fully operational testing foundation in your C++ project, ready to create robust and maintainable tests leveraging the full power of GoogleTest and GoogleMock.