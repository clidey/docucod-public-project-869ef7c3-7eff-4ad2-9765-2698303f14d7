---
title: "Install with CMake"
description: "Practical, step-by-step instructions to build and set up GoogleTest and GoogleMock using CMake, the most common modern C++ build tool. Covers fetching, configuring, building, and linking into your own projects."
---

# Install with CMake

Practical, step-by-step instructions to build and set up GoogleTest and GoogleMock using CMake, the most common modern C++ build tool. This guide covers fetching the source, configuring the build, compiling the libraries, and integrating them into your own projects.

---

## 1. Prerequisites & System Requirements

Before you begin building GoogleTest and GoogleMock with CMake, ensure your environment satisfies the following requirements:

- **Operating System**: Compatible with Linux, macOS, or Windows.
- **C++ Compiler**: Supports at least the C++17 standard.
- **CMake Version**: 3.13 or higher is required (latest stable versions recommended).
- **Build Tool**: Make, Ninja, or Visual Studio (depending on your platform).

<Tip>
If you donâ€™t have CMake installed, you can download it from https://cmake.org/install.
</Tip>

---

## 2. Fetching the Source Code

Begin by cloning the GoogleTest repository which includes GoogleMock as a subdirectory:

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
```

The repository combines both GoogleTest and GoogleMock sources, allowing you to build both with a single CMake invocation.

---

## 3. Configuring the Build with CMake

Create a separate directory to hold the build files and configure the build system:

```bash
mkdir build
cd build
cmake ..
```

This generates native build files for your platform. By default, both GoogleTest and GoogleMock will be built.

### Optional CMake Flags

- To **disable** building GoogleMock (if you only need GoogleTest):

  ```bash
  cmake .. -DBUILD_GMOCK=OFF
  ```

- To **enable** building the internal GoogleMock or GoogleTest tests (not needed for most users):

  ```bash
  cmake .. -Dgmock_build_tests=ON -Dgtest_build_tests=ON
  ```

- On **Windows**, to force shared CRT linkage (resolves runtime conflicts):

  ```bash
  cmake .. -Dgtest_force_shared_crt=ON
  ```

<Tip>
This configuration step detects your compiler, linkers, and threading capabilities (e.g., pthread detection) automatically.
</Tip>

---

## 4. Building the Libraries

With the configuration complete, build the project:

### On Unix-like systems (Linux/macOS):

```bash
make
```

### With Ninja generator:

```bash
ninja
```

### On Windows (Visual Studio):

Open the generated `.sln` solution file and build from the IDE or use MSBuild on the command line.

### Expected outcome:

- Static libraries `libgtest.a`, `libgmock.a` (or equivalent `.lib` on Windows) are built.
- Optional `gtest_main` and `gmock_main` libraries with main() for standalone test executables.

<Tip>
If you want shared libraries (DLLs), enable `BUILD_SHARED_LIBS` option when running CMake:

```bash
cmake .. -DBUILD_SHARED_LIBS=ON
```

Note: Building shared libraries is optional and requires setting appropriate flags.
</Tip>

---

## 5. Installing the Libraries

If you have administrative privileges and want to install the built libraries and headers system-wide (default install prefix is `/usr/local`):

```bash
sudo make install
```

Or specify a custom prefix during configuration:

```bash
cmake .. -DCMAKE_INSTALL_PREFIX=/your/custom/path
make
make install
```

Installation will place headers, libraries, and pkg-config `.pc` files appropriately, making it easier for your projects to locate GoogleTest and GoogleMock.

---

## 6. Integrating GoogleTest and GoogleMock into Your Projects

You have two primary ways to consume GoogleTest and GoogleMock built via CMake:

### A. Linking Installed Libraries

Assuming GoogleTest/GoogleMock is installed, use CMake's `find_package` to locate them:

```cmake
find_package(GTest REQUIRED)
add_executable(your_test your_test.cc)
target_link_libraries(your_test PRIVATE GTest::gtest_main GTest::gmock)
```

This uses the installed library targets.

### B. Adding as a Subdirectory in Your Project

If you prefer building GoogleTest/GoogleMock alongside your code (to ensure compiler/linker consistency), add the source as a subdirectory:

```cmake
add_subdirectory(path/to/googletest)
add_executable(your_test your_test.cc)
target_link_libraries(your_test PRIVATE gtest_main gmock_main)
```

This approach naturally matches settings like compiler flags and ensures no version mismatch.

<Tip>
When linking to GoogleMock, you usually link either `gmock_main` (provides `main()`) or `gmock` (requires your own `main()`).
</Tip>

---

## 7. Running Your First Test Using CMake

Follow these steps to create, build, and run a simple test executable.

### Step 1: Create a Test Source File

Create `hello_test.cc` with the following content:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(42, 7 * 6);
}
```

### Step 2: Update Your Project's `CMakeLists.txt`

Add the following to your project directory:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Windows
FetchContent_MakeAvailable(googletest)

add_executable(hello_test hello_test.cc)
# Link with gtest_main provides main()
target_link_libraries(hello_test PRIVATE GTest::gtest_main GTest::gmock)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

### Step 3: Configure and Build

```bash
cmake -S . -B build
cmake --build build
```

### Step 4: Run Tests

```bash
cd build
ctest
```

Expected test output:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions .......   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

Congratulations, you have built and run your first test using GoogleTest and GoogleMock with CMake!

---

## 8. Useful Tips and Best Practices

- **Separate Build Directory:** Always use an out-of-source build directory (e.g., `build/`) to keep your source tree clean.

- **C++17 is Required:** Ensure your compiler supports C++17 or later, as GoogleTest needs modern features.

- **Thread Support:** GoogleTest detects and uses pthreads automatically; no manual flags are needed in most cases.

- **Windows Runtime Linking:** If you encounter runtime conflicts on Windows, enable `gtest_force_shared_crt`.

- **Controlling Shared Vs Static:** Use standard CMake variable `BUILD_SHARED_LIBS`.

- **Pkg-config Integration:** If using pkg-config, ensure environment variables like `PKG_CONFIG_PATH` include the path to the installed `.pc` files.

---

## 9. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting GoogleTest and GoogleMock Build Issues">
<Accordion title="CMake Fails to Find GoogleTest or GoogleMock">
This usually means the libraries are not installed or the CMake `find_package` paths are not set correctly.

**Solution:**

- Confirm you have installed GoogleTest/GoogleMock.
- Set `CMAKE_PREFIX_PATH` or use `FetchContent` to include GoogleTest sources directly.
- Verify environment variables like `PKG_CONFIG_PATH` for pkg-config-based discovery.
</Accordion>
<Accordion title="Compiler Does Not Support C++17">
Errors related to C++ features indicate insufficient compiler support.

**Solution:**

- Upgrade to a compiler version supporting C++17 (e.g., GCC 7+, Clang 5+, MSVC 2017+).
- Explicitly specify C++ standard in your project, for example:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```
</Accordion>
<Accordion title="Linker Errors about pthread or threading">
GoogleTest requires pthread support on POSIX platforms.

**Solution:**

- Ensure that CMake detected `Threads` correctly (look at CMake output).
- Add `-pthread` flags manually if needed.
- Use the bundled CMake configuration which sets threading correctly.
</Accordion>
<Accordion title="Runtime Library Mismatches on Windows">
Conflicts between DLL and static CRTs cause linker or runtime errors.

**Solution:**

- Set `-Dgtest_force_shared_crt=ON` in your CMake configuration.
- Ensure your project and GoogleTest link against compatible runtimes.
</Accordion>
</AccordionGroup>

---

## 10. Next Steps

- Explore writing your own tests using [GoogleTest Primer](../primer.md).
- Experiment with mock objects using GoogleMock features as covered in the [Mocking API Reference](/api-reference/core-apis/mocking).
- Review platform-specific considerations in [Supported Platforms & Requirements](/overview/integration-ecosystem/supported-platforms).
- Consult the [Quickstart: Building with CMake](../guides/getting-started/quickstart-cmake.md) for a hands-on tutorial.

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [Official CMake Documentation](https://cmake.org/cmake/help/latest/)
- [GoogleTest CMakeLists.txt source](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [GoogleMock CMakeLists.txt source](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [Pkg-config usage with GoogleTest](docs/pkgconfig.md)
- [Quickstart with CMake Guide](../guides/getting-started/quickstart-cmake.md)

---

By following these instructions, you will have a reliable, maintainable setup of GoogleTest and GoogleMock using CMake, enabling efficient unit testing in your C++ projects.