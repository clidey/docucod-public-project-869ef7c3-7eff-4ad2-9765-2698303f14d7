---
title: "Writing and Running Your First Test"
description: "Leads users through creating, building, and executing a minimal C++ test case using GoogleTest. Covers both standard and mocking test cases to showcase immediate value and ease of use."
---

# Writing and Running Your First Test

This guide leads you step-by-step through creating, building, and executing your very first minimal C++ test case using GoogleTest. You will learn how to write both a standard test and a mocking test case, illustrating GoogleTest's ease of use and immediate value.

---

## 1. Writing Your First Standard Test

GoogleTest simplifies testing by letting you write straightforward test functions grouped into test suites.

### Step 1: Include the Header

Begin your test file by including the GoogleTest header.

```cpp
#include <gtest/gtest.h>
```

### Step 2: Define a Test with `TEST()` Macro

Use the `TEST()` macro to define a test case. The two parameters are: 
- The **test suite name**: a logical grouping of tests for related functionality.
- The **test name**: descriptive for the specific test.

Both names should be valid C++ identifiers without underscores.

Example - testing a simple `Factorial` function:

```cpp
// Function under test
int Factorial(int n);

// Tests factorial of 0
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

// Tests factorial of positive inputs
TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(8), 40320);
}
```

### Step 3: Understand Assertions

Assertions like `EXPECT_EQ` compare actual results to expected values:
- `EXPECT_*` continue running the test after failure (recommended).
- `ASSERT_*` halt the current test if they fail.

Example:

```cpp
EXPECT_EQ(Factorial(3), 6);
ASSERT_GT(Factorial(3), 0); // Checks greater than zero before continuing
```

### Step 4: Write a main() or Link with `gtest_main`

Most users will link with the `gtest_main` library, which provides a suitable `main()` function. If you need a custom `main()`, follow this pattern:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

The `InitGoogleTest()` function parses GoogleTest flags from the command line.

### Step 5: Build the Test

Compile your test with the GoogleTest libraries linked. For example, using `g++`:

```bash
g++ -std=c++17 your_test.cc -lgtest -lgtest_main -pthread -o your_test
```

### Step 6: Run the Test Suite

Execute your test binary:

```bash
./your_test
```

You will see output summarizing which tests passed, failed, or were skipped.

---

## 2. Writing Your First Mocking Test

GoogleTest includes GoogleMock, a powerful mocking framework integrated and ready to use.

### Step 1: Include GoogleMock Header

Begin your test file with:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>
```

### Step 2: Define a Mock Class

Create a class that mocks the interface or class you want to test. Use the `MOCK_METHOD` macro inside the public section.

Example: Mocking a simple `Foo` interface:

```cpp
class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetValue(int x) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (int x), (override));
};
```

### Step 3: Set Expectations with `EXPECT_CALL`

Before exercising your code under test, specify which mock methods you expect to be called, with what arguments, and how often.

Example:

```cpp
using ::testing::Return;

TEST(MockExample, ReturnsExpectedValue) {
  MockFoo mock;
  EXPECT_CALL(mock, GetValue(5)).WillOnce(Return(42));

  int result = mock.GetValue(5);
  EXPECT_EQ(result, 42);
}
```

This test expects `GetValue(5)` to be called once, and returns 42.

### Step 4: Build and Run the Mock Test

Compile as before, linking with GoogleMock and GoogleTest:

```bash
g++ -std=c++17 your_mock_test.cc -lgmock -lgtest -pthread -o your_mock_test
```

Run it:

```bash
./your_mock_test
```

GoogleMock verifies that all expectations are met at test completion.

---

## 3. Understanding the Test Execution Flow

- `testing::InitGoogleTest()` (or `InitGoogleMock()`) initializes the framework and parses command-line flags.
- `RUN_ALL_TESTS()` runs all registered tests.
- Tests are grouped into test suites (or fixtures).
- Each test runs independently with fresh setup.
- Failures, passed tests, and skipped tests are reported clearly.

## 4. Tips and Best Practices

- Use `EXPECT_*` assertions unless failure should halt the current test.
- Group related tests in the same test suite for clarity.
- Name test suites and tests clearly, avoiding underscores.
- Use test fixtures (`TEST_F`) when multiple tests share setup.
- Use mocking only where interaction verification is necessary.
- Link with `gtest_main` or `gmock_main` to avoid writing main explicitly.
- Always return the result of `RUN_ALL_TESTS()` from `main()`.

## 5. Troubleshooting Common Issues

<AccordionGroup title="Common Pitfalls">
<Accordion title="Test Not Running">
Ensure your main calls `RUN_ALL_TESTS()` after initializing GoogleTest.
Also, check the test names follow identifier rules and linking is correct.
</Accordion>
<Accordion title="Linker Errors">
Make sure you link against both `gtest` and `gtest_main` (or `gmock` and `gmock_main` if using mocking) and link with `-pthread` if required.
</Accordion>
<Accordion title="Mock Expectations Not Met">
Verify that expected method calls match actual calls. If a call is missing or extra, GoogleMock will report errors.
</Accordion>
</AccordionGroup>

## 6. Next Steps

After successfully writing and running your first tests, explore these related topics:

- [Test Fixtures: Using Shared Setup for Multiple Tests](/guides/getting-started/writing-your-first-tests)
- [Mocking Concepts and Advanced Features](/guides/mocking-techniques/mock-classes-expectations)
- [Assertions Reference for detailed validation macros](/api-reference/core-testing-apis/assertions)
- [Running Tests with Filters and Flags](/advanced.md#running-a-subset-of-the-tests)

---

## Appendix: Minimal Complete Example

```cpp
#include <gtest/gtest.h>

int Factorial(int n) {
  return (n <= 1) ? 1 : n * Factorial(n - 1);
}

TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Run this to see GoogleTest in action.

---

## Appendix: Minimal Mock Example

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetValue(int x) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (int x), (override));
};

TEST(MockExample, ReturnsExpectedValue) {
  MockFoo mock;
  EXPECT_CALL(mock, GetValue(5)).WillOnce(Return(42));

  EXPECT_EQ(mock.GetValue(5), 42);
}

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This example shows mock setup and verifies the behavior.

---

For further information, consult related documentation sections linked below.

---

<Source url="https://github.com/google/googletest" paths={[{"path":"docs/primer.md","range":"1-120"},{"path":"docs/reference/testing.md","range":"1-300"},{"path":"docs/reference/mocking.md","range":"1-300"},{"path":"googlemock/src/gmock_main.cc","range":"1-65"}]} />
