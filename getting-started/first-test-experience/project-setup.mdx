---
title: "Project Setup & Configuration"
description: "Step-by-step instructions for configuring your project to link against GoogleTest/GoogleMock. Covers how to include headers, organize source files, and prepare your build files for testing."
---

# Project Setup & Configuration

Configure your C++ project to use GoogleTest and GoogleMock by linking the necessary headers, source files, and libraries. This guide walks you through including GoogleTest/GoogleMock in your build environment, arranging source files, and preparing your build files for effective testing.

---

## 1. Preparing Your Project to Use GoogleTest and GoogleMock

GoogleTest (gtest) and GoogleMock (gmock) require your build system to locate their headers and libraries correctly. Depending on your build environment, the setup differs slightly but follows the same core principles.

### 1.1 Organizing Source and Header Files

- **Headers:** Include GoogleTest headers using `#include <gtest/gtest.h>` and GoogleMock headers with `#include <gmock/gmock.h>` where mocks are needed.
- **Source files:** You do not need to directly compile or add GoogleTest or GoogleMock source files to your project manually if you link pre-built libraries. However, if embedding sources (see below), you will need to add them accordingly.

### 1.2 Including GoogleTest/GoogleMock in Your Build

There are two common ways to include GoogleTest and GoogleMock in your project:

- **Linking Installed Libraries:** If you have installed GoogleTest/GoogleMock system-wide (for example, via package managers or after `make install`), use your build system's `find_package` or equivalent to find and link against `gtest` and `gmock` libraries.
- **Building from Source Within Your Project:** You can add GoogleTest/GoogleMock source code as a subdirectory in your build system (such as CMake) and build and link them alongside your project. This ensures consistent compiler and linker settings.

---

## 2. Integrating GoogleTest and GoogleMock with CMake

GoogleTest provides comprehensive CMake support, making integration straightforward.

### 2.1 Standalone GoogleTest Build Example

To build GoogleTest and GoogleMock independently:

```bash
# Clone the repository with a specific tag for versioning
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
mkdir build
cd build
# Generate build files including GoogleMock
cmake ..
# Build the project (on Linux/macOS)
make
# (Optional) Install globally, requires admin privileges
sudo make install
```

- To build only GoogleTest (without GoogleMock), use:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

On Windows, use Visual Studio to open the generated solution (`.sln`) in the build directory and build the projects.

---

### 2.2 Incorporating GoogleTest into Your CMake Project

To add GoogleTest/GoogleMock to your existing CMake project, use one of these approaches:

#### 2.2.1 Use Installed GoogleTest

If GoogleTest is installed system-wide or available via package managers:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test test.cpp)
target_link_libraries(your_test GTest::gtest_main GTest::gmock_main)
add_test(NAME your_test COMMAND your_test)
```

This method is simple but depends on external installation.

#### 2.2.2 Download and Embed GoogleTest at Configure Time

Use CMake's `FetchContent` to automatically download and build GoogleTest alongside your project:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Windows, ensure runtime settings compatibility
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(your_test test.cpp)
target_link_libraries(your_test gtest_main gmock_main)
add_test(NAME your_test COMMAND your_test)
```

**Requirements:** CMake version 3.14 or higher is needed for `FetchContent_MakeAvailable()`.

---

### 2.3 Handling Compiler Settings

- Make sure your project and GoogleTest/GoogleMock use the same *C++ standard*, minimally C++17.

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- On Windows with Visual Studio, to resolve runtime library mismatches between dynamic and static runtimes, set:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This ensures GoogleTest uses the dynamic C runtime to match your project.

---

## 3. Linking and Including Headers in Your Source Files

### 3.1 Including Headers

- For writing test cases, include:

```cpp
#include <gtest/gtest.h>
```

- For writing mocks, additionally include:

```cpp
#include <gmock/gmock.h>
```

Use these headers in your test files to access GoogleTest and GoogleMock APIs.

### 3.2 Linking Libraries

Ensure your test executable links against the correct libraries:

- `gtest` or `gtest_main` for GoogleTest
- `gmock` or `gmock_main` for GoogleMock including a main function

Use `gtest_main` or `gmock_main` to avoid writing your own `main()` function, as they provide an entry point that initializes GoogleTest and runs all tests.

Example linking:

```cmake
target_link_libraries(your_test gtest_main gmock_main)
```

---

## 4. Organizing Your Tests

- Place your test source files in a dedicated `tests/` directory or similar.
- Name test files clearly, e.g., `example_test.cpp`.
- Use `TEST()` macros for simple tests and `TEST_F()` with test fixtures for tests sharing common setup.

### Sample Test File (example_test.cpp)

```cpp
#include <gtest/gtest.h>

TEST(SampleTestSuite, SampleTest) {
  EXPECT_EQ(1 + 1, 2);
}
```

This test executable can be built and linked as shown above.

---

## 5. Writing Your First Test Executable

Create a `CMakeLists.txt` for your test executable:

```cmake
add_executable(example_test example_test.cpp)

# Link with gtest_main and gmock_main to get main() for free
target_link_libraries(example_test gtest_main gmock_main)

# Enable testing in CMake
enable_testing()
add_test(NAME example_test COMMAND example_test)
```

Build your entire project, then run:

```bash
./example_test
```

Output will show GoogleTest test results.

---

## 6. Troubleshooting Common Setup Issues

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Linker Errors (Undefined References)">
If you encounter linker errors related to GoogleTest or GoogleMock symbols, verify:

- Correct linking against `gtest`, `gmock`, or their `_main` variants.
- The libraries are built with the same C++ standard and runtime settings.
- On Windows, `gtest_force_shared_crt` is set if using dynamic runtimes.
</Accordion>
<Accordion title="Missing Headers or Cannot Find gtest/gtest.h">
- Confirm GoogleTest include directories are added to include paths.
- If using CMake's `find_package`, ensure GoogleTest is installed or added as a subproject.
- Check for typos in include statements.
</Accordion>
<Accordion title="Tests Not Running or No Tests Found">
- Ensure `RUN_ALL_TESTS()` is called in your `main()` or you link with `gtest_main` / `gmock_main`.
- Confirm test files are part of the build and linked executable.
- Check that tests are defined with `TEST()` or `TEST_F()` macros properly.
</Accordion>
<Accordion title="C++ Standard Compatibility Issues">
- GoogleTest requires at least C++17.
- Set `CMAKE_CXX_STANDARD` to 17 or higher.
- Ensure your compiler supports C++17.
</Accordion>
</AccordionGroup>

---

## 7. Summary

By integrating GoogleTest and GoogleMock as shown:

- You ensure repeatable, organized, and maintainable tests.
- You avoid runtime and linking mismatches with proper CMake setup.
- You write, build, and run test executables seamlessly with minimal configuration.

For detailed guidance on writing tests or mocks and advanced usage, consult other sections of the documentation.

---

## Additional Resources

For more detailed installation and setup guidance, visit:

- [Installing on Linux/macOS](https://github.com/google/googletest/tree/main/getting-started/installation-guides/linux-macos-install)
- [Installing on Windows](https://github.com/google/googletest/tree/main/getting-started/installation-guides/windows-install)
- [Using Bazel for Build & Test](https://github.com/google/googletest/tree/main/getting-started/installation-guides/bazel-integration)
- [GoogleTest Primer](https://github.com/google/googletest/tree/main/docs/primer.md)

Explore guides for writing your first test and advanced mocking techniques to fully unleash the power of GoogleTest and GoogleMock.

---

<Check>
Remember: Your build system controls how GoogleTest/GoogleMock headers and libraries are linked. Tailor the instructions above to your environment, and always ensure consistency in compiler settings across your project and dependencies.
</Check>

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googletest/README.md", "range": "1-147"}, {"path": "googlemock/CMakeLists.txt", "range": "1-160"}]} />
