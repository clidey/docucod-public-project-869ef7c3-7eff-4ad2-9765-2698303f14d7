---
title: "Writing Your First Test"
description: "Follow a concise walkthrough to create your first basic unit test using GoogleTest and extend it with GoogleMock for mocking scenarios. Understand how to write, organize, and name tests for best results."
---

# Writing Your First Test with GoogleTest and GoogleMock

Welcome to a practical guide designed to get you writing your very first test using GoogleTest. This walkthrough will take you through the essentials of creating a basic unit test, then extend to mocking scenarios with GoogleMock. By the end, you'll understand how to effectively write, organize, and name your tests to achieve clear, maintainable, and actionable tests in your C++ project.

---

## 1. Understanding What You Want to Achieve

Before diving into code, think about what a test does:

- It verifies that a piece of your code behaves as expected.
- For unit tests, this often means calling a function or method and asserting the correctness of the output or side effects.
- When parts of your code depend on other components (e.g., external services or complex dependencies), mocking helps simulate those dependencies.

GoogleTest provides a rich framework for writing such tests, while GoogleMock enables you to create mock objects for simulating interactions.

---

## 2. Writing Your First Basic Unit Test with GoogleTest

### Step 1: Create a Test Function

Use the `TEST` macro to define a test case. Tests are grouped into **test suites** for related tests. Here's a minimal example:

```cpp
#include <gtest/gtest.h>

// A simple function to test
int Add(int a, int b) {
  return a + b;
}

// Define a test in a test suite named MathTest
TEST(MathTest, AddsTwoNumbers) {
  EXPECT_EQ(Add(2, 3), 5);  // Checks that Add(2, 3) == 5
}
```

- `MathTest` is the test suite name.
- `AddsTwoNumbers` is the specific test case.

### Step 2: Using Assertions

- `EXPECT_EQ` asserts expected equality but allows test to continue if it fails.
- Use assertions to verify conditions; if verification fails, the test reports the issue clearly.

### Step 3: Naming Conventions

- Name your test suites after the components or classes you are testing.
- Test names should describe the behavior under test.
- Avoid underscores in suite and test names for consistency.

<Callout>
**Tip:** For better organization, group logically related tests into a single test suite. This improves clarity and maintainability.
</Callout>

---

## 3. Organizing Tests Using Test Fixtures

If you need to share setup and teardown code or common data across multiple tests, use a test fixture.

### Step 1: Define a Fixture Class

Derive your fixture class from `testing::Test`:

```cpp
class CalculatorTest : public testing::Test {
 protected:
  void SetUp() override {
    calculator_initialized = true;
  }

  void TearDown() override {
    // Clean up resources if needed
  }

  bool calculator_initialized = false;
};
```

### Step 2: Write Tests Using the Fixture

Use `TEST_F` macro to associate tests with the fixture:

```cpp
TEST_F(CalculatorTest, InitializesCorrectly) {
  EXPECT_TRUE(calculator_initialized);
}
```

Each test gets a fresh fixture instance.

---

## 4. Extending with GoogleMock for Mocking Scenarios

When your code depends on interfaces or components that you don’t want to invoke in tests (like databases, networks), GoogleMock enables you to simulate their behavior.

### Step 1: Define an Interface to Mock

Suppose you have:

```cpp
class Database {
 public:
  virtual ~Database() = default;
  virtual int GetData(int id) = 0;
};
```

### Step 2: Create a Mock Class

Derive a mock from this interface:

```cpp
#include <gmock/gmock.h>

class MockDatabase : public Database {
 public:
  MOCK_METHOD(int, GetData, (int id), (override));
};
```

### Step 3: Write a Test Using the Mock

```cpp
TEST(DatabaseTest, ReturnsExpectedData) {
  MockDatabase mock_db;

  // Set expectation: when GetData(1) is called, return 42
  EXPECT_CALL(mock_db, GetData(1)).WillOnce(testing::Return(42));

  int value = mock_db.GetData(1);
  EXPECT_EQ(value, 42);
}
```

This approach isolates the component under test and controls dependent behavior.

---

## 5. Writing Death Tests for Verification of Program Termination

GoogleTest supports *death tests* to verify that code correctly terminates under certain conditions (e.g., invalid parameters).

### Step 1: Write a Death Test

Use the `ASSERT_DEATH` or `EXPECT_DEATH` macros:

```cpp
void CrashIfNegative(int x) {
  if (x < 0) {
    abort();  // Terminates the program
  }
}

TEST(CrashTest, CrashesOnNegativeInput) {
  ASSERT_DEATH(CrashIfNegative(-1), "");  // Expect program to die
}
```

### Step 2: Understand Macro Usage

- `ASSERT_DEATH(statement, matcher)`: Fails fatally if `statement` doesn't cause process termination and if stderr matches `matcher`.
- `EXPECT_DEATH`: Same but allows continuing other tests.

### Best Practices
- Name test suites with suffix `DeathTest` when including death tests.
- Avoid placing multiple death tests on the same source line.
- Be aware that code inside death test runs in a subprocess, so side effects don't propagate.

<Warning>
Avoid freeing memory inside death tests as the memory release might not be observable.
</Warning>

---

## 6. Organizing and Naming Tests for Best Results

- Use PascalCase for test suite and test names (e.g., `MathTest`, `ReturnsZeroOnNull`).
- Keep test names concise but descriptive of the expected behavior.
- For death tests, append `DeathTest` to the test suite's name to clarify intent.
- Separate tests logically: write small focused tests that verify one behavior.

<Callout>
**Best Practice:** If you share a fixture between normal and death tests, consider aliasing the fixture for the death tests to distinguish between normal and death test cases.
</Callout>

Example:

```cpp
class FooTest : public testing::Test { ... };
using FooDeathTest = FooTest;

TEST_F(FooTest, NormalBehavior) { ... }
TEST_F(FooDeathTest, DeathBehavior) { ... }
```

---

## 7. Running Your Tests

- Compile your test using GoogleTest and GoogleMock libraries.
- Call `RUN_ALL_TESTS()` in your `main()` after initializing GoogleTest (`InitGoogleTest`).

Example main:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Run your test binary; GoogleTest will discover and execute all tests.

---

## 8. Tips and Common Pitfalls

- Always include `<gtest/gtest.h>` and `<gmock/gmock.h>` when using GoogleMock.
- Assert with `ASSERT_*` macros if continuing after failure makes no sense (like null pointer dereference).
- Streaming custom messages after assertions using `<<` improves debugging clarity.
- Death tests spawn sub-processes; avoid code with side effects that you expect visible outside those sub-processes.
- For death tests, keep the regex simple and compatible with GoogleTest's supported syntax.

---

## 9. Summary

By following this guide you:

- Created your first unit test with GoogleTest.
- Learned how to organize tests using fixtures.
- Extended tests with mocks using GoogleMock.
- Understood the essentials of writing death tests.
- Adopted naming and organization best practices for scalable and maintainable tests.

Explore related documentation on [Advanced Assertions](../../docs/reference/assertions.md), [Mocking with GoogleMock](../../guides/advanced-testing-patterns/mocking-with-googlemock.md), and [Death Tests and Exception Handling](../../guides/advanced-testing-patterns/death-tests-and-exception-handling.md) for deepening your testing skills.

---

## References and Further Reading

- [GoogleTest Primer](../../docs/primer.md) – foundational concepts to get you started
- [Assertions Reference](../../docs/reference/assertions.md) – a detailed list of assertion macros
- [Installation Methods](../../getting-started/setup-and-installation/installation-methods.md) – setting up GoogleTest and GoogleMock in your project
- [GoogleMock Documentation](../../guides/advanced-testing-patterns/mocking-with-googlemock.md) – advanced mocking patterns
- [Death Tests](../../docs/advanced.md#death-tests) – comprehensive guide on death tests usage and styles

---  

Happy Testing!