---
title: "Initial Configuration"
description: "Configure your project to make use of GoogleTest and GoogleMock by linking the right libraries and including required headers. Understand best practices for test directory layout and integration into your build process."
---

# Initial Configuration

Configure your project to prepare for writing and running tests using GoogleTest and GoogleMock. This guide walks you through including the required headers, linking against necessary libraries, and organizing your test directories effectively to seamlessly integrate testing into your build process.

---

## 1. Including GoogleTest and GoogleMock

Before you start writing tests, ensure your source files include the proper headers:

- For **GoogleTest** assertions and basic test infrastructure, include:

  ```cpp
  #include <gtest/gtest.h>
  ```

- For **GoogleMock** mocking functionalities and macros, include:

  ```cpp
  #include <gmock/gmock.h>
  ```

> Note: Including `<gmock/gmock.h>` automatically brings in `<gtest/gtest.h>`, so including only `<gmock/gmock.h>` suffices for tests using mocks.


## 2. Linking the Correct Libraries

To successfully build and run tests using GoogleTest and GoogleMock, link your test binaries against the relevant libraries.

### Typical libraries:

- `gtest` (GoogleTest core library)
- `gtest_main` (optional: provides `main()` function for test programs)
- `gmock` (GoogleMock library)
- `gmock_main` (optional: provides `main()` function when using mocks)

### Best practice:

- If you write tests using only GoogleTest (no mocks), link against `gtest` and `gtest_main`.
- If you use mocks, link against `gmock` and `gmock_main` (which also link `gtest` internally).

### Example using CMake:

```cmake
add_executable(my_tests test/foo_test.cpp)
target_link_libraries(my_tests gmock_main)  # Automatically links gmock and gtest
```

### If your build setup is manual or non-CMake:

Make sure that the include paths point to GoogleTest/GoogleMock headers and that the compiler links the corresponding static or shared libraries.


## 3. Organizing Your Test Directory Layout

Proper layout of your test directories helps maintain clarity and encourages best practices.

### Recommended structure:

```
project-root/
  include/          # Project public headers
  src/              # Source code files
  tests/            # Test sources
    mock/           # Mock class definitions
    unit/           # Unit tests
    integration/    # Integration tests
    CMakeLists.txt  # Test-specific build config
```

- Place mock class definitions in the `mock/` directory allowing easier reuse and isolation from test logic.
- Separate unit and integration tests clearly.
- Keep test-specific build files here to isolate from production builds.


## 4. Integrating Tests Into Your Build System

GoogleTest and GoogleMock integrate well with various build tools. Common approaches include:

### Using CMake

- Find and link GoogleTest and GoogleMock via `find_package(GTest REQUIRED)` or your custom integration paths.
- Declare test executables with `add_executable()`.
- Link with `target_link_libraries()` pointing to `GTest::gtest_main` or `gmock_main`.
- Use `enable_testing()` and `add_test()` commands to integrate with `ctest`.

### Using Bazel

- Use rules provided by GoogleTest in Bazel workspace.
- Declare `cc_test` targets with the necessary dependencies.

Provide clear `CMakeLists.txt` or build instructions so that tests naturally integrate and are run as part of your CI process.


## 5. Best Practices

- Always add the suffix `_test` or place your test sources under a designated `tests` directory.
- Use consistent naming for mocks, for example, prefix with `Mock` such as `MockFoo`.
- Register your mock classes and tests in modular fashion.
- Use `ON_CALL` for defining default mock behaviors and minimize `EXPECT_CALL` usage to what your test verifies directly.


## 6. Troubleshooting Common Configuration Issues

### Missing symbols during linking

Make sure you link against `gmock` or `gmock_main` when using mocks, and `gtest` or `gtest_main` otherwise.

### Header files not found

Confirm that your compiler include paths point to the right GoogleTest/GoogleMock directories.

### Runtime errors with mocks

Verify virtual destructors exist on classes you mock and that expectations are set before invoking mock methods.


## 7. Sample Minimal Setup

Hereâ€™s a minimal example showing inclusion and linking for a mock test:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Foo {
public:
    virtual ~Foo() {}
    virtual int Bar(int x) = 0;
};

class MockFoo : public Foo {
public:
    MOCK_METHOD(int, Bar, (int x), (override));
};

TEST(FooTest, ReturnsExpectedValue) {
    MockFoo foo;
    EXPECT_CALL(foo, Bar(5)).WillOnce(::testing::Return(42));
    EXPECT_EQ(foo.Bar(5), 42);
}
```

Build linking against `gmock_main` to get the main function and necessary mocks.


---

For full build integration details, see the [Integrating with CMake, Bazel, and Other Build Tools](https://google.github.io/googletest/guides/integration-and-best-practices/build-integration) guide.


---

## Additional References

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) for writing tests
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) to understand mock basics
- [Mocking Your First Class or Function](https://google.github.io/googletest/guides/getting-started/first-mock.html) for an onboarding to mocks
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for details on mocking syntax and features
- [Troubleshooting Common Issues](https://google.github.io/googletest/getting-started/troubleshooting/common-issues.html) if you encounter build or runtime problems
