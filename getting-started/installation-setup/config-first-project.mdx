---
title: "Configuring Your First Test Project"
description: "Guides users through setting up a new project with GoogleTest and GoogleMock, including directory layout, necessary configuration files, and integrating the framework with existing code. Includes code snippets to demonstrate basic setup."
---

# Configuring Your First Test Project with GoogleTest and GoogleMock

This guide walks you through setting up a new C++ project using GoogleTest and GoogleMock frameworks. It covers how to organize your project directory, prepare essential configuration files, and integrate the testing frameworks with your existing codebase, including minimal working examples.

---

## 1. Project Directory Layout

Establishing a clear and scalable directory structure is a crucial first step for effective testing. Below is a recommended layout:

```
/my_project
  ├── include/           # Public headers of your project
  ├── src/               # Source files
  ├── tests/             # Test source files
  │   ├── mocks/         # Mock class definitions
  │   └── *.cc           # Test implementations
  ├── CMakeLists.txt     # Build configuration
  └── README.md          # Project overview
```

**Tips:**
- Organize mock classes within a dedicated `mocks/` subdirectory under tests.
- Keep test source files separate from production code to avoid accidental linkage.

---

## 2. Preparing Your Build System

GoogleTest and GoogleMock are designed to integrate seamlessly with CMake, the recommended build system. Follow these steps to configure your project build:

### Step 2.1: Import GoogleTest and GoogleMock

Add the following to your top-level `CMakeLists.txt` to fetch and link GoogleTest and GoogleMock:

```cmake
cmake_minimum_required(VERSION 3.16)
project(my_project CXX)

# Enable testing support
enable_testing()

# Download and add GoogleTest (which includes GoogleMock)
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.16.0.zip
)
FetchContent_MakeAvailable(googletest)

# Add your executable
add_executable(my_app src/main.cc)
target_link_libraries(my_app PRIVATE gtest_main gmock_main)

# Add test executable
add_executable(my_tests tests/my_tests.cc)
target_link_libraries(my_tests PRIVATE gtest gmock pthread)

# Register tests
include(GoogleTest)
gtest_discover_tests(my_tests)
```

### Step 2.2: Basic CMake Test Configuration

- Ensure you link with `gtest_main` or `gmock_main` to get the main test entry point.
- Link `pthread` on Unix-like systems if using threads (GoogleTest uses threads internally).
- Use `gtest_discover_tests()` for automatic test discovery.

---

## 3. Writing Your First Test

Create a simple test source file, e.g., `tests/my_tests.cc`:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

// A simple function to test
int Add(int a, int b) {
  return a + b;
}

TEST(MathTest, AddsTwoNumbers) {
  EXPECT_EQ(Add(2, 3), 5);
}

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

**Success Criteria:** Running your tests executable should output:

```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from MathTest
[ RUN      ] MathTest.AddsTwoNumbers
[       OK ] MathTest.AddsTwoNumbers (0 ms)
[----------] 1 test from MathTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

---

## 4. Integrating GoogleMock: Creating and Using a Mock Class

GoogleMock allows you to define mock classes that simulate dependencies and enable behavior verification.

### Step 4.1: Define a Mock Class

Example interface and mock for a simple database:

```cpp
#include <gmock/gmock.h>

class Database {
 public:
  virtual ~Database() = default;
  virtual bool Connect(const std::string& url) = 0;
  virtual int GetRecordCount() const = 0;
};

class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), (override));
  MOCK_METHOD(int, GetRecordCount, (), (const, override));
};
```

### Step 4.2: Writing Tests Using the Mock

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Return;

TEST(DatabaseTest, ConnectsSuccessfully) {
  MockDatabase mock_db;

  EXPECT_CALL(mock_db, Connect("localhost"))
      .WillOnce(Return(true));
  EXPECT_CALL(mock_db, GetRecordCount())
      .WillRepeatedly(Return(42));

  // Your production function would use &mock_db here
  EXPECT_TRUE(mock_db.Connect("localhost"));
  EXPECT_EQ(mock_db.GetRecordCount(), 42);
}
```

---

## 5. Essential Configuration Files

### 5.1. CMakeLists.txt (Minimal Example)

```cmake
cmake_minimum_required(VERSION 3.16)
project(my_project)

enable_testing()

find_package(GTest REQUIRED)
include_directories(${GTEST_INCLUDE_DIRS})

add_executable(my_tests tests/my_tests.cc)
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock GTest::gtest_main pthread)

gtest_discover_tests(my_tests)
```

### 5.2. Headers and Sources

- Keep public headers in `include/` and private headers inside `src/` or alongside source files.
- Test files stay in `tests/` and should include GoogleTest and GoogleMock headers where needed.

---

## 6. Best Practices and Tips

- **Use Namespaces Clearly:** To simplify code, use `using ::testing::` for GoogleMock and GoogleTest symbols.
- **Separate Test Data:** Keep test input/output data separate from production code.
- **Suppress Noise:** Wrap mocks in `NiceMock<T>` to suppress warnings from uninteresting calls for cleaner test output.
- **Use `EXPECT_CALL` Judiciously:** Only specify expectations you intend to verify to avoid brittle tests.
- **Organize Mocks:** Place mock class definitions in logical places such as a dedicated `mocks/` folder.
- **Document Dependencies:** Make sure your build system detects and correctly links all dependencies.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Challenges and Solutions">
<Accordion title="Build Errors Related to GoogleTest Includes">
Ensure that GoogleTest and GoogleMock include directories are correctly set in your build system. Missing includes cause compilation failures.
</Accordion>
<Accordion title="Linker Errors During Test Executable Linking">
Link with correct targets such as `gtest_main`, `gmock_main`, and system `pthread` where applicable.
</Accordion>
<Accordion title="Run-time Test Discovery Fails or No Tests Run">
Verify that your `main()` function initializes GoogleTest with `::testing::InitGoogleTest(&argc, argv)` and calls `RUN_ALL_TESTS()`.
</Accordion>
</AccordionGroup>

<Tip>
If you encounter warnings about uninteresting mock calls, consider wrapping mocks with `NiceMock` to suppress these warnings, or explicitly add catch-all expectations with `EXPECT_CALL(mock, method(_)).Times(AnyNumber());`.
</Tip>

---

## 8. Next Steps

- Explore [Writing Your First Unit Test](/guides/getting-started/first-unit-test) to deepen your test authoring skills.
- Try [Creating Your First Mock Object](/guides/getting-started/first-mock) for hands-on experience with mocks.
- Review the [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) for recipes and patterns.

---

## References

- [GoogleTest Official Documentation](https://github.com/google/googletest)
- [GoogleMock Cheat Sheet](https://github.com/google/googletest/blob/main/docs/gmock_cheat_sheet.md)
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [GoogleTest Integration and Platform Support Guide](/overview/integration-and-getting-started/integration-points)

---

For detailed build configuration examples and advanced settings, refer also to the `CMakeLists.txt` files provided in the official GoogleMock repository under `googlemock` folder.

---

This concludes the essentials for configuring your first C++ test project with GoogleTest and GoogleMock. With these foundations, you can confidently build reliable tests and evolve your codebase with confidence.