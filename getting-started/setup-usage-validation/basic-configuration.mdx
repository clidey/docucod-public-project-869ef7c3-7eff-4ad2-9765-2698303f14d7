---
title: "Project Configuration and Test Discovery"
description: "Outline how to configure your project for testing: add dependencies, set up include paths, scaffold test source files, and use GoogleTest's test discovery features. Set the stage for highly maintainable and automatable tests."
---

# Project Configuration and Test Discovery

This guide walks you through configuring your C++ project to use GoogleTest and GoogleMock for testing. You'll learn how to add necessary dependencies, set up include paths, scaffold your first test source files, and leverage GoogleTest's automatic test discovery features. The goal is to help you establish a maintainable and automatable testing setup that integrates seamlessly into your development workflow.

---

## 1. Prerequisites and Setup

Before you begin configuring your project for testing, ensure the following prerequisites are met:

- **Compiler & Language Version**: Use a C++17-compatible compiler (e.g., MSVC 2015+, GCC 7+, Clang 5+).
- **Build System**: Prepare your build system to integrate GoogleTest and GoogleMock (Bazel, CMake, or other supported tools).
- **Source Tree Structure**: Organize your source and test files logically.
  
  Typically, test sources are placed in a separate directory (e.g., `/tests` or `/test`).

- **GoogleTest and GoogleMock Libraries**: Either have the libraries preinstalled on your system or include them as part of your project subtree or via package managers.


<Tip>
If you are using Bazel or CMake, refer to the official installation guides for setting up GoogleTest and GoogleMock in your environment before proceeding.
</Tip>

## 2. Adding GoogleTest & GoogleMock Dependencies

To configure your project to compile and link with GoogleTest and GoogleMock, perform these key steps:

### 2.1 Include Paths

Add GoogleTest and GoogleMock include directories to your compiler's search path.

For example, assuming the libraries are located under `/third_party/googletest/include`:

```shell
-I/third_party/googletest/include
```

Make sure both `gtest` and `gmock` headers are accessible.

### 2.2 Linker Configuration

Link against GoogleTest and GoogleMock libraries. This can be static or dynamic libraries.

Example with CMake targeting static libraries:

```cmake
find_package(GTest REQUIRED)

add_executable(my_test my_test.cc)
target_link_libraries(my_test GTest::gtest GTest::gmock GTest::gtest_main pthread)
```

For Bazel, add dependencies on `@com_github_google_googletest//:gmock_main` or `:gmock`.

### 2.3 Source Files Setup

Place your GoogleTest and GoogleMock test sources under your test directory, with `.cc` or `.cpp` extension.

Ensure source files include the appropriate headers:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

Your tests can now use the testing and mocking APIs.


<Warning>
Always use the matching library versions for GoogleTest and GoogleMock. Mismatched versions can cause link or run-time issues.
</Warning>

## 3. Scaffolding Your First Test Source File

Follow these steps to scaffold and verify your first test source file:

### Step 1: Create a Test Source File

E.g., `sample_test.cc` under your test directory.

### Step 2: Include GoogleTest and GoogleMock Headers

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

### Step 3: Write a Simple Test Case

```cpp
TEST(SampleTest, BasicAssertion) {
  EXPECT_EQ(1 + 1, 2);
}
```

### Step 4 (Optional): Define a Mock Class

If you want to test interactions, define a mock:

```cpp
class MockInterface {
 public:
  virtual ~MockInterface() = default;
  virtual int Foo(int x) = 0;
};

class MockFoo : public MockInterface {
 public:
  MOCK_METHOD(int, Foo, (int x), (override));
};
```

### Step 5: Write Expectations and Test Logic

```cpp
TEST(MockTest, UsesMock) {
  MockFoo mock;
  EXPECT_CALL(mock, Foo(5)).WillOnce(::testing::Return(10));
  EXPECT_EQ(mock.Foo(5), 10);
}
```

<Tip>
See the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick mock definitions.
</Tip>

## 4. Using GoogleTestâ€™s Test Discovery

### 4.1 Naming Conventions

GoogleTest automatically discovers tests based on:

- File extensions: `.cc`, `.cpp`, `.cxx`
- Test declarations via `TEST()` or `TEST_F()` macros

No explicit registration is needed.

### 4.2 Running Tests

Compile your test executable, then run it from the command line:

```bash
./my_test [--gtest_filter=...] [--gtest_shuffle] [--gtest_repeat=n]
```

The test runner will find all declared tests and run them.

### 4.3 Test Filters

Use `--gtest_filter` to select specific tests to run, e.g.

```bash
./my_test --gtest_filter=SampleTest.BasicAssertion
```

### 4.4 Automatic Initialization

In your `main()` function, initialize GoogleTest and GoogleMock:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This sets up everything required for running the tests.

<Check>
You can use the standard testing main from GoogleTest (`gtest_main`) if you do not want to write your own `main()`.
</Check>

## 5. Best Practices for Maintainable Test Configurations

- Use **`ON_CALL`** for setting default mock behavior, and **`EXPECT_CALL`** to enforce expectations.
- Avoid setting expectations after the mock methods have been called.
- Use **named mocks** and keep mock classes in dedicated headers to reuse mocks across tests.
- Use **sequences** or **partial ordering** for complex call order constraints.
- Regularly run tests with `--gtest_shuffle` to catch order-dependent errors.

<Tip>
If your tests generate warnings about "Uninteresting mock function call", consider using `NiceMock` to silence undesired warnings or add appropriate expectations.
</Tip>

## 6. Troubleshooting

### Problem: Tests are not discovered

- Verify the test source file uses correct extensions (`.cc`, `.cpp`).
- Confirm test cases are declared using `TEST()` or `TEST_F()` macros.
- Ensure `main()` calls `::testing::InitGoogleMock` and `RUN_ALL_TESTS()`.

### Problem: Linker errors for GoogleTest or GoogleMock symbols

- Confirm the linker can find and link against the GoogleTest and GoogleMock libraries.
- Check your library paths and library names.

### Problem: Unexpected warnings for uninteresting calls

- Add `EXPECT_CALL(mock, method).Times(AnyNumber())` for methods expected to be called with no checks.
- Use `NiceMock<MockClass>` wrapper to suppress warnings for uninteresting calls.

## 7. Example: Simple Test Setup

Here's a minimal example of project configuration and a test file:

```cpp
// sample_test.cc
#include <gtest/gtest.h>
#include <gmock/gmock.h>

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), ());
};

TEST(CalculatorTest, AddsNumbers) {
  MockCalculator calc;
  EXPECT_CALL(calc, Add(1, 2)).WillOnce(::testing::Return(3));
  EXPECT_EQ(calc.Add(1, 2), 3);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Your build system should compile `sample_test.cc` and link with GoogleTest and GoogleMock.

---

For more advanced test configuration and usage, please consult the official GoogleTest and GoogleMock documentation.

<Note>
Explore further topics such as Test Fixtures, Parameterized Tests, Mock Behaviors, and Advanced Matchers after the basic setup.
</Note>

---

## References

- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Writing and Running Your First Test](https://google.github.io/googletest/getting-started/writing-first-test.html)
- [Effective Mock Behaviors Guide](https://google.github.io/googletest/gmock_cook_book.html#The-Nice-the-Strict-and-the-Naggy)

---

## Navigation

For a guided start, visit:

- [System Requirements](https://google.github.io/googletest/getting-started/prerequisites-installation/system-requirements.html)
- [Installation with CMake](https://google.github.io/googletest/getting-started/prerequisites-installation/installation-cmake.html)
- [Writing and Running Your First Test](https://google.github.io/googletest/getting-started/setup-usage-validation/writing-first-test.html)
- [Quick Validation and Troubleshooting](https://google.github.io/googletest/getting-started/setup-usage-validation/quick-validation.html)

---

This page is part of the Getting Started > Setup, First Test, and Validation section.


<Source url="https://github.com/google/googletest" paths={[{"path": "docs/gmock_cheat_sheet.md", "range": "1-250"},{"path": "docs/reference/mocking.md", "range": "1-500"}]} />
