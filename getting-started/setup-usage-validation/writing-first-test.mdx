---
title: "Writing and Running Your First Test"
description: "Guide users in writing their initial unit test, compiling a simple test target, and running the test binary. Explain key test structure, typical entry points, and expectations for first-run output."
---

# Writing and Running Your First Test

Welcome to the initial step in using GoogleTest and GoogleMock: writing your first unit test. This guide walks you through creating a simple test, compiling it, and running it to observe the expected output. Along the way, you'll understand the key structure of a Google Test, how to write expectations on your mocks using Google Mock, and what to expect when your test runs successfully.

---

## 1. Understanding the Test Structure and Key Components

A typical Google Test consists of:

- **Test Case / Test Suite:** A named group of related tests.
- **Test:** A function that checks behavior or state.
- **Assertions:** Checks that determine whether a test passes or fails.
- **Mock Objects:** Fake classes that imitate real dependencies to verify interactions.

In GoogleMock, you use `EXPECT_CALL` to set expectations on mocked methods for how they are used by the code under test.

### Example Test Skeleton

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Return;
using ::testing::_;  // wildcard matcher

// An example dependency interface to be mocked
class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetValue(int x) = 0;
};

// The mock class generated using gMock
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (int x), (override));
};

// Code under test, using Foo
class Bar {
 public:
  explicit Bar(Foo* foo) : foo_(foo) {}

  int Compute(int x) {
    return foo_->GetValue(x) + 1;
  }

 private:
  Foo* foo_;
};

// Test
TEST(BarTest, ComputesCorrectly) {
  MockFoo mock_foo;

  // Expect GetValue to be called with any int argument, and return 10.
  EXPECT_CALL(mock_foo, GetValue(_))
      .WillOnce(Return(10));

  Bar bar(&mock_foo);

  EXPECT_EQ(bar.Compute(5), 11);  // (10 + 1)
}
```

This test demonstrates:

- Using `MOCK_METHOD` to define mocked interface methods.
- Setting expectations with `EXPECT_CALL` before exercising the code.
- Using matchers like `_` to accept any argument.
- Using `WillOnce(Return(value))` to define method result behaviors.
- Using `EXPECT_EQ` to assert expected results.

---

## 2. Writing Your First Test File

Follow these steps:

### Step 1: Create a New C++ Source File

Create a file named `first_test.cc` or similar in your test directory.

### Step 2: Include the Required Headers

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

### Step 3: Define or Include the Interface to Mock

If your code under test depends on interfaces (classes with virtual functions), define them or include their declarations. For example:

```cpp
class MyInterface {
 public:
  virtual ~MyInterface() = default;
  virtual int DoWork(int a) = 0;
};
```

### Step 4: Define the Mock Class

Create a mock class that inherits from the interface using `MOCK_METHOD`:

```cpp
class MockMyInterface : public MyInterface {
 public:
  MOCK_METHOD(int, DoWork, (int a), (override));
};
```

### Step 5: Write Your Test Case and Test

Write a `TEST` macro where you instantiate the mock, set expectations, invoke the code, and assert:

```cpp
TEST(MyInterfaceTest, DoWorkSimple) {
  MockMyInterface mock;

  EXPECT_CALL(mock, DoWork(5))
      .WillOnce(::testing::Return(42));

  // Call the mocked method.
  int result = mock.DoWork(5);

  EXPECT_EQ(result, 42);
}
```

---

## 3. Compiling the Test

### Prerequisites

- Ensure GoogleTest and GoogleMock are installed and built.
- Your compiler supports C++17 or later.

### Compilation Example Using G++

```bash
g++ -std=c++17 first_test.cc -I/path/to/googletest/include -L/path/to/googletest/lib -lgtest -lgmock -lpthread -o first_test
```

Adjust paths to where GoogleTest and GoogleMock headers and libraries are installed.

### Using CMake or Bazel

Refer to existing guides for configuring your project build files.

---

## 4. Running the Test Binary

After compiling, run the executable:

```bash
./first_test
```

### Expected Output

```
[==========] Running 1 test from 1 test case.
[----------] Global test environment set-up.
[----------] 1 test from MyInterfaceTest
[ RUN      ] MyInterfaceTest.DoWorkSimple
[       OK ] MyInterfaceTest.DoWorkSimple (0 ms)
[----------] 1 test from MyInterfaceTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test case ran. (0 ms total)
[  PASSED  ] 1 test.
```

This output verifies:

- The test case and test name are recognized.
- Test executed and passed correctly.
- Test runner messages confirming execution.

---

## 5. Understanding First-Run Output

- Successful tests end with `[ PASSED ]` message.
- Failed expectations or assertions print detailed messages specifying the assertion failure and source location.
- GoogleMock reports on mock function calls as they happen if verbosity flags are increased.

If your test fails unexpectedly:

- Check that you set your expectations before calling the mock methods.
- Ensure the matchers correspond to actual calls.
- Use `--gmock_verbose=info` when running to get detailed mock call traces.

---

## 6. Next Steps

- Explore more complex matcher expressions (e.g., `Gt(5)`, `NotNull()`).
- Use sequences to specify order of mock calls with `InSequence`.
- Use `ON_CALL` to set default mock method behaviors.
- Review the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for detailed reference.
- Learn about multi-argument matchers and custom actions.

---

## Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting First Tests">
<Accordion title="Linker errors about GoogleTest symbols">
Make sure you link with the `-lgtest` and `-lgmock` libraries.
Check compile and link paths.
</Accordion>
<Accordion title="Missing virtual destructor in interface">
GoogleMock requires the base interface to have a **virtual destructor**.
Add virtual destructor as:

```cpp
virtual ~InterfaceName() = default;
```
</Accordion>
<Accordion title="Mock methods not called as expected">
Verify your `EXPECT_CALL` uses correct argument matchers.
Use `--gmock_verbose=info` to see matching traces.
</Accordion>
<Accordion title="Compilation failing when mocking methods with commas in types">
Wrap return types or argument types containing commas in parentheses in `MOCK_METHOD`.
Example:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, (), (override));
```
</Accordion>
</AccordionGroup>

---

## References and Further Reading

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Beginner-friendly introduction.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Recipes and advanced uses.
- [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) - Quick reference.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) - Full API documentation.
- [Using Assertions and Matchers](https://google.github.io/googletest/guides/core-testing-workflows/using-assertions-and-matchers.html) - Test assert guidance.

---

This guide is your starting point to use GoogleTest and GoogleMock effectively. As you become comfortable with basics, you can dive into creating richer tests, mocking complex behavior, and structuring tests for maintainability and robustness.
