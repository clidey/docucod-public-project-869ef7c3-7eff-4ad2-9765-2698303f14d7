---
title: "Troubleshooting Common Issues"
description: "Find answers and solutions to frequently encountered issues, such as compiler errors, missing dependencies, and platform-specific quirks, to get back on track quickly."
---

# Troubleshooting Common Issues

Find answers and solutions to frequently encountered issues, such as compiler errors, missing dependencies, and platform-specific quirks, to get back on track quickly.

---

## Common Compiler Errors

Compiler errors can often halt progress early. Here's how to identify and quickly resolve them:

### Error: Commas in `MOCK_METHOD` Arguments

When using `MOCK_METHOD`, argument or return types containing commas (such as `std::pair` or `std::map`) may cause parsing errors.

**Symptom:** Compilation fails with cryptic errors near the `MOCK_METHOD` macro.

**Solution:**

- Wrap types that contain commas in parentheses. For example:

  ```cpp
  // Incorrect - causes compilation error
  MOCK_METHOD(std::pair<bool, int>, GetPair, ());
  MOCK_METHOD(bool, CheckMap, (std::map<int, double>, bool));

  // Correct - using parentheses to protect commas
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

- Alternatively, define a type alias to simplify the macro usage:

  ```cpp
  using BoolAndInt = std::pair<bool, int>;
  using MapIntDouble = std::map<int, double>;

  MOCK_METHOD(BoolAndInt, GetPair, ());
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
  ```

This avoids direct macro parsing issues related to unprotected commas.

---

## Issues with Mocking Const and Overloaded Methods

### Compiler Warnings for Const Parameters

If you encounter warnings such as MSVC warnings C4301 or C4373 when mocking methods with `const` parameters, it is due to a known compiler quirk. 

**Best Practice:** Remove top-level `const` qualifiers on primitive parameters in both your base and mock methods, as they are ignored by C++ and can trigger warnings.

### Mocking Overloaded Methods

When mocking overloaded methods, ensure you mock *all* relevant overloads to avoid compiler warnings about hidden base class methods.

If you want to mock only some overloads and allow others to pass through, bring the unmocked overloads into scope with `using`:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Make unmocked overloads visible
  MOCK_METHOD(int, Add, (Element x), (override));
};
```

---

## Managing Expectations & Avoiding Common Test Pitfalls

### Uninteresting Calls Warning

When a mock method is called without any `EXPECT_CALL` set, gMock prints a warning about an "uninteresting mock function call." This is normal and means your test does not specify expectations for that method.

**How to handle:**

- If such calls are expected and should be ignored, consider using `NiceMock` to suppress warnings:

  ```cpp
  NiceMock<MockFoo> mock_foo;
  EXPECT_CALL(mock_foo, DoThis());  // set expectations on interesting calls
  ```

- To explicitly allow any number of calls without warnings, add a catch-all `EXPECT_CALL`:

  ```cpp
  EXPECT_CALL(mock_foo, Method(_)).Times(AnyNumber());
  ```

### Unexpected Calls and Strict Mocks

Unexpected calls are calls that do not match any existing `EXPECT_CALL`.

- By default, gMock treats these as errors.
- Using `StrictMock` makes all uninteresting calls failures, tightening test validation.

### Sticky Expectations

Expectations remain active even after their expected call count is saturated ("sticky") unless explicitly retired with `.RetiresOnSaturation()`. This may lead to confusing errors like call count violations if not handled as intended.

**Tip:** To make expectations retire automatically on saturation:

```cpp
EXPECT_CALL(mock, Foo())
    .Times(2)
    .RetiresOnSaturation();
```

---

## Platform-Specific Quirks

### Virtual Destructors Required

Always declare base classes with virtual destructors to avoid undefined behavior, especially when mocking. Missing a virtual destructor can cause leaks or crashes due to improper destruction.

Example:

```cpp
class Foo {
 public:
  virtual ~Foo() {}  // Must be virtual
  virtual void Bar() = 0;
};
```

### MSVC Macro Conflicts

Windows headers sometimes define macros that clash with mock method names.

**Solution:** Either:

- Undefine conflicting macros before using `EXPECT_CALL` or `ON_CALL`.
- Use alternate names.

Example in tests:

```cpp
#undef Method
EXPECT_CALL(mock, Method());
```

---

## Best Practices for Effective Mock Usage

- Define `MOCK_METHOD` macros in the public section even if mocking private or protected methods.
- Use `ON_CALL()` to specify default behaviors without expectations.
- Use `EXPECT_CALL()` only to enforce that calls must occur, avoiding over-constrain tests.
- Set expectations before exercising the mock.
- Use sequences or `InSequence` to enforce call order explicitly.
- When mocking methods with move-only types, provide lambdas or functors to handle the returned or passed unique pointers.
- For complex argument matching, use matchers (`_`, `Eq()`, or custom matchers).

---

## Troubleshooting Tips

### Diagnosing Expectation Failures

Run tests with the flag `--gmock_verbose=info` to get detailed call matching traces with stack backtraces, helping identify why expectations fail.

### Compilation Errors Related to MOCK_METHOD

Ensure types with commas are wrapped or aliased as noted above. Confirm qualifiers in MOCK_METHOD match those in the base class methods.

### Unexpected Call Errors

Check if missing `EXPECT_CALL` or too restrictive matchers are causing calls to be unexpected. Add more permissive expectations or set catch-all expectations.

### Method Not Being Mocked

Verify that the method is virtual (except for Hi-perf dependency injection use cases). For non-virtuals, template-based mocking may be used instead.

### Multiple EXPECT_CALL and Matching Order

Remember gMock matches expectations in reverse order of specification. Put more specific expectations after the general ones to override them.

---

## Further Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.md) - detailed recipes and examples
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) - common questions and clarifications
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) - learning tests writing basics
- [Mocking Reference](https://google.github.io/googletest/docs/reference/mocking.html) - API documentation

---

For more examples and explanations, visit the [GoogleMock Github Repository](https://github.com/google/googletest) to explore source code and additional tests addressing corner cases and advanced usage.
