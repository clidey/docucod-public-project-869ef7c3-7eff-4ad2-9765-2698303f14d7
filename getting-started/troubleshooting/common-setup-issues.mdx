---
title: "Troubleshooting Common Setup Issues"
description: "Identify and resolve frequent problems that arise during installation and first use—including build errors, platform compatibility, missing dependencies, and linking failures—with clear, step-by-step solutions."
---

# Troubleshooting Common Setup Issues

This guide helps you quickly identify and resolve frequent problems encountered during installation and initial use of GoogleMock and GoogleTest. Follow the step-by-step solutions for build errors, platform compatibility issues, missing dependencies, and linking failures to ensure your development environment is correctly configured and your test code runs smoothly.

---

## 1. Common Build Errors and Their Solutions

GoogleMock and GoogleTest require a properly configured build environment that supports the C++17 standard or newer. Below are common errors and fixes.

### 1.1 Compiler Does Not Support C++17

**Symptom:** Compilation fails with errors related to unsupported language features or version.

**Solution:**

- Verify your compiler supports C++17 or higher. GoogleMock requires C++17 features.
- Update your compiler to a version that supports C++17.
- Make sure your build system passes the appropriate C++ standard flag (e.g., `-std=c++17` for GCC/Clang or `/std:c++17` for MSVC).

```bash
# Example for GCC/Clang
g++ -std=c++17 ...

# CMake addition
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

<Tip>
Always check the compiler documentation and your project's build configuration to ensure the C++17 standard is enabled.
</Tip>

### 1.2 Missing pthread Library on Linux

**Symptom:** Linking errors such as `undefined reference to pthread_create`.

**Solution:**

- Confirm `pthread` development libraries are installed on your system.
- Add `pthread` to your link libraries.

```bash
# Install pthread on Debian/Ubuntu
sudo apt-get install libpthread-stubs0-dev

# Link with pthread
g++ -pthread ...

# CMake: 
find_package(Threads REQUIRED)
target_link_libraries(your_target Threads::Threads)
```

<Warning>
Failing to link with `pthread` can cause build failures on POSIX systems.
</Warning>

### 1.3 Linker Errors for GoogleMock Symbols

**Symptom:** Undefined reference errors for `gmock` or `gmock_main` symbols.

**Solution:**

- Ensure you link your test binaries against `gmock` or `gmock_main` libraries.
- If using CMake, link explicitly:

```cmake
target_link_libraries(your_test_target gmock_main)
```

- For static versus shared library issues:
  - Ensure consistent linking of static/shared libraries in your project.
  - On Windows, consider setting `gtest_force_shared_crt` for runtime library consistency.

<Note>
Link errors frequently stem from missing `-lgmock_main` or mismatching build options.
</Note>

### 1.4 Incorrect Main Function Linkage

**Symptom:** Multiple `main()` definitions or missing entry point.

**Causes:**

- Linking both your own `main()` and GoogleMock's `gmock_main.cc` library.
- Not linking `gmock_main` and providing no `main()` function.

**Solution:** Choose one:

- Use GoogleMock's provided main by linking `gmock_main` and do not define your own.
- Provide your own `main()` and link only with `gmock` instead of `gmock_main`.

See the file `src/gmock_main.cc` for reference implementation of `main()` tailored for different platforms.

<Tip>
Match your main function approach with the corresponding library: `gmock_main` has main, `gmock` does not.
</Tip>

## 2. Platform Compatibility Issues

GoogleMock supports Linux, Windows, and MacOS, but setup nuances exist.

### 2.1 Windows-Specific Link Errors

**Symptom:** Link errors related to `_tmain` or Unicode settings.

**Reason:** MSVC has known issues with static libs and Unicode that cause `_tmain` linker failures.

**Solution:**

- Use the plain `main()` function instead of `_tmain` when compiling on Windows.
- This is handled inside `src/gmock_main.cc` already.

### 2.2 Embedded/Arduino Platforms

**Note:** There is conditional code support for platforms like ESP8266, ESP32, and NRF52, which changes the test runner strategy.

- If working on these platforms, ensure your build uses the provided hooks like `setup()` and `loop()` instead of a traditional `main()`.

## 3. Addressing Missing Dependencies

### 3.1 GoogleTest Source Directory Not Found

**Symptom:** Build scripts cannot find the GoogleTest source or headers.

**Solution:**

- Confirm that the GoogleTest source is present under `gtest/` or `../googletest/` relative to your GoogleMock directory.
- Adjust CMake variable `gtest_dir` if you have a custom directory structure.

```cmake
if (EXISTS "${CMAKE_CURRENT_SOURCE_DIR}/gtest/CMakeLists.txt")
  set(gtest_dir gtest)
else()
  set(gtest_dir ../googletest)
endif()
```

- Ensure subdirectory add commands work correctly to include GoogleTest.

### 3.2 CMake Version Incompatibility

GoogleMock's CMake scripts require at least CMake 3.13 or higher.

- Upgrade your CMake version if you encounter syntax or command not found errors related to CMake.

## 4. Linking Failures and Library Conflicts

### 4.1 Mismatched Runtime Libraries (Windows)

**Symptom:** LNK2038 error about runtime library mismatches.

**Resolution:**

- Enable `gtest_force_shared_crt` in your CMake build to align your project with GoogleTest’s runtime linkage.

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### 4.2 Shared vs Static Library Confusion

- Decide whether to use static or shared libraries for GoogleMock.
- Pass `-DBUILD_SHARED_LIBS=ON` to CMake to build shared libs if desired.
- Be consistent in linking your test code accordingly.

## 5. Verification and Debugging

### 5.1 Verifying Installation and Linking

After building, verify your setup:

- Ensure your test binaries link successfully with GoogleMock libraries.
- Run a sample test (e.g., using `gmock_main`) to see output like:

```console
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from FooTest
[ RUN      ] FooTest.DoesXyz
[       OK ] FooTest.DoesXyz (0 ms)
[----------] 1 test from FooTest (0 ms total)
[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

<Tip>
Use GoogleMock flags for verbose output if your tests fail, e.g., `--gmock_verbose=info`.
</Tip>

### 5.2 Catching Leaked Mocks

- To help diagnose leaked mocks during development, enable the `catch_leaked_mocks` flag:
  
```cpp
GMOCK_FLAG_SET(catch_leaked_mocks, true);
```

- This will generate warnings for mocks that are not destroyed properly.

## 6. Troubleshooting Tips

<AccordionGroup title="Common Troubleshooting Scenarios">
<Accordion title="Build Fails: Undefined References to gmock or gtest">
Ensure you link your test binaries with the appropriate GoogleMock and GoogleTest libraries (`-lgmock_main` or `-lgmock` and `-lgtest`). Check your build files for missing link targets.
</Accordion>
<Accordion title="Compilation Errors When Using MOCK_METHOD">
Make sure your compiler is set to C++17 standard or newer, as `MOCK_METHOD` relies on modern C++ features.
</Accordion>
<Accordion title="Test Program Does Not Run or No Output">
Verify that you either link in `gmock_main` (which provides `main()`) or provide your own valid `main()` function calling `RUN_ALL_TESTS()`.
</Accordion>
</AccordionGroup>

---

For detailed steps on installation and first use, refer to [Installation & Integration](/getting-started/environment-installation/installation-integration) and [Quick Validation & First Success](/getting-started/initial-usage/quick-validation).

## 7. Summary

| Problem Category               | Key Checks & Actions                              |
|-------------------------------|--------------------------------------------------|
| Compiler Compatibility        | Ensure C++17 support and correct compiler flags. |
| Missing pthread on Linux       | Install pthread libs and link pthread.            |
| Linker Errors                 | Link with `gmock` or `gmock_main` correctly.      |
| Windows Link Issues           | Use `main()` instead of `_tmain()` for MSVC bugs. |
| Missing GoogleTest Sources    | Confirm source directory path for CMake.          |
| Runtime Mismatches on Windows | Use `gtest_force_shared_crt` to match runtimes.   |

---

If you encounter further issues or specialized environment concerns, consult the [FAQ - Installation and Setup Issues](/faq/general-usage-troubleshooting/installation-issues) and the [Community & Further Help](/getting-started/troubleshooting/community-resources).

---

<CardGroup cols={2}>
<Card title="Helpful Resources">
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [Installation & Integration](/getting-started/environment-installation/installation-integration)
- [Troubleshooting Common Setup Issues](/getting-started/troubleshooting/common-setup-issues)
</Card>
<Card title="Key Commands & Flags">
- `cmake .. -DCMAKE_CXX_STANDARD=17`
- `make` or your platform's build command
- Link with `gmock_main` library for built-in main()
- Use `--gmock_verbose=info` for detailed logs
- Set `gtest_force_shared_crt ON` in CMake on Windows
</Card>
</CardGroup>

---