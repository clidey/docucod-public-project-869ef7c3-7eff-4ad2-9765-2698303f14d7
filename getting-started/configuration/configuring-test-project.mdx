---
title: "Configuring Your Test Project"
description: "Show users how to set up a test project structure compatible with GoogleTest, including creating test targets, linking libraries, and organizing source/test files. Discuss typical project layouts and build integration."
---

# Configuring Your Test Project

This guide shows you how to set up a test project structure compatible with GoogleTest. You will learn how to create test targets, link necessary libraries, and organize your source and test files effectively. We also cover typical project layouts and how to integrate tests into your build system for smooth compilation and execution.

---

## 1. Setting Up Your Project Structure

A clear and maintainable project structure is foundational for successful testing with GoogleTest. Typical layouts separate production code and test code, making the project clean and scalable.

### Recommended Layout Example

```
/my_project
|-- CMakeLists.txt
|-- src/
|   |-- my_library.cpp
|   |-- my_library.h
|-- tests/
    |-- CMakeLists.txt
    |-- my_library_test.cpp
```

- `src/` contains your main source files.
- `tests/` contains the test source files.

### Tips:
- Keep test files close to the code they test by naming them accordingly (e.g., `my_library_test.cpp` for `my_library.cpp`).
- Avoid mixing test and production files in the same directories.

---

## 2. Creating Test Targets with CMake

GoogleTest integrates smoothly with CMake, which is the most common build system for C++ projects. Follow these steps to create test targets:

### Step 1: Find and Link GoogleTest

In your top-level `CMakeLists.txt` or test subdirectory's `CMakeLists.txt`, add:

```cmake
# Enable testing capabilities
enable_testing()

# Find GoogleTest package - adjust if you build or bundle it yourself
find_package(GTest REQUIRED)

# Link directories and libraries
include_directories(${GTEST_INCLUDE_DIRS})
```

### Step 2: Define Your Test Executable

Create a test executable with the source files containing tests and link against GoogleTest libraries.

```cmake
add_executable(my_library_test my_library_test.cpp)

# Link to GoogleTest and pthread (required by GoogleTest)
target_link_libraries(my_library_test ${GTEST_LIBRARIES} pthread)
```

### Step 3: Register Tests

Enable CTest to run your tests:

```cmake
add_test(NAME MyLibraryTest COMMAND my_library_test)
```

### Step 4: Build and Run Tests

At the command line:

```sh
mkdir build && cd build
cmake ..
make
ctest
```

Your tests will compile and run automatically.

---

## 3. Building and Linking Your Production Code

To test your code effectively, your test targets need access to the production code they exercise.

### Option 1: Add Production Library Target

In the main `CMakeLists.txt`:

```cmake
add_library(my_library src/my_library.cpp src/my_library.h)
```

Then link it to your tests:

```cmake
target_link_libraries(my_library_test my_library ${GTEST_LIBRARIES} pthread)
```

### Option 2: Include Source Files Directly (Not Recommended)

For small projects or quick prototypes, you may include source files directly in your test target sources.

```cmake
add_executable(my_library_test tests/my_library_test.cpp src/my_library.cpp)
```

Use this sparingly as it doesn't scale well.

---

## 4. Organizing Test Source Files

### Writing Test Files

Each test file should include the necessary headers and GoogleTest headers:

```cpp
#include <gtest/gtest.h>
#include "../src/my_library.h"  // Adjust path as needed

// Your TEST or TEST_F macros here
```

### Naming Conventions

- Use `_test.cpp` suffix for test implementations.
- Name tests clearly, matching the module or class they exercise.

### Example Basic Test

```cpp
TEST(MyLibrary, Addition) {
  EXPECT_EQ(Add(2, 3), 5);
}
```

This helps isolate tests and improve discoverability.

---

## 5. Typical Project Layout Variations

Depending on your project size and complexity, you may opt for different layouts.

### Monolithic (Simple) Layout

All code and tests in one directory.

### Separated Layout

Split production and test code as shown earlier.

### Multi-Module Layout

Organize as follows:

```
/my_project
|-- lib1/
|   |-- src/
|   |-- tests/
|-- lib2/
    |-- src/
    |-- tests/
```

Each module builds its own library and test executables. Share GoogleTest via CMake's `find_package`.

---

## 6. Build System Integration

GoogleTest integrates with various build systems (CMake, Bazel, Make, etc.). This section focuses on CMake.

- Always link test executables against the GoogleTest libraries and your production code.
- Use CTest (`enable_testing()` and `add_test()`) to register tests for easy running.
- If you include GoogleTest as a submodule or embedded source, add it via `add_subdirectory` before referencing it.

### Example Integration snippet with embedded GoogleTest

```cmake
add_subdirectory(googletest)
add_executable(my_library_test my_library_test.cpp)
target_link_libraries(my_library_test gtest gtest_main my_library pthread)
add_test(NAME MyLibraryTests COMMAND my_library_test)
```

---

## 7. Best Practices & Common Pitfalls

### Tips for Success

- **Separate code and tests:** Clean separation prevents accidental dependency issues.
- **Use CMake's testing features:** This provides uniform and easy test execution.
- **Link correctly:** Forgetting to link production code or GoogleTest libraries leads to link errors.
- **Use descriptive test names:** For maintainability and clarity.
- **Retire Expectations:** When using GoogleMock, `.RetiresOnSaturation()` helps avoid sticky mocks.

### Common Errors

- **Link errors:** Usually from missing GoogleTest or pthread linkage.
- **Tests not found:** Forgetting to register tests with `add_test()`.
- **Include path issues:** Ensure `gtest` headers are correctly included.
- **Overly complex test targets:** Avoid lumping unrelated tests in one executable.

---

## 8. Sample CMakeLists.txt for Tests

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyProject)

enable_testing()

# Find GoogleTest
find_package(GTest REQUIRED)
include_directories(${GTEST_INCLUDE_DIRS} include src)

# Production library
add_library(my_library src/my_library.cpp)

# Test executable
add_executable(my_library_test tests/my_library_test.cpp)

# Link test executable with libraries
target_link_libraries(my_library_test my_library ${GTEST_LIBRARIES} pthread)

# Register the test
add_test(NAME MyLibraryTest COMMAND my_library_test)
```

---

## 9. Running Your Tests

After building, you can run tests using:

```bash
# Run all tests
ctest

# Or run manually
./my_library_test
```

GoogleTest supports command-line arguments to filter tests, control output, and set seed values for randomized tests.

Example:

```bash
./my_library_test --gtest_filter=MyLibrary.Addition
```

---

## 10. Troubleshooting

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Linker Errors Related to GoogleTest or pthread">
**Cause:** Your test target is missing references to GoogleTest libraries or POSIX threads.

**Solution:**
- Make sure your `target_link_libraries` includes `${GTEST_LIBRARIES}` and `pthread`.
- Confirm GoogleTest is installed or added in your project.
- On Windows, pthread may not be required.
</Accordion>
<Accordion title="Tests Not Detected or Not Running">
**Cause:** You have not enabled testing or registered tests.

**Solution:**
- Call `enable_testing()` in your top-level CMakeLists.
- Use `add_test()` for each test executable.
- Run `ctest` in the build directory.
</Accordion>
<Accordion title="Include Path Errors for gtest/gtest.h">
**Cause:** The compiler cannot find GoogleTest headers.

**Solution:**
- Use `find_package(GTest REQUIRED)` followed by `include_directories(${GTEST_INCLUDE_DIRS})`.
- Confirm GoogleTest is installed or available as a submodule.
</Accordion>
<Accordion title="Tests Crash or Behave Unexpectedly">
**Cause:** Test code or mocks misconfigured, or dependency issues.

**Solution:**
- Review test source code for misuse of mocks.
- Confirm correct GoogleTest version.
- Run with verbose output: `--gtest_repeat=1 --gtest_break_on_failure`.
</Accordion>
</AccordionGroup>

---

## References & Further Reading

- [GoogleTest Primer](../primer.md) — learn fundamentals of GoogleTest.
- [gMock Cookbook](../gmock_cook_book.md) — advanced mock usage.
- [Mocking Reference](../reference/mocking.md) — API details about mocks.
- [Installation with CMake](../setup/install-cmake.md) — setting up GoogleTest with CMake.
- [Running and Validating Your First Test](../configuration/running-tests.md) — next step after configuration.

<Check>
Ensure your development environment supports C++17 or later, and your build system is configured correctly for GoogleTest integration.
</Check>

---