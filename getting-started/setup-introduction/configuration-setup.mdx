---
title: "Configuration & Project Integration"
description: "Learn how to set up your project to use GoogleTest. This includes linking libraries, integrating into your build process, organizing test directories, and any project-level settings necessary for seamless usage in your workflow."
---

# Configuration & Project Integration

Learn how to set up your project to use GoogleTest. This includes linking libraries, integrating into your build process, organizing test directories, and any project-level settings necessary for seamless usage in your workflow.

---

## 1. Overview

This guide focuses on configuring GoogleTest in your C++ project to seamlessly integrate testing capabilities. Whether you are adding GoogleTest to an existing build setup or starting fresh, you will learn the recommended ways to link libraries, organize your test source files, and configure project-level build settings for smooth compilation and execution.

GoogleTest provides simple mechanisms for incorporation, with native CMake support as the primary method. Other build systems can adopt similar concepts based on this guidance.

## 2. Prerequisites

Before proceeding with integration, ensure:

- Your environment supports **C++17** (GoogleTest requires it).
- You have a working build system; CMake 3.14 or newer is preferred for advanced integration.
- GoogleTest libraries (either built separately or as part of your project) are available.

Refer to [Prerequisites & System Requirements](https://your-docs-url/getting-started/setup-introduction/prerequisites-requirements) for detailed environment checks.

## 3. Linking GoogleTest into Your Project

### 3.1. Using Installed GoogleTest Libraries (Preferred Method)

If you have installed GoogleTest on your system (e.g., `/usr/local` on UNIX-like systems), the simplest way to integrate is via `find_package` in CMake.

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test_executable test_main.cpp other_test_files.cpp)
target_link_libraries(your_test_executable PRIVATE GTest::gtest GTest::gtest_main)

add_test(NAME YourTests COMMAND your_test_executable)
```

#### Outcomes

- Your test executable will link against the installed GoogleTest library.
- The `add_test` registers tests with CTest for integration into CI/CD.

#### Tips

- Use `GTest::gtest_main` if you want to use the default main; otherwise, link `GTest::gtest` and provide your own `main()`.
- Ensure your compiler uses C++17 by setting `target_compile_features(your_test_executable PUBLIC cxx_std_17)` if necessary.

### 3.2. Incorporating GoogleTest Source Using `add_subdirectory()`

For closer control and consistency, embed GoogleTest's source code as a subdirectory within your main project.

**Steps:**

1. Add GoogleTest as a submodule or download and place the source under a directory (e.g., `external/googletest`).

2. In your project's `CMakeLists.txt`, add:

```cmake
add_subdirectory(external/googletest)

add_executable(your_test_executable test_main.cpp other_tests.cpp)
target_link_libraries(your_test_executable PRIVATE gtest gtest_main)

add_test(NAME YourTests COMMAND your_test_executable)
```

#### Why use this method?

- Ensures that GoogleTest is compiled with the same compiler settings and flags as your project.
- Avoids issues like runtime library mismatches, especially on Windows.

#### Visual Studio Note

- To resolve runtime library conflicts, set `gtest_force_shared_crt` to `ON` before `FetchContent_MakeAvailable` if you use the recommended FetchContent method for downloading GoogleTest:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### 3.3. Dynamic vs Static Runtime on Windows

By default, GoogleTest links statically against the runtime, which can conflict if your project uses dynamic runtimes (`/MD`). Configure accordingly:

- To make GoogleTest use the dynamic runtime libraries, set the CMake option:

```cmake
set(gtest_force_shared_crt ON)
```

- This should be done before GoogleTest's build targets are created (e.g., before `add_subdirectory` or `FetchContent_MakeAvailable`).

## 4. Organizing Test Sources and Directories

### Standard Layout

Organize your test files and directories to keep tests clean, discoverable, and maintainable:

```
/project-root
|-- src/                  # Production source files
|-- tests/                # Test source files
   |-- CMakeLists.txt     # Build config for tests
   |-- test_main.cpp      # Optional, if not using gtest_main
   |-- foo_test.cpp       # Example test suites
   |-- bar_test.cpp
```

- **Use a dedicated directory** for your test sources.
- **Name test files** with suffix `_test.cpp` or similar conventions.
- **Avoid mixing production and test files** for easier builds and clarity.

### Build Setup

Add a `tests/CMakeLists.txt` with:

```cmake
add_executable(unit_tests
    test_main.cpp
    foo_test.cpp
    bar_test.cpp
)
target_link_libraries(unit_tests PRIVATE gtest_main)
add_test(NAME RunAllTests COMMAND unit_tests)
```

- If you use `gtest_main`, you don't need your own `main()`.
- Otherwise, provide `test_main.cpp` with `int main()` calling `RUN_ALL_TESTS()`.

## 5. Configuring Build Settings

### 5.1. C++ Standard

Ensure the compiler uses C++17:

```cmake
set_target_properties(unit_tests PROPERTIES
    CXX_STANDARD 17
    CXX_STANDARD_REQUIRED ON
)
```

### 5.2. Compiler Flags

GoogleTest's build scripts handle necessary flags for pthreads and threading support if you use CMake's supplied build targets.

If you build GoogleTest separately or manually, link pthread (`-pthread`) on UNIX-like systems.

### 5.3. Control Macros

You can tweak GoogleTest behaviour by adding macros to the compiler command line:

- To disable GoogleTest macro definitions and avoid clashes:

  ```
  -DGTEST_DONT_DEFINE_TEST=1
  ```

- For pthread availability override:

  ```
  -DGTEST_HAS_PTHREAD=1
  ```

Use these flags via `target_compile_definitions` or your build system's equivalent.

## 6. Example: Minimal CMake `CMakeLists.txt` Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject)

# Enable C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Fetch GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # Fix runtime libraries on Windows
FetchContent_MakeAvailable(googletest)

# Add your test executable
add_executable(my_tests tests/foo_test.cpp tests/bar_test.cpp)

target_link_libraries(my_tests PRIVATE gtest_main)

# Add test for CTest
enable_testing()
add_test(NAME AllTests COMMAND my_tests)
```

## 7. Running Your Tests

After configuration and build:

- Run your tests via the executable directly (e.g., `./my_tests`).
- Or use CTest with `ctest` for integration.

## 8. Troubleshooting and Tips

- **Linker errors:** Ensure you link against the correct GoogleTest libraries and that runtime libraries are compatible.
- **Multiple runtime conflicts on Windows:** Use `gtest_force_shared_crt` option.
- **Using without CMake:** Make sure to manually add include paths and link libraries correctly.
- **Test filtering and execution control:** Use GoogleTest command-line flags to filter or run subsets of tests.

<Tip>
Always keep your GoogleTest version aligned with your project's C++ standard and compiler support to avoid build issues.
</Tip>

<Note>
Integrating GoogleTest as a subdirectory or via FetchContent improves consistency and reduces external dependencies.
</Note>

---

For further detail, refer to:

- [GoogleTest README](https://github.com/google/googletest/blob/main/README.md)
- [Platform Support & Build Integration](https://your-docs-url/overview/integrations-and-ecosystem/platform-support-and-build-integration)
- [Installation and Environment Setup](https://your-docs-url/guides/getting-started/setup-installation)

---

## References

- GoogleTest GitHub: https://github.com/google/googletest
- Official CMake Documentation: https://cmake.org/documentation/

---

## Summary

This document covered how to configure GoogleTest within your C++ project. It described linking approaches (installed libraries, subdirectory builds, FetchContent), organizing test sources, setting C++ standards, handling build flags, and creating test executables. You also learned practical tips for handling platform-specific settings, especially on Windows.

Following these best practices ensures seamless integration of GoogleTest and efficient test execution in your development workflow.
