---
title: "Common Setup Issues"
description: "Troubleshoot typical problems encountered during installation, linkage, compiler compatibility, and initial integration. Each scenario includes symptoms, root causes, and actionable solutions."
---

# Common Setup Issues

This guide helps you identify and resolve frequent problems encountered during the setup of GoogleTest and GoogleMock. Whether you're facing installation hitches, linkage errors, compiler incompatibilities, or issues integrating the framework into your environment, this page provides clear symptoms, explanations of root causes, and practical solutions to get you up and running swiftly.

---

## 1. Installation Problems

### Symptom:
- `cmake` or `make` fails with errors related to missing headers or targets.
- GoogleMock and GoogleTest sources are not found during build.

### Root Causes:
- Incorrect project source tree layout.
- Missing or outdated CMakeLists.txt files.
- Incomplete or non-existent dependencies.

### Solutions:
1. **Verify Source Layout:**
   - Ensure you have cloned the full `googletest` repository, which includes both GoogleTest and GoogleMock.
   - The subdirectory structure should contain `gmock` and `googletest` folders or use the single combined repo as expected.

2. **Run CMake from Correct Directory:**
   - Always run `cmake` inside a separate `build` directory, not in the source directory.

3. **Check CMakeLists.txt Presence:**
   - Confirm `gmock` directory contains `CMakeLists.txt`.

4. **Use Correct CMake Command:**
   - To build both GoogleTest and GoogleMock, run:

    ```bash
    cmake ..
    make
    ```

   - To build only GoogleTest, run:

    ```bash
    cmake .. -DBUILD_GMOCK=OFF
    make
    ```

5. **Review Console Output for Errors:**
   - Look for missing files or dependencies and resolve them accordingly.

### Troubleshooting Tips:
- If you do not want to build tests, set the `gmock_build_tests` option to `OFF`.
- Ensure your C++ compiler supports C++17 or later.
- On Windows, Visual Studio users may need to adjust runtime library settings (see [Visual Studio Dynamic vs Static Runtimes](https://github.com/google/googletest/blob/main/googletest/README.md#visual-studio-dynamic-vs-static-runtimes)).

---

## 2. Linker Errors

### Symptom:
- Linker errors about undefined references to GoogleTest or GoogleMock symbols.
- Conflicts between static and shared library versions.

### Root Causes:
- Incorrect linkage order or missing libraries in the build settings.
- Mixing static and shared library linkage options.
- Building GoogleTest and GoogleMock with different compiler flags than your test code.

### Solutions:
1. **Link With Correct Libraries:**
   - For tests, link against `gmock_main` or `gtest_main` to get default `main()` implementation.

2. **Consistent Compiler Flags:**
   - Use the same C++17 standard and runtime library options across GoogleTest, GoogleMock, and your test code.
   - If using CMake, import targets properly:

    ```cmake
    target_link_libraries(your_test PRIVATE gmock_main)
    ```

3. **Avoid Mixing Static and Shared:**
   - Choose whether to build shared (`-DBUILD_SHARED_LIBS=ON`) or static libraries.
   - Ensure your test target links accordingly.

4. **MSVC Specific:**
   - Adjust runtime linkage flags (`/MD` vs `/MT`) to match GoogleTest.

### Troubleshooting Tips:
- Use verbose build output to trace linkage commands.
- Confirm the libraries actually contain the needed symbols (e.g., with `nm` on UNIX).

---

## 3. Compiler Compatibility Issues

### Symptom:
- Compiler errors related to features C++17 does not support or warnings treated as errors.
- Warnings or errors stemming from misuse of `const` parameters in mocks.

### Root Causes:
- Using older compilers without full C++17 support.
- Compiler bugs or peculiarities, especially on MSVC.

### Solutions:
1. **Use Supported Compiler Versions:**
   - Ensure your compiler supports C++17 (e.g., GCC 7+, Clang 5+, MSVC 2017 Update 2+).

2. **Remove `const` from Value Parameters:**
   - If your mock method parameter is a const value (e.g., `const int`), remove `const` from the declaration in both the base and mock class to avoid MSVC warnings.

3. **Adjust Compiler Flags:**
   - See `googletest/cmake/internal_utils.cmake` for recommended flags.
   - Disable warnings that cause build failures if safe.

4. **Use CMake Helper Functions:**
   - Use the provided helper functions during build to configure strict but compatible flags.

### Troubleshooting Tips:
- Check the [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) for details on specific compiler warnings.
- If you encounter inexplicable failures, try updating your compiler.

---

## 4. Integration & Initialization Issues

### Symptom:
- Tests crash or return nothing meaningful.
- Flags such as `--gmock_verbose` are ignored.
- Tests report unexpected behavior or fail unexpectedly.

### Root Causes:
- Not calling `InitGoogleMock()` before running tests.
- Incorrect command-line flag usage.
- Using both GoogleTest and GoogleMock initialization incorrectly.

### Solutions:
1. **Ensure Proper Initialization in `main()`:**

    ```cpp
    int main(int argc, char** argv) {
      testing::InitGoogleMock(&argc, argv);
      return RUN_ALL_TESTS();
    }
    ```

2. **Avoid Calling `InitGoogleTest()` Separately:**
   - `InitGoogleMock()` initializes GoogleTest as well. Do not call `InitGoogleTest()` if you use `InitGoogleMock()`.

3. **Use `gmock_main` Library When Possible:**
   - Linking against `gmock_main` provides a default `main()` that calls `InitGoogleMock()`.

4. **Handle Command-Line Flags Correctly:**
   - Flags like `--gmock_verbose=info` should be passed to the test executable.
   - Flags not recognized by GoogleMock remain in `argv` after initialization.

5. **Check for Wide-Character Support on Windows:**
   - On Windows, make sure you use the correct wide-character versions if running with UNICODE.

### Troubleshooting Tips:
- Use the test in `googlemock/test/gmock_test.cc` as a reference for proper initialization.
- If flags are not working, verify that command line parsing doesn't strip arguments prematurely.

---

## 5. Common Pitfalls and How to Avoid Them

### Compiler Running Out of Memory When Compiling Large Mock Classes

- Avoid the `/clr` flag on MSVC when compiling native mocks.

### Mock Method Parameter Parsing Errors

- Wrap parameters containing commas in extra parentheses in `MOCK_METHOD` declarations.

### Virtual Destructor Missing in Base Classes

- Ensure any base class you mock has a virtual destructor to prevent heap checking issues and leaks.

### Unexpected Calls Warnings

- Add explicit expectations with `EXPECT_CALL(...)` to suppress “Uninteresting function call” warnings, or adjust verbosity with `--gmock_verbose` flag.

### Using `ON_CALL` vs `EXPECT_CALL`

- Use `ON_CALL` to specify default behavior but note it does *not* suppress warnings.
- Use `EXPECT_CALL` with `.WillRepeatedly()` to signal expected calls.

---

## 6. Summary Table of Common Issues

| Issue                             | Symptoms                                | Solution Summary                                      |
|----------------------------------|----------------------------------------|------------------------------------------------------|
| Installation Failure             | Build errors, missing files             | Verify source layout, run CMake in build dir          |
| Linker Errors                   | Undefined references                    | Link with correct libs, consistent flags              |
| Compiler Warnings/Errors        | MSVC warnings on const params           | Remove redundant `const`, update compiler             |
| Initialization Missing          | Tests crash or silent failure           | Call `InitGoogleMock()` before `RUN_ALL_TESTS()`       |
| Virtual Destructor Missing      | Heap check errors or crashes            | Add virtual destructor to base classes                 |
| Unexpected Calls Warning        | Warnings at runtime                      | Use `EXPECT_CALL` or set verbosity flags              |

---

## 7. Where to Get Help

- [Official GoogleTest GitHub Repository](https://github.com/google/googletest) to report issues or get updates.
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) for foundational understanding.
- [gMock FAQ](https://google.github.io/googletest/gmock_faq.html) for common mock-related questions.
- [Integration & Ecosystem](https://github.com/google/googletest) page for details on build and IDE integration.
- Join community forums or Q&A sites for peer support.

---

By understanding these common setup issues and their solutions, you can accelerate your GoogleTest and GoogleMock adoption journey, focusing on writing robust, reliable tests without delay.

---

[Back to Getting Started / Common Setup Issues](../../getting-started/setup-troubleshooting/common-setup-issues.md)