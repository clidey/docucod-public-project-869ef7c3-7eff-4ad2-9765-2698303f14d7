---
title: "Installing with CMake"
description: "Step-by-step instructions for integrating GoogleTest and GoogleMock in CMake-based projects. Details acquiring sources, configuring dependencies, and validating builds—empowering users who rely on the CMake ecosystem."
---

# Installing GoogleTest and GoogleMock with CMake

This guide walks you through integrating GoogleTest and GoogleMock into your CMake-based C++ project. You'll learn how to acquire GoogleTest sources, configure your project to build tests using these frameworks, and confirm that everything is working correctly. This practical onboarding empowers you to leverage GoogleTest and GoogleMock seamlessly within your CMake environment.

---

## 1. Prerequisites

Before you begin, ensure the following are in place:

- **C++ Compiler:** Your compiler must support C++17 or later.
- **CMake:** Version 3.13 or newer is required.
- **Build Tool:** Compatible with your platform (e.g., Make, Ninja, Visual Studio).

> For detailed environment requirements, see [System Requirements](/getting-started/setup-requirements/system-requirements).

---

## 2. Acquire GoogleTest Sources

There are two recommended ways to use GoogleTest in your CMake project:

### Option A: Download and Build GoogleTest Separately

```bash
# Clone the GoogleTest repository:
git clone https://github.com/google/googletest.git -b main
down into the directory:
cd googletest
# Create and enter a build directory:
mkdir build && cd build
# Generate build files with default options (GoogleMock included):
cmake ..
# Build
make
# Optionally, install GoogleTest system-wide (may require sudo):
sudo make install
```

> If you only want to build GoogleTest without GoogleMock, add `-DBUILD_GMOCK=OFF` to the cmake command.

### Option B: Integrate GoogleTest into Your Project Directly

Use CMake's `FetchContent` module to download and build GoogleTest during your project’s configuration step.

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project LANGUAGES CXX)

# Require C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
# For Windows: Use shared runtime to match project settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

---

## 3. Configure Your CMakeLists.txt to Use GoogleTest

After acquiring sources (Option A or B), update your `CMakeLists.txt` to build and link your test executables:

```cmake
# Enable testing in CMake
enable_testing()

# Add test executable with your test source file(s)
add_executable(
  hello_test
  hello_test.cc
)

# Link with GoogleTest's main library (provides main function)
target_link_libraries(
  hello_test
  GTest::gtest_main
)

# Enable test discovery to use ctest to find and run your tests
include(GoogleTest)
gtest_discover_tests(hello_test)
```

> **Tip:** Use `GTest::gtest_main` to automatically provide a main function for your tests.

---

## 4. Build and Run Your Tests

Use the following commands from your project root directory:

```bash
# Generate build system files
cmake -S . -B build

# Build the tests
cmake --build build

# Run all tests discovered by CTest
cd build
ctest
```

Expected output if successful will indicate tests passing:

```
Test project /path/to/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ...........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

---

## 5. Using pkg-config Files (Optional)

GoogleTest installs `.pc` pkg-config files (`gtest.pc`, `gtest_main.pc`, `gmock.pc`, `gmock_main.pc`) that contain necessary compiler and linker flags.

### Why Use pkg-config?

- Simplifies retrieval of include paths and linking flags.
- Automatically includes required macros like `-DGTEST_HAS_PTHREAD=1` and thread libraries.

### How to Use pkg-config in Your Build

Example of using pkg-config with CMake:

```cmake
find_package(PkgConfig)
pkg_search_module(GTEST REQUIRED gtest_main)

target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})
```

### Troubleshooting pkg-config

If `pkg-config` does not find GoogleTest modules:

- Ensure the `.pc` files are installed (commonly in `/usr/local/lib/pkgconfig` or `/usr/local/lib64/pkgconfig`).
- Set the environment variable:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

- For cross-compilation setups, set the sysroot-related variables as explained in the [Pkg-config usage guide](docs/pkgconfig.md).

---

## 6. Best Practices and Tips

- Prefer linking with `gtest_main` or `gmock_main` libraries to avoid defining your own `main()` in test projects.
- Use `FetchContent` for flexible and up-to-date GoogleTest integration.
- Always enable testing (`enable_testing()`) and test discovery (`gtest_discover_tests()`) in CMake.
- On Windows with Visual Studio, set `gtest_force_shared_crt` ON to match runtime libraries and prevent linker errors.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting GoogleTest with CMake">
<Accordion title="Build Fails Due to Missing pthreads">
If your environment doesn't support pthread, or GoogleTest misdetects pthread availability, you can force using pthread by adding:

```cmake
target_compile_definitions(your_target PRIVATE GTEST_HAS_PTHREAD=1)
```

Or disable pthread support explicitly:

```cmake
-DGTEST_HAS_PTHREAD=0
```

</Accordion>
<Accordion title="Linker Errors for gtest_main">
Ensure you have linked your test executable with `GTest::gtest_main` or the equivalent target to get the main() entry point.

</Accordion>
<Accordion title="pkg-config Can't Find GoogleTest">
Double-check your `.pc` files installation path and update `PKG_CONFIG_PATH` accordingly. Example:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

See [Using pkg-config](docs/pkgconfig.md) for details.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps

- Start writing tests using GoogleTest features - see [Primer: First Steps with GoogleTest](/guides/getting-started/primer-overview).
- Explore assertions, matchers, and test structuring in the [Assertions and Results](/api-reference/core-testing-apis/assertions-results) guide.
- Try mocking patterns with GoogleMock in [Introduction to Mocking with GoogleMock](/guides/mocking-patterns/introduction-to-mocking).


---

For comprehensive usage, including building with Bazel, advanced configuration, and troubleshooting, refer to the navigation links and additional guides provided with the GoogleTest documentation.


---

<Note>
This guide focuses strictly on CMake-based usage of GoogleTest and GoogleMock, assuming users who prefer CMake for C++ project management.
</Note>