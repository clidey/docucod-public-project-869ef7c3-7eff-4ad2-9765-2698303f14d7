---
title: "Introducing GoogleMock: Your First Mocked Test"
description: "Demonstrates how to add a simple mock to a test case using GoogleMock. Explains the purpose and syntax of mock setup, expectation macros, and what to expect when running a test that uses mocks for the first time."
---

# Introducing GoogleMock: Your First Mocked Test

This guide will help you create and run your first test using GoogleMock, GoogleTest's powerful mocking framework. GoogleMock lets you create mock objects that simulate behaviors of real classes, enabling you to test interaction patterns within your C++ code effectively.

---

## 1. Prerequisites & Setup

Before you write your first mocked test, make sure you have the following:

- GoogleTest and GoogleMock installed and built.
- Your compiler supports C++17 or above.
- Basic familiarity with GoogleTest's `TEST` framework.

If you haven’t installed GoogleMock yet, please follow the [Installation: CMake, Bazel, and Manual Integration](https://google.github.io/googletest/quickstart-cmake.html) guide.

<Check>
Ensure that your project includes the GoogleMock headers and links against the GoogleMock library.
</Check>

## 2. Defining Your Mock Class

To create a mock class:

- Derive a class from the interface or base class you want to mock.
- Use the `MOCK_METHOD` macro inside the `public:` section to mock virtual methods.

For example, consider an interface `Turtle`:

```cpp
class Turtle {
public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

You can define a mock class like this:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

<Note>
Always put `MOCK_METHOD` declarations in the `public:` section regardless of the original method's visibility.
</Note>

## 3. Writing Your First Mocked Test

With your mock class ready, follow these steps:

### Step 1: Import gMock Symbols

Add the following to your test file:

```cpp
using ::testing::AtLeast;
using ::testing::_;
using ::testing::Return;
```

This imports essential GoogleMock matchers and actions.

### Step 2: Create a Mock Object

Instantiate your mock object:

```cpp
MockTurtle mock_turtle;
```

### Step 3: Set an Expectation

Specify how you expect your mock to be used. For example, to expect `PenDown()` to be called at least once:

```cpp
EXPECT_CALL(mock_turtle, PenDown())
    .Times(AtLeast(1));
```

You can also specify behaviors:

```cpp
EXPECT_CALL(mock_turtle, GetX())
    .WillOnce(Return(42));
```

### Step 4: Exercise the Code Under Test

Pass the mock to the code you want to test. The mock will verify the interactions:

```cpp
Painter painter(&mock_turtle);
EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
```

### Step 5: Automatically Verify

GoogleMock will verify the expectations when the mock object is destroyed. If any expectation wasn’t met, the test will fail.

---

## 4. Understanding Expectation Syntax

### The `EXPECT_CALL` Macro

- Sets expectations on mock methods.
- Syntax:

  ```cpp
  EXPECT_CALL(mock_object, MethodName(matchers))
      .Times(cardinality)
      .WillOnce(action)
      .WillRepeatedly(action);
  ```

- The matcher `_` means “match any argument”.

- `Times(AtLeast(1))` specifies that the method should be called one or more times.

- `WillOnce(Return(value))` sets the method to return `value` the first time it is called.

- `WillRepeatedly(Return(value))` sets the method to return `value` on all subsequent calls.

### Common Matchers

- `_`: Match any value.
- `Eq(value)`: Match an argument equal to `value`.
- `Gt(value)`, `Ge(value)`, `Lt(value)`, `Le(value)`: Greater than, greater or equal, less than, less or equal.

### Cardinalities

| Cardinality        | Meaning                          |
| ------------------ | -------------------------------- |
| `Times(1)` or omit | Expect one call (default)         |
| `Times(AtLeast(n))`| At least n calls                  |
| `Times(AnyNumber())`| Any number of calls, including zero |
| `Times(Exactly(n))` | Exactly n calls                  |

<Tip>
Be as specific with expectations as necessary, but avoid over-specifying to keep your tests maintainable.
</Tip>

## 5. What to Expect When Running Your First Mocked Test

When you run your test:

- GoogleMock will monitor calls on your mock objects for compliance with the defined expectations.
- If an expected method is not called or called with wrong arguments, the test will fail immediately, reporting the mismatch.
- If an unexpected method is invoked, or more calls than expected occur, the test will also fail.

Example output for an unmet expectation may look like:

```
test_file.cc:24: Failure
Expected: to be called at least once
Actual: never called.
``` 

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Issues & Solutions">
<Accordion title="Mock Method Not Called as Expected">
- Verify that `EXPECT_CALL` is placed **before** exercising the code using the mock.
- Make sure that the mock object stays in scope during the calls.
</Accordion>
<Accordion title="Warnings about Uninteresting Calls">
- These happen when a mock method is called without an explicit `EXPECT_CALL`.
- Use `ON_CALL` to specify default behaviors or wrap mocks with `NiceMock` to suppress warnings.
</Accordion>
<Accordion title="Compilation Errors with MOCK_METHOD">
- Check that you have included `<gmock/gmock.h>`.
- For methods with comma in argument types, wrap them in extra parentheses or use type aliases.
</Accordion>
</AccordionGroup>

<Note>
Expectations must be set before the mock’s methods are called. Calling before setting expectations can cause undefined behavior.
</Note>

---

## 7. Next Steps

- Explore the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for detailed usage of macros and classes.
- Practice [writing expectations and actions](https://google.github.io/googletest/gmock_cook_book.html) to fine-tune your tests.
- Learn how to [manage mock strictness](https://google.github.io/googletest/mock_strictness.html) using `NiceMock` and `StrictMock`.
- Consult the [Troubleshooting & Common Setup Issues](https://google.github.io/googletest/getting-started/troubleshooting-setup.html) guide if you run into setup problems.

---

## Example: Complete Simple Test

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;
using ::testing::Return;
using ::testing::_;

class Turtle {
public:
  virtual ~Turtle() {}
  virtual void PenDown() = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

class Painter {
public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}
  bool DrawCircle(int x, int y, int radius) {
    turtle_->PenDown();
    return turtle_->GetX() == x;  // Simplified for this example
  }
private:
  Turtle* turtle_;
};

TEST(PainterTest, DrawsCircle) {
  MockTurtle mock_turtle;

  EXPECT_CALL(mock_turtle, PenDown()).Times(AtLeast(1));
  EXPECT_CALL(mock_turtle, GetX()).WillOnce(Return(0));

  Painter painter(&mock_turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

This test verifies that `PenDown()` is called at least once, and that `GetX()` returns 0 when called.

With these instructions, you can confidently write your first mock test and begin harnessing GoogleMock’s power.

---

## Helpful References

- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [Troubleshooting & Common Setup Issues](https://google.github.io/googletest/getting-started/troubleshooting-setup.html)

---