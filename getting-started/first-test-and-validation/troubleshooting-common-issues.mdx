---
title: "Troubleshooting Common Setup Issues"
description: "Guidance for resolving typical setup, compilation, and linking problems. Covers common misconfigurations, platform-specific quirks, and directs users to documentation and diagnostics for deeper problem-solving."
---

# Troubleshooting Common Setup Issues

Setting up GoogleTest and GoogleMock is mostly straightforward, but occasionally, users encounter setup, compilation, or linking problems. This guide helps you identify and resolve frequent issues, providing practical tips and directing you to deeper diagnostics and documentation.

---

## 1. Common Installation and Build Issues

### 1.1 Build Failures Due to Missing Dependencies or Incorrect Compiler

- **Problem:** Compilation errors such as missing headers, or unrecognized standard library features.
- **Cause:** Not meeting the prerequisites or using an unsupported compiler version.

**How to Fix:**
- Confirm your compiler supports at least C++17 standard. GoogleTest and GoogleMock require C++17.
- Verify that all dependencies and toolchains outlined in the [Prerequisites & System Requirements](/getting-started/setup-prerequisites-installation/prerequisites-system-requirements) page are installed and the environment variables set.
- On Linux, ensure you have development tools and libraries installed.
- On Windows, prefer MSVC 2017 or later; ensure SDK and toolset are appropriate.

### 1.2 Linking Errors

- **Problem:** Linker errors reporting missing symbols for GoogleTest or GoogleMock functions.
- **Cause:** Libraries are not linked properly.

**How to Fix:**
- Make sure to link against the correct libraries, typically `gtest`, `gtest_main`, and `gmock` or `gmock_main`.
- If using CMake, use `find_package(GTest REQUIRED)`, then link your test targets with `target_link_libraries(your_target GTest::gtest GTest::gtest_main GTest::gmock)`.
- When manually building, ensure compiled static or shared libraries are correctly referenced in your linker command.
- Verify that your build system passes the appropriate compiler flags for C++17 and includes the directories with GoogleTest headers.

### 1.3 Incompatible or Missing Initialization

- **Problem:** Tests run but GoogleTest or GoogleMock features (such as mock printing verbosity) don't appear to work correctly.
- **Cause:** Improper initialization of the test framework.

**How to Fix:**
- Always call `testing::InitGoogleTest()` or `testing::InitGoogleMock()` before `RUN_ALL_TESTS()`.
- If you write your own `main()` function, ensure it calls `InitGoogleTest(&argc, argv);` or `InitGoogleMock(&argc, argv);` exactly once.
- Alternatively, link against `gtest_main` or `gmock_main` which provide a default main.

***Example of a minimal main function initializing gMock and gTest:***

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 2. Platform-Specific and Environment Quirks

### 2.1 Microsoft Visual C++ (MSVC) Warnings and Errors

- You may encounter warnings like `C4301` or `C4373` related to `const` parameters when mocking methods.
- **Fix:** Remove `const` from top-level parameters in mock methods, as it has no effect in method declarations but triggers MSVC warnings.

### 2.2 Compiler Memory or Performance Issues

- Mock classes with many methods may lead to long compile times or out-of-memory errors.
- **Fix:**
  - Move mock class constructor and destructor definitions to `.cc` files to reduce recompilation.
  - Use `-j` flag or equivalent to parallelize builds.

### 2.3 Thread Safety Issues

- GoogleTest and GoogleMock are thread-safe on most POSIX platforms with pthreads.
- On some platforms (e.g., Windows), simultaneous ASSERT or EXPECT calls from multiple threads may cause undefined behavior.
- **Fix:** Run your test code (not the code being tested) in a single thread, or serialize access to mocks.

### 2.4 Special Platform Constraints (Embedded, ESP, Arduino)

- GoogleTest initialization and execution may differ.
- Consult platform-specific README files or the [Integration and Platform Support](/overview/features-integration/integration-and-platforms) for details.

---

## 3. Mock Class Setup Issues

### 3.1 Mock Method Not Being Called or Real Method Called Instead

- Ensure mocked methods are **virtual**; non-virtual methods cannot be mocked in the standard way.
- For non-virtual methods, consider alternative patterns, such as dependency injection or template-based mocking as discussed in the [gMock Cookbook](docs/gmock_cook_book.md#MockingNonVirtualMethods).

### 3.2 Uninteresting Call Warnings

- If your mock methods are called without matching `EXPECT_CALL`, warnings appear.
- To suppress warnings:
  - Use `NiceMock<YourMock>` to silence all such warnings, or
  - Add an `EXPECT_CALL(your_mock, Method(_)).Times(AnyNumber())` catch-all expectation.

### 3.3 Unexpected Calls Fail Tests

- If calls are made to mocks that do not match any `EXPECT_CALL`, tests fail.
- Review your expectations; ensure all legitimate calls are expected.
- Use wildcard matchers (`_`) if specific argument values are not essential.

### 3.4 Using NiceMock, NaggyMock, and StrictMock Correctly

- `NiceMock` suppresses uninteresting call warnings.
- `NaggyMock` logs uninteresting call warnings (default behavior).
- `StrictMock` treats uninteresting calls as test failures.

Choose according to your testing needs.

---

## 4. Debugging and Diagnostics

### 4.1 Using --gmock_verbose Flag

- Run your tests with `--gmock_verbose=info` to see detailed information about mock calls, including matching expectations and stack traces.
- Control stack trace depth via `--gtest_stack_trace_depth=0` to suppress stack traces if too verbose.

### 4.2 Catching Leaked Mocks

- Enable mock leak detection by setting `--gmock_catch_leaked_mocks=true` or programmatically with `GMOCK_FLAG_SET(catch_leaked_mocks, true);`.
- Helps ensure mocks are properly destroyed and verified.

### 4.3 Forced Verification

- When mocks live beyond the scope of your tests or are heap-allocated, use `testing::Mock::VerifyAndClearExpectations(&mock_object);` to verify expected calls early.

### 4.4 Typical Error Messages and Their Meaning

| Error Message                                   | Meaning & Guidance                                               |
| -----------------------------------------------|-----------------------------------------------------------------|
| `Upper bound of expectations reached`          | Your mock method was called more often than expected. Check `Times()` clause.
|
| `Uninteresting mock function call encountered` | No expectation matched: consider adding `EXPECT_CALL` or use `NiceMock`.
|
| `Unexpected call with no expectation`          | Means an unexpected call happened; check your `EXPECT_CALL` coverage.
|
| `Mock method calls do not happen in the expected order` | Use sequences like `InSequence` to enforce call order or relax order requirements.

---

## 5. Additional Resources

- Refer to the [gMock for Dummies](docs/gmock_for_dummies.md) for practical examples and explanations.
- Consult the [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) for quick reference on mocking syntax.
- Explore the [Mocking Reference](docs/reference/mocking.md) for macro and API details.
- See the [gMock Cookbook](docs/gmock_cook_book.md) for advanced usage recipes.
- Use the [Getting Started Installation Guides](/getting-started/setup-prerequisites-installation/) for environment setup and configuration details.

---

## 6. Summary of Troubleshooting Checklist

<AccordionGroup title="Troubleshooting Checklist">
<Accordion title="Build and Compiler Issues">
- Confirm C++17 support and compatible compiler.
- Ensure all dependencies are installed and environment variables set.
- Use supported build systems and proper flags.
</Accordion>
<Accordion title="Linking Problems">
- Link with `gtest`, `gtest_main`, `gmock`, and `gmock_main` libraries correctly.
- Verify library search paths and linker configurations.
</Accordion>
<Accordion title="Mock Method Issues">
- Ensure methods to mock are virtual.
- Set expectations before calls.
- Use `NiceMock` to suppress unexpected call warnings.
- Verify mock destruction to validate expectations.
</Accordion>
<Accordion title="Test Framework Initialization">
- Call `InitGoogleTest()` or `InitGoogleMock()` once before `RUN_ALL_TESTS()`.
- Use provided `gtest_main` or `gmock_main` for automatic main if suitable.
</Accordion>
<Accordion title="Debugging Tools">
- Use `--gmock_verbose=info` for detailed mock call tracing.
- Use `Mock::VerifyAndClearExpectations()` for manual verification.
- Check for leaked mocks with `--gmock_catch_leaked_mocks`.
</Accordion>
</AccordionGroup>

<Tip>
Always set your mock expectations before the code that exercises the mock is invoked. This avoids undefined behavior and ensures clear error messages.
</Tip>

<Warning>
Avoid over-specifying expectations by setting unnecessary constraints; aim for tests that verify contracts, not implementations.
</Warning>

---

## 7. Example: Debugging a Common Linking Error

Suppose you get an undefined reference to a GoogleTest symbol during linking.

**Steps to resolve:**

```text
1. Check if the linker options include the path to GoogleTest and GoogleMock libraries.
2. Confirm you link with both gtest and gmock libraries if you use mocks.
3. For CMake, verify your `target_link_libraries()` contains `GTest::gtest`, `GTest::gtest_main`, and `GTest::gmock`.
4. If building manually, add `-lgtest -lgtest_main -lgmock -lgmock_main` and library paths.
5. Clean and rebuild your project.
```

If problems persist, see the [Installation Guide](getting-started/setup-prerequisites-installation/installation-platforms) or relevant platform-specific instructions.

---