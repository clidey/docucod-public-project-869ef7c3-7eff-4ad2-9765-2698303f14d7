---
title: "Troubleshooting Common Issues"
description: "Quickly resolve common errors encountered during setup or first usage. This page lists frequent mistakes, missing dependencies, compilation errors, and recommends validation steps to ensure users can get unstuck quickly."
---

# Troubleshooting Common Issues

Quickly resolve common errors encountered during setup or first usage of GoogleTest and GoogleMock. This guide addresses typical mistakes, missing dependencies, compilation errors, runtime failures, and provides validation suggestions to help you get unstuck rapidly and keep progressing smoothly.

---

## 1. Common Installation Problems

### 1.1. Missing Dependencies
- **Symptom:** Build errors referencing missing headers or libraries (e.g., `gtest/gtest.h` not found).
- **Cause:** GoogleTest/GoogleMock libraries are not installed or not found in include/link paths.
- **Solution:**
  1. Verify that the GoogleTest sources or binaries are properly cloned or installed.
  2. Check your build system configuration (CMake, Bazel, Makefile) to ensure correct include and link directories.
  3. Follow the official [Installing with CMake guide](../installation-and-configuration/installing-googletest-cmake) or [Bazel setup](../installation-and-configuration/installing-googletest-bazel).

### 1.2. Compiler Compatibility Issues
- **Symptom:** Compilation warnings or errors related to virtual destructors or missing C++17 support.
- **Cause:** Using older compilers or incorrect compiler flags.
- **Solution:**
  1. Confirm your compiler supports C++17. GoogleTest requires C++17 standard.
  2. Set appropriate compiler flags, e.g., `-std=c++17`.
  3. Refer to the [Supported Platforms & Toolchains](../integration-and-ecosystem/supported-platforms) documentation.


## 2. Compilation and Linking Errors

### 2.1. Virtual Destructor Must Be Present
- **Symptom:** Heap check failures, memory leaks, or runtime crashes when deleting mock objects.
- **Cause:** Mocked interfaces do not declare destructors as virtual.
- **Solution:**
  - Always declare destructors in base classes virtual. For example:

```cpp
class MyInterface {
 public:
  virtual ~MyInterface() {}  // Must be virtual
  virtual void DoSomething() = 0;
};
```

- Without a virtual destructor, deleting derived mock objects through base pointers causes undefined behavior.

### 2.2. Macro Name Conflicts
- **Symptom:** Compilation errors due to unexpected macro expansions (e.g., `Method` macro conflicts).
- **Cause:** Platform or library headers define macros that conflict with method names in your mocks.
- **Solution:**
  1. Use the latest GoogleMock versions, which handle expanded method names in macros (see `gmock-spec-builders_test.cc`).
  2. Explicitly `#undef` conflicting macros before mock definitions.
  3. Rename mocked methods if conflicts persist.

### 2.3. Mock Method Argument Comma Issues
- **Symptom:** Mock method macros fail to compile when argument or return types contain commas (e.g., templates).
- **Cause:** `MOCK_METHOD` misparses unprotected commas in argument/return types.
- **Solution:**
  1. Wrap argument or return types with parentheses:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

  2. Or define and use type aliases:

```cpp
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetPair, ());
```

- See the [gMock Cookbook - Creating Mock Classes](../gmock_cook_book#mock-class) for details.


## 3. Runtime and Testing Failures

### 3.1. Unexpected or Uninteresting Calls
- **Symptom:** Warnings/errors such as:
  - "Uninteresting mock function call - returning default value."
  - "Unexpected mock function call - returning default value."
- **Cause:** Calls to mock methods that do not have matching `EXPECT_CALL` or are outside the defined expectations.
- **Solution:**
  1. Decide if the call is expected.
  2. If expected, add an `EXPECT_CALL` with a suitable matcher or `Times(AnyNumber())`.
  3. Use `ON_CALL` to define default actions without setting expectations if you only want to specify behavior but not verify calls.
  4. To suppress warnings without failing tests, use `NiceMock<T>` instead of `Mock<T>`.

#### Example: Allow any arguments and suppress warnings

```cpp
EXPECT_CALL(mock_obj, SomeMethod(_)).Times(AnyNumber());
```

- For detailed discussion see [The Nice, the Strict, and the Naggy](../gmock_cook_book#nicestrictnaggy).

### 3.2. Calls Made Too Many Times (Excessive Calls)
- **Symptom:** Errors:
  - "Mock function called more times than expected ..."
- **Cause:** Calls exceed the maximum `Times()` specified.
- **Solution:**
  1. Review your `EXPECT_CALL().Times()` usage.
  2. Adjust the cardinality to accommodate the actual number of calls.
  3. Consider using `.RetiresOnSaturation()` if you want expectations to become inactive once fulfilled.

### 3.3. Calls Made Too Few Times (Unsatisfied Expectations)
- **Symptom:** Error messages about expectations not met:
  - "Actual function call count doesn't match this expectation"
- **Cause:** The tested code missed calls expected by the test.
- **Solution:**
  1. Review that your test exercised the code paths that invoke the expected calls.
  2. Use `--gmock_verbose=info` to log mock function calls and understand call patterns.
  3. Adjust or remove overly strict expectations to suit the test intent.

### 3.4. Mismatched Arguments
- **Symptom:** Errors indicating expectations are unmet due to argument mismatch.
- **Cause:** The actual function call arguments do not match those specified in `EXPECT_CALL`.
- **Solution:**
  1. Use more flexible argument matchers (e.g., `_` for anything, or `Gt()`, `Le()`).
  2. Use composite matchers such as `With()` to match multiple arguments collectively.
  3. Check for typographic errors or data mismatches in test code.

### 3.5. Order of Expectations Failures
- **Symptom:** Failures saying calls happened out of expected order.
- **Cause:** The test sets expectations with ordering constraints (e.g., `InSequence` or `After`) that the code violates.
- **Solution:**
  1. Verify if strict call order is necessary.
  2. Use `InSequence` blocks consciously to enforce order.
  3. Relax ordering constraints if they cause brittle tests.


## 4. Validation and Diagnostics

### 4.1. Using `--gmock_verbose=info`
- Enables detailed logging of mock function calls, expectations, and their matches.
- Helps identify which expectations matched or failed and why.

### 4.2. Checking for Mock Object Leaks
- **Symptom:** Errors on test exit stating leaked mock objects.
- **Cause:** Mock objects not being destroyed.
- **Solution:**
  1. Ensure mocks are properly deleted or go out of scope.
  2. If intentional, suppress with `Mock::AllowLeak(&mock_obj);`.
  3. Remember that expectation verification runs upon destruction; leaks may mask test failures.

### 4.3. Verifying and Clearing Expectations Manually
- Call `Mock::VerifyAndClearExpectations(&mock_obj)` to verify expectations before destruction.
- Useful in complex ownership scenarios where destructor timing is uncertain.

### 4.4. Heap Check Failures
- Indicate improper memory management, often due to missing virtual destructors or improper mock cleanup.
- Fix by ensuring virtual destructors and correct lifecycle management.


## 5. Best Practices During Troubleshooting

- **Set Clear Expectations:** Use `EXPECT_CALL` only where verification is needed; use `ON_CALL` for default behavior.
- **Avoid Over-Specifying:** Write expectations to express meaningful contracts rather than rigid call counts or exact arguments unless strictly required.
- **Use Verbosity Levels Wisely:** Use `--gmock_verbose=info` for detailed debugging and `warning` or `error` for normal runs.
- **Prefer `NiceMock` for General Tests:** Reduce noise from uninteresting calls unless you want to enforce strict call checks.
- **Sequence and After:** Use call ordering cautiously to avoid brittle tests.
- **RetiresOnSaturation:** Use to prevent upper-bound errors when repeated calls to the same expectation are allowed but limited.


## 6. Example Troubleshooting Scenario

### Problem:
You get a warning: "Uninteresting mock function call - returning default value" while running your test.

### Steps to debug:
1. Identify the mock object and method from the warning output.
2. Check if you have an `EXPECT_CALL` for that method.
3. If no `EXPECT_CALL`, decide if the call should be expected:
   - If yes, add `EXPECT_CALL(mock, Method(...)).Times(AnyNumber());`.
   - If no, consider if the call indicates a bug.
4. Alternatively, switch to using `NiceMock<YourMock>` class to suppress the warning.
5. Use `--gmock_verbose=info` to trace the mock call flow.


---

## 7. Additional Resources

- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - practical recipes for defining and using mocks.
- [GoogleMock FAQ](https://google.github.io/googletest/gmock_faq.html) - explanations on common confusions and problems.
- [Expectations and Actions Reference](../reference/mocking.md) - detailed macros and behaviors.
- [Getting Started Writing and Running Your First Test](../first-test-and-validation/writing-and-running-your-first-test) - for hands-on learning.
- [Installation and Setup](../installation-and-configuration/installing-googletest-cmake) - verifying environment correctness.

---

## 8. Quick Checklist for Troubleshooting

| Issue                                      | Action                                                             |
|--------------------------------------------|--------------------------------------------------------------------|
| Missing headers/libraries                   | Verify installation and include/link paths.                        |
| Virtual destructor missing                  | Add `virtual` to base class destructor.                            |
| Unexpected mock function calls              | Add or adjust `EXPECT_CALL` or `ON_CALL`.                          |
| Uninteresting call warnings                  | Use `NiceMock`, or add catch-all `EXPECT_CALL(...).Times(AnyNumber())`.
|
| Calls too many or too few                    | Check and adjust `Times()` cardinality and `.RetiresOnSaturation()`.
|
| Order-related failures                      | Review sequences and `After` clauses.                              |
| Mock object leaks detected                   | Ensure proper destruction or use `Mock::AllowLeak()`.               |
| Macro conflicts                             | Undefine or rename conflicting macros.                             |

---

<Tip>
For persistent or complex issues, enable verbose logging via `--gmock_verbose=info` and carefully analyze the detailed call traces. Also, ensure your mock classes strictly follow best practices regarding method mocking and lifecycle management.
</Tip>

<Note>
GoogleMock’s warnings and errors are designed to guide you to better tests and clearer contracts. Paying attention to them improves test reliability and maintainability.
</Note>

---

_For detailed information on GoogleMock usage and advanced troubleshooting, refer to the [gMock documentation](https://google.github.io/googletest/gmock_for_dummies.html) and the [GoogleTest Primer](../first-test-and-validation/quickstart-primer)._
