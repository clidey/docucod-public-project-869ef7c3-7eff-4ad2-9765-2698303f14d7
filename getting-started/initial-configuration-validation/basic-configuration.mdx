---
title: "Basic Configuration"
description: "Explains how to add GoogleTest/GoogleMock to a new or existing C++ project, including linking, include paths, and recommended directory layouts. Addresses configuration for both main build systems (CMake, Bazel)."
---

# Basic Configuration

This guide explains how to add **GoogleTest** and **GoogleMock** to a new or existing C++ project. It covers the essential steps for configuring include paths, linking libraries, and arranging your directories. Both main build systems, **CMake** and **Bazel**, are addressed to help you get started quickly and effectively.

---

## 1. Overview: Why Configure GoogleTest and GoogleMock

GoogleTest and GoogleMock provide a robust, portable, and flexible framework for writing and running C++ tests with mocking capabilities. To use them properly, your project must:

- Find and use the necessary headers.
- Correctly link against the libraries.
- Organize source and test code for maintainability and scalability.

Setting this up correctly from the start avoids build errors, linkage conflicts, and confusing setup during test execution.

---

## 2. Directory Layout Recommendations

Organizing your project directory structure can simplify managing GoogleTest/GoogleMock sources and your tests.

A common pattern is:

```
my_project/
  ├── CMakeLists.txt       # Main build file
  ├── src/                 # Your application source code
  ├── include/             # Your application headers
  ├── tests/               # Your test source files
  │    ├── CMakeLists.txt  # Build tests separately
  │    └── ...
  └── third_party/         # For vendored dependencies (optional)
       └── googletest/     # GoogleTest source if vendored
```

**Tip:** Instead of vendoring GoogleTest source, better approaches include using package managers, Git submodules, or downloading GoogleTest as part of the build (see below).

---

## 3. Configuring with CMake

CMake users have two straightforward ways to integrate GoogleTest and GoogleMock:

### 3.1 Building GoogleTest as a Standalone Project

If you want to build and install GoogleTest separately, follow these steps:

```bash
# Clone the GoogleTest repository (version 1.17.0 used here).
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
mkdir build
cd build
# Generate build files with both GoogleTest and GoogleMock included.
cmake ..
# Build the libraries.
make
# Optionally install to the system (requires root/admin).
sudo make install
```

**On Windows**: Open the generated Visual Studio solution `gtest.sln` from the `build` directory and build the solution.

**On macOS**: Use the generated `.xcodeproj` similarly.


### 3.2 Adding GoogleTest to an Existing CMake Project

You can directly incorporate GoogleTest's source code into your project, ensuring compiler/linker settings stay consistent.

#### Recommended Method: Use CMake FetchContent

Insert the following in your main `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Visual Studio: Use shared CRT to prevent linker errors.
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

# Example: add your test executable and link against gtest_main
add_executable(my_test tests/my_test.cpp)
target_link_libraries(my_test PRIVATE gtest_main)

# Register tests for CTest
include(CTest)
add_test(NAME MyTest COMMAND my_test)
```

> **Requirements**: CMake 3.14 or later is needed for `FetchContent_MakeAvailable()`.

#### Alternative Approaches

- Add GoogleTest source code directly into your project (not recommended for maintainability).
- Use Git submodules to manage GoogleTest as a dependency.


### 3.3 Include and Link Settings

- Include headers `<gtest/gtest.h>` and `<gmock/gmock.h>` in your test sources.
- Link test executables against `gtest`, `gtest_main`, `gmock`, and/or `gmock_main` as appropriate.
- Use `gtest_main` or `gmock_main` for a supplied `main()` function that runs tests.


### 3.4 C++ Standard Compatibility

Ensure your project uses at least C++17 (required by GoogleTest). For example, add to your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```


### 3.5 Handling Visual Studio Runtime Conflicts

Visual Studio's default dynamic CRT linkage may conflict with GoogleTest's static CRT linkage.

Use this CMake option to align runtimes:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This makes GoogleTest link against the dynamic runtime, avoiding linker errors.

---

## 4. Configuring with Bazel

While this page focuses on CMake, GoogleTest and GoogleMock also support [Bazel](https://bazel.build/).

- GoogleTest can be included using Bazel's `@com_google_googletest` repository.
- Add `@com_google_googletest` target dependencies like `//external:googletest` to your Bazel build files.

Consult the [Bazel installation guide](https://github.com/google/googletest/tree/main/googletest#bazel) for details.

---

## 5. Using GoogleMock in Your Project

GoogleMock is included when building GoogleTest by default.

- Include GoogleMock headers with `#include <gmock/gmock.h>`.
- Initialize GoogleMock in your test executable's `main()` by calling:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Alternatively, link with `gmock_main` to use the default `main()` provided by GoogleMock.

**Note:** `InitGoogleMock()` also initializes GoogleTest, so there's no need to call `InitGoogleTest()` separately.

---

## 6. Basic Example: Adding GoogleTest and GoogleMock to a CMake Project

Assuming you want to add tests to your existing project:

### Step 1: Add FetchContent for GoogleTest

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

### Step 2: Write Your Test Source

Create `tests/example_test.cpp`:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

// Simple test example
TEST(ExampleTest, BasicAssertion) {
  EXPECT_EQ(1 + 1, 2);
}
```

### Step 3: Add Executable and Link Libraries

```cmake
add_executable(example_test tests/example_test.cpp)
target_link_libraries(example_test PRIVATE gtest_main gmock_main)
add_test(NAME ExampleTest COMMAND example_test)
```

### Step 4: Build and Run

```bash
mkdir build && cd build
cmake ..
cmake --build .
ctest
```

You should see GoogleTest and GoogleMock running and passing your tests.

---

## 7. Practical Tips and Common Pitfalls

- Always ensure consistent CRT linkage on Windows by using `gtest_force_shared_crt` option.
- Keep GoogleTest and GoogleMock versions fixed to a known release for stability.
- When mocking, always include `gmock/gmock.h`, which pulls in GoogleTest headers as well.
- Use `gmock_main` or `gtest_main` libraries if you prefer not to write your own `main()`.
- If you encounter linker errors, verify that you link against both gtest and gmock libraries.
- Avoid multiple conflicting copies of GoogleTest sources or binaries in your project tree.

---

## 8. Troubleshooting

<AccordionGroup title="Common Issues During Configuration">
<Accordion title="Linker errors related to CRT on Windows">
Most linker errors involving `RuntimeLibrary` mismatch happen because GoogleTest links statically and your project links dynamically.

**Solution:** In your `CMakeLists.txt`, add:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

and rebuild.
</Accordion>

<Accordion title="Build fails due to missing C++17 support">
GoogleTest requires C++17 or newer.

**Solution:** Make sure your compiler supports C++17 and your `CMakeLists.txt` sets:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Alternatively, use compiler flags directly.
</Accordion>

<Accordion title="GoogleTest headers not found">
Ensure your include paths include GoogleTest's headers. When using `FetchContent`, linking with `gtest_main` or `gmock_main` will handle this automatically.

Verify your include statements use:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

Incorrect include paths cause this common issue.
</Accordion>
</AccordionGroup>

---

## 9. Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest): Source, releases, issues.
- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Beginner's guide to mocking.
- [CMake Documentation](https://cmake.org/documentation/): For build system specifics.

For further usage of mocking capabilities, see the [Mocking Reference](../api-reference/mocking-apis/creating-mocks) and [Advanced Mocking & Test Design Patterns](../googletest-guides/advanced-mocking-patterns/intro-to-mocking) guides in this documentation.

---