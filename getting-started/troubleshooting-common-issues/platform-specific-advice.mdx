---
title: "Platform-Specific Advice"
description: "Summarizes known issues and mitigation strategies for Windows, macOS, and Linux environments, drawing from both internal documentation and community contributions. Includes references to relevant shell scripts and platform guides."
---

# Platform-Specific Advice for GoogleTest

This guide provides targeted advice and known issue workarounds for using GoogleTest across major platforms including Windows, macOS, and Linux. These recommendations are drawn from both internal documentation and community feedback, helping ensure smooth integration and operation in your development environment.

---

## 1. Windows Platform

### Common Issues and Mitigation

- **Runtime Library Mismatch**

  The most frequent problem on Windows involves mismatched C runtime libraries between GoogleTest and your project, leading to linker errors such as:

  ```
  gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
  ```

  To resolve this:

  1. Enable the `gtest_force_shared_crt` option during `cmake` configuration to align runtime linkage (dynamic vs static):

     ```bash
     cmake .. -Dgtest_force_shared_crt=ON
     ```

  2. Ensure your Visual Studio project and all dependencies consistently use the same runtime.

- **Unicode Main Function Support**

  When compiling with `UNICODE`, GoogleTest supports wide-string command-line arguments transparently. If you implement a custom `main()`, use:

  ```c++
  int wmain(int argc, wchar_t** argv) {
    testing::InitGoogleTest(&argc, argv);
    return RUN_ALL_TESTS();
  }
  ```

- **Visual Studio Linking Bugs**

  Some versions of MSVC on Windows have known bugs causing link errors with `_tmain` and static libraries. The recommended workaround is to use `main()` instead of `_tmain()` in your test executable entry point.

### Best Practices

- Prefer linking against the prebuilt `gtest_main` library unless custom initialization is required.
- Always build GoogleTest with the same toolchain and settings as your tests to avoid ABI incompatibilities.

---

## 2. macOS Platform

### Known Challenges

- **Xcode & Clang Compatibility**

  GoogleTest is fully compatible with Apple Clang and Xcode, but you should ensure your project settings specify a minimum C++17 standard:

  ```bash
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

- **Code Signing & Gatekeeper**

  When running test binaries on newer versions of macOS, unsigned executables may be blocked. Sign your binaries or execute them via terminal to bypass Gatekeeper restrictions during development.

### Recommendations

- Use CMakeâ€™s native support and `FetchContent` for dependency management to ensure smooth builds.
- Test execution via Terminal gives more immediate visibility into results.

---

## 3. Linux Platform

### Common Issues and Resolutions

- **Missing pthread Linkage**

  Compiler and linker errors related to `pthread` (POSIX threads) are common if linker flags are omitted:

  ```bash
  -pthread
  ```

  Add this flag in both compile and link stages. If using CMake, this is handled automatically.

- **C++17 Requirement**

  Ensure the compiler supports C++17. Use:

  ```bash
  g++ -std=c++17 ...
  ```

- **Shared Libraries vs Static Linking**

  If building GoogleTest as shared libraries, add the compile flags:

  ```bash
  -DGTEST_CREATE_SHARED_LIBRARY=1
  -DGTEST_LINKED_AS_SHARED_LIBRARY=1
  ```

  Provide appropriate linker instructions for shared objects.

### Tips

- Use the standard build process with CMake for easier library management.
- When running tests that involve death tests, ensure that the environment supports required system calls and file system access.

---

## 4. Embedded and Specialized Platforms

- **Arduino-like Platforms (ESP8266, ESP32, NRF52)**

  GoogleTest adapts test execution to platforms where the traditional `main()` entry point is unavailable. Initialization occurs inside `setup()` and tests run continuously in `loop()`.

- **QuRT Platform**

  The main entry point is overridden to work with platform-specific argument constraints. Tests still execute through `RUN_ALL_TESTS()`.

---

## 5. Platform-Specific Initialization Patterns

| Platform             | Main Function Prototype                               | Notes                                                                |
|----------------------|-------------------------------------------------------|----------------------------------------------------------------------|
| Normal platforms      | `int main(int argc, char** argv)`                     | Standard GoogleTest initialization with parsed command-line flags.  |
| Arduino-like         | `void setup()` / `void loop()`                         | init in `setup()`, tests run in `loop()`.                            |
| QuRT                 | `int main()`                                          | Argc/argv unavailable; minimal init performed.                       |

---

## 6. Configuration Macros and Customization

For special platform needs, you can define several macros as compiler flags to tweak GoogleTest behavior:

- Enable or disable pthread support:

  ```bash
  -DGTEST_HAS_PTHREAD=1
  ```

- Build as shared or static library:

  ```bash
  -DGTEST_CREATE_SHARED_LIBRARY=1
  -DGTEST_LINKED_AS_SHARED_LIBRARY=1
  ```

- Avoid macro name clashes with other libraries:

  ```bash
  -DGTEST_DONT_DEFINE_TEST=1
  ```

For a full list of customization macros, see `gtest-port.h` in the source tree.

---

## 7. Troubleshooting Common Platform Issues

<AccordionGroup title="Platform-Specific Troubleshooting">
<Accordion title="Windows Runtime Library Mismatch">
Linker errors like `LNK2038` usually result from static vs dynamic CRT mismatches. Use the `gtest_force_shared_crt` CMake option and ensure project runtime settings match.
</Accordion>
<Accordion title="Linux pthread Linker Errors">
Add `-pthread` to the compiler and linker command lines. If not using CMake, manual addition is required.
</Accordion>
<Accordion title="macOS Gatekeeper Blocking Executables">
Sign your test binaries or run via Terminal. Use `xattr -d com.apple.quarantine <binary>` to remove quarantine attribute if necessary.
</Accordion>
<Accordion title="Command-line Argument Parsing Issues">
On embedded platforms or special OSes that don't provide standard argc/argv, GoogleTest adapts by initializing differently. Check platform-specific `main()` functions.
</Accordion>
</AccordionGroup>

---

## 8. Additional Resources

- [GoogleTest Installation & Setup](https://google.github.io/googletest/quickstart-cmake.html)
- [System Requirements & Prerequisites](../getting-started/prerequisites-installation/system-requirements.md)
- [Common Installation & Setup Issues](../getting-started/troubleshooting-common-issues/common-installation-issues.md)
- [Integration & Extensibility Overview](../overview/features-and-integration/integration-overview.md)


<Check>
Remember: Consistent build settings and understanding your platform's capabilities ensure reliable GoogleTest integration. Always verify compiler and linker flags match your environment.
</Check>

---

## 9. Example: Custom Main Function for Windows (Unicode)

```c++
#include <gtest/gtest.h>

int wmain(int argc, wchar_t** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

## 10. Example: CMake Configuration to Enforce Shared CRT on Windows

```bash
cmake .. -Dgtest_force_shared_crt=ON
make
```

---

This advice is designed to improve your development workflow with GoogleTest on different platforms, preventing common pitfalls and helping you get tests running smoothly and efficiently.


---

*Last updated from GoogleTest version main branch, source at [github.com/google/googletest](https://github.com/google/googletest)*
