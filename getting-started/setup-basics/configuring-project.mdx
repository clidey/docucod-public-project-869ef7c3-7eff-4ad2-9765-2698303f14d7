---
title: "Configuring Your Project"
description: "Walks users through integrating GoogleTest and GoogleMock into their own projects, with attention to build system configuration (CMake, Bazel), include paths, and linking options. Clarifies typical project structure and necessary configuration tweaks."
---

# Configuring Your Project with GoogleTest and GoogleMock

This guide walks you through integrating **GoogleTest** and **GoogleMock** into your C++ project. You will learn how to configure your build system (focusing on CMake and Bazel), set up include paths, and properly link the libraries. We also clarify the typical project structure and necessary configuration tweaks to get you up and running efficiently.

---

## 1. Understanding Your Project Setup

Before you start configuring, understand the role of GoogleTest and GoogleMock in your project:

- **GoogleTest** is a powerful C++ testing framework.
- **GoogleMock** extends GoogleTest by providing a rich framework for creating mock objects, allowing interaction-based testing.

You'll need to integrate these libraries in a way that your build system can find and link them properly.


## 2. Including GoogleTest and GoogleMock in Your Build

### 2.1 Consider Your Build System

This guide covers configuration for the two most common build systems:

- **CMake**
- **Bazel**

If you use a different build system, the principles are similar, but you might need to adapt accordingly.

### 2.2 Typical Directory Structure

A conventional project may look like this:

```
/my_project
  /src
    ... your source files ...
  /tests
    mock_classes.h
    your_test_files.cc
  CMakeLists.txt or BUILD
```

- Place mock class definitions inside your test folder (`mock_classes.h` is common).
- Keep source and test code separate for clarity.


## 3. Configuring with CMake

CMake integration is common and straightforward if you follow these steps:

### Step 1: Fetch or Add GoogleTest as a Dependency

You can add GoogleTest and GoogleMock by either cloning the googletest repository or using a package manager that supplies it.

Example using `FetchContent` to clone and add GoogleTest:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.13.0.zip
)
FetchContent_MakeAvailable(googletest)
```


### Step 2: Link GoogleTest and GoogleMock

Since GoogleMock is bundled with GoogleTest, linking `gmock` will also include GoogleTest.

Example for your test executable:

```cmake
add_executable(my_tests tests/my_tests.cc tests/mock_classes.h)
target_link_libraries(my_tests gmock_main)
```

- Use `gmock_main` to link GoogleMock and the main function for testing.


### Step 3: Add Include Directories

CMake target dependencies typically supply include directories automatically.

However, if not, explicitly add:

```cmake
target_include_directories(my_tests PRIVATE ${gtest_SOURCE_DIR}/include ${gmock_SOURCE_DIR}/include)
```


### Step 4: Enable Testing

Ensure you enable CTest and add your tests:

```cmake
enable_testing()
add_test(NAME MyTest COMMAND my_tests)
```


### Verification

- Build your tests using `cmake` and `make` or your preferred generator.
- Run `ctest` or execute the test binary directly: `./my_tests`


## 4. Configuring with Bazel

Bazel users can integrate GoogleTest and GoogleMock using Bazel rules, as the repository provides the necessary BUILD files.

### Step 1: Add GoogleTest and GoogleMock Repository

Add the following to your `WORKSPACE`:

```python
http_archive(
    name = "com_google_googletest",
    url = "https://github.com/google/googletest/archive/release-1.13.0.zip",
    strip_prefix = "googletest-release-1.13.0",
)
```

### Step 2: Declare Your Test Target

In your `BUILD` file:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc", "mock_classes.h"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

- Using `gmock_main` provides both gMock and the test main entry point.

### Step 3: Build and Run Tests

Run Bazel build and test commands:

```bash
bazel build //:my_test
bazel test //:my_test
```


## 5. Writing Mock Classes Effectively

Use the `MOCK_METHOD` macro from GoogleMock to define mock classes.

### Example Mock Class Definition

Given an interface:

```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual void Process(int x) = 0;
};
```

Define a mock:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Process, (int x), (override));
};
```

### Using Mock Modifiers: NiceMock, NaggyMock, StrictMock

You can wrap your mock types for different behaviors on uninteresting calls:

- **NiceMock**: suppresses warnings about uninteresting calls.
- **NaggyMock**: (default) warns on uninteresting calls.
- **StrictMock**: treats uninteresting calls as test errors.

Example usage:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, Process(42));

// nice_foo will not warn if Process() is called with other arguments.
```

### Important Notes

- `NiceMock`, `NaggyMock`, and `StrictMock` inherit constructors of your mock class, so you can construct them with appropriate arguments.
- They only affect mock methods defined **directly** in the mock class, not inherited ones.
- Your mock class should have a virtual destructor to avoid issues.


## 6. Best Practices and Common Pitfalls

- Always set your expectations (`EXPECT_CALL`) **before** exercising the code under test.
- Use wildcards (`_`) for arguments you don't need to specify explicitly.
- Use `.Times()`, `.WillOnce()`, and `.WillRepeatedly()` clauses to control how many times methods should be called and what they should return or do.
- To manage call order, use `InSequence` or call expectations `.After()` others.
- Use `RetiresOnSaturation()` if an expectation should become inactive after its calls are used up.
- Avoid mocking classes you do not own unless you place your mocks in the owner’s test namespace.
- For mocking concrete classes, prefer using interfaces and writing adaptors.


## 7. Troubleshooting Tips

- If you see warnings about uninteresting calls, consider whether you should suppress the warnings with a `NiceMock` or add appropriate `EXPECT_CALL`s.
- If your tests fail because of unexpected calls, verify argument matchers and call orders.
- To debug expectations, run your tests with `--gmock_verbose=info` for detailed output about mock calls and expectations.
- If a mock method returns a non-default-constructible type, ensure you specify a custom action or default value.
- If you get linker errors, check your build system’s linking step to ensure `gmock`, `gtest`, and their dependencies are correctly linked.


## 8. Additional Resources

- [GoogleTest & GoogleMock GitHub Repository](https://github.com/google/googletest)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [GoogleMock Mocking Reference](https://google.github.io/googletest/reference/mocking.html)


---

By following this configuration guide, you can successfully integrate GoogleTest and GoogleMock into your project build environment, define robust mock classes, and structure your testing code effectively.

For more detailed examples and advanced usage, consult our related guides on **Setting Up and Running Your First Test** and **Managing Mock Strictness with Nice, Naggy, and Strict Mocks**.
