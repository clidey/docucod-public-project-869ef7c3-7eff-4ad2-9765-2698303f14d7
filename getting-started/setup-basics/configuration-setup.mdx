---
title: "Configuration & Initial Integration"
description: "Lead users through linking GoogleTest and GoogleMock to their C++ project, configuring build files, and setting up the first test target. Covers required include paths, header usage, and how to structure a test directory within a project."
---

# Configuration & Initial Integration

This guide leads you through integrating GoogleTest and GoogleMock into your C++ project. You will learn how to configure your build files, link necessary libraries, set include paths, and structure your test directories for a smooth start with your first test targets.

---

## 1. Preparing Your Project for GoogleTest and GoogleMock

Before linking GoogleTest and GoogleMock, ensure the following prerequisites are in place:

- **GoogleTest and GoogleMock source or binaries**: Either install via package manager, include as submodules, or build from source.
- **Supported Compiler and C++17 Support**: Confirm your compiler supports at least C++17.
- **Build system compatibility**: This guide assumes a CMake-based project setup.


## 2. Linking GoogleTest and GoogleMock Libraries

GoogleTest provides pre-built libraries you can link to your tests, simplifying your `main()` implementation and test registration.

### 2.1 Libraries Overview

- `gtest`: GoogleTest core library.
- `gtest_main`: GoogleTest core + main function.
- `gmock`: GoogleMock core (built on GoogleTest).
- `gmock_main`: GoogleMock + GoogleTest core + main.

### 2.2 Choosing the Right Library
Link your test executable against `gtest_main` or `gmock_main` if you want the default main to be provided. Otherwise, you'll have to write your own `main()` function that initializes the framework.

---

## 3. Configuring CMake for GoogleTest and GoogleMock

### 3.1 Using Installed Libraries

If you have installed GoogleTest/GoogleMock (e.g., in `/usr/local`), you can find and link them via CMake's `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_main.cpp my_test1.cpp)
target_link_libraries(my_tests PRIVATE GTest::gmock_main)

# Optional: Enable testing and register
include(CTest)
add_test(NAME MyTest COMMAND my_tests)
```

### 3.2 Adding GoogleTest/GoogleMock as a Subdirectory

For projects embedding GoogleTest source, add the GoogleTest source tree and link directly:

```cmake
add_subdirectory(${path_to_googletest_src} googletest_build)

add_executable(my_tests test_main.cpp my_test1.cpp)
# Link against gmock_main for GoogleMock + GoogleTest main()
target_link_libraries(my_tests PRIVATE gmock_main)

include(CTest)
add_test(NAME MyTest COMMAND my_tests)
```

### 3.3 Include Path Setup

CMake targets `gmock` and `gmock_main` provide the include directories automatically. When linking these targets, your compiler will receive the necessary `-I` flags.


## 4. Structuring Your Test Directory

A clean directory structure helps maintain tests effectively and integrates well with CMake.

Recommended approach:

```
/project-root
  /src                  # Your main source files
  /tests                 # Your test sources
    CMakeLists.txt       # Test-specific CMake configuration
    test_example.cpp     # Example test file
```

In your `/tests/CMakeLists.txt`, define test executables and link GoogleTest/Mock:

```cmake
add_executable(example_test test_example.cpp)
target_link_libraries(example_test PRIVATE gmock_main)
add_test(NAME example_test COMMAND example_test)
```


## 5. Including GoogleTest and GoogleMock Headers

To write tests and mocks, include headers in your test files:

```cpp
#include <gtest/gtest.h>    // Core GoogleTest functionality
#include <gmock/gmock.h>    // GoogleMock functionality
```

 - Use `gtest/gtest.h` for writing standard tests.
 - Use `gmock/gmock.h` when you need mocking capabilities.


## 6. Writing and Linking Your First Test Target

### 6.1 Example Test File: `test_example.cpp`

```cpp
#include <gtest/gtest.h>

// A simple test case
TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
  EXPECT_TRUE(true);
}
```

### 6.2 Building and Running Your Test

Example using CMake:

- From your build directory:

```
cmake /path/to/project-root
make example_test
./example_test
```

- You should see output similar to:

```
Running main() from ...
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from SampleTest
[ RUN      ] SampleTest.BasicAssertions
[       OK ] SampleTest.BasicAssertions (0 ms)
[----------] 1 test from SampleTest
[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran.
[  PASSED  ] 1 test.
```


## 7. Writing Your Own `main()` Function (Optional)

If you prefer to manage the test executable yourself instead of linking with `gtest_main` or `gmock_main`, implement `main()` as follows:

```cpp
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Note:
- For GoogleMock, use `InitGoogleMock(&argc, argv)` instead of `InitGoogleTest`.


## 8. Best Practices and Tips

- **Keep test source files separate** from production code.
- **Use `gmock_main`** for GoogleMock projects to avoid writing `main`.
- **Use target linking** in CMake for automatic dependency and include management.
- **Use consistent naming conventions** for test suites and files (e.g., suffix with `_test.cpp`).
- **Do not** modify the GoogleTest/Mock sources directly; integrate them as external libraries.


## 9. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Common Errors">
<Accordion title="GoogleTest or GoogleMock Not Found on CMake Configure">
Check that the path to GoogleTest is correct, or that GoogleTest is installed. If using `find_package`, verify it can locate `GTestConfig.cmake` or the pkg-config data.
</Accordion>
<Accordion title="Linker Errors Missing Symbols like `RUN_ALL_TESTS`">
Ensure you link against `gtest_main` or `gmock_main` libraries, and not just `gtest` or `gmock`.
</Accordion>
<Accordion title="Include Files Not Found">
Confirm your target links to the `gtest`/`gmock` targets, which supply include directories. Don't manually set include paths unless necessary.
</Accordion>
<Accordion title="Multiple Definition Errors on `main`()">
Do not link both your own main() and `gtest_main` or `gmock_main` libraries simultaneously. Choose one method.
</Accordion>
</AccordionGroup>


## 10. Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) - Overview of the testing framework.
- [GoogleMock Quickstart](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) - Guide to mocking features.
- [Installation Methods](https://github.com/google/googletest/blob/main/docs/installation.md) - How to install and build GoogleTest and GoogleMock.


---

By following these steps, you establish a well-configured baseline to write, run, and maintain C++ tests and mocks effectively with GoogleTest and GoogleMock.
