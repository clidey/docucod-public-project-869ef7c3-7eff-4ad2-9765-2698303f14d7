---
title: "Configuration & Initial Setup"
description: "Guidance on configuring your build system and integrating GoogleTest with your C++ project. Covers basic CMake configuration, linking, include paths, and recommended project structures for both new and existing projects."
---

# Configuration & Initial Setup

Configure your build system to effectively incorporate GoogleTest into your C++ project. This guide covers essential CMake configurations, linking practices, include path settings, and recommendations for maintaining a clean project structure whether starting fresh or adding GoogleTest to an existing codebase.

---

## 1. Preparing Your Project for GoogleTest

Before running tests, your project needs to be aware of GoogleTest’s headers and libraries. The configuration depends heavily on your build system, with CMake integration being the most common.

### Key Objectives

- Make GoogleTest headers discoverable.
- Link your test targets with GoogleTest libraries.
- Maintain compatibility across platforms.

### Recommended Project Structure

Organize your source and test files to keep tests and production code separate but manageable:

```
/my_project
  /src
    ... production source files ...
  /include
    ... production headers ...
  /tests
    /unit
      ... GoogleTest tests go here ...
  CMakeLists.txt
```

Separating tests in their own directory helps keep dependencies clear and allows you to target test builds independently.

---

## 2. Basic CMake Configuration for GoogleTest

To integrate GoogleTest with your project using CMake, follow these steps:

<Steps>
<Step title="Find GoogleTest Package">
Use `find_package(GTest CONFIG REQUIRED)` to locate installed GoogleTest libraries and headers.

```cmake
find_package(GTest CONFIG REQUIRED)
```
This requires GoogleTest to be installed on your system or available via CMake package registry.

If GoogleTest is **not installed**, consider adding it as a subdirectory or use CMake’s `FetchContent` to download and embed GoogleTest:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)
```

This approach automatically downloads GoogleTest as part of your build.
</Step>
<Step title="Include Directories">
Add the GoogleTest include directories to your target:

```cmake
target_include_directories(your_test_target PRIVATE ${GTEST_INCLUDE_DIRS})
```

If using `FetchContent`, the target `gtest` already handles this, so this step is optional.
</Step>
<Step title="Linking Libraries">
Link your test executable against GoogleTest libraries:

```cmake
target_link_libraries(your_test_target PRIVATE GTest::gtest GTest::gtest_main)
```

If GoogleMock is required, add `GTest::gmock` and `GTest::gmock_main` as appropriate.
</Step>
<Step title="Enabling C++17 Standard">
Ensure your target compiles with at least C++17 to meet GoogleTest requirements:

```cmake
target_compile_features(your_test_target PRIVATE cxx_std_17)
```

Alternatively, set globally at the project or directory level:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```
</Step>
</Steps>

---

## 3. Example `CMakeLists.txt` Snippet for Your Tests

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject)

# Enable testing infrastructure
include(CTest)
enable_testing()

# Add FetchContent for GoogleTest if needed
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

# Add executable for your tests
add_executable(my_tests
  tests/unit/my_test1.cpp
  tests/unit/my_test2.cpp
)

# Link GoogleTest libraries
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gtest_main)

# Set C++ standard
target_compile_features(my_tests PRIVATE cxx_std_17)

# Register tests with CTest
add_test(NAME MyTests COMMAND my_tests)
```

<Tip>
It's best practice to build GoogleTest as part of your project or install it system-wide. Avoid mixing compiler versions or build types (debug/release) between GoogleTest and your code to prevent linker conflicts.
</Tip>

---

## 4. Handling Include Paths and Compiler Flags

- **Include Paths**: By linking to `GTest::gtest` or adding `${GTEST_INCLUDE_DIRS}`, your compiler will automatically find GoogleTest headers.

- **Compiler Flags**: GoogleTest requires C++17 support. If your project already targets a lower standard, you must override it.

- **Multi-threading Support**: GoogleTest detects `pthread` support automatically on Unix-like systems. If it fails to detect, you can forcibly enable or disable it by defining `GTEST_HAS_PTHREAD=1` or `GTEST_HAS_PTHREAD=0` on your compiler flags.

- **Shared vs Static Libraries**: Decide whether GoogleTest is linked statically or dynamically. If building or linking GoogleTest as a shared library, configure `GTEST_CREATE_SHARED_LIBRARY=1` during build and define `GTEST_LINKED_AS_SHARED_LIBRARY=1` when compiling tests.

<Warning>
Mixing static and dynamic runtimes (especially on Windows with MSVC) can cause linker errors. Use the CMake option `-Dgtest_force_shared_crt=ON` when building GoogleTest to align runtimes if necessary.
</Warning>

---

## 5. Utilizing GoogleTest in Existing Projects

For projects already using CMake, the recommended approach is to add GoogleTest as a subdirectory or external dependency, rather than manually managing source files:

- **Subdirectory Addition**: 

  Place GoogleTest source under a `third_party` folder.
  Then in your CMakeLists.txt:

  ```cmake
  add_subdirectory(third_party/googletest)
  target_link_libraries(your_test_target PRIVATE gtest gtest_main)
  ```

- **FetchContent Usage**: This is a flexible approach that automates downloading and building GoogleTest during your project’s configuration.

Both methods ensure consistent compiler flags and settings between your tests and GoogleTest itself.

---

## 6. Verifying Setup

After configuration, build your project and run tests:

```bash
mkdir build
cd build
cmake ..
cmake --build .
ctest
```

If GoogleTest is properly linked and configured, your tests should compile and run, outputting results to the console.

<Check>
If you encounter errors locating GoogleTest headers or libraries:

- Confirm the `find_package(GTest ...)` call locates GoogleTest correctly.
- Ensure you have the correct GoogleTest installation or submodule.
- Verify that compile features are correctly specified.
</Check>

---

## 7. Troubleshooting Common Issues

### GoogleTest not found by CMake

- Confirm GoogleTest is installed or fetch it via `FetchContent`.
- Check that the `CMAKE_PREFIX_PATH` or `CMAKE_MODULE_PATH` includes GoogleTest installation directories.

### Linker errors about missing symbols

- Double-check targets link against `GTest::gtest` and `GTest::gtest_main`.
- Confirm no ABI mismatches (for example, release vs debug versions).

### Runtime errors or crashes

- Ensure your tests and GoogleTest use matching compiler flags and runtime libraries.
- Check platform-specific notes (for instance on Windows, the CRT linkage).

---

## 8. Additional Setup Recommendations

- **Separate Test Code From Production:** Use separate targets and directories to avoid unintentional dependencies.
- **Use CTest:** Integrate with CMake’s testing framework for streamlined test running.
- **Configure Test Filters:** You can use GoogleTest flags such as `--gtest_filter` to run a subset of tests.

See [Running Your Tests](../getting-started/first-test-experience/building-and-running-tests.md) for more details.

---

## References & Next Steps

- [Installation Instructions](../getting-started/setup-basics/installation-instructions.md) — to set up GoogleTest before configuring your environment.
- [Writing Your First Test](../getting-started/first-test-experience/write-first-test.md) — learn to write test cases.
- [Advanced Configuration and Customization](../advanced.md#global-set-up-and-tear-down) — for global test environment setup.
- [CMake Documentation](https://cmake.org/cmake/help/latest/manual/cmake.1.html) — for further details on build system setup.

---

For the most seamless experience, build and configure GoogleTest in your project with CMake’s `FetchContent` or `add_subdirectory` mechanism. This ensures your build environment remains consistent, and facilitates smoother adoption of test-driven development using GoogleTest.