---
title: "Configuration and Project Setup"
description: "Explains how to configure a C++ project to use GoogleTest and GoogleMock, including linking libraries, including necessary headers, and basic project structure. Covers initial integration and common configuration scenarios."
---

# Configuration and Project Setup

Configure your C++ project to use GoogleTest and GoogleMock smoothly by setting up the necessary include paths, linking libraries correctly, and structuring your project files. This page guides you through the essential steps to integrate GoogleTest and GoogleMock into typical C++ build environments, enabling you to write and run tests and mocks with confidence.

---

## 1. Include Headers Correctly

To use GoogleTest and GoogleMock, include their main headers in your test source files:

```cpp
#include <gtest/gtest.h>  // GoogleTest functionality
#include <gmock/gmock.h>  // Google Mock functionality (optional but recommended)
```

- Include `gtest/gtest.h` for all testing features.
- Include `gmock/gmock.h` if your tests involve mocks.

This setup ensures visibility of all necessary classes, macros, and functions.

<Check>
Always include **gmock/gmock.h** if you plan to use mocks, since it includes GoogleTest internally.
</Check>

## 2. Link Against GoogleTest and GoogleMock Libraries

Your project needs to link to the compiled GoogleTest and GoogleMock libraries. This typically involves:

- Linking with `gtest` and `gmock` static or shared libraries.
- Ensuring the linker knows the location of those libraries.

### Common Scenarios

#### Using CMake

Add the following to your `CMakeLists.txt` after setting up your executable target:

```cmake
find_package(GTest REQUIRED)
add_executable(my_tests test_main.cpp ...)
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock GTest::gtest_main)
```

If you're building GoogleTest/GoogleMock from source, add the directories correctly.

#### Manual Linker Instructions

Link directly with the `libgtest.a` and `libgmock.a` (or `.lib` on Windows), for example:

```bash
g++ -o my_tests test_main.o ... -lgtest -lgmock -lpthread
```

- `-lpthread` is necessary on POSIX systems.
- On Windows, link against the appropriate GoogleTest/GoogleMock libs and MSVC runtime.

### Verifying Linker Settings

After linking, ensure your test executable is successfully built without unresolved symbols related to GoogleTest or GoogleMock.

<Warning>
If you receive linker errors about missing GoogleTest symbols, verify that libraries are built and linked correctly.
</Warning>

## 3. Basic Project Structure for Tests

Organize your test source files and mock classes cohesively:

- Place tests and mocks typically under a dedicated directory (e.g., `test/` or `tests/`).
- Mocks for a specific module can go under `test/mocks/` or inside the module’s test directory.
- Use descriptive file names for mock classes, e.g., `mock_foo.h`.

### Minimal Mock Class Setup Example

Suppose an interface `Foo`:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};
```

Create a mock class by inheriting `Foo` and using the `MOCK_METHOD` macro for each virtual method:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

**Important:**
- Define mock methods in `public` section regardless of the original access level.
- Make destructors virtual in the base interface.

Refer to the [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) for more patterns.

## 4. Integration in Your Build System

Use the following steps to configure integration:

### Step 1: Clone or Add GoogleTest and GoogleMock Sources

You can either:
- Clone the GoogleTest repository inside your project.
- Use a package manager to include pre-built binaries.

### Step 2: Build GoogleTest and GoogleMock Libraries

Use your build system or CMake:

```bash
mkdir build && cd build
cmake ../
cmake --build . --target gmock gmock_main
```

### Step 3: Include the Library and Header Paths

Configure your compiler and linker paths:

- Add the `include/` directories for headers.
- Add library directories to your linker.

### Step 4: Link Test Executables

Link your test executables with GoogleTest and GoogleMock libraries as described in section 2.

## 5. Common Configuration Scenarios

### Using GoogleMock's Main

If you use GoogleMock’s default `main()`, link your test executable with `gmock_main`. This initializes GoogleMock and GoogleTest automatically:

```cmake
add_executable(my_tests test_main.cpp ...)
target_link_libraries(my_tests PRIVATE gmock_main)
```

This saves you from writing your own `main()`.

### Custom Test Main

If you want to write a custom `main()`, initialize GoogleMock and GoogleTest manually:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

## 6. Best Practices and Tips

- **Always** include `gmock/gmock.h` for tests that use mocks to ensure proper setup.
- Use `NiceMock` to reduce noise from uninteresting calls during test development.
- Define mocks in a dedicated header/source to keep test code clean and maintainable.
- Use C++17 or later for compatibility and better support.
- Use `RetiresOnSaturation()` in expectations to avoid sticky expectation issues.

## 7. Troubleshooting Configuration Issues

### Problem: Tests do not compile due to missing GoogleMock symbols

- Ensure `-lgmock` or equivalent is linked.
- Verify that GoogleMock library is built.
- Check include paths for `<gmock/gmock.h>`.

### Problem: Multiple or missing `main()` functions

- Link either with `gmock_main` or provide your own main.
- Avoid linking both `gmock_main` and defining a `main()` in your test.

### Problem: Mock methods cause compiler errors

- Verify that the mocked methods match the virtual methods in the interface.
- Wrap parameter types containing commas in parentheses or use type aliases.

### Problem: Uninteresting calls warnings

- Use `NiceMock` to suppress warnings during test writing.
- Explicitly set expectations for frequently called methods.

## 8. Example: Minimal Test Setup

```cpp
// File: mock_foo.h
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};

// File: test_main.cpp
#include <gmock/gmock.h>
#include "mock_foo.h"

TEST(FooTest, GetSizeReturnsExpected) {
  MockFoo mock_foo;
  EXPECT_CALL(mock_foo, GetSize()).WillOnce(::testing::Return(10));
  ASSERT_EQ(10, mock_foo.GetSize());
}

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Build by linking with `-lgmock -lgtest -pthread`.

---

## Further Reading and Links

- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) – A handy reference for mock definitions and expectations.
- [gMock Cookbook](../docs/gmock_cook_book.md) – Practical recipes for mocking scenarios.
- [Writing and Running Your First Test](../getting-started/running-first-test/your-first-test.md) – Learn how to write your initial tests.
- [Installation (CMake, Bazel & More)](../getting-started/setup-basics/installation-platforms.md) – For instructions on building and installing.


---

By following this guide, your C++ project will be configured to use GoogleTest and GoogleMock effectively. Once set up, you can focus on writing tests and mocks that ensure your software quality securely and efficiently.
