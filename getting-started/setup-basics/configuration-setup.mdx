---
title: "Configuration & Environment Setup"
description: "Learn how to configure your build system, set the necessary environment variables, and verify your installation. This page details typical configuration steps, including linking GoogleTest with your C++ projects, so you can start testing with confidence."
---

# Configuration & Environment Setup

Learn how to configure your build system, set the necessary environment variables, and verify your installation. This page details typical configuration steps, including linking GoogleTest and GoogleMock with your C++ projects, so you can start testing with confidence.

---

## 1. Preparing Your Build Environment

Before you begin integrating GoogleTest and GoogleMock into your C++ projects, ensure the following:

- You have already installed GoogleTest/GoogleMock, following the steps in the [Installation Instructions](https://github.com/google/googletest/blob/main/docs/getting-started/setup-basics/installation-instructions.mdx).
- Your build system supports C++17 or later, as required by GoogleTest.
- Your environment variables and paths are set to locate the installed GoogleTest/GoogleMock headers and libraries.


## 2. Configuring Your Build System

GoogleTest and GoogleMock provide flexible ways to include testing support in your project. This section focuses on the typical setup using CMake.

### 2.1 Using CMake to Link GoogleMock with Your Project

GoogleMock comes with a `gmock_main` library that includes a default implementation of `main()`. Linking with `gmock_main` enables you to run tests without writing your own `main` function.

### Step-by-step configuration:

<Steps>
<Step title="Include GoogleTest and GoogleMock in Your Project">
Add GoogleTest and GoogleMock as dependencies to your `CMakeLists.txt`. You can do this by either importing installed packages or adding source directories directly.

Example using `add_subdirectory`:

```cmake
# Assuming googletest and googlemock are subdirectories
add_subdirectory(googletest)
add_subdirectory(googlemock)
```

Or find installed packages:

```cmake
find_package(GTest REQUIRED)
find_package(GMock REQUIRED)
```

</Step>
<Step title="Link Your Test Target Against gmock_main">
Link your test executable with the `gmock_main` and `gtest_main` libraries. This provides the test runner `main` function.

```cmake
target_link_libraries(your_test_target PRIVATE gmock_main)
```

This automatically brings in GoogleTest dependencies.

</Step>
<Step title="Add Include Directories">
Ensure your test target includes GoogleTest and GoogleMock headers for compilation.

```cmake
target_include_directories(your_test_target PRIVATE ${GTEST_INCLUDE_DIRS} ${GMOCK_INCLUDE_DIRS})
```

If you use `add_subdirectory`, this is usually handled for you.

</Step>
</Steps>

### 2.2 Environment Variables

- **CPLUS_INCLUDE_PATH**: Optional variable to add directories for header search 
  if your build system does not manage this directly.

- **LD_LIBRARY_PATH** (Linux/macOS) or **PATH** (Windows): Add paths to the directories where GoogleTest and GoogleMock shared libraries are installed if linking dynamically.

<Note>
Avoid hardcoding paths inside your project files. Use variables or package config files to maintain portability.
</Note>


## 3. Initializing GoogleMock in Your Test Code

GoogleMock depends on GoogleTest, so initialization covers both.

### 3.1 Using the Default Main Implementation

If you link against `gmock_main`, you do **not** need to write your own `main()` in your test code.

Example:

```cpp
// No user-defined main needed
#include <gmock/gmock.h>
// Your test code here
```

### 3.2 Writing Your Own main() Function

If your project requires a custom `main()`, initialize GoogleMock by calling `testing::InitGoogleMock()` before running tests.

Example:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This function parses command-line flags relevant to GoogleMock and GoogleTest and removes them from `argv`. It must be called **before** `RUN_ALL_TESTS()`.

<Warning>
If using Windows in UNICODE mode, there is an overloaded version accepting `wchar_t** argv`.
</Warning>


## 4. Verifying Your Configuration

Once configured, verify your environment with these steps:

### 4.1 Compile a Basic Test

Create a minimal test file, e.g., `sample_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, AssertionTrue) {
  EXPECT_TRUE(true);
}
```

Compile and link it against `gmock_main`.

### 4.2 Run the Tests

Execute the test binary. A successful run prints:

```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from SampleTest
[ RUN      ] SampleTest.AssertionTrue
[       OK ] SampleTest.AssertionTrue (0 ms)
[----------] 1 test from SampleTest (0 ms total)

[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

This output confirms your configuration is correct.


## 5. Best Practices and Tips

- Prefer linking against `gmock_main` to avoid boilerplate `main()` implementations.
- Always call `testing::InitGoogleMock` if you provide your own `main()`, passing `argc` and `argv` by reference.
- Use CMake's `find_package` and targets to manage dependencies cleanly.
- Keep your test binary isolated from non-test code.
- Watch out for compiler and linker flags that may conflict with GoogleTest/GoogleMock settings.


## 6. Troubleshooting

<AccordionGroup title="Common Configuration and Environment Issues">
<Accordion title="Tests Not Running or Discoverable">
Ensure `InitGoogleMock` is called before `RUN_ALL_TESTS()`.
If using `gmock_main`, verify it is linked properly.
Check for silencers or filters via GoogleMock flags.
</Accordion>
<Accordion title="Linker Errors Related to Main Function">
You may have multiple definitions of `main()`. Link either with `gmock_main` or provide your own `main()` but not both.

On Windows, prefer the non-`_tmain` variant as shown in supplied build files.
</Accordion>
<Accordion title="Build Errors About Missing Headers or Libraries">
Confirm include paths and library paths are set correctly.
Use CMake's targets or variables to avoid path issues.
Check environment variables like `CPLUS_INCLUDE_PATH` (Linux/macOS) or Visual Studio's include settings.
</Accordion>
<Accordion title="GoogleMock Flags Not Applied from Command Line">
Command-line flags recognized by GoogleMock like `--gmock_verbose` must be passed through `InitGoogleMock`.
Flags after `InitGoogleMock` are ignored.
</Accordion>
</AccordionGroup>


## 7. Summary

By following these steps, you configure your environment and build system to seamlessly integrate GoogleTest and GoogleMock. Linking against `gmock_main` removes the burden of implementing `main()`, while explicit initialization allows custom setup when needed. Verifying with a basic test confirms the setup is working, so you can dive into writing robust tests with confidence.


---

## Additional Resources

- [Installation Instructions](https://github.com/google/googletest/blob/main/docs/getting-started/setup-basics/installation-instructions.mdx)
- [Writing Your First Test](https://github.com/google/googletest/blob/main/docs/getting-started/first-test-run/writing-first-test.mdx)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)


---

For further details on build customization, multi-threading considerations, and advanced configuration, please refer to the respective detailed guides in this documentation set.