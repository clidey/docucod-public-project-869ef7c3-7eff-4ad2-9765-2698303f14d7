---
title: "Configuration & Environment Setup"
description: "Configure your project to use GoogleTest and GoogleMock. Get guidance on integrating the frameworks with your build system, linking libraries, and any environment-specific tweaks. Ensure your tests are set up for discovery and execution."
---

# Configuration & Environment Setup

Configure your project to use GoogleTest and GoogleMock effectively. This page guides you through the essential steps to integrate these frameworks with your build system, link the necessary libraries, and apply environment-specific configurations. By following this guide, you will ensure your tests are correctly discovered and executed, laying a solid foundation for reliable, maintainable testing.

---

## 1. Include GoogleTest and GoogleMock in Your Project

GoogleMock is bundled with GoogleTest. To use mocking features, include the main header:

```cpp
#include <gmock/gmock.h>
```

This header includes all necessary components for both GoogleTest and GoogleMock.

### Best Practice

- Always use this single include for both testing and mocking.
- Use the `testing` namespace or qualified names explicitly:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;
using ::testing::Return;
```


## 2. Integration with Your Build System

GoogleTest and GoogleMock support multiple build systems. Integration involves compiling or linking the appropriate libraries and configuring your environment accordingly.

### Using CMake

1. **Fetch the googletest repository** if not already available:

   ```bash
   git clone https://github.com/google/googletest.git
   cd googletest
   mkdir build && cd build
   cmake ..
   make
   sudo make install
   ```

2. **Link against `gtest` and `gmock` libraries** in your `CMakeLists.txt`:

   ```cmake
   find_package(GTest REQUIRED)
   include_directories(${GTEST_INCLUDE_DIRS})

   add_executable(your_test executable_sources.cc)
   target_link_libraries(your_test GTest::gtest GTest::gmock pthread)
   ```

### Using Bazel

Follow Bazel's rules for external dependencies and link your tests with `@com_google_googletest//:gmock` and `@com_google_googletest//:gtest`.

### Manual Compilation

If you prefer to compile manually, make sure to compile and link the following sources:

- `gtest/gtest-all.cc`
- `gmock/src/gmock-all.cc`

and link with the pthread library (on Linux/Unix/macos).


## 3. Linking Libraries and Header Paths

- Ensure your compiler can locate the header files for GoogleTest/GoogleMock. Common include directories:

  - `/usr/local/include`
  - `external/googletest/include`

- Link against the compiled libraries:

  - `libgtest.a` or `GTest::gtest`
  - `libgmock.a` or `GTest::gmock`

- On Unix-like systems, remember to link to `pthread`.


## 4. Environment and Platform-Specific Tweaks

### Compiler Requirements

- The framework requires a compiler supporting **C++17** or later.
- Supported compilers include GCC, Clang, and MSVC with recent versions.
- Ensure your compiler flags enable C++17 (e.g., `-std=c++17`).

### Threading Support

- GoogleMock uses threading features; a POSIX threads library (`pthread`) or equivalent is necessary.

### Windows Runtime Libraries

- On Windows, avoid mixing CRT versions between your project and GoogleMock to prevent runtime conflicts.

### Include Path Conflicts

- When integrating multiple frameworks, carefully manage include paths to avoid conflicts.


## 5. Test Discovery and Execution Setup

GoogleTest automatically discovers test cases and mock-related tests based on `TEST()`, `TEST_F()`, and `TEST_P()` macros.

### Initialization

In your test's main file, initialize GoogleMock (which also initializes GoogleTest):

```cpp
#include <gmock/gmock.h>
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This initializes the framework and ensures all test cases, including those with mocks, are executed properly.


## 6. Environment Variables and Runtime Flags

You can control GoogleMock’s behavior and verbosity using command-line flags:

- `--gmock_verbose=LEVEL` where LEVEL is one of:
  - `info`: most verbose (logs all calls, including stack traces)
  - `warning`: shows warnings and errors (default)
  - `error`: only errors

- `--gmock_catch_leaked_mocks=0`: disable failure on leaked mock objects

### Example

```bash
./your_test_binary --gmock_verbose=info
```


## 7. Common Pitfalls and Troubleshooting Tips

<AccordionGroup title="Troubleshooting Tips">
<Accordion title="Linker Errors on Missing Symbols">
Ensure that both `gtest` and `gmock` libraries are correctly linked. Also, include pthreads on POSIX systems.
</Accordion>
<Accordion title="Compiler Errors on MOCK_METHOD Macro">
Verify that the mocked methods are `virtual` in your base classes and have correct signatures. Make sure your compiler supports C++17.
</Accordion>
<Accordion title="Unrecognized Flags or Initialization Failures">
Make sure to call `InitGoogleMock()` instead of or in addition to `InitGoogleTest()`.
</Accordion>
<Accordion title="Uninteresting Mock Function Call Warnings">
Use `NiceMock<T>` to suppress warnings for calls to mock methods without explicit expectations. Use `StrictMock<T>` to treat such calls as failures.
</Accordion>
</AccordionGroup>

<Tip>
To speed up compilation, move the constructor and destructor implementations of large mock classes to `.cc` files, reducing template instantiations.
</Tip>

<Tip>
Keep your mock class’s destructors virtual to avoid memory leaks and undefined behavior.
</Tip>

## 8. Example: Minimal Configuration and Test Setup

```cpp
#include <gmock/gmock.h>

class FooInterface {
 public:
  virtual ~FooInterface() = default;
  virtual int GetSize() const = 0;
};

class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
};

TEST(FooTest, SizeTest) {
  MockFoo mock_foo;

  EXPECT_CALL(mock_foo, GetSize()).WillOnce(::testing::Return(42));

  int size = mock_foo.GetSize();
  EXPECT_EQ(size, 42);
}

int main(int argc, char **argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

To build with CMake, ensure you link against `gtest` and `gmock` as described.


## 9. Next Steps

- After you have successfully configured your project and run simple tests, proceed to:
  - [Writing Your First Test](/getting-started/first-test-run-validation/writing-your-first-test)
  - [Building & Running Tests](/getting-started/first-test-run-validation/running-tests)

- Deepen your understanding with these resources:
  - [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
  - [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
  - [Core Features at a Glance](/overview/product-intro-core-concepts/core-features-overview)

- For real-world integration scenarios, see:
  - [Integration and Ecosystem Compatibility](/overview/architecture-usage-integration/integration-and-ecosystem)


---

<Check>
Make sure your compiler supports C++17 and that you link all required libraries.
Run `InitGoogleMock()` in your test executable before running tests.
</Check>

<Note>
Using `NiceMock<T>` can reduce warnings for uninteresting calls during early development.
Use `StrictMock<T>` to enforce stricter call checking when ready.
</Note>

## References

- [GoogleMock Official Documentation](https://google.github.io/googletest/gmock_for_dummies.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)


---

## Summary

This page guides you through configuring your project to use GoogleTest and GoogleMock, focusing on build system integration, library linking, initialization, and environment-specific considerations needed to effectively run and discover tests.

---

<Source url="https://github.com/google/googletest" paths='[{"path": "README.md"},{"path": "googlemock/include/gmock/gmock.h"},{"path": "docs/gmock_cook_book.md"},{"path": "docs/gmock_cheat_sheet.md"}]' />