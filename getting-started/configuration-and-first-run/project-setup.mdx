---
title: "Configuring Your Project"
description: "Instructions for integrating GoogleTest and GoogleMock with your project's build system. Explains how to add the necessary files, link libraries, and update configuration scripts, so users can initiate testing with minimal friction."
---

# Configuring Your Project

Integrating GoogleTest and GoogleMock into your project's build system is essential to leverage their powerful testing capabilities with minimal setup friction. This guide walks you through the necessary steps to add the required files, link libraries properly, and update your build configuration scripts so you can compile, link, and run your tests smoothly.

---

## 1. Preparing Your Build System

Before integrating GoogleTest and GoogleMock, decide on your build system (e.g., CMake, Bazel, or manual Makefiles) and ensure you have installed GoogleTest and GoogleMock correctly, based on the installation methods described elsewhere.

> Recommended: Use CMake integration for ease of maintenance and consistency.


## 2. Adding GoogleTest and GoogleMock to Your Project

There are two common ways to incorporate GoogleTest and GoogleMock:

### A. Using Installed Libraries

If you have installed GoogleTest and GoogleMock on your system, you can link to the prebuilt libraries:

- Locate the installed headers (usually under `/usr/local/include` or your custom prefix).
- Locate the compiled libraries (`libgtest.a`, `libgtest_main.a`, `libgmock.a`, `libgmock_main.a`).

### B. Building From Source Within Your Project

Alternatively, embed GoogleTest sources as part of your project and build them together. This approach ensures compatible compiler flags and is preferred for complex projects or Windows environments.

For CMake, you can use `add_subdirectory()` to include GoogleTest and GoogleMock subdirectories.


## 3. Configuring CMake to Use GoogleTest and GoogleMock

Assuming you use CMake, follow these steps to integrate GoogleTest and GoogleMock into your project build.

### Step 1: Declare GoogleTest as a Dependency

If you installed GoogleTest and GoogleMock system-wide or via FetchContent, first find the package:

```cmake
find_package(GTest CONFIG REQUIRED)
```

### Step 2: Add Your Test Executable

Create an executable target for your tests, for example:

```cmake
add_executable(my_tests test_example.cpp)
```

### Step 3: Link GoogleTest and GoogleMock Libraries

Use the imported targets for linking. Link to either `gtest_main` or `gmock_main` if you want to use the provided `main()` function.

- To use **GoogleTest only:**

```cmake
target_link_libraries(my_tests PRIVATE GTest::gtest_main)
```

- To use **GoogleMock (and GoogleTest) with its own main():**

```cmake
target_link_libraries(my_tests PRIVATE GTest::gmock_main)
```

This links the necessary libraries (`gmock`, `gtest`, and their dependencies) and includes relevant headers.

### Step 4 (Optional): Add Test to CTest

Enable CTest support and register your test for `ctest` or `make test`:

```cmake
enable_testing()
add_test(NAME my_test COMMAND my_tests)
```


## 4. Using GoogleTest/GoogleMock Source Directly with add_subdirectory()

If you prefer to build GoogleTest and GoogleMock as part of your project and have the source code available, add to your `CMakeLists.txt`:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Windows: make sure to link runtimes consistently
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_example.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)
```

Replace `gtest_main` with `gmock_main` if your tests use GoogleMock features.


## 5. Understanding main() Functions Provided by GoogleTest and GoogleMock

GoogleTest and GoogleMock provide standard `main()` implementations to run all your tests automatically. Linking to `gtest_main` or `gmock_main` supplies this.

- **`gtest_main`**: Runs your GoogleTest tests.
- **`gmock_main`**: Runs GoogleMock tests along with GoogleTest support.

If your project requires custom test initialization logic, you can write your own `main()` as demonstrated in the [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md#writing-the-main-function).


## 6. Updating Your Build Configuration for Manual Makefiles or Other Systems

If you manage build scripts manually:

- Include GoogleTest and GoogleMock header directories in your compiler include path (e.g., `-Ipath/to/googletest/include`, `-Ipath/to/googlemock/include`).
- Add the GoogleTest and GoogleMock source files (`gtest-all.cc`, `gmock-all.cc`, plus `gmock_main.cc` or `gtest_main.cc` if not linking precompiled libraries) to your compile lists.
- Link with pthread (`-lpthread`) on platforms that require it.


## 7. Verifying Your Configuration

Once set up, compile your tests and run the binary. You should see output similar to:

```
Running main() from gtest_main.cc
[==========] Running 3 tests from 1 test suite.
[----------] Global test environment set-up.
[ RUN      ] YourTestSuite.Test1
[       OK ] YourTestSuite.Test1 (0 ms)
[----------] 3 tests from YourTestSuite (3 ms total)
[==========] 3 tests from 1 test suite ran. (3 ms total)
[  PASSED  ] 3 tests.
```


## 8. Troubleshooting Common Configuration Issues

<AccordionGroup title="Common Issues During Project Configuration">
<Accordion title="Missing GoogleTest Headers or Libraries">
If your compiler cannot find GoogleTest headers or libraries:

- Verify your `include_directories` or include paths are correct.
- Ensure your linker settings include the paths to `libgtest.a`, `libgmock.a`, or their dynamic equivalents.
- For CMake, confirm `find_package` locates the installed files or that FetchContent downloads GoogleTest.

</Accordion>
<Accordion title="Linker Errors About Multiple main() Functions">
These happen if you link both `gtest_main` and `gmock_main` libraries or provide your own `main()` without excluding default mains.

- Link only one main library.
- If providing your own `main()`, link to `gtest` or `gmock` without `_main`.

</Accordion>
<Accordion title="Runtime Errors Like Tests Not Running or Crashing">
- Check that you call `testing::InitGoogleTest()` or `testing::InitGoogleMock()` in your `main()` before `RUN_ALL_TESTS()`.
- Ensure your test source files properly include `<gtest/gtest.h>` and/or `<gmock/gmock.h>`.
- Confirm your tests are compiled and linked in the test executable.

</Accordion>
</AccordionGroup>

---

## Additional Tips & Best Practices

- **Consistent Compiler Flags:** Ensure the compiler and linker flags used for GoogleTest and your project match to avoid ABI incompatibilities.
- **Use `gmock_main` for mocking:** Link to the `gmock_main` library when using mocks, not just `gtest_main`.
- **Prefer CMake integration:** CMakeâ€™s `FetchContent` and `find_package` mechanisms simplify dependency management.
- **Keep GoogleTest updated:** Regularly update your GoogleTest source or package to benefit from improvements.

---

## Next Steps

After configuration, proceed to:

- Write your first tests using the [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md).
- Learn how to run your tests effectively in your development workflow.
- Explore mocking capabilities with GoogleMock if applicable.

For advanced build setups and platform-specific notes, see the [Integration with Other Tools & Systems](overview/architecture-features-integration/integration-overview) guide.

---

```cmake
# Minimal example integrating GoogleTest via FetchContent
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)

enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

Run `cmake .. && cmake --build . && ctest` to build and execute your tests using this setup.
