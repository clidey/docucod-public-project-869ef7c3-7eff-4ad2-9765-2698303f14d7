---
title: "Installing with CMake and Bazel"
description: "Detailed guidance for integrating GoogleTest into projects using CMake or Bazelâ€”the primary supported build systems. Includes directory structure, CMakeLists and BUILD file examples, and troubleshooting for different platforms."
---

# Installing with CMake and Bazel

This guide provides detailed, practical instructions on how to integrate GoogleTest into your C++ projects using the two primary supported build systems: **CMake** and **Bazel**. By following this guide, you will set up your project to build and run tests using GoogleTest efficiently, leveraging best practices tailored for each build system.

---

## 1. Installing with CMake

GoogleTest supports robust integration with CMake, a widely-used cross-platform build system. CMake simplifies the process of managing compiler options, dependencies, and test discovery.

### 1.1 Prerequisites
- Ensure you have CMake 3.14 or newer installed. Download from [cmake.org](https://cmake.org/).
- You need a C++17 compatible compiler (e.g., GCC 7+, Clang 5+, MSVC 2017+).
- A build tool compatible with CMake such as Make or Ninja.

<Tip>
If you do not have CMake installed, follow the official installation instructions at https://cmake.org/install.
</Tip>

### 1.2 Setting Up Your Project

1. Create a new project directory and navigate into it:

```bash
mkdir my_project && cd my_project
```

2. Create a `CMakeLists.txt` file with the following content. It downloads and makes GoogleTest available during build configuration:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Use C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
# On Windows, use shared CRT to avoid runtime conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

<Note>
Update the commit hash (`03597a01ee50ed33e9dfd640b249b4be3799d395`) periodically to track the latest stable GoogleTest release.
</Note>

### 1.3 Adding a Test Source File

Create a sample test `hello_test.cc` to validate your setup:

```cpp
#include <gtest/gtest.h>

// A simple test for demonstration
TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### 1.4 Updating `CMakeLists.txt` to Build and Run Tests

Add these lines at the end of your `CMakeLists.txt` to build your test binary and enable test discovery:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)
target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

### 1.5 Build and Run Your Tests

Run these commands in your project directory:

```bash
cmake -S . -B build
cmake --build build
cd build && ctest
```

**Expected output:**

```text
Test project .../my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
```

<Tip>
If your build or test run fails, ensure your compiler supports C++17 and that CMake is properly installed.
</Tip>

### 1.6 Troubleshooting Common CMake Installation Issues

<AccordionGroup title="Troubleshooting Common CMake Installation Issues">
<Accordion title="Linker errors related to Runtime Library mismatch on Windows">
Make sure to set `gtest_force_shared_crt` to ON in your `CMakeLists.txt` to align GoogleTest's runtime with your project:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
</Accordion>

<Accordion title="Compiler does not support C++17">
Verify the compiler version and flags. Explicitly setting `set(CMAKE_CXX_STANDARD 17)` ensures C++17 mode. If issues persist, update your compiler.
</Accordion>

<Accordion title="Tests not detected by ctest">
Ensure `include(GoogleTest)` and `gtest_discover_tests()` are correctly specified. Alternatively, manually add tests via `add_test()`.
</Accordion>
</AccordionGroup>

---

## 2. Installing with Bazel

Bazel is a fast, scalable build system extensively used by GoogleTest developers. This section guides you through setting up Bazel for your tests.

### 2.1 Prerequisites
- Bazel version 7.0 or newer installed. See [bazel.build/install](https://bazel.build/install).
- Compatible C++17 compiler.

### 2.2 Setting Up a Bazel Workspace

1. Create a workspace directory and navigate into it:

```bash
mkdir my_workspace && cd my_workspace
```

2. Create a file named `MODULE.bazel` at the root of the workspace specifying GoogleTest as a dependency:

```python
# MODULE.bazel

bazel_dep(name = "googletest", version = "1.17.0")
```

<Tip>
Always check the Bazel Central Registry for the latest GoogleTest version.
</Tip>

### 2.3 Adding a Test Source File

Create `hello_test.cc` with this minimal example:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### 2.4 Creating the Bazel Build File

Add a `BUILD` file in the same directory with the contents:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

This defines a test target using GoogleTest's core libraries.

### 2.5 Building and Running the Test

Execute this command:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

**Expected output excerpts:**

```text
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[----------] 1 test from HelloTest
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions (0 ms)
[----------] 1 test from HelloTest (0 ms total)

[  PASSED  ] 1 test.
//:hello_test                                                     PASSED in 0.1s
```

<Note>
Set the appropriate `--cxxopt=` flag for your compiler to ensure C++17 compliance (`/std:c++17` for MSVC).
</Note>

### 2.6 Troubleshooting Common Bazel Issues

<AccordionGroup title="Troubleshooting Common Bazel Installation Issues">
<Accordion title="Bazel cannot find google test dependencies">
Verify `MODULE.bazel` syntax and placement. Run `bazel clean --expunge` to reset the build cache if dependencies change.
</Accordion>

<Accordion title="C++17 support errors during build">
Check your compiler's version and provide Bazel with the correct compiler options for C++17 (`--cxxopt=-std=c++17` or `--cxxopt=/std:c++17`).
</Accordion>

<Accordion title="Tests fail to run or show no output">
Use the flag `--test_output=all` with `bazel test` to see detailed test output.
</Accordion>
</AccordionGroup>

---

## 3. Understanding Directory Structure and Build Files

Both CMake and Bazel integrations rely on a known directory layout and build file conventions to locate source files, libraries, and headers.

### 3.1 CMake
- **Project Root:** Directory containing your `CMakeLists.txt`.
- **Build Directory:** Arbitrary (e.g., `build`). This is where build artifacts are generated.
- **Source Files:** Your test or source files live alongside or in subdirectories.

The provided example places the test source and CMakeLists in the same directory for simplicity.

### 3.2 Bazel
- **Workspace Directory:** Top-level folder containing `MODULE.bazel` and `BUILD` files.
- **BUILD Files:** Define targets (e.g., `cc_test`) and declare dependencies.
- **Source Files:** Typically in the same folder or subfolders referenced by `srcs`.

---

## 4. Summary and Next Steps

You have now learned how to:

- Set up GoogleTest in projects using **CMake** with `FetchContent` or manually downloaded sources.
- Configure, build, and run tests smoothly within **Bazel** workspaces.
- Create basic test binaries linked to GoogleTest libraries.
- Troubleshoot common platform-specific and build system-specific issues.

**What to explore next:**

- Writing custom tests and assertions ([Writing Your First Test](/getting-started/first-test-run-validation/write-first-test)).
- Configuring more complex project setups and integrating with CI pipelines.
- Exploring the guides for [Advanced Mocking](https://google.github.io/googletest/gmock_cook_book.html).

---

## 5. Additional Resources

- [GoogleTest Quickstart with CMake](https://github.com/google/googletest/blob/main/docs/quickstart-cmake.md)
- [GoogleTest Quickstart with Bazel](https://github.com/google/googletest/blob/main/docs/quickstart-bazel.md)
- [Supported Platforms](https://github.com/google/googletest/blob/main/docs/platforms.md)
- Official CMake documentation: https://cmake.org/documentation/
- Official Bazel documentation: https://docs.bazel.build/

---

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/quickstart-cmake.md", "range": "entire"}, {"path": "docs/quickstart-bazel.md", "range": "entire"}, {"path": "googlemock/CMakeLists.txt", "range": "entire"}]} />