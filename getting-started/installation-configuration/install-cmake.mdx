---
title: "Install with CMake"
description: "Follow the recommended workflow to build and install GoogleTest and GoogleMock using CMake. Includes quick commands, troubleshooting common errors, and integrating into your existing CMake project."
---

# Install with CMake

This guide walks you through the recommended workflow to build and install **GoogleTest** and **GoogleMock** using CMake. You'll find clear, actionable steps to clone the repository, configure the build, compile the libraries, install them on your system, and integrate them into your existing CMake projects. Troubleshooting tips for common issues are included to help you overcome obstacles quickly.

---

## 1. Prerequisites & System Requirements

Before you begin, ensure your environment meets the following:

- **Operating System**: Linux, macOS, or Windows (with appropriate build tools).
- **C++ Compiler**: Supports C++17 standard or higher (e.g., GCC 7+, Clang 7+, MSVC 2017+).
- **CMake**: Version 3.14 or later is required.
- **Build Tools**:
  - Linux/macOS: Make, Ninja, or similar.
  - Windows: Visual Studio with C++ workloads.
- **Network Access**: To clone the GitHub repository or download dependencies.

<Tip>
GoogleTest’s CMake support is community-based. The maintainers do not use it internally, so some behavior may vary. Follow this guide to ensure a robust setup.
</Tip>

## 2. Cloning and Building GoogleTest with GoogleMock

By default, building GoogleTest also builds GoogleMock.

### Step 1: Clone the Repository

Open a terminal or command prompt and enter:

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
```

### Step 2: Create a Build Directory

To keep build files separate from source, create a dedicated directory:

```bash
mkdir build
cd build
```

### Step 3: Configure the Build

Run CMake to generate platform-native build files. This command also includes GoogleMock by default:

```bash
cmake ..
```

If you want to build only GoogleTest without GoogleMock, disable it explicitly:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Build the Libraries

- **On Linux/macOS with Make:**

  ```bash
  make
  ```

- **On Windows with Visual Studio:**
  - Open the generated `.sln` file in the `build` directory.
  - Build the solution from Visual Studio.

- **On macOS with Xcode:**
  - Open the generated `.xcodeproj` file.
  - Build via Xcode IDE.

<Tip>
Building GoogleMock automatically builds GoogleTest as a dependency.
</Tip>

### Step 5: Install Libraries (Optional)

If you want to install GoogleTest and GoogleMock system-wide (commonly `/usr/local/` on Unix-like systems):

```bash
sudo make install
```

This step requires system administrator privileges.

<Warning>
Ensure you have correct permissions before installing. You can customize the install location with `-DCMAKE_INSTALL_PREFIX` during the configuration step.
</Warning>

## 3. Verifying Your Build

After building, confirm that the libraries and headers are properly built:

- Check that `libgtest.a`, `libgmock.a`, or their shared variants exist in the build directory under `lib` or `lib64`.
- Confirm header files are in the `include` directory.
- Run provided tests to verify integrity:

```bash
make test
# or
ctest
```

All tests should pass without failures.

## 4. Integrating GoogleTest into Your Existing CMake Project

You can use GoogleTest as an external dependency in your projects using either installed libraries or by building as part of your build.

### Method A: Using Installed GoogleTest with `find_package`

Ensure GoogleTest is installed with CMake export files generated (default behavior if installed using `make install`).

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_test test/my_test.cc)

target_link_libraries(my_test PRIVATE GTest::gtest_main)

enable_testing()
gtest_discover_tests(my_test)
```

This method assumes `CMAKE_PREFIX_PATH` includes the GoogleTest install path or the standard system search paths.

### Method B: Building GoogleTest as a Subdirectory

Add GoogleTest source directly into your project build to ensure consistent compiler and linker settings.

Modify your `CMakeLists.txt` as follows:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # Windows-specific
FetchContent_MakeAvailable(googletest)

add_executable(my_test test/my_test.cc)

target_link_libraries(my_test PRIVATE gtest_main)

enable_testing()
gtest_discover_tests(my_test)
```

<Tip>
Using `FetchContent` is the recommended way to include GoogleTest in your project. It downloads and builds GoogleTest automatically during your build.
</Tip>

## 5. Common Build Options

- **`BUILD_SHARED_LIBS`**: Set to `ON` to build GoogleTest and GoogleMock as shared libraries (DLLs).

```bash
cmake .. -DBUILD_SHARED_LIBS=ON
```

- **`gtest_force_shared_crt`**: On Windows, set to `ON` to use dynamic CRT linkage matching your project settings.

- **`BUILD_GMOCK`**: Disable or enable building GoogleMock separately when you want only GoogleTest.

- **`INSTALL_GTEST`**: Disable installation of Googletest if embedding it inside another project.

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Build Problems and Fixes">
<Accordion title="CMake cannot find C++17 compiler or features">
Verify your compiler supports C++17. You can explicitly set the C++ standard:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Also, ensure the compiler path is correctly configured in your environment.
</Accordion>
<Accordion title="Linker errors related to pthread or threads">
GoogleTest uses threading support. Ensure you have pthreads installed (Linux/macOS) and linked properly.

If using your own build scripts, add `-pthread` to compiler and linker flags.

The CMake scripts handle this automatically.
</Accordion>
<Accordion title="Mismatch of Runtime Libraries on Visual Studio builds">
Use the `gtest_force_shared_crt` option to align GoogleTest runtime with your project to avoid LNK2038 errors.

Invoke CMake with:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

</Accordion>
<Accordion title="Tests are not discovered or running failures">
Ensure you call `enable_testing()` and use `gtest_discover_tests()` appropriately in your CMake script.

Run tests using `ctest` or your IDE’s test runner.
</Accordion>
</AccordionGroup>

## 7. Summary

By following this guide, you have successfully cloned, built, installed, and integrated GoogleTest and GoogleMock into your projects with CMake. This foundation allows you to write, build, and run robust C++ tests leveraging GoogleTest’s powerful features.

For your next steps, consider:

- Writing your first test case using GoogleTest assertions.
- Exploring mocking capabilities with GoogleMock.
- Reviewing the [GoogleTest Primer](https://google.github.io/googletest/primer.html) for test writing fundamentals.

---

## Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Official Site](https://cmake.org/)
- [GoogleTest Primer Guide](https://google.github.io/googletest/primer.html)
- [Getting Started with GoogleTest](../getting-started/installation-configuration/install-cmake.md)
- [Troubleshooting Common Issues](../getting-started/troubleshooting/common-issues.md)

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googletest/README.md", "range": "1-120"},{"path": "googletest/CMakeLists.txt", "range": "1-150"},{"path": "googlemock/CMakeLists.txt", "range": "1-130"}]} />