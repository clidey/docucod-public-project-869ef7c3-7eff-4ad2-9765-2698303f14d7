---
title: "Pkg-config and Other Installation Methods"
description: "Explore alternative ways to configure and use GoogleTest, including pkg-config, manual source inclusion, and system package managers. Especially useful for existing projects or customized build workflows."
---

# Pkg-config and Other Installation Methods

Explore alternative ways to configure and use GoogleTest, including `pkg-config`, manual source inclusion, and system package managers. This guide is especially useful for existing projects or customized build workflows that do not rely solely on CMake or Bazel.

---

## 1. Using GoogleTest with pkg-config

GoogleTest provides `pkg-config` files that describe the necessary compiler and linker flags to build and link your tests. These files simplify integration across a variety of build systems by standardizing the inclusion paths, macro definitions, libraries, and linker flags.

### What pkg-config provides for GoogleTest

- Include directory path (`-I`) for headers
- Macro definitions (`-D`) such as enabling pthread support
- Required linker flags including `-pthread`
- Library directories (`-L`) and libraries (`-l`) for linking

All major build systems support `pkg-config` either natively or via add-ons.

### 1.1 Integrating pkg-config in CMake

Here is a recommended example workflow to use `pkg-config` in your CMake project to build a test executable using GoogleTest:

```cmake
find_package(PkgConfig)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(testapp)
target_sources(testapp PRIVATE samples/sample3_unittest.cc)
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(first_and_only_test testapp)
```

**Best Practice**: Prefer `target_compile_options` with `${GTEST_CFLAGS}` instead of `target_include_directories` with `${GTEST_INCLUDE_DIRS}`. This ensures all compiler flags including `-pthread` and macros are correctly applied.

Similarly, use `${GTEST_LDFLAGS}` over `${GTEST_LIBRARIES}` to include both `-L` and `-l` linker flags correctly.

### 1.2 Troubleshooting pkg-config detection

If `pkg-config` fails to find GoogleTest modules (`gtest_main`), especially when you have installed GoogleTest manually, the error may look like:

```
-- Checking for one of the modules 'gtest_main'
CMake Error at /usr/share/cmake/Modules/FindPkgConfig.cmake:640 (message):
  None of the required 'gtest_main' found
```

This usually means the `.pc` files are not in the default `pkg-config` search paths.

**Resolve this by setting the `PKG_CONFIG_PATH` environment variable to include the directory of your installed GoogleTest `.pc` files. For example, if installed under `/usr/local`:**

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Once set, `pkg-config` will locate `gtest_main.pc` and `gtest.pc` correctly.

### 1.3 Using pkg-config in Cross-Compilation

When cross-compiling GoogleTest, you must ensure `pkg-config` is properly configured to respect your sysroot and target directories.

**Typical cross-compilation steps:**

```bash
mkdir build
cmake -DCMAKE_INSTALL_PREFIX=/usr ..
make -j install DESTDIR=/home/MYUSER/sysroot
```

**Set environment variables for pkg-config to include sysroot:**

```bash
export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
export PKG_CONFIG_DIR=
export PKG_CONFIG_SYSROOT_DIR=/home/MYUSER/sysroot
export PKG_CONFIG_LIBDIR=${PKG_CONFIG_SYSROOT_DIR}/usr/lib64/pkgconfig
```

Without these, pkg-config may return normal host paths ignoring the sysroot, causing build errors.

### 1.4 Example pkg-config Output

Running this command after proper configuration:

```bash
pkg-config --cflags gtest
pkg-config --libs gtest
```

Outputs:

```
-DGTEST_HAS_PTHREAD=1 -lpthread -I/home/MYUSER/sysroot/usr/include
-L/home/MYUSER/sysroot/usr/lib64 -lgtest -lpthread
```

These flags ensure correct compilation and linking against GoogleTest in the cross-compilation environment.

---

## 2. Manual Integration Using Source Files

For projects that do not use pkg-config or need tighter integration, GoogleTest can be included manually by adding the necessary source files and headers directly.

### 2.1 Steps for manual source inclusion

1. **Download GoogleTest source code**
   - Clone or download the GoogleTest repository from [https://github.com/google/googletest](https://github.com/google/googletest)

2. **Add `googletest` and `googlemock` directories to your project source tree**

3. **Modify your build to compile GoogleTest source files**

   Typical source files to include:

   - `googletest/src/gtest-all.cc`
   - `googlemock/src/gmock-all.cc` (if using GoogleMock)

4. **Add include paths**

   Include `googletest/include` and `googlemock/include` in your compiler's include directories.

5. **Link your test binaries against these compiled GoogleTest objects or static libraries**

### 2.2 Advantages and considerations

- Complete control over build and compile options
- Avoids dependency on `pkg-config` or installed packages
- Larger maintenance overhead in keeping GoogleTest source synchronized

---

## 3. Using GoogleTest from System Package Managers

Many Linux distributions and package managers provide prebuilt GoogleTest packages.

### 3.1 Common package names

- Debian/Ubuntu: `libgtest-dev` (headers and source)
- Fedora/RedHat: `gtest-devel`
- Arch Linux: `googletest`

### 3.2 Important notes

- Some distributions package GoogleTest only as source since its tests require building to create libraries.
- You may need to manually compile and install GoogleTest static libraries from `/usr/src/gtest` after installing the dev package.

### 3.3 Example: Installing on Ubuntu

```bash
sudo apt-get install libgtest-dev
cd /usr/src/gtest
sudo cmake .
sudo make
sudo cp *.a /usr/lib
```

After this, you can link against `-lgtest` normally.

---

## 4. Best Practices and Tips

- Always verify the location of the `.pc` files if using `pkg-config`, especially with custom installs.
- When cross-compiling, explicitly specify sysroot-related environment variables to avoid incorrect include and library paths.
- Prefer `target_compile_options` and `target_link_libraries` with the full flags from `pkg-config` in CMake rather than splitting flags.
- For embedded or isolated environments, use manual source inclusion for full build control.
- Consult your platform package manager documentation to understand how GoogleTest is packaged and built.

---

## 5. Troubleshooting

### Issue: pkg-config cannot find gtest_main

**Cause:** `.pc` files are not in default search paths.

**Fix:** Export `PKG_CONFIG_PATH` to where `.pc` is installed (e.g., `/usr/local/lib64/pkgconfig`).

### Issue: Link errors related to pthread when building

**Cause:** Missing `-pthread` flag during compile or link.

**Fix:** Using `pkg-config` flags with thread support or define `-DGTEST_HAS_PTHREAD=1` and ensure `-pthread` is passed both in compile and link steps.

### Issue: Cross-compilation paths point to host system

**Cause:** `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` not set.

**Fix:** Set these environment variables to your target sysroot and pkgconfig directories as documented above.

---

## 6. Next Steps

- For a fully integrated CMake build, see [Install with CMake](/getting-started/installation-configuration/install-cmake).
- To learn Bazel integration, visit [Install with Bazel](/getting-started/installation-configuration/install-bazel).
- When ready, try writing and running your first tests with [Write and Run Your First Test](/getting-started/first-test-and-validation/write-run-your-first-test).

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [Pkg-config Cross-Compile Guide](https://autotools.io/pkgconfig/cross-compiling.html)
- [GoogleTest Installation Readme](https://github.com/google/googletest/blob/main/googletest/README.md)

---

<Check>
Ensure you have C++17 or later support enabled in your build environment.
Verify `pkg-config` is installed and accessible in your development setup.
</Check>

<Note>
This document focuses on alternative installation methods outside primary CMake and Bazel workflows, enabling flexible adoption in diverse projects.
</Note>
