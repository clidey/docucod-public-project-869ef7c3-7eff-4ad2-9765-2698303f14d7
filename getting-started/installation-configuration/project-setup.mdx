---
title: "Configuring Your Project"
description: "Instructions for adding GoogleTest to your C++ project, referencing necessary headers, linking libraries, and managing dependencies. Focuses on both standalone usage and integration within larger codebases."
---

# Configuring Your Project with GoogleTest and GoogleMock

This guide provides clear, step-by-step instructions for adding GoogleTest and GoogleMock to your C++ project. Whether integrating GoogleTest standalone or using GoogleMock for mocking capabilities, this documentation covers header inclusion, linking libraries, and managing dependencies for seamless setup.

---

## 1. Prerequisites

Before configuring your project:

- Ensure your development environment supports **C++17** or later.
- Have access to GoogleTest and GoogleMock source or installed packages.
- Familiarize yourself with your build system (preferably CMake).
- Verify thread and exception support appropriate for your platform.

Refer to the [System Requirements & Supported Platforms](https://github.com/google/googletest/tree/main/getting-started/setup-prerequisites/system-requirements) for detailed environment needs.

---

## 2. Acquiring GoogleTest and GoogleMock

Follow one of these methods to get the sources:

- Clone the GitHub repository:

  ```bash
  git clone https://github.com/google/googletest.git
  ```

- Download release archives from the [GitHub releases page](https://github.com/google/googletest/releases).

- Use CMake's `FetchContent` to fetch during your build (recommended for CI):
  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
  )
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows dynamic runtimes
  FetchContent_MakeAvailable(googletest)
  ```

See [Obtaining GoogleTest](https://github.com/google/googletest/tree/main/getting-started/setup-prerequisites/get-the-code) for full details.

---

## 3. Including Headers in Your Project

To use GoogleTest or GoogleMock, include the appropriate public headers in your source files:

- For GoogleTest:

  ```cpp
  #include <gtest/gtest.h>
  ```

- For GoogleMock (also includes GoogleTest):

  ```cpp
  #include <gmock/gmock.h>
  ```

These headers provide access to all testing macros, utilities, and mocking functions.

---

## 4. Linking Libraries

You need to link your test executable against GoogleTest and/or GoogleMock libraries.

### 4.1 Linking GoogleTest

- **With main() provided** (most common): Link against `gtest_main`.

- **Without main() provided**: Link against `gtest` and define your own `main()`.

Example CMake usage:

```cmake
# Link example target with gtest_main
target_link_libraries(your_test_target PRIVATE GTest::gtest_main)
```

### 4.2 Linking GoogleMock

- **With main() provided:** Link against `gmock_main`. This includes GoogleMock and GoogleTest with a pre-defined main function.

- **Without main() provided:** Link against `gmock` and `gtest` libraries; youâ€™ll write your own `main()`.

Example CMake usage:

```cmake
# Link example target with gmock_main
target_link_libraries(your_test_target PRIVATE GMock::gmock_main)
```

---

## 5. Managing Dependencies in CMake

### 5.1 Standalone Build

If building GoogleTest/GoogleMock as a standalone project:

```bash
mkdir build
cd build
cmake ..
make
sudo make install
```

Then link installed libraries as shown above.

### 5.2 Incorporating GoogleTest into Your Project

Preferred approach: Add GoogleTest as a subdirectory in your `CMakeLists.txt`:

```cmake
# Download GoogleTest via FetchContent
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(your_tests test_main.cpp your_tests.cpp)
target_link_libraries(your_tests PRIVATE gtest_main)
```

This ensures consistent compiler/linker settings and up-to-date sources.

---

## 6. Writing Your main() Function (If Needed)

Usually, you don't have to write your own `main()` because `gtest_main` or `gmock_main` provide one. If you write a custom `main()`, initialize GoogleTest or GoogleMock in it as follows:

### 6.1 For GoogleTest only

```cpp
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 6.2 For GoogleMock (Includes GoogleTest)

```cpp
#include <gmock/gmock.h>

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

See the respective alternative implementations for Arduino-like platforms in `gtest_main.cc` and `gmock_main.cc` if targeting embedded systems.

---

## 7. Important Build and Link Macros

GoogleTest and GoogleMock support build-time macros to tweak behavior:

- `-DGTEST_CREATE_SHARED_LIBRARY=1` to build shared libraries.
- `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when linking against shared libraries.
- `-DGTEST_HAS_PTHREAD=1` or `0` to control pthread usage.
- Use `-DGTEST_DONT_DEFINE_TEST=1` if you want to avoid macro name clashes.

Adjust these in your build system when needed, especially on Windows or for advanced use cases.

---

## 8. Troubleshooting Common Configuration Issues

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Linker Errors Related to Runtime Mismatches on Windows">

Ensure that your project and GoogleTest/GoogleMock are built with the same runtime settings:

- Use the CMake option `gtest_force_shared_crt=ON` for dynamic CRT linkage.
- Match Debug/Release settings uniformly.
- Rebuild GoogleTest/GoogleMock if needed.

</Accordion>
<Accordion title="Failing to Find Headers or Libraries in CMake">

- Verify include directories are correctly set via `target_include_directories` or `include_directories`.
- If using FetchContent, make sure to call `FetchContent_MakeAvailable()` before linking.
- Check that your build paths are correct relative to your project root.

</Accordion>
<Accordion title="Multiple main() Functions Detected">

- Avoid linking both `gtest_main` and writing your own `main()`.
- Similarly, avoid linking `gmock_main` with a custom main.

</Accordion>
</AccordionGroup>

---

## 9. Verification: Confirm Your Setup

To verify your configuration:

1. Write a simple test, e.g.:  

   ```cpp
   #include <gtest/gtest.h>

   TEST(SimpleTest, Passing) {
     EXPECT_EQ(1, 1);
   }
   ```

2. Build and run your test executable.
3. Successful output:

   ```
   [==========] Running 1 test from 1 test suite.
   [----------] Global test environment set-up.
   [----------] 1 test from SimpleTest
   [ RUN      ] SimpleTest.Passing
   [       OK ] SimpleTest.Passing (0 ms)
   [----------] 1 test from SimpleTest (0 ms total)

   [==========] 1 test from 1 test suite ran. (0 ms total)
   [  PASSED  ] 1 test.
   ```

If this runs successfully, your configuration is correct.

---

## 10. Next Steps

- Start writing tests: see [Writing Your First Test](https://github.com/google/googletest/tree/main/getting-started/first-test-run-validation/write-first-test).
- Explore [Using Mocks Effectively](https://github.com/google/googletest/tree/main/guides/advanced-and-mocking-guides/using-mocks-effectively) for advanced mock-based testing.
- Integrate tests in your CI/CD pipeline following [Integration & Extensibility](https://github.com/google/googletest/tree/main/overview/quick-glance/integration-overview).

---

For more information, visit the [GoogleTest repository](https://github.com/google/googletest) and consult the extensive documentation and examples provided.
