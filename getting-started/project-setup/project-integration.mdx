---
title: "Integrating with Your Build System"
description: "Understand how to link GoogleTest and GoogleMock libraries in your application or library, whether building with CMake, Bazel, or other systems. Covers configuration of test targets and correct header/library inclusion."
---

# Integrating with Your Build System

Welcome to the crucial guide for linking GoogleTest and GoogleMock libraries to your application or library. This page helps you integrate these testing frameworks smoothly whether you’re using CMake, Bazel, or other build systems. Here, you’ll learn how to configure your test targets correctly and include the necessary headers and libraries to run your tests seamlessly.

---

## 1. Overview

GoogleTest and GoogleMock provide C++ developers with robust tools for writing and running tests. Integration with your build system is essential to enable these frameworks in your projects. This page focuses exclusively on the practical steps to link GoogleTest and GoogleMock with various build environments, setting you up to write and run tests efficiently.


## 2. Prerequisites

Before integrating GoogleTest/GoogleMock with your build system, ensure:

- Your build environment supports C++11 or later.
- You have GoogleTest and GoogleMock libraries either downloaded or included as submodules or external dependencies.
- Required development tools and compilers compatible with your platform.
- Familiarity with your chosen build system (CMake, Bazel, Makefiles, or others).


## 3. Linking GoogleTest and GoogleMock

GoogleTest and GoogleMock can be integrated either by linking the standalone library or embedding the sources directly into your build system. The following covers the key points of integration with the major build systems.

### 3.1 Including headers

Always include GoogleTest headers in your test source files as follows:

```cpp
#include <gtest/gtest.h>
```

For mocking features, include GoogleMock via:

```cpp
#include <gmock/gmock.h>
```

Ensure your include path points to the directories containing these headers.

### 3.2 Linking Libraries

#### CMake

- If you installed GoogleTest and GoogleMock system-wide or as packages, link them using:

```cmake
find_package(GTest REQUIRED)
add_executable(MyTests my_tests.cc)
target_link_libraries(MyTests GTest::gtest_main GMock::gmock_main)
```

- To build GoogleTest/GoogleMock from source within your project, add them as subdirectories:

```cmake
add_subdirectory(googletest)
add_subdirectory(googlemock)
add_executable(MyTests my_tests.cc)
target_link_libraries(MyTests gtest gmock_main)
```

Ensure that you link with `gtest_main` or `gmock_main` to gain the default entry point.

#### Bazel

- Include `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` as dependencies in your BUILD files.

Example snippet:

```bzl
cc_test(
    name = "my_tests",
    srcs = ["my_tests.cc"],
    deps = [
        "@com_google_googletest//:gtest_main",
        "@com_google_googletest//:gmock_main",
    ],
)
```

Ensure that environment variables for Bazel test sharding and filtering are set as required.

#### Other Build Systems

- For Makefiles or custom build scripts, compile and link GoogleTest and GoogleMock source files or pre-built libraries explicitly.
- Add proper include paths and define test targets that also link the required libraries.


## 4. Configuring Test Targets

To properly configure your test targets, follow these steps:

1. **Add your test source files** that use GoogleTest and GoogleMock.
2. **Ensure header include paths** know where to find `gtest/gtest.h` and `gmock/gmock.h`.
3. **Link against the correct libraries:**
   - GoogleTest: `gtest`, `gtest_main`
   - GoogleMock: `gmock`, `gmock_main` (which transitively links GoogleTest)
4. **Set compiler options** as needed to match those of GoogleTest (e.g., C++ standard, compiler warnings).


## 5. Handling Test Filters and Environment Variables

GoogleTest uses several flags and environment variables that may affect how tests are run. When configuring your build and test execution, consider:

- `--gtest_filter`: To select or exclude specific tests.
- `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`: For test sharding across multiple machines or processes.
- `--gtest_also_run_disabled_tests`: To include disabled tests.

Set these flags in your test execution command or configure your build system’s test runner accordingly.


## 6. Common Pitfalls & Best Practices

- **Always link GoogleMock and GoogleTest libraries together if mocking features are used.** GoogleMock depends on GoogleTest internally.
- **Avoid mixing `TEST()` and `TEST_F()` in the same test suite with different fixture classes,** as this will cause runtime errors.
- **Make sure the test executable calls `InitGoogleTest()` before running `RUN_ALL_TESTS()`.** This properly initializes flags and listeners.
- If building from source, **ensure that any dependencies** such as Abseil are satisfied to avoid link errors.
- When using Bazel, **adhere strictly to the environment variables for test sharding and output files** to ensure compatibility.


## 7. Example: Integrating GoogleTest with CMake

1. Add GoogleTest and GoogleMock as submodules or download them.
2. In your root CMakeLists.txt, add:

```cmake
add_subdirectory(googletest)
add_subdirectory(googlemock)

add_executable(MyTest my_test.cc)
target_link_libraries(MyTest gmock_main)
```

3. Build your test target:

```bash
mkdir build && cd build
cmake ..
make MyTest
```

4. Run the tests:

```bash
./MyTest
```


## 8. Verifying Successful Integration

- Running your tests should produce console output with a summary of tests run and results.
- The `RUN_ALL_TESTS()` function returns `0` on success and `1` on failure.
- Test output can be configured to generate XML or JSON for CI tools.


## 9. Troubleshooting

### Problem: Linking errors related to GoogleTest/GoogleMock

- Verify that you have linked against all required libraries (`gtest`, `gmock`, `gtest_main`, `gmock_main`).
- Ensure the GoogleTest and GoogleMock sources or libraries match the compiler and platform.
- Check that include directories are correctly specified.

### Problem: Tests are not discovered or no tests run

- Make sure you have called `InitGoogleTest()` before `RUN_ALL_TESTS()`.
- Check your test filter flags (`--gtest_filter`) to ensure they are not too restrictive.
- Confirm that the test functions are correctly defined with `TEST()`, `TEST_F()`, or registered dynamically.

### Problem: Using Bazel and test shards do not run as expected

- Verify the environment variables `GTEST_SHARD_INDEX` and `GTEST_TOTAL_SHARDS` are correctly set.
- Sharding is disabled automatically for death test subprocesses.
- Check for any errors printed at startup regarding invalid shard indices.


## 10. Additional Resources

- [GoogleTest Primer](../docs/primer.md): Comprehensive introduction to test writing.
- [Integration & Dependencies](../overview/architecture-concepts/integration-and-dependencies.mdx): Deep dive into how GoogleTest relates to other components.
- [Common Use Cases](../overview/feature-overview-group/common-use-cases.mdx): Typical workflows and scenarios.
- [Configuring Test Execution](../getting-started/project-setup/configuration-options): How to control test run options and environment.
- [GoogleTest Build System Examples](https://github.com/google/googletest/tree/main/googletest): Official source repository examples.


---

For detailed debugging of integration issues, consult the Troubleshooting guide and use verbose logging in your build system.

Happy testing!