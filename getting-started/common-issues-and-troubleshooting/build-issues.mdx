---
title: "Resolving Build & Integration Issues"
description: "Common problems and their solutions when building or integrating GoogleTest/GoogleMock with various compilers, platforms, or build systems—including tips for diagnosing errors."
---

# Resolving Build & Integration Issues

This guide addresses common problems you may encounter when building or integrating GoogleTest and GoogleMock with various compilers, platforms, and build systems. It provides practical tips, diagnostic steps, and solutions to help you get past build errors and setup difficulties quickly.

---

## 1. Understanding Build Failures

Build and integration issues typically stem from incompatibilities, misconfigurations, or missing dependencies. Here's how to systematically diagnose and resolve them.

### Common Symptoms
- Compiler errors related to missing headers or symbols
- Linker errors such as unresolved external symbols
- Runtime crashes or incorrect linking with shared versus static libraries
- Compiler warnings turned errors that block compilation

### Key Diagnostic Questions
- Are you building with a supported compiler and version?
- Are required dependencies and environment settings correctly configured?
- Is your build system properly including GoogleTest and GoogleMock sources, headers, and libraries?
- Are runtime libraries (e.g., CRT on Windows) matched between your project and GoogleTest/GoogleMock?

---

## 2. Supported Environments and Compiler Requirements

GoogleTest and GoogleMock require a C++17-compatible compiler. Ensure these prerequisites:

- **Compiler Support:** GCC ≥ 7.0, Clang ≥ 3.4, MSVC ≥ Visual Studio 2017 (version 15.3+)
- **C++ Standard:** Project and GoogleTest must specify `-std=c++17` or equivalent
- **Platform Support:** Linux, macOS, Windows (Desktop), and others
- **Build Tools:** CMake 3.14 or higher is recommended

<Tip>
Use `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)` in your `CMakeLists.txt` to enforce the C++17 standard.
</Tip>

---

## 3. Build System Integration Pitfalls

### A. CMake Integration

GoogleTest and GoogleMock provide native CMake support, but incorrect usage often causes build or linkage errors.

#### Best Practices
1. **Adding GoogleTest to your project:**
   - Use `FetchContent` to download and build GoogleTest as a subproject, ensuring compiler flags and settings match.

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # Match CRT linkage on Windows
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

2. **CRT linkage on Windows:**
   GoogleTest links the C runtime statically by default, but Visual Studio projects typically link it dynamically. This mismatch leads to linker errors.

   To fix, enable the option `gtest_force_shared_crt` when configuring with CMake.

#### Common Error Example
```text
error LNK2038: mismatch detected for 'RuntimeLibrary': value 'MTd_StaticDebug' vs 'MDd_DynamicDebug'
```

#### Resolution
Pass `-Dgtest_force_shared_crt=ON` to your CMake configure step.

<Tip>
If you want to build GoogleTest only (without GoogleMock), run:
`cmake .. -DBUILD_GMOCK=OFF`
</Tip>

### B. Bazel and Other Build Systems

For Bazel, ensure dependencies and workspace files correctly point to GoogleTest/GoogleMock repos. Verify build targets, include paths, and linking.

Refer to the [Installing with Bazel](../getting-started/setup-and-installation/installing-with-bazel) guide for detailed steps.

---

## 4. Addressing Common Compiler and Linker Issues

### Missing or Undefined Symbols
- Confirm you link against the right libraries:
  - `gtest` or `gtest_main` for GoogleTest
  - `gmock` or `gmock_main` when using GoogleMock
- Check that source files (`gtest-all.cc`, `gmock-all.cc`) are included either directly or via libraries.

### Macro Name Collisions

GoogleTest uses macros for assertions like `TEST()`, `EXPECT_EQ()`. These can conflict with other libraries.

To avoid:
- Use compiler flags to rename macros, e.g., `-DGTEST_DONT_DEFINE_TEST=1` to rename `TEST` to `GTEST_TEST`

### Runtime Linkage Errors on Windows

Using different runtime linkage between your code and GoogleTest/GoogleMock can cause runtime errors:
- If building GoogleTest/GoogleMock as shared libraries (DLL), compile your tests with `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` to ensure consistent runtime linkage.
- Prefer matching runtime flags (e.g., `/MD` vs `/MT`).

### Threading Library Errors

If your environment incorrectly detects pthread availability:
- Define `-DGTEST_HAS_PTHREAD=0` or `1` explicitly.
- Add pthread linking flags (e.g., `-pthread`) manually if your build system doesn't handle that.

---

## 5. GoogleMock Specific Build Issues

### Large Mock Classes and MSVC Memory Exhaustion
- Mock classes with many methods cause compiler memory stress in MSVC, especially with `/clr` flag.
- Avoid `/clr` when compiling mocks to reduce memory usage.

### Mocking Non-virtual Methods
- GoogleMock can mock non-virtual methods via Hi-perf dependency injection.
- Ensure usage per the recipe in [gMock Cookbook](../getting-started/configuration-and-first-use/using-googlemock-basics).

### Debugging Mock Expectation Failures
- Use the flag `--gmock_verbose=info` when running tests to get detailed call traces.
- This helps identify why mock expectations are not met or why warnings appear.

<Tip>
If unexpected warnings about "uninteresting function calls" occur, consider using `NiceMock` wrappers or explicitly specify calls with `EXPECT_CALL(...).Times(AnyNumber())`.
</Tip>

---

## 6. Diagnosing Integration with Build and CI Systems

- Verify include paths are correctly set, capturing all GoogleTest and GoogleMock header directories.
- Link against the correct target libraries (`gtest`, `gmock`, and their `_main` variants).
- Use consistent compiler and linker flags across tests and libraries.
- For Continuous Integration:
  - Cache dependencies properly.
  - Build and test under clean environments.
  - Monitor verbose logs for build or test issues.

Refer to the [Integrating with Build and CI Systems](../overview/features-architecture/integration-other-systems) guide for extended tips.

---

## 7. Troubleshooting Checklist

- **Build fails with missing header files**
  - Confirm include paths.
  - Confirm if GoogleTest/GoogleMock sources are correctly added.

- **Link errors about undefined symbols**
  - Link against `gtest`, `gmock` correctly.
  - Verify runtime flags and shared/static linkage consistency.

- **Warnings or errors about macro redefinition**
  - Use `-DGTEST_DONT_DEFINE_*` flags to rename conflicting macros.

- **Mock tests warn about unexpected calls**
  - Use `NiceMock` to suppress warnings or add expectations explicitly.

- **Memory exhaustion on MSVC when compiling mocks**
  - Disable `/clr` flag.
  - Split mock class implementation into `.h` and `.cc` files as per best practices.

- **Tests crash with heapcheck errors using mocks**
  - Ensure all base classes of mocked classes have virtual destructors.

---

## 8. Additional Tips and Best Practices

- Always consult the specific compiler and platform documentation for applying recommended flags.
- Keep GoogleTest and GoogleMock libraries up to date as fixes for build and integration issues are frequent.
- When integrating with complex build systems, favor using the native CMake integration or officially recommended workspace setups.

<Note>
Comprehensive guidance and advanced troubleshooting scenarios can be found in the official GoogleTest and GoogleMock GitHub repository and [FAQ pages](../faq/troubleshooting/faq-build-errors).
</Note>

---

## 9. Getting Help

- Review the official GitHub [issues page](https://github.com/google/googletest/issues) for existing solutions.
- Consult [GoogleTest FAQ](../faq/common-questions/faq-supported-platforms) and [GoogleMock Cookbook](../docs/gmock_cook_book.md).
- Join GoogleTest user communities and mailing lists for peer support.

---

For your next steps, consider reading:
- [Installing with CMake](../getting-started/setup-and-installation/installing-with-cmake) for installation guidance.
- [Project Configuration](../getting-started/configuration-and-first-use/project-configuration) to configure your integration properly.
- [Writing and Running Your First Test](../getting-started/configuration-and-first-use/writing-first-test) to verify your setup correctness.


---

<Source url="https://github.com/google/googletest" paths='[{"path":"CMakeLists.txt","range":"1-200"},{"path":"googlemock/CMakeLists.txt","range":"1-150"},{"path":"googletest/README.md","range":"10-130"}]' />