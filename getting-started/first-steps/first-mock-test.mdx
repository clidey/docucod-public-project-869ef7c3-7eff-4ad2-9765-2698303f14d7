---
title: "Getting Started with GoogleMock (Optional)"
description: "Introduces mocking for new users who require it. Provides a simple, copy-ready example using GoogleMock for interface-based testing, with advice when to use mocks."
---

# Getting Started with GoogleMock (Optional)

GoogleMock (gMock) is GoogleTest's powerful C++ mocking framework that lets you create mock classes and set expectations on their usage in tests. This guide introduces you to the basics of mocking and provides a practical, copy-ready example using GoogleMock to get you started quickly with interface-based testing.

---

## What Is Mocking and When to Use It?

Mocking involves creating objects that simulate the behavior of real objects in controlled ways. These mock objects allow you to:

- Verify interactions between your code and its dependencies.
- Isolate the tested component by simulating collaborators.
- Control the behavior and responses of dependencies for testing edge cases or failure modes.

Use mocks when you want precise control and observation over the calls to dependent interfaces, rather than relying on real implementations or fakes.

> **Tip:** Consider using `ON_CALL()` to define default behaviors and reserve `EXPECT_CALL()` only for the calls you want to verify explicitly. This helps keep tests maintainable and less brittle.

---

## Your First Mock Class: A Simple Example

Imagine you have an interface `Turtle` for drawing operations that your code interacts with. Here's how to create a mock version:

```cpp
#include <gmock/gmock.h>  // Includes gMock.

// The interface you want to mock.
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

// The mock class.
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Explanation:
- Derive your mock class from the interface.
- Use the `MOCK_METHOD` macro to mock each virtual method.
- For const methods, add `(const, override)` qualifiers.


---

## Setting Expectations and Default Behaviors

Once you have a mock object, you can set:

- **Default behaviors** with `ON_CALL()`, which specify how the mock will behave if called, but do not enforce any expectation about whether it will be called.
- **Expectations** with `EXPECT_CALL()`, which both specify behavior and assert that the method will be called with specified arguments and usage frequency.

### Example usage with our mock turtle:

```cpp
using ::testing::AtLeast;
using ::testing::_;
using ::testing::Return;

TEST(PainterTest, UsesTurtleToDraw) {
  MockTurtle turtle;

  // Set default behavior: GetX returns initial position 0
  ON_CALL(turtle, GetX())
      .WillByDefault(Return(0));

  // Expect PenDown to be called once
  EXPECT_CALL(turtle, PenDown())
      .Times(1);

  // Expect Forward to be called with any distance at least once
  EXPECT_CALL(turtle, Forward(_))
      .Times(AtLeast(1));

  // Code under test
  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

- `ON_CALL` here sets the default return value for `GetX()` without requiring it be called.
- `EXPECT_CALL` states that `PenDown()` and `Forward(...)` must be called, with specified cardinalities.

---

## Common Mocking Patterns and Best Practices

- **Use `ON_CALL` for stub behavior:** Define the common, default behavior of mock methods.
- **Use `EXPECT_CALL` for verification:** Limit to only the interactions you intend to verify in your test.
- **Use `_` wildcard matcher:** When arguments don't matter, use `_` to say "match anything." This prevents over-specification.
- **Suppress warnings on uninteresting calls:** Wrap your mock with `NiceMock<YourMock>` to avoid noise for methods you don't care about.
- **Enforce strict mocks when needed:** Use `StrictMock<YourMock>` to fail the test upon unexpected calls.
- **Testing call order:** Use `InSequence` scope or `.InSequence()` clause to enforce call order.
- **Retire expectations when done:** Use `.RetiresOnSaturation()` when multiple similar calls occur to avoid sticky expectations.

---

## Troubleshooting Common Issues

| Symptom | Explanation & Solution |
|---|---|
| Unexpected calls cause test failures | You specified `EXPECT_CALL` but method was called with unexpected arguments or out of expected count. Check call arguments or adjust expectations.
| Warning on uninteresting calls | Your mock method was called without an `EXPECT_CALL`. Add an `EXPECT_CALL(...).Times(AnyNumber())` or use `NiceMock`.
| Mock method accidentally calls real method | Ensure the method to mock is `virtual`. Non-virtual methods canâ€™t be mocked by default.
| `EXPECT_CALL` order seems reversed | Remember newer expectations override older ones; use sequences or combine actions within one `EXPECT_CALL`.
| No verification on heap-allocated mocks | Either ensure proper deletion or use `Mock::VerifyAndClearExpectations()` manually.

---

## Summary Checklist for Your First Mock Test

- [ ] Define your mock class inheriting from your interface
- [ ] Use `MOCK_METHOD` to mock virtual methods
- [ ] Initialize your mock object in your test
- [ ] Set default behaviors with `ON_CALL` (optional)
- [ ] Add verification with `EXPECT_CALL` only on methods you want to assert
- [ ] Exercise your code under test
- [ ] Confirm tests pass and verify expectations automatically or explicitly

---

## Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Your ultimate beginner-friendly guide.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) - Detailed documentation on gMock macros and classes.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Recipes and best practices for advanced uses.
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) - Recommended prerequisite reading if new to GoogleTest.

---

By following this guide, you'll quickly build confidence in writing interface-based tests using GoogleMock, making your C++ testing faster, more controlled, and easier to maintain.
