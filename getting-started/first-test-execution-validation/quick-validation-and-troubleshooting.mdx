---
title: "Quick Validation & Troubleshooting"
description: "A checklist of quick validation steps and resolutions to address the most common setup and configuration issues for first-time users, ensuring frustration-free onboarding and offering resources for deeper investigation if problems arise."
---

# Quick Validation & Troubleshooting

Ensure your first experience with GoogleTest and GoogleMock is seamless, by performing a set of quick validations to catch common setup and configuration issues. This page offers a checklist of steps to verify your environment and mock setup, along with clear resolutions to typical problems, enabling you to overcome roadblocks efficiently and confidently move forward.

---

## 1. Verifying Your Mock Setup

Before running tests with mocks, confirm the following essentials to avoid unexpected failures and cumbersome debugging.

### 1.1 Confirm All Mock Methods are Properly Defined
- Ensure every virtual method you intend to mock is declared with the `MOCK_METHOD` macro inside the `public:` section of your mock class.
- For const methods, add `(const)` in the macro qualifier list, e.g., `MOCK_METHOD(int, GetValue, (), (const, override));`
- Double-check you wrap types with commas properly when they include commas, either by:
  - Wrapping the entire type with parentheses, e.g., `MOCK_METHOD((std::pair<bool, int>), GetPair, ());`
  - Using type aliases for complex types to avoid parsing errors.

### 1.2 Use Correct Qualifiers and Overrides
- Add `(override)` to every method to prevent silent mismatches.
- Use additional qualifiers like `(noexcept)`, `Calltype(...)`, or `ref(&)` if overriding methods with such specifications.

### 1.3 Mock Virtual Methods Only
- Remember that only virtual methods can be mocked to reliably intercept calls. If you need to mock non-virtual methods, consider templates or redesign interfaces.

### 1.4 Avoid Common Pitfalls with Destructors
- Ensure your base classes have a **virtual destructor**; mocks depend on this to avoid leaks or undefined behavior.


## 2. Common Troubleshooting Scenarios and Solutions

Below are typical issues first-time users encounter, along with immediate fixes.

<AccordionGroup title="Troubleshooting Checklist">
<Accordion title="Unexpected Calls to Real Methods Instead of Mock Methods">
If a call to a mock object invokes the real implementation:

- **Cause:** The method you are trying to mock may not be `virtual`.
- **Resolution:** Verify the method declaration is `virtual` in the base class.
- **Tip:** Consider refactoring to add a virtual interface if missing.
</Accordion>
<Accordion title="Uninteresting Call Warnings">
GoogleMock warns when a mock method without expectation is called.

- **Cause:** No `EXPECT_CALL` or `ON_CALL` setting for this method.
- **Resolution Options:**
  - Use `NiceMock<MockClass>` to suppress such warnings when uninteresting calls are acceptable.
  - Explicitly add `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());` to silence warnings for specific methods.
- **Avoid:** Using `EXPECT_CALL` blindly to silence warnings, as this may cause brittle tests.
</Accordion>
<Accordion title="Mismatch in EXPECT_CALL Invocation Counts">

- **Cause:** The actual call count differs from specified `.Times()` or inferred calls based on `WillOnce()` and `WillRepeatedly()`.
- **Solutions:**
  - Confirm that the number of `WillOnce()` clauses covers expected call count or provide a `WillRepeatedly()`.
  - Use `.RetiresOnSaturation()` to retire saturated expectations and allow others to match.
  - Use `.Times(AnyNumber())` if the call count is flexible.
- **Tip:** Use `--gmock_verbose=info` during test runs to trace calls and understand expectation matching.
</Accordion>
<Accordion title="Compiler Warnings for Const Parameters in Mock Methods">

- **Common Warning:** MSVC warns about overriding methods differing only by const qualifiers.
- **Cause:** Top-level const qualifiers on parameters are ignored in C++ and cause this warning.
- **Solution:** Remove top-level const on parameters in both base and mock class method declarations.
</Accordion>
<Accordion title="Mock Methods Returning Move-Only Types">

- **Issue:** Mocking methods returning or accepting `std::unique_ptr` or other move-only types.
- **Guidance:**
  - Use the `MOCK_METHOD` macro normally.
  - Use lambdas or functors in `WillOnce()` or `WillRepeatedly()` for returning new instance each call.
- **Tip:** Avoid returning moved-from objects repeatedly with `Return()`; use lambdas for fresh values.
</Accordion>
<Accordion title="Duplicate or Redundant Failure Messages for Expectation Violations">

- **Cause:** gMock prints expectation states multiple times to reflect state changes at different failure moments.
- **Advice:** This is by design; focus on the timeline of failures rather than treating duplicates as redundant.
</Accordion>
</AccordionGroup>

## 3. Quick Validation Steps

Follow these steps to verify your test environment and mock correctness.

<Steps>
<Step title="Compile Your Mock Classes">
Make sure your mock classes compile without warnings or errors.
- Warnings about missing `override` or mismatched signatures indicate problems.
- If compilation fails due to complex types, factor those types into aliases.
</Step>
<Step title="Run Basic Tests with Verbose Mock Logging">
Execute your test binary with verbose mock logging enabled:

```shell
./your_test_binary --gmock_verbose=info
```

- This shows all calls to mocks including matches and uninteresting calls.
- Analyze unexpected calls and mismatches immediately.
</Step>
<Step title="Check for Unverified Expectations">
After running tests, ensure no unmet expectations exist.
- Failure to satisfy an expectation results in an error message.
- Use `Mock::VerifyAndClearExpectations(&mock_object)` in your test to verify early.
</Step>
<Step title="Address Warnings for Uninteresting Calls">
If warnings about uninteresting calls persist:
- Use `NiceMock` wrapper
- Add catch-all expectations with `.Times(AnyNumber())`
- Or explicitly define default behaviors with `ON_CALL`
</Step>
</Steps>

## 4. Understanding Mock Strictness

gMock provides three strictness levels influencing how uninteresting calls are handled.

| Mock Type               | Behavior on Uninteresting Calls                   | Usage Recommendation                 |
|------------------------|-------------------------------------------------|------------------------------------|
| `NaggyMock<T>` (default) | Prints warning, but allows call                  | Useful during early test development or debugging |
| `NiceMock<T>`            | Suppresses warnings, silently allows call        | Recommended for stable tests to reduce noise       |
| `StrictMock<T>`          | Treats uninteresting calls as errors              | Use to enforce tight test validation when needed   |

**Example Usage:**

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoSomething());
```

Use these wrappers to balance test maintainability and strictness.

## 5. How to Handle Unusual Mocking Needs

### Delegating Behavior

If you want your mock to use a real or fake objectâ€™s implementation by default:

```cpp
ON_CALL(*this, MethodName)
    .WillByDefault([this](Args... args) {
      return real_object.MethodName(args...);
    });
```

### Mocking Non-Virtual Methods

For non-virtual methods, consider redesigning to use interfaces or templates, as direct mocking is not possible.

### Mocking Destructors

Since destructors cannot be mocked directly, add a mock method `Die()` called inside the destructor:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```

Expect and verify `Die()` calls instead.

## 6. Common Sources of Confusing Behavior

- **Order of Expectations Matters:** Newer expectations override older; put catch-all expectations before specific ones.
- **Sticky Expectations:** By default, saturated expectations remain active leading to upper-bound violations unless retired.
- **Using `.RetiresOnSaturation()`:** Prevents sticky expectation issues by retiring expectations once saturated.

## 7. Additional Resources and Support

- See [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for approachable tutorials.
- Consult the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick reference.
- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes and common patterns.
- Visit the [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) for specific common problems and expert answers.
- Refer to the related getting-started pages for installation, configuration, writing your first test, and building and running tests.

---

For complex debugging, running tests with `--gmock_verbose=info` combined with `--gtest_stack_trace_depth=0` provides detailed mock call information without cluttering with stack traces.

Ensure that your mock classes use proper virtual destructors and are declared with all necessary overrides, and remember that mocking behavior is driven by expectations set *before* the code under test exercises the mock objects.

If you encounter issues beyond these common scenarios, please consult the broader GoogleTest and gMock documentation or community support channels.


---

**Helpful Links:**
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [gMock Reference](https://google.github.io/googletest/reference/mocking.html)
- [Feature Summary](../../overview/feature-overview/feature-summary.md)
- [Supported Platforms](../../overview/feature-overview/supported-platforms.md)
- [Installation Guide](../../getting-started/setup-prerequisites-installation/installation-methods.md)


<Check>
Remember:
- Set expectations before exercising mocks.
- Use `NiceMock` or `StrictMock` to control warning levels.
- Use `--gmock_verbose=info` to diagnose matching issues.
</Check>
