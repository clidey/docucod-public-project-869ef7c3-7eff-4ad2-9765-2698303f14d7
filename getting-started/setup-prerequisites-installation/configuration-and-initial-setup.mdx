---
title: "Configuration and Initial Setup"
description: "Learn how to configure build files, link dependencies, and integrate GoogleTest/GoogleMock into your project structure for a seamless development experience. This page covers minimal configuration to get your test targets compiling and ready."
---

# Configuration and Initial Setup

Learn how to configure build files, link dependencies, and integrate GoogleTest and GoogleMock into your project structure for a seamless development experience. This page covers the minimal configuration you need to get your test targets compiling and ready.

---

## 1. Prerequisites & Environment Preparation

Before configuring your project to use GoogleTest and GoogleMock, ensure your environment meets the following requirements:

- **C++17 Support**: Your compiler must support C++17 or later.
- **CMake**: Recommended for easy integration and build management. Version 3.14 or higher is ideal.
- **Source Access**: Have the GoogleTest and GoogleMock source, either via cloning the repository or by including it as a submodule or external dependency.

<Check>
Make sure your development environment supports multithreading, especially if you plan on running tests in parallel. On non-pthreads platforms (e.g., Windows), thread safety may require additional configuration.
</Check>

---

## 2. Configuring Your Build Files

You need to properly link GoogleTest and GoogleMock libraries and headers to your test targets. The instructions below assume you use CMake; adapt accordingly if you use another build system.

### 2.1. Include GoogleMock and GoogleTest in Your Build

GoogleMock is bundled with GoogleTest and extends it. To include both:

- Fetch the GoogleTest source code as part of your project or install it system-wide.
- Use `add_subdirectory()` in your `CMakeLists.txt` to incorporate the GoogleTest source.

Example minimal `CMakeLists.txt` snippet:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Fetch GoogleTest and GoogleMock if not already present
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
)
# For Windows: dynamically link CRT
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

# Add your test executable
add_executable(my_tests test_sample.cpp)

# Link the test executable with GoogleTest and GoogleMock
# Use gmock_main to get main() function for your tests
target_link_libraries(my_tests PRIVATE gmock_main)

# Enable testing and add tests
enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

### 2.2. Linking Explanation

- `gmock_main` includes GoogleMock and GoogleTest, and also provides a default `main()` function for running tests.
- You can link with `gmock` if you prefer to write a custom `main()`.

<Note>
Linking against `gmock_main` is recommended unless you have special initialization needs.
</Note>

---

## 3. Setting Up Your Source Files for Testing

### 3.1. Including Headers

In your test source files, include the GoogleMock header:

```cpp
#include <gmock/gmock.h>
```

This header automatically includes GoogleTest headers and all mock-related facilities.

### 3.2. Writing a Basic Test

For example, a simple test can look like:

```cpp
#include <gmock/gmock.h>

using ::testing::Test;

TEST(ExampleTest, SimpleAssertion) {
  EXPECT_EQ(1 + 1, 2);
}
```

---

## 4. Initializing GoogleMock and Running Tests

If you've linked with `gmock_main`, the test runner initialization is done for you.

If you write your own `main()`, initialize the framework as follows:

```cpp
#include <gmock/gmock.h>

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This initializes both GoogleTest and GoogleMock, parses all testing-related flags, and executes all tests.

<Warning>
Do not forget to pass command line arguments to `InitGoogleMock`, or test flags may not be recognized.
</Warning>

---

## 5. Minimal Example: Full Setup Walkthrough

Follow these steps to get started quickly:

<Steps>
<Step title="Step 1: Clone GoogleTest">Clone the googletest repository at a stable release:<br><br>```bash
git clone https://github.com/google/googletest.git -b v1.17.0
```</Step>
<Step title="Step 2: Setup your CMakeLists.txt">Create or edit your `CMakeLists.txt` to include GoogleTest as a dependency. Use the FetchContent module or add it as a subdirectory if you have cloned it locally (see Section 2 for example).</Step>
<Step title="Step 3: Create your test file">Write a test source file (`test_sample.cpp`) that includes `<gmock/gmock.h>` and contains at least one `TEST()` or `TEST_F()` macro.</Step>
<Step title="Step 4: Build your tests">Generate and build your project using CMake:<br><br>```bash
mkdir build && cd build
cmake ..
cmake --build .
```</Step>
<Step title="Step 5: Run your tests">Run the compiled test executable:<br><br>```bash
./my_tests
```<br>This runs all your tests and reports results to the console.</Step>
</Steps>

---

## 6. Practical Tips & Best Practices

- **Use `gmock_main` library** unless you need custom test initialization.
- **Keep mock classes in test-only directories** or files to avoid leaking test code into production binaries.
- **Avoid mocking code you do not own**; instead use adapters or interfaces owned by your code.
- **Name test suites and fixtures clearly** following C++ style guidelines (avoid underscores).
- **Leverage sequences (`::testing::InSequence`)** to test call orders when needed.

---

## 7. Common Troubleshooting

<AccordionGroup title="Troubleshooting" >
<Accordion title="Build Fails with Compiler Errors Related to Runtime Library Mismatch on Windows">
This is often caused by differences between your project's runtime linkage (dynamic vs static) and GoogleTest's default. Fix it by setting `gtest_force_shared_crt` to `ON` as shown in the sample CMakeLists.txt in section 2.1.
</Accordion>
<Accordion title="Tests Do Not Run or No Output Shows Up">
Make sure you linked to `gmock_main` or that your `main()` calls `testing::InitGoogleMock(&argc, argv);` before running `RUN_ALL_TESTS()`.
</Accordion>
<Accordion title="GoogleMock Macros Like `EXPECT_CALL` Are Not Found">
Verify your source file includes `<gmock/gmock.h>`. Don't include GoogleTest headers alone when using mocks.
</Accordion>
<Accordion title="Linker Errors About Missing Symbols from gmock or gtest">
Check that your test executable links to `gmock_main` or `gmock` and `gtest` properly. Ensure you have built GoogleTest libraries first if using them separately.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps

After successful setup and initial test compilation:

- Write more tests including mocks; start with [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html).
- Explore advanced configuration and mock features in the [Mocking Reference](../docs/reference/mocking.md).
- Review integration with your build system if not using CMake.
- Check the [GoogleTest Primer](../docs/primer.md) for writing effective tests.

---

## References

- [GoogleTest GitHub](https://github.com/google/googletest) repository
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) tutorial
- [GoogleTest Primer](../docs/primer.md)
- [Mocking Reference](../docs/reference/mocking.md)
- [Installation and Build Instructions](../getting-started/setup-prerequisites-installation/installation-methods.md)

---

Unlock the power of automated testing with GoogleTest and GoogleMock by correctly configuring your environment and projects with these essential steps. Start running robust, maintainable C++ tests in no time!
