---
title: "Configuration and Initial Setup"
description: "Step-by-step guidance on configuring your project to use GoogleTest and GoogleMock. Learn how to link libraries, include necessary headers, and tailor your environment for different build systems (CMake, Bazel, others)."
---

# Configuration and Initial Setup

Configure your project to use GoogleTest and GoogleMock effectively with this step-by-step guide. Learn how to include necessary headers, link against the libraries, and tailor the setup for your build system, covering CMake, Bazel, and manual configurations.

---

## 1. Include GoogleMock Headers

To start using GoogleMock in your tests, include its main header file `gmock.h`. This header consolidates the necessary components for mocking:

```cpp
#include <gmock/gmock.h>
```

This single include file brings in mocking facilities such as actions, matchers, cardinalities, and function mockers. It also handles initialization routines for GoogleMock and GoogleTest.

> **Tip:** Always include `gmock/gmock.h` instead of individual headers for easier maintenance and consistency.

---

## 2. Initialize GoogleMock and GoogleTest

Before running your tests, initialize GoogleMock (which also initializes GoogleTest) by calling `InitGoogleMock()`. This function parses command-line flags for both frameworks and prepares the environment.

### Initialization Examples

- **Standard initialization with `argc` and `argv` (typical for main functions):**

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- **Windows UNICODE mode (using `wchar_t`):**

```cpp
int wmain(int argc, wchar_t** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- **Embedded/Arduino platforms without command line arguments:**

```cpp
testing::InitGoogleMock();
```

> **Note:** Calling `InitGoogleMock` ensures that both GoogleMock and GoogleTest flags are recognized and removed from `argv`.

---

## 3. Link Against GoogleTest and GoogleMock Libraries

To successfully compile and run your tests with mocking support, link your test binaries against both GoogleTest and GoogleMock libraries.

### Typical Link Targets:

- `gtest` - GoogleTest core
- `gmock` - GoogleMock core (includes GoogleTest dependencies)
- `gtest_main` - GoogleTest main() function implementation
- `gmock_main` - GoogleMock main() function implementation (includes GoogleTest)

### Recommendation:

Link against `gmock_main` and `gmock` to use the built-in `main()` function that initializes both frameworks and runs all tests.

Example linking flags for CMake projects:

```cmake
target_link_libraries(my_test PRIVATE gmock_main)
```

For manual makefiles, link with corresponding libraries, e.g.: 

```
-lpthread -lgmock_main -lgmock -lgtest
```

> **Tip:** The `gmock_main` library contains an example `main()` in `gmock_main.cc` that calls `InitGoogleMock` and runs all tests. Linking this avoids writing your own main function.

---

## 4. Configure Your Build System

### 4.1 CMake

GoogleTest and GoogleMock provide official CMake support. To add GoogleTest/GoogleMock to your CMake project:

#### Option 1: Using Installed Libraries

After installing GoogleTest/GoogleMock, use `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(my_test test.cpp)
target_link_libraries(my_test PRIVATE GTest::gmock_main)
```

#### Option 2: Building as Part of Your Project

Include GoogleTest as a subdirectory for consistent compiler/linker flags:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# This prevents runtime library conflicts on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test PRIVATE gmock_main)
```

> **Best Practice:** Set C++ standard at least to C++17 using `set(CMAKE_CXX_STANDARD 17)`.

### 4.2 Bazel

If using Bazel, GoogleTest and GoogleMock are usually available as external dependencies. Refer to your workspace setup to include the appropriate Bazel rules and dependencies.

> **See:** The [Integration and Platform Support](https://google.github.io/googletest/integration-and-platforms.html) guide for detailed Bazel instructions.

### 4.3 Manual Build Systems

When building without CMake or Bazel:

- Download or clone GoogleTest/GoogleMock sources
- Ensure your compile flags support C++17
- Compile GoogleTest and GoogleMock sources
- Link compiled static or shared libraries to your test binaries

> **Tip:** Follow compilation and linking order carefully to avoid undefined reference errors.

---

## 5. Include Paths and Compiler Flags

Make sure your compiler knows where to find GoogleTest and GoogleMock headers by adding the following include paths:

- `googletest/include`
- `googlemock/include`

Example (GCC/Clang):

```
-I/path/to/googletest/include -I/path/to/googlemock/include
```

### C++ Standard

GoogleTest and GoogleMock require C++17 or later.

In CMake:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

In compiler command line:

```
-std=c++17
```

> **Note:** Setting the standard consistently prevents build and linker issues.

---

## 6. Setting GoogleMock Behavior with Flags

You can customize GoogleMock behavior using runtime flags (typically passed as command-line arguments):

| Flag                             | Description                                                                       |
|---------------------------------|-----------------------------------------------------------------------------------|
| `--gmock_catch_leaked_mocks=0/1` | Disable or enable failure on leaked mock objects (default is enabled).          |
| `--gmock_verbose=info|warning|error` | Control verbosity of GoogleMock output (default is `warning`).                  |

Flags are parsed during `InitGoogleMock()`. You can also set them programmatically:

```cpp
::testing::FLAGS_gmock_verbose = "error";
```

---

## 7. Example: Minimal Setup for a Basic Test with Mock

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int Bar(int x) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x), (override));
};

TEST(FooTest, BarReturnsExpectedValue) {
  MockFoo mock_foo;

  ON_CALL(mock_foo, Bar(::testing::_))
      .WillByDefault(::testing::Return(7));

  EXPECT_CALL(mock_foo, Bar(42))
      .Times(1);

  EXPECT_EQ(mock_foo.Bar(42), 7);
}

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Compile and link this file with GoogleMock and GoogleTest libraries, then run the resulting executable.

---

## 8. Troubleshooting

### Common Issues

- **Missing headers or symbols:**
  - Verify include paths and link libraries.
  - Ensure GoogleMock and GoogleTest are correctly installed.

- **C++ standard errors:**
  - Confirm the `-std=c++17` or equivalent compiler flag is set.

- **Linker errors on Windows with CRT mismatches:**
  - Use `gtest_force_shared_crt` CMake option to align runtime linkage.

- **Flags not recognized or ignored:**
  - Make sure to call `InitGoogleMock()` *before* running tests or setting flags.

<Tip>
If you encounter unresolved external symbols, especially on Windows, verify that you are linking consistently with GoogleMock's libraries, and check for any CRT mismatches between your project and GoogleMock build.
</Tip>

---

## 9. Additional Resources

- [GoogleTest Primer Guide](../primer.md) — Learn basics of GoogleTest usage.
- [gMock Cheat Sheet](../gmock_cheat_sheet.md) — Quick reference for mocking syntax.
- [Integration and Platform Support](../overview/features-integration/integration-and-platforms.md) — Details on various platform integrations.
- [Installation Instructions](../getting-started/setup-prerequisites-installation/installation-platforms.md) — How to install GoogleTest and GoogleMock.
- [Mocking Reference](../docs/reference/mocking.md) — In-depth explanation of mocking APIs.

For source code, see the main header file: [`gmock/include/gmock/gmock.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock.h).

---

Configure your project now using these actionable steps to smoothly integrate GoogleTest and GoogleMock into your development workflow, enabling powerful C++ test automation and mocking.
