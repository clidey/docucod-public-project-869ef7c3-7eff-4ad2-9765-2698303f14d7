---
title: "Build Configuration"
description: "Explains the typical configuration steps after installation, including integrating GoogleTest/GoogleMock with your project's build system and linking test targets. Addresses basic setup for CMake, Bazel, and direct source builds, focusing on ensuring first-time build success."
---

# Build Configuration

This page guides you through the essential build configuration steps after installing GoogleTest and GoogleMock. You will learn how to integrate these frameworks into your existing project’s build system and link your tests correctly, focusing on common build systems like CMake, Bazel, and direct source integration. The goal is to ensure your very first build with GoogleTest succeeds without hassle.

---

## 1. Overview of Build Configuration

After installing GoogleTest, your next step is to configure your build system so your project can compile, link, and run tests using GoogleTest and GoogleMock. This involves:

- Including GoogleTest/GoogleMock headers and sources.
- Linking test targets against the GoogleTest libraries.
- Setting compiler flags, including C++17 standard and threading support.

This page covers basic examples for three common build systems:

- CMake
- Bazel
- Direct source build (manual compilation)

---

## 2. CMake Integration

GoogleTest provides a comprehensive CMake build setup that you can either build as a standalone project or integrate as a subdirectory into your existing CMake project.

### 2.1 Using Installed GoogleTest Libraries

Once GoogleTest is installed on your system, you can import it using `find_package` and link against `GTest::gtest` and `GTest::gtest_main`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_main.cpp other_test_files.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

Make sure your compiler standard is set to C++17 or later:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

> **Tip:** Linking with `gtest_main` provides a ready-made `main()` function. If you want to customize `main()`, link with `gtest` only and provide your own main function calling `testing::InitGoogleTest()` and `RUN_ALL_TESTS()`.

### 2.2 Adding GoogleTest as a Subdirectory

For tighter integration and consistent compiler/linker settings, add GoogleTest as a subdirectory:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp other_test_files.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)
```

On Windows, you may need to enable the option to use shared runtime libraries:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This avoids runtime library mismatch errors.

### 2.3 Compiler and Linker Flags

GoogleTest’s CMake build defines necessary compiler features like `-DGTEST_HAS_PTHREAD=1` when pthread is available, and enforces C++17. You generally don't need to set these manually if you use GoogleTest's CMake integration. However, if you're building manually, see section 4 below.

---

## 3. Bazel Integration

GoogleTest supports Bazel as a build system. When using Bazel, you typically add a dependency on the `@com_google_googletest//` repository in your BUILD files.

Example:

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

Bazel handles compilation flags internally, so no specific flags are generally required. Consult Bazel documentation and GoogleTest's Bazel repository for advanced customization.

---

## 4. Direct Source Integration (Manual Build)

If you prefer to build GoogleTest by directly compiling the source files alongside your project without a build system integration, follow these steps:

### 4.1 Include Headers and Source Files

Add the GoogleTest source files `src/gtest-all.cc` and, if using GoogleMock, `googlemock/src/gmock-all.cc` to your compilation list.
Make sure to include include directories:

```
/path/to/googletest/include
/path/to/googlemock/include
```

### 4.2 Set Compiler Flags

- Ensure that your compiler supports and uses C++17:

```bash
-std=c++17
```

- Define macro `GTEST_HAS_PTHREAD=1` if your platform supports pthreads, or 0 if not.

- Add pthread library when linking:

```bash
-pthread
```

Example compilation command:

```bash
clang++ -std=c++17 -I/path/to/googletest/include -I/path/to/googlemock/include \
  -DGTEST_HAS_PTHREAD=1 -pthread \
  test_mycode.cpp \
  /path/to/googletest/src/gtest-all.cc \
  /path/to/googlemock/src/gmock-all.cc \
  -o my_tests
```

### 4.3 Link Libraries

Link the pthread library on POSIX systems and ensure all dependencies are resolved.

---

## 5. Linking Your Test Targets

Whether you’re using CMake, Bazel, or manual compilation, your test targets should link against one of the following:

- **`gtest_main`**: Provides a `main()` function that calls `RUN_ALL_TESTS()`.
- **`gtest`**: Does not provide `main()`, so you must provide your own `main()` function.

If your tests use GoogleMock features, include `gmock` and `gmock_main` accordingly.

Example CMake:

```cmake
target_link_libraries(my_tests PRIVATE gtest_main gmock)
```

Example manual:

```bash
clang++ ... -lgtest_main -lgmock ...
```

---

## 6. Best Practices & Troubleshooting

### 6.1 Best Practices

- Always ensure your project and GoogleTest use the **same compiler flags and runtime settings**, especially on Windows (dynamic vs static CRT).

- Prefer to link with `gtest_main` to avoid having to write your own `main()` function.

- Use build system integration (e.g., CMake subdirectory or Bazel deps) whenever possible to avoid manual flag management.

- Check that your compiler version supports **C++17 or later**, as required by GoogleTest.

### 6.2 Common Issues & Fixes

| Issue                                                      | Solution                                                                                     |
| ---------------------------------------------------------- | -------------------------------------------------------------------------------------------- |
| Mismatch in runtime libraries (ex: MT vs MD on Windows)    | Set `gtest_force_shared_crt` option ON in CMake or adjust your project's runtime library flags. |
| Link errors for pthread symbols                             | Ensure `-pthread` linker flag is present (or equivalent) and macro `GTEST_HAS_PTHREAD=1` is defined. |
| Undefined reference to `main` when linking to `gtest` only | Link with `gtest_main` or provide your own `main()` calling `InitGoogleTest` and `RUN_ALL_TESTS()`. |
| Compilation errors due to C++ standard version mismatch     | Add `-std=c++17` or equivalent flag in your compile commands or CMakeLists.                  |

---

## 7. First Build Success Checklist

To verify that you have successfully configured your build:

- Your test targets compile without errors, including GoogleTest headers.
- The linker resolves all GoogleTest symbols.
- Running your test executable runs the tests and reports passes/failures.
- If using CMake, `ctest` runs your tests.

If any of these fail, refer to the troubleshooting tips above.

---

## 8. Next Steps

Once your build configuration is working:

- Move on to writing and building your first test: see [Create and Build Your First Test](/getting-started/first-run-validation/create-first-test).
- Learn to write assertions and test fixtures in the core testing workflows guides.
- Explore integration with continuous integration pipelines for automated testing.

---

## References and Links

- [GoogleTest CMakeLists.txt (source)](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- [Using GoogleTest with CMake](https://cmake.org/cmake/help/latest/module/FindGTest.html)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [Installation Methods Guide](/getting-started/setup-prerequisites-installation/installation-methods)
- [Pkg-config Integration](docs/pkgconfig.md)
- [Bazel Build Integration](https://docs.bazel.build/versions/main/tutorial/cpp.html)

<Tip>
If you face specific build errors, consult the [Troubleshooting Setup Issues](/getting-started/first-run-validation/troubleshooting-setup-issues) page for detailed fixes.
</Tip>