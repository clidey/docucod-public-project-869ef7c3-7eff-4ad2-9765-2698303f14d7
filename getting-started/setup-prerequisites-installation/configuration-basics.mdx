---
title: "Configuration Basics"
description: "Learn how to configure GoogleTest after installation, including initial project setup, main file integration, and how to include GoogleTest headers in your C++ tests for seamless compilation."
---

# Configuration Basics

Configure GoogleTest and GoogleMock to work seamlessly with your C++ projects after installation. This guide covers how to integrate the GoogleTest main file, set up your project structure, and include the necessary GoogleTest headers in your test sources for smooth compilation.

---

## 1. Initial Project Setup

To start using GoogleTest in your C++ project, establish a clear project structure and include GoogleTest sources or link against installed libraries:

- Organize your tests in a dedicated directory (e.g., `tests/`).
- Ensure your build system includes GoogleTest headers and links to GoogleTest and GoogleMock libraries.
- Decide whether to use the `gtest_main` or `gmock_main` libraries which provide a default `main()` function.

### Example Directory Structure
```plaintext
project_root/
├── src/
│   └── your_code.cc
├── tests/
│   ├── your_tests.cc
│   └── CMakeLists.txt
├── CMakeLists.txt
```

### Including GoogleTest
In your `CMakeLists.txt` or build scripts, add:

```cmake
find_package(GTest REQUIRED)
include_directories(${GTEST_INCLUDE_DIRS})

target_link_libraries(your_test_executable ${GTEST_LIBRARIES} pthread)
```

> **Tip:** When using GoogleMock, link against `gmock_main` instead of `gtest_main`.

---

## 2. Adding GoogleTest Main File

GoogleTest provides a ready-to-use main function in the `gtest_main` library, and GoogleMock provides one in `gmock_main`. Using these simplifies your test executables by handling initialization and test execution internally.

### Using `gtest_main`
Link your test executable against `gtest_main` to avoid defining your own `main()`:

```cmake
target_link_libraries(your_test_executable gtest_main pthread)
```

This provides a standard `main()` that:

- Calls `testing::InitGoogleTest()` to initialize the framework.
- Runs all tests with `RUN_ALL_TESTS()`.

### Using `gmock_main`
If you are combining GoogleMock with GoogleTest, link against `gmock_main`:

```cmake
target_link_libraries(your_test_executable gmock_main pthread)
```

This library initializes both GoogleMock and GoogleTest internally, calling `testing::InitGoogleMock()` which covers both initialization and parsing of GoogleMock-specific flags.

> **Note:** If you want custom initialization behavior (e.g., manipulating command-line arguments), you can write your own `main()` and call `testing::InitGoogleMock(&argc, argv);`.

---

## 3. Including GoogleTest Headers

For your test files to compile correctly, include GoogleTest and GoogleMock headers explicitly.

### Basic Includes
Add these lines at the top of your `.cc` or `.cpp` test files:

```cpp
#include "gtest/gtest.h"
#include "gmock/gmock.h"  // Only if using GoogleMock
```

- `gtest/gtest.h` provides core testing utilities, macros, assertions, and test fixtures.
- `gmock/gmock.h` provides mock class definitions, expectations, and actions.

### Sample Test File Example
```cpp
#include "gtest/gtest.h"
#include "gmock/gmock.h"

// Simple test case
TEST(MyTestSuite, MyTestCase) {
  EXPECT_EQ(1, 1);
}
```

> **Tip:** Don't forget to use double quotes "" or angle brackets <> appropriately depending on your include path setup.

---

## 4. Environment Initialization

GoogleTest requires explicit initialization to parse command-line flags and prepare the test environment.

### With `gtest_main` or `gmock_main`
No action needed; initialization is handled internally.

### Without `gtest_main` / `gmock_main`
Define your own `main()` as follows:

```cpp
#include "gtest/gtest.h"
#include "gmock/gmock.h"  // if using GoogleMock

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- `testing::InitGoogleMock()` initializes both GoogleTest and GoogleMock, parsing recognized flags and removing them from `argv`.

> **Note:** Using `InitGoogleMock()` also initializes GoogleTest internally. You do not need to call `InitGoogleTest()` separately.

---

## 5. Best Practices and Tips

- **Linking:** Prefer linking against `gmock_main` or `gtest_main` for quick setup.
- **Compilation:** Set your build to use C++17 or above to meet GoogleTest requirements.
- **Headers:** Always include headers explicitly to avoid build issues.
- **Namespace:** GoogleTest uses the `testing` namespace; consider using `using namespace testing;` locally in tests to reduce verbosity.

---

## 6. Common Pitfalls

- **Multiple Main() Definitions:** Linking both `gtest_main` and `gmock_main` together or defining your own `main()` causes linker errors. Use only one source of `main()`.
- **Missing Link Libraries:** Ensure you link with pthread on Unix-like systems.
- **Command-Line Flags Parsing:** When writing your own `main()`, always call `InitGoogleMock(&argc, argv)` to handle GoogleMock/GoogleTest flags correctly.
- **Incorrect Include Paths:** Confirm your include directories are properly set in your build system to find `gtest/gtest.h` and `gmock/gmock.h`.

---

## 7. Verifying Configuration

After configuring, build and run a simple test to verify:

```cpp
#include "gtest/gtest.h"

TEST(ExampleTest, BasicEquality) {
  EXPECT_EQ(5, 5);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Compile, link, and run:

```bash
./your_test_executable
```

Output should indicate running one test and PASS.

---

## 8. Additional Resources

- [Writing Your First Test](https://yourdocs/getting-started/first-test-usage-validation/creating-first-test)
- [Building & Running Tests](https://yourdocs/getting-started/first-test-usage-validation/building-running-tests)
- [Troubleshooting and Validation](https://yourdocs/getting-started/first-test-usage-validation/troubleshooting-validation)
- [GoogleMock Cookbook](https://yourdocs/guides/advanced-testing-patterns/using-gmock)

---

## Summary
You have now learned how to configure your project to use GoogleTest and GoogleMock after installation. This includes project layout recommendations, linking against the appropriate main libraries to avoid custom `main()` implementations, correctly including required headers, and calling necessary initialization functions if you opt for a custom `main()`.

Following these steps ensures your C++ test files compile and run seamlessly, allowing you to focus on writing effective tests.

---

# Appendix: Understanding `InitGoogleMock` Behavior

The `testing::InitGoogleMock(int* argc, char** argv)` function not only initializes GoogleMock but also GoogleTest internally. During initialization, it scans command-line arguments for GoogleMock flags (e.g., `--gmock_verbose`, `--gmock_default_mock_behavior`) and extracts them, ensuring the testing framework is correctly configured before running tests.

This is why, if you use `InitGoogleMock`, you do not separately call `InitGoogleTest`. The library handles both.

---

## Example Custom `main()` Using GoogleMock Initialization

```cpp
#include "gmock/gmock.h"
#include "gtest/gtest.h"

int main(int argc, char** argv) {
  // Initializes GoogleMock and GoogleTest, parsing flags
  testing::InitGoogleMock(&argc, argv);

  // Runs all tests
  return RUN_ALL_TESTS();
}
```

Use this custom `main()` only if you need special handling of initialization. Otherwise, link against `gmock_main` to let GoogleMock handle it for you.

---

## Troubleshooting Configuration Issues

<AccordionGroup title="Common Configuration Issues">
<Accordion title="Linker errors: Multiple main() definitions">
This error often occurs when:
- You link both `gtest_main` and `gmock_main` libraries.
- You link `gtest_main` or `gmock_main` along with your own `main()` implementation.

**Solution:** Use only one source of `main()`: either link to a main library or provide your own.
</Accordion>
<Accordion title="Missing pthread during linking on Unix-like systems">

GoogleTest requires pthread for thread safety.

**Solution:** Add `-pthread` flag to your compile and link commands.
Example in CMake:
```cmake
target_link_libraries(your_executable pthread)
```
</Accordion>
<Accordion title="Cannot find GoogleTest headers">

Your build system might miss or have incorrect include directories.

**Solution:** Add GoogleTest include directories to your compiler’s header search path.
In CMake:
```cmake
include_directories(${GTEST_INCLUDE_DIRS})
```
</Accordion>
</AccordionGroup>
