---
title: "Introducing GoogleMock: Your First Mock Test"
description: "Show how to set up and use basic mocking in a test, helping users validate code that depends on other components. Includes writing a mock class and setting expectations."
---

# Introducing GoogleMock: Your First Mock Test

Welcome to your first experience with GoogleMock, the powerful C++ mocking framework designed to help you validate code that depends on other components seamlessly. This guide walks you through setting up basic mocking in a test case, including writing a mock class, setting expectations on mock methods, and running your first mocked test.

---

## 1. Understanding the Purpose of Your First Mock Test

When testing, often your code interacts with other components or interfaces. Instead of relying on real implementations—which may be slow, unavailable, or hard to control—you use mocks. Mocks simulate behaviors, letting you focus on the interactions and logic of the code under test.

Your goal here:

- Create a mock class that emulates a dependency.
- Set expectations to verify how that dependency is used.
- Run your code with the mock and validate interactions.

This guide will introduce the minimal steps to achieve these outcomes.

---

## 2. Prerequisites

Before diving into writing your first mock test:

- **Development environment**: Ensure GoogleTest and GoogleMock are installed and integrated into your build system (see [Installation & Integration](../environment-installation/installation-integration) for details).
- **Concept readiness**: Familiarize yourself with the basics of GoogleTest and have a simple test setup ready (you can review [Creating and Running a Basic Test](hello-world-test) if needed).
- **Basic C++ knowledge**: Comfortable with interfaces, inheritance, and virtual methods.

---

## 3. Writing Your First Mock Class

### Step 3.1: Identify the Interface to Mock

Suppose you have a production interface representing a component, for example:

```cpp
class Database {
 public:
  virtual ~Database() {}
  virtual bool Connect(const std::string& url) = 0;
  virtual int GetRecordCount() const = 0;
  virtual void Close() = 0;
};
```

As you can see, it has virtual methods, which GoogleMock requires to generate mocks.

### Step 3.2: Define the Mock Class

Derive a mock class using the `MOCK_METHOD` macro, placing these lines in the `public:` section:

```cpp
#include <gmock/gmock.h>  // Include GoogleMock header

class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), (override));
  MOCK_METHOD(int, GetRecordCount, (), (const, override));
  MOCK_METHOD(void, Close, (), (override));
};
```

**Key points:**
- Use the exact method signature but split into three arguments to `MOCK_METHOD`: return type, method name, argument types in parentheses.
- Include `(const)` if method is `const`.
- Add `(override)` as a C++11 best practice to guarantee overriding.

> <Tip>
> When argument types or return types contain commas (e.g., templates), wrap them in extra parentheses or create type aliases to avoid parsing errors.
> </Tip>

---

## 4. Setting Expectations on Your Mock

Expectations specify how you anticipate your code under test to interact with the mock.

### Step 4.1: Include the Testing Namespaces

For convenience:

```cpp
using ::testing::Return;
using ::testing::_;  // The wildcard matcher
```

### Step 4.2: Setup the Test and Expectations

Example test that uses the mock:

```cpp
TEST(DatabaseUserTest, ConnectsAndQueriesCount) {
  MockDatabase mock_db;

  // Set default behavior for any Connect call
  ON_CALL(mock_db, Connect(_))
      .WillByDefault(Return(true));

  // Expect that Connect is called exactly once with "my_db_url"
  EXPECT_CALL(mock_db, Connect("my_db_url"))
      .Times(1)
      .WillOnce(Return(true));

  // Expect GetRecordCount to be called at least once and return 42
  EXPECT_CALL(mock_db, GetRecordCount())
      .WillRepeatedly(Return(42));

  // Code under test
  bool connected = mock_db.Connect("my_db_url");
  int count = mock_db.GetRecordCount();

  EXPECT_TRUE(connected);
  EXPECT_EQ(count, 42);
}
```

**Explanation:**
- `ON_CALL` sets the default action (called when no expectation matches).
- `EXPECT_CALL` sets an expectation and optionally an action.
- `_` is a matcher that accepts any argument.

> <Tip>
> Use `EXPECT_CALL()` only when you want to verify the call is made. Otherwise, use `ON_CALL()` to set default behaviors and keep tests less fragile.
> </Tip>

---

## 5. Running Your First Mock Test

### Step 5.1: Build Your Test

Compile your test using your build system or compiler with GoogleTest and GoogleMock linked.

### Step 5.2: Execute the Test

Run the generated test executable. If all occurs as expected, you should see a pass.

### Step 5.3: Interpret Output

GoogleMock will automatically verify that all expectations were met when the mock objects are destroyed. In case of failures, the test output will guide you precisely:

- Which mock method failed its expected call count.
- Arguments that did not match expected values.
- Ordering violations if sequences or `.After()` clauses are used.

> <Check>
> Successful test execution confirms your understanding and correct use of GoogleMock's mocking capabilities.
> </Check>

---

## 6. Common Pitfalls & Best Practices

- **Always mock virtual methods**: GoogleMock can only mock virtual methods effectively.
- **Set expectations before exercising code**: Set all `EXPECT_CALL`s before calling functions that use the mocks.
- **Avoid over-specification**: Specify only the expectations necessary for the test to succeed.
- **Use sequences for strict order**: If order matters, use `Sequence` and `.InSequence()`.
- **Retiring expectations**: Use `.RetiresOnSaturation()` to make expectations stop matching after fulfillment.
- **Suppress warnings on uninteresting calls**: Use `NiceMock<YourMockClass>` to avoid noisy warnings.

---

## 7. Next Steps

Now that you have your first mock test:

- Explore more complex mocking scenarios in [Creating and Using Test Doubles with GoogleMock](../../guides/getting-started/first-mocking-workflow).
- Learn about matchers to verify function arguments beyond exact matching.
- Understand action chaining and custom actions for simulating complex behaviors.
- Dive into sequences and partial ordering for testing call orders.
- Visit the [gMock Cookbook](../../docs/gmock_cook_book.html) for recipes and advanced techniques.

---

## 8. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Common Mock Test Issues">
<Accordion title="Mock Method Fails to Compile">
If your `MOCK_METHOD` fails to compile, ensure:
- The method being mocked is virtual.
- Types with commas are carefully wrapped or aliased.
- Const and override qualifiers match the original method.
</Accordion>
<Accordion title="Uninteresting Call Warnings">
GoogleMock prints warnings for mock methods called without expectations.
Consider using `NiceMock` to suppress these or add an `EXPECT_CALL` with `.Times(AnyNumber())` for catch-all.
</Accordion>
<Accordion title="Unexpected Call Failures">
When a call does not match any `EXPECT_CALL`, the test fails with details about which calls were expected.
Check your argument matchers for correctness and completeness.
</Accordion>
<Accordion title="Linker Errors With GoogleMock">
Make sure GoogleMock and GoogleTest libraries are linked correctly, matching your build system (CMake/Bazel).
See [Installation & Integration](../environment-installation/installation-integration) for guidance.
</Accordion>
</AccordionGroup>

---

## Summary Example: Putting It All Together

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;
using ::testing::_;

// Production interface
class Database {
 public:
  virtual ~Database() {}
  virtual bool Connect(const std::string& url) = 0;
  virtual int GetRecordCount() const = 0;
  virtual void Close() = 0;
};

// Mock class
class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), (override));
  MOCK_METHOD(int, GetRecordCount, (), (const, override));
  MOCK_METHOD(void, Close, (), (override));
};

// Test
TEST(DatabaseUserTest, BasicMockTest) {
  MockDatabase mock_db;

  ON_CALL(mock_db, Connect(_))
      .WillByDefault(Return(true));
  EXPECT_CALL(mock_db, Connect("my_db_url"))
      .Times(1)
      .WillOnce(Return(true));
  EXPECT_CALL(mock_db, GetRecordCount())
      .WillRepeatedly(Return(42));

  bool connected = mock_db.Connect("my_db_url");
  int count = mock_db.GetRecordCount();

  EXPECT_TRUE(connected);
  EXPECT_EQ(count, 42);
}
```

---

You've now successfully learned how to write a basic mock class, set expectations, and run your first mock test using GoogleMock. This foundational skill unlocks powerful testing capabilities for complex interactions.


<Source url="https://github.com/google/googletest" paths='[{"path": "docs/gmock_cook_book.md", "range": "1-1000"}, {"path": "docs/gmock_cheat_sheet.md", "range": "1-1000"}, {"path": "docs/gmock_for_dummies.md", "range": "1-300"}]' />