---
title: "Matchers and Actions"
description: "Understand the matcher and action system—how argument expectations are described and how mock behaviors are specified. Learn how to use built-in and custom matchers/actions for fine-grained control over mock responses."
---

# Matchers and Actions

Understand the matcher and action system—how argument expectations are described and how mock behaviors are specified. Learn how to use built-in and custom matchers/actions for fine-grained control over mock responses.

---

## Introduction

When writing tests with GoogleMock (gMock), controlling how mock methods match arguments and behave when called is the key to effective and expressive tests. This page explains two fundamental concepts:

- **Matchers:** Specify what arguments a mock method is expected to receive.
- **Actions:** Specify what a mock method should do when called.

Mastering these allows you to precisely describe your test expectations and specify realistic mock behaviors.

---

## Understanding Matchers

Matchers define the criteria that arguments to mock functions must satisfy to match an expectation. They act like predicates that independently or collectively evaluate the arguments passed to a mock method call.

### What Matchers Do for You

Matchers let you say things like:

- Expect the argument to be equal to a certain value.
- Expect an argument to be greater than or less than a threshold.
- Expect a string argument to contain a certain substring or match a regex.
- Expect complex conditions on objects, such as certain fields or properties meeting constraints.
- Compose multiple conditions using logical operators (`AllOf()`, `AnyOf()`, `Not()`).

### Basic Syntax

Match arguments by value or use built-in matchers:

```cpp
EXPECT_CALL(mock, Method(Eq(5), NotNull()));
EXPECT_CALL(mock, Method(_, Ge(10)));  // _ matches anything
```

You can omit argument matcher lists for non-overloaded methods to match any arguments:

```cpp
EXPECT_CALL(mock, Method);  // Matches any arguments
```

### Multi-Argument Matching

Use the `.With()` clause in `EXPECT_CALL` and `ON_CALL` to write matchers that operate on the full tuple of arguments:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // first arg < second arg
```

### Built-in Matchers

GoogleMock ships with an extensive collection of built-in matchers for primitives, strings, containers, pointers, tuples, and more. Examples include:

- `_`, `A<T>()`, `An<T>()` — Wildcard matchers
- `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()` — Comparisons
- `StrEq()`, `StrNe()`, `StartsWith()`, `EndsWith()`, `HasSubstr()` — String matchers
- `Pointee(m)` — Matches pointer pointee
- `Field(&Class::field, m)`, `Property(&Class::property, m)` — Match members and properties
- `ElementsAre(...)`, `UnorderedElementsAre(...)` — Container element matchers

### Defining Custom Matchers

For specialized argument checks, gMock provides macros (`MATCHER`, `MATCHER_P`, etc.) to define concise custom matchers:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

Custom matchers should always be *pure functions* without side effects, enabling reliable and repeatable tests.

### Polymorphic and Monomorphic Matchers

Matchers can be polymorphic, usable with multiple argument types (e.g. `Eq(value)`), or monomorphic, which only work for a particular type. gMock handles conversions and inference automatically in most cases.

---

## Understanding Actions

Actions define the behavior of a mock method when invoked. When a mock method is called matching an expectation, the specified action tells gMock what to do.

### Why Actions Matter

Without actions, mock methods either return default values (zero, false, nullptr, or default constructed objects) or do nothing. Actions allow behavior specification such as:

- Returning a specific value or reference
- Throwing exceptions
- Invoking callbacks or other functions
- Modifying output parameters
- Performing sequences of actions

### Basic Action Syntax

Specify actions in `EXPECT_CALL` and `ON_CALL` clauses:

```cpp
EXPECT_CALL(mock, GetSize())
    .WillOnce(Return(42));

ON_CALL(mock, IsReady())
    .WillByDefault(Return(true));
```

### Common Built-in Actions

#### Returning Values

| Action                   | Description                                                   |
|--------------------------|---------------------------------------------------------------|
| `Return()`               | Return from a void function.                                  |
| `Return(value)`          | Return a pre-specified value or copy.                        |
| `ReturnArg<N>()`         | Return the N-th argument of the call.                        |
| `ReturnNew<T>(...)`      | Create and return new object of type `T` each call.         |
| `ReturnNull()`           | Return null pointer.                                         |
| `ReturnPointee(ptr)`     | Return value pointed by `ptr` at call time.                  |
| `ReturnRef(variable)`    | Return a reference to a variable, reflecting live changes.  |
| `ReturnRefOfCopy(value)` | Return reference to copy of value (lives as long as action). |
| `ReturnRoundRobin({...})`| Cycle through return values repeatedly.                      |

#### Side Effects

| Action                     | Description                                                      |
|----------------------------|------------------------------------------------------------------|
| `Assign(&var, value)`       | Assign `value` to `var`.                                        |
| `DeleteArg<N>()`            | Deletes the pointer argument at index N.                        |
| `SaveArg<N>(pointer)`       | Save the N-th argument to the location `pointer`.               |
| `SaveArgByMove<N>(pointer)` | Save by move the N-th argument.                                 |
| `SetArgReferee<N>(value)`  | Assign `value` to the variable referenced by the N-th argument.|
| `SetArgPointee<N>(value)`  | Assign `value` to the variable pointed by the N-th argument.   |
| `SetArrayArgument<N>(first, last)` | Copy from range `[first, last)` to the argument array.    |
| `SetErrnoAndReturn(error, value)` | Sets errno and returns a value.                          |
| `Throw(exception)`          | Throw an exception.                                            |

#### Invoking Functions and Callables

You can specify actions that invoke functions, member functions, lambdas, or other callables to dynamically compute return values or side effects.

- `Invoke(f)` — Invokes function or functor `f` with the mock arguments.
- `Invoke(object_pointer, &Class::method)` — Invoke method on object.
- `InvokeWithoutArgs(f)` — Calls `f` without arguments.
- `InvokeArgument<N>(args...)` — Calls the N-th argument (assumed callable) with args.

### Combining Actions

`DoAll(a1, a2, ..., an)` allows multiple actions to execute sequentially when a mock is called, where the return value is from the last action.

Example:

```cpp
EXPECT_CALL(mock, Foo())
    .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));
```

### Custom Actions

Define your own actions using `ACTION()`, `ACTION_P()`, or `ACTION_TEMPLATE()` macros, or by implementing the `ActionInterface<F>` for a function type `F`:

```cpp
ACTION(IncrementArg1) {
  return ++(*arg1);
}
```

Use these actions with `WillOnce()` / `WillRepeatedly()` for tailored behaviors.

---

## User Journey: Using Matchers and Actions Together

### Step 1: Define a Mock

Create a mock class using `MOCK_METHOD`. Specify the methods you want to mock.

### Step 2: Set Expectations with Matchers

```cpp
EXPECT_CALL(mock, DoSomething(Ge(5), _));
```
This expects `DoSomething` called with first argument >= 5 and the second any value.

### Step 3: Specify Behavior with Actions

```cpp
EXPECT_CALL(mock, DoSomething(_, _))
    .WillOnce(Return(42))
    .WillRepeatedly(Return(0));
```

The mock returns 42 on first call, 0 afterwards.

### Step 4: Use Advanced Matchers & Actions

Refine argument conditions with combined matchers (`AllOf`, `AnyOf`), custom matchers (`MATCHER_P`), or multi-argument matchers `.With()`. Combine or chain actions (`DoAll`, `Invoke`) to simulate complex behavior.

---

## Best Practices

- Match only what matters. Avoid over-specifying argument expectations.
- Use `ON_CALL` to define default behaviors without enforcing call expectations.
- Use `EXPECT_CALL` for calls you want to verify.
- Prefer built-in matchers and actions first, add custom ones only when required.
- Be mindful that matchers must be pure functions without side effects.
- Use `RetiresOnSaturation()` to retire expectations after they're satisfied, especially in sequences.
- Use `NiceMock` or `StrictMock` to control verbosity and strictness of uninteresting calls.

---

## Troubleshooting Common Issues

- **Mismatch Arguments:** If the expected calls fail due to argument mismatches, verify matcher correctness and types.
- **Overloaded Methods:** Help disambiguate by specifying types or use `Const()` wrapper for const-qualified overloads.
- **Lifetime of Returned References:** Use `ReturnRef` with care to avoid dangling references.
- **Uninteresting Call Warnings:** Use `NiceMock` to silence ``uninteresting mock calls`` warnings if expected.
- **Multiple Expectations Order:** Newer expectations override older ones; order your `EXPECT_CALL`s carefully.

---

## References and Further Reading

- [Matchers Reference](../reference/matchers.md) — Exhaustive list of built-in matchers
- [Actions Reference](../reference/actions.md) — Comprehensive details on built-in actions
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for advanced matcher and action usage
- [Defining and Using Mocks](../api-reference/mocking-apis/defining-mocks.md) — Foundational guide on mock objects

---

*This page fits within the Mocking Paradigms & Data Models group, complementing the Mock Object and Expectation Model and Strictness Modes pages. For mock definition syntax see the Defining and Using Mocks API Reference.*

---

### Example: Custom Matcher and Action

```cpp
MATCHER(IsEven, "Checks if a number is even") {
  return (arg % 2) == 0;
}

ACTION_P(IncrementBy, n) {
  return arg0 + n;
}

// Usage
EXPECT_CALL(mock, Calculate(IsEven()))
    .WillOnce(IncrementBy(5));
```

---