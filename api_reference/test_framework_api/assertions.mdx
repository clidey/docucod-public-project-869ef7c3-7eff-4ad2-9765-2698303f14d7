---
title: "Assertions API"
description: "In-depth documentation of built-in assertions such as equality, inequality, exceptions, and user-defined assertions. Explains assertion macros, expected behaviors, customizability, and best practices to express intent clearly in tests."
---

# Assertions API

GoogleTest provides a rich set of assertion macros to express and verify expected conditions in tests. This documentation offers an in-depth exploration of these built-in assertions including equality, inequality, exception verification, predicate assertions, and more. It explains how to use assertion macros, customize failure messages, understand expected behaviors, and best practices for writing clear and maintainable tests.

---

## Assertion Macro Categories

GoogleTest assertion macros come in pairs: `EXPECT_*` and `ASSERT_*`. Use `EXPECT_*` to record test failures while allowing the test to continue, and use `ASSERT_*` to halt the test on failure. All macros allow streaming additional failure context with the `<<` operator for enhanced diagnostics.

### Basic Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Succeeds if `condition` is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Succeeds if `condition` is false.

Example:

```cpp
EXPECT_TRUE(isValid()) << "Input validation failed";
```

### Binary Comparison Assertions

Verifies relational comparisons with value printing on failure.

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`: Verifies `val1 == val2`.
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`: Verifies `val1 != val2`.
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)`: Verifies `val1 < val2`.
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)`: Verifies `val1 <= val2`.
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)`: Verifies `val1 > val2`.
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)`: Verifies `val1 >= val2`.

> **Tip:** Use `EXPECT_STREQ` and friends to compare C strings by content.

Example:

```cpp
EXPECT_EQ(computedValue, expectedValue) << "Mismatch in computed value";
```

### String Assertions for C Strings

Compare null-terminated strings by content:

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)`: Checks that strings are equal.
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)`: Checks that strings are not equal.
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)`: Case-insensitive equality.
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)`: Case-insensitive inequality.

Example:

```cpp
ASSERT_STREQ(result.c_str(), expected.c_str()) << "String contents do not match";
```

### Floating-Point Assertions

Floating-point comparisons consider the inexact nature of floating-point math:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)`: Checks approximate equality within 4 ULPs for `float`.
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)`: Checks approximate equality within 4 ULPs for `double`.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`: Checks difference within absolute error.

Example:

```cpp
EXPECT_NEAR(computedVal, expectedVal, 1e-5) << "Value not within tolerance";
```

### Exception Assertions

If exceptions are enabled, you can verify throwing behaviors:

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(statement, exception_type)`: Verifies a particular exception type is thrown.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(statement)`: Verifies any exception is thrown.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(statement)`: Verifies no exception is thrown.

Example:

```cpp
EXPECT_THROW(Process(input), std::runtime_error);
```

### Predicate Assertions

Use predicate assertions for complex conditions or when more descriptive failure messages are needed.

#### Predicate Boolean Assertions

- `EXPECT_PRED1(pred, val1)` ... up to `EXPECT_PRED5(pred, val1, val2, val3, val4, val5)`
- `ASSERT_PRED1`, ..., `ASSERT_PRED5`

`pred` is a function or functor returning `bool`. On failure, it prints which predicate failed and the argument values.

Example:

```cpp
bool IsPrime(int n) { ... }
EXPECT_PRED1(IsPrime, value);
```

#### Predicate-Formatter Assertions

- `EXPECT_PRED_FORMAT1(pred_formatter, val1)` ... `EXPECT_PRED_FORMAT5`
- `ASSERT_PRED_FORMAT1`, ..., `ASSERT_PRED_FORMAT5`

`pred_formatter` returns an `AssertionResult` with custom success/failure messages, for richer explanations.

Example:

```cpp
AssertionResult IsEven(const char* expr, int n) {
  if (n % 2 == 0)
    return AssertionSuccess();
  return AssertionFailure() << expr << " evaluates to " << n << ", which is odd";
}
EXPECT_PRED_FORMAT1(IsEven, value);
```

### Explicit Success and Failure

- `SUCCEED()`: Explicitly generates a success. Useful for documentary purposes.
- `FAIL()`: Always generates a fatal failure and aborts the current function.
- `ADD_FAILURE()`: Always generates a non-fatal failure, allowing continuation.
- `ADD_FAILURE_AT(file, line)`: Like `ADD_FAILURE` but at a specific file and line.

Example:

```cpp
switch (error_code) {
  case 0: SUCCEED(); break;
  default: FAIL() << "Unexpected error code: " << error_code;
}
```

### Windows HRESULT Assertions

Exclusive to Windows builds with `HRESULT` codes:

- `EXPECT_HRESULT_SUCCEEDED(expression)` / `ASSERT_HRESULT_SUCCEEDED(expression)`: Checks if `expression` is a success HRESULT.
- `EXPECT_HRESULT_FAILED(expression)` / `ASSERT_HRESULT_FAILED(expression)`: Checks if it's a failure HRESULT.

### Death Assertions

Check that code causes process termination (useful for testing fatal checks). These spawn a child process on POSIX or Windows.

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)`: Verifies process dies with output matching `matcher`.
- `EXPECT_DEATH_IF_SUPPORTED` / `ASSERT_DEATH_IF_SUPPORTED`: Conditional death test.
- `EXPECT_DEBUG_DEATH` / `ASSERT_DEBUG_DEATH`: Death test only in debug builds.
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT`: Verifies process exit status satisfies `predicate` and output matches `matcher`.

Example:

```cpp
EXPECT_DEATH(CheckInvariant(ptr), "ptr != nullptr");
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

### Message Streaming

All assertion macros support streaming additional information with `<<`. For example:

```cpp
EXPECT_TRUE(condition) << "Failure reason: " << details;
```

This helps clarify test failures with contextual information.

---

## Best Practices and Tips

- **Choose Between `EXPECT_` and `ASSERT_` Based on Intent:** Use `ASSERT_` if it makes no sense to continue after failure.
- **Stream Custom Messages:** Always provide meaningful failure descriptions to simplify debugging.
- **Use Predicate Assertions for Complex Checks:** Instead of `EXPECT_TRUE(complex_condition)`, use `EXPECT_PRED_FORMAT` to emit detailed failure explanations.
- **Prefer `EXPECT_EQ` Over Manual Comparisons:** Provides clearer messages including actual values.
- **Use Floating-Point Assertions for Numeric Comparison:** Properly handle precision and rounding issues.
- **Use Exception Assertions Only When Exceptions Are Enabled:** Otherwise, these macros won't work.
- **Test Death Cases Separately:** Use the death assertion macros carefully for process-terminating scenarios.
- **Avoid Assertions in Non-void Functions:** Fatal assertions abort the current function, which should be void.

---

## Common Pitfalls

- Comparing pointers with `EXPECT_EQ` compares their addresses, not the content. For C strings, use `EXPECT_STREQ`.
- Using assertion macros with args that have side effects without knowing that arguments are evaluated exactly once but in undefined order.
- Trying to use fatal assertions in constructors or destructors â€” these don't work as expected; prefer `SetUp`/`TearDown` methods.
- Overusing `EXPECT_CALL` in mocks where not needed; prefer `ON_CALL` to specify default mock behavior.
- Placement of death assertions inside macros or functions that cause early returns or exceptions can lead to misleading results.

---

## Practical Usage Examples

### Equality Assertion

```cpp
TEST(MathTest, Addition) {
  int result = Add(2, 3);
  EXPECT_EQ(result, 5) << "Add(2, 3) should equal 5";
}
```

### String Comparison

```cpp
TEST(StringTest, Compare) {
  const char* s1 = "Hello";
  const char* s2 = "Hello";
  ASSERT_STREQ(s1, s2) << "Strings should be equal.";
}
```

### Floating Point Comparison

```cpp
TEST(FloatTest, NearEqual) {
  EXPECT_FLOAT_EQ(0.1f + 0.2f, 0.3f);
  EXPECT_NEAR(0.1f + 0.2f, 0.3f, 1e-6f);
}
```

### Exception Verification

```cpp
TEST(ExceptionTest, Throws) {
  EXPECT_THROW(ThrowCustomException(), MyException);
  EXPECT_NO_THROW(ProcessSafely());
}
```

### Predicate Assertion

```cpp
bool IsEven(int n) { return (n % 2) == 0; }

TEST(PredTest, CheckEven) {
  EXPECT_PRED1(IsEven, 4);  // succeeds
  EXPECT_PRED1(IsEven, 5);  // fails with message
}
```

---

## Troubleshooting

- If an assertion macro fails unexpectedly, check that arguments aren't being optimized or evaluated in unexpected order.
- Use `SCOPED_TRACE` to add trace messages when calling a helper function that performs assertions.
- Verify that exceptions are enabled if you are using exception-based assertions.
- Use `EXPECT_FATAL_FAILURE` and `EXPECT_NONFATAL_FAILURE` in your tests when testing assertion macros themselves.

---

## Further Reading and Cross-References

- See the [GoogleTest Assertions Reference](reference/assertions.md) for the complete list of assertion macros with details and examples.
- For customized failure messages and predicate assertions, see [Advanced GoogleTest Topics](advanced.md#more-assertions).
- To learn how to create and manage mock expectations related to assertions, see the [gMock Mocking Reference](reference/mocking.md) and [gMock Cookbook](gmock_cook_book.md).
- For writing parameterized and typed tests incorporating assertions, review [Testing Reference](reference/testing.md) and [Advanced Usage Patterns](guides/advanced-usage-patterns/parameterized-and-type-tests).
- Explore [How to Write Tests](guides/core-workflows/authoring-unit-tests.mdx) for practical patterns integrating assertions.

---

## Example: Custom Assertion with `AssertionResult`

```cpp
// Defines a predicate function returning an AssertionResult.
testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0)
    return testing::AssertionSuccess();
  else
    return testing::AssertionFailure() << n << " is odd";
}

TEST(NumberTest, EvenCheck) {
  EXPECT_TRUE(IsEven(4));  // Succeeds
  EXPECT_TRUE(IsEven(5));  // Fails, prints "5 is odd"
}
```

---

## Example: Death Test

```cpp
TEST(DeathTest, CrashesOnNull) {
  EXPECT_DEATH({ ProcessPointer(nullptr); }, "Null pointer");
}
```

---

For complete, copy-paste ready examples and details on all macros, refer to the [Assertions Reference page](reference/assertions.md).