---
title: "Configuration Macros & Flags"
description: "Outlines the major platform/configuration macros and command-line flags supported throughout GoogleTest and GoogleMock, enabling users to tailor execution, filtering, output, and integration with CI."
---

# Configuration Macros & Flags

GoogleTest and GoogleMock offer a comprehensive suite of platform and configuration macros alongside command-line flags that empower you to finely tune test execution, filtering, output behavior, and integration in continuous integration (CI) workflows. Understanding and leveraging these macros and flags enables you to adapt the frameworks to diverse environments and optimize test runs for your project's specific needs.

---

## 1. Overview of Configuration Macros

GoogleTest and GoogleMock use a set of macros, typically prefixed with `GTEST_` and `GMOCK_`, to describe environment properties, feature availability, and execution behaviors. You can define these macros in your build system or code to tailor framework behaviour explicitly or rely on their auto-detection for common platforms.

### Key Macros Categories

- **Environment Detection Macros**: Indicate platform, compiler, and threading support.
- **Feature Flags**: Denote support for features like exceptions, RTTI, death tests, and regular expressions.
- **Build and Linking Macros**: Control shared/static library builds and runtime linkage.
- **Thread Safety and Synchronization**: Enable threading support where applicable.

### Commonly Used Macros

| Macro Name                             | Purpose                                                                                 |
|--------------------------------------|-----------------------------------------------------------------------------------------|
| `GTEST_HAS_PTHREAD`                   | Indicates pthread support on the platform (1 = supported, 0 = unsupported).              |
| `GTEST_HAS_EXCEPTIONS`                | Determines if C++ exception handling is enabled.                                       |
| `GTEST_HAS_RTTI`                     | Signals availability of Run-Time Type Information.                                     |
| `GTEST_HAS_DEATH_TEST`                | Enables support for death tests, typically requires file system and platform support.  |
| `GTEST_LINKED_AS_SHARED_LIBRARY`     | Defined when your tests link GoogleTest as a shared library (DLL).                     |
| `GTEST_CREATE_SHARED_LIBRARY`         | Defined when compiling GoogleTest itself as a shared library.                          |

### Usage

These macros are generally set automatically during build configuration, but you may override them via compiler flags to solve platform detection issues or to customize behavior explicitly:

```shell
-DGTEST_HAS_PTHREAD=1       # Force pthread usage
-DGTEST_HAS_EXCEPTIONS=0    # Compile without exceptions support
-DGTEST_CREATE_SHARED_LIBRARY=1  # Build GoogleTest as shared
```

### Example

If GoogleTest does not detect pthread support correctly, force it with:

```shell
-DGTEST_HAS_PTHREAD=1
```

This ensures thread safety features are enabled.

<Note>
Defining these macros incorrectly may cause build or runtime issues. Use only if you fully understand your environment.
</Note>

---

## 2. Command-Line Flags for GoogleMock

GoogleMock supports several command-line flags (prefixed with `--gmock_`) that configure runtime behavior. These flags are parsed when you call `InitGoogleMock()`, which removes recognized flags from the argument list.

### Common GoogleMock Flags

| Flag                         | Type     | Description                                                                                      | Default |
|------------------------------|----------|------------------------------------------------------------------------------------------------|---------|
| `--gmock_verbose`             | string   | Controls verbosity of GoogleMock output. Values: `info`, `warning`, `error`, or `warning`      | Empty   |
| `--gmock_catch_leaked_mocks` | bool     | Controls whether leaked mock objects cause the test to fail.                                   | true    |
| `--gmock_default_mock_behavior` | int32  | Sets default behavior for uninteresting calls: 0 - nice (ignore), 1 - naggy (warn), 2 - strict (fail) | 0       |

### Usage Example

To run your tests with verbose GoogleMock logging and strict default mock behavior:

```shell
./my_tests --gmock_verbose=info --gmock_default_mock_behavior=2
```

This shows informational logs and treats unexpected mock calls as errors.

### Accessing Flags Programmatically

You can access and modify these flags in code through provided macros:

```cpp
#include "gmock/gmock.h"

bool catch_leaked = GMOCK_FLAG_GET(catch_leaked_mocks);
GMOCK_FLAG_SET(verbose, "error");
```

### Initialization

Call `InitGoogleMock` in your test binary to parse flags:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This removes recognized flags and sets internal states.

---

## 3. Platform and Build Configuration Macros

GoogleTest has numerous macros to manage platform specifics and build configurations. These macros influence compilation, feature discovery, and linkage.

### Managing Platform Detection and Feature Support

GoogleTest defines macros to identify platforms (e.g., `GTEST_OS_LINUX`, `GTEST_OS_WINDOWS`) and feature support (e.g., regex engines, exceptions, threading).

If necessary, override these settings in your build system to address environment-specific quirks or limitations.

### Shared Library and Linking Relays

- Define `GTEST_CREATE_SHARED_LIBRARY=1` when building GoogleTest itself as a DLL/shared library.
- Define `GTEST_LINKED_AS_SHARED_LIBRARY=1` when your tests link against GoogleTest in shared mode.

Properly setting these ensures symbol visibility and linkage correctness.

### Thread Safety

`GTEST_IS_THREADSAFE` indicates whether GoogleTest is built with thread safety support. This depends on pthread availability or platform threading primitives.

You can force pthread threading with `-DGTEST_HAS_PTHREAD=1` if automatic detection is insufficient.

---

## 4. Practical Tips & Best Practices

- **Initialize GoogleMock and GoogleTest Before Executing Tests:**
  Always call `InitGoogleMock` or `InitGoogleTest` at the beginning of your `main` function to parse and apply flag values.

- **Use Flags to Control Test Output and Filtering:**
  Combine GoogleMock flags with GoogleTest flags (e.g., `--gtest_filter`) to run targeted test subsets with detailed logging.

- **Handle Flag Conflicts with Care:**
  If macros or flags conflict with other libraries in your build environment, use the documented `-DGTEST_DONT_DEFINE_*` macros to rename GoogleTest macros safely.

- **Check Unsupported Platforms:**
  Consult the platform macros to verify feature support, especially on embedded systems or uncommon OSes.

- **Regularly Review Configuration After Upgrades:**
  New GoogleTest versions may add or change macros and flags; keep your build configuration updated accordingly.

---

## 5. Example: Customizing Behavior with Macros and Flags

Suppose you need strict mock behavior by default and detailed verbose output during test development:

### Build Configuration (e.g., CMake)

```cmake
add_definitions(-DGTEST_HAS_PTHREAD=1)                    # Ensure threading
add_definitions(-DGTEST_CREATE_SHARED_LIBRARY=1)           # Build GoogleTest shared
add_definitions(-DGTEST_LINKED_AS_SHARED_LIBRARY=1)         # Link test against shared
```

### Run Tests with Flags

```shell
./my_test_binary --gmock_verbose=info --gmock_default_mock_behavior=2 --gtest_filter=MyTestSuite.*
```

### Code Sample for Accessing Flags

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  // Check if verbose output is enabled
  if (GMOCK_FLAG_GET(verbose) == "info") {
    // Enable additional logging in your test setup
  }

  return RUN_ALL_TESTS();
}
```

<Info>
This configuration ensures that unexpected mock calls fail tests, and you receive detailed logging for debugging.
</Info>

---

## 6. Troubleshooting Common Issues

<Warning>
**Unexpected Behavior in Threaded Tests:**
If tests behave unpredictably, verify `GTEST_HAS_PTHREAD` is enabled correctly for your platform. In misdetected cases, force it explicitly via build flags.
</Warning>

<Warning>
**Flags Not Taking Effect:**
Ensure that `InitGoogleMock` is called early in `main()` and that flags follow the naming convention (`--gmock_`). Unrecognized flags will be ignored.
</Warning>

<Note>
**Macro Name Collisions:**
If you see macro conflicts, use `-DGTEST_DONT_DEFINE_TEST=1` (or similar) to change macro prefixes, e.g., `TEST` to `GTEST_TEST`.
</Note>

---

## 7. Additional Resources & Related Documentation

- [GoogleTest Overview & Concepts](/overview/introduction-and-core-concepts/product-overview)
- [Setting Up and Building Tests](/guides/getting-started/setup-build-integration)
- [GoogleMock Main Header & Flags](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock.h)
- [Flag Parsing Tests & Examples](https://github.com/google/googletest/blob/main/googlemock/test/gmock_test.cc)
- [System Requirements & Supported Platforms](/getting-started/setup-requirements/system-requirements)

Explore these to deepen understanding of feature configuration and startup logic.

---