---
title: "Test Fixtures and Suites"
description: "Learn how to set up test cases and organize them using fixtures and suites. Understand the lifecycle, inheritance, and best practices for structuring your code to leverage test reuse and maintainability. This is essential for creating scalable, organized test suites."
---

# Test Fixtures and Suites

GoogleTest empowers you to write organized and scalable tests using the concepts of **test fixtures** and **test suites**. This chapter will guide you through setting up tests with fixtures, structuring suites for reuse and maintainability, controlling test lifecycles, and best practices to get the most from these features.

---

## Test Fixtures: Sharing Set-Up and Tear-Down

When your tests share common data, configuration, or resources, test fixtures provide a structured way to avoid duplication and centralize setup and cleanup logic.

### What is a Test Fixture?

A _test fixture_ is a C++ class derived from `testing::Test`. It encapsulates data members and functions shared by multiple tests, plus virtual `SetUp()` and `TearDown()` methods to initialize and release resources respectively before and after each test runs.

### Creating a Test Fixture

```cpp
class FooTest : public ::testing::Test {
 protected:
  void SetUp() override {
    // Common setup operations
  }

  void TearDown() override {
    // Cleanup operations
  }

  // Shared resources
  int shared_value_;
};
```

### Writing Tests with Fixtures

Use the `TEST_F` macro (the `_F` suffix stands for fixture) to associate a test with a fixture:

```cpp
TEST_F(FooTest, BehaviorOne) {
  shared_value_ = 42;
  EXPECT_EQ(shared_value_, 42);
}

TEST_F(FooTest, BehaviorTwo) {
  EXPECT_NE(shared_value_, 0);  // Can access fixture members directly
}
```

Each test runs independently with a fresh instance of the fixture class. GoogleTest instantiates the fixture, calls `SetUp()`, runs the test body, calls `TearDown()`, and then destroys the fixture.

<Check>
Always prefer `TEST_F` over global variables for shared setup because it avoids state leakage and improves test isolation.
</Check>

### Per-Test Setup and TearDown Lifetime

- **Constructor/Destructor**: Run for each fixture instance (one per test run). However, GoogleTest discourages using assertions in constructors/destructors because they do not support exceptions or proper failure reporting.

- **`SetUp()`/`TearDown()`**: Called before and after each individual test function respectively. These are the recommended places to put potentially failing setup code.

### Per-Test-Suite Setup and Tear-Down

Sometimes your fixture requires expensive resources shared across all tests in a suite. GoogleTest lets you create static members and defines `SetUpTestSuite()` and `TearDownTestSuite()` static methods in your fixture:

```cpp
class FooTest : public ::testing::Test {
 protected:
  static void SetUpTestSuite() {
    // Setup expensive shared resource
    shared_resource_ = new Resource();
  }

  static void TearDownTestSuite() {
    // Cleanup shared resource
    delete shared_resource_;
    shared_resource_ = nullptr;
  }

  void SetUp() override {
    // Per test setup
  }

  void TearDown() override {
    // Per test cleanup
  }

  static Resource* shared_resource_;
};

Resource* FooTest::shared_resource_ = nullptr;
```

GoogleTest calls `SetUpTestSuite()` once before the first test in the suite, and `TearDownTestSuite()` after the last test completes.

<Tip>
`SetUpTestSuite()` and `TearDownTestSuite()` are called automatically; there is no need to invoke them manually.
</Tip>

### Fixture Inheritance

You can derive one fixture from another to share common setup and utilities:

```cpp
class BaseTest : public ::testing::Test {
 protected:
  void SetUp() override { /* base setup */ }
};

class DerivedTest : public BaseTest {
 protected:
  void SetUp() override {
    BaseTest::SetUp();  // Call base setup
    // Derived setup
  }
};

TEST_F(DerivedTest, Example) {
  // Uses combined fixture setup
}
```

<Note>
Always call the base fixture's `SetUp()` and `TearDown()` methods in derived fixtures to ensure complete resource management.
</Note>

---

## Organizing Test Suites

A **test suite** is the logical grouping of tests, typically corresponding to a fixture class or `TEST` group. Tests within a suite share the fixture and name prefix.

### Defining Test Suites

- Use `TEST(TestSuiteName, TestName)` for simple tests without fixtures.
- Use `TEST_F(FixtureName, TestName)` for tests with shared setup.

GoogleTest automatically associates the suite name with the fixture when using `TEST_F`.

### Rules for Test and Suite Naming

- Suite and test names must be valid C++ identifiers without underscores (`_`).
- Avoid duplicate fully qualified test names in the same executable.

<LongWarning>
Including underscores can interfere with GoogleTestâ€™s internal naming and cause subtle bugs or failures in test registration or filtering.
</LongWarning>

### Running Suites and Tests

By default, all registered tests run on invoking `RUN_ALL_TESTS()`.

You can filter tests by suite or test name using:

```bash
./my_test --gtest_filter=SuiteName.*        # Run all tests in SuiteName
./my_test --gtest_filter=SuiteName.TestA    # Run only SuiteName.TestA
```

### Accessing Suite and Test Info During Execution

GoogleTest provides the reflection API to access current test and suite details:

```cpp
const testing::TestInfo* info = testing::UnitTest::GetInstance()->current_test_info();
std::cout << "Running " << info->test_suite_name() << "." << info->name() << std::endl;
```

Useful for dynamically adjusting behavior or generating logs specific to the test.

---

## Advanced Fixtures: Parameterized and Typed Tests

Fixtures are also the backbone of advanced testing paradigms.

### Value-Parameterized Tests

Create tests reused across multiple input parameters:

1. Derive fixture from both `Test` and `WithParamInterface<T>` or use `TestWithParam<T>`.
2. Define tests using `TEST_P` with access to parameters via `GetParam()`.
3. Instantiate the tests with parameter sets using `INSTANTIATE_TEST_SUITE_P`.

Example:

```cpp
class MyParamTest : public ::testing::TestWithParam<int> {};

TEST_P(MyParamTest, IsEven) {
  int value = GetParam();
  EXPECT_EQ(value % 2, 0);
}

INSTANTIATE_TEST_SUITE_P(EvenValues, MyParamTest, ::testing::Values(2, 4, 6));
```

### Typed Tests

If you want to test the same logic for different types, use typed tests:

1. Define a fixture template class parameterized on a type `T`.
2. Define a type list with `::testing::Types<T1, T2, ...>`.
3. Associate types with the fixture using `TYPED_TEST_SUITE`.
4. Define tests with `TYPED_TEST`.

Example:

```cpp
template<typename T>
class MyTypedTest : public ::testing::Test {
public:
  T value_;
};

using MyTypes = ::testing::Types<int, double>;
TYPED_TEST_SUITE(MyTypedTest, MyTypes);

TYPED_TEST(MyTypedTest, DefaultIsZero) {
  EXPECT_EQ(this->value_, TypeParam());
}
```

### Type-Parameterized Tests

For more flexible scenarios, define test templates separately and instantiate later using `TYPED_TEST_SUITE_P` and `INSTANTIATE_TYPED_TEST_SUITE_P`.

---

## Best Practices and Common Pitfalls

- **Use Fixtures to Avoid Global State:** Always prefer `TEST_F` with fixtures over global or static variables to ensure test isolation.
- **Always Provide a Default Constructor in Fixtures:** GoogleTest requires a default constructor for fixture classes.
- **Call Base SetUp/TearDown in Derived Fixtures:** To maintain predictable fixture state.
- **Avoid Mixing `TEST` and `TEST_F` in the Same Suite:** It leads to runtime errors due to mismatched fixture types.
- **Avoid Underscores in Suite and Test Names:** To prevent name collisions and registration issues.
- **Manage Test Suite Resources Carefully:** Remember that `SetUpTestSuite()` can be called multiple times if inheritance is involved.
- **Use `GTEST_SKIP()` to Skip Tests at Runtime:** Can be invoked in `SetUp()` to skip entire suites gracefully.


---

## Troubleshooting

### Test Fixture Not Instantiated / Error: No Default Constructor

Ensure your fixture has an accessible default constructor; if you provide any non-default constructors, define a default as well.

### Mixing `TEST` and `TEST_F` in the Same Suite

GoogleTest forbids this and will report errors. Move tests to separate suites or convert all tests to use a fixture.

### Multiple Fixtures with Same Suite Name

If fixtures with the same class name exist in different namespaces, rename one to avoid collisions.

### Suite Setup/TearDown Not Called

Confirm that `SetUpTestSuite()` and `TearDownTestSuite()` are public **static** methods.

### Unexpected Test Skips

Check usage of `GTEST_SKIP()` or ensure `SetUpTestSuite()` does not trigger a skip that skips entire suite.

---

## Additional References

- [GoogleTest Primer - Test Fixtures](../primer.md#same-data-multiple-tests)
- [Value-Parameterized Tests](../advanced.md#value-parameterized-tests)
- [Typed Tests](../advanced.md#typed-tests)
- [Friend Tests for Private Access](reference/testing.md#FRIEND_TEST)
- [Test Organization Best Practices](/guides/scenarios-patterns/test-organization.md)

---

## Summary Diagram

```mermaid
flowchart TD
  A[Define TestFixture Class
(derived from testing::Test)] --> B[Implement SetUp() & TearDown()]
  B --> C[Write TEST_F using Fixture]
  C --> D[Optionally define SetUpTestSuite()/TearDownTestSuite()]
  D --> E[Add tests with TEST_F]
  E --> F[Run tests via RUN_ALL_TESTS()]
  subgraph Advanced
    G[TestWithParam<T> for Parameterized Tests]
    H[TYPED_TEST_SUITE and TYPED_TEST for Typed Tests]
    G --> I[INSTANTIATE_TEST_SUITE_P for Params]
    H --> J[INSTANTIATE_TYPED_TEST_SUITE_P]
  end
  F --> G
  F --> H
```

---

## Real-World Usage

Projects gain maintainability and execution efficiency by structuring tests with fixtures. Teams share expensive setup code once while writing clean, isolated tests. Parameterized and typed tests maximize coverage for multiple data inputs or types from a single logical test.

---

# Code Examples

### Basic Fixture Example

```cpp
#include <gtest/gtest.h>

class MathTest : public ::testing::Test {
protected:
  void SetUp() override {
    value_ = 1;
  }

  int value_;
};

TEST_F(MathTest, Increment) {
  value_++;
  EXPECT_EQ(value_, 2);
}

TEST_F(MathTest, Decrement) {
  value_--;
  EXPECT_EQ(value_, 0);
}
```

### Fixture with Per-Suite Setup

```cpp
class DatabaseTest : public ::testing::Test {
protected:
  static void SetUpTestSuite() {
    db_connection_ = new DatabaseConnection("mydb");
  }

  static void TearDownTestSuite() {
    delete db_connection_;
    db_connection_ = nullptr;
  }

  void SetUp() override {
    db_connection_->BeginTransaction();
  }

  void TearDown() override {
    db_connection_->RollbackTransaction();
  }

  static DatabaseConnection* db_connection_;
};

DatabaseConnection* DatabaseTest::db_connection_ = nullptr;
```

### Value-Parameterized Test Fixture

```cpp
class IsEvenTest : public ::testing::TestWithParam<int> {};

TEST_P(IsEvenTest, CheckEven) {
  EXPECT_EQ(GetParam() % 2, 0);
}

INSTANTIATE_TEST_SUITE_P(EvenNumbers, IsEvenTest, ::testing::Values(2, 4, 6));
```

### Typed Test Fixture

```cpp
template<typename T>
class NumericLimitsTest : public ::testing::Test {};

typedef ::testing::Types<int, float> NumericTypes;
TYPED_TEST_SUITE(NumericLimitsTest, NumericTypes);

TYPED_TEST(NumericLimitsTest, MinimumIsLessThanMaximum) {
  EXPECT_LT(std::numeric_limits<TypeParam>::min(),
            std::numeric_limits<TypeParam>::max());
}
```

---

# Summary

This page teaches how to leverage GoogleTest's test fixtures and test suites to build scalable, maintainable, and reusable test code. It covers creating fixtures with setup and teardown routines, organizing tests with `TEST_F`, the use of static per-suite setup/teardown methods, and fixture inheritance. Advanced patterns such as value-parameterized and typed tests are introduced. Best practices and troubleshooting tips are also provided.

---

# Related Documentation

- [GoogleTest Primer](../primer.md#same-data-multiple-tests)
- [Value-Parameterized Tests](../advanced.md#value-parameterized-tests)
- [Typed Tests](../advanced.md#typed-tests)
- [Test Organization Guide](/guides/scenarios-patterns/test-organization.md)
- [FRIEND_TEST for Private Testing](reference/testing.md#FRIEND_TEST)

# Action Items

- Start defining fixtures for tests sharing setup/teardown.
- Use `TEST_F` to write tests using the fixtures.
- Explore parameterized and typed tests for broader coverage.
- Review test suite lifecycle management for resources.
- Consult tips for naming conventions and avoiding common pitfalls.
