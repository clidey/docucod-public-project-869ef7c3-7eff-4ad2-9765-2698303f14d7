---
title: "Defining Mocks"
description: "How to define mock classes and methods using GoogleMock macros. Covers the MOCK_METHOD macros, supported C++ features, function signatures, and best practices for accurate, maintainable mocks."
---

# Defining Mocks

This page guides you through defining mock classes and methods using the core GoogleMock macros. It explains how to use the `MOCK_METHOD` macro to create mock methods that precisely simulate interfaces, detailing qualifiers, function signatures, and best practices to help you build accurate and maintainable mocks.

---

## Overview of Mock Definition

GoogleMock relies on the `MOCK_METHOD` macro to define methods within your mock classes. This macro generates the necessary boilerplate to intercept method calls, check expectations, and provide specified behaviors dynamically during test execution.

### Defining a Mock Method

The `MOCK_METHOD` macro signature is:

```cpp
MOCK_METHOD(return_type, method_name, (args...), (specs...));
```

- **`return_type`**: The return type of the method to be mocked.
- **`method_name`**: The identifier of the method.
- **`args...`**: The argument list enclosed in parentheses. Use parentheses carefully to avoid parsing errors.
- **`specs...`**: (Optional) Comma-separated method qualifiers such as `const`, `override`, `noexcept`, calling convention (`Calltype(...)`), or reference qualifiers (`ref(&)` or `ref(&&)`).


### Important Usage Notes

- Always define `MOCK_METHOD` in the `public:` section of your mock class, regardless of the base method's original access level. This is necessary for `ON_CALL` and `EXPECT_CALL` to access the mocks correctly.

- Wrap any argument or return types that include commas (e.g. templates like `std::pair<bool, int>`) inside extra parentheses. For example:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

Alternatively, define type aliases to avoid this:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

- Include qualifiers accurately to match the method you're overriding, for example, use `(const, override)` for const virtual methods.

- It's recommended to use `override` for all mocked virtual methods to ensure signature correctness.


## Supported Method Qualifiers

| Qualifier                  | Purpose and Notes                                                     |
|----------------------------|----------------------------------------------------------------------|
| `const`                    | Marks the mocked method as `const`. Required if the base method is `const`. |
| `override`                 | Marks the method as overriding a virtual base method. Recommended for virtual methods. |
| `noexcept`                 | Marks the method as `noexcept`. Required if base method is `noexcept`. |
| `Calltype(convention)`     | Specifies a calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` on Windows. |
| `ref(&)` or `ref(&&)`      | Adds lvalue or rvalue reference qualifiers if overriding methods with them. |


## Example: Defining a Mock Class

Suppose you have the following interface:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};
```

You can mock it in GoogleMock as:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

This mock class can then be instantiated and used to set expectations and default behaviors in your tests.


## Handling Overloaded Methods

You can mock overloaded methods by declaring each overload explicitly using `MOCK_METHOD` with the appropriate argument list and qualifiers:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int Add(Element x);
  virtual int Add(int times, Element x);
  virtual Bar& GetBar();
  virtual const Bar& GetBar() const;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

If you don't mock all overloads, use `using` declarations to avoid hiding base class methods.


## Special Cases

- **Mocking Class Templates**: Templates can be mocked similarly by defining the mock template class and mocking each method with `MOCK_METHOD`:

```cpp
template <typename Elem>
class StackInterface {
 public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const Elem& x) = 0;
};

template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

- **Mocking Move-Only Types**: Supported via the usual `MOCK_METHOD` syntax. You can specify how to return or accept move-only types (e.g., `std::unique_ptr`) using lambdas or `Return(std::move(...))` cautiously.

- **Calling Conventions**: Use `Calltype(...)` qualifier with `MOCK_METHOD` as needed for platform-specific calling conventions.


## Best Practices for Defining Mocks

- Always use `override` qualifier for virtual methods.
- Put all `MOCK_METHOD` declarations in the public section for accessibility.
- Use type aliases or parentheses to handle types containing commas.
- Avoid mocking non-virtual or static methods directly; instead, use interfaces or suitable design patterns.


## Advanced Mock Classes

GoogleMock provides user-friendly mock wrappers:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // Ignores uninteresting calls
NaggyMock<MockFoo> naggy_foo;    // Warns on uninteresting calls
StrictMock<MockFoo> strict_foo;  // Fails on uninteresting calls
```

These can dramatically affect how uninteresting calls are handled during testing.


## Common Failure Points

- Incorrect qualifiers (missing `const` or `override`) cause unexpected behavior.
- Comma in types without parentheses wrapping causes compilation failure.
- Mock methods defined out of `public` cause `ON_CALL`/`EXPECT_CALL` to fail.


---

## Example Walkthrough: Defining and Using a Mock

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};

// Usage in test
using ::testing::AtLeast;
using ::testing::Return;

TEST(PainterTest, CanDrawSomething) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  // Optionally specify return values and default behaviors
  ON_CALL(turtle, GetX()).WillByDefault(Return(0));
  ON_CALL(turtle, GetY()).WillByDefault(Return(0));

  // Exercise code that uses turtle
  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

In this example, `MockTurtle` is a fully mocked version of `Turtle` implemented using `MOCK_METHOD`. This allows precise testing of drawing commands and interactions with the turtle.


---

## Troubleshooting Common Issues

<AccordionGroup title="Common Issues in Defining Mocks">
<Accordion title="Compilation failures due to commas in types">
When your mock method's return type or arguments involve templates with commas, `MOCK_METHOD` will fail to parse unless you surround the type with parentheses or use type aliases.

**Solution:**

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
``` 
or
```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```
</Accordion>
<Accordion title="Missing qualifiers causing mismatched overrides">
Ensure that you include all necessary qualifiers like `const` and `override` when mocking methods to correctly override base class methods. Omissions can lead to subtle failures.
</Accordion>
<Accordion title="Inaccessible mock methods">
Always declare mock methods in the `public:` section to allow `EXPECT_CALL` and `ON_CALL` to access them.
</Accordion>
</AccordionGroup>


---

## Summary

Defining mocks with GoogleMock is straightforward and flexible, accomplished through the `MOCK_METHOD` macro, which bridges interface declarations and mock implementations. By carefully matching method signatures, including qualifiers, and managing complex types with parentheses or aliases, you can craft mocks that are accurate, maintainable, and powerful testing tools.

For nuanced behaviors like uninteresting call handling, GoogleMock offers `NiceMock`, `NaggyMock`, and `StrictMock` wrappers.

Use the guidance and examples here to confidently write mocks that enhance your unit testing effectiveness.

---

## Additional Resources

- [gMock Cookbook](../gmock_cook_book.md): Practical recipes for mock usage
- [Mocking Reference](../reference/mocking.md): API details and advanced features
- [gMock for Dummies](../gmock_for_dummies.md): Introductory tutorial
- [Matchers Reference](../core_assertions_matchers/matchers_reference.md): For argument matching and expressions

## Code References

Explore source examples and tests verifying mock definitions and macros:

- `gmock-spec-builders_test.cc` for usage and test cases of `EXPECT_CALL` and `ON_CALL` syntax

---

<Note>
Always define all qualifiers on mocked methods to match the base class exactly. Consider defining aliases for complex types to reduce parsing errors.
</Note>
<Info>
To suppress warnings on uninteresting calls, use `NiceMock`, or explicitly allow the call with `EXPECT_CALL(...).Times(AnyNumber())`.
</Info>
