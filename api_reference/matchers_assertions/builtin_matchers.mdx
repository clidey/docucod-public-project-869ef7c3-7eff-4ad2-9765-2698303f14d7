---
title: "Built-in Matchers"
description: "Detailing built-in argument matchers such as Eq, Ne, Lt, and more complex container or property matchers. Learn to compose, nest, and customize matchers for clear, maintainable, and precise expectations."
---

# Built-in Matchers

This page details the built-in argument matchers provided by GoogleMock, such as `Eq`, `Ne`, `Lt`, and more specialized container or property matchers. Understanding these matchers allows you to compose, nest, and customize expectations for mock method calls with clarity and precision.

---

## 1. Introduction to Matchers

Matchers describe the criteria for the arguments passed to mock methods. They enable assertions about the properties or values of arguments beyond exact equality.

- Matchers are used in `EXPECT_CALL` and `ON_CALL` macros to specify which calls are expected or what default behavior is set.
- Each matcher tests whether a given argument value satisfies its conditions and provides readable descriptions for test diagnostics.

For example:

```cpp
EXPECT_CALL(mock, DoThis(Eq(5)));
EXPECT_CALL(mock, DoThat(Ge(10), Lt(20)));
```

---

## 2. Comparison Matchers

Basic comparison matchers simplify conditions on argument values:

| Matcher | Meaning | Example Usage |
|---|---|---|
| `Eq(value)` | Equals to `value` | `EXPECT_CALL(mock, Func(Eq(42)));` |
| `Ne(value)` | Not equal to `value` | `EXPECT_CALL(mock, Func(Ne(0)));` |
| `Lt(value)` | Less than `value` | `EXPECT_CALL(mock, Func(Lt(10)));` |
| `Le(value)` | Less or equal to `value` | `EXPECT_CALL(mock, Func(Le(10)));` |
| `Gt(value)` | Greater than `value` | `EXPECT_CALL(mock, Func(Gt(0)));` |
| `Ge(value)` | Greater or equal to `value` | `EXPECT_CALL(mock, Func(Ge(1)));` |

### Example:

```cpp
EXPECT_CALL(mock, Compute(Lt(10), Ne(0)))
    .WillOnce(Return(true));
```


---

## 3. Wildcard Matcher

- `_` (underscore) matches **any** argument value regardless of type.
- Equivalent to `A<T>()` or `An<T>()` which match any value of type `T`.

### Example:

```cpp
EXPECT_CALL(mock, Process(_));  // Matches Process called with any argument.
```

---

## 4. String Matchers

Specialized matchers for string comparisons that consider content and optionally case sensitivity.

- `StrEq(str)`: Matches strings equal to `str`.
- `StrNe(str)`: Matches strings not equal to `str`.
- `StrCaseEq(str)`: Matches strings equal to `str` ignoring case.
- `StrCaseNe(str)`: Matches strings not equal to `str` ignoring case.
- `HasSubstr(substring)`: Matches strings containing `substring`.
- `StartsWith(prefix)`: Matches strings that start with `prefix`.
- `EndsWith(suffix)`: Matches strings that end with `suffix`.

### Example:

```cpp
EXPECT_CALL(mock, Log(StrEq("ERROR")));
EXPECT_CALL(mock, Filename(StartsWith("/tmp/")));
```

---

## 5. Pointer and Reference Matchers

Manipulate matchers to work on references or pointees.

- `Pointee(m)`: Matches a pointer if the value pointed to matches matcher `m`.
- `Ref(variable)`: Matches any argument that is a reference to the specific `variable`.
- `IsNull()`: Matches any null pointer (raw or smart).
- `NotNull()`: Matches any non-null pointer.

### Nested pointers example:

```cpp
EXPECT_CALL(mock, Foo(Pointee(Pointee(Eq(5)))));  // Pointer to pointer matches 5.
```

---

## 6. Container Matchers

Matchers to validate elements within standard containers such as vectors, maps, lists, etc.

- `ElementsAre(m1, m2, ...)`: Checks sequential elements against the given matchers.
- `UnorderedElementsAre(m1, m2, ...)`: Checks elements regardless of order.
- `ElementsAreArray(...)`: Like `ElementsAre` but takes an array/vector.
- `UnorderedElementsAreArray(...)`: Like `UnorderedElementsAre` but takes an array/vector.
- `Contains(element_matcher)`: Matches if at least one element satisfies `element_matcher`.
- `IsSubsetOf(container_or_matchers)`, `IsSupersetOf(container_or_matchers)`: Test for subset/superset relations.
- `Each(element_matcher)`: All elements match the matcher.

#### Special matchers for maps:

- `Pair(m1, m2)`: Matches `std::pair` where first field matches `m1` and second field matches `m2`.
- `Key(m)`: Matches the key of a pair against matcher `m`.

### Example:

```cpp
EXPECT_CALL(mock, ProcessData(
    ElementsAre(Ge(1), Lt(5), _)));

std::map<int, std::string> m = {{1, "foo"}, {2, "bar"}};
EXPECT_THAT(m, Contains(Pair(1, "foo")));
```

---

## 7. Composite Matchers

GoogleMock lets you combine existing matchers to build more complex conditions:

- `AllOf(m1, m2, ...)`: Matches if **all** sub-matchers match.
- `AnyOf(m1, m2, ...)`: Matches if **any** sub-matcher matches.
- `Not(m)`: Matches the negation of matcher `m`.

Example with combinations:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(0), Le(100), Not(Eq(50)))));
```

---

## 8. Matchers for Structs, Classes, and Tuples

- `Field(&Class::member, matcher)`: Matches an object whose member matches.
- `Property(&Class::getter, matcher)`: Matches an object whose property method returns a value that matches.
- `FieldsAre(m1, m2, ...)`: Matches an aggregate type or tuple piecewise on fields.

### Example:

```cpp
EXPECT_THAT(foo, Field(&Foo::bar, Eq(5)));
EXPECT_THAT(foo, FieldsAre(Ge(3), StartsWith("John")));
```

---

## 9. Polymorphic vs Monomorphic Matchers

- **Polymorphic matchers**: Can be used with multiple types (e.g., `Eq(5)` works with ints, doubles, etc.).
- **Monomorphic matchers**: Specific to a single type.

GoogleMock provides polymorphic versions of most built-in matchers to simplify usage.

---

## 10. Custom Matchers and Extensibility

- Use `MATCHER`, `MATCHER_P`, etc., macros to define custom matchers quickly.
- Implement matcher classes using the `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods for more advanced behavior.

For details see the [gMock Cookbook: Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#writing-new-matchers-quickly).

---

## 11. Best Practices & Tips

- Use `_` as a catch-all matcher when you are not interested in specific arguments.
- Compose matchers for clarity and maintainability.
- Use `Ref()` to match references to specific variables reliably.
- Use `Pointee()` for matching values pointed to by pointers or smart pointers.
- Prefer `ElementsAre` and variants to verify container contents precisely.
- Use `With()` clause on expectations to match multiple arguments as a tuple for complex relations.
- Leverage polymorphic matchers for flexible mocking and code reuse.

---

## 12. Common Pitfalls & Troubleshooting

- Using `Eq()` directly with C strings checks pointer equality, not content. Use `StrEq()` for content comparison.
- Unprotected commas in types cause `MOCK_METHOD` macro parsing errors. Wrap complex types like `std::pair<int, double>` in extra parentheses or use type aliases.
- Matching pointers requires care: match the pointee with `Pointee()`, not the pointer itself unless that is intentional.
- When matchers involve complex logic or side-effects, ensure they are pure and side-effect free.
- Beware of uninteresting calls without expectations; consider `NiceMock` to suppress warnings or explicitly add expectations if calls are expected.

---

## 13. Reference Examples

### Basic argument matcher with EXPECT_CALL

```cpp
using ::testing::Eq;
using ::testing::Lt;

EXPECT_CALL(mock, Calculate(Eq(5), Lt(10)))
    .WillOnce(Return(42));
```

### Using wildcard matcher

```cpp
EXPECT_CALL(mock, Process(_));  // Matches any argument.
```

### Matching container arguments

```cpp
using ::testing::ElementsAre;

EXPECT_CALL(mock, UpdateData(ElementsAre(1, 2, 3)));
```

### Matching nested pointer values

```cpp
using ::testing::Pointee;

EXPECT_CALL(mock, ReceiveData(Pointee(Pointee(Eq(42)))));
```

### Matching object members

```cpp
EXPECT_CALL(mock, Foo(Field(&Foo::id, Eq(10))));
```

---

## Additional Resources

- [Matchers Reference](matchers.md) for detailed built-in matcher descriptions and usage.
- [gMock Cookbook](gmock_cook_book.md) for practical recipes and advanced matcher techniques.
- [Mocking Reference](mocking.md) for how expectations interact with matchers.
- [Writing New Matchers Quickly](custom-assertions.md#gmock-matchers) for extending the matcher API.

---

## Glossary

- **Matcher**: An object that encapsulates a condition for matching argument values.
- **Polymorphic Matcher**: Matches arguments of multiple compatible types.
- **Monomorphic Matcher**: Matches arguments of a single specific type.
- **Wildcard Matcher (`_`)**: A matcher that matches any value.
- **Element Matcher**: A matcher for elements of a container.

---

Using these matchers effectively will empower you to write concise and robust mock-based tests, while giving clear meaningful failure diagnostics to support debugging and maintainability.


<AccordionGroup title="Quick Reference for Common Matchers">
<Accordion title="Basic Comparison Matchers">
| Matcher | Description                  | Usage Example                    |
|---------|------------------------------|---------------------------------|
| `Eq(x)` | Equal to `x`                 | `EXPECT_CALL(mock, Foo(Eq(5)));`|
| `Ne(x)` | Not equal to `x`             | `EXPECT_CALL(mock, Foo(Ne(0)));`|
| `Lt(x)` | Less than `x`                | `EXPECT_CALL(mock, Foo(Lt(10)));`|
| `Le(x)` | Less or equal to `x`         | `EXPECT_CALL(mock, Foo(Le(10)));`|
| `Gt(x)` | Greater than `x`             | `EXPECT_CALL(mock, Foo(Gt(0)));`|
| `Ge(x)` | Greater or equal to `x`      | `EXPECT_CALL(mock, Foo(Ge(1)));`|
</Accordion>
<Accordion title="String Matchers">
| Matcher      | Description                          | Example                         |
|--------------|--------------------------------------|--------------------------------|
| `StrEq(s)`   | String equals `s`                   | `EXPECT_CALL(mock, Bar(StrEq("Hi")));`|
| `StrNe(s)`   | String not equals `s`               | `EXPECT_CALL(mock, Bar(StrNe("Bye")));`|
| `StrCaseEq`  | String equals ignoring case         | `EXPECT_CALL(mock, Bar(StrCaseEq("hello")));`|
| `HasSubstr(s)`| String contains substring `s`      | `EXPECT_CALL(mock, Bar(HasSubstr("world")));`|
| `StartsWith(s)`| String starts with `s`            | `EXPECT_CALL(mock, Bar(StartsWith("pre")));`|
| `EndsWith(s)` | String ends with `s`               | `EXPECT_CALL(mock, Bar(EndsWith("end")));`|
</Accordion>
<Accordion title="Pointer and Reference Matchers">
| Matcher     | Description                            | Usage Example                      |
|-------------|----------------------------------------|-----------------------------------|
| `Pointee(m)`| Pointer to value matching `m`         | `EXPECT_CALL(mock, Foo(Pointee(Eq(42))));`|
| `Ref(x)`    | Reference to variable `x`              | `EXPECT_CALL(mock, Foo(Ref(my_var)));`|
| `IsNull()`  | Null pointer match                     | `EXPECT_CALL(mock, Foo(IsNull()));`|
| `NotNull()` | Not-null pointer match                 | `EXPECT_CALL(mock, Foo(NotNull()));`|
</Accordion>
<Accordion title="Container Matchers">
| Matcher           | Description                        | Usage Example                                  |
|-------------------|------------------------------------|------------------------------------------------|
| `ElementsAre(...)`| Matches exact elements in order   | `EXPECT_CALL(mock, Foo(ElementsAre(1, 2, 3)));`|
| `UnorderedElementsAre(...)` | Matches elements in any order  | `EXPECT_CALL(mock, Foo(UnorderedElementsAre(1, 3, 2)));`|
| `Contains(m)`     | Container contains element matching `m` | `EXPECT_THAT(container, Contains(42));`   |
| `Pair(m1, m2)`    | Matches std::pair with first=m1, second=m2| `EXPECT_THAT(map, Contains(Pair(1, "foo")));`|
| `Key(m)`          | Matches key in pair or map          | `EXPECT_THAT(map, Contains(Key(42)));`          |
</Accordion>
<Accordion title="Composite Matchers">
| Matcher    | Description                                   |
|------------|-----------------------------------------------|
| `AllOf(m1, m2,...)` | Matches if all sub-matchers match        |
| `AnyOf(m1, m2,...)` | Matches if any sub-matcher matches        |
| `Not(m)`            | Matches negation of matcher `m`               |
</Accordion>
</AccordionGroup>