---
title: "Assertion Macros"
description: "Reference for assertion macros, detailing their semantics, usage, and failure handling logic. Discover how to control test flow using fatal and non-fatal assertions, including flexible ways to author custom assertions."
---

# Assertion Macros Reference

This guide provides a thorough reference for GoogleTest’s assertion macros, explaining their semantics, their effect on test flow, and how to author custom assertions and handle failures gracefully. Learn how to leverage both fatal and non-fatal assertions to control your test execution, with detailed guidance on common assertion types, best practices, and troubleshooting tips.

---

## Overview of Assertion Macros

GoogleTest assertion macros form the backbone of your test validations, allowing you to verify conditions and expected behaviors in your C++ code. These macros primarily come in pairs:

- **`EXPECT_` macros:** Generate *non-fatal* failures, which report the failure but allow the current test function to continue.
- **`ASSERT_` macros:** Generate *fatal* failures, which report the failure and immediately abort the current test function.

All assertion macros support streaming custom failure messages using the `<<` operator to enrich diagnostics.

> Example:
>
```cpp
EXPECT_TRUE(value > 0) << "Value must be positive";
```

### Intent & Usage

Choose `EXPECT_` when you want to continue testing after a failure to collect more error information, and `ASSERT_` when encountering a failure should stop further execution of the current test case immediately.

### Including Assertions

To use these macros, include the main GoogleTest header:

```cpp
#include <gtest/gtest.h>
```

---

## Key Assertion Categories

### 1. Explicit Success and Failure

**Control test flow manually when branching logic determines test success:**

- **`SUCCEED()`**: Generates a success at the assertion site (does not override overall test status). Useful for documenting code paths that are expected.

- **`FAIL()`**: Generates a fatal failure, aborting the current function immediately. Use only in `void` functions.

- **`ADD_FAILURE()`**: Generates a nonfatal failure, reporting an error but continuing execution.

- **`ADD_FAILURE_AT(file, line)`**: Nonfatal failure at a specified file and line externally from the assertion site.

Usage example:

```cpp
switch (val) {
  case 1:
    // checks...
    break;
  default:
    FAIL() << "Unexpected value: " << val;
}
```

---

### 2. Boolean Condition Assertions

Verify boolean expressions clearly and succinctly:

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` — Expect condition to be true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` — Expect condition to be false.

Example:

```cpp
EXPECT_TRUE(is_ready) << "Object must be ready";
ASSERT_FALSE(has_error) << "Error detected unexpectedly";
```

---

### 3. Binary Comparison Assertions

Compare two values with familiar operators, with detailed failure messages showing actual and expected values. Supports pointers, integers, floating-point, strings, and user-defined types (provided streaming is supported):

| Macro          | Meaning                |
| -------------- | ---------------------- |
| `EXPECT_EQ`/`ASSERT_EQ` | Equality (`==`)       |
| `EXPECT_NE`/`ASSERT_NE` | Inequality (`!=`)     |
| `EXPECT_LT`/`ASSERT_LT` | Less than (`<`)       |
| `EXPECT_LE`/`ASSERT_LE` | Less or equal (`<=`)  |
| `EXPECT_GT`/`ASSERT_GT` | Greater than (`>`)    |
| `EXPECT_GE`/`ASSERT_GE` | Greater or equal (`>=`)|

**Important:**

- Comparing C strings with `EXPECT_EQ` tests pointer equality, use `EXPECT_STREQ` for content comparison.
- When comparing pointers against `NULL`, use `nullptr` to avoid warnings.

Example:

```cpp
EXPECT_EQ(calculated, expected);
ASSERT_GT(value, threshold);
```

---

### 4. String Comparison Assertions

When working with C strings, specialized macros treat strings as sequences of characters:

| Macro            | Purpose                                               |
| ---------------- | ---------------------------------------------------- |
| `EXPECT_STREQ`/`ASSERT_STREQ` | Equal contents                                  |
| `EXPECT_STRNE`/`ASSERT_STRNE` | Not equal contents                               |
| `EXPECT_STRCASEEQ`/`ASSERT_STRCASEEQ` | Equal contents, ignoring case                   |
| `EXPECT_STRCASENE`/`ASSERT_STRCASENE` | Not equal contents, ignoring case               |

Example:

```cpp
EXPECT_STREQ("hello", str);
EXPECT_STRCASEEQ("FOO", str_upper);
```

Supports wide C strings, which are UTF-8 encoded in output messages.

---

### 5. Floating-Point Comparison Assertions

Floating-point arithmetic requires approximate comparisons due to rounding and representation:

| Macro               | Description                                               |
| ------------------- | --------------------------------------------------------- |
| `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ` | Approximately equal `float`s within 4 ULPs                     |
| `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ` | Approximately equal `double`s within 4 ULPs                |
| `EXPECT_NEAR` / `ASSERT_NEAR` | Difference within specified absolute error                 |

Example:

```cpp
EXPECT_FLOAT_EQ(result, expected_value);
ASSERT_NEAR(computed, reference, 1e-5);
```

**Note:** This handles infinities and special floating point cases gracefully.

---

### 6. Exception Assertions

For projects that enable exception handling, GoogleTest provides assertions to verify exception throwing behavior:

| Macro                  | Description                               |
| ---------------------- | ----------------------------------------- |
| `EXPECT_THROW`/`ASSERT_THROW` | Expects a specific type of exception              |
| `EXPECT_ANY_THROW`/`ASSERT_ANY_THROW` | Expects *some* exception of any type            |
| `EXPECT_NO_THROW`/`ASSERT_NO_THROW` | Expects no exception thrown                     |

Example:

```cpp
EXPECT_THROW(FunctionThatShouldThrow(), std::runtime_error);
ASSERT_NO_THROW(SafeFunction());
```

---

### 7. Predicate Assertions

Enable more expressive assertions by calling user-defined predicates that print informative failure messages.

- Simple predicates:
  - `EXPECT_PRED1`, `EXPECT_PRED2`, ..., `EXPECT_PRED5` allow checking bool-returning functions or functors with up to five parameters with automatic argument printing on failure.

- Predicate-formatters:
  - `EXPECT_PRED_FORMAT1`, ..., `EXPECT_PRED_FORMAT5` accept functions returning `testing::AssertionResult` to fully customize failure messages.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
```

Or with a detailed failure message:

```cpp
testing::AssertionResult AssertPositive(const char* expr, int val) {
  if (val > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to non-positive: " << val;
}
EXPECT_PRED_FORMAT1(AssertPositive, value);
```

---

### 8. Generalized Assertion Using Matchers

The powerful `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` allow combinatorial and readable verification leveraging GoogleMock’s matcher framework.

Example:

```cpp
using ::testing::StartsWith;
EXPECT_THAT(message, StartsWith("Error:"));
```

See the [Matchers Reference](builtin_matchers.md) for rich matcher capabilities.

---

### 9. HRESULT Assertions for Windows

For COM programming or Windows API, GoogleTest provides convenience macros to check `HRESULT` success or failure:

- `EXPECT_HRESULT_SUCCEEDED(expr)` / `ASSERT_HRESULT_SUCCEEDED(expr)`
- `EXPECT_HRESULT_FAILED(expr)` / `ASSERT_HRESULT_FAILED(expr)`

Example:

```cpp
HRESULT hr = CoCreateInstance(...);
ASSERT_HRESULT_SUCCEEDED(hr);
```

The failure messages include the human-readable error message for the returned `HRESULT` value.

---

### 10. Death Assertions

To verify that a piece of code causes the process to exit or crash, use death test assertions, which run the tested statement in a subprocess, checking exit conditions and error output:

| Macro                        | Description                                   |
| ---------------------------- | --------------------------------------------- |
| `EXPECT_DEATH` / `ASSERT_DEATH` | Expects that code terminates with nonzero exit and output matches regex/matcher. |
| `EXPECT_DEATH_IF_SUPPORTED` / `ASSERT_DEATH_IF_SUPPORTED` | Runs if death tests supported, does nothing otherwise. |
| `EXPECT_DEBUG_DEATH` / `ASSERT_DEBUG_DEATH` | Like `EXPECT_DEATH`, but only active in debug builds. |
| `EXPECT_EXIT` / `ASSERT_EXIT` | Expects code to terminate with specified exit status and output matching a pattern. |

Example:

```cpp
EXPECT_DEATH({ DoSomethingBad(); }, "Fatal error at line");
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

See the [Death Tests](../advanced.md#death-tests) guide for detailed usage and best practices.

---

## Best Practices and Tips

- Use `EXPECT_` assertions when continuing after failure is safe and meaningful.
- Use `ASSERT_` when subsequent test code depends critically on prior conditions.
- Always add informative failure messages using streaming (<<) for clarity.
- For floating-point comparisons, prefer floating-point-specific assertions over `EXPECT_EQ`.
- Use `EXPECT_THAT` with matchers for readable, expressive, and powerful assertions.
- In death tests, name your test suite with a `DeathTest` suffix for proper test ordering and threading considerations.
- Employ `SCOPED_TRACE` or `ScopedTrace` to add context when multiple assertion checks happen inside helpers or loops.

---

## Troubleshooting Common Issues

- **Fatal assertions inside non-void functions:** Fatal macros (`ASSERT_*`, `FAIL()`) can only be used in `void` functions. Use non-fatal assertions or redesign functions accordingly.
- **Comparing C strings:** Don't use `EXPECT_EQ` for C strings, instead use `EXPECT_STREQ` to compare content.
- **Expectations not triggering:** Ensure `EXPECT_CALL` precedes any calls to mock objects.
- **Death test failures:** Verify regex in death assertions match stderr output; also confirm subprocess spawning support on your platform.
- **Misleading failure messages:** If using predicate assertions, ensure predicates provide informative messages or use predicate-formatters.

---

## Extending Assertions with Custom Predicates and Matchers

GoogleTest supports authoring custom assertions via matchers and predicates:

- Write custom matchers using `MATCHER` macros for concise new checks with automatic message generation.
- Implement detailed matchers via the matcher interfaces for fine-grained control.
- Leverage `EXPECT_PRED_FORMAT` wrappers to insert rich, structured predicate checks with custom error messages.

For step-by-step instructions and examples, see the [Creating Custom Assertions and Matchers](../googletest-guides/advanced-testing-patterns/custom-assertions.md) guide.

---

## Sample Usage

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::StartsWith;

TEST(MyTestSuite, CheckString) {
  std::string greeting = "Hello, world!";

  EXPECT_TRUE(!greeting.empty()) << "Greeting should not be empty";
  EXPECT_EQ(greeting.size(), 13);
  EXPECT_THAT(greeting, StartsWith("Hello")) << "Greeting should start with 'Hello'";
}

TEST(ExceptionTest, ThrowsLogicError) {
  auto func = []() { throw std::logic_error("fail"); };

  EXPECT_THROW(func(), std::logic_error);
  EXPECT_ANY_THROW(func());
  EXPECT_NO_THROW(int x = 5; (void)x;);
}

TEST(DeathTestExample, DiesWithMessage) {
  ASSERT_DEATH({ abort(); }, ".*");
}

// Explicit success and failure:
TEST(ExplicitFail, Demo) {
  if (some_condition_for_failure) {
    FAIL() << "Should not reach here!";
  } else {
    SUCCEED() << "Reached expected code path";
  }
}
```

---

## Further Reading & Related Documentation

- [GoogleTest Assertions Reference](reference/assertions.md)
- [GoogleMock Matchers Reference](api_reference/matchers_assertions/builtin_matchers)
- [Writing and Using Assertions Guide](googletest-guides/core-workflows/writing-assertions)
- [Custom Assertions and Matchers Guide](googletest-guides/advanced-testing-patterns/custom-assertions)
- [Death Tests and Exception Assertions Guide](googletest-guides/advanced-testing-patterns/death-tests)

For advanced mocking scenarios and behaviors related to assertions combined with mocks, see:
- [Mock Method Macros Reference](api_reference/mocking_core/mock_method_macros)
- [EXPECT_CALL and ON_CALL Reference](api_reference/mocking_core/expect_call_on_call)

---

## Summary

This page equips you with the knowledge to validate your C++ program behavior using GoogleTest’s assertion macros—from basic boolean assertions to advanced predicates, exception checks, and death tests. Understanding the difference between fatal and non-fatal assertions, and how to best apply each, empowers effective test construction and failure diagnostics. By extending your tests with custom assertions and utilizing the rich matcher infrastructure, you can write expressive, maintainable, and robust test cases that precisely capture your code’s expected behavior.

---

<Info>
For a practical walkthrough on writing assertions, refer to the [Writing and Using Assertions](googletest-guides/core-workflows/writing-assertions) guide.
</Info>
<Info>
To integrate assertions seamlessly with mocks, consult the [Mocking Basics](googletest-guides/core-workflows/mocking-basics) and [Mock Method Macros](api_reference/mocking_core/mock_method_macros) pages.
</Info>

