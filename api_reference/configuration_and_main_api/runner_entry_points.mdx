---
title: "Test Runner Entry Points"
description: "Describes the C++ main function integration with Googletest and GoogleMock. Shows how to initialize, run, and customize the test runner on supported platforms, including special platform considerations."
---

# Test Runner Entry Points

## Overview

This page explains the primary entry points used to initialize and run test programs with GoogleTest and GoogleMock. It covers how to write or customize the `main()` function, how the test runner operates on different platforms, and special considerations for embedded and unusual environments.

GoogleTest and GoogleMock provide a standard way to execute tests by calling `RUN_ALL_TESTS()` after initializing the framework. Most users do not need to write their own `main()` function and instead link to provided main implementations. However, when custom behavior is needed before tests run, this document guides you how to safely implement and hook into the test runner lifecycle.

## Standard Test Runner Workflow

The typical lifecycle of a GoogleTest program is:

1. Initialize GoogleTest (and optionally GoogleMock) with command line arguments.
2. Run all tests registered in the program.
3. Return the overall status reflecting test success or failure.

### Default `main()` Implementation

GoogleTest provides a default implementation of `main()` in the `gtest_main` target which most users should link against. Similarly, GoogleMock provides `gmock_main` which also initializes GoogleMock with GoogleTest.

Here is a canonical `main()` function skeleton when writing your own:

```c++
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  // Initializes GoogleTest framework with all command line flags processed.
  testing::InitGoogleTest(&argc, argv);

  // Runs all tests and obtains their overall result.
  return RUN_ALL_TESTS();
}
```

You must call `InitGoogleTest` before running tests so the command-line flags and configuration are properly set up. Ignoring this leads to unexpected behavior.

### Using GoogleMock

Since GoogleMock depends on GoogleTest, use `testing::InitGoogleMock()` instead, which also initializes GoogleTest internally. Example:

```c++
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

## Platform Specific Notes

### Desktop and Standard Platforms

GoogleTest and GoogleMock both provide main implementations suitable for Linux, macOS, and Windows. Simply linking with `gtest_main` or `gmock_main` provides a fully functional entry point.

On Windows Mobile, the main function uses `_tmain` with Unicode-aware parameters.

### Embedded and Arduino-like Environments

On platforms like ESP8266, ESP32, and some NRF52 variants running Arduino:

- The program entry points are `setup()` and `loop()`, not `main()`.
- These platforms provide their own `setup()` and `loop()` implementations.

GoogleTest and GoogleMock supply example `setup()` and `loop()` functions to run tests:

```c++
void setup() {
  testing::InitGoogleTest();  // or InitGoogleMock()
}

void loop() {
  RUN_ALL_TESTS();
}
```

Users can embed this code directly or adapt it as needed.

### QuRT Platforms

QuRT has a `main()` function but no usable `argc` and `argv`. The default GoogleTest main is adapted as:

```c++
int main() {
  testing::InitGoogleTest();
  return RUN_ALL_TESTS();
}
```

## Customizing the Test Runner

Users sometimes need custom setup or tear-down around their tests that doesn't fit into the test fixtures or environments. For example, setting up logging, parsing non-standard flags, or hooking diagnostics.

To customize:

- Write your own `main()` instead of linking with `gtest_main` or `gmock_main`.
- Initialize GoogleTest (and GoogleMock) explicitly with `InitGoogleTest()` or `InitGoogleMock()`.
- Perform your setup steps.
- Then call `RUN_ALL_TESTS()`.
- Optionally, perform any teardown after `RUN_ALL_TESTS()` returns.

Example:

```c++
int main(int argc, char** argv) {
  // Initialize testing framework
  testing::InitGoogleTest(&argc, argv);

  // Custom setup
  SetupLogging();

  // Run tests
  int result = RUN_ALL_TESTS();

  // Custom teardown
  CleanupResources();

  return result;
}
```

## Important Guidelines

- **Always use the return value** of `RUN_ALL_TESTS()` as your program's exit code. This ensures that automated systems can detect test failures reliably.
- **Call `InitGoogleTest()` or `InitGoogleMock()` once and before running tests.** Calling multiple times or omitting this leads to incorrect flag processing and test registration.
- If you want to run tests multiple times manually (such as in a loop), call `InitGoogleTest()` only once.
- Avoid writing your own `main()` unless necessary; rely on the provided `gtest_main` or `gmock_main` libraries when possible.

## Example: Minimal Custom Entry Point

```c++
#include <gtest/gtest.h>

class CustomListener : public testing::EmptyTestEventListener {
  void OnTestStart(const testing::TestInfo& info) override {
    printf("Starting test %s.%s\n", info.test_suite_name(), info.name());
  }
  // Implement other event handlers as needed.
};

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);

  // Register a custom test event listener
  testing::TestEventListeners& listeners =
      testing::UnitTest::GetInstance()->listeners();
  listeners.Append(new CustomListener());

  // Run all tests
  return RUN_ALL_TESTS();
}
```

## Summary

- The main entry point is typically provided via `gtest_main` or `gmock_main`.
- Call `testing::InitGoogleTest()` or `testing::InitGoogleMock()` before running tests.
- Use `RUN_ALL_TESTS()` to execute all registered tests.
- Support exists for embedded platforms with Arduino-like `setup()`/`loop()` models.
- Customize `main()` only when necessary to integrate new setup or teardown logic.

---

## Related Links

- [GoogleTest Primer](primer.md) — Fundamentals of writing tests and the main test API.
- [Advanced GoogleTest Topics](docs/advanced.md) — For customizing test execution and advanced usage.
- [GoogleMock Main Source](googlemock/src/gmock_main.cc) — Reference implementation of GoogleMock’s main.
- [GoogleTest Main Source](googletest/src/gtest_main.cc) — Reference implementation of GoogleTest’s main.
- [CMake Integration](googletest/README.md) — How to link and build tests with `gtest_main` and `gmock_main`.

---

## Troubleshooting

- **`RUN_ALL_TESTS()` return value ignored:** Always return this value from `main()`. Otherwise, test failures are ignored by CI systems.
- **Tests not executing:** Did you forget to call `InitGoogleTest(argc, argv)`?
- **Multiple `main()` functions:** Link with either `gtest_main` or provide your own `main()`. Do not link both.
- **Embedded platform setup issues:** Check platform-specific entry points `setup()` and `loop()` are defined correctly.

<Tip>
Use `gtest_main` or `gmock_main` whenever possible to avoid writing your own `main()`. Only customize when you need special setup or teardown outside test fixtures.
</Tip>

<Warning>
Do not call `RUN_ALL_TESTS()` more than once per process lifetime, as this can cause undefined behavior.
</Warning>
