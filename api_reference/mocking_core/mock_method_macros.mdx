---
title: "Mock Method Macros"
description: "Reference for the key macros—such as MOCK_METHOD—for mocking class and interface methods. Learn how to declare, configure, and use mocks for member functions, including support for different signatures, qualifiers, and advanced behaviors."
---

# Mock Method Macros

Reference for the key macros—such as `MOCK_METHOD`—for mocking class and interface methods. Learn how to declare, configure, and use mocks for member functions, including support for different signatures, qualifiers, and advanced behaviors.

---

## Overview

In GoogleMock, mock methods are declared within mock classes using the `MOCK_METHOD` macro family. This powerful macro defines mocked versions of member functions, allowing tests to specify expected calls, argument matching, behavior, and verification.

Mocking methods accurately requires careful mirroring of the original method signatures, including const-ness, override specifications, noexcept, calling conventions, and reference qualifiers. This reference details how to use `MOCK_METHOD` and its variants effectively.

---

## MOCK_METHOD Macro

The primary macro for mocking a method is:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- **ReturnType**: The function return type.
- **MethodName**: The name of the method to mock.
- **Args...**: The function arguments, enclosed in parentheses.
- **Specs...**: Optional qualifiers enclosed in parentheses such as `const`, `override`, `noexcept`, `Calltype(...)`, and `ref(...)`.


### Usage Example

```cpp
class MyMock : public Interface {
 public:
  MOCK_METHOD(void, DoSomething, (int x, const std::string& y), (override));
  MOCK_METHOD(int, Compute, (), (const, override));
};
```

### Important Notes on `MOCK_METHOD`

- The argument list **must** be enclosed in parentheses.
- If the function return type or any argument type contains commas (e.g. `std::pair<bool, int>`), you must wrap the return or argument type in an extra pair of parentheses or use a type alias to avoid macro parsing errors.
- `MOCK_METHOD` must appear in the `public:` section of your mock class regardless of the original method's access specifier.

### Supported Specifiers

The optional fourth parameter accepts a comma-separated list of qualifiers affecting the generated method:

| Qualifier               | Meaning                                                                                  |
|-------------------------|------------------------------------------------------------------------------------------|
| `const`                 | Marks the method as `const`, required if overriding a const method.                      |
| `override`              | Marks the method as `override`. Recommended for overriding virtual methods.              |
| `noexcept`              | Marks the method as `noexcept`. Required if overriding a `noexcept` method.              |
| `Calltype(...)`         | Specifies the calling convention, e.g., `Calltype(STDMETHODCALLTYPE)`. Useful on Windows.|
| `ref(&)` or `ref(&&)`   | Adds lvalue or rvalue reference qualifiers. Required if overriding reference-qualified methods. |

Example with specifiers:

```cpp
MOCK_METHOD(int, Func, (double x), (const, override, noexcept));
MOCK_METHOD(void, WindowsStyle, (), (Calltype(STDMETHODCALLTYPE), override));
MOCK_METHOD(int, RefQualified, (), (const, ref(&), override));
```

### Dealing with Unprotected Commas in Types

Unprotected commas inside argument or return types can cause compile errors because macros interpret commas as argument separators. To resolve this:

- **Solution 1:** Wrap the type in an extra pair of parentheses:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

- **Solution 2:** Use a `using` alias:

```cpp
using BoolAndInt = std::pair<bool, int>;
using MapIntDouble = std::map<int, double>;

MOCK_METHOD(BoolAndInt, GetPair, ());
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

### Mocking Reference-Qualified Methods

If the method you want to mock has reference qualifiers, you must include the `ref(...)` qualifier in the spec:

```cpp
MOCK_METHOD(int, Bar, (), (const, ref(&), override));  // const &
MOCK_METHOD(int, Baz, (), (ref(&&), override));        // &&
```

---

## Legacy MOCK_METHODn Macros

Before 2018, GoogleMock used a family of macros like `MOCK_METHOD1`, `MOCK_CONST_METHOD1`, etc. These are still supported but using the generic `MOCK_METHOD` macro is recommended.

| Legacy Macro                        | New Equivalent                                        |
|-----------------------------------|------------------------------------------------------|
| `MOCK_METHOD1(Foo, bool(int))`     | `MOCK_METHOD(bool, Foo, (int))`                      |
| `MOCK_CONST_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`             |
| `MOCK_METHOD1_T(Foo, bool(int))`   | `MOCK_METHOD(bool, Foo, (int))`                      |
| `MOCK_CONST_METHOD1_T(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`             |
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))` |

If you find yourself maintaining legacy code, the above translations can help migrate to the modern macro.

---

## Mocking Different Method Types

- **Mocking private/protected methods:** Define `MOCK_METHOD` in the public section for any method to be mocked, regardless of its access level in the base class.

- **Mocking overloaded methods:** Simply declare `MOCK_METHOD` for each overload. If you omit some overloads, bring the base class's overloads in scope with `using BaseClass::MethodName;`.

- **Mocking methods with move-only types:** Supported directly with `MOCK_METHOD`. Use lambdas or `WillOnce` with lambdas to return unique_ptrs repeatedly.

- **Mocking non-virtual methods:** Use dependency injection via templates or interfaces; mock classes have unrelated types but matching method signatures.

- **Mocking free functions:** Refactor your code to call through an interface to enable mocking.

---

## Practical Tips

- Always put `MOCK_METHOD` declarations in the `public:` section.
- Wrap argument or return types with commas if not aliased to avoid parsing errors.
- Use the specifiers parameter to correctly mock overridden methods with `const`, `override`, `noexcept`, calling conventions, or reference qualifiers.
- For ref-qualified methods, integration with `ref(&)` and `ref(&&)` works seamlessly with `MOCK_METHOD`.

---

## Example Mock Class

```cpp
#include <gmock/gmock.h>
class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int v), (override));
  MOCK_METHOD((std::pair<bool, int>), GetPair, (), (override));
};
```

---

## Advanced Specifier Usage

```cpp
// Example with calling convention
MOCK_METHOD(bool, WindowsCall, (int), (Calltype(STDMETHODCALLTYPE), override));

// Reference qualified method
MOCK_METHOD(int, RefQualifiedMethod, (), (const, ref(&), override));
```

---

## Troubleshooting

- **Compilation errors due to commas:** Ensure argument and return types with commas are wrapped in parentheses or aliased.
- **Missing `override` leads to warnings:** Use `(override)` specifier for overridden virtual methods.
- **Private/protected method mock undefined:** Ensure the mock method is declared public in the mock class.
- **Ambiguous overloads:** Provide full argument list to disambiguate.
- **Ref qualifier omitted:** Use `ref(&)` or `ref(&&)` in specs as needed.

---

For detailed guidance on mocking techniques, expectations, matchers, and setting behavior, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and the [Mocking Reference](https://google.github.io/googletest/reference/mocking.md).

---

## See Also

- [`EXPECT_CALL` and `ON_CALL`](reference/mocking_core/expect_call_on_call.md) - How to specify expectations and default behaviors
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Practical recipes
- [Matchers Reference](reference/matchers.md) - How to specify argument matchers
- [Actions and Advanced Mocking](reference/actions_and_advanced/standard_actions.md) - How to set up mock method return behaviors

---

<Call>
**Note:** gMock macros live in the `testing` namespace. It is recommended to write `using ::testing::Foo;` once in your test files for readability.
</Call>
