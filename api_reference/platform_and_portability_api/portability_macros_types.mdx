---
title: "Portability Macros and Types"
description: "Documents macros, types, and functions that maintain compatibility and feature parity on different platforms and compilers. Intended for users extending or adapting GoogleTest/GoogleMock infrastructure."
---

# Portability Macros and Types

GoogleTest provides a collection of macros, types, and utilities designed to maintain compatibility and feature parity across a broad range of platforms and compilers. This page documents these elements specifically for users aiming to extend or adapt the GoogleTest and GoogleMock infrastructure to various environments.

---

## Overview

Platform and compiler differences challenge consistent test behavior and portability. GoogleTest addresses this through a set of clearly defined macros and types that transparently encapsulate platform-specific details. These macros enable GoogleTest and GoogleMock to:

- Detect the underlying operating system or platform.
- Adapt to compiler features, threading support, and exception handling capabilities.
- Harmonize type definitions like fixed-width integers and timings.

By relying on these portability macros and types, users can write and maintain tests that seamlessly run on systems ranging from Linux, Windows (including Mobile and MinGW variants), macOS/iOS, to less common or embedded targets like QNX, Haiku, ESP platforms, and more.


## Platform Identification Macros

GoogleTest automatically defines a suite of macros during compilation to identify the target platform. These macros are critical as they allow conditional compilation and behavior adjustments necessary for compatibility.

### Key Macros

| Macro Name               | Meaning                                      | Example Use Case                                                  |
|--------------------------|----------------------------------------------|------------------------------------------------------------------|
| `GTEST_OS_LINUX`          | Compile target is Linux OS                    | Enable Linux-specific code paths or include Linux-only headers   |
| `GTEST_OS_WINDOWS`        | Compile target is Windows (desktop or MinGW) | Windows-specific threading or file handling                      |
| `GTEST_OS_WINDOWS_DESKTOP`| Standard Windows desktop                      | Enable desktop Win32 API features                                |
| `GTEST_OS_WINDOWS_MINGW`  | MinGW Windows platform                        | Use MinGW-specific workarounds                                    |
| `GTEST_OS_MAC`            | macOS platform                               | Use macOS system calls or facilities                             |
| `GTEST_OS_IOS`            | iOS (Apple mobile)                            | Adapt for iOS app sandbox restrictions                           |
| `GTEST_OS_CYGWIN`         | Cygwin POSIX compatibility environment       | POSIX emulation on Windows                                       |
| `GTEST_OS_QNX`            | QNX Neutrino RTOS                             | Embedded RTOS-specific behavior                                   |
| `GTEST_OS_ESP32`          | Espressif ESP32 embedded platform             | Embedded-specific adaptations                                    |


### Usage

These macros evaluate to 1 if the corresponding platform is detected; otherwise, they are undefined (never 0). This allows for clean conditional compilation, e.g.: 

```cpp
#ifdef GTEST_OS_WINDOWS
// Windows-specific code here
#endif
```


## Feature Support Macros

GoogleTest also provides macros that report availability of key features in the compilation environment:

| Macro Name              | Meaning                                           | Typical Value |
|-------------------------|---------------------------------------------------|---------------|
| `GTEST_HAS_EXCEPTIONS`   | C++ exceptions enabled or disabled                | 0 or 1        |
| `GTEST_HAS_PTHREAD`      | Availability of pthread threading library         | 0 or 1        |
| `GTEST_HAS_RTTI`         | Run-time type identification enabled              | 0 or 1        |
| `GTEST_HAS_FILE_SYSTEM`  | File system support availability                   | 0 or 1        |
| `GTEST_HAS_STREAM_REDIRECTION` | Support for redirecting stdout/stderr streams | 0 or 1        |
| `GTEST_HAS_DEATH_TEST`   | Death test support available                        | 0 or 1        |
| `GTEST_HAS_TYPED_TEST`   | Support for typed tests                             | 0 or 1        |
| `GTEST_HAS_TYPED_TEST_P` | Support for type-parameterized tests                | 0 or 1        |


### Implications

These macros allow users or GoogleTest internals to adapt behavior or enable/disable features, for example:

```cpp
#if GTEST_HAS_EXCEPTIONS
try {
  // risky code
} catch(...) {
  // handle
}
#endif
```


## Thread Safety Macros and Classes

GoogleTest identifies whether the platform supports threading and synchronization:

- `GTEST_IS_THREADSAFE`: Defined to 1 if thread-safe primitives (like mutexes, thread locals) are available.

With threading enabled, GoogleTest provides:

- `Mutex` and `MutexLock`: Lightweight classes encapsulating platform-specific mutexes, supporting locking and unlocking.
- `ThreadLocal<T>`: Template class providing thread-local storage for type `T`.

If threading support is unavailable, these components become no-ops, allowing GoogleTest to compile but not support concurrent test threads.


**Example of usage:**

```cpp
::testing::internal::Mutex mu;
{
  ::testing::internal::MutexLock lock(&mu);
  // protected code
}
```


## Platform-Agnostic Types

GoogleTest defines convenient base types that provide consistent semantics regardless of the platform.

| Type or Macro           | Purpose                                      |
|------------------------|----------------------------------------------|
| `time_t` / `TimeInMillis` | Typedef for representing time in milliseconds |
| `BiggestInt`           | The largest signed integer type supported     |
| `TypeWithSize<N>`      | Template mapping a byte size to fixed-width integer types (`UInt`, `Int`) |

These simplify comparisons, arithmetic, and interactions with timing functions and file systems by avoiding platform-specific type pitfalls.


## File System and POSIX Wrappers

GoogleTest provides a `posix` namespace with wrappers for common POSIX-like system calls. These provide consistent interfaces for:

- File operations: `FOpen`, `FReopen`, `FDOpen`, `FClose`.
- Directory operations: `ChDir`, `RmDir`.
- File descriptor queries: `IsATTY`, `FileNo`.

These wrappers adapt calls to their Windows or non-POSIX equivalents where necessary, ensuring code portability without changing business logic.


## Regular Expression Selection

GoogleTest selects its regular expression implementation based on platform capabilities:

- Uses RE2 (`GTEST_USES_RE2`) when built with Abseil support.
- Uses POSIX regex (`GTEST_USES_POSIX_RE`) on compatible UNIX-like platforms.
- Falls back to a simple internal regex otherwise (`GTEST_USES_SIMPLE_RE`).

This macro-based selection guides `RE` class behavior and parsing mechanisms.


## Utility Macros and Functions

GoogleTest defines a number of utility macros that are crucial for safe, consistent test code:

- `GTEST_CHECK_(condition)`: An assertion macro that aborts the program if its condition evaluates false under all build modes.
- `GTEST_SNPRINTF_`: Platform-appropriate variant of `snprintf` for safe string formatting.
- `ImplicitCast_<To>`: Safe upcasting helper function.
- `CheckedDowncastToActualType<Derived, Base>`: Downcasting with runtime checks when RTTI is enabled.
- Character classification helpers (e.g., `IsAlpha`, `IsDigit`, `IsSpace`) that work correctly for signed and unsigned `char`.


## Best Practices and Common Pitfalls

- **Rely on Portability Macros**: When writing extensions or customizations, always use platform macros like `GTEST_OS_WINDOWS` or `GTEST_HAS_PTHREAD` to conditionally compile code paths.
- **Thread Safety**: Do not assume multi-threading support; check `GTEST_IS_THREADSAFE`. Use `Mutex` and `ThreadLocal` provided by GoogleTest when available.
- **Exception Handling**: Use `GTEST_HAS_EXCEPTIONS` to guard exception-dependent code.
- **File Operations**: Use GoogleTest's `posix` wrappers instead of raw system calls for portability.
- **Regular Expressions**: Understand that the actual regex engine varies; test compatibility especially when using advanced regex features.
- **Avoid Macro Name Collisions**: GoogleTest prefixes internal macros with `GTEST_` to avoid clashes, but when writing customizations, follow the same discipline.


## Example Usage Scenario

Imagine you are extending GoogleTest to support a custom embedded platform that lacks POSIX threads but uses a Windows-like environment:

1. Use `#ifdef` around code requiring threading to disable or replace with your own synchronization.
2. Use `GTEST_OS_WINDOWS` or `GTEST_OS_ESP32` to gate platform-specific code.
3. Implement or override necessary low-level file operations using `posix` namespace wrappers.
4. Use `TypeWithSize` to declare fixed-size integral types to fit your special hardware.

This approach guarantees that your extensions respect GoogleTest's cross-platform abstraction and maintain consistency.


## Troubleshooting

- **Build Errors Related to Macros**: Make sure that your compilation environment correctly defines platform macros or explicitly defines required feature macros if autodetection fails.
- **Thread-Safety Assertions Fail**: Verify that `GTEST_IS_THREADSAFE` is correctly defined and that your platform supports required threading primitives.
- **Unexpected Regular Expression Behavior**: Check which regex engine is in use (`GTEST_USES_RE2`, `GTEST_USES_POSIX_RE`, or `GTEST_USES_SIMPLE_RE`) and adapt your patterns accordingly.
- **File Operation Failures on Embedded Targets**: Ensure you rely on `posix::FOpen` and related wrappers and provide necessary implementations if your platform lacks standard C library features.


## Related Documentation

- [Internal Utilities](../platform_and_portability_api/internal_utilities.md) — Delves deeper into helper functions and synchronization primitives.
- [Platform Portability and Customization](../../concepts/integration-and-extensibility/platform-portability.md) — Explains the broad philosophy and practical strategies to adapt GoogleTest to various platforms.
- [Building and Installation Guides](../../getting-started/prerequisites-installation/installation-cmake.md) — Crucial for setting up your build environment respecting platform-specific flags such as these macros.


---

For code-driven exploration and validation, see the source header file `gtest-port.h` and its corresponding unit test `googletest-port-test.cc` for examples showing macros and types in action.

<Source url="https://github.com/google/googletest" paths={[{"path":"googletest/include/gtest/internal/gtest-port.h","range":"1-538"},{"path":"googletest/test/googletest-port-test.cc","range":"1-434"}]} branch="main" />

---