---
title: "Matchers Reference"
description: "Comprehensive guide to built-in and advanced matchers for argument verification, including composition, custom matcher definition, and practical examples. Enables expressive validation of call parameters and outcomes."
---

# Matchers Reference

This comprehensive guide presents the built-in and advanced matchers in GoogleTest's mocking framework (GoogleMock), enabling precise and expressive validation of function call arguments within tests. You'll learn about basic matchers, argument composition, custom matchers creation, and practical usage scenarios to elevate your mock verifications.

---

## 1. Introduction to Matchers

Matchers are the core tools gMock provides to verify that mocked functions are called with expected arguments. A matcher acts like a predicate, determining whether a given argument meets certain criteria. They enable tests to be expressive and maintainable, checking argument properties beyond mere equality.

Matchers can be:

- **Simple**: matching exact values, e.g., `Eq(5)`
- **Wildcard**: matching any value, e.g., `_`
- **Composed**: combining multiple matchers, e.g., `AllOf(Gt(0), Lt(10))`
- **Custom**: user-defined predicates to suit domain-specific verifications

Typically, matchers are used within `EXPECT_CALL()` or `EXPECT_THAT()` assertions to specify argument constraints.

<Call>
**Tip:** Import common matchers with `using ::testing::_; using ::testing::Eq;` etc., to write concise expectations.
</Call>

## 2. Basic Built-In Matchers

GoogleMock includes a rich set of built-in matchers for many common scenarios.

### 2.1 Wildcard Matcher

- `_`: Matches any argument of any type.

Example:
```cpp
EXPECT_CALL(mock_obj, SomeMethod(_));  // Accepts any argument.
```

### 2.2 Equality and Inequality

- `Eq(val)`: Matches arguments equal to `val` (using `operator==`).
- `Ne(val)`: Matches arguments not equal to `val`.

Example:
```cpp
EXPECT_CALL(mock_obj, SomeMethod(Eq(42)));
```

### 2.3 Relational Comparisons

- `Lt(val)`: Less than `val`
- `Le(val)`: Less or equal to `val`
- `Gt(val)`: Greater than `val`
- `Ge(val)`: Greater or equal to `val`

Example:
```cpp
EXPECT_CALL(mock_obj, SomeMethod(Gt(10)));
```

### 2.4 Boolean and Any-Type

- `A<T>()` or `An<T>()`: Matches any value of type `T`.
- `IsNull()`: Matches any nullptr (raw or smart pointers).
- `NotNull()`: Matches any non-null pointer.

### 2.5 String Matchers

- `StrEq(str)`: Matches strings equal to `str`.
- `StrNe(str)`: Matches strings not equal to `str`.
- `StrCaseEq(str)`: Matches strings equal to `str` ignoring case.
- `StrCaseNe(str)`: Matches strings not equal to `str` ignoring case.
- `HasSubstr(sub)`: Matches strings containing `sub`.
- `StartsWith(prefix)`: Matches strings starting with `prefix`.
- `EndsWith(suffix)`: Matches strings ending with `suffix`.

Example:
```cpp
EXPECT_CALL(mock_obj, SomeStringMethod(StartsWith("Hello")));
```

### 2.6 Floating-Point Approximate Equality

- `FloatEq(value)`, `DoubleEq(value)`: match float or double values approximately equal to `value`.
- `FloatNear(value, epsilon)` and `DoubleNear(value, epsilon)`: match within absolute error `epsilon`.


## 3. Composite Matchers

Matchers can be combined logically to create complex conditions:

- `AllOf(m1, m2, ...)`: Matches if *all* matchers are satisfied.
- `AnyOf(m1, m2, ...)`: Matches if *any* matcher is satisfied.
- `Not(m)`: Matches if inner matcher does *not* match.

Example:
```cpp
EXPECT_CALL(mock_obj, SomeMethod(AllOf(Gt(10), Lt(20))));
```

## 4. Matchers for Objects, Containers, and Members

### 4.1 Field and Property

- `Field(&Class::field, m)`: Matches an object whose member `field` matches matcher `m`.
- `Property(&Class::property, m)`: Matches an object whose getter method `property()` returns a value matching `m`.

Example:
```cpp
EXPECT_CALL(mock_obj, SomeMethod(Field(&Person::age, Ge(18))));
```

### 4.2 Pair and Key

- `Pair(m1, m2)`: Matches `std::pair` where first and second element match `m1` and `m2` respectively.
- `Key(m)`: Matches a pair whose first element matches `m`.

Useful for matching containers like maps.

### 4.3 Container Matchers

- `ElementsAre(e1, e2, ...)`: Matches container elements exactly and in order.
- `UnorderedElementsAre(e1, e2, ...)`: Matches container elements exactly but in any order.
- `Contains(m)`: Matches if container contains at least one element matched by `m`.
- `SizeIs(m)`: Matches container size against matcher `m`.
- `Each(m)`: Matches if *all* elements of container match `m`.
- `IsSupersetOf(...)` and `IsSubsetOf(...)`: For sets to check subgroup and supergroup relations.

Example:
```cpp
EXPECT_CALL(mock_obj, SomeMethod(ElementsAre(Eq(1), _, Gt(3))));
```

## 5. Advanced Matchers and Techniques

### 5.1 Multi-argument Matchers and `.With()` Clause

When you need to match the arguments as a whole tuple, use the `.With()` clause with a multi-argument matcher. For example:

```cpp
EXPECT_CALL(mock_obj, Func(_, _))
    .With(Lt()); // expects first argument < second argument
```

### 5.2 Matching Arguments by Reference

- `Ref(variable)`: Matches an argument that references the specified variable.

### 5.3 Matching Pointer and Smart Pointer Pointees

- `Pointee(m)`: Matches a pointer/smart pointer where the pointed-to value matches matcher `m`.

### 5.4 Using Predicates as Matchers

You can convert any unary predicate function or functor to a matcher with `Truly(predicate)`. For example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_CALL(mock_obj, Foo(Truly(IsEven)));
```

### 5.5 Combining Matchers with Logical Compositions

Compose complex conditions easily with nested `AllOf()`, `AnyOf()`, and `Not()`.

### 5.6 Custom Matchers

#### 5.6.1 Writing a Matcher with the `MATCHER` Macro

Define new matchers succinctly:

```cpp
MATCHER(IsDivisibleBy3, "Checks if divisible by 3") {
  return arg % 3 == 0;
}
```

Usage:

```cpp
EXPECT_CALL(mock_obj, Foo(IsDivisibleBy3()));
```

You can stream additional diagnostic information inside the matcher:

```cpp
MATCHER(IsDivisibleBy3, "") {
  if (arg % 3 != 0) {
    *result_listener << "remainder: " << (arg % 3);
    return false;
  }
  return true;
}
```

#### 5.6.2 Parameterized Custom Matchers

Use `MATCHER_P`, `MATCHER_P2`, ..., `MATCHER_P10` macros for parameterized matchers:

```cpp
MATCHER_P(IsWithinRange, range, "") {
  return arg >= -range && arg <= range;
}
```

Usage:

```cpp
EXPECT_CALL(mock_obj, Foo(IsWithinRange(5)));
```

### 5.7 Writing Matcher Classes (Advanced)

For complex scenarios, implement matcher classes with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods, then use factory functions returning `Matcher<T>`.

### 5.8 Polymorphic Matchers

Matchers that can match multiple argument types. E.g., `Eq(5)` can match `int`, `double`, `float`, etc.

## 6. Expressive Examples

### 6.1 Basic Example

```cpp
EXPECT_CALL(mock_turtle, PenDown());
EXPECT_CALL(mock_turtle, Forward(Ge(100)));
```
This expects the mock turtle to pen down and then move forward at least 100 units.

### 6.2 Matching Members

```cpp
EXPECT_CALL(mock_person, DoSomething(Field(&Person::age, Ge(21))));
```
Matches when `age` member of the `Person` argument is at least 21.

### 6.3 Container Contents

```cpp
EXPECT_CALL(mock_container, Insert(ElementsAre(1, _, Gt(3))));
```
Expects the container's insert method to be called with exactly three elements, where first is 1, third is greater than 3.

### 6.4 Custom Matcher

```cpp
MATCHER_P(IsSum, value, "checks sum") {
  return arg.x + arg.y == value;
}
EXPECT_CALL(mock_obj, Foo(IsSum(10)));
```
Matches when the argument's `x` and `y` fields sum to 10.

## 7. Best Practices

- Match only what matters: avoid over-specifying arguments; use `_` for unconstrained arguments.
- Prefer built-in matchers; use custom matchers only when necessary.
- Use composite matchers to express complex conditions clearly.
- Use `Ref()` when matching references to variables specifically.
- Use `RetiresOnSaturation()` on expectations to avoid sticky expectations blocking tests.
- Suppress uninteresting calls warnings via `NiceMock` where appropriate.

## 8. Troubleshooting and Tips

- **Ambiguous overloaded methods:** Use `TypedEq<T>(val)` or `MatcherCast<T>(m)` to disambiguate matchers.
- **Unmatched calls:** Check that expectations are set before calls occur. Use `--gmock_verbose=info` to see detailed call matching.
- **Custom matcher syntax errors:** Remember the description string must be C-string literals; use `result_listener` to provide custom explanations.
- **Matchers should be pure:** Do not have matchers with side-effects or internal state that changes across calls.

---

### Related Documentation

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mock Object & Method Definitions](reference/mocking.md#MOCK_METHOD)
- [Setting Expectations with EXPECT_CALL](reference/mocking.md#EXPECT_CALL)
- [Assertions with EXPECT_THAT using Matchers](reference/assertions.md#EXPECT_THAT)

---

Harness the full power of matchers to write precise, robust, and maintainable test verifications, making your C++ unit tests expressive and reliable.

<Call>
Remember: Start with simple matchers and grow your expertise progressively by combining and customizing matchers for your unique testing needs.
</Call>
