---
title: "Call Expectations and Cardinalities"
description: "Explains how to express expectations about how many times a mock method should be called, the order of calls, generic and strict mocking, and behaviors for unexpected calls—all crucial for verifying correct interaction patterns."
---

# Call Expectations and Cardinalities

GoogleMock empowers you to precisely specify how many times a mock method is expected to be called, the order in which calls should occur, and how the mock behaves when unexpected calls happen. Mastering call expectations and cardinalities is critical to verifying that your code interacts as intended with mocked dependencies, ensuring both correctness and maintainability of your tests.

---

## Understanding Call Expectations

Call expectations define **what calls you expect** your mock methods to receive during test execution. These expectations capture the interaction contract between your code and its dependencies. GoogleMock lets you set detailed expectations on method calls with fine-grained control over argument matching, call count, call order, and reaction to unexpected calls.

### Using `EXPECT_CALL`

The primary way to express expectations is the `EXPECT_CALL` macro, with syntax resembling natural language:

```cpp
EXPECT_CALL(mock_object, MethodName(argument_matchers))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action)
    .InSequence(sequences)
    .After(prerequisites)
    .RetiresOnSaturation();
```

- **`MethodName(argument_matchers)`**: Specify which method and which arguments you expect.
- **`.Times(cardinality)`**: Define how many times the call is expected (default inferred).
- **`.WillOnce()` and `.WillRepeatedly()`**: Define behavior for individual and repeated calls.
- **`.InSequence()` and `.After()`**: Specify strict or partial ordering.
- **`.RetiresOnSaturation()`**: Automatically retire the expectation when fulfilled.

> **Best Practice:** Use expectations sparingly to only verify critical interactions. Over-specification leads to brittle tests.

### Ignoring Parameters When Unimportant

If your test only cares about the number or order of calls but not arguments, omit the parameter list or use the wildcard matcher `_`:

```cpp
EXPECT_CALL(foo, Bar).Times(2);          // Expect Bar() called twice with any args
EXPECT_CALL(foo, Baz(_, _));              // Expect Baz() called with any two args
```

If you face an overloaded method and wish to avoid ambiguity, specify argument matchers or consider simplifying your mock interface.


## Cardinalities: Expressing How Many Times Calls Should Occur

Cardinalities determine the allowed or expected number of times a mock method is called. GoogleMock provides several built-in cardinalities in the `testing` namespace, enabling exact or flexible call counts.

| Cardinality         | Meaning                                        |
|---------------------|------------------------------------------------|
| `AnyNumber()`       | Zero or more calls allowed. No upper bound.    |
| `AtLeast(n)`        | The method is expected to be called at least n times. |
| `AtMost(n)`         | The method is expected to be called at most n times.  |
| `Between(m, n)`     | The method is expected to be called between m and n times (inclusive). |
| `Exactly(n)` or `n` | The method is expected to be called exactly n times. If n is 0, calls are disallowed. |

### Examples of Cardinalities

```cpp
using ::testing::AtLeast;
using ::testing::AtMost;
using ::testing::Between;
using ::testing::Exactly;
using ::testing::AnyNumber;

// Method called exactly once (default if Times() omitted)
EXPECT_CALL(mock, Foo()).Times(Exactly(1));

// Method called at least three times
EXPECT_CALL(mock, Bar()).Times(AtLeast(3));

// Method called between 2 and 4 times
EXPECT_CALL(mock, Baz()).Times(Between(2, 4));

// Method allowed to be called any number of times
EXPECT_CALL(mock, Quux()).Times(AnyNumber());

// Method must never be called
EXPECT_CALL(mock, Disconnect()).Times(0);
```

### Cardinality Behavior

- If `Times()` is omitted, GoogleMock infers the count from the presence of `.WillOnce()` and `.WillRepeatedly()`:
  - No `.WillOnce()` or `.WillRepeatedly()` means `Times(1)`.
  - *n* `.WillOnce()`s with no `.WillRepeatedly()` means `Times(n)` calls.
  - *n* `.WillOnce()`s and one `.WillRepeatedly()` means `Times(AtLeast(n))`.
- If you specify `Times()` explicitly, GoogleMock will enforce the bound precisely.


## Order of Calls: Sequencing and Prerequisites

In interaction-based testing, ordering can be critically important. GoogleMock provides tools to express **strict ordering** and **partial ordering** easily.

### Strict Ordering Using `InSequence`

Wrap your expectations in an `InSequence` block to enforce that calls happen in that exact order:

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
  EXPECT_CALL(mock, ThirdCall());
}
```
If the calls happen out of order, the test fails immediately, allowing you to catch order violations precisely.

### Partial Ordering With `InSequence` and `After`

For more complex scenarios, order doesn't have to be total—some calls must happen before others, but others can be unordered.

- Use the `.InSequence(Sequence&)` clause for grouping expectations into sequences with partial order.
- Use `.After(Expectation or ExpectationSet)` for explicit partial ordering, stating that a call should only happen after other calls.

Example of partial order with sequences:

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Init()).InSequence(s1, s2);
EXPECT_CALL(mock, Step1()).InSequence(s1);
EXPECT_CALL(mock, Step2()).InSequence(s2);
EXPECT_CALL(mock, Finish()).InSequence(s1, s2);
```

This expresses `Init()` must happen before the other steps, and `Finish()` must come after both sequences.


## Mocking Behavior Regarding Unexpected and Uninteresting Calls

GoogleMock distinguishes **uninteresting calls**—calls to mock methods without expectations set—from **unexpected calls**—calls that do not match any specified expectation.

### Default Behavior

- **Uninteresting calls** generate warnings but do not fail tests by default.
- **Unexpected calls** always cause test failures.

### Mock Behavior Modifiers

You can control how uninteresting calls are handled using mock behavior wrappers:

| Mock Type      | Behavior on Uninteresting Calls                |
|---------------|------------------------------------------------|
| `NaggyMock<T>` (default)  | Prints warnings (naggy behavior).
| `NiceMock<T>`              | Suppresses warnings.
| `StrictMock<T>`            | Treats uninteresting calls as errors.

### Suppressing Unexpected Warnings

To avoid noise, prefer `NiceMock` for mocks where you don't care about all calls, and reserve `StrictMock` for critical paths.


## Advanced: Retiring Expectations

By default, expectations are "sticky" and remain active after being saturated, causing repeated calls to fail. You can use `.RetiresOnSaturation()` to **automatically retire** an expectation once it has fulfilled its invocation count.

Example:

```cpp
EXPECT_CALL(mock, Foo(7))
    .Times(2)
    .RetiresOnSaturation();
```

The third call to `Foo(7)` would then fall through to other expectations or become an error, depending on your setup.


## Practical Examples

### Expecting an Exact Number of Calls

```cpp
EXPECT_CALL(mock, Connect())
    .Times(Exactly(3))
    .WillRepeatedly(Return(true));
```
The test will fail if `Connect()` is called fewer or more than three times.

### Allowing Any Number of Calls

```cpp
EXPECT_CALL(mock, Ping())
    .Times(AnyNumber())
    .WillRepeatedly(Return(true));
```
The method may be called any number of times, including none.

### Expecting Calls in Order

```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, Step1());
  EXPECT_CALL(mock, Step2());
}
```
Calls must be in order: `Step1()` then `Step2()`.

### Partial Order with Sequences

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Init()).InSequence(s1, s2);
EXPECT_CALL(mock, Load()).InSequence(s1);
EXPECT_CALL(mock, Save()).InSequence(s2);
EXPECT_CALL(mock, Shutdown()).InSequence(s1, s2);
```
`Init` happens first, then `Load` and `Save` can happen in any order, and finally `Shutdown`.

### Disallowing Calls

```cpp
EXPECT_CALL(mock, Delete()).Times(0);
```
Fails the test if `Delete()` is ever called.

### Defining Behavior with `WillOnce` and `WillRepeatedly`

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));

// Returns 10 on first call, 20 on second, 30 thereafter
```


## Troubleshooting Common Issues

- **Unexpected Mock Function Call**: Occurs when a call does not match any `EXPECT_CALL()` expectation. Fix by adding or correcting expectations.
- **Mock Function Called More Times Than Expected**: The call count exceeds the upper bound of `Times()`. Adjust your cardinality or inspect your test logic.
- **Warnings About Uninteresting Calls**: If warnings are noisy, consider using `NiceMock` to suppress or add `EXPECT_CALL(...).Times(AnyNumber())` for methods you want to ignore explicitly.
- **Order Violations in Sequences**: Ensure calls happen following `.InSequence()` or `.After()` order constraints.


## Summary

Call expectations and cardinalities enable you to harness the full verifying power of GoogleMock. By combining precise call counts, argument matching, and ordered sequences, you create robust tests that ensure your code interacts with its dependencies exactly as intended. Understanding uninteresting versus unexpected calls and managing mock strictness levels allows you to tune your tests for both correctness and maintainability.

---

## Further Reading and Related Documentation

- [Creating and Using Mocks](../api_reference/mocking_and_matchers/creating_and_using_mocks) — Learn how to define and instantiate mocks.
- [Matchers and Custom Matchers](../api_reference/mocking_and_matchers/matchers_and_custom_matchers) — Guide on argument matching.
- [Strict, Nice, and Naggy Mocks](../guides/gmock-mocking-patterns/controlling-mock-behavior) — Detailed explanation on mock behavior modifiers.
- [Actions and Side Effects](../api_reference/mocking_and_matchers/actions_and_side_effects) — Define mock method behaviors.
- [Mocking Best Practices and Common Patterns](../guides/gmock-mocking-patterns/best-practices-mocking) — Tips for maintainable mocks.

For a conceptual overview, see the [Fundamental Concepts](../../overview/core-concepts-and-capabilities/fundamental-concepts) and practical anecdotes in the [gMock Cookbook](../../docs/gmock_cook_book.md).

---

## Key API and Functions

```cpp
using ::testing::AtLeast;
using ::testing::AtMost;
using ::testing::Between;
using ::testing::Exactly;
using ::testing::AnyNumber;
using ::testing::Sequence;
using ::testing::InSequence;
using ::testing::Expectation;
using ::testing::ExpectationSet;
using ::testing::NiceMock;
using ::testing::StrictMock;
using ::testing::_;

EXPECT_CALL(mock, MethodName(args...))
    .Times(AtLeast(3))   // Cardinality
    .InSequence(seq)     // Ordering
    .WillOnce(Return(5)) // Behavior
    .WillRepeatedly(Return(10));

// Creating and using sequences
Sequence s1, s2;
EXPECT_CALL(mock, Foo()).InSequence(s1);
EXPECT_CALL(mock, Bar()).InSequence(s2);
EXPECT_CALL(mock, Baz()).InSequence(s1, s2);

// Chaining After
Expectation e1 = EXPECT_CALL(mock, Init());
EXPECT_CALL(mock, Run()).After(e1);
```

---

## Diagram: Call Expectation Matching Flow

```mermaid
flowchart TD
  A[Call to Mock Method] --> B[Search Expectations in Reverse Order]
  B -->|No Match| C[Uninteresting Call?
(with no EXPECT_CALL)]
  C -->|Yes| D[Perform Default Action + Warning]
  C -->|No| E[Unexpected Call
(Error Reported)]
  B -->|Matched Expectation| F[Check Call Count against Cardinality]
  F -->|Saturation Reached| G[If .RetiresOnSaturation(), retire expectation]
  F --> H[Perform Next Action (WillOnce or WillRepeatedly)]
  H --> I[Return Action Result]
```

This flow explains how GoogleMock processes each call to mocked methods, matching expectations, enforcing cardinalities, and managing behaviors for unexpected or uninteresting calls.
