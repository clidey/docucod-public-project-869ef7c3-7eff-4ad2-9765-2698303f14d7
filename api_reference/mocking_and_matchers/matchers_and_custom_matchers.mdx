---
title: "Matchers and Custom Matchers"
description: "Complete matcher library reference, including standard matchers for values, containers, strings, and user-defined matchers. Shows how to compose matchers and employ them in setting call expectations and argument validation within mocks."
---

# Matchers and Custom Matchers

This page provides a complete reference to GoogleMock's matcher library, which offers an extensive set of standard matchers for values, containers, strings, and user-defined types. It guides you on composing matchers and using them to set call expectations and validate arguments within mocks, thereby making your unit tests expressive, precise, and maintainable.

---

## Introduction to Matchers

Matchers in GoogleMock are predicates that determine whether a given value meets certain criteria. They are fundamental for specifying expectations on mock method calls and writing rich assertions.

- **Standard Matchers:** Cover simple value comparisons, container contents, string properties.
- **Parameterized Matchers:** Accept arguments to define custom matching logic (e.g., `Gt(5)` for "greater than 5").
- **User-Defined Matchers:** Created with macros or custom classes for bespoke matching needs.
- **Composite Matchers:** Combine multiple matchers to form complex conditions (e.g., `AllOf()`, `AnyOf()`).

Matchers improve test accuracy by verifying that arguments not only appear but also satisfy specified constraints.

## Core Value Matchers

GoogleMock provides straightforward matchers for common relational operations.

| Matcher | Matches When             | Description Example                  |
|---------|-------------------------|------------------------------------|
| `Eq(x)` | Equal to `x`             | `EXPECT_CALL(mock, Foo(Eq(10)));`   |
| `Ne(x)` | Not equal to `x`         | `EXPECT_CALL(mock, Foo(Ne(0)));`    |
| `Lt(x)` | Less than `x`            | `EXPECT_CALL(mock, Foo(Lt(5)));`    |
| `Le(x)` | Less than or equal to `x`| `EXPECT_CALL(mock, Foo(Le(3)));`    |
| `Gt(x)` | Greater than `x`         | `EXPECT_CALL(mock, Foo(Gt(7)));`    |
| `Ge(x)` | Greater than or equal to `x`| `EXPECT_CALL(mock, Foo(Ge(2)));` |

### Wildcard Matcher

- `_` matches any value of any type, useful when the argument value is unimportant:

```cpp
EXPECT_CALL(mock, Reset(_));  // Matches any argument.
```

### Any Type Matcher

- `A<T>()` or `An<T>()` matches any value of type `T`. Useful for clarifying arg types:

```cpp
EXPECT_CALL(mock, Process(A<int>()));
```

## Container Matchers

To assert conditions on container arguments, GoogleMock provides container-aware matchers:

- `ElementsAre(e1, e2, ..., en)`: Matches if the container has exactly `n` elements matching each matcher in order.

- `UnorderedElementsAre(e1, e2, ..., en)`: Matches if the container has exactly `n` elements matching each matcher in any order.

- `ElementsAreArray(array_or_container)`: Matches if the container elements match those in the given sequence in order.

- `UnorderedElementsAreArray(array_or_container)`: Same as `ElementsAreArray` but ignores order.

- `Contains(m)`: Container has at least one element matching matcher `m`.

- `Each(m)`: All elements in the container satisfy matcher `m`.

- `SizeIs(size_matcher)`: Container's size matches `size_matcher`.

- `IsEmpty()`: Matches empty containers or strings.

- `Pointwise(pair_matcher, rhs_container)`: Matches containers of equal size where each element of the left matches the corresponding element in the right according to `pair_matcher`.

- `UnorderedPointwise(pair_matcher, rhs_container)`: Like `Pointwise` but order doesn't matter.

### Examples

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _, 5)));   // 4 elements, specific expected positions
EXPECT_CALL(mock, Bar(UnorderedElementsAre(3, 2, 1)));  // Elements in any order
EXPECT_CALL(mock, Baz(Contains(Gt(10))));               // At least one element > 10
EXPECT_CALL(mock, Quux(Each(Ne(0))));                   // No element equals 0
```

## String Matchers

Matching strings is common and GoogleMock offers powerful string matchers that understand C strings, `std::string`, and wide strings (if supported).

- `StrEq(str)`: Matches strings exactly equal to `str`.

- `StrNe(str)`: Matches strings not equal to `str`.

- `StrCaseEq(str)`: Case-insensitive equality.

- `StrCaseNe(str)`: Case-insensitive inequality.

- `HasSubstr(substring)`: Matches strings containing `substring`.

- `StartsWith(prefix)`: Matches strings starting with `prefix`.

- `EndsWith(suffix)`: Matches strings ending with `suffix`.

- `MatchesRegex(regex)`: Matches string fully matching the regex.

- `ContainsRegex(regex)`: Matches string containing a substring matching the regex.

### Examples

```cpp
EXPECT_CALL(mock, Greet(StrEq("hello")));
EXPECT_CALL(mock, Greet(HasSubstr("world")));
EXPECT_CALL(mock, Filename(EndsWith(".txt")));
EXPECT_THROW(foo, ThrowsMessage<std::runtime_error>(ContainsRegex("timeout")));
```

## Composite Matchers

Matchers can be combined to express complex logic:

- `AllOf(m1, m2, ...)`: Succeeds only if all sub-matchers succeed.

- `AnyOf(m1, m2, ...)`: Succeeds if any of the sub-matchers succeed.

- `Not(m)`: Logical negation of matcher `m`.

- `Conditional(cond, m_true, m_false)`: Uses `m_true` if `cond` is true, else `m_false`.

These combinators enable the creation of rich boolean expressions for matching.

### Example

```cpp
EXPECT_CALL(mock, Foo(AllOf(Gt(0), Lt(10))));  // Argument > 0 and < 10
EXPECT_CALL(mock, Bar(AnyOf(Eq(1), Eq(2), Eq(3))));  // Argument is 1, 2, or 3
EXPECT_CALL(mock, Baz(Not(StrEq("skip"))));  // Argument is not "skip"
```

## Matching Members and Properties

Sometimes, you want to verify certain parts of an object passed by reference or pointer.

- `Field(&Class::field, matcher)`: Matches if the object’s member `field` matches `matcher`.

- `Property(&Class::method, matcher)`: Matches if calling `method()` on the object returns a value matching `matcher`.

Both support providing field or property name strings to improve error messages.

### Example

```cpp
struct Foo { int id; std::string name() const; };
EXPECT_CALL(mock, Process(Field(&Foo::id, Ge(10))));  // Foo.id >= 10
EXPECT_CALL(mock, Process(Property(&Foo::name, StartsWith("John"))));
```

You can also match members or properties of pointed-to objects:

```cpp
EXPECT_CALL(mock, Process(Pointee(Field(&Foo::id, Eq(5)))));
```

## Pointer-Related Matchers

GoogleMock supports matching pointers with special considerations:

- `IsNull()`: Matches any NULL raw or smart pointer.

- `NotNull()`: Matches any non-NULL raw or smart pointer.

- `Ref(var)`: Matches any argument that is a reference to the given variable.

- `Pointee(m)`: Matches a pointer if it points to an object matching matcher `m`.

- `Pointer(m)`: Matches a pointer itself (not pointee) with matcher `m`.

- `Address(m)`: Matches an object if its address matches matcher `m`.

- `WhenDynamicCastTo<T>(m)`: Matches a pointer or reference if `dynamic_cast<T>` succeeds and the result matches `m`. Requires RTTI support.

### Examples

```cpp
int x = 5;
EXPECT_CALL(mock, Update(Ref(x)));
int* ptr = ...;
EXPECT_CALL(mock, Update(Pointee(Eq(42))));
EXPECT_CALL(mock, Create()).WillOnce(ReturnNew<Foo>());
```

## Writing Custom Matchers

If standard matchers don’t meet your needs, GoogleMock lets you easily create custom matchers.

### Using `MATCHER` and `MATCHER_P` Macros

Define custom matchers with this macro family:

```cpp
MATCHER(Name, "Description") { 
  // `arg` is the value being matched
  return /* boolean condition using arg */;
}

MATCHER_P(HasValue, value, "Matches if abs(arg) == value") {
  return std::abs(arg) == value;
}
```

These macros generate usable matchers you can pass anywhere a matcher is expected.

### Customizing the Description

In the matcher body, you can provide a bool variable `negation` to customize messages depending on whether the matcher is negated.

You can also stream additional info to `result_listener` to give detailed match failure explanations.

### Defining Matcher Classes

For more control and reuse, define a matcher as a class implementing:

- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Then write a factory function returning `testing::Matcher<T>` of your class.

### Example

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;
  explicit DivisibleBy7Matcher(int divisor) : divisor_(divisor) {}
  bool MatchAndExplain(int n, MatchResultListener* listener) const {
    if (n % divisor_ == 0) return true;
    if (listener) *listener << "the remainder is " << n % divisor_;
    return false;
  }
  void DescribeTo(std::ostream* os) const { *os << "is divisible by " << divisor_; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is not divisible by " << divisor_; }
 private:
  const int divisor_;
};

Matcher<int> DivisibleBy7() { return Matcher<int>(new DivisibleBy7Matcher(7)); }

EXPECT_THAT(21, DivisibleBy7());
```

## Parameterized Matchers

You can create matchers with parameters using `MATCHER_P`, `MATCHER_P2`, ..., up to `MATCHER_P10`.

For example:

```cpp
MATCHER_P(InRange, range, "") {
  return arg >= range.first && arg <= range.second;
}
EXPECT_THAT(value, InRange(std::make_pair(5, 10)));
```

## Useful Helper Matchers and Patterns

- Use `Truly(predicate)` to create a matcher from any unary predicate.
- Use logical combinations like `AllOf()`, `AnyOf()`, and `Not()` to compose matchers.
- Use `SafeMatcherCast<T>()` to cast matchers safely between compatible types.
- Use `DescribeMatcher<T>(m, negation)` to get human-friendly descriptions.

## Working with Tuples, Pairs, and Structured Bindings

GoogleMock provides matchers to work with tuples and structs piecewise:

- `FieldsAre(m1, m2, ..., mn)`: Matches aggregate or tuple-like objects piecewise.
- `Pair(m1, m2)`: Matches `std::pair` where `.first` and `.second` match respectively.
- `Key(m)`: Matches a pair's `.first` against `m`.

### Examples

```cpp
auto pair = std::make_pair(5, "foo");
EXPECT_THAT(pair, Pair(Eq(5), StartsWith("f")));
EXPECT_THAT(pair, Key(Ge(3)));
std::tuple<int, std::string> tup(1, "hi");
EXPECT_THAT(tup, FieldsAre(Eq(1), HasSubstr("h")));
```

## Error Explanation and Descriptions

GoogleMock matchers provide detailed explanation messages on failures, using:

- `MatchAndExplain()` to return bool and optionally write why the match failed.
- `DescribeTo()` and `DescribeNegationTo()` to produce human-readable matcher descriptions.

When assertions or expectations fail, these descriptions help you diagnose what went wrong.

## Practical Tips and Best Practices

- Use built-in matchers wherever possible for clarity and better diagnostics.
- When matching containers, prefer `ElementsAre` for ordered checks and `UnorderedElementsAre` for unordered.
- Use `Pointee()` to check the value pointed to by a pointer rather than the pointer itself.
- When writing custom matchers, ensure they are side-effect free and purely functional.
- Use `With()` clause in `EXPECT_CALL` or `ON_CALL` to match all arguments as a tuple for complex logic.

## Troubleshooting Common Matcher Issues

- _Unexpected Calls:_ Ensure your expectations cover the arguments that will be passed.
- _Type Mismatch:_ Use `SafeMatcherCast<T>()` to fix safe mismatched types in matchers.
- _Ambiguous Overloads:_ Specify exact matcher types or use `Const()` to resolve.
- _Uninteresting Calls:_ Use `NiceMock<>` to suppress unwanted warnings.
- _Matcher Descriptions Too Generic:_ Customize descriptions to make failure messages clearer.

## Summary

By mastering matchers, including standard, composite, and custom types, you control how GoogleMock validates interactions with your mocks. Well-crafted matchers yield expressive tests and meaningful failures.

---

For more details, examples, and reference on defining custom matchers and using them in expectations, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and explore related pages:

- [Creating and Using Mocks](/api_reference/mocking_and_matchers/creating_and_using_mocks)
- [Actions and Side Effects](/api_reference/mocking_and_matchers/actions_and_side_effects)
- [Call Expectations and Cardinalities](/api_reference/mocking_and_matchers/call_expectations_and_cardinalities)

See also the related overview content:
- [Feature Overview](/overview/core-concepts-and-capabilities/feature-overview)
- [Writing and Running Your First Test](/guides/gtest-core-workflows/writing-and-running-tests)
- [Essential Assertions and How to Use Them](/guides/gtest-core-workflows/using-assertions)

---

*This documentation is part of the GoogleTest / GoogleMock API Reference.*