---
title: "Mock Object Creation"
description: "Master the process of designing and instantiating mock objects with GoogleMock, including using the MOCK_METHOD macro, handling method signatures, and integrating mocks into your tests."
---

# Mock Object Creation

Master the process of designing and instantiating mock objects with GoogleMock, including using the `MOCK_METHOD` macro, handling method signatures, and integrating mocks into your tests.

---

## Introduction to Mock Object Creation

Creating mock objects is a fundamental step in writing interaction-based tests with GoogleMock. This page guides you through defining mock classes, using the `MOCK_METHOD` macro for mocking methods, managing method signatures including qualifiers, and effectively integrating these mocks into your test suites.

By the end of this page, you will confidently define mock classes that emulate real interfaces, specify behaviors and expectations on mock methods, and avoid common pitfalls in mock creation.

---

## Defining Mock Classes with `MOCK_METHOD`

GoogleMock’s `MOCK_METHOD` macro is the primary tool to declare mock methods inside mock classes. Its usage transforms virtual method declarations into mocked methods that can intercept and simulate behavior during testing.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers...));
```

- **ReturnType**: The return type of the method.
- **MethodName**: Name of the method to mock.
- **Args**: Parenthesized list of argument types (use extra parentheses if the list contains commas).
- **Qualifiers** *(optional)*: Method qualifiers such as `const`, `override`, `noexcept`, calling conventions, or reference qualifiers.


### Important Rules

- Always place `MOCK_METHOD` declarations in the **public** section of the mock class, even if the original method is `protected` or `private`. This is necessary for GoogleMock to access and manipulate the mocks.
- If the method being mocked is `virtual` in the base class, add the `(override)` qualifier to ensure correctness and clarity.
- For `const` methods, use `(const, override)`.
- If your method has a specific calling convention (for example on Windows), specify it with `Calltype(CONVENTION)`.
- If the method includes reference qualifiers, specify them via `ref(&)` or `ref(&&)`.


### Examples

#### Simple Mock Methods

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

#### Handling Types with Commas

When the return type or argument type contains commas (e.g., STL containers or pairs), surround the type with an extra set of parentheses or use type aliases:

```cpp
class MyMock {
 public:
  // Using parentheses
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

  // Using type aliases
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```


#### Mocking Overloaded Methods

Mock each overload explicitly, ensuring right qualifiers:

```cpp
MOCK_METHOD(int, Add, (Element x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));
MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

If you don’t mock all overloads, bring others into scope with `using BaseClass::MethodName;`


#### Mocking Class Templates

```cpp
template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```


#### Mocking Non-virtual Methods

GoogleMock supports mocking non-virtual methods by defining unrelated mock classes with matching method signatures. The selection of mock vs real class must be done at compile time.

```cpp
class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```


### Best Practices for Mock Class Placement

- Place mock class declarations in **test-only headers** corresponding to the interface’s owning package to minimize maintenance overhead.
- Avoid mocking classes you don’t own directly. If necessary, define interface adapters or thin wrappers.
- Use type aliases to simplify complicated mock definitions and improve readability.

---

## Using Mocks Within Tests

Once the mock is defined, use it in your tests as follows:

1. **Create** the mock object.
2. **Specify expectations** on method calls via `EXPECT_CALL`.
3. **Provide default behaviors** with `ON_CALL` if needed.
4. **Exercise** your code under test.
5. Let GoogleMock **verify** expectations automatically upon mock destruction.

Example:

```cpp
using ::testing::Return;  // For readability

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
};

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown()).Times(1);

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```


#### Tips
- Always set expectations **before** exercising the code to avoid undefined behavior.
- Use matcher placeholders like `_` to avoid over-specifying method arguments.
- Control mock behavior granularity by combining `ON_CALL` for defaults and `EXPECT_CALL` for verifications.

---

## Handling Qualifiers and Complex Signatures

GoogleMock allows mocking methods with any combination of qualifiers:

- `const`
- `override`
- `noexcept`
- Calling convention via `Calltype()`
- Reference qualifiers `ref(&)` or `ref(&&)`

Example:

```cpp
MOCK_METHOD(bool, Foo, (int x, int y), (const, override, noexcept, Calltype(STDMETHODCALLTYPE), ref(&)));
```


---

## Common Pitfalls & Troubleshooting

### Problems with Commas in Types

Remember to wrap types containing commas in extra parentheses or use type aliases.

### Access Specifiers

Mock methods must always be `public` even if the original method is `protected` or `private`.

### Overloaded Methods Ambiguity

If you omit argument specification for overloaded methods, compilation will fail due to ambiguity. Specify argument matchers explicitly.

### Virtual Destructors

Ensure your base class has a virtual destructor to avoid undefined behavior and heap issues when mocking.

### Uninteresting Calls

Mock methods invoked without an `EXPECT_CALL` will generate warnings. Use `NiceMock` to suppress, or add expectations if calls are intended.

### Mock Object Lifetime

Mock objects verify expectations upon destruction. If allocated on the heap and managed externally, use `Mock::VerifyAndClearExpectations()` explicitly.

---

## Advanced Techniques

### Delegating Calls to Fake or Real Objects

Mocks can delegate default behavior to an existing fake or real implementation using `ON_CALL`. This lets you validate interactions yet retain actual behavior.

### Mocking Private or Protected Methods

It is supported by declaring the mock method `public` in the mock class despite the base class access.

### Handling Move-Only Types

Mock methods can accept or return move-only types with `MOCK_METHOD`. When returning, use lambdas or direct `WillOnce` with factory methods to avoid move errors.

### Customizing Default Actions and Expectations

Use `ON_CALL` for setting default behavior without expectations and `EXPECT_CALL` to specify expected calls and their behavior.

### Controlling Call Order

Use `InSequence` and `After` to specify call ordering of mock methods for sophisticated test scenarios.


---

## Summary

Mastering mock object creation with GoogleMock empowers you to write precise and maintainable unit tests by simulating dependencies effectively. Understanding the `MOCK_METHOD` macro and its qualifiers is crucial for correctly defining mock classes and avoiding common issues. Integrate mocks seamlessly by setting expectations and behaviors ahead of exercising production code, and leverage advanced techniques for complex scenarios.

---

## Related Documentation Links

- [MOCK_METHOD Macro Details](https://google.github.io/googletest/reference/mocking.html#MOCK_METHOD)
- [Using Mocks and Setting Expectations](https://google.github.io/googletest/gmock_for_dummies.html#using-mocks-in-tests)
- [Mocking Best Practices Guide](/guides/scenarios-patterns/mocking-best-practices)
- [Matchers Reference](reference/matchers.md)
- [Actions Reference](reference/actions.md)
- [Understanding Uninteresting vs Unexpected Calls](https://google.github.io/googletest/gmock_cook_book.html#uninteresting-vs-unexpected)

---

## Next Steps

- Learn how to set behavioral expectations and actions in [`EXPECT_CALL` and `ON_CALL`](./expectations_and_actions.md).
- Explore custom argument matching strategies in [Argument Matching](./argument_matching.md).
- Understand mock strictness modes in [Strict, Naggy, and Nice Mocks](./strictness_and_nice_mocks.md).
- Review `gMock Cookbook` for recipes and usage patterns.

---

<Check>
Remember: Always put mock method declarations (`MOCK_METHOD`) in the public section of the mock class, cater for method qualifiers appropriately, and set expectations **before** invoking methods in tests.
</Check>

<Note>
If you encounter compilation errors with overloaded methods, specify argument matchers explicitly or reduce overload ambiguity using `using` declarations.
</Note>

<Tip>
Use type aliases to simplify complex mock method declarations involving templates or nested types.
</Tip>

<Warning>
Mocking non-virtual methods requires special design consideration. Use alternate techniques such as template-based dependency injection if needed.
</Warning>

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-spec-builders.h", "range": "1-344"}]} />
<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/mocking.md", "range": "0-653"}]} />
<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_cook_book.md", "range": "0-417"}]} />
