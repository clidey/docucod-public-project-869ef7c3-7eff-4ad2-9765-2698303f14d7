---
title: "Actions and Side Effects"
description: "Reference for defining return values, throwing exceptions, and performing side effects with mock methods. Explains the ACTION macros, chained actions, and advanced templates enabling dynamic behavior during mock invocation."
---

# Actions and Side Effects Reference

This reference page details the full set of built-in actions provided by GoogleMock to specify what a mock function should do when invoked. Actions range from returning values and throwing exceptions to assigning values and invoking callable arguments. All actions reside within the `::testing` namespace.

---

## Returning Values

Actions that control the return value of a mock function call:

| Action                      | Description                                                                                              |
|----------------------------|----------------------------------------------------------------------------------------------------------|
| `Return()`                 | Returns from a `void` mock function.
| `Return(value)`            | Returns the given `value`. If the type of `value` differs from the mock function's return type, conversion occurs at the time the expectation is set, not at execution.
| `ReturnArg<N>()`           | Returns the `N`-th (0-based) argument from the mock function.
| `ReturnNew<T>(a1, ..., ak)`| Returns a newly allocated object `new T(a1, ..., ak)` on every call.
| `ReturnNull()`             | Returns a null pointer.
| `ReturnPointee(ptr)`       | Returns the value pointed to by `ptr` at execution time.
| `ReturnRef(variable)`      | Returns a reference to an existing `variable`.
| `ReturnRefOfCopy(value)`   | Returns a reference to a copy of `value`, which lives as long as the action.
| `ReturnRoundRobin({a1, ..., ak})` | Returns each element in the list in turn, wrapping around after the last.


## Side Effect Actions

Side effect actions allow a mock method to modify its arguments or environment when called, without returning a value or in addition to it.

| Action                        | Description                                                                                     |
|------------------------------|-------------------------------------------------------------------------------------------------|
| `Assign(&variable, value)`   | Assigns `value` to `variable`.
| `DeleteArg<N>()`             | Deletes the `N`-th (0-based) argument (must be a pointer).
| `SaveArg<N>(pointer)`        | Saves the `N`-th argument by copy-assignment into `*pointer`.
| `SaveArgByMove<N>(pointer)`  | Saves the `N`-th argument by move-assignment into `*pointer`.
| `SaveArgPointee<N>(pointer)` | Saves the value pointed to by the `N`-th argument into `*pointer`.
| `SetArgReferee<N>(value)`   | Assigns `value` to the object referenced by argument `N`.
| `SetArgPointee<N>(value)`   | Assigns `value` to the object pointed to by argument `N`.
| `SetArgumentPointee<N>(value)` | Deprecated alias for `SetArgPointee<N>(value)`.
| `SetArrayArgument<N>(first, last)` | Copies elements from range `[first, last)` into the array or iterator pointed to by argument `N`.
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` and returns `value`.
| `Throw(exception)`           | Throws the given exception (any copyable value). Available since v1.1.0.


## Using Callables as Actions

Any callable — functions, functors, lambdas — can be used as actions to define dynamic behaviors.

| Action                                              | Description                                                                                                                |
|----------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------|
| `f`                                                | Invokes callable `f` with the mock function's arguments.                                                                   |
| `Invoke(f)`                                        | Invokes free/static function or functor `f` with the mock function's arguments.                                             |
| `Invoke(object_pointer, &class::method)`          | Invokes a member method on the given object pointer with mock function's arguments.                                         |
| `InvokeWithoutArgs(f)`                             | Invokes callable `f` that takes no arguments.
| `InvokeWithoutArgs(object_pointer, &class::method)` | Invokes member method on object pointer, method takes no arguments.
| `InvokeArgument<N>(arg1, arg2, ..., argk)`         | Invokes the `N`-th argument (callable) of the mock function with specified arguments.


### Notes on Callables in Invoke

- You can declare unused parameters as `Unused` to conveniently ignore unneeded arguments.
- `Invoke(callback)` and `InvokeWithoutArgs(callback)` take ownership of the callback; it must outlive the action.
- To pass an argument by reference in `InvokeArgument<N>`, wrap it with `std::ref()` to avoid copying.

```cpp
using ::testing::Invoke;
double Distance(Unused, double x, double y) { return sqrt(x*x + y*y); }
EXPECT_CALL(mock, Foo("Hi", _, _)).WillOnce(Invoke(Distance));
```

```cpp
EXPECT_CALL(mock, DoWork(_))
    .WillOnce(InvokeArgument<2>(5, std::string("Hi"), std::ref(foo)));
```


## Default and Composite Actions

| Action               | Description                                                                                                                             |
|---------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| `DoDefault()`       | Performs the default action as specified by `ON_CALL()` or the built-in default. Cannot be used inside composite actions (runtime error).

Composite actions allow chaining and argument manipulation:

| Action                           | Description                                                                                                                                |
|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)`        | Performs all actions in order `a1` to `an` for each call; the return value is the return from `an`. The first `n-1` actions must return void and get a readonly view of the arguments.
| `IgnoreResult(a)`               | Runs action `a` but ignores its return value; `a` must not return void.
| `WithArg<N>(a)`                | Passes only the `N`-th argument of the mock function to the action `a`.
| `WithArgs<N1, N2, ..., Nk>(a)`| Passes selected arguments from the mock function by index to action `a`.
| `WithoutArgs(a)`               | Runs the action `a` with no arguments.


## Defining Custom Actions Using Macros

For cases where built-in or callable actions are not sufficient, GoogleMock provides macros to define custom actions.

| Macro                           | Description                                                                                       |
|---------------------------------|--------------------------------------------------------------------------------------------------|
| `ACTION(name)`                 | Defines an action `name()` returning a value (or void). You can refer to mock arguments as `arg0`, `arg1`, and so on.
| `ACTION_P(name, p)`            | Defines a parameterized action `name(p)`, where `p` is a parameter available inside the action body.
| `ACTION_Pk(name, p1, ..., pk)`| Defines a parameterized action with multiple parameters `p1` through `pk`.

Example:

```cpp
ACTION(Sum) { return arg0 + arg1; }
...
EXPECT_CALL(mock, Foo(_, _)).WillOnce(Sum());
```

Parameterized action:

```cpp
ACTION_P(Plus, n) { return arg0 + n; }
...
EXPECT_CALL(mock, Foo(_)).WillOnce(Plus(5));
```

These macros must be declared at namespace scope, not inside functions or classes.

## Additional Notes

- Actions passed to `EXPECT_CALL` or `ON_CALL` are *evaluated once* at the point of call, so any side effects or state dependent on runtime behavior must be handled carefully.
- Composition of actions via `DoAll` enables combining side effects and return values elegantly.
- When returning references from mock methods, use `ReturnRef()` or `ReturnPointee()` to refer to live values rather than copies.
- Use `InvokeArgument<N>` to call function-pointer or functor arguments passed into mocks.

---

For more examples and best practices, see the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html).

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/reference/actions.md", "range": "all"},{"path": "docs/gmock_cook_book.md", "range": "#Using-Actions"}]}/>