---
title: "Matchers Reference"
description: "Catalog of GoogleTest and GoogleMock matchers for validating test expectations. Covers built-in matchers, combinators, and how to extend with custom matchers, enabling more expressive and flexible test conditions."
---

# Matchers Reference

A comprehensive catalog of **GoogleTest** and **GoogleMock** matchers designed to validate test expectations effectively. This reference covers built-in matchers for primitive types, containers, pointers, strings, and more, combinators for logical composition, and instructions for extending GoogleMock with custom matchers. Mastering these matchers empowers you to write more expressive and flexible test conditions that precisely capture intent while easing debugging.

---

## Overview

Matchers are the cornerstone of GoogleMock's ability to observe and validate arguments passed to mocked functions. They enable tests to specify sophisticated conditions beyond simple equality, boosting test robustness and clarity. This page catalogues:

- The selection of built-in matchers shipped with GoogleTest/GoogleMock
- How to combine matchers logically for complex validations
- Techniques to create your own custom matchers for domain-specific needs

As a user, your focus is on describing *what* you expect in your tests, not how itâ€™s implemented internally. Matchers provide the declarative language for those expectations.

---

## 1. Basic Matchers

These matchers validate fundamental properties of values, pointers, and objects.

### Universal Matchers

- `_` or `A<T>()` or `An<T>()`
  - Matches *any* value of type `T`.
  - Useful as a wildcard when the argument value is not under test.

```cpp
EXPECT_CALL(mock_obj, Foo(_));         // Matches any argument
EXPECT_CALL(mock_obj, Bar(A<int>()));  // Also matches any int
```

### Equality Matchers

- `Eq(value)`
  - Matches an argument equal to `value` using `operator==`.
  - Implicit conversions of raw values to `Eq()` are supported.
- `Ne(value)`
  - Matches arguments not equal to `value`.
- `Ref(x)`
  - Matches a reference to the specific variable `x` (must be used with reference arguments).

```cpp
EXPECT_CALL(foo, Bar(Eq(42)));
EXPECT_CALL(foo, Baz(Ne("hello")));
EXPECT_CALL(foo, DoSomething(Ref(my_var)));
```

### Comparison Matchers

- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`
  - Match less-than, less-or-equal, greater-than, greater-or-equal conditions.

```cpp
EXPECT_CALL(mock, Increase(Ge(10)));
```

### Special Value Matchers

- `IsNull()` / `NotNull()`
  - Match pointer arguments that are null or non-null respectively.
- `IsNan()`
  - Matches floating-point arguments that are NaN.

### String Matchers

- `StrEq(str)` / `StrNe(str)`
  - Matches strings equal or not equal to `str` (case-sensitive). Supports `const char*`, `std::string`, and wide strings.
- `StrCaseEq(str)` / `StrCaseNe(str)`
  - Matches strings equal or unequal ignoring case.
- `HasSubstr(substr)`
  - Matches strings containing the specified substring.
- `StartsWith(prefix)` / `EndsWith(suffix)`
  - Matches string prefix and suffix respectively.

```cpp
EXPECT_CALL(mock, SetName(StrEq("Alice")));
EXPECT_CALL(mock, LogMessage(StartsWith("Error:")));
```

---

## 2. Container & Collection Matchers

GoogleMock supports rich matcher support for STL-style containers or native arrays.

- `IsEmpty()`
  - Matches empty containers or strings.
- `ElementsAre(...)`
  - Matches a container with elements matching the given matchers *in order*.
- `ElementsAreArray(...)`
  - Like `ElementsAre` but takes a container or array of matchers or values.
- `UnorderedElementsAre(...)`
  - Matches a container that contains the given elements in any order, with no extras.
- `UnorderedElementsAreArray(...)`
  - Like `UnorderedElementsAre` but takes a container or array.
- `Contains(matcher)`
  - Matches if any element in the container satisfies `matcher`.
- `Each(matcher)`
  - Matches if *every* element satisfies `matcher` (including in empty containers).
- `SizeIs(matcher)`
  - Matches containers where `.size()` satisfies the given matcher.
- `WhenSorted(matcher)`
  - Matches containers that, when sorted, satisfy the given matcher.
- `Pointwise(pair_matcher, rhs_container)`
  - Matches containers where each element and corresponding element in rhs_container satisfy `pair_matcher`.
- `UnorderedPointwise(pair_matcher, rhs_container)`
  - Like Pointwise, but order of elements does not matter.

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(set, Contains(Gt(10)));
EXPECT_THAT(map, Contains(Key(42)));
```

### Map/Sets Helper Matchers

- `Key(matcher)`
  - Matches an std::pair whose first element satisfies `matcher`.
- `Pair(first_matcher, second_matcher)`
  - Matches an std::pair whose first and second elements satisfy the respective matchers.

---

## 3. Matcher Combinators

Matchers can be combined logically to form more expressive conditions.

- `AllOf(m1, m2, ...)`
  - Matches if *all* of the given matchers match (logical AND).
- `AnyOf(m1, m2, ...)`
  - Matches if *any* of the given matchers match (logical OR).
- `Not(m)`
  - Matches if `m` does not match (logical NOT).
- `Truly(predicate)`
  - Matches if the unary predicate returns `true` (custom predicates).

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(0), Le(10))));
EXPECT_CALL(mock, Bar(Not(Eq(42))));
```

---

## 4. Advanced Matchers

### Field & Property Matchers

- `Field(&Class::member, matcher)`
  - Matches an object whose member variable satisfies `matcher`.
- `Property(&Class::getter, matcher)`
  - Matches an object whose getter method result matches `matcher`.

```cpp
EXPECT_THAT(foo, Field(&Foo::age, Ge(18)));
EXPECT_THAT(foo, Property(&Foo::Name, StrEq("Alice")));
```

### Pointer Matchers

- `Pointee(matcher)`
  - Matches pointers or smart pointers that point to values matched by `matcher`.
- `Pointer(matcher)`
  - Matches pointers (raw or smart) themselves matching `matcher`.

### Exception Matcher

- `Throws<T>()` or `Throws<T>(exception_matcher)`
  - Matches if a callable throws an exception of type T matching the optional matcher.

### Container Count Matchers

- `Contains(m).Times(cardinality)`
  - Matches if the number of elements matching `m` meets the cardinality condition.

### String Matching with Encodings

- `WhenBase64Unescaped(matcher)`
  - Matches strings that base64-unescape successfully and whose decoded contents match `matcher`.

---

## 5. Writing Custom Matchers

GoogleMock supports concise and expressive creation of your own matchers suited to your domain.

### MATCHER family macros

- `MATCHER(Name, Description) { ... }`
  - Defines a simple matcher named `Name`.
- `MATCHER_P(Name, param, Description) { ... }`
  - Defines a parameterized matcher.
- Supports up to `MATCHER_P10` for multiple params.

Inside the matcher body, use:

- `arg` for the value being matched
- `arg_type` for the type of `arg`
- `negation` and `result_listener` for custom message control

Example:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

### Matcher Classes

For more fine-grained control, implement a matcher class with:

- `bool MatchAndExplain(const T& value, std::ostream* os)`
- `void DescribeTo(std::ostream* os)`
- `void DescribeNegationTo(std::ostream* os)`

Wrap in a factory function returning `Matcher<T>`.

Custom matchers should be pure (no side effects) and provide clear messages to improve test diagnosability.

---

## 6. Best Practices & Tips

- Use matchers to specify *only* the necessary expectations for arguments.
- Prefer `ON_CALL` for setting default behaviors; use `EXPECT_CALL` when verifying that methods *are* called.
- Employ combinators (e.g., `AllOf`, `Not`) to reduce test duplication and clarify intent.
- Use `RetiresOnSaturation()` with sequences or repeated expectations to avoid brittle test failures.
- Define custom matchers using `MATCHER` macros for domain-specific validation with clear failure output.

---

## 7. Troubleshooting

- If your matcher expressions are ambiguous with overloaded methods, help the compiler select the correct overload (see gMock Cookbook).
- Excessive uninteresting call warnings? Consider using `NiceMock` to suppress them.
- If your test fails with an unexpected call, verify matcher argument expectations and order.

---

## 8. Related Documentation

- [Assertions Reference](../core_testing_apis/assertions_reference.md): how to integrate matchers in assertions.
- [Mocking Reference](../mocking_and_expectations/creating_mock_objects.md): creating and configuring mocks using matchers.
- [Actions Reference](../core_testing_apis/actions_reference.md): controlling mock behaviors.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): recipes and patterns for matchers and mocks.

Use this page as your central matchmaking station when building expressive, maintainable, and robust tests with GoogleTest and GoogleMock.

---

## 9. Example

```cpp
#include <gmock/gmock.h>
using ::testing::Ge;
using ::testing::Not;
using ::testing::StrEq;
using ::testing::_;

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
  MOCK_METHOD(std::string, GetName, (), (const, override));
};

TEST(CalculatorTest, UsesMatchers) {
  MockCalculator mock;

  EXPECT_CALL(mock, Add(Ge(0), _)) // First arg >= 0, second arg anything
      .Times(3)
      .WillRepeatedly(testing::Return(42));

  EXPECT_CALL(mock, GetName())
      .WillOnce(StrEq("CalcMock"));

  EXPECT_EQ(mock.Add(5, 10), 42);
  EXPECT_EQ(mock.GetName(), "CalcMock");
}
```
