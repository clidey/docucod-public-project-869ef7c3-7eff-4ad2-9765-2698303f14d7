---
title: "Defining Expectations & Cardinalities"
description: "Shows how to specify expected method calls on mocks—including order, argument matching, call count constraints, and default actions. Highlights ON_CALL and EXPECT_CALL usage, plus working with different cardinalities."
---

# Defining Expectations & Cardinalities

This reference page explains how to specify expected method calls on mocks in GoogleMock—including defining argument matchers, enforcing order, setting call count constraints, and managing default actions. It details the use of `ON_CALL` and `EXPECT_CALL` macros and shows how cardinalities control the number of calls expected. Understanding this is key to precisely controlling mock behavior and verifying interactions in your tests.

---

## Overview

Mock objects emulate real objects by specifying the behavior and expectations for method calls. This page helps you define what calls are expected, when they occur, with which arguments, how many times, and what actions they perform. The focus is on:

- **Argument Matching:** How to specify what argument values a method should be called with.
- **Call Count Constraints (Cardinalities):** How to control how many times a call is allowed or expected.
- **Ordering Expectations:** How to specify relative call order (sequences, partial order).
- **Default Behavior vs Expectations:** How to set default actions (`ON_CALL`) versus hard expectations (`EXPECT_CALL`).

---

## Specifying Expectations on Mock Methods

### The `EXPECT_CALL` Macro

Use `EXPECT_CALL(mock_object, method_name(matchers...))` to specify that a method on a mock object is expected to be called with arguments matching the given matchers. Setting expectations with `EXPECT_CALL` implies verification that the call will occur (or not, if count is zero).

Example:
```cpp
using ::testing::_;               // Wildcard matcher
using ::testing::Exactly;
using ::testing::Return;

EXPECT_CALL(mock_turtle, Forward(100))    // expects Forward(100) call
    .Times(Exactly(2))                     // exactly twice
    .WillRepeatedly(Return());             // do nothing (default)
```

**Key points:**
- You can omit matchers to accept any arguments for non-overloaded methods.
- The macro provides a rich, chainable syntax to refine the expectation.

### Modifiers on `EXPECT_CALL`

- `.With(multi_argument_matcher)` restricts the expectation to calls whose entire argument tuple matches the matcher.
- `.Times(cardinality)` specifies how many times the call is expected.
- `.InSequence(sequences...)` constrains calls into sequences to enforce order.
- `.After(expectations...)` specifies dependencies, such that the call is expected after other expectations are satisfied.
- `.WillOnce(action)` specifies behavior for individual calls.
- `.WillRepeatedly(action)` specifies behavior for all subsequent calls.
- `.RetiresOnSaturation()` makes the expectation inactive once its cardinality is saturated.

#### Example of Full Syntax
```cpp
using ::testing::_;
using ::testing::Sequence;
using ::testing::Return;
using ::testing::AtLeast;

Sequence seq;
EXPECT_CALL(mock, Init())
    .InSequence(seq)
    .Times(1)
    .WillOnce(Return(true));
EXPECT_CALL(mock, Run(_))
    .InSequence(seq)
    .Times(AtLeast(1))
    .WillRepeatedly(Return(42));
EXPECT_CALL(mock, Cleanup())
    .InSequence(seq)
    .Times(1);
```

This defines an ordered sequence where `Init()` is called once, then `Run()` called at least once with any argument, then `Cleanup()` once.

### Call Counts and Cardinalities

Cardinalities control how many calls are expected:

| Cardinality         | Meaning                                             |
|---------------------|-----------------------------------------------------|
| `AnyNumber()`       | Method can be called any number of times            |
| `AtLeast(n)`        | Expected to be called at least *n* times             |
| `AtMost(n)`         | Expected at most *n* times                            |
| `Between(m, n)`     | Expected between *m* and *n* times (inclusive)       |
| `Exactly(n)` or `n` | Expected exactly *n* times. 0 means the method should never be called |

If `.Times()` is omitted, it is inferred:
- No `WillOnce()` or `WillRepeatedly()` → `Times(1)`
- `n` `WillOnce()` and no `WillRepeatedly()` → `Times(n)`
- `n` `WillOnce()` and one `WillRepeatedly()` → `Times(AtLeast(n))`

### Action Clauses

- `.WillOnce(action)` defines behavior for a single expected call. Multiple `.WillOnce` clauses define a sequence of behaviors.
- `.WillRepeatedly(action)` defines behavior for all subsequent calls after `.WillOnce` clauses.

Example:
```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

Meaning: first call returns 1, second 2, others 3.

#### Best Practice Tip
Avoid side effects inside `WillOnce(Return(value))` because the return value is evaluated only once at setup time, not at call time. Use lambdas or `Invoke` for dynamic values.

### RetiresOnSaturation

Use `.RetiresOnSaturation()` to declare that when the expected number of calls is reached, the expectation is retired and no longer matches further calls, allowing subsequent expectations to match.

Example:
```cpp
EXPECT_CALL(mock, SetNumber(7))
    .Times(2)
    .RetiresOnSaturation();
EXPECT_CALL(mock, SetNumber(_))
    .Times(AnyNumber());
```
First two calls with 7 will match the first expectation, subsequent calls match the second.

---

## Setting Default Behavior with `ON_CALL`

Use `ON_CALL(mock_object, method_name(matchers...))` to define default behavior without specifying an expectation on the call count.

The syntax mirrors `EXPECT_CALL` but requires `.WillByDefault(action)` and optionally `.With(...)`.

Example:
```cpp
ON_CALL(mock_turtle, GetX())
    .WillByDefault(Return(10));
```

This means if the method is called without matching an `EXPECT_CALL` expectation, the call returns 10.

The default action is overridden by matching `EXPECT_CALL` actions if any.

---

## Argument Matching

Specify expected argument values or properties using matchers. Use `_` to accept any argument.

Example:
```cpp
EXPECT_CALL(mock, SetPosition(50, _));
```
Here, the first parameter must be 50, the second can be anything.

You can combine simple and complex matchers. For details, see the [Matchers Reference](reference/matchers.md).

---

## Ordering Calls

By default, expectations can match calls in any order.

### Enforcing Order with `InSequence`

Create an `InSequence` scoped object to ensure all expectations defined in its scope happen in order.

Example:
```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, Start());
  EXPECT_CALL(mock, Process());
  EXPECT_CALL(mock, Stop());
}
```

Calls must happen in order: `Start` &rarr; `Process` &rarr; `Stop`.

### Partial Ordering with Multiple Sequences

Use multiple `Sequence` objects with `.InSequence()` clauses on expectations to define partial orderings where some calls must occur before others, but some orders are unspecified.

Example:
```cpp
Sequence s1, s2;
EXPECT_CALL(mock, A()).InSequence(s1, s2);
EXPECT_CALL(mock, B()).InSequence(s1);
EXPECT_CALL(mock, C()).InSequence(s2);
```
Here, `A()` must happen before `B()` and `C()`, but `B()` and `C()` can be in any order.

### Dependence Ordering with `.After(...)`

Use `.After(expectations...)` to specify that one expectation must occur only after others are satisfied.

Example:
```cpp
Expectation e1 = EXPECT_CALL(mock, InitX());
Expectation e2 = EXPECT_CALL(mock, InitY());
EXPECT_CALL(mock, Describe()).After(e1, e2);
```
`Describe()` must happen after both `InitX()` and `InitY()`.


---

## Common Pitfalls and Best Practices

- **Over-specification:** Avoid expecting too many calls or too strict an order unless it captures real requirements — brittle tests are hard to maintain.
- **Use `ON_CALL` for default behavior:** This makes tests less fragile and focused on what calls truly matter.
- **Use wildcards `_` for arguments you don't care about:** Helps keep tests flexible.
- **Order your expectations carefully:** More specific expectations should be declared after broader catch-all ones.
- **Use `.RetiresOnSaturation()` when chaining `.WillOnce()` calls:** Ensures expectations don't incorrectly remain active.
- **For complex sequences, use `Sequence` or `.After()` for clarity and precision.**

---

## Practical Example

```cpp
#include <gmock/gmock.h>
using ::testing::_;                 // wildcard
using ::testing::Return;
using ::testing::InSequence;
using ::testing::Sequence;
using ::testing::Expectation;

class MockTurtle {
 public:
  MOCK_METHOD(void, PenDown, (), ());
  MOCK_METHOD(void, Forward, (int distance), ());
  MOCK_METHOD(int, GetX, (), (const));
};

void TestDrawing() {
  MockTurtle turtle;

  // Define default behavior
  ON_CALL(turtle, GetX()).WillByDefault(Return(0));

  {
    InSequence seq;  // calls must happen in order

    EXPECT_CALL(turtle, PenDown()).Times(1);
    EXPECT_CALL(turtle, Forward(100)).Times(AtLeast(1));
  }

  EXPECT_CALL(turtle, GetX())
      .WillOnce(Return(10))
      .WillOnce(Return(20))
      .RetiresOnSaturation();

  // ... code under test that calls turtle methods ...
}
```

---

## Troubleshooting

- **Warning about uninteresting calls:** Means a mock method was called without an `EXPECT_CALL`. Add `EXPECT_CALL(...).Times(AnyNumber())` or replace the mock with a `NiceMock` to suppress.
- **Unexpected call errors:** Means a call happened that did not match any `EXPECT_CALL` expectation.
- **Ordering failures:** If calls come out-of-order relative to `InSequence` or `.After()` constraints, adjust expectations accordingly.
- **Too few or too many calls:** Cardinality violations. Check your `.Times()` or implicit counts.

---

For a detailed walkthrough of all clauses and patterns, see the [Mocking Reference](reference/mocking.html) and [gMock Cookbook](gmock_cook_book.md).

---

## Related Pages

- [Creating Mock Objects](https://google.github.io/googletest/api/reference/mocking_and_expectations/creating_mock_objects.html)
- [Matchers Reference](reference/matchers.md)
- [Actions Reference](reference/actions.md)
- [gMock Cookbook](gmock_cook_book.md)
- [Nice, Naggy, and Strict Mocks](api_reference/mocking_and_expectations/strict_naggy_nice_mocks.md)
- [Mocking Techniques Guide](guides/core-workflows/mocking-techniques.md)

---