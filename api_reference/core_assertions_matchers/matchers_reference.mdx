---
title: "Matchers Reference"
description: "Comprehensive reference to built-in matchers for comparing values, containers, strings, and custom objects. Includes matcher syntax, composition, combining matchers, and guidance on writing custom matchers for domain-specific checks."
---

# Matchers Reference

Comprehensive reference to built-in matchers for comparing values, containers, strings, and custom objects. Includes matcher syntax, composition, combining matchers, and guidance on writing custom matchers for domain-specific checks.

---

## Overview

Matchers in GoogleTest and GoogleMock are predicates that verify whether values or arguments meet specified criteria. They enable expressive and readable tests by allowing conditions to be described declaratively within assertions or mock expectations.

Matchers can be used with `EXPECT_THAT()`, `ASSERT_THAT()`, and inside mock specifications like `EXPECT_CALL()` and `ON_CALL()`.

This reference details the syntax, categories, and usage of the built-in matchers and explains how to compose and customize them to fit any domain-specific needs.

---

## Basic Matcher Usage

### Assertion Macros Using Matchers

- `EXPECT_THAT(value, matcher)` verifies *value* matches *matcher*.
- `ASSERT_THAT(value, matcher)` is the fatal version that aborts on failure.

Example:

```cpp
EXPECT_THAT(actual_string, StartsWith("Hello"));
EXPECT_THAT(numbers, ElementsAre(1, Gt(0), _, 5));
```

### Matching Arguments in Mock Expectations

Matchers can be used to specify argument constraints in mock methods:

```cpp
EXPECT_CALL(mock, DoThis(Ge(5))).WillOnce(Return(true));
EXPECT_CALL(mock, DoThat(_, NotNull()));
```

---

## Categories of Built-in Matchers

Matchers are generally polymorphic and reside in the `::testing` namespace. Below are the major categories:

### 1. Wildcard Matchers
- `_` matches any value of the expected type.
- `A<T>()` or `An<T>()` also match any value of type `T`.

### 2. Equality and Comparison Matchers
- `Eq(value)` or simply writing `value` matches equality.
- `Ne(value)` - not equal.
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` - less/greater than or equal/strict.

### 3. Boolean Matchers
- `IsTrue()` matches values that evaluate to `true` in boolean context.
- `IsFalse()` matches false-like values.

### 4. Null and Pointer Matchers
- `IsNull()` matches any null pointer.
- `NotNull()` matches non-null pointers.
- `Pointee(m)` matches a pointer pointing to a value that matches `m`.
- `Pointer(m)` matches a pointer against matcher `m` of the raw pointer value.
- `WhenDynamicCastTo<T>(m)` matches after dynamic casting pointer/reference.

### 5. String Matchers
- `StrEq(s)`, `StrNe(s)`: exact string equality / inequality.
- `StrCaseEq(s)`, `StrCaseNe(s)`: case-insensitive equality / inequality.
- `HasSubstr(s)`: string contains substring.
- `StartsWith(prefix)`: matches strings starting with prefix.
- `EndsWith(suffix)`: matches strings ending with suffix.
- `MatchesRegex(regex)`: matches the entire string against the regex.
- `ContainsRegex(regex)`: string contains a substring matching regex.
- `WhenBase64Unescaped(m)`: matches base64-encoded string whose unescaped form matches `m`.

### 6. Floating Point Matchers
- `DoubleEq(expected)`, `FloatEq(expected)`: approximately equal double/float.
- `NanSensitiveDoubleEq(expected)`, `NanSensitiveFloatEq(expected)`: treat two NaNs as equal.
- `DoubleNear(value, max_abs_error)`, `FloatNear(value, max_abs_error)`: approx equal with explicit error bound.

### 7. Container Matchers
- `ElementsAre(e1, e2, ...)`: container has exactly these elements in order.
- `UnorderedElementsAre(e1, e2, ...)`: container has exactly these elements in any order.
- `ElementsAreArray(...)`, `UnorderedElementsAreArray(...)`: like above, but from arrays or containers.
- `Contains(e)`: container contains at least one element matching `e`.
- `IsEmpty()`: container is empty.
- `Each(e)`: every element matches `e`.
- `SizeIs(m)`: container size matches matcher `m`.
- `BeginEndDistanceIs(m)`: distance between `begin()` and `end()` matches `m`.
- `ContainerEq(c)`: containers are equal, with enhanced failure messages.
- `WhenSorted(m)`, `WhenSortedBy(comparator, m)`: matches after sorting container.
- `Pointwise(m, container)`, `UnorderedPointwise(m, container)`: pairwise element matching.
- `IsSubsetOf(...)`, `IsSupersetOf(...)`: container is subset/superset of the matchers.

### 8. Member Matchers
- `Field(&Class::field, m)`: matches an object whose `field` matches matcher `m`.
- `Property(&Class::property, m)`: matches an object whose property getter returns a value matching `m`.
- `Key(m)`: matches a pair whose `first` matches `m`.
- `Pair(m1, m2)`: matches a pair with `first` matching `m1` and `second` matching `m2`.
- `FieldsAre(m1, m2, ...)`: matches tuple-like objects whose fields match given matchers.

### 9. Exception Matchers (If exceptions enabled)
- `Throws<E>()`: matches callable throwing exception of type `E`.
- `Throws<E>(m)`: matches callable throwing `E` exception satisfying matcher `m`.
- `ThrowsMessage<E>(m)`: matches callable throwing `E` exception with message matching `m`.

### 10. Composite Matchers
- `AllOf(m1, m2, ...)`: matches if all constituent matchers match.
- `AnyOf(m1, m2, ...)`: matches if any constituent matchers match.
- `Not(m)`: matches if the inner matcher does *not* match.
- `Conditional(cond, m1, m2)`: chooses a matcher based on the condition.

### 11. Adapters and Utility Matchers
- `MatcherCast<T>(m)`: casts matcher `m` to type compatible with `T` safely.
- `SafeMatcherCast<T>(m)`: similar to `MatcherCast` but with additional type safety.
- `Truly(predicate)`: wrap predicate function or functor as a matcher.
- `Ref(variable)`: matches anything referring to the same variable.
- `Optional(m)`: matches an optional containing a value matching `m`.
- `VariantWith<T>(m)`: matches variants holding alternative `T` matching `m`.
- `Address(m)`: matches an object's address.

---

## Writing Custom Matchers

GoogleMock provides facilities and macros for quick creation of domain-specific matchers:

### MATCHER Macros

- `MATCHER(name, description) { ... }` defines a matcher called `name()`.
- `MATCHER_P(name, param, description) { ... }` defines a parameterized matcher.
- Variants support up to `MATCHER_P10` for multiple parameters.

Example:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
EXPECT_THAT(value, IsDivisibleBy7());
```

### Implementing Matcher Interface

For advanced usage, define a class implementing:

- `bool MatchAndExplain(const T& value, MatchResultListener*) const;`
- `void DescribeTo(std::ostream*) const;`
- `void DescribeNegationTo(std::ostream*) const;`

and provide a factory function returning `Matcher<T>`.

For polymorphic matchers, implement `MatchAndExplain` as a template.

### Composite Matchers

Build new matchers that use existing ones by storing sub-matchers. Use the `Matcher<T>` type to describe sub-matchers.

---

## Examples of Common Matchers

### Use Matchers in Mock Expectations

```cpp
EXPECT_CALL(mock, DoSomething(_, Ge(5), NotNull()));
```

### Match Elements of Containers

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(set, UnorderedElementsAre(1, 2, 3));
EXPECT_THAT(map, Contains(Pair(5, "foo")));
```

### Match Strings

```cpp
EXPECT_THAT(str, StartsWith("Hello"));
EXPECT_THAT(str, HasSubstr("world"));
EXPECT_THAT(str, StrCaseEq("CASE insensitive"));
```

### Use Custom Matcher

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
EXPECT_THAT(value, IsEven());
```

---

## Tips and Best Practices

- Use `_` as wildcard in argument matchers when argument values are irrelevant.
- Combine matchers with `AllOf()`, `AnyOf()`, `Not()` for more complex criteria.
- Use `SafeMatcherCast<T>()` to cast matchers to expected argument types safely.
- Prefer `ElementsAre()` for containers with known order, and `UnorderedElementsAre()` when order does not matter.
- Use `Pointee(m)` to validate the value pointed to by a pointer argument.
- Use `EXPECT_CALL()` to set expectations on mock method calls before exercising the code.
- When writing custom matchers, ensure they are pure functions without side effects.

---

## Troubleshooting Matchers

- Unmatched calls in mocks may result from incorrect argument matchers.
- Use `--gmock_verbose=info` to get more detailed matching output and call traces.
- When matching containers, make sure the expected elements and their order match the actual container if using `ElementsAre()`.
- Be cautious with string matchers on C strings: use `StrEq` or `HasSubstr` rather than `Eq`.

---

## Additional Resources

- [Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers)
- [Matchers Reference (Current)](/api_reference/core_assertions_matchers/matchers_reference)
- [Using Assertions Effectively Guide](/guides/core-workflows/using-assertions)
- [Mocking Reference](/docs/reference/mocking.md)
- [gMock Cookbook](/docs/gmock_cook_book.md)

---

<Info>
For practical hands-on examples, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) which includes recipes for mocking, setting expectations, actions, and custom matcher creation.
</Info>

---

## Reference: Selected Core Matcher Syntax

```cpp
// Wildcard matchers
EXPECT_CALL(mock, Func(_));
EXPECT_CALL(mock, Func(A<int>()));

// Equality and comparison
EXPECT_CALL(mock, Foo(Eq(5)));
EXPECT_CALL(mock, Foo(Ne(10)));
EXPECT_CALL(mock, Foo(Lt(100)));

// Pointer matchers
EXPECT_CALL(mock, Bar(IsNull()));
EXPECT_CALL(mock, Bar(NotNull()));
EXPECT_CALL(mock, Bar(Pointee(Eq(42))));

// String matchers
EXPECT_THAT(str, StrEq("hello"));
EXPECT_THAT(str, HasSubstr("world"));
EXPECT_THAT(str, StartsWith("foo"));
EXPECT_THAT(str, EndsWith("bar"));

// Container matchers
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(set, UnorderedElementsAre(3, 2, 1));
EXPECT_THAT(map, Contains(Pair(5, "value")));

// Member matchers
EXPECT_THAT(obj, Field(&MyClass::field, Eq(42)));
EXPECT_THAT(obj, Property(&MyClass::method, StartsWith("abc")));
EXPECT_THAT(p, Pair(Eq(1), Eq("one")));

// Composite matchers
EXPECT_THAT(value, AllOf(Ge(1), Lt(10)));
EXPECT_THAT(value, AnyOf(Eq(0), Eq(5), Eq(10)));
EXPECT_THAT(value, Not(Eq(3)));

// Custom matcher example
MATCHER(IsDivisibleBy3, "is divisible by 3") {
  return (arg % 3) == 0;
}
EXPECT_THAT(num, IsDivisibleBy3());
```

---

## Summary

Matchers provide a flexible, expressive way to specify expectations and assertions on values, arguments, and complex data structures in C++. They seamlessly integrate with GoogleTest assertions and GoogleMock expectations, empowering developers to write clear, maintainable tests.

This page documents all major built-in matcher categories, usage patterns, and customization approaches needed by users ranging from novices to advanced experts.

---