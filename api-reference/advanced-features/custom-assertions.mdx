---
title: "Custom Assertions and Predicates"
description: "Describes how to create custom assertions, format assertion results, use predicate assertion macros, and design expressive checks tailored to specific codebases."
---

# Custom Assertions and Predicates

This documentation page describes how to create custom assertions within GoogleTest. It explains how to design assertions that provide more expressive, readable, and informative test results, beyond the built-in expectations. You will learn how to format assertion results for clarity, use predicate assertion macros for better diagnostics, and craft checks tailored to your specific code base.

---

## Overview

When standard assertions such as `EXPECT_TRUE`, `EXPECT_EQ`, or `ASSERT_EQ` are not sufficient, writing *custom assertions* or *predicate functions* enhances your test expressiveness. Custom assertions improve failure messages by showing values of sub-expressions or by describing why an assertion failed.

This page shows how to:

- Create simple custom assertions that return `::testing::AssertionResult`, signaling success or failure, and stream user-friendly messages.
- Use predicate assertion macros (`EXPECT_PRED*` and `EXPECT_PRED_FORMAT*`) to verify complex predicates with clear diagnostics.
- Write predicate-formatters for fine-grained control over failure message content.
- Avoid common pitfalls and optimize the reliability and clarity of assertion output.

You’ll find guidance to help you consistently write assertions that empower anyone reading test failures to quickly diagnose issues.

---

## Designing Custom Assertions

Custom assertions are functions that evaluate a condition and return an `AssertionResult` object indicating success or failure along with an optional message.

#### Writing Assertion Functions

Create a function returning `::testing::AssertionResult`:

```cpp
#include <gtest/gtest.h>

testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0)
    return testing::AssertionSuccess();
  else
    return testing::AssertionFailure() << n << " is odd";
}
```

- Return `AssertionSuccess()` to indicate a passing check.
- Return `AssertionFailure()` and stream diagnostic details for meaningful failure messages.

Use this function in assertions:

```cpp
EXPECT_TRUE(IsEven(4));  // Passes
EXPECT_TRUE(IsEven(5));  // Fails with message "5 is odd"
```

This is preferable to `EXPECT_TRUE` with a complex expression, as failure prints the explanation.

#### Enhancing Negative Checks

You can optionally add a success message for better output on `EXPECT_FALSE` checks:

```cpp
testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0)
    return testing::AssertionSuccess() << n << " is even";
  else
    return testing::AssertionFailure() << n << " is odd";
}
EXPECT_FALSE(IsEven(3));  // Prints that "3 is odd"
EXPECT_FALSE(IsEven(4));  // Prints "4 is even", helping diagnose unexpected pass
```

---

## Using Predicate Assertion Macros

GoogleTest provides predicate assertion macros specialized for checking predicates with 1 to 5 arguments.

### Predicate Macros with Boolean Return

If your predicate returns `bool`, use these:

| Macro           | Description                                  |
|-----------------|----------------------------------------------|
| `EXPECT_PRED1`  | For predicate with 1 argument                |
| `EXPECT_PRED2`  | For predicate with 2 arguments               |
| ...             | up to `EXPECT_PRED5` for 5 arguments         |
| Same for ASSERT | Fatal-failure versions that abort the test  |

Example:

```cpp
bool IsPrime(int n) { /* ... */ }
int x = 7;
EXPECT_PRED1(IsPrime, x);  // Passes if IsPrime(x) returns true
```

If the assertion fails, GoogleTest prints the predicate call and each argument value.

#### Important Usage Notes

- If your predicate is overloaded or templated, explicitly cast it for disambiguation:
  
  ```cpp
  EXPECT_PRED1((bool (*)(int))IsPositive, 5);
  EXPECT_PRED1(IsNegative<int>, -5);
  ```
- Arguments are evaluated exactly once.

### Predicate-Formatter Macros for Custom Messages

For predicates that return `AssertionResult`, or when you want full control over failure text, use predicate-formatter macros:

| Macro                 | Description                               |
|-----------------------|------------------------------------------|
| `EXPECT_PRED_FORMAT1` | Predicate formatter with 1 argument      |
| `EXPECT_PRED_FORMAT2` | With 2 arguments                         |
| ...                   | Up to 5 arguments                         |
| Same for ASSERT       | Fatal-failure variants                    |

A predicate-formatter function has the signature:

```cpp
testing::AssertionResult PredicateFormatter(
    const char* expr1, ..., const char* exprN,
    T1 val1, ..., TN valN);
```

Where:

- The first N `const char*` parameters give the textual expressions.
- The last N parameters are the evaluated argument values.
- Returns `AssertionSuccess()` or failure with a detailed message.

Example:

```cpp
// Checks if two numbers are mutually prime and explains failure.
testing::AssertionResult AssertMutuallyPrime(const char* m_expr, const char* n_expr, int m, int n) {
  if (MutuallyPrime(m, n)) return testing::AssertionSuccess();

  return testing::AssertionFailure() << m_expr << " and " << n_expr
                                      << " (" << m << " and " << n << ") are not mutually prime.";
}

EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);  // Fails with detailed message
```

---

## Examples of Advanced Custom Assertions

### Example 1: Simple Even Number Check

```cpp
// Predicate returning AssertionResult

testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return testing::AssertionSuccess() << n << " is even";
  else
    return testing::AssertionFailure() << n << " is odd";
}

TEST(MathTest, CheckEven) {
  EXPECT_TRUE(IsEven(4));
  EXPECT_TRUE(IsEven(5));  // Fails printing "5 is odd"
}
```

### Example 2: Predicate with Two Arguments

```cpp
bool SumIsEven(int a, int b) {
  return ((a + b) % 2) == 0;
}

TEST(MathTest, SumCheck) {
  EXPECT_PRED2(SumIsEven, 2, 4);  // Passes
  EXPECT_PRED2(SumIsEven, 1, 3);  // Fails
}
```

### Example 3: Predicate-Formatter with Detailed Error Message

```cpp
// Returns AssertionResult with rich failure message

testing::AssertionResult AssertSumIsEven(const char* a_expr, const char* b_expr, int a, int b) {
  if ((a + b) % 2 == 0) return testing::AssertionSuccess();

  return testing::AssertionFailure() << a_expr << " + " << b_expr << " (" << a << " + " << b << ") is not even.";
}

TEST(MathTest, SumFormatter) {
  EXPECT_PRED_FORMAT2(AssertSumIsEven, 1, 3);  // Prints failure with values and expression
}
```

---

## Best Practices and Tips

- **Evaluate arguments once:** Define predicates that do not cause side effects or expensive computations multiple times.
- **Use expressive messages:** Stream helpful diagnostics via `AssertionFailure()` to aid debugging.
- **Use predicate-formatters for complex cases:** When the default failure message format is insufficient.
- **Explicitly specify function signatures:** Avoid ambiguous predicate selections due to overloaded or templated predicates.
- **Prefer `AssertionResult`-returning predicates:** They produce more informative failure outputs than Boolean predicates.
- **Use `SCOPED_TRACE` to associate failures with context:** This complements custom assertions to enhance failure traceability.

---

## Troubleshooting

### Common Pitfalls

- **Assertion evaluates arguments multiple times:** Leads to unintended side effects. Wrap code carefully.
- **Predicate overload ambiguity:** Use explicit casts when necessary.
- **Ignoring failure messages:** Ensure `AssertionFailure` is used with streamed diagnostics.
- **Fatal assertions in non-void functions:** Fatal assertions abort the current function; use carefully in void-returning contexts.

### How to Diagnose

- Check that your predicate or predicate-formatter is invoked with expected values.
- Use `EXPECT_NONFATAL_FAILURE()` and `EXPECT_FATAL_FAILURE()` test macros to verify assertion failures during test development.
- Review detailed failure messages printed to stderr for mismatches in expectations.

---

## Related Macros and Utilities

| Macro/Function          | Description                                       |
|------------------------|-------------------------------------------------|
| `EXPECT_PRED*`         | Predicate assertions returning bool              |
| `ASSERT_PRED*`         | Fatal variant of predicate assertions            |
| `EXPECT_PRED_FORMAT*`  | Predicate-formatters with `AssertionResult`     |
| `ASSERT_PRED_FORMAT*`  | Fatal variant of predicate-formatters            |
| `AssertionSuccess()`   | Creates passing assertion result                  |
| `AssertionFailure()`   | Creates failing assertion result (message streamed in)
| `SCOPED_TRACE`         | Adds scoped contextual information to failures   |

---

## Further Reading

- [Assertions Reference](reference/assertions.md) — Catalogue of all built-in assertions.
- [Matchers Reference](api-reference/core-apis/matchers.mdx) — Framework for expressive argument matching.
- [Writing Your First Test](guides/getting-started-testing/writing-your-first-test.mdx) — Introductory guide.
- [Using Matchers Effectively](guides/core-testing-workflows/using-matchers-effectively.mdx) — Best practices for matchers.

---

# Summary

This page empowers you to extend GoogleTest's assertion capabilities by creating custom assertions and predicate checks that provide clearer and more actionable failure messages. It covers designing functions that return `AssertionResult`, using predicate macros for various argument counts, and crafting predicate-formatters to customize failure reporting fully.

---

<Steps>
<Step title="Understand the need for custom assertions">Use built-in assertions as much as possible; prefer custom assertions when failure diagnostics are insufficient.</Step>
<Step title="Write assertion functions">Implement functions returning `AssertionResult` with meaningful success and failure messages.</Step>
<Step title="Use predicate macros">Apply `EXPECT_PREDn` or `EXPECT_PRED_FORMATn` macros to invoke predicates with proper diagnostics.</Step>
<Step title="Test and refine messages">Verify custom assertions produce correct output on success and failure cases.</Step>
<Step title="Integrate with test workflows">Use `SCOPED_TRACE` and combine with matchers for richer test failure context.</Step>
</Steps>

<Tip>
- Always ensure arguments to predicates are evaluated once to avoid side effects.
- Stream detailed messages in `AssertionFailure()` to make debugging easier.
- Explicitly cast overloaded predicates for clarity.
- Consider writing custom matchers (see Matchers Reference) if your assertion logic is complex.
</Tip>

---