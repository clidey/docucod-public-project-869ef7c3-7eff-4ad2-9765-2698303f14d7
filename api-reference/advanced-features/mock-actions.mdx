---
title: "Mock Actions and Call Handling"
description: "Documents the use of GoogleMock action APIs to control mock method outputs, side-effects, and argument capturing. Guides users through advanced actions, variadic templates, and custom action creation for deeper mock customization."
---

# Mock Actions and Call Handling

The `Mock Actions and Call Handling` page explores the core APIs provided by GoogleMock to control the behavior, response, and side-effects of mocked methods. This documentation guides you through setting up mock behaviors using default actions (`ON_CALL`), expectations (`EXPECT_CALL`), advanced action specifications, and managing call sequences and lifecycles.

---

## Overview

Mock actions allow you to specify what happens when mock methods are invoked during testing. This includes:

- Defining default actions with `ON_CALL` where no strict expectation of invocation is set.
- Specifying expectations with `EXPECT_CALL` that assert a method *must* be called with certain arguments, and control how many times and in what order.
- Handling argument matching precisely with matchers, including matching multiple arguments at once.
- Controlling sequences and ordering of calls with `Sequence` and `InSequence`.
- Customizing mock method effects with `WillOnce()`, `WillRepeatedly()`, and retiring expectations on saturation.

GoogleMockâ€™s mechanism for actions and call handling serves to simulate real object behavior in tests while verifying interaction correctness.

---

## Setting Default Behavior With `ON_CALL`

`ON_CALL(mock_object, Method(matchers))` defines the default behavior whenever the method matching the argument matchers is invoked. It configures the *default action* taken for uninteresting calls (calls that have no associated expectations).

- Use the `.With()` clause once to specify a multi-argument matcher that inspects all arguments as a tuple.
- The `.WillByDefault()` clause must be specified exactly once to define the default action taken upon calling the mock method.

Example:
```cpp
ON_CALL(my_mock, GetValue(_))
    .With(::testing::Lt())  // Use a multi-argument matcher (optional)
    .WillByDefault(::testing::Return(42));
```

This means calls matching `GetValue` with the argument less than some value will return 42 by default unless overridden by expectations.

---

## Setting Expectations With `EXPECT_CALL`

`EXPECT_CALL(mock_object, Method(matchers))` sets expectations that the method will be called with arguments matching the given matchers. Unlike `ON_CALL`, it *asserts* that matching calls occur, enabling verification.

### Chainable Clauses in `EXPECT_CALL`

You can further refine expectations with the following clauses; order and cardinality matter:

- `.With(multi_argument_matcher)`: At most once. Restricts matching by a tuple matcher.
- `.Times(cardinality)`: At most once. Defines how many times calls are expected.
- `.InSequence(sequences...)`: Zero or more times. Specifies sequences of ordered expectations.
- `.After(expectations...)`: Zero or more times. Defines partial ordering dependency.
- `.WillOnce(action)`: Zero or more times. Specifies action for each matched call, in order.
- `.WillRepeatedly(action)`: At most once. Specifies the action for all subsequent calls after `WillOnce`s.
- `.RetiresOnSaturation()`: At most once. Retires (deactivates) the expectation after saturation.

Example:
```cpp
using ::testing::Return;
using ::testing::_;

EXPECT_CALL(mock_object, Compute(_, _))
    .Times(3)
    .WillOnce(Return(5))
    .WillOnce(Return(10))
    .WillRepeatedly(Return(0))
    .RetiresOnSaturation();
```

This means:
- `Compute` should be called exactly 3 times.
- Returns 5 on first call, 10 on second.
- Returns 0 on third and subsequent calls if any.
- The expectation becomes inactive after 3 calls.

### Important Notes About Expectations

- **Order matters:** Later `EXPECT_CALL`s override earlier for matching.
- **Late calls cause errors:** Calls made before relevant `EXPECT_CALL` cause undefined behavior.
- **Default cardinality inference:**
  - No `Times()` but n `WillOnce()`: `Times(n)` inferred.
  - `WillRepeatedly()` present with n `WillOnce()`: `Times(AtLeast(n))` inferred.
  - No `Times()`, `WillOnce()`, or `WillRepeatedly()`: defaults to `Times(1)`.

---

## Matching Arguments as a Whole With `.With()` Clause

Both `ON_CALL` and `EXPECT_CALL` support `.With()` to match *all arguments* as a tuple with multi-argument matchers.

Example: Expect `SetRange(a, b)` called only when `a < b`.

```cpp
EXPECT_CALL(mock, SetRange(_, _))
    .With(::testing::Lt());  // Matches std::tuple(a, b) with Lt().
```

Useful when inter-argument dependencies must be checked beyond per-argument matchers.

---

## Controlling Call Order and Sequences

Sometimes the order of expected calls is important. GoogleMock provides:

### `Sequence`

Defines one or more sequences representing calls expected to occur in a defined order.

Example:
```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Foo())
    .InSequence(s1, s2);
EXPECT_CALL(mock, Bar())
    .InSequence(s1);
EXPECT_CALL(mock, Baz())
    .InSequence(s2);
```
This means `Foo` is expected before `Bar` and `Baz`, while `Bar` and `Baz` can occur in any order relative to each other but after `Foo`.

### `InSequence` Object

Use `InSequence` to automatically place all expectations declared in its scope into one anonymous sequence.

Example:
```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, A());
  EXPECT_CALL(mock, B());
}
```
Means: calls to `A` and `B` must occur in order.

### `.After()` Clause

Specify partial ordering between expectations, allowing an expectation to only match after one or more other expectations have been satisfied.

Example:
```cpp
Expectation exp1 = EXPECT_CALL(mock, Init1());
ExpectationSet exps2;
exps2 += EXPECT_CALL(mock, Init2a());
exps2 += EXPECT_CALL(mock, Init2b());
EXPECT_CALL(mock, Work()).After(exp1, exps2);
```
Means `Work()` must be called after `Init1()`, `Init2a()`, and `Init2b()` have been called.

---

## Specifying Actions for Mock Calls

### `.WillOnce()`

Define the action performed on the *next* matching invocation.

Example:
```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(1))
    .WillOnce(Return(2));
```
The first call returns 1, the second returns 2.

### `.WillRepeatedly()`

Define the action performed for *all subsequent* matching invocations after exhausting all `WillOnce()` actions.

Example:
```cpp
EXPECT_CALL(mock, GetValue())
     .WillOnce(Return(1))
     .WillRepeatedly(Return(0));
```
Returns 1 first, then 0 after.

### `.RetiresOnSaturation()`

Marks the expectation to become inactive after it has been saturated (all expected calls occurred). This helps prevent sticky expectations from interfering with other expectations.

---

## Controlling Uninteresting Calls and Mock Strictness

By default, uninteresting calls (mock methods called without an `EXPECT_CALL`) generate warnings.

GoogleMock offers these wrappers to control this behavior:
- `NiceMock<T>`: suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: warns on uninteresting calls (default behavior).
- `StrictMock<T>`: treats uninteresting calls as failures.

Example:
```cpp
NiceMock<MockTurtle> turtle;
StrictMock<MockTurtle> strict_turtle;
```
Use these as per your test's tolerance of uninteresting mock calls.

---

## Using `MockFunction` for Mocking `std::function`

`MockFunction<R(Args...)>` mocks a generic callable object with one mock method `Call()`:

```cpp
MockFunction<int(std::string)> mock_func;
EXPECT_CALL(mock_func, Call("test")).WillOnce(Return(42));
foo.DoSomething(mock_func.AsStdFunction());
```
Enables mocking of callback interfaces passed as `std::function`.

---

## Common Troubleshooting

- **Expectations must be set before calls:** Setting expectations after the mock method is called leads to undefined behavior.
- **Uninteresting call warnings:** Suppress with `NiceMock` or catch-all expectations using `_` matcher and `Times(AnyNumber())`.
- **Sticky expectations:** Use `.RetiresOnSaturation()` or `Sequence` to avoid expectations matching beyond intended calls.
- **Overloaded methods:** Disambiguate with `Const(mock)` wrapper or explicit matcher casting.

---

## Code Examples

### Simple `ON_CALL` Usage
```cpp
ON_CALL(mock, Foo(_))
    .WillByDefault(Return(42));
```

### Typical `EXPECT_CALL` with Actions
```cpp
EXPECT_CALL(mock, Bar(Ge(0)))
    .Times(3)
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(0));
```

### Using `InSequence` For Ordering
```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Init());
  EXPECT_CALL(mock, Process());
  EXPECT_CALL(mock, Finish());
}
```

### Using `Sequence` For Partial Ordering
```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Start()).InSequence(s1, s2);
EXPECT_CALL(mock, Step1()).InSequence(s1);
EXPECT_CALL(mock, Step2()).InSequence(s2);
```

### Using `WillOnce()` And `WillRepeatedly()`
```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(-1));
```

### Delegating Default Behavior to a Fake
```cpp
class FakeFoo : public Foo {
 public:
  int DoWork(int x) override { return x * 2; }
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, DoWork, (int), (override));

  void DelegateToFake() {
    ON_CALL(*this, DoWork)
        .WillByDefault([this](int x) { return fake_.DoWork(x); });
  }

 private:
  FakeFoo fake_;
};
```

---

## Summary

This page has equipped you with a comprehensive understanding of how to control mock behavior and expectations using GoogleMock's action APIs. You learned how to set up default behaviors with `ON_CALL`, assert expected calls with `EXPECT_CALL`, use matcher-based argument validation, organize expectations in sequences and partial orderings, specify precise actions, and manage uninteresting calls and mock object strictness.

For complex mocking scenarios, the page details the use of `MockFunction` for mocking `std::function` objects, delegation patterns, and advanced expectation management.

Use these APIs to make your mocks precisely emulate real object interactions and to verify program behavior through their calls.

---

## Related Documentation

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Mocking Basics Guide](https://google.github.io/googletest/guides/getting-started-testing/mocking-basics)
- [Using Matchers Effectively](https://google.github.io/googletest/guides/core-testing-workflows/using-matchers-effectively)

---

<Callout>
**Tip:**
When working with overloaded methods, use `Const(object)` for const overloads and explicit matcher casting to disambiguate.

</Callout>

<Callout>
**Note:**
Always set expectations before exercising mock methods to avoid undefined behavior and hard-to-debug errors.

</Callout>