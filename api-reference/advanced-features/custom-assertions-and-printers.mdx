---
title: "Custom Assertions and Value Printers"
description: "Explains how to create custom assertions and value printers for richer diagnostics and output. Includes reference to required interfaces and extension points provided by internal and custom headers."
---

# Custom Assertions and Value Printers

GoogleTest empowers you to enhance your testing diagnostics and assertions by creating **custom assertions** and **value printers**. This page explains how you can define these customizations to produce richer, clearer, and more actionable test failure messages, enabling better debugging and more expressive test code.

---

## Why Create Custom Assertions and Value Printers?

Sometimes the built-in assertions don't offer enough detail about why a test failed or how values are compared. When you have complex objects or domain-specific conditions, you want failure messages to clearly explain what went wrong, showing the relevant values in readable formats.

Custom assertions and value printers help you:

- **Produce informative failure messages** that show actual values and the context
- **Improve test readability** by encapsulating complex verification logic
- **Ensure** objects without native stream operators (`operator<<`) are printed meaningfully

---

## Custom Assertion Types in GoogleTest

GoogleTest offers two main styles of custom assertions, designed to fit different user needs:

### 1. Boolean Predicate Assertions

These are straightforward predicates that return a `bool` indicating success or failure.

- Use macros like `EXPECT_PRED1`, `ASSERT_PRED2`, ..., `EXPECT_PRED5`.
- Your predicate is a function or functor returning `bool`.
- Value arguments should be printable by streaming to `std::ostream` (`operator<<`).

**Example:**

```cpp
// A simple predicate function.
bool IsEven(int n) { return n % 2 == 0; }

// Use it in your test.
EXPECT_PRED1(IsEven, value);
```

When the predicate fails, GoogleTest prints the predicate's argument values to help diagnose the issue.


### 2. Predicate-Formatter Assertions

Sometimes, your predicate(s) need to generate custom failure messages richer than just "false". Predicate-formatters return a `testing::AssertionResult`, which encapsulates both success/failure and a detailed message.

- Use macros like `EXPECT_PRED_FORMAT1`, `ASSERT_PRED_FORMAT3`, `EXPECT_PRED_FORMAT5`.
- The predicate-formatter is a function or functor with a signature like:

  ```cpp
  testing::AssertionResult PredicateFormatter(const char* expr1, ..., const T1& val1, ...);
  ```

- It receives the textual source expressions and the values themselves.
- It returns `AssertionSuccess()` on pass, or `AssertionFailure()` streaming a message on failure.

**Example:**

```cpp
// Predicate-formatter that checks evenness and explains failure.
testing::AssertionResult AssertIsEven(const char* expr, int n) {
  if (IsEven(n))
    return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}

// Usage
EXPECT_PRED_FORMAT1(AssertIsEven, value);
```

This style allows full control over the failure message's content and format.

---

## Supported Predicate Arity

GoogleTest supports predicate assertions up to **5 arguments**:

- Unary predicates: `EXPECT_PRED1`, `ASSERT_PRED1`, `EXPECT_PRED_FORMAT1`, etc.
- Binary predicates: `EXPECT_PRED2`, ...
- Ternary predicates: `...3` macros
- 4-ary predicates: `...4` macros
- 5-ary predicates: `...5` macros

If you require higher arities, you must contact the GoogleTest team for support.

---

## How to Implement Custom Predicate Assertions

### Creating a Boolean Predicate

Write a function or functor that takes the required number of arguments and returns a `bool`.

Example:

```cpp
bool GreaterThanZero(int n) { return n > 0; }

EXPECT_PRED1(GreaterThanZero, x);
```

### Creating a Predicate-Formatter

Write a function or functor that takes the textual expressions for arguments **and** their values, and returns a `testing::AssertionResult`.

Example:

```cpp
testing::AssertionResult AssertGreaterThanZero(const char* expr, int n) {
  if (n > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not greater than zero.";
}

EXPECT_PRED_FORMAT1(AssertGreaterThanZero, x);
```

This makes failure messages clear and actionable.

### Tips to Write Good Predicate-Formatters

- Always provide the source expression text to help users identify which value failed.
- Show the actual value(s) with `<<` streaming to `Message` or `AssertionFailure`.
- Return `AssertionSuccess()` on pass.
- Include additional helpful explanation on failure.

---

## Teaching GoogleTest How to Print Your Types

GoogleTest can automatically print values in failure messages if your types support streaming to `std::ostream`. However, sometimes you must teach GoogleTest how to print custom classes or types for clearer output.

### Preferred Methods

1. **Define `PrintTo()` Function**

In your class's namespace (or global namespace), define:

```cpp
namespace my_namespace {

class MyType { ... };

// Friendly print function used by GoogleTest.
void PrintTo(const MyType& obj, std::ostream* os) {
  *os << "MyType: {field_1=" << obj.field_1 << ", field_2=" << obj.field_2 << "}";
}

}
```

GoogleTest calls `PrintTo()` to generate diagnostic representations.

2. **Define AbslStringify() Function** (if using Abseil)

You can overload `AbslStringify()`:

```cpp
namespace my_namespace {

template <typename Sink>
friend void AbslStringify(Sink& sink, const MyType& obj) {
  absl::Format(&sink, "MyType(%d, %d)", obj.field1, obj.field2);
}

}
```

If both `PrintTo()` and `AbslStringify()` are defined, GoogleTest prefers `PrintTo()`.

### When To Use?

Use these methods especially when your types don't have `operator<<` or the existing one is not meaningful.

### Using `testing::PrintToString()` Directly

You can also explicitly print a value inside a failure message:

```cpp
EXPECT_TRUE(IsValid(x)) << "x = " << testing::PrintToString(x);
```

---

## Macro Reference for Predicate Assertions

| Macro                      | Description                                              |
| -------------------------- | -------------------------------------------------------- |
| `EXPECT_PRED1(pred, v1)`          | Checks unary predicate returning bool (nonfatal failure). |
| `ASSERT_PRED1(pred, v1)`          | Same as `EXPECT_PRED1` but fatal failure.                  |
| `EXPECT_PRED_FORMAT1(pred_fmt, v1)`  | Uses unary predicate-formatter returning `AssertionResult`. |
| `ASSERT_PRED_FORMAT1(pred_fmt, v1)`  | Fatal version of `EXPECT_PRED_FORMAT1`.                   |
| `EXPECT_PRED2(pred, v1, v2)`      | Binary predicate (nonfatal).                              |
| `ASSERT_PRED2(pred, v1, v2)`      | Binary predicate (fatal).                                 |
| `EXPECT_PRED_FORMAT2(pred_fmt, v1, v2)`| Binary predicate-formatter (nonfatal).                   |
| `ASSERT_PRED_FORMAT2(pred_fmt, v1, v2)`| Binary predicate-formatter (fatal).                      |
| ...                              | Up to arity 5 similarly.                                |

**Note:** Always use the `ASSERT_` variants when failure should abort the test immediately.

---

## Example Usage

```cpp
// Example with binary predicate.
bool AreBothPositive(int a, int b) {
  return a > 0 && b > 0;
}

TEST(MyTests, AreBothPositiveTest) {
  EXPECT_PRED2(AreBothPositive, 5, 7);  // Passes.
  EXPECT_PRED2(AreBothPositive, -1, 7);  // Fails, prints values.
}

// Example with predicate-formatter.
testing::AssertionResult AssertBothPositive(
    const char* expr1, const char* expr2, int a, int b) {
  if (a > 0 && b > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr1 << " = " << a << ", "
                                   << expr2 << " = " << b
                                   << " are not both positive.";
}

TEST(MyTests, AssertBothPositiveTest) {
  EXPECT_PRED_FORMAT2(AssertBothPositive, 5, 7);  // Pass
  EXPECT_PRED_FORMAT2(AssertBothPositive, -1, 3);  // Failure with message
}
```

---

## Common Pitfalls & Best Practices

- **Evaluate arguments only once**: GoogleTest predicate assertions guarantee each argument is evaluated exactly once.
- **Streamable arguments**: For non-predicate-formatter assertions, ensure arguments support streaming with `operator<<`.
- **Explicitly specify template types**: For overloaded functions or templates, specify casts to disambiguate.
- **Use predicate-formatter if streaming is unsupported**: When arguments cannot be streamed, or you want richer messages, use predicate-formatters.

---

## Reference to Interfaces and Internal Headers

Custom assertions rely on interfaces provided by GoogleTest’s internal and public headers, particularly:

- `testing::AssertionResult`: The result type for predicate-formatters indicating pass or failure with an associated message.
- Macros from `gtest_pred_impl.h` enable predicates and predicate-formatters for arities 1 to 5 with `EXPECT_PREDn` and `EXPECT_PRED_FORMATn` variants.
- `testing::PrintToString()`: Utility to convert objects to string using GoogleTest’s printers.

For full details on predicate assertion macros, see the [Assertions Reference](reference/assertions.md#predicates).

---

## Troubleshooting

| Issue                                       | Solution                                                   |
| --------------------------------------------| ----------------------------------------------------------|
| Predicate arguments evaluated multiple times | Use GoogleTest predicate macros; they guarantee single eval.|
| Compiler errors on overloaded predicates     | Cast predicate function pointer explicitly with correct types.|
| Failure messages are uninformative             | Switch to predicate-formatters returning `AssertionResult`. |
| Value prints as raw bytes or garbage          | Define a `PrintTo()` or `AbslStringify()` function for your type. |

---

## Related Documentation and Next Steps

- [Assertions Reference](reference/assertions.md#predicates): Complete guide on predicate assertions.
- [Creating Custom Assertions Guide](guides/advanced-usage/custom-assertions.md): Tutorial on writing custom assertion macros.
- [Teaching GoogleTest How to Print Your Values](advanced.md#teaching-googletest-how-to-print-your-values): How to extend printing support.
- [Test Registration and Execution](api-reference/core-testing-framework/test-registration-and-execution.mdx): To understand where assertions fit in test execution.

Explore these documents to deepen your mastery of expressive and maintainable test assertions.

---

## Summary
- GoogleTest supports predicate assertions to write custom Boolean checks.
- Predicate-formatters enable expressive failure messages with full control.
- Value printing can be customized for complex types using `PrintTo()` or `AbslStringify()`.
- Supports predicates of up to 5 parameters.

<Callout title="Tip">
Always prefer predicate-formatters for complex conditions and custom types to gain rich diagnostics.
</Callout>

<Callout title="Note">
You must include `<gtest/gtest.h>` and ensure your predicates align with GoogleTest’s requirements for argument types and evaluation.
</Callout>

---

## See Also

- [ASSERT_PRED_FORMAT* and EXPECT_PRED_FORMAT* macros](reference/assertions.md#EXPECT_PRED_FORMAT)
- [Teaching GoogleTest To Print Your Values](advanced.md#teaching-googletest-how-to-print-your-values)
- [Writing Custom Assertions](guides/advanced-usage/custom-assertions.md)
- [Testing Reference](reference/testing.md)

---

<Source url="https://github.com/google/googletest" paths={[{"path": "googletest/include/gtest/gtest_pred_impl.h", "range": "1-190"}]} branch="main" />
<Source url="https://github.com/google/googletest" paths={[{"path": "docs/reference/assertions.md", "range": "1-301"}]} branch="main" />
<Source url="https://github.com/google/googletest" paths={[{"path": "docs/advanced.md", "range": "50-280"}]} branch="main" />
