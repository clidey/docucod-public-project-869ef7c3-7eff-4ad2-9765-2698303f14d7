---
title: "Built-in Actions and Return Controls"
description: "API documentation for the set of built-in actions (e.g., Return, SetArgPointee, Throw) used to define mock object behavior in response to calls. Includes usage of action macros and parameterization."
---

# Built-in Actions and Return Controls

This reference details the built-in actions provided by GoogleMock to define how mock methods behave when invoked. These actions specify return values, side effects, and invocation behaviors that govern the mock's responses during tests. All actions reside in the `::testing` namespace.

---

## Returning a Value

The following built-in actions specify what value or effect a mock method returns or produces.

| Action                             | Description                                                                                     |
|-----------------------------------|------------------------------------------------------------------------------------------------|
| `Return()`                        | Return from a `void` mock function.                                                            |
| `Return(value)`                   | Return a specified constant or expression `value`. Conversion to the mock function's return type occurs at expectation setup, not at call time. |
| `ReturnArg<N>()`                  | Return the `N`-th argument (0-based) received by the mock method.                               |
| `ReturnNew<T>(a1, ..., ak)`       | Return a newly allocated pointer to a `T` constructed with arguments `(a1, ..., ak)`. A new instance is created each time the action runs. |
| `ReturnNull()`                    | Return a null pointer (e.g., `nullptr`, `NULL`).                                               |
| `ReturnPointee(ptr)`              | Return the value pointed to by pointer `ptr` at call time (useful to return live values).       |
| `ReturnRef(variable)`             | Return a reference to `variable`. This is used for mock functions returning references.        |
| `ReturnRefOfCopy(value)`          | Return a reference to a persistent copy of `value`. Useful when returning a reference but not from a live variable. |
| `ReturnRoundRobin({a1, ..., ak})` | Cycle through each value in the list `{a1, ..., ak}` on successive calls, repeating from the start after the end. |

### Example: Returning Different Values on Calls

```cpp
using ::testing::Return;

EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));

int val1 = mock.GetValue();  // 10
int val2 = mock.GetValue();  // 20
int val3 = mock.GetValue();  // 30
int val4 = mock.GetValue();  // 30
```

---

## Side Effects on Arguments

Some actions let you simulate side effects by modifying arguments passed into the mock method.

| Action                     | Description                                                                                              |
|---------------------------|---------------------------------------------------------------------------------------------------------|
| `Assign(&variable, value)` | Assign `value` to the variable pointed to by `variable`.                                                |
| `DeleteArg<N>()`           | Delete the `N`-th argument (0-based), which must be a pointer.                                           |
| `SaveArg<N>(pointer)`      | Save a copy of the `N`-th argument into `*pointer`.                                                      |
| `SaveArgByMove<N>(pointer)`| Move-save the `N`-th argument into `*pointer`. Requires move semantics support.                           |
| `SaveArgPointee<N>(pointer)`| Save the value pointed to by the `N`-th argument into `*pointer`.                                       |
| `SetArgReferee<N>(value)`  | Assign `value` to the object referenced by the `N`-th argument.                                         |
| `SetArgPointee<N>(value)`  | Set the value pointed to by the `N`-th argument to `value`.                                            |
| `SetArgumentPointee<N>(value)` | Deprecated alias for `SetArgPointee<N>(value)`; will be removed in future versions.                     |
| `SetArrayArgument<N>(first, last)` | Copy elements in `[first, last)` range into the array or iterator pointed to by the `N`-th argument.  |
| `SetErrnoAndReturn(error, value)` | Set the global `errno` to `error` and return `value`. Only works on platforms supporting `errno`.     |
| `Throw(exception)`          | Throws the provided copyable `exception` when the mock method is called. Introduced in v1.1.0.         |

### Example: Modifying Argument Values

```cpp
using ::testing::SetArgPointee;

EXPECT_CALL(mock, ProcessData(_, _))
    .WillOnce(DoAll(
        SetArgPointee<1>(100),  // Sets the value pointed to by arg #1
        Return(true)));

int output;
bool success = mock.ProcessData(42, &output);
// success == true
// output == 100
```

---

## Using Callables and Functions as Actions

You can specify that the mock method invokes a function, lambda, functor, or a method pointer.

| Action                                   | Description                                                                                            |
|-----------------------------------------|--------------------------------------------------------------------------------------------------------|
| `f`                                     | Invoke callable `f` with mock method's arguments; return its return value.                              |
| `Invoke(f)`                             | Similar to `f`, explicitly wraps the callable `f`.                                                    |
| `Invoke(object_pointer, &class::method)`| Invoke method on given object with mock method's arguments.                                           |
| `InvokeWithoutArgs(f)`                   | Invoke callable `f` with no arguments, ignoring the mock method's arguments.                           |
| `InvokeWithoutArgs(object_pointer, &class::method)` | Invoke nullary method on object without arguments.                                                 |
| `InvokeArgument<N>(arg1, arg2, ..., argk)` | Called on the mock method's `N`-th argument, which must be callable, passing `arg1, arg2, ..., argk`. |

### Notes on Invoking Callable Arguments

- Wrap arguments in `std::ref()` if you want to pass by reference. Otherwise, arguments are passed by value.
- `InvokeArgument` is especially useful for mocking asynchronous callbacks or functions supplied as arguments.

### Example: Invoking a Function Argument

```cpp
using ::testing::InvokeArgument;

EXPECT_CALL(mock, ProcessWithCallback(_, _))
    .WillOnce(InvokeArgument<1>(true));

// This will invoke the second argument given to ProcessWithCallback
// with argument `true`.
```

---

## Default Action

| Action          | Description                                               |
|-----------------|-----------------------------------------------------------|
| `DoDefault()`   | Perform the default action as specified by `ON_CALL` or the built-in default action. |

- `DoDefault()` cannot be used inside a composite action like `DoAll()`.
- Using `DoDefault()` in `ON_CALL()` is invalid and will cause a runtime error.

### Behavior

- If an `ON_CALL()` is present defining a default action, `DoDefault()` uses that.
- Otherwise returns built-in default values: typically zero for numerics, false for bool, nullptr for pointers, and default-constructed for default-constructible return types.
- Throws or aborts if no default value exists for the return type.

---

## Composite Actions

Composite actions allow you to combine multiple actions into one.

| Action                        | Description                                                                                     |
|------------------------------|------------------------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)`     | Perform all actions `a1` through `an`. All but the last must return void. The final's return is the composite's return value. |
| `IgnoreResult(a)`            | Perform action `a` and discard its return value (useful for void-returning mock methods).       |
| `WithArg<N>(a)`              | Extract the `N`-th argument of the mock method and feed it to action `a`.                       |
| `WithArgs<N1, N2, ..., Nk>(a)` | Extract the selected arguments (0-based) `N1, N2, ..., Nk` and feed them to action `a`.         |
| `WithoutArgs(a)`             | Perform action `a` without any arguments. Useful for adapting actions with no arguments.        |

### Example: Combining Actions

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoAll(
        SetArgPointee<0>(42),
        Return(true)));
```

This sets the first pointer argument to 42 and returns true.

---

## Defining Custom Actions

GoogleMock provides convenient macros for defining custom actions.

| Macro                      | Description                                                  |
|----------------------------|--------------------------------------------------------------|
| `ACTION(Name)`             | Defines an action `Name()` with no parameters.                |
| `ACTION_P(Name, p1)`       | Defines a parameterized action `Name(p1)`.                    |
| `ACTION_Pk(Name, p1, ..., pk)` | Defines an action with `k` parameters.                      |
| `ACTION_TEMPLATE(...)`     | Defines an action template with explicit template and value parameters. |

Inside the action body, you can refer to the mock arguments as `arg0`, `arg1`, ..., `args` (tuple of all arguments), and return type as `return_type`.

Custom actions provide flexibility for complex or domain-specific behaviors.

### Example: Custom Parameterized Action

```cpp
ACTION_P(Plus, n) {
  return arg0 + n;
}

EXPECT_CALL(mock, Compute(_))
    .WillOnce(Plus(5));
```

This adds 5 to the first argument when the mock method is called.

---

## Practical Tips & Best Practices

- Use `ReturnRef` instead of `Return` when your mock method returns a reference to prevent dangling references.
- If you modify arguments and also return a value, use `DoAll` to chain `SetArgPointee` and `Return` actions, placing `Return` last.
- Use `InvokeArgument` when a mock method receives a callback or functor argument to invoke it easily.
- For side-effect actions, prefer built-in actions like `SetArgPointee`, `Assign`, or `DeleteArg` where possible.
- When returning move-only values (e.g., `std::unique_ptr`), use lambdas or callables since `Return` can only return a move-only value once.
- Avoid using `DoDefault` inside `ON_CALL` statements.

<Note>
Use of `DoDefault()` allows test code to rely on the previously defined `ON_CALL` default behavior or built-in defaults but cannot be nested inside composite actions.
</Note>

<Warning>
Passing arguments by reference in `InvokeArgument` requires wrapping the argument in `std::ref()` to avoid passing references to temporaries.
</Warning>

---

## Troubleshooting Common Issues

| Issue                              | Cause & Solution                                                                                      |
| --------------------------------- | ----------------------------------------------------------------------------------------------------- |
| Mock method with move-only return fails on repeated calls. | `Return` with move-only type can only be executed once. Use a lambda or `WillRepeatedly` with factory lambda. |
| Unintentional copies of arguments in `InvokeArgument` | Wrap reference arguments in `std::ref()` to preserve references.                                      |
| `DoDefault()` used inside `ON_CALL()` causes runtime error. | `DoDefault` is not allowed in `ON_CALL`. Use it only in `EXPECT_CALL` or standalone actions.            |
| `SetArgPointee` used without `DoAll` with non-void return | Combine `SetArgPointee` with `Return` using `DoAll` to avoid return type mismatches.                   |

---

## See Also

- [Mocking Reference](../reference/mocking.md) - for `EXPECT_CALL`, `ON_CALL`, and `MOCK_METHOD`
- [Actions Reference](../reference/actions.md) - complete list and descriptions of built-in actions
- [Matchers Reference](../reference/matchers.md) - to specify argument matchers used in calls
- [Writing Custom Actions](../guides/real-world-workflows/custom-matchers-and-actions.md) - advanced usage
- [gMock Cheat Sheet](../gmock_cheat_sheet.md) - quick practical guide

---

This page focuses specifically on built-in action macros and parameterized actions that shape a mock object's behavior in response to method calls. It empowers you to configure return values, modify arguments, and control mock behavior seamlessly using GoogleMock.

---
