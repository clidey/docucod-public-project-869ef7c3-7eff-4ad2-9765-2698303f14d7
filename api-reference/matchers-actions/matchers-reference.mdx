---
title: "Matchers API"
description: "Reference guide to all built-in matchers (e.g., Eq, Ne, Lt, Contains, AllOf), chained operations, and how to write custom matchers. Explores advanced topics like container matchers and typed matchers with practical examples."
---

# Matchers API Reference Guide

This comprehensive guide provides a detailed overview of the built-in matchers in GoogleMock, including key matchers like `Eq`, `Ne`, `Lt`, and more complex ones like `AllOf`. You will also learn how to chain matchers, create custom matchers, and explore advanced matchers such as container and typed matchers, all demonstrated with practical examples.

---

## 1. Overview of Built-in Matchers

Matchers in gMock are predicates used to specify the conditions that arguments of mocked methods must satisfy. They are fundamental to specifying expectations and verifying behaviors in tests.

### Common Built-in Matchers

- **`Eq(value)`** — Matches arguments that equal the specified value.
- **`Ne(value)`** — Matches arguments not equal to the specified value.
- **`Lt(value)`** — Matches arguments less than the specified value.
- **`Le(value)`** — Matches arguments less than or equal to the specified value.
- **`Gt(value)`** — Matches arguments greater than the specified value.
- **`Ge(value)`** — Matches arguments greater or equal to the specified value.
- **`Contains(substring)`** — Matches strings or containers containing the given substring or element.
- **`AllOf(m1, m2, ...)`** — Matches if all sub-matchers match.
- **`AnyOf(m1, m2, ...)`** — Matches if any sub-matcher matches.
- **`Not(matcher)`** — Matches if the given matcher does not match.
- **`_` (Wildcard matcher)** — Matches any argument value.

### Usage Example
```cpp
using ::testing::Eq;
EXPECT_CALL(mock_obj, Foo(Eq(5)));  // Expects Foo called with argument equal to 5

// Combining matchers
using ::testing::AllOf, ::testing::Gt, ::testing::Ne;
EXPECT_CALL(mock_obj, Bar(AllOf(Gt(5), Ne(10))));  // arg > 5 and != 10
```

<Info>
Always use the namespace imports like `using ::testing::Eq;` to enhance code readability and avoid verbose notation.
</Info>

---

## 2. Matcher Composition and Chaining

### Combining Matchers

You can compose complex argument matchers using logical combinators:

- **`AllOf(...)`** — All contained matchers must match.
- **`AnyOf(...)`** — Any of the contained matchers matches.
- **`Not(...)`** — Negates the provided matcher.

Example:
```cpp
EXPECT_CALL(mock, SetValue(AllOf(Ge(1), Le(100))));  // value in [1, 100]
EXPECT_CALL(mock, SetName(Not(StartsWith("temp"))));  // name not starting with "temp"
```

### Multi-argument Matchers with `.With()` Clause

While simple matchers specify per-argument expectation, `.With()` allows matching arguments as a whole tuple:

```cpp
EXPECT_CALL(mock, SetBounds(_, _)).With(Lt());  // first arg < second arg
```
	
This enables constraints involving multiple arguments jointly.

<Note>
Only one `.With()` clause can be used on a single expectation and it must be first.
</Note>

---

## 3. Matching Containers

Matchers provide powerful support for STL containers and other iterable types.

### Core Container Matchers

- **`ElementsAre(e1, e2, ...)`** — Matches a container of exact size with elements matching the respective matchers in order.
- **`UnorderedElementsAre(e1, e2, ...)`** — Matches a container with elements matching the matchers in any order.
- **`Contain(element_matcher)`** — Checks whether the container contains at least one element matching the matcher.
- **`Each(m)`** — All elements of the container satisfy matcher `m`.
- **`SizeIs(matcher)`** — Checks container size against a matcher.

### Examples
```cpp
using ::testing::ElementsAre, ::testing::Gt, ::testing::_;

// Matches vector with exactly 3 elements: 1, >0, anything
EXPECT_CALL(mock, ProcessData(ElementsAre(1, Gt(0), _)));

// Matches unordered container containing elements 5, 3, and 2, in any order
EXPECT_CALL(mock, AnalyzeData(UnorderedElementsAre(5, 3, 2)));

// Container whose every element is positive
EXPECT_CALL(mock, FilterData(Each(Gt(0))));
```

### Nested Containers

Matchers can be nested to validate nested containers:

```cpp
EXPECT_CALL(mock, ComplexMethod(ElementsAre(ElementsAre(1, 2), ElementsAre(_, Gt(5)))));
```

<Callout>
For pointers to containers, wrap the matcher inside `Pointee()`. Works transparently with smart pointers.
</Callout>

---

## 4. Typed and Specialized Matchers

GoogleMock supports matchers that can be:

- **Monomorphic**: match only specific types (e.g., `Matcher<int>`).
- **Polymorphic**: match arguments of multiple types depending on usage (e.g., `Eq(5)`).

### Typed Equality and Comparison Matchers

- `Eq()`, `Ne()`, `Lt()`, `Gt()`, `Le()`, `Ge()` are polymorphic and adapt to argument types.

### Casting Matchers Safely

When type mismatch occurs between matchers and arguments, use `SafeMatcherCast<T>(m)` to safely cast matchers, ensuring type compatibility during compile-time.

Example:
```cpp
EXPECT_CALL(foo, DoThis(SafeMatcherCast<Derived*>(base_matcher)));
```

### Validated Field and Property Matching

Matchers include helpers to inspect members or results of getter methods:

- **`Field(&Class::field, matcher)`** — Matches objects whose member `field` matches.
- **`Property(&Class::getter, matcher)`** — Matches objects whose getter method returns a value matching the matcher.

Example:
```cpp
// Expects obj.foo.bar >= 10
EXPECT_CALL(mock_obj, Method(Field(&Foo::bar, Ge(10))));

// Matches objects whose .name() starts with 'John '
EXPECT_CALL(mock_obj, Process(Property(&Person::name, StartsWith("John "))));
```

---

## 5. Custom Matchers

GoogleMock allows defining your own matchers to capture specialized conditions.

### Using `MATCHER` Macros

You can define a custom matcher quickly using macros:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock_obj, Foo(IsDivisibleBy7()));
```

For parameterized matchers, use `MATCHER_P` and its variants:

```cpp
MATCHER_P(IsMultipleOf, divisor, "") {
  return (arg % divisor) == 0;
}

EXPECT_CALL(mock_obj, Foo(IsMultipleOf(3)));
```

### Writing Matcher Classes

For more complex or reusable cases, implement a matcher class providing:

- `bool MatchAndExplain(const T& value, std::ostream* os) const;`
- `void DescribeTo(std::ostream* os) const;`
- `void DescribeNegationTo(std::ostream* os) const;`

Followed by a wrapper factory returning a `testing::Matcher<T>`.

Example:
```cpp
class BarPlusBazEqMatcher {
 public:
  using is_gtest_matcher = void;

  explicit BarPlusBazEqMatcher(int expected_sum) : expected_sum_(expected_sum) {}

  bool MatchAndExplain(const Foo& f, std::ostream* /* os */) const {
    return (f.bar() + f.baz()) == expected_sum_;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "bar() + baz() equals " << expected_sum_;
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "bar() + baz() does not equal " << expected_sum_;
  }

 private:
  int expected_sum_;
};

::testing::Matcher<const Foo&> BarPlusBazEq(int expected_sum) {
  return BarPlusBazEqMatcher(expected_sum);
}
```

### Best Practices

- Ensure custom matchers are pure; avoid side effects.
- Include helpful failure explanations using `result_listener`.

<Warning>
All matchers must be pure functions and should not modify any state or perform actions such as calling mock methods.
</Warning>

---

## 6. Container and Typed Matcher Advanced Topics

### Container Matchers

You can construct matchers that rely on container sizes, elements, and order:

- `SizeIs(matcher)` for container size validation.
- `WhenSortedBy(comparator, matcher)` to apply a matcher after sorting by a comparator.
- `Pointwise(pair_matcher, container)` and `UnorderedPointwise` for element-wise matching with another container.

### Matching Map-Like Containers

Specialized matchers like `Key(matcher)` and `Pair(matcher_for_first, matcher_for_second)` help to match associative containers:

```cpp
EXPECT_THAT(my_map, Contains(Pair(Eq(5), StrEq("foo"))));
EXPECT_THAT(my_map, Contains(Key(Ge(3))));
```

### Matcher Sharing

Complex matchers can be stored in variables and reused efficiently since matcher objects are lightweight and reference counted.

```cpp
Matcher<int> in_range = AllOf(Gt(5), Le(10));
EXPECT_CALL(mock, Foo(in_range));
EXPECT_CALL(mock, Bar(in_range));
```

---

## 7. Practical Tips and Common Pitfalls

- **Use `using ::testing::...;`** at the top of your test file for cleaner matcher usage.
- Avoid over-specifying matchers to keep tests maintainable and less brittle.
- Use wildcard matcher `_` for arguments you do not care about.
- Combine matchers for clarity and specificity.
- When matching pointers, remember to use `Pointee(matcher)` to match the value pointed to.
- For overloaded methods, explicitly specify matcher types or use `Const()` wrapper to disambiguate.
- Use `SafeMatcherCast<T>()` when needing to cast matcher types safely.
- Always ensure your matcher expressions are pure and do not have side effects.

<Warning>
Matchers are only evaluated on call-time and may be invoked multiple times; they must not mutate state or depend on mutable external state.
</Warning>

---

## 8. Code Examples

### Basic Usage
```cpp
using ::testing::Eq;
using ::testing::Ne;
using ::testing::AllOf;
using ::testing::Contains;

EXPECT_CALL(mock_obj, Method(Eq(5)));
EXPECT_CALL(mock_obj, Method(AllOf(Gt(2), Ne(4))));
EXPECT_CALL(mock_obj, Method(Contains("hello")));
```

### Container Matchers
```cpp
using ::testing::ElementsAre;
using ::testing::UnorderedElementsAre;

EXPECT_CALL(mock_obj, ProcessData(ElementsAre(1, 2, 3)));
EXPECT_CALL(mock_obj, ProcessData(UnorderedElementsAre(3, 2, 1)));
```

### Custom Matcher Using `MATCHER`
```cpp
MATCHER(IsPositive, "") {
  return arg > 0;
}

EXPECT_CALL(mock_obj, SetValue(IsPositive()));
```

---

## 9. Troubleshooting

### Common Issues

- **Matcher Type Mismatch:** Use `SafeMatcherCast` or define explicit typed matchers.
- **Overloaded Methods:** Use typed matchers or `Const()` to disambiguate.
- **Unintended Side Effects:** Ensure matchers are pure functions without state.
- **Uninteresting Calls Warnings:** Use `NiceMock` to suppress warnings or add catch-all expectations.

### Tips

- Enable verbose logging with `--gmock_verbose=info` to trace matcher evaluations and failures.
- Use `EXPECT_THAT` assertions combined with matchers for expressive and detailed test validations.

---

## 10. Further Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — For recipes on custom matchers and actions.
- [Matchers Reference](https://google.github.io/googletest/matchers.html) — Official list and descriptions of matchers.
- [gMock For Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly tutorial.

---

# Summary
This page documents the comprehensive set of built-in matchers provided by GoogleMock, covering exact value matchers, logical combinators, container matchers, and ways to create custom matchers. It helps you write precise expectations to verify arguments in mock function calls effectively.

---