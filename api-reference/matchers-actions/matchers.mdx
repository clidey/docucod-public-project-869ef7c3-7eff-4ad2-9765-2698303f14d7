---
title: "Matchers API"
description: "Documentation of built-in and extensible matcher APIs, covering value comparisons, container checks, and customization workflows. Includes guides to creating custom matchers, combining matchers, and best practices for readable assertions."
---

# Matchers API

This page documents the comprehensive suite of built-in and extensible matcher APIs available in GoogleTest and GoogleMock. Matchers let you specify conditions on values and arguments in tests, expressing expectations clearly and concisely. This guide covers value comparison matchers, container matchers, string matchers, composing and combining matchers, and strategies for defining custom matchers to make your tests both expressive and robust.

---

## Introduction

Matchers are predicate-like objects used in assertions and mock expectations to validate values. They provide readable failure messages and enable flexible verification, going beyond simple equality checks. GoogleTest supports polymorphic and monomorphic matchers, allowing seamless use with various types.

Key concepts:

- **Polymorphic matcher**: Can match values of multiple types (e.g., `Eq(5)` matches int, double, etc).
- **Monomorphic matcher**: Matches a specific type.
- **Custom matcher**: User-defined matchers implementing specific matching logic.

Matchers are used with `EXPECT_THAT()` or inside `EXPECT_CALL()` for validating arguments.

Example:

```cpp
using ::testing::Gt;
EXPECT_THAT(value, Gt(0));  // Expects value to be greater than 0
```

---

## 1. Core Value Comparison Matchers

These matchers compare values using standard operators or predicates.

### Equality and Inequality

- `Eq(value)` – Matches if equal to `value`.
- `Ne(value)` – Matches if not equal to `value`.

Example:

```cpp
EXPECT_THAT(x, Eq(42));
EXPECT_THAT(y, Ne(0));
```

### Relational Operators

- `Lt(value)` – Matches if `< value`.
- `Le(value)` – Matches if `<= value`.
- `Gt(value)` – Matches if `> value`.
- `Ge(value)` – Matches if `>= value`.

Example:

```cpp
EXPECT_THAT(score, Ge(50));
EXPECT_THAT(count, Lt(10));
```

### NaN Checks

- `IsNan()` – Matches values that are NaN (floating-point).

### Approximate Floating-Point Matchers

Use these to compare floating-point numbers approximately, with optional tolerance:

- `DoubleEq(value)`, `FloatEq(value)` – Approximate equality, ignoring NaN.
- `NanSensitiveDoubleEq(value)`, `NanSensitiveFloatEq(value)` – Like above, but treats NaN as equal.
- `DoubleNear(value, max_abs_error)`, `FloatNear(value, max_abs_error)` – Approximate equality with max absolute error.

Example:

```cpp
EXPECT_THAT(pi, DoubleNear(3.14159, 1e-5));
```

---

## 2. Composing Matchers

Matchers can be combined to express complex conditions.

### Logical Composition

- `AllOf(m1, m2, ...)` – Matches if *all* matchers `m1, m2, ...` match.
- `AnyOf(m1, m2, ...)` – Matches if *any* matcher matches.
- `Not(m)` – Matches if matcher `m` does *not* match.

```cpp
EXPECT_THAT(value, AllOf(Ge(10), Lt(20)));
EXPECT_THAT(name, Not(IsEmpty()));
```

### Multi-Argument Matching

- `.With(...)` – Used in `EXPECT_CALL` to match all arguments as a tuple.
- `Args<indices...>(matcher)` – Matches selected arguments.
- `AllArgs(matcher)` – Matches all arguments as a tuple (synonym for `.With(AllArgs(matcher))`).

Example:

```cpp
EXPECT_CALL(mock, Func(_, _))
    .With(AllArgs(Lt()));  // First arg < second arg
```

### Containers as Matchers

Matchers like `ElementsAre()` and `UnorderedElementsAre()` allow matching container elements:

- `ElementsAre(m1, m2, ...)` – Matches container with elements in order matching `m1, m2, ...`.
- `UnorderedElementsAre(m1, m2, ...)` – Matches container with elements matching `m1, m2, ...` in any order.
- `Contains(m)` – Matches container that contains an element matching `m`.
- `Each(m)` – Matches container where *all* elements match `m`.
- `SizeIs(m)` – Matches containers where size matches matcher `m`.

Example:

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(set, Contains(Eq(42)));
EXPECT_THAT(map, Each(Key(Ge(0))));
```

---

## 3. String Matchers

GoogleTest provides special matchers to test strings effectively.

- `StrEq(s)` – Matches strings equal to `s`, considering embedded null characters.
- `StrNe(s)` – Matches strings not equal to `s`.
- `StrCaseEq(s)` – Matches strings equal to `s` ignoring case.
- `StrCaseNe(s)` – Matches strings not equal to `s` ignoring case.
- `HasSubstr(substring)` – Matches strings containing the substring.
- `StartsWith(prefix)` – Matches strings starting with the prefix.
- `EndsWith(suffix)` – Matches strings ending with the suffix.
- `MatchesRegex(regex)` – Matches strings fully matching the regex.
- `ContainsRegex(regex)` – Matches strings containing a substring matching regex.
- `WhenBase64Unescaped(matcher)` – Matches base64 encoded strings that match `matcher` after decoding.

Example:

```cpp
EXPECT_THAT(name, StartsWith("John"));
EXPECT_THAT(description, HasSubstr("error"));
EXPECT_THAT(text, MatchesRegex("^Hello.*World$"));
```

---

## 4. Pointer and Reference Matchers

- `IsNull()` – Matches any null pointer (raw or smart).
- `NotNull()` – Matches any non-null pointer (raw or smart).
- `Pointee(m)` – Matches pointer whose pointee matches matcher `m`. Treats null pointers as unmatched.
- `Ref(var)` – Matches an argument that references the same variable `var`.
- `Pointer(m)` – Matches pointer (raw or smart) with raw pointer matching matcher `m`.
- `Address(m)` – Matches objects whose address matches `m`.
- `WhenDynamicCastTo<T>(m)` – Matches pointer/reference dynamic cast to `T` matched by `m` (requires RTTI).

Example:

```cpp
EXPECT_THAT(ptr, NotNull());
EXPECT_CALL(mock, Func(Pointee(Eq(42))));
EXPECT_CALL(mock, Get(VAR))->WillOnce(ReturnRef(obj));
```

---

## 5. Field and Property Matchers

These matchers target specific members or properties of objects:

- `Field(&Class::member, matcher)` – Matches objects whose `member` matches `matcher`.
- `Field("member_name", &Class::member, matcher)` – Same as above, but with member name for error messages.
- `Property(&Class::getter, matcher)` – Matches objects whose property/method return matches `matcher`. Property method must be `const` and take no arguments.
- `Property("property_name", &Class::getter, matcher)` – Same as above with property name.

Example:

```cpp
EXPECT_THAT(foo, Field(&Foo::count, Ge(3)));
EXPECT_THAT(bar, Property(&Bar::name, StartsWith("John")));
```

---

## 6. Pair and Tuple Matchers

- `Pair(m1, m2)` – Matches a pair whose first element matches `m1` and second matches `m2`.
- `FieldsAre(m1, m2, ..., mN)` – Matches a tuple or aggregate type with fields matched piecewise by matchers.
- `Key(m)` – Matches a pair whose first field matches the inner matcher (common for maps).
- `Pointwise(pair_matcher, rhs_container)` – Matches a container whose elements correspond one-to-one with `rhs_container` via `pair_matcher`.
- `UnorderedPointwise(pair_matcher, rhs_container)` – Like `Pointwise` but order does not matter.

Example:

```cpp
EXPECT_THAT(map, Contains(Pair(Ge(10), "foo")));
EXPECT_THAT(tuples, FieldsAre(Eq(1), HasSubstr("abc")));
```

---

## 7. Optional and Variant Matchers

- `Optional(matcher)` – Matches an optional that is engaged and whose value matches `matcher`.
- `VariantWith<T>(matcher)` – Matches a `std::variant` containing a value of type `T` matching `matcher`.
- `AnyWith<T>(matcher)` – Matches `absl::any` containing a value of type `T` matching `matcher`.

Example:

```cpp
std::optional<int> opt = 5;
EXPECT_THAT(opt, Optional(Eq(5)));
```

---

## 8. Defining Custom Matchers

You can extend GoogleTest by writing your own matchers.

### Quick Definition using `MATCHER` Macros

- `MATCHER(name, description)` – Defines a matcher `name` with no parameters.
- `MATCHER_P(name, param, description)` – Defines a matcher with one parameter.
- Variants exist for up to 10 parameters: `MATCHER_P2`, `MATCHER_P3`, ..., `MATCHER_P10`.

Inside the matcher body, `arg` represents the value being matched, and `result_listener` can be used to provide detailed failure messages.

Example:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
EXPECT_THAT(value, IsEven());
```

### Implementing Matcher Interface

For more complex matchers, implement the `MatcherInterface<T>` interface with:

- `bool MatchAndExplain(const T& x, MatchResultListener* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

and use convenience factory functions to create instances.

---

## 9. Using Matchers

### In Assertions

Use `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)` for readable checks.

```cpp
EXPECT_THAT(result, Gt(0));
```

### In Mock Expectations

Use matchers to specify argument constraints:

```cpp
EXPECT_CALL(mock_object, MethodName(Eq(42), NotNull()));
```

### Matching Any Argument

- Use `_` to match any argument.
- Omit parameters in `EXPECT_CALL()` if the method is not overloaded to match any arguments.

### Combining Matchers

Use logical composition and container matchers to form expressive conditions.

### Casting Matchers

- `SafeMatcherCast<T>(m)` safely casts a matcher to match a related type.
- `MatcherCast<T>(m)` performs explicit casts and should be used cautiously.

---

## 10. Tips and Best Practices

- Use as general matchers as needed to avoid brittle tests.
- Use sequences (`InSequence`) or ordering clauses (`After`, `InSequence`) to manage call order.
- Use `NiceMock<T>` or `StrictMock<T>` to alter behavior for uninteresting calls.
- Avoid mocking private or protected methods without making them accessible.
- Use `ReturnPointee(&value)` for returning live values.
- Use `Invoke()` to call custom functions or lambdas as actions.

---

## 11. Troubleshooting Matcher Usage

- If a matcher fails to compile, check that the argument types match or use casting thoughtfully.
- If test failures produce unclear messages, consider adding additional explanations in custom matchers.
- Use `--gmock_verbose=info` for detailed logging of matcher matches and mock calls.

---

## References and Further Reading

- [Matchers Reference](reference/matchers.md) for a comprehensive list of built-in matchers.
- [Mocking Reference](reference/mocking.md) for understanding mocking macros and mocks.
- [gMock Cookbook](guides/essential-workflows/advanced-mocking-patterns.md) for advanced matcher and action patterns.
- [Writing New Matchers Quickly](concepts/extensibility-integrations/user-defined-assertions.md) to learn customization.

---

## Summary

This documentation covered the API and usage of matchers in GoogleTest/GoogleMock, with examples of built-in matchers, techniques for combining them, working with containers, strings, pointers, and custom types, and guidelines to write your own matchers. Proper understanding and use of matchers will elevate your test expressiveness and reliability.

---

### Example Code Snippet Combining Matchers

```cpp
using ::testing::_, ::testing::Gt, ::testing::HasSubstr, ::testing::Return;

// Simple matcher usage
EXPECT_THAT(value, Gt(0));

// Container matcher usage
EXPECT_THAT(results, ElementsAre(1, _, Gt(5)));

// Complex expectation with sequence
{
  InSequence s;
  EXPECT_CALL(mock, DoStep1()).WillOnce(Return(true));
  EXPECT_CALL(mock, DoStep2("abc", _))
      .WillOnce(Return(false));
}
```
