---
title: "Actions API"
description: "Comprehensive reference for defining, combining, and utilizing actions in mock behaviors. Documents built-in actions, variadic/template action support, and user-defined action patterns with practical, scenario-driven code samples."
---

# Actions API Reference

This reference details the comprehensive suite of actions available in GoogleMock for defining and combining behaviors when mock methods are called. Actions specify *what* a mock function should do upon invocation — from returning values and performing side effects, to invoking other functions or complex user-defined logic.

All actions reside in the `::testing` namespace and seamlessly integrate with expectations declared via `EXPECT_CALL` or default behaviors via `ON_CALL`.

---

## 1. Understanding Actions

When setting up mocks, specifying the behavior of a function call is essential. Actions define these behaviors — they describe the side effects or return values that result when a mocked method is invoked.

An action can range from built-in simple actions like returning a constant or throwing an exception, to composed or user-defined actions for advanced scenarios. Using actions correctly empowers you to simulate realistic behaviors and precise test conditions.

## 2. Built-in Actions

The following categories cover GoogleMock’s built-in actions, each designed to serve common mocking needs efficiently.

### 2.1 Returning Values
These actions specify what value a mock function returns.

| Action                     | Description                                             |
| -------------------------- | -------------------------------------------------------|
| `Return()`                 | Returns from a `void` function (does nothing).          |
| `Return(value)`            | Returns a copy or converted `value`. Conversion occurs when the expectation is set, not at call time. |
| `ReturnArg<N>()`           | Returns the `N`-th (0-based) argument passed to the mock function. |
| `ReturnNew<T>(a1, ..., ak)`| Creates and returns a new object `new T(a1, ..., ak)` on each call. Ownership is transferred to the caller. |
| `ReturnNull()`             | Returns a null pointer.                                  |
| `ReturnPointee(ptr)`       | Returns the value pointed to by `ptr`.                   |
| `ReturnRef(variable)`      | Returns a reference to `variable`. Useful for reference return types. |
| `ReturnRefOfCopy(value)`   | Returns a reference to a copy of `value`; the copy’s lifetime matches the action’s. |
| `ReturnRoundRobin({a1,...})` | Cycles through a list of values, returning the next on each call in a round-robin fashion. |

### 2.2 Side Effects
These allow modifying external variables or arguments as part of the mocked method call.

| Action                        | Description                                                   |
| -----------------------------| -------------------------------------------------------------|
| `Assign(&variable, value)`    | Assigns `value` to `variable`.                                |
| `DeleteArg<N>()`              | Deletes the `N`-th argument assumed to be a pointer.          |
| `SaveArg<N>(pointer)`         | Copies the `N`-th argument to `*pointer`.                      |
| `SaveArgByMove<N>(pointer)`   | Moves the `N`-th argument to `*pointer`.                       |
| `SaveArgPointee<N>(pointer)`  | Copies the value pointed to by the `N`-th argument to `*pointer`. |
| `SetArgReferee<N>(value)`    | Assigns `value` to the object referenced by the `N`-th argument. |
| `SetArgPointee<N>(value)`    | Assigns `value` to the object pointed to by the `N`-th argument. |
| `SetArrayArgument<N>(first, last)` | Copies a range `[first, last)` to the array pointed to by the `N`-th argument; does not take ownership. |
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` then returns `value`. Useful for syscall simulation. |
| `Throw(exception)`            | Throws the specified copyable exception. Available since v1.1.0. |

### 2.3 Using Functions, Functors, or Lambdas
You can directly specify that the mocked function calls another callable, optionally binding some or all arguments.

| Action                                        | Description                                   |
|-----------------------------------------------|-----------------------------------------------|
| `f`                                           | Invoke `f` with the same arguments as the mock function. `f` can be a free function, functor, or lambda. |
| `Invoke(f)`                                   | Like `f` above; can be function or functor. |
| `Invoke(object_pointer, &Class::method)`      | Invokes a method on an object pointer with mock function’s arguments. |
| `InvokeWithoutArgs(f)`                         | Invokes `f` without passing any mock function arguments. |
| `InvokeWithoutArgs(object_pointer, &Class::method)` | Invokes a no-argument method on an object pointer. |
| `InvokeArgument<N>(arg1, arg2, ..., argk)`    | Invokes the `N`-th argument (which must be callable) passing the provided arguments.

**Note:**
- Unused parameters can be declared as `Unused` in callables to improve readability.
- Pass reference arguments wrapped in `std::ref()` to ensure they pass by reference.

### 2.4 Default Action

| Action           | Description                      |
| ---------------- | --------------------------------|
| `DoDefault()`    | Performed when no explicit action is set. Executes the default behavior (from `ON_CALL` or built-in default).

> **Note:** `DoDefault()` cannot be used inside composite actions such as `DoAll()`.

### 2.5 Composite Actions
Composite actions perform multiple actions sequentially within a single invocation.

| Action                   | Description                                           |
| ------------------------ | ----------------------------------------------------|
| `DoAll(a1, a2, ..., an)` | Perform all actions `a1` to `an` sequentially. Return the result of `an`. First `n-1` must return `void` and receive arguments read-only. |
| `IgnoreResult(a)`        | Executes `a` and ignores its return value. `a` must return a non-void type. |
| `WithArg<N>(a)`          | Passes the `N`-th argument of the mock function to `a` and executes it. |
| `WithArgs<N1, N2, ..., Nk>(a)` | Pass selected arguments to `a` and performs it.
| `WithoutArgs(a)`         | Perform `a` without any arguments.

## 3. Defining Custom Actions

GoogleMock provides macros for conveniently defining custom actions when the built-in ones are insufficient.

- `ACTION(name) { statements; }` defines a zero-parameter action named `name`.
- `ACTION_P(name, param) { statements; }` defines an action parameterized by one argument.
- `ACTION_P2`, `ACTION_P3`, ..., `ACTION_P10` allow 2-10 parameters.

Inside the action body, you can reference:

- Arguments of the mock function as `arg0`, `arg1`, ..., and their types as `arg0_type`, `arg1_type`, etc.
- The entire argument tuple as `args` and its type as `args_type`.
- The return type with `return_type`.
- The mock function type as `function_type`.

**Important:**
- These macros must be declared in namespace scope (not inside classes or functions).
- Typically, the return value of the action is the value of the last statement.

### Example: Basic Custom Action

```cpp
ACTION(IncrementArg1) {
  return ++(*arg1);
}

// Usage:
EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementArg1());
```

### Example: Parameterized Action

```cpp
ACTION_P(Add, n) {
  return arg0 + n;
}

// Usage:
EXPECT_CALL(mock, Foo(_)).WillOnce(Add(5));
```

### Writing Advanced Template Actions

Use `ACTION_TEMPLATE` to define actions with explicit template parameters:

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(std::get<k>(args));
}

// Usage:
int n;
EXPECT_CALL(mock, Foo(_, _)).WillOnce(DuplicateArg<1, unsigned char>(&n));
```

## 4. Practical Usage Tips

- **Combining actions:** Use `DoAll()` to perform side effects and then return a value.
- **Selecting arguments:** Use `WithArg<N>`, `WithArgs<N1, N2, ...>` and `WithoutArgs()` to adapt argument lists for inner actions.
- **Ignoring unused arguments:** Declare unused parameters in your callables as `Unused` for simpler code.
- **Sharing actions:** Actions are lightweight copyable handles; sharing stateful actions can lead to unexpected shared state.
- **Testing side effects:** Side-effect actions such as `SetArgPointee<N>()` efficiently set output parameters.
- **Move-only types:** Move-only types (e.g. `std::unique_ptr`) are supported in mocks and actions, typically with `WillOnce()` and lambdas.

## 5. Examples

### Returning incremented argument

```cpp
ACTION(IncrementArg1) {
  return ++(*arg1);
}

EXPECT_CALL(mock, Modify(_)).WillOnce(IncrementArg1());
```

### Returning value of a smart pointer at call time

```cpp
EXPECT_CALL(mock, GetValue())
    .WillRepeatedly(ReturnPointee(&external_value));

external_value = 5;
EXPECT_EQ(5, mock.GetValue());
```

### Performing multiple actions, including setting output and returning

```cpp
EXPECT_CALL(mock, Process(_))
    .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));
```

### Using a lambda as a custom action

```cpp
EXPECT_CALL(mock, Compute(_, _))
    .WillOnce([](int a, int b) { return a + b; });
```

### Invoking a callable passed as an argument

```cpp
EXPECT_CALL(mock, DoWork(_, _))
    .WillOnce(InvokeArgument<1>(true));

// Calls the 1st argument (0-based), assumed callable, with `true`.
```

### Delegating default behavior to a real object

```cpp
ON_CALL(mock, Foo(_))
    .WillByDefault([&real](int x) { return real.Foo(x); });
```

## 6. Troubleshooting & Common Pitfalls

- `DoDefault()` cannot be used inside composite actions — it will cause runtime errors.
- When returning references, always use `ReturnRef()` or `ReturnRefOfCopy()`; returning references with `Return()` will produce compilation or runtime errors.
- Actions combining side effects and returns must use `DoAll()` with the return action last.
- Ensure your custom actions correctly handle argument references and lifetimes to prevent dangling references.

## 7. Further Reading & Related Topics

- [Mocking Reference](../api-reference/core-testing-apis/mocking-apis.md) for how actions fit into mock expectations.
- [Matchers API](../api-reference/matchers-actions/matchers.md) describes how to specify argument matchers for expectations.
- [gMock Cookbook](../guides/getting-started/basic-mocking.md) for practical recipes involving actions.
- [Advanced Mocking Patterns](../guides/essential-workflows/advanced-mocking-patterns.md) to extend the capabilities of actions.

---

## Source Code & Definition

Most actions are implemented via the `Action` and `ActionInterface` classes, and additional macros and helper templates in `gmock-actions.h` and `gmock-more-actions.h`. These headers define the core built-in actions and support for variadic and template actions.

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-actions.h", "range": "1-563"},{"path": "googlemock/include/gmock/gmock-more-actions.h", "range": "1-250"}]} />

---