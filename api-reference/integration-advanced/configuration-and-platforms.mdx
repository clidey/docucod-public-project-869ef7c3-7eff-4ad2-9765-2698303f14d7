---
title: "Configuration and Platform Adaptation"
description: "Summarizes configuration options for various platforms and compilers, including portability layers, platform abstraction headers, and customization points for adapting the framework to embedded or specialized environments. Covers environment detection macros and integration touchpoints for extending GoogleTest/GoogleMock functionality."
---

# Configuration and Platform Adaptation

GoogleTest and GoogleMock are designed to work seamlessly across a wide variety of platforms, compilers, and environments. This documentation page summarizes the available configuration options, platform abstraction layers, and customization points you can use to adapt the framework for embedded or specialized development contexts.

---

## 1. Platform and OS Detection

GoogleTest internally detects and defines macros for the platform and operating system it is being compiled on, enabling conditional compilation to tailor functionality. These macros are available for use if you need to adapt your code for different platforms.

Some key platform macros include:

| Macro Name                | Description                         |
|---------------------------|-----------------------------------|
| `GTEST_OS_WINDOWS`        | Microsoft Windows general          |
| `GTEST_OS_WINDOWS_DESKTOP`| Windows Desktop                   |
| `GTEST_OS_LINUX`          | Linux                            |
| `GTEST_OS_MAC`            | macOS                            |
| `GTEST_OS_IOS`            | iOS (iPhone/iPad)                |
| `GTEST_OS_ANDROID`        | Android (sub-macro of Linux)     |
| `GTEST_OS_CYGWIN`         | Cygwin environment               |
| others (BSD, Solaris, QNX, etc.) | Various other OS platforms  |

These macros are automatically set by the framework's detection headers such as `gtest-port-arch.h`. They never are zero; they are either defined as 1 or not defined at all.

**Usage Example:**

```cpp
#if defined(GTEST_OS_WINDOWS)
  // Windows-specific code
#elif defined(GTEST_OS_LINUX)
  // Linux-specific code
#endif
```

---

## 2. Configuration Macros and Environment Overrides

GoogleTest allows fine-tuning of features via compiler command-line macros, which begin with `GTEST_`.

### Important Configuration Macros:

| Macro                   | Purpose                                                    | Values                  |
|-------------------------|------------------------------------------------------------|-------------------------|
| `GTEST_HAS_PTHREAD`      | Force enable/disable pthread support                      | `1` or `0`              |
| `GTEST_IS_THREADSAFE`    | Indicates if the framework is thread-safe                  | `1` or `0` (read-only)  |
| `GTEST_HAS_EXCEPTIONS`   | Control whether exceptions support is enabled             | `1` or `0`              |
| `GTEST_CREATE_SHARED_LIBRARY` | Build GoogleTest as a shared library (DLL on Windows) | `1` or `0`              |
| `GTEST_LINKED_AS_SHARED_LIBRARY` | Mark tests built against shared GoogleTest lib      | `1` or `0`              |
| `GTEST_DONT_DEFINE_TEST` and related | Rename macros to avoid clashes (e.g. `TEST` to `GTEST_TEST`) | `1` or `0`              |

If you find the automatic detection unsuitable, you may explicitly set these macros on the compiler command line.

### Example (CMake):

```cmake
add_compile_definitions(GTEST_HAS_PTHREAD=1)
```

---

## 3. Portability and Platform Abstraction

GoogleTest hides platform differences behind internal headers such as `gtest-port.h` and `gtest-port-arch.h`. These provide:

- **File system operations:** OS-specific file APIs are abstracted.
- **Synchronization primitives:** Abstract `Mutex`, `MutexLock`, and `ThreadLocal` classes adapt to pthreads, Windows API, or no-op equivalents on non-threaded environments.
- **OS API wrappers:** Portable wrappers for common C functions with platform-specific names.

This abstraction ensures that the core framework behaves consistently regardless of environment peculiarities.

### Thread Safety

GoogleTest supports thread-safe operation when pthreads or native Windows APIs are available. The presence of threading support can be checked programmatically using:

```cpp
#ifdef GTEST_IS_THREADSAFE
// Code that relies on threading
#endif
```

If your environment does not have threading or you disable threading support manually (e.g., `-DGTEST_HAS_PTHREAD=0`), GoogleTest compiles with dummy mutex implementations that do nothing.

---

## 4. Customizing GoogleTest Behavior

### Controlling Macro Name Clashes

If GoogleTest macros conflict with other code in your project, you can instruct GoogleTest to rename its macros by defining the following macros to `1` during compilation:

| Original Macro | Configuration Macro        |
|----------------|---------------------------|
| `TEST`         | `GTEST_DONT_DEFINE_TEST`   |
| `ASSERT_EQ`    | `GTEST_DONT_DEFINE_ASSERT_EQ` |
| (others like `EXPECT_EQ`, `FAIL`, `SUCCEED`) | Corresponding `GTEST_DONT_DEFINE_*` macros |

In this mode, your code must use the prefixed GoogleTest macros, e.g., `GTEST_TEST` instead of `TEST`.

### Enabling Building as Shared/DLL Libraries

To build GoogleTest and your test binaries as shared libraries, pass these definitions:

- **For GoogleTest library:** `-DGTEST_CREATE_SHARED_LIBRARY=1`
- **For tests linking to GoogleTest DLL:** `-DGTEST_LINKED_AS_SHARED_LIBRARY=1`

This is particularly relevant in Windows environments to handle DLL symbol exports correctly.

### Forcing Pthread Usage

Sometimes, GoogleTest might not automatically detect pthread availability, especially in custom embedded environments. You can force it with:

```bash
-DGTEST_HAS_PTHREAD=1
```

Remember that you must link with the pthread library manually if using this flag outside of CMake.

---

## 5. Building GoogleTest and GoogleMock

### Using CMake

GoogleTest provides modern CMakeLists allowing both standalone builds and inclusion into existing projects.

Typical standalone build:

```sh
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
mkdir build && cd build
cmake ..
make
sudo make install
```

To disable GoogleMock and only build GoogleTest:

```sh
cmake .. -DBUILD_GMOCK=OFF
```

### Embedding GoogleTest in Your Project

You can add GoogleTest as a subdirectory to your own CMake build tree:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL "https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip"
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # Fix for MSVC runtimes
FetchContent_MakeAvailable(googletest)

add_executable(your_test your_test.cc)
target_link_libraries(your_test gtest_main)
add_test(NAME your_test COMMAND your_test)
```

Ensure your minimum CMake version is 3.14 or higher to use `FetchContent` effectively.

### Visual Studio Runtime Mismatch

Visual Studio projects by default link C runtimes dynamically, whereas GoogleTest links them statically. This mismatch causes linker errors.

Override the default behavior in CMake by setting:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

---

## 6. Embedded and Specialized Environments

GoogleTest can be configured for embedded or limited environments where OS facilities such as threads or file systems are unavailable or limited. The portability layer will:

- Provide dummy implementations when features are missing.
- Omit death tests or stream redirection where unsupported.
- Allow disabling exceptions (`GTEST_HAS_EXCEPTIONS` set to 0).

You can define the relevant macros manually, or include `custom/gtest-port.h` to override or supply definitions specific to your environment.

---

## 7. Environment Detection Macros Summary

GoogleTest defines feature detection macros that indicate availability of key OS features:

| Macro                      | Description                         |
|----------------------------|-----------------------------------|
| `GTEST_HAS_PTHREAD`         | pthreads support detected          |
| `GTEST_HAS_EXCEPTIONS`      | Compiler exceptions enabled        |
| `GTEST_HAS_RTTI`            | Runtime Type Information enabled   |
| `GTEST_HAS_POSIX_RE`        | POSIX regex available              |
| `GTEST_HAS_STD_WSTRING`     | std::wstring supported             |
| `GTEST_HAS_STREAM_REDIRECTION` | Support for I/O redirection    |
| `GTEST_HAS_DEATH_TEST`      | Death test support enabled         |

Check these macros to conditionally compile test code or features.

---

## 8. Summary Example

A minimal example showing conditional compilation based on detected environment:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);

#if defined(GTEST_OS_WINDOWS)
  std::cout << "Running tests on Windows" << std::endl;
#elif defined(GTEST_OS_LINUX)
  std::cout << "Running tests on Linux" << std::endl;
#endif

  return RUN_ALL_TESTS();
}
```

---

## 9. Further Integration Touchpoints

- **Flag Definitions and Handling:** Both GoogleTest and GoogleMock provide command-line flag support. Macros such as `GTEST_FLAG(name)` and `GMOCK_FLAG(name)` expose access to flags.
- **Abseil and RE2 Integration:** When built with Abseil, GoogleTest defers flag and regex handling to Abseil.
- **Custom Port Headers:** For specialized platforms, place overrides in `custom/gtest-port.h` or `custom/gmock-port.h` to adapt features.

---

## 10. Troubleshooting Common Platform Issues

- **Pthread Linker Errors:** If enabling pthread support manually, ensure the `-pthread` flag is passed both to compiler and linker.
- **Macro Conflicts:** Use the `GTEST_DONT_DEFINE_XXX` macros to rename conflicting GoogleTest macros.
- **Visual Studio Runtime Mismatch:** Use the `gtest_force_shared_crt` option to align runtimes.
- **Building on Embedded Systems:** Explicitly disable unsupported features by setting macros like `GTEST_HAS_PTHREAD=0` and `GTEST_HAS_EXCEPTIONS=0`.

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Build Integration Guide](/guides/integration_real_world_use/build_system_integration)
- [GoogleMock Mock Creation API Reference](/api-reference/mocking-api/mock-creation)
- [Supported Platforms Overview](/docs/platforms.md)

---

## Source Links

<Source url="https://github.com/google/googletest" branch="main" paths={[{path: "googletest/include/gtest/internal/gtest-port-arch.h", range: "1-100"}, {path: "googletest/include/gtest/internal/gtest-port.h", range: "1-400"}, {path: "googletest/README.md", range: "1-150"}]} />

---