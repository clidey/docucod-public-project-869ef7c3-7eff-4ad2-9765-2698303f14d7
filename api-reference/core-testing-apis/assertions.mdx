---
title: "Assertions & Expectations"
description: "Covers the full range of built-in assertions, including equality checks, exception assertions, death tests, and user-defined assertions. Explains fatal vs. non-fatal failures, with real-world code snippets and recommendations for effective test writing."
---

# Assertions & Expectations

Explore the full spectrum of GoogleTest's built-in assertions, empowering you to verify program correctness effectively and robustly. This page guides you through fundamental concepts, assertion types, expectation mechanisms, and best practices to write clear, reliable tests.

---

## Understanding Assertions in GoogleTest

Assertions are at the heart of test verification. They check whether your code behaves as expected and report failures when it does not. GoogleTest assertions come in pairs: `EXPECT_` macros generate **non-fatal failures** that allow the test to continue, while `ASSERT_` macros generate **fatal failures** aborting the current function immediately.

This distinction lets you control the flow of your tests - use non-fatal assertions when the test can still make sense after failure, and fatal assertions when continuing is pointless or unsafe.

### Key Points About Assertions
- All assertions support streaming custom failure messages via `<<`, providing rich context.
- Assertions evaluate arguments exactly once, avoiding side effects.
- Wide string support ensures UTF-8 output for internationalization.


## Common Assertion Types

### Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Pass if `condition` is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Pass if `condition` is false.

These are foundational and often used to check boolean logic or predicate results.

### Binary Comparisons

GoogleTest supports all standard comparisons with clear error messages:

- Equality: `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`
- Inequality: `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`
- Less-than: `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)`
- Less-or-equal: `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)`
- Greater-than: `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)`
- Greater-or-equal: `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)`


> **Tip:** Use `EXPECT_STREQ` or `EXPECT_STRCASEEQ` for C string comparisons to avoid pointer comparisons.

### String Assertions

GoogleTest distinguishes between C-style string pointer equality and content equality. Use:

- `EXPECT_STREQ(str1, str2)` for content equality
- `EXPECT_STRNE(str1, str2)` for content inequality
- Case-insensitive versions: `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`


### Floating-Point Comparisons

Due to rounding, exact equality is often unsuitable for floating-point types. GoogleTest provides:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)` (float precision)
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)` (double precision)
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`: Checks that the difference is within `abs_error`.

### Exception Assertions

Verify exception behavior when exceptions are enabled:

- `EXPECT_THROW(statement, exception_type)` verifies `statement` throws `exception_type`.
- `EXPECT_ANY_THROW(statement)` verifies `statement` throws any exception.
- `EXPECT_NO_THROW(statement)` verifies `statement` throws no exceptions.


### Explicit Success and Failure

- `SUCCEED()` generates a success mark but does not end the test.
- `FAIL()` generates a fatal failure and aborts the current function.
- `ADD_FAILURE()` generates a nonfatal failure but lets the function continue.

Use these for control-flow based verification or in situations not expressible as simple boolean assertions.

---

## Expectation Mechanisms for Mocked Objects

GoogleTest integrates tightly with GoogleMock to allow **expectations** on mock method calls, specifying:

- Which methods will be called
- Argument match conditions
- Call cardinality (how many times)
- Ordering constraints
- What actions to perform when called

This mechanism leverages the `EXPECT_CALL` macro.

### Setting Expectations with `EXPECT_CALL`

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .With(multi_argument_matcher)  // Optional
    .Times(cardinality)            // Optional
    .InSequence(seq1, seq2, ...)   // Optional
    .After(exp1, exp2, ...)        // Optional
    .WillOnce(action)              // Optional
    .WillRepeatedly(action)        // Optional
    .RetiresOnSaturation();        // Optional
```

Each clause refines the expectation:

- `.Times()` specifies how many times this expectation should be matched.
- `.InSequence()` requires calls to occur in the order assigned to the same sequence.
- `.After()` imposes partial ordering dependencies on expectations.
- `.WillOnce()` and `.WillRepeatedly()` specify the behavior/results for calls.
- `.RetiresOnSaturation()` makes the expectation inactive once fulfilled.

If `.Times()` is omitted, GoogleMock infers it based on the presence and number of `.WillOnce()` and `.WillRepeatedly()` clauses.

### Using Matchers for Arguments

Matchers define what arguments to expect. Use `_` as a wildcard matcher if you don't care about an argument:

```cpp
EXPECT_CALL(foo, DoThis(_))  // matches any argument
```

You can use more precise matchers like `Eq()`, `Ge()`, `Lt()` or even custom matchers for detailed validation.

### Handling Multiple Expectations on Same Method

GoogleMock searches expectations in reverse order, so specific expectations should be declared after general catch-all expectations. This enables layering behavior and overrides cleanly.

### Ordering Calls

The `InSequence` utility lets you group expectations to require strict order:

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Foo());
  EXPECT_CALL(mock, Bar());
}
```

Now `Foo()` must be called before `Bar()`.

### Uninteresting, Unexpected, and Excessive Calls

- **Uninteresting calls:** methods called without any `EXPECT_CALL` set. They use default action and generate warnings by default.
- **Unexpected calls:** method calls that do not match any active expectation - *always an error*.
- **Excessive calls:** method calls exceeding the specified cardinality - *always an error*.


> **Tip:** Use `NiceMock<>` to suppress uninteresting call warnings or `StrictMock<>` to treat such calls as failures.

---

## Using Built-in Matchers and Actions

GoogleTest's powerful built-in matchers facilitate flexible argument matching.

You can combine matchers with logical operators (`AllOf`, `AnyOf`, `Not`), and match complex data structures.

Actions specify what happens when a mock method is invoked:

- `Return(value)` returns the specified value.
- `ReturnRef(variable)` returns a reference.
- `Invoke(function_or_lambda)` calls a user function.
- `SetArgPointee<N>(value)` sets the N-th argument by pointer.
- `DoAll(actions...)` executes multiple actions in sequence (return value from last).

Use these building blocks to create concise, expressive mock behavior.

---

## Best Practices and Common Pitfalls

- Always set expectations before exercising mocks to avoid undefined behavior.
- Prefer `ON_CALL` to set default behavior without verifying calls.
- Use `EXPECT_CALL` sparingly to check the interactions you're interested in.
- Beware that expectations are "sticky": they remain active after saturation unless `RetiresOnSaturation()` is used.
- Leaked mocks prevent verification; use `Mock::AllowLeak(mock_object)` if intentional.
- Control verbosity with `--gmock_verbose` flag (`info`, `warning`, or `error`) to get appropriate diagnostic detail.

---

## Advanced Assertion Techniques

GoogleTest supports advanced assertions for complex use cases:

### Predicate Assertions

Use predicates and predicate-formatters to provide custom assertion logic and detailed failure messages.

```cpp
EXPECT_PRED2(MyPredicate, val1, val2);
EXPECT_PRED_FORMAT2(MyPredicateFormatter, val1, val2);
```

### Exception and Death Assertions

- Use `EXPECT_THROW`, `EXPECT_ANY_THROW`, `EXPECT_NO_THROW` to verify exception behavior.
- Use `EXPECT_DEATH`, `EXPECT_EXIT` to verify that code terminates with expected output or exit codes.

### Floating Point and String Matchers

Leverage GoogleTest’s special floating-point assertions like `EXPECT_FLOAT_EQ` and regex string matchers with `EXPECT_THAT` for expressive checks.

### Using `EXPECT_THAT`

Combine GoogleTest with GoogleMock's matcher library to write expressive, readable assertions:

```cpp
EXPECT_THAT(actual_value, StartsWith("Hello"));
EXPECT_THAT(container, ElementsAre(1, 2, 3));
```

---

## Troubleshooting and Debugging

- Enable verbose logging with `--gmock_verbose=info` to see detailed mock call traces.
- Use `SCOPED_TRACE` to add context to failures in deeply nested functions.
- Trigger heap checkers or force verification via `Mock::VerifyAndClearExpectations()` if mock verification does not happen at expected times.

---

## Related Documentation

- [GoogleTest Primer](primer.md): Introduction to writing tests
- [gMock for Dummies](docs/gmock_for_dummies.md): Beginner’s guide to mocking
- [Mocking Reference](docs/reference/mocking.md): Detailed API for mocking
- [Assertions Reference](docs/reference/assertions.md): Full assertion macros
- [gMock Cookbook](docs/gmock_cook_book.md): Advanced mocking recipes
- [Writing Maintainable Tests](guides/troubleshooting-and-patterns/writing-maintainable-tests.md): Best practices

---

## Summary

GoogleTest assertions and GoogleMock expectations form a flexible foundation to verify both direct results and interaction semantics. Learning to leverage matchers, call cardinalities, ordering constraints, and expressive failure reports will empower you to write robust, maintainable tests that precisely capture your code’s intended behavior.

---

<Steps>
<Step title="Begin with Simple Assertions">
Start by verifying boolean conditions and equality with `EXPECT_TRUE`, `EXPECT_EQ`.
</Step>
<Step title="Use Matchers for Complex Argument Checking">
Employ matchers like `_`, `Ge()`, `HasSubstr()` in `EXPECT_CALL` to specify detailed call expectations.
</Step>
<Step title="Refine Call Expectations">
Apply clauses like `Times()`, `InSequence()`, and `After()` to model call count and order.
</Step>
<Step title="Control Mock Strictness">
Choose between `NaggyMock`, `NiceMock`, and `StrictMock` based on test requirements.
</Step>
<Step title="Leverage Advanced Assertions and Custom Matchers">
Utilize predicate assertions, death assertions, and custom matchers for unique needs.
</Step>
</Steps>

---