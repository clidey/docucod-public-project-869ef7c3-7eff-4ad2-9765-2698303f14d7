---
title: "Assertions and Matchers"
description: "Provides a categorized reference of built-in and user-defined assertions, along with powerful matcher utilities. Covers syntax, parameterization, and common patterns for verifying code correctness."
---

# Assertions and Matchers Reference

This page provides a categorized reference of built-in and user-defined assertions, along with powerful matcher utilities in GoogleTest. It covers their syntax, parameterization, and common patterns for verifying code correctness effectively.

---

## 1. Overview of Assertions and Matchers

Assertions are the foundation of test verification in GoogleTest. They validate conditions or expressions in your C++ test code and report success, nonfatal failures, or fatal failures. Matchers provide a flexible way to verify complex expectations on values beyond simple comparisons.

- **Assertion Pairs:** Each assertion macro comes in two variants:
  - `EXPECT_*`: Reports a nonfatal failure allowing the test to continue.
  - `ASSERT_*`: Reports a fatal failure that aborts the current function.

- **Matchers:** Used to enhance assertions by offering composable and expressive condition checks. They work seamlessly with `EXPECT_THAT` and `ASSERT_THAT` macros.

### Key Concepts

- Assertions evaluate expressions exactly once, preventing side-effect duplication.
- Assertions work with streaming user messages using `<<` for added debug info.
- Predicate assertions allow custom predicates or predicate-formatters for detailed diagnostics.
- Floating-point comparisons come with tolerance handling and ULP-based checks.
- Exception assertions verify if code throws or does not throw expected exceptions.

The following sections describe these with examples and best practices.

---

## 2. Explicit Success and Failure Assertions

Sometimes the test flow rather than a boolean check determines test success or failure.

### SUCCEED()

- Use to document or explicitly mark a successful step.
- Does not affect overall test outcome but marks an explicit "success".

```cpp
SUCCEED();
SUCCEED() << "Explicit success message.";
```

### FAIL()

- Reports a fatal failure and aborts the current void-returning function.
- Use when test logic reaches an unexpected or erroneous point.

```cpp
if (unexpected_condition) {
  FAIL() << "Unexpected condition met.";
}
```

### ADD_FAILURE()

- Reports a nonfatal failure allowing the test to continue.
- Useful inside helper functions or complex checks.

```cpp
if (!VerifyData()) {
  ADD_FAILURE() << "Data verification failed.";
}
```

### ADD_FAILURE_AT(file, line)

- Reports a nonfatal failure at specified source location.

```cpp
ADD_FAILURE_AT("foo.cc", 42) << "Issue found here.";
```

---

## 3. Boolean Assertions

### EXPECT_TRUE(condition) / ASSERT_TRUE(condition)

- Verifies condition evaluates to true.
- On failure, prints the condition and actual value.

```cpp
EXPECT_TRUE(is_ready) << "Expected ready state.";
ASSERT_TRUE(CheckStatus());
```

### EXPECT_FALSE(condition) / ASSERT_FALSE(condition)

- Verifies condition evaluates to false.

```cpp
EXPECT_FALSE(has_error);
ASSERT_FALSE(is_empty()) << "Collection should not be empty.";
```

### Predicate with AssertionResult

To improve failure messages when using complex boolean checks, write predicates returning `testing::AssertionResult` instead of raw bool:

```cpp
::testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) {
    return ::testing::AssertionSuccess() << n << " is even";
  } else {
    return ::testing::AssertionFailure() << n << " is odd";
  }
}

EXPECT_TRUE(IsEven(value));
```

This approach prints detailed diagnostic info on failures and successes.

---

## 4. Binary Comparison Assertions

GoogleTest provides macros for verifying relational comparisons.

| Macro         | Check                         | Behavior                               |
| ------------- | -----------------------------| ------------------------------------- |
| EXPECT_EQ / ASSERT_EQ | `val1 == val2`             | Equality check, prints values on fail|
| EXPECT_NE / ASSERT_NE | `val1 != val2`             | Inequality check                      |
| EXPECT_LT / ASSERT_LT | `val1 < val2`              | Less than check                      |
| EXPECT_LE / ASSERT_LE | `val1 <= val2`             | Less than or equal check             |
| EXPECT_GT / ASSERT_GT | `val1 > val2`              | Greater than check                   |
| EXPECT_GE / ASSERT_GE | `val1 >= val2`             | Greater than or equal check          |

### Important Notes

- Pointer types are compared by address.
- To compare C strings by content, use string assertions (see next section).
- Streaming outputs actual and expected values for clarity.

Example:

```cpp
EXPECT_EQ(result, expected) << "Result differs from expected.";
ASSERT_LT(value, limit) << "Value exceeds limit.";
```

---

## 5. String Assertions

Specialized assertions exist to compare C-style strings (`const char*`, `wchar_t*`).

| Macro            | Description                                      |
|------------------|------------------------------------------------|
| EXPECT_STREQ / ASSERT_STREQ | Verifies two C strings have the same content.   |
| EXPECT_STRNE / ASSERT_STRNE | Verifies two C strings differ in content.       |
| EXPECT_STRCASEEQ / ASSERT_STRCASEEQ | Verifies two C strings equal, ignoring case. |
| EXPECT_STRCASENE / ASSERT_STRCASENE | Verifies two C strings differ, ignoring case. |

Example:

```cpp
EXPECT_STREQ("Hello", received);
ASSERT_STRNE(ptr1, ptr2);
EXPECT_STRCASEEQ("foo", "FOO");
```

Fails print clear messages with actual values displayed as UTF-8.

---

## 6. Floating-Point Comparison Assertions

Due to rounding and precision limits, use specialized macros for floating-point equality.

| Macro             | Description                                                          |
|-------------------|----------------------------------------------------------------------|
| EXPECT_FLOAT_EQ / ASSERT_FLOAT_EQ | Approximately equal floats (within 4 ULPs).                      |
| EXPECT_DOUBLE_EQ / ASSERT_DOUBLE_EQ | Approximately equal doubles (within 4 ULPs).                    |
| EXPECT_NEAR / ASSERT_NEAR           | Values differ by no more than an absolute error threshold.     |

Example:

```cpp
EXPECT_FLOAT_EQ(3.14f, computed_value);
ASSERT_NEAR(1.0, measured, 0.001);
```

---

## 7. Exception Assertions

These macros verify whether code throws expected exceptions. Requires exception support enabled.

| Macro                | Description                                            |
|----------------------|--------------------------------------------------------|
| EXPECT_THROW / ASSERT_THROW | Verifies the statement throws the specified exception. |
| EXPECT_ANY_THROW / ASSERT_ANY_THROW | Verifies the statement throws any exception.           |
| EXPECT_NO_THROW / ASSERT_NO_THROW   | Verifies the statement does not throw any exception.     |

Example:

```cpp
EXPECT_THROW(DoSomething(), std::runtime_error);
ASSERT_NO_THROW(Initialize());
```

The statement can be compound:

```cpp
EXPECT_NO_THROW({ Setup(); Run(); });
```

---

## 8. Predicate Assertions

When built-in assertions are insufficient for complex checks, predicate assertions allow custom functions or functors to convey richer messages.

### EXPECT_PRED*

Check predicates returning bool with 1 to 5 arguments.  Arguments are printed on failure.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
EXPECT_PRED2(MutuallyPrime, a, b);
```

### EXPECT_PRED_FORMAT*

For even richer diagnostics, use predicate-formatters returning `testing::AssertionResult`. They receive:

- Expressions as strings
- Their evaluated values

Example:

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* expr1, const char* expr2, int m, int n) {
  if (MutuallyPrime(m, n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr1 << " and " << expr2 << " are not mutually prime.";
}
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

This approach outputs detailed failure info, including evaluated values.

---

## 9. Generalized Assertions Using Matchers

Matchers provide a flexible and readable approach to assert on complex data and conditions.

### Macros

- `EXPECT_THAT(value, matcher)` 
- `ASSERT_THAT(value, matcher)`

Example:

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(foo_str, StartsWith("Hello"));
EXPECT_THAT(bar_str, MatchesRegex("Line \\d+"));
ASSERT_THAT(num, AllOf(Gt(5), Lt(10)));
```

Matchers produce clear, English-like failure messages making debugging simpler.

---

## 10. Windows HRESULT Assertions

Use these assertions to verify success or failure of Windows `HRESULT` values.

### EXPECT_HRESULT_SUCCEEDED / ASSERT_HRESULT_SUCCEEDED

- Verifies the expression returns a success HRESULT.

```cpp
ASSERT_HRESULT_SUCCEEDED(CoCreateInstance(...));
```

### EXPECT_HRESULT_FAILED / ASSERT_HRESULT_FAILED

- Verifies the expression returns a failure HRESULT.

```cpp
EXPECT_HRESULT_FAILED(GetItem(...));
```

Failure messages include human-readable error info.

---

## 11. Death Assertions (Process Termination Checks)

Death assertions verify that a statement causes the process to terminate as expected.

### EXPECT_DEATH / ASSERT_DEATH

```cpp
EXPECT_DEATH({ initialize(); AbortIfBad(); }, "Error on line .* of AbortIfBad");
```
- Verifies process terminates with non-zero exit status.
- Checks that the stderr output matches a regex or matcher.

### EXPECT_DEATH_IF_SUPPORTED / ASSERT_DEATH_IF_SUPPORTED

- Behaves like `EXPECT_DEATH` but only if death tests are supported by the platform.

### EXPECT_DEBUG_DEATH / ASSERT_DEBUG_DEATH

- Executes as usual in debug mode, otherwise runs the statement normally without death check.

### EXPECT_EXIT / ASSERT_EXIT

```cpp
EXPECT_EXIT(CleanupAndExit(), testing::ExitedWithCode(0), "Success");
```
- Verifies normal termination with a specific exit code.
- Checks stderr output.

---

## 12. Common Patterns and Best Practices

- **Use `EXPECT_*` to allow further assertions post failure**: Prefer `EXPECT_*` unless continuing test without early exit is unsafe.
- **Use typed or parameterized predicates to get richer failure diagnostics**.
- **Streaming custom messages is encouraged** to add contextual info:

```cpp
EXPECT_EQ(result, expected) << "Result mismatch at iteration " << i;
```

- **Avoid assertion macros inside constructors or destructors**; use `SetUp()` and `TearDown()` methods to place fatal assertions.
- **Use `SCOPED_TRACE()`** to insert trace information that helps identify the source context of assertion failures in sub-routines.

```cpp
SCOPED_TRACE("Checking iteration " << i);
EXPECT_TRUE(CheckCondition());
```

- **Use `ASSERT_NO_FATAL_FAILURE()`** to verify that a function call does not produce fatal failures, which helps propagate failures properly when calling sub-routines.

---

## 13. Troubleshooting Common Assertion Issues

- **Fatal assertions in non-void functions cause compilation errors.** Use non-fatal assertions or restructure functions to `void` where possible.
- **Predicate assertions with overloaded functions require explicit casting** to resolve ambiguity.
- **Comparing C strings with `EXPECT_EQ` compares pointers, not contents.** Use `EXPECT_STREQ` instead.
- **Floating-point comparisons require specialized macros** to avoid precision errors.

---

## 14. Extending GoogleTest's Printing for User Types

GoogleTest prints values in failures using `operator<<` or user-overloadable `AbslStringify()` or `PrintTo()`.

- Implement a friend function `AbslStringify()` in your type's namespace for better output.

```cpp
namespace foo {
class Point {
  int x, y;
  template <typename Sink>
  friend void AbslStringify(Sink& sink, const Point& point) {
    absl::Format(&sink, "(%d, %d)", point.x, point.y);
  }
};
}
```
- Alternatively, define `PrintTo(const Type&, std::ostream*)`.
- If both exist, `PrintTo()` takes precedence in GoogleTest output.

You can also manually format and print with:

```cpp
EXPECT_TRUE(CheckVector(vec)) << testing::PrintToString(vec);
```

---

For detailed usage examples and deeper API understanding, please refer to the related documentation pages linked below.

---

### See Also

- [Assertions Reference](reference/assertions.md)
- [Matchers Reference](reference/matchers.md)
- [GoogleTest Primer: Getting Started with Assertions](primer.md#Assertions)
- [Advanced Guide: Using AssertionResult and Predicate-Formatters](advanced.md#using-a-function-that-returns-an-assertionresult)
- [Writing Your First Test](getting_started/first_test_run_validation/write_first_test)
- [Mocking Reference](reference/mocking.md) for combined assertion with mocks

