---
title: "Assertions and Expectations"
description: "Documents the full set of assertions available in GoogleTest, including equality, inequality, exception handling, and custom assertions. Includes detailed usage patterns and practical examples."
---

# Assertions and Expectations

GoogleTest provides a comprehensive set of assertions that enable you to verify program correctness and define clear expectations during testing. This page documents the full suite of assertion macros and the expectations mechanism available in GoogleTest and GoogleMock, covering fundamental conditions such as equality, inequality, Boolean checks, exception verification, predicate assertions, and the ordering and cardinality of mock interactions.

---

## Overview of Assertion Macros

GoogleTest's assertions come in pairs with `EXPECT_` and `ASSERT_` variants:

- `EXPECT_` macros generate **non-fatal failures**, allowing tests to continue running after a failure.
- `ASSERT_` macros generate **fatal failures**, causing the current function to abort immediately.

All macros allow streaming custom failure messages to clarify the cause of failure.

### Direct Success and Failure

| Macro       | Purpose                                   | Usage Notes                              |
|-------------|-------------------------------------------|-----------------------------------------|
| `SUCCEED()` | Explicitly generates a success.           | Does not make the test succeed alone.   |
| `FAIL()`    | Generates a fatal failure and aborts the current void function.
| `ADD_FAILURE()` | Generates a nonfatal failure.              | Useful for annotating failures without stopping execution. |
| `ADD_FAILURE_AT(file, line)` | Generates a nonfatal failure at a specific location. | Useful for pinpointing custom failures. |

### Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` verify that the condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` verify that the condition is false.

### Binary Comparisons

Expectations for paired values supporting respective comparison operators.

| Macro         | Description                                  |
|---------------|----------------------------------------------|
| `EXPECT_EQ(v1, v2)` / `ASSERT_EQ(v1, v2)` | Verifies `v1 == v2`. Pointer equality applies for raw pointers.
| `EXPECT_NE(v1, v2)` / `ASSERT_NE(v1, v2)` | Verifies `v1 != v2`. Pointer inequality for pointers.
| `EXPECT_LT(v1, v2)`, `EXPECT_LE(v1, v2)`, `EXPECT_GT(v1, v2)`, `EXPECT_GE(v1, v2)` | Verifies the appropriate ordering (`<`, `<=`, `>`, `>=`).

**Note:** For C strings, use the specialized `EXPECT_STREQ` and friends to compare contents rather than addresses.

### String Comparison (C Strings)

- `EXPECT_STREQ` / `ASSERT_STREQ`: Verify string equality by content.
- `EXPECT_STRNE` / `ASSERT_STRNE`: Verify string inequality by content.
- `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ`: Case-insensitive string equality.
- `EXPECT_STRCASENE` / `ASSERT_STRCASENE`: Case-insensitive string inequality.

Comparisons handle both narrow and wide strings and will print UTF-8 representations on failures.

### Floating-Point Comparisons

Due to rounding errors, specialized macros verify near equality within a tolerance.

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`: Compare `float` values within 4 ULPs.
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`: Compare `double` values similarly.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR`: Assert values differ by no more than an absolute error.

### Exception Assertions

Verify exception throwing or absence thereof. Requires exceptions enabled.

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW`: Checks for throwing a specific exception.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW`: Checks for throwing any exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW`: Verifies that execution does not throw.

### Predicate Assertions

More expressive checks that involve user-defined predicates to improve error reporting.

- `EXPECT_PREDn(predicate, val1, ..., valn)` / `ASSERT_PREDn`: Succeed if predicate returns true for values.
- `EXPECT_PRED_FORMATn` / `ASSERT_PRED_FORMATn`: Use predicate-formatter functions that control failure message formatting.

Example predicate-formatter usage:

```cpp
// Predicate formatter example.
testing::AssertionResult AssertMutuallyPrime(const char* m_expr,
                                             const char* n_expr,
                                             int m, int n) {
  if (MutuallyPrime(m, n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << m_expr << " and " << n_expr
      << " (" << m << " and " << n << ") are not mutually prime.";
}
...
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

### HRESULT Assertions (Windows Specific)

- `EXPECT_HRESULT_SUCCEEDED(expression)` / `ASSERT_HRESULT_SUCCEEDED`: Assert success `HRESULT`.
- `EXPECT_HRESULT_FAILED(expression)` / `ASSERT_HRESULT_FAILED`: Assert failure `HRESULT`.

### Death Assertions

Verify that a statement causes the process to terminate in a predictable way.

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH`: Verifies abnormal process exit with matching stderr output.
- `EXPECT_DEATH_IF_SUPPORTED`: Conditionally runs `EXPECT_DEATH` if death tests enabled.
- `EXPECT_DEBUG_DEATH`: Runs `EXPECT_DEATH` only in debug builds.
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT`: Verifies process exit with predicate evaluation and stderr matching.

When writing death tests, the `statement` can be compound code, such as:

```cpp
EXPECT_DEATH({ int n = 5; Foo(&n); }, "Error on line .* of Foo()");
```

---

## Expectations in GoogleMock

Beyond assertions, GoogleMock provides a rich system to specify **expectations** on mock method calls, including:

- **WHEN** a mock method is called with matching arguments
- **HOW MANY TIMES** it is expected
- **WHEN** it is allowed or disallowed to be called (ordering)
- **WHAT** should happen (actions)

### Creating Expectations

Use `EXPECT_CALL(mock_object, method(matchers...))` to specify expectations:

```cpp
EXPECT_CALL(my_mock, Foo(42))
    .Times(3)                    // Expect exactly 3 calls
    .WillOnce(Return(7))         // First call returns 7
    .WillRepeatedly(Return(0)); // Subsequent calls return 0
```

- If omitted, `Times()` is inferred by `WillOnce()` and `WillRepeatedly()` presence.
- Specifying no matchers means _all arguments match_ (works only for non-overloaded methods).

### Matchers

Matchers express constraints on arguments:

- `Eq(value)`: Equal to value
- `_`: Wildcard match (anything)
- `Lt(value)`, `Ge(value)`, `AllOf(...)`, `AnyOf(...)`, etc.

You can use `With()` to combine all arguments as a single tuple matcher.

### Cardinalities — How Many Times?

Specify with `Times(Cardinality)`, including:

- `AnyNumber()`
- `Exactly(n)`
- `AtLeast(n)`
- `AtMost(n)`
- `Between(m, n)`

If omitted, GoogleMock infers cardinalities automatically based on actions.

### Ordering Calls

**Sequences:** Use `InSequence(sequence_1, sequence_2, ...)` or the convenient `InSequence` RAII class to enforce call order.

Example:

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, A()).InSequence(s1);
EXPECT_CALL(mock, B()).InSequence(s1, s2);
EXPECT_CALL(mock, C()).InSequence(s2);
```

This enforces the partial order represented by a DAG.

**After Clause:** Use `.After(expectation)` or `.After(expectation_set)` to specify calls that must happen after certain expectations are fulfilled.

### WillOnce and WillRepeatedly — What Happens?

- `WillOnce(action)`: Specifies action on the next matching call.
- `WillRepeatedly(action)`: Specifies action on all subsequent matching calls after all `WillOnce`s are exhausted.

Actions can be built-in or custom, including lambdas, function pointers, or functors.

### RetiresOnSaturation

Use `.RetiresOnSaturation()` to make an expectation inactive when its call count reaches the specified maximum. This helps manage overlapping expectations to avoid saturation errors.

### Uninteresting vs Unexpected Calls

- **Uninteresting calls:** Calls to mock methods without any expectation set. These by default generate warnings.
- **Unexpected calls:** Calls that do not match any `EXPECT_CALL` expectation. These are errors.

You can control warnings/errors behavior by using `NiceMock` (suppresses warnings), `NaggyMock` (default, warns), or `StrictMock` (treats uninteresting calls as errors).

### Verifying & Clearing Expectations

- `Mock::VerifyAndClearExpectations(&mock)`: Verify all expectations have been met and clear them.
- `Mock::VerifyAndClear(&mock)`: Additionally clears any default actions set via `ON_CALL`.
- Use `Mock::AllowLeak(&mock)` if the mock object might be leaked (e.g. death tests) to avoid false leak warnings.

### Common Pitfalls with Expectations

- Set expectations **before** calling mock methods; otherwise behavior is undefined.
- Expectations are sticky by default: they stay active after saturation unless retired explicitly or via sequences.
- Overlapping expectations require careful use of cardinalities, ordering, and `RetiresOnSaturation`.

---

## Practical Examples

### Simple Expectation

```cpp
EXPECT_CALL(turtle, PenDown())
    .Times(AtLeast(1));

// Exercise code.
painter.DrawCircle(0, 0, 10);
```

### Matching Argument Ranges

```cpp
EXPECT_CALL(foo, DoThis(AllOf(Gt(5), Lt(10))));
```

### Controlling Call Order

```cpp
{
  InSequence seq;
  EXPECT_CALL(obj, Initialize());
  EXPECT_CALL(obj, Start());
  EXPECT_CALL(obj, Stop());
}
```

### Using `After()` Clause

```cpp
auto init = EXPECT_CALL(mock, Initialize());
auto run = EXPECT_CALL(mock, Run()).After(init);
```

### Default Behavior without Expectation

```cpp
ON_CALL(mock, DoSomething(_)).WillByDefault(Return(true));
```

---

## Troubleshooting Common Issues

### Missing WillByDefault or WillOnce

An `ON_CALL` must have a `.WillByDefault(action)`. Failing to specify it will trigger a runtime error.

### Duplicate Clauses

`With()`, `Times()`, `WillRepeatedly()`, and `RetiresOnSaturation()` clauses can appear at most once per `EXPECT_CALL` or `ON_CALL`.

### Ordering Violations

When using sequences or `After()`, calls out of order will cause test failures with detailed diagnostic messages.

### Excessive or Insufficient Calls

GoogleMock warns when too many or too few calls happen relative to the cardinality set in the expectation.

### Uninteresting Call Warnings

Use `NiceMock` to suppress warnings on uninteresting calls or explicitly add `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` if needed.

---

For a deep dive into setting up mocks and expectations, see the [GoogleMock Mocking Reference](../reference/mocking.md) and [gMock for Dummies](../gmock_for_dummies.md). For detailed examples and patterns, consult the [gMock Cheat Sheet](../gmock_cheat_sheet.md) and [gMock Cookbook](../gmock_cook_book.md). For comprehensive assertion macros usage, review the [Assertions Reference](reference/assertions.md).


<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/assertions.md", "range": "1-174"},{"path": "docs/reference/mocking.md", "range": "1-699"},{"path": "googlemock/include/gmock/gmock-spec-builders.h", "range": "1-606"},{"path": "googlemock/src/gmock-spec-builders.cc", "range": "1-635"},{"path": "googlemock/test/gmock-spec-builders_test.cc", "range": "1-1036"}]} />
