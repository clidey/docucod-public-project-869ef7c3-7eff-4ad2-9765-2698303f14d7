---
title: "Assertions"
description: "Documents the suite of built-in assertions for verifying conditions, such as equality, exceptions, and floating-point comparisons. Clarifies use cases for fatal vs. non-fatal assertions and shows examples covering common validation needs."
---

# Assertions

GoogleTest provides a comprehensive suite of built-in assertions that allow you to verify conditions in your code under test. These assertions enable validation of equality, inequality, exceptions, floating-point approximations, string comparisons, and much more. Understanding when and how to use fatal versus non-fatal assertions is crucial to writing effective tests that both catch errors and facilitate debugging.

---

## Overview of Assertions

Assertions come in pairs, each with an `EXPECT_` and an `ASSERT_` variant:

- `EXPECT_` macros generate **non-fatal failures**: test continues running even if the assertion fails.
- `ASSERT_` macros generate **fatal failures**: aborts the current test function immediately upon failure.

Both types support streaming custom failure messages using the `<<` operator to provide additional context on failure.

```cpp
EXPECT_TRUE(condition) << "My condition is not true";
```

---

## Explicit Success and Failure

These assertions directly mark a test as succeeded or failed, independent of conditions.

### SUCCEED()
Marks a test as having succeeded at this point. This is purely documentary and does not override failure status elsewhere.

### FAIL()
Generates an immediate **fatal failure** and aborts the current function. Can only be used in `void`-returning functions.

### ADD_FAILURE()
Generates a **non-fatal failure**, allowing subsequent code to continue execution.

### ADD_FAILURE_AT(file, line)
Generates a non-fatal failure at the specified source file and line.

---

## Generalized Assertion with Matchers

GoogleTest supports using the powerful `EXPECT_THAT` and `ASSERT_THAT` macros, which allow you to assert that a value matches a flexible matcher expressed through GoogleMock. Matchers provide human-readable and expressive conditions, such as checking substrings, regex matches, ranges, and composite logical conditions.

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(value, MatchesRegex("Line \\d+"));
ASSERT_THAT(value, AllOf(Gt(5), Lt(10)));
```

Matchers produce intuitive failure messages that describe the expectation clearly.

For a full overview of matchers, see the [Matchers Reference](matchers.md).

---

## Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` — verify that condition evaluates to true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` — verify condition is false.

---

## Binary Comparisons

The following assertions compare two values using standard C++ comparison operators.

| Assertion   | Meaning                         |
|-------------|--------------------------------|
| `EXPECT_EQ` | Checks `val1 == val2`           |
| `EXPECT_NE` | Checks `val1 != val2`           |
| `EXPECT_LT` | Checks `val1 < val2`            |
| `EXPECT_LE` | Checks `val1 <= val2`           |
| `EXPECT_GT` | Checks `val1 > val2`            |
| `EXPECT_GE` | Checks `val1 >= val2`           |

All have corresponding `ASSERT_` variants for fatal failures.

Strings and pointers require special consideration — for C strings use string-specific assertions.

Example:

```cpp
EXPECT_EQ(a, b);
ASSERT_NE(ptr, nullptr);
EXPECT_LT(x, y);
```

---

## String Comparisons (C strings)

Because comparing C strings with `EXPECT_EQ` checks pointer equality, GoogleTest provides:

- `EXPECT_STREQ` / `ASSERT_STREQ` to check if contents are equal.
- `EXPECT_STRNE` / `ASSERT_STRNE` for inequality.
- Case-insensitive variants: `EXPECT_STRCASEEQ`, `ASSERT_STRCASEEQ`, `EXPECT_STRCASENE`, `ASSERT_STRCASENE`.

These work for wide strings as well and will print failures with UTF-8.

Example:

```cpp
EXPECT_STREQ(str1, str2);
ASSERT_STRCASEEQ(str1, str2);
```

---

## Floating-Point Comparisons

Due to rounding errors, floating-point equality requires special handling.

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`: Compares two `float`s within 4 ULPs.
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`: Compares two `double`s within 4 ULPs.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(...)`: Checks values are within an absolute error margin.

Use floating-point comparisons that suit your numerical tolerance requirements instead of exact equality.

Example:

```cpp
EXPECT_FLOAT_EQ(result, expected);
ASSERT_NEAR(computed_value, 3.14, 0.01);
```

---

## Exception Assertions

Requires exceptions enabled in your build environment.

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(...)`: Verifies statement throws the expected exception.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(...)`: Verifies statement throws any exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(...)`: Verifies statement does not throw.

Example:

```cpp
EXPECT_THROW(Foo(), std::runtime_error);
EXPECT_NO_THROW(Bar());
```

You can provide compound statements wrapped in braces.

---

## Predicate Assertions

To verify conditions expressed as arbitrary predicate functions while also providing rich failure messages.

### EXPECT_PRED*

Macros `EXPECT_PRED1` through `EXPECT_PRED5` and `ASSERT_PRED1` through `ASSERT_PRED5` accept predicates of arity 1 to 5 respectively.

Example:

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, x);
```

If the predicate fails, GoogleTest prints argument values.

### EXPECT_PRED_FORMAT*

Provide predicate-formatter functions which return `testing::AssertionResult`. They allow custom error messages with detailed explanations.

Example:

```cpp
testing::AssertionResult IsEvenPredicate(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}
EXPECT_PRED_FORMAT1(IsEvenPredicate, x);
```

---

## Windows HRESULT Assertions

For Windows COM APIs, you can check HRESULT success or failure:

- `EXPECT_HRESULT_SUCCEEDED(expr)` / `ASSERT_HRESULT_SUCCEEDED(expr)`
- `EXPECT_HRESULT_FAILED(expr)` / `ASSERT_HRESULT_FAILED(expr)`

These print both the HRESULT code and a human-readable error message for easier diagnostics.

---

## Death Assertions

Verify that a piece of code terminates the process as expected.

Available macros:

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(...)`: Verifies code dies with expected stderr output that matches the matcher.
- `EXPECT_DEATH_IF_SUPPORTED` / `ASSERT_DEATH_IF_SUPPORTED`: Like `EXPECT_DEATH` but no-op if death tests not supported.
- `EXPECT_DEBUG_DEATH` / `ASSERT_DEBUG_DEATH`: Runs death test in debug mode, runs normally otherwise.
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT(...)`: Verifies code exits with status satisfying predicate and matching stderr output.

Example:

```cpp
EXPECT_DEATH(DoSomething(42), "Error message");
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

Note the death test may spawn child processes and match process exit conditions.

---

# Practical Guidance

## Choosing Between EXPECT_ and ASSERT_

- Use `ASSERT_*` when further test execution depends on this check succeeding.
- Use `EXPECT_*` when you want to gather multiple failures in one test run.

## Streaming Custom Messages

All assertion macros support streaming additional diagnostic messages with `<<` to provide clarity in failure reports.

## Fatal Assertions in Subroutines

Fatal assertions abort only the current function, not the entire test. Use `ASSERT_NO_FATAL_FAILURE(statment);` to check failures inside a subroutine or consider exceptions or `HasFatalFailure()` to manually propagate failures.

## Skipping Test Execution

Use `GTEST_SKIP()` to skip a test dynamically, for example to check runtime preconditions.

---

# Examples

### Verifying Equality

```cpp
TEST(MathTest, Addition) {
  int sum = Add(2, 3);
  EXPECT_EQ(sum, 5) << "Sum mismatch";
}
```

### Expecting Exceptions

```cpp
TEST(ThrowTest, ThrowsRuntime) {
  EXPECT_THROW(FunctionThatThrows(), std::runtime_error);
}
```

### Floating-Point Approximate Equality

```cpp
TEST(FloatTest, ApproxEqual) {
  float a = 0.1f * 7;
  float b = 0.7f;
  EXPECT_FLOAT_EQ(a, b);
}
```

### Predicate Assertion for Complex Validation

```cpp
testing::AssertionResult IsPrime(int n) {
  if (n <= 1) return testing::AssertionFailure() << n << " is not prime";
  for (int i = 2; i < n; ++i) {
    if (n % i == 0) return testing::AssertionFailure() << n << " divisible by " << i;
  }
  return testing::AssertionSuccess();
}

TEST(NumberTest, PrimeCheck) {
  EXPECT_PRED_FORMAT1(IsPrime, 7);
}
```

### Checking Death with Message

```cpp
TEST(MyDeathTest, CrashesOnBadInput) {
  EXPECT_DEATH({ Foo(-1); }, "Invalid input");
}
```

---

# Troubleshooting

### Fatal Assertions in Non-void Functions

`ASSERT_*` and `FAIL()` macros produce confusing compile errors if used in functions returning non-void. Use only in `void` functions or refactor to out parameters.

### Failing to Catch Failures in Subroutines

To ensure fatal failures in helper functions abort the whole test, use `ASSERT_NO_FATAL_FAILURE(...)` or check `Test::HasFatalFailure()` after the helper returns.

### Comparing C Strings by Content

Use `EXPECT_STREQ` instead of `EXPECT_EQ` when comparing C string contents to avoid pointer equality comparison.

### Floating-Point Comparisons

Avoid `EXPECT_EQ` for floats; use `EXPECT_FLOAT_EQ` or `EXPECT_NEAR` instead to avoid false failures due to precision errors.

### Exception Tests Not Working

Ensure that the code is compiled with exceptions enabled, or else `EXPECT_THROW` and related macros will not work.

### Death Test Failures

Make sure death tests run in an environment supporting process forking. If tests hang or fail, consider setting `--gtest_death_test_style=threadsafe`.

---

For deeper understanding and advanced usage, see the [Assertions Reference](docs/reference/assertions.md), [Advanced Testing Topics](docs/advanced.md), and [Using Assertions and Matchers Effectively](guides/advanced-testing-and-best-practices/assertions-matchers.mdx).

Also related are [Matchers Reference](reference/matchers.md) and [Mocking Reference](docs/reference/mocking.md) for combined use with mock objects.

---

## Source
<Source url="https://github.com/google/googletest" paths='[{"path": "docs/reference/assertions.md", "range": "1-240"}]' branch="main" />