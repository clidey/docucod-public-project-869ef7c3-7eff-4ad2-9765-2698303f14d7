---
title: "Assertions and Expectations"
description: "Details the built-in assertion macros for expressing expectations inside tests, including equality, inequality, error checks, exception assertions, and more. Explains syntax, usage scenarios, and distinctions between fatal and non-fatal failures."
---

# Assertions and Expectations

GoogleTest equips you with a comprehensive suite of assertion macros designed to express and verify expectations within tests. These assertions enable you to check conditions, compare values, inspect error handling, confirm exception behavior, and much more, all with clear syntax and actionable feedback to make your tests robust and maintainable.

---

## 1. Basic Assertion Types

Assertions in GoogleTest fall into two broad categories:

- **Fatal Assertions (`ASSERT_`)**: Stop test execution immediately on failure.
- **Non-fatal Assertions (`EXPECT_`)**: Report the failure but allow the test to continue.

Choosing between them depends on whether continuing the test after the failure makes sense and whether subsequent checks rely on the assertion succeeding.

### 1.1 SUCCEED, FAIL, and ADD_FAILURE

- `SUCCEED()`: Signals explicit success. Useful for documenting intent rather than controlling flow.

- `FAIL()`: Signals a fatal failure and immediately aborts the current test function.

- `ADD_FAILURE()`: Generates a non-fatal failure allowing test execution to continue.

```cpp
SUCCEED();  // Marks this point explicitly succeeded
FAIL() << "Unexpected condition";  // Fatal failure
ADD_FAILURE() << "Non-fatal failure";
```

---

## 2. Generalized Assertions with Matchers

Matchers allow expressive, readable, and fine-grained argument validation. GoogleTest integrates [gMock's matcher framework](../api-reference/mocking-apis/matchers-actions) to enable this.

- `EXPECT_THAT(value, matcher)`: Verifies `value` satisfies the matcher.
- `ASSERT_THAT(value, matcher)`: Like `EXPECT_THAT`, but fatal on failure.

Example:

```cpp
EXPECT_THAT(value, ::testing::StartsWith("Hello"));
ASSERT_THAT(number, ::testing::AllOf(::testing::Gt(5), ::testing::Lt(10)));
```

Matchers make assertions act like fluent English statements and produce informative failure messages.

---

## 3. Boolean Condition Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

These check basic Boolean conditions.

Example:

```cpp
EXPECT_TRUE(IsValid(user));
ASSERT_FALSE(has_errors());
```

---

## 4. Binary Comparison Assertions

Useful for verifying equality and ordering;
they support both built-in and user-defined types (if streaming to `ostream` is supported).

| Macro       | Description                         |
|-------------|-----------------------------------|
| EXPECT_EQ / ASSERT_EQ       | Checks `val1 == val2`                     |
| EXPECT_NE / ASSERT_NE       | Checks `val1 != val2`                     |
| EXPECT_LT / ASSERT_LT       | Checks `val1 < val2`                      |
| EXPECT_LE / ASSERT_LE       | Checks `val1 <= val2`                     |
| EXPECT_GT / ASSERT_GT       | Checks `val1 > val2`                      |
| EXPECT_GE / ASSERT_GE       | Checks `val1 >= val2`                     |

**Special Note:** For C strings (`const char*`), use `EXPECT_STREQ` / `EXPECT_STRNE` to compare contents.

Example:

```cpp
EXPECT_EQ(result, expected);
ASSERT_GT(size, 5);
EXPECT_NE(ptr, nullptr);
```

---

## 5. String Comparison Assertions

Specifically for C strings comparison, respecting content rather than pointer values:

| Macro       | Description                              |
|-------------|------------------------------------------|
| EXPECT_STREQ / ASSERT_STREQ       | Checks that two C strings have the same contents |
| EXPECT_STRNE / ASSERT_STRNE       | Checks that two C strings have different contents |
| EXPECT_STRCASEEQ / ASSERT_STRCASEEQ   | Checks equality ignoring case                 |
| EXPECT_STRCASENE / ASSERT_STRCASENE   | Checks inequality ignoring case               |

Example:

```cpp
EXPECT_STREQ("hello", actual_c_str);
ASSERT_STRCASEEQ("Hello", actual_cstr);
```

---

## 6. Floating-Point Comparison Assertions

Due to floating-point precision limits, approximate comparisons with useful tolerances are provided.

| Macro         | Description                                               |
|---------------|-----------------------------------------------------------|
| EXPECT_FLOAT_EQ / ASSERT_FLOAT_EQ    | Checks approximate equality for floats (within 4 ULPs)         |
| EXPECT_DOUBLE_EQ / ASSERT_DOUBLE_EQ  | Checks approximate equality for doubles (within 4 ULPs)        |
| EXPECT_NEAR / ASSERT_NEAR            | Checks that difference does not exceed a given absolute error  |

Example:

```cpp
EXPECT_FLOAT_EQ(x, y);
ASSERT_DOUBLE_EQ(computed, expected);
EXPECT_NEAR(measured, target, 0.01);
```

---

## 7. Exception Assertions

Verify exception-throwing behavior when enabled:

| Macro             | Description                              |
|-------------------|------------------------------------------|
| EXPECT_THROW / ASSERT_THROW         | Expects the statement throws a specific exception type     |
| EXPECT_ANY_THROW / ASSERT_ANY_THROW | Expects the statement throws any exception                 |
| EXPECT_NO_THROW / ASSERT_NO_THROW   | Expects the statement does not throw an exception           |

Example:

```cpp
EXPECT_THROW(Foo(), std::runtime_error);
ASSERT_NO_THROW(DoWork());
```

---

## 8. Predicate Assertions

For testing complex Boolean predicates with enhanced failure messaging:

- `EXPECT_PRED1` to `EXPECT_PRED5` and their fatal variants.
- Assert predicate functions/functors with appropriate argument counts.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
```

## 9. Predicate-Formatter Assertions

Use predicate formatters to customize failure messages:

- `EXPECT_PRED_FORMATn` / `ASSERT_PRED_FORMATn` (
  `n` = number of arguments)

Formatters return `testing::AssertionResult` allowing detailed error formatting.

Example:

```cpp
testing::AssertionResult IsPrimeFormatter(const char* expr, int n) {
  if (IsPrime(n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " is not prime.";
}
EXPECT_PRED_FORMAT1(IsPrimeFormatter, number);
```

---

## 10. Windows HRESULT Assertions

For verifying HRESULT success/failure:

| Macro               | Description                              |
|---------------------|------------------------------------------|
| EXPECT_HRESULT_SUCCEEDED / ASSERT_HRESULT_SUCCEEDED | Checks if HRESULT indicates success   |
| EXPECT_HRESULT_FAILED / ASSERT_HRESULT_FAILED       | Checks if HRESULT indicates failure   |

Example:

```cpp
EXPECT_HRESULT_SUCCEEDED(ptr->QueryInterface(IID_IUnknown));
```

---

## 11. Death Assertions

Test that code correctly terminates the process under certain conditions.

| Macro               | Description                                        |
|---------------------|--------------------------------------------------|
| EXPECT_DEATH / ASSERT_DEATH               | Expects statement kills the process with matching stderr output             |
| EXPECT_DEATH_IF_SUPPORTED / ASSERT_DEATH_IF_SUPPORTED | Same as above if death tests enabled                        |
| EXPECT_DEBUG_DEATH / ASSERT_DEBUG_DEATH | Death test only in debug mode                       |
| EXPECT_EXIT / ASSERT_EXIT                 | Expects process exits with status satisfying predicate and output matching regex |

Example:

```cpp
EXPECT_DEATH(FailFunc(), "error message regex");
EXPECT_EXIT(NormalExit(), ::testing::ExitedWithCode(0), "Success");
```

---

# Practical Usage Tips

- **Fatal vs Non-Fatal:** Use fatal (`ASSERT_`) when failure makes continuation meaningless.
- **Using Matchers:** Use `EXPECT_THAT` for expressive, readable assertions.
- **Exception Assertions:** Protect against unhandled exceptions in tested code.
- **Death Tests:** Confirm that invalid states cause program termination as expected.
- **Predicate Assertions:** Use to check complex conditions beyond simple equality or Boolean checks.

---

# Example Test Illustrations

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Return;
using ::testing::_;

class MyMock {
 public:
  MOCK_METHOD(int, GetValue, (), ());
  MOCK_METHOD(bool, SetValue, (int), ());
};

TEST(MyTest, BasicAssertions) {
  MyMock mock;

  EXPECT_CALL(mock, GetValue())
      .WillRepeatedly(Return(42));

  EXPECT_EQ(mock.GetValue(), 42);  // EXPECT_EQ with matcher Return(42)

  EXPECT_TRUE(mock.SetValue(5));

  EXPECT_THAT(mock.GetValue(), ::testing::Gt(40));  // Matcher usage
}

TEST(MyTest, ExceptionChecking) {
  EXPECT_THROW(throw std::runtime_error("fail"), std::runtime_error);
  EXPECT_NO_THROW(int x = 5;
                  (void)x;);
}

TEST(MyTest, DeathTestExample) {
  EXPECT_DEATH(
      { abort(); },
      "");  // Expect test to abort
}
```

---

For detailed syntax, examples, and advanced use cases, consult the related [Assertions Reference](../docs/reference/assertions.md) and [Matchers & Actions documentation](../api-reference/mocking-apis/matchers-actions).

---

# Troubleshooting

- Ensure that expected behavior occurs before assertions.
- Avoid side effects in predicate matchers as they may be evaluated multiple times.
- Use `EXPECT_` assertions when you want to accumulate errors; use `ASSERT_` when failure should abort the test.
- Death tests require special platform support; if unavailable, prefer alternative validation.

---

# References & Further Reading

- [Matchers Reference](../api-reference/mocking-apis/matchers-actions)
- [gMock for Dummies](../docs/gmock_for_dummies.md)
- [gMock Cookbook](../docs/gmock_cook_book.md)
- [GoogleTest Primer](../guides/getting-started/your-first-test.md)
- [Assertions & Best Practices](../guides/writing-tests/assertions-best-practices.md)
- [Using Matchers with Assertions (EXPECT_THAT)](../docs/reference/assertions.md#EXPECT_THAT)
- [Death Tests](../guides/writing-tests/assertions-best-practices.md#death-tests)

---