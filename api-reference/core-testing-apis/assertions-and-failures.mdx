---
title: "Assertions and Failure Handling"
description: "Detailed reference for GoogleTest assertion macros, covering equality, comparison, fatal/non-fatal failures, and predicate assertions. Understand how failures are reported and how to use custom messages for clarity in test results."
---

# Assertions and Failure Handling

This reference details the assertion macros provided by GoogleTest to verify code correctness during testing. It covers the various kinds of assertions including equality, comparison, string, floating-point, exception assertions, and predicate assertions. You will learn how assertion failures are reported, the differences between fatal and non-fatal failures, and how to add custom messages for clarity in your test results.

---

## Overview of Assertions

GoogleTest assertions come in paired macros:

- `EXPECT_*`: Non-fatal failures, allow the test function to continue execution.
- `ASSERT_*`: Fatal failures, abort the current test function immediately.

You can stream custom failure messages to assertions using the `<<` operator, which enhances the failure output with your context.

### Explicit Success and Failure

- `SUCCEED()`: Marks a success explicitly (rarely needed).
- `FAIL()`: Generates an immediate fatal failure.
- `ADD_FAILURE()`: Adds a non-fatal failure allowing continuation.
- `ADD_FAILURE_AT(file, line)`: Adds a non-fatal failure at a specified source location.


## Boolean Assertions

Validate boolean expressions:

- **`EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`**: Passes if `condition` is true.
- **`EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`**: Passes if `condition` is false.

They support streaming custom messages.

Example:

```cpp
EXPECT_TRUE(ptr != nullptr) << "Pointer must not be null";
ASSERT_FALSE(is_empty()) << "Container should not be empty";
```


## Equality and Comparison Assertions

These macros compare two values using standard comparison operators. Use them to check expected relations:

| Macro        | Description                               |
|--------------|-------------------------------------------|
| `EXPECT_EQ` / `ASSERT_EQ` | Checks if two values are equal (`==`). Use for object equality. For C strings, use `EXPECT_STREQ`. |
| `EXPECT_NE` / `ASSERT_NE` | Checks if two values are different (`!=`). For C strings, use `EXPECT_STRNE`. |
| `EXPECT_LT` / `ASSERT_LT` | Checks if first value is less than second (`<`). |
| `EXPECT_LE` / `ASSERT_LE` | Checks if first value is less than or equal (`<=`). |
| `EXPECT_GT` / `ASSERT_GT` | Checks if first value is greater than second (`>`). |
| `EXPECT_GE` / `ASSERT_GE` | Checks if first value is greater than or equal (`>=`). |

Example:

```cpp
EXPECT_EQ(calculated, expected) << "Calculation did not match expected value.";
ASSERT_LT(index, container.size()) << "Index out of range.";
```

**Important Notes:**

- These macros evaluate their arguments **exactly once**.
- Pointer equality compares addresses. For C string content comparison, use string-specific assertions.
- When comparing against `nullptr`, always use `nullptr` (not `NULL` or `0`).


## String Comparisons

Compare **C strings** by content, including wide strings:

- `EXPECT_STREQ(s1, s2) / ASSERT_STREQ(s1, s2)`: Equal strings.
- `EXPECT_STRNE(s1, s2) / ASSERT_STRNE(s1, s2)`: Not equal strings.
- `EXPECT_STRCASEEQ(s1, s2) / ASSERT_STRCASEEQ(s1, s2)`: Equal ignoring case.
- `EXPECT_STRCASENE(s1, s2) / ASSERT_STRCASENE(s1, s2)`: Not equal ignoring case.

If the strings differ, detailed messages with values are displayed.

Example:

```cpp
ASSERT_STREQ("hello", actual_str) << "Strings do not match";
EXPECT_STRCASEEQ("hello", actual_str) << "Case-insensitive match failed";
```


## Floating-Point Comparisons

Due to floating-point rounding errors, exact equality is uncommon. Use these macros:

- `EXPECT_FLOAT_EQ(val1, val2) / ASSERT_FLOAT_EQ(val1, val2)`: Checks approximate equality for `float` values within 4 ULPs.
- `EXPECT_DOUBLE_EQ(val1, val2) / ASSERT_DOUBLE_EQ(val1, val2)`: Checks approximate equality for `double` values within 4 ULPs.
- `EXPECT_NEAR(val1, val2, abs_error) / ASSERT_NEAR(val1, val2, abs_error)`: Checks if the absolute difference between `val1` and `val2` is less than or equal to `abs_error`.

These macros provide accurate error bounds and meaningful error messages if they fail.

Example:

```cpp
EXPECT_FLOAT_EQ(sqrt(2.f) * sqrt(2.f), 2.f);
ASSERT_NEAR(value1, value2, 0.001) << "Values differ outside error bound";
```


## Exception Assertions

Verify that code throws or doesn't throw specific exceptions. Requires exceptions to be enabled.

- `EXPECT_THROW(statement, exception_type) / ASSERT_THROW(statement, exception_type)`: Check that `statement` throws `exception_type`.
- `EXPECT_ANY_THROW(statement) / ASSERT_ANY_THROW(statement)`: Check that `statement` throws any exception.
- `EXPECT_NO_THROW(statement) / ASSERT_NO_THROW(statement)`: Check that `statement` throws no exceptions.

Example:

```cpp
ASSERT_THROW(my_function(), std::runtime_error);
EXPECT_NO_THROW(another_function());
```


## Predicate Assertions

For complex conditions, use predicate assertions that provide detailed failure messages and avoid multiple evaluations.

- **`EXPECT_PREDn(pred, val1, val2, ...) / ASSERT_PREDn(pred, val1, val2, ...)`**: 
  Verify predicates returning `bool`.
- **`EXPECT_PRED_FORMATn(pred_formatter, val1, val2, ...) / ASSERT_PRED_FORMATn(pred_formatter, val1, val2, ...)`**: 
  Use custom predicate-formatters returning `AssertionResult` to generate detailed messages.

Example of `EXPECT_PRED2`:

```cpp
bool AreClose(int a, int b) { return abs(a - b) < 5; }
EXPECT_PRED2(AreClose, val1, val2);
```

Example of a predicate-formatter:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}

EXPECT_PRED_FORMAT1(IsEven, x);
```


## Controlling Failure Behavior

### Skipping Test Execution

- `GTEST_SKIP()`: Skip the current test or fixture setup, with optional message.

Usage:

```cpp
TEST(FooTest, DoesSkip) {
  GTEST_SKIP() << "Skipping this test due to unmet condition.";
  FAIL();  // Not executed
}
```

### Checking for Fatal Failures

- `HasFatalFailure()`: Returns true if the current test has any fatal failures. Useful to abort following code gracefully after `ASSERT_*` in subroutines.

```cpp
Subroutine();
if (HasFatalFailure()) return;  // Bail out early on failure.
```

### Ensuring No Fatal Failures in Subroutines

- `ASSERT_NO_FATAL_FAILURE(statement)` / `EXPECT_NO_FATAL_FAILURE(statement)`: Ensure the given statement does *not* generate any new fatal failures.


## Adding Custom Messages

All assertions support streaming additional diagnostic messages with `<<` to provide extra clarity.

Example:

```cpp
EXPECT_EQ(a, b) << "Mismatch between A and B values";
``` 

You can stream any data that supports being sent to an `ostream`.


## Handling Failures in Listeners

GoogleTest supports an event listener interface to respond to test execution events. However, listeners should avoid generating new failures during `OnTestPartResult()` to prevent recursive faults.


## Recording Additional Test Properties

You can log key-value properties during a test run for output in XML or JSON reports:

```cpp
RecordProperty("SimulationTime", sim_time);
```

Only the last value for a given key is saved, and keys cannot conflict with internally reserved names such as `name`, `time`, or `classname`.

Properties recorded between `SetUpTestSuite()` and `TearDownTestSuite()` apply to the entire test suite. Properties recorded outside of tests belong to the global test context.


## Catching Failures During Testing of Testing Utilities

GoogleTest provides macros to assert that statements generate expected failures:

- `EXPECT_FATAL_FAILURE(statement, substring)`: Checks that `statement` causes exactly one fatal failure containing `substring` in the current thread.
- `EXPECT_NONFATAL_FAILURE(statement, substring)`: Checks similarly for non-fatal failures.

Also available with `_ON_ALL_THREADS` variants to catch failures on all threads.


## Best Practices & Tips

- Use `EXPECT_*` for checks where continuation is safe; use `ASSERT_*` to abort on failure.
- For C string comparisons, always prefer `EXPECT_STREQ` over `EXPECT_EQ`.
- Avoid fatal assertions in constructors or destructors. Use `SetUp()` and `TearDown()` methods instead.
- Use `SCOPED_TRACE()` to add trace messages for failures inside helper functions or loops.
- Stream custom failure messages liberally to clarify test failures.
- When using value-parameterized or typed tests, ensure proper instantiation to avoid uninstantiated test errors.


## Example Usage

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1) << "Factorial of zero should be 1.";
}

TEST(MyTest, UsesAssertion) {
  int a = 5;
  int b = 10;

  ASSERT_LT(a, b) << "a should be less than b";

  EXPECT_TRUE(IsEven(b)) << "b is expected to be even";
}

// Using predicate assertion with detailed message.
testing::AssertionResult IsPositive(int n) {
  if (n > 0)
    return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is not positive";
}

TEST(PredTest, CheckPositive) {
  EXPECT_PRED1(IsPositive, -1);
}
```


## Troubleshooting

- **Fatal assertions donâ€™t stop entire tests**: Fatal failures abort *only* the current function. Use `HasFatalFailure()` to detect fatal failures in subroutines and return early.
- **Mixing TEST and TEST_F in one test suite**: All tests in a test suite must use the same fixture class; otherwise, GoogleTest reports errors.
- **Uninstantiated parameterized tests**: Use `INSTANTIATE_TEST_SUITE_P` to instantiate; otherwise the framework reports test suite registration errors.
- **Streaming NULL strings in failure messages**: GoogleTest safely prints `(null)` for NULL pointers.
- **Order of evaluation**: Arguments in assertions are evaluated only once, but argument evaluation order is undefined. Do not rely on specific evaluation order.


---

## See Also

For additional details and deeper insights, refer to:

- [GoogleTest Assertions Reference](reference/assertions.md)
- [GoogleTest Primer](primer.md)
- [Predicate Assertions](reference/assertions.md#predicates)
- [Exception Assertions](reference/assertions.md#exceptions)
- [Death Assertions](reference/assertions.md#death)
- [Value-Parameterized Tests](reference/testing.md#TEST_P)
- [Typed Tests](guides/core-test-design/parameterized-typed-tests.mdx)
- [Adding Traces to Assertions](guides/core-test-design/assertions-macros.mdx#SCOPED_TRACE)

---

<Callout>
Ensure you call `testing::InitGoogleTest(&argc, argv);` before running tests.

Use `RUN_ALL_TESTS()` to run all registered tests and return exit code indicative of overall test success.

When writing assertions, prefer streaming detailed messages to help diagnosis.
</Callout>


---

## Practical Tips

- Use non-fatal `EXPECT_*` assertions to continue tests after minor failures.
- Use fatal `ASSERT_*` assertions when failure makes continuing unsafe.
- Use `SCOPED_TRACE` macro to add contextual info in nested test helpers.
- Use `RecordProperty()` to log useful metadata per test.
- For string equality, prefer `EXPECT_STREQ` over `EXPECT_EQ` for meaningful content comparison.
- Write custom predicate assertions to improve failure message clarity.
- For testing that failures happen, use `EXPECT_FATAL_FAILURE` and `EXPECT_NONFATAL_FAILURE`.

---