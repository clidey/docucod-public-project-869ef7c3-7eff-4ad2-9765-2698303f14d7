---
title: "Assertions & Failure Handling"
description: "Details all available assertion macros and mechanisms for reporting and controlling test failures, including fatal vs. non-fatal assertions and custom assertion creation. Users learn how to write expressive tests and control failure propagation for both common and advanced scenarios."
---

# Assertions & Failure Handling

This page details all available assertion macros and mechanisms for reporting and controlling test failures in GoogleTest. You will learn about the distinction between fatal and non-fatal assertions, how to write expressive tests, and how to control failure propagation for both common and advanced testing scenarios. This knowledge empowers you to write more robust and maintainable tests.

---

## Understanding Assertions

GoogleTest provides a rich set of assertion macros for verifying conditions during test execution. These assertions fall primarily into two categories:

- **Fatal Assertions (`ASSERT_*`)**: Terminate the current function immediately upon failure, aborting further test execution in that test scope.
- **Non-Fatal Assertions (`EXPECT_*`)**: Record the failure but allow the test function to continue running.

This deliberate design helps you decide between continuing a test after a failure or stopping it immediately based on the importance of the checked condition.

### Writing Basic Assertions

All assertion macros support streaming a custom failure message with the `<<` operator for improved diagnostics. For example:

```cpp
EXPECT_TRUE(is_valid) << "Expected is_valid to be true but it is false";
ASSERT_EQ(result, expected) << "Mismatch in result value.";
```

You can assert Boolean conditions, equality or inequality, string comparisons, floating-point approximations, and exceptions. Detailed examples include:

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`
- `EXPECT_STREQ(str1, str2)` for C strings
- `EXPECT_FLOAT_EQ(val1, val2)`
- `EXPECT_THROW(expression, exception_type)`

### Explicit Success and Failure

Use `SUCCEED()` to indicate an explicit success within a test, and `FAIL()` to generate a fatal failure immediately, returning from the current `void` function.

Example of usage:

```cpp
switch(code) {
  case 0:
    SUCCEED();
    break;
  default:
    FAIL() << "Unexpected code value: " << code;
}
```

### Predicate Assertions for Enhanced Error Messages

Sometimes your test needs to verify complex conditions that are hard to express with the standard macros, leading to obscure failure messages. GoogleTest offers predicate assertions (`EXPECT_PRED*`) and predicate-formatter assertions (`EXPECT_PRED_FORMAT*`) to solve this by allowing custom functions or functors to evaluate conditions and provide informative failure details.

Here is a simple example:

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, value);
```

For more expressive messages, define a function returning `testing::AssertionResult`.

## Controlling Failure Propagation

Fatal assertions stop the current test function but do not abort the entire test process. If you wish to propagate failure beyond a function boundary, use one of the following strategies:

- Use exceptions by integrating a listener that converts fatal failures to exceptions.
- Use `ASSERT_NO_FATAL_FAILURE(statement)` to check that `statement` runs without fatal failures.
- Check for failures after a subroutine call using `HasFatalFailure()` and return early if true.

Example:

```cpp
void SubTest() {
  ASSERT_EQ(x, y); // Fatal failure aborts SubTest only
}

TEST(MyTest, Example) {
  SubTest();
  if (HasFatalFailure()) return; // Abort test if SubTest failed
  // Continue test
}
```

## Skipping Tests at Runtime

You can skip tests dynamically at runtime using the `GTEST_SKIP()` macro, optionally streaming a message explaining the skip reason:

```cpp
TEST(FooTest, Skips) {
  if (!FeatureAvailable()) {
    GTEST_SKIP() << "Feature not available";
  }
  // Rest of the test
}
```

This feature supports skipping in individual tests or fixtures' `SetUp()`.

## Failure Details & Reporting

When an assertion fails, GoogleTest prints the expected vs. actual values, along with source location. For enhanced readability and debugging:

- Use matchers with `EXPECT_THAT` to verify values using English-like expressions.
- Use message streaming to add context to failures.
- Employ `SCOPED_TRACE` for tracing nested calls and sub-test points.

## Advanced Assertion Types

### Exception Assertions

Verify code throws or does not throw exceptions:

- `EXPECT_THROW(stmt, exception_type)`
- `EXPECT_NO_THROW(stmt)`
- `EXPECT_ANY_THROW(stmt)`

### Predicate Format Assertions

Use predicate-formatters to customize the failure message completely. A predicate-formatter function returns `AssertionResult` and takes the string expressions of the arguments, enabling precise control over failure descriptions.

### Floating-Point Assertions

Use special assertions like `EXPECT_FLOAT_EQ` or `EXPECT_DOUBLE_EQ` for approximate equality within 4 ULPs, or `EXPECT_NEAR` for absolute error bounds.

### String Assertions

Assertions for C strings include equality, inequality, and case-insensitive comparisons.

## Common Pitfalls & Best Practices

- Avoid using `ASSERT_*` macros in constructors and destructors directly.
- Prefer `EXPECT_*` in non-void functions to avoid confusion with fatal failures.
- Use custom messages to clarify failure causes.

## Troubleshooting Failures

To capture and test failure scenarios in your test code, use:

- `EXPECT_FATAL_FAILURE(statement, message_substring)` to catch fatal failures.
- `EXPECT_NONFATAL_FAILURE(statement, message_substring)` to catch non-fatal failures.

Note that these macros check failures only in the current thread.

## Summary

The assertion macros and failure handling mechanisms in GoogleTest provide a flexible and powerful way to verify your code's correctness, control test flow, and produce informative diagnostics. Mastery of these tools leads to more robust tests that clearly communicate expectations and errors.

---

## Additional Resources

- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md) — Detailed API and macro descriptions.
- [Advanced GoogleTest Topics](https://github.com/google/googletest/blob/main/docs/advanced.md#assertions-failure-handling) — Guides on failure propagation, skipping, and predicate assertions.
- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md) — To write richer assertions using matchers.

---

# Understanding the Difference Between Expect and Assert

| Aspect                         | `EXPECT_*` (Non-Fatal)                             | `ASSERT_*` (Fatal)                          |
|------------------------------|---------------------------------------------------|---------------------------------------------|
| Failure Impact                | Reports failure, continues test execution         | Reports failure, aborts the current function|
| Use Case                     | When you want to verify but continue multiple tests or checks within a test function | When the rest of the code depends on the assertion   |
| Can be used in non-void functions? | Yes                                         | No, only in `void` returning functions       |

---

# Sample Assertion Usage

```cpp
TEST(MathTest, Basics) {
  int result = Add(2, 3);

  EXPECT_EQ(result, 5) << "Sum did not add correctly.";
  ASSERT_NE(result, 0) << "Result should never be zero.";
  EXPECT_TRUE(result > 0);

  // If ASSERT_NE fails, the rest is skipped.
  // If EXPECT_EQ fails, the test continues.
}
```

# How to Write Death Tests

To verify code that causes the process to terminate (death tests), use:

- `EXPECT_DEATH(statement, "matcher")` — expects death with output matching regex or matcher.
- `ASSERT_DEATH` and variants for assertions inside death tests.

Example:

```cpp
TEST(FooDeathTest, InvalidInput) {
  ASSERT_DEATH({ Foo(-1); }, "Invalid argument");
}
```

Remember to allow mocks to leak in death tests using `Mock::AllowLeak()`.

---

# Controlling Failure Messages and Test Flow

- Use `SCOPED_TRACE` to add contextual traces to failures inside helper functions.
- Use `GTEST_SKIP()` to skip tests dynamically based on runtime conditions.
- Use `HasFatalFailure()` to detect and conditionally abort after failures in subroutines.

---

# Additional Tips

- Avoid over-specifying tests; use `EXPECT_CALL` only when you want to verify a call.
- Use `ON_CALL` to specify default mock method behavior without setting expectations.
- Non-fatal failures with `EXPECT_` allow tests to report multiple issues in one run.

---

For further details and advanced techniques, please explore the official GoogleTest [Assertions Reference](reference/assertions.md) and [Advanced Topics](docs/advanced.md#assertions-failure-handling).


