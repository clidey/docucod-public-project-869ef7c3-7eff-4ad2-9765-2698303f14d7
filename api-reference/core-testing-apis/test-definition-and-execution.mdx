---
title: "Test Definition and Execution"
description: "Describes the main APIs and macros used to declare, implement, and run tests and test suites. Includes guidance on core classes (Test, TestSuite), macros for test structure, test environment functions, and configuration options, helping users understand how to create and manage test cases."
---

# Test Definition and Execution

This page details the core APIs and macros you use to declare, implement, and run tests and test suites in GoogleTest. It provides essential guidance on the foundational classes, macros for test structure, test environment lifecycle functions, and configuration mechanisms that enable you to create robust, maintainable, and scalable test cases.

---

## Overview

GoogleTest centers testing around two conceptual building blocks:

- **Test**: an individual unit of testing, representing a single, isolated check or verification.
- **TestSuite**: a collection of related tests grouped together, often sharing common setup or teardown logic.

This page introduces you to the primary ways of defining tests and test suites using GoogleTest APIs and macros, how to organize tests with fixtures, how to leverage typed and parameterized tests, and how to manage the lifecycle of testing environments.

---

## Core Classes for Test Definition

### `testing::Test`

- This is the **abstract base class** from which all test fixtures derive.
- Represents a single test.
- Users typically subclass this when they want to share setup and teardown code among multiple tests in the same suite.
- Supports overriding the following virtual methods to manage test lifecycle:
  - `SetUp()` — runs before each test.
  - `TearDown()` — runs after each test.


### `testing::TestSuite`

- Conceptually groups multiple `Test` instances.
- Represents a collection of tests sharing a common fixture or related purpose.
- Has methods like `Passed()`, `Failed()`, `test_to_run_count()`, and more for introspecting test suite status and counts.


### Additional Classes and Utilities

- `testing::Environment`
  - Defines global test environment with `SetUp()` and `TearDown()` methods.
  - Useful for one-time setup/cleanup that spans *all* tests.

- `testing::UnitTest`
  - Singleton class that aggregates all registered test suites and tests.
  - Provides access to the currently running test or suite and overall test state.

---

## Macros and API for Declaring Tests

GoogleTest provides a suite of macros to declare tests and organize them effectively.

### Simple Tests: `TEST`

Defines a test with no fixture or shared state:

```cpp
TEST(TestSuiteName, TestName) {
  ...  // test body with assertions
}
```

- `TestSuiteName`: groups related tests.
- `TestName`: individual test name.
- The test body contains assertions that determine success or failure.

---

### Test Fixtures: `TEST_F`

Use a fixture class derived from `testing::Test` to share setup/teardown across tests:

```cpp
class MyFixture : public testing::Test {
 protected:
  void SetUp() override { ... }
  void TearDown() override { ... }
  // shared data members
};

TEST_F(MyFixture, Test1) {
  ... // access fixture members
}

TEST_F(MyFixture, Test2) {
  ...
}
```

- Each test uses a fresh instance of the fixture class.
- Allows reuse of test state and reduces duplication.

---

### Parameterized Tests: `TEST_P` and `INSTANTIATE_TEST_SUITE_P`

Helps test a function/class with different inputs without duplicating test code.

#### Steps to define value-parameterized tests:

1. Define a fixture class inheriting from `testing::TestWithParam<T>` where `T` is the parameter type:

```cpp
class MyParamTest : public testing::TestWithParam<int> {};
```

2. Define parameterized tests with `TEST_P`:

```cpp
TEST_P(MyParamTest, HandlesInput) {
  int param = GetParam();
  ... // test logic using param
}
```

3. Instantiate test cases with parameters:

```cpp
INSTANTIATE_TEST_SUITE_P(
    ParamGroup, MyParamTest, testing::Values(1, 2, 3));
```

- Parameters can be generated using various generators such as `Values()`, `Range()`, `ValuesIn()`, `Bool()`, `Combine()`.

- The instantiation name prefix (`ParamGroup` above) helps distinguish multiple instantiations.

---

### Typed Tests: `TYPED_TEST_SUITE` and `TYPED_TEST`

Allows repeating the same test logic across different types:

1. Define a fixture class template:

```cpp
template <typename T>
class MyTypedTest : public testing::Test {
 public:
  T value;
};
```

2. Associate it with a list of types:

```cpp
using MyTypes = ::testing::Types<int, char, double>;
TYPED_TEST_SUITE(MyTypedTest, MyTypes);
```

3. Define tests:

```cpp
TYPED_TEST(MyTypedTest, DoesSomething) {
  TypeParam val = this->value;  // use TypeParam for current type
  ...
}
```

- This runs the test logic once for each type in the list.

---

### Type-Parameterized Tests: `TYPED_TEST_SUITE_P`, `TYPED_TEST_P`, `REGISTER_TYPED_TEST_SUITE_P`, and `INSTANTIATE_TYPED_TEST_SUITE_P`

Like typed tests, but you define the test logic independently of the type list (the list is provided later), supporting modularity and multiple instantiations:

1. Define a fixture template:

```cpp
template <typename T>
class MyTestSuite : public testing::Test {};
```

2. Declare the test suite pattern:

```cpp
TYPED_TEST_SUITE_P(MyTestSuite);
```

3. Define type-parameterized tests:

```cpp
TYPED_TEST_P(MyTestSuite, TestA) {
  TypeParam val = 0;
  ...
}
```

4. Register tests:

```cpp
REGISTER_TYPED_TEST_SUITE_P(MyTestSuite, TestA, TestB);
```

5. Instantiate:

```cpp
using MyTypes = ::testing::Types<int, double>;
INSTANTIATE_TYPED_TEST_SUITE_P(MyPrefix, MyTestSuite, MyTypes);
```

---

## Test Environment and Lifecycle Hooks

You can define `SetUp()` and `TearDown()` hooks at different granularities:

- **Global Level:** Subclass `testing::Environment` and register with `AddGlobalTestEnvironment()` to set up and tear down shared resources for your entire test program.
- **Test Suite Level:** Define static methods in your fixture class:
  - `static void SetUpTestSuite()` — called once before the first test in the suite.
  - `static void TearDownTestSuite()` — called once after the last test in the suite.
- **Test Level:** Override `SetUp()` and `TearDown()` virtual methods in the fixture for setup and cleanup for each individual test.

These hooks enable you to manage expensive resources, establish preconditions, and clean up properly at appropriate scopes.

---

## Running Tests

- Call `testing::InitGoogleTest(&argc, argv);` before running tests to initialize GoogleTest and parse flags.
- Invoke `RUN_ALL_TESTS();` in your `main()` to execute all registered tests.
- Tests are automatically discovered via registration macros (`TEST()`, `TEST_F()`, etc.) or programmatic registration (`RegisterTest()`).

Example of a minimal `main` function:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## Programmatic Test Registration

For dynamic test creation, use:

```cpp
template <typename Factory>
TestInfo* RegisterTest(const char* test_suite_name, const char* test_name,
                       const char* type_param, const char* value_param,
                       const char* file, int line, Factory factory);
```

- `factory` is a callable creating new test fixture instances.
- Useful when test cases depend on runtime data.

---

## Test Properties

During a test run, you can log key-value pairs associated with a test, test suite, or overall run using:

```cpp
testing::Test::RecordProperty("key", value);
```

- Supported value types include `std::string` and integral
- These properties are serialized into XML reports or test logs for post-mortem analysis.

---

## Practical Tips and Best Practices

- Use `TEST_F` when tests share common setup/teardown and data.
- Use `TEST_P` to avoid duplicated code and run the same tests with varied inputs.
- Typed and type-parameterized tests scale well when testing generic code over type lists.
- Use `SetUpTestSuite` and `TearDownTestSuite` for costly setup/cleanup required once per suite, not per test.
- Always call `InitGoogleTest()` before `RUN_ALL_TESTS()`.
- Use `RecordProperty` for logging extra metadata.
- For global setup/cleanup, register environments via `AddGlobalTestEnvironment`.

---

## Troubleshooting Common Misuse

- Misspelling `SetUp` as `Setup` or `TearDown` as `Teardown` leads to these not being called.
- Don’t call `RUN_ALL_TESTS()` more than once.
- `TEST()` and `TEST_F()` macros create and register tests automatically; avoid manual registration except for dynamic use cases.
- When mixing typed and non-typed tests, ensure proper macro use (`TYPED_TEST_SUITE`, `TYPED_TEST_P`, etc.).
- `GTEST_SKIP()` can be used inside test bodies or `SetUp` to skip tests.

---

## Example: Basic Test with Fixture

```cpp
// Define fixture
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }
  Queue<int> q0_, q1_, q2_;
};

// Test using fixture
TEST_F(QueueTest, EnqueueTest) {
  EXPECT_EQ(q0_.size(), 0);
  q0_.Enqueue(4);
  EXPECT_EQ(q0_.size(), 1);
}
```

## Example: Value-Parameterized Test

```cpp
class IsEvenTest : public testing::TestWithParam<int> {};

TEST_P(IsEvenTest, ReturnsTrueForEvenNumbers) {
  EXPECT_EQ(GetParam() % 2, 0);
}

INSTANTIATE_TEST_SUITE_P(EvenNumbers,
                         IsEvenTest,
                         testing::Values(2, 4, 6, 8));
```

## Example: Typed Test

```cpp
template <typename T>
class MathTest : public testing::Test {
 public:
  T value_ = 1;
};

using TestedTypes = ::testing::Types<int, float>;
TYPED_TEST_SUITE(MathTest, TestedTypes);

TYPED_TEST(MathTest, IsPositive) {
  EXPECT_GT(this->value_, 0);
}
```

## Example: Type-Parameterized Test

```cpp
template <typename T>
class InterfaceTest : public testing::Test {
 public:
  void SomeSharedTest() { ... }
};

TYPED_TEST_SUITE_P(InterfaceTest);

TYPED_TEST_P(InterfaceTest, DoesAction) {
  this->SomeSharedTest();
}

REGISTER_TYPED_TEST_SUITE_P(InterfaceTest, DoesAction);

using Implementations = ::testing::Types<ImplA, ImplB>;
INSTANTIATE_TYPED_TEST_SUITE_P(ImplTests, InterfaceTest, Implementations);
```

---

## References and Further Reading

- [Basic Test Writing with TEST and TEST_F](../primer.md#simple-tests)
- [Parameterized and Typed Tests](reference/testing.md#TEST_P)
- [Test Fixtures and Lifecycle Hooks](reference/testing.md#Test)
- [Advanced Topics: Typed and Type-Parameterized Tests](advanced.md#typed-tests)
- [Global Test Environments](reference/testing.md#AddGlobalTestEnvironment)
- [Macros Reference (TEST, TEST_F, TEST_P, TYPED_TEST, etc.)](reference/testing.md#Macros)

---

## Source and Examples

- View source code of typed tests for detailed implementation and samples: [`googletest/test/gtest_list_output_unittest_.cc`](https://github.com/google/googletest/blob/main/googletest/test/gtest_list_output_unittest_.cc)
- Explore samples directory for test patterns: [googletest/samples](https://github.com/google/googletest/tree/main/googletest/samples)

---

This page serves as a comprehensive guide to writing, organizing, and running tests using the GoogleTest framework’s core constructs, enhancing your ability to create clear, flexible, and maintainable test suites.
