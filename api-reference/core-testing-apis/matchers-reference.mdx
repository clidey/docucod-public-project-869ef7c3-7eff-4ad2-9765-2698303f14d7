---
title: "Matcher APIs"
description: "Comprehensive guide to built-in and extensible matcher APIs for argument and value verification in tests. Includes syntax, customization, and advanced matching strategies."
---

# Matcher APIs

Explore GoogleMock's built-in matchers and learn how to create advanced, customizable matchers for verifying arguments and return values in your tests. This comprehensive guide covers the syntax, customization options, and strategies for effective argument matching in mock expectations.

---

## Introduction to Matcher APIs

Matchers are predicates that express requirements on function arguments, enabling fine-grained verification of calls made to mock objects. They empower your tests to describe the expected properties of arguments beyond simple equality, such as ranges, patterns, or complex conditions.

In GoogleMock, matchers are used within `EXPECT_CALL` and `ON_CALL` macros to specify which arguments a mock method should expect. This page details how to use these matchers effectively and extend them for complex testing needs.

---

## Using Built-in Matchers

GoogleMock comes equipped with a rich library of easily composable matchers. At the simplest, they include:

- **Wildcard matcher `_`**: Matches any argument value, e.g., `EXPECT_CALL(mock_obj, Foo(_))`.
- **Equality matchers `Eq(value)` or simply `value`**: Matches arguments equal to `value`.
- **Relational matchers**: `Lt()`, `Le()`, `Gt()`, `Ge()`, and `Ne()` for comparisons.
- **Logical combiners**: `AllOf()`, `AnyOf()`, and `Not()` to build complex conditions.
- **String matchers**: `StrEq()`, `StartsWith()`, `EndsWith()`, `HasSubstr()`, etc.
- **Container matchers**: `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, and others for collections.
- **Pointer matchers**: `IsNull()`, `NotNull()`, `Pointee()` for matching pointer values or pointees.

### Example: Using Simple Matchers

```cpp
using ::testing::_;
using ::testing::Gt;
using ::testing::StartsWith;

EXPECT_CALL(mock_obj, Func(Gt(10), StartsWith("prefix"), _));
```

This matches calls to `Func` where the first argument is greater than 10, the second argument is a string starting with "prefix", and the third argument can be anything.

---

## Writing Custom Matchers

When built-in matchers are insufficient, write your own by defining matcher classes or using `MATCHER` macros. Custom matchers let you encapsulate complex validation logic and produce informative failure messages, improving test diagnostics.

### Quick Custom Matcher with `MATCHER`

```cpp
MATCHER(IsDivisibleBy7, "Checks divisibility by 7") {
  return (arg % 7) == 0;
}

// Usage:
EXPECT_CALL(mock, Func(IsDivisibleBy7()));
```

### Parameterized Matchers with `MATCHER_P`

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return std::abs(arg) == value;
}

// Usage:
EXPECT_THAT(number, HasAbsoluteValue(10));
```

### Full Matcher Class Example

If more control is needed, implement the matcher interface directly:

```cpp
class RangeMatcher {
 public:
  using is_gtest_matcher = void;
  RangeMatcher(int low, int high) : low_(low), high_(high) {}

  bool MatchAndExplain(int value, std::ostream* os) const {
    bool match = low_ <= value && value <= high_;
    if (!match && os) {
      *os << "which is not within range [" << low_ << ", " << high_ << "]";
    }
    return match;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is in range [" << low_ << ", " << high_ << "]";
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not in range [" << low_ << ", " << high_ << "]";
  }

 private:
  int low_, high_;
};

::testing::Matcher<int> InRange(int low, int high) {
  return ::testing::MakeMatcher(new RangeMatcher(low, high));
}

// Usage:
EXPECT_CALL(mock, Func(InRange(5, 10)));
```

### Tips for Writing Matchers

- Keep matchers **pure** (no side effects).
- Produce **clear, helpful descriptions** for failures.
- Use `result_listener` or the output stream in `MatchAndExplain` to add context.
- Parameterize matchers for reusability.

---

## Advanced Matching Techniques

### Matching Multiple Arguments as a Tuple

Use `.With()` clause in `EXPECT_CALL` to constrain all arguments together:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // First arg less than second
```

The expression inside `.With()` is a matcher for a tuple of arguments.

### Selecting Specific Arguments

Use `Args<k1, k2>(matcher)` to match only selected arguments:

```cpp
EXPECT_CALL(foo, Bar(_, _, _))
    .With(Args<0, 2>(Gt(0)));  // match arg0 and arg2 > 0
```

### Combining Matchers

Combine matchers with `AllOf()`, `AnyOf()`, and `Not()` to build complex logic:

```cpp
EXPECT_CALL(foo, Bar(AllOf(Gt(5), Ne(10))));
```

### Matching Containers

Matchers like `ElementsAre()`, `UnorderedElementsAre()`, and `Contains()` allow detailed matching of containers:

```cpp
EXPECT_CALL(mock, ProcessContainer(ElementsAre(1, Gt(0), _, 5)));
```

### Matching Pointer Pointees

Use `Pointee(matcher)` to match the value pointed to:

```cpp
EXPECT_CALL(mock, Func(Pointee(Gt(5))));
```

### Casting Matchers

Use `SafeMatcherCast<T>(m)` when types differ but are compatible:

```cpp
EXPECT_CALL(mock, Foo(SafeMatcherCast<Derived*>(base_ptr_matcher)));
```

---

## Using Matchers in Expectations

Matchers are central to `EXPECT_CALL` and `ON_CALL` macros for setting up expectations and default behaviors.

### Basic Syntax

```cpp
EXPECT_CALL(mock_object, MethodName(arg_matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

The matchers specify argument expectations effectively and clearly.

### Default Matcher Behavior

If no matcher is provided for an argument, the wildcard matcher `_` applies, matching any value.

### Tips for Stable Tests

- Use only as specific matchers as necessary to avoid brittle tests.
- Use `ON_CALL` to set default behaviors without requiring call verification.
- Use `EXPECT_CALL` only when calls must be verified.
- Prefer `NiceMock<T>` to suppress warnings on uninteresting calls.

---

## Troubleshooting Matchers

### Common Issues

- **Matchers must be pure**: No side effects or stateful behaviors.
- **Type mismatches**: Use `SafeMatcherCast` or define explicit matchers.
- **Matcher evaluation order**: Later expectations shadow earlier ones.
- **Ambiguous overloads**: Help compiler by casting or specifying matchers explicitly.

### Debugging Tools

- Use `--gmock_verbose=info` to log detailed matcher and expectation activity.
- Use `EXPECT_THAT(value, matcher)` assertions to validate matcher logic.

---

## Summary

Matchers in GoogleMock provide powerful, flexible tools to specify expected argument properties concisely and clearly. By combining built-in matchers, writing custom ones, and utilizing advanced matching strategies, you can create expressive, maintainable, and robust tests.

Mastering matcher APIs ensures precise control over mock object interactions, leading to trustworthy and efficient unit tests.

---

## See Also

- [Mocking Reference](reference/mocking.md) - Integration of matchers in mock setup
- [gMock Cookbook](gmock_cook_book.md) - Recipes for creating custom matchers and using actions
- [Assertions Reference](reference/assertions.md) - Using `EXPECT_THAT` with matchers in tests
- [Matchers Reference](reference/matchers.md) - Complete list of built-in matchers
- [Action APIs](reference/actions.md) - Using actions with matchers
- [Nice, Naggy, and Strict Mocks](mock-configuration-behavior/nice-naggy-strict-mocks.md) - Managing unexpected/uninteresting calls

---

For full examples and detailed syntax, consult the official GoogleMock repository at https://github.com/google/googletest and the documentation pages linked above.

---
