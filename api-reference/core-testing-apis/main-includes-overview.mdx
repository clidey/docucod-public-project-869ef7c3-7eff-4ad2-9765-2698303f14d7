---
title: "Main Includes and Entry Points"
description: "Overview of the main header files and initialization entry points for setting up GoogleTest and GoogleMock. Learn which headers to include, available configuration flags, and supported platforms for test execution."
---

# Main Includes and Entry Points

## Overview

This page provides a comprehensive overview of the essential header files and initialization entry points you need to set up and run tests using GoogleTest and GoogleMock. Understanding which headers to include, how to initialize the testing framework, available configuration flags, and supported platforms ensures that you can start writing and executing tests smoothly and efficiently.

GoogleTest and GoogleMock together form a robust testing and mocking framework for C++. This page focuses specifically on the main includes and entry points that serve as the foundation of your test programs.

---

## Main Header Files to Include

To use GoogleMock and GoogleTest in your project, you primarily need to include the following headers:

| Header File                | Description                                               |
|----------------------------|-----------------------------------------------------------|
| `gmock/gmock.h`            | Primary GoogleMock header that internally includes GoogleTest headers and exposes the full mocking API. |
| `gtest/gtest.h`             | Core GoogleTest header providing assertions and test macros. Used if you only need testing without mocking. |

### Why Include `gmock/gmock.h`?

Including `gmock/gmock.h` is usually all you need if you require mocking capabilities because it includes all essential GoogleMock and GoogleTest headers. It provides:

- Declarative syntax support for mocks with `ON_CALL()` and `EXPECT_CALL()`.
- Built-in initialization function `InitGoogleMock()` for setting up both GoogleMock and GoogleTest.
- Access to advanced mocking features like matchers, actions, and cardinalities.

### Example Include Usage

```cpp
#include "gmock/gmock.h"  // Includes GoogleMock + GoogleTest

// Alternatively, if only testing (no mocks) is needed:
// #include "gtest/gtest.h"
```

---

## Initialization Entry Points

After including the necessary headers, you must initialize the framework before running your tests. The main initialization function is:

```cpp
void testing::InitGoogleMock(int* argc, char** argv);
```

### How to Use `InitGoogleMock`

- This function initializes GoogleMock **and** GoogleTest together.
- It parses command-line arguments to process any GoogleMock or GoogleTest specific flags.
- It modifies `argc` and `argv` to remove recognized flags, leaving application-specific flags untouched.

### Overloads and Special Cases

- `InitGoogleMock(int* argc, wchar_t** argv);` for Unicode Windows applications.
- `InitGoogleMock();` for platforms without `argc/argv` such as Arduino and some embedded systems.

### Typical Main Function using GoogleMock

```cpp
#include <iostream>
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  std::cout << "Running tests via gmock_main entry point.\n";
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Platform-Specific Entrypoints

- On embedded platforms like ESP8266, ESP32, or NRF52 (with Arduino), GoogleMock uses `setup()` and `loop()` as entry points instead of `main()`.

```cpp
void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

- On Windows Mobile, `_tmain()` is used due to platform-specific compiler and linker constraints.

---

## Linking with Provided Main Libraries

To avoid writing your own `main()` function, GoogleTest and GoogleMock provide ready-to-use main libraries:

- **`gtest_main`** — Contains a `main()` function that initializes GoogleTest.
- **`gmock_main`** — Contains a `main()` function that initializes both GoogleMock and GoogleTest.

Linking your test executable with `gmock_main` is recommended if you want to use the standard entry point with mock support.

Example CMake usage:

```cmake
add_executable(my_tests my_tests.cc)
target_link_libraries(my_tests gmock_main)
```

---

## Configuration Flags

GoogleMock recognizes several command-line flags that control test running behavior and verbosity. These are parsed by `InitGoogleMock()`.

Common flags include:

- `--gmock_verbose=<level>`: Controls verbosity level (e.g., `info`, `warning`, `error`).
- `--gmock_default_mock_behavior=<value>`: Sets default mock behavior (e.g., strict, nice).
- Flags controlling leak checks, output formatting, and more.

Any flags not recognized by GoogleMock or GoogleTest are left untouched in `argv` for your application to handle.

---

## Supported Platforms

GoogleTest and GoogleMock provide broad platform support, enabling tests to run consistently across:

- Linux
- Windows (including Windows Mobile)
- Mac OS X
- Embedded platforms such as ESP8266, ESP32, and NRF52 (Arduino environment)
- Other Unix-like systems

Special handling of entry points and initialization logic ensures compatibility with platform-specific constraints.

---

## Summary of User Workflow

1. **Include Headers**: In your test source files, include `gmock/gmock.h` for mocking or `gtest/gtest.h` for testing only.
2. **Initialize Framework**: Use `testing::InitGoogleMock(&argc, argv);` at the start of `main()`, or `testing::InitGoogleMock();` for embedded systems.
3. **Write Tests**: Define tests using `TEST()`, `TEST_F()`, and mock classes.
4. **Run Tests**: Call `RUN_ALL_TESTS()` to execute all defined tests.
5. **Link Against Main or Custom Main**: Link your test binary against `gmock_main` to avoid writing a `main()`.

---

## Practical Tips and Best Practices

- **Use `gmock_main` when possible**: It saves you from writing boilerplate main functions.
- **Call `InitGoogleMock()` once**: Multiple calls interfere with flag parsing and internal setup.
- **Check the return code of `RUN_ALL_TESTS()`**: Your `main()` function must return this exit code for proper test result reporting.
- **Configure flags early**: Pass recognized flags at test binary invocation to control behavior.
- **Be mindful of platform-specific entry points**, especially for embedded targets like Arduino or Windows Mobile.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Initialization Issues">
<Accordion title="Tests Not Running or Not Found">
Make sure `InitGoogleMock()` is called before `RUN_ALL_TESTS()`. If you use a custom `main()`, verify the proper inclusion and initialization sequence.
</Accordion>
<Accordion title="Linker Errors on main() Function">
If you include both `gmock_main` and define your own `main()`, you will get multiple definition errors. Either use `gmock_main` or your own `main()`, not both.
</Accordion>
<Accordion title="Flags Not Being Recognized">
Check that flags passed to the test executable use the `--gmock_` prefix and that `InitGoogleMock()` receives the full `argc/argv` parameters.
</Accordion>
<Accordion title="Incompatible Platforms or Compiler Errors">
Verify your build environment matches minimum C++17 support requirements and that platform-specific constraints are handled (such as entry points).
</Accordion>
</AccordionGroup>

---

## Further Reading and Related Topics

- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md) — Overview of GoogleMock capabilities.
- [GoogleTest Primer](primer.md) — A beginner-friendly introduction to writing tests.
- [Basic Configuration & Project Setup](getting-started/setup-installation/configuration-basics.md) — Details on project setup and linking.
- [Mock Classes and MOCK_METHOD API](api-reference/core-testing-apis/mock-class-api.md) — How to create mock classes.
- [Writing Expectations and Actions](guides/mocking-best-practices/writing-expectations-actions.md) — How to use GoogleMock for specifying behaviors.


---

## Example Minimal `main()` Using GoogleMock

```cpp
#include "gmock/gmock.h"
#include <iostream>

int main(int argc, char** argv) {
  std::cout << "Starting tests...\n";
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For embedded systems like Arduino, your test source would instead use:

```cpp
#include "gmock/gmock.h"

void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

Your build system should link against `gmock_main` to use Google's preprepared main, unless you have custom initializations.

---