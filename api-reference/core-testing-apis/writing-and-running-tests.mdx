---
title: "Writing & Running Tests"
description: "Learn how to define and execute test cases using GoogleTest's test discovery system, including the main entry points and environment setup. Provides details on the structure of test suites and test cases, initialization patterns, entry functions, and platform considerations."
---

# Writing & Running Tests

Learn how to define and execute test cases using GoogleTest's test discovery system, including the main entry points and environment setup. This document details the structure of test suites and test cases, initialization patterns, entry functions, and platform-specific considerations.

---

## Overview

GoogleTest simplifies writing and running tests by automatically discovering tests and organizing them into logical groups called *test suites*. Each test suite contains one or more *test cases*, which are individual test functions verifying specific program behaviors.

This guide focuses on how you can write, structure, and execute tests effectively with GoogleTest, helping you integrate testing seamlessly in your development workflow.

---

## Test Suites and Test Cases

### Defining a Test Case

At its core, a **test case** is an individual function that performs some checks (assertions) to verify code correctness.

Use the `TEST()` macro to define a test case:

```cpp
TEST(TestSuiteName, TestName) {
  ... // test code and assertions
}
```

- The first argument is the **test suite** name. Tests in the same suite are grouped together logically.
- The second argument is the specific **test case** name within that suite.

Both should be valid C++ identifiers without underscores.

Example:

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(3), 6);
}
```

Here, `FactorialTest` is the test suite holding two test cases.

### Test Case Results

- If all assertions in a test case pass, the test case is marked as **success**.
- If any assertion fails or the test crashes, it is marked as **failure**.

GoogleTest reports results suite by suite, helping you easily locate problems.

---

## Test Fixtures

When multiple tests share common objects or setup, use **test fixtures** for code reuse and maintainability.

### Creating a Fixture

1. Define a class inheriting from `testing::Test`.
2. Declare common test data members.
3. Override `SetUp()` for initialization and `TearDown()` for cleanup.

Example:

```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  Queue<int> q0_;
  Queue<int> q1_;
  Queue<int> q2_;
};
```

### Using Fixtures in Tests

Use `TEST_F()` instead of `TEST()` to access fixture members:

```cpp
TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q0_.Dequeue();
  EXPECT_EQ(n, nullptr);
  
  n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
}
```

Each test uses a fresh instance of the fixture class with the setup code executed before the test and teardown afterward.

---

## Writing the Test Program Entry Point

Most users do **not** need to write their own `main()` function because GoogleTest provides a `gtest_main` library with a suitable entry point.

If you do need to customize the entry point:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Call `InitGoogleTest()` before running tests to initialize framework flags.
- `RUN_ALL_TESTS()` runs all registered tests and returns 0 if all succeed.

### Important Notes

- Always return the value from `RUN_ALL_TESTS()` in `main()` to correctly communicate test results.
- Call `RUN_ALL_TESTS()` **only once** in your program.

---

## Test Discovery and Execution Flow

GoogleTest automatically registers tests defined by `TEST()` and `TEST_F()` macros. The framework discovers these tests at runtime, so you don't need to manually list or enumerate them.

When you invoke `RUN_ALL_TESTS()`, GoogleTest:

1. Initializes test flags.
2. Iterates over all registered tests.
3. Creates test fixture instances where applicable.
4. Runs each test case, reporting success or failure.

You can control which tests to run using command-line filters; this helps focus on subsets of tests during development.

---

## Platform and Environment Setup

- GoogleTest supports Linux, Windows, and Mac with comprehensive cross-platform compatibility.
- The `InitGoogleTest()` function properly parses and consumes command-line flags.
- On Windows, `InitGoogleTest()` supports wide-character command-line arguments, allowing easy Unicode program execution.

---

## Best Practices

- **Name test suites and tests consistently** to reflect the code structure and intent.
- Use test fixtures to avoid repetition and centralize common setup.
- Group logically related tests in the same suite.
- Always check the return value of `RUN_ALL_TESTS()` in your main to ensure test failures are detected.

---

## Troubleshooting

- If tests are not discovered or run, ensure the test has been linked properly and uses the correct test macro.
- Compilation errors often arise from missing `main()` or misusing `TEST_F()` without a defined fixture.
- Use command-line flags like `--gtest_filter` to restrict which tests run for easier debugging.

---

## Example: Simple Test Program

```cpp
#include <gtest/gtest.h>

// Sample function to test
int Square(int x) {
  return x * x;
}

// Define a test suite named MathTest with a test named HandlesPositiveInput
TEST(MathTest, HandlesPositiveInput) {
  EXPECT_EQ(Square(5), 25);
  EXPECT_EQ(Square(10), 100);
}

// Use test fixture for shared setup
class MathFixture : public testing::Test {
 protected:
  void SetUp() override {
    factor_ = 3;
  }
  int factor_;
};

TEST_F(MathFixture, MultiplyByFactor) {
  EXPECT_EQ(factor_ * 4, 12);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This program defines two tests, one simple and one using a fixture, then runs all tests.

---

## Additional Resources

For detailed guidance on writing assertions, mocks, and advanced test features, see:

- [GoogleTest Primer](primer.md)
- [Assertions API](/api-reference/core-testing-apis/assertions-api)
- [Mocking Reference](docs/reference/mocking.md)
- [Test Fixtures](primer.md#same-data-multiple-tests)
- [Writing Your First Test](guides/getting-started/writing-your-first-test)

Explore platform setup and troubleshooting if you run into build or runtime issues.

---