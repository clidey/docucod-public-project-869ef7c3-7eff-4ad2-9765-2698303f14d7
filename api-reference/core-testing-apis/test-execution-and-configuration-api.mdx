---
title: "Test Execution & Configuration"
description: "API reference for running and controlling tests, including command-line options, environment setup, and test filtering. Guides users through customizing execution with main(), listeners, environment variables, and configuration APIs for seamless CI integration and debugging."
---

# Test Execution & Configuration API Reference

This page provides a detailed API reference for executing and controlling tests with GoogleTest and GoogleMock. It guides you through customizing test runs using `main()`, registering listeners, configuring via environment variables, and using runtime configuration APIs. Whether you are running simple test suites or integrating into a CI environment, this reference empowers you to tailor test execution to your needs for robust validation and insightful debugging.

---

## Overview

GoogleTest and GoogleMock empower you to write and run C++ tests efficiently. The test execution API enables you to:

- Compile and run tests via a customizable `main()` function.
- Register and manage event listeners to hook into the test lifecycle.
- Filter and select tests to run using command-line and environment variables.
- Configure test properties programmatically and at runtime.
- Integrate seamlessly with CI/CD pipelines and IDEs.

This reference documents the key components and best practices for managing test execution and configuration.

---

## 1. Customizing Test Execution with `main()`

GoogleTest and GoogleMock provide a default `main()` via `gmock_main.cc` that initializes the framework and runs all tests. However, you can create your own `main()` for further control:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);  // Initializes GoogleTest and GoogleMock
  return RUN_ALL_TESTS();                // Runs all registered tests
}
```

**Key Points:**

- `InitGoogleMock()` parses command-line flags for GoogleTest and GoogleMock.
- It is required to call `InitGoogleMock` before running tests.
- `RUN_ALL_TESTS()` executes all tests and returns the test status.
- For embedded or special platforms, alternative signatures or `InitGoogleMock()` without parameters are available.

**Tip:** Use your own `main()` if you want to parse additional custom command-line options or initialize other systems before running tests.

---

## 2. Test Listeners & Event Hooks

GoogleTest supports *listeners* which are user-defined hooks into the test lifecycle. This allows you to observe, customize, or extend test run behavior.

### Registering Listeners

```cpp
class MyListener : public testing::EmptyTestEventListener {
  void OnTestStart(const testing::TestInfo& test_info) override {
    std::cout << "Starting test: " << test_info.name() << std::endl;
  }
};

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  testing::TestEventListeners& listeners =
      testing::UnitTest::GetInstance()->listeners();

  listeners.Append(new MyListener);  // Adds custom listener

  return RUN_ALL_TESTS();
}
```

### Listener Lifecycle Callbacks

Listeners provide callbacks such as:

- `OnTestProgramStart()` / `OnTestProgramEnd()` - for test suite lifecycle
- `OnTestCaseStart()` / `OnTestCaseEnd()` (deprecated in favor of TestSuite)
- `OnTestSuiteStart()` / `OnTestSuiteEnd()` - for grouping of tests
- `OnTestStart()` / `OnTestEnd()` - per individual test
- `OnTestPartResult()` - after each assertion

### Use Cases

- Logging test start and completion
- Capturing custom metrics
- Executing setup or teardown code outside fixtures
- Integrating with custom dashboards or reporting tools

---

## 3. Runtime Configuration

GoogleTest offers multiple ways to configure tests without recompiling.

### Command-line Flags

Run tests with useful flags:

- `--gtest_filter=POSITIVE_PATTERN[-NEGATIVE_PATTERN]`: Runs only tests matching the positive pattern and excluding the negative one, e.g., `--gtest_filter=MyTestSuite.*`.
- `--gtest_break_on_failure`: Breaks into the debugger on test failure.
- `--gtest_repeat=N`: Runs all tests `N` times.
- `--gtest_shuffle`: Randomizes test execution order.
- And many others for output format, list tests, etc.

### Environment Variables

GoogleTest picks up certain environment variables to influence test running. For example:

- `GTEST_FILTER` for filtering tests
- `GTEST_SHUFFLE` to enable test shuffling

These allow configuration on environments where passing command-line flags is difficult.

### Programmatic Configuration API

Besides flags and environment variables, the API lets you adjust settings, for example:

```cpp
// Access test event listener manager
auto* listeners = testing::UnitTest::GetInstance()->listeners();

// Remove default result printer listener
delete listeners->Release(listeners->default_result_printer());

// Add custom result printer
listeners->Append(new CustomPrinter());
```

Use these techniques to tailor output, run selective tests, or control behavior dynamically.

---

## 4. Filtering and Selecting Tests

Test filtering is essential to running targeted subsets in large suites.

### Using `--gtest_filter`

Filter expressions support wildcards and can exclude tests. Examples:

```shell
--gtest_filter=MyTestSuite.Test1    # Run only this test
--gtest_filter=MyTestSuite.*:OtherTestSuite.*     # Multiple suites
--gtest_filter=-MyTestSuite.FlakyTest              # Exclude flaky test
--gtest_filter=MyTestSuite.*-MyTestSuite.FlakyTest # Run suite except flaky
```

### Filtering via API

You can programmatically filter tests by overriding the test loading and execution process using listeners or custom `main()`.

---

## 5. Environment Setup and Test Fixtures

While test fixtures are documented elsewhere, configuring the environment that tests run in is crucial for consistent results.

- Environment variables can store credentials, paths, or config options.
- Set up environment globals via `testing::Environment` subclasses.

Example:

```cpp
class MyEnv : public testing::Environment {
 public:
  void SetUp() override {
    // Initialize database connections
  }
  void TearDown() override {
    // Clean up database connections
  }
};

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  testing::AddGlobalTestEnvironment(new MyEnv);
  return RUN_ALL_TESTS();
}
```

---

## 6. Integration Considerations

For smooth operation in environments like CI, IDEs, or custom runners:

- Use XML or JSON output formats with `--gtest_output=xml[:path]` for CI reports.
- Control verbosity with `--gtest_verbose=LEVEL`.
- Capture and analyze test failures using return codes from `RUN_ALL_TESTS()`.

---

## 7. Troubleshooting

- **Tests not running?** Ensure `InitGoogleMock` is called before `RUN_ALL_TESTS()`.
- **Filtering not working?** Verify correct use of `--gtest_filter` syntax.
- **Output not appearing?** Check if custom listeners override default printers.
- **Unexpected test failures?** Run with `--gtest_break_on_failure`.

---

## 8. Summary

GoogleTest's Test Execution and Configuration API provides flexible mechanisms to run, manage, and debug your tests effectively. Customize the lifecycle with listeners, control which tests run with filters, extend test setup with environments, and integrate into diverse workflows with confidence.

---

## Example: Basic Custom Main with Listener Registration

```cpp
#include <gmock/gmock.h>
#include <iostream>

class MyListener : public testing::EmptyTestEventListener {
 public:
  void OnTestStart(const testing::TestInfo& info) override {
    std::cout << "Test starting: " << info.test_suite_name() << "." << info.name() << std::endl;
  }

  void OnTestEnd(const testing::TestInfo& info) override {
    std::cout << "Test ended: " << info.test_suite_name() << "." << info.name()
              << (info.result()->Passed() ? " PASSED" : " FAILED") << std::endl;
  }
};

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  testing::TestEventListeners& listeners = testing::UnitTest::GetInstance()->listeners();

  listeners.Append(new MyListener());

  return RUN_ALL_TESTS();
}
```

## Further Reading and Useful Links

- [Writing Your First Test](../getting-started/first-test-workflow/writing-your-first-test)
- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting-validation/common-setup-issues)
- [Running and Validating Your Tests](../getting-started/first-test-workflow/running-tests)
- [Integrating with Bazel and CMake](../guides/integration-solutions/build-integration)
- [System Architecture Overview](../overview/architecture-features-integration/system-architecture-overview)

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/src/gmock_main.cc", "range": "1-75"}, {"path": "googlemock/gmock-spec-builders.cc", "range": "1-250"}]} />