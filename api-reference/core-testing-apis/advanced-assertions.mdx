---
title: "Advanced Assertions: Death and Parameterized Tests"
description: "Explains advanced testing features, including death tests for crash/error code and parameterized tests for repeated execution with varying values or types. Includes setup, usage, and limitations."
---

# Advanced Assertions: Death and Parameterized Tests

This section dives into advanced testing features of GoogleTest that enable verification of program behaviors involving process termination and efficient test reuse through parameterization. It covers the setup, usage, and limitations of death tests—which confirm that code aborts or crashes as expected—and parameterized tests—which allow repeated execution of the same test logic across varied input values or types.

---

## Death Tests

Death tests ensure your code properly terminates—via abnormal process termination or explicit exits—under error conditions or violated invariants. This capability is vital for testing code that enforces assertions or triggers fatal failure handlers to avoid undefined or corrupted states.

### How Death Tests Work

GoogleTest executes death tests by spawning child processes to run the code snippet that is expected to terminate the process. This isolation protects the main test runner and allows verification of exit status and error output.

- On POSIX platforms, the child process is created using `fork()` or `clone()` (Linux).
- On Windows, the child process is started via `CreateProcess()`.

The style of death tests depends on the flag `::testing::GTEST_FLAG(death_test_style)`, defaulted to "fast":

- "fast": Executes the test code immediately after `fork()`. Minimal overhead but less thread-safe.
- "threadsafe": Re-executes the test binary in the child with extra flags to run only the target death test, improving thread safety but with performance cost.

Invalid values for this flag will cause death tests to fail.

### Death Test Macros

GoogleTest provides the following main macros:

#### `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)`

Validates that `statement` causes the process to terminate with a non-zero exit status and produces stderr output matching `matcher`, which can be a regex or a matcher for strings.

Example:

```cpp
TEST(MyDeathTest, CrashOnInvalidInput) {
  EXPECT_DEATH(MyFunction(-1), "Invalid input: -1");
}
```

#### `EXPECT_DEATH_IF_SUPPORTED(statement, matcher)`

Runs like `EXPECT_DEATH` if death tests are supported on the current platform, otherwise passes without effect.

#### `EXPECT_DEBUG_DEATH(statement, matcher)`

Runs like `EXPECT_DEATH` only in debug builds (`NDEBUG` not defined), otherwise executes `statement` normally without checking termination.

#### `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT(statement, predicate, matcher)`

Validates the process terminates with an exit code satisfying `predicate` (a callable or special predicates), and produced stderr output matching `matcher`.

GoogleTest provides two common predicates:

```cpp
::testing::ExitedWithCode(exit_code);             // Checks normal exit with exit_code.
::testing::KilledBySignal(signal_number);          // Checks signal termination. Not on Windows.
```

Example:

```cpp
EXPECT_EXIT(CleanExitFunction(), ::testing::ExitedWithCode(0), "Success");
```

### Death Test Usage Notes

- `statement` can be a compound statement (a block of code in `{ ... }`).
- The stderr matching supports GoogleTest matchers or regular expressions.
- If the `statement` does not terminate as expected, the assertion fails.
- Avoid using fatal assertion macros like `ASSERT_*` inside death tests unless you intend to cause termination.
- Since the death test executes in a child process, any in-memory side effects are not observable in the parent process.

### Best Practices

- Name test suites containing death tests with the suffix `DeathTest` to avoid conflicts and help GoogleTest execute them first.
- Use `GTEST_FLAG_SET(death_test_style, "threadsafe")` for better safety in multi-threaded environments, especially important if any threads exist before the death test runs.
- Avoid freeing resources in death tests that would cause memory leaks detected by the parent process.
- Ensure mock objects used in death tests are allowed to leak or are handled correctly since process termination bypasses usual cleanup.

### Common Pitfalls

<Warning>
Death tests rely on re-executing the binary or forking, so tests involving threads, or with side effects that are expected to persist beyond test execution, can be problematic.
</Warning>

<Warning>
Placing multiple death assertions on the same line is illegal and will cause compilation errors.
</Warning>

---

## Parameterized and Typed Tests

Parameterized and typed tests promote test reuse by running the same test code repeatedly with varying input parameters or types, improving coverage and reducing boilerplate.

### Value-Parameterized Tests

These tests take a parameter value that varies across test runs. They are suitable when you want to run the same test logic on different inputs.

#### Defining Value-Parameterized Tests

1. Derive your fixture class from `testing::TestWithParam<T>`, where `T` is the parameter type.

```cpp
class MyTest : public testing::TestWithParam<int> {
  // Fixture setup and members
};
```

2. Use `TEST_P` to define tests using the parameter. Access the parameter with `GetParam()`:

```cpp
TEST_P(MyTest, IsEvenTest) {
  int n = GetParam();
  EXPECT_EQ(n % 2, 0);
}
```

3. Instantiate the parameter values with `INSTANTIATE_TEST_SUITE_P`:

```cpp
INSTANTIATE_TEST_SUITE_P(EvenNumbers, MyTest, testing::Values(2, 4, 6, 8));
```

#### Notes

- Parameter type `T` must be copyable.
- You can instantiate a test suite multiple times with different parameter sets.

#### Naming

The full test name includes the instantiation prefix, test suite name, test name, and parameter index.

#### Limitations

- If no instances are defined via `INSTANTIATE_TEST_SUITE_P`, the test suite will register as uninstantiated and not run unless suppressed.

---

### Typed Tests

Typed tests let you specify tests that run for multiple types instead of values, ideal for testing template classes or interfaces against various implementations.

#### Defining Typed Tests

1. Define a test fixture template:

```cpp
template <typename T>
class MyTypedTest : public testing::Test {
  // Fixture code
};
```

2. Register the types to test with `TYPED_TEST_SUITE`:

```cpp
using MyTypes = ::testing::Types<int, float, double>;
TYPED_TEST_SUITE(MyTypedTest, MyTypes);
```

3. Define test cases with `TYPED_TEST`, using the special `TypeParam` to represent the current type:

```cpp
TYPED_TEST(MyTypedTest, TestBehavior) {
  TypeParam val = TypeParam();
  // Test logic using val
}
```

---

## Example: Death Test

```cpp
TEST(FooDeathTest, CrashOnNullPointer) {
  EXPECT_DEATH({
    Foo(nullptr);  // Should cause process termination
  }, "Null pointer passed to Foo");
}
```

## Example: Parameterized Test

```cpp
class IsEvenTest : public testing::TestWithParam<int> {};

TEST_P(IsEvenTest, ReturnsTrueForEvenNumbers) {
  int n = GetParam();
  EXPECT_EQ(n % 2, 0);
}

INSTANTIATE_TEST_SUITE_P(EvenNumbers, IsEvenTest, testing::Values(2, 4, 6, 8));
```

## Troubleshooting

<AccordionGroup title="Common Issues with Death and Parameterized Tests">
<Accordion title="Death Test Does Not Detect Process Termination">
Ensure the death test code triggers a fatal termination (e.g., via `abort()` or failed assertion). Code that throws exceptions or handles errors without terminating will not cause death test to pass.
</Accordion>
<Accordion title="Regular Expressions Not Matching">
Remember GoogleTest supports POSIX extended regex syntax. On Windows, support is limited. Be sure your regex matches stderr output format in child process.
</Accordion>
<Accordion title="Parameterized Test Fails to Run">
Verify that you have instantiated your test suite with `INSTANTIATE_TEST_SUITE_P`. Test suites without instantiations register as uninstantiated.
</Accordion>
</AccordionGroup>

---

## References

- [Assertions Reference](reference/assertions.md#death)
- [GoogleTest Advanced Guide: Death Tests](docs/advanced.md#death-tests)
- [Value-Parameterized Tests](docs/advanced.md#value-parameterized-tests)
- [Typed Tests](docs/advanced.md#typed-tests)

For detailed examples and best practices, consult related guides:

- [Writing and Organizing Tests](api-reference/core-testing-apis/writing-tests)
- [Matchers Reference](reference/matchers.md)
- [GoogleMock Cookbook](docs/gmock_cook_book.md)

---

This page fits into the API reference as a specialized section on advanced assertion patterns, complementing guides and references on basic assertions and test writing.
