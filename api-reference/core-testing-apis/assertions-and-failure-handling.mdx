---
title: "Assertions and Failure Handling"
description: "Documents core assertion macros, custom predicate assertions, fatal vs non-fatal failures, and mechanisms for detailed assertion results. Explains how to check values, exceptions, and implement custom assertions."
---

# Assertions and Failure Handling

This documentation details the core assertion macros offered by GoogleTest to verify code correctness and behavior. These macros allow checking Boolean expressions, comparing values, confirming exception throwing, and crafting custom assertions for specific predicate logic. Understanding their behavior—especially the difference between fatal and non-fatal failures—is essential for writing robust, clear, and maintainable tests.

---

## Understanding Fatal vs Non-Fatal Assertion Failures

GoogleTest provides assertion macros in pairs, distinguished by their failure severity:

- **`EXPECT_` macros**: Generate *non-fatal failures*. When an `EXPECT_` macro fails, the test records a failure but continues executing the current function and test.
- **`ASSERT_` macros**: Generate *fatal failures*. When an `ASSERT_` macro fails, it aborts the current function immediately, preventing any subsequent code within that function from running.

This duality offers flexibility in tests; use `EXPECT_` when it is safe for the test to continue despite failure, and `ASSERT_` when later code depends on the assertion being true.

### Custom Failure Messages

Both variants support user-defined failure messages streamed with the `<<` operator. For example:

```cpp
EXPECT_TRUE(user_condition) << "Condition was expected to be true but was false";
```

You can stream anything printable to an `ostream`, including strings, numbers, and custom types.


## Explicit Success and Failure Macros

Sometimes, your control flow dictates success or failure directly without testing a specific expression.

### SUCCEED()

Explicitly generates a *success* at that point in the test. Note that it doesn’t force the test to pass if other assertions fail.

Use it as documentation or to mark progress nuancedly:

```cpp
SUCCEED() << "Reached this point successfully";
```

### FAIL()

Generates a *fatal failure* that immediately aborts the current void-returning function.

Example use inside a `switch` default case:

```cpp
switch (status) {
  case OK:
    ... // checks
    break;
  default:
    FAIL() << "Unexpected status.";
}
```

**Important:** `FAIL()` may only be used in functions that return `void`.

### ADD_FAILURE()

Generates a *non-fatal failure* allowing the test to continue.

Example:

```cpp
if (!CheckCondition()) {
  ADD_FAILURE() << "Condition failed, but continuing.";
}
```

### ADD_FAILURE_AT(file, line)

Thu a same as `ADD_FAILURE()`, but the failure is reported at a specific source file and line number.

Example:

```cpp
ADD_FAILURE_AT("foo.cc", 42) << "Issue found here.";
```


## Boolean Condition Assertions

Use these macros to check if conditions hold true or false.

| Macro                  | Description                          |
|------------------------|------------------------------------|
| `EXPECT_TRUE(cond)`     | Passes if `cond` is `true`.         |
| `ASSERT_TRUE(cond)`     | Fatal check that `cond` is `true`.  |
| `EXPECT_FALSE(cond)`    | Passes if `cond` is `false`.        |
| `ASSERT_FALSE(cond)`    | Fatal check that `cond` is `false`. |

All accept custom failure messages streamed via `<<`.


## Binary Comparison Assertions

Check the relationship between two values. GoogleTest handles printing values for various types automatically.

| Macro                       | Computes                 | Notes                                           |
|-----------------------------|--------------------------|-------------------------------------------------|
| `EXPECT_EQ(val1, val2)`      | `val1 == val2`           | For pointers, compares addresses. Use `EXPECT_STREQ` for C-strings. When comparing pointer vs `nullptr`, use `EXPECT_EQ(ptr, nullptr)`.
| `ASSERT_EQ(val1, val2)`      | Fatal version of `EXPECT_EQ` |                                                 |
| `EXPECT_NE(val1, val2)`      | `val1 != val2`           | Same pointer rules as `EXPECT_EQ` apply.        |
| `ASSERT_NE(val1, val2)`      | Fatal `!=` check         |                                                 |
| `EXPECT_LT(val1, val2)`      | `val1 < val2`            |                                                 |
| `ASSERT_LT(val1, val2)`      | Fatal `<` check          |                                                 |
| `EXPECT_LE(val1, val2)`      | `val1 <= val2`           |                                                 |
| `ASSERT_LE(val1, val2)`      | Fatal `<=` check         |                                                 |
| `EXPECT_GT(val1, val2)`      | `val1 > val2`            |                                                 |
| `ASSERT_GT(val1, val2)`      | Fatal `>` check          |                                                 |
| `EXPECT_GE(val1, val2)`      | `val1 >= val2`           |                                                 |
| `ASSERT_GE(val1, val2)`      | Fatal `>=` check         |                                                 |

**Example:**

```cpp
int a = 5;
int b = 6;
EXPECT_LT(a, b) << "a should be less than b";
ASSERT_EQ(a + 1, b);
```


## String Comparison Assertions

Use these to compare **C strings** (`char*`), including wide strings (`wchar_t*`). For `std::string`, use `EXPECT_EQ`.

| Macro                    | Checks                                                          |
|--------------------------|-----------------------------------------------------------------|
| `EXPECT_STREQ(str1, str2)` | `str1` has same contents as `str2`                              |
| `ASSERT_STREQ(str1, str2)` | Fatal version of `EXPECT_STREQ`                                 |
| `EXPECT_STRNE(str1, str2)` | `str1` has different contents from `str2`                      |
| `ASSERT_STRNE(str1, str2)` | Fatal version of `EXPECT_STRNE`                                 |
| `EXPECT_STRCASEEQ(str1, str2)` | `str1` and `str2` are equal ignoring case                      |
| `ASSERT_STRCASEEQ(str1, str2)` | Fatal ignoring case equality check                             |
| `EXPECT_STRCASENE(str1, str2)` | `str1` and `str2` are *not* equal ignoring case               |
| `ASSERT_STRCASENE(str1, str2)` | Fatal not equal ignoring case check                            |

Use `nullptr` in place of C-strings to test null pointers for equality. Use streaming failure messages to add context.


## Floating-Point Comparisons

Comparing floating-point values for exact equality is generally unsafe due to rounding errors. GoogleTest provides specialized macros which use an approximate comparison with a carefully chosen tolerance.

| Macro                  | Description                                                                                               |
|------------------------|-----------------------------------------------------------------------------------------------------------|
| `EXPECT_FLOAT_EQ(val1, val2)`  | Checks if two `float`s are approximately equal (within 4 ULPs)                                         |
| `ASSERT_FLOAT_EQ(val1, val2)`  | Fatal version of `EXPECT_FLOAT_EQ`                                                                    |
| `EXPECT_DOUBLE_EQ(val1, val2)` | Checks if two `double`s are approximately equal (within 4 ULPs)                                         |
| `ASSERT_DOUBLE_EQ(val1, val2)` | Fatal version of `EXPECT_DOUBLE_EQ`                                                                   |
| `EXPECT_NEAR(val1, val2, abs_error)`  | Checks if the absolute difference is within the `abs_error` tolerance                                |
| `ASSERT_NEAR(val1, val2, abs_error)`  | Fatal version of `EXPECT_NEAR`                                                                       |

If you need to compare floating-point values with predicates providing rich diagnostics, see [Advanced Predicate Format Assertions](#predicate-assertions).


## Exception Assertions

Require exceptions enabled to test whether code throws or not.

| Macro                     | Description                                   |
|---------------------------|-----------------------------------------------|
| `EXPECT_THROW(statement, exception_type)`  | Verifies statement throws the specified exception type        |
| `ASSERT_THROW(statement, exception_type)`  | Fatal version                                                   |
| `EXPECT_ANY_THROW(statement)`               | Verifies statement throws any exception                         |
| `ASSERT_ANY_THROW(statement)`               | Fatal version                                                   |
| `EXPECT_NO_THROW(statement)`                | Verifies statement does *not* throw any exception               |
| `ASSERT_NO_THROW(statement)`                | Fatal version                                                   |

Example:

```cpp
EXPECT_THROW(MyFunction(), std::runtime_error);
EXPECT_NO_THROW(Initialize());
```

You can wrap multiple statements in a compound statement:

```cpp
EXPECT_NO_THROW({
  int n = 5;
  StartProcess(&n);
});
```


## Custom Predicate Assertions

GoogleTest allows building rich, extendable assertions when built-in macros do not suffice.

### Predicate Assertions (`EXPECT_PRED*`, `ASSERT_PRED*`)

Check arbitrary unary or multi-argument predicates returning `bool`. They print argument values when failed to aid debugging:

```cpp
bool IsPrime(int n) { ... }
EXPECT_PRED1(IsPrime, 7);  // Checks if 7 is prime.
```

They support up to 5 arguments, e.g., `EXPECT_PRED2`, `EXPECT_PRED3`.

**Note:** If your predicate is overloaded or templated, you might need explicit casts to specify which to apply.

### Predicate-Formatter Assertions (`EXPECT_PRED_FORMAT*`, `ASSERT_PRED_FORMAT*`)

Provide fully customizable failure messages, by defining a predicate-formatter function or functor returning `testing::AssertionResult`:

```cpp
// Custom predicate-formatter for asserting two values are mutually prime.
testing::AssertionResult AssertMutuallyPrime(const char* expr1, const char* expr2, int m, int n) {
  if (IsMutuallyPrime(m, n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr1 << " and " << expr2 << " are not mutually prime";
}
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

This mechanism allows expressive error messages while avoiding the limitations of plain `EXPECT_TRUE`.

## Generalized Assertions Using Matchers

The `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` macros allow verification using GoogleMock matchers—providing expressive and composable assertion logic. Matchers are carefully designed to generate readable failure messages.

Example:

```cpp
EXPECT_THAT(str, StartsWith("Hello"));
ASSERT_THAT(number, AllOf(Gt(5), Lt(10)));
```

See the [Matchers Reference](matchers.md) for comprehensive matcher options and how to write your own.


## Summary of Assertion Macros by Usage

| Usage                | Example                                  |
|----------------------|------------------------------------------|
| Check Boolean        | `EXPECT_TRUE(condition);`                 |
| Compare Values       | `EXPECT_EQ(a, b);`                        |
| Compare C Strings    | `EXPECT_STREQ(cstr1, cstr2);`             |
| Floating Comparison  | `EXPECT_DOUBLE_EQ(x, y);`                  |
| Exception Checking   | `EXPECT_THROW(call(), std::exception);`  |
| Custom Predicates    | `EXPECT_PRED_FORMAT2(my_pred, x, y);`    |
| Matcher Usage        | `EXPECT_THAT(val, matcher);`              |
| Explicit Success     | `SUCCEED();`                             |
| Explicit Failure     | `FAIL();`                                |
| Non-fatal Failure    | `ADD_FAILURE();`                         |


## Practical Tips

- Choose `ASSERT_` macros when subsequent code depends on the assertion.
- Use `EXPECT_` macros when you want to continue test execution to find multiple errors.
- Stream clear, concise failure messages to help your future self and teammates.
- When comparing C strings, use `EXPECT_STREQ` rather than `EXPECT_EQ`.
- Use `EXPECT_THAT` with GoogleMock matchers for more expressive and user-friendly assertions.
- Prefer predicate-format assertions over `EXPECT_TRUE` with complex conditions for better diagnostics.
- Remember fatal assertions can only be used in void-returning functions.


## Troubleshooting Common Failures

- **Unexpected test continuation after `ASSERT_` failure:** Remember `ASSERT_*` aborts only the current function. Fatal failure won't stop the whole test unless combined with control flow.

- **Comparing C strings with `EXPECT_EQ`:** This will compare pointer addresses, leading to false failures. Use `EXPECT_STREQ` instead.

- **Floating-point comparison fails despite values appearing equal:** Use the floating-point comparison macros like `EXPECT_FLOAT_EQ` or `EXPECT_NEAR` rather than `EXPECT_EQ`.

- **Overloaded or templated predicates in `EXPECT_PRED*` cause errors:** Perform explicit casts or specify template parameters.

- **Assertion messages missing or not descriptive:** Utilize predicate-format assertions or custom matchers for richer diagnostics.

- **Fatal assertions in non-void functions cause compile errors:** Refactor function to return `void` or use `EXPECT_` variants.


---

## Examples

### Basic Boolean Check

```cpp
TEST(ExampleTest, BoolCheck) {
  bool success = PerformOperation();
  EXPECT_TRUE(success) << "PerformOperation failed";
}
```

### Checking Equality of Values

```cpp
TEST(ExampleTest, EqualityCheck) {
  EXPECT_EQ(5, Add(2, 3));
  ASSERT_NE(nullptr, ptr) << "Pointer should not be null";
}
```

### Comparing C Strings

```cpp
TEST(StringTest, CStringComparison) {
  const char* expected = "hello";
  const char* actual = GetString();
  EXPECT_STREQ(expected, actual);
}
```

### Floating Point Approximate Equality

```cpp
TEST(FloatingPointTest, NearEquality) {
  EXPECT_FLOAT_EQ(3.14f, ComputePi());
  ASSERT_NEAR(0.001, ComputeThreshold(), 0.0001);
}
```

### Checking Exception Throwing

```cpp
TEST(ExceptionTest, ThrowsCorrectly) {
  EXPECT_THROW(RiskyOperation(), std::runtime_error);
  ASSERT_NO_THROW(SafeOperation());
}
```

### Using Predicate Assertion

```cpp
bool IsEven(int n) { return n % 2 == 0; }

TEST(PredicateTest, IsEvenCheck) {
  EXPECT_PRED1(IsEven, 4);
}
```

### Using Predicate-Formatter for Descriptive Assertion

```cpp
testing::AssertionResult IsEvenWithMessage(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is odd";
}

TEST(PredicateFormatTest, IsEvenCheck) {
  EXPECT_PRED_FORMAT1(IsEvenWithMessage, 3);
}
```

### Using Matchers

```cpp
#include <gmock/gmock.h>

using ::testing::StartsWith;

TEST(MatcherTest, StringStartsWith) {
  std::string s = "Hello, World!";
  EXPECT_THAT(s, StartsWith("Hello"));
}
```

---

For a full list of assertion macros and usage details, see the [Assertions Reference](reference/assertions.md).


---

## See Also

- [Matchers Reference](matchers.md) — Comprehensive guide to built-in and custom matchers.
- [Writing Custom Assertions and Matchers](guides/advanced-testing-patterns/custom-assertions-and-matchers.mdx)
- [Exception Assertions](reference/assertions.md#exceptions)
- [Death Tests](guides/advanced-testing-patterns/death-tests.mdx)
- [Parameterized and Typed Tests](guides/advanced-testing-patterns/parameterized-and-typed-tests.mdx)
- [Test Infrastructure](api-reference/core-testing-apis/test-infrastructure.md)


---

## Summary

This documentation page covers GoogleTest's core assertion macros including explicit success/failure, Boolean assertions, binary and string comparisons, floating-point assertions, exception checks, predicate and predicate-formatter assertions, and the use of matchers for expressive validations. It explains the critical distinction between fatal (`ASSERT_`) and non-fatal (`EXPECT_`) failures and demonstrates how to write clear, actionable tests with practical examples and troubleshooting tips.

Main sections include:
- Fatal vs Non-Fatal Failures
- Explicit Success and Failure Macros
- Boolean Condition Assertions
- Binary and String Comparisons
- Floating-Point Comparisons
- Exception Assertions
- Custom Predicate Assertions
- Matcher-Based Assertions
- Practical Tips and Common Pitfalls

For further mastery, users should consult related documents such as the [Matchers Reference](matchers.md), [Custom Assertions and Matchers Guide](guides/advanced-testing-patterns/custom-assertions-and-matchers.mdx), and [Parameterized and Typed Tests Guide](guides/advanced-testing-patterns/parameterized-and-typed-tests.mdx). This page fits into the core testing APIs of GoogleTest and builds from introductory test writing guides toward advanced test construction techniques.

Action items:
- Review [Assertions Reference](reference/assertions.md) for complete macros.
- Explore matcher and predicate usage to build readable and maintainable tests.
- Understand test failure classifications to use the correct assertion variants.
- Combine this knowledge with teaching value-printing and event listeners (see [Test Infrastructure](api-reference/core-testing-apis/test-infrastructure.md)) for full-featured tests.

