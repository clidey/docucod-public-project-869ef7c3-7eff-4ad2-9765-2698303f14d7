---
title: "Writing and Running Tests"
description: "Covers the fundamental APIs for defining, registering, and executing unit tests using GoogleTest. Includes core macros (TEST, TEST_F, etc.), test suite structure, test runner invocation, and platform support considerations, with usage examples. Ideal for users new to the framework or seeking a refresher on test basics."
---

# Writing and Running Tests

## Overview

This section introduces the fundamental APIs of GoogleTest that allow you to define, register, and execute unit tests effectively. It explains how to write basic tests using macros, organize test suites, utilize test fixtures, and run tests with proper initialization. Ideal for developers new to GoogleTest or needing a refresher on core testing workflows.

---

## Defining Tests

### TEST

The simplest way to define a test in GoogleTest is to use the `TEST` macro. It creates an independent test with a specific name inside a test suite.

```cpp
TEST(TestSuiteName, TestName) {
  ... test code ...
}
```

- **TestSuiteName** is the grouping name for related tests.
- **TestName** is the individual test’s identifier within the suite.

These must be valid C++ identifiers and **should not contain underscores** to avoid naming conflicts or compilation issues.

*Example:* Testing a factorial function:

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(4), 24);
}
```

Tests in the same suite share a conceptual grouping but do not share state.

---

### TEST_F: Using Test Fixtures

For tests that require a common data setup or cleanup, GoogleTest supports *test fixtures*. A test fixture is a class derived from `testing::Test` that holds shared data and setup/teardown logic.

Define a fixture class:

```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    // Initialize data structures shared by tests
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  Queue<int> q0_;  // Empty queue
  Queue<int> q1_;  // Contains 1 element
  Queue<int> q2_;  // Contains 2 elements
};
```

Use `TEST_F` macro to write tests using this fixture:

```cpp
TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
}
```

Each test runs with a fresh fixture instance. GoogleTest creates a new instance of your fixture class for every test, calls its `SetUp()` method, runs the test body, then calls `TearDown()` and finally deletes the instance.

*Note:* The fixture constructor is a great place for constant setup, while `SetUp()`/`TearDown()` are preferred for operations that might fail or require assertions.

---

### Naming Tests Without Underscores

GoogleTest reserves underscores (`_`) for special purposes such as prefixes like `DISABLED_`. Additionally, test suite and test names with underscores can create internal name collisions causing confusing errors. For robust tests:

- Avoid underscores in test suite and test names.
- Use CamelCase or PascalCase formatting for names.

See [GoogleTest FAQ](faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore) for the detailed rationale and examples.

---

## Running Tests

### Initializing GoogleTest

Before running tests, initialize GoogleTest to parse and apply command-line flags:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- This sets up GoogleTest’s internal state and command line options.
- On Windows, an overload accepting `wchar_t**` is provided for `UNICODE` builds.

### Executing Tests

Invoke `RUN_ALL_TESTS()` to execute all registered tests:

- Returns 0 if all tests pass, 1 if any test fails.
- Runs each test suite and test in registration order (modifiable with filters/shuffle).
- Handles fixture setup/teardown transparently.

*Important:* Always return the value of `RUN_ALL_TESTS()` from `main()` to ensure the test program signals failures correctly to the environment.

---

## Advanced Organization

### Test Fixtures Lifecycle

For each individual test:

1. Instantiate the fixture class.
2. Call the fixture’s `SetUp()` method.
3. Run the test defined inside `TEST_F`.
4. Call the fixture’s `TearDown()` method.
5. Destroy the fixture instance.

Shared setup for all tests within a test suite can be added by defining static methods:

```cpp
static void SetUpTestSuite();
static void TearDownTestSuite();
```

These are called once before the first test and after the last test in the suite.

### Skipping Tests

During setup or at runtime, you can skip tests meaningfully using the `GTEST_SKIP()` macro:

```cpp
TEST(SkipTest, SkipsThisTest) {
  GTEST_SKIP() << "Skipping because of missing resource";
  FAIL();  // Not executed
}
```

Use this to bypass tests that cannot run without specific conditions met.

---

## Best Practices

- **Use fixtures to share setup/teardown** logic for related tests.
- **Prefer `EXPECT_*` macros** to report multiple assertion failures unless test should abort immediately.
- **Name tests clearly and avoid underscores** in suite and test names.
- **Return `RUN_ALL_TESTS()` in `main()`** for accurate test status reporting.
- **Use `SetUpTestSuite()` and `TearDownTestSuite()`** for costly shared resources.
- **Apply `GTEST_SKIP()` for conditional test skipping** rather than commenting out or disabling tests.

---

## Example: A Complete Test Suite

```cpp
class CalculatorTest : public testing::Test {
 protected:
  void SetUp() override {
    calculator_.Reset();
  }

  Calculator calculator_;
};

TEST_F(CalculatorTest, AddsNumbers) {
  EXPECT_EQ(calculator_.Add(1, 2), 3);
}

TEST_F(CalculatorTest, SubtractsNumbers) {
  EXPECT_EQ(calculator_.Subtract(5, 3), 2);
}

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This test suite ensures a clean state for each test and covers multiple calculator operations.

---

## Troubleshooting and Tips

- **Compilation errors on `TEST_F` require your fixture to have a default constructor.**
- **Avoid using fatal assertions (`ASSERT_*`) in constructors or destructors**; use `SetUp()`/`TearDown()` instead.
- **Don’t ignore return code of `RUN_ALL_TESTS()`.**
- **If a test is disabled with the `DISABLED_` prefix**, it is compiled but not run.
- Use `--gtest_filter` to run subsets of tests.

See [GoogleTest FAQ](faq.md) for common issues.

---

## Additional Resources

- [GoogleTest Primer](primer.md) — core concepts and simple tests
- [Assertions Reference](reference/assertions.md) — detailed assertion macros
- [Advanced Topics](advanced.md) — fixtures, parameterized tests, death tests
- [Testing Reference](reference/testing.md) — API details

---

For a guided workflow on writing, running, and interpreting tests, visit the [Getting Started guides](../guides/getting-started-core-workflows).


---