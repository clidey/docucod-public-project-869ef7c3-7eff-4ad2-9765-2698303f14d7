---
title: "Writing and Organizing Tests"
description: "Describes the standard approach to declaring and organizing test cases with GoogleTest, including test discovery, test suites, and main entry points. Includes canonical examples to help users set up their first test suites."
---

# Writing and Organizing Tests

GoogleTest provides a structured and efficient approach to writing and organizing tests in C++. This page guides you through the standard methodology for declaring test cases, grouping them into suites, discovering them automatically, and handling the main entry points of your test programs. With carefully chosen examples and practical insights, you will learn how to set up your first test suites following best practices.

---

## Understanding Test Organization with GoogleTest

To get the most out of GoogleTest, it’s crucial to understand how test cases and test suites fit together, how tests are discovered and executed, and how you can control test flow starting from the main entry point.

### Test Suites and Tests

- **Test Suite**: A logical grouping of related tests. GoogleTest uses the term 'TestSuite' (formerly 'TestCase') to describe this grouping.
- **Test**: An individual test case within a test suite that asserts specific behaviors of your code.

Organizing tests into suites that reflect your code’s architecture enhances maintainability and clarity. Each test suite contains multiple test functions.

---

## Declaring Tests

### Using `TEST()` Macro: Simple Tests

This macro is your starting point for writing tests with GoogleTest. It creates a test without shared setup or teardown.

Syntax:
```cpp
TEST(TestSuiteName, TestName) {
  // Your test code and assertions here
}
```

- **TestSuiteName** groups related tests.
- **TestName** identifies the individual test.
- Both should be valid C++ identifiers and avoid underscores (_).

Example:
```cpp
// Test suite for factorial function
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(5), 120);
}
```

GoogleTest will automatically collect these tests for execution without further registration.

### Using `TEST_F()` Macro: Tests with Fixtures

When multiple tests within a suite share common objects or setup/teardown code, use a *test fixture*.

To define a test fixture:
1. Declare a class derived from `testing::Test`.
2. Define shared objects and setup/teardown functions (`SetUp()` and `TearDown()`).

Example Fixture Declaration:
```cpp
class StackTest : public testing::Test {
 protected:
  void SetUp() override {
    stack_.push(1);
    stack_.push(2);
  }

  std::stack<int> stack_;
};
```

Writing tests using the fixture:
```cpp
TEST_F(StackTest, HasSizeTwoInitially) {
  EXPECT_EQ(stack_.size(), 2);
}

TEST_F(StackTest, CanPopElement) {
  stack_.pop();
  EXPECT_EQ(stack_.size(), 1);
}
```

Each test runs with a fresh fixture instance, ensuring that tests remain independent.

---

## Test Discovery

GoogleTest automatically discovers all tests defined in the program. You do not need to register test cases explicitly or list them in any file. When you build and run your test binary, all tests defined with `TEST()` and `TEST_F()` macros are discovered and executed.

You can filter the tests run at the command line using the `--gtest_filter` flag to select specific suites or tests.

Example:
```bash
test_binary --gtest_filter=FactorialTest.* # runs all tests in FactorialTest

test_binary --gtest_filter=*HandlesZeroInput # runs all tests with HandlesZeroInput in the name
```

---

## Main Entry Point for Tests

GoogleTest requires a `main()` function that initializes the framework and runs all tests. Typically, you do not write `main()` yourself; instead, link with `gtest_main` or `gmock_main` for a default implementation.

If custom behavior is needed, you can write your own `main()`:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- **`InitGoogleTest()`** parses command-line flags used to control test execution.
- **`RUN_ALL_TESTS()`** executes all registered tests and returns an exit code representing success or failure.

Always return the result of `RUN_ALL_TESTS()` in `main()`.

---

## Example: Putting It All Together

```cpp
#include <gtest/gtest.h>
#include <stack>

// The fixture for testing std::stack<int>
class StackTest : public testing::Test {
 protected:
  void SetUp() override {
    stack_.push(10);
    stack_.push(20);
  }

  std::stack<int> stack_;
};

// Test without fixture
TEST(FactorialTest, Basic) {
  EXPECT_EQ(Factorial(0), 1);
  EXPECT_EQ(Factorial(3), 6);
}

// Tests using the fixture
TEST_F(StackTest, SizeIsTwo) {
  EXPECT_EQ(stack_.size(), 2);
}

TEST_F(StackTest, PopWorks) {
  stack_.pop();
  EXPECT_EQ(stack_.top(), 10);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Run this binary, and GoogleTest will automatically run all the above tests, reporting results in a structured manner.

---

## Best Practices and Tips

- **Name Tests Clearly**: Choose descriptive names that communicate the intent, aiding readability and maintainability.
- **Use Fixtures for Shared Setup**: Avoid duplication and improve test isolation using test fixtures.
- **Keep Tests Independent**: Each test should be runnable on its own, without relying on side effects from other tests.
- **Avoid Overly Large Tests**: Small focused tests quickly reveal problems and are easier to debug.
- **Use `EXPECT_*` vs. `ASSERT_*` Appropriately**: Use `ASSERT_*` when a failure means continuing the test is pointless or unsafe.
- **Link with `gtest_main` or `gmock_main`**: To avoid boilerplate code writing `main()`, link to provided implementations.

---

## Troubleshooting Common Issues

### Tests Not Running

- Ensure tests are built and linked properly.
- Use the `--gtest_list_tests` flag to list all discovered tests.

### Linking Errors with `RUN_ALL_TESTS()`

- Verify you link against `gtest_main` or define your own `main()`.

### Test Case Naming Errors

- Check that test suite and test names are valid C++ identifiers without underscores.

### Fixture Usage Mistakes

- Remember: `TEST_F()` requires a previously defined fixture class.
- Mismatched use of `TEST()` instead of `TEST_F()` will cause compiler errors.

---

## Additional Resources

- [Writing Your First Test](../../getting_started/first_test_run_validation/write_first_test)
- [Test Fixtures, Parameterized, and Typed Tests](../advanced-testing-patterns/test-fixtures-parameterization)
- [GoogleTest Primer](docs/primer.md)
- [Assertions and Matchers Reference](../core-testing-apis/assertions)
- [Integrating into Real-World Projects](../../guides/integration-best-practices/integrating-into-projects)

---

Mastering the conventions for writing and organizing tests with GoogleTest is your gateway to building robust, maintainable, and scalable C++ testing solutions. Start small with simple tests, leverage fixtures for shared setups, and confidently scale your test suite with a clear organizational structure.

---