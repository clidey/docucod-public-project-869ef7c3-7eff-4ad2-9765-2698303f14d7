---
title: "Matchers"
description: "Presents the matcher API, enabling expressive validation of complex data types and patterns. Includes how to use core matchers, write custom matchers, and interpret matcher results in assertions or death tests."
---

# Matchers API Reference

GoogleTest's matcher API empowers you to write expressive, precise, and maintainable test assertions by validating the complex data types and patterns your code interacts with. This page focuses on the matcher components that underpin `EXPECT_THAT` and `ASSERT_THAT` assertions, enabling validation beyond simple binary comparisons.

Matchers allow you to match arguments passed to mock methods, verify return values, and write custom expectation criteria. They are essential for detailed behavioral specifications in unit tests, especially when combined with mocking.

---

## Contents
- [Introduction to Matchers](#introduction-to-matchers)
- [Using Core Matchers](#using-core-matchers)
- [Writing Custom Matchers](#writing-custom-matchers)
- [Matcher Composition](#matcher-composition)
- [Advanced Use Cases](#advanced-use-cases)
- [Matchers in Assertions and Death Tests](#matchers-in-assertions-and-death-tests)
- [Best Practices and Common Pitfalls](#best-practices-and-common-pitfalls)
- [Troubleshooting Matcher Issues](#troubleshooting-matcher-issues)

---

## Introduction to Matchers

Matchers provide a type-safe, composable mechanism to express constraints on values involved in tests. Unlike traditional assertions, which verify simple conditions, matchers offer readable, customizable assertions that describe expectations clearly and yield informative failure messages.

### What Can Matchers Do?
- Assert values satisfy properties (equality, comparison, containment, etc.)
- Validate complex structures by fields or properties
- Confirm container contents with ordering or unordered constraints
- Match function/method call arguments precisely in mocks
- Produce human-readable failure explanations including context

### Core Matcher Concepts
- **Polymorphic Matchers**: Factory-like objects that can create type-specific matcher instances as needed.
- **Monomorphic Matchers**: Matchers bound to a specific type.
- **Matcher Interface**: Implementations must provide methods to check matches and describe themselves.

Use GoogleTest matchers within `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)` to directly leverage their full potential.

---

## Using Core Matchers

GoogleTest includes a rich built-in set of matchers covering most common needs.

### 1. Wildcard Matchers
- `_`: Matches any value of any type, the equivalent of a universal wildcard.
- `A<T>()` / `An<T>()`: Match any value of type `T`.

### 2. Equality and Comparison Matchers
- `Eq(value)`: Matches if equal to value.
- `Ne(value)`: Matches if not equal.
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`: Less than, less or equal, greater than, greater or equal.
- String-specific equalities:
  - `StrEq(str)`, `StrNe(str)`: Case-sensitive equality/non-equality on C-strings or strings.
  - `StrCaseEq(str)`, `StrCaseNe(str)`: Case-insensitive equality/non-equality.

### 3. String Matchers
- `HasSubstr(substring)`: Matches if string contains the substring.
- `StartsWith(prefix)`: Matches if string starts with prefix.
- `EndsWith(suffix)`: Matches if string ends with suffix.

### 4. Container Matchers
- `ElementsAre(...)`: Matches if container elements match a sequence of matchers in order.
- `UnorderedElementsAre(...)`: Like `ElementsAre` but order doesn't matter.
- `ElementsAreArray(array)`: Matches container elements against an array or initializer list.
- `UnorderedElementsAreArray(array)`: Unordered version of the above.
- `Contains(element_matcher)`: Matches if container contains at least one element matching.
- `SizeIs(size_matcher)`: Matches if the container size matches given matcher.

### 5. Pointer and Reference Matchers
- `IsNull()`: Matches null pointers.
- `NotNull()`: Matches non-null pointers.
- `Pointee(matcher)`: Matches pointers whose pointee value matches `matcher`.
- `Ref(variable)`: Matches arguments that are references to a specific variable.

### 6. Composite Matchers
- `AllOf(m1, m2, ...)`: Matches if all enclosed matchers match.
- `AnyOf(m1, m2, ...)`: Matches if any enclosed matcher matches.
- `Not(matcher)`: Matches if `matcher` does not match.

### 7. Tuple and Field Matchers
- `Pair(matcher1, matcher2)`: Matches a `std::pair` where first and second fields match respective matchers.
- `Key(matcher)`: Matches the key (first) field of a pair.
- `Field(&Class::member, matcher)`: Matches an object's member by value.
- `Property(&Class::getter, matcher)`: Matches an object's property returned by a const getter method.
- `FieldsAre(m1, m2, ...)`: Matches structured bindings or tuple-like objects field-wise.

### 8. Numeric and Floating Point
- `FloatEq`, `DoubleEq`: Match floating-point values approximately equal.
- `NanSensitiveFloatEq`, `NanSensitiveDoubleEq`: Same but consider NaNs equal.
- `FloatNear`, `DoubleNear`: Approximate equality with specified error bounds.

### 9. Predicate Matchers
- `Truly(predicate)`: Converts an arbitrary unary predicate to a matcher.

---

## Writing Custom Matchers

### Easy Matchers with `MATCHER` Macros

You can define matchers quickly with the `MATCHER`, `MATCHER_P`, `MATCHER_P2`, ... macros by specifying a name, optional parameters, and a predicate expression.

Example:
```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
```
Use it as:
```cpp
EXPECT_CALL(mock_obj, Func(IsEven()));
EXPECT_THAT(value, IsEven());
```
You can provide a custom description string using `negation` for clarity.

### Full Custom Matcher Classes

For finer control, implement the matcher interface:
- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const` returns true if value matches and may stream explanation.
- `void DescribeTo(std::ostream* os) const` describes positive match.
- `void DescribeNegationTo(std::ostream* os) const` describes negative match.

Create a factory function returning `testing::Matcher<T>` wrapping your matcher class.

### Polymorphic Matchers

Define matcher implementations supporting `MatchAndExplain` template for polymorphic behavior across types.

---

## Matcher Composition

Combine matchers to form complex expectations:

- `AllOf(m1, m2, ...)`: All must match.
- `AnyOf(m1, m2, ...)`: At least one matches.
- `Not(m)`: Negates matcher.
- `FieldsAre(...)`: Combines matchers against multiple fields.
- `Pair(m1, m2)`: Matches pairs of values.
- `Key(m)`: Matches pair keys.

These combinators make it easier to tailor assertions naturally.

---

## Advanced Use Cases

### Matching Multiple Arguments Together

You can match entire argument tuples in mock expectations using `.With()` and tuple matchers like `Lt()` on arguments wrapped as tuples.

Example:
```cpp
EXPECT_CALL(mock, Method(_, _))
    .With(Lt()); // First argument < second argument
```

### Matching Optional and Variant Types

Matchers like `Optional(matcher)`, `VariantWith<T>(matcher)` allow matching complex variant-like containers.

### Dynamic Cast Matching with RTTI

`WhenDynamicCastTo<T>(matcher)` matches after a dynamic cast succeeds.

### Matching Result of Callable

`ResultOf(callable, matcher)` matches a value transformed by a callable.

---

## Matchers in Assertions and Death Tests

Matchers integrate with assertions:

- `EXPECT_THAT(value, matcher)`: Checks if `value` satisfies `matcher` with expressive failure messages.
- Death tests support matcher-based message checks, e.g., `EXPECT_DEATH(statement, matcher)`.

Matchers make test failures easier to diagnose by providing human-readable descriptions and additional explanation when failing.

---

## Best Practices and Common Pitfalls

- **Use `EXPECT_CALL` sparingly:** Only when verifying calls. Use `ON_CALL` for default behaviors.
- **Avoid over-specification:** Only match arguments essential to your test intent.
- **Sequence your expectations** if order matters using `InSequence` or `After`.
- **Use `NiceMock` to suppress uninteresting call warnings**, `StrictMock` to treat them as failures.
- **Beware of sticky expectations:** Use `.RetiresOnSaturation()` when sequencing multiple `WillOnce` clauses to avoid signature match issues.
- **Do not call mock methods before setting expectations.**
- **Implement custom matchers as pure functions** without side effects.

---

## Troubleshooting Matcher Issues

- If matchers don't compile, verify template and argument types.
- Use `SafeMatcherCast<T>(m)` to resolve type conversion issues.
- Use `--gmock_verbose=info` flag to trace mock call matching and diagnose mismatches.
- For complex predicates, use `Truly()` to turn your predicate function into a matcher.
- Inspect matcher failure messages to understand why an argument did not match.

---

For extensive examples, recipes, and API details, see:
- [GoogleMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Matchers Reference](reference/matchers.md) (this page)
- [Mocking Reference](reference/mocking.md)
- [Assertions Reference](reference/assertions.md)

Refer to other API sections such as [Test Case and Suite Definition](api-reference/core-testing-apis/test-basics.md) and [Death Tests](api-reference/core-testing-apis/death-tests.md) for integrated usage of matchers.

---

<Info>
Matchers form the foundation of expressive C++ test assertions in GoogleTest. Mastering them empowers you to write precise and maintainable tests that clearly communicate intent.
</Info>

