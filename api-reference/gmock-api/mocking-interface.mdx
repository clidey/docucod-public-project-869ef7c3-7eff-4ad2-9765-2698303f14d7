---
title: "Defining and Using Mocks"
description: "Explains how to define mock classes and methods using the MOCK_METHOD macros, with examples for various method signatures and attributes. Highlights inheritance, mocking virtual methods, and the interplay with strict/nice/naggy mock behaviors."
---

# Defining and Using Mocks with GoogleMock

GoogleMock (`gMock`) dramatically simplifies creating mock classes in C++. It provides macros and utilities to declare mock methods, set expectations, and verify interactions in your tests. This page focuses explicitly on how to define mock classes and methods with the `MOCK_METHOD` macros, how to handle various method signatures and attributes, and how to work with mock objects effectively.

---

## Mocking Basics: Defining Mock Methods

To mock a C++ class method, declare a mock class inheriting from the original interface or base class. Use the `MOCK_METHOD` macro in the **public** section of your mock class to generate mock implementations for virtual methods.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Optional Qualifiers));
```

- `ReturnType`: The method's return type.
- `MethodName`: The name of the method to mock.
- `(Args...)`: The method's parameters, enclosed in parentheses.
- `(Optional Qualifiers)`: Additional specifiers such as `const`, `override`, `noexcept`, calling conventions, and reference qualifiers. This argument is optional.

### Example

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(bool, Process, (int x, std::string y), (override));
};
```

### Notes

- `MOCK_METHOD` must be placed **in the public section** regardless of the original method's accessibility.
- Qualifiers like `const` and `override` should be provided if the original method has them.
- If the method is overloaded, all overloads must be mocked explicitly.


## Handling Complex Signatures and Attributes

### Methods with Commas in Arguments

When method arguments contain commas (e.g., template types like `std::pair<bool, int>`), these must be wrapped in parentheses to ensure proper parsing.

```cpp
class MockFoo {
 public:
  // Incorrect: will not compile
  // MOCK_METHOD(std::pair<bool, int>, GetPair, ());

  // Correct: wrap return type in extra parentheses
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
};
```

Alternatively, define type aliases to simplify the method signature:

```cpp
using BoolIntPair = std::pair<bool, int>;
class MockFoo {
 public:
  MOCK_METHOD(BoolIntPair, GetPair, ());
};
```

### Mocking Methods With Qualifiers

- **`const` methods**: Add `(const)` qualifier.
- **`override` specification**: Recommended to prevent accidental signature mismatches.
- **`noexcept`**: Apply if the original method is `noexcept`.
- **Calling conventions (`Calltype`)**: Useful for Windows-style calling conventions.
- **Reference qualifiers (`ref`)**: Handle `&` or `&&` qualified methods.

Example with multiple qualifiers:

```cpp
MOCK_METHOD(bool, Close, (), (const, noexcept, override));
```

## Mocking Overloaded Methods

Each overloaded version must be mocked explicitly with the full signature and qualifiers:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Calculate, (int x), (override));
  MOCK_METHOD(double, Calculate, (double x, double y), (override));
};
```

If you do not mock all overloads, the compiler warns about hidden base class methods. Control this via `using` declarations:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Calculate;  // Bring other overloads into scope
  MOCK_METHOD(int, Calculate, (int x), (override));
};
```

## Mocking Template Classes

Template classes are mocked by templating the mock class:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

## Managing Mock Object Strictness: Nice, Naggy, Strict

GoogleMock provides wrappers to modify how uninteresting calls are treated:

- `NiceMock<T>`: suppresses warnings for uninteresting calls.
- `NaggyMock<T>`: (default) warns on uninteresting calls.
- `StrictMock<T>`: makes uninteresting calls test failures.

Example:

```cpp
NiceMock<MockFoo> nice_foo;
StrictMock<MockFoo> strict_foo;
NaggyMock<MockFoo> naggy_foo;
```

Use these wrappers when you want to control the verbosity and strictness of your tests with unplanned mock calls.

## Best Practices & Common Pitfalls

- **Always place `MOCK_METHOD` in the public section**, even if the base method is protected or private.
- **Specify qualifiers accurately** to avoid compiler warnings or unexpected behaviors.
- **Avoid mocking excessively detailed overloads unless necessary** to reduce maintenance.
- Use **type aliases or parentheses** for complex argument types to fix parsing issues.
- Use **`NiceMock` or `StrictMock`**, not default mocks, to get predictable warnings or errors on uninteresting calls.
- **Use sequences or `.RetiresOnSaturation()`** to handle ordered expectations gracefully.

## Real-World Example

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(char, Bar, (const std::string& s, int i, double x), (override));
  MOCK_METHOD(bool, Bar2, (int x, int y), (override));
  MOCK_METHOD(void, Bar3, (int x, int y), (override));
};

// Usage with expectation setup

// Expect Bar2 to be called once with first argument 0, second argument anything
EXPECT_CALL(mock_foo, Bar2(0, _));

// You can set up multiple actions
EXPECT_CALL(mock_foo, Bar2(_, _))
    .Times(2)
    .WillOnce(Return(false))
    .WillOnce(Return(true));

mock_foo.Bar2(0, 1);  // Expected call
``` 

## Troubleshooting

- If the mock methods do not seem to override the base class, check for correct `override` qualifier.
- If you see warnings about hidden base class methods, ensure all overloads are either mocked or brought in scope.
- When using complex template types, wrap arguments in parentheses or define type aliases.
- Control uninteresting call warnings using `NiceMock` or verbosity flags.
- Verify that the base class has **virtual destructors** to avoid resource leaks.

## Further Learning

GoogleMock offers vast capabilities in managing actions, matchers, sequences, and more. To deepen your mastery, consult:

- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [gMock for Dummies](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md)
- [Mocking Best Practices](https://github.com/google/googletest/blob/main/guides/advanced-patterns/mocking-pitfalls-best-practices.mdx)

---

<Info>
GoogleMock empowers you to create flexible, readable, and maintainable tests by defining mocks with precise control over method behavior, invocation counts, and call ordering.
</Info>

<Check>
- Remember to place all `MOCK_METHOD` macros in the public section.
- Always specify method qualifiers (`const`, `override`) accurately.
- Use `NiceMock`, `NaggyMock`, or `StrictMock` appropriately to control uninteresting calls.
- Wrap complex template types in parentheses or define type aliases.
</Check>

---

<AccordionGroup title="Quick Start Examples">
<Accordion title="Basic Mock Method">
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
};
```
</Accordion>
<Accordion title="Mock Overloaded Methods">
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Draw, (int x, int y), (override));
  MOCK_METHOD(void, Draw, (const Point& p), (override));
};
```
</Accordion>
<Accordion title="Using NiceMock to Suppress Warnings">
```cpp
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoThis());
```
</Accordion>
<Accordion title="Handling Commas in Types">
```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool,int>), GetPair, ());
};
```
</Accordion>
</AccordionGroup>

---

<Steps>
<Step title="Define Your Mock Class">
Derive a class from the interface or base class and create mock methods using `MOCK_METHOD`.
</Step>
<Step title="Set Expectations">
Use `EXPECT_CALL` in your test code to specify which calls are expected and how they behave.
</Step>
<Step title="Run Your Tests">
Execute code that uses mock objects and verify that the calls meet your expectations.
</Step>
<Step title="Manage Strictness">
Choose between `NiceMock`, `NaggyMock`, or `StrictMock` to control warnings for uninteresting calls.
</Step>
</Steps>

---

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/reference/mocking.md", "range": "1-670"}]} />

