---
title: "Matchers Reference"
description: "Comprehensive guide to argument and value matchers in GoogleMock. Includes built-in matchers, combinators, and the extension points for creating custom matchers. This is essential for writing precise expectations on function calls, simplifying the validation of complex interactions."
---

# Matchers Reference

A **matcher** is a fundamental construct in GoogleMock used to specify constraints on a *single* argument passed to mocked functions or validated values. Matchers empower you to write precise, readable expectations for how your mock objects interact with your code, making tests both expressive and maintainable.

You use matchers within `ON_CALL()` and `EXPECT_CALL()` to specify argument expectations. Additionally, you can directly assert a value matches a matcher with:

| Macro                                | Description                             |
|-------------------------------------|---------------------------------------|
| `EXPECT_THAT(actual_value, matcher)` | Asserts that `actual_value` satisfies `matcher`. |
| `ASSERT_THAT(actual_value, matcher)` | Same as `EXPECT_THAT`, but causes an immediate fatal failure on mismatch. |

<Warning>
Equality matching via `EXPECT_THAT(actual_value, expected_value)` is supported, but be cautious of unintended implicit conversions. For instance, `EXPECT_THAT(some_bool, "some string")` may compile and unexpectedly pass.

**Best Practice:** Always prefer explicit equality matchers like `EXPECT_THAT(actual_value, Eq(expected_value))` or `EXPECT_EQ(actual_value, expected_value)`.
</Warning>

---

## Wildcard Matchers

Wildcard matchers accept any input of the specified type.

| Matcher                     | Description                            |
|----------------------------|--------------------------------------|
| `_`                        | Matches any argument of the correct type. |
| `A<type>()` or `An<type>()` | Matches any argument of the exact `type`. |

These are useful when you want to ignore an argument's value in an expectation.

---

## Generic Comparison Matchers

These matchers compare the actual argument against a given value or condition:

| Matcher                     | Meaning                                                  |
|-----------------------------|----------------------------------------------------------|
| `Eq(value)` or `value`       | Matches if `argument == value`.                           |
| `Ne(value)`                  | Matches if `argument != value`.                           |
| `Lt(value)`                  | Matches if `argument < value`.                            |
| `Le(value)`                  | Matches if `argument <= value`.                           |
| `Gt(value)`                  | Matches if `argument > value`.                            |
| `Ge(value)`                  | Matches if `argument >= value`.                           |
| `IsTrue()`                  | Matches if `argument` converts to true in Boolean context. |
| `IsFalse()`                 | Matches if `argument` converts to false in Boolean context. |
| `IsNull()`                  | Matches if `argument` is a null pointer (raw or smart).  |
| `NotNull()`                 | Matches if `argument` is a non-null pointer (raw or smart). |
| `Optional(m)`               | Matches if `argument` is a `std::optional` containing a value matching matcher `m`.  |
| `VariantWith<T>(m)`         | Matches if `argument` is a variant holding alternative of type `T` matching `m`. |
| `Ref(variable)`             | Matches if `argument` is a reference to `variable`.      |
| `TypedEq<type>(value)`      | Matches if `argument` has type `type` and equals `value`. Useful to disambiguate overloaded mocks. |

<Note>
Most matchers (except `Ref()`) make a copy of `value` to avoid lifetime issues. For non-copyable values, wrap them in `std::ref` â€” but ensure the reference remains valid during the test.
</Note>

---

## Floating-Point Matchers

Floating-point matchers handle approximate equality with special handling for NaNs and error bounds.

| Matcher                        | Description                                                                   |
|-------------------------------|-------------------------------------------------------------------------------|
| `DoubleEq(a_double)`           | Approximately equals a double `a_double`, treating NaNs as not equal.         |
| `NanSensitiveDoubleEq(a_double)` | Approximately equals a double `a_double`, treating NaNs as equal.             |
| `FloatEq(a_float)`             | Approximately equals a float `a_float`, treating NaNs as not equal.           |
| `NanSensitiveFloatEq(a_float)`  | Approximately equals a float `a_float`, treating NaNs as equal.               |
| `DoubleNear(a_double, max_abs_error)` | Equals double `a_double` within absolute error `max_abs_error`, NaNs unequal. |
| `NanSensitiveDoubleNear(a_double, max_abs_error)` | Same as `DoubleNear` but NaNs equal.                                |
| `FloatNear(a_float, max_abs_error)`  | Equals float `a_float` within absolute error `max_abs_error`, NaNs unequal.   |
| `NanSensitiveFloatNear(a_float, max_abs_error)` | Same as `FloatNear` but NaNs equal.                                 |
| `IsNan()`       | Matches any floating-point value that is NaN.                                         |

These use ULP-based comparison where no explicit error bound is given.

---

## String Matchers

Matchers for strings or C strings provide rich capabilities to validate substrings, regex patterns, and more.

| Matcher                | Description                                                        |
|------------------------|------------------------------------------------------------------|
| `ContainsRegex(string)` | Matches if the argument matches the regular expression `string`.  |
| `MatchesRegex(string)`  | Matches if the argument fully matches the regular expression `string`.  |
| `HasSubstr(string)`    | Matches if the argument contains `string` as a substring.         |
| `StartsWith(prefix)`   | Matches if the argument starts with `prefix`.                     |
| `EndsWith(suffix)`     | Matches if the argument ends with `suffix`.                       |
| `StrEq(string)`        | Matches if the argument is equal to `string`.                     |
| `StrNe(string)`        | Matches if the argument is not equal to `string`.                 |
| `StrCaseEq(string)`    | Matches if the argument equals `string`, ignoring case.           |
| `StrCaseNe(string)`    | Matches if the argument does not equal `string`, ignoring case.   |
| `IsEmpty()`            | Matches if the argument is an empty string.                       |
| `WhenBase64Unescaped(m)` | Matches a Base64-encoded string whose unescaped content matches matcher `m`. |

<Note>
- Regular expressions use a platform-dependent syntax: RE2 when built with Abseil, POSIX extended on most POSIX systems, and a simplified regex on Windows. Check your platform's support.
- String matchers work for C strings as well as C++ string objects.
</Note>

---

## Exception Matchers

Matchers that verify whether a callable throws an exception of a specific type and optionally matching a further condition.

| Matcher                         | Description                                                               |
|--------------------------------|---------------------------------------------------------------------------|
| `Throws<E>()`                  | Matches a callable that throws exception of type `E`.                     |
| `Throws<E>(m)`                 | Matches a callable that throws exception of type `E` that satisfies matcher `m`. |
| `ThrowsMessage<E>(m)`          | Matches a callable that throws exception of type `E` whose message matches `m`. |

Example usage:

```cpp
auto argument = [] { throw std::runtime_error("error msg"); };

EXPECT_THAT(argument, Throws<std::runtime_error>());
EXPECT_THAT(argument, Throws<std::runtime_error>(Property(&std::runtime_error::what, Eq("error msg"))));
EXPECT_THAT(argument, ThrowsMessage<std::runtime_error>(HasSubstr("msg")));
```

---

## Container Matchers

These matchers validate properties of STL-style containers or native arrays. They help you check element values, container sizes, subsets, and more with great flexibility.

| Matcher Name                 | Description                                                                                         |
|-----------------------------|---------------------------------------------------------------------------------------------------|
| `SizeIs(m)`                 | Matches if the container size matches matcher `m` (e.g., `SizeIs(2)` or `SizeIs(Lt(5))`).        |
| `BeginEndDistanceIs(m)`     | Matches if the distance between `begin()` and `end()` of the container matches matcher `m`.       |
| `ContainerEq(container)`    | Matches container exactly equal to `container`, with detailed failure reporting of differences.  |
| `Contains(e)`               | Matches if the container contains an element matching `e` (value or matcher).                    |
| `Contains(e).Times(n)`      | Matches if the container has exactly `n` elements matching `e`. Supports any count matcher `n`.   |
| `Each(e)`                  | Matches if every element in the container matches `e`.                                            |
| `ElementsAre(e0, e1, ..., en)` | Matches if container elements precisely match the given matchers in order.                      |
| `ElementsAreArray(array or container)` | Similar to `ElementsAre` but takes an array or container.                             |
| `IsEmpty()`                | Matches if container is empty.                                                                    |
| `IsSubsetOf(container or {elements})` | Matches if container is a subset of specified elements.                             |
| `IsSupersetOf(container or {elements})` | Matches if container is a superset of specified elements.                             |
| `Pointwise(m, container)`   | Matches each element pairwise with the same index using matcher `m` on pairs.                     |
| `UnorderedElementsAre(e0, e1, ..., en)` | Matches container elements regardless of order but matching precisely.                  |
| `UnorderedElementsAreArray(array or container)` | Same as above but for arrays or containers.                                    |
| `UnorderedPointwise(m, container)` | Like `Pointwise` but ignores element order.                                                |

**Notes:**
- These matchers work with native arrays, pointers with count, containers, and initializer lists.
- For Containers passed by pointer, you can wrap with `Pointee(...)` to match the pointed-to container.
- `Contains(e).Times(0)` verifies that no element matches `e`.

---

## Member Matchers

When validating arguments of complex objects, member matchers let you express expectations for internal fields or properties.

| Matcher                        | Description                                                                                       |
|-------------------------------|-------------------------------------------------------------------------------------------------|
| `Field(&class::field, m)`     | Matches if `argument.field` (or `argument->field` if pointer) matches matcher `m`.               |
| `Field(field_name, &class::field, m)` | Same as above but includes the field name for better error messages.                          |
| `Key(e)`                      | Matches an `std::pair` whose `first` field matches matcher `e`. Useful for map keys.            |
| `Pair(m1, m2)`                | Matches an `std::pair` whose `first` matches `m1` and `second` matches `m2`.                    |
| `FieldsAre(m...)`             | Matches any compatible object (tuple, pair, array, struct with structured bindings) piecewise with `m...`.
|
| `Property(&class::property, m)` | Matches if `argument.property()` (const method, or pointer->method) matches `m`. Caution advised when using on member functions you do not own.
| `Property(property_name, &class::property, m)` | Same as above but adds property name for improved errors.                         |

Example:

```cpp
EXPECT_THAT(my_tuple, FieldsAre(Ge(0), HasSubstr("hello")));
EXPECT_THAT(my_struct, FieldsAre(42, "aloha"));
```

---

## Matching Function/Functor/Callback Results

You can match the *result* of applying a callable to an argument, useful for matching computed values.

| Matcher                      | Description                                                              |
|------------------------------|--------------------------------------------------------------------------|
| `ResultOf(f, m)`             | Matches if `f(argument)` matches matcher `m`.                            |
| `ResultOf(result_description, f, m)` | Same as above but includes a description for better error messages.  |

Example:

```cpp
EXPECT_THAT(foo, ResultOf(&Foo::GetScore, Ge(10)));
```

---

## Pointer Matchers

Matchers designed for pointers, whether raw or smart, allow checking the pointer itself or the value it points to.

| Matcher                   | Description                                                  |
|---------------------------|--------------------------------------------------------------|
| `Address(m)`              | Matches if the address of the argument (`std::addressof(argument)`) matches matcher `m`. |
| `Pointee(m)`              | Matches if the argument (pointer) points to a value matching matcher `m`. `NULL` pointers always fail. Works with raw and smart pointers.
|
| `Pointer(m)`              | Matches if the pointer (raw or smart) itself matches matcher `m`. The raw pointer is matched.
|
| `WhenDynamicCastTo<T>(m)` | Matches if the argument casted to `T` by `dynamic_cast` matches matcher `m`. Returns false if cast fails (for references), or passes `nullptr` to `m` for pointer casts.

---

## Multi-argument Matchers

Though matchers work on single arguments, you can match on tuples representing multiple arguments.

| Matcher          | Description                                  |
|------------------|----------------------------------------------|
| `Eq()`           | Matches if `x == y` on tuple `(x, y)`.       |
| `Ge()`, `Gt()`, `Le()`, `Lt()`, `Ne()` | Similar comparisons on tuple `(x, y)`.

Additionally, selectors allow matching subsets or reordered arguments:

| Selector             | Meaning                                                    |
|----------------------|-------------------------------------------------------------|
| `AllArgs(m)`         | Matches all arguments using matcher `m`.                   |
| `Args<N1, N2, ..., Nk>(m)` | Matches a tuple of the selected argument indices against matcher `m`. |

Example:

```cpp
EXPECT_CALL(foo, InRange(Ne(0), _)).With(Lt());
EXPECT_CALL(foo, Blah).With(AllOf(Args<0, 1>(Lt()), Args<1, 2>(Lt())));
```

---

## Composite Matchers

You can combine multiple matchers logically.

| Matcher                   | Description                                                                               |
|---------------------------|-------------------------------------------------------------------------------------------|
| `AllOf(m1, m2, ..., mn)`  | Matches if *all* matchers `m1` to `mn` match.                                            |
| `AnyOf(m1, m2, ..., mn)`  | Matches if *any* of the matchers `m1` to `mn` matches.                                   |
| `Not(m)`                  | Matches if matcher `m` does *not* match.                                                 |
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` true, else matches `m2`.                                        |
|
The `AllOfArray()` and `AnyOfArray()` variants accept containers or arrays of matchers.

Example:

```cpp
EXPECT_CALL(foo, DoThis(AllOf(Gt(5), Ne(10))));
EXPECT_CALL(foo, DoThat(Not(HasSubstr("blah")), NULL));
```

---

## Adapters for Matchers

Matcher adaptors let you transform or cast matchers to fit in various contexts.

| Matcher                 | Description                                                         |
|-------------------------|---------------------------------------------------------------------|
| `MatcherCast<T>(m)`     | Casts matcher `m` to matcher of type `Matcher<T>`.                  |
| `SafeMatcherCast<T>(m)` | Similar to `MatcherCast`, but enforces safety checks at compile time.| 
| `Truly(predicate)`      | Matches if predicate returns true for the argument.

Example:

```cpp
EXPECT_CALL(mock, Foo(SafeMatcherCast<Derived*>(m)));
EXPECT_CALL(foo, Bar(Truly(IsEven)));
```

`AddressSatisfies(callback)` and `Truly(callback)` take ownership of the callback and require it to outlive the matcher.

---

## Using Matchers as Predicates

Matchers can be used as boolean predicates wherever unary predicate functors are expected.

| Matcher                 | Description                                  |
|-------------------------|----------------------------------------------|
| `Matches(m)(value)`     | Returns `true` if `value` matches matcher `m`. Can be used as a unary functor.
|
Example:

```cpp
std::count_if(container.begin(), container.end(), Matches(Ge(10)));  
```

---

## Defining Custom Matchers

GoogleMock allows easy creation of custom matchers using a set of macros and interfaces, to express complex logic with clear messages.

### Simple Matchers with `MATCHER`

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
EXPECT_THAT(value, IsEven());
```

Optionally add meaningful failure explanations by streaming to `result_listener`.

### Parameterized Matchers with `MATCHER_P` / `MATCHER_P2` ...

```cpp
MATCHER_P(HasAbsoluteValue, value, "") { return abs(arg) == value; }
EXPECT_THAT(x, HasAbsoluteValue(10));
```

### Advanced Matcher Classes

Implement the matcher interface for a given type, providing `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods.

### Polymorphic Matchers

Matchers that can work on multiple types by templating `MatchAndExplain`.

### Composite and Adapter Matchers

Define matchers composed of other matchers, or specialized behavior (see `DistanceFrom`, `Field`, `Property`, etc).

### Writing New Cardinalities and Actions

You can also extend GoogleMock's cardinalities for call count expectations and actions for methods' behavior, detailed in the gMock Cookbook.

---

## Practical Tips & Best Practices

- Prefer explicit matchers over implicit equality to avoid confusing implicit conversions.
- Use wildcard matcher `_` when argument content doesn't matter.
- Use member matchers like `Field()` and `Property()` to validate nested data succinctly.
- Combine matchers with logical combinators like `AllOf` and `AnyOf` to represent complex constraints.
- Always set expectations before calling mocked methods to avoid undefined behavior.
- When matching floating-point values, use approximate matchers like `DoubleEq` or `FloatNear`.
- Use polymorphic matchers and adaptors to simplify matcher expressions and reduce type verbosity.
- Leverage parameterized matchers for reusable, clearer test assertions.
- Apply container matchers to assert container contents flexibly and precisely.
- Always build custom matchers with clear, human-readable failure messages.

---

For more practical usage examples and a guided journey to mastering matchers, visit the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [Custom Matchers Guide](https://google.github.io/googletest/guides/advanced-assertions.md#custom-assertions-and-matchers).