---
title: "Mock Object Strictness and Verification"
description: "Documentation for controlling strictness of mock behavior using NiceMock, NaggyMock, and StrictMock, as well as verifying expectations, order, and error cases. Guides users in enforcing strict contract validation within tests and provides examples for typical error handling patterns."
---

# Mock Object Strictness and Verification

Control the strictness of your mock objects and verify your expectations effectively using GoogleMock's NiceMock, NaggyMock, and StrictMock wrappers. This guide helps you enforce how strictly mock interactions are checked in tests, manage uninteresting calls, and validate call sequences and error scenarios.

---

## Overview of Mock Strictness

When working with mocks, not all calls need the same level of scrutiny. GoogleMock offers three strictness levels that dictate how calls without explicit expectations are handled:

- **NiceMock**: Suppresses warnings on uninteresting calls (calls without expectations).
- **NaggyMock** (default behavior): Prints warnings on uninteresting calls.
- **StrictMock**: Treats uninteresting calls as errors causing test failures.

By choosing the right strictness wrapper, you explicitly communicate your intent regarding uninteresting calls and help keep test outputs clean or strict as needed.

<Check>
**Important:**
- Uninteresting calls relate to methods without any `EXPECT_CALL` set; unexpected calls are calls that do not match any existing expectation.
- Strictness wrappers **only affect uninteresting calls**, not unexpected calls.
</Check>

---

## Using Strictness Wrappers

GoogleMock provides template wrappers to adjust mock strictness:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

// Create mocks with desired strictness:
NiceMock<MockFoo> nice_mock_foo;    // Ignores uninteresting calls, no warnings.
NaggyMock<MockFoo> naggy_mock_foo;  // Prints warnings (default).
StrictMock<MockFoo> strict_mock_foo; // Fails on uninteresting calls.
```

You can pass constructor arguments to these wrappers, matching your underlying mock class constructors.

### Typical Usage Scenario

Imagine you have a mock `MockTurtle` and you want to enforce strict contract verification in a test:

```cpp
StrictMock<MockTurtle> turtle;
EXPECT_CALL(turtle, PenDown());
... // code that exercises turtle
```

If any method other than `PenDown()` is called without an expectation, the test will fail immediately.

### When to Use Which Wrapper

- Use **NiceMock** during test development or when you want to suppress noisy warnings for uninteresting calls.
- Use the default naggy mock or **NaggyMock** during standard test runs to receive informational warnings about potentially overlooked calls.
- Use **StrictMock** in finalized tests where you want to guarantee no unexpected calls pass silently.

<Note>
Changing strictness can impact test maintenance. Overly strict mocks may cause brittle tests requiring updates for harmless code changes.
</Note>

---

## Verifying Expectations

GoogleMock verifies that all expectations (`EXPECT_CALL`) are satisfied when the mock object is destructed. You can also force verification explicitly at any point in your test:

```cpp
using ::testing::Mock;
...
Mock::VerifyAndClearExpectations(&mock_object);
```

This call returns `true` if all expectations are met, and `false` otherwise, generating test failures for unsatisfied or excessive calls. Avoid setting new expectations after calling this function.

---

## Controlling Call Order and Sequence Verification

You can enforce call order in your tests to ensure mock method calls happen as expected.

### The `InSequence` Helper

Wrap expectations in an `InSequence` block to require calls occur in the declared order:

```cpp
using ::testing::InSequence;

{
  InSequence s;

  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
  EXPECT_CALL(mock, ThirdCall());
}
```

Here, `FirstCall()` must be invoked before `SecondCall()`, which precedes `ThirdCall()`.

### Using `Sequence` Objects

For fine-grained control, specify explicit `Sequence` objects:

```cpp
using ::testing::Sequence;

Sequence s1, s2;

EXPECT_CALL(mock, CallA()).InSequence(s1);
EXPECT_CALL(mock, CallB()).InSequence(s2);
EXPECT_CALL(mock, CallC()).InSequence(s1, s2);
```

This defines partial order DAGs where certain calls must happen before others based on the sequences they belong to.

### Using `After()` Clause

Alternatively, explicitly specify call order dependencies using `After()`:

```cpp
Expectation e1 = EXPECT_CALL(mock, Initialize());
EXPECT_CALL(mock, Run()).After(e1);
```

This requires `Initialize()` to occur before `Run()`.

---

## Handling Common Error Scenarios

Understanding typical error cases allows you to write robust, maintainable tests.

### Uninteresting Calls

By default, uninteresting calls (methods called without any expectation) cause warnings. Use `NiceMock` to suppress or `StrictMock` to treat these as errors.

### Unexpected Calls

If a call matches no expectation (arguments mismatch, etc.), it is an error regardless of strictness wrapper.

### Excessive Calls

Calls exceeding an expectation's upper bound (e.g., more calls than specified in `Times`) cause failures.

### Unsatisfied Expectations

If expected calls are not made according to the cardinality (e.g., fewer calls than expected), verification will fail.

### Retired Expectations and Sticky Expectations

Expectations remain *sticky* after saturation by default, meaning further matching calls cause failures. Use `.RetiresOnSaturation()` to retire expectations after the first saturation, allowing others to match later calls.


---

## Practical Examples

### Suppressing Warnings with NiceMock

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
// No warnings for uninteresting calls
mock_foo.SomeMethodWithoutExpectation();
```

### Making Tests Strict

```cpp
using ::testing::StrictMock;

StrictMock<MockFoo> strict_foo;
EXPECT_CALL(strict_foo, DoThis());
// Unexpected or uninteresting calls cause test failures
strict_foo.UnexpectedMethodCall();  // Fails
```

### Specifying Call Order with InSequence

```cpp
using ::testing::InSequence;

InSequence seq;
EXPECT_CALL(mock, First());
EXPECT_CALL(mock, Second());
// First() must be called before Second()
```

### Forcing Verification Before Destruction

```cpp
using ::testing::Mock;

MockFoo foo;
EXPECT_CALL(foo, DoSomething());
foo.DoSomething();
ASSERT_TRUE(Mock::VerifyAndClearExpectations(&foo));
```

---

## Tips and Best Practices

- **Set Expectations Before Use**: Always set `EXPECT_CALL` before exercising the mock; setting expectations after use results in undefined behavior.
- **Use Strictness Wisely**: Use `NiceMock` for suppressing noise during early test development, and `StrictMock` when you want strict enforcement.
- **Retire Expectations When Appropriate**: Use `.RetiresOnSaturation()` to avoid sticky expectations causing false upper-bound violations.
- **Use Sequences and After for Order**: Prefer `InSequence` blocks for straightforward ordering; use `After()` clauses for complex partial orders.
- **Verify Mocks Explicitly If Needed**: When mocks live beyond your control, force verification with `Mock::VerifyAndClearExpectations()`.

---

## Troubleshooting

### My test fails with unexpected call errors, but I expected them to be ignored.

- Confirm if you are using `StrictMock`, which treats uninteresting calls as errors.
- If you want to suppress warnings/errors for uninteresting calls, use `NiceMock` instead.

### I see warnings about uninteresting calls but don't want them.

- Wrap your mock in `NiceMock`.
- Alternatively, add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.

### My expectations are not verified early enough.

- Use `Mock::VerifyAndClearExpectations(&mock)` explicitly.
- Ensure mocks are destroyed at the correct time if relying on destructor verification.

### Multiple expectations are shadowing each other.

- Remember later `EXPECT_CALL`s override earlier ones.
- Specify more specific expectations last.

### Calls occur out of order but no error is raised.

- Wrap your expectations in an `InSequence` block or use `Sequence` objects to enforce call order.

---

## Additional Resources

- [The Nice, The Strict, and The Naggy - gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#TheNiceStrictNaggy)
- [EXPECT_CALL Reference](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL)
- [Sequence and InSequence Reference](https://google.github.io/googletest/reference/mocking.html#Sequence)
- [GoogleMock API: Mock Object and Method API](https://google.github.io/googletest/reference/gmock-api/mock-object-api.html)
- [Guides: Controlling Mock Strictness](https://google.github.io/googletest/guides/advanced-testing-patterns/controlling-strictness-of-mocks.html)

---

## Summary

Master GoogleMock's strictness wrappers (`NiceMock`, `NaggyMock`, `StrictMock`) to control warnings and errors from uninteresting calls. Use `EXPECT_CALL` with sequences and `After()` clauses to enforce call order. Verify expectations automatically at mock destruction or explicitly via verification functions. This balance allows you to write tests that are both robust and maintainable, catching interaction errors without excessive noise. Apply best practices for clean, reliable testing.
