---
title: "Actions and Cardinalities"
description: "Documents available actions (returning values, throwing exceptions, invoking side effects) and how to use or customize them when setting up mocks. Explains cardinality concepts to control how many times expectations should be satisfied."
---

# Actions and Cardinalities

This page documents the available **actions** you can specify on mock methods in GoogleMock and explains how to control their behavior during testing. It also introduces **cardinalities**, the mechanism to define how many times an expected call should happen, helping you precisely express your test intent and enforce call counts.

---

## Understanding Actions: What Should Your Mock Do?

When you define an expectation (`EXPECT_CALL`) on a mock method, you don't just say that the method should be called; you also tell GoogleMock *what to do* when that method is invoked. This is where **actions** come in.

### Default Action Behavior

- Mock methods with `void` return type will simply return (i.e., do nothing).
- For methods with basic return types (e.g., `bool`, `int`, pointers), a default value is returned (`false` for `bool`, `0` for `int`, `nullptr` for pointers).
- From C++11 onwards, if the return type has a default constructor, it will return a default-constructed value.

If this default action suits your needs, you do not need to specify an action.

### Customizing Actions with `WillOnce()` and `WillRepeatedly()`

You can precisely customize mock behavior using one or more calls to the following:

- `.WillOnce(action)`: Specifies an action to perform exactly once when the method is called. You can chain multiple `WillOnce()` calls to specify different behaviors in sequence.
- `.WillRepeatedly(action)`: Specifies an action to perform on *all* subsequent calls after the `WillOnce()` actions are used.

#### Example:

```cpp
using ::testing::Return;

EXPECT_CALL(mock_turtle, GetX())
    .WillOnce(Return(100))           // Returns 100 first time
    .WillOnce(Return(150))           // Returns 150 second time
    .WillRepeatedly(Return(200));   // Returns 200 all other times
```

This states that the mockâ€™s `GetX()` method will be called at least twice; it returns 100 the first time, 150 the second, then 200 every time thereafter.

### Important Caveats

- The action argument to `WillOnce()` is evaluated once at expectation setup, not on each invocation. For example:

  ```cpp
  int n = 100;
  EXPECT_CALL(mock_turtle, GetX())
      .Times(4)
      .WillRepeatedly(Return(n++));  // Always returns 100, because n++ is evaluated once
  ```
  To have side effects executed each call, you must define a stateful or callable action.

- If you specify fewer `WillOnce()` actions than the expected call count and no `WillRepeatedly()`, GoogleMock uses the default action for the remaining calls.

### Examples of Common Actions

| Action           | Description                                   |
|------------------|-----------------------------------------------|
| `Return(value)`  | Returns a copy of `value`                      |
| `ReturnRef(variable)` | Returns a reference to `variable`          |
| `ReturnPointee(pointer)` | Returns the value pointed to by `pointer`|
| `Invoke(func)`   | Calls the specified function or callable      |
| `DoAll(action1, action2, ...)` | Executes multiple actions in sequence; only the last's return value is used|
| `SetArgPointee<N>(value)` | Sets the `N`th (zero-based) pointer argument to `value` as a side effect|
| `DeleteArg<N>()` | Deletes the object pointed to by the `N`th argument|

(For a full list, see the [GoogleMock Actions Reference](https://github.com/google/googletest/blob/main/docs/reference/actions.md))

---

## Cardinalities: Controlling How Many Times Expectations Occur

A **cardinality** defines how many times an expected call should occur. It is specified with the `.Times()` clause.

### Why use cardinalities?

- To ensure that a method is called a precise number of times (for example, exactly once).
- To specify flexible counts like "at least" or "between" some number of times.
- To disallow calls entirely using `Times(0)`.

### Built-in Cardinalities

All cardinalities belong to the `testing` namespace and can be used directly.

| Cardinality         | Description                                                         |
|---------------------|---------------------------------------------------------------------|
| `AnyNumber()`       | Method can be called any number of times (including zero).          |
| `AtLeast(n)`        | Expected to be called **at least** `n` times.                       |
| `AtMost(n)`         | Expected to be called **at most** `n` times.                        |
| `Between(m, n)`     | Expected to be called **between** `m` and `n` times, inclusive.     |
| `Exactly(n)` or `n` | Expected to be called **exactly** `n` times. `Exactly(0)` means never called. |

For example:

```cpp
EXPECT_CALL(mock_foo, Bar()).Times(Exactly(2));  // Call exactly twice
EXPECT_CALL(mock_foo, Baz()).Times(AtLeast(1));  // Call one or more times
```

### Cardinality Inference

If you omit `.Times()`, GoogleMock will infer the cardinality based on the presence of `WillOnce()` or `WillRepeatedly()` clauses:

- No `WillOnce()` or `WillRepeatedly()`: infers `Times(1)`.
- `n` `WillOnce()`, no `WillRepeatedly()`: infers `Times(n)`.
- `n` `WillOnce()` and 1 `WillRepeatedly()`: infers `Times(AtLeast(n))`.

### Cardinalities as Fluent and Flexible Specifications

The cardinalities allow precise and expressive specifications. For example:

```cpp
EXPECT_CALL(mock_obj, Foo(5)).Times(Between(1, 3));
EXPECT_CALL(mock_obj, Bar()).Times(AtMost(2));
EXPECT_CALL(mock_obj, Baz()).Times(AnyNumber());
```

- `Between(1, 3)` expects the method to be called once, twice, or three times.
- `AtMost(2)` means zero, one, or two calls.
- `AnyNumber()` allows calls of any count (default for uninteresting calls).

### Creating Custom Cardinalities

GoogleMock enables defining custom cardinalities by implementing the `CardinalityInterface`. This advanced feature allows you to specify domain-specific call count constraints.

---

## Typical User Workflow for Setting Actions and Cardinalities

1. **Set up the Mock Object:** Define your mock classes using the `MOCK_METHOD` macro.

2. **Write `EXPECT_CALL` Statements:** Specify your expectations on mock methods with argument matchers.

3. **Specify Cardinality:** Add `.Times()` to define *how many* times the method call is expected.

4. **Specify Actions:** Use `.WillOnce()` and `.WillRepeatedly()` to control *what the mock does* when those calls happen.

5. **Run Your Tests:** GoogleMock verifies the expectations and cardinalities automatically.

---

## Best Practices

- Use `.Times()` to clearly specify call counts. Avoid overly tight expectations that cause brittle tests.
- Use `AnyNumber()` or omit `.Times()` with care when you want to allow flexible call counts.
- Use `.WillOnce()` sequence for varying responses per call, and `.WillRepeatedly()` for the stable fallback behavior.
- Remember actions are evaluated once at expectation setup, so use lambdas or custom actions for side effects.
- If a call should never happen, explicitly use `.Times(0)` to catch accidental invocations.
- Combine cardinalities and actions to write expressive and maintainable mocks.

---

## Common Pitfalls and Troubleshooting

- **Missing `MOCK_METHOD` on non-virtual methods:** Only virtual methods can be mocked unless you opt for special techniques.
- **Over-specifying matches or cardinalities:** Leads to brittle tests that fail unexpectedly when implementation details change.
- **Forgot to specify actions for non-void methods:** GoogleMock uses default return values which may not be appropriate.
- **`WillOnce()` action side effects evaluated only once:** Use `Invoke()` or custom lambda if expecting different side effects per call.
- **Multiple overlapping expectations:** Remember gMock matches the last matching expectation declared.
- **Forgetting to cleanup or verify mocks:** Use `Mock::VerifyAndClearExpectations()` if mock objects live beyond test scope.

---

## See Also and References

- **GoogleMock Cookbook:** A comprehensive set of recipes for mocking including actions and cardinalities.
- **Mocking Reference:** Details on macros and API usage for mocks.
- **Matchers Reference:** Guide on argument matching in expectations.
- **Actions Reference:** Full list of built-in actions.
- **Cardinalities:** [Cardinality classes header](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-cardinalities.h) and implementation.
- **GoogleMock Cheat Sheet:** Quick reference on setting expectations and specifying behavior.

---

## Illustrative Example

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::AtLeast;
using ::testing::Exactly;

class MockTurtle {
 public:
  MOCK_METHOD(int, GetX, (), (const));
  MOCK_METHOD(void, PenDown, ());
};

TEST(PaintTest, CallsPenDownOnce) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(Exactly(1));  // Must be called exactly once

  EXPECT_CALL(turtle, GetX())
      .Times(AtLeast(2))
      .WillOnce(Return(10))
      .WillRepeatedly(Return(20));

  // ...code under test that calls PenDown() once and GetX() multiple times...
}
```

---