---
title: "Defining and Using Mock Methods"
description: "Explains how to declare, configure, and invoke mock methods using the MOCK_METHOD macros and templates. Covers support for const, noexcept, and parameter variations to accurately model real interfaces."
---

# Defining and Using Mock Methods

This documentation explains how to declare, configure, and invoke mock methods in GoogleMock, using the `MOCK_METHOD` macros and template classes. It covers advanced scenarios including const-qualified, noexcept, and overloaded methods, empowering you to accurately model and test real-world interfaces.

## Overview

Mock methods are fundamental to using GoogleMock. They enable you to create mock classes that can specify and verify expectations on how an interface should be used in tests. The core macro for defining mock methods is `MOCK_METHOD`, which generates a mock implementation of a method matching the signature of a real interface.

GoogleMock's design embraces modern C++ features, supporting complex method signatures, overloads, const and noexcept qualifiers, and even move-only types. This allows mock classes to effectively substitute for real objects and provide precise control over their behavior during testing.

---

## Declaring Mock Methods

### The `MOCK_METHOD` Macro

Use `MOCK_METHOD` inside the `public:` section of a mock class to define a mock method. The syntax mirrors the method declaration split into parts:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (OptionalSpecifiers));
```

- `ReturnType`: the return type of the method
- `MethodName`: the name of the method
- `(Args...)`: the argument list in parentheses
- `(OptionalSpecifiers)`: optional qualifiers such as `const`, `override`, `noexcept`, `Calltype(...)`, or `ref(...)`

Example:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
};
```

### Handling Commas in Types

If your return type or argument types include commas (e.g., template types like `std::pair` or `std::map`), you must surround them with parentheses to avoid parsing errors:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

Alternatively, define type aliases:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### Mocking Overloaded Methods

To mock overloaded methods, list all overloads you wish to mock separately:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));

  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

Use `Const()` wrapper when referring to const overloads in `EXPECT_CALL`:

```cpp
EXPECT_CALL(Const(mock), GetBar()).WillOnce(ReturnRef(bar_const));
EXPECT_CALL(mock, GetBar()).WillOnce(ReturnRef(bar_non_const));
```

### Mocking Const and Noexcept Methods

Specify method qualifiers after the argument list:

```cpp
MOCK_METHOD(int, Foo, (int n), (const, override));
MOCK_METHOD(void, Bar, (), (noexcept, override));
```

Include qualifier flags exactly as in real interface for overriding methods to avoid compiler warnings or errors.

### Mocking Non-virtual Methods

Though not inheriting from the original class, mock classes can implement methods with the same signatures to enable mocking via template-based dependency injection.

```cpp
class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

Use such mocks by supplying them to templated code expecting the method signatures.

---

## Configuring Mock Method Behavior

Mock methods support fine control over expected calls and default actions using the following macros and techniques.

### Setting Expectations: `EXPECT_CALL`

`EXPECT_CALL(mock_object, Method(matchers))` declares expectations on method calls matching the provided argument matchers.

Optional chainable clauses modify the expectation:

- `.With(multi_arg_matcher)`: match arguments as a whole tuple
- `.Times(cardinality)`: specify call count constraints
- `.InSequence(sequences...)`: enforce call order
- `.After(expectations...)`: specify prerequisite calls
- `.WillOnce(action)`: action for a single call
- `.WillRepeatedly(action)`: action for remaining calls
- `.RetiresOnSaturation()`: retire expectation after calls are saturated

Example:

```cpp
EXPECT_CALL(mock_turtle, Forward(Ge(5)))
    .Times(AtLeast(1))
    .WillRepeatedly(Return());
```

### Setting Default Actions: `ON_CALL`

`ON_CALL(mock_object, Method(matchers))` specifies default behavior without implying a call expectation.

Use `.WillByDefault(action)` clause to define the action.

Example:

```cpp
ON_CALL(mock_turtle, GetX()).WillByDefault(Return(0));
```

This default action is superseded by any matching `EXPECT_CALL`.

### Inferring Cardinalities

If `.Times()` is omitted, GoogleMock infers call counts based on action clauses:

- No `.WillOnce()` or `.WillRepeatedly()`: `Times(1)` is assumed
- N `.WillOnce()`, no `.WillRepeatedly()`: `Times(N)`
- N `.WillOnce()`, plus one `.WillRepeatedly()`: `Times(AtLeast(N))`

### Retiring Expectations

By default, expectations remain active (sticky) after being satisfied. Use `.RetiresOnSaturation()` to deactivate them once the expected calls are completed.

Example:

```cpp
EXPECT_CALL(mock, Foo()).Times(2).RetiresOnSaturation();
```

---

## Using MockMethod Templates

In addition to macros, GoogleMock provides template classes such as `MockFunction` useful for mocking callbacks or function objects without defining a full mock class:

```cpp
MockFunction<int(int)> mock;
EXPECT_CALL(mock, Call(5)).WillOnce(Return(10));
int result = mock.AsStdFunction()(5);  // result == 10
```

These templates have a single mock method `Call()` of the specified signature.

---

## Best Practices and Tips

- Always declare mock methods in the `public:` section to enable gMock access.
- Use `NiceMock<MockClass>` or `StrictMock<MockClass>` wrappers to control warnings on uninteresting calls.
- Use `ON_CALL` to specify common behavior shared across tests, and `EXPECT_CALL` when you want to verify a call is made.
- When mocking overloaded methods, specify explicit matchers or use `Const()` to disambiguate.
- For move-only arguments or return types, prefer lambdas or `MockFunction` for testability.
- Use sequences (`Sequence` and `InSequence`) or `.After()` to enforce call order when ordering matters.
- To debug expectations issues, run tests with `--gmock_verbose=info` to see call matches and failures.

---

## Troubleshooting Common Issues

- **Ambiguous overloads**: Specify arguments in `EXPECT_CALL` or use type casting and `Const()` wrappers.
- **Missing default action for non-default-constructible return types**: Use `ON_CALL` to set default actions explicitly.
- **Uninteresting call warnings**: Means a method was called without expectations; use `NiceMock` or add catch-all `EXPECT_CALL` if calls should be allowed.
- **Sticky expectations causing call count Mismatches**: Add `.RetiresOnSaturation()` or use sequences to auto-retire.
- **Macros not evaluating arguments once**: `EXPECT_CALL` and `ON_CALL` evaluate their arguments exactly once; beware of side effects in arguments.

---

## References and Further Reading

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes and practical usage
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) — Argument matching
- [Actions Reference](https://google.github.io/googletest/reference/actions.html) — Defining mock method behaviors
- [Basics of Mocking](https://google.github.io/googletest/guides/mocking-best-practices/basics-of-mocking.html) — Introduction and best practices
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — API details

---

_Return to [Mocking and Expectations API](/api-reference/gmock-api/mock-methods) for detailed interface information and related API documentation._