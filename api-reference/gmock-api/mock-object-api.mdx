---
title: "Mock Object and Method API"
description: "End-to-end documentation for defining and using mock classes and methods in GoogleMock. Explains the MOCK_METHOD macro and its parameters, how to construct mock objects, and how mock methods interact with test code. Includes best practices for integrating mocking into real-world test suites."
---

# Mock Object and Method API

This comprehensive guide explains how to define and use mock classes and methods in GoogleMock, the official C++ mocking framework. It covers the use of the pivotal `MOCK_METHOD` macro for declaring mock methods, demonstrates how mock objects are constructed and used in tests, and provides best practices for integrating mocking effectively in real-world test suites.

---

## Defining Mock Methods with `MOCK_METHOD`

The primary building block for creating mock classes is the `MOCK_METHOD` macro. It declares mock methods within a mock class, enabling you to specify the expected calls, argument matchers, and behavior during tests.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- **ReturnType**: The return type of the mocked method.
- **MethodName**: The method's identifier.
- **Args...**: The method's argument types enclosed in parentheses. If an argument type contains commas (e.g., template types like `std::pair<int, int>`), wrap them in an extra set of parentheses or use a type alias to avoid parsing errors.
- **Qualifiers**: Optional C++ qualifiers such as `const`, `override`, `noexcept`, and calling conventions (like `Calltype(STDMETHODCALLTYPE)` on Windows).

### Example

Given a class interface:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual std::string Describe(int type) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};
```

Define a mock class as:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

### Dealing with Commas in Types

Types with commas (such as from template instantiations) need wrapping:

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
```

Alternatively, use type aliases:

```cpp
using BoolAndInt = std::pair<bool, int>;
using MapIntDouble = std::map<int, double>;

class MockFoo {
 public:
  MOCK_METHOD(BoolAndInt, GetPair, ());
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

### Use in Public Section

Always declare `MOCK_METHOD` macros in the `public:` section of your mock class regardless of the access level of the corresponding method in the base class. This ensures that `ON_CALL` and `EXPECT_CALL` macros can properly access them.

### Mocking Const and Overloaded Methods

You can declare mock versions of const-qualified and overloaded methods by including the appropriate qualifiers. Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));

  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

Use `using` declarations to bring base class methods into scope for overloads you don't mock to prevent hiding them.


## Constructing and Using Mock Objects

Create instances of your mock classes and set expectations on their mock methods using the `EXPECT_CALL` and `ON_CALL` macros, described in detail in related sections. Mock objects support a flexible and expressive syntax for specifying the number of calls, argument matchers, call sequences, and actions to perform.

### Typical Workflow

1. Include GoogleMock and import symbols from the `testing` namespace.

2. Instantiate mock objects.

3. Optionally set default actions with `ON_CALL` to define behavior for uninteresting calls.

4. Define explicit usage expectations using `EXPECT_CALL` with matchers and action clauses.

5. Exercise the code under test that interacts with mock objects.

6. Allow gMock to verify expectations automatically on mock destruction, or explicitly verify earlier using `Mock::VerifyAndClearExpectations()`.

### Example

```cpp
using ::testing::Return;

TEST(BarTest, DoesThis) {
  MockFoo foo;

  ON_CALL(foo, GetSize())
      .WillByDefault(Return(1));

  EXPECT_CALL(foo, Describe(5))
      .Times(3)
      .WillRepeatedly(Return("Category 5"));

  EXPECT_EQ(MyProductionFunction(&foo), "good");
}
```

The example shows default behavior setup with `ON_CALL`, expectation setting with `EXPECT_CALL`, and usage in test logic.

## Mock Method Behavior and Interaction

Mock methods created by `MOCK_METHOD` can be called like any normal method. When invoked:

- gMock checks if the call matches any expectation set by `EXPECT_CALL`. It selects the last matching active expectation.
- If none match, checks for default action specified by matching `ON_CALL`.
- Failing both, it uses a built-in default action if available (such as returning zero-initialized or default-constructed values).
- If no action is found and no default value exists, an assertion failure occurs.

Mock methods provide rich verification including call counts, argument validation, execution order via sequences, and custom actions.

## Best Practices

- Always specify the destructor of the base class as `virtual` to avoid undefined behavior.
- Use `MOCK_METHOD` only in the `public:` section of mock classes.
- Declare `EXPECT_CALL`s before exercising code that should trigger them to avoid undefined behavior.
- Prefer `ON_CALL` to specify default behavior when you do not intend to strictly verify calls.
- Use sequences or `After` clauses to enforce call ordering instead of relying on `EXPECT_CALL` declaration order.
- When mocking overloaded methods, fully specify overloads or use `using` to prevent hiding.
- Use `NiceMock`, `NaggyMock`, or `StrictMock` wrappers to control how uninteresting calls are handled.
- Delegate complex default behaviors to fakes or real objects via `ON_CALL` default actions where appropriate.
- For move-only types, `MOCK_METHOD` supports them directly, and lambdas can be used for flexible actions.

## Controlling Strictness

Mock objects can be wrapped to control how they handle calls without expectations:

- **NiceMock**: suppress warnings on uninteresting calls.
- **NaggyMock** (default): shows warnings.
- **StrictMock**: treats uninteresting calls as test failures.

Usage example:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
// behaves like MockFoo but suppresses warnings.
```

## Advanced Capabilities

- Mocking class templates with `MOCK_METHOD` is similar to normal classes.
- Mocking non-virtual methods requires unrelated mock classes with matching methods.
- `MockFunction` allows mocking `std::function`-type callbacks seamlessly.
- Delegation to real or fake implementations is possible via default actions.
- Mocking destructors requires manual addition of a mock method called in destructor to verify destruction order.

## Troubleshooting

- If a mock method unexpectedly calls the real implementation, ensure the base method is `virtual`.
- If gMock prints warnings about uninteresting calls despite `ON_CALL`, consider using `NiceMock` or an `EXPECT_CALL` with `Times(AnyNumber())`.
- Setting expectations after code execution or interleaving with calls leads to undefined behavior.
- Use `--gmock_verbose=info` to trace mock invocations and diagnose unexpected failures.

## References and Related Documentation

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) - Quick syntax reference.
- [Mocking Reference](reference/mocking.md) - Detailed documentation of mocking macros, classes, and concepts.
- [gMock Cookbook](docs/gmock_cook_book.md) - Recipes and best practices for complex mocking scenarios.
- [Controlling Mock Strictness Guide](guides/advanced-testing-patterns/controlling-strictness-of-mocks.mdx) - Adjusting mock strictness.
- [Matchers Reference](api-reference/gmock-api/matchers-reference) - Using and composing argument matchers.
- [Actions and Cardinalities Reference](api-reference/gmock-api/actions-and-cardinalities) - Controlling mock method behavior on calls.

---

## Example: Defining and Using a Mock Class

```cpp
#include <gmock/gmock.h>

// Interface to mock
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

// Mock class
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};

// Test
using ::testing::Return;
using ::testing::_; // wildcard matcher

TEST(FooTest, SizeAndDescribe) {
  MockFoo foo;

  // Set default behavior
  ON_CALL(foo, GetSize()).WillByDefault(Return(42));
  ON_CALL(foo, Describe(_)).WillByDefault(Return("foo called"));

  // Expectations
  EXPECT_CALL(foo, GetSize()).Times(1);
  EXPECT_CALL(foo, Describe("test")).Times(1).WillOnce(Return("test description"));

  // Test code exercising mock
  EXPECT_EQ(foo.GetSize(), 42);
  EXPECT_EQ(foo.Describe("test"), "test description");
}
```

---

## Summary of MOCK_METHOD qualifiers

| Qualifier                        | Meaning                                                |
|---------------------------------|--------------------------------------------------------|
| `const`                         | Mocked method is `const` qualified (must match base).  |
| `override`                      | Marks method as overriding virtual base method.        |
| `noexcept`                      | Marks method as `noexcept`, matching base method.      |
| `Calltype(stdcall_type)`        | Specifies calling convention e.g., on Windows.         |
| `ref(&)` / `ref(&&)`            | Marks method with reference qualifiers.                |

---

## Summary

The `MOCK_METHOD` macro is the core facility to declare mock methods in a mock class. When properly declared and combined with `EXPECT_CALL` and `ON_CALL`, it empowers flexible, precise, and comprehensive mocking capabilities aligned with C++ language specifics. Understanding and applying these concepts ensures robust unit testing with interaction verification.


<Callout title="Tip">
When mocking methods that accept or return move-only types (e.g., `std::unique_ptr`), use the normal `MOCK_METHOD` syntax and consider lambdas for flexible actions.
</Callout>

<Callout title="Warning">
Always ensure your interfaces have virtual destructors when mocking to avoid undefined behavior.
</Callout>