---
title: "Built-in Matchers Reference"
description: "Thorough enumeration of built-in matchers for arguments, return values, and other expressions. Covers composing matchers, comparisons, container, arithmetic, and custom matcher extension points."
---

# Built-in Matchers Reference

GoogleMock provides a rich set of built-in matchers for validating function arguments, return values, and various expressions. These matchers let you write clear, expressive expectations and assertions within `EXPECT_CALL()`, `ON_CALL()`, or direct assertion macros like `EXPECT_THAT()`. This reference details categories of matchers, tips for using them effectively, and how to compose or extend them.

---

## Overview of Matchers

Matchers are predicates that evaluate the correctness of an argument in a function call or a tested expression. They enable you to express:

- Exact values or approximations
- Containers with element-wise constraints
- Pointer states
- Composite logical combinations
- Custom predicates

Matchers can be used where an argument to a mocked method is expected, or inside assertions validating program state.


## Wildcard and Generic Matchers

- **`_`**: Matches any value (wildcard)
- **`A<type>()`** or **`An<type>()`**: Matches any value of the specified type
- **`Eq(value)`** or simply the value itself: Matches exactly equal value
- **Comparison matchers**: `Ge(value)`, `Gt(value)`, `Le(value)`, `Lt(value)`, `Ne(value)` match based on relational operators
- **Boolean state**: `IsTrue()`, `IsFalse()` for explicit boolean context
- **`Ref(variable)`**: Matches a reference to the exact variable instance

```cpp
EXPECT_CALL(foo, Bar(_));                  // Matches any argument
EXPECT_CALL(foo, Bar(42));                 // Matches argument == 42
EXPECT_CALL(foo, Bar(Ge(5)));              // Matches argument >= 5
EXPECT_CALL(foo, Bar(Ref(my_var)));        // Matches argument exactly referencing my_var
```

---

## Pointer and Null State Matchers

- **`IsNull()`**: Matches any null pointer (raw or smart)
- **`NotNull()`**: Matches any non-null pointer
- **`Pointee(matcher)`**: Matches a pointer whose pointed-to value matches `matcher`
- **`Pointer(matcher)`**: Matches pointers matching `matcher` (matcher operates on raw pointer)
- **`Address(matcher)`**: Matches an object whose address matches `matcher`

```cpp
EXPECT_CALL(foo, Func(IsNull()));              // Expect a nullptr pointer
EXPECT_CALL(foo, Func(NotNull()));             // Expect a valid pointer
EXPECT_CALL(foo, Func(Pointee(Eq(5))));        // Expect pointer pointing to value 5
EXPECT_THAT(p, Pointer(NotNull()));            // p is a non-null pointer
EXPECT_THAT(obj, Address(Ref(expected_obj)));  // obj has address matching expected_obj
```

---

## String Matchers

Designed for matching strings with common conditions:

- **`StrEq(string)`**: Equals string (case-sensitive)
- **`StrNe(string)`**: Not equal string
- **`StrCaseEq(string)`**: Equals string ignoring case
- **`StrCaseNe(string)`**: Not equals string ignoring case
- **`HasSubstr(string)`**: Contains substring
- **`StartsWith(prefix)`**: Starts with substring
- **`EndsWith(suffix)`**: Ends with substring
- **`ContainsRegex(pattern)`**: Contains regex
- **`MatchesRegex(pattern)`**: Matches entire regex
- **`WhenBase64Unescaped(matcher)`**: Matches decoded value after base64 unescaping

```cpp
EXPECT_THAT(name, StrEq("Hello"));
EXPECT_THAT(text, HasSubstr("error"));
EXPECT_THAT(command, StartsWith("run "));
EXPECT_THAT(log_message, MatchesRegex("^WARN:.*failed$"));
```

---

## Floating-Point Matchers

Use specialized matchers to cope with rounding errors and NaN values:

- **`FloatEq(value)`**, **`DoubleEq(value)`**: Approximate equality (ULP-based)
- **`NanSensitiveFloatEq(value)`**, **`NanSensitiveDoubleEq(value)`**: Treat NaNs as equal
- **`FloatNear(value, max_abs_error)`**, **`DoubleNear(value, max_abs_error)`**: Approximate equality within absolute error
- **`NanSensitiveFloatNear(value, max_abs_error)`**, **`NanSensitiveDoubleNear(value, max_abs_error)`**: Absolute error match including NaNs
- **`IsNan()`**: Matches NaN values

---

## Container Matchers

Express constraints on STL-style containers and sequential collections:

- **`ElementsAre(e0, e1, ..., en)`**: Matches a container with exactly these elements in order
- **`ElementsAreArray(container_or_range)`**: Matches elements from a container or array
- **`UnorderedElementsAre(e0, e1, ..., en)`**: Matches container elements ignoring order
- **`UnorderedElementsAreArray(container_or_range)`**
- **`Contains(element_matcher)`**: Container that contains an element matching the matcher
- **`Each(element_matcher)`**: All elements match the matcher
- **`SizeIs(matcher)`**: Container size matches the matcher
- **`BeginEndDistanceIs(matcher)`**: Distance between `begin()` and `end()` matches matcher
- **`IsEmpty()`**: Matches empty containers
- **`IsSubsetOf(container)`**, **`IsSupersetOf(container)`**: Matching subsets or supersets
- **`Pointwise(pair_matcher, rhs_container)`**: Element-wise matching with another container (order matters)
- **`UnorderedPointwise(pair_matcher, rhs_container)`**: Same as Pointwise but order ignored

Example:

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Ge(5), _)));
EXPECT_THAT(vec, UnorderedElementsAre(4, 2, 3));
EXPECT_THAT(map, Contains(Key(42)));
EXPECT_THAT(data, Each(Gt(0)));
EXPECT_THAT(v, SizeIs(3));
```

---

## Member and Property Matchers

- **`Field(&Class::member, matcher)`**: Matches an object whose member matches the matcher
- **`Field("name", &Class::member, matcher)`**: Like above, but includes member name in failure
- **`Property(&Class::getter, matcher)`**: Matches object whose property's getter result matches matcher
- **`Property("name", &Class::getter, matcher)`**: Like above, with property name included

```cpp
EXPECT_THAT(foo, Field(&Foo::count, Ge(1)));
EXPECT_THAT(bar, Property(&Bar::GetName, StartsWith("Mr.")));
```

> **Warning:** Avoid `Property()` on member functions outside your control as it relies on unstable function pointer semantics.

---

## Composite and Logical Matchers

You can combine matchers to express complex conditions:

- **`AllOf(m1, m2, ..., mn)`**: Matches if all specified matchers match
- **`AnyOf(m1, m2, ..., mn)`**: Matches if any matcher matches
- **`Not(m)`**: Matches if the inner matcher does not match
- **`Conditional(cond, m_true, m_false)`**: Matches `m_true` if cond is true, else `m_false`

```cpp
EXPECT_THAT(value, AllOf(Ge(10), Lt(20)));
EXPECT_THAT(name, AnyOf(StrEq("foo"), StrEq("bar")));
EXPECT_THAT(x, Not(Eq(0)));
```

---

## Using Matchers as Assertions

GoogleTest’s `EXPECT_THAT()` and `ASSERT_THAT()` enable writing assertions with matchers:

```cpp
EXPECT_THAT(actual, Contains(Key(42)));
ASSERT_THAT(vec, ElementsAre(1, 2, 3));
```

These assertions generate descriptive failure messages by leveraging the matchers’ descriptions and explanations.

---

## Writing Custom Matchers

GoogleMock supports defining your own matchers either with:

- **`MATCHER` family of macros** for quick inline matchers
- Direct implementation of the matcher interface for advanced cases

Example using `MATCHER` macro:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
...
EXPECT_CALL(mock, Foo(IsEven()));
EXPECT_THAT(value, IsEven());
```

For parameterized matchers (with arguments), use `MATCHER_P`, `MATCHER_P2`, etc.

To add rich explanations for failure, use the `result_listener` argument in the matcher body.

---

## Tips and Best Practices

- Use `_` matcher when the argument’s value is irrelevant
- Prefer `ON_CALL()` to set default behavior; use `EXPECT_CALL()` only when verifying call behavior
- Compose matchers with `AllOf()`, `AnyOf()`, and `Not()` for complex argument validation
- Use container matchers to verify collections precisely
- When matching pointers, prefer `Pointee()` to check the pointee value
- For floating-point comparisons, always use the approximate matchers (`DoubleEq()`, `FloatNear()`) to avoid flaky tests
- Carefully handle overloaded methods using `TypedEq<T>()` or explicit matchers
- Balance strictness with maintainability; avoid over-specifying expectations

---

## Reference Examples

### Basic Value Matchers

```cpp
EXPECT_CALL(mock, Func(Eq(10)));  // argument == 10
EXPECT_CALL(mock, Func(Ge(5)));   // argument >= 5
EXPECT_CALL(mock, Func(_));       // argument ignored
```

### Pointer Matchers

```cpp
EXPECT_CALL(mock, Func(IsNull()));              // pointer is nullptr
EXPECT_CALL(mock, Func(Pointee(Eq(42))));       // pointee value == 42
EXPECT_THAT(ptr, NotNull());                      // ptr != nullptr
```

### Container Matchers

```cpp
EXPECT_THAT(vec, ElementsAre(1, _, Ge(3)));    // vec of size 3, second any, third >= 3
EXPECT_THAT(list, Contains(Eq("foo")));       // list contains "foo"
EXPECT_THAT(set, Each(Ge(0)));                   // all elements >= 0
EXPECT_THAT(map, Contains(Key(42)));             // map has key 42
```

### String Matchers

```cpp
EXPECT_THAT(str, StartsWith("Hello"));
EXPECT_THAT(str, HasSubstr("world"));
EXPECT_THAT(str, MatchesRegex("^Hello.*world$"));
```

### Composite Matchers

```cpp
EXPECT_CALL(mock, Func(AllOf(Ge(0), Le(10)))); // argument in [0,10]
EXPECT_CALL(mock, Func(AnyOf(Eq(0), Eq(1), Eq(2)))); // argument is 0,1, or 2
EXPECT_CALL(mock, Func(Not(Eq(42))));            // argument != 42
```

---

## Common Pitfalls

- Do not use `EXPECT_CALL()` on mock methods after the mock is used by tested code
- Avoid overusing `EXPECT_CALL()` - `ON_CALL()` sets default behavior without requiring call
- Do not mock non-virtual methods unless using special patterns
- When matching overloaded methods, disambiguate the expected overload explicitly
- Avoid returning references to temporary objects
- Beware of matcher purity: matchers must be side-effect free and deterministic
- Use `RetiresOnSaturation()` to avoid sticky expectations leading to call count errors

---

## See Also

- [Mock Object Definition](./mock-object-definition.md)
- [Setting Expectations & Call Strictness](./expectations-and-strictness.md)
- [Actions & Return Behaviors](./actions-and-return-behaviors.md)
- [Matchers & Assertions](../core-testing-apis/assertions-api.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)


---

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-922"},{"path": "docs/reference/matchers.md", "range": "1-685"},{"path": "docs/gmock_cook_book.md", "range": "1-2589"}]} branch="main" />
