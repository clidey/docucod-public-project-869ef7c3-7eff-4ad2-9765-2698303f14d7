---
title: "Mock Behavior and Strictness Policies"
description: "APIs and macros to configure mock objects' behavior regarding unexpected or uninteresting calls. Explains NiceMock, StrictMock, and NaggyMock policies, and how to enforce or relax strictness in large codebases."
---

# Mock Behavior and Strictness Policies

This page details the APIs and macros provided by GoogleTest's GoogleMock framework to configure the behavior of mock objects around unexpected and uninteresting calls. It explains the different mock strictness policies — NiceMock, NaggyMock, and StrictMock — and guides you on controlling mock call tolerance in your tests.

---

## 1. Overview of Mock Call Behavior

In interaction-based testing with GoogleMock, your test sets *expectations* on mock methods via `EXPECT_CALL`. Calls matching these expectations proceed normally, and violations are flagged. However, calls that do not correspond to any expectation fall into two categories:

- **Uninteresting Calls**: Methods called without any expectation set.
- **Unexpected Calls**: Calls that do not match any declared expectation.

By default, uninteresting calls emit warnings, while unexpected calls always cause test failures. To control this behavior in your test suite, GoogleMock provides strictness policies implemented through specialized mock wrappers.

---

## 2. Mock Strictness Policies

GoogleMock provides three standard mock wrappers that control how the mock treats uninteresting calls:

### 2.1 NiceMock

`NiceMock<T>` suppresses warnings for calls to mocked methods that have no explicit expectations set. It is useful when you want to ignore uninteresting calls and keep your test output clean.

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, Foo());
... use mock_foo ...
```

**Key points:**

- Ignores warnings on uninteresting calls.
- Applicable only for mock methods defined *directly* with `MOCK_METHOD` in the mock class.
- Works as a subclass of the original mock and forwards constructors accordingly.

### 2.2 NaggyMock

`NaggyMock<T>` represents the default GoogleMock behavior: warnings are generated for uninteresting calls.

```cpp
using ::testing::NaggyMock;

NaggyMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, Foo());
... use mock_foo ...
```

### 2.3 StrictMock

`StrictMock<T>` treats uninteresting calls as **test failures**, immediately flagging any call that was not explicitly expected.

```cpp
using ::testing::StrictMock;

StrictMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, Foo());
... use mock_foo ...
```

**Important:** Strict mode is most useful when you want to enforce tight control over all mock interactions.

---

## 3. Using `EXPECT_CALL` and `ON_CALL` to Set Expectations and Default Behavior

### 3.1 `EXPECT_CALL`

- Declares an *expectation* that a mock method will be called.
- Supports chaining clauses to specify: argument matchers, call cardinalities, call ordering, actions, and retirement.

Example:

```cpp
EXPECT_CALL(mock_foo, Bar(5))
    .Times(3)
    .WillOnce(Return(true))
    .WillRepeatedly(Return(false));
```

This expects `mock_foo.Bar(5)` to be called three times, returning `true` once and `false` subsequently.

### 3.2 `ON_CALL`

- Specifies the *default behavior* of a mock method when called with matching arguments.
- Does **not** set an expectation that the call must occur.

Example:

```cpp
ON_CALL(mock_foo, Foo(_))
    .WillByDefault(Return(42));
```

Here, calls to `Foo` with any argument return 42 unless overridden by an `EXPECT_CALL`.

---

## 4. Managing Call Cardinalities

`EXPECT_CALL` supports the `.Times()` clause specifying how many times a mock method call is expected:

| Cardinality         | Meaning                                      |
|---------------------|----------------------------------------------|
| `AnyNumber()`       | Call can happen any number of times.
| `AtLeast(n)`        | Call expected at least n times.
| `AtMost(n)`         | Call expected at most n times.
| `Between(m, n)`     | Call expected between m and n times.
| `Exactly(n)` or `n` | Call expected exactly n times.

If `.Times()` is omitted, GoogleMock infers call counts based on specified actions (`WillOnce` and `WillRepeatedly`).

---

## 5. Enforcing Call Ordering

GoogleMock allows you to specify order constraints on mock expectations:

- **Sequences with `InSequence`**

  Use the `InSequence` helper to group multiple expectations that must be called in order.

```cpp
{
  InSequence seq;
  EXPECT_CALL(mock_foo, Init());
  EXPECT_CALL(mock_foo, Run());
}
```

- **Partial Ordering with `After` and `Sequence`**

  Use the `.After()` clause and `Sequence` objects to define more flexible partial orders.

Example:

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, First()).InSequence(s1);
EXPECT_CALL(mock, Second()).InSequence(s1, s2);
EXPECT_CALL(mock, Third()).InSequence(s2);
```

This enforces that `First` occurs before `Second`, and `Second` before `Third`.

---

## 6. Controlling Expectation Retirement

By default, expectations remain active (or "sticky") until the test ends, unless the mock object or test ends.

The `.RetiresOnSaturation()` clause instructs GoogleMock to retire the expectation (making it inactive) once the expected number of invocations is reached. This is useful to avoid unexpected call errors when multiple expectations overlap.

Example:

```cpp
EXPECT_CALL(mock_foo, SetValue(_))
    .Times(2)
    .RetiresOnSaturation();
```

---

## 7. Understanding Uninteresting vs Unexpected Calls

| Call Type         | Description                                                  | Outcome                     |
|-------------------|--------------------------------------------------------------|-----------------------------|
| Uninteresting Call | Call with no matching EXPECT_CALL set.                       | Warning (naggy), ignored in NiceMock, failure in StrictMock.
| Unexpected Call    | Call does not match any EXPECT_CALL criteria but expectations exist on the method. | Test failure (always).

**Recommended usage:**

- Use `ON_CALL` to set default behavior without requiring calls.
- Use `EXPECT_CALL` to require that calls must occur and to verify interaction.
- Use `NiceMock` to suppress warnings about unimportant interactions.
- Use `StrictMock` to ensure no unexpected interactions occur.

---

## 8. API Reference Summary

### MOCK_METHOD

Defines a mock method in a mock class.

```cpp
MOCK_METHOD(return_type, method_name, (args...), (qualifiers...));
```

**Qualifiers include:**

- `const` - for mocking const methods
- `override` - recommended when overriding virtual methods
- `noexcept` - for noexcept methods
- `Calltype(X)` - for specifying calling conventions
- `ref(&)` or `ref(&&)` - reference qualifiers

### EXPECT_CALL

Sets an expectation on a mock method and configures behavior with chainable clauses:

```cpp
EXPECT_CALL(mock_object, method_name(matchers...))
    .With(multi_argument_matcher)  // optional
    .Times(cardinality)            // optional
    .InSequence(sequences...)      // optional
    .After(expectations...)        // optional
    .WillOnce(action)              // optional
    .WillRepeatedly(action)        // optional
    .RetiresOnSaturation();        // optional
```

- Call order for clauses must follow the above sequence.

### ON_CALL

Sets default action on matching calls without setting an expectation:

```cpp
ON_CALL(mock_object, method_name(matchers...))
    .With(multi_argument_matcher)  // optional
    .WillByDefault(action);        // required
```

---

## 9. Common Pitfalls and Best Practices

- Always set expectations (`EXPECT_CALL`) before exercising code that calls mocks.
- Use `NiceMock` for tests that don't care about uninteresting calls to reduce noise.
- Use `StrictMock` when you want uninteresting calls to cause test failures.
- Use `.RetiresOnSaturation()` on expectations with limited call counts to avoid sticky expectations causing failures.
- Beware that the order of `EXPECT_CALL`s impacts which expectation matches a call (last matching expectation is chosen).
- When mocking overloaded methods, always specify argument matchers to disambiguate.
- Prefer setting default behavior with `ON_CALL` rather than relying on default return values, to avoid unexpected results.

---

## 10. Example Usage

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::NiceMock;
using ::testing::StrictMock;
using ::testing::_; // wildcard matcher

class MockFoo {
 public:
  MOCK_METHOD(int, DoSomething, (int x), ());
};

TEST(MockBehaviorTest, UsingStrictAndNice) {
  {
    StrictMock<MockFoo> strict_mock;
    EXPECT_CALL(strict_mock, DoSomething(5))
        .Times(1)
        .WillOnce(Return(42));
    EXPECT_ANY_THROW(strict_mock.DoSomething(10)); // unexpected call fails
  }

  {
    NiceMock<MockFoo> nice_mock;
    EXPECT_CALL(nice_mock, DoSomething(5))
        .Times(1)
        .WillOnce(Return(42));
    int val = nice_mock.DoSomething(10);  // no warning or failure
    (void)val;
  }
}
```

---

## 11. Troubleshooting

- **Uninteresting call warnings:** Use `NiceMock` to suppress or add a catch-all EXPECT_CALL with `Times(AnyNumber())`.
- **Unexpected call errors:** Ensure your expectations cover all expected call patterns or add explicit disallowance with `Times(0)`.
- **Action run out warnings:** When using multiple `WillOnce()`, ensure `.Times()` matches or use `WillRepeatedly()`.
- **Order violations:** Use `InSequence` or `After` clauses to enforce call order.
- **Mock leaks:** If a mock object's expectations are not verified due to object leaks, use `Mock::AllowLeak` or ensure proper cleanup.

---

## 12. Further Reading and References

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Mocking Reference (this page)](https://google.github.io/googletest/reference/mocking.html)
- [Matchers Reference](reference/matchers.md)
- [Actions Reference](reference/actions.md)
- [Guides on Mock Strictness and Lifecycle](guides/mocking-patterns/mock-strictness-lifecycle.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)

---

<Callout>
Use `EXPECT_CALL` to precisely define expected calls and behaviors, and `ON_CALL` to set default behaviors without enforcing calls.
For flexible mock behavior across your codebase, combine `NiceMock`, `NaggyMock`, and `StrictMock` types strategically to balance warning noise and strictness.
</Callout>

---