---
title: "Mock Class Declaration & Management"
description: "Details on defining mock classes and member functions using GoogleMock macros. Reference for MOCK_METHOD and how to support different qualifiers and signatures."
---

# Mock Class Declaration & Management

This reference provides detailed guidance on defining mock classes and member functions using GoogleMock macros, particularly focusing on the `MOCK_METHOD` macro. It explains how to declare mock methods that match various method signatures, including const-qualification, noexcept, calling conventions, and reference qualifiers.

---

## Overview of MOCK_METHOD

GoogleMock uses the `MOCK_METHOD` macro to generate mocked member functions in mock classes. This macro simplifies the creation of mock methods that override virtual functions from an interface or base class.

```cpp
MOCK_METHOD(return_type, method_name, (args...), (qualifiers...));
```

- **return_type**: The return type of the mocked method.
- **method_name**: The name of the mock method.
- **args...**: The parameter list, wrapped in parentheses.
- **qualifiers...** (optional): A comma-separated list of qualifiers such as `const`, `override`, `noexcept`, calling conventions, and reference qualifiers.

This macro must be placed in the **public** section of the mock class regardless of the original access specifier of the mocked method.

### Important Notes on Argument Parsing

If the `return_type` or any argument type contains commas (e.g., template types like `std::pair<int, int>` or `std::map<int, double>`), you **must** either:

- Wrap the type in an extra pair of parentheses, or
- Use a type alias to avoid unprotected commas.

Example:

```cpp
class MockFoo {
 public:
  // Will not compile — unprotected commas.
  MOCK_METHOD(std::pair<bool, int>, GetPair, ());
  MOCK_METHOD(bool, CheckMap, (std::map<int, double>, bool));

  // Correct ways:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

---

## Supported Qualifiers and Specifications

You can specify a fourth macro parameter — the qualifiers — to match the original method signature precisely:

| Qualifier                  | Meaning                                      |
|----------------------------|----------------------------------------------|
| `const`                    | Makes the mocked method a const method.       |
| `override`                 | Marks the method with `override`. Recommended when overriding a virtual method. |
| `noexcept`                 | Marks the method as `noexcept`. Required if the original method is `noexcept`.
| `Calltype(...)`            | Specifies the calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` on Windows.
| `ref(&)` or `ref(&&)`      | Marks the method with reference qualifiers (e.g., lvalue-reference or rvalue-reference). Required if overriding methods qualified with them.

*Ordering*: Qualifiers can be combined in any order within the parentheses, separated by commas.

Example:

```cpp
class MockExample {
 public:
  // Const method overriding interface
  MOCK_METHOD(int, GetValue, (), (const, override));

  // noexcept and override method
  MOCK_METHOD(void, Reset, (), (noexcept, override));

  // Method with calling convention specified
  MOCK_METHOD(bool, Foo, (int x), (Calltype(STDMETHODCALLTYPE)));

  // Method with rvalue reference qualifier
  MOCK_METHOD(int, Compute, (int x), (ref(&&), override));
};
```

---

## Mocking Overloaded Methods

GoogleMock seamlessly supports overloaded methods by mocking each overload separately.

```cpp
class Foo {
 public:
  virtual int Add(int x) = 0;
  virtual int Add(int x, int y) = 0;
  virtual int GetValue() const = 0;
  virtual int GetValue() = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int x, int y), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(int, GetValue, (), (override));
};
```

*Tip:* If you don't mock all overloads, the unmocked ones are hidden by default. Use `using BaseClass::method_name;` to bring unmocked overloads into scope.

---

## Mocking Methods in Template Classes

Just like regular classes, template classes can be mocked by defining a mock class template that inherits from the interface template.

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual void Push(const T& elem) = 0;
  virtual int GetSize() const = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(void, Push, (const T& elem), (override));
  MOCK_METHOD(int, GetSize, (), (const, override));
};
```

---

## Mocking Non-Virtual Methods

GoogleMock supports mocking non-virtual methods to facilitate high-performance dependency injection. Since they are not virtual, mock classes will **not** inherit from the original class but provide methods with matching signatures using the same `MOCK_METHOD` macros (without `override`).

```cpp
class ConcreteStream {
 public:
  void AppendPacket(Packet* packet);
  const Packet* GetPacket(size_t n) const;
  size_t NumberOfPackets() const;
};

class MockStream {
 public:
  MOCK_METHOD(void, AppendPacket, (Packet* packet));
  MOCK_METHOD(const Packet*, GetPacket, (size_t n), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

*Note:* Your code should use templates or other compile-time techniques to switch between real and mock implementations.

---

## Best Practices

### Always Place MOCK_METHOD in the Public Section

Even if the base class method is protected or private, define your mock methods in the `public:` section to allow `EXPECT_CALL` and `ON_CALL` to access them.

### Use `override` Where Relevant

Adding the `override` specifier helps the compiler ensure your mocks match virtual functions correctly.

### Handle Comma-Containing Types Carefully

Remember to enclose types with commas in extra parentheses or use type aliases to avoid parsing errors.

### Mock Virtual Destructors Properly

Your interface should have a **virtual destructor** to ensure mock destruction works correctly and prevents leaks.

### Use Naming Conventions

Give meaningful mock class names, typically prefixing with `Mock`.

### Consider Niceness and Strictness

Wrap your mock classes with `NiceMock<>`, `StrictMock<>`, or use the default behavior to control warnings for uninteresting calls.

---

## Example: Defining a Mock Class

```cpp
#include <gmock/gmock.h>

// Interface to mock
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int value, double factor) = 0;
};

// Mock class
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int value, double factor), (override));
};
```

Usage in a test:

```cpp
TEST(FooTest, ProcessesValuesCorrectly) {
  MockFoo mock;
  EXPECT_CALL(mock, GetSize())
      .WillOnce(Return(42));
  EXPECT_CALL(mock, Process(7, _))
      .WillOnce(Return(true));

  // Exercise code that uses Foo* or Foo& with mock
  ...
}
```

---

## Advanced Usage

### Specifying Calling Conventions

For platform-specific calling conventions, use the `Calltype` qualifier:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

### Using Reference Qualifiers

To mock ref-qualified methods (e.g., `foo() &` or `foo() &&`), specify `ref(&)` or `ref(&&)`:

```cpp
MOCK_METHOD(int, Foo, (), (ref(&), override));
MOCK_METHOD(int, Foo, (), (ref(&&), override));
```

### Mocking Methods with noexcept

If the original method is `noexcept`, add `noexcept` in the qualifier list:

```cpp
MOCK_METHOD(void, Func, (), (noexcept, override));
```

---

## Troubleshooting

- **Compilation Errors:** Usually caused by unprotected commas in types. Wrap such types in parentheses or use type aliases.
- **Unexpected Calls Reported:** Make sure expectations are set *before* exercising mock methods.
- **Warnings on Uninteresting Calls:** Consider using `NiceMock<>` to suppress warnings if calls are expected but not verified.
- **Overloaded Method Ambiguity:** Use argument matchers or `Const()` wrapper for const overloads.

---

## References and Further Reading

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — concise syntax summary.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — beginner-friendly guide.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — recipes for advanced uses.
- [Matchers Reference](../matchers.md) — learn about argument matchers.
- [Actions Reference](../actions.md) — understand mocking actions.
- Mocking API group in the GoogleTest documentation for related topics including expectations, actions, matchers, and strictness modes.

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-function-mocker.h", "range": "1-273"},{"path": "docs/gmock_cheat_sheet.md", "range": "1-244"},{"path": "docs/gmock_for_dummies.md", "range": "1-195"},{"path": "docs/gmock_cook_book.md", "range": "1-886"}]} />
