---
title: "Defining Mocks and Mocked Methods"
description: "Step-by-step API reference for declaring mock classes and methods with the MOCK_METHOD macro. Details supported signatures, qualifiers, and usage scenarios for class and interface mocking."
---

# Defining Mocks and Mocked Methods

Step-by-step API reference for declaring mock classes and methods with the `MOCK_METHOD` macro. This documentation details supported signatures, qualifiers, and usage scenarios for class and interface mocking within GoogleMock.

---

## 1. Overview of Mock Classes and MOCK_METHOD

Mocking in GoogleMock is primarily done by defining mock classes that mimic the interfaces or classes you want to test against. The core facility for declaring mocked methods in those classes is the `MOCK_METHOD` macro.

`MOCK_METHOD` generates the mocked method implementation for you with full support for argument matching, expectation setting, and behavior configuration.

### Defining a Mock Class

To create a mock class for a given interface or class:

- Derive a class from the original interface or base class.
- In the `public:` section, declare each method to be mocked using the `MOCK_METHOD` macro.

Example:

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

### How `MOCK_METHOD` Works

The syntax is:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers...));
```

- The first argument is the return type.
- The second argument is the method name.
- The third argument is the argument list in parentheses.
- The optional fourth argument is a parenthesized, comma-separated list of qualifiers.

Valid qualifiers include:

- `const`            — marks the method as const
- `override`         — marks the method as overriding a virtual method
- `noexcept`         — marks the method noexcept
- `Calltype(...)`    — specifies a calling convention (important on Windows)
- `ref(...)`         — reference qualifiers like `ref(&)` or `ref(&&)`

### Important Notes

- **Always place `MOCK_METHOD` declarations in `public:`** regardless of the access level of the method in the base class. This ensures that expectations can be set and verified on the mock methods.
- **If your method signature contains commas that are not protected by parentheses,** this can confuse the macro parser. Wrap the entire return type or argument type that contains commas with extra parentheses or use type aliases to avoid this problem.


## 2. Handling Method Signatures and Qualifiers

### Dealing with Commas in Types

Some types like `std::pair<int, int>` contain commas and must be wrapped to avoid parsing issues with `MOCK_METHOD`.

Example of broken code:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(std::pair<int, int>, GetPair, ());  // Won't compile due to comma
};
```

Solutions:

- Wrap in extra parentheses:

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<int, int>), GetPair, ());
};
```

- Use type aliases to simplify:

```cpp
using IntPair = std::pair<int, int>;
class MockFoo {
 public:
  MOCK_METHOD(IntPair, GetPair, ());
};
```

### Const and noexcept

Specify qualifiers in the fourth argument when mocking methods that have them.

Example:

```cpp
MOCK_METHOD(int, GetSize, (), (const, override));
MOCK_METHOD(void, Foo, (), (noexcept, override));
```

### Reference qualifiers

If a method has reference qualifiers (`&` or `&&`), specify them using `ref(...)` in the mock method.

Example:

```cpp
MOCK_METHOD(void, Foo, (), (ref(&), override));
```

### Calling conventions (Windows)

To support non-default calling conventions, use `Calltype(...)`:

```cpp
MOCK_METHOD(bool, Bar, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

## 3. Usage Scenarios

### Mocking Protected or Private Methods

You always put `MOCK_METHOD` declarations in the public section, even if the corresponding base class methods are protected or private. This allows expectations and default actions to be set from test code.

Example:

```cpp
class Foo {
 protected:
  virtual void Resume();
 private:
  virtual int GetTimeout();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Resume, (), (override));
  MOCK_METHOD(int, GetTimeout, (), (override));
};
```

### Mocking Overloaded Methods

You can mock overloaded methods by specifying each overload as usual. If you do not mock all overloads, you may get compiler warnings because some overloads are hidden. Use `using` to share the base class overloads you do not want to mock.

Example:

```cpp
class Foo {
 public:
  virtual int Add(int x);
  virtual int Add(int times, int x);
  virtual const Bar& GetBar() const;
  virtual Bar& GetBar();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
  MOCK_METHOD(Bar&, GetBar, (), (override));

  using Foo::Add;  // Bring in unmocked overloads
};
```

### Mocking Class Templates

Mock templates just like normal classes.

```cpp
template <typename Elem>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int GetSize() const = 0;
  virtual void Push(const Elem& x) = 0;
};

template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

### Mocking Non-Virtual Methods

gMock can mock non-virtual methods for use with compile-time dependency injection. Your mock class defines methods with the same signatures but does not inherit from the real class.

Example:

```cpp
class RealClass {
 public:
  void DoSomething();
  int Compute() const;
};

class MockClass {
 public:
  MOCK_METHOD(void, DoSomething, (), ());  // No override
  MOCK_METHOD(int, Compute, (), (const));
};
```

Use templates or other techniques to substitute between the real and mock classes at compile-time.

### Old-style `MOCK_METHODn` macros

Prior to 2018, GoogleMock used different macros `MOCK_METHODn` (where `n` is the number of arguments). They are still supported but not recommended. The newer `MOCK_METHOD` macro is preferred for clarity and consistency.

Example correspondence:

| Old style                | New style                                       |
|-------------------------|------------------------------------------------|
| `MOCK_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int))`                  |
| `MOCK_CONST_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`          |
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))` |

## 4. Best Practices and Tips

### Default Visibility

Mock methods **must** be declared in the `public:` section of the mock class, even if the corresponding base class methods are protected or private. This guarantees accessibility for expectation and action macros.

### Use Qualifiers For Overrides

Always specify `override` in the qualifiers to help catch mismatches between the mock method and the base class method signature.

### Be Careful With Templates and Overloads

- To mock all overloaded methods, provide explicit mocks for each signature.
- Use `using BaseClass::MethodName;` to expose unmocked overloads and suppress hiding warnings.

### Use Type Aliases To Avoid Parsing Ambiguities

If mocking methods with return or argument types that contain commas, use type aliases or wrap the type in parentheses to help `MOCK_METHOD` parse correctly.

### Mocking Non-Virtual Methods

Use the high-perf dependency injection technique by creating unrelated mock classes with matching signatures. Use template parameters to select real or mock implementations at compile time.

### Delegating to Real or Fake Implementations

You may delegate a mock's behavior to a fake or real object by customizing default actions via `ON_CALL` and lambda wrappers.

### Strict/Nice/Naggy Mocks

To control warning and error behavior on uninteresting calls, use `NiceMock`, `StrictMock`, or the default naggy mocks. Use these wisely to strike the right balance between strictness and test maintainability.

### Speed Up Compilation

Separate mock class constructors and destructors into `.cc` files to reduce compilation overhead.

## 5. Example Snippets

### Simple Mock Class Definition

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

### Wrapping Comma-Containing Types

```cpp
using BoolAndInt = std::pair<bool, int>;
class MockFoo {
 public:
  MOCK_METHOD(BoolAndInt, GetPair, ());
};
```

### Mocking Overloaded Methods

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));

  using Foo::Add;  // Suppress hiding warnings
};
```

### Mocking Const Method

```cpp
MOCK_METHOD(int, Size, (), (const, override));
```

### Mocking Method with Reference Qualification

```cpp
MOCK_METHOD(void, Process, (), (ref(&), override));
```

### Mocking Method with Calling Convention

```cpp
MOCK_METHOD(bool, FooMethod, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

## 6. Troubleshooting Common Issues

### Compiler Errors with Comma-Containing Types

Ensure types with commas are wrapped or aliased.

### Access Errors to Protected or Private Methods

Declare mocks of such methods in `public:` to allow `EXPECT_CALL` to access them.

### Overloaded Method Warnings

Use `using BaseClass::MethodName;` to bring unmocked overloads into scope.

### Missing Virtual Destructor Warnings or Memory Leaks

Ensure base classes have virtual destructors to allow proper cleanup of mocks.

### Unexpected Calls or Missing Expectations

Ensure `EXPECT_CALL` is set before exercising mocks. Use `ON_CALL` for default behaviors if needed.

### Mock Method Call Warnings

Use `NiceMock` to suppress warnings on uninteresting calls or explicitly specify expectations if needed.

## 7. Related Macros and Facilities

### EXPECT_CALL
Set expectations on mock methods, specifying expected call counts, argument matchers, and desired actions.

### ON_CALL
Define default actions for mock methods without imposing call count expectations.

For details, see the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL) and the [Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

---

For comprehensive information and recipes, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#mocking-methods) and [Mocking Reference](https://google.github.io/googletest/reference/mocking.html). See also the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick usage.

# End of Document
