---
title: "Custom Actions and Invocations"
description: "Reference for GoogleMock's actions API, enabling users to define what a mock method should do when invoked. Covers built-in actions, custom actions, and utilities for returning values, throwing exceptions, and invoking other functions."
---

# Custom Actions and Invocations

This reference page details the **GoogleMock (gMock) Actions API**, empowering you to define precisely what a mock method should do when invoked. Actions control the behavior of mock functions, such as returning values, performing side effects, throwing exceptions, or delegating to other functions or functors. You will find descriptions of built-in actions, custom actions creation methods, and utilities to handle both standard and advanced invocation scenarios.

---

## Contents

- [Understanding Actions in gMock](#understanding-actions-in-gmock)
- [Built-in Actions Reference](#built-in-actions-reference)
  - [Returning Values](#returning-values)
  - [Side Effects](#side-effects)
  - [Using Functions, Functors, or Lambdas as Actions](#using-functions-functors-or-lambdas-as-actions)
  - [Default Action](#default-action)
  - [Composite Actions](#composite-actions)
- [Defining Custom Actions](#defining-custom-actions)
  - [Legacy Macro-based Actions](#legacy-macro-based-actions)
  - [Writing Monomorphic Actions](#writing-monomorphic-actions)
  - [Writing Polymorphic Actions](#writing-polymorphic-actions)
- [Advanced Action Utilities](#advanced-action-utilities)

---

## Understanding Actions in gMock

In gMock, **actions specify what a mock method actually does** when it is called. This is distinct from expectations, which specify *whether and how often a mock method will be called*. Actions enable you to control the return values, invoke user code, manipulate arguments, or perform other effects in a fully customizable way.

Mock methods can use built-in actions for common scenarios or define custom actions, empowering you to tailor mock behavior exactly to your tests' needs.

> **Tip:** Using actions thoughtfully helps create tests that are both precise and maintainable while mimicking your application's real behavior to a high degree.

---

## Built-in Actions Reference

All built-in actions are defined in the `::testing` namespace.

### Returning Values

These actions specify return values from mock functions. They cover simple returns to more advanced behaviors like returning references or cyclic sequences.

| Action                          | Description                                                                                                  |
|--------------------------------|--------------------------------------------------------------------------------------------------------------|
| `Return()`                     | Returns from a `void` function without a value.                                                             |
| `Return(value)`                | Returns `value` (converted to the mock function's return type at expectation setup time).                    |
| `ReturnArg<N>()`               | Returns the `N`-th (0-based) argument passed to the mock function.                                           |
| `ReturnNew<T>(a1, ..., ak)`     | Returns a new instance created with `new T(a1, ..., ak)` on the heap (new object each call).                 |
| `ReturnNull()`                 | Returns a null pointer.                                                                                       |
| `ReturnPointee(ptr)`           | Returns the value pointed to by pointer `ptr` at runtime.                                                   |
| `ReturnRef(variable)`          | Returns a reference to the given variable. Useful when the mock method's return type is a reference.         |
| `ReturnRefOfCopy(value)`       | Returns a reference to a *copy* of `value` stored inside the action.                                        |
| `ReturnRoundRobin({a1,...,ak})`| Cycles through the given values; each call returns the next value in order, restarting at the beginning when exhausted.|

### Side Effects

These actions perform side effects on function arguments or global state.

| Action                          | Description                                                                                                  |
|--------------------------------|--------------------------------------------------------------------------------------------------------------|
| `Assign(&variable, value)`     | Assigns `value` to the variable pointed to by `&variable`.                                                  |
| `DeleteArg<N>()`               | Deletes the `N`-th (0-based) argument, which must be a pointer.                                              |
| `SaveArg<N>(pointer)`          | Saves the `N`-th argument by copy-assignment into `*pointer`.                                               |
| `SaveArgByMove<N>(pointer)`    | Moves the `N`-th argument into `*pointer`.                                                                  |
| `SaveArgPointee<N>(pointer)`   | Saves the value pointed to by the `N`-th argument into `*pointer`.                                          |
| `SetArgReferee<N>(value)`      | Assigns `value` to the variable referenced by the `N`-th argument.                                          |
| `SetArgPointee<N>(value)`      | Assigns `value` to the object pointed to by the `N`-th argument.                                            |
| `SetArgumentPointee<N>(value)` | Deprecated alias for `SetArgPointee<N>(value)` (to be removed).                                              |
| `SetArrayArgument<N>(first, last)` | Copies elements from the range `[first, last)` into the array pointed to by the `N`-th argument.          |
| `SetErrnoAndReturn(error, value)` | Sets `errno` to the specified error and returns `value` (simulate system call failures).                    |
| `Throw(exception)`             | Throws the specified exception (available if exceptions are enabled).                                       |

### Using Functions, Functors, or Lambdas as Actions

Any callable can be the action for a mock method, as long as its signature is compatible.

| Action                              | Description                                                                                               |
|------------------------------------|-----------------------------------------------------------------------------------------------------------|
| `f`                                | Invokes callable `f` with the mock function's arguments.                                                  |
| `Invoke(f)`                        | Invokes callable `f` (a function, functor, or lambda) with the mock function's arguments.                 |
| `Invoke(object_ptr, &Class::method)` | Invokes the specified method on `object_ptr` with the mock function's arguments.                        |
| `InvokeWithoutArgs(f)`             | Invokes callable `f`, which must be parameterless.                                                       |
| `InvokeWithoutArgs(object_ptr, &Class::method)` | Invokes a parameterless method on `object_ptr`.                                                    |
| `InvokeArgument<N>(arg1, arg2, ..., argk)` | Invokes the `N`-th argument (callable) passed to the mock function with the supplied arguments.         |

> **Important:** When passing arguments by reference to `InvokeArgument`, use `std::ref()` to ensure the callable receives the reference to the original value rather than a copy.

### Default Action

| Action       | Description                                                                                      |
|--------------|--------------------------------------------------------------------------------------------------|
| `DoDefault()` | Performs the default action set via `ON_CALL()` or the built-in default for the method's return type. |

> **Note:** `DoDefault()` cannot be used inside composite actions; attempts to do so will cause runtime errors.

### Composite Actions

Combine multiple actions to execute sequentially during a single mock method invocation.

| Action                          | Description                                                                                       |
|--------------------------------|---------------------------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)`        | Executes actions `a1` through `an` sequentially; only the result of the last action `an` is used. The first `n-1` must return void. |
| `IgnoreResult(a)`               | Executes action `a` and ignores its result; `a` must not return `void`.                            |
| `WithArg<N>(a)`                 | Passes the `N`-th mock function argument to action `a` and performs it.                            |
| `WithArgs<N1, N2, ..., Nk>(a)`  | Passes selected arguments to action `a` and performs it.                                          |
| `WithoutArgs(a)`                | Performs action `a` without any arguments (adapts a no-argument action to functions with arguments).|

---

## Defining Custom Actions

If the built-in actions do not meet your needs, GoogleMock lets you define custom actions to provide tailored behaviors.

### Legacy Macro-based Actions

For quick and easy action definitions, you can use the `ACTION*` macros in namespace scope (not inside functions or classes).

- `ACTION(name) { statements; }` defines an action with no parameters.
- `ACTION_P(name, param) { statements; }` defines an action with one parameter.
- Variations up to `ACTION_P10` allow multiple parameters.

Inside an action body, you have access to:

- `arg0`, `arg1`, ... : the mock function arguments by index.
- `args` : tuple of all arguments.
- `return_type` : mock function's return type.
- `function_type` : full function signature.

Example:

```cpp
ACTION(IncrementArg1) {
  return ++(*arg1);
}

... WillOnce(IncrementArg1());
```

Another example with more parameters:

```cpp
ACTION_P(Add, n) {
  return arg0 + n;
}

... WillOnce(Add(5));
```

> **Tip:** Use `argK_type` or parameter type variables (`n_type`) when you need explicit typing inside action bodies.

### Writing Monomorphic Actions

For more control, define a class implementing `::testing::ActionInterface<F>`, where `F` is the mock function type.

Example:

```cpp
class IncrementArgumentAction : public ::testing::ActionInterface<int(int*)> {
 public:
  int Perform(const std::tuple<int*>& args) override {
    int* p = std::get<0>(args);
    return ++(*p);
  }
};

::testing::Action<int(int*)> IncrementArgument() {
  return ::testing::MakeAction(new IncrementArgumentAction);
}
```

Then use:

```cpp
EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementArgument());
```

### Writing Polymorphic Actions

To create actions usable with multiple function signatures, implement a template-based `Perform` method and wrap the implementation using `MakePolymorphicAction()`.

Example:

```cpp
class ReturnSecondArgumentAction {
 public:
  template <typename Result, typename ArgumentTuple>
  Result Perform(const ArgumentTuple& args) const {
    return std::get<1>(args);
  }
};

::testing::PolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() {
  return ::testing::MakePolymorphicAction(ReturnSecondArgumentAction());
}
```

Use as:

```cpp
EXPECT_CALL(mock, Foo).WillOnce(ReturnSecondArgument());
```

---

## Advanced Action Utilities

Some additional utilities help you invoke methods, ignore return values, and manipulate arguments efficiently.

- `Invoke(object_ptr, &Class::method)` allows invoking a method on an object as an action.
- `InvokeWithoutArgs(f)` invokes a zero-argument function or functor as the action.
- `IgnoreResult(action)` changes any action returning a value to one returning `void`, discarding that value (useful when calling non-void functions in mocks returning void).
- `InvokeArgument<N>(args...)` invokes the `N`-th argument (a callback) passed to the mock function with the specified arguments.
- `ByRef(variable)` returns a `std::reference_wrapper` to `variable`, useful when you want to pass references explicitly in actions.

---

## Practical Guidance

- **Evaluate actions only once:** Action expressions are evaluated when expectations are set, not at execution time.
- **Use `WillOnce` for one-time actions:** Actions with state or move-only semantics should be used with `WillOnce`.
- **Combine multiple side effects:** Use `DoAll()` to execute multiple actions on invocation.
- **When returning references:** Use `ReturnRef()` or `ReturnPointee()`.
- **For complex behavior:** Define custom actions or use callables (lambdas, functors).

For comprehensive recipes and examples, see the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#Actions) and [Actions Reference](../docs/reference/actions.md).

---

## See Also

- [gMock Cookbook - Actions Section](https://google.github.io/googletest/gmock_cook_book.html#Actions)
- [Matchers Reference](reference/matchers.md)
- [Mocking Reference - Setting Expectations](reference/mocking.md#EXPECT_CALL)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)

---

_This documentation is part of the GoogleMock API Reference, providing actionable and clear guidance to help you tailor mock behaviors effectively._
