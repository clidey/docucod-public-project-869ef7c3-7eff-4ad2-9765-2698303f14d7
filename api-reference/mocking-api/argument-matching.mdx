---
title: "Argument Matching"
description: "Explores matcher APIs, including built-in matchers, custom matchers, and advanced usage patterns. Shows how to write expressive expectations about function arguments."
---

# Argument Matching

Explore how to precisely specify expectations about function arguments in GoogleMock. This guide delves into matcher APIs including built-in matchers, custom matchers, and advanced usage patterns. Learn how to write expressive and flexible expectations to validate your mock method calls with exact or complex argument criteria.

---

## Understanding Argument Matchers

Matchers are predicates used to define constraints on arguments passed to mock methods. They enable you to check not just exact values but properties, patterns, and relationships between arguments.

In GoogleMock, you use matchers inside the `EXPECT_CALL()` and `ON_CALL()` macros to specify what arguments you expect mock methods to receive. When the mock method is called, GoogleMock compares the actual arguments against the provided matchers to decide which expectation applies.

### Basic Usage

Suppose you have a mock method `Forward(int distance)`. To expect that it is called with the value `100`:

```cpp
EXPECT_CALL(turtle, Forward(100));
```

Here, the literal `100` acts as an implicit matcher equivalent to `Eq(100)`, meaning the argument must be equal to 100.

If you want to accept any argument value:

```cpp
EXPECT_CALL(turtle, Forward(_));
```

The underscore `_` is the wildcard matcher that matches any value of the appropriate type.

### Using Built-in Matchers

GoogleMock comes equipped with rich built-in matchers that allow you to:

- Match textual patterns (`HasSubstr()`, `StartsWith()`, `EndsWith()`, `MatchesRegex()`, etc.)
- Compare numeric values (`Gt()`, `Lt()`, `Ge()`, `Le()`, `Eq()`, `Ne()`, etc.)
- Match pointer properties (`IsNull()`, `NotNull()`, `Pointee()`, `Pointer()`) 
- Check container contents (`ElementsAre()`, `Contains()`, `UnorderedElementsAre()`, `SizeIs()`, etc.)
- Use composition and logic (`AllOf()`, `AnyOf()`, `Not()`, `Conditional()`)

Example: to expect `Forward()` to be called with a value greater than 50:

```cpp
EXPECT_CALL(turtle, Forward(Gt(50)));
```

### Matching Multiple Arguments as a Whole

Sometimes you want to apply conditions based on a relationship among multiple arguments rather than each individually.

GoogleMock provides the `.With()` clause on expectations to specify a multi-argument matcher that takes a tuple of all arguments.

Example: expect that the first argument is less than the second:

```cpp
EXPECT_CALL(my_mock, SetPosition(_, _))
    .With(Lt());
```

Here `Lt()` is a 2-tuple matcher. You can use built-in multi-argument matchers or define your own.

### Matching Overloaded and Const Methods

If the mock method is overloaded, you must help GoogleMock disambiguate by specifying matchers explicitly or using the `Const()` wrapper for const overloads. For example:

```cpp
EXPECT_CALL(mock, GetBar()).WillOnce(Return(bar1));         // non-const
EXPECT_CALL(Const(mock), GetBar()).WillOnce(Return(bar2));  // const
```

### Using Custom Matchers

When built-in matchers are insufficient, you can write your own:

- Use `MATCHER` macros to define simple custom matchers with expressive failure messages.
- Define your own matcher classes implementing the matcher interface for advanced behavior.

Example custom matcher with `MATCHER` macro:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

// Usage:
EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

### Composing Matchers

You can compose matchers using logical operators:

- `AllOf(m1, m2, ...)` matches if all sub-matchers match.
- `AnyOf(m1, m2, ...)` matches if any sub-matcher matches.
- `Not(m)` matches if `m` fails to match.

Example: match arguments greater than 5 but not equal to 10:

```cpp
EXPECT_CALL(foo, Bar(AllOf(Gt(5), Not(Eq(10)))));
```

### Convenient Matchers on Object Fields and Properties

GoogleMock allows matching on specific fields or properties of an argument:

- `Field(&Class::field, m)` matches objects whose member field matches matcher `m`.
- `Property(&Class::property, m)` matches objects whose no-argument `property()` method returns a value matching `m`.

Example:

```cpp
EXPECT_CALL(mock, Process(Field(&Widget::id, Eq(42))));
EXPECT_CALL(mock, Analyze(Property(&Widget::GetStatus, Eq("OK"))));
```

### Matching Pointer Arguments

To match the value pointed to by a pointer argument:

- Use `Pointee(m)`.

Example:

```cpp
EXPECT_CALL(mock, Foo(Pointee(Eq(5))));  // Pointer to int equal to 5
```

### Safety and Best Practices

- **Avoid overly specific matchers:** Over-specifying arguments can lead to brittle tests.
- **Use `ON_CALL` for default behaviors** and `EXPECT_CALL` only when you want to assert calls.
- **Retire expectations** when expecting calls in sequence to avoid “sticky” expectations.
- **Use `RetiresOnSaturation()`** on expectations when you want them to become inactive after being satisfied.

### Troubleshooting Argument Matching

- Use the `--gmock_verbose=info` flag in your test run to get detailed reports on mock call matching.
- Check for uninteresting calls (calls that do not match any expectation) and whether you need catch-all wildcard expectations.
- Avoid using ambiguous matchers on overloaded methods without disambiguation.
- When matching complex data, use custom matchers with clear failure messages.

### Summary of Common Matchers and Constructs

| Matcher/Construct | Description |
|------------------|-------------|
| `_`              | Wildcard matcher; matches anything of the correct type.
| `Eq(value)`       | Matches argument equal to value.
| `Ne(value)`       | Matches argument not equal to value.
| `Gt(value)`, `Lt(value)`, `Ge(value)`, `Le(value)` | Numeric comparisons.
| `IsNull()`, `NotNull()` | Matches null or non-null pointers.
| `Pointee(m)`      | Matches pointer whose pointee matches `m`.
| `Field(&Class::field, m)` | Matches member field.
| `Property(&Class::prop, m)` | Matches `prop()` method.
| `AllOf(...)`, `AnyOf(...)`, `Not(m)` | Composite matchers.
| `Truly(pred)`     | Matches if predicate returns true.
| `With(multi_arg_matcher)` | Matches all arguments as a tuple.

### Examples

#### Expect a method called with an int less than 10:

```cpp
EXPECT_CALL(mock, Foo(Lt(10)));
```

#### Expect a method called with a string starting with "Hello":

```cpp
EXPECT_CALL(mock, Bar(StartsWith("Hello")));
```

#### Expect a method called with two arguments where first is less than second:

```cpp
EXPECT_CALL(mock, Baz(_, _)).With(Lt());
```

#### Define a simple custom matcher:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
EXPECT_CALL(mock, DoSomething(IsEven()));
```

#### Expect a method called with an object having an `id` field equal to 5:

```cpp
EXPECT_CALL(mock, Process(Field(&MyClass::id, Eq(5))));
```

#### Expect a method called with a pointer argument pointing to a value > 0:

```cpp
EXPECT_CALL(mock, Foo(Pointee(Gt(0))));
```

---

## Summary

The argument matching APIs allow precise and expressive specification of expected arguments in mock method calls. From simple equality checks to complex tuple relations, GoogleMock’s matchers let you frame your expectations clearly and robustly. Custom matchers and composition enable tailored match conditions, improving test clarity and maintainability.

Use the `.With()` clause to impose constraints spanning multiple arguments, and `.RetiresOnSaturation()` to manage expectation lifetime. Disambiguate overloaded methods carefully using explicit matchers or `Const()`.

Employ verbosity options for debugging argument matching and fine-tune tests to avoid brittleness through balanced use of expectations and default actions.

---

## References

- [Matchers Reference](reference/matchers.md) — comprehensive list of built-in matchers
- [Mocking Reference](reference/mocking.md#EXPECT_CALL) — setting expectations with matchers
- [gMock Cookbook: Using Matchers](docs/gmock_cook_book.md#UsingMatchers) — practical matcher usage and examples
- [Writing New Matchers Quickly](docs/gmock_cook_book.md#NewMatchers) — guide to custom matchers
- [Understanding Uninteresting vs Unexpected Calls](docs/gmock_cook_book.md#uninteresting-vs-unexpected) — importance of `ON_CALL` and `EXPECT_CALL`

---

## Navigation

This page fits into the [Mocking API Reference](api-reference/mocking-api/specifying-expectations) alongside other related pages such as [Creating and Using Mock Objects](api-reference/mocking-api/creating-mock-objects) and [Defining Actions and Behaviors](api-reference/mocking-api/actions-behaviors).

For comprehensive understanding, read the [gMock Cookbook](docs/gmock_cook_book.md) and the [Matchers Reference](reference/matchers.md).

---

<Callout title="Tip">
Use expressive argument matchers to make your tests more readable and maintainable. Avoid over-specifying; prefer `_` for arguments you don't care about. Compose matchers to capture complex conditions succinctly.
</Callout>

<Callout title="Warning">
Expectations must be set before mock methods are called. Using ambiguous matchers on overloaded methods can cause compilation errors or unexpected behavior.
</Callout>

<Callout title="Note">
`.With()` clause in `EXPECT_CALL` or `ON_CALL` must be the first clause and can only be used once.
</Callout>

---