---
title: "Mock Class Creation & MOCK_METHOD"
description: "Step-by-step documentation for creating mock classes, using the MOCK_METHOD macro for various method signatures, and integrating mocks with test code. Explains method qualifiers, argument matching, and advanced configuration."
---

# Mock Class Creation & MOCK_METHOD

This section guides you through creating mock classes with GoogleMock, focusing on the key macro `MOCK_METHOD` for defining mocked methods. It explains how to properly declare mocks, handle various method signatures, use method qualifiers, and integrate mocks in your tests. Additionally, it covers advanced configurations like calling conventions, method overloading, and managing reference qualifiers.

---

## Defining a Mock Class

Mock classes are user-defined classes that simulate behavior of real classes for testing purposes. In GoogleMock, defining a mock class follows simple, consistent rules:

1. Derive your mock class from the interface or class you want to mock.
2. Declare all mock methods **in the public section** using the `MOCK_METHOD` macro regardless of the original method's access specifier.
3. Use `MOCK_METHOD` to define each method's return type, name, argument list, and optional specifiers.

### Basic Syntax of `MOCK_METHOD`

```cpp
class MyMock : public MyInterface {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specifiers...));
};
```

- **ReturnType**: The method's return type.
- **MethodName**: The method's identifier.
- **Args...**: Argument types enclosed in parentheses.
- **Specifiers (optional)**: A closed list of qualifiers modifying the method signature.

### Example

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Important Guidelines

- **Placement**: Always place `MOCK_METHOD` declarations in the `public:` section. This allows gMock to set expectations and perform call interceptions regardless of the original visibility.
- **Method Overriding**: To correctly override virtual methods, use `(override)` specifier in the fourth parameter list.
- **Const Methods**: For const-qualified methods, include `(const, override)`.
- **Reference Qualifiers**: If the original method has reference qualifiers (like `&` or `&&`), specify them using `ref(&)` or `ref(&&)` in the specifier list.

---

## Handling Complex Signatures and Commas

In signatures with types that contain unprotected commas (e.g., `std::pair<bool, int>`), the macro argument parsing breaks. Solve this by:

- Wrapping the type in parentheses:
  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

- Or defining type aliases:
  ```cpp
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
  ```

Note that these parentheses are removed internally to generate correct C++ code.

---

## Method Specifiers (Fourth Parameter)

The optional specifiers influence the generated mock methods to ensure correct overriding and calling conventions:

| Specifier                | Purpose
|--------------------------|----------------------------------------------|
| `const`                  | Marks the method as `const`. Use when overriding const methods.
| `override`               | Adds the `override` keyword. Recommended best practice.
| `final`                  | Adds the `final` keyword.
| `noexcept`               | Marks the method as `noexcept` for noexcept methods.
| `Calltype(X)`            | Specifies a calling convention, e.g., `STDMETHODCALLTYPE` on Windows.
| `ref(&)` or `ref(&&)`    | Applies reference qualifiers for methods qualified with `&` or `&&`.

### Example with Specifiers

```cpp
MOCK_METHOD(bool, Open, (const char* filename), (const, override, noexcept));
MOCK_METHOD(void, Process, (int data), (override, Calltype(STDMETHODCALLTYPE)));
MOCK_METHOD(int, GetValue, (), (const, override, ref(&)));
```

---

## Mocking Overloaded Methods

To mock overloaded virtual methods, simply use `MOCK_METHOD` with matching signatures and specifiers:

```cpp
class Foo {
 public:
  virtual int Add(int x) = 0;
  virtual int Add(int times, int x) = 0;
  virtual const Bar& GetBar() const = 0;
  virtual Bar& GetBar() = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
};
```

If you do not mock all overloads, use `using` declarations to bring base class methods into scope and prevent hiding warnings.

---

## Mocking Template Classes

Mocking template classes involves defining mock class templates with `MOCK_METHOD` inside:

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int GetSize() const = 0;
  virtual void Push(const T& elem) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& elem), (override));
};
```

Use the mock template class by instantiating the template with a concrete type.

---

## Mocking Non-Virtual Methods

gMock can mock non-virtual methods for high-performance dependency injection by defining mock classes unrelated to the original classes but with the same interface:

```cpp
class Concrete {
 public:
  void Foo(int x);
  int Bar() const;
};

class MockConcrete {
 public:
  MOCK_METHOD(void, Foo, (int x));
  MOCK_METHOD(int, Bar, (), (const));
};
```

Use templates or other compile-time mechanisms to switch between real and mock classes.

---

## Specifying Calling Conventions

If mock methods use custom calling conventions (such as Windows `__stdcall`), specify it via the `Calltype` specifier:

```cpp
MOCK_METHOD(bool, Func, (int x), (Calltype(STDMETHODCALLTYPE)));
MOCK_METHOD(void, Proc, (), (const, Calltype(STDMETHODCALLTYPE)));
```

---

## Old-Style MOCK_METHODn Macros

Legacy macros like `MOCK_METHOD1`, `MOCK_CONST_METHOD1`, and their variants are supported but deprecated in favor of `MOCK_METHOD`:

| Old Macro                         | New Equivalent Usage
|----------------------------------|---------------------|
| `MOCK_METHOD1(Foo, bool(int))`   | `MOCK_METHOD(bool, Foo, (int))` 
| `MOCK_CONST_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`
| `MOCK_METHOD1_T(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int))`
| `MOCK_CONST_METHOD1_T(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))`
| `MOCK_CONST_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const, Calltype(STDMETHODCALLTYPE)))`

---

## Best Practices

- Always specify method qualifiers correctly (`const`, `override`, `noexcept`, `ref(&)`, etc) to match the base class. Incorrect qualifiers may cause subtle bugs or compilation errors.
- Place all mock method declarations in the `public:` section.
- Use type aliases or parentheses to handle complex argument or return types with commas.
- Use `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>` wrappers to control behavior on uninteresting calls (warnings, suppression, or failures) depending on your test needs.
- For overloaded methods, mock each overload explicitly. Use `using Base::Method` to avoid hiding base methods.
- When mocking template classes, ensure all mocked methods and destructors are virtual.

---

## Integration with Test Code

Once mock classes are defined, typical usage involves:

1. Instantiating mock objects.
2. Setting expectations via `EXPECT_CALL` or default behaviors via `ON_CALL`.
3. Exercising the code that uses the mocks.
4. GoogleMock automatically verifies expectations on destruction.

Example:

```cpp
using ::testing::Return;

MockTurtle turtle;
ON_CALL(turtle, GetX()).WillByDefault(Return(42));
EXPECT_CALL(turtle, PenDown()).Times(1);

// Code under test uses `turtle` ...
```

---

## Troubleshooting and Tips

- If you see compilation errors related to commas in type parameters, use parentheses or type aliases as shown.
- If uninteresting calls on mocks generate warnings, consider converting the mock to `NiceMock` or adding expectations.
- Always verify that mocked signatures precisely match base class virtual methods.
- To speed up compilation on large mocks, consider moving constructor and destructor out of header files.

---

## References and Further Reading

- [gMock Cookbook — Creating Mocks](https://google.github.io/googletest/gmock_cook_book.html#CreatingMocks)
- [Mocking Reference — MOCK_METHOD](../api-reference/mocking-api/mock-class-creation)
- [gMock Cheat Sheet — Mock Classes](https://google.github.io/googletest/gmock_cheat_sheet.html#mocking-a-class)
- [Using Mocks in Tests](gmock_for_dummies.md#UsingMocks)

---

## Summary

This documentation has detailed how to define mock classes and their methods using the `MOCK_METHOD` macro, including handling of method qualifiers, complex type signatures, and calling conventions. It covers usage patterns for overloaded and template methods, legacy macros, and integration strategies in test scenarios.

To master mocking with GoogleMock, ensure you follow best practices for method declarations and specifier usage, and leverage `NiceMock` and related types to manage uninteresting calls effectively.
