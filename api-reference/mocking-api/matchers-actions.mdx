---
title: "Matchers and Actions"
description: "Catalog of built-in matchers and actions available out of the box, with signatures, usage examples, and extension mechanisms. Covers both standard and advanced actions/matchers for flexible argument verification and mock behavior."
---

# Matchers and Actions

This page catalogs the extensive collection of built-in **matchers** and **actions** provided by GoogleMock. These tools let you precisely verify the arguments passed to mock methods and control the behavior of mocks when their methods are invoked. They cover fundamental types, container contents, argument predicates, function call sequencing, and more.

All matchers and actions reside in the `::testing` namespace. Examples demonstrate their signatures, usage patterns, and extension mechanisms.

---

## Matchers Reference

Matchers specify the conditions mock function arguments must satisfy for an expectation to match. They function as expressive predicates enhancing test intent clarity.

### Common Matchers

| Matcher             | Description                                                           | Example                                       |
|---------------------|-----------------------------------------------------------------------|-----------------------------------------------|
| `_`                 | Wildcard matcher that matches any value.                            | `EXPECT_CALL(mock, Foo(_));`                   |
| `Eq(value)`          | Matches when the argument equals `value` (using `operator==`).      | `EXPECT_CALL(mock, Foo(Eq(5)));`                |
| `Ne(value)`          | Matches when the argument is not equal to `value`.                   | `EXPECT_CALL(mock, Foo(Ne(0)));`                |
| `Lt(value)`, `Le(value)`| Matches less than (`Lt`), or less than or equal (`Le`).           | `EXPECT_CALL(mock, Foo(Lt(10)));`                |
| `Gt(value)`, `Ge(value)`| Matches greater than (`Gt`), or greater than or equal (`Ge`).     | `EXPECT_CALL(mock, Foo(Ge(100)));`               |
| `Not(matcher)`       | Matches when inner matcher does not match.                          | `EXPECT_CALL(mock, Foo(Not(Eq(0))));`            |
| `IsNull()`           | Matches null pointers (`nullptr`).                                  | `EXPECT_CALL(mock, Foo(IsNull()));`               |
| `NotNull()`          | Matches non-null pointers.                                          | `EXPECT_CALL(mock, Foo(NotNull()));`              |
| `A<T>()`             | Matches a value implicitly convertible to `T`.                      | `EXPECT_CALL(mock, Foo(A<int>()));`                |

### Container Matchers

Matchers for STL containers and other iterable types.

| Matcher                        | Meaning                                                          | Example                                    |
|-------------------------------|------------------------------------------------------------------|--------------------------------------------|
| `ElementsAre(e1, e2, ...)`     | Matches container whose elements exactly correspond to the sequence.| `EXPECT_CALL(mock, Foo(ElementsAre(1, 2, 3)));` |
| `UnorderedElementsAre(e1, e2...)` | Matches container with exactly the given elements in any order.| `EXPECT_CALL(mock, Foo(UnorderedElementsAre(1, 2, 3)));` |
| `ElementsAreArray(array)`       | Matches container with elements matching those in a C-style array.| `EXPECT_CALL(mock, Foo(ElementsAreArray(arr)));` |
| `ContainerEq(container)`        | Matches containers with identical elements in the same order.    | `EXPECT_CALL(mock, Foo(ContainerEq(expected_vec)));` |
| `IsSubsetOf(container)`         | Matches if the argument container is a subset of reference container.| `EXPECT_CALL(mock, Foo(IsSubsetOf({1, 2, 3})));` |
| `IsSupersetOf(container)`       | Matches if the argument container is a superset of reference container.| `EXPECT_CALL(mock, Foo(IsSupersetOf({5})));` |

### Composite and Logical Matchers

Compose existing matchers for complex logic.

| Matcher                  | Meaning                                               | Example                                      |
|--------------------------|-------------------------------------------------------|----------------------------------------------|
| `AllOf(m1, m2, ...)`     | Matches when all inner matchers match.                | `EXPECT_CALL(mock, Foo(AllOf(Ge(10), Le(20))));` |
| `AnyOf(m1, m2, ...)`     | Matches when any inner matcher matches.                | `EXPECT_CALL(mock, Foo(AnyOf(Eq(5), Eq(7))));`    |

### Specialized Matchers

| Matcher                      | Description                                        | Example                                      |
|------------------------------|---------------------------------------------------|----------------------------------------------|
| `Field(&Class::field, matcher)` | Matches objects whose member `field` matches matcher.  | `EXPECT_CALL(mock, Foo(Field(&MyStruct::x, Lt(10))));` |
| `Property(&Class::method, matcher)` | Matches objects whose method result matches matcher.| `EXPECT_CALL(mock, Foo(Property(&MyClass::GetValue, Eq(42))));` |
| `Pointee(matcher)`           | Matches pointer or smart pointer pointing to value matching matcher.| `EXPECT_CALL(mock, Foo(Pointee(Lt(0))));` |
| `Truly(predicate)`           | Matches when `predicate(arg)` returns true (predicate is user-defined function or lambda).| `EXPECT_CALL(mock, Foo(Truly([](int n){ return n%2 == 0; })));` |

### Matcher Composing Examples

```cpp
using ::testing::Lt;
using ::testing::Gt;
using ::testing::Field;
using ::testing::_; 

// First argument is less than second argument.
EXPECT_CALL(mock, Foo(_, _))
    .With(Lt());

// Object arg's member 'count' is greater than 5.
EXPECT_CALL(mock, Bar(Field(&MyObject::count, Gt(5))));

// Pointer argument points to an integer less than 10.
EXPECT_CALL(mock, Baz(Pointee(Lt(10))));
```

---

## Actions Reference

Actions specify what a mock method does when it is invoked, beyond just verifying calls.

All actions are declared in the `::testing` namespace.

### Returning Values

| Action                   | Description
|--------------------------|---------------------------------------------------|
| `Return()`               | Returns from a `void` mock function.
| `Return(value)`          | Returns the given `value`. If incompatible type, converts it immediately.
| `ReturnArg<N>()`         | Returns the N-th argument.
| `ReturnNew<T>(args...)`  | Returns a new `T` object allocated with given arguments.
| `ReturnNull()`           | Returns a null pointer.
| `ReturnPointee(ptr)`     | Returns the value pointed to by `ptr` at invocation time.
| `ReturnRef(variable)`    | Returns a reference to a variable.
| `ReturnRefOfCopy(value)` | Returns a reference to a copy of value.
| `ReturnRoundRobin({a1,...})` | Cycles through listed return values consecutively.

### Side Effect Actions

| Action                        | Description
|-------------------------------|--------------------------------------------|
| `Assign(&var, val)`           | Assigns `val` to `var`.
| `DeleteArg<N>()`              | Deletes pointer argument at index N.
| `SaveArg<N>(pointer)`         | Copies N-th argument to pointed storage.
| `SaveArgByMove<N>(pointer)`   | Moves N-th argument to pointed storage.
| `SaveArgPointee<N>(pointer)`  | Copies the value pointed to by argument N to pointed storage.
| `SetArgReferee<N>(value)`    | Assigns `value` to the reference pointed to by argument N.
| `SetArgPointee<N>(value)`    | Assigns `value` to the pointer pointed to by argument N.
| `SetArrayArgument<N>(first, last)` | Copies range `[first, last)` to array pointed by argument N.
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` and returns `value`.
| `Throw(exception)`            | Throws the given exception.

### Using Callables as Actions

| Action                                                  | Description
|---------------------------------------------------------|----------------------------|
| `f` or `Invoke(f)`                                      | Calls `f` (function, functor, or lambda) with the mock's arguments.
| `Invoke(object_pointer, &class::method)`                | Calls method on object with the mock's arguments.
| `InvokeWithoutArgs(f)`                                  | Calls `f` without arguments.
| `InvokeWithoutArgs(object_pointer, &class::method)`    | Calls method on object that takes no arguments.
| `InvokeArgument<N>(args...)`                            | Invokes the N-th argument (must be callable) with given parameters.
| `IgnoreResult(a)`                                       | Executes `a` but ignores its return value.
| `DoAll(a1, a2, ..., an)`                                | Executes actions sequentially; returns result of last action.
| `WithArg<N>(a)`                                         | Executes action `a` with only the N-th argument of the mock function.
| `WithArgs<N1, ..., Nk>(a)`                              | Executes action `a` with selected args.
| `WithoutArgs(a)`                                        | Executes action `a` with no arguments.

### Defining Custom Actions

GoogleMock provides macros to define custom actions simplistically:

- `ACTION(name) { ... }` defines zero-parameter action.
- `ACTION_P(name, param) { ... }` defines action with one parameter.
- `ACTION_P2(name, p1, p2) { ... }` extends for multiple parameters.

Custom actions must have a call operator with signature compatible with the mocked function.

### Examples

```cpp
using ::testing::Return;
using ::testing::Invoke;
using ::testing::DoAll;
using ::testing::SetArgPointee;

class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (int x, int* out), (override));
};

MockFoo mock;

// Return 42 when Compute() is called.
EXPECT_CALL(mock, Compute).
    WillOnce(Return(42));

// Set *out to 5 and return true when called.
EXPECT_CALL(mock, Compute).
    WillOnce(DoAll(SetArgPointee<1>(5), Return(1)));

// Use a lambda as custom action.
EXPECT_CALL(mock, Compute).
    WillOnce(Invoke([](int x, int* out) {
      *out = x + 10;
      return x * 2;
    }));
```

---

## Extending Matchers and Actions

### Writing Custom Matchers

Use `MATCHER(name, description)` macros or implement a matcher class with:

- `MatchAndExplain()` method to determine match success.
- `DescribeTo()` and `DescribeNegationTo()` to generate user-friendly messages.

Example:

```cpp
MATCHER(IsEven, "is even number") {
  return (arg % 2) == 0;
}
```

### Writing Parameterized Matchers

Use `MATCHER_P(name, param, description)` to define matchers with parameters:

```cpp
MATCHER_P(InRange, range, "is within range") {
  return arg >= range.first && arg <= range.second;
}
```

### Writing Custom Actions

Create functor classes or lambdas with operator() compatible with the mock function signature. Use `MakePolymorphicAction()` to support multiple function signatures if needed.

---

## Practical Tips and Best Practices

- Use `_` wildcard sparingly; overuse can over-relax tests.
- Prefer expressive matchers to document expectations clearly.
- Use `ON_CALL` for setting default behavior without enforcing call counts.
- Use `EXPECT_CALL` when you intend to verify calls and their order.
- Combine multiple `WillOnce()` clauses for behaviors over multiple calls; use `WillRepeatedly()` for default fallback.
- Use `RetiresOnSaturation()` to disable sticky expectations once saturated.
- Use `NiceMock`, `NaggyMock`, or `StrictMock` to control treatment of uninteresting calls.

## Troubleshooting

- If you get warnings about uninteresting calls, consider adding `ON_CALL()` default actions or wrapping your mock with `NiceMock`.
- If expectations are not met, run tests with `--gmock_verbose=info` to trace calls and match attempts.
- When mocking overloaded methods, specify arguments or use `Const()` helper to disambiguate.

---

## Related Documentation

- [gMock Cookbook](../gmock_cook_book.md): Recipes for using GoogleMock.
- [Mocking Reference](reference/mocking.md): Detailed macro and expectation definitions.
- [Matchers Reference](reference/matchers.md): Complete list of matchers.
- [Actions Reference](reference/actions.md): Details on built-in actions.
- [gMock for Dummies](gmock_for_dummies.md): Beginner-friendly guide.
- [Setting Expectations and Sequencing](mocking-api/expectations-and-sequencing.md): Guide on call ordering and cardinalities.

## See Also

- `MOCK_METHOD` macro for defining mock methods.
- `EXPECT_CALL` and `ON_CALL` for setting expectations and default behaviors.
- `::testing::InSequence` for enforcing call order.

---

<Callout title="Tip" type="tip">
**Tip:** Start with `ON_CALL` for setting default behavior in test setup, and `EXPECT_CALL` only for those methods whose calls you want to verify explicitly.
</Callout>

<Callout title="Note" type="note">
**Note:** Matchers are pure functions and must not have side-effects as gMock may call them multiple times.
</Callout>

---

## Example Workflow

```cpp
#include <gmock/gmock.h>

using ::testing::Return;
using ::testing::_;

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
};

void TestAddition() {
  MockCalculator mock_calc;

  // Set default behavior for Add(a, b) to return a + b.
  ON_CALL(mock_calc, Add(_, _))
      .WillByDefault([](int a, int b) { return a + b; });

  // Expect Add(2, 3) exactly once and return 5.
  EXPECT_CALL(mock_calc, Add(2, 3))
      .Times(1)
      .WillOnce(Return(5));

  int result = mock_calc.Add(2, 3); // returns 5
  int other_result = mock_calc.Add(10, 20); // returns 30 due to default

  // Any calls other than Add(2, 3) are allowed.
}
```

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-spec-builders.h", "range": "20-250"}]} />
