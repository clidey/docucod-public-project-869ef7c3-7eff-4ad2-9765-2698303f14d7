---
title: "Mock Class Macros and Method Declarations"
description: "API for declaring mock classes and methods, focusing on MOCK_METHOD and related macros for various member function signatures and qualifiers. Includes usage differences between NiceMock, NaggyMock, and StrictMock, and tips for effective mock class design."
---

# Mock Class Macros and Method Declarations

This page documents the API for declaring mock classes and methods using GoogleMock's `MOCK_METHOD` macro and related constructs. It covers how to declare mock methods for various C++ member function signatures, qualifiers such as `const` and reference qualifiers, and call types (e.g., Windows calling conventions). It also explains usage differences between `NiceMock`, `NaggyMock`, and `StrictMock` wrappers, along with tips for designing effective mock classes.

---

## Overview of Mock Method Declarations

GoogleMock provides the `MOCK_METHOD` macro as the primary means to declare mock methods inside your mock classes. It generates mock method implementations that integrate seamlessly with the expectation and action APIs such as `EXPECT_CALL` and `ON_CALL`.

### Basic Syntax

```cpp
class MyMockClass {
 public:
  // ReturnType: return type of the method
  // MethodName: name of the method to mock
  // (Args...): parenthesized argument list
  MOCK_METHOD(ReturnType, MethodName, (Args...));
  
  // With qualifiers and specifiers
  MOCK_METHOD(ReturnType, MethodName, (Args...), (qualifiers));
};
```

- The first three parameters correspond to the method declaration split into:
  1. Return type (e.g., `int`, `void`, `std::string`).
  2. Method name.
  3. Argument list inside parentheses.
- The optional fourth parameter is a list of specifiers such as `const`, `override`, `noexcept`, `ref(&)` (reference qualifiers), and `Calltype(...)` (calling convention).

### Example

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

This declares mock methods matching the virtuals in the `Turtle` interface with proper overrides.

### Important Notes

- Your mock methods **must be declared in the `public:` section** regardless of access level of the base method.
- Parenthesize the argument list and the specifiers to ensure correct parsing, especially when the return type or arguments contain commas (e.g., `std::map<int, double>`).
- If the return type contains commas, wrap it in extra parentheses to avoid macro argument parsing issues. For example:

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

## Handling Various Member Function Signatures and Qualifiers

GoogleMock's `MOCK_METHOD` supports advanced C++ features in method declarations:

| Qualifier / Specifier  | Description |
|-----------------------|-------------|
| `const`               | Mock method will be marked `const`, overriding a `const` base method. |
| `override`            | Adds the `override` specifier to improve compiler checks. Recommended when overriding virtual methods. |
| `noexcept`            | Marks the method `noexcept`. Required when overriding a `noexcept` base method. |
| `ref(&)`              | Reference qualifier for lvalue qualified methods (e.g., `foo() &`). |
| `ref(&&)`             | Reference qualifier for rvalue qualified methods (e.g., `foo() &&`). |
| `Calltype(...)`       | Specifies calling convention (e.g., for Windows COM methods using `STDMETHODCALLTYPE`). |

### Reference Qualified Methods

To mock virtual methods that are qualified with reference qualifiers, include the `ref(...)` specifier:

```cpp
MOCK_METHOD(int, Func, (), (const, ref(&), override));
MOCK_METHOD(int, Func, (), (ref(&&), override));
```

These are necessary to properly match methods with such qualifiers in the base interface.

### Methods with noexcept

For overriding methods declared `noexcept`, add the `noexcept` qualifier in your mock declaration:

```cpp
MOCK_METHOD(void, Func, (), (noexcept, override));
```

Specifying the exact `noexcept` expression is supported as well.

### Methods with Calling Conventions (Windows)

If your target uses special calling conventions (like `STDMETHODCALLTYPE` on Windows), use the `Calltype(...)` modifier:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

This ensures the mock method uses the correct ABI.

### Overloaded Methods

Support for overloaded member functions is seamless. You simply declare each overload with the proper signature and qualifiers:

```cpp
MOCK_METHOD(int, Add, (int x), (override));
MOCK_METHOD(int, Add, (int times, int x), (override));
MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

If you do not mock every overload, the compiler may warn about hidden base class methods; use `using Base::Method;` to bring them into scope if needed.

### Legacy Macros

The old style `MOCK_METHODn` macros are still supported for compatibility, but the new `MOCK_METHOD` macro is recommended:

| Legacy Macro                   | Equivalent New Macro                                      |
|-------------------------------|----------------------------------------------------------|
| `MOCK_METHOD1(Foo, bool(int))`     | `MOCK_METHOD(bool, Foo, (int))`                              |
| `MOCK_CONST_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`                     |
| `MOCK_METHOD1_T(Foo, bool(int))`    | `MOCK_METHOD(bool, Foo, (int))`                              |
| `MOCK_CONST_METHOD1_T(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`                     |
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))` |
| `MOCK_CONST_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const, Calltype(STDMETHODCALLTYPE)))` |

---

## Using Mock Wrappers: NiceMock, NaggyMock, StrictMock

GoogleMock provides wrappers around mock classes to better control behavior on uninteresting mock method calls (calls without expectations declared):

| Type          | Behavior on Uninteresting Calls         | Use Case                                        |
|---------------|----------------------------------------|------------------------------------------------|
| `NaggyMock<T>` (default) | Generates warnings                  | Useful during development/debugging              |
| `NiceMock<T>`             | Suppresses warnings                 | Keeps test output clean when uninterested in calls |
| `StrictMock<T>`           | Treats uninteresting calls as errors | Ensures no unexpected calls slip through          |

### How to Use

Wrap your mock class type with the desired wrapper:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock_foo;
NaggyMock<MockFoo> naggy_mock_foo;
StrictMock<MockFoo> strict_mock_foo;
```

**Note:** They inherit from your mock class, so can be used anywhere your mock class can.

### Caveats

- These wrappers only affect mock methods defined directly within the mock class using `MOCK_METHOD`. If methods are defined in base classes, their behavior might not be affected consistently.
- StrictMock and NiceMock currently do not support nesting wrappers (e.g., `NiceMock<StrictMock<MockFoo>>` is not supported).
- Mock classes should have virtual destructors to ensure proper cleanup.

### Best Practices

- Use `NiceMock` to reduce noisy warnings during test runs when uninteresting calls are common and harmless.
- Use `StrictMock` to catch unexpected method calls and enforce correct test behavior.
- Use `NaggyMock` (the default) if you want warnings but not hard failures.

---

## Best Practices for Mock Class Design

- Define mocks **only for interfaces or classes you own.** Avoid mocking third-party or external library classes. If necessary, place your mocks close to the owner in the source tree for easier maintenance.
- Place mock class definitions in dedicated header/source files when sharing across multiple tests.
- When interfaces are non-virtual or concrete classes, prefer composition or adaptor patterns rather than mocking concrete classes directly.
- Use `MOCK_METHOD` in the mock class's public section for all mocked functions, regardless of their access level in the base class.
- Use `override` in the specifiers to catch mismatches at compile time.
- For complicated function signatures (e.g., with function pointers, template parameters, or commas), use parentheses or type aliases appropriately to ensure macro parsing correctness.
- For overloaded methods, mock all overloads if they are used or bring unmocked overloads into scope with `using`.
- Use wrappers like `NiceMock` or `StrictMock` judiciously to control mock behavior in tests and avoid brittle tests.

---

## Common Troubleshooting Tips

- **Compiler warnings about const qualifiers in parameters:** These warnings (especially on MSVC) often relate to const qualifiers on function parameters being ignored by the compiler in signature matching. Remove `const` from top-level parameters in both interface and mock declarations as a workaround.

- **Unrecognized commas in types in `MOCK_METHOD`:** Always wrap complex return types or argument types containing commas in extra parentheses or use type aliases.

- **Overloaded function ambiguity:** Always specify argument types in the `MOCK_METHOD` macro and disambiguate when calling `EXPECT_CALL` using cast or explicit matchers.

- **Unexpected uninteresting call warnings:** If you see warnings for calls you don't expect or haven't written expectations for, consider switching to `NiceMock` or explicitly allowing calls with `EXPECT_CALL(...).Times(AnyNumber())`.

- **Use `override` to detect signature mismatches early:** This practice significantly helps catch errors in method declaration alignment.

- **Memory or compilation overhead with large mocks:** Moving mock constructors and destructors definitions out of the header to `.cc` files can improve compile times.

- **Mock method qualifiers must match base methods:** If the base has `const`, `noexcept`, or reference qualifiers, include them accurately in the `MOCK_METHOD` macro specifiers to avoid linkage or runtime errors.

---

## Illustrative Example

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Using the mock:

#include <gtest/gtest.h>
using ::testing::Return;

TEST(TurtleTest, ForwardMovesCorrectly) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, Forward(100))
      .Times(1);

  turtle.Forward(100);
}
```

This example demonstrates creating a mock class for the `Turtle` interface with overridden methods using the recommended `MOCK_METHOD` syntax, including const correctness.

---

## Summary

- Use `MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers))` to declare mock methods.
- Properly handle return types with commas by using extra parentheses or type aliases.
- Include qualifiers (`const`, `override`, `noexcept`, `ref(&)`, `Calltype(...)`) as needed.
- Use `NiceMock`, `NaggyMock`, or `StrictMock` wrappers to adjust behaviors of mocks on uninteresting calls.
- Declare mock methods in the `public:` section even if base methods are protected or private.
- Follow best practices for placing mock class definitions and using overrides.
- Troubleshoot common issues related to const qualifiers, method overloading, and macro parsing by using proper specifiers and macro usage.

---

## See Also

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): A beginner-friendly introduction.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes covering mock class definitions and using mock methods.
- [Mocking Reference - MOCK_METHOD Macro](reference/mocking.md#MOCK_METHOD): Official macro reference.
- [Setting Expectations and Call Sequencing](api-reference/mocking-api/expectations-and-sequencing): For working with `EXPECT_CALL`.
- [Matchers and Actions](api-reference/mocking-api/matchers-actions): For argument expectations and mock method behaviors.

