---
title: "Actions Reference"
description: "Covers reusable action templates and user-defined actions for advanced mocking scenarios. Learn how to implement flexible mock responses, invoke callables, and pass custom parameters to mock method invocations."
---

# Actions Reference

This reference details the reusable action templates and user-defined actions in GoogleMock (gMock), enabling advanced mocking scenarios where you can customize mock method behavior extensively. Learn how to implement flexible mock responses, invoke callable arguments, and pass custom parameters to mock method invocations.

---

## Overview

In gMock, *actions* specify what a mock method should *do* when it is called. This can include returning a value, modifying arguments, invoking callbacks, chaining side effects, and more. Actions can be built-in, user-defined, or composed from other actions.

This page explains the key built-in actions you can leverage directly and shows how to define your own for custom behaviors.

---

## Built-in Action Templates

### Returning Values from Mock Methods

- `Return()`
  - Used with `void` mock functions to simply return.
- `Return(value)`
  - Returns a specified value. The value is copied (or converted) at the time the expectation is set, not when invoked.
- `ReturnArg<N>()`
  - Returns the N-th (zero-based) argument of the mock method.
- `ReturnNew<T>(a1, ..., ak)`
  - Creates and returns a new object of type `T` constructed with the provided parameters every time the action is performed.
- `ReturnNull()`
  - Returns a null pointer.
- `ReturnPointee(ptr)`
  - Returns the value pointed to by `ptr` at the moment the action is executed, useful to return live, changing values.
- `ReturnRef(variable)`
  - Returns a reference to the given variable.
- `ReturnRefOfCopy(value)`
  - Returns a reference to a copy of the given value that lives as long as the action itself.
- `ReturnRoundRobin({a1, ..., ak})`
  - On successive calls, returns each value in the provided list in turn, cycling back to the start.

### Modifying Arguments and Side Effects

- `Assign(&variable, value)`
  - Assigns a given `value` to the specified `variable`.
- `DeleteArg<N>()`
  - Deletes the pointer passed as the N-th argument to the mock method.
- `SaveArg<N>(pointer)`
  - Saves the N-th argument by copy to the pointed-to location.
- `SaveArgByMove<N>(pointer)`
  - Saves the N-th argument by move to the pointed-to location (useful with move-only types).
- `SaveArgPointee<N>(pointer)`
  - Saves the value pointed to by the N-th argument.
- `SetArgReferee<N>(value)`
  - Sets the value of the variable referred to by the N-th argument.
- `SetArgPointee<N>(value)`
  - Sets the value at the location pointed to by the N-th argument.
- `SetArrayArgument<N>(first, last)`
  - Copies elements from the range `[first, last)` into the array or iterator pointed to by the N-th argument.
- `SetErrnoAndReturn(error, value)`
  - Sets the `errno` global to `error` and returns `value` from the mock method.
- `Throw(exception)`
  - Throws the specified exception of any copyable type. Available since gMock v1.1.0.

### Using Callables and Lambdas as Actions

- `Invoke(f)`
  - Calls the callable `f` (function, lambda, functor) with the same arguments as the mock method received.
- `Invoke(object_pointer, &class::method)`
  - Calls a specific member method on an object using the mock method arguments.
- `InvokeWithoutArgs(f)`
  - Invokes a callable with no arguments, ignoring mock method arguments.
- `InvokeWithoutArgs(object_pointer, &class::method)`
  - Invokes a no-arg method on an object.
- `InvokeArgument<N>(args...)`
  - Invokes the N-th argument of the mock function, which must be a callable, with provided arguments `args...`. Wrap arguments with `std::ref()` when passing by reference.

### Composing and Controlling Actions

- `DoAll(a1, a2, ..., an)`
  - Performs all actions in sequence. Only the result of the last action is returned. All actions except the last must return void.
- `IgnoreResult(a)`
  - Runs the specified action and ignores its return value. Useful in contexts where a `void` return is required but the action returns a value.
- `WithArg<N>(a)`
  - Runs action `a` with only the N-th argument of the mock method.
- `WithArgs<N1, N2, ..., Nk>(a)`
  - Runs action `a` with a subset or reorder of the mock method's arguments.
- `WithoutArgs(a)`
  - Runs action `a` without passing any arguments.

---

## Defining Custom Actions

If the built-in actions don't meet your needs, you can define your own:

### Using Lambdas or Functors

- Any callable object can be used as an action if it matches the mock method signature.
- Example:

  ```cpp
  MockFunction<int(int)> mock;
  EXPECT_CALL(mock, Call)
      .WillOnce([](int input) { return input * 7; });
  EXPECT_EQ(mock.AsStdFunction()(2), 14);
  ```

- A callable that takes no arguments can be used even if the mock method has arguments.

### Using ACTION Macros

- `ACTION(name) { ... }`
  - Defines a new action named `name`.
  - Inside the body, use `arg0`, `arg1`, ... and `args` (tuple) to access arguments.
  - Returns a value matching the mock method's return type.

- `ACTION_P(name, param) { ... }`
  - Defines a parameterized action with one or more parameters.

- `ACTION_TEMPLATE(name, HAS_m_TEMPLATE_PARAMS(...), AND_n_VALUE_PARAMS(...)) { ... }`
  - Defines actions with explicit template parameters and values.

Example:

```cpp
ACTION_P(Add, n) { return arg0 + n; }
EXPECT_CALL(mock, Foo(_)).WillOnce(Add(5));
```

### Using `Invoke` for Custom Functions

- You can use existing functions, lambdas, or functors directly via `Invoke()`.

---

## Practical Tips & Best Practices

- Use `ReturnPointee()` to return values that may change during test execution from pointers.
- To invoke a callable argument passed to the mock, `InvokeArgument<N>(...)` is the easiest built-in solution.
- Chain multiple side effects and return values using `DoAll()`.
- Use `IgnoreResult()` to use actions that return values in contexts where void is required.
- Use `WithArg` and `WithArgs` to adapt arguments before passing to inner actions, avoiding cumbersome parameter lists.
- When defining your own action with `ACTION` macros, use the provided `argK` and `return_type` symbols for clarity and type safety.

---

## Common Usage Scenarios

### Deleting a Mock Argument

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DeleteArg<0>());
```

Deletes the pointer argument at index 0 when the mock method is called.

### Invoking a Callback Argument:

```cpp
EXPECT_CALL(mock, DoWork(_, _))
    .WillOnce(InvokeArgument<1>(5));  // Invokes second argument as callable with 5
```

### Saving an Argument for Later Verification:

```cpp
int saved_value;
EXPECT_CALL(mock, Foo(_))
    .WillOnce(SaveArg<0>(&saved_value));
// Later verify 'saved_value' as needed
```

### Combining Side Effects and Return Values:

```cpp
EXPECT_CALL(mock, Mutate(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

The first subaction updates the pointed-to argument, the last returns `true`.

---

## Troubleshooting

- If an action returns a value but the mock method returns void, consider wrapping the action in `IgnoreResult()`.
- When invoking callables with reference arguments, be sure to wrap arguments in `std::ref()` to pass by reference correctly.
- Beware the copy vs move semantics in actions for move-only types; lambdas or functors give better control.
- When chaining multiple `WillOnce()` actions, use `RetiresOnSaturation()` if you want them to be non-sticky.

---

For more on associated concepts and extended uses, see the related pages:
- [Using Mocks with GoogleMock](../guides/core-testing-workflows/using-mocks.md)
- [Mocking Methods and Expectations](../api-reference/mocking-api/mock-methods.md)
- [Actions in GoogleMock Cookbook](../../docs/gmock_cook_book.md#UsingActions)

<Callout>
  Note: All actions live in the `testing` namespace, so use `using ::testing::Return;` etc. to bring them into scope.
</Callout>

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-more-actions.h", "range": "1-298"}]} />
