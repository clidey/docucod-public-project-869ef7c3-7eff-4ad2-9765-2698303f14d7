---
title: "Matchers Reference"
description: "Exhaustive list of built-in and extensible matchers for argument matching, including equality, container, arithmetic, and custom matcher extension points. Provides usage examples and guidance for combining matchers in complex mocks."
---

# Matchers Reference

The `Matchers` Reference provides an exhaustive catalog of built-in and extensible argument matchers for GoogleMock. Matchers allow for expressive, precise, and flexible assertions about the arguments that mock methods are called with, enabling you to write readable, maintainable, and robust tests.

This page focuses on the argument matching facilitiesâ€”how to specify what kinds of arguments you expect a function to be called with, how to combine these specifications, and how to extend them with custom logic.

---

## 1. Introduction to Matchers

Matchers act as predicates that determine whether actual arguments meet expected conditions. They go beyond simple equality checks, supporting comparisons, container content verification, pointer analyses, regular expressions, and custom criteria.

Matchers are used in:

- `EXPECT_CALL(mock_object, MethodName(matchers...))` to specify expectations on mock method arguments.
- `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)` assertions to perform generalized checks.

Matchers provide detailed diagnostics when they fail, including human-readable explanations of mismatches.

---

## 2. Basic Matchers

### Wildcard
- **`_`** - Matches any argument of any type.

```cpp
EXPECT_CALL(mock, Foo(_));  // Accepts any argument.
```

### Equality
- **`Eq(value)`** - Matches arguments equal to `value` using `operator==`.
- You can use the simpler form where a literal or value is passed implicitly.

```cpp
EXPECT_CALL(mock, Foo(42));       // Same as Eq(42)
EXPECT_CALL(mock, Foo(Eq(42)));
```

### Inequality and Comparisons
- `Ne(value)` - Not equal to `value`.
- `Lt(value)` - Less than `value`.
- `Le(value)` - Less than or equal to `value`.
- `Gt(value)` - Greater than `value`.
- `Ge(value)` - Greater than or equal to `value`.

```cpp
EXPECT_CALL(mock, Foo(Ge(10)));  // Argument >= 10
```

---

## 3. String Matchers

Specialized matchers for strings and string-like types:

- **`StrEq(string)`** - Case-sensitive equality.
- **`StrNe(string)`** - Case-sensitive inequality.
- **`StrCaseEq(string)`** - Case-insensitive equality.
- **`StrCaseNe(string)`** - Case-insensitive inequality.
- **`HasSubstr(substring)`** - Contains substring.
- **`StartsWith(prefix)`** - Starts with prefix.
- **`EndsWith(suffix)`** - Ends with suffix.

```cpp
EXPECT_CALL(mock, Foo(StrCaseEq("hello")));
EXPECT_THAT(my_string, HasSubstr("world"));
```

They work with `const char*`, `std::string`, and string views.

---

## 4. Container Matchers

Matchers to verify STL-like container contents.

### Elements and Order
- **`ElementsAre(m1, m2, ...)`** - Matches containers with elements matching given matchers in exact order.
- **`ElementsAreArray(container_or_array)`** - Like `ElementsAre` but from a container or array.
- **`UnorderedElementsAre(m1, m2, ...)`** - Matches containers if elements satisfy matchers in any order.
- **`UnorderedElementsAreArray(container_or_array)`** - Like `UnorderedElementsAre` from a container or array.

Example:

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Ge(2), _)));
EXPECT_CALL(mock, Foo(UnorderedElementsAreArray({10, 20, 30})));
```

### Contains
- **`Contains(matcher)`** - Matches containers that contain at least one element matching `matcher`.
- Modifier `.Times(n)` allows specifying quantity of matching elements.

```cpp
EXPECT_THAT(vec, Contains(Ge(100)).Times(AtLeast(2)));
```

### Each
- **`Each(matcher)`** - Matches containers where all elements satisfy `matcher`.

### Size and Distance
- **`SizeIs(size_matcher)`** - Matches containers with a size matching `size_matcher`.
- **`BeginEndDistanceIs(distance_matcher)`** - Matches containers based on the distance between `begin()` and `end()` iterators.

Example:

```cpp
EXPECT_THAT(vec, SizeIs(Ge(3)));
```

---

## 5. Pointer and Smart Pointer Matchers

Matchers that work with raw and smart pointers.

- **`IsNull()`** - Matches null pointers.
- **`NotNull()`** - Matches non-null pointers.
- **`Pointee(matcher)`** - Matches a pointer whose pointed-to value matches `matcher`. Null pointers always fail.
- **`Pointer(matcher)`** - Matches a pointer that itself (the raw pointer value) matches `matcher`.
- **`WhenDynamicCastTo<T>(matcher)`** (requires RTTI) - Matches pointer or reference that matches the inner matcher after successful `dynamic_cast` to type `T`.

```cpp
EXPECT_CALL(mock, Foo(Pointee(Ge(10))));
EXPECT_THAT(ptr, IsNull());
```

---

## 6. Composite Matchers

Matchers can be combined to express complex expectations.

- **`AllOf(m1, m2, ...)`** - Matches when all matchers match.
- **`AnyOf(m1, m2, ...)`** - Matches when any matcher matches.
- **`Not(matcher)`** - Matches when the inner matcher does not match.
- **`Conditional(cond, matcher_true, matcher_false)`** - Matches using `matcher_true` if `cond` is true, otherwise `matcher_false`.

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(10), Le(20))));
EXPECT_THAT(value, Not(StartsWith("x")));
```

---

## 7. Tuple and Field Matchers

### Pair and Tuple Matchers

- **`Pair(m1, m2)`** - Matches an `std::pair` whose `first` matches `m1` and `second` matches `m2`.
- **`FieldsAre(m1, m2, ..., mn)`** - Matches aggregate types (tuples, structs, pairs, arrays) by matching each field against the respective matcher.
- Supports structured bindings and std::tuple-like objects.

```cpp
EXPECT_THAT(p, Pair(Ge(5), Eq("foo")));
EXPECT_THAT(my_tuple, FieldsAre(10, StartsWith("bar")));
```

### Field and Property Matchers

- **`Field(&Class::member, matcher)`** - Matches objects whose given member variable satisfies the matcher.
- **`Property(&Class::property_method, matcher)`** - Matches objects whose given const no-arg member function returns a value satisfying the matcher.

These also support optional name arguments for better error messages.

```cpp
EXPECT_CALL(mock, Foo(Field(&MyStruct::count, Ge(10))));
EXPECT_THAT(obj, Property(&MyClass::GetName, StartsWith("John")));
```

---

## 8. Specialized Matchers

### Regular Expression Matchers

- **`MatchesRegex(regex)`** - Matches strings fully matching the given regex.
- **`ContainsRegex(regex)`** - Matches strings containing a substring matching the regex.

The regex can be specified as a `const RE*` or a string.

### Base64 Unescape Matcher

- **`WhenBase64Unescaped(matcher)`** - Matches strings that, when base64 unescaped, match `matcher`.

Example:

```cpp
EXPECT_THAT(str, MatchesRegex("^Hello.*world$"));
EXPECT_THAT(encoded_str, WhenBase64Unescaped(StartsWith("Hello")));
```

### Numerical Precision Matchers

- **`FloatEq(value)`**, **`DoubleEq(value)`** - Match floating-point numbers approximately equal to `value` within ULPs.
- **`FloatNear(value, epsilon)`**, **`DoubleNear(value, epsilon)`** - Match floating-point numbers near `value` with given error bound.
- Nan sensitivity variants available.

---

## 9. Optional and Variant Matchers

- **`Optional(matcher)`** - Matches an engaged optional value whose contained value matches `matcher`.
- **`VariantWith<T>(matcher)`** - Matches a `std::variant` holding a value of type `T` satisfying `matcher`.
- **`AnyWith<T>(matcher)`** - Matches an `absl::any` or similar "any" type holding a value of type `T` satisfying `matcher`.

---

## 10. Utility Matchers

- **`A<T>()` / `An<T>()`** - Matches any value of the given type (alias for `_`).
- **`Ref(variable)`** - Matches arguments that are references to the given variable.
- **`Truly(predicate)`** - Turns an arbitrary predicate into a matcher.

---

## 11. Custom Matchers & Extensibility

GoogleMock makes it easy to create your own matchers:

- Use **`MATCHER(name, description_string)`** macro for simple custom matchers.
- Use **`MATCHER_P(name, param_name, description_string)`** and variants for parameterized custom matchers.
- For advanced needs, implement the matcher interface directly by defining `MatchAndExplain()`, `DescribeTo()`, and optionally `DescribeNegationTo()`.
- Use **`MakePolymorphicMatcher()`** to create polymorphic matchers usable with any compatible types.

Example custom matcher:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(mock, Foo(IsEven()));
EXPECT_THAT(value, IsEven());
```

---

## 12. Casting and Safety

- Use **`SafeMatcherCast<T>(m)`** to safely cast matcher `m` to type `Matcher<T>` with compile-time checks on type compatibility.
- Use **`MatcherCast<T>(m)`** for less strict casting (may be unsafe).

---

## 13. Advanced Composite Matchers

- **`AllOfArray()`**, **`AnyOfArray()`** - Accept arrays or container ranges of matchers.
- **`Pointwise(tuple_matcher, container)`** - Matches containers where each element matches the corresponding element in a container using a tuple matcher.
- **`UnorderedPointwise(tuple2_matcher, container)`** - Like `Pointwise` but without regard to order.

---

## 14. Common Usage Patterns and Examples

### Expecting Calls with Simple Argument Matchers

```cpp
EXPECT_CALL(mock, Foo(Ge(5)));  // Called with arg >= 5.
EXPECT_CALL(mock, Bar(_, StartsWith("Hello")));  // Second argument starts with "Hello".
```

### Matching Containers

```cpp
EXPECT_CALL(mock, ProcessData(ElementsAre(1, 2, 3)));
EXPECT_CALL(mock, ProcessData(UnorderedElementsAreArray(expected_values)));
```

### Matching Pointers and Values Pointed To

```cpp
EXPECT_CALL(mock, SetValue(Pointee(Ge(10))));  // Pointer points to value >= 10.
EXPECT_THAT(ptr, NotNull());
```

### Using Composite Matchers

```cpp
EXPECT_CALL(mock, Compute(AllOf(Ge(0), Le(100))));
EXPECT_THAT(value, Not(ContainsRegex("error")));
```

### Custom Matchers Example

```cpp
MATCHER_P(InRange, range, "") {
  return arg >= range.first && arg <= range.second;
}

EXPECT_CALL(mock, Foo(InRange(std::make_pair(10, 20))));
```

---

## 15. Troubleshooting & Tips

- **Matchers Must Be Pure:** Do NOT add side effects inside matchers. They may be invoked multiple times or out of order.
- **Avoid Ambiguous Matchers:** Use `SafeMatcherCast` and explicit type specifications when matching overloaded functions.
- **Use `_` When Arguments Do Not Matter:** To avoid over-specification and brittle tests, use wildcard matcher `_`.
- **Order of `EXPECT_CALL`s Matters:** Later declared expectations take precedence.
- **Use `InSequence` or `After` to Enforce Call Order:** For testing call sequences.

---

## 16. See Also

- [Mocking Reference](reference/mocking-api/mock-class-creation) - For setting expectations and mocking methods.
- [Actions Reference](reference/mocking-api/actions-and-cardinalities) - To control mock method behaviors.
- [Assertions Reference](reference/core-test-api/assertions-reference) - Using matchers inside assertions like `EXPECT_THAT()`.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Recipes for using matchers effectively.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) - Quick syntax reference.

---

## Code Snippet Reference Example

```cpp
using ::testing::_;
using ::testing::Ge;
using ::testing::Pointee;
using ::testing::ElementsAre;
using ::testing::NotNull;
using ::testing::StrCaseEq;

class MockFoo {
 public:
  MOCK_METHOD(void, SetValue, (int value), (override));
  MOCK_METHOD(void, ProcessData, (const std::vector<int>& data), (override));
  MOCK_METHOD(void, HandlePointer, (int* ptr), (override));
};

TEST(FooTest, ExampleMatchers) {
  MockFoo mock;

  EXPECT_CALL(mock, SetValue(Ge(10)));
  EXPECT_CALL(mock, ProcessData(ElementsAre(1, 2, 3, _)));
  EXPECT_CALL(mock, HandlePointer(Pointee(NotNull())));

  int val = 15;
  int* ptr = &val;

  mock.SetValue(15);
  mock.ProcessData({1, 2, 3, 5});
  mock.HandlePointer(ptr);
}
```

---

### Response Concludes
