---
title: "Actions & Cardinalities"
description: "Details actions that can be triggered by mocked methods, including default and custom actions, and cardinalities to enforce invocation count rules. Includes practical patterns for setting expectations and responses."
---

# Actions & Cardinalities

This page details the powerful ways you can control the behavior and expected usage of mocked methods in GoogleMock. It focuses on **actions** — the behaviors triggered when a mocked method is called — and **cardinalities**, which specify how many times methods should be invoked. Through intuitive syntax and flexible constructs, you can precisely model, verify, and customize interactions with your mocks to reflect real-world scenarios and rigorous testing goals.

---

## Understanding Actions and Cardinalities

When working with mocks, your primary goals often include:

- Setting **what** a method does when called (its *action*).
- Expressing **how many times** a method should be called (its *cardinality*).

GoogleMock provides a rich domain-specific language (DSL) to specify these seamlessly via `EXPECT_CALL()` and `ON_CALL()` macros.

---

## Actions: Defining What a Mocked Method Does

By default, GoogleMock uses built-in default actions:
- For `void` functions, it just returns.
- For `bool`, it returns `false`.
- For numeric types, it returns `0`.
- For pointers, it returns `nullptr`.
- For default-constructible types, it returns a default constructed value.

You can override these behaviors to simulate realistic scenarios, side effects, or return values that match your test’s needs.

### Specifying Actions

Actions are specified primarily through two constructs in expectations:

- `.WillOnce(action)`: Defines the behavior of the mock method for a *single* invocation.
- `.WillRepeatedly(action)`: Defines the behavior for *all subsequent* invocations after `.WillOnce()` actions are used up.

### Common Built-in Actions

| Action                      | Description                                                                                              |
|-----------------------------|----------------------------------------------------------------------------------------------------------|
| `Return(value)`             | Returns the given value. The value is converted to the mocked method’s return type when the expectation is set, not at runtime. |
| `ReturnRef(variable)`       | Returns a reference to the provided variable. Useful for methods returning references.                  |
| `ReturnPointee(ptr)`        | Returns the value pointed to by the pointer, evaluated at each call.                                    |
| `ReturnNew<T>(args...)`     | Returns a new dynamically allocated `T` created with the given arguments.
| `ReturnNull()`              | Returns a null pointer.
| `DoDefault()`               | Invokes the default action (from `ON_CALL()` or built-in) instead of an explicit action.
| `Assign(&var, value)`       | Assigns `value` to `var`.
| `SetArgPointee<N>(value)`   | Sets the `N`-th argument’s pointee (should be a pointer) to `value`.
| `DeleteArg<N>()`            | Deletes the `N`-th argument (which must be a pointer).
| `SaveArg<N>(pointer)`       | Saves a copy of the `N`-th argument to `*pointer`.
| `IgnoreResult(action)`      | Executes `action` but ignores its return value.
| `DoAll(action1, ..., actionN)` | Executes a sequence of actions in order. The result of the last action is the result of the entire composite action.

### Using Callables as Actions

You can provide any callable (functions, functors, lambdas) whose signature is compatible with the mocked method:

```cpp
EXPECT_CALL(mock_obj, Method(arg1))
    .WillOnce([](ArgType1 arg){ /* custom logic */ return result; });
```

This flexibility lets you integrate complex behaviors inline.

### Invoking Callable Arguments

If a mocked method receives callbacks or function objects as arguments, you can invoke them using `InvokeArgument<N>(args...)`:

```cpp
EXPECT_CALL(mock_obj, Method(_,_))
    .WillOnce(InvokeArgument<1>(callback_args...));
```

Use `std::ref()` for passing arguments by reference.

---

## Cardinalities: Controlling How Many Times Methods Are Called

Cardinalities define expectations on how often a mock method should be invoked.

You specify cardinalities through the `.Times()` clause in `EXPECT_CALL()`:

```cpp
EXPECT_CALL(mock_obj, Method(args)).Times(cardinality)
```

### Built-in Cardinalities

| Cardinality            | Meaning                                    |
|-------------------------|--------------------------------------------|
| `AnyNumber()`           | Method may be called zero or more times.  |
| `AtLeast(n)`            | Method must be called *at least* `n` times. |
| `AtMost(n)`             | Method must be called *at most* `n` times. |
| `Between(m, n)`         | Method must be called between `m` and `n` times, inclusive. |
| `Exactly(n)` or just `n`| Method must be called *exactly* `n` times. If `n` is `0`, the mock method must *never* be called. |

### Inferred Cardinalities

If you omit `.Times()`, GoogleMock infers cardinality based on actions:

- No `WillOnce()` or `WillRepeatedly()`: assumes exactly one call.
- n `WillOnce()`, no `WillRepeatedly()`: expects exactly n calls.
- n `WillOnce()` plus one `WillRepeatedly()`: expects *at least* n calls.

### Special Case: `.Times(0)`

Means the mock method **should never be called** with the specified arguments.
GoogleMock will fail the test if it is.

### Example: Detecting Unexpected Calls

```cpp
EXPECT_CALL(mock_obj, DoThis(_))
    .Times(0);  // Ensures method is never called.

mock_obj.DoThis(5);  // Test will fail here if called.
``` 

---

## Combining Actions and Cardinalities

The full power comes from chaining these clauses:

```cpp
EXPECT_CALL(mock_obj, Method(args))
    .Times(cardinality)
    .WillOnce(action1)
    .WillOnce(action2)
    .WillRepeatedly(default_action);
```

You control not only how many calls happen but how each call behaves.

### Sticky Expectations and Saturation

By default, expectations remain *active* even when their call limit is reached, resulting in errors if they're called too many times.

Using `.RetiresOnSaturation()` tells GoogleMock to deactivate an expectation as soon as it reaches its call limit, allowing other expectations to match subsequent calls:

```cpp
EXPECT_CALL(mock_obj, Foo(7))
    .Times(2)
    .RetiresOnSaturation();

EXPECT_CALL(mock_obj, Foo(_))
    .Times(AnyNumber());

mock_obj.Foo(7);  // Matches first expectation
mock_obj.Foo(7);  // Matches first expectation
mock_obj.Foo(7);  // Matches the fallback expectation
```

### Ordering Calls with `InSequence` and `After`

You can specify the order of expected calls:

- **`InSequence`**: all expectations declared within the scope of an `InSequence` object must occur in order.

```cpp
{
  InSequence seq;
  EXPECT_CALL(mock_obj, Start());
  EXPECT_CALL(mock_obj, Process());
  EXPECT_CALL(mock_obj, Finish());
}
```

- **`After(expectations...)`**: declares that an expectation can only occur after one or more other expectations.

```cpp
Expectation e1 = EXPECT_CALL(mock_obj, Init());
Expectation e2 = EXPECT_CALL(mock_obj, LoadData());
EXPECT_CALL(mock_obj, Run()).After(e1, e2);
```

### Sequences can model partial orderings and complex scenarios. See the [`InSequence` and `After` sections](#EXPECT_CALL.InSequence) for deeper detail.

---

## Practical Patterns and Best Practices

### Setting Default Behaviors vs Expectations

- Use `ON_CALL()` for default behavior without enforcing call counts.
- Use `EXPECT_CALL()` with `.Times()` to assert how many times a method must be called.

This separation keeps tests flexible and robust.

### Using Multiple Expectations

You can define multiple expectations on the same method with different argument matchers. GoogleMock matches calls against the *most recently declared* matching expectation first.

Example:

```cpp
EXPECT_CALL(turtle, Move(_));                   // #1
EXPECT_CALL(turtle, Move(10)).Times(2);         // #2
```

Calls to `Move(10)` will match #2 until it reaches its limit; other calls match #1.

### Avoid Over-Specification

Too strict expectations cause brittle tests. Be as specific as needed, no more.

### Handling Uninteresting Calls

If no `EXPECT_CALL` or `ON_CALL` exists for a method, calls to it are "uninteresting" and by default generate warnings but not test failures.

You can make mocks *nice* (suppress warnings) via `NiceMock<T>`, or *strict* (fail on uninteresting calls) via `StrictMock<T>`.

### Dealing with Move-Only Types

GoogleMock supports mocking methods accepting and returning move-only types (like `std::unique_ptr`) naturally through the usual syntax. Use `Return(ByMove(std::move(obj)))` to specify move-only return values.

---

## Complete `EXPECT_CALL` Syntax Overview

GoogleMock allows chaining clauses in a fixed order to comprehensively specify expectations:

```cpp
EXPECT_CALL(mock_obj, Method(args))
    .With(multi_argument_matcher)  // optional, once
    .Times(cardinality)            // optional, once
    .InSequence(sequences...)      // optional, any number
    .After(expectations...)        // optional, any number
    .WillOnce(action)              // optional, any number
    .WillRepeatedly(action)        // optional, once
    .RetiresOnSaturation();        // optional, once
```

Each serves a key purpose in describing your test's intent clearly.

---

## Code Examples

### Basic Usage of Actions and Cardinalities

```cpp
using ::testing::Return;
using ::testing::AtLeast;
using ::testing::_;

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(PaintTest, CallsPenDownAtLeastOnce) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(AtLeast(1));

  Painter painter(&turtle);
  painter.DrawCircle(0, 0, 10);
}

TEST(CoordinateTest, ReturnsSequenceOfXPositions) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, GetX())
      .WillOnce(Return(100))
      .WillOnce(Return(150))
      .WillRepeatedly(Return(200));

  EXPECT_EQ(100, turtle.GetX());
  EXPECT_EQ(150, turtle.GetX());
  EXPECT_EQ(200, turtle.GetX());
  EXPECT_EQ(200, turtle.GetX());
}
```

### Controlling Call Order with Sequences

```cpp
using ::testing::InSequence;

TEST(DrawingOrderTest, DrawsInOrder) {
  MockTurtle turtle;

  {
    InSequence seq;
    EXPECT_CALL(turtle, PenDown());
    EXPECT_CALL(turtle, Forward(100));
    EXPECT_CALL(turtle, PenUp());
  }

  Drawing drawing(&turtle);
  drawing.Draw();
}
```

### Using Multiple Actions

```cpp
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Return;

EXPECT_CALL(mock, Mutate(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

This example sets the value of the first argument’s pointee and returns `true`.

### Invoking Callback Argument

```cpp
using ::testing::InvokeArgument;

MOCK_METHOD(void, RegisterCallback, (std::function<void(int)> cb));

EXPECT_CALL(mock_obj, RegisterCallback(_))
    .WillOnce(InvokeArgument<0>(42));  // Calls the callback with 42
```

---

## Troubleshooting Common Issues

- **Unexpected calls**: Occur if a mock method is called without a matching expectation. Fix by adding an `EXPECT_CALL()` or relaxing the expectations.
- **Too many/few calls**: Cardinality mismatch failures will report actual vs expected counts.
- **Sticky expectations**: Use `.RetiresOnSaturation()` to prevent expectations from lingering after fulfilling their call count.
- **Uninteresting call warnings**: Suppress via `NiceMock<>` or explicitly expect with `.Times(AnyNumber())`.
- **Default action issues**: Use `ON_CALL()` to define default behavior; otherwise, a built-in default is used.
- **Move-only types**: Use `Return(ByMove(std::move(obj)))` and avoid returning temporary `std::unique_ptr` by value in repeated calls.

---

## Summary

By mastering actions and cardinalities, you gain granular control over mocked method behaviors and invocation rules to precisely reflect your testing requirements. Properly combining default actions, exact or fuzzy call count specifications, sequences, and custom actions ensures robust and readable tests that reliably verify complex interactions.

For a full spectrum of mock capabilities, complement this with documentation on [Matchers](../mocking-api/matchers-reference.md), [Mock Class Creation](../mocking-api/mock-class-creation.md), and [Writing Your First Mock](../../guides/getting-started/writing-your-first-mock.md).

---

## References

- [GoogleMock - gMock for Dummies](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md#actions-what-should-it-do)
- [Actions Reference](../reference/actions.md)
- [Mocking Reference](../reference/mocking.md#EXPECT_CALL)
- [Matchers Reference](../mocking-api/matchers-reference.md)
- [Mocking Techniques and Patterns Guide](../../guides/core-workflows/mocking-techniques-and-patterns.md)

---

For source code and examples, see the [GoogleTest GitHub repository](https://github.com/google/googletest).

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-more-actions.h", "range": "1-411"},{"path": "googlemock/src/gmock-spec-builders.cc", "range": "1-350"}]} />
