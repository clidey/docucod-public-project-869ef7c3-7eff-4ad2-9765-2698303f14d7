---
title: "Defining and Using Mock Classes"
description: "API documentation for the core GOOGLE_MOCK macros and templates that declare mock methods, including support for various C++ method qualifiers. Guides users in implementing mock interfaces for robust testing."
---

# Defining and Using Mock Classes

GoogleMock provides a robust, declarative syntax for defining mock classes in C++. This page documents the essential macros and templates, primarily the `MOCK_METHOD` macro and the related constructs, that allow you to declare mock methods, including support for method qualifiers such as `const`, `override`, `noexcept`, and calling conventions.

These features enable you to create mock interfaces for effective unit testing and integration testing, with full control over method behaviors, call expectations, and interactions.

---

## Overview

Mock classes in GoogleMock are ordinary C++ classes that mimic interfaces or concrete classes you want to test against. The key to defining mock classes is the `MOCK_METHOD` macro, which lets you declare mocked methods with signatures matching those in your production interfaces.

GoogleMock manages the lifecycle and expectations of your mocks, tracking calls, arguments, and ordering constraints via additional macros such as `EXPECT_CALL` and `ON_CALL`.

---

## Defining Mock Methods with `MOCK_METHOD`

The macro `MOCK_METHOD` is the primary building block to declare mocked methods inside your mock classes.

### Syntax

The typical syntax is:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers...));
```

- `ReturnType`: The return type of the method.
- `MethodName`: The name of the method to mock.
- `(Args...)`: The argument list, enclosed in parentheses. Take care to wrap argument types containing commas (e.g., STL templates) in extra parentheses.
- `(Qualifiers...)`: Optional list of qualifiers that apply to the mocked method (e.g., `const`, `override`, `noexcept`, calling conventions).

### Qualifiers Supported

You can specify the following qualifiers as a list in the fourth argument:

| Qualifier                | Description                                                        |
| ------------------------ | -----------------------------------------------------------------|
| `const`                  | Marks the mocked method as a `const` method.                      |
| `override`               | Marks the method with the C++11 `override` keyword. Recommended.  |
| `noexcept`               | Marks the method as `noexcept`. Required if overriding such a method. |
| `Calltype(<calling_conv>)` | Defines calling convention (for Windows: e.g., `STDMETHODCALLTYPE`). |
| `ref(&)` / `ref(&&)`     | Marks the method with a reference qualifier (lvalue or rvalue).  |

### Notes for Complex Argument Types

- If your return or argument types include commas (e.g., `std::pair<bool, int>`), wrap those types in parentheses to help the macro parse correctly.

```cpp
class MyMock {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
```

- Alternatively, you can use type aliases to simplify macro usage.

### Visibility

Place all `MOCK_METHOD` declarations in the `public:` section of your mock class, regardless of the original method's visibility. This enables external `ON_CALL` and `EXPECT_CALL` statements to work correctly.

### Overloaded Methods

Simply mock each overload by repeating `MOCK_METHOD` for each variant with correct signatures and qualifiers.

If you do not mock all overloads, you may need to bring unmocked overloads into scope with `using Base::MethodName;` to avoid hiding them.

### Mocking Templates

You can also mock class templates as usual by templating your mock class and mocking methods similarly.

### Mocking Non-Virtual Methods

GoogleMock supports mocking non-virtual methods for dependency injection where classes are unrelated. Mock methods must reproduce the exact signature but need no `override` qualifier.

### Mocking Free Functions and Static Methods

Direct mocking is not supported. Instead, wrap free or static functions behind an interface, then mock that interface.

---

## Using `EXPECT_CALL` and `ON_CALL` with Mock Methods

The macros `EXPECT_CALL` and `ON_CALL` link your mock methods with expectations and default behaviors.

- `ON_CALL` specifies what happens when a matching method call occurs, but does not enforce that the call must happen.
- `EXPECT_CALL` sets explicit expectations on the mock method, including call count, argument matchers, sequences, and actions.

Both macros accept argument matchers and support chaining clauses to refine expectations or default behaviors.

Examples:

```cpp
EXPECT_CALL(mock_object, MethodName(ArgMatcher1, ArgMatcher2))
    .Times(Exactly(2))
    .WillOnce(Return(value))
    .WillRepeatedly(DoSomething());

ON_CALL(mock_object, MethodName(_))
    .WillByDefault(Return(default_value));
```

---

## Mock Class Example

```cpp
#include <gmock/gmock.h>

// Interface to be mocked
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

// Mock class
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

Use this mock like so:

```cpp
TEST(DrawTest, UsesForwardCorrectly) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, Forward(100))
      .Times(1);

  // Call production code that uses turtle
  ... 
}
```

---

## Tips and Best Practices

- Always specify the `override` qualifier if you mock an overridden method to catch signature mismatches.
- To avoid warnings, be sure your mock's base class has a virtual destructor.
- Use `NiceMock<T>` to silently ignore uninteresting calls, or `StrictMock<T>` to treat those as failures.
- Avoid mixing `EXPECT_CALL` and mock method calls — set expectations before the code uses the mocks.
- Use `RetiresOnSaturation()` to allow expectations to retire after saturation, preventing sticky expectations.

---

## Common Pitfalls

- **Unprotected commas in types**: If your method uses templated argument or return types containing commas, wrap them in parentheses or use type aliases.
- **Method overload ambiguity**: If a method is overloaded, you must specify argument types to disambiguate in `EXPECT_CALL` or `ON_CALL`.
- **Mock object leak warnings**: Make sure each mock object is properly deleted to trigger verification, or call `Mock::VerifyAndClearExpectations()` manually.
- **Virtual destructors**: Lack of virtual destructor in base classes leads to undefined behavior when deleting mock objects.

---

## Advanced Usage

- GoogleMock supports mocking methods with reference qualifiers through the `ref(...)` qualifier.
- Supports calling conventions on Windows using `Calltype(...)` qualifier.
- You can delegate mock method calls to real or fake classes using `ON_CALL` in your mock constructor.
- `MockFunction<R(Args...)>` provides a quick way to mock arbitrary callable types.

---

## Summary

GoogleMock’s core macro for defining mock methods is `MOCK_METHOD`, supporting qualifiers such as `const`, `override`, and `noexcept`. All mock methods must be declared in the public section regardless of base class access. Use `EXPECT_CALL` to specify call expectations and `ON_CALL` to define default behavior. Proper use of these constructs allows highly expressive, maintainable, and safe mock classes for thorough C++ testing.

---

## References

- [`MOCK_METHOD` Macro](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#mock_method)
- [`EXPECT_CALL` and `ON_CALL` Macros](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#expect_call)
- [gMock for Dummies Guide](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Patterns and Mock Workflows Guide](https://google.github.io/googletest/guides/mocking-patterns/defining-using-mocks.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)

---

## Troubleshooting

- If your mock method fails to override a base method, check for method qualifiers mismatch.
- For problems with overloaded methods, specify exact argument types or use `Const()` wrapper for const overloads.
- If you encounter warnings about uninteresting calls, consider using `NiceMock` or adding catch-all `EXPECT_CALL` with `Times(AnyNumber())`.
- Use `Mock::AllowLeak()` to suppress leaked mock warnings if intentional.

---

With these capabilities and patterns, GoogleMock empowers you to write precise and maintainable mock classes crucial for robust C++ automated testing practices.