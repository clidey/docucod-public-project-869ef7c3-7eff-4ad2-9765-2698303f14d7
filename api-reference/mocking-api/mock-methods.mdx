---
title: "Mocking Methods and Classes"
description: "Explains how to declare and implement mock classes and methods using core GoogleMock macros, including support for C++ features like const correctness, overrides, and noexcept. Highlights best practices for mock class design."
---

# Mocking Methods and Classes

This document explains how to declare and implement mock classes and their methods using GoogleMock macros. It covers the usage of the core `MOCK_METHOD` macro, including how to handle C++ features such as const correctness, overrides, noexcept, calling conventions, and reference qualifiers. It also highlights best practices in mock class design, with examples demonstrating common scenarios.

---

## Overview

GoogleMock enables writing mock classes that simulate behavior of real classes for testing purposes. The cornerstone for mocking is the declaration of mock methods within mock classes using the `MOCK_METHOD` macro, which allows specification of the method signature and optional qualifiers matching the method being mocked.

By accurately defining mock methods, you can set expectations on how these methods will be called, customize their behavior, and verify interactions during tests.

---

## Defining Mock Methods with `MOCK_METHOD`

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Specs...));
```

- **ReturnType**: The return type of the mocked method.
- **MethodName**: The name of the method to mock.
- **ArgTypes...**: The types of the methodâ€™s parameters, enclosed in parentheses.
- **Specs...** *(optional)*: A comma-separated list of qualifiers such as `const`, `override`, `noexcept`, `Calltype(...)`, and `ref(...)` to match the method's declaration.

Example:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Foo, (int x, double y), (noexcept, override));
};
```

### Handling Commas in Types

Some complex types such as templates with multiple arguments contain commas which confuse the macro parser. To fix this:

- Wrap the entire type in an extra pair of parentheses, e.g.:
  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

- Or use type aliases:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### Important Notes

- Declare mock methods **public** in your mock class, even if the base class method is protected or private. This enables `ON_CALL` and `EXPECT_CALL` to work.
- The mock method signature must match the original method, including qualifiers like `const` and `override`.

---

## Qualifiers Supported by `MOCK_METHOD`

The following qualifiers can be applied in the optional `Specs...` parameter:

| Qualifier           | Description                                                         |
|---------------------|---------------------------------------------------------------------|
| `const`             | Marks the mock method as `const`. Required if mocking a `const` method. |
| `override`          | Marks the method with `override`. Recommended if overriding a virtual method. |
| `noexcept`          | Marks the method with `noexcept`. Required if overriding a `noexcept` method. |
| `Calltype(...)`     | Specifies the calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` on Windows. |
| `ref(&)` or `ref(&&)` | Specifies reference qualifiers, required if overriding methods with reference qualifiers. |

Example:

```cpp
MOCK_METHOD(bool, Process, (const Data& data), (const, override));
MOCK_METHOD(void, Foo, (), (noexcept, override));
MOCK_METHOD(int, Bar, (int), (Calltype(STDMETHODCALLTYPE)));
``` 

---

## Using `EXPECT_CALL` and `ON_CALL` with Mock Methods

Once mock methods are declared, you use:

- `EXPECT_CALL(mock_object, Method(arguments))` to set expected calls with behavior and cardinality.
- `ON_CALL(mock_object, Method(arguments))` to set default behaviors without imposing call expectations.

Example:

```cpp
MockFoo mock;
ON_CALL(mock, GetSize()).WillByDefault(Return(42));
EXPECT_CALL(mock, GetSize()).Times(2).WillRepeatedly(Return(17));

int size = mock.GetSize();  // returns 17
```

---

## Best Practices for Mock Class Design

- **Match original method signatures and qualifiers exactly** to ensure compatibility.
- Declare all mock methods in the `public` section.
- Avoid mocking non-virtual methods unless applying high-performance dependency injection techniques.
- Wrap complex return and argument types with parentheses or use type aliases.
- Use `override` and `noexcept` qualifiers where appropriate for clarity and correctness.
- For overloaded methods, mock each overload explicitly, using `Const()` to disambiguate const overloads if needed.

---

## Common Scenarios and Examples

### Mocking a Simple Virtual Class

```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetValue() const = 0;
  virtual void SetValue(int value) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int value), (override));
};
```

### Mocking an Overloaded Method

```cpp
class Bar {
 public:
  virtual ~Bar() {}
  virtual int Calculate(int a) = 0;
  virtual int Calculate(double a) = 0;
};

class MockBar : public Bar {
 public:
  MOCK_METHOD(int, Calculate, (int a), (override));
  MOCK_METHOD(int, Calculate, (double a), (override));
};

// Usage:
MockBar mock;
EXPECT_CALL(mock, Calculate(5));       // Calls int version
EXPECT_CALL(mock, Calculate(3.14));    // Calls double version
```

### Mocking Const Overloads

```cpp
class Baz {
 public:
  virtual int Foo() = 0;
  virtual int Foo() const = 0;
};

class MockBaz : public Baz {
 public:
  MOCK_METHOD(int, Foo, (), (override));
  MOCK_METHOD(int, Foo, (), (const, override));
};

// Disambiguation of const calls
const MockBaz const_mock;
EXPECT_CALL(Const(mock), Foo()).WillOnce(Return(1));
EXPECT_CALL(mock, Foo()).WillOnce(Return(2));
```

### Overriding Methods with Reference Qualifiers

```cpp
class Qux {
 public:
  virtual int Get() & = 0;
  virtual int Get() && = 0;
};

class MockQux : public Qux {
 public:
  MOCK_METHOD(int, Get, (), (ref(&), override));
  MOCK_METHOD(int, Get, (), (ref(&&), override));
};
```

---

## Handling Move-only Types

GoogleMock supports mocking methods accepting or returning move-only types (e.g., `std::unique_ptr<T>`). You can declare these mock methods as usual:

```cpp
MOCK_METHOD(std::unique_ptr<Foo>, CreateFoo, (), (override));
MOCK_METHOD(bool, ProcessFoo, (std::unique_ptr<Foo> foo), (override));
```

In tests, to return a move-only object repeatedly, use lambdas or functors:

```cpp
EXPECT_CALL(mock, CreateFoo())
    .WillRepeatedly([]() { return std::make_unique<Foo>(); });
```

Avoid `Return(std::move(...))` with `WillRepeatedly`, as the value will be moved from only once.

---

## Verifying and Cleaning Up Mocks

GoogleMock automatically verifies expectations on mock objects when their destructors run. You can also explicitly verify and clear expectations and default actions at any point using:

```cpp
bool success = ::testing::Mock::VerifyAndClearExpectations(&mock_object);
bool successAndCleared = ::testing::Mock::VerifyAndClear(&mock_object);
```

Use `Mock::AllowLeak(&mock_object);` to suppress verification and suppress leak errors when intentionally leaking mocks.

---

## Summary

This documentation page provides comprehensive guidance on defining and implementing mock classes and methods using GoogleMock's core facilities. Detailed explanations include:

- The syntax and usage of the `MOCK_METHOD` macro, including handling of C++ qualifiers and complex types.
- How to set expectations with `EXPECT_CALL` and default behaviors with `ON_CALL`.
- Best practices in mock class design and qualifiers use.
- Working with overloaded methods, const and ref-qualified methods.
- Support for move-only types in mocks.
- Verification and cleanup of mocks.

Users will find actionable examples and guidance for common usage scenarios, enabling robust test double creation and interaction verification.

---

## Additional Resources

- [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Mocking Reference](../api-reference/mocking-api/mock-methods)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Expectation Modifiers and Actions](../api-reference/mocking-api/expectations-actions)
- [Advanced Mocking Techniques](../guides/advanced-usage-and-integration/advanced-mocking)
- [Writing and Running Your First Test](../../getting-started/configuration-and-first-use/writing-first-test)

---

## See Also

- [`EXPECT_CALL` Reference](../api-reference/mocking-api/expectations-actions)
- [Matchers Guide](../api-reference/matchers-api/builtin-matchers)
- [Using Mock Objects in Tests](../guides/core-test-workflows/mocking-intro)
- [GoogleTest Core API](../api-reference/core-api/test-structure)

---

_This documentation focuses strictly on mocking method and class declaration with GoogleMock macros, supporting user scenarios for designing and using mocks effectively._