---
title: "Matchers Reference"
description: "Complete guide to matching input arguments and results using Google Mock’s matcher APIs. Includes built-in matchers, custom matchers, and matcher composition, supporting expressive, readable mock expectations."
---

# Matchers Reference

Complete guide to matching input arguments and results using Google Mock’s matcher APIs. Includes built-in matchers, custom matchers, and matcher composition, supporting expressive, readable mock expectations.

---

## Overview

Matchers are the core mechanism in Google Mock to verify that functions are called with expected arguments. This page provides a thorough reference on using Google Mock’s matcher APIs to specify constraints on arguments or values in assertions and mock expectations.

Matchers can be simple predicates or complex compositions, supporting both built-in and custom matchers. They enable writing readable and expressive tests that verify interactions precisely.

---

## Defining Custom Matchers with MATCHER Macros

Google Mock provides the `MATCHER` family of macros to quickly define custom matchers.

### Basic Syntax

```cpp
MATCHER(Name, "description") {
  return /* boolean expression on arg */;
}
```

- `Name` is the matcher name.
- Inside the body, `arg` is the input value being matched.
- The `description` documents what the matcher asserts. If empty, a default description is generated from the matcher name.

### Example

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
// Usage:
EXPECT_CALL(mock_obj, Bar(IsEven()));
EXPECT_THAT(value, IsEven());
```

If it fails, the message will say:

```
Value of: value
Expected: is even
  Actual: 7
```

### Parameterized Matchers

For matchers with parameters, use `MATCHER_P`, `MATCHER_P2`, ... up to `MATCHER_P10`.

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}
// Usage:
EXPECT_THAT(x, HasAbsoluteValue(10));
```

The description string can refer to parameters and the negation flag `negation`:

```cpp
MATCHER_P2(InClosedRange, low, high,
           std::string(negation ? "is not" : "is") + " in range [" +
           PrintToString(low) + ", " + PrintToString(high) + "]") {
  return low <= arg && arg <= high;
}
```

---

## Built-in Matchers

Google Mock includes a rich set of built-in matchers to match common properties of arguments.

### Wildcard Matchers

- `_` : Matches any value of any type.
- `A<T>()` or `An<T>()` : Matches any value of type `T`.

### Null-Related Matchers

- `IsNull()` : Matches any null pointer (raw or smart).
- `NotNull()` : Matches any non-null pointer.
- `Ref(variable)` : Matches arguments referring to the specific variable.

### Equality and Comparison

- `Eq(value)` : Matches values equal to `value`.
- `Ne(value)` : Matches values not equal to `value`.
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` : Numeric comparisons.

### Floating Point Approximate Equality

- `FloatEq(val)`, `DoubleEq(val)` : Approximate equality based on units in last place, excluding NaN.
- `NanSensitiveFloatEq(val)`, `NanSensitiveDoubleEq(val)` : Same but NaN equals NaN.
- `FloatNear(val, max_error)`, `DoubleNear(val, max_error)` : Approximate equality with max absolute error.

### Container Matchers

- `ElementsAre(...)` : Matches a container with elements matching the given matchers *in order*.
- `UnorderedElementsAre(...)` : Matches a container with elements matching the given matchers *in any order*.
- `ElementsAreArray(...)`, `UnorderedElementsAreArray(...)` : Like above but take a container or array of matchers/value.
- `Contains(matcher)` : Matches a container if at least one element matches `matcher`.
- `Each(matcher)` : Matches a container if *all* elements match `matcher`.
- `SizeIs(matcher)` : Matches a container whose size matches the given matcher.

### String Matchers

- `StrEq(string)`, `StrNe(string)` : Case-sensitive string equality and inequality.
- `StrCaseEq(string)`, `StrCaseNe(string)` : Case-insensitive string equality and inequality.
- `HasSubstr(substring)` : Matches strings containing the substring.
- `StartsWith(prefix)` : Matches strings starting with the prefix.
- `EndsWith(suffix)` : Matches strings ending with the suffix.
- `WhenBase64Unescaped(matcher)` : Matches base64-encoded string that matches after unescaping.

### Compound Matchers

- `AllOf(matcher1, matcher2, ...)` : Matches if *all* matchers match.
- `AnyOf(matcher1, matcher2, ...)` : Matches if *any* matcher matches.
- `Not(matcher)` : Matches if the matcher does not match.

### Tuple and Pair Matchers

- `Pair(m1, m2)` : Matches a `std::pair` where first matches `m1` and second matches `m2`.
- `Key(matcher)` : Matches an associative container element whose key matches `matcher`.
- `Field(&Class::member, matcher)` : Matches an object whose member matches `matcher`.
- `Property(&Class::method, matcher)` : Matches an object whose property (getter method) matches `matcher`.

### Pointer Matchers

- `Pointee(matcher)` : Matches a pointer pointing to a value that matches `matcher`.
- `Pointer(matcher)` : Matches a pointer that itself matches `matcher`.
- `Address(matcher)` : Matches an object whose address matches `matcher`.
- `WhenDynamicCastTo<T>(matcher)` : Matches a pointer/reference which matches after dynamic_cast to T.

### Optional and Variant Matchers

- `Optional(matcher)` : Matches a std::optional that is engaged and whose value matches `matcher`.
- `VariantWith<T>(matcher)` : Matches `std::variant` holding `T` and whose value matches `matcher`.
- `AnyWith<T>(matcher)` : Matches absl::any holding type `T` whose value matches `matcher`.

### Quantifier Matchers

- `Contains(matcher).Times(count_matcher)` : Matches containers with number of elements matching `matcher`.

### More Advanced Matchers

- `DistanceFrom(target, matcher)` : Matches values whose distance from `target` matches `matcher`.
- `ResultOf(callable, matcher)` : Matches objects for which callable(obj) matches `matcher`.
- `Args<N1, N2, ...>(matcher)` : Matches tuples of selected arguments.

---

## Using Matchers

Matchers form the basis for precise mock expectations and assertions.

```cpp
EXPECT_CALL(mock_obj, Func(Ge(5), StrCaseEq("hello")));
EXPECT_THAT(value, AllOf(HasSubstr("abc"), EndsWith("xyz")));
```

---

## Composing Matchers

Matchers can be composed logically using `AllOf()`, `AnyOf()`, and negated with `Not()`:

- `AllOf(m1, m2, ...)` matches if all matchers match.
- `AnyOf(m1, m2, ...)` matches if at least one matcher matches.
- `Not(m)` matches if `m` does not match.

These allow building complex predicates in a readable way.

---

## Practical Examples

1. Match an argument that is an even integer:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
EXPECT_CALL(mock, Func(IsEven()));
```

2. Check a string starts with "Hello" ignoring case:

```cpp
EXPECT_THAT(msg, StartsWith("Hello"));
```

3. Verify a container has exactly 3 elements 1, 2, and a value greater than 3:

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, 2, Gt(3))));
```

4. Check a pointer points to a non-null object whose `id` field is >= 10:

```cpp
EXPECT_CALL(mock, Func(Pointee(Field(&MyObj::id, Ge(10)))));
```

5. Match an optional holding a value greater than 0:

```cpp
EXPECT_THAT(opt_val, Optional(Gt(0)));
```

---

## Tips and Best Practices

- Use `_` to match any argument when the argument value is irrelevant.
- Use `Ref(variable)` to match arguments referring to a specific variable.
- Prefer built-in matchers whenever possible for clarity and better error messages.
- Compose matchers with `AllOf` and `AnyOf` for expressive conditions.
- Use `RetiresOnSaturation()` for expectations that should disable after hitting call limits.
- Use `SafeMatcherCast<T>(m)` to cast matchers when types differ but conversion is safe.
- Always write matchers without side effects; they can be called multiple times.

---

## Troubleshooting Matchers

- **Matcher doesn't compile:** Ensure your matcher is correctly specified and parameter types match expected usage.
- **Unexpected match failures:** Check that your matcher description aligns with the data and that correct types are matched.
- **Use `SafeMatcherCast` when matching across compatible types** to avoid compiler errors.
- **Remember `Pointee(m)` fails on null pointers**, so use `AllOf(NotNull(), Pointee(m))` if appropriate.

---

## Related Commands and Concepts

- `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` macros use matchers to verify values.
- Writing custom matchers with `MATCHER` macros allows precise predicate definitions.
- Use `Contains`, `Each`, `ElementsAre`, and related container matchers for STL container arguments.
- Use `With()` clause in `EXPECT_CALL` to apply a matcher on all arguments as a tuple.

For detailed usage and examples, see the [gMock Cookbook - Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#WritingNewMatchersQuickly).

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Matchers Reference in GoogleMock](reference/matchers.md)
- [Mocking with GoogleMock Guide](guides/core-testing-workflows/using-mocks.md)
- [Assertions Reference](reference/assertions.md)

---