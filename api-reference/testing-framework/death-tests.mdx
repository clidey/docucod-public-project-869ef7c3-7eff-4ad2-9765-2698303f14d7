---
title: "Death Tests"
description: "Reference for GoogleTest's death test functionality, enabling assertions that code terminates in a controlled fashion. Includes API documentation for defining, registering, and using death tests, with error handling and reporting details."
---

# Death Tests

GoogleTest provides a robust framework for writing assertions that verify if your code terminates as expected under error conditions or failures. These *death tests* run the specified code in a controlled environment and verify the manner in which the process terminates. This API reference page details how to define, register, and use death tests in GoogleTest, along with their error handling and reporting.

---

## Overview

Death tests verify that your code aborts, crashes, or exits in a controlled and expected manner. This is critical for testing assertions, error handlers, and other program invariants that must terminate the program when invalid conditions occur.

These tests spawn a separate process to run the code under test, isolate failure cases, and prevent crashes from terminating the entire test suite. GoogleTest supports different death test styles and provides predicates to match on exit codes or signals.

> **Important:** Typically, test suites containing death tests should be named with a `*DeathTest` suffix to ensure correct execution order and thread-safety semantics.


## Core Macros for Writing Death Tests

### ASSERT_DEATH(statement, matcher)
Asserts that the `statement` causes the process to terminate (crash, abort, or exit with a non-zero status) and whose stderr output matches the `matcher` (a regular expression or a GoogleTest matcher). If the assertion fails, the current test is aborted.

### EXPECT_DEATH(statement, matcher)
Like `ASSERT_DEATH`, but upon failure, the test continues with subsequent tests.

### ASSERT_EXIT(statement, predicate, matcher)
Asserts the `statement` causes the process to exit with a status satisfying the predicate (`ExitedWithCode`, `KilledBySignal`, or user-defined), and produces stderr output matching the `matcher`.

### EXPECT_EXIT(statement, predicate, matcher)
Similar to `ASSERT_EXIT` but continues on failure.

### ASSERT_DEATH_IF_SUPPORTED(statement, matcher) / EXPECT_DEATH_IF_SUPPORTED(statement, matcher)
These macros act like `ASSERT_DEATH`/`EXPECT_DEATH` if death tests are available, otherwise they issue a warning without failing.

### ASSERT_DEBUG_DEATH(statement, matcher) / EXPECT_DEBUG_DEATH(statement, matcher)
Verify death assertions only in Debug mode. In Release mode, `statement` is simply executed without assertion failures.

---

## Common Predicates

GoogleTest provides convenient predicate classes for use with `ASSERT_EXIT` and `EXPECT_EXIT`:

- `ExitedWithCode(int exit_code)`: Passes if the process exited normally with the specified exit code.
- `KilledBySignal(int signal_number)`: Passes if the process was killed by the specified signal (POSIX only).

---

## How Death Tests Work

When a death test macro is executed:

1. A warning is emitted if there is more than one active thread since forking with multiple threads is unsafe.
2. The parent forks (or clones on Linux) a child process.
3. Depending on the death test style (`threadsafe` or `fast`), the child either immediately executes the death test statement, or re-executes the test binary with flags to run only this death test.
4. The parent waits for the child to terminate.
5. The parent verifies that the child died as expected and that stderr output matches the matcher.

### Death Test Styles

- **fast:** The child runs the death test statement immediately after forking. This is faster but unsafe with threaded tests.

- **threadsafe:** The child re-executes the entire test binary but only runs the designated death test. This mode is slower but safe in multithreaded environments.

The style can be set programmatically via:
```cpp
GTEST_FLAG_SET(death_test_style, "threadsafe");
```

or via command-line flag `--gtest_death_test_style=`.

---

## Best Practices for Death Tests

- Name your **test suites** containing death tests with the suffix `DeathTest` to ensure they run before other tests.
- Place your death tests in a separate fixture or test suite if you mix death and non-death tests.
- Avoid creating or managing threads outside the death test statement, as multithreaded parent processes may cause death tests to fail or hang.
- Keep your death test statements simple and deterministic since they execute in a separate process.
- If your death test modifies any global or static state, it will not be reflected in the parent process since the test runs in a child.

---

## Using Death Tests

```cpp
// Example of a death test verifying that calling Foo(42) terminates with an error:
TEST(FooDeathTest, CrashesWithInvalidInput) {
  ASSERT_DEATH(Foo(42), "Invalid input");
}

// Example checking exit code and stderr output:
TEST(ExitTest, ExitsCleanly) {
  EXPECT_EXIT(NormalExitFunction(), testing::ExitedWithCode(0), "Success");
}

// Death test using a predicate for signal kill:
#if !defined(_WIN32)
TEST(SignalTest, KilledBySIGINT) {
  EXPECT_EXIT(SendSIGINT(), testing::KilledBySignal(SIGINT), "Interrupted");
}
#endif
```

---

## Assertions and Macros for Subtle Use Cases

- **EXPECT_DEATH** and **ASSERT_DEATH** may be combined with streaming additional failure messages.
- **EXPECT_DEBUG_DEATH** and **ASSERT_DEBUG_DEATH** allow death assertions only to run in debug builds.
- You cannot put multiple death test assertions on the same source line.
- Returning early from the death test statement or throwing exceptions inside it is considered a failure.

---

## Troubleshooting and Common Issues

- **Death tests may hang or behave unexpectedly if multiple threads are running in the parent process.** Try to isolate or reduce threads outside the `EXPECT_DEATH()` macro.
- **Mock objects and death tests:** Because death tests occur in separate processes, any mock expectations or calls in the death test must be inside the death test macro.
- **Race conditions or deadlocks:** Since death tests run in forked processes, any errno or state changes donâ€™t propagate back to the parent.

For more troubleshooting tips, consult the [Troubleshooting Common Issues guide](/getting-started/troubleshooting/common-issues).

---

## Related Utilities

GoogleTest provides supporting macros and utilities to detect and handle failures within tests themselves, capture error logs from death test processes, and enable advanced test event handling.

For example, GoogleTest provides `EXPECT_FATAL_FAILURE()` and `EXPECT_NONFATAL_FAILURE()` for verifying that portions of your test code produce the right kind of failures.

---

## Detailed API Reference

### ASSERT_DEATH
```cpp
#define ASSERT_DEATH(statement, matcher)
```
- **Parameters:**
  - `statement`: Any valid C++ statement or block that you expect to terminate.
  - `matcher`: A regex string or matcher that the `stderr` output must match.
- **Behavior:** Runs `statement` in a child process, asserts the process dies with `stderr` output matching `matcher`. Aborts the current test upon failure.

### EXPECT_DEATH
```cpp
#define EXPECT_DEATH(statement, matcher)
```
Same as `ASSERT_DEATH` but continues test execution on failure.

### ASSERT_EXIT
```cpp
#define ASSERT_EXIT(statement, predicate, matcher)
```
- `predicate` is a functor or function determining if exit code or signal is expected.

### EXPECT_EXIT
```cpp
#define EXPECT_EXIT(statement, predicate, matcher)
```
Continuing variant of `ASSERT_EXIT`.

### ExitedWithCode Class
```cpp
class ExitedWithCode {
 public:
  explicit ExitedWithCode(int exit_code);
  bool operator()(int exit_status) const;
};
```
Predicate to match normal process exit with exact code.

### KilledBySignal Class
```cpp
class KilledBySignal {
 public:
  explicit KilledBySignal(int signum);
  bool operator()(int exit_status) const;
};
```
Predicate to match process killed by specified signal (POSIX only).

---

## Additional Examples

```cpp
// Multiple death assertions in a loop
TEST(MyDeathTests, CheckAllCasesExit) {
  for (int i = 0; i < 3; ++i) {
    EXPECT_DEATH(CheckAndCrash(i), "Crash on invalid input") << "i=" << i;
  }
}

// Death test with compound statement
TEST(CompoundDeathTest, CrashesCorrectly) {
  ASSERT_DEATH({
    Setup();
    CrashNow();
  }, "Fatal error");
}

// Death test verifying exit code 0
TEST(ExitTest, ExitsWithoutError) {
  EXPECT_EXIT(CleanShutdown(), testing::ExitedWithCode(0), "Shutting down");
}

// Death test for signals
#ifndef _WIN32
TEST(SignalExitTest, KilledBySIGTERM) {
  EXPECT_EXIT(KillWithSIGTERM(), testing::KilledBySignal(SIGTERM), ".*");
}
#endif
```

---

## See Also

- [Assertions Reference](reference/assertions.md#death) - Details on death-related assertions
- [Advanced Topics: Death Tests](guides/practical-testing-patterns/death-tests.md) - Extended best practices and usage
- [FAQ: Death Tests](faq.md#my-death-test-hangs-or-segfaults-how-do-i-fix-it) - Common issues and resolutions

---

## Source Links

<Source url="https://github.com/google/googletest" paths={[{"path": "googletest/include/gtest/gtest-death-test.h", "range": "1-230"},{"path": "googletest/src/gtest-death-test.cc", "range": "1-480"}]} />

---