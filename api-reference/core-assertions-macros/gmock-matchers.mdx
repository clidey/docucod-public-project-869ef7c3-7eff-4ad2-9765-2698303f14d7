---
title: "Matchers in GoogleTest and GoogleMock"
description: "Documents the powerful matchers available for flexible value and type comparison, detail common built-ins, compositional techniques, and usage patterns, enabling expressive test expectations."
---

# Matchers in GoogleTest and GoogleMock

GoogleTest and GoogleMock equip you with a powerful, flexible system of **matchers** that make it easy to specify expected values and types in your tests. By harnessing matchers, you can precisely describe what arguments a mock method should receive, or directly verify values with expressive, readable assertions.

This page documents the array of built-in matchers, compositional techniques to combine and refine them, and practical usage patterns to leverage their expressiveness in your tests. Whether you need simple equality checks or complex multi-argument conditions, this guide will equip you with everything you need to craft robust and maintainable expectations.

---

## What Are Matchers?

A **matcher** represents a predicate on a single argument of a function call or a value, allowing you to verify it flexibly beyond simple equality. Matchers can be used:

- Inside `EXPECT_CALL` or `ON_CALL` to specify conditions on mock method parameters.
- Directly in assertions with `EXPECT_THAT` or `ASSERT_THAT` to validate values.

Matchers support direct value comparison, range checks, container content validation, polymorphic behaviors, and user-defined predicates, enabling succinct yet descriptive test statements.

---

## Basic Usage

Matchers come by default with a wildcard matcher `_` that accepts any argument, and various typed and comparison matchers:

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;
using ::testing::Le;
...

EXPECT_CALL(mock_obj, Func(Eq(5)));             // match argument exactly equal to 5
EXPECT_CALL(mock_obj, Func(Gt(10)));            // match argument greater than 10
EXPECT_CALL(mock_obj, Func(_));                  // accept any value

EXPECT_THAT(value, Lt(20));                      // directly verify value less than 20
EXPECT_THAT(value, Eq("abc"));                 // verify strings
```

Matchers are polymorphic and type-safe: they check argument types and convert when safe.

---

## Categories of Matchers

Matchers are grouped by purpose:

### Wildcard Matchers

| Matcher       | Description                         |
|---------------|-----------------------------------|
| `_`           | Matches any value of any type      |
| `A<T>()`/`An<T>()` | Matches any value of type `T`     |

### Generic Comparison Matchers

| Matcher        | Description                                     |
|----------------|------------------------------------------------|
| `Eq(val)`, `val` | Matches arguments equal to `val`               |
| `Ne(val)`      | Not equal to `val`                              |
| `Lt(val)`      | Less than `val`                                 |
| `Le(val)`      | Less than or equal                              |
| `Gt(val)`      | Greater than `val`                              |
| `Ge(val)`      | Greater than or equal                           |
| `IsTrue()`     | Evaluates as true                               |
| `IsFalse()`    | Evaluates as false                              |
| `DistanceFrom(target, m)` | Matches if distance from target matches matcher m |
| `DistanceFrom(target, get_distance, m)` | Same as above with custom distance functor     |

### Floating-Point Matchers

Specialized floating-point comparisons that handle NaNs and ULP-based equality.

| Matcher                       | Description                                |
|------------------------------|--------------------------------------------|
| `DoubleEq(d)`, `FloatEq(f)`  | Approximate equality with IEEE compliance  |
| `NanSensitiveDoubleEq(d)`, `NanSensitiveFloatEq(f)` | Includes NaN equality                       |
| `DoubleNear(d, eps)`, `FloatNear(f, eps)` | Approximate equality with custom epsilon   |
|

### String Matchers

Special matchers to compare string contents in various ways.

| Matcher          | Description                        |
|------------------|----------------------------------|
| `StrEq(s)`, `StrNe(s)` | Equality or inequality of strings    |
| `StrCaseEq(s)`, `StrCaseNe(s)` | Case-insensitive equivalence          |
| `HasSubstr(s)`    | String contains substring            |
| `StartsWith(prefix)` | String starts with prefix           |
| `EndsWith(suffix)`  | String ends with suffix             |
| `IsEmpty()`        | String is empty                    |
| `MatchesRegex(s)`  | String matches regex exactly       |
| `ContainsRegex(s)` | String contains regex              |
| `WhenBase64Unescaped(m)` | Base64 unescaped content matches m    |

### Container Matchers

Matchers for STL and STL-like containers.

| Matcher                | Description                              |
|------------------------|------------------------------------------|
| `Contains(e)`          | Container contains an element matching e |
| `Contains(e).Times(n)` | Contains exactly n elements matching e   |
| `Each(e)`              | All elements match e                     |
| `ElementsAre(e...)`    | Elements exactly match sequence e...    |
| `ElementsAreArray(...)`| Elements from a sequence or array match  |
| `IsEmpty()`            | Container empty                         |
| `IsSubsetOf(...)`      | Container is subset of expected elements |
| `IsSupersetOf(...)`    | Container is superset of expected elements |
| `Pointwise(m, container)` | Elementwise tuple matching with m        |
| `UnorderedElementsAre(e...)` | Container elements match in any order    |
| `UnorderedElementsAreArray(...)`| Similar to above with arrays/sequences |
| `UnorderedPointwise(m, container)` | Like Pointwise ignoring order          |
| `WhenSorted(m)`        | Container matches m when sorted (natural order) |
| `WhenSortedBy(cmp, m)` | Container sorted with comparator matches m |

### Member Matchers

Matchers that inspect members or properties inside objects.

| Matcher                                | Description                         |
|--------------------------------------|-----------------------------------|
| `Field(&class::member, m)`            | Matches member variable             |
| `Field(name, &class::member, m)`      | Same but provides better error messages |
| `Property(&class::getter, m)`         | Matches value returned by getter   |
| `Property(name, &class::getter, m)`   | Same but with better error messages |
| `Key(k)`                             | Matches the `first` element of a pair  |
| `Pair(m1, m2)`                      | Matches `std::pair` elements         |

### Pointer and Reference Matchers

| Matcher               | Description                               |
|-----------------------|-------------------------------------------|
| `IsNull()`            | Matches null pointers (raw and smart)     |
| `NotNull()`           | Matches non-null pointers                  |
| `Pointee(m)`          | Matches pointer's pointee value            |
| `Pointer(m)`          | Matches the contained pointer              |
| `Address(m)`          | Matches address of argument                |
| `Ref(var)`            | Matches argument referencing given var    |
| `WhenDynamicCastTo<T>(m)` | Matches result of dynamic_cast to T     |

### Exception Matchers

| Matcher                      | Description                           |
|-----------------------------|-------------------------------------|
| `Throws<E>()`               | Callable throws exception of type E  |
| `Throws<E>(m)`              | Callable throws E satisfying m        |
| `ThrowsMessage<E>(m)`       | Callable throws E with message matching m |

### Matchers for Multi-Arguments

You can also match multiple arguments as tuples.

| Matcher       | Description                                       |
|---------------|-------------------------------------------------|
| `Eq()`, `Ne()`, `Ge()`, `Gt()`, `Le()`, `Lt()` | Match tuple arguments by comparison operators. |
| `AllArgs(m)`  | Matches all arguments as a tuple                  |
| `Args<N1,N2,...>(m)` | Matches selected arguments by indices          |

### Composite Matchers

Build complex matchers by combining simpler ones:

| Matcher        | Description                          |
|----------------|------------------------------------|
| `AllOf(m1,...,mn)` | All sub-matchers must match        |
| `AnyOf(m1,...,mn)` | Any sub-matcher matches             |
| `Not(m)`       | Negates matcher                     |
| `Conditional(cond,m1,m2)` | Matches m1 if cond else m2          |
|
---

## Using Matchers Effectively: User Workflows

### Defining Expectations on Mock Methods

To specify that a mock method should be called with particular arguments, you use `EXPECT_CALL`.

```cpp
using ::testing::Eq;
using ::testing::_;

EXPECT_CALL(mock_obj, DoStuff(Eq(5), _));
```

This expects `DoStuff` to be called where the first argument is 5 and the second can be anything.

You can also combine matchers:

```cpp
EXPECT_CALL(mock_obj, ProcessData(AllOf(Gt(0), Le(10))));
```

This expects the argument to be between 1 and 10 inclusive.

### Verifying Values with Matchers

Matchers are also used with assertions to check concrete values:

```cpp
int value = GetValue();
EXPECT_THAT(value, Ge(5));  // Assert value >= 5
EXPECT_THAT(name, StartsWith("John"));
```

### Matching Containers with Detail

Checking the contents of containers is simple and expressive:

```cpp
std::vector<int> v{1, 3, 5};
EXPECT_THAT(v, ElementsAre(1, AnyOf(3, 4), 5));
EXPECT_THAT(v, Contains(5));
EXPECT_THAT(v, Each(Gt(0)));
```

For unordered matchers:

```cpp
EXPECT_THAT(v, UnorderedElementsAre(3, 1, 5));
```

### Combining Arguments in Multi-parameter Matchers

Sometimes constraints involve multiple arguments at once:

```cpp
EXPECT_CALL(mock, SetRange(_, _))
    .With(Lt())  // expects first arg < second arg
    .Times(1);
```

### Defining Custom Matchers

You can define your own custom matchers using `MATCHER` macros:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }

EXPECT_CALL(mock, DoSomething(IsEven()));
```

This matcher will accept any even number.

---

## Practical Tips and Best Practices

- **Use `ON_CALL` for default behaviors, `EXPECT_CALL` for verifying calls:**
  Speaking precisely avoids brittle tests that break due to implementation changes.

- **Prefer matchers over plain values for complex conditions:**
  Makes tests more readable and failures more descriptive.

- **Suppress uninteresting call warnings intentionally:**
  Use `NiceMock` for ignoring unexpected calls without failures.

- **Use `RetiresOnSaturation()` to manage overlapping expectations:**
  Prevent unexpected failures from multiple matching expectations.

- **Match pointers with `IsNull()`, `NotNull()`, or `Pointee(m)`:**
  Safely check against null or contents rather than pointer addresses.

- **Compose matchers to capture complex logic clearly:**
  Use `AllOf()`, `AnyOf()`, `Not()`, and `Args<>` for readability.

- **Match containers' orders carefully:**
  Use `ElementsAre` for ordered checks; `UnorderedElementsAre` to ignore order.

---

## Common Pitfalls and How to Avoid Them

- **Implicit conversions can lead to surprising matches:**
  Always prefer explicit matchers like `Eq()` instead of passing raw values to `EXPECT_THAT()`.

- **Matcher functions and predicates must be free of side effects:**
  Violations can cause flaky or incorrect test results.

- **Expectations on overloaded methods require disambiguation:**
  Use `TypedEq<T>()` and explicit cast of mock objects.

- **Uninitialized default actions may return default-constructed objects:**
  Define `ON_CALL` to specify default return values to avoid surprises.

- **Order-sensitive expectations should use `InSequence` or `After()`:**
  To avoid brittle tests due to call order assumptions.

---

## Examples

### Expecting Calls with Specific Arguments

```cpp
using ::testing::Eq;
using ::testing::_;  

class MockFoo {
 public:
  MOCK_METHOD(void, Bar, (int n), ());
};

MockFoo mock;
EXPECT_CALL(mock, Bar(Eq(42)));  // Expect Bar to be called with 42
mock.Bar(42);
```

---

### Using Composite Matchers

```cpp
EXPECT_CALL(mock, DoSomething(AllOf(Ge(0), Le(10)))); // arg between 0 and 10
```

### Matching Container Elements

```cpp
EXPECT_THAT(my_vector, ElementsAre(1, _, Gt(5)));
EXPECT_THAT(my_set, UnorderedElementsAre(3, 1, 2));
```

### Matching Multiple Arguments as a Whole

```cpp
EXPECT_CALL(mock, SetRange(_, _))
    .With(Lt())  // first arg < second arg
    .Times(1);
```

### Defining and Using a Custom Matcher

```cpp
MATCHER(IsOdd, "") { return arg % 2 == 1; }
EXPECT_CALL(mock, Foo(IsOdd()));
```

---

## Troubleshooting

### Unexpected Match Failures

- Verify you use the correct matcher type for the argument's type.
- Check whether matchers are composed correctly.
- Run tests with `--gmock_verbose=info` to see detailed matcher evaluation and stack traces.

### Uninteresting Call Warnings

- If you get warnings for calls not explicitly expected, consider if those calls should be ignored or verified.
- Use `NiceMock<>` wrapper to silence such warnings when appropriate.

### Overly Strict Tests Due to Ordering

- Use `InSequence()` or `.After()` judiciously to express call orders.
- Avoid making call order too strict if not necessary.

---

## Related Links

- [Mocking Reference](../reference/mocking.md)
- [Matchers Reference](./matchers.md)
- [EXPECT_THAT Assertion Reference](../reference/assertions.md#EXPECT_THAT)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Writing New Matchers](./gmock-matchers.h)

---

*This page is part of the API Reference under Core Assertions, Matchers, and Macros.*

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-912"},{"path": "docs/reference/matchers.md", "range": "1-303"},{"path": "docs/gmock_cook_book.md", "range": "245-1350"}]} />