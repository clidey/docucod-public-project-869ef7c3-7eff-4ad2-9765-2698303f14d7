---
title: "Mock Classes and Methods API"
description: "Reference for defining mocks with the MOCK_METHOD macros and supporting utilities. Details syntax, signature customization, and integration with test fixtures, guiding users through best practices for maintainable mock code."
---

# Mock Classes and Methods API

This reference guide details how to define mock classes and mock methods using the `MOCK_METHOD` macros, along with associated utilities and best practices to write maintainable, clear, and effective mock code in GoogleMock.

---

## Introduction

Mock objects enable you to simulate and control behavior of dependencies during testing. GoogleMock uses macros and a rich API to define mock classes that imitate interfaces or classes under test, allowing you to specify expected interactions, argument matching, call counts, and return behaviors.

The `MOCK_METHOD` family of macros is the primary way to declare mocked methods in your mock classes. This reference explains their syntax, customization options, integration in test fixtures, and complementary concepts for robust usage.

---

## Defining Mock Methods with `MOCK_METHOD`

`MOCK_METHOD` creates a mock method within a mock class, with syntax mirroring a method declaration.

### Basic Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- **ReturnType**: The type your mocked method returns.
- **MethodName**: Name of the method to mock.
- **Args...**: Parenthesized argument list, e.g., `(int x, const std::string& y)`.
- **Specs...**: Optional method qualifiers listed inside parentheses, separated by commas.

Example:

```cpp
class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, SetName, (const std::string& name), (override));
};
```

### Method Qualifiers

The optional 4th argument allows specifying one or multiple qualifiers to properly override base class methods:

| Qualifier              | Description                                  |
|------------------------|----------------------------------------------|
| `const`                | Makes the mock method a `const` method.      |
| `override`             | Marks the method `override` (recommended).  |
| `noexcept`             | Marks the method as `noexcept`.               |
| `Calltype(calltype)`   | Specifies calling convention (e.g., for Windows).
| `ref(&)` or `ref(&&)`  | Specifies reference qualifiers if needed.

You can combine multiple qualifiers:

```cpp
MOCK_METHOD(int, Foo, (int x), (const, noexcept, override));
```

### Handling Commas in Types

If your return type or argument types have commas (e.g., STL containers like `std::pair` or `std::map`), you must use either:

- **Parentheses wrapping:**
  ```cpp
  MOCK_METHOD((std::pair<int, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```
- **Type aliases:**
  ```cpp
  using IntPair = std::pair<int, int>;
  MOCK_METHOD(IntPair, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
  ```

### Access Section Requirement

Always place `MOCK_METHOD` declarations in the **public** section of your mock class, regardless of the base method's accessibility. This is required so `EXPECT_CALL` and `ON_CALL` can access them.

### Mocking Overloaded Methods

For overloaded methods, define mocked versions for each signature explicitly.

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (double x), (override));

  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

To avoid hiding base class overloads, use `using` declarations:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Bring other overloads into scope.
  MOCK_METHOD(int, Add, (int x), (override));
};
```

### Mocking Non-Virtual Methods

Although generally mock methods correspond to virtual base class methods, GoogleMock supports mocking non-virtual methods by defining a mock class unrelated to the real one but with identical method signatures (without `override`). Use templates or explicit polymorphism at compile time to switch between mock and real.

Example:

```cpp
class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

---

## Using Mock Classes in Tests

### Instantiation

Create mock objects as usual, e.g.: 

```cpp
MockFoo mock_foo;
```

or with constructor arguments:

```cpp
MockBar mock_bar("hello");
```

### Nice, Naggy, and Strict Mocks

GoogleMock offers predefined wrappers to control behavior on uninteresting calls (calls without expectations):

| Wrapper               | Behavior on Uninteresting Calls                  |
|-----------------------|-------------------------------------------------|
| `NiceMock<T>`         | Suppresses warnings (ignores uninteresting calls) |
| `NaggyMock<T>`        | Default, warns on uninteresting calls.           |
| `StrictMock<T>`       | Fails tests on uninteresting calls.              |

Example:

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> my_mock;
EXPECT_CALL(my_mock, DoSomething());

// Calls to other methods won't cause warnings.
```

These wrappers inherit all constructors of the mock class, so they accept the same constructor parameters.

### Setting Expectations with `EXPECT_CALL`

Set expectations on mock methods to specify which calls you expect, with what arguments, how many times, and what behavior:

```cpp
EXPECT_CALL(mock_foo, Bar(5))
    .Times(3)
    .WillOnce(Return('a'))
    .WillOnce(Return('b'))
    .WillRepeatedly(Return('c'));
```

See the [Expectations, Actions, Cardinalities, and Matchers Guide](../googletest-guides/advanced-mocking/expectations-actions-cardinalities-matchers) for full details.

---

## Best Practices

- Use `MOCK_METHOD` only in the `public` part of your mock class.
- For mocking methods with complex argument types containing commas, wrap them in parentheses or use type aliases.
- Prefer to mock interfaces or abstract base classes rather than concrete classes to keep tests decoupled and maintainable.
- Use `NiceMock` for most tests to reduce noise from uninteresting calls.
- Use `StrictMock` when you want to enforce strict interaction checking.
- When mocking overloaded methods, mock all relevant overloads and use `using` declarations to bring others into scope if needed.
- When mocking move-only types (e.g., `std::unique_ptr`), `MOCK_METHOD` supports them natively; prefer using lambdas in `WillOnce` or `WillRepeatedly` to generate fresh objects on each call.

---

## Common Patterns and Examples

### Basic Mock Method Definition

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual void SetName(const std::string& name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, SetName, (const std::string& name), (override));
};
```

### Mocking Overloaded Methods

```cpp
class Bar {
 public:
  virtual ~Bar();
  virtual int Convert(int n) = 0;
  virtual int Convert(double x) = 0;
};

class MockBar : public Bar {
 public:
  MOCK_METHOD(int, Convert, (int n), (override));
  MOCK_METHOD(int, Convert, (double x), (override));
};
```

### Using NiceMock to Silence Warnings

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, SetName("test"));
mock_foo.GetSize();  // No warning for uninteresting call
```

### Mocking Methods Using Move-Only Types

```cpp
class Buzz {
 public:
  explicit Buzz(int level);
};

class Buzzer {
 public:
  virtual ~Buzzer();
  virtual std::unique_ptr<Buzz> MakeBuzz(const std::string& text) = 0;
  virtual bool ShareBuzz(std::unique_ptr<Buzz> buzz) = 0;
};

class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (const std::string& text), (override));
  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz), (override));
};
```

Set expectations using lambdas to handle move-only semantics:

```cpp
EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
    .WillOnce([](const std::string&){
      return std::make_unique<Buzz>(1);
    });
```

---

## Integration with Test Fixtures

Mock classes integrate seamlessly with Googletest fixtures. Declare `Mock` objects as member variables, set expectations in `SetUp()`, and exercise code under test in your tests.

Example:

```cpp
class MyTest : public ::testing::Test {
 protected:
  MockFoo mock_foo;

  void SetUp() override {
    EXPECT_CALL(mock_foo, GetSize()).WillRepeatedly(Return(10));
  }
};

TEST_F(MyTest, TestSize) {
  EXPECT_EQ(mock_foo.GetSize(), 10);
}
```

---

## Troubleshooting and Common Pitfalls

- **Method calls invoke real implementations instead of mock:** Ensure methods are declared `virtual` in the base class.
- **Warnings about uninteresting calls:** Use `NiceMock` to silence or add `EXPECT_CALL(...).Times(AnyNumber())` for expected but unimportant calls.
- **Compilation errors with commas in types:** Use parentheses or type aliases as described.
- **Mock methods with const parameters causing MSVC warnings:** Remove top-level `const` qualifiers from parameters.
- **Ambiguous overloaded method calls:** Use full signatures in `MOCK_METHOD` and `Const()` wrapper for const overloads.
- **Mock object leaks (tests not verifying mocks):** Use scoped mocks or manually verify expectations using `Mock::VerifyAndClearExpectations()`.

---

## References and Related Documentation

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes and advanced usage.
- [Expectations, Actions, Cardinalities, and Matchers](../googletest-guides/advanced-mocking/expectations-actions-cardinalities-matchers) for detailed clauses of `EXPECT_CALL` and `ON_CALL`.
- [Mocking Policies and Behaviors: Nice, Naggy, and Strict](https://google.github.io/googletest/googletest/advanced-mocking/mocking-policies-and-behaviors.html) for behavior control.
- [Mocking Basics: Creating and Using Mocks](https://google.github.io/googletest/googletest/advanced-mocking/mocking-basics.html) for foundational concepts and workflows.

---

## Additional Tips

- Always place `MOCK_METHOD` in the public section.
- Mock destructors indirectly by adding a mock method (e.g., `Die()`) and calling it in the destructor.
- Use `EXPECT_CALL` before the mock method is invoked to avoid undefined behavior.
- When you want multiple expected calls in sequence, use `InSequence` or the `.After()` clause.
- Prefer lambdas or functors in `.WillOnce()`/.`WillRepeatedly()` when more customization is needed.
- For return by reference, use `ReturnRef()` instead of `Return()`.

---

## Example Snippet: Mock Class Definition

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetValue() const = 0;
  virtual void SetValue(int val) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int val), (override));
};
```

---

## Example Snippet: Using NiceMock

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, SetValue(42));

mock_foo.SetValue(42);  // No warning on uninteresting calls.
```

---

## Example Snippet: Mocking Overloads

```cpp
class MockBar {
 public:
  MOCK_METHOD(int, Foo, (int n), (override));
  MOCK_METHOD(int, Foo, (double x), (override));
};

MockBar mock;
EXPECT_CALL(mock, Foo(5));  // int overload
EXPECT_CALL(mock, Foo(3.14));  // double overload
```

---

## Summary

This page explains how to define mock classes and methods using the `MOCK_METHOD` macro, covering syntax, qualifiers, handling of complex types, integration with Googletest fixtures, and behavior wrappers like `NiceMock`. It includes practical examples, best practices, and troubleshooting advice for writing robust mocks in C++ tests using GoogleMock.

---