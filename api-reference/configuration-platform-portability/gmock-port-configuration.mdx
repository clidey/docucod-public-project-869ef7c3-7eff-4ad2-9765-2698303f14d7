---
title: "Portability Flags and Macros"
description: "Reference documentation for internal and public macros, compiler checks, and conditional logic that enable running tests across multiple platforms. Useful for integrators and build engineers customizing GoogleTest builds."
---

# Portability Flags and Macros

Reference documentation for internal and public macros, compiler checks, and conditional logic that enable running tests across multiple platforms. Useful for integrators and build engineers customizing GoogleTest builds.

---

## Overview

GoogleTest and GoogleMock support a wide range of platforms and compilers, enabling running tests and mocks consistently across diverse environments. This page documents the portability macros, flags, and conditional compilation logic primarily located in the internal headers `gtest-port.h` and `gmock-port.h`.

Integrators and build engineers customize or extend GoogleTest builds by understanding and utilizing these macros and flags properly. Many macros ending with underscores (`_`) and internal namespace symbols are for internal use only and can change without notice. Public macros without trailing underscores are safe for use outside GoogleMock.

---

## Environment and Platform Detection Macros

GoogleTest detects and encodes the build environment's capabilities and the target platform through macros. These macros allow for conditional compilation and platform-specific implementations.

### Key Platform Macros

- `GTEST_OS_*`: Defined as `1` if compiled on a specific platform. Examples include:
  - `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, `GTEST_OS_CYGWIN`, `GTEST_OS_FREEBSD`, `GTEST_OS_AIX`, etc.
  - Sub-platforms and variants: `GTEST_OS_WINDOWS_DESKTOP`, `GTEST_OS_WINDOWS_MINGW`, `GTEST_OS_LINUX_ANDROID`.

### Feature and Capability Macros

These macros indicate the availability of various platform features or compiler capabilities; defined as `1` if supported.

- `GTEST_HAS_PTHREAD` — POSIX threads support
- `GTEST_HAS_EXCEPTIONS` — whether C++ exceptions are enabled
- `GTEST_HAS_RTTI` — Run-time type information enabled
- `GTEST_HAS_STD_WSTRING` — `std::wstring` supported
- `GTEST_HAS_FILE_SYSTEM` — file system available
- `GTEST_HAS_CLONE` — availability of `clone()` system call
- `GTEST_HAS_DEATH_TEST` — death tests supported on the platform
- `GTEST_IS_THREADSAFE` — Google Test is thread-safe
- `GTEST_HAS_STREAM_REDIRECTION` — supports I/O stream redirection
- `GTEST_HAS_SEH` — Structured Exception Handling on Windows

> **Tip:** These macros are always defined to either 0 or 1 after `gtest-port.h` is included, ensuring code can directly use `#if GTEST_HAS_PTHREAD` without writing `#ifdef`.

---

## Compiler and Standard Language Level Checks

GoogleTest requires a minimum of C++17, verified at compile-time:

```cpp
#if !defined(GTEST_INTERNAL_CPLUSPLUS_LANG) || \
    GTEST_INTERNAL_CPLUSPLUS_LANG < 201703L
#error C++ versions less than C++17 are not supported.
#endif
```

It also uses `__has_include` and feature test macros when available to detect the presence of headers/features like `<version>`, `std::string_view`, `<string_view>`, `std::span`, and three-way comparison operator support.

---

## Synchronization & Threading Macros and Utilities

GoogleTest coordination across threads is controlled by these macros and utilities.

### Thread Safety Macro

- `GTEST_IS_THREADSAFE` is defined as `1` if the platform supports threading primitives such as pthreads or Windows threading. Otherwise, it is `0`.

### Mutex Implementation

- For thread-safe builds:
  - On Windows (Desktop, non-Phone), `Mutex` and `MutexLock` classes wrap Windows critical sections with lazy initialization.
  - On pthreads systems, `Mutex` wraps `pthread_mutex_t`.

- For non-thread-safe builds, dummy mutex classes are provided that no-op.

### ThreadLocal Storage

- Thread-local storage is implemented either on Windows or pthreads, providing `ThreadLocal<T>` template.
- It supports default initialization and per-thread value storage.

### Thread Creation Helpers

- `ThreadWithParam<T>` helps run user functions in threads for Google Test internal testing.

> **Note:** Thread synchronization and thread-local abstractions abstracts platform differences from test code.

---

## Compiler and Code Attributes

These use compiler feature detection to enable attributes:

- `GTEST_HAVE_ATTRIBUTE_` to check for attributes supported by GCC, Clang.
- `GTEST_NO_INLINE_` requests the compiler to disable function inlining.
- `GTEST_NO_TAIL_CALL_` requests disabling tail-call optimization.
- Sanitizer disabling attributes: `GTEST_ATTRIBUTE_NO_SANITIZE_ADDRESS_`, `GTEST_ATTRIBUTE_NO_SANITIZE_THREAD_`, and others.

---

## GoogleMock Portability and Flag Handling

These macros are defined primarily in `gmock-port.h` and enable GoogleMock's integration, flags support, and compiler version guards.

### Compiler Version Check

- Minimum supported version for MS Visual C++ is 2015 (version 1900). Older versions trigger a compile-time error.

### Flag Referencing Macros

- `GMOCK_FLAG_NAME_(name)` — internal macro to create the flag variable name.
- `GMOCK_FLAG(name)` — references the flag variable.

### Flag Definition and Declaration

Depending on availability of Abseil flags support (`GTEST_HAS_ABSL`):

- With Abseil:
  - Flags are defined using `ABSL_FLAG` macros:
    - `GMOCK_DEFINE_bool_`, `GMOCK_DEFINE_int32_`, `GMOCK_DEFINE_string_`
  - Flags declared with `ABSL_DECLARE_FLAG`.
  - Obtain and set flag values with `GMOCK_FLAG_GET(name)` and `GMOCK_FLAG_SET(name, value)` using Abseil APIs.

- Without Abseil:
  - Flags are declared/defined as `extern` or initialized `namespace testing` variables.
  - `GMOCK_FLAG_GET(name)` and `GMOCK_FLAG_SET` map directly to variable access and assignment.

This abstraction ensures consistent flag usage regardless of the underlying flag implementation.

---

## Usage Example: GoogleMock Flag Initialization

Initializing GoogleMock command-line flags with removal from the `argv` array:

```cpp
int argc = ...;
char** argv = ...;
testing::InitGoogleMock(&argc, argv);
// GoogleMock flags like --gmock_verbose are parsed and removed from argv
```

Flags are accessible in code as:

```cpp
bool catch_leaked = GMOCK_FLAG_GET(catch_leaked_mocks);
std::string verbose = GMOCK_FLAG_GET(verbose);
GMOCK_FLAG_SET(default_mock_behavior, 1);
```

---

## Practical Tips & Best Practices

- **Do not use internal macros directly:** Macros ending with underscores and internal namespace symbols can change without notice.
- **If customizing flags or platform support,** use the `custom/gmock-port.h` injection point for any user-defined overrides.
- **Check platform macros** when writing platform-specific code inside GoogleTest.
- **Use public macros without trailing underscores** for external code.
- **Always verify compiler versions** and threading support on your target build system.

---

## Common Pitfalls

- Using unsupported compiler versions may cause build failures.
- Misusing internal-only macros can break compatibility.
- Incorrect flag references if Abseil flags are enabled or disabled inconsistently.
- Thread-safety macros impact synchronization primitives - disabling them can degrade reliability.

---

## Source References

- [gmock-port.h](https://github.com/google/googletest/blob/main/googlemock/include/gmock/internal/gmock-port.h) — GoogleMock portability and flags header.
- [gtest-port.h](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h) — GoogleTest portability, platform, and synchronization utilities.
- [gtest-port-arch.h](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port-arch.h) — Platform detection macros.

---

## Summary

This page documents the portability flags, macros, and compiler feature checks pivotal for running GoogleTest and GoogleMock across diverse platforms and environments. It covers platform detection macros, threading and synchronization utilities, compiler attribute checks, and flag abstractions that unify these mechanisms. Integrators and build engineers customizing builds or targeting new platforms will find this reference essential for extending and maintaining GoogleTest's cross-platform robustness.

---

# Appendix: Selected Macro Reference

| Macro/Function                        | Description                                          |
|-------------------------------------|------------------------------------------------------|
| `GTEST_OS_WINDOWS`                  | Defined if building on Windows platform              |
| `GTEST_HAS_PTHREAD`                 | POSIX threads supported                               |
| `GTEST_HAS_EXCEPTIONS`              | C++ exceptions enabled                                |
| `GTEST_IS_THREADSAFE`               | GoogleTest is thread-safe                             |
| `GTEST_DEFINE_bool_`, `GTEST_DECLARE_bool_` | Macros for defining and declaring bool flags    |
| `GMOCK_DEFINE_bool_`, `GMOCK_DECLARE_bool_` | Macros for GoogleMock flag handling               |
| `GTEST_API_`                       | Attribute macro for symbol export                      |
| `GTEST_NO_INLINE_`                 | Prevent function inlining                              |
| `ThreadLocal<T>`                   | Thread-local storage template                          |
| `InitGoogleMock(int* argc, char** argv)` | Initializes GoogleMock and parses flags         |

---

<Info>
For detailed examples on how to initialize GoogleMock with flag parsing, see the tests in `gmock_test.cc`.
</Info>

---

## Troubleshooting

- **Build fails due to MSVC version:** Ensure you use Visual C++ 2015 or newer.
- **Flags not recognized or missing:** Verify whether Abseil flags are enabled (`GTEST_HAS_ABSL`). Adjust your build environment or flag use accordingly.
- **Threading issues:** Make sure threading support (`GTEST_HAS_PTHREAD`) is correctly detected or manually defined to avoid deadlocks.
- **Unexpected synchronization behavior:** Check your use of `Mutex`, `MutexLock`, and `ThreadLocal` and ensure they correspond to the platform-specific implementations.

If problems persist, consult the GoogleTest GitHub issues or community forums.

---