---
title: "Framework Initialization and Configuration"
description: "An overview of macros, imports, and configuration hooks necessary to initialize and tailor the test environment. Describes supported flags, environment variables, and integration points for enabling advanced scenarios and automation tooling."
---

# Framework Initialization and Configuration

An overview of macros, imports, and configuration hooks necessary to initialize and tailor the test environment. This page describes supported flags, environment variables, and integration points that enable advanced testing scenarios and automation tooling.

---

## Introduction

GoogleMock depends on GoogleTest to provide a robust testing foundation. To execute tests with GoogleMock, proper initialization and configuration are essential. This page walks you through the key components, macros, flags, and entry points required to bootstrap and customize your test environment effectively.

Whether you're integrating GoogleMock into your own test executable or using the provided main function, understanding these initialization steps ensures smooth test execution and precise control over mock behavior.

---

## Importing GoogleMock

Include the primary header to gain access to all GoogleMock features and essential GoogleTest components:

```cpp
#include "gmock/gmock.h"
```

This header aggregates core mocking APIs, matchers, actions, and internal utilities. It also declares important configuration flags exposed for user manipulation.

---

## Initialization APIs

Before running any tests, you must initialize GoogleMock to configure flags and the test environment. Initialization automatically cascades to GoogleTest, parsing command-line arguments and preparing the framework.

### `InitGoogleMock` Functions

GoogleMock provides three overloaded initialization routines:

- `void InitGoogleMock(int* argc, char** argv);`
- `void InitGoogleMock(int* argc, wchar_t** argv);` (Windows UNICODE support)
- `void InitGoogleMock();` (Embedded platforms like Arduino without argc/argv)

Example usage in a custom `main` function:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

The function parses and removes GoogleMock-specific flags from `argv`, updates internal flag states, and initializes GoogleTest in the same call.

### Automatic Initialization via Provided `main()`

GoogleMock ships with a default main function implementation (`gmock_main.cc`), designed for convenience in common use cases.

When you link against the `gmock_main` library, your program uses this main function without requiring you to write one:

```cpp
// Simplified main() from gmock_main.cc
int main(int argc, char** argv) {
  std::cout << "Running main() from gmock_main.cc\n";
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Embedded or Arduino-based environments use platform-specific entry points like `setup()` and `loop()` to hook in GoogleMock initialization and test runs.

---

## GoogleMock Configuration Flags

GoogleMock exposes several command-line flags and corresponding programmatic variables to control test behavior globally. These flags can be set on the command line or modified programmatically after initialization.

| Flag Name              | Type    | Description                                                                                                   | Default Value         | Valid Values                          |
|------------------------|---------|---------------------------------------------------------------------------------------------------------------|-----------------------|-------------------------------------|
| `--gmock_catch_leaked_mocks` | bool    | Whether GoogleMock should treat leaked mock objects as test failures.                                         | `true`                | `true` or `false`                   |
| `--gmock_verbose`       | string  | Controls the verbosity of GoogleMock's output messages.                                                      | `warning`              | `info`, `warning`, `error`          |
| `--gmock_default_mock_behavior` | int32_t | Sets the default strictness level of mocks created via `MOCK_METHOD`.                                         | `1` (NaggyMock)        | `0` (NiceMock), `1` (NaggyMock), `2` (StrictMock) |

### Setting Flags on the Command Line

When invoking tests, you can customize behavior with flags:

```bash
./my_tests --gmock_verbose=info --gmock_default_mock_behavior=2
```

Unrecognized flags are preserved and not consumed by GoogleMock.

### Accessing Flags Programmatically

Use the exposed macros to get or set flag values:

```cpp
bool leak_check = GMOCK_FLAG_GET(catch_leaked_mocks);
GMOCK_FLAG_SET(verbose, "info");
int mock_behavior = GMOCK_FLAG_GET(default_mock_behavior);
```

Flags are applied during `InitGoogleMock()` but can be updated dynamically if needed.

---

## How `InitGoogleMock` Processes Flags

Internally, `InitGoogleMock` performs the following steps:

1. Ensures GoogleTest is initialized too (calls `InitGoogleTest()` in an idempotent manner).
2. Scans the `argv` array for `--gmock_*` flags.
3. Parses recognized flags and updates the corresponding flag variables.
4. Removes the parsed flags from `argv` and decrements `argc` to prevent downstream confusion.

This sequence effectively isolates GoogleMock flags from other command-line options.

---

## Integration and Automation Hooks

Because test initialization and configuration are centralized in `InitGoogleMock`, it serves as the primary extension point for integrating GoogleMock into automated test pipelines:

- **Build Systems and CI:** Initialization ensures flags can be passed to tune verbosity, strictness, and leak detection per run.
- **Embedded Systems:** Specialized overloads allow initialization without command-line parameters.
- **Custom Mains:** Users may write their own `main` or platform-specific entry point, invoking `InitGoogleMock` to gain full configuration.

---

## Practical Usage Patterns

### Using `gmock_main` Library

Simply link your test executable against the `gmock_main` library to avoid writing your own main function:

```bash
g++ my_test.cc -lgmock_main -lgmock -lgtest -pthread
```

This setup runs all tests with default initialization.

### Writing a Custom Main

If you need additional setup or integration, write your own `main`:

```cpp
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  // Perform pre-test setup here
  int result = RUN_ALL_TESTS();
  // Perform post-test teardown here
  return result;
}
```

### Handling Embedded Platforms

Platforms without standard `argc` and `argv` (Arduino, ESP32) use the zero-argument overload:

```cpp
void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

---

## Tips and Best Practices

- **Always call `InitGoogleMock` before `RUN_ALL_TESTS()`.** Flags won’t be parsed or applied if initialization is skipped.
- **Use the default `main()` provided by `gmock_main` for simple scenarios to simplify your codebase.**
- **Pass only GoogleMock-specific flags via `--gmock_` prefix to avoid unintended conflicts.**
- **If using custom main, remember to forward wide or narrow command-line arguments on Windows.**
- **Adjust verbosity with `--gmock_verbose` to aid debugging during development.**
- **Set `--gmock_catch_leaked_mocks=false` temporarily if investigating complex lifetime issues with mocks.**

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Initialization Issues">
<Accordion title="GoogleMock flags not recognized or removed">
Ensure `InitGoogleMock(&argc, argv)` is called early in your test executable’s `main()`. If `InitGoogleTest` is called separately or by accident, GoogleMock may not parse flags properly.
</Accordion>
<Accordion title="Tests do not run on embedded platforms">
Verify you call the no-argument `InitGoogleMock()` variant inside your platform’s `setup()` function and call `RUN_ALL_TESTS()` inside `loop()` as shown in examples.
</Accordion>
<Accordion title="Linker errors related to main() function">
Link against `gmock_main` to use the bundled `main()`. When writing your own `main()`, ensure no conflicting entry points exist in linked libraries.
</Accordion>
</AccordionGroup>

---

## See Also

- [GoogleMock Main() Implementation](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc) — Default entry point source.
- [InitGoogleMock API Reference](https://google.github.io/googletest/reference/gmock.html#InitGoogleMock) — Initialization function details.
- [Running Tests in Embedded Environments](https://google.github.io/googletest/advanced.md#embedded-testing) — Guidance for platforms like Arduino.
- [Build Systems and Integration](https://github.com/google/googletest/blob/main/docs/guides/integration-advanced-optimization/build-systems-and-integration.mdx) — How to link and configure GoogleMock in your build.

---