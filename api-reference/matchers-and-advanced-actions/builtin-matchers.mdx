---
title: "Built-in Matchers"
description: "Documents the built-in matchers for value, container, and predicate matching within GoogleTest and GoogleMock. Includes usage patterns and guidance on combining matchers for fluent assertions."
---

# Built-in Matchers

This documentation details the comprehensive suite of built-in matchers offered by GoogleTest and GoogleMock. These matchers allow you to assert the properties of values, complex containers, pointers, and objects in a clear, expressive, and composable manner. They enable fluent assertions that are critical for precise and maintainable tests.

---

## Overview

Matchers in GoogleMock are predicates that test values against expectations in your tests. Built-in matchers cover everything from simple value equality to container element matching, string content checks, pointer validity, and even custom property and predicate validations.

Matchers are designed to be used primarily in `EXPECT_CALL()`, `ON_CALL()`, and GoogleTest's `EXPECT_THAT()` assertions, providing an expressive and flexible Domain-Specific Language (DSL) for specifying test expectations.

---

## Basic Matchers

### Wildcard Matcher: `_`

Matches any value of any type.

```cpp
EXPECT_CALL(foo, Bar(_));  // Accepts any argument
```

### Equality Matchers: `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`

Compare values using standard C++ operators:

```cpp
EXPECT_CALL(foo, DoSomething(Eq(42)));  // Matches exactly 42
EXPECT_CALL(foo, Process(Gt(10)));     // Matches values > 10
```

### Nullity Matchers: `IsNull()`, `NotNull()`

Match pointers that are nullptr or not.

```cpp
EXPECT_CALL(foo, SetData(IsNull()));    // Pointer must be nullptr
EXPECT_CALL(foo, SetData(NotNull()));   // Pointer must not be nullptr
```

### Floating Point Matchers

Use special matchers that compare floating types for approximate equality:

- `FloatEq()` / `DoubleEq()` for approximate equality.
- `NanSensitiveFloatEq()` / `NanSensitiveDoubleEq()` treat NaNs as equal.
- `FloatNear(epsilon)` / `DoubleNear(epsilon)` for approximate equality within an absolute error.

```cpp
EXPECT_THAT(value, DoubleEq(3.14159));
EXPECT_THAT(value, NanSensitiveDoubleEq(std::numeric_limits<double>::quiet_NaN()));
EXPECT_THAT(value, DoubleNear(100.0, 0.01));
```

---

## String Matchers

Matchers for common string operations, working with `std::string`, string literals, or `std::wstring`.

| Matcher      | Description                               |
|--------------|-------------------------------------------|
| `StrEq(s)`   | Matches strings exactly equal to `s`      |
| `StrNe(s)`   | Matches strings not equal to `s`           |
| `StrCaseEq(s)` | Case-insensitive equality comparison      |
| `StrCaseNe(s)` | Case-insensitive inequality comparison    |
| `HasSubstr(sub)` | Contains substring `sub`                   |
| `StartsWith(prefix)` | Starts with the specified prefix         |
| `EndsWith(suffix)` | Ends with the specified suffix             |

```cpp
EXPECT_CALL(foo, Print(StrEq("hello")));
EXPECT_THAT(message, HasSubstr("error"));
```

---

## Pointer and Object Matchers

### `Pointee(m)`

Matches a pointer whose pointee value matches matcher `m`. Supports raw and smart pointers.

```cpp
EXPECT_CALL(foo, Process(Pointee(Eq(42))));  // Pointer points to value 42
```

### `Pointer(m)`

Matches a pointer itself against matcher `m` (e.g., equal to some pointer value).

### `Ref(variable)`

Matches any argument that references a particular variable.

```cpp
int x = 5;
EXPECT_CALL(foo, Foo(Ref(x)));  // Matches argument referring to x
```

---

## Container Matchers

Matchers that allow precise control when testing container contents, sizes, and element properties.

### `ElementsAre(...)`

Matches if the container has the exact number of elements and each element matches the corresponding matcher/values in order.

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));  // Checks container contents exactly
```

### `UnorderedElementsAre(...)`

Matches if the container has exactly the specified elements, in any order.

```cpp
EXPECT_THAT(set, UnorderedElementsAre(3, 1, 2));
```

### `ElementsAreArray(...)`, `UnorderedElementsAreArray(...)`

Equivalent to `ElementsAre` and `UnorderedElementsAre`, but accepts arrays, initializer lists, or iterators.

### `Contains(matcher)`

Matches if the container contains at least one element matching the matcher.

```cpp
EXPECT_THAT(vec, Contains(Gt(5)));  // At least one element > 5
```

### `Each(matcher)`

Matches if every element in the container matches the matcher (empty containers always match).

### `SizeIs(matcher)`

Matches if the container’s `.size()` matches the matcher.

```cpp
EXPECT_THAT(vec, SizeIs(Ge(3)));  // Container has at least 3 elements
```

### `WhenSorted(matcher)`

Matches if the sorted container matches a matcher.

### `Key(matcher)`, `Pair(matcher1, matcher2)`

Matches map-like containers. `Key(m)` matches pairs whose key matches `m`. `Pair(m1, m2)` matches pairs where first and second element match `m1` and `m2` respectively.

---

## Tuple and Field Matchers

### `FieldsAre(...)`

Matches structs or tuples by matching each field with the corresponding matcher.

```cpp
struct Point { int x; int y; };
EXPECT_THAT(point, FieldsAre(Eq(1), Ge(0)));  // x == 1, y >= 0
```

### `Field(pointer_to_field, matcher)`

Matches an object by matching one of its fields.

### `Property(pointer_to_method, matcher)`

Matches an object by matching the return value of one of its const methods.

---

## Combining and Logical Matchers

### `AllOf(m1, m2, ...)`

Matches if all of the given matchers match.

### `AnyOf(m1, m2, ...)`

Matches if at least one matcher matches.

### `Not(m)`

Matches if the matcher does NOT match.

### `Conditional(condition, m1, m2)`

Matches `m1` if `condition` is true, else matches `m2`.

### `Truly(predicate)`

Wraps a unary predicate functor/function as a matcher.

---

## Special Matchers

### `SafeMatcherCast<T>(m)`

Casts matcher `m` to the type `Matcher<T>`, used to resolve type mismatches preserving type safety.

### `Args<N1, ..., Nk>(m)`

Matches the selected arguments in a tuple against a matcher.

### `ResultOf(callable, matcher)`

Matches if applying `callable` on the value matches `matcher`.

### `Throws<ExceptionType>(matcher)`

Matches if a callable throws an exception of the specified type matching `matcher`.

---

## Practical Tips and Best Practices

- Prefer specifying only as much detail as your test requires to prevent brittle tests.
- Chain matchers naturally in `EXPECT_CALL` or `EXPECT_THAT` to enhance readability.
- Use container matchers to validate collections precisely, including order or ignoring it.
- For pointer arguments, check both nullity and pointee value when appropriate.
- Use `With()` in `EXPECT_CALL` to match all arguments in a tuple if cross-argument validation is required.
- Use `SafeMatcherCast` to handle subtle type mismatches gracefully in matchers.

---

## Code Examples

```cpp
#include <gmock/gmock.h>
using ::testing::_;
using ::testing::Eq;
using ::testing::HasSubstr;
using ::testing::ElementsAre;
using ::testing::Gt;

class MockFoo {
 public:
  MOCK_METHOD(std::string, GetName, (), (const));
  MOCK_METHOD(void, SetNumbers, (const std::vector<int>&));
};

TEST(FooTest, BasicMatchers) {
  MockFoo mock;

  // Expect GetName to be called and return exactly "John".
  EXPECT_CALL(mock, GetName()).WillOnce(Eq("John"));

  // Expect SetNumbers to be called with a vector containing 1, 2, 3.
  EXPECT_CALL(mock, SetNumbers(ElementsAre(1, 2, 3)));

  EXPECT_EQ(mock.GetName(), "John");
  mock.SetNumbers({1, 2, 3});
}

TEST(FooTest, StringMatchers) {
  MockFoo mock;

  EXPECT_CALL(mock, GetName()).WillRepeatedly(HasSubstr("Doe"));

  std::string name = mock.GetName();
  EXPECT_THAT(name, HasSubstr("Doe"));
}

TEST(FooTest, PointerMatchers) {
  MockFoo mock;

  int value = 7;
  EXPECT_CALL(mock, SetNumbers(_));  // Focus on other logic

  // Example usage of Pointee matcher:
  int* ptr = &value;
  EXPECT_TRUE(::testing::Matches(Pointee(Eq(7)))(ptr));
}
```

---

## Troubleshooting

### Common Pitfalls

- **Unmatched calls**: Calls to mock methods not covered by any `EXPECT_CALL` result in errors. Use catch-all expectations or `ON_CALL` to handle uninteresting calls.
- **Over-specified expectations**: Specifying overly rigid matchers or call counts leads to brittle tests. Relax matchers or use cardinalities like `AnyNumber()`, `AtLeast(n)`.
- **Incorrect matcher chaining order**: `With()` must be the first clause in `EXPECT_CALL`. Placing it later results in failures.
- **Overlapping expectations**: Newer `EXPECT_CALL` statements override older ones for matching; order expectations carefully.
- **Ignoring arguments improperly**: Use `_` matcher or omit arguments for non-overloaded functions; for overloaded functions you must specify matchers clearly.

### Debugging Tips

- Use `--gmock_verbose=info` flag to see detailed logs about matcher and expectation matching.
- Use `EXPECT_CALL` with `.Description()` to provide readable names to expectations, helping trace failures.
- When runtime errors suggest side effects in matchers, ensure matchers are pure and side-effect free.

---

## Additional Resources

- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) – Full list and explanation of matchers.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) – Introductory guide to using GoogleMock.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) – Recipes and tips for advanced matcher and mock usage.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) – Details on mock class definitions and expectations.

---

## Summary

This page thoroughly documents the use of Google's built-in matchers for value, container, string, pointer, tuple, and composite matching. It guides users in expressing assertions fluently and efficiently with clear examples and practical advice on handling the diversity of types and scenarios found in C++ testing.


