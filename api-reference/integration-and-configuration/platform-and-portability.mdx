---
title: "Platform and Portability Configuration"
description: "Explores the APIs and macros for configuring and porting the frameworks across operating systems and compilers. Highlights platform detection utilities, porting macros, and defines that impact build/runtime behavior."
---

# Platform and Portability Configuration

Explore how GoogleTest ensures seamless portability and platform compatibility through its comprehensive APIs and macros. This page focuses on the tools provided for detecting platforms, configuring build and runtime behavior, and adapting GoogleTest's framework across different operating systems and compilers.

---

## Overview

GoogleTest is designed for wide portability across diverse platforms and environments. This flexibility is achieved via a set of carefully designed macros, platform detection utilities, and synchronization primitives that adapt the framework's internal behavior without exposing complicated platform-specific code to users.

This section details the key configuration APIs and macros that allow GoogleTest to detect the underlying OS and compiler environment, provide portable synchronization primitives, manage platform-specific features, and ensure consistent behavior across compilers and system architectures.


## Environment Detection Macros

GoogleTest defines a series of macros to represent the platform on which it is being compiled. These macros are automatically generated during compilation and help GoogleTest select the appropriate platform-specific implementations internally.

The macros indicate the operating system, threading support, availability of exception handling, runtime type information (RTTI), and filesystem presence, among others.

### Common Platform Macros

| Macro                         | Description                                                           |
|-------------------------------|-----------------------------------------------------------------------|
| `GTEST_OS_WINDOWS`             | Windows OS detected                                                    |
| `GTEST_OS_MAC`                 | Mac OS X detected                                                     |
| `GTEST_OS_LINUX`               | Linux OS detected                                                     |
| `GTEST_OS_IOS`                 | iOS platform on Apple devices                                         |
| `GTEST_OS_ANDROID`             | Android platform                                                     |
| `GTEST_OS_CYGWIN`              | Cygwin environment on Windows                                      |
| `GTEST_HAS_PTHREAD`            | POSIX pthreads support available                                    |
| `GTEST_HAS_EXCEPTIONS`         | C++ exceptions are enabled                                           |
| `GTEST_HAS_RTTI`               | Run-time type information (RTTI) is enabled                         |
| `GTEST_HAS_DEATH_TEST`         | Death test support available (requires file system and platform)    |

> GoogleTest provides default values if these macros are unspecified, but users can override them to tailor the framework to unique build environments.

## Platform-Independent APIs

GoogleTest offers several utility types and functions that abstract platform-specific details, enabling portable synchronization and thread management.

### Synchronization Primitives

- **Mutex**: A mutual exclusion primitive with the same interface across platforms. Designed to lock critical sections safely.
- **MutexLock**: RAII-style lock guard for a Mutex. Automatically releases the Mutex when it goes out of scope to prevent deadlocks.
- **ThreadLocal**: A thread-local storage (TLS) implementation allowing variables to have a unique instance per thread.

These primitives adapt to the compiler and OS:

- On POSIX platforms with pthreads, GoogleTest uses pthread mutexes and thread-local storage.
- On Windows, it uses native critical sections and Windows thread-local storage APIs.
- If thread safety is disabled or unsupported, dummy implementations are provided to ensure compilation without thread safety guarantees.

### Thread Counting

The utility function `GetThreadCount()` returns the number of active threads in the current process when supported by the platform; otherwise, it returns zero.

### Character and String Utilities

GoogleTest includes thin wrappers around standard C/C++ character classification functions (e.g., `IsAlpha()`, `IsDigit()`, `IsSpace()`), carefully casting to `unsigned char` to ensure correctness across compilers.

Additionally, conversions and validations for Unicode and UTF-8 are provided to assure text portability, especially when running on platforms with different wide-string encodings (UTF-16 vs UTF-32).

## Platform Detection and Configuration Macros

These macros govern how GoogleTest adapts its build and runtime behaviors:

- **`GTEST_HAS_STREAM_REDIRECTION`**: Indicates whether the platform supports stream redirection of stdout/stderr, vital for reliable output capturing especially for death tests.

- **`GTEST_IS_THREADSAFE`**: Marks whether thread-safe features are enabled, depending on compiler and platform support.

- **`GTEST_HAS_CLONE`**: True if the OS supports the Linux `clone()` system call, influencing process and thread creation.

Users building GoogleTest in unusual or constrained environments might need to define or override these macros manually to ensure correct behavior.

## Compiler and Linking Configuration

Though abstracted away from most users, GoogleTestâ€™s build configuration handles differences in compiler flags and linking for MSVC, Clang, GCC, and other compilers. Key features include:

- Override default runtime library selections, especially to avoid conflicting DLL vs static CRT settings on Windows.
- Adjust warning levels and disable specific warnings that can interfere with GoogleTest builds.
- Define macros like `GTEST_CREATE_SHARED_LIBRARY` and `GTEST_LINKED_AS_SHARED_LIBRARY` to build and link GoogleTest as a shared library when required.

Users employing CMake or Bazel for building will get this configuration automatically via packaged scripts. For manual builds, consult the build integration documentation to properly define macros and flags.

## Usage Patterns and Best Practices

### Ensuring Correct Build Environment

- Always verify that your compiler supports C++17, as it is a hard requirement for building GoogleTest.
- If using threading, ensure `GTEST_HAS_PTHREAD` or equivalent threading support is correctly set.
- When compiling as a shared library, define appropriate macros (`GTEST_CREATE_SHARED_LIBRARY` and `GTEST_LINKED_AS_SHARED_LIBRARY`) consistently between the library and its consumers.

### Handling Platform-Specific Test Behavior

- For platforms lacking full stream redirection support, features like output capturing and death tests may not work reliably.
- On Windows, avoid mixing static and dynamic runtimes to prevent runtime conflicts.

### Synchronization Usage

When writing custom test components or extending the framework, utilize the provided `Mutex`, `MutexLock`, and `ThreadLocal` types to ensure portable synchronization without platform checks.

### Managing Macro Conflicts

If your project defines conflicting macros, consider disabling GoogleTest macro definitions via `-DGTEST_DONT_DEFINE_TEST=1` and use the prefixed versions (e.g., `GTEST_TEST`) to avoid name collisions.

## Troubleshooting Platform Issues

- If your tests fail to capture stdout or stderr output, verify `GTEST_HAS_STREAM_REDIRECTION` macro and your platform capabilities.
- On compilation errors related to RTTI or exceptions, check `GTEST_HAS_RTTI` and `GTEST_HAS_EXCEPTIONS` macros; override them if your project disables those features.
- For thread-unsafety errors or unexpected behaviors on threading tests, confirm threading availability and that `GTEST_IS_THREADSAFE` evaluates correctly.

## Code Example: Using Portable Synchronization and ThreadLocal Storage

```cpp
#include <gtest/gtest.h>
#include <thread>
#include <vector>

// Shared counter protected by GoogleTest's Mutex.
class SafeCounter {
public:
  void Increment() {
    ::testing::internal::MutexLock lock(&mutex_);
    ++count_;
  }

  int Get() const { return count_; }

private:
  int count_ = 0;
  ::testing::internal::Mutex mutex_;
};

TEST(PlatformPortability, ThreadSafeCounting) {
  SafeCounter counter;
  std::vector<std::thread> threads;

  // Launch multiple threads incrementing counter.
  for (int i = 0; i < 10; ++i) {
    threads.emplace_back([&counter]() {
      for (int j = 0; j < 1000; ++j) {
        counter.Increment();
      }
    });
  }

  for (auto& t : threads) {
    t.join();
  }

  EXPECT_EQ(counter.Get(), 10000);
}
```

This example demonstrates portable synchronization primitives ensuring thread safety without requiring platform-specific code.

## Diagram: Interaction of Platform and Portability Components

```mermaid
flowchart TD
  subgraph Platform Detection
    GTEST_OS_WINDOWS["GTEST_OS_WINDOWS"]
    GTEST_OS_MAC["GTEST_OS_MAC"]
    GTEST_OS_LINUX["GTEST_OS_LINUX"]
  end
  subgraph Feature Flags
    GTEST_HAS_PTHREAD["GTEST_HAS_PTHREAD"]
    GTEST_HAS_EXCEPTIONS["GTEST_HAS_EXCEPTIONS"]
    GTEST_HAS_RTTI["GTEST_HAS_RTTI"]
    GTEST_HAS_STREAM_REDIRECTION["GTEST_HAS_STREAM_REDIRECTION"]
  end
  subgraph Synchronization Primitives
    Mutex["Mutex"]
    MutexLock["MutexLock"]
    ThreadLocal["ThreadLocal"]
  end

  Platform Detection --> Feature Flags
  Feature Flags --> Synchronization Primitives

  subgraph Build Configuration
    CompilerFlags["Compiler and Linker Flags"]
    SharedLibraryMacros["Shared Library Defines"]
  end

  Feature Flags --> Build Configuration
  Build Configuration -->|Defines| Synchronization Primitives

```

This diagram outlines how platform detection influences feature flags, which in turn shape the synchronization primitives and build configurations.

## Further Reading

- [Supported Platforms](../docs/platforms.md) â€” Details about officially supported operating systems and compilers.
- [Build System Integration](../api-reference/integration-and-configuration/build-integration.md) â€” How GoogleTest integrates with CMake and Bazel.
- [GoogleTest Primer](../docs/primer.md) â€” Learn about setting up tests and basic usage.
- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting-validation/common-setup-issues.md) â€” Solving platform-related build and runtime problems.


---

<Note>
Platform and Portability APIs are primarily for GoogleTest internal use but understanding them helps ensure smooth integration across diverse environments. Users typically interact via higher-level APIs, but this configuration layer guarantees that GoogleTest behaves predictably on supported platforms.
</Note>

<Callout>
**Tip:** If you are integrating GoogleTest into an uncommon environment, verify these macros' values and the availability of synchronization utilities to avoid subtle runtime issues.
</Callout>
