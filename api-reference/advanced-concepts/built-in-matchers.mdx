---
title: "Built-in and Custom Matchers"
description: "Documentation for using and composing built-in matchers, as well as creating user-defined matchers for expressive test expectations. Shows matcher chaining and parameterization."
---

# Built-in and Custom Matchers

This document explains how to use the built-in matchers provided by GoogleMock to write expressive and readable expectations, and how to create user-defined custom matchers for more tailored verification logic. You'll learn to compose matchers, chain them, parameterize them, and understand their descriptions and failure explanations.

---

## Understanding Matchers

### What Are Matchers?

Matchers are predicates that test whether a value meets a certain condition. They are used inside assertions like `EXPECT_THAT()` or mock method expectations in GoogleMock to verify argument values in a way that reads like plain English.

Matchers support:
- Matching values during test execution.
- Generating descriptive messages for failures.
- Explaining why a match succeeded or failed.

### Using Built-in Matchers

GoogleMock provides a rich set of built-in matchers for common situations:

- `_` (wildcard matcher) that matches any value.
- Comparisons: `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()` for relational operations.
- String matchers: `StrEq()`, `StrCaseEq()`, `HasSubstr()`, `StartsWith()`, `EndsWith()`, etc.
- Container matchers: `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, `Pointwise()`, etc.
- Pointer matchers: `IsNull()`, `NotNull()`, `Pointee()`, `Pointer()`, etc.
- Composite matchers: `AllOf()`, `AnyOf()`, `Not()`, `Conditional()`.
- Specialized: `SizeIs()`, `DistanceFrom()`, `Field()`, `Property()`, `ResultOf()`.

#### Example: Basic Matcher Usage
```cpp
using ::testing::Eq;
using ::testing::_;

EXPECT_CALL(mock_obj, SomeMethod(Eq(5), _));  // First argument must equal 5, second any value
```

#### Combining Matchers
Matchers can be combined to form logical expressions:
```cpp
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Ne;

EXPECT_CALL(mock_obj, SomeMethod(AllOf(Gt(5), Ne(10))));
// Matches values > 5 and != 10
```

### Multi-argument Matchers Using `.With()` Clause
When you want to express relationships among multiple arguments taken together, use the `.With()` clause combined with multi-argument matchers like `Lt()` for tuples:

```cpp
EXPECT_CALL(my_mock, SetPosition(_, _))
    .With(Lt());  // First argument less than the second
```

### Matcher Polymorphism and Casting
Matchers are polymorphic and adapt to the type of the value they are matching. You can use `SafeMatcherCast<T>(m)` to safely cast a matcher to match a value of type `T` while ensuring type correctness.

---

## Defining Custom Matchers

If built-in matchers are insufficient, you can define custom matchers to express complex or domain-specific verification logic.

### Using `MATCHER` Macros
GoogleMock provides a family of macros to define custom matchers quickly.

#### Syntax:
```cpp
MATCHER(Name, description_string) { /* statements */ }
MATCHER_P(Name, param, description_string) { /* statements using 'param' */ }
// Likewise for MATCHER_P2...MATCHER_P10
```

The macro defines a matcher named `Name` that returns `true` when the match succeeds and `false` otherwise. Inside the body, `arg` refers to the matched value, and `result_listener` allows streaming explanation strings.

#### Basic Example
```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(mock_obj, Foo(IsEven()));
EXPECT_THAT(value, IsEven());
```

If the match fails, the failure message will read like:
```
Value of: value
Expected: is even
  Actual: 3
```

#### Parameterized Matcher Example
```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return std::abs(arg) == value;
}

EXPECT_THAT(x, HasAbsoluteValue(10));
```

This message will display the parameter value for clarity:
```
Value of: x
Expected: has absolute value 10
  Actual: -9
```

### Description Strings

You can customize the description printed on match failures by providing a string expression that may reference parameters and the special `negation` boolean variable.

For example:
```cpp
MATCHER_P(InRange, low, hi,
          std::string(negation ? "isn't" : "is") +
          " in range [" + std::to_string(low) + ", " + std::to_string(hi) + "]") {
  return low <= arg && arg <= hi;
}
```

### Advanced Custom Matchers

If the `MATCHER` macros are too limiting, you may define full matcher classes implementing the matcher interface and provide detailed descriptions and match result explanations.

Example:
```cpp
class EvenMatcher {
 public:
  using is_gtest_matcher = void;

  template <typename T>
  bool MatchAndExplain(const T& value, std::ostream* os) const {
    const bool result = (value % 2) == 0;
    if (!result && os) {
      *os << "which is odd";
    }
    return result;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is an even number";
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is an odd number";
  }
};

::testing::Matcher<int> IsEven() {
  return EvenMatcher();
}
```

---

## Commonly Used Built-in Matchers

| Matcher               | Description                                                 |
|-----------------------|-------------------------------------------------------------|
| `_`                   | Matches any value (wildcard)                                |
| `Eq(value)`            | Equal to value using `operator==`                           |
| `Ne(value)`            | Not equal to value                                          |
| `Lt(value)`            | Less than value                                            |
| `Le(value)`            | Less than or equal to value                                 |
| `Gt(value)`            | Greater than value                                         |
| `Ge(value)`            | Greater than or equal to value                              |
| `StrEq(str)`           | String equals (case-sensitive)                             |
| `StrCaseEq(str)`       | String equals ignoring case                                |
| `HasSubstr(sub)`       | String contains substring                                  |
| `StartsWith(prefix)`   | String starts with prefix                                   |
| `EndsWith(suffix)`     | String ends with suffix                                    |
| `Contains(matcher)`    | Container contains an element matching `matcher`           |
| `Each(matcher)`        | All elements in a container match `matcher`                 |
| `ElementsAre(...)`     | Container elements match the matchers in order              |
| `UnorderedElementsAre(...)` | Container elements match matchers in any order          |
| `Pointee(matcher)`     | Pointer points to a value matching `matcher`                 |
| `Not(matcher)`         | Logical negation of `matcher`                                |
| `AllOf(m1, m2, ...)`  | Matches all submatchers                                      |
| `AnyOf(m1, m2, ...)`  | Matches any submatcher                                       |
| `Field(&Class::field, matcher)`   | Matches an object's field                                  |
| `Property(&Class::method, matcher)` | Matches an object's property getter                         |
| `ResultOf(callable, matcher)` | Matches when the callable applied to value matches matcher|

---

## Example: Combining Matchers and Using Predicates

```cpp
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Not;
using ::testing::HasSubstr;

EXPECT_CALL(mock_object, Method(
    AllOf(Gt(10), Not(HasSubstr("bad")))));
```

In this example, the first argument is expected to be greater than 10 and not contain the substring "bad".

---

## Tips and Best Practices

- Use `_` to avoid over-specifying arguments you don't care about.
- Prefer combining matchers with `AllOf()` or `AnyOf()` for clarity.
- When matching multiple arguments together, use `.With()` with a tuple matcher.
- Assign complex matchers to variables to improve readability and reuse.
- Define custom matchers using `MATCHER` macros for frequently used predicates.
- Make your matchers pure functions without side effects.
- Use `SafeMatcherCast` to avoid type incompatibility errors.

## Troubleshooting Matchers

- If your matcher doesn't compile, check that the argument types match or are safely cast.
- Avoid using matchers with side effects as matcher invocation count or order is not guaranteed.
- When defining custom matchers, use `result_listener` to provide detailed failure reasons.
- For overloaded functions, disambiguate which overload you expect by specifying matcher types explicitly or use `Const()` wrapper for const methods.

---

## Advanced Topics

### Parameterized Matchers
Use `MATCHER_P`, `MATCHER_P2`, etc., to define matchers that take parameters and provide descriptive failure messages including parameter values.

### Composite Matchers
Create matchers that take other matchers as parameters, compose complex conditions, and print rich failure messages by describing their sub-matchers.

### Safe Matcher Casting
Use `SafeMatcherCast<T>(m)` to convert matchers safely between types when argument types differ but conversions are safe.

### Matching Container Contents
Matchers like `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, and `Pointwise()` allow detailed verification of container element sequences and their relationship to expected values or matchers.

### Working with Pointers
Matchers like `IsNull()`, `NotNull()`, `Pointee(m)`, and `Pointer(m)` match pointer values themselves or the values they point to, enabling flexible checks for pointer arguments.

---

## Summary

Matchers constitute the core of expressive verification in GoogleMock. They enable precise and readable assertions on mock method arguments and tested values. Built-in matchers cover common needs, but custom matchers defined via `MATCHER` macros or matcher classes unlock verification of domain-specific invariants.

Explore the wide variety of built-in matchers to compose powerful expectations. Use custom matchers to express unique test constraints clearly, complete with intuitive failure messages.

---

For examples and further details, see the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) and the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers).
