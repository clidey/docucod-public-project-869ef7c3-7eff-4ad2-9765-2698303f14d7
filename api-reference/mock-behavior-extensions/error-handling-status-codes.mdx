---
title: "Error Handling and Status Codes"
description: "Explanation of the key status codes, error scenarios, and best practices for diagnosing and responding to failures encountered during tests, mock invocations, or initialization."
---

# Error Handling and Status Codes

This page provides a comprehensive guide to the key status codes, typical error scenarios, and best practices for diagnosing and responding to failures encountered during tests, mock invocations, or initialization within GoogleMock and GoogleTest. Understanding error reporting and status behavior is crucial to writing robust, maintainable tests and effectively interpreting test failures.

---

## 1. Understanding Status Codes and Error Scenarios

GoogleMock and GoogleTest report status and failure information through a variety of mechanisms, including error messages, warnings, and test failures. These are closely tied to:

- Expectations on mock method calls (`EXPECT_CALL`)
- Uninteresting and unexpected mock calls
- Exhaustion of explicit actions
- Violations of call cardinalities
- Mock object lifecycle and verification

The core status types a user will encounter are:

| Status Type       | Meaning                                                                                     | Effect on Test                                       |
|-------------------|---------------------------------------------------------------------------------------------|-----------------------------------------------------|
| **Success**       | All expectations are satisfied, calls are as expected                                        | Test passes                                          |
| **Failure**       | Call counts violated or unexpected calls occurred                                           | Test reports failure                                 |
| **Warning**       | Uninteresting calls (mock methods without expectations) issue a warning (by default)        | Warning message printed, test continues              |


### Uninteresting vs Unexpected Calls  

- **Uninteresting call:** A call to a mock method without any `EXPECT_CALL` (expectation) on that method. It is allowed but warned by default.
- **Unexpected call:** A call that does not match any existing `EXPECT_CALL` set on that method. This is always a failure.

This distinction is crucial in interpreting error messages and deciding how strict tests should be.

<Tip>
Use `NiceMock` to suppress warnings on uninteresting calls, making tests less noisy when you do not care about all mock method calls. Use `StrictMock` to treat uninteresting calls as errors, enforcing strict verification.
</Tip>


## 2. Error Messages, Warnings, and Failures

GoogleMock prints detailed messages for various error and warning conditions. Some common cases include:

### a) Unexpected Mock Function Call

When a mock method is called that did not match any expectation:

- An error is generated immediately.
- The error message includes the invoked function, argument values, and all existing expectations that were tried but did not match.
- If the method returns a value, the default value for that type is returned.
- For void methods, the call returns immediately after reporting the failure.

Example failure snippet:

```
Unexpected mock function call - returning default value.
    Function call: DoB(2)
          Returns: 0
Google Mock tried the following 1 expectation, but it didn't match:
  Expected arg #0: is equal to 1
           Actual: 2
         Expected: to be called once
           Actual: called once - saturated and active
```

### b) Calls More Times Than Expected (Excessive Calls)

If a mock method exceeds the maximum invocation count set by `Times()`: 

- Failure report indicating the call count violation.
- Default action executed after failure report.

Example:

```
Mock function called more times than expected - returning default value.
    Function call: DoB(2)
          Returns: 0
         Expected: to be called once
           Actual: called twice - over-saturated and active
```

### c) Calls Fewer Times Than Expected (Insufficient Calls)

If a mock method is called too few times at the end of a test (usually detected at mock tear down or explicit verification):

- Non-fatal failure reporting actual call count vs expected.
- Message indicates unsatisfied expectations.

Example:

```
Actual function call count doesn't match EXPECT_CALL(b, DoB(5))...
         Expected: to be called at least twice
           Actual: called once - unsatisfied and active
```

### d) Uninteresting Calls

Calls to mock methods without `EXPECT_CALL` produce warnings by default. The warning includes:

- Notification that the call is uninteresting.
- The function name and arguments.
- Suggestion to add `EXPECT_CALL` if the call should be expected.

Use `NiceMock` to suppress these warnings.

### e) Exhaustion of Explicit Actions

If the number of `WillOnce()` actions provided in an `EXPECT_CALL` is fewer than invocation count:

- Warning notes that explicit actions have run out.
- Default action is run afterwards.

Example:

```
Actions ran out in EXPECT_CALL(b, DoB())...
Called 3 times, but only 2 WillOnce()s are specified - returning default value.
```


## 3. Diagnosing Failures and Issues

To effectively diagnose test failures related to mocks and expectations, follow these steps:

### Step 1: Use Verbose Output

Run your tests with the `--gmock_verbose=info` flag to see detailed traces of all mock function calls, matched expectations, and call arguments including stack traces. This helps find out which expectations matched or failed.

### Step 2: Analyze Call Arguments and Order

Look at the actual argument values passed and compare them to the expected matchers. Confirm if calls occurred in the expected order when sequences or `After()` clauses are used.

### Step 3: Evaluate Uninteresting vs Unexpected Calls

If warnings about uninteresting calls occur, check if the test should have explicit expectations on those calls or if `NiceMock` should be used.

### Step 4: Check Cardinalities

Review `Times()` clauses ensuring that the expected number of calls matches the actual number. Cardinalities like `AtLeast`, `AtMost`, or `Between` affect these checks.

### Step 5: Verify Mock Object Lifetimes and Cleanup

Use `Mock::VerifyAndClearExpectations(&mock_obj)` to force verification before object destruction and detect missed expectations early.

### Step 6: Read Failure Messages Fully

Failure messages often include comprehensive details including expected vs actual calls, argument mismatches, and which expectations remained unsatisfied.


## 4. Best Practices for Handling Errors and Status

### Use Expectation Ordering When Needed

Control call order with `InSequence` or `After()` clauses to avoid failures related to unexpected call sequences.

### Define Catch-All Expectations

Add catch-all `EXPECT_CALL(obj, Method(_)).Times(AnyNumber())` for methods called with arguments not explicitly matched, to avoid unexpected call failures.

### Use Nice and Strict Mocks Judiciously

- Use `NiceMock<T>` to reduce noise from uninteresting call warnings.
- Use `StrictMock<T>` to enforce strict checking, turning uninteresting calls into failures.

### Set Default Actions with ON_CALL

Override mock default behavior for uninteresting calls by setting default behavior via `ON_CALL()` without requiring explicit expectations.

### Explicitly Disallow Calls If Needed

Use `.Times(0)` in expectations to ensure certain mock methods are not called.

### Leverage Mock Verification APIs

Call `Mock::VerifyAndClearExpectations()` or `Mock::VerifyAndClear()` to verify mocks explicitly before destruction, especially in complex tests.

### Avoid Expectation Over-Specification

Use `EXPECT_CALL` only for calls you intend to verify. Over-constraint leads to fragile tests.


## 5. Common Troubleshooting Scenarios

<AccordionGroup title="Typical Error Scenarios and Solutions">
<Accordion title="Uninteresting Call Warnings">
**Problem:** Tests print warnings about uninteresting mock function calls.

**Cause:** A mock method was called without any matching `EXPECT_CALL`.

**Solution:**
- Add explicit `EXPECT_CALL` if the call should be verified.
- Use `NiceMock<T>` to suppress warnings for uninteresting calls.
- Add a catch-all expectation with `Times(AnyNumber())` if certain calls should be allowed regardless.
</Accordion>

<Accordion title="Unexpected Calls and Test Failures">
**Problem:** Test fails due to unexpected mock function calls.

**Cause:** The calls do not match any defined expectation.

**Solution:**
- Verify argument matchers in expectations.
- Add missing expectations or adjust argument matchers.
- If order-sensitive, confirm `InSequence` or `After` order definitions.
</Accordion>

<Accordion title="Call Count Mismatch Failures">
**Problem:** Failures stating that a mock method was called too many or too few times.

**Cause:** The actual call count violates the cardinality set in `Times()`.

**Solution:**
- Adjust the expected number of calls in `Times()` or use fuzzy cardinalities like `AtLeast` or `Between`.
- Review if multiple expectations on the same method are causing conflicts.
</Accordion>

<Accordion title="Exhausted Actions Warning">
**Problem:** Warning about explicit actions running out in `EXPECT_CALL`.

**Cause:** Calls exceed the number of `WillOnce` actions provided, but no `WillRepeatedly` defined.

**Solution:**
- Add a `WillRepeatedly()` clause to cover calls after the explicit ones.
- Increase `WillOnce()` clauses if needed.
- Accept default actions if appropriate.
</Accordion>

<Accordion title="Mock Verification Fails on Mock Destruction">
**Problem:** Tests fail at mock object destruction due to unmet expectations.

**Cause:** Mock methods were not called the expected number of times.

**Solution:**
- Call `Mock::VerifyAndClearExpectations()` before mock destruction to diagnose early.
- Check if some expectations must be relaxed.
</Accordion>
</AccordionGroup>


## 6. Key Status Flags and Runtime Controls

- `--gmock_verbose=info|warning|error` controls verbosity of mock call reporting:
  - `info`: show all calls, matches, warnings, errors and stack traces.
  - `warning` (default): suppress stack trace in uninteresting call warnings.
  - `error`: print errors only, suppress warnings.

- `Mock::AllowLeak(&mock_obj)` allows intentional leaks of mocks to skip verification.


## 7. Summary of Status Codes and Messages

| Condition                                 | Status Code / Type    | Description                                       |
|-------------------------------------------|----------------------|---------------------------------------------------|
| Call matches expectation                  | Success              | No failure; call allowed and handled               |
| Call does not match any expectation       | Unexpected call error| Test failure; reports unmatched calls              |
| Call occurs too many times                 | Excess call error    | Test failure; exceeds `Times()` upper bound        |
| Call occurs too few times                  | Unsatisfied error    | Test failure; less than `Times()` lower bound      |
| Call to mock without expectation          | Warning              | Calls allowed, but warning issued (naggy default) |
| Exhaustion of explicit actions             | Warning              | Warn that `WillOnce` actions are exhausted         |


---

## Appendix: Example of Error Handling in GoogleMock

```cpp
using ::testing::Return;
using ::testing::_;
using ::testing::AtLeast;

class MockFoo {
 public:
  MOCK_METHOD(int, DoA, (int n), ());
};

TEST(MyTest, Example) {
  MockFoo foo;

  // Set expectation: DoA(5) will be called once and return 42
  EXPECT_CALL(foo, DoA(5))
      .Times(1)
      .WillOnce(Return(42));

  // Call meets expectation
  int ret = foo.DoA(5);
  EXPECT_EQ(ret, 42);

  // Call does not match expectation - will cause failure
  EXPECT_NONFATAL_FAILURE(
    { foo.DoA(10); },
    "Unexpected mock function call"
  );

  // Call called more times than expected
  EXPECT_NONFATAL_FAILURE(
    { foo.DoA(5); foo.DoA(5); },
    "called more times than expected"
  );

  // Uninteresting call warning will occur for calls with no expectation
  foo.DoA(3);  // Warning printed unless using NiceMock
}
```


---

## Related Documentation

- [Using Mocks in Tests](gmock_for_dummies.md#using-mocks-in-tests) – foundational guide on mock usage.
- [Nice, Naggy, and Strict Mocks](api-reference/mock-behavior-extensions/nice-naggy-strict-mocks.mdx) – detailed on mock strictness and error perception.
- [EXPECT_CALL Matcher and Action Syntax](api-reference/core-mocking-api/setting-expectations-actions.mdx) – for setting detailed call expectations and related error scenarios.
- [VerifyAndClear and AllowLeak](api-reference/core-mocking-api/mock-method-definition.mdx) – cleaning and verifying mocks reliably.
- [gMock Verbosity Flag](docs/gmock_cheat_sheet.md#flags) – controlling diagnostic verbosity.
- [Troubleshooting Common Setup Issues](getting-started/configuration-validation/troubleshooting-common-issues.mdx) – includes common error scenarios during setup.


---

By mastering error handling and understanding the variety of status codes and messages GoogleMock produces, you will greatly accelerate debugging, strengthen test reliability, and achieve more predictable and maintainable test suites.