---
title: "Matchers"
description: "Definitive list and usage guide for built-in and custom matchers, including matcher composition and extension strategies. Covers scalar, container, floating-point, and user-defined type matchers with minimal and advanced examples."
---

# Matchers

A matcher defines the conditions an argument to a mock method should satisfy. Use matchers inside `ON_CALL()`, `EXPECT_CALL()`, or assertions like `EXPECT_THAT()` and `ASSERT_THAT()` to express precisely how arguments are expected to look or behave.

This page provides a definitive guide to all built-in and user-defined matchers, including how to compose, extend, and customize them. It covers scalar types, container matchers, floating-point precision checks, and user-defined matchers, with examples ranging from simple to advanced.

---

## Matcher Basics

- Matchers act as predicates that return `true` when the argument matches the specified condition.
- You can use matchers anywhere an argument value is expected in mocking or assertions.
- The wildcard matcher `_` matches any value regardless of type.
- Literals like `5` are implicitly converted to `Eq(5)` matchers.

### Using Matchers in Mocks

```cpp
using ::testing::_;
using ::testing::Eq;

// Expect that Foo is called with argument equal to 5
EXPECT_CALL(mock, Foo(5)); // Same as Foo(Eq(5))

// Expect that Bar is called with any argument
EXPECT_CALL(mock, Bar(_));
```

### Asserting with Matchers

Matchers also empower expressive assertions:

```cpp
EXPECT_THAT(value, Ge(10));    // value >= 10
EXPECT_THAT(name, StartsWith("John"));
EXPECT_THAT(container, ElementsAre(1, _, 3));
```

---

## Categories of Built-In Matchers

### 1. Wildcard Matchers

| Matcher | Description |
|---------|-------------|
| `_` | Matches any value.
| `A<T>()` or `An<T>()` | Matches any value of type `T`.

### 2. Generic Comparison Matchers

These matchers use standard ordering or equality:

| Matcher | Meaning |
|---------|---------|
| `Eq(value)` or `value` | Equal to `value`.
| `Ne(value)` | Not equal to `value`.
| `Lt(value)` | Less than `value`.
| `Le(value)` | Less than or equal to `value`.
| `Gt(value)` | Greater than `value`.
| `Ge(value)` | Greater than or equal to `value`.
| `IsTrue()` / `IsFalse()` | Evaluates to true/false in boolean context.
| `DistanceFrom(target, matcher)` | Distance between argument and `target` matches `matcher`. Defaults to `abs(arg - target)`.
| `DistanceFrom(target, get_distance, matcher)` | Distance computed by supplied `get_distance(arg, target)`.
| `IsNull()` / `NotNull()` | Raw or smart pointer is null / non-null.
| `Optional(matcher)` | Optional type contains value matching `matcher`.
| `VariantWith<T>(matcher)` | Variant holds alternative of type T matching `matcher`.
| `Ref(variable)` | Argument is a reference to `variable`.
| `TypedEq<T>(value)` | Strictly typed equality matcher (useful for overloaded methods).

### 3. Floating-Point Matchers

Specialized matchers for approximate equality of floating-point values, considering rounding errors and NaNs.

| Matcher | Description |
|---------|-------------|
| `DoubleEq(value)` | Double approximately equal to `value` (NaNs unequal).
| `FloatEq(value)` | Float approximately equal to `value` (NaNs unequal).
| `NanSensitiveDoubleEq(value)` | Double approximately equal with NaNs considered equal.
| `NanSensitiveFloatEq(value)` | Float approximately equal with NaNs considered equal.
| `DoubleNear(value, max_abs_error)` | Within absolute error.
| `FloatNear(value, max_abs_error)` | Within absolute error.
| `NanSensitiveDoubleNear(value, max_abs_error)` | With NaN equality.
| `NanSensitiveFloatNear(value, max_abs_error)` | With NaN equality.
| `IsNan()` | Argument is NaN of any floating-point type.

### 4. String Matchers

Applicable to C strings, `std::string`, and wide strings (where supported). These matchers handle common string queries:

| Matcher | Description |
|---------|-------------|
| `StrEq(str)` | String equal to `str` (case-sensitive).
| `StrNe(str)` | String not equal to `str` (case-sensitive).
| `StrCaseEq(str)` | String equal ignoring case.
| `StrCaseNe(str)` | String not equal ignoring case.
| `HasSubstr(substring)` | Contains substring.
| `StartsWith(prefix)` | Starts with prefix.
| `EndsWith(suffix)` | Ends with suffix.
| `ContainsRegex(regex)` | Matches substring regex.
| `MatchesRegex(regex)` | Matches entire string regex.
| `IsEmpty()` | Is empty string.
| `WhenBase64Unescaped(matcher)` | Base64-escaped string whose unescaped form matches `matcher`.

### 5. Container Matchers

Matchers to verify containers' contents and properties. They work with STL-like containers and native arrays.

| Matcher | Description |
|---------|-------------|
| `Contains(element_matcher)` | Container with an element matching `element_matcher`.
| `Contains(element_matcher).Times(n)` | Element occurs exactly `n` times (or matches cardinality).
| `Each(element_matcher)` | All elements match `element_matcher`.
| `ElementsAre(m0, m1, ..., mn)` | Matches elements in order.
| `ElementsAreArray(container_or_array)` | Like `ElementsAre`, but with container or array.
| `UnorderedElementsAre(m0, m1, ..., mn)` | Matches elements in any order.
| `UnorderedElementsAreArray(container_or_array)` | Like above, from container or array.
| `Pointwise(matcher, container)` | Matches elements pairwise with elements of container.
| `UnorderedPointwise(matcher, container)` | Like Pointwise, order-insensitive.
| `SizeIs(size_matcher)` | Container size matches.
| `BeginEndDistanceIs(distance_matcher)` | Matches distance between begin/end iterators.
| `ContainerEq(container)` | Exact match of container contents with detailed diffs.
| `IsEmpty()` | Container is empty.
| `IsSubsetOf(container_or_array)` | Container is a subset of the given collection.
| `IsSupersetOf(container_or_array)` | Container is a superset of the given collection.
| `WhenSorted(matcher)` | Container matches after sorting with `<`.
| `WhenSortedBy(comparator, matcher)` | Container matches after sorting with comparator.

### 6. Member Matchers

Matchers that inspect and match specific fields, properties, or key-value pairs.

| Matcher | Description |
|---------|-------------|
| `Field(&Class::field, matcher)` | Matches object's field (or pointer's pointee field) with `matcher`.
| `Field(field_name, &Class::field, matcher)` | Same as above with named field for clearer messages.
| `Property(&Class::method, matcher)` | Matches value returned by a getter method.
| `Property(property_name, &Class::method, matcher)` | Same as above with name.
| `Key(matcher)` | Matches `first` member of a `std::pair` or map element.
| `Pair(matcher1, matcher2)` | Matches an `std::pair` matching both elements.
| `FieldsAre(m1, m2, ..., mn)` | Matches aggregate or tuple by fields.

### 7. Matchers for Function/Callback Results

| Matcher | Description |
|---------|-------------|
| `ResultOf(callable, matcher)` | Matches when `callable(argument)` matches `matcher`.
| `ResultOf(description, callable, matcher)` | Like above with a result description.

### 8. Pointer Matchers

| Matcher | Description |
|---------|-------------|
| `Address(matcher)` | Matches the address of the argument.
| `Pointee(matcher)` | Argument points to a value matching `matcher` (works for raw and smart pointers).
| `Pointer(matcher)` | The pointer itself matches `matcher` (raw or smart).
| `WhenDynamicCastTo<T>(matcher)` | Matches if dynamic casting argument to `T` matches `matcher`.

### 9. Multi-Argument Matchers

| Matcher | Description |
|---------|-------------|
| `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()` | Matches tuples of two arguments with comparison predicates.
| `AllArgs(matcher)` | Passes all arguments as a tuple to `matcher`.
| `Args<N1, N2, ..., Nk>(matcher)` | Matches a subset of arguments at indices `N1, N2, ..., Nk`.

### 10. Composite Matchers

| Matcher | Description |
|---------|-------------|
| `AllOf(m1, m2, ..., mn)` | Argument matches *all* matchers.
| `AnyOf(m1, m2, ..., mn)` | Argument matches *any* matcher.
| `AllOfArray(container_or_array)` | Like `AllOf`, from a container.
| `AnyOfArray(container_or_array)` | Like `AnyOf`, from a container.
| `Not(matcher)` | Negation of matcher.
| `Conditional(condition, m1, m2)` | If `condition` is true, matches `m1`; else `m2`.

### 11. Adapters for Matchers

| Matcher | Description |
|---------|-------------|
| `MatcherCast<T>(m)` | Casts matcher `m` to `Matcher<T>`. Requires `T` is convertible to argument type of `m`.
| `SafeMatcherCast<T>(m)` | Like `MatcherCast`, but enforces safety for pointer and arithmetic conversions.
| `Truly(predicate)` | Wraps a unary predicate callable as a matcher.
| `Matches(m)(value)` | Use matcher `m` as a predicate functor returning bool.

---

## Defining Custom Matchers

GoogleMock supports defining your own matchers in multiple ways, from simplest macros to full class implementations.

### Quick Custom Matcher with `MATCHER` Macros

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
EXPECT_THAT(val, IsEven());
```

### Parameterized Matchers

```cpp
MATCHER_P(IsDivisibleBy, divisor, "") {
  *result_listener << "remainder is " << (arg % divisor);
  return (arg % divisor) == 0;
}
EXPECT_THAT(value, IsDivisibleBy(5));
```

Use `MATCHER_P2`, `MATCHER_P3`, etc. for multiple parameters.

### Matcher Classes

For advanced cases, implement a matcher class providing:

- `bool MatchAndExplain(const T& value, MatchResultListener*) const`
- `void DescribeTo(std::ostream*) const`
- `void DescribeNegationTo(std::ostream*) const`

Then provide a factory function returning `testing::Matcher<T>` for syntactic convenience.

---

## Matcher Composition and Usage

### Composing Matchers

Matchers can be combined to express complex conditions:

```cpp
EXPECT_CALL(mock, Func(AllOf(Ge(5), Ne(10))));
EXPECT_THAT(container, Each(Not(Contains("foo"))));
```

### Matchers as Predicates

Matchers can be used as predicates in algorithms:

```cpp
std::vector<int> v = {1, 7, 3};
int count = std::count_if(v.begin(), v.end(), testing::Matches(testing::Ge(5)));
```

### Using Matcher Factories

Build complex reusable matchers and assign to variables:

```cpp
auto in_range = testing::AllOf(testing::Gt(5), testing::Le(20));
EXPECT_THAT(value, in_range);
```

---

## Advanced Matcher Techniques

### Matching Containers

- Use `ElementsAre()` for ordered matching.
- Use `UnorderedElementsAre()` for order-insensitive matching.
- Use nested matchers for deep container checks.

### Matching Object Members

Use `Field()` for member variables and `Property()` for getter methods:

```cpp
EXPECT_THAT(obj, Field(&Type::member, Ge(10)));
EXPECT_THAT(obj, Property(&Type::GetFlag, IsTrue()));
```

### Pointer and Reference Matchers

- `Ref(variable)` matches argument by identity.
- `Pointee(matcher)` matches the value pointed to.
- `Pointer(matcher)` matches the pointer itself.

### Floating-Point Approximate Matching

Choose between ULP-based or absolute-error approaches:

```cpp
EXPECT_THAT(value, DoubleEq(expected));
EXPECT_THAT(value, NanSensitiveFloatNear(expected, 0.001f));
```

---

## Practical Tips & Best Practices

- Prefer explicit `EXPECT_CALL()` argument matchers to avoid accidental tests.
- Use wildcard matcher `_` when argument specifics don’t matter.
- Compose matchers to express complex argument constraints clearly.
- Use `ON_CALL()` to specify default behavior when calls are not asserted.
- Define custom matchers for repeated or domain-specific conditions.
- Be careful with matchers involving move-only types — lambdas often help.
- Remember matcher purity: no side effects, deterministic matching only.

---

## Troubleshooting Common Matcher Issues

- If matcher compilation fails, verify types and try explicit `TypedEq<>` or `SafeMatcherCast<>`.
- Avoid comparing pointers with literals; use `IsNull()` or `NotNull()`.
- For overloaded methods, specify argument types or use `SafeMatcherCast` to disambiguate.
- If your matcher has complex predicate logic, use `Truly()` or a custom matcher with detailed `MatchAndExplain()`.

---

## Example: Defining and Using a Matcher

Define a matcher for “divisible by a number”:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "is divisible by " + ::testing::PrintToString(divisor)) {
  if ((arg % divisor) == 0) return true;
  *result_listener << "remainder is " << (arg % divisor);
  return false;
}

EXPECT_CALL(mock, Compute(IsDivisibleBy(5)));
EXPECT_THAT(value, IsDivisibleBy(3));
```

---

## Summary

Matchers are the foundation of argument validation and value assertions in GoogleMock and GoogleTest. Mastering the built-in matchers and writing your own custom matchers lets you express complex test expectations with clarity and precision.

Explore the [Matchers Reference](reference/matchers.md) for a complete list and details, and the [gMock Cookbook](gmock_cook_book.md#NewMatchers) for advanced techniques in writing custom matchers.

---

<AccordionGroup title="Common Matcher Workflows">
<Accordion title="Basic Argument Matching and Wildcards">
Use simple matchers like `Eq(val)`, literals, or `_` to match any argument value.
</Accordion>
<Accordion title="Combining Matchers">
Compose existing matchers with `AllOf()`, `AnyOf()`, and `Not()` to build complex logic.
</Accordion>
<Accordion title="Matching Containers">
Use `ElementsAre()`, `Contains()`, `IsEmpty()`, and related container matchers for STL containers.
</Accordion>
<Accordion title="Field and Property Matchers">
Match specific members or properties inside objects using `Field()` and `Property()`.
</Accordion>
<Accordion title="Floating-point Precision Matchers">
Use `DoubleEq()`, `FloatEq()`, and their near variants to handle floating point comparisons.
</Accordion>
</AccordionGroup>

<Tip>
When constructing composite or nested matchers, assign sub-matchers to variables for clarity and reuse.
</Tip>

---

## Additional Resources

- [Matchers Reference](reference/matchers.md)
- [gMock Cookbook: Writing New Matchers Quickly](gmock_cook_book.md#NewMatchers)
- [Mocking Reference](reference/mocking.md) for interaction with mocks
- [gMock Cheat Sheet](gmock_cheat_sheet.md) for quick lookup of macros

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-438"}]} />