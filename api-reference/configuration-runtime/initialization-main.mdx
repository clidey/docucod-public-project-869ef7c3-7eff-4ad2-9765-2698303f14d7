---
title: "Test Runner Initialization and Main"
description: "Documents how to initialize GoogleTest/GoogleMock and customize the main entry point for executing test suites, with common options and example `main.cc` templates."
---

# Test Runner Initialization and Main

This page guides you through initializing GoogleTest and GoogleMock frameworks and customizing the main entry point for executing your test suites. It covers standard and platform-specific entry points, command-line flag parsing, integration tips, and common usage patterns.

---

## Overview

GoogleTest and GoogleMock require explicit initialization before running your tests to properly parse command-line arguments and configure runtime settings. This initialization happens through dedicated functions you must call, usually in your program's `main()` function.

Most users link against provided main entry point libraries (such as `gtest_main` or `gmock_main`) that provide a ready-made `main` function with correct initialization. However, if you need custom behavior before or after running tests—such as additional setup, teardown, or argument preprocessing—you will write your own `main()` function.

GoogleMock depends on GoogleTest, so initializing GoogleMock initializes both frameworks.

---

## Initialization Functions

### `testing::InitGoogleTest()`

- Initializes GoogleTest.
- Parses GoogleTest-specific command-line flags, removes recognized arguments from `argc`/`argv`.
- Must be called before `RUN_ALL_TESTS()`.
- Accepts `argc` and `argv` as input.

### `testing::InitGoogleMock()`

- Initializes both GoogleMock and GoogleTest.
- Parses GoogleMock and GoogleTest flags.
- Removes recognized flags from `argc`/`argv`.
- Overloaded to accept `char** argv` or `wchar_t** argv` (on Windows).
- Can be called without arguments on platforms without `argc`/`argv` (e.g., Arduino).

**Usage**:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Calling `InitGoogleMock` automatically calls `InitGoogleTest` internally.

<Check>
Always call initialization before `RUN_ALL_TESTS()` to ensure flags are configured correctly.
</Check>

---

## Custom `main()` Function

If you need to customize test program behavior (e.g., setup resources, filter tests, change logging), write your own `main()` like this:

```cpp
#include "gmock/gmock.h"
#include "gtest/gtest.h"

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  // Custom setup here

  int result = RUN_ALL_TESTS();

  // Custom teardown here

  return result;
}
```

### Important Details

- Ensure your `main` returns the result of `RUN_ALL_TESTS()`.
- `InitGoogleMock` parses and cleans recognized flags from command line.
- The `RUN_ALL_TESTS()` macro runs all registered tests and returns 0 on success.

<Warning>
Do not ignore the return value of `RUN_ALL_TESTS()`, as test success/failure status depends on it.
</Warning>

---

## Platform-Specific Entry Points

GoogleTest and GoogleMock support several platforms with tailored entry points:

### Arduino and Embedded Platforms

On platforms like ESP8266, ESP32, or NRF52 with Arduino-style programming model:

- There is no `main()`; the program entry is through `setup()` and `loop()` functions.
- Initialization and running tests happen inside these:

```cpp
void setup() {
  testing::InitGoogleMock(); // initializes gMock and gTest
}

void loop() {
  RUN_ALL_TESTS();
}
```

### QuRT Platform

- Has a `main()` but `argc` and `argv` are unusable.
- Tests are run in a simple `main` without arguments:

```cpp
gtest_api_ int main() {
  printf("Running main() from main.cc\n");
  testing::InitGoogleTest();
  return RUN_ALL_TESTS();
}
```

### Windows and Windows Mobile

- On Windows Mobile, `main` can be replaced by `_tmain` (Unicode-compatible entry).
- Otherwise, plain C++ `main(int argc, char** argv)` is used.

---

## Linking with `gtest_main` or `gmock_main`

To avoid writing your own `main()`, link with these libraries:

| Library       | Purpose                                                      |
|---------------|--------------------------------------------------------------|
| `gtest_main`  | Provides a default `main()` for GoogleTest only              |
| `gmock_main`  | Provides a `main()` initializing GoogleMock and GoogleTest   |

This saves manual boilerplate and ensures best-practice initialization.

Example linking with CMake:

```cmake
find_package(GTest REQUIRED)
add_executable(my_tests test_main.cc my_tests.cc)
target_link_libraries(my_tests GTest::gmock_main)
```

---

## Common Command-Line Flags

`InitGoogleTest` and `InitGoogleMock` parse flags that control runtime behavior. Examples:

- `--gtest_filter=TestSuiteName.TestName` — Run only matching tests.
- `--gmock_verbose=info|warning|error` — Set verbosity level for GoogleMock.
- `--gmock_catch_leaked_mocks=1` — Enable leak detection for mock objects.

These flags are removed from `argv` during initialization, simplifying argument handling in your `main()`.

<Info>
Unsupported or unrecognized flags are left in `argv` untouched.
</Info>

---

## Example `main.cc` Templates

### Simple GoogleTest-only main

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Simple GoogleMock main

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Custom initialization example

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  // Initialize logging or other resources here

  int result = RUN_ALL_TESTS();

  // Cleanup resources here

  return result;
}
```

---

## Troubleshooting & Best Practices

<Warning>

- Calling `RUN_ALL_TESTS()` multiple times in the same process is not supported and can cause inconsistent results.
- Always call initialization before any test execution.
- Use the provided main entry point libraries if you do not need custom behavior to avoid common pitfalls.

</Warning>

<Tip>
If your test binary does not link due to missing `main()`, ensure you are linking with `gtest_main` or `gmock_main` where appropriate.
</Tip>

---

## Summary

By correctly initializing GoogleTest and GoogleMock and writing or linking the proper `main()` entry point, you ensure your tests run reliably across platforms. Proper parsing of command-line flags provides flexible runtime configuration, while linking against pre-built mains saves development effort.

For detailed guides and examples, consult:

- [GoogleTest Primer](../core-testing-apis/writing-tests.md)
- [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Installing with CMake](../../getting_started/installation_integration/install_cmake.md)

---