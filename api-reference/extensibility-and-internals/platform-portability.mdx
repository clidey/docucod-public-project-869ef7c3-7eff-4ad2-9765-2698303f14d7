---
title: "Platform Portability and Configuration"
description: "Describes macros and abstractions supporting cross-platform use, compiler compatibility, and interaction with external dependencies like Abseil. Details core configuration touchpoints for environment adaptation."
---

# Platform Portability and Configuration

This documentation describes the macros and abstractions provided by GoogleTest and GoogleMock that enable cross-platform compatibility, compiler adaptability, and smooth interaction with external dependencies like Abseil. It highlights core configuration points that allow GoogleTest to adapt its behavior according to the compilation environment and external flags.

---

## 1. Overview of Platform Portability Support

GoogleTest and GoogleMock are designed to run reliably across diverse operating systems and compiler configurations. This cross-platform portability is achieved through a set of macros, compile-time feature detection, and utility abstractions:

- **Platform Detection Macros**: Identify the OS family and environment at compile time.
- **Feature Detection Macros**: Indicate availability of threading, exceptions, RTTI, and regular expression support.
- **Compiler Compatibility Macros**: Manage compiler-specific extensions and warnings.
- **External Dependency Support**: Enable smooth integration with dependencies like Abseil.

This foundational layer ensures tests and mocks written using GoogleTest and GoogleMock can reliably run on Linux, Windows, macOS, and many other supported systems.

---

## 2. Platform and Compiler Macro Definitions

GoogleTest internally defines a series of macros that describe the compilation environment precisely.

### Platform Identification Macros

These macros are automatically defined by GoogleTest's internal headers, based on the detected OS during compilation:

- `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, etc. – Indicate which operating system the framework is currently targeting.
- Subplatform macros like `GTEST_OS_WINDOWS_DESKTOP`, `GTEST_OS_WINDOWS_MINGW` further refine the target.

These macros allow conditional compilation in user code or tests to adapt behavior based on the OS.

### Feature-Availability Macros

GoogleTest tests for the presence or absence of key features, defining the following macros to 1 or 0:

- `GTEST_HAS_PTHREAD` – Indicates availability of POSIX threads.
- `GTEST_HAS_EXCEPTIONS` – Indicates whether C++ exceptions are enabled.
- `GTEST_HAS_RTTI` – Indicates availability of Run-Time Type Information.
- `GTEST_HAS_STD_WSTRING` – Signals support for `std::wstring`.
- `GTEST_HAS_FILE_SYSTEM` – Denotes the presence of file system operations.
- `GTEST_HAS_CXXABI_H_` – Whether the C++ ABI header is present.

#### Practical Usage

Users can conditionally enable or disable features in tests or utilities by checking these macros, ensuring compatibility with environments such as restricted embedded platforms or different compiler modes.

---

## 3. Customization Macros and User Overrides

Users and integrators can influence GoogleTest’s portability behavior by defining certain macros before compilation. This customization allows overriding default implementations or adapting the framework to non-standard or constrained environments.

### Customization Points in Headers

The following headers expose macros users can define in their build or source environment to tailor GoogleTest:

- **`gtest/internal/custom/gtest-port.h`**: The primary injection point for overrides and custom configuration related to platform portability.

- **`gmock/internal/custom/gmock-port.h`**: Similar customization points when working with GoogleMock.

### Commonly Used Macros

| Macro                          | Purpose                                                                                     |
| ------------------------------| -------------------------------------------------------------------------------------------|
| `GTEST_OS_STACK_TRACE_GETTER_`| Specifies a custom implementation to obtain stack trace information across platforms.    |
| `GTEST_CUSTOM_TEMPDIR_FUNCTION_` | Overrides the function for obtaining temporary directory paths (`testing::TempDir()`).        |
| `GTEST_LOG_(severity)`         | Defines custom logging mechanisms per severity level.                                     |
| `GTEST_CHECK_(condition)`      | Enables defining a custom assertion or check facility beyond the default.                 |
| `GTEST_HAS_NOTIFICATION_`      | Forces declaring that a `Notification` primitive is provided externally.                  |
| `GTEST_HAS_MUTEX_AND_THREAD_LOCAL_` | Declares that mutex and thread-local storage implementations are provided externally, requiring related macros for declaring/defining mutexes.
|
| `GTEST_API_`                  | Controls symbol export/import declarations, crucial for shared library builds on Windows.
|

### How to Use Custom Macros

Users typically define these macros in their build system or via compiler command-line flags:

```shell
-DGTEST_HAS_PTHREAD=0
-DGTEST_API_=__declspec(dllexport)
```

This flexibility empowers advanced users and integrators to adapt GoogleTest to custom or restricted environments while ensuring full functionality.

---

## 4. Threading and Synchronization Abstractions

GoogleTest provides platform portability for concurrency features essential in multi-threaded testing scenarios.

### Thread Safety Macros

- `GTEST_IS_THREADSAFE`: Defined to 1 when the platform and build support thread-safe operations.
- `GTEST_HAS_MUTEX_AND_THREAD_LOCAL_`: Indicates whether mutex and thread local storage are implemented or provided by the user.
- `GTEST_HAS_NOTIFICATION_`: A flag for availability of a notification primitive.

### Thread Primitives

GoogleTest abstracts synchronization using its own `Mutex` and `ThreadLocal` classes with implementations conditional on platform support:

- **Windows:** Uses critical sections and Windows native threading APIs.
- **Posix Systems:** Uses `pthread_mutex_t` and POSIX thread locals.
- **ThreadLocal:** Implements per-thread storage respecting platform limitations.

For unsupported or single-threaded environments, dummy no-op implementations exist to keep the code compatible without adding overhead.

### Best Practices

When writing tests requiring synchronization or shared states, rely on GoogleTest’s threading abstractions to guarantee portability and correct functionality.

---

## 5. Logging and Error Checking Macros

GoogleTest supports controlled logging mechanisms and assertion checks that adapt to the platform and user overrides.

### Logging

- `GTEST_LOG_(severity)`: Macro to log messages at different severity levels (`INFO`, `WARNING`, `ERROR`, `FATAL`). The user can override this to integrate with their system’s logging framework.
- `LogToStderr()` and `FlushInfoLog()`: Functions to direct logs explicitly to stderr and flush logs.

### Assertions

- `GTEST_CHECK_`: An assert-like macro that aborts program execution if a given condition fails, logging an explanatory message.

These facilities ensure that failures are reported consistently regardless of the target platform or runtime environment.

---

## 6. Integration with External Dependencies (Abseil Example)

GoogleTest can optionally interface with external libraries such as Abseil.

### Abseil Support Macros

- `GTEST_HAS_ABSL`: If defined to 1, enables integration with Abseil, including using Abseil's flags system instead of GoogleTest's native flag implementation.
- When using Abseil, GoogleTest enables the use of RE2 for regex and absl::string_view for string operations internally.

### Flags Implementation

GoogleTest conditionally uses Abseil flag macros when built with Abseil, exposing macros such as:

- `GTEST_DEFINE_bool_()`, `GTEST_DEFINE_int32_()`, `GTEST_DEFINE_string_()`
- `GTEST_FLAG_GET()` and `GTEST_FLAG_SET()` to access and update flags

This makes GoogleTest fully compatible and consistent within projects that already use Abseil.

---

## 7. Symbol Export and Shared Library Configuration

When building GoogleTest as a shared library (DLL) or static library, correct symbol visibility and linkage are critical.

### Macros Involved

- `GTEST_API_`: Controls symbol export/import declarations, typically resolves to:
  - `__declspec(dllexport)` when building the library on Windows
  - `__declspec(dllimport)` when using the library
  - `__attribute__((visibility("default")))` on GCC/Clang

- `GTEST_LINKED_AS_SHARED_LIBRARY` and `GTEST_CREATE_SHARED_LIBRARY`: Used internally and by users to specify shared library usage.

Users who build GoogleTest or Mock as shared libraries must define these macros in their build system to correctly expose symbols and avoid linker errors.

---

## 8. File System and Environment Adaptations

GoogleTest incorporates platform abstractions around basic file and environment system calls:

- Functions like `posix::FOpen()`, `posix::Stat()`, `posix::ChDir()`.
- Macros for path separators like `GTEST_PATH_SEP_` adapt to Windows or Unix conventions.
- Environment variable access via `GetEnv()` abstracts platform limitations such as embedded or mobile platforms lacking traditional environment variables.

This ensures code dealing with file or environment operations behaves consistently.

---

## 9. Compiler and Language Standard Compatibility

GoogleTest requires at least C++17 support for compilation. The platform portability layer helps:

- Automatically detect the compiler and version.
- Use compiler-specific pragmas and attributes to suppress warnings and enable features like `noinline`, `no_sanitize_memory`, etc.
- Provide consistent UTF-8 encoding support on Windows using `-utf-8` flags and platform-specific APIs.

The provided CMake build utilities also guide the compiler flag configurations to ensure compliance with portability and language requirements.

---

## 10. Practical Tips and Troubleshooting

- **Customizing Behavior**: Use the injection points in `gtest-port.h` and `gmock-port.h` to tailor GoogleTest logging, threading, or environment interactions.
- **Thread Safety**: Check `GTEST_IS_THREADSAFE` macro to confirm threading support.
- **Exceptions and RTTI**: Use flags `GTEST_HAS_EXCEPTIONS` and `GTEST_HAS_RTTI` to conditionally compile for constrained environments.
- **Abseil Integration**: Define `GTEST_HAS_ABSL` to 1 for projects based on Abseil.
- **Shared Libraries**: Always define shared library macros correctly on Windows to avoid symbol visibility problems.

If encountering build failures on specific platforms or compilers, verify respective macros in `gtest-port.h` for overrides and consult the build integration guide.

---

## Appendix: Selected Macros Summary Table

| Macro                         | Description                                                       |
|-------------------------------|-----------------------------------------------------------------|
| `GTEST_OS_WINDOWS`             | Defined if building on Windows OS                              |
| `GTEST_HAS_PTHREAD`            | Indicates POSIX threads availability                            |
| `GTEST_HAS_EXCEPTIONS`         | Indicates availability of C++ exceptions                        |
| `GTEST_HAS_RTTI`               | Indicates Runtime Type Information availability                 |
| `GTEST_API_`                   | Controls symbol export/import, especially on Windows            |
| `GTEST_CUSTOM_TEMPDIR_FUNCTION_` | Allows overriding temporary directory retrieval function          |
| `GTEST_LOG_(severity)`         | Enables user to override logging for different severity levels |
| `GTEST_HAS_MUTEX_AND_THREAD_LOCAL_` | Indicates if mutex and thread-local are user-provided            |
| `GTEST_HAS_ABSL`               | Indicates GoogleTest is compiled with Abseil support            |

---

## Related Documentation

- [Supported Platforms](../docs/platforms.md): Lists operating systems and compilers supported.
- [Customization Points for GoogleTest](googletest/include/gtest/internal/custom/README.md): Details user macro overrides.
- [GoogleMock Customization Points](googlemock/include/gmock/internal/custom/README.md): For GoogleMock-specific customizations.
- [Integration & Platform Support Guide](overview/system-architecture-and-integration/integration-and-dependencies.mdx): Explains build and integration details.
- [CMake Build Utilities](googletest/cmake/internal_utils.cmake): Shows build flag configurations.

---

## Source Code Links

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path":"googletest/include/gtest/internal/gtest-port.h","range":"1-538"},{"path":"googletest/include/gtest/internal/gtest-port-arch.h","range":"1-76"},{"path":"googlemock/include/gmock/internal/gmock-port.h","range":"1-130"}]} />