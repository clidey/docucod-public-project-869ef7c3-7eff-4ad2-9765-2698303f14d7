---
title: "Internal Utility Classes & Functions"
description: "Outlines key type traits, helpers, and internal utilities available for advanced customization, including type categorization, tuple utilities, and failure reporting."
---

# Internal Utility Classes & Functions

This page outlines key type traits, helpers, and internal utilities provided by Google Mock to support advanced customization and implementation details. These utilities underpin behaviors such as type categorization, tuple utilities, raw pointer extraction, and failure reporting, enabling the construction and management of mocks and matchers with greater expressiveness and safety.

---

## 1. Type Categorization and Traits

To ensure safe and correct matcher behavior across diverse argument types, Google Mock internally classifies types based on their characteristics:

- **TypeKind Enum**: Categorizes types into:
  - `kBool` for `bool` types
  - `kInteger` for native integers
  - `kFloatingPoint` for floating-point types
  - `kOther` for all other types

- **KindOf<T> Template**: Maps a C++ type `T` to its `TypeKind`. For example, `int` maps to `kInteger`, `double` to `kFloatingPoint`, and user-defined types to `kOther`.

- **LosslessArithmeticConvertible**: Template traits that verify if a conversion between two arithmetic types is lossless, preventing potential silent data corruption in matcher casts.

This systematic type classification helps `SafeMatcherCast` and related utilities enforce safe conversions and maintain type correctness.

---

## 2. Utilities for Reporting and Assertions

Google Mock integrates tightly with Google Test's failure reporting system to provide robust assertion and expectation checks:

- **FailureReporterInterface**: Abstract interface to report failures as fatal or non-fatal.

- **GoogleTestFailureReporter**: Default reporter implementation forwarding failures to Google Test's assertion framework.

- **Assert() and Expect() Functions**: Used internally to assert conditions or produce non-fatal expectations, trigger test failures, and abort if needed.

- **LogIsVisible() and Log()**: Control logging visibility and output according to `--gmock_verbose` flag, providing informative warnings and diagnostic messages with optional stack traces.

---

## 3. String and Identifier Helpers

To improve error readability and diagnostics, Google Mock provides:

- `JoinAsKeyValueTuple`: Constructs a string that joins a list of names and corresponding values as a key-value tuple for error messages.

- `ConvertIdentifierNameToWords`: Converts identifier names formatted in camel case or snake case into readable, space-separated, lower-case words. For example, `FooBar123` becomes `foo bar 123`.

These functions help produce human-friendly matcher and failure descriptions.

---

## 4. Raw Pointer Extraction Utilities

Mock methods often accept smart pointers, and Google Mock must obtain the underlying raw pointer to evaluate matchers properly. The utility functions are:

- **GetRawPointer(p)**: Returns the raw pointer for:
  - Smart pointers (e.g., `std::unique_ptr`, `std::shared_ptr`): returns `.get()`
  - `std::reference_wrapper`: returns the address of the referred object
  - Raw pointers: returns as is

These ensure matchers work uniformly regardless of pointer encapsulation.

---

## 5. Tuple and Function Traits

Google Mock uses template utilities to decompose and operate on tuples and functions for matcher implementations:

- **Function<T> Template**: Extracts traits from function types such as:
  - Return type
  - Number of arguments
  - Individual argument types
  - Tuples of argument types and matchers
  - Aliases to function types with `void` return or ignored values

- **Tuple Element Accessors** and **FlatTuple**: Provide mechanisms to analyze argument lists for matchers and actions, including unpacking, selecting, and applying operations on tuple elements.

- **TupleMatches**: Implements element-wise matching of tuples to support multi-argument matcher verification.

These facilities allow Google Mock to support rich multi-argument expectation matchers and adaptors.

---

## 6. Base64 Utilities

Google Mock includes an internal Base64 decoding utility:

- `Base64Unescape(encoded, decoded)`: Converts a base64-encoded string to its decoded binary form, returning `false` if the input is invalid.

This supports matchers and internal features that require verification or manipulation of base64-encoded strings.

---

## 7. Log Severity and Verbosity Levels

Google Mock defines verbosity levels for controlling diagnostic output:

- `kInfoVerbosity`: Shows info, warnings, and errors.
- `kWarningVerbosity`: Shows warnings and errors.
- `kErrorVerbosity`: Shows errors only.

The `LogIsVisible` function returns whether a message at a certain `LogSeverity` should be printed based on the verbosity setting.

The `Log` function handles thread-safe printing, formatting, and optionally appending stack traces, governed by the verbosity level.

---

## 8. Internal Constants and Compiler Compatibility

- Google Mock enforces minimum compiler requirements, such as at least Visual C++ 2015.

- It uses macros to conditionally define or suppress warnings for various compilers.

- The code leverages constexpr, templates, and C++17 features for compile-time utilities.

---

## Practical Guidance

- These utilities are **internal** and subject to change without notice; **users should not directly use them**.

- They serve as foundational building blocks for features exposed via the public gMock API, such as matchers, actions, and mock classes.

- The type traits and converters ensure robust, type-safe mocking behavior even with complex or mixed types.

- The logging and failure reporting utilities foster clear diagnostics, improving test maintainability and debugging.

---

## Example Usage Scenario

When defining custom matchers or working with polymorphic matchers, Google Mock uses type categorization and tuple utilities to verify argument compatibility and to explain match failures in detail. Logging utilities enable verbose output during test failures or mock call traces, significantly aiding developers during test debugging and development.

---

## See Also

- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced mocking recipes.
- [Matchers Reference](/api-reference/mocking-matching-actions/argument-matchers) for user-level custom matcher guidance.
- [Expectations and Calls](/api-reference/mocking-matching-actions/expectations-calls) for managing mock method interactions.
- [Mock Class and Method Macros](/api-reference/mocking-matching-actions/mock-class-macros) for defining mocks.
- [Internal Portability Utilities](/api-reference/extensibility-and-internals/platform-portability) for platform-specific abstractions.

<Info>
This documentation describes internal helpers pivotal to constructing Google Mock's robust and type-safe mocking infrastructure. These internals facilitate powerful, expressive mocking capabilities behind the scenes.
</Info>

<Note>
This page targets advanced users and contributors needing insight into Google Mockâ€™s internal implementations or extending its functionality at a deep level.
</Note>