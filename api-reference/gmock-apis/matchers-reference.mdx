---
title: "Matchers"
description: "Catalog of built-in matchers for argument and value verification in mocked method calls, including advanced and custom matcher support. Offers code samples for matcher usage."
---

# Matchers

GoogleMock offers a **comprehensive catalog of built-in matchers** to precisely verify the correctness of arguments passed to mock methods during tests. Matchers power the expressive verification in `EXPECT_CALL` and `ON_CALL` statements, enabling you to specify expectations not just on *whether* a method was called, but *how* it was called — with what arguments and in what manner.

Beyond the basics, GoogleMock supports advanced and custom matcher implementations, giving you the flexibility to tailor your tests to complex or domain-specific requirements. This page catalogs the core built-in matchers, details usage patterns, and provides actionable examples that will empower your testing workflow.

---

## Overview

Matchers are predicates used to verify arguments in mocked method calls. They play a critical role in Google's C++ mocking framework, allowing test authors to state precise conditions on arguments passed to mocked functions. Each matcher can be used in:

- `EXPECT_CALL(mock_obj, Method(matcher1, matcher2, ...))` to set expectations
- `ON_CALL(mock_obj, Method(matcher1, matcher2, ...))` to set default behavior
- `EXPECT_THAT(value, matcher)` to assert properties on arbitrary values

Matchers can be simple (matching any value), or complex (matching computed properties, containers, pointers, etc). They also support composability and can be parameterized.

---

## Built-in Matchers Catalog

### Wildcard Matchers
- `_` — Matches any value of the correct type; the most common wildcard.
- `A<type>()` or `An<type>()` — Matches any value of the specified type.

### Comparison Matchers
| Matcher          | Description                                                |
|------------------|------------------------------------------------------------|
| `Eq(value)` or just `value` | Matches if argument equals `value` using `operator==` |
| `Ne(value)`      | Matches if argument not equal to `value`                   |
| `Ge(value)`      | Matches if argument >= `value`                             |
| `Gt(value)`      | Matches if argument > `value`                              |
| `Le(value)`      | Matches if argument <= `value`                             |
| `Lt(value)`      | Matches if argument < `value`                              |
| `IsTrue()`       | Matches if argument evaluates to boolean **true**         |
| `IsFalse()`      | Matches if argument evaluates to boolean **false**        |
| `IsNull()`       | Matches if argument is a null pointer (raw or smart)       |
| `NotNull()`      | Matches if argument is a non-null pointer                   |
| `Optional(m)`    | For optional types, matches if value is engaged and matches inner matcher `m`|
| `VariantWith<T>(m)` | For `std::variant`, matches if argument holds alternative type `T` and value matches `m`|
| `Ref(variable)`  | Matches if argument is a reference to `variable`           |
| `TypedEq<type>(value)` | Matches argument with exact type and equality to value (useful for resolving overload ambiguities) |

### Floating-Point Matchers
Designed to handle the intricacies of floating-point comparison, including NaN and tolerances:

| Matcher                         | Description                                                  |
|---------------------------------|--------------------------------------------------------------|
| `DoubleEq(a_double)`            | Approximate match of `double` values, treats NaN != NaN      |
| `NanSensitiveDoubleEq(a_double)`| Approximate match of `double`, treats NaN == NaN             |
| `FloatEq(a_float)`              | Approximate match of `float`, treats NaN != NaN              |
| `NanSensitiveFloatEq(a_float)` | Approximate match of `float`, treats NaN == NaN              |
| `DoubleNear(a_double, max_abs_error)` | Absolute error comparison for `double`                      |
| `FloatNear(a_float, max_abs_error)`     | Absolute error comparison for `float`                        |
| `NanSensitiveDoubleNear(a_double, max_abs_error)` | Absolute error with NaN equality for `double`      |
| `NanSensitiveFloatNear(a_float, max_abs_error)`   | Absolute error with NaN equality for `float`          |
| `IsNan()`                      | Matches any floating-point NaN value                          |

### String Matchers
Use with C strings and `std::string` objects for expressive string validation:

| Matcher             | Description                                         |
|---------------------|-----------------------------------------------------|
| `ContainsRegex(string)`  | Matches if argument matches the given regex      |
| `MatchesRegex(string)`   | Matches if entire argument matches regex          |
| `StartsWith(prefix)`     | Matches if argument starts with the prefix        |
| `EndsWith(suffix)`       | Matches if argument ends with the suffix           |
| `HasSubstr(string)`      | Matches if argument contains substring             |
| `StrEq(string)`          | Case-sensitive equality                             |
| `StrNe(string)`          | Case-sensitive inequality                           |
| `StrCaseEq(string)`      | Case-insensitive equality                           |
| `StrCaseNe(string)`      | Case-insensitive inequality                         |
| `WhenBase64Unescaped(matcher)` | Matches base64 escaped string whose unescaped value matches `matcher` |

### Exception Matchers
Verify that callable expressions throw exceptions matching criteria:

| Matcher                                | Description                                          |
|--------------------------------------|------------------------------------------------------|
| `Throws<E>()`                        | Throws exception of type `E`                         |
| `Throws<E>(m)`                      | Throws exception of type `E` whose value matches `m`|
| `ThrowsMessage<E>(m)`               | Throws exception of type `E` with a message matching `m` |

### Container Matchers
For STL-style containers or native arrays, these matchers provide fine-grained control over the elements within containers:

| Matcher                | Description                                                    |
|------------------------|----------------------------------------------------------------|
| `SizeIs(m)`            | Container's size matches the matcher `m`                      |
| `BeginEndDistanceIs(m)`| Distance between `begin()` and `end()` iterators matches `m`|
| `ContainerEq(container)`| Container equals `container` with detailed element mismatch info|
| `ElementsAre(...)`     | Container's elements match specified matchers in order        |
| `ElementsAreArray(...)`| Like `ElementsAre` but from array or container                 |
| `UnorderedElementsAre(...)` | Container elements match matchers in any order              |
| `UnorderedElementsAreArray(...)`| Like `UnorderedElementsAre` but from array/container        |
| `Contains(e)`          | Container contains an element matching `e`                    |
| `Contains(e).Times(n)` | Number of elements matching `e` equals `n`                    |
| `Each(e)`              | Every element matches matcher `e`                              |
| `IsSubsetOf(container)`| Container is subset of elements matching matchers in container |
| `IsSupersetOf(container)`| Container is superset; contains all elements matching matchers |
| `Pointwise(m, container)`| Matches elements pairwise with container using matcher `m`    |
| `UnorderedPointwise(m, container)` | Like Pointwise but ignores order                           |

### Member Matchers
For matching within object fields or properties:

- `Field(&Class::field, matcher)` — matches objects whose member variable `field` matches `matcher`.
- `Field(field_name, &Class::field, matcher)` — same as above but with an explicit field name for clearer error messages.
- `Property(&Class::property, matcher)` — matches objects whose method `property()` returns a value matching `matcher`.
- `Property(property_name, &Class::property, matcher)` — same as above with name.

### Pointer Matchers
Matchers for pointer arguments, both raw and smart pointers:

- `Pointee(m)` — Matches a pointer if it points to a value matching `m`.
- `Pointer(m)` — Matches if the pointer itself matches `m` (the raw pointer within if smart pointer).
- `Address(m)` — Matches if the address of the argument matches `m`.
- `WhenDynamicCastTo<T>(m)` — Matches if `dynamic_cast<T>` of the argument matches `m` (requires RTTI).

### Multi-Argument and Composite Matchers
You can match argument tuples as a whole:
- `With(multi_arg_matcher)` — Specifies that the tuple of arguments matches matcher `m`.
- `AllArgs(m)` — Syntactic sugar equivalent to `m` for all arguments.
- `Args<N1, N2, ..., Nk>(m)` — Matches a subset of arguments by indices.
- Combinators: `AllOf(...)`, `AnyOf(...)`, `Not(m)`, `Conditional(cond, m1, m2)`.

---

## Usage Patterns and Examples

### Basic Matcher Usage
```cpp
using ::testing::_;
using ::testing::Eq;

EXPECT_CALL(mock_obj, Foo(Eq(5), _));
```
Expects `Foo` to be called with first argument equal to 5 and second argument anything.

### Using Wildcards
```cpp
EXPECT_CALL(mock_obj, Bar(_));
```
Matches any call to `Bar` regardless of arguments.

### Combined and Parameterized Matchers
```cpp
EXPECT_CALL(mock_obj, Baz(AllOf(Ge(0), Lt(10))));
```
Matches calls where argument is between 0 and 9 inclusive.

### Container Matchers
```cpp
EXPECT_CALL(mock_obj, ProcessVector(ElementsAre(1, 2, 3)));
```
Ensures argument container holds exactly 1, 2, 3 in order.

### Pointer Matchers
```cpp
EXPECT_CALL(mock_obj, AcceptPtr(Pointee(Gt(5))));
```
Expects pointer argument that points to a value greater than 5.

### Matching Struct Members
```cpp
struct Foo { int x; std::string y; };
EXPECT_CALL(mock_obj, AcceptFoo(Field(&Foo::x, Eq(5))));
```
Expect `AcceptFoo` to be called with a `Foo` struct whose `x` is 5.

### Matching Argument Tuples
```cpp
EXPECT_CALL(mock_obj, Func(_, _))
    .With(Args<0, 1>(Lt())); // First argument less than second
```

### Floating Point and String Matchers
```cpp
EXPECT_THAT(value, DoubleNear(3.1415, 0.001));
EXPECT_THAT(str, StartsWith("hello"));
```

### Exception Checking
```cpp
EXPECT_THAT([](){ throw std::runtime_error("fail"); }, Throws<std::runtime_error>());
```

---

## Custom Matchers

When built-in matchers don’t meet your specific needs, you can write custom ones using the macro-based or class-based APIs. For quick definitions, use:

```cpp
MATCHER(IsEven, "checks if a number is even") { return (arg % 2) == 0; }
```

Parameterized custom matcher:

```cpp
MATCHER_P(IsBetween, range, "is within range") {
  return arg >= range.first && arg <= range.second;
}
```

Use custom matchers anywhere built-in matchers are used. 

---

## Best Practices

- Prefer **matchers** over raw values for clarity and flexibility.
- Use `_` to ignore arguments not relevant to the test.
- Combine matchers using `AllOf()`, `AnyOf()`, and `Not()` for complex conditions.
- When matching containers, choose `ElementsAre` for ordered and `UnorderedElementsAre` for unordered sequences.
- Use `With()` to impose constraints on the entire argument tuple.
- Write custom matchers for domain-specific logic to increase test expressiveness.
- Suppress uninteresting call warnings using `NiceMock` when you do not want to verify calls.

---

## Troubleshooting

- **Overly strict matchers causing failures:** Relax argument constraints or use wildcards for non-critical arguments.
- **Ambiguity with overloaded methods:** Use `TypedEq<type>()`, `An<type>()`, or `Const()` to disambiguate overloads.
- **Default action being taken unexpectedly:** Verify that the `EXPECT_CALL` or `ON_CALL` clauses are properly set and matched.
- **Unexpected calls:** Ensure that all relevant calls have expectations or default actions set; otherwise, the test will fail.

---

## Summary

Matchers provide the foundation for expressive, readable, and precise test verification in GoogleMock. Mastering both built-in and custom matchers dramatically improves test quality, easing maintenance while catching defects early. With matchers, you can describe *what* arguments are expected clearly, enabling robust behavioral testing of complex software.

---

For a detailed reference on matchers, see the [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md).

For hands-on usage and examples, refer to:
- [gMock Cheat Sheet](https://github.com/google/googletest/blob/main/docs/gmock_cheat_sheet.md)
- [gMock for Dummies](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md)
- [Writing Custom Matchers](https://github.com/google/gooogletest/blob/main/docs/gmock_cook_book.md#NewMatchers)

