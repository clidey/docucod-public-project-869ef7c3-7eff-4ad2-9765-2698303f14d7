---
title: "Mocking: Class and Method Mocking"
description: "A hands-on overview of mocking C++ class methods with GoogleMock. Includes the MOCK_METHOD macros, mock class setup, defining mock interfaces, and invoking mock expectations in test scenarios. Guidance on best practices for robust, clear mocks."
---

# Mocking: Class and Method Mocking

GoogleMock provides a powerful, expressive framework to create mock classes and mock individual methods for C++ interfaces. This documentation walks you through the practical steps to mock class methods using the `MOCK_METHOD` macro, properly set up mock classes, define mock interfaces, and construct well-structured test scenarios that verify method expectations. It also offers best practices to build clear, robust mocks that test the interactions your code performs.

---

## Understanding What You Can Achieve

Mocking class methods allows you to replace complex or external dependencies with controllable mock objects. This empowers you to:

- Verify how your code calls certain methods (arguments, call order, frequency).
- Simulate method behaviors dynamically, including return values and side effects.
- Isolate units under test by mocking collaborators.

By mocking methods, you transition from testing outcomes to testing interactions, a critical distinction for integration-heavy code.

---

## Defining Mock Classes: The Essentials

### Using `MOCK_METHOD`

At the heart of mocking methods in GoogleMock is the `MOCK_METHOD` macro. It defines a mocked method inside your mock class that overrides the corresponding virtual method in the interface you are mocking.

#### Syntax Overview

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- `ReturnType`: The return type of the original method.
- `MethodName`: Name of the method to mock.
- `(Args...)`: Parenthesized list of argument types.
- `(Qualifiers)`: Optional list like `const`, `override`, `noexcept`, reference qualifiers.

#### Example

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

**Important:**

- Always put `MOCK_METHOD` declarations in the `public:` section regardless of whether the original method is protected or private.
- When mocking a `const` method, include `const` in the qualifiers.
- Use `override` to enforce overriding the base method, improving clarity and compiler checks.

### Handling Complex Signatures

When argument or return types contain commas (e.g., template types like `std::pair<bool, int>`), wrap the return type or argument in extra parentheses or use `using` type aliases to avoid macro parsing errors.

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

  // Or with type aliases
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

### Mocking Overloaded Methods

You can mock overloaded methods by defining a `MOCK_METHOD` for each variant including correct qualifiers:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));

  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

**Tip:** If you don't want to mock certain overloads, bring base class versions into scope by `using`:

```cpp
using Foo::Add;
```

---

## Setting Up Expectations on Mocked Methods

Once your mock class is ready, you create mock objects and set expectations with `EXPECT_CALL`. This defines the expected interactions:

```cpp
EXPECT_CALL(mock_object, MethodName(ArgumentMatchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

### Typical Workflow

1. Create mock instance.<br>2. Optionally set default method behaviors with `ON_CALL`.<br>3. Define expectations for calls you want to verify using `EXPECT_CALL`.<br>4. Exercise the test code that uses the mock.<br>5. GoogleMock verifies expectations automatically at mock destruction.

Example:

```cpp
MockFoo foo;

ON_CALL(foo, GetSize())
    .WillByDefault(Return(42));

EXPECT_CALL(foo, Process(_, 3))
    .Times(Exactly(1))
    .WillOnce(Return(true));

// Code under test that uses foo
SomeFunctionUsingFoo(&foo);
```

### Key Points

- `EXPECT_CALL` must be set **before** the method is called; otherwise, behavior is undefined.
- Use matchers like `_` when you don't care about specific argument values.
- Specify cardinalities (`Times()`) to control expected invocation counts.
- Use `WillOnce()` and `WillRepeatedly()` to specify side effects or return values.

---

## Mock Object Variants: Nice, Naggy, and Strict

GoogleMock provides three wrapper mock types to control how uninteresting calls (calls for which no expectations exist) are handled:

- **NiceMock**: Suppresses warnings for uninteresting calls. Use for noisy interfaces or when minimal fuss is desired.

- **NaggyMock**: Default behavior that warns on uninteresting calls.

- **StrictMock**: Treats uninteresting calls as failures.

Example:

```cpp
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, DoSomething());  // Warnings for other calls suppressed

StrictMock<MockFoo> strict_foo;
EXPECT_CALL(strict_foo, DoSomething());  // Fails if other methods called
```

**Warning:** Only affects uninteresting calls; unexpected calls (calls that do not match any expectation) always cause errors.

---

## Invoking Mock Expectations: Practical Test Scenario

Follow these steps to integrate mocks effectively in your tests:

<Steps>
<Step title="Define the Mock Class">
Use `MOCK_METHOD` macros inside a class that inherits from the interface to override methods.
</Step>
<Step title="Create Mock Object">
Instantiate the mock in your test body or fixture.
</Step>
<Step title="(Optional) Provide Default Behavior">
Use `ON_CALL` to specify default return values or actions for methods where you do not necessarily expect explicit calls.
</Step>
<Step title="Set Expectations">
Use `EXPECT_CALL` for all methods you want to verify calls to. Specify matchers and cardinalities.
</Step>
<Step title="Exercise Code Under Test">
Run the component that calls the mock methods, triggering the expectations.
</Step>
<Step title="Automatic Verification">
On test exit, mocks verify all expectations are met. Failures report mismatches instantly.
</Step>
</Steps>

Example:

```cpp
TEST(CircleDrawerTest, DrawCallsPenDownAndForward) {
  MockTurtle turtle;  // Mock implementation of Turtle interface

  EXPECT_CALL(turtle, PenDown())
      .Times(1);
  EXPECT_CALL(turtle, Forward(::testing::Gt(0)))  // Expect Forward called with positive distance
      .Times(::testing::AtLeast(1));

  CircleDrawer drawer(&turtle);
  drawer.DrawCircle(10);
}
```

---

## Best Practices for Robust Mocks

- **Mock only owned or stable interfaces:** Avoid mocking dependencies you do not maintain; centralize mock definitions close to the owners.
- **Keep mocks simple:** Use mocks primarily for interaction testing, not for complex state simulation.
- **Use type aliases for complex signatures:** Enhance readability and reduce macro parsing issues.
- **Leverage `NiceMock` or `StrictMock` appropriately:** Choose the appropriate strictness to balance noisy test output with early bug detection.
- **Avoid over-specifying matchers and times:** Restrain your expectations to what truly matters in the test scenario.
- **Set expectations **before** passing mocks to code under test:** Avoid undefined behavior.
- **Use sequences (`InSequence`) when order matters:** Express strict or partial order constraints clearly.
- **Delegate to fakes or real objects if behavior is complex:** Use delegation patterns to reuse behavior while benefiting from verification.

---

## Troubleshooting Common Pitfalls

- **Methods not virtual:** Only virtual methods can be mocked with `MOCK_METHOD`. Ensure your interfaces have virtual destructors.
- **Incorrect qualifiers:** Mismatch of `const`, `noexcept`, or ref qualifiers between base method and mock method causes compilation errors.
- **Mock method declarations outside `public:`:** Put all `MOCK_METHOD` macros in public sections.
- **Overly strict specifications:** Excessive or exact argument matchers cause fragile tests; use wildcards `_` when exact value is unimportant.
- **Uninteresting call warnings:** Occur when methods without `EXPECT_CALL` get invoked. Suppress with `NiceMock` or add catch-all `EXPECT_CALL(...).Times(AnyNumber())`.
- **Order of `EXPECT_CALL` matters:** Later rules override earlier ones; arrange expectations accordingly.

---

## Summary

This page provided a comprehensive, hands-on guide to mocking class methods with GoogleMock. You learned how to:

- Define mock classes with `MOCK_METHOD`, including handling complicated method signatures and qualifiers.
- Use `EXPECT_CALL` to specify call expectations, match arguments, and define invocation counts and behaviors.
- Employ mock wrapper types like `NiceMock`, `NaggyMock`, and `StrictMock` for controlling uninteresting call reports.
- Structure test scenarios applying mock objects effectively to verify interaction correctness.
- Follow best practices to maintain clear, robust, and maintainable mocks.
- Address common issues and pitfalls encountered during mocking.

For a deeper exploration of matchers, actions, expectations ordering and advanced patterns, please refer to the following complementary documentation:

- [Mocking Reference](reference/mocking.md)
- [gMock Cheat Sheet](gmock_cheat_sheet.md)
- [Mocking for Dummies](gmock_for_dummies.md)
- [gMock Cookbook](gmock_cook_book.md)

---

## Additional Resources

- GoogleMock official repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- Interactive documentation for matchers and actions
- Guides on writing custom actions and matchers

---

For comprehensive understanding, explore how this page integrates with broader documentation - especially mock behavior control strategies, and foundational concepts in the Mocking Reference and gMock for Dummies guides.
