---
title: "Actions"
description: "Documents actions—predefined, custom, and composable—that can be used with mock expectations to simulate side effects and return values. Explains how to use, compose, and extend actions in test doubles for rich behavioral testing."
---

# Actions Reference

[**Actions**](../gmock_for_dummies.md#actions-what-should-it-do) specify what a mock function should do when invoked. This reference details the predefined actions that GoogleTest provides to simulate side effects and return values in mocks. Actions empower your mock expectations with rich behavioral definitions.

All actions are defined in the `::testing` namespace.

---

## Returning a Value

Actions that return values control the result of a mock function call. They can return fixed values, values derived from arguments or external state, or cycle through a list of values.

| Action | Description |
| --- | --- |
| `Return()` | Return from a `void` mock function (no value).
| `Return(value)` | Return `value`. The return type of `value` is converted to match the mock function’s return type at expectation setup time (not invocation time). Use carefully when value changes over time.
| `ReturnArg<N>()` | Return the `N`-th (0-based) argument passed to the mock function.
| `ReturnNew<T>(a1, ..., ak)` | Return a new dynamically allocated object `new T(a1, ..., ak)` on each invocation, producing a fresh object every time.
| `ReturnNull()` | Return a null pointer.
| `ReturnPointee(ptr)` | Return the value pointed to by `ptr` at invocation time. Useful to return a live-updated value.
| `ReturnRef(variable)` | Return a reference to `variable`. Use when mock method returns by reference.
| `ReturnRefOfCopy(value)` | Return a reference to a copy of `value`. The copy lives as long as the action object. Useful to avoid returning references to temporaries.
| `ReturnRoundRobin({a1, ..., ak})` | On each call, return the next value from the list cyclically, resetting to the start after the end.

**Example:**

```cpp
using ::testing::Return;
EXPECT_CALL(mock, GetCount())
    .WillOnce(Return(5))
    .WillOnce(Return(10))
    .WillRepeatedly(Return(20));
```

This makes the first two calls return 5 and 10 respectively, all subsequent calls return 20.

---

## Side Effects

Side-effect actions simulate behaviors by modifying function arguments or program state when a mock method is called.

| Action | Description |
| --- | --- |
| `Assign(&variable, value)` | Assign `value` to `variable`. Useful to simulate changing external state.
| `DeleteArg<N>()` | Delete the N-th argument (0-based), which must be a pointer. Useful when mocking ownership transfer.
| `SaveArg<N>(pointer)` | Save the N-th argument’s value into `*pointer` by copy.
| `SaveArgByMove<N>(pointer)` | Save the N-th argument by move into `*pointer`. Useful for movable-only arguments.
| `SaveArgPointee<N>(pointer)` | Save the value pointed to by the N-th argument into `*pointer`.
| `SetArgReferee<N>(value)` | Assign `value` to the reference pointed to by the N-th argument.
| `SetArgPointee<N>(value)` | Assign `value` to the object pointed to by the N-th argument.
| `SetArgumentPointee<N>(value)` | Same as `SetArgPointee<N>(value)`. Deprecated and will be removed.
| `SetArrayArgument<N>(first, last)` | Copies values from range `[first, last)` into the array pointed to by N-th argument. Useful for output arrays or iterator ranges.
| `SetErrnoAndReturn(error, value)` | Sets the global `errno` to `error` and returns `value`. Ideal for simulating system call failures.
| `Throw(exception)` | Throws the given exception. The exception must be copyable. Requires C++11 or higher. Useful for testing error handling.

**Example:**

```cpp
using ::testing::SetArgPointee;
EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(SetArgPointee<1>(42)); // Assign 42 to 2nd param pointer.
```

---

## Using a Function, Functor, or Lambda as an Action

Actions can also be arbitrary callable objects executed when the mock method is invoked. These provide great flexibility.

| Action | Description |
| --- | --- |
| `f` | Call function or callable `f` with the mock method arguments. The return value of `f` is returned from the mock method.
| `Invoke(f)` | Like `f`, but allows passing global/static functions or functors.
| `Invoke(object_pointer, &class::method)` | Call the member method on the object with the mock function arguments.
| `InvokeWithoutArgs(f)` | Call `f` without any arguments when mock method is invoked.
| `InvokeWithoutArgs(object_pointer, &class::method)` | Call no-arg member method on object.
| `InvokeArgument<N>(arg1, arg2, ..., argk)` | Invoke the N-th argument (0-based) passed to the mock function as a callable with provided arguments. Useful for triggering callbacks.

When implementing callable actions, you may ignore unused parameters by declaring them as `Unused` for clarity.

**Example:**

```cpp
using ::testing::Invoke;
EXPECT_CALL(mock, Process(_)).WillOnce(Invoke(&RealObject::Process));
```

Or invoking a callback argument:

```cpp
EXPECT_CALL(mock, DoWork(_, _))
    .WillOnce(InvokeArgument<1>(5)); // call 2nd arg callable with 5
```

---

## Default Action

| Action | Description |
| --- | --- |
| `DoDefault()` | Execute the default action for the mock method as set by `ON_CALL()` or fallback to the built-in default. Cannot be used inside composite actions.

---

## Composite Actions

Composite actions combine multiple actions or modify their behavior for complex scenarios.

| Action | Description |
| --- | --- |
| `DoAll(a1, a2, ..., an)` | Perform all actions `a1` to `an` sequentially each time the mock method is called. The return value of the last action `an` is used as the return value for the mock method. Only the last action can return non-void.
| `IgnoreResult(a)` | Perform action `a` but discard its return value (used when return type is `void`). Ensure `a` itself returns non-void.
| `WithArg<N>(a)` | Pass the N-th (0-based) argument to action `a` and perform it. Useful to isolate a single argument for processing.
| `WithArgs<N1, N2, ..., Nk>(a)` | Pass selected arguments to `a`. Allows argument reordering and repetition.
| `WithoutArgs(a)` | Perform action `a` without any arguments.

**Example:**

```cpp
EXPECT_CALL(mock, DoSomething(_))
    .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));
```

This sets argument 0 to 42 and then returns `true`.

---

## Defining Custom Actions

When predefined actions are insufficient, you can define custom actions:

- Use **`ACTION` macros** to quickly define actions that use mock function arguments `arg0`, `arg1`, etc.
- Define **typed functor objects or lambdas** with appropriate call signatures that match the mock method.
- Use **`Invoke()`** to wrap existing functions, lambdas, or functors.
- For polymorphic or reusable actions, implement `ActionInterface` or use `MakePolymorphicAction()`.

**Example defining a simple action:**

```cpp
ACTION(IncrementArg1) { return ++(*arg1); }

EXPECT_CALL(mock, Foo(_))
    .WillOnce(IncrementArg1());
```

**Parameterized action:**

```cpp
ACTION_P(Plus, n) { return arg0 + n; }

EXPECT_CALL(mock, Foo(_))
    .WillOnce(Plus(5)); // returns arg0 + 5
```

---

## Practical Tips and Best Practices

- Use `ON_CALL()` to define default behavior without requiring calls.
- Use `EXPECT_CALL()` to both define behavior and set expectations that calls will happen.
- Carefully select actions for different invocations using `.WillOnce()` and `.WillRepeatedly()`.
- Use `DoAll()` to combine side effects and return values.
- Use `InvokeArgument<N>()` to simulate asynchronous callbacks by invoking function objects passed as parameters.
- When returning references, use `ReturnRef()` rather than `Return()`.
- Use `ReturnPointee()` to return the current value pointed to by a pointer instead of a captured snapshot.
- Design reusable actions by implementing custom functors or using `ACTION` macros for clarity and maintainability.
- Chain actions correctly in `DoAll()`, ensuring the last action returns a value if the mock method is non-void.

---

## Troubleshooting Common Issues

- **Return Value Issues:** Returning dynamically allocated objects with `Return(new T(...))` returns the same pointer every time unless wrapped in `ReturnNew<T>()`.
- **Side Effects Without Return Value:** Use `DoAll()` to combine side effects like `SetArgPointee()` with return values.
- **Uninteresting Calls Warning:** If a mock method is called without expectations, gMock prints a warning unless you suppress it with `NiceMock` or `EXPECT_CALL(...).Times(AnyNumber())`.
- **Callbacks Not Invoked:** Use `InvokeArgument<N>()` to simulate calling a function pointer or callback passed as an argument.
- **Returning Live Values:** `ReturnPointee()` returns the pointed-to value at call time; `Return()` returns a copied snapshot made when the expectation is set.

---

For further examples, use cases, and deep dives into custom actions and advanced behaviors, consult the [gMock Cookbook](../gmock_cook_book.md#using-actions), the [Mocking Reference](../reference/mocking.md), and the [Matchers API](../api-reference/core-apis/matchers-api.md).

<Accordion title="Example: Combining Multiple Actions Using DoAll()">
```cpp
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Return;

class MockMutator : public Mutator {
 public:
  MOCK_METHOD(bool, Mutate, (int* value), (override));
};

TEST(MutatorTest, SetsValueAndReturnsTrue) {
  MockMutator mutator;
  EXPECT_CALL(mutator, Mutate(_))
      .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));

  int x = 0;
  bool result = mutator.Mutate(&x);
  EXPECT_TRUE(result);
  EXPECT_EQ(x, 42);
}
```
</Accordion>

<Accordion title="Example: Returning a Value from a Mock Function">
```cpp
using ::testing::Return;

EXPECT_CALL(mock_obj, GetValue())
    .WillOnce(Return(100));

int val = mock_obj.GetValue(); // val == 100
```
</Accordion>

<Accordion title="Example: Invoking a Callback Argument">
```cpp
using ::testing::InvokeArgument;

EXPECT_CALL(mock_obj, RegisterCallback(_))
    .WillOnce(InvokeArgument<0>(42)); // Invokes the first argument with 42
```
</Accordion>