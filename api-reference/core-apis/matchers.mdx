---
title: "Matchers"
description: "Covers built-in and extensible matcher interfaces used to enhance test assertions and mock expectations. Explains matcher composition patterns, available core matchers, and how to write custom matchers for domain-specific needs."
---

# Matchers

Matchers in GoogleTest and GoogleMock offer a powerful, expressive, and extensible way to specify expectations and assertions over values passed to mock methods or checked in your tests. They serve as semantic predicates that can validate function arguments, return values, or any data types, providing rich and human-readable failure messages to help diagnose test issues effectively.

---

## Overview

Matchers provide intuitive means for verifying that values or function arguments meet certain requirements—such as equality, inequality, containment, or custom predicates. They can be combined, parameterized, and customized to cover a nearly unlimited range of conditions, greatly enhancing your test specifications.

Matchers are extensively used in:

- Setting expectations on mock method calls with `EXPECT_CALL`.
- Verifying test values using `EXPECT_THAT` or `ASSERT_THAT`.
- Writing custom assertions that are descriptive and maintainable.

All matchers are designed to be **purely functional** and **side-effect free**, ensuring repeatable and reliable test validation.

---

## Built-in Core Matchers

GoogleMock provides a comprehensive set of polymorphic and monomorphic matchers, meaning they adapt to the types they are used with or specifically match a single type.

### Wildcard Matcher

- `_` — Matches any value of any type, equivalent to `A<T>()` or `An<T>()`.

### Comparison Matchers

- `Eq(value)` / implicit equality: Tests if the argument equals `value`.
- `Ne(value)` — Not equal.
- `Lt(value)` — Less than.
- `Le(value)` — Less or equal.
- `Gt(value)` — Greater than.
- `Ge(value)` — Greater or equal.

### Floating-Point Approximate Matchers

- `FloatEq(value)` — Approximate equality for `float`.
- `DoubleEq(value)` — Approximate equality for `double`.
- `FloatNear(value, abs_error)` — Approximate equality within absolute error for `float`.
- `DoubleNear(value, abs_error)` — Same for `double`.

### Pointer Matchers

- `IsNull()` — Matches null pointers (raw and smart).
- `NotNull()` — Matches non-null pointers.
- `Pointee(matcher)` — Matches pointer pointing to a value that matches `matcher`.
- `Pointer(matcher)` — Matches pointer itself against the matcher.
- `Address(matcher)` — Matches the address of an object.

### Container Matchers

- `Contains(value_or_matcher)` — Matches if it contains an element that matches.
- `Each(matcher)` — Matches if all elements match.
- `ElementsAre(...)` / `ElementsAreArray(...)` — Matches for exact element sequence.
- `UnorderedElementsAre(...)` — Matches for elements without regard to order.
- `SizeIs(matcher)` — Matches containers whose size matches.
- `Pointwise(tuple_matcher, rhs_container)` — Matches container elements pairwise.
- `IsSubsetOf(...)` / `IsSupersetOf(...)` — Matches subset or superset containment.

### String Matchers

- `StrEq(string)` — Case-sensitive string equality.
- `StrCaseEq(string)` — Case-insensitive string equality.
- `StrNe(string)` / `StrCaseNe(string)` — Negations.
- `HasSubstr(substring)` — Contains substring.
- `StartsWith(prefix)` — String starts with prefix.
- `EndsWith(suffix)` — String ends with suffix.

### Compound and Logical Matchers

- `AllOf(m1, m2, ...)` — Logical AND of multiple matchers.
- `AnyOf(m1, m2, ...)` — Logical OR of multiple matchers.
- `Not(matcher)` — Logical negation.
- `Conditional(cond, matcher_true, matcher_false)` — Chooses matcher based on a condition.

### Utility Matchers

- `Truly(predicate)` — Uses an arbitrary unary predicate function.
- `ResultOf(callable, matcher)` — Matches the result of a callable applied to the object.
- `Field(field_ptr, matcher)` — Matches an object based on a member variable.
- `Property(property_method, matcher)` — Matches an object based on a const getter method.
- `Key(matcher)` — Matches key in a key-value pair.
- `Pair(matcher1, matcher2)` — Matches value pairs.
- `Optional(matcher)` — Matches types supporting optional semantic.

---

## Using Matchers

Matchers can be used directly as arguments to `EXPECT_CALL` or `EXPECT_THAT`. For example:

```cpp
using ::testing::_;             // Wildcard matcher
using ::testing::Ge;
using ::testing::Contains;

EXPECT_CALL(mock, ProcessItems(Contains(Ge(5))));
EXPECT_THAT(container, ElementsAre(1, Ge(5), _));
```

### Combining Matchers

Matchers can be combined through logical connectors to express complex requirements:

```cpp
EXPECT_CALL(mock, SetValue(AllOf(Ge(0), Le(100))));  // Value between 0 and 100
EXPECT_THAT(name, AnyOf(StartsWith("Mr."), StartsWith("Mrs.")));
EXPECT_CALL(mock, Func(Not(Contains("bad_substring"))));
```

### Matcher Polymorphism

Matchers adapt their behavior based on the type of arguments they are matching against, supporting built-in types, pointers, containers, user-defined types, smart pointers, and more.

### Parameterized Matchers

Many matchers accept arguments for fine-tuning:

- `HasSubstr("test")` matches strings containing "test".
- `ElementsAre(1, _, Ge(5))` matches containers with three elements, with specified matchers.

---

## Writing Custom Matchers

GoogleMock provides convenient macros to define custom matchers for domain-specific conditions.

### Simple Custom Matchers Using `MATCHER` Macro

Creates a matcher without parameters.

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(mock, Foo(IsEven()));
EXPECT_THAT(value, IsEven());
```

The description string can be customized to provide context sensitive messages.

### Adding Explanations

You can explain match failures using a `result_listener`:

```cpp
MATCHER(IsEven, "") {
  if ((arg % 2) == 0) return true;
  *result_listener << "which has a remainder of " << (arg % 2);
  return false;
}
```

### Parameterized Matchers Using `MATCHER_P` Macro

Create matchers with one or more parameters:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}

// Usage:
EXPECT_THAT(number, HasAbsoluteValue(10));
```

You can use up to 10 parameters via `MATCHER_P2` ... `MATCHER_P10`.

### Custom Matcher Classes

For more control, you can implement matcher classes with the following methods:

- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const` — Does the actual matching and explanation.
- `void DescribeTo(std::ostream* os) const` — Describes the matcher.
- `void DescribeNegationTo(std::ostream* os) const` — Describes negation.

Example:

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, MatchResultListener* os) const {
    if (n % 7 == 0) return true;
    if (os) *os << "the remainder is " << (n % 7);
    return false;
  }

  void DescribeTo(std::ostream* os) const { *os << "is divisible by 7"; }
  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not divisible by 7";
  }
};

inline ::testing::Matcher<int> DivisibleBy7() {
  return ::testing::Matcher<int>(new ::testing::MatcherInterface<int>(...));
}
```

---

## Best Practices

- Prefer built-in matchers and their combinators for clarity and maintenance.
- Use `MATCHER` macros for simple custom matchers — they're concise and effective.
- For complex scenarios or reusable matchers, implement custom classes.
- Use matchers to validate members or properties of objects via `Field()` and `Property()`.
- Use `Pointee()` to validate pointer targets safely without worrying about null pointers.
- Combine matchers logically to express complex conditions clearly.
- Use parameterized matchers to make assertions dynamic and informative.
- Avoid side effects in matchers; they must be purely functional.

---

## Troubleshooting Common Matcher Issues

- **Compilation Errors:** Use `SafeMatcherCast<T>(m)` to resolve type compatibility issues when a matcher type does not exactly match the argument type.
- **Ambiguous Overloads:** Use wrappers like `Const()` or specify types explicitly to resolve overloaded method matchers.
- **Poor Failure Messages:** Improve your matcher’s description or provide detailed explanations within `MatchAndExplain`.
- **Null Pointer Crashes:** Use `NotNull()` or `Pointee()` to ensure safe pointer matching.
- **Unexpected Match Failures:** Verify that your matcher logic correctly accounts for all edge cases.

---

## Example: Using Matchers in Tests

```cpp
#include <gmock/gmock.h>
using ::testing::_;
using ::testing::Ge;
using ::testing::Contains;
using ::testing::ElementsAre;

// A mock class with a method to test
class MockFoo {
 public:
  MOCK_METHOD(void, Process, (const std::vector<int>&), ());
};

void TestFoo(MockFoo& mock) {
  std::vector<int> input = {1, 2, 3, 4, 5};
  mock.Process(input);
}

TEST(FooTest, MatcherExample) {
  MockFoo mock;
  
  // Expect Process to be called with a vector containing
a number >= 4
  EXPECT_CALL(mock, Process(Contains(Ge(4))));

  TestFoo(mock);
  
  // Expect Process to be called with exactly these elements
  EXPECT_CALL(mock, Process(ElementsAre(1, 2, _, 4, 5)));
  
  TestFoo(mock);
}
```

---

## Additional Resources

- For complete matcher references and advanced usage, see the official [Matchers Reference](https://google.github.io/googletest/reference/matchers.html).
- Learn how to define new matchers quickly in the [gMock Cookbook: Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#new-matchers).
- Use matchers effectively in assertions with `EXPECT_THAT()` in the [Assertions Reference](https://google.github.io/googletest/reference/assertions.html#EXPECT_THAT).
- Explore mocking basics and advanced patterns in the [Mocking Basics](https://google.github.io/googletest/gmock_for_dummies.html) and [Composing Powerful Mocks](https://google.github.io/googletest/gmock_cook_book.html#composing-powerful-mocks) guides.

---