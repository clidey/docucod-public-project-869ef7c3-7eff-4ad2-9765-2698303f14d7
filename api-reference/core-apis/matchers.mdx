---
title: "Matchers"
description: "Descriptions and practical usage of matcher APIs, including built-in matchers and custom matcher creation. Explore syntactic variants and learn how matchers improve test readability and robustness."
---

# Matchers

Matchers in GoogleTest and GoogleMock provide a powerful, expressive way to specify expected argument values in mock function calls and assertions. This page covers the built-in matchers, how to use them effectively, and how to create custom matchers to improve the readability and robustness of your tests.

---

## What Are Matchers?

Matchers are predicates that describe the expected properties of arguments passed to mock functions or values checked in assertions. They allow tests to be precise about argument values without needing to specify exact matches.

By using matchers, you unlock:
- Intuitive expressiveness for complex argument validation
- Polymorphic behavior to handle multiple types
- Composability through combining matchers
- The ability to generate detailed failure explanations

GoogleMock expects you to use matchers inside `EXPECT_CALL` macros to anticipate the arguments passed to mock methods.

---

## Using Built-in Matchers

### Simple Matchers

You can use literal values as matchers, which implicitly behave as equality (`Eq`) matchers:

```cpp
EXPECT_CALL(mock_obj, Foo(7));  // Matches if arg == 7
```

If you aren’t concerned about an argument’s value, use the wildcard matcher `_` to match anything:

```cpp
EXPECT_CALL(mock_obj, Foo(_));  // Matches any single argument
EXPECT_CALL(mock_obj, Bar(_, _));  // Matches any two arguments
```

### Common Built-in Matchers

- `Eq(value)`: Matches arguments equal to `value` (same as literal)
- `Ne(value)`: Matches arguments not equal to `value`
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`: Matches based on comparison
- `IsNull()`, `NotNull()`: Matches null or non-null pointers
- `StrEq(str)`, `StrNe(str)`: String equality/inequality match (case-sensitive)
- `StrCaseEq(str)`, `StrCaseNe(str)`: String equality/inequality ignoring case
- `HasSubstr(substring)`: String contains substring
- `StartsWith(prefix)`, `EndsWith(suffix)`: String prefix and suffix matching
- `ContainsRegex(regex)`, `MatchesRegex(regex)`: Regular expression matching

### Combining Matchers

Matchers can be combined to express complex predicates using:
- `AllOf(m1, m2, ...)`: Matches if all provided matchers pass
- `AnyOf(m1, m2, ...)`: Matches if any one matcher passes
- `Not(m)`: Matches if `m` does not match

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Gt(5), Ne(10))));
EXPECT_CALL(mock, Foo(Not(HasSubstr("error"))));
```

### Container Matchers

For validating container contents, use:
- `ElementsAre(...)`: Matches container elements in order
- `UnorderedElementsAre(...)`: Matches elements regardless of order
- `ElementsAreArray(array)`: Matches elements to array contents
- `Contains(matcher)`: Matches if any element matches
- `Each(matcher)`: Matches if all elements match

Example:

```cpp
EXPECT_CALL(mock, ProcessVector(ElementsAre(1, 2, 3)));
EXPECT_CALL(mock, ProcessSet(UnorderedElementsAre(3, 1, 2)));
EXPECT_THAT(my_vector, Contains(Ge(5)));
EXPECT_THAT(my_vector, Each(Lt(10)));
```

### Specialized Argument Matchers

- `Pointee(matcher)`: Matches pointers to values matching matcher
- `Field(&Class::field, matcher)`: Matches objects whose member field matches
- `Property(&Class::getter, matcher)`: Matches objects whose property method returns value matching matcher
- `Key(matcher)`, `Pair(matcher1, matcher2)`: For key-value associative containers

Example:

```cpp
EXPECT_CALL(mock, UpdateFoo(Field(&Foo::id, Eq(42))));
EXPECT_THAT(pair, Pair(Ge(1), HasSubstr("foo")));
```

### Matching Multiple Arguments as a Whole

For functions with multiple arguments needing correlated validation (e.g., first less than second), use `.With()` clauses in expectations or match tuples via `Args<>`:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // First arg less than second

EXPECT_CALL(mock, Blah)
    .With(AllOf(Args<0,1>(Lt()), Args<1,2>(Lt())));
```

---

## Defining Custom Matchers

When the built-in matchers cannot express your intent clearly, write custom matchers.

### Quick Custom Matchers with Macros

Use the `MATCHER` family of macros to quickly create,
parameterized custom matchers:

- `MATCHER(name, description) { /* return bool */ }`
- `MATCHER_P(name, param, description) { /* use 'param' */ }`
- Supports `MATCHER_P2` ... `MATCHER_P10`

Inside, `arg` is the value being matched, and `arg_type` its type.

Example:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, ProcessValue(IsEven()));
```

You may add explanation via streaming to `*result_listener`:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if (arg % 7 != 0) {
    *result_listener << "which has remainder " << (arg % 7);
    return false;
  }
  return true;
}
```

Descriptions adapt automatically, but you can customize by providing a string expression referencing bool `negation`.

### Advanced Custom Matchers

For full control, implement a matcher class with methods:

- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Make a factory function returning a `testing::Matcher<T>` from it.

---

## Matcher Usage Tips and Best Practices

- Use `ON_CALL` to define behavior without requiring a call expectation.
- Use `EXPECT_CALL` to assert that a mock method will be called with particular arguments.
- Prefer specifying only relevant argument constraints — avoid over-specifying your expectations.
- Combine matchers with `AllOf` or `AnyOf` to increase expressiveness.
- When mocking methods with complex argument relationships, utilize `.With()` and `Args<>` for precise control.
- Use `SafeMatcherCast<Type>(matcher)` when matching against compatible but not identical types.

---

## Common Pitfalls and Troubleshooting

- **Uninteresting calls warnings:** If a mock method is called without an expectation, GoogleMock warns by default. Suppress with `NiceMock` or add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.
- **Overly sticky expectations:** By default, expectations in GoogleMock remain active even after being saturated. Use `.RetiresOnSaturation()` or sequences to make expectations retire.
- **Overloaded methods:** Help compiler select the correct overload using `Const()`, `Matcher<type>()`, or `TypedEq<type>()` wrappers.
- **Using non-copyable objects:** Match non-copyable/move-only types with caution; use lambdas or functors for actions.

---

## Example: Matching and Combining

```cpp
using ::testing::AllOf;
using ::testing::Ge;
using ::testing::Lt;
using ::testing::HasSubstr;
using ::testing::_;

EXPECT_CALL(mock, Foo(AllOf(Ge(10), Lt(20))));  // Argument should be between 10 (inclusive) and 20 (exclusive)
EXPECT_CALL(mock, Bar(StartsWith("Hello"), HasSubstr("gMock"), _));
```

---

## Summary

Matchers are the backbone of expressive, flexible argument validation in GoogleMock. Use a rich set of built-in matchers or create custom ones to clearly specify your expectations and make your tests maintainable and robust.

## See Also

- [Mocking Basics](../guides/mocking-and-test-doubles/mock-basics.md)
- [Advanced Mocking](../guides/mocking-and-test-doubles/advanced-mocking.md)
- [Assertions Reference](../api-reference/core-apis/assertions.md)
- [Actions Reference](../api-reference/mocking-apis/actions.md)
- [Writing Custom Matchers](../api-reference/advanced-customization/custom-matchers.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)

---

## References

- GoogleMock Matchers Source Code: [`googlemock/include/gmock/gmock-matchers.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-matchers.h)
- gMock For Dummies: https://google.github.io/googletest/gmock_for_dummies.html
- gMock Cheat Sheet: https://google.github.io/googletest/gmock_cheat_sheet.html
