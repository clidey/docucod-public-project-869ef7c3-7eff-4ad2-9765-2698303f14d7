---
title: "Matchers"
description: "Explains the core matcher APIs for fine-grained validation of values. Includes standard matchers for equality, containers, floating point, and composite/compound matchers, with examples and customization options."
---

# Matchers Reference

This page explains the core APIs for matchers used in GoogleTest and GoogleMock to achieve fine-grained validation of values passed in tests. Matchers form a foundation for specifying expressive, readable expectations and assertions about arguments, return values, container contents, and more.

---

## Overview

Matchers are predicates that define expectations about values in C++ tests. They check whether a value satisfies some condition and can provide detailed explanation messages when a test fails. They integrate seamlessly with assertions like `EXPECT_THAT` and mocking expectations such as `EXPECT_CALL`.

This reference covers:

- Standard matchers for primitive values and objects
- Container matching including elements and size
- Floating point matchers with approximate equality
- Composite and compound matchers for sophisticated conditions

Matchers are polymorphic and support intuitive syntax to make tests more maintainable and less brittle.

---

## Using Matchers in Tests

Matchers can be used to verify values in assertions:

```cpp
#include <gmock/gmock.h>

using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(name, StartsWith("Hello"));
EXPECT_THAT(text, MatchesRegex("Line \\d+"));
EXPECT_THAT(value, AllOf(Gt(5), Lt(10)));
```

They are also the key ingredients for setting expectations on mock function calls:

```cpp
using ::testing::_;
using ::testing::Return;

EXPECT_CALL(mock_turtle, GoTo(50, _));
EXPECT_CALL(mock_turtle, Forward(Gt(0)));  // Moves forward by >0

ON_CALL(mock_turtle, GetX()).WillByDefault(Return(42));
```

---

## Standard Matchers

- `_` matches any value (wildcard).
- `Eq(value)` matches values equal to `value`.
- `Ne(value)` matches values not equal to `value`.
- Comparison matchers: `Lt()`, `Le()`, `Gt()`, `Ge()` match values less than, less or equal, greater than, or greater or equal to a specified value.
- `Not(matcher)` inverts another matcher.
- `Truly(predicate)` accepts an arbitrary predicate function or lambda.

Example:

```cpp
EXPECT_CALL(foo, Bar(Eq(5)));
EXPECT_CALL(bar, Baz(Not(Lt(10))));
EXPECT_THAT(x, Truly([](int n) { return n % 2 == 0; }));  // even number
```

---

## Matchers for Containers

- `Contains(element_matcher)` matches if the container has at least one element matching `element_matcher`.
- `Each(matcher)` matches if *all* elements match the given matcher.
- `ElementsAre(m1, m2, ...)` matches a container with elements that match the given matchers exactly and in order.
- `UnorderedElementsAre(...)` matches if the container has exactly the given elements, but order does not matter.
- `SizeIs(matcher)` matches containers whose size matches the matcher (e.g., `SizeIs(2)`).
- `Pointwise(pair_matcher, rhs_container)` matches containers element-wise using a tuple matcher.

Example:

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(vec, Contains(Gt(10)));
EXPECT_THAT(set, Each(Ge(0)));
EXPECT_THAT(map, Contains(Pair(Ge(5), "foo")));
EXPECT_THAT(vec, SizeIs(4));
```

---

## Floating Point Matchers

Floating point comparisons use approximate equality due to rounding error:

- `FloatEq(value)` matches floats approximately equal to `value` within 4 ULPs.
- `DoubleEq(value)` matches doubles similarly.
- Variants `NanSensitiveFloatEq` and `NanSensitiveDoubleEq` treat NaNs as equal.
- `FloatNear(value, max_abs_error)` and `DoubleNear(value, max_abs_error)` allow custom absolute error bounds.

Example:

```cpp
EXPECT_THAT(3.14f, FloatNear(3.15f, 0.02f));
EXPECT_THAT(value, NanSensitiveDoubleEq(std::nan("")));
```

---

## Composite Matchers

Use combinators to build complex conditions:

- `AllOf(m1, m2, ...)` matches if all matchers are satisfied.
- `AnyOf(m1, m2, ...)` matches if any matcher is satisfied.

Example:

```cpp
EXPECT_THAT(value, AllOf(Gt(0), Lt(100)));
EXPECT_THAT(value, AnyOf(Eq(0), Eq(42)));
```

---

## Matcher Utilities

- `Field(&Class::member, matcher)` matches an object whose member matches.
- `Property(&Class::getter, matcher)` matches based on a getter method.
- `Pointee(matcher)` matches pointers/smart pointers pointing to a value matching `matcher`.
- `Key(matcher)` to match keys in map-like containers.
- `Pair(matcher1, matcher2)` to match pairs or tuples.

Example:

```cpp
EXPECT_THAT(foo, Field(&Foo::x, Eq(10)));
EXPECT_THAT(map, Contains(Pair(Ge(5), Eq("data"))));
EXPECT_THAT(ptr, Pointee(Lt(0)));
```

---

## Writing Custom Matchers

You can extend GoogleMock with custom matchers for domain-specific predicates:

- Use `MATCHER(name, description) { ... }` for simple predicates.
- Use `MATCHER_P(name, param, description) { ... }` for parameterized matchers.
- For advanced control, implement the matcher interface directly.

Example:

```cpp
MATCHER(IsDivisibleBy7, "") { return arg % 7 == 0; }
EXPECT_THAT(value, IsDivisibleBy7());
```

---

## Matcher Behavior Notes

- Matchers must be purely functional and have no side effects.
- Matchers are polymorphic and can adapt to types they're used with.
- Combining matchers produces detailed failure messages explaining mismatches.

---

## Troubleshooting

- Use `EXPECT_THAT` to get detailed failure messages with matcher descriptions.
- When matching containers, prefer `ElementsAre` and `UnorderedElementsAre` for explicit expectations.
- Use `Truly()` sparingly as it performs arbitrary user code and may complicate test failures.

---

## Example: Matching a Complex Container

```cpp
using ::testing::ElementsAre;
using ::testing::Pair;
using ::testing::Gt;

EXPECT_THAT(map, ElementsAre(
    Pair(Gt(10), "ten-plus"),
    Pair(5, "five")
));
```

This verifies the map contains exactly two pairs where the first key is greater than 10 with the value "ten-plus", and a key of 5 with value "five".

---

For more details and the full list of matchers and related utilities, see the:

- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [gMock Cookbook - Matchers Section](https://google.github.io/googletest/gmock_cook_book.html#Using-Matchers)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html#MatcherList)

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-507"}]} />
