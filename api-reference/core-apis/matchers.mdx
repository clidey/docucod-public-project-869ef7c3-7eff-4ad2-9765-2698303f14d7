---
title: "Matchers Reference"
description: "A catalog of matchers provided by GoogleTest and GoogleMock for expressive value checking, including advanced and custom matchers. Covers usage patterns, examples, and extensibility options."
---

# Matchers Reference

Matchers in GoogleTest and GoogleMock provide a powerful and expressive way to specify conditions and expectations on values or function arguments in your tests. They enable you to write readable assertions and mock expectations that closely express your intent.

---

## Overview

A **matcher** is an object that determines whether a single argument satisfies a given condition. You use matchers inside `ON_CALL()`, `EXPECT_CALL()`, or for assertions with `EXPECT_THAT()` and `ASSERT_THAT()`.

Matchers can:
- Verify that arguments meet certain criteria.
- Be composed or combined to express complex conditions.
- Provide informative failure messages explaining why a match failed.

Example:

```cpp
EXPECT_CALL(turtle, Forward(Ge(100)));  // Argument must be >= 100
EXPECT_THAT(value, StartsWith("Hello"));  // Value starts with "Hello"
```

---

## Using Matchers

Matchers come in various categories to cover most common testing needs. Here is a detailed catalog of built-in matchers available in the `::testing` namespace.

### Wildcard Matchers

| Matcher             | Description                                           |
| -------------------- | ----------------------------------------------------- |
| `_`                  | Matches any value of the appropriate type.            |
| `A<type>()` or `An<type>()` | Matches any value of the specified type `type`.        |

*Example:* If you don't care about a function argument's value, use `_`.

```cpp
EXPECT_CALL(mock, Process(_));  // Accepts any value.
```

---

### Generic Comparison Matchers

These compare values using operators or predicates:

| Matcher         | Description                                   |
|-----------------|-----------------------------------------------|
| `Eq(value)` or `value` | Matches if argument equals `value` (`==`).      |
| `Ne(value)`     | Matches if argument does not equal `value`.    |
| `Lt(value)`     | Matches if argument < `value`.                  |
| `Le(value)`     | Matches if argument <= `value`.                 |
| `Gt(value)`     | Matches if argument > `value`.                  |
| `Ge(value)`     | Matches if argument >= `value`.                 |
| `IsTrue()`      | Matches if argument evaluates to `true`.       |
| `IsFalse()`     | Matches if argument evaluates to `false`.      |
| `IsNull()`      | Matches null pointers (raw or smart).           |
| `NotNull()`     | Matches non-null pointers (raw or smart).       |
| `Optional(m)`   | Matches `std::optional` that contains a value matching `m`.
| `VariantWith<T>(m)` | Matches `std::variant` holding alternative `T` matching `m`.
| `Ref(variable)` | Matches arguments that refer to `variable` (by reference). |
| `TypedEq<type>(value)` | Matches if argument has type exactly `type` and equals `value`.

*Example:* Checking an argument exactly equals 42, or is not null.

```cpp
EXPECT_CALL(mock, GetValue(Eq(42)));
EXPECT_CALL(mock, GetPtr(NotNull()));
```

**Tip:** For non-copyable value matchers, use `Eq(std::ref(value))` to avoid copying.

---

### Floating-Point Matchers

Floating-point comparisons consider floating precision and special cases like NaNs.

| Matcher                           | Description                                      |
|---------------------------------|--------------------------------------------------|
| `FloatEq(value)`                 | Matches `float` value approximately equal to `value` (4 ULPs).          |
| `DoubleEq(value)`                | Matches `double` value approximately equal to `value` (4 ULPs).         |
| `NanSensitiveFloatEq(value)`    | Like `FloatEq` but treats NaN == NaN as true.                              |
| `NanSensitiveDoubleEq(value)`   | Like `DoubleEq` but treats NaN == NaN as true.                             |
| `FloatNear(value, max_abs_err)` | Matches `float` within `max_abs_err` absolute error.                     |
| `DoubleNear(value, max_abs_err)`| Matches `double` within `max_abs_err` absolute error.                    |
| `NanSensitiveFloatNear(value, max_abs_err)` | Like `FloatNear` but treats NaN == NaN as true.                      |
| `NanSensitiveDoubleNear(value, max_abs_err)` | Like `DoubleNear` but treats NaN == NaN as true.                    |
| `IsNan()`                       | Matches any floating-point NaN value.                                       |

**Example:**

```cpp
EXPECT_THAT(x, DoubleEq(3.1415));
EXPECT_THAT(y, NanSensitiveFloatEq(std::numeric_limits<float>::quiet_NaN()));
```

---

### String Matchers

These allow expressive tests on string values (C char arrays or `std::string`). They also work with wide strings if available.

| Matcher                  | Description                               |
|--------------------------|-------------------------------------------|
| `StrEq(string)`          | Matches string exactly equal to `string`.
| `StrNe(string)`          | Matches string not equal to `string`.
| `StrCaseEq(string)`      | Matches string equal to `string`, ignoring case.
| `StrCaseNe(string)`      | Matches string not equal to `string`, ignoring case.
| `HasSubstr(string)`      | Matches strings containing `string` as a substring.
| `StartsWith(prefix)`     | Matches strings starting with `prefix`.
| `EndsWith(suffix)`       | Matches strings ending with `suffix`.
| `WhenBase64Unescaped(m)` | Matches base64 escaped strings whose unescaped value matches `m`.
| `ContainsRegex(string)`  | Matches strings matching regular expression.
| `MatchesRegex(string)`   | Matches strings matching regular expression exactly.

**Example:**

```cpp
EXPECT_THAT(my_str, StartsWith("Hello"));
EXPECT_THAT(error_message, ContainsRegex("File not found.*critical"));
```

---

### Exception Matchers

Matching exceptions thrown by callables.

| Matcher                     | Description                                                |
|-----------------------------|------------------------------------------------------------|
| `Throws<E>()`               | Callable throws an exception of type `E`.                  |
| `Throws<E>(m)`              | Callable throws exception of type `E` with value matching `m`.
| `ThrowsMessage<E>(m)`       | Callable throws exception of type `E` with `what()` string matching `m`.

**Example:**

```cpp
auto lambda = [] { throw std::runtime_error("error msg"); };
EXPECT_THAT(lambda, Throws<std::runtime_error>());
EXPECT_THAT(lambda, ThrowsMessage<std::runtime_error>(HasSubstr("error")));
```

---

### Container Matchers

Container matchers provide flexible ways to assert properties of STL-like containers.

| Matcher                      | Description                                         |
|------------------------------|-----------------------------------------------------|
| `SizeIs(m)`                 | Container size matches matcher `m`.                |
| `BeginEndDistanceIs(m)`     | Distance between begin/end iterators matches `m`. |
| `ContainerEq(container)`    | Matches if container equals another in contents.   |
| `Contains(e)`               | Container contains at least one element matching `e`.
| `Contains(e).Times(n)`      | Container has exactly `n` elements matching `e`.
| `Each(e)`                   | Every element in container matches `e`.
| `ElementsAre(e0, e1, ..., en)` | Container matches specified element matchers in order.
| `ElementsAreArray(...)`     | Like `ElementsAre()` but from array or container.
| `UnorderedElementsAre(...)` | Matches elements ignoring order.
| `UnorderedElementsAreArray(...)` | As above but from array or container.
| `Pointwise(m, container)`  | Compares two containers element-wise with matcher `m` on element pairs.
| `UnorderedPointwise(m, container)` | As above but ignoring order.
| `IsSubsetOf(...)`           | Container is subset of given elements.
| `IsSupersetOf(...)`         | Container is superset of given elements.
| `WhenSorted(m)`             | Container sorted by `<` matches matcher `m`.
| `WhenSortedBy(comparator, m)` | Container sorted by comparator matches `m`.

**Example:**

```cpp
EXPECT_THAT(vec, Contains(Gt(10)));
EXPECT_THAT(set, Each(Le(100)));
EXPECT_THAT(array, ElementsAre(1, 2, 3));
EXPECT_THAT(unordered_map, UnorderedElementsAre(Pair("a", 1), Pair("b", 2)));
```

---

### Member Matchers

Matchers that examine members or properties of objects.

| Matcher               | Description                                                        |
|-----------------------|--------------------------------------------------------------------|
| `Field(&Class::field, m)`              | Matches if `argument.field` (or `argument->field` pointer) matches matcher `m`.
| `Field(name, &Class::field, m)`       | Like above, but includes field name in error messages.
| `Property(&Class::getter, m)`          | Matches if `argument.getter()` returns a value matching `m`.
| `Property(name, &Class::getter, m)`   | Like above, with property name.
| `Key(e)`                             | Matches an `std::pair` whose `first` (key) matches matcher or value `e`.
| `Pair(m1, m2)`                       | Matches an `std::pair` with `first` matching `m1` and `second` matching `m2`.
| `FieldsAre(m...)`                    | Matches aggregates or tuples by piecewise matching fields with provided matchers.

**Example:**

```cpp
EXPECT_THAT(obj, Field(&MyClass::id, Ge(0)));
EXPECT_THAT(map, Contains(Key(Eq("foo"))));
EXPECT_THAT(pair, Pair(Lt(10), HasSubstr("bar")));
EXPECT_THAT(tuple, FieldsAre(Eq(1), HasSubstr("abc"), _));
```

---

### Multi-argument Matchers

These handle matching multiple arguments as a tuple, useful in `.With()` clauses.

| Matcher             | Description                                                   |
|---------------------|---------------------------------------------------------------|
| `AllArgs(m)`        | Matches all arguments as a tuple against matcher `m`.         |
| `Args<N1, N2, ...>(m)` | Matches selected subset of arguments (by 0-based indices) with `m`.

Used typically as:

```cpp
EXPECT_CALL(foo, Func(_, _)).With(AllArgs(Lt()));  // first arg < second arg
EXPECT_CALL(foo, Bar(_, _, _)).With(Args<0, 2>(Eq()));
```

---

### Composite Matchers

Build complex matchers by composing others:

| Matcher                 | Description                                   |
|-------------------------|-----------------------------------------------|
| `AllOf(m1, m2, ..., mn)` | Matches if all `m1` to `mn` match.
| `AnyOf(m1, m2, ..., mn)` | Matches if any of `m1` to `mn` match.
| `Not(m)`                 | Matches if `m` does not match.
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` true, else `m2`.

---

### Adapters for Matchers

| Matcher                | Description                                    |
|------------------------|------------------------------------------------|
| `MatcherCast<T>(m)`    | Casts matcher `m` to type `Matcher<T>` unsafely.
| `SafeMatcherCast<T>(m)`| Safely casts matcher `m` to `Matcher<T>`, ensuring compatibility.
| `Truly(predicate)`     | Converts arbitrary predicate to matcher.

---

### Using Matchers As Predicates

- `Matches(m)(value)` returns true if `value` matches `m`.
- `ExplainMatchResult(m, value, listener)` returns true if `value` matches `m` and writes explanation.

---

### Defining New Matchers

You can define custom matchers for specific needs using macros or interfaces.

- `MATCHER(name, desc) { ... }` defines a polymorphic matcher without parameters.
- `MATCHER_P(name, param, desc) { ... }` defines a parameterized matcher.
- Use `ExplainMatchResult()` inside to wrap other matchers.

Example:

```cpp
MATCHER(IsEven, "") { return arg % 2 == 0; }
EXPECT_THAT(x, IsEven());
```

For advanced control, you can implement the matcher interface classes directly.

---

### Defining New Actions

If built-in actions don't suffice, define your own actions:

- Use lambdas, functors, or action templates with appropriate operator signatures.
- Use `Invoke()`, `InvokeWithoutArgs()` to call functions or methods.
- Combine multiple actions with `DoAll()`.
- Actions can produce side effects or return values as expected.

Example:

```cpp
EXPECT_CALL(mock, Foo()).WillOnce([]() { return 42; });
```

---

### Special Matchers and Utilities

- `Ref(variable)` matches arguments that refer to the same variable.
- `Pointee(m)` matches pointers pointing to values matching matcher `m`.
- `WhenDynamicCastTo<T>(m)` matches objects that can be `dynamic_cast` to `T` and satisfy `m`.

---

### Tips & Best Practices

- Use `ON_CALL` to set default behaviors without creating expectations.
- Use `EXPECT_CALL` to set expectations on call count and argument values.
- Omit argument matchers or use `_` to avoid over-specification.
- Combine matchers to build expressive conditions.
- Use `NiceMock` and `StrictMock` wrappers to control warnings and failures on uninteresting calls.
- When testing containers, pick between ordered `ElementsAre` and unordered `UnorderedElementsAre` appropriately.
- Use `With(...)` to match multiple arguments as a tuple.

---

### Example: Using Various Matchers

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;
using ::testing::StartsWith;
using ::testing::Pair;
using ::testing::ElementsAre;

// Expect 'DoSomething' called with first arg >= 10 and any second arg
EXPECT_CALL(mock, DoSomething(Gt(9), _));

// Assert that 'name' string starts with "My"
EXPECT_THAT(name, StartsWith("My"));

// Check a vector contains exactly three elements, matching conditions:
EXPECT_THAT(vec, ElementsAre(1, Gt(0), Eq(3)));

// Check a map contains a key-value pair with key "foo" and numeric value > 10
EXPECT_THAT(my_map, Pair(Eq("foo"), Gt(10)));
```

This expressive syntax improves readability and test clarity.

---

### Troubleshooting

- If a matcher does not compile, ensure types match or use `SafeMatcherCast`.
- Beware of using implicit conversions that can cause unexpected match results.
- For pointers, use `IsNull()` or `NotNull()` rather than raw `nullptr` comparisons.
- Use `ExplainMatchResult()` or run tests with verbose output (`--gmock_verbose=info`) to diagnose matcher failures.

---

For a practical introduction and workflows using matchers, consider reading the [gMock for Dummies](../gmock_for_dummies.md) and [Using Assertions Effectively](../guides/getting-started/using-assertions.mdx) guides.

For full API details, consult [Mocking Reference](../docs/reference/mocking.md) and [Actions Reference](../docs/reference/actions.md).

---

**Note:** This catalog covers matchers; they play a vital role when combined with mocks and actions to build robust tests.

---