---
title: "Matchers"
description: "API documentation for using and composing matchers in tests and mocks. Explore built-in matchers and patterns to verify complex data structures, custom compare logic, and expressive checks for arguments and results."
---

# Matchers

GoogleTest's matcher library provides a rich and expressive set of tools to validate individual arguments in mocks and assertions. A matcher tests a *single* argument, allowing you to specify precise conditions that argument values must satisfy in mock method calls or direct value validations.

---

## Using Matchers

Matchers are used extensively in mocks with `EXPECT_CALL()` or `ON_CALL()`, and also in assertions with macros like `EXPECT_THAT(value, matcher)`. They give you the power to write tests that are both clear in intention and provide helpful diagnostics on failure.

### Basic Syntax

```cpp
EXPECT_THAT(actual_value, matcher);
ASSERT_THAT(actual_value, matcher);  // fatal failure variant
```

In mock expectations:

```cpp
EXPECT_CALL(mock_obj, MockMethod(matcher1, matcher2, ...));
```

When you pass a raw value instead of a matcher as an argument, it is implicitly converted to `Eq()` matcher, i.e., equality matching.

### Wildcard Matchers

| Matcher        | Description                                |
|----------------|--------------------------------------------|
| `_`            | Matches any value of the correct type.    |
| `A<type>()` or `An<type>()` | Matches any value of the specified type.  |

Example:

```cpp
EXPECT_CALL(mock, Foo(_));  // Foo can be called with any argument.
EXPECT_CALL(mock, Bar(A<int>()));  // Bar can be called with any int.
```

### Generic Comparison Matchers

| Matcher    | Description                         |
|------------|-----------------------------------|
| `Eq(value)` or `value` | Matches `argument == value`.
| `Ne(value)` | Matches `argument != value`.
| `Lt(value)` | Matches `argument < value`.
| `Le(value)` | Matches `argument <= value`.
| `Gt(value)` | Matches `argument > value`.
| `Ge(value)` | Matches `argument >= value`.
| `IsTrue()`  | Matches if argument evaluates to true.
| `IsFalse()` | Matches if argument evaluates to false.
| `IsNull()`  | Matches null raw or smart pointers.
| `NotNull()` | Matches non-null raw or smart pointers.
| `Optional(m)` | Matches optional types that contain value matching `m`.
| `VariantWith<T>(m)` | Matches variants holding alternative of type T matching `m`.
| `Ref(variable)` | Matches arguments that are references to a given variable.

Note: For non-copyable values, wrap them with `std::ref()` when using `Eq()` or similar to avoid copying.

Example:

```cpp
EXPECT_CALL(mock, Foo(Eq(42)));
EXPECT_CALL(mock, Bar(Le(10)));
EXPECT_CALL(mock, Baz(NotNull()));
```

### Floating-Point Matchers

Match floating-point arguments approximately with ULP-based or absolute-error-based comparators:

| Matcher                        | Description                                             |
|-------------------------------|---------------------------------------------------------|
| `DoubleEq(a_double)`           | Approximate equality for doubles, NaNs not equal        |
| `NanSensitiveDoubleEq(a_double)` | Approximate equality for doubles, treating NaNs equal |
| `DoubleNear(a_double, max_abs_error)` | Absolute error bound equality                           |
| `FloatEq(a_float)`             | Approximate equality for floats, NaNs not equal         |
| `NanSensitiveFloatEq(a_float)` | Approximate equality for floats, treating NaNs equal   |
| `FloatNear(a_float, max_abs_error)` | Absolute error bound equality                           |

Example:

```cpp
EXPECT_THAT(value, DoubleEq(3.14159));
EXPECT_THAT(value, NanSensitiveDoubleEq(std::numeric_limits<double>::quiet_NaN()));
EXPECT_THAT(value, DoubleNear(2.718, 0.001));
```

### String Matchers

Matchers for strings (C-style, `std::string`, and in many cases wide strings) include:

| Matcher             | Description                                                      |
|---------------------|------------------------------------------------------------------|
| `StrEq(string)`     | Case-sensitive equality                                          |
| `StrNe(string)`     | Case-sensitive inequality                                        |
| `StrCaseEq(string)` | Case-insensitive equality                                        |
| `StrCaseNe(string)` | Case-insensitive inequality                                      |
| `HasSubstr(string)` | Argument contains substring                                      |
| `StartsWith(prefix)`| Argument starts with prefix                                      |
| `EndsWith(suffix)`  | Argument ends with suffix                                        |
| `IsEmpty()`         | Argument is empty                                                |
| `ContainsRegex(string or RE)` | Argument matches regex                                  |
| `MatchesRegex(string or RE)`  | Argument matches regex fully                                  |
| `WhenBase64Unescaped(m)`      | Argument is base64-encoded string whose decoded form matches m |

Example:

```cpp
EXPECT_THAT(msg, HasSubstr("error"));
EXPECT_THAT(username, StrCaseEq("admin"));
EXPECT_THAT(filename, StartsWith("log_"));
EXPECT_THAT(data, MatchesRegex("^\d{3}-\d{2}-\d{4}$"));
```

### Exception Matchers

Matchers that assert a callable throws exceptions:

| Matcher                                 | Description                                               |
|-----------------------------------------|-----------------------------------------------------------|
| `Throws<E>()`                           | Callable throws an exception of type `E`                 |
| `Throws<E>(m)`                         | Callable throws exception of type `E` satisfying matcher `m` |
| `ThrowsMessage<E>(m)`                  | Callable throws exception `E` with message matching `m`   |

Example:

```cpp
auto lambda = [] { throw std::runtime_error("error msg"); };
EXPECT_THAT(lambda, Throws<std::runtime_error>());
EXPECT_THAT(lambda, Throws<std::runtime_error>(Property(&std::runtime_error::what, Eq("error msg"))));
EXPECT_THAT(lambda, ThrowsMessage<std::runtime_error>(HasSubstr("msg")));
```

### Container Matchers

Matchers for STL-like containers and native arrays. Supports flexible verification of container contents and properties.

| Matcher                                  | Description                                                               |
|-----------------------------------------|---------------------------------------------------------------------------|
| `Contains(e)`                          | Container has at least one element matching `e`.                         |
| `Contains(e).Times(n)`                 | Container has exactly `n` elements matching `e`.                         |
| `Each(e)`                             | Every element in container matches `e`.                                  |
| `ElementsAre(e0, e1, ..., en)`         | Container has exactly (n+1) elements, matching respectively.              |
| `ElementsAreArray(...)`               | Same as `ElementsAre` but takes an array, container, or iterator range.  |
| `UnorderedElementsAre(e0, e1, ..., en)`| Container matches elements in any order.                                 |
| `UnorderedElementsAreArray(...)`      | Same as `UnorderedElementsAre` but takes array/container/iterator range. |
| `SizeIs(m)`                          | Container's size matches matcher `m`.                                   |
| `IsSubsetOf(...)`                     | Container is a subset matching provided elements/matchers.              |
| `IsSupersetOf(...)`                   | Container contains superset matching provided elements/matchers.        |
| `Pointwise(m, container)`             | Matches element-wise with another container using tuple matcher `m`.     |
| `UnorderedPointwise(m, container)`   | Like `Pointwise` but ignores order.                                     |
| `IsEmpty()`                          | Container is empty.                                                     |
| `BeginEndDistanceIs(m)`                | Distance between `begin()` and `end()` matches m.                        |

Examples:

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(set, Contains(3));
EXPECT_THAT(map, Contains(Key(Le(5))));
EXPECT_THAT(vec, Each(Gt(0)));
EXPECT_THAT(unordered_vec, UnorderedElementsAre(1, 2, 3));
EXPECT_THAT(vec, SizeIs(Ge(5)));
```

### Member Matchers

Matchers that examine specific members or properties of objects.

| Matcher                                    | Description                                                                         |
|--------------------------------------------|-------------------------------------------------------------------------------------|
| `Field(&class::field, m)`                  | Field `field` of `class` matches matcher `m`.                                      |
| `Field(field_name, &class::field, m)`      | Same as above but gives better error messages using `field_name`.                   |
| `Property(&class::property, m)`            | `property()` method result matches matcher `m`.                                   |
| `Property(property_name, &class::property, m)` | Same as above but gives better error messages.                                  |
| `Key(e)`                                  | Matches the `first` element of key-value pairs like `std::pair` or map entries.    |
| `Pair(m1, m2)`                            | Matches `std::pair` where `first` matches `m1` and `second` matches `m2`.           |
| `FieldsAre(m...)`                         | Matches compatible structs, tuples, or aggregates by matching each field individually. |

Example:

```cpp
EXPECT_THAT(obj, Field(&MyClass::id, Eq(42)));
EXPECT_THAT(obj, Property(&MyClass::GetName, StartsWith("John")));
EXPECT_THAT(map, Contains(Key(Ge(10))));
EXPECT_THAT(p, Pair(Eq(1), Lt(100)));
EXPECT_THAT(tuple, FieldsAre(Ge(0), HasSubstr("foo")));
```

### Matching Function or Callback Results

You can specify matchers for the result of a function or callable applied to an argument:

```cpp
ResultOf(f, m)
ResultOf("description", f, m)
```

This matches if `f(argument)` matches `m`. Helpful to write concise matchers for properties accessible only via functions.

Example:

```cpp
EXPECT_THAT(obj, ResultOf(&MyClass::GetValue, Eq(42)));
```

---

## Composite Matchers

Matchers can be combined logically to express complex conditions:

| Matcher             | Description                                  |
|---------------------|----------------------------------------------|
| `Not(m)`            | Matches if `m` does not match.                |
| `AllOf(m1, m2, ...)`| Matches if all m_i match.                      |
| `AnyOf(m1, m2, ...)`| Matches if any m_i matches.                    |
| `Conditional(cond, m1, m2)` | Matches with m1 if cond is true, else m2.  |

Example:

```cpp
EXPECT_THAT(x, AllOf(Ge(0), Le(100), Ne(50)));
EXPECT_THAT(ptr, Not(IsNull()));
```

---

## Matcher Casting

GoogleTest matchers are strongly typed. However, you can cast matchers to compatible types:

- `MatcherCast<T>(m)` — unsafe cast (uses `static_cast`). Use when sure.
- `SafeMatcherCast<T>(m)` — strict, safe cast, ensures no lossy conversions.

Use these to resolve type mismatches or overloading ambiguities.

Example:

```cpp
EXPECT_CALL(mock, Func(SafeMatcherCast<Derived*>(m)));
```

---

## Defining Custom Matchers

You can define your own matchers in two common ways:

### Using MATCHER macros

Quick and concise.

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
EXPECT_THAT(value, IsEven());
```

You can define parameterized matchers with `MATCHER_P`, `MATCHER_P2`, etc.

### Defining Matcher class

For more control, define a class implementing the matcher interface.

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    const int remainder = n % 7;
    if (remainder != 0 && os != nullptr) {
      *os << "the remainder is " << remainder;
    }
    return remainder == 0;
  }
  void DescribeTo(std::ostream* os) const {
    *os << "is divisible by 7";
  }
  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not divisible by 7";
  }
};

::testing::Matcher<int> DivisibleBy7() {
  return DivisibleBy7Matcher();
}
```

---

## Best Practices & Tips

- Use matchers to express intent explicitly. Avoid overfitting tests with exact values unless necessary.
- Prefer explicit `Eq()` over bare values in `EXPECT_THAT` to avoid implicit conversion surprises.
- For move-only types or non-copyable arguments, use references wrapped with `std::ref()`.
- Combine matchers with `AllOf()`, `AnyOf()`, `Not()` to build complex rules.
- Use `Field()`, `Property()`, and `Pair()` to validate parts of complex objects.
- `Pointee()` is useful for matching the pointed-to value of pointers or smart pointers.
- When writing fluent mock expectations, use matcher composition to keep expressions clear and maintainable.
- Define reusable matcher variables for complex, repeated matchers to improve test readability.

---

## Troubleshooting Matchers

- If a matcher fails unexpectedly, use `ExplainMatchResult(matcher, value, &listener)` to obtain diagnostic messages explaining why the match failed or succeeded.
- Make sure to match types correctly—mismatched types are a common cause of confusing matcher failures.
- Use `SafeMatcherCast` when you need to explicitly cast matchers to avoid compilation errors or unexpected matches.
- Beware of lifetime issues when using references or pointers in matchers; ensure referenced objects outlive the matcher usage.

---

## Code Examples

```cpp
// Simple equality matcher
EXPECT_THAT(value, Eq(42));

// Match any int
EXPECT_CALL(mock, Foo(A<int>()));

// Combination
EXPECT_THAT(value, AllOf(Ge(0), Le(100), Not(Eq(50))));

// String contains substring
EXPECT_THAT(name, HasSubstr("foo"));

// Validate a field in struct
EXPECT_THAT(obj, Field(&MyStruct::count, Gt(0)));

// Pointer points to value greater than 10
EXPECT_THAT(ptr, Pointee(Gt(10)));

// Custom matcher example
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}
EXPECT_THAT(x, IsEven());

// Parameterized matcher
MATCHER_P(IsDivisibleBy, n, "checks divisibility") {
  return (arg % n) == 0;
}
EXPECT_THAT(value, IsDivisibleBy(7));
```

---

## Summary

Matchers lie at the heart of powerful GoogleTest assertions and GoogleMock expectations. They enable precise, readable, and robust verification of function calls and values, supporting everything from simple comparisons to deeply nested properties and complex custom validation logic.

Explore built-in matchers first to cover most needs. When necessary, define your own custom or composite matchers to clearly express the intent and complexity of your tests.

---

## Related Documentation

- [Using Matchers in gMock Expectations (Mocking Reference)](/docs/reference/mocking.md)
- [gMock Cookbook - Defining New Matchers](https://google.github.io/googletest/gmock_cook_book.html#writing-new-matchers-quickly)
- [GoogleTest Assertions Reference - EXPECT_THAT](reference/assertions.md#EXPECT_THAT)
- [Matchers Reference](docs/reference/matchers.md)
- [Matchers in Test Assertions](api-reference/core-apis/matchers)

---

## Next Steps

- Start with simple built-in matchers for common types
- Use matcher composition to build complex validation
- Write custom parameterized matchers for project-specific needs
- Explore extending mock expectations using matchers
- Diagnose matcher failures with `ExplainMatchResult()`
- Read the [Advanced Mocking: Actions, Matchers, and Customizations](guides/mocking-best-practices/advanced-mocking-actions) guide for detailed help