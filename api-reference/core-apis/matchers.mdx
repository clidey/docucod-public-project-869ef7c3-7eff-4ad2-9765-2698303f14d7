---
title: "Matchers"
description: "Provides a reference to built-in matchers, matcher combinations, and custom matcher support for expressive test conditions. Explains usage with assertions and mock expectations, shows examples, and covers advanced features like container, string, and predicate matching."
---

# Matchers Reference

GoogleTest's **Matchers** enable you to write expressive, readable, and flexible expectations and assertions by defining patterns that arguments or values must satisfy. This page provides a detailed reference to the built-in matchers, combination utilities, and facilities for writing your own custom matchers, essential for crafting precise tests and mocks.

---

## Overview of Matchers

Matchers are predicates used when verifying values passed to mocked functions or evaluated inside assertions like `EXPECT_THAT`. They encapsulate the logic to check a condition (e.g., equality, comparison, string matching) and also explain why a value matches or fails the condition.

- You can use matchers anywhere a value is expected in mock expectations and `EXPECT_THAT` assertions.
- Built-in matchers support numeric comparison, string patterns, container contents, pointer checks, and more.
- Matchers are polymorphic and type-safe: the compiler ensures matchers are used with compatible argument types.

### Using Matchers with Assertions and Mocks

You typically use matchers inside `EXPECT_CALL()` on mocks or googletest's `EXPECT_THAT` macro:

```cpp
#include <gmock/gmock.h>

EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_CALL(mock, Method(Ge(5), _));
```

Here, `StartsWith` and `Ge` are matchers.

---

## Basic Built-in Matchers

### Wildcard

- `_` / `A<T>()` / `An<T>()`: Matches any value of type `T`.

Example:
```cpp
EXPECT_CALL(mock, Foo(_));
EXPECT_THAT(x, A<int>());
```

### Equality and Inequality

- `Eq(value)`: Matches any value equal to `value` using `operator==`.
- `Ne(value)`: Matches any value not equal to `value`.
- `TypedEq<T>(value)`: Matches any value of type `T` equal to `value`.

Example:
```cpp
EXPECT_CALL(mock, Bar(Eq(42)));
EXPECT_THAT(x, Ne("foo"));
```

### Relational Operators

- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`: match less-than, less-or-equal, greater-than, greater-or-equal.

Example:
```cpp
EXPECT_CALL(mock, Foo(Gt(10)));
EXPECT_THAT(val, Le(100));
```

### Pointer Matchers

- `IsNull()`: Matches any null pointer of any type (raw or smart).
- `NotNull()`: Matches any non-null pointer.
- `Ref(variable)`: Matches an argument that is a reference to `variable`.
- `Pointee(matcher)`: Matches a pointer (raw or smart) whose pointed-to value matches `matcher`.

Example:
```cpp
EXPECT_CALL(mock, Foo(IsNull()));
EXPECT_CALL(mock, Foo(Pointee(Eq(5))));
```

### String Matchers

- `StrEq(str)`: Matches strings equal to `str` (case-sensitive, works with C-strings, `std::string`, optionally wide strings).
- `StrNe(str)`: Matches strings not equal to `str`.
- `StrCaseEq(str)`, `StrCaseNe(str)`: Like above but case-insensitive.
- `HasSubstr(substring)`: Matches if the string contains `substring`.
- `StartsWith(prefix)`: Matches strings starting with `prefix`.
- `EndsWith(suffix)`: Matches strings ending with `suffix`.

Example:
```cpp
EXPECT_THAT(name, StartsWith("Dr."));
EXPECT_CALL(mock, Foo(StrCaseEq("hello")));
```

### Regex Matchers

- `MatchesRegex(regex)`: Matches if the string fully matches the given regex.
- `ContainsRegex(regex)`: Matches if the string contains a substring that matches the given regex.

### Floating Point Matchers

- `DoubleEq(value)`, `FloatEq(value)`: Approximate equality with sensible defaults on floating-point comparison.
- `NanSensitiveDoubleEq(value)`, `NanSensitiveFloatEq(value)`: Like above, but consider NaNs equal.
- `DoubleNear(value, max_abs_error)`, `FloatNear(value, max_abs_error)`: Approximately equal within specified max absolute error.

Example:
```cpp
EXPECT_THAT(3.14, DoubleNear(3.1415, 0.001));
```

### Container Matchers

- `IsEmpty()`: Matches empty containers or strings.
- `SizeIs(matcher)`: Matches containers whose size satisfies the size matcher.
- `ContainerEq(container)`: Matches any container equal to the given container, with detailed failure reports.
- `WhenSortedBy(comparator, matcher)`: Matches containers that match `matcher` after sorting with `comparator`.

### Collection Content Matchers

- `Contains(element_matcher)`: Matches containers with at least one element matching `element_matcher`. Can be modified with `.Times(matcher)` to expect exact or range counts.
- `Each(element_matcher)`: Matches containers whose every element matches `element_matcher`.
- `ElementsAre(m_1, ..., m_n)`: Matches containers with exactly n elements matching `m_1` through `m_n` in order.
- `UnorderedElementsAre(m_1, ..., m_n)`: Matches containers whose elements match the given matchers in any order.
- `ElementsAreArray()`, `UnorderedElementsAreArray()`: Like above but from arrays, containers, or initializer lists.
- `IsSupersetOf()`, `IsSubsetOf()`: Verify partial matches for superset or subset.
- `Pointwise(tuple_matcher, container)`: Matches positionwise elements of two containers.
- `UnorderedPointwise()` same as above but order doesn't matter.

Example:
```cpp
EXPECT_THAT(vec, ElementsAre(1, Gt(0), _));
EXPECT_THAT(map, Contains(Key(Ge(5))));
```

### Tuple and Pair Matchers

- `Pair(matcher_first, matcher_second)`: Matches std::pair whose first and second fields match respectively.
- `Key(matcher)`: Matches any std::pair where first field matches `matcher`.
- `FieldsAre(m_1, ..., m_n)`: Matches structs, tuples, and aggregates piecewise with given matchers.

---

## Matcher Combinators

### Logical Combinators

- `Not(m)`: Matches the negation of matcher `m`.
- `AllOf(m1, m2, ..., mn)`: Matches if all matchers match.
- `AnyOf(m1, m2, ..., mn)`: Matches if any matcher matches.

They can be nested to build complex logic:

```cpp
EXPECT_THAT(x, AllOf(Gt(0), Not(Eq(10))));
```

### Conditional Matcher

- `Conditional(cond, m1, m2)`: Matches `m1` if `cond` is true, else `m2`.

---

## Writing Custom Matchers

GoogleTest offers an easy-to-use macro system to create your own matchers quickly, or lets you define matcher classes for advanced needs.

### MATCHER Macro

Define parameterless custom matchers:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
```

Use:

```cpp
EXPECT_THAT(value, IsEven());
```

### Parameterized Matchers

Use `MATCHER_P`, `MATCHER_P2`, ..., `MATCHER_P10` macros:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "") {
  return (arg % divisor) == 0;
}
```

Use:

```cpp
EXPECT_THAT(value, IsDivisibleBy(7));
```

Descriptions can be parameterized and may reference `negation` for proper failure messages.

### Custom Matcher Classes

For complex matchers, implement the matcher interface class manually. A matcher class must:

- Define `using is_gtest_matcher = void;`
- Implement `bool MatchAndExplain(const T& arg, std::ostream* os) const;`
- Implement `void DescribeTo(std::ostream* os) const;`
- Optionally implement `DescribeNegationTo(std::ostream* os) const;`

Finally, provide a factory function that returns a `testing::Matcher<T>`.

Example:

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  explicit DivisibleBy7Matcher(int divisor) : divisor_(divisor) {}

  bool MatchAndExplain(int n, std::ostream* os) const {
    if (n % divisor_ == 0) return true;
    if (os) *os << "remainder is " << (n % divisor_);
    return false;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is divisible by " << divisor_;
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not divisible by " << divisor_;
  }

 private:
  const int divisor_;
};

inline testing::Matcher<int> DivisibleBy7(int divisor) {
  return testing::Matcher<int>(new DivisibleBy7Matcher(divisor));
}
```

---

## Advanced and Container Matchers

### Matching Container Sizes and Contents

Matchers like `SizeIs(matcher)`, `Contains(matcher)`, `Each(matcher)`, `ElementsAre(...)`, and `UnorderedElementsAre(...)` provide nuanced checks for container size and element values, along with detailed failure explanations.

Example:

```cpp
EXPECT_THAT(vec, SizeIs(Ge(3)));
EXPECT_THAT(vec, Contains(42).Times(2));
EXPECT_THAT(map, UnorderedElementsAre(Pair("key1", 1), Pair(_, 2)));
```

### Field and Property Matchers

- `Field(&Class::member, matcher)` verifies a member variable matches.
- `Property(&Class::getter, matcher)` verifies the result of a const getter method matches.

Example:

```cpp
EXPECT_THAT(foo, Field(&Foo::value, Ge(10)));
EXPECT_THAT(bar, Property(&Bar::Name, StartsWith("John")));
```

### Tuple and Pair Matchers

- `FieldsAre(m1, m2, ..., mn)` matches aggregates or tuples piecewise.
- `Pair(m1, m2)` matches a `std::pair` with respective field matchers.

---

## Tips and Best Practices

- Use matchers sparingly, expressing only what's required to avoid brittle tests.
- Combine matchers with `AllOf` and `AnyOf` to construct complex conditions cleanly.
- Use `SafeMatcherCast<T>()` to safely cast matchers between types when appropriate.
- For string matching, choose the most specific string matcher (e.g., `StrEq` vs `HasSubstr`) to improve clarity.
- Use nested containers and `ElementsAre` for structured container validations.
- Write custom matchers for domain-specific checks to keep tests readable and expressive.

---

## Troubleshooting

- If your matcher fails unexpectedly, enable verbose output with `--gmock_verbose=info` for detailed diagnostics.
- For complex container matchers, check failure messages for element index and value mismatches.
- Ensure your custom matcher is functionally pure: no side effects or state changes.

---

## Related Documentation

- [Assertions Reference](../core-apis/assertions.md) — Using `EXPECT_THAT` with matchers
- [Mocking API Reference](../core-apis/mocking.md) — Using matchers in mock expectations
- [gMock Cookbook](../gmock_cook_book.md) — Recipes for custom matchers and interactions
- [Matchers Overview and Guide](concepts/architecture-core-abstractions/matchers-actions-cardinalities.md) — Concepts and patterns

---

For detailed examples and explanations, see [gMock Cheat Sheet](../gmock_cheat_sheet.md) and [gMock for Dummies](../gmock_for_dummies.md).

---
