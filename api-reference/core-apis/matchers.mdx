---
title: "Matchers"
description: "Reference the rich library of matcher objects for flexible, readable, and expressive test assertions in both GoogleTest and GoogleMock. Understand how to use standard matchers and build custom ones, including argument constraints and regular expressions."
---

# Matchers Reference for GoogleTest and GoogleMock

Discover the rich library of matcher objects that empower you to write *flexible*, *expressive*, and *readable* test assertions in both GoogleTest and GoogleMock. This reference covers how to use standard matchers, compose them into complex constraints, and craft custom matchers for your testing needs.

---

## Overview

Matchers are the essential building blocks that let you specify precise conditions on mock function arguments or values in `EXPECT_THAT` assertions. They operate like predicates that describe properties or patterns a value should satisfy.

Using matchers, you can write tests that:

- Check argument values with simple equality or inequality (`Eq()`, `Ne()`).
- Validate strings for substrings, prefixes, or regular expressions.
- Inspect container contents flexibly, accounting for order or subsets.
- Create composite conditions by combining multiple matchers (`AllOf`, `AnyOf`).
- Integrate user-defined predicates as matchers.

This reference guides you through harnessing the power of matchers, starting from the basics up to advanced customizations.

---

## Using Built-in Matchers

### Wildcard Matcher: `_`

- Matches *any* value of any type.
- Often used when the exact argument does not matter.

```cpp
EXPECT_CALL(mock, DoSomething(_, _));  // Matches any arguments
```

### Equality and Comparison Matchers

- `Eq(value)`: Argument equals `value`.
- `Ne(value)`: Argument not equal to `value`.
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`: Less than, less or equal, greater than, greater or equal.

```cpp
EXPECT_CALL(mock, ProcessValue(Ge(10)));  // Value >= 10
```

### Special Matchers for Pointers

- `IsNull()`: Matches null raw or smart pointers.
- `NotNull()`: Matches any non-null pointers.
- `Pointee(m)`: Matches pointer whose pointee matches matcher `m`.

### String Matchers

- `StrEq(s)`: Matches a string exactly equal to `s`.
- `StrNe(s)`: Not equal to `s`.
- `StrCaseEq(s)`: Case-insensitive equality.
- `StartsWith(prefix)`, `EndsWith(suffix)`: Check string prefixes or suffixes.
- `HasSubstr(substring)`: Checks if a substring appears.

### Container Matchers

- `ElementsAre(m1, m2, ...)`:
  Matches the exact elements in order.
- `UnorderedElementsAre(m1, m2, ...)`:
  Matches elements in any order.
- `Contains(m)`:
  Matches container having at least one element matching `m`.
- `Each(m)`:
  Matches if *all* elements satisfy matcher `m`.

### Composite Matchers

- `AllOf(m1, m2, ...)`:
  Matches if all matchers match.
- `AnyOf(m1, m2, ...)`:
  Matches if any matcher matches.
- `Not(m)`:
  Negates matcher `m`.

### Tuple and Member Matchers

- `Field(&Class::field, m)`:
  Matches an object whose given field satisfies `m`.
- `Property(&Class::getter, m)`:
  Matches when the property's getter result satisfies `m`.
- `Pair(m1, m2)`:
  Matches an object with two fields matching `m1` and `m2`.
- `Key(m)`, `Value(m)`:
  Matches keys or values in pair-like containers.

### Advanced Argument Matching

- `Args<k1,...,kn>(m)`:
  Matches a subset of arguments as a tuple.
- `With(m)` in `EXPECT_CALL`:
  Applies a matcher on all arguments as a tuple.

---

## Writing Custom Matchers

If built-in matchers donâ€™t fit your needs, you can define **custom matchers**.

### Quick Definition using Macros

GoogleMock offers macros that let you quickly create matchers:

```cpp
MATCHER(IsDivisibleBy7, "checks divisibility by 7") {
  return (arg % 7) == 0;
}

// Use it in tests:
EXPECT_CALL(mock, Func(IsDivisibleBy7()));
```

**Tips:**
- Use `MATCHER_P` to add a parameter.
- Provide meaningful failure descriptions.
- Use the special `result_listener` to stream additional failure explanation.

### Matcher Class Interface

For advanced custom matchers, implement the interface:

- `bool MatchAndExplain(const T& value, std::ostream* os) const` - returns true if `value` matches; stream diagnostic info into os.
- `void DescribeTo(std::ostream* os) const` - describes the condition matched.
- `void DescribeNegationTo(std::ostream* os) const` - describes the negative condition.

### Polymorphic Matchers

Polymorphic matchers can match multiple compatible types. Use template methods for this.

---

## Practical Examples

### Basic Expectation with Matchers

```cpp
using ::testing::Ge;
EXPECT_CALL(mock_obj, Process(Ge(10), _));
```
Here, `Process` is expected to be called with the first argument >= 10, and the second can be anything.

### Combining Matchers

```cpp
using ::testing::AllOf;
EXPECT_CALL(mock, DoAction(AllOf(Ge(5), Ne(10))));
```
The argument must be >= 5 and not equal to 10.

### Matching Complex Arguments Using Property

```cpp
EXPECT_CALL(mock, Transform(Property(&Foo::state, Eq(kReady))));
```
Matches calls where `Foo`'s state equals `kReady`.

### Matching Containers Flexibly

```cpp
EXPECT_CALL(mock, UpdateList(ElementsAre(1, _, Gt(5))));
```
Matches a container where first element is 1, second any value, third greater than 5.

---

## Best Practices and Tips

- Use `_` when argument values do not matter to keep tests resilient.
- Combine matchers to express intent clearly.
- Prefer default actions (`ON_CALL`) for usual behaviors and expectations (`EXPECT_CALL`) only when you want to enforce call order or counts.
- Define custom matchers for domain-specific validation to keep tests readable.
- Use `With()` for matching all arguments as a whole when relation among arguments must be asserted.
- Take care to match argument types - use `SafeMatcherCast<T>()` when needed.

---

## Troubleshooting

### Common Pitfalls

- Forgetting to put mock methods in `public:` can cause `ON_CALL`/`EXPECT_CALL` to fail.
- Overloaded methods need explicit argument specification in matchers to disambiguate.
- Improper use of `MATCHER` macros can lead to confusing error messages. Favor precise type annotations.
- Using default matcher for non-copyable or move-only types requires care.

### Debugging Matcher Failures

Run tests with `--gmock_verbose=info` to see detailed matcher call matching logs.

---

## Related Concepts and Extensions

- See the [Matchers Reference](reference/matchers.md) for the complete list of built-in matchers.
- Combine with [Actions Reference](api-reference/mocking-apis/actions) for specifying mock behaviors.
- Use `EXPECT_THAT` for matcher-based assertions in tests.

---

## Further Learning

- Explore [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes on matchers.
- Read [Writing Custom Matchers](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers) for deep customization.
- Consult [Mocking Reference](docs/reference/mocking.md) for detailed usage of EXPECT_CALL and argument matchers.

---

<Callout title="Note">
Matchers form the expressive core of GoogleMock's argument validation. Effective use leads to tests that are precise, easy to read, and maintainable.
</Callout>
