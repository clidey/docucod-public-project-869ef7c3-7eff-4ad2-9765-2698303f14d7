---
title: "Matchers"
description: "Describes GoogleTest's matcher API and GoogleMock's argument/value matchers. Understand built-in matchers, composition techniques, custom matchers, and practical matcher selection tips for expressive and maintainable tests."
---

# Matchers Reference

This page provides a comprehensive overview of GoogleTest's matcher API and GoogleMock's argument and value matchers. Matchers enable expressive validation of function arguments and values, allowing you to write readable and maintainable tests that specify fine-grained constraints on the values your code handles.

---

## What Are Matchers?

Matchers are predicates used to specify and verify the expected properties of values or arguments in tests. Unlike simple equality checks, matchers can express complex conditions such as "greater than 5", "contains substring", or "matches any value".

GoogleMock's matchers let you specify argument constraints in mock method expectations, while GoogleTest's `EXPECT_THAT` and `ASSERT_THAT` assertions use matchers to check arbitrary values.

## Using Matchers in Tests

### Basic Syntax

To set an expectation that a mock method is called with arguments matching certain criteria:

```cpp
EXPECT_CALL(mock_object, MethodName(MatcherForArgument1, MatcherForArgument2, ...));
```

To assert that a value satisfies a matcher:

```cpp
EXPECT_THAT(value, matcher);
ASSERT_THAT(value, matcher);
```

When you omit arguments in `EXPECT_CALL`, the matcher `_` (wildcard) matches any value.

```cpp
EXPECT_CALL(mock_object, DoSomething(_));
```

### Example

```cpp
#include <gmock/gmock.h>
using ::testing::_;
using ::testing::Ge;
using ::testing::HasSubstr;

class MockTurtle {
 public:
  MOCK_METHOD(void, Forward, (int distance), ());
};

TEST(TurtleTest, MovesForward) {
  MockTurtle turtle;
  // Expect Forward to be called with distance >= 100
  EXPECT_CALL(turtle, Forward(Ge(100)));

  turtle.Forward(120);  // matches expectation
}
```

## Common Built-in Matchers

GoogleTest and GoogleMock provide a rich set of built-in matchers. Some of the most commonly used include:

- **_** : Matches any value (wildcard).
- **Eq(value)** : Matches values equal to *value*.
- **Ne(value)** : Matches values not equal to *value*.
- **Lt(value)**, **Le(value)**, **Gt(value)**, **Ge(value)** : Less than, less or equal, greater than, greater or equal.
- **Not(matcher)** : Matches values that do not match the given matcher.
- **AllOf(m1, m2, ...)** : Matches if all matcher arguments match.
- **AnyOf(m1, m2, ...)** : Matches if any matcher argument matches.
- **Contains(element_matcher)** : Matches containers containing an element matching *element_matcher*.
- **ElementsAre(e1, e2, ...)** : Matches containers whose elements match the given matchers in order.
- **UnorderedElementsAre(e1, e2, ...)** : Matches containers with elements matching the matchers in any order.
- **StartsWith(substring)** : Matches string starting with the given substring.
- **EndsWith(substring)** : Matches string ending with the given substring.
- **HasSubstr(substring)** : Matches string containing the substring.
- **IsNull()** / **NotNull()** : Matches null or non-null pointer values.
- **Pointee(matcher)** : Matches pointers where the pointee matches *matcher*.
- **Field(&Class::member, matcher)** : Matches objects whose member matches *matcher*.
- **Property(&Class::getter, matcher)** : Matches objects whose getter method returns a value matching *matcher*.
- **Truly(predicate)** : Matches values satisfying a unary predicate.
- **SizeIs(matcher)** : Matches containers whose size matches *matcher*.
- **FloatEq(value)**, **DoubleEq(value)** : Matches floating-point values approximately equal (ULP-based) to *value*.

## Creating Custom Matchers

To define a matcher tailored to your use case, use the `MATCHER` family of macros.

### Basic Matcher

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

// Usage
EXPECT_CALL(mock_obj, Func(IsDivisibleBy7()));
```

You can provide a descriptive string that depends on negation:

```cpp
MATCHER(IsDivisibleBy7, absl::StrCat(negation ? "isn't" : "is", " divisible by 7")) {
  return (arg % 7) == 0;
}
```

### Parameterized Matcher

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}

// Usage
EXPECT_THAT(expression, HasAbsoluteValue(10));
```

You can supply multi-parameter variants: `MATCHER_P2`, ..., up to `MATCHER_P10`.

## Composing Matchers

Matchers can be combined logically:

```cpp
EXPECT_CALL(mock, Func(AllOf(Gt(5), Ne(10))));
EXPECT_CALL(mock, Func(AnyOf(Eq(1), Eq(2), Eq(3))));
EXPECT_CALL(mock, Func(Not(Lt(0))));
```

## Matching Containers

Matchers can validate container contents with element-wise granularity:

- `ElementsAre(...)` for ordered matching
- `UnorderedElementsAre(...)` for unordered matching
- `Contains(...)` to check for presence of an element
- `ElementsAreArray()` and `UnorderedElementsAreArray()` to match against arrays or containers
- `Pointwise()` to compare pairwise elements with a tuple matcher

Example:

```cpp
// Matches a vector<int> with 3 elements 1, 2, any value
EXPECT_CALL(mock, Func(ElementsAre(1, 2, _)));

// Matches a map containing keys >=5
EXPECT_THAT(map, UnorderedElementsAre(Pair(Ge(5), _)));
```

## Matcher Usage Tips and Best Practices

- Use `_` wildcards only when argument values don't matter.
- Use `SafeMatcherCast<Type>()` to cast matchers safely between compatible types.
- Avoid over-specifying matchers to reduce test brittleness.
- Combine simple matchers to express complex constraints clearly.
- For pointer arguments, use `IsNull()`, `NotNull()`, and `Pointee()`.
- Use `Field()` and `Property()` to validate members or getter return values of complex objects.
- Define custom matchers for reusable or domain-specific constraints.

## Troubleshooting Matcher Failures

When a matcher check fails, the output includes:

- Value under test
- Expected constraint description
- Actual value
- Additional explanation provided by the matcher

Use the visibility of detailed messages to diagnose mismatches.

---

# Code Examples

```cpp
#include <gmock/gmock.h>
using ::testing::_;         // wildcard matcher
using ::testing::Ge;        // >= matcher
using ::testing::StrEq;     // string equality matcher
using ::testing::ElementsAre;  // container elements matcher

class MockFoo {
 public:
  MOCK_METHOD(std::string, GetName, (), (const));
  MOCK_METHOD(void, Process, (int x), ());
  MOCK_METHOD(void, ProcessList, (const std::vector<int>& list), ());
};

TEST(MyTest, SimpleMatchers) {
  MockFoo mock;

  // Setup mock to expect a call to GetName returning "Alice"
  EXPECT_CALL(mock, GetName()).WillOnce(testing::Return("Alice"));

  EXPECT_EQ(mock.GetName(), "Alice");

  // Expect Process called with argument >= 10
  EXPECT_CALL(mock, Process(Ge(10)));
  mock.Process(12);  // Passes
}

TEST(MyTest, ContainerMatchers) {
  MockFoo mock;

  std::vector<int> expected = {1, 2, 3};

  // Expect ProcessList called with vector of exactly 3 elements 1,2,3
  EXPECT_CALL(mock, ProcessList(ElementsAre(1, 2, 3)));

  mock.ProcessList(expected);
}
```

---

# Advanced Matcher Topics

## Matching Multiple Arguments as a Whole

Use `.With()` clause to add matcher on all arguments at once (as a tuple). For example,

```cpp
EXPECT_CALL(mock, Func(_, _)).With(testing::Lt());
```

means 1st argument is less than 2nd argument.

## Using Matchers as Predicates

Matchers can be used as predicates in STL algorithms using `Matches()`:

```cpp
std::vector<int> v = {1, 5, 20};
int count = std::count_if(v.begin(), v.end(), Matches(Ge(10)));
// count == 1
```

## Combining Matchers Safely

Use `SafeMatcherCast` to convert between compatible matcher types safely when the compiler requires. Prefer using built-in matchers and their combinations.

## Writing Custom Matchers with MATCHER / MATCHER_P

Use MATCHER macros to define matchers succinctly, including descriptions and explanations to improve error messages on failures.

## Field and Property Matchers

Validate fields or getter results of objects:

```cpp
EXPECT_CALL(mock, Func(Field(&MyClass::value, Ge(10))));
EXPECT_CALL(mock, Func(Property(&MyClass::GetValue, Eq(5))));
```

## Pointer Matchers

Use `IsNull()`, `NotNull()`, and `Pointee()` for pointer arguments, including smart pointers.

---

# Matcher API Reference Summary

| Matcher Name           | Description                                   |
|-----------------------|-----------------------------------------------|
| `_`                   | Matches any value                              |
| `Eq(value)`           | Equals to `value`                             |
| `Ne(value)`           | Not equal to `value`                          |
| `Lt(value)`, `Le(value)` | Less than or less or equal than                |
| `Gt(value)`, `Ge(value)` | Greater than or greater or equal than          |
| `Not(matcher)`        | Negation of matcher                            |
| `AllOf(...)`          | Matches if all contained matchers match       |
| `AnyOf(...)`          | Matches if any contained matcher matches      |
| `Contains(element_matcher)` | Matches containers containing an element      |
| `ElementsAre(...)`    | Matches container elements in order           |
| `UnorderedElementsAre(...)` | Matches container elements in any order        |
| `StartsWith(string)`  | Matches strings starting with string          |
| `EndsWith(string)`    | Matches strings ending with string             |
| `HasSubstr(string)`   | Matches strings containing substring           |
| `IsNull()` / `NotNull()` | Matches null / non-null pointers              |
| `Pointee(matcher)`    | Matches pointer to value matching matcher     |
| `Field(&Class::member, matcher)` | Matches member field of object               |
| `Property(&Class::getter, matcher)` | Matches result of getter method               |
| `Truly(predicate)`    | Matches value satisfying predicate            |
| `SizeIs(matcher)`     | Matches containers whose size matches matcher |

---

# Additional Resources

- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [gMock Cookbook - Matchers](https://google.github.io/googletest/gmock_cook_book.html#Matchers)
- [Writing New Matchers](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers)
- [Assertion Macros using Matchers](./assertion-macros.md#EXPECT_THAT)
- [Mocking Reference](./mocking.md#EXPECT_CALL)

---