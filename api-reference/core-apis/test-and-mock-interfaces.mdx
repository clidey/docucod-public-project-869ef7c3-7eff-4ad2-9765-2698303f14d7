---
title: "Test and Mock Interfaces"
description: "Describes the main interfaces and macros for declaring and using tests and mocks, including how to structure test cases, define fixtures, and use mock objects. This page outlines the primary entry points for writing and organizing test code in C++."
---

# Test and Mock Interfaces

This page describes the core interfaces and macros for declaring and using tests and mocks in GoogleTest and GoogleMock. It covers how to structure test cases, define test fixtures, and create mock objects, outlining the primary entry points for writing and organizing test code in C++.

---

## Overview

In GoogleTest, tests are organized in test cases using macros that define individual tests and test fixtures. GoogleMock extends this by allowing you to define mock classes and specify expectations on mock method calls. Together, these interfaces empower you to write comprehensive unit tests with valid, readable, and maintainable structure.

---

## Test Declaration Macros

GoogleTest provides macros to define test cases and manage their lifecycle.

### TEST

Defines a simple test without shared setup or teardown.

```cpp
TEST(TestCaseName, TestName) {
  // Test code here
  EXPECT_EQ(42, MyFunction());
}
```

- `TestCaseName` groups related tests.
- `TestName` should be unique within the test case.

### TEST_F

Defines a test that uses a fixture class, allowing shared setup and teardown.

```cpp
class MyTestFixture : public testing::Test {
 protected:
  void SetUp() override {
    // Setup code here
  }
  void TearDown() override {
    // Cleanup code here
  }

  // Shared data
  int shared_value;
};

TEST_F(MyTestFixture, DoesSomething) {
  shared_value = 10;
  EXPECT_EQ(shared_value, 10);
}
```

The fixture class must inherit from `testing::Test` and can define setup and teardown logic in `SetUp()` and `TearDown()`.

---

## Writing Tests with Fixtures

Fixtures organize common pre-test setup and post-test cleanup.

### Workflow

1. Define a test fixture class inheriting from `testing::Test`.
2. Add member variables and helper methods.
3. Override `SetUp()` and `TearDown()` for initialization and cleanup.
4. Use `TEST_F` macros referencing the fixture class.

This pattern promotes reuse and clarity, especially for groups of tests with common dependencies or configuration.

---

## Defining Mock Classes

GoogleMock lets you create mock classes that simulate interfaces or classes your code depends on.

### MOCK_METHOD Macro

Within a mock class, use the `MOCK_METHOD` macro to declare mock methods:

```cpp
class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(return_type, MethodName, (arg_types), (specifiers));
};
```

- `return_type`: The return type of the method.
- `MethodName`: The name of the method.
- `arg_types`: Parameter types in parentheses.
- `specifiers`: (optional) qualifiers such as `(const, override)`.

Example:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Important Notes

- Place `MOCK_METHOD` in the `public:` section, even if the original method in the base class is protected or private.
- Commas in types must be protected by parentheses or replaced with type aliases to prevent macro parsing issues.

### Mock Class Usage

Create instances of your mock class to substitute real dependencies in tests.

```cpp
MockFoo mock_foo;
EXPECT_CALL(mock_foo, MethodName(ArgMatcher))
    .Times(1)
    .WillOnce(Return(value));

// Exercise code that uses mock_foo.
```

---

## Controlling Mock Behavior and Expectations

### Expectations: EXPECT_CALL

Use `EXPECT_CALL(mock, method(matchers))` to declare the expected interaction.

Example:

```cpp
EXPECT_CALL(mock_foo, DoSomething()).Times(1);
```

This ensures the method is called exactly once.

### Default Behavior: ON_CALL

Use `ON_CALL(mock, method(matchers))` to define default actions without setting expectations.

```cpp
ON_CALL(mock_foo, DoSomething()).WillByDefault(Return(true));
```

If there's no matching `EXPECT_CALL`, default actions from `ON_CALL` will be used.

---

## Mock Strictness Wrappers

GoogleMock offers wrappers to control warnings and failures for calls without explicit expectations.

| Wrapper              | Behavior for Uninteresting Calls                                  |
|----------------------|------------------------------------------------------------------|
| `NiceMock<T>`        | Suppresses warnings for uninteresting calls.                     |
| `NaggyMock<T>` (default) | Prints warnings for uninteresting calls.                        |
| `StrictMock<T>`      | Treats all uninteresting calls as test failures.                 |

### Using Strictness Wrappers

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

They inherit constructors from `T`, so you can create them with parameters as needed.

---

## Example: Defining and Using a Mock

```cpp
class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetValue(int x) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (int x), (override));
};

TEST(FooTest, ReturnsExpectedValue) {
  MockFoo mock;
  EXPECT_CALL(mock, GetValue(42))
      .WillOnce(testing::Return(100));

  int result = mock.GetValue(42);
  EXPECT_EQ(result, 100);
}
```

In this example, `GetValue(42)` is expected once, returning 100.

---

## Best Practices

- Always declare mock methods in the public section.
- Use strictness wrappers to balance test strictness and maintainability.
- Set expectations before exercising code to avoid undefined behavior.
- Use `ON_CALL` to specify default behavior without setting call expectations.
- Wrap arguments with parentheses in `MOCK_METHOD` when their types contain commas.
- For methods returning references, use `ReturnRef()` in actions.
- When mocking classes with non-default constructors, `NiceMock`, `NaggyMock`, or `StrictMock` will inherit those constructors transparently.

---

## Troubleshooting Common Pitfalls

- Missing virtual destructors in base classes can cause resource leaks or undefined behavior with mocks.
- Forgetting to set `EXPECT_CALL` leads to uninteresting calls and warnings (or failures with `StrictMock`). Use `NiceMock` if you want to suppress these warnings.
- Using the wrong method qualifiers (e.g., missing `const` where required) results in mismatches.
- Overly strict expectations may break tests unnecessarily. Use `Times` clauses appropriately.

---

## Summary

`Test and Mock Interfaces` provide the essential macros and classes to declare tests, test fixtures, and mocks in GoogleTest and GoogleMock. With clear syntax for defining tests, setup, and teardown, and powerful mock definition with `MOCK_METHOD` and strictness controls via `NiceMock`, `NaggyMock`, and `StrictMock`, users can write expressive and accurate unit tests efficiently.

---

## References

- [Writing Your First Test](../../guides/get-started/writing-tests.md)
- [Mocking Basics](../../guides/get-started/mocking-basics.md)
- [Mock Method Macros](../mocking-framework/mock-method-macros.md)
- [Cardinalities and Expectations](../mocking-framework/cardinalities-and-expectations.md)
- [Mock Strictness Wrappers](../mocking-framework/mock-strictness-wrappers.md)
- [gMock Cookbook - Creating Mock Classes](https://google.github.io/googletest/gmock_cook_book.html#creating-mock-classes)

---

More detailed examples and advanced usage can be found in the gMock [Cookbook](https://google.github.io/googletest/gmock_cook_book.html).


