---
title: "Matchers"
description: "Presents the complete API for GoogleTest and GoogleMock matchers, including built-in matchers, composition and combinators, and instructions for creating custom matchers. Illustrates matcher capabilities with real test examples and guides users through matcher extensibility points."
---

# Matchers API Reference

This reference presents the comprehensive API for GoogleTest and GoogleMock matchers, describing built-in matchers, matcher composition and combinators, and guidance on creating custom matchers. You will find practical examples demonstrating matcher usage in real tests and instructions to extend matcher functionality to suit complex validation needs.

---

## 1. Overview of Matchers

Matchers in GoogleTest enable you to specify flexible and expressive expectations for function arguments in mock objects. Instead of hardcoding exact argument values, matchers let you assert properties or constraints on arguments, increasing test robustness and clarity.

The matchers API supports:

- Built-in matchers for common conditions (`Eq`, `Lt`, `NotNull`, etc.)
- Composition combinators to combine multiple matchers logically (`AllOf`, `AnyOf`, `Not`)
- Property and field extraction matchers (`Field()`, `Property()`)
- Container element matchers to verify sequences (`ElementsAre`, `UnorderedElementsAre`)
- Custom matcher creation for domain-specific validations

Matchers work seamlessly with `EXPECT_CALL`, `ON_CALL`, and assertions like `EXPECT_THAT`.

---

## 2. Using Built-in Matchers

### 2.1 Wildcard and Simple Matchers

- `_` (Wildcard): Matches any value.
- `Eq(val)`: Matches values equal to `val`.
- `Ne(val)`: Matches values not equal to `val`.
- `Lt(val)`, `Le(val)`, `Gt(val)`, `Ge(val)`: Comparison matchers.
- `Not(m)`: Negates matcher `m`.

### Example
```cpp
EXPECT_CALL(mock_object, Method(Lt(5)));
EXPECT_CALL(mock_object, Method(Not(Eq(10))));
```

### 2.2 Matching Pointer Arguments

- `IsNull()`: Matches null pointers.
- `NotNull()`: Matches non-null pointers.
- `Pointee(m)`: Matches pointers to values matched by `m`. Supports raw and smart pointers. Null pointer always fails.

Example:
```cpp
EXPECT_CALL(mock, Func(Pointee(Ge(3))));  // Argument points to value >= 3
```

---

## 3. Combining Matchers

GoogleTest supports logical composition of matchers to express complex constraints.

- `AllOf(m1, m2, ...)`: Matches if all sub-matchers match.
- `AnyOf(m1, m2, ...)`: Matches if any sub-matcher matches.
- `Not(m)`: Matches if matcher `m` does not match.

Example:
```cpp
EXPECT_CALL(foo, Bar(AllOf(Gt(5), Ne(10))));
```

---

## 4. Matching Object Properties and Fields

When matching objects, you might want to constrain particular attributes or method results.

- `Field(&Type::field, m)`: Matches an object whose member `field` matches matcher `m`.
- `Property(&Type::func, m)`: Matches an object whose zero-argument const method `func()` matches `m`.

Example:
```cpp
EXPECT_CALL(mock, Foo(Field(&MyStruct::count, Ge(3))));
EXPECT_CALL(mock, Foo(Property(&MyClass::name, StartsWith("John"))));
```

Both can also be used to match pointers to objects, failing if the pointer is null.

---

## 5. Container Matchers

To verify container contents precisely or loosely:

- `ElementsAre(m_0, m_1, ...)`: Matches container elements in order.
- `UnorderedElementsAre(m_0, m_1, ...)`: Matches container elements in any order.
- `ElementsAreArray(array)`: Accepts C-style arrays or arrays of matchers.
- `UnorderedElementsAreArray(array)`: Same as above but order agnostic.
- `Pair(k, v)`: Matches a key-value pair in associative containers.

Example:
```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _, 5)));
EXPECT_THAT(my_map, UnorderedElementsAre(Pair("a", 1), Pair("b", 2)));
```

---

## 6. Sharing and Aliasing Matchers

Matchers are lightweight and share implementations internally. You can assign complex matchers to variables and reuse them without overhead.

Example:
```cpp
Matcher<int> in_range = AllOf(Gt(5), Le(10));
EXPECT_CALL(foo, Bar(in_range));
```

---

## 7. Creating Custom Matchers

Custom matchers allow you to express domain-specific validation logic. GoogleMock provides multiple ways to define matchers:

### 7.1 Using MATCHER and MATCHER_P Macros

- `MATCHER(name, description)` defines a matcher named `name` that operates on `arg`.
- `MATCHER_P(name, param, description)` additionally accepts a parameter `param`.

Example:
```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
// Usage:
EXPECT_THAT(value, IsDivisibleBy7());

MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}
```

### 7.2 Advanced Matcher Classes

For advanced usage, implement a class with:

- `bool MatchAndExplain(const T& value, std::ostream* os) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`.

Return a `testing::Matcher<T>` object wrapping the class instance.

Example:
```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream*) const {
    return (n % 7) == 0;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is divisible by 7";
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not divisible by 7";
  }
};

Matcher<int> DivisibleBy7() {
  return DivisibleBy7Matcher();
}
```

---

## 8. Advanced Matching Techniques

### 8.1 Multi-argument Matchers

You can match multiple arguments as a tuple using the `.With()` clause in `EXPECT_CALL`:

```cpp
EXPECT_CALL(mock, Func(_, _))
  .With(Lt());  // Expects first argument < second argument
```

Alternatively, use `AllArgs(m)` or `Args<k1, k2>(m)` to focus on specific arguments.

### 8.2 Using Matchers as Predicates

Matchers can be wrapped with `Matches()` to serve as predicates in STL algorithms.

Example:
```cpp
const int count = std::count_if(vec.begin(), vec.end(), Matches(Ge(10)));
```

### 8.3 Safe Matcher Casting

Sometimes you need to match arguments of related but not identical types:

```cpp
EXPECT_CALL(mock, Foo(SafeMatcherCast<Derived*>(m_base_ptr_matcher)));
```

This ensures type safety during matcher conversion.

---

## 9. Matcher Best Practices and Troubleshooting

- Always use matchers that are *pure* functions without side effects.
- Use `ON_CALL` to set default mock behavior, and `EXPECT_CALL` to set explicit expectations.
- Avoid overly strict expectations that make tests brittle.
- For complex argument verification, consider saving arguments for separate assertions.
- Suppress warnings on uninteresting calls by using `NiceMock` if needed.

---

## 10. Real-World Matcher Examples

### Basic Matching Example
```cpp
using ::testing::_;
using ::testing::Lt;
using ::testing::Return;

class MockTurtle {
 public:
  MOCK_METHOD(void, Forward, (int distance), (override));
};

TEST(TurtleTest, MovesForward) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, Forward(Lt(100)))
      .Times(1)
      .WillOnce(Return());

  turtle.Forward(50);  // Succeeds since 50 < 100
}
```

### Matching Multiple Arguments
```cpp
EXPECT_CALL(mock, SetPosition(_, _))
  .With(Lt());  // The first argument must be less than the second
```

### Custom Matcher Usage
```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Process(IsEven()));
```

---

## 11. Extending Matcher Capabilities

You can build polymorphic and parameterized matchers that adapt their behavior to multiple argument types and provide rich descriptions. Use `MATCHER_Pk` macros for multiple parameters and consider inheriting from matcher interfaces for fine-grained control.

GoogleMock also supports composite matchers that embed sub-matchers, managing their descriptions and match logic properly.

---

### Source
For full API implementation and detailed internal logic, see:
<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-spec-builders.h","range": "10-250"},{"path": "docs/gmock_cook_book.md","range": "50-500"}]} />

---