---
title: "Assertions and Expectations"
description: "Detailed reference for all built-in assertions and test expectations. Documents syntax, usage examples, and advanced assertion features including fatal/non-fatal behavior and exception checks."
---

# Assertions and Expectations

This document provides a detailed reference for all built-in GoogleTest assertions and test expectations. It includes their syntax, functional descriptions, example usages, and advanced features such as fatal versus non-fatal behavior and exception handling.

---

## 1. Understanding Assertions in GoogleTest

GoogleTest offers various macros to assert conditions in your tests. These assertions check program behavior and report success or failure accordingly. All assertion macros are defined in the `<gtest/gtest.h>` header.

### Fatal vs. Non-Fatal Assertions
Most assertion macros have two variants:
- `ASSERT_` macros generate **fatal failures** that abort the current test function immediately.
- `EXPECT_` macros generate **non-fatal failures** which allow the test to continue running.

For example, use `ASSERT_EQ` when further execution after failure is meaningless or would cause crashes, and `EXPECT_EQ` when you want to continue testing despite a failure.

Both accept streaming of custom failure messages using `<<` to clarify failure reasons.

Example:
```cpp
EXPECT_TRUE(value) << "Value should be true but isn't.";
```

---

## 2. Basic Assertions

### 2.1 Explicit Success and Failure

- `SUCCEED()`
  - Generates an explicit success.
  - Useful for documenting code paths that represent successful outcomes.

- `FAIL()`
  - Generates a fatal failure and aborts the current function.
  - Can only be used in void-returning functions.

- `ADD_FAILURE()`
  - Generates a non-fatal failure, allowing tests to continue.

- `ADD_FAILURE_AT(file, line)`
  - Generates a non-fatal failure reported at the specified source file and line.

### Example
```cpp
switch(result) {
  case ExpectedValue:
    SUCCEED();
    break;
  default:
    FAIL() << "Unexpected result";
}
```

---

### 2.2 Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

Checks that the condition evaluates to true or false, respectively.

Detailed failure messages include actual values.

---

### 2.3 Equality and Relational Assertions

GoogleTest provides assertions to compare values with standard comparison operators:

- Equality:
  - `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`  // `val1 == val2`
  - `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`  // `val1 != val2`

- Ordering:
  - `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)`  // `val1 < val2`
  - `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)`  // `val1 <= val2`
  - `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)`  // `val1 > val2`
  - `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)`  // `val1 >= val2`

> **Important:**
> - Use `EXPECT_STREQ` family to compare C strings for content equality (see section 2.4).
> - When comparing pointers with `NULL`, prefer `nullptr` in newer C++ code.

---

### 2.4 String Comparison Assertions

Specialized macros for comparing C strings and wide strings by their contents:

- Equality:
  - `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)`
  - `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)` (case-insensitive)

- Inequality:
  - `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)`
  - `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)` (case-insensitive)

If either string is a wide string, GoogleTest converts it to UTF-8 when displaying failure messages.

Use these macros instead of `EXPECT_EQ` when comparing string contents to avoid pointer comparison.

---

### 2.5 Floating-Point Comparisons

Direct equality is unsuitable for floats and doubles due to rounding errors. GoogleTest provides specialized assertions:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)`
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)`

These macros check for approximate equality within 4 Units in the Last Place (ULPs).

For configurable tolerance, use:
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`

where the absolute difference should be within `abs_error`.

---

### 2.6 Exception Assertions

To verify exception-related behavior, GoogleTest supports:

- `EXPECT_THROW(stmt, exception_type)` / `ASSERT_THROW(stmt, exception_type)`
  - Verifies that executing `stmt` throws an exception of type `exception_type`.

- `EXPECT_ANY_THROW(stmt)` / `ASSERT_ANY_THROW(stmt)`
  - Verifies that `stmt` throws any exception.

- `EXPECT_NO_THROW(stmt)` / `ASSERT_NO_THROW(stmt)`
  - Verifies that `stmt` does not throw any exception.

> The code under test can be a compound statement wrapped in `{ ... }`.

---

### 2.7 Predicate Assertions

For complex custom predicates, GoogleTest provides predicate-based assertions with better failure messages:

- `EXPECT_PRED1(pred, val1)`, ..., `EXPECT_PRED5(pred, val1, ..., val5)`
- `ASSERT_PRED1(pred, val1)`, ..., `ASSERT_PRED5(pred, val1, ..., val5)`

Here, `pred` is a function or functor returning `bool`.

Additionally, for predicates that return `testing::AssertionResult`, which allow rich failure messages:

- `EXPECT_PRED_FORMAT1(pred_formatter, val1)`, ..., `EXPECT_PRED_FORMAT5(pred_formatter, val1, ..., val5)`
- `ASSERT_PRED_FORMAT1(pred_formatter, val1)`, ..., `ASSERT_PRED_FORMAT5(pred_formatter, val1, ..., val5)`

`pred_formatter` has a signature that outputs detailed failure reasons.

---

### 2.8 Windows HRESULT Assertions

For Windows development, GoogleTest supports assertions to check HRESULT values:

- `EXPECT_HRESULT_SUCCEEDED(expression)` / `ASSERT_HRESULT_SUCCEEDED(expression)`
  - Verifies that `expression` returns a success HRESULT.

- `EXPECT_HRESULT_FAILED(expression)` / `ASSERT_HRESULT_FAILED(expression)`
  - Verifies that `expression` returns a failure HRESULT.

Failure messages include corresponding HRESULT codes and descriptions.

---

### 2.9 Death Assertions

Death tests verify that code causes the program to terminate as expected.

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)`
  - Verifies that executing `statement` causes the process to die with stderr matching `matcher`.

- `EXPECT_DEATH_IF_SUPPORTED(statement, matcher)` / `ASSERT_DEATH_IF_SUPPORTED(statement, matcher)`
  - Runs `EXPECT_DEATH` if death tests are supported; otherwise, does nothing.

- `EXPECT_DEBUG_DEATH(statement, matcher)` / `ASSERT_DEBUG_DEATH(statement, matcher)`
  - Runs death test only in debug mode; otherwise simply executes `statement`.

- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT(statement, predicate, matcher)`
  - Verifies that `statement` causes process exit matching `predicate` and stderr matching `matcher`.

Matchers for `matcher` can be string matchers or regular expressions. Custom exit status predicates like `ExitedWithCode` and `KilledBySignal` are provided.

Death tests execute `statement` in a separate process, isolating the death.

---

### 2.10 Complex and Custom Assertions

GoogleTest supports the `EXPECT_THAT` and `ASSERT_THAT` macros that leverage gMock matchers to perform flexible value matching using expressive matcher expressions.

Example:
```cpp
#include <gmock/gmock.h>

using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(value_str, StartsWith("Hello"));
EXPECT_THAT(another_str, MatchesRegex("Line \\d+"));
ASSERT_THAT(num, AllOf(Gt(5), Lt(10)));
```

Matchers provide clear English-like descriptions and informative failure messages.

---

## 3. Best Practices & Common Pitfalls

- Use `ASSERT_` when a failure should abort a test function early to prevent undefined behavior.
- Use `EXPECT_` to allow multiple checks in a single test and continue after failures.
- Avoid comparing pointers to strings with `EXPECT_EQ`; use `EXPECT_STREQ` for content comparison.
- For floating-point comparisons, `EXPECT_FLOAT_EQ` and `EXPECT_DOUBLE_EQ` provide better approximate equality checks.
- Use predicate assertions for complex logical conditions that are hard to express with basic macros.
- When writing death tests, wrap statements with braces `{ ... }` to ensure compound execution.
- Use custom failure messages with `<<` to clarify complex assertion failures.

---

## 4. Assertion Examples

### 4.1 Boolean Assertions
```cpp
EXPECT_TRUE(is_ready);
ASSERT_FALSE(has_error) << "Operation unexpectedly failed.";
```

### 4.2 Equality Assertions
```cpp
EXPECT_EQ(expected_value, actual_value);
ASSERT_NE(nullptr, ptr);
EXPECT_LT(min_value, test_value);
```

### 4.3 String Assertions
```cpp
EXPECT_STREQ("hello", greeting.c_str());
ASSERT_STRCASEEQ("HELLO", greeting.c_str());
EXPECT_STRNE("bye", response.c_str());
```

### 4.4 Floating-Point Assertions
```cpp
EXPECT_FLOAT_EQ(3.14f, my_value);
ASSERT_DOUBLE_EQ(0.1 + 0.2, 0.3);
EXPECT_NEAR(calculated, expected, 0.001);
```

### 4.5 Exception Assertions
```cpp
EXPECT_THROW(MyFunc(), std::runtime_error);
ASSERT_ANY_THROW(MyFuncThrowingAnyException());
EXPECT_NO_THROW(MyFuncSafe());
```

### 4.6 Predicate Assertions
```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, value);

// Using a predicate formatter
AssertionResult IsPositive(const char* expr, int val) {
  if(val > 0) return AssertionSuccess();
  return AssertionFailure() << expr << " is not positive";
}
EXPECT_PRED_FORMAT1(IsPositive, value);
```

---

## 5. Troubleshooting Common Assertion Issues

### Failure to Continue After Fatal Assertion
If your function returns a non-void type and you use `ASSERT_*` or `FAIL()`,
compilation errors will occur. Use `EXPECT_*` for non-void functions, or
refactor to return `void` when an early abort is required.

### Comparing C Strings Using `EXPECT_EQ`
`EXPECT_EQ` compares pointer addresses for C strings, not contents.
Always use `EXPECT_STREQ` and its variants for string content comparisons.

### Floating-Point Equality Failures
Due to precision, expect approximate comparisons using `EXPECT_FLOAT_EQ`,
`EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` instead of exact equality.

### Death Tests Not Executing Properly
Ensure you use compound statements in your death tests,
for example: `ASSERT_DEATH({ code; }, "message");`

### Assertion Evaluation with Side Effects
Arguments to assertion macros are evaluated exactly once to avoid side
effects repeating unexpectedly; use temporary variables if you need reuse.

---

## 6. Additional Resources

- [GoogleTest Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Matchers Reference](../advanced-behaviors/argument-matchers.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Writing and Running Your First Test](../guides/getting-started/your-first-test.md)
- [Effective Testing Techniques Guide](../guides/effective-testing-techniques/assertions-best-practices.md)

---

End of Assertions and Expectations documentation.