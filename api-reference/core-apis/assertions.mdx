---
title: "Assertions"
description: "A detailed reference for built-in assertion macros, covering their signatures, behaviors, and best practice patterns. Learn when to use fatal versus non-fatal assertions, how to capture assertion results, and how to extend assertions for custom needs."
---

# Assertions Reference

A detailed reference for built-in assertion macros, covering their signatures, behaviors, and best practice patterns. Learn when to use fatal versus non-fatal assertions, how to capture assertion results, and how to extend assertions for custom needs.

---

## Overview

Assertions in GoogleTest verify program correctness by confirming expected conditions or behaviors. They consist of a rich set of macros designed to support different verification needs, including basic boolean checks, equality comparisons, string matching, exception handling, floating-point comparisons, and predicate assertions.

Every assertion macro comes in pairs:

- `EXPECT_` variants generate *non-fatal failures*—the current function continues after failure.
- `ASSERT_` variants generate *fatal failures*—the current function is aborted on failure.

You typically want to use `EXPECT_` macros unless continuing after failure is not meaningful, in which case use `ASSERT_`.

Custom failure messages can be streamed into any assertion macro using `<<`, allowing precise diagnostics on failure.

---

## 1. Explicit Success and Failure

These assertions signal success or failure directly, without testing any expression.

### SUCCEED()

```cpp
SUCCEED();
```

Deliberately generates a success. Note that this doesn't guarantee the overall test passes; tests fail if any assertions fail. Useful for marking explicit success points.

### FAIL()

```cpp
FAIL();
```

Generates a fatal failure and immediately returns from the current `void` function. Use to indicate unreachable code paths or when a certain control flow path must not be taken.

### ADD_FAILURE()

```cpp
ADD_FAILURE();
```

Generates a nonfatal failure, allowing execution to continue. Useful for flagging unexpected conditions without aborting.

### ADD_FAILURE_AT(file_path, line_number)

```cpp
ADD_FAILURE_AT("foo.cc", 42);
```

Generates a nonfatal failure reported at the specified file and line. Useful for precise error reporting in helper functions or macros.

---

## 2. Generalized Assertions

GoogleTest supports powerful assertions using [gMock matchers](../matchers.md) for expressive and extensible verification.

### EXPECT_THAT(value, matcher)

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
```

Asserts that `value` matches the specified matcher, enabling readable assertions with detailed failure messages. Both `EXPECT_THAT` and `ASSERT_THAT` variants exist.

---

## 3. Boolean Condition Assertions

### EXPECT_TRUE(condition)

```cpp
EXPECT_TRUE(is_valid);
```

Passes if `condition` evaluates to true. Generates nonfatal failure otherwise.

### ASSERT_TRUE(condition)

```cpp
ASSERT_TRUE(result);
```

Passes if `condition` evaluates to true. Generates fatal failure and returns from the current function otherwise.

### EXPECT_FALSE(condition)

```cpp
EXPECT_FALSE(has_error);
```

Passes if `condition` evaluates to false.

### ASSERT_FALSE(condition)

```cpp
ASSERT_FALSE(is_ready);
```

Passes if `condition` evaluates to false. Fails fatally otherwise.

These assertions print the values of the condition and informative messages on failure.

---

## 4. Binary Comparisons

Assertions comparing two values using relational operators. Supports standard and user-defined types, including pointers and C-strings (with exceptions for `EXPECT_STREQ` family).

| Macro           | Description                                         |
|-----------------|-----------------------------------------------------|
| EXPECT_EQ(val1, val2)  | Checks if `val1 == val2`.                       |
| ASSERT_EQ(val1, val2)  | Fatal version of `EXPECT_EQ`.                     |
| EXPECT_NE(val1, val2)  | Checks if `val1 != val2`.                        |
| ASSERT_NE(val1, val2)  | Fatal version of `EXPECT_NE`.                     |
| EXPECT_LT(val1, val2)  | Checks if `val1 < val2`.                         |
| ASSERT_LT(val1, val2)  | Fatal version of `EXPECT_LT`.                     |
| EXPECT_LE(val1, val2)  | Checks if `val1 <= val2`.                        |
| ASSERT_LE(val1, val2)  | Fatal version of `EXPECT_LE`.                     |
| EXPECT_GT(val1, val2)  | Checks if `val1 > val2`.                         |
| ASSERT_GT(val1, val2)  | Fatal version of `EXPECT_GT`.                     |
| EXPECT_GE(val1, val2)  | Checks if `val1 >= val2`.                        |
| ASSERT_GE(val1, val2)  | Fatal version of `EXPECT_GE`.                     |

Example:

```cpp
EXPECT_EQ(expected_size, my_vector.size()) << "Unexpected vector size.";
```

---

## 5. String Comparisons

These assertions specifically compare null-terminated C strings, including support for wide strings:

| Macro              | Description                                  |
|--------------------|----------------------------------------------|
| EXPECT_STREQ(s1, s2)    | Checks if strings have the same content.       |
| ASSERT_STREQ(s1, s2)    | Fatal version of `EXPECT_STREQ`.               |
| EXPECT_STRNE(s1, s2)    | Checks if strings differ.                       |
| ASSERT_STRNE(s1, s2)    | Fatal version of `EXPECT_STRNE`.                |
| EXPECT_STRCASEEQ(s1, s2)| Case-insensitive equality check.               |
| ASSERT_STRCASEEQ(s1, s2)| Fatal version of `EXPECT_STRCASEEQ`.           |
| EXPECT_STRCASENE(s1, s2)| Case-insensitive inequality check.             |
| ASSERT_STRCASENE(s1, s2)| Fatal version of `EXPECT_STRCASENE`.            |

Example:

```cpp
EXPECT_STREQ("hello", buffer) << "String value did not match.";
```

Wide strings are converted to UTF-8 for printing in failure messages.

---

## 6. Floating-Point Comparison

Regular comparisons on floating-point values are unreliable due to rounding errors. GoogleTest provides specialized macros with default tolerances based on ULPs (Units in the Last Place), plus absolute difference checks.

### EXPECT_FLOAT_EQ(val1, val2)

```cpp
EXPECT_FLOAT_EQ(computed_float, expected_float);
```

Checks that two `float` values are approximately equal within 4 ULPs. Considers infinities and special cases properly.

### EXPECT_DOUBLE_EQ(val1, val2)

```cpp
EXPECT_DOUBLE_EQ(computed_double, expected_double);
```

Similar to `EXPECT_FLOAT_EQ` but for `double`.

### EXPECT_NEAR(val1, val2, abs_error)

```cpp
EXPECT_NEAR(actual, expected, 0.001);
```

Checks the absolute difference between two floating-point values does not exceed `abs_error`.

Failure messages clearly indicate the difference and tolerance.

---

## 7. Exception Assertions

Requires compiler support for exceptions.

| Macro            | Checks                                               |
|------------------|-----------------------------------------------------|
| EXPECT_THROW(stmt, exception_type)      | `stmt` throws the expected exception type.              |
| ASSERT_THROW(stmt, exception_type)      | Fatal version of `EXPECT_THROW`.                        |
| EXPECT_ANY_THROW(stmt)                   | `stmt` throws any exception.                            |
| ASSERT_ANY_THROW(stmt)                   | Fatal version of `EXPECT_ANY_THROW`.                    |
| EXPECT_NO_THROW(stmt)                    | `stmt` does not throw any exception.                    |
| ASSERT_NO_THROW(stmt)                    | Fatal version of `EXPECT_NO_THROW`.                     |

Example:

```cpp
EXPECT_THROW(Foo(), std::runtime_error);
```

---

## 8. Predicate Assertions

Predicate assertions enable richer verification with informative failure messages by invoking a user-supplied predicate or predicate-formatter.

### EXPECT_PRED* Macros

`EXPECT_PRED1`, `EXPECT_PRED2`, ..., `EXPECT_PRED5` accept predicates that return `bool`. They print values of arguments upon failure.

Example:

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, x);
```

If the assertion fails, the message shows the values of `x`.

### EXPECT_PRED_FORMAT* Macros

Allow fully custom messages by using a predicate-formatter returning `testing::AssertionResult`. The predicate receives expressions as strings alongside argument values.

Example:

```cpp
testing::AssertionResult AssertIsEven(const char* expr, int n) {
  if ((n % 2) == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}

EXPECT_PRED_FORMAT1(AssertIsEven, value);
```

---

## 9. Windows HRESULT Assertions

On Windows platforms, macros exist to validate HRESULT codes:

- `EXPECT_HRESULT_SUCCEEDED(expr)`: verifies `expr` is a success HRESULT.
- `ASSERT_HRESULT_SUCCEEDED(expr)`: fatal version.
- `EXPECT_HRESULT_FAILED(expr)`: verifies `expr` failed.
- `ASSERT_HRESULT_FAILED(expr)`: fatal version.

Failure messages display the HRESULT code and descriptive information.

---

## 10. Death Assertions

Test that code terminates a process under expected conditions.

| Macro                | Description                                                       |
|----------------------|-------------------------------------------------------------------|
| EXPECT_DEATH(stmt, regex) | Verifies `stmt` terminates with output matching `regex`.           |
| ASSERT_DEATH(stmt, regex) | Fatal version of `EXPECT_DEATH`.                                   |
| EXPECT_EXIT(stmt, predicate, regex) | Verifies `stmt` exits with status matching `predicate` and output matching `regex`. |
| ASSERT_EXIT(stmt, predicate, regex) | Fatal version of `EXPECT_EXIT`.                                   |

`
stmt` may be a compound statement.

Example:

```cpp
EXPECT_DEATH({ Foo(); }, "Error on line .* of Foo()");
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

---

## 11. Using Assertions in Sub-Routines

### Adding Traces with SCOPED_TRACE

Wrap complex subroutine invocations to annotate failures with contextual information.

```cpp
{
  SCOPED_TRACE("Processing index " << i);
  Subroutine(i);
}
```

This appends the trace message to any failures within the scope.

### Propagating Fatal Failures

Fatal failures abort only the current function, not the overall test. To simulate propagating failures:

- Use exceptions (requires enabling them).
- Use `ASSERT_NO_FATAL_FAILURE(statement)` or `EXPECT_NO_FATAL_FAILURE(statement)` macros.
- Check `HasFatalFailure()` to early exit.

---

## Troubleshooting and Best Practices

- Use `EXPECT_` rather than `ASSERT_` when possible to get all test failures in one run.
- Remember `ASSERT_` macros can only be used in void-returning functions.
- Avoid placing fatal assertions in constructors or destructors.
- Use predicate or predicate-format assertions for complex or custom verification with clear messages.
- For death tests, be mindful that the code is run in a separate process; side effects won't propagate.
- Use string assertions for C strings; `EXPECT_EQ` compares pointer addresses.
- Use custom message streaming to add clarity and context to failures.

---

## Code Examples

```cpp
// Basic equality assertion with custom message
EXPECT_EQ(val1, val2) << "Values differ at index " << i;

// Predicate assertion for even number check
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, x);

// Predicate formatter assertion with detailed message
testing::AssertionResult CheckPositive(const char* expr, int n) {
  if (n > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " is negative: " << n;
}
EXPECT_PRED_FORMAT1(CheckPositive, x);

// Death test example
EXPECT_DEATH({ AbortIfNull(ptr); }, "null pointer detected");

// Floating-point comparison
EXPECT_FLOAT_EQ(calculated_pi, 3.14159f);

// Exception assertion
EXPECT_THROW(SomeFunction(), std::runtime_error);

// String equality
EXPECT_STREQ("hello", buffer);
```

---

## Summary

This page comprehensively documents GoogleTest assertion macros, guiding users from basic conditions to advanced custom assertions and death tests. By using this reference, developers can write robust, informative tests that catch bugs early and clearly report failures, improving debugging efficiency and code quality.

---

## Cross-References

- [Matchers Reference](../matchers.md): For use with `EXPECT_THAT`.
- [Advanced GoogleTest Topics](../advanced.md): Covers hooks, failure propagation, and custom messages.
- [GoogleMock Cookbook](../gmock_cook_book.md): For advanced predicate and mocking techniques.
- [GoogleTest Primer](../primer.md): Beginner-friendly introduction.

---

## Practical Tips

- Use `EXPECT_` variants to accumulate multiple failures in a test.
- Use `ASSERT_` variants when later code in the function depends on the assertion.
- Add `SCOPED_TRACE` to improve failure message context in loops and nested calls.
- For precise floating-point comparisons, prefer `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` over `EXPECT_EQ`.
- When writing death tests, isolate failure causes clearly and use regular expressions to match expected error output.
- Stream custom messages into assertions to clarify failure reasons.

---

## Troubleshooting Common Issues

- **Fatal assertions in non-void functions:** Only use fatal assertions in `void` functions; wrap non-void functions or split logic to allow this.
- **Assertion macros evaluating arguments multiple times:** Arguments to assertion macros are always evaluated once; side-effects should be minimal.
- **Comparing pointers with `EXPECT_EQ`:** `EXPECT_EQ` checks pointer equality, not string content. Use `EXPECT_STREQ` for C strings.
- **Death tests not detecting failure:** Check that the statement actually terminates the process; exceptions do not count as death.
- **Using assertions in constructors/destructors:** Avoid fatal assertions in these; prefer `SetUp`/`TearDown`.

---

<Info>
For complete and detailed API signatures of each assertion macro, see the [Assertions Reference in the GoogleTest GitHub repository](https://github.com/google/googletest/blob/main/docs/reference/assertions.md).
</Info>
