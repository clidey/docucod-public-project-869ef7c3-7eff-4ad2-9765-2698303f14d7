---
title: "Assertions and Failure Handling"
description: "Provides full reference for all built-in assertion macros used to verify behavior and outcomes in tests, including equality, inequalities, exception assertions, death tests, and custom assertions. Describes fatal vs. non-fatal failures and their influence on test flow."
---

# Assertions and Failure Handling

## Overview

Assertions form the backbone of verifying behavior and outcomes in GoogleTest. This page serves as a complete reference for all built-in assertion macros, including those for equality, inequality, boolean conditions, exceptions, floating-point comparisons, string comparisons, death tests, and custom predicates. It also details the semantics of fatal vs. non-fatal failures and how they affect test flow.

By mastering these assertions, you can craft precise checks that either halt a test immediately upon critical failure or allow continued verification despite some errors, depending on your testing goals.

---

## Understanding Assertions

Each assertion macro in GoogleTest comes in two variants:

- **`EXPECT_` assertions:** Generate non-fatal failures, allowing the test function to continue executing.
- **`ASSERT_` assertions:** Generate fatal failures, aborting the current function immediately.

Use `EXPECT_` macros when you want to check multiple conditions and report all failures within a test.
Choose `ASSERT_` macros when encountering a failure should prevent further execution (e.g., dereferencing a null pointer).

All assertions also support streaming custom failure messages using the `<<` operator.

```cpp
EXPECT_TRUE(x > 0) << "Expected positive value";
ASSERT_EQ(expected, actual) << "Mismatch in values";
```

---

## Assertion Categories and Macros

### 1. Explicit Success and Failure

- **`SUCCEED()`**
  - Generates a success event. Useful for documenting that a particular test point was reached.
  - Does *not* make the entire test succeed if other assertions fail.

- **`FAIL()`**
  - Generates a fatal failure, immediately aborting the current function.
  - Can only be used in `void` functions (e.g., test bodies).

- **`ADD_FAILURE()`**
  - Generates a nonfatal failure, allowing test continuation.

- **`ADD_FAILURE_AT(file, line)`**
  - Generates a nonfatal failure with the failure attributed to the specified file and line.

### 2. Boolean Condition Assertions

- **`EXPECT_TRUE(condition)`**, **`ASSERT_TRUE(condition)`**
  - Test that `condition` evaluates to true.

- **`EXPECT_FALSE(condition)`**, **`ASSERT_FALSE(condition)`**
  - Test that `condition` evaluates to false.

### 3. Binary Comparison Assertions

Macros to compare two values using relational operators. On failure, GoogleTest displays both the expressions and their evaluated values if possible.

| Macro           | Meaning                          |
|-----------------|---------------------------------|
| `EXPECT_EQ(a,b)` | Check `a == b`                   |
| `EXPECT_NE(a,b)` | Check `a != b`                   |
| `EXPECT_LT(a,b)` | Check `a < b`                    |
| `EXPECT_LE(a,b)` | Check `a <= b`                   |
| `EXPECT_GT(a,b)` | Check `a > b`                    |
| `EXPECT_GE(a,b)` | Check `a >= b`                   |
| (also `ASSERT_` versions for fatal failures)                  |

**Note on C strings:** These macros compare pointer addresses, not string content. Use string-specific macros for content comparison.

### 4. String Comparison Assertions

These macros are designed for C-style strings, including wide strings.

- **`EXPECT_STREQ(str1, str2)`**, **`ASSERT_STREQ(str1, str2)`**
  - Verify that two C strings have the same content.

- **`EXPECT_STRNE(str1, str2)`**, **`ASSERT_STRNE(str1, str2)`**
  - Verify two C strings differ in content.

- **`EXPECT_STRCASEEQ(str1, str2)`**, **`ASSERT_STRCASEEQ(str1, str2)`**
  - Verify two C strings are equal ignoring case.

- **`EXPECT_STRCASENE(str1, str2)`**, **`ASSERT_STRCASENE(str1, str2)`**
  - Verify two C strings differ ignoring case.

### 5. Floating-Point Comparison Assertions

Comparing floating-point values is subtle due to rounding errors. GoogleTest provides assertions that check approximate equality based on Units in the Last Place (ULPs).

- **`EXPECT_FLOAT_EQ(val1, val2)`**, **`ASSERT_FLOAT_EQ(val1, val2)`**
  - Checks two `float` values are approximately equal (within 4 ULPs).

- **`EXPECT_DOUBLE_EQ(val1, val2)`**, **`ASSERT_DOUBLE_EQ(val1, val2)`**
  - Checks two `double` values are approximately equal (within 4 ULPs).

- **`EXPECT_NEAR(val1, val2, abs_error)`**, **`ASSERT_NEAR(val1, val2, abs_error)`**
  - Checks that absolute difference between `val1` and `val2` does not exceed `abs_error`.

### 6. Exception Assertions

Require that C++ exceptions are enabled.

- **`EXPECT_THROW(statement, exception_type)`**, **`ASSERT_THROW(statement, exception_type)`**
  - Verifies `statement` throws an exception of type `exception_type`.

- **`EXPECT_ANY_THROW(statement)`**, **`ASSERT_ANY_THROW(statement)`**
  - Verifies `statement` throws any exception.

- **`EXPECT_NO_THROW(statement)`**, **`ASSERT_NO_THROW(statement)`**
  - Verifies `statement` does not throw any exception.

Example:

```cpp
EXPECT_THROW({ Foo(); }, std::runtime_error);
EXPECT_NO_THROW({ Bar(); });
```

### 7. Predicate Assertions

When you need more expressive and detailed failure messages for complex conditions:

- **`EXPECT_PREDn(predicate, val1, val2, ...)`**, **`ASSERT_PREDn(predicate, val1, val2, ...)`**
  - `predicate` is a function/functor returning `bool`. Provides argument values on failure.

- **`EXPECT_PRED_FORMATn(pred_formatter, val1, val2, ...)`**, **`ASSERT_PRED_FORMATn(pred_formatter, val1, val2, ...)`**
  - `pred_formatter` returns `AssertionResult` and can customize failure message formatting.

These enable detailed failure reporting beyond simple boolean checks.

### 8. Windows HRESULT Assertions (Windows only)

Test HRESULT return values from Windows APIs.

- **`EXPECT_HRESULT_SUCCEEDED(expression)`**, **`ASSERT_HRESULT_SUCCEEDED(expression)`**
  - Verifies expression returns a success HRESULT.

- **`EXPECT_HRESULT_FAILED(expression)`**, **`ASSERT_HRESULT_FAILED(expression)`**
  - Verifies expression returns a failure HRESULT.

### 9. Death Assertions

For scenarios where the code under test is expected to terminate the process, GoogleTest supports *death tests*.

- **`EXPECT_DEATH(statement, matcher)`**, **`ASSERT_DEATH(statement, matcher)`**
  - Verifies that `statement` crashes or exits with output matching `matcher`.

- **`EXPECT_EXIT(statement, predicate, matcher)`**, **`ASSERT_EXIT(statement, predicate, matcher)`**
  - Verifies process exit status satisfies `predicate` and output matches `matcher`.

- Additional macros such as `EXPECT_DEATH_IF_SUPPORTED`, `EXPECT_DEBUG_DEATH` exist based on platform and mode.

---

## Fatal vs. Non-fatal Failures and Test Flow

- Fatal failures (`ASSERT_*`, `FAIL()`) immediately abort the current function, preventing further execution within that function. This allows immediate termination when continuing doesn't make sense.

- Non-fatal failures (`EXPECT_*`, `ADD_FAILURE()`) record the failure but allow the function to continue, enabling the test to check multiple conditions and provide comprehensive failure reports.

**Important**: Fatal assertions generate a failure and *return* from the current function - they do *not* throw exceptions. This means they abort only the current function, not the entire test or test suite. To propagate a fatal failure from a helper subroutine and stop the whole test, you can:

- Use `ASSERT_NO_FATAL_FAILURE(helper_function())` to verify no fatal failures happen inside.
- Check `HasFatalFailure()` after calls to subroutines and explicitly return early if needed.
- Enable exceptions for fatal failures via event listeners.

---

## Customizing Assertion Messages

You can stream custom failure messages into any assertion to provide additional context:

```cpp
EXPECT_EQ(foo, bar) << "foo and bar differ for input: " << input_value;
```

This message is appended to the standard GoogleTest failure message.

---

## Advanced Features

### Skipping Tests at Runtime

Use `GTEST_SKIP()` to skip the rest of a test case at runtime, optionally with a message:

```cpp
TEST(MyTest, SkipExample) {
  if (!IsFeatureAvailable()) {
    GTEST_SKIP() << "Feature not available";
  }
  ... // Rest of test
}
```

### Adding Traces to Assertions

Use `SCOPED_TRACE(message)` to attach additional trace information to all failures within a scope, helpful for diagnosing failures inside helper functions or loops.

```cpp
SCOPED_TRACE("Loop iteration " << i);
EXPECT_EQ(Foo(i), expected_value);
```

### Teaching GoogleTest to Print Custom Types

For better failure messages, teach GoogleTest how to print your types by defining an `AbslStringify(Sink&, const T&)` or a `PrintTo(const T&, std::ostream*)` function in the same namespace as your type.

```cpp
namespace foo {
class Point {
  int x, y;
  template <typename Sink>
  friend void AbslStringify(Sink& sink, const Point& p) {
    absl::Format(&sink, "(%d, %d)", p.x, p.y);
  }
};
}
```

### Controlling Assertion Placement

Fatal assertions (`ASSERT_*`) must only be used in functions returning `void`. Using fatal assertions in non-void functions results in compilation errors.

If your function cannot be changed to return void, use nonfatal assertions (`EXPECT_*`) instead.

Fatal assertions are not allowed inside constructors or destructors; use `SetUp()` and `TearDown()` instead.

---

## Example Usage

### Equality Assertion with Custom Message

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  int result = Factorial(0);
  ASSERT_EQ(result, 1) << "Factorial of zero should be one";
}
```

### Floating-Point Approximate Equality

```cpp
TEST(MathTest, ApproximatesSqrt) {
  double val = sqrt(2.0);
  EXPECT_NEAR(val * val, 2.0, 1e-9);
}
```

### Exception Assertion

```cpp
TEST(AllocatorTest, ThrowsOnOverflow) {
  EXPECT_THROW(allocator.Allocate(huge_size), std::bad_alloc);
}
```

### Death Test

```cpp
TEST(FooDeathTest, CrashesOnInvalidInput) {
  ASSERT_DEATH(Foo(nullptr), "null pointer");
}
```

---

## Troubleshooting and Best Practices

- Use `ASSERT_*` when a failure should prevent further test execution (e.g., null pointer checks before dereference).
- Use `EXPECT_*` to accumulate multiple checks and report all failures.
- Use `SCOPED_TRACE` to clarify failure context in helper functions or loops.
- Teach GoogleTest printing for custom types to enhance failure messages.
- Avoid using `ASSERT_*` in functions returning non-void and in constructors or destructors.
- Remember that fatal failures abort only the current function; use `ASSERT_NO_FATAL_FAILURE` or `HasFatalFailure()` to manage propagation.
- For death tests involving mocks, ensure to allow mock leaks with `Mock::AllowLeak` to avoid false positives.

---

## Related Pages

- [Test Declarations & Test Cases](/api-reference/core-apis/test-declarations)
- [Matchers](/api-reference/core-apis/matchers)
- [GoogleMock & Advanced Testing](/overview/features-at-a-glance/mocking-and-advanced-testing)
- [Writing Your First Test](/getting-started/first-test-configuration/writing-first-test)
- [Troubleshooting and Installation Validation](/getting-started/first-test-configuration/troubleshooting-validation)

---

## Source
[GoogleTest GitHub Repository](https://github.com/google/googletest/tree/main) (main branch)

---