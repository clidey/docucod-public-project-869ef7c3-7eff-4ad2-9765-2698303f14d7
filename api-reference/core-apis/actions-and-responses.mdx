---
title: "Actions and Custom Responses"
description: "Reference documentation on GoogleMock actions—tools that define custom behavior for mock invocations, including built-in actions, value and argument return, custom action creation, and advanced action features. Example-driven to support flexible test doubles."
---

# Actions and Custom Responses

This page provides thorough reference documentation on GoogleMock actions. Actions in GoogleMock define the custom behaviors mock methods exhibit when invoked during tests. This includes built-in actions for returning values, performing side effects, invoking callbacks, and composing complex behaviors. These tools enable flexible and powerful test doubles for C++ projects.

---

## Overview of Actions

Actions specify *what* a mock function *does* when called. They complement expectations — which specify *that* a call should happen — by providing the implementation behavior of the mock function.

GoogleMock provides a rich set of built-in actions, as well as mechanisms to define your own custom actions, tailored to your testing needs.

You can think of actions as commands executed on mock invocation, enabling you to:

- Return fixed or computed values
- Modify call arguments
- Invoke user-defined functions, lambdas, or functors
- Compose multiple actions
- Call callbacks passed as arguments


## Built-in Actions

### Returning Values

| Action                           | Description                                                                                  |
|---------------------------------|----------------------------------------------------------------------------------------------|
| `Return()`                      | Returns from a void mock function.                                                           |
| `Return(value)`                 | Returns the specified `value` from the mock call. Value is converted at expectation set time. |
| `ReturnArg<N>()`                | Returns the `N`-th (0-based) argument passed to the mock method.                             |
| `ReturnNew<T>(args...)`          | Returns a `new T(args...)` pointer each call, allocating a new object every time.             |
| `ReturnNull()`                  | Returns a null pointer.                                                                      |
| `ReturnPointee(ptr)`            | Returns the value pointed to by `ptr` at the time of invocation (reflects live value).        |
| `ReturnRef(variable)`           | Returns a reference to `variable`.                                                          |
| `ReturnRefOfCopy(value)`        | Returns a reference to a copy of `value`. The copy lives as long as the action.              |
| `ReturnRoundRobin({a1,...,an})` | Returns elements in turn repeatedly, cycling through the list on each call.                  |

### Side Effect Actions

| Action                              | Description                                             |
|------------------------------------|---------------------------------------------------------|
| `Assign(&variable, value)`          | Assigns `value` to `variable`.                          |
| `DeleteArg<N>()`                    | Deletes the pointer passed as the `N`-th argument.     |
| `SaveArg<N>(pointer)`               | Saves a copy of the `N`-th argument to `*pointer`.      |
| `SaveArgByMove<N>(pointer)`         | Moves the `N`-th argument to `*pointer`.                 |
| `SaveArgPointee<N>(pointer)`        | Saves the pointee value of the `N`-th argument to `*pointer`. |
| `SetArgReferee<N>(value)`           | Assigns `value` to the variable referenced by the `N`-th argument. |
| `SetArgPointee<N>(value)`           | Assigns `value` to the variable pointed to by the `N`-th argument. |
| `SetArrayArgument<N>(first, last)` | Copies the elements from source range `[first, last)` to the array passed as the `N`-th argument. |
| `SetErrnoAndReturn(error, value)`  | Sets `errno` to `error` and returns `value`.           |
| `Throw(exception)`                  | Throws the provided exception object.                  |

### Invoking Functions or Callables

Many actions can invoke external functions or functors, which lets you customize the behavior with complex logic inside your test:

- `Invoke(f)`: calls `f` with the arguments passed to the mock function.
- `Invoke(object_pointer, &class::method)`: calls the associated method on the supplied object.
- `InvokeWithoutArgs(f)`: calls `f` with no arguments, good when callee needs none.
- `InvokeArgument<N>(args...)`: Invokes the `N`-th (0-based) argument of the mock function as a callable with supplied arguments.

#### Example

```cpp
using ::testing::InvokeArgument;

// Action that calls the second argument to the mock function, passing 5.
EXPECT_CALL(foo, DoThis(_, _))
    .WillOnce(InvokeArgument<1>(5));
```

Use `std::ref()` around arguments if the callable expects reference parameters.

### Composing Actions

- `DoAll(a1, a2, ..., an)`: Performs all actions in sequence, returning the result of the last.
- `IgnoreResult(a)`: Performs action `a` but ignores its return value.
- `WithArg<N>(a)`: Passes the `N`-th argument of the mock function to `a`.
- `WithArgs<N1, N2, ..., Nk>(a)`: Passes multiple selected arguments to `a`.
- `WithoutArgs(a)`: Calls `a` without any arguments.


## Defining Custom Actions

gMock affords multiple methods to define your own custom actions beyond built-in ones.

### Using Lambdas, Functors, or Callables

Define an action by supplying any callable compatible with the mock method's signature:

```cpp
EXPECT_CALL(mock, Func(int arg))
    .WillOnce([](int x) { return x * 2; });
```

The callable can be parameterless or accept any subset of arguments; `WithArgs` and related adaptors can reshape arguments accordingly.

### Legacy Macro-Based Actions

Before C++11, actions were defined by macros:

- `ACTION(Name) { statements; }`: Defines a zero-parameter action.
- `ACTION_P(Name, param) { statements; }`: Defines a one-parameter action.
- `ACTION_Pk(Name, p1, ..., pk) { statements; }`: Defines an action with multiple parameters.

Inside the macro, arguments of the mocked function are accessible as `arg0`, `arg1`, ..., and types are inferred automatically.

Example:

```cpp
ACTION(IncrementArg1) { return ++(*arg1); }
```

### Using `ACTION_TEMPLATE` to Define Action Templates

`ACTION_TEMPLATE` solves scenarios where template parameters must be explicitly specified, which cannot be done using usual `ACTION_P` macros.

Example:

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(std::get<k>(args));
}
```

Invoked as:

```cpp
int n;
EXPECT_CALL(mock, Func(_))
    .WillOnce(DuplicateArg<1, unsigned char>(&n));
```

### More Advanced: Implementing `ActionInterface`

For deep customization, you can implement the `ActionInterface<F>` template for a mock function type `F`, where you define the `Perform()` method that takes the mock's arguments as a tuple, and returns the result.

---

## Usage Patterns and Best Practices

- **`EXPECT_CALL()` vs `ON_CALL()`**:
  - Use `EXPECT_CALL()` to set expectations and specify behavior when you *require* the mock method to be called.
  - Use `ON_CALL()` to set default behaviors used when no specific expectation matches.

- **Ordering and Sequencing**: Use actions in conjunction with sequencing constructs (`InSequence`, `.After()`) to model call order dependent behaviors.

- **Returning Move-Only Types**: When your mock method returns move-only types (e.g., `std::unique_ptr`), prefer lambdas or functors for `WillOnce()` or `WillRepeatedly()`, as `Return()` with `std::move` only works once and may cause runtime errors if repeated.

- **Combining Actions for Side Effects and Return Values**: Use `DoAll()` to chain side-effect actions (like `SetArgPointee`) and return actions.

- **Suppressing Uninteresting Call Warnings**: Use `NiceMock<T>` to suppress warnings on calls without expectations.

- **Retiring Expectations**: Use `.RetiresOnSaturation()` to mark an expectation as inactive once called its specified times; this avoids saturation errors.

- **Built-in Synchronization**: GoogleMock actions are thread-safe and actions are invoked in the thread of the call.


## Troubleshooting

- **Action Side Effects Not Happening?** Verify custom callables are correctly captured and invoked; lambdas or functors are preferred.

- **Return Values Not Changing as Expected?** Remember `Return(value)` captures value at expectation, not invocation. Use `ReturnPointee()` for live values or lambdas for dynamic values.

- **Overloaded Methods Ambiguous?** Help the compiler with `Const()` for const overloads or explicit casting, especially for ambiguous matchers.

- **Action Order Confusion?** Recall `EXPECT_CALL` matches the most recent matching expectation. Arrange `.WillOnce()` and `.WillRepeatedly()` accordingly.

- **Mock Method Calls Not Matching Expectations?** Increase verbosity (`--gmock_verbose=info`) to trace matching and identify mismatches.


## Summary

This page gives you detailed reference information on GoogleMock *Actions* — the mechanisms by which mocked functions produce custom behavior, return values, and side effects during tests. Whether you need simple return values, complex argument manipulation, or full control through custom functors, GoogleMock supports it all with a flexible, expressive API.

---

## References

- For defining mocks and setting up expectations, see [Mocking: Class and Method Mocking](/api-reference/core-apis/mocking-basics).
- Detailed information about the [`EXPECT_CALL` and `ON_CALL` macros](reference/mocking.md#EXPECT_CALL, #ON_CALL).
- Explore [Matchers](reference/matchers.md) to specify argument conditions.
- Learn from the [gMock Cookbook](guides/mocking-techniques/expectations-and-actions) for examples and recipes.
- For advanced customization, the [Defining Custom Actions and Matchers](/guides/advanced-and-integration/custom-actions-matchers) guide provides deep insights.

---

## Useful Code Examples

```cpp
using ::testing::Return;
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::InvokeArgument;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (int x, std::function<int(int)> callback), ());
};

// Simple return a fixed value.
EXPECT_CALL(mock_foo, Bar)
    .WillOnce(Return(42));

// Setting output argument and returning value.
EXPECT_CALL(mock_foo, Bar)
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(0)));

// Invoking the callback provided as 2nd argument with 10.
EXPECT_CALL(mock_foo, Bar(_, _))
    .WillOnce(InvokeArgument<1>(10));

// Custom lambda action.
EXPECT_CALL(mock_foo, Bar)
    .WillRepeatedly([](int x, std::function<int(int)> cb) {
       return cb(x*2);
    });
```
