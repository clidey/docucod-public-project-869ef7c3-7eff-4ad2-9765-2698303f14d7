---
title: "Mock Method Definition (MOCK_METHOD)"
description: "Detailed guide to defining mock methods using the MOCK_METHOD macro, including type signatures, qualifiers, and common patterns. Explains usage and customization for effective mocking of C++ classes and interfaces."
---

# Mock Method Definition (MOCK_METHOD)

This document provides a detailed guide to defining and using mock methods in GoogleMock by leveraging the `MOCK_METHOD` macro. It covers the syntax for specifying method signatures, qualifiers, and common usage patterns, enabling you to effectively mock C++ classes and interfaces.

---

## Overview of `MOCK_METHOD`

`MOCK_METHOD` is the foundational macro for declaring mock methods in a mock class. It allows you to define the interface of your mock methods with precise control over types, qualifiers, and calling conventions.

### Syntax

```cpp
MOCK_METHOD(return_type, method_name, (args...), (qualifiers));
```

- `return_type`: The return type of the mocked method.
- `method_name`: The name of the mocked method.
- `(args...)`: A parenthesis-enclosed, comma-separated list of argument types.
- `(qualifiers)`: Optional method specifiers such as `const`, `override`, and others.

### Example

```cpp
class MockFoo {
 public:
  MOCK_METHOD(bool, DoSomething, (int x, double y), (const, override));
};
```

This defines a mock method `DoSomething` that takes an `int` and a `double`, returns a `bool`, and is a `const override` method.

---

## Key Details and Usage

### Qualifiers Supported

The optional fourth argument to `MOCK_METHOD` allows you to specify multiple qualifiers to mirror the original method's signature accurately. The supported qualifiers are:

| Qualifier                  | Description                                                                                 |
|----------------------------|---------------------------------------------------------------------------------------------|
| `const`                    | Marks the mocked method as const. Required when overriding a `const` method.                |
| `override`                 | Marks the method with `override`. Recommended for overriding virtual methods.                |
| `noexcept`                 | Marks the method `noexcept`. Required if overriding a `noexcept` method.                     |
| `Calltype(calltype)`       | Specifies the calling convention, useful for Windows-specific calling types like `STDMETHODCALLTYPE`. |
| `ref(&)` or `ref(&&)`      | Marks the reference qualifier (lvalue or rvalue) if the original method has reference qualifiers. |

### Important Notes on Arguments Containing Commas

Argument lists or return types containing commas, such as templated types, need special handling. The macro cannot parse unprotected commas properly. Use one of the following approaches:

- **Wrap the type in an extra set of parentheses:**

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

- **Use type aliases to simplify types with commas:**

  ```cpp
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
  ```

### Placement of `MOCK_METHOD`

Declare all `MOCK_METHOD` macros in the **public** section of the mock class, **regardless of the original method access level** (`public`, `protected`, or `private`). This enables external code to set expectations (`EXPECT_CALL`) or default actions (`ON_CALL`) without access restrictions.

### Mocking `const` and other qualifiers

Always add the appropriate qualifiers (e.g., `(const)`, `(const, override)`) to your `MOCK_METHOD` declarations to match the signature of the method being mocked. This is crucial to avoid subtle overrides issues and compilation errors.

### Mocking Overloaded Methods

You can mock overloaded methods by declaring each version separately with the appropriate signature and qualifiers.

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));

  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

To avoid hiding overloads not mocked, use `using BaseClass::MethodName;` in the mock class.

### Mocking Non-virtual Methods

Although traditionally `MOCK_METHOD` can only mock virtual methods, GoogleMock supports mocking non-virtual methods by defining unrelated mock classes with matching method signatures, enabling compile-time substitution.

---

## Common Patterns and Best Practices

### Handling Specifiers

Use modifiers consistently to clearly express method behavior:

- Add `override` when mocking virtual methods to make your intentions explicit.
- Use `const` for const methods.
- Specify calling convention with `Calltype()` when necessary.
- Add reference qualifiers with `ref(&)` or `ref(&&)` as applicable.

### Example: Mocking Complex Method Signatures

```cpp
class MyMock {
 public:
  // Mocking a method with std::pair<> return type
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());

  // Mocking a method with complex argument containing commas
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
```

### Overriding Access Levels

```cpp
class Base {
 protected:
  virtual void Resume();
 private:
  virtual int GetTimeOut();
};

class MockBase : public Base {
 public:
  MOCK_METHOD(void, Resume, (), (override));
  MOCK_METHOD(int, GetTimeOut, (), (override));
};
```

Even though `Resume` and `GetTimeOut` are protected and private respectively, mocks are declared public to enable testing.

### Legacy Macro Versions

Legacy macros like `MOCK_METHODn` and `MOCK_CONST_METHODn` exist but migrating to `MOCK_METHOD` is encouraged for clarity and flexibility. These legacy macros correspond to fixed argument counts and require explicit type management.

---

## Troubleshooting & Tips

- **Compilation errors with commas in types:** Always use an extra pair of parentheses or type aliases for complex template types to avoid parse errors.
- **Method signature mismatch warnings:** Double-check qualifiers (`const`, `noexcept`, reference qualifiers) to avoid subtle overrides issues.
- **Unintended method hiding in overloads:** Include `using BaseClass::MethodName;` in your mock class for overloads you wish to preserve.
- **Error when mocking methods declared `const` with MSVC:** MSVC sometimes mishandles top-level const qualifiers in parameters; consider removing top-level `const` from parameters if it causes issues.
- **Placing mocks in `public:` section:** Always define `MOCK_METHOD`s as public in the mock to enable expectation setting.

---

## Summary

The `MOCK_METHOD` macro is the essential mechanism in GoogleMock to define mock method signatures in your mock classes.

It:

- Mirrors the exact method signature, including return type and argument list.
- Supports method qualifiers like `const`, `override`, `noexcept`, calling convention, and reference qualifiers.
- Requires special handling for argument or return types containing commas.
- Must be declared in the public section of a mock class irrespective of original method access levels.
- Supports mocking overloaded and non-virtual methods.

Following these guidelines will help you create robust and maintainable mocks to power your C++ tests.

---

## References and Further Reading

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Full mock macros and options.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for sophisticated mocking usage.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly gMock guide.
- [Setting Expectations and Actions](./setting-expectations-actions) — Next step after defining mock methods.
- [NiceMock, NaggyMock, StrictMock Controls](./nice-naggy-strict-mocks) — Control mock behavior on uninteresting calls.

---