---
title: "Setting Call Expectations and Cardinalities"
description: "Dive into specifying expectations on mock calls, including counting call occurrences and enforcing strict, lenient, or warning behavior for unexpected calls. The page explains cardinalities, expectation syntax, and practical strategies for controlling test precision."
---

# Setting Call Expectations and Cardinalities

Mastering how to specify expectations on mock method calls is crucial to crafting precise, reliable tests using GoogleMock. This page guides you through defining the number of times a mock function should be invoked—called *cardinalities*—and controlling the behavior of unexpected or uninteresting calls. With clear syntax, practical strategies, and best practices, you will gain fine-grained control over test verification and failures.

---

## Understanding Call Expectations

When using GoogleMock, you specify how often a mock method is expected to be called and with what behavior using the `EXPECT_CALL` macro. This not only sets the behavior of the mock but also verifies if the actual code-under-test interacts correctly with its dependencies.

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- **`mock_object`**: Your mock instance.
- **`MethodName`**: The mock method you expect to be called.
- **`matchers...`**: Argument matchers specifying the expected inputs (e.g., `_` for any).
- **`Times(cardinality)`**: How many times the call should be made.
- **`WillOnce` / `WillRepeatedly`**: Defines the actions the mock performs when called.

If `Times` is omitted, GoogleMock infers the expected call count from the presence of `WillOnce` and `WillRepeatedly` clauses.

---

## What Are Cardinalities?

Cardinalities define the expected number of invocations for a mock method call matching your expectations. They let you express expectations that range from exact counts to ranges or unlimited calls. This flexibility simplifies test maintenance and increases expressiveness.

### Built-in Cardinalities

| Cardinality        | Description                                     |
|--------------------|------------------------------------------------|
| `AnyNumber()`      | The method can be called any number of times (zero or more).
| `AtLeast(n)`       | The method must be called at least *n* times.
| `AtMost(n)`        | The method can be called up to *n* times.
| `Between(m, n)`    | The method must be called between *m* and *n* times inclusive.
| `Exactly(n)` / `n` | The method must be called exactly *n* times. If *n* is 0, the call should never occur.

### Examples of Cardinalities in Use

```cpp
using ::testing::AtLeast;
using ::testing::Exactly;
using ::testing::AnyNumber;

EXPECT_CALL(my_mock, Foo())
    .Times(AtLeast(2));  // Expect Foo() called two or more times.

EXPECT_CALL(my_mock, Bar(_))
    .Times(Exactly(1));  // Expect Bar() called exactly once.

EXPECT_CALL(my_mock, Baz(_))
    .Times(AnyNumber());  // Expect Baz() called any times.
```

### What If You Don't Specify `Times`?

GoogleMock uses these rules to infer the cardinality:

- No `WillOnce` or `WillRepeatedly`: infers `Times(1)` — expect exactly one call.
- `n` `WillOnce` clauses and no `WillRepeatedly`: infers `Times(n)` — expect exactly *n* calls.
- `n` `WillOnce` clauses and one `WillRepeatedly`: infers `Times(AtLeast(n))` — expect at least *n* calls.

---

## Controlling Behavior on Unexpected and Uninteresting Calls

Not all calls to mock methods may be anticipated by `EXPECT_CALL`. GoogleMock distinguishes:

- **Uninteresting calls**: calls to mock methods without any expectation set. These are allowed but generate warnings by default.
- **Unexpected calls**: calls to mock methods which do have expectations but do not match any.

### Using Mock Object Wrappers

You can modify how GoogleMock reacts to these calls by choosing a wrapper:

- `NiceMock<T>`: suppresses warnings on uninteresting calls.
- `NaggyMock<T>` (default): warns about uninteresting calls.
- `StrictMock<T>`: treats uninteresting calls as test failures.

For example:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, Bar());
// Calls to other methods will be silently ignored.
```

### Explicitly Expecting No Calls

If a method should never be called with specific arguments, articulate this with `Times(0)`.

```cpp
EXPECT_CALL(mock, Method(arguments))
    .Times(0);  // Expects the method is never called with these arguments.
```

---

## Practical Strategies for Cardinality Usage

### Granular Control With Cardinalities

Use cardinalities appropriate to your test's intent. For example:

- Use `Exactly(n)` when you want to tightly control the number of calls — use sparingly to avoid brittle tests.
- Use `AtLeast(n)` or `AnyNumber()` for more flexible tests where minimum calls or allowing many calls is fine.
- Use `Between(m, n)` for specifying a valid range.

### Stacking Multiple Expectations

You may have multiple overlapping expectations on the same method. GoogleMock selects the *latest matching expectation* when a call is made, enabling you to set a broad default and then refine.

```cpp
EXPECT_CALL(mock, Compute(_))     // Matches any argument
    .Times(AnyNumber());
EXPECT_CALL(mock, Compute(5))     // More specific
    .Times(2);
```

This means calls with argument 5 are limited, others are unrestricted.

### Retiring Expectations

Sometimes you want an expectation to auto-disable after being saturated to avoid upper-bound violations and allow fallback to more general expectations:

```cpp
EXPECT_CALL(mock, Process(Arg))
    .Times(2)
    .RetiresOnSaturation();
```

After two matches, this expectation is retired and no longer matches calls.

### Sequences and Order

For ordered expectations of calls, you combine cardinalities with sequences. This is discussed further in the [Expectation Ordering and Sequences](reference/mocking.md#EXPECT_CALL.InSequence) section.

---

## Common Cardinality Functions and Their Behavior

```cpp
#include <gmock/gmock.h>

// Allows any number of calls, including zero.
using ::testing::AnyNumber;

// At least n calls.
using ::testing::AtLeast;

// At most n calls.
using ::testing::AtMost;

// Between m and n inclusive.
using ::testing::Between;

// Exactly n calls.
using ::testing::Exactly;  // equivalent to Times(n)
```

### Notes:
- Negative arguments to these functions (except `AnyNumber`) cause runtime failures.
- `Exactly(0)` expects the call never occurs.
- `Between(0, 0)` means the call must never happen.

---

## Insight Into Cardinalities: How They Work Under the Hood

Each cardinality implements the `CardinalityInterface`, defining logic to:

- Check if the current call count *satisfies* the cardinality.
- Check if the call count *saturates* the cardinality (reaches upper bound).
- Describe itself in human-readable terms.

GoogleMock provides these cardinality implementations:

- **Exactly** via `Between(min, max)` where min = max.
- **Between** enforces allowable call range.
- **AtLeast** uses min bound and max as unlimited (`INT_MAX`).
- **AtMost** uses max bound and min as zero.
- **AnyNumber** is just `AtLeast(0)`.

> See `gmock-cardinalities.h` and `gmock-cardinalities.cc` for detailed implementation.

---

## Troubleshooting and Common Pitfalls

### Overlapping Expectations Not Matching As Expected

If two expectations match the same call, the most recent takes precedence. Always place more general expectations before more specific ones.

### Expectation Failures Due to Call Counts

- *Too few calls*: occurs when the mock method is called less often than cardinality lower bound. GoogleMock reports failure upon verification.
- *Too many calls*: occurs when calls exceed cardinality upper bound. GoogleMock reports immediate failure.

### Sticky Expectations

Expectations by default remain active after being saturated which may cause unexpected failures on subsequent calls. Use `.RetiresOnSaturation()` to disable this behavior.

### Missing `Times()` Clause

If you use multiple `.WillOnce()` or `.WillRepeatedly()` actions but omit `Times()`, GoogleMock infers the call count automatically, often correctly, but it can sometimes cause surprises.

### Suppressing Warnings for Uninteresting Calls

Avoid suppressing warnings by adding catch-all expectations indiscriminately. Use `NiceMock` or `NaggyMock` objects when you want to manage warnings globally.

---

## Example: Defining Expectations with Cardinalities

```cpp
using ::testing::Return;
using ::testing::AtLeast;
using ::testing::Exactly;
using ::testing::AnyNumber;

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), ());
};

TEST(CalculatorTest, AddCalledExactlyTwice) {
  MockCalculator mock;

  EXPECT_CALL(mock, Add(_, _))
      .Times(Exactly(2))
      .WillRepeatedly(Return(10));

  mock.Add(1, 2);
  mock.Add(3, 4);
}

TEST(CalculatorTest, AddCalledAtLeastOnce) {
  MockCalculator mock;

  EXPECT_CALL(mock, Add(5, 5))
      .Times(AtLeast(1))
      .WillRepeatedly(Return(10));

  mock.Add(5, 5);
  mock.Add(5, 5);
}

TEST(CalculatorTest, AddAnyTimes) {
  MockCalculator mock;

  EXPECT_CALL(mock, Add(_, _))
      .Times(AnyNumber())
      .WillRepeatedly(Return(0));

  // Calls are allowed any number of times.
}
```

---

## Related Concepts and Further Reading

- [EXPECT_CALL Syntax and Modifiers](reference/mocking.md#EXPECT_CALL)
- [Cardinalities API Reference](reference/mocking.md#EXPECT_CALL.Times)
- [Mocking Basics Guide](guides/getting-started-workflows/mocking-basics.mdx)
- [Using Actions to Set Behavior](api-reference/core-mocking-api/mock-behavior-actions.mdx)
- [Common Mocking Scenarios](guides/best-practices-and-real-world-usage/common-mocking-scenarios.mdx)

---

## Summary

- Cardinalities allow precise control over how often a mock method is expected to be called.
- Use `Times()` clause in `EXPECT_CALL()` to specify exact or fuzzy numbers of calls.
- If omitted, cardinalities are inferred intelligently based on actions specified.
- Managing unexpected or uninteresting calls helps maintain the balance between test strictness and flexibility.
- Retiring expectations on saturation avoids brittle tests that fail on extra calls.

<Check>
When specifying expectations:
- Use `.Times(Exactly(n))` for precise call counts.
- Use `.Times(AtLeast(n))` or `.Times(AnyNumber())` for flexibility.
- Combine with `.RetiresOnSaturation()` to avoid retries on saturated expectations.
- Use mock wrappers (`NiceMock`, `StrictMock`) to control uninteresting call reactions.
- Order your expectations from general to specific.
</Check>

---