---
title: "Actions and Return Behaviors"
description: "API reference for defining mock method behaviors via actions. Includes built-in actions, custom action templates, value returning, argument saving, and exception throwing for highly controllable mock behavior."
---

# Actions and Return Behaviors

API reference for defining mock method behaviors via actions. Includes built-in actions, custom action templates, value returning, argument saving, and exception throwing for highly controllable mock behavior.

---

## Overview

GoogleMock actions specify what a mock method does when it is invoked during testing. Using actions, you can precisely control behavior of mocks to model complex scenarios, simulate side effects, return values, throw exceptions, or delegate calls. This page explains how to use both built-in and custom actions to define the functional behavior of mock methods beyond just setting expectations.

Actions let you turn mock methods into expressive test doubles that respond realistically, enabling robust and maintainable interaction-based tests.

---

## Built-in Actions

GoogleTest offers a rich set of built-in actions in the `::testing` namespace to compose behaviors easily.

### Returning Values

These actions control return values from mocked methods:

| Action                  | Description                                                                                                   |
|-------------------------|---------------------------------------------------------------------------------------------------------------|
| `Return()`              | Return void from a void mock function.
| `Return(value)`         | Returns the specified value. The value is captured at specification time â€” not at execution time.
| `ReturnArg<N>()`        | Return the N-th argument passed to the mock function (0-based index).
| `ReturnNew<T>(args...)` | Returns a new pointer to a freshly created object of type T constructed with the given arguments.
| `ReturnNull()`          | Returns a null pointer.
| `ReturnPointee(ptr)`    | Returns the value pointed to by the pointer.
| `ReturnRef(variable)`   | Returns a reference to the given variable.
| `ReturnRefOfCopy(value)`| Returns a reference to a copy of the specified value (copy lifetime is managed by the action).
| `ReturnRoundRobin()`    | Returns values in sequence from a list cycling through on repeated calls.

### Example: Returning Values
```cpp
using ::testing::Return;

EXPECT_CALL(mock_object, GetValue())
    .WillOnce(Return(10))
    .WillRepeatedly(Return(20));

EXPECT_CALL(mock_object, GetRef())
    .WillOnce(ReturnRef(existing_variable));

EXPECT_CALL(mock_object, GetPtr())
    .WillOnce(ReturnNew<MyClass>(arg1, arg2));
```

---

### Side Effect Actions

These actions modify arguments, save values, or modify state when the mock function is called:

| Action                  | Description                                                                         |
|-------------------------|-------------------------------------------------------------------------------------|
| `Assign(&var, value)`   | Assigns `value` to the variable pointed to by `var`.
| `DeleteArg<N>()`        | Deletes the N-th argument, if it is a pointer.
| `SaveArg<N>(pointer)`   | Copies the N-th argument into the memory pointed to by `pointer`.
| `SaveArgByMove<N>(pointer)` | Moves the N-th argument into the pointed location.
| `SaveArgPointee<N>(pointer)` | Copies the pointee of the N-th argument to `*pointer`.
| `SetArgReferee<N>(value)` | Assigns `value` to the variable referenced by the N-th argument.
| `SetArgPointee<N>(value)` | Assigns `value` to the variable pointed to by the N-th argument.
| `SetArrayArgument<N>(first, last)` | Copies a range of values to the array pointed to by the N-th argument.
| `SetErrnoAndReturn(error, value)` | Sets errno and returns the specified value.
| `Throw(exception)`      | Throws the given exception object. Requires the exception to be copyable.

### Example: Side Effects
```cpp
using ::testing::SetArgPointee;
using ::testing::DoAll;
using ::testing::Return;

int output;
EXPECT_CALL(mock, Compute(_))
    .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));
```

This example sets output argument 0 to 42 and returns true when `Compute` is called.

---

### Using Functions, Functors, or Lambdas as Actions

GoogleMock allows you to supply arbitrary callable objects to dictate mock behavior.

| Action                                  | Description                                          |
|-----------------------------------------|------------------------------------------------------|
| `f`                                     | Directly invoke callable `f` with mock function arguments.
| `Invoke(f)`                             | Invoke a global/static function or functor `f`.
| `Invoke(object_ptr, &Class::Method)`   | Invoke a method on an object.
| `InvokeWithoutArgs(f)`                  | Invoke a callable `f` that takes no arguments.
| `InvokeWithoutArgs(object_ptr, &Class::Method)` | Invoke a method taking no arguments on an object.
| `InvokeArgument<N>(args...)`            | Invoke the Nth argument of the mock function, which must be callable, with arguments `args...`.

These facilities provide extreme flexibility to model complex or asynchronous behavior by leveraging actual logic or callbacks inside your test suite.

### Example: Using Callables
```cpp
using ::testing::Invoke;

int Add(int a, int b) { return a + b; }

EXPECT_CALL(mock, Sum(_, _))
    .WillOnce(Invoke(Add));

EXPECT_CALL(mock, Callback(_))
    .WillOnce(InvokeArgument<0>(42));
```

---

## Defining Custom Actions

For advanced use cases where built-ins don't suffice, you can define your own actions.

### Using ACTION Macros

- `ACTION(Name) { /* statements */ }`
- `ACTION_P(Name, param) { /* statements */ }`
- `ACTION_Pk(Name, p1, ..., pk) { /* statements */ }`

Inside the action body, use `argN` to access the N-th argument. The returned value is used as the mock function's return.

Example:
```cpp
ACTION(DoubleArg0) { return arg0 * 2; }
...
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoubleArg0());
```

### Implementing Action Interfaces

Beyond macros, for maximum control and performance, you may implement the `::testing::ActionInterface<F>` for a function type `F`.

Example:
```cpp
template <typename F>
class MyAction : public ::testing::ActionInterface<F> {
 public:
  ReturnType Perform(const std::tuple<Args...>& args) override {
    // your logic
  }
};

Action<F> MakeMyAction() {
  return MakeAction(new MyAction<F>());
}
```

### Writing Polymorphic Actions

When needing an action usable with different function signatures, define a class with a templated `Perform` method and wrap it with `MakePolymorphicAction`:

```cpp
class ReturnSecondArgumentAction {
 public:
  template <typename R, typename Args>
  R Perform(const Args& args) const {
    return std::get<1>(args);
  }
};

PolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() {
  return MakePolymorphicAction(ReturnSecondArgumentAction());
}
```

This action can then be applied to any mock method to return its second argument.

---

## Composing Actions

### `DoAll(a1, a2, ..., an)`

Performs all actions in order, returns the result of the last. Useful when you want to combine side-effects and return values.

### `IgnoreResult(a)`

Executes `a`, discards its return value, needed when return type does not match.

### Argument Selection

- `WithArg<N>(a)`: Passes the N-th argument to action `a` and invokes it.
- `WithArgs<N1, N2, ..., Nk>(a)`: passes multiple selected arguments in order.
- `WithoutArgs(a)`: invokes `a` with no arguments.

Example:
```cpp
EXPECT_CALL(mock, Foo(_, _, _))
    .WillOnce(WithArgs<0, 2>(Invoke(MyFunc)));
```

---

## Controlling Action Invocation

- Use `.WillOnce(action)` to specify the action for a single invocation.
- Use `.WillRepeatedly(action)` to specify the behavior after `WillOnce` actions are exhausted.

If no actions are specified, GoogleMock uses built-in defaults.

---

## Best Practices and Tips

- Use `ON_CALL` to set default behaviors without imposing call expectations.
- Use `EXPECT_CALL` to define expected calls and their actions.
- Avoid returning references to temporaries with `ReturnRef`.
- Use `ReturnPointee` to return the live value pointed to.
- Combine actions with `DoAll` to perform side effects and return values.
- Prefer lambdas or `Invoke` when your logic can't be expressed by built-ins.
- Use `InvokeArgument` when a mock method receives function-like arguments you wish to execute.

---

## Troubleshooting

- If your action causes compiler errors, verify argument types match the mock method signature.
- Unexpected behavior with return values often stems from using `Return` with temporaries; consider `ReturnPointee` or lambdas.
- Excessive or missing calls relative to `WillOnce` can cause warnings or failures; use `.Times` and `.RetiresOnSaturation` clauses deliberate.
- Use `--gmock_verbose=info` to get detailed traces of mock calls and actions.

---

## Code Examples

<CodeGroup>
```cpp
// Simple Return
using ::testing::Return;
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(42));
```
```python
# Python bindings example (hypothetical)
mock.GetValue.expect_call().will_once(Return(42))
```
</CodeGroup>

<CodeGroup>
```cpp
// Complex Side Effect
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Return;

EXPECT_CALL(mock, ReadValue(_))
    .WillOnce(DoAll(SetArgPointee<0>(123), Return(true)));
```
```python
# Python bindings example (hypothetical)
mock.ReadValue.expect_call().will_once(DoAll(SetArgPointee(0, 123), Return(True)))
```
</CodeGroup>

<CodeGroup>
```cpp
// Custom action to increment argument 0
ACTION(IncrementArg0) {
  return ++arg0;
}

EXPECT_CALL(mock, Increment(_))
    .WillOnce(IncrementArg0());
```
```python
# Python bindings example (hypothetical)
# Define custom action accordingly
```
</CodeGroup>

---

## Additional Resources
- [GoogleMock Actions Reference](../reference/actions.md)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html#actions)
- [gMock Cookbook - Using Actions](https://google.github.io/googletest/gmock_cook_book.html#actions)
- [Mocking Reference - Actions and Expectations](../reference/mocking.md#EXPECT_CALL.WillOnce)

---

This API page fits within the overall mocking framework by enabling comprehensive control of mock method behavior to support assertions, side effects, and complex interactions in tests.

For foundational concepts, please refer to the [Mock Class and Method Macros](api-reference/mocking-and-matcher-api/mock-class-api) and [Expectations and Call Sequences](api-reference/mocking-and-matcher-api/expectation-api) pages.


---