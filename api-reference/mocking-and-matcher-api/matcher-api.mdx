---
title: "Matchers API"
description: "Comprehensive coverage of built-in and custom matcher APIs for value verification in assertions and mock expectations. Details advanced, composable matchers for numbers, strings, containers, and custom types."
---

# Matchers API Reference

Comprehensive coverage of built-in and custom matcher APIs for value verification in assertions and mock expectations. Details advanced, composable matchers for numbers, strings, containers, and custom types.

---

## Overview

In GoogleMock, **matchers** form the backbone of verifying argument values passed into mock methods or assertions. A matcher checks whether a given argument satisfies a condition you specify, enabling precise and expressive verification beyond simple equality.

You use matchers primarily within macros like `EXPECT_CALL()` and `ON_CALL()` to specify expectations or default behaviors for mock methods. They are also used with `EXPECT_THAT()` or `ASSERT_THAT()` assertions to validate values directly. This page documents the rich set of built-in matchers, how to compose them, and how to create your own advanced matchers.

---

## How to Use Matchers

### Basic Use

Matchers appear as arguments in `EXPECT_CALL` or `ON_CALL`:

```cpp
using ::testing::_;  // wildcard matcher
using ::testing::Eq;

EXPECT_CALL(mock_object, Method(
    Eq(10),  // first argument must equal 10
    _));     // second argument can be anything
```

You can also use `EXPECT_THAT` to assert values:

```cpp
EXPECT_THAT(value, Eq(5));
EXPECT_THAT(str, StartsWith("Hello"));
```

### Wildcard

- `_`: matches any argument regardless of type.
- `A<T>()` / `An<T>()`: matches any argument of type `T`.

### Equality

- `Eq(value)` or simply `value`: matches if argument equals `value`.
- Other common comparators like `Ne(value)`, `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` provide rich comparison capabilities.

### Composing Matchers

You can combine matchers with:

- `AllOf(m1, m2, ...)`: all must match.
- `AnyOf(m1, m2, ...)`: any must match.
- `Not(m)`: negates a matcher.

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(5), Ne(10))));  // argument >= 5 and != 10
```

### Using Matchers for Multiple Arguments

Sometimes you want to match multiple arguments as a tuple, e.g. to specify that one argument is less than another. Use `.With()` in `EXPECT_CALL` with a multi-argument matcher such as `Lt()` for tuples:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // first argument less than second
```

---

## Categories of Built-in Matchers

### Generic Matchers

| Matcher                 | Description                          |
|-------------------------|------------------------------------|
| `_`                     | Matches any value                   |
| `Eq(value)`             | Equals the specified value          |
| `Ne(value)`             | Not equal to specified value        |
| `Lt(value)`             | Less than value                     |
| `Le(value)`             | Less than or equal to value         |
| `Gt(value)`             | Greater than value                  |
| `Ge(value)`             | Greater than or equal to value      |
| `IsTrue()`              | Evaluates to true in boolean context |
| `IsFalse()`             | Evaluates to false in boolean context |
| `IsNull()`              | Is a null pointer (raw or smart)    |
| `NotNull()`             | Is a non-null pointer                |
| `Optional(m)`           | `std::optional` containing a value matching `m` |
| `VariantWith<T>(m)`     | `std::variant` holding `T` with value matching `m` |
| `Ref(variable)`         | Argument is a reference to the variable |
| `TypedEq<type>(value)`  | Equals the `value` with argument of `type` (used for overloaded functions) |

### Floating-Point Matchers

- `DoubleEq(value)`, `FloatEq(value)`: approximate equality using ULPs
- `NanSensitiveDoubleEq(value)`, `NanSensitiveFloatEq(value)`: treats NaNs as equal
- `DoubleNear(value, max_abs_error)`, `FloatNear(value, max_abs_error)`: approximate equality within absolute error

### String Matchers

| Matcher                 | Description                          |
|-------------------------|------------------------------------|
| `StrEq(string)`          | Equal to string (case sensitive)    |
| `StrNe(string)`          | Not equal to string                  |
| `StrCaseEq(string)`      | Equal ignoring case                 |
| `StrCaseNe(string)`      | Not equal ignoring case             |
| `HasSubstr(string)`      | Contains substring                  |
| `StartsWith(prefix)`     | Starts with the prefix              |
| `EndsWith(suffix)`       | Ends with the suffix                |
| `MatchesRegex(regex)`    | Matches entire regex                |
| `ContainsRegex(regex)`   | Contains regex as substring         |
| `WhenBase64Unescaped(m)`| Base64 unescaped string matches `m`|

### Container Matchers

| Matcher                  | Description                          |
|--------------------------|------------------------------------|
| `ElementsAre(e1, e2, ...)` | Matches container elements in order matching each `ei` |
| `ElementsAreArray(collection)` | Same but from an array or container   |
| `UnorderedElementsAre(e1, e2, ...)` | Elements match in any order       |
| `UnorderedElementsAreArray(collection)` | Same but from array or container   |
| `IsEmpty()`              | Container empty                     |
| `Contains(value_or_matcher)` | Container contains at least one matching element |
| `Each(matcher)`          | All elements match `matcher`        |
| `SizeIs(matcher)`        | Container size matches matcher      |
| `WhenSorted(matcher)`    | Matches when container sorted by `<` matches `matcher` |
| `WhenSortedBy(comparator, matcher)` | Same but sorted by comparator         |
| `Pointwise(m, container)` | Container elements matched element-wise with `container` using matcher `m` on pairs |

### Member Matchers

| Matcher                  | Description                          |
|--------------------------|------------------------------------|
| `Field(&class::field, matcher)` | Matches object's field against matcher |
| `Field(name, &class::field, matcher)` | Same, with field name for better error |
| `Property(&class::property, matcher)` | Matches result of property getter method |
| `Property(name, &class::property, matcher)` | Same, with property name for better error |

### Pointer and Reference Matchers

| Matcher                  | Description                          |
|--------------------------|------------------------------------|
| `Pointee(matcher)`       | Pointer points to a value matching `matcher` |
| `Pointer(matcher)`       | Pointer itself matches `matcher` (on raw pointer value) |
| `Address(matcher)`       | Address of the object matches `matcher` |
| `WhenDynamicCastTo<T>(matcher)` | After dynamic_cast to `T`, matches `matcher` (requires RTTI) |
| `Ref(variable)`          | Argument is a reference to the variable (exactly) |

### Exception Matchers (Requires Exceptions)

- `Throws<E>()`: callable throws exception of type E
- `Throws<E>(matcher)`: callable throws exception of type E matching matcher
- `ThrowsMessage<E>(matcher)`: callable throws exception E with message matching matcher

---

## Creating Custom Matchers

You can define custom matchers for complex or domain-specific conditions. GoogleMock offers several ways:

### Using MATCHER Macros

Simplest way, for most use cases. For example:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

Use `MATCHER_P` for parameterized matchers:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "checks divisibility by divisor") {
  return (arg % divisor) == 0;
}
EXPECT_THAT(val, IsDivisibleBy(5));
```

### Using MatcherInterface

For more control, implement the matcher interface in a class with:
- `MatchAndExplain(value, listener)` to perform match and optionally explain failure
- `DescribeTo(os)` and `DescribeNegationTo(os)` to output matcher descriptions

Then provide a factory function returning an instance wrapped in `Matcher<T>`.

Refer to [Custom Matcher Class](docs/gmock_cook_book.md#CustomMatcherClass) for patterns and examples.

### Best Practices

- Matchers must be **pure** functions â€” no side effects.
- Provide clear and helpful `DescribeTo` messages for better failure reports.
- Use `MatchAndExplain` to emit additional diagnostic info in failures.

---

## Using Matchers in User Workflows

### Setting Expectations on Mocks

Combined with `EXPECT_CALL`, matchers precisely specify which argument patterns should occur.

```cpp
EXPECT_CALL(mock_obj, DoSomething(Ge(10), StartsWith("abc")))
    .Times(3);
```

This expects that `DoSomething` is called three times where the first arg is >=10 and the second starts with "abc".

### Using `EXPECT_THAT` Assertions

Matchers make assertions expressive and readable:

```cpp
EXPECT_THAT(my_vector, ElementsAre(1, Ge(5), Lt(10)));
EXPECT_THAT(my_string, HasSubstr("needle"));
```

### Common Pitfalls

- When matching overloaded methods, use `TypedEq<>` or disambiguate overloads in expectations.
- Matchers must not depend on mutable state or cause side effects.
- Be careful with move-only types; some matchers/actions might not support them.

---

## Troubleshooting Matchers

<Tip>
- If you get compilation errors using a matcher with a certain argument, check that the matcher type matches the argument type.
- Use `SafeMatcherCast<T>(m)` to cast where suitable.
- Complex or nested matchers can produce long compile-time error messages. Simplify by breaking down matchers or using intermediate variables.
</Tip>

<Tip>
- Use `--gmock_verbose=info` test run flag to see details of matcher usage and expectation matching during tests.
</Tip>

---

## Summary

Matchers in GoogleMock are a powerful, flexible toolkit to verify values passed to mocks and in assertions. From simple equality checks to deeply composite matchers on containers and complex objects, you can precisely specify the conditions your tests expect. For domain-specific needs, easily write your own pure-function matchers with detailed explanations to make your tests meaningful and maintainable.

Use the rich matcher set to write readable expectations and assertions that succinctly express test intent, helping you build robust, expressive tests rapidly.

---

## See Also

- [EXPECT_CALL and ON_CALL - Setting Expectations and Behaviors](docs/reference/mocking.md)
- [gMock Cookbook - Using Matchers Guide](docs/gmock_cook_book.md#UsingMatchers)
- [Matchers Reference](docs/reference/matchers.md)
- [Writing Custom Matchers](docs/gmock_cook_book.md#NewMatchers)
- [Assertions Reference - Using `EXPECT_THAT`](docs/reference/assertions.md#EXPECT_THAT)

---

For implementation, see the GoogleMock repository: https://github.com/google/googletest (matchers implemented in `include/gmock/gmock-matchers.h`)

---

### Example Matcher Usages

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;
using ::testing::ElementsAre;
using ::testing::StartsWith;

// Expect method called with first argument equal to 5, second is anything
EXPECT_CALL(mock_obj, Foo(Eq(5), _));

// Expect method called with argument greater than 10
EXPECT_CALL(mock_obj, Bar(Gt(10)));

// Match vector with exact elements
EXPECT_THAT(vec, ElementsAre(1, 2, 3));

// Match string starting with 'Hello'
EXPECT_THAT(str, StartsWith("Hello"));

// Custom matcher usage
MATCHER(IsPositive, "Checks that a number is positive") {
  return arg > 0;
}
EXPECT_CALL(mock_obj, Baz(IsPositive()));
```

---

### Summary Diagram

```mermaid
flowchart TD

  subgraph Matcher Usage
    A[Call Mock Method with arguments] --> B{Arguments matche all matchers?}
    B -- Yes --> C[Expectation matched]
    B -- No --> D[Try next expectation or fail]
  end

  subgraph Assertion Flow
    E[Call EXPECT_THAT(actual, matcher)] --> F{Value matches matcher?}
    F -- Yes --> G[Pass assertion]
    F -- No --> H[Fail assertion & show description]
  end

  style A fill:#cce5ff,stroke:#003366,stroke-width:2px
  style E fill:#d4edda,stroke:#155724,stroke-width:2px
  style B fill:#99ccff,stroke:#003366
  style F fill:#a6d8a8,stroke:#155724
  style D fill:#f8d7da,stroke:#721c24,stroke-width:2px
  style H fill:#f5c6cb,stroke:#721c24,stroke-width:2px

```

