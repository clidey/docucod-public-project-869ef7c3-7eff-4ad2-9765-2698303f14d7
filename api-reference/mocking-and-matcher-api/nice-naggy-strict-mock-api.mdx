---
title: "Controlling Mock Strictness"
description: "Explains how to use NiceMock, NaggyMock, and StrictMock wrappers to control the handling of unexpected or uninteresting calls. Guides users on test maintenance strategies and expectation management."
---

# Controlling Mock Strictness

GoogleMock provides three main mock wrappers—**NiceMock**, **NaggyMock**, and **StrictMock**—to finely control how unexpected or uninteresting calls to mock methods are handled in tests. These wrappers help you balance test strictness, maintainability, and clarity by managing warnings, errors, and failures for mock invocations that do not have explicit expectations.

---

## Overview

When using mock objects, not every method call is explicitly interesting in every test. Calls to methods without set expectations are called *uninteresting calls*. How you want your tests to treat such calls varies: sometimes silently allow them, other times warn, or even treat them as test failures. GoogleMock’s strictness wrappers enable this configuration:

- **NiceMock<T>**: Subclass of your mock `T`. Allows uninteresting calls to proceed silently without warnings.
- **NaggyMock<T>**: (Default behavior for mocks) Warns about uninteresting calls.
- **StrictMock<T>**: Fails the test immediately upon any uninteresting call.

All three wrappers inherit the constructors of your mock class, so you can forward arguments just as you would normally.

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
  MOCK_METHOD(int, GetValue, (), ());
};

TEST(SomeTest, UsingMocks) {
  NiceMock<MockFoo> nice_mock;   // Suppress warnings on uninteresting calls
  NaggyMock<MockFoo> naggy_mock; // Warn on uninteresting calls (default)
  StrictMock<MockFoo> strict_mock;  // Fail on uninteresting calls

  EXPECT_CALL(strict_mock, DoThis());

  strict_mock.DoThis();            // Expected call
  nice_mock.GetValue();            // Uninteresting call, silently accepted
  naggy_mock.GetValue();           // Warning about uninteresting call
  // strict_mock.GetValue();       // Error: test failure on uninteresting call
}
```

---

## When to Use Each Wrapper

Choosing the right strictness helps make your tests both robust and maintainable:

| Wrapper       | Behavior on Uninteresting Calls               | Use Cases & Recommendations                               |
|---------------|-----------------------------------------------|-----------------------------------------------------------|
| **NiceMock**  | Silently allows uninteresting calls           | Preferred for general testing; reduces noise and maintenance as your code evolves. Especially recommended when you don't care about every method call. |
| **NaggyMock** | Prints warnings for uninteresting calls       | Useful during test development or debugging to prompt you to consider if a call should be expected. This is the current default mock behavior. |
| **StrictMock**| Treats uninteresting calls as test failures   | Use only when strict verification is required to prevent any unexpected interactions. Useful for critical interfaces or legacy bugs. |

**Important:** These wrappers affect only *uninteresting* calls (calls to mock methods with no expectations). Calls that violate an expectation (unexpected calls) always fail regardless of wrapper used.

<Note>
Naggy behavior is currently the default for your mock classes. GoogleMock plans to switch the default to nice behavior in the future for enhanced test maintainability.
</Note>

---

## Key Characteristics and Limitations

- All three wrappers are subclasses of your mock class, so usage is transparent.
- They "inherit" constructors of your mock class, supporting any constructor signature.
- They only affect mock methods directly defined in the mock class using `MOCK_METHOD`. Methods inherited from base classes are usually unaffected due to C++ limitations.
- Nesting wrappers (e.g., `NiceMock<StrictMock<MockFoo>>`) is **not supported**.
- The mock class should have a **virtual destructor** to avoid undefined behavior.

---

## Practical Examples

### 1. Using NiceMock to Suppress Uninteresting Call Warnings

```cpp
using ::testing::NiceMock;

class MockWidget {
 public:
  MOCK_METHOD(void, Update, (), ());
  MOCK_METHOD(int, GetValue, (), ());
};

TEST(WidgetTest, ProcessesUpdates) {
  NiceMock<MockWidget> mock_widget;

  EXPECT_CALL(mock_widget, Update());

  mock_widget.Update();  // Verified call
  mock_widget.GetValue(); // Uninteresting call, no warning emitted
}
```

### 2. Using StrictMock to Catch Any Unexpected Calls

```cpp
using ::testing::StrictMock;

StrictMock<MockWidget> strict_mock;

EXPECT_CALL(strict_mock, Update());

strict_mock.Update();     // OK
// strict_mock.GetValue(); // Fails test: Uninteresting call detected
```

### 3. NaggyMock Behavior (Default)

If you just use `MockWidget` normally without wrapping, uninteresting calls will produce warnings:

```cpp
MockWidget mock;

EXPECT_CALL(mock, Update());

mock.Update();      // Expected call
mock.GetValue();   // Warning about uninteresting call
```

---

## How These Wrappers Work Under the Hood

Each wrapper registers itself with the GoogleMock framework to modify the behavior for uninteresting calls for its lifetime. On creation, they:

- **NiceMock**: Allow uninteresting calls silently.
- **NaggyMock**: Print a warning when uninteresting calls happen.
- **StrictMock**: Treat uninteresting calls as failures.

On destruction, they unregister themselves to restore default behavior.

This layered behavior ensures the mock methods run with the wrapper’s specified level of strictness.

---

## Tips and Best Practices

- **Prefer NiceMock for most tests:** It reduces test maintenance overhead.
- **Use StrictMock sparingly:** Limits flexibility and complicates refactoring.
- **Avoid nesting wrappers:** They are unsupported and may break behavior.
- **Always set expectations before exercising mocks:** Expectation order and presence determine matching behavior.
- **When testing interfaces you don’t own:** Wrap the mock class you control rather than the underlying classes.

<Warning>
Be cautious applying strict mocks as even minor refactors can cause tests to fail, increasing maintenance cost.
</Warning>

---

## Troubleshooting

### Uninteresting Call Warning or Failure

- You see warnings/errors about uninteresting calls:
  - If using default mock (NaggyMock), add expectations or switch to `NiceMock` to suppress warnings.
  - If using `StrictMock`, add explicit expectations or switch to less strict wrapper.

### No Effect When Applying Wrappers

- Ensure your mock methods are defined directly with `MOCK_METHOD` in the mock class.
- Verify the mock class destructor is virtual.
- Don’t nest wrappers.

### Unclear Why a Call Is Unexpected

- Use `--gmock_verbose=info` when running tests to get detailed matching information.
- Review the order and specificity of your `EXPECT_CALL`s.

---

## Related Concepts and Further Reading

- [Mocking Best Practices](https://google.github.io/googletest/guides/testing-patterns/mocking-best-practices)
- [`EXPECT_CALL` Reference](https://google.github.io/googletest/reference/mocking.md#EXPECT_CALL)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.md)
- [Actions Reference](https://google.github.io/googletest/reference/actions.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)

---

## Summary Diagram

```mermaid
flowchart TD
  UsingMock["User writes mock class MockFoo"] --> UsingWrapper["Wrap MockFoo as
NiceMock, NaggyMock, or StrictMock"]
  UsingWrapper --> BehaviorReg["On construction, registers mock's
strictness behavior"]
  BehaviorReg --> MockMethodCalls["Calls to mock methods"]

  subgraph Strictness Handling
    direction TB
    MockMethodCalls -->|Uninteresting call|
    Decision{Mock behavior for
uninteresting calls}
    Decision -->|NiceMock|
    AllowCall["Allow call silently"]
    Decision -->|NaggyMock (default)|
    WarnCall["Print warning"]
    Decision -->|StrictMock|
    FailCall["Fail test immediately"]
  end

  MockMethodCalls -->|Expected or Unexpected call|
  NormalBehavior["Normal EXPECT_CALL/ON_CALL matching and handling"]
```

---

## Source Reference

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-nice-strict.h", "range": "1-160"}]} />

---
