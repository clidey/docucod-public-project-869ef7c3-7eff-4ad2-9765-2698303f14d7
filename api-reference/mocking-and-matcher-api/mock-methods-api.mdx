---
title: "Mock Class and Method APIs"
description: "Describes the macros and constructs for defining mock classes and methods in C++ with GoogleMock. Learn how to use MOCK_METHOD, handle overloads, specify expectations, and extend mock objects for diverse testing needs."
---

# Mock Class and Method APIs

This page provides detailed documentation on GoogleMock's macros and constructs for defining mock classes and methods in C++. Learn how to declare mock methods using the `MOCK_METHOD` macro, handle function overloads, set expectations with `EXPECT_CALL`, and configure mock strictness modes to suit diverse testing scenarios.

---

## Defining Mock Methods with `MOCK_METHOD`

### What is `MOCK_METHOD`?

The `MOCK_METHOD` macro defines mock methods within mock classes. It generates implementations for virtual methods so you don't have to manually write them. This enables you to specify expectations and behaviors for those methods in tests.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- **ReturnType**: The return type of the method.
- **MethodName**: The name of the method to mock.
- **Args...**: Parameter types, enclosed in parentheses.
- **Qualifiers** (optional): Method qualifiers like `const`, `override`, `noexcept`, reference qualifiers (`ref(&)`, `ref(&&)`), or calling conventions (`Calltype(...)`).

**Example:**

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Handling Commas in Return Types or Arguments

If your return type or argument list has commas (e.g., template types like `std::map<int, double>`), enclose the type in parentheses or use a type alias:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
using MapIntDouble = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

### Where to Place `MOCK_METHOD`

Always place `MOCK_METHOD` declarations in the `public:` section of your mock class, even if you are mocking protected or private methods in the base class. This makes the mock methods accessible to `ON_CALL` and `EXPECT_CALL` macros externally.

### Qualifiers Supported

| Qualifier                    | Purpose                                   |
|------------------------------|-------------------------------------------|
| `const`                      | Marks method as `const`. Must match base. |
| `override`                   | Indicates method overrides virtual base. |
| `noexcept`                   | Marks method `noexcept`. Must match base. |
| `Calltype(convention)`       | Specifies calling convention (e.g. `STDMETHODCALLTYPE`). |
| `ref(&)` or `ref(&&)`        | Reference qualifier for lvalue/rvalue refs. Must match base. |

---

## Mocking Overloaded Methods

GoogleMock fully supports overloaded functions. You mock each overload as a separate `MOCK_METHOD` in your mock class.

**Example:**

```cpp
class Foo {
 public:
  virtual int Add(int x) = 0;
  virtual int Add(int times, int x) = 0;
  virtual const Bar& GetBar() const = 0;
  virtual Bar& GetBar() = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
};
```

If you don't mock every overload, you should bring the others into scope to avoid hiding them:

```cpp
using Foo::Add;  // To avoid hiding other overloads not mocked.
```

---

## Using Mock Methods in Tests

After defining your mock class and mock methods, you can set expectations on method calls using the `EXPECT_CALL` macro and specify their behavior.

### Basic Workflow

1. Include the mock header.
2. Instantiate mock objects.
3. Use `EXPECT_CALL(mock, Method(matchers))` to specify expected calls and behaviors.
4. Exercise your tested code with the mocks.
5. GoogleMock verifies expectations automatically when mocks are destroyed.

**Example:**

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
};

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(1);

  Painter painter(&turtle);
  painter.DrawCircle(0, 0, 10);
}
```

If `PenDown()` isnâ€™t called, the test fails immediately with a helpful error.

### Setting Expectations with `EXPECT_CALL`

`EXPECT_CALL` specifies that the mock method *should* be called at runtime with matching arguments.

Syntax:

```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action)
    .RetiresOnSaturation();
```

- **Matchers:** specify expected argument values or properties (see the Matchers Reference).
- **Times:** how often the call is expected.
- **WillOnce / WillRepeatedly:** specify the behavior and return values.
- **RetiresOnSaturation:** disables the expectation after it has been fully met.

### Important Notes:

- Set expectations *before* exercising code that calls mocks.
- If you omit `Times()`, GoogleMock infers reasonable defaults based on the presence of `WillOnce`/`WillRepeatedly`.
- Multiple `EXPECT_CALL`s on the same method apply with specific matching logic, checked in *reverse order*.

---

## Mock Strictness Control

GoogleMock provides three mock strictness modes to control how mocks handle calls without explicit expectations.

| Mock Type     | Behavior on Uninteresting Calls     | When to Use                              |
|---------------|--------------------------------------|-----------------------------------------|
| **NaggyMock** (default) | Prints warnings                     | General development and debugging        |
| **NiceMock**            | Suppresses uninteresting call warnings | Cleaner test output, ignoring irrelevant calls |
| **StrictMock**          | Treats uninteresting calls as errors | Enforcing strict test behavior; catching unwanted calls early |

### How to Use:

Wrap your mock object with the strictness wrapper:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

### Important Caveats:

- These wrappers only affect mock methods defined using `MOCK_METHOD` directly in the class, not inherited methods.
- The mock class should have a virtual destructor for proper functioning.
- Use strict mocks sparingly to avoid brittle tests.

---

## Advanced Mock Method Features

### Mocking Methods with Reference Qualifiers and `noexcept`

You can specify reference qualifiers and `noexcept` for mocked methods using the optional specifiers:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (const, ref(&), noexcept, override));
```

This ensures the mock exactly matches the base class method's declaration.

### Mocking Methods with Different Calling Conventions

On Windows, you might need to specify the call type qualifier:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

### Mocking Template Classes

Mock class templates similarly use the `MOCK_METHOD` macro:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(void, Push, (const T& elem), (override));
  MOCK_METHOD(int, GetSize, (), (const, override));
};
```

### Legacy vs Modern Mock Macros

Older code may use `MOCK_METHODn` macros grouped by argument count, but `MOCK_METHOD` with variadic templates is recommended moving forward.

---

## Troubleshooting Common Mock Method Issues

- **Compile errors with commas in types:** Use parentheses or type aliases.
- **Uninteresting call warnings:** Use `NiceMock` or add `EXPECT_CALL` with `Times(AnyNumber())` for those calls you want to ignore.
- **Unexpected calls leading to failures:** Explicitly define expectations or disallow calls with `Times(0)`.
- **Mock destructor issues:** Ensure virtual destructors on base interfaces; you can also mock destructor behavior using a mock method called inside the destructor.

---

## Summary of Key Macros and Classes

| Macro/Class               | Purpose                                |
|--------------------------|--------------------------------------|
| `MOCK_METHOD`            | Define a mock method in a mock class. |
| `EXPECT_CALL`            | Set an expectation on mock method call.
| `ON_CALL`                | Define default behavior without expectation.
| `NiceMock<T>`            | Suppress warnings on uninteresting calls.
| `StrictMock<T>`          | Fail on uninteresting calls.
| `NaggyMock<T>`           | Default, warn on uninteresting calls.
| `Sequence` / `InSequence` | Manage call order of expectations.

---

For more extensive examples and best practices see the [gMock Cookbook](docs/gmock_cook_book.md) and [gMock for Dummies](docs/gmock_for_dummies.md).

---

## References and Further Reading

- [GoogleMock Mocking Reference](docs/reference/mocking.md) (full API details)
- [gMock Cookbook](docs/gmock_cook_book.md) (recipes and examples)
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) (quick reminders)
- [Controlling Mock Strictness](api-reference/mocking-and-matcher-api/nice-naggy-strict-mock-api) (nice, naggy, and strict mock usage)

---

## Practical Tips for Effective Mocking

- Always define mock methods in `public:` section.
- Use `override` in mocks to catch mismatched method signatures.
- Set expectations *before* exercising tested code.
- Use matchers to avoid over-specification; specify only what matters.
- Use `NiceMock` to reduce noise for uninteresting methods.
- Prefer interaction-based testing with mocks over brittle state verifications.
- When mocking overloaded methods, ensure all relevant overloads are declared or brought into scope.

---

## Example: Defining a Mock Class with Various Features

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {};
  virtual int Process(int x) const = 0;
  virtual void Reset() noexcept = 0;
  virtual std::string ToString() = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Process, (int x), (const, override));
  MOCK_METHOD(void, Reset, (), (noexcept, override));
  MOCK_METHOD(std::string, ToString, (), (override));
};

// Use in test
TEST(FooTest, Example) {
  MockFoo mock;
  EXPECT_CALL(mock, Process(5)).Times(1).WillOnce(::testing::Return(10));
  EXPECT_CALL(mock, Reset()).Times(1);

  // ... code that calls mock.Process(5) and mock.Reset() ...
}
```

---

This page empowers C++ developers with the precise tools and syntax needed to create robust, maintainable mock classes and methods using GoogleMock, enabling confident and expressive testing of complex dependencies and behaviors.