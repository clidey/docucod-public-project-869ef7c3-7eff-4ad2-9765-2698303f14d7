---
title: "Actions Reference"
description: "Details all built-in and advanced GoogleMock actions. Understand how to specify return values, invoke callbacks, throw exceptions, and chain or compose behaviors in mock expectations, including templates and extension points."
---

# Actions Reference

GoogleMock provides a rich set of **actions** that define what a mock function should do when it is invoked. This page details built-in and advanced actions you can use to specify return values, side effects, invocations, chaining behaviors, and template-based extensions.

---

## Understanding Actions

Actions in GoogleMock specify the behavior of mocked methods when called during tests. They can:

- Return a fixed or computed value
- Manipulate arguments (e.g., modify output parameters)
- Invoke callbacks or other functions
- Throw exceptions
- Chain multiple behaviors sequentially

By combining actions, you define comprehensive and expressive mock behaviors that match complex real-world scenarios.

Actions are used primarily in `EXPECT_CALL` and `ON_CALL` statements with `.WillOnce()`, `.WillRepeatedly()`, or `.WillByDefault()` clauses.

---

## Common Return Value Actions

| Action | Description |
|--------|-------------|
| `Return()` | Return from a `void` mock function. Useful to indicate the action immediately returns. |
| `Return(value)` | Return a specific value. The value is copied or converted at setup time, not call time. |
| `ReturnArg<N>()` | Return the `N`-th argument passed to the mock method, useful for forwarding. |
| `ReturnRef(variable)` | Return a reference to an existing variable. Ensures the mock returns the live object. |
| `ReturnPointee(ptr)` | Return the value pointed to by pointer `ptr` at call time, reflecting live state. |
| `ReturnNull()` | Return a null pointer. Convenient for pointer-returning functions. |
| `ReturnNew<T>(args...)` | Return a newly allocated object `new T(args...)` each time the action executes, ensuring fresh instances are returned. |

**Practical Tip:** Avoid returning references to temporaries; use `ReturnRef` with caution and ensure the referenced object outlives the mock call.

---

## Side Effects on Arguments

Actions allow modifying function arguments to simulate side effects such as modifying output parameters or pointer targets.

| Action | Description |
|------- |-------------|
| `SetArgPointee<N>(value)` | Assign `value` to the pointee of the `N`-th (zero-based) argument, which must be pointer or iterator. Commonly used for output parameters. |
| `SetArgReferee<N>(value)` | Assign `value` to the `N`-th argument, expected to be a reference. |
| `SetArrayArgument<N>(first, last)` | Copy elements in the range `[first, last)` to the array pointed by the `N`-th argument. Works for pointers or iterators, like output buffers. |
| `SaveArg<N>(pointer)` | Copy-assign the `N`-th argument to `*pointer` for later verification. |
| `SaveArgByMove<N>(pointer)` | Move-assign the `N`-th argument to `*pointer`. Supports move-only types. |
| `SaveArgPointee<N>(pointer)` | Copy the value pointed to by the `N`-th argument to `*pointer`. Useful for verifying output pointer contents. |
| `DeleteArg<N>()` | Delete the resource pointed to by the `N`-th argument (which must be a pointer). Useful to mock ownership transfer in APIs. |

<Callout>
**Best Practice:** When chaining side-effect actions with return values, wrap side effects before the return in `DoAll()` (see next section).
</Callout>

---

## Composing Multiple Actions

Use `DoAll(a1, a2, ..., an)` to execute multiple actions sequentially when a mock method is called. This is useful to combine side effects with a return value.

- The first `n - 1` actions must return `void`.
- The last action's result becomes the result of the entire composite action.

### Example

```cpp
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Return;

EXPECT_CALL(mock, Mutate(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

Here, when `Mutate` is called, it sets the pointed `int` argument to 5, then returns `true`.

---

## Using Functions, Methods, and Callables as Actions

You can invoke any callable (function, lambda, functor, or method) directly as an action.

| Action Syntax | Description |
|---------------|-------------|
| `f` | Calls the callable `f` with the arguments of the mock function.
| `Invoke(f)` | Calls a function or functor `f` passing all mock function arguments.
| `Invoke(object_ptr, &Class::Method)` | Calls a class method on the given object with mock function arguments.
| `InvokeWithoutArgs(f)` | Calls the callable `f` without passing the mock function's arguments.
| `InvokeWithoutArgs(object_ptr, &Class::Method)` | Calls a method on object without arguments.

### Practical Examples

```cpp
using ::testing::Invoke;

int Sum(int x, int y) { return x + y; }

EXPECT_CALL(mock, Add(_, _))
    .WillOnce(Invoke(Sum));

EXPECT_CALL(mock, Notify())
    .WillOnce(InvokeWithoutArgs([]() { /* do something */ }));
```

---

## Invoking Callable Arguments

Sometimes a mock function receives function pointers or functors as arguments, and you want to invoke those callbacks.

Use `InvokeArgument<N>(args...)` to call the N-th argument, which must be callable, with the supplied arguments.

### Example

```cpp
using ::testing::InvokeArgument;

EXPECT_CALL(mock, DoAsync(_, _))
    .WillOnce(InvokeArgument<1>(5));  // Calls the 2nd argument with 5
```

**Note:** To pass an argument by reference to the callable, wrap it with `std::ref()`.

---

## Ignoring Action Return Values

If an action produces a result but you want to ignore it (for example, in a `void` function), use:

- `IgnoreResult(a)` - performs action `a` but discards the result.

Example:

```cpp
EXPECT_CALL(mock, DoSomething())
    .WillOnce(IgnoreResult(Invoke(SomeFunctionWithReturnValue)));
```

> **Warning:** Don't use `IgnoreResult` on actions that already return `void`.

---

## Selecting and Transforming Arguments for Actions

Sometimes the target action expects fewer or differently ordered arguments than the mock function provides.

- `WithArg<N>(action)` - passes the `N`-th argument (zero-based) to `action`.
- `WithArgs<N1, N2, ..., Nk>(action)` - passes multiple selected arguments.
- `WithoutArgs(action)` - calls `action` without any arguments.

### Example

```cpp
EXPECT_CALL(mock, Foo(_, _, _))
    .WillOnce(WithArgs<0, 2>(Invoke(SomeFunction)));
```

This calls `SomeFunction` passing the first and third arguments of `Foo`.

---

## Defining Custom Actions

You can define named custom actions using macros or classes.

### Using ACTION macros

```cpp
ACTION(MyAction) {
  // Use arg0, arg1, ..., return value as needed.
  return arg0 + 1;
}
```

- `_P` suffix macros define parameterized actions.

Example:

```cpp
ACTION_P(Add, n) {
  return arg0 + n;
}

EXPECT_CALL(mock, Foo(_))
    .WillOnce(Add(5));  // Returns arg0 + 5
```

### Using ACTION_TEMPLATE

To create actions with explicit template parameters (beyond what can be deduced), use `ACTION_TEMPLATE`.

Example:

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(::std::get<k>(args));
}

EXPECT_CALL(mock, Foo(_, _))
    .WillOnce(DuplicateArg<1, unsigned char>(&n));
```

### Implementing Action Interface

For full control and complex behaviors, implement `ActionInterface<F>` where `F` is the mock function type.

---

## Throwing Exceptions

Use `Throw(exception)` to cause the mock method to throw the given exception.

Example:

```cpp
EXPECT_CALL(mock, Func())
    .WillOnce(Throw(std::runtime_error("fail")));
```

---

## Default Action and `DoDefault()`

`DoDefault()` executes the default behavior of the mock method (either built-in default or configured via `ON_CALL`).

> **Note:** `DoDefault()` cannot be used inside composite actions like `DoAll()`.

---

## Advanced Usage and Best Practices

- Combine side effects with return values using `DoAll`.
- Specify action for individual arguments with `WithArg` and `WithArgs` to adapt mismatched function signatures.
- Use `InvokeArgument` to propagate callbacks supplied to mocks, simulating async or deferred behavior.
- Prefer `ReturnPointee` for returning values from pointers to reflect live state.
- Use `IgnoreResult` to adjust incompatible action return types.
- Define custom actions with `ACTION` macros for reusable behaviors.
- Leverage `ACTION_TEMPLATE` for actions needing template parameters.
- Use lambdas or functors directly as actions for straightforward behavior.

---

## Troubleshooting Common Issues

- Remember action return values are evaluated once during expectation setup, not per call. Use lambdas or functors to return dynamic values.
- Passing arguments by reference to invoked callables requires wrapping with `std::ref` to avoid passing copies.
- Sharing stateful actions may cause unexpected shared-effect bugs; create separate instances if independent state is needed.
- `DoAll` requires all but the last sub-actions to return `void`; violating this causes compilation errors.
- `Throw` may lead to test failures if not expected; catch exceptions accordingly or specify behavior carefully.

---

## Example: Chaining Setting Output and Returning a Value

```cpp
using ::testing::SetArgPointee;
using ::testing::Return;
using ::testing::DoAll;

EXPECT_CALL(mock, ProcessData(_, _))
    .WillOnce(DoAll(
        SetArgPointee<1>(42),  // Set output argument to 42
        Return(true)));       // Return true as function result
```

## Example: Invoking a Callback Argument

```cpp
using ::testing::InvokeArgument;

// Mock method signature: void Foo(int, std::function<void(int)> callback);
EXPECT_CALL(mock, Foo(42, _))
    .WillOnce(InvokeArgument<1>(100));  // Calls callback with 100
```

## Example: Using `WithArgs` to Adapt Arguments

```cpp
int Sum3(int x, int y, int z) { return x + y + z; }

// Mock method signature: int Foo(int, int, int, int);
EXPECT_CALL(mock, Foo(_, _, _, _))
    .WillOnce(WithArgs<0, 1, 3>(Invoke(Sum3)));
```

This calls `Sum3` passing the 1st, 2nd, and 4th arguments of `Foo`.

---

## Further Reading & Related Topics

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - for actionable recipes including actions.
- [Mock Method API](https://google.github.io/googletest/reference/mocking-and-matcher-api/mock-methods-api.html) - setting expectations with actions.
- [Matchers Reference](https://google.github.io/googletest/reference/mocking-and-matcher-api/matchers-api.html) - combine with actions for argument matching.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - beginner-friendly introduction.

For detailed usage patterns, see the Guides section on [Custom Matchers and Actions](https://google.github.io/googletest/guides/advanced-usage-integration/custom-matchers-actions.html).

---

By mastering actions in GoogleMock, you can simulate complex interactions, side effects, and behaviors, enabling robust and expressive mock-based tests.