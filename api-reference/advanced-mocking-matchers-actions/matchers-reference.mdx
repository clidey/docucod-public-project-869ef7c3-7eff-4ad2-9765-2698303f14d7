---
title: "Matchers API"
description: "Catalog of built-in and extensible matchers for argument validation in mock method calls, with syntax, extensibility guidelines, and real-world C++ usage examples."
---

# Matchers API

Explore GoogleMock's powerful and flexible arsenal of built-in and extensible matchers, designed specifically for argument validation in mock method calls within C++ test suites. This reference details the syntax, extensibility guidelines, and practical usage examples to help you precisely specify how mocks should be invoked, unlocking highly expressive and maintainable tests.

---

## Overview

Matchers are the heart of argument validation in GoogleMock. They enable you to specify what arguments a mock method expects, from simple exact value matches to complex predicates, combining matchers logically and even defining your own custom matchers for domain-specific conditions.

This API reference covers:

- Catalog of built-in common matchers.
- Matcher composition and combination.
- Guidance on writing custom matchers using macros and classes.
- Best practices and caveats in matcher usage.
- Real-world C++ examples demonstrating matcher integration in mocks.

Match expectations set with `EXPECT_CALL` use matchers to verify calls, ensuring your code under test interacts precisely with dependencies.

---

## Built-in Matchers

GoogleMock ships with a rich collection of built-in matchers catering to diverse use cases. Here are key categories and examples:

### Wildcard Matchers

- `_` — Matches *any* value. Use when argument is unconstrained.
- `A<T>()` or `An<T>()` — Matches any value of type `T`.

### Equality and Comparison Matchers

- `Eq(val)` — Matches values equal to `val` (uses `operator==`). Literal values implicitly convert to `Eq`.
- `Ne(val)` — Not equal to `val`.
- `Lt(val)`, `Le(val)`, `Gt(val)`, `Ge(val)` — Less than, less or equal, greater than, greater or equal.

### Nullness Matchers

- `IsNull()` — Matches any null pointer (raw or smart).
- `NotNull()` — Matches any non-null pointer.

### String Matchers

- `StrEq(str)`, `StrNe(str)` — Case-sensitive string equality/inequality.
- `StrCaseEq(str)`, `StrCaseNe(str)` — Case-insensitive string equality/inequality.
- `StartsWith(prefix)` / `EndsWith(suffix)` / `HasSubstr(substring)` — Match string patterns.
- `MatchesRegex(regex)` / `ContainsRegex(regex)` — Match strings against regular expressions.

### Container Matchers

- `Contains(element_matcher)` — Container has *at least one* element matching.
- `ElementsAre(...)` — Container has elements matching exactly in given order.
- `UnorderedElementsAre(...)` — Container has elements matching exactly in any order.
- `Each(element_matcher)` — All elements match the matcher.
- `SizeIs(matcher)` — Container size matches the matcher.

### Pointer and Reference Matchers

- `Pointee(matcher)` — Pointer points to a value matching the matcher.
- `Ref(variable)` — Matches arguments referencing a specific variable.
- `Address(matcher)` — Matches objects whose address matches the matcher.
- `WhenDynamicCastTo<T>(matcher)` — Matches after dynamically casting pointer or reference to T.

### Tuple and Pair Matchers

- `Pair(first_matcher, second_matcher)` — Matches pairs where both elements satisfy respective matchers.
- `FieldsAre(matchers...)` — Matches tuple-like aggregates field-wise.
- `Args<k1, k2, ...>(matcher)` — Matches selected arguments as a tuple.

### Logical Composition

- `AllOf(m1, m2, ...)` — Matches if *all* matchers match.
- `AnyOf(m1, m2, ...)` — Matches if *any* matcher matches.
- `Not(matcher)` — Negates the matcher.

### Predicate and Functional Matchers

- `Truly(predicate)` — Matches if the predicate (functor or lambda) returns true.
- `Matches(matcher)` — Converts a matcher into a predicate suitable for STL algorithms.

---

## Extending Matchers

GoogleMock allows you to create your own custom matchers tailored to your domain, with intuitive syntax and comprehensive failure messages.

### Using the `MATCHER` Macros

The simplest way to define a new matcher is the `MATCHER` macro, which lets you write concise, readable matchers based on predicates.

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(mock, Foo(IsEven()));
```

- `arg` is the value being matched.
- The description string documents what the matcher means.
- You can stream explanatory text to `*result_listener` to improve failure messages.

You can also write parameterized matchers with `MATCHER_P`, `MATCHER_P2`, ..., supporting up to 10 parameters:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "") {
  return (arg % divisor) == 0;
}

// Usage:
EXPECT_THAT(value, IsDivisibleBy(7));
```

### Implementing Matcher Classes

For greater flexibility and type control, implement the matcher interface yourself:

```cpp
class MyMatcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(const T& arg, std::ostream* os) const {
    // Return true if matched, optionally write to os
  }

  void DescribeTo(std::ostream* os) const {
    *os << "description";
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "negated description";
  }
};

::testing::Matcher<T> MakeMyMatcher() {
  return ::testing::Matcher<T>(new MyMatcher());
}
```

### Polymorphic Matchers

Define matchers that work with multiple types by making `MatchAndExplain` a template function. Use `MakePolymorphicMatcher()` to create instances.

### Composite Matchers

You can define matchers that take other matchers as parameters and combine them logically, describing failure cases clearly.

---

## Usage Patterns and Tips

### Choosing Matchers for Arguments

Specify only the constraints relevant to your test logic. Use `_` to skip arguments.

### Matcher Composition

Combine matchers with `AllOf()`, `AnyOf()`, and `Not()` for expressive criteria.

### Matching Tuples and Multiple Arguments

Use the `Args<>()` or `.With()` clause in `EXPECT_CALL` when your validation depends on relationships between multiple arguments.

### Avoiding Side Effects

Matchers must be pure functions without side effects, as gMock may invoke them multiple times.

### Safe Casting of Matchers

Use `SafeMatcherCast<T>()` when you need to convert between compatible but different matcher types.

### Using Matchers for Callbacks and Move-Only Types

Matchers work with pointers, unique_ptr, and even std::function mocks.

### Debugging Matcher Issues

Run tests with `--gmock_verbose=info` to trace matcher invocations and understand mismatches.

---

## Real-world C++ Example

Here's how you might use matchers in a mock class testing scenario:

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;
using ::testing::_;
using ::testing::Gt;
using ::testing::StrEq;

class MockTurtle {
 public:
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};

TEST(PainterTest, MovesTurtleCorrectly) {
  NiceMock<MockTurtle> turtle;

  EXPECT_CALL(turtle, GoTo(50, _));  // x=50, y=anything
  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(Gt(0)));  // distance > 0

  Painter painter(&turtle);
  painter.DrawLine(50, 10);
}
```

This test checks for calls matching required argument properties without over-specifying.

---

## Troubleshooting

- **Matcher type errors:** Ensure matchers match the exact argument types or use `SafeMatcherCast`.
- **Uninteresting call warnings:** Use `NiceMock` to suppress when appropriate.
- **Ambiguous overloads:** Help the compiler choose overloads with explicit type matchers or `Const()` wrapper.
- **Matcher side effects:** Avoid changing state in matchers to prevent flaky tests.


---

## Further Reading and References

- [Matchers Reference](../reference/matchers.md): Full list of all matchers available.
- [gMock Cookbook](../gmock_cook_book.md#NewMatchers): Recipes for defining and using matchers.
- [Mocking Reference](../reference/mocking.md): Integration of matchers with mock methods.
- [Configuring Expectations and Actions Guide](../guides/mocking-advanced-testing/configuring-expectations-actions.mdx): How to connect matchers with expectations.
- [Writing New Matchers Quickly (MATCHER macros)](../googlemock/include/gmock/gmock-matchers.h): Source examples.

---

## Navigation Context

This page belongs to the **Matchers & Actions** group within the API Reference section, complementing the **Actions API** and **Cardinalities & Call Expectations** pages. Together, they form the core toolkit for advanced mocking with GoogleMock, allowing you to precisely specify mock behaviors and validate interactions.

Consider consulting related guides on **Working with Matchers and Custom Parameters** and **Managing Mock Strictness** for a holistic understanding.

---