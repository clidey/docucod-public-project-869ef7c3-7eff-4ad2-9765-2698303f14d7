---
title: "Matchers and Value Comparisons"
description: "Describes matcher syntax, implementation details, and advanced comparison features supported by GoogleTest. Provides use cases for integrating matchers with assertions and customizing value comparisons."
---

# Matchers and Value Comparisons

GoogleTest offers a powerful and expressive system of *matchers* — predicates that allow you to specify fine-grained conditions on values, function arguments, and complex objects in your tests. This page details how to use matcher syntax, leverage built-in matchers for value comparisons, and implement advanced matching behavior to make your assertions both more readable and robust.

---

## What Are Matchers?

Matchers specify *what values you expect* in your test checks, going beyond simple equality. Instead of only checking if a value equals another, matchers let you specify semantic conditions — like whether a number is positive, a string contains a substring, or a container holds elements matching certain criteria.

They are especially useful in mock expectations (`EXPECT_CALL`) and generalized assertions (`EXPECT_THAT`), making tests expressive and maintainable.

### Why Use Matchers?

- **Expressiveness:** Combine, compose, and customize conditions in human-readable ways.
- **Better Failure Messages:** Provide descriptive explanations of why a test failed.
- **Reusability:** Share complex matching logic across multiple tests.
- **Flexibility:** Match values approximately, partially, or by properties.

<Tip>
Matchers form the foundation for writing intuitive assertions and mock expectations. Using them effectively will help you write clearer and more resilient tests.
</Tip>

---

## Basic Matcher Syntax

Matchers appear wherever you can specify argument expectations. For example:

```cpp
EXPECT_CALL(mock_object, Method(Ge(10), StartsWith("foo"), _));
EXPECT_THAT(actual_value, AllOf(Le(20), Ge(10)));
```

- `Ge(10)`: Matches values greater or equal to 10.
- `StartsWith("foo")`: Matches strings starting with "foo".
- `_`: Wildcard matcher; matches any value.
- `AllOf(...)`: Combines multiple matchers; all must match.

Matchers also implicitly wrap values as equality checks:

```cpp
EXPECT_THAT(x, 42);  // Equivalent to EXPECT_THAT(x, Eq(42));
EXPECT_CALL(mock, Func("hello"));  // Equivalent to Expect_CALL(mock, Func(Eq("hello")));
```

---

## Using Matchers in Assertions

To verify properties of values, use the generalized assertions:

```cpp
EXPECT_THAT(value, matcher);
ASSERT_THAT(value, matcher);
```

They function like traditional `EXPECT_EQ` or `ASSERT_TRUE` but take advantage of the expressive matching.

Example:

```cpp
EXPECT_THAT(my_string, HasSubstr("error"));
EXPECT_THAT(numbers, Each(Gt(0)));
```

This assertion will check that `my_string` contains "error", and that all elements in `numbers` are positive.

---

## Commonly Used Built-in Matchers

GoogleTest provides an extensive library of matchers to cover many common needs.

### Equality and Comparison

| Matcher     | Description                                                      |
|-------------|------------------------------------------------------------------|
| `Eq(val)`   | Equals `val`. Implicitly used when passing plain values.       |
| `Ne(val)`   | Not equal to `val`.                                             |
| `Lt(val)`   | Less than `val`.                                                |
| `Le(val)`   | Less or equal to `val`.                                         |
| `Gt(val)`   | Greater than `val`.                                             |
| `Ge(val)`   | Greater or equal to `val`.                                      |

Example:

```cpp
EXPECT_CALL(mock, Func(Gt(10)));
EXPECT_THAT(x, Le(100));
```

### String Matchers

| Matcher              | Description                                           |
|----------------------|-------------------------------------------------------|
| `StrEq(s)`           | String equals `s` (case-sensitive)                    |
| `StrNe(s)`           | String not equals `s` (case-sensitive)                |
| `StrCaseEq(s)`       | String equals `s` (case-insensitive)                  |
| `HasSubstr(substring)` | String contains `substring`                          |
| `StartsWith(prefix)` | String starts with `prefix`                            |
| `EndsWith(suffix)`   | String ends with `suffix`                              |

Example:

```cpp
EXPECT_THAT(error_message, StartsWith("Fatal"));
EXPECT_CALL(mock, Log(StrCaseEq("WARNING")));
```

### Container Matchers

| Matcher                     | Description                                                                   |
|-----------------------------|-------------------------------------------------------------------------------|
| `Contains(element_matcher)` | The container contains at least one element that matches `element_matcher`.    |
| `Each(element_matcher)`     | All elements in the container match `element_matcher`.                        |
| `ElementsAre(...)`          | Container elements match matchers exactly, in order.                         |
| `UnorderedElementsAre(...)` | Container elements match matchers exactly, in any order.                     |
| `SizeIs(size_matcher)`      | The container's size matches `size_matcher` (e.g., `Eq(3)`, `Le(5)`).        |
| `Key(key_matcher)`          | Matches `std::pair` or map where the `first` matches `key_matcher`.          |
| `Pair(first_matcher, second_matcher)` | Matches `std::pair` whose `first` and `second` satisfy respective matchers. |

Example:

```cpp
EXPECT_THAT(my_vector, ElementsAre(1, 2, 3));
EXPECT_THAT(my_map, Contains(Key(Ge(10))));
EXPECT_THAT(vector_of_strings, Each(HasSubstr("foo")));
```

---

## Combining and Negating Matchers

You can combine matchers using logical operators:

- `AllOf(m1, m2, ...)` — all must match.
- `AnyOf(m1, m2, ...)` — any must match.
- `Not(m)` — logical negation.

Example:

```cpp
EXPECT_THAT(value, AllOf(Ge(0), Le(10)));
EXPECT_THAT(string_value, Not(StartsWith("error")));
```

This enables writing very precise predicates.

---

## Advanced Matcher Usage

### Matching Nested or Complex Structures

Matchers support hierarchical structures using `Field()`, `Property()`, or `Pair()`:

- `Field(&Class::member, matcher)` matches an object if its member satisfies `matcher`.
- `Property(&Class::getter_method, matcher)` matches an object whose getter returns a matching value.
- `Pair(m1, m2)` matches an `std::pair` whose first and second element satisfy the respective matchers.

Example:

```cpp
struct Point { int x; int y; };

EXPECT_THAT(point, Field(&Point::x, Ge(10)));
EXPECT_THAT(map_entry, Pair(Eq(1), HasSubstr("ok")));
```

This allows precise verification without deep manual checks.

### SafeMatcherCast

GoogleTest provides `SafeMatcherCast<T>(m)` to convert matchers safely between compatible types, especially useful when working with inheritance or type conversions.

You rarely need to call this explicitly as most casting happens automatically.

### Custom Matchers

You can define your own matchers quickly using macros:

- `MATCHER(Name, "description") { ... }` for parameterless matchers.
- `MATCHER_P(Name, param, "description") { ... }` for matchers with parameters.

These custom matchers must implement `MatchAndExplain` returning whether the argument matches and optionally streaming failure details.

Example:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
EXPECT_THAT(value, IsEven());
```

For complex matchers, write classes implementing the matcher interface.

---

## Practical Tips and Best Practices

- Use `_` as a wildcard matcher when argument value doesn't matter.
- Prefer `EXPECT_THAT` for expressive assertions using matchers.
- Combine matchers logically for clearer intent.
- Use `Field()` and `Property()` to check parts of objects without verbose code.
- When matching containers, prefer `ElementsAre` or `Contains` to check contents precisely.
- Beware of over-specifying mock expectations; keep them as general as possible to avoid brittle tests.

<Tip>
Always provide custom failure messages or use matchers that generate rich failure output to speed up debugging.
</Tip>

---

## Common Pitfalls & Troubleshooting

<Warning>
- Remember that matcher evaluation may be invoked multiple times; do not write matchers with side effects.
- For overloaded functions, disambiguate the mock method or matcher to avoid unexpected behavior.
- Using too specific matchers might cause tests to fail unnecessarily on innocuous changes.
- Beware that pointer equality does not check pointed-to values; use `Pointee()` matcher for that.
</Warning>

---

## Summary of Usage Flow

1.  Identify the value or argument you want to verify.
2.  Choose or combine appropriate built-in matchers to describe expected properties.
3.  Use `EXPECT_THAT` or `EXPECT_CALL` with matchers.
4.  Write custom matchers if needed for recurrent or complex conditions.
5.  Use `Field()`, `Property()`, and `Pair()` to target object members or pairs.
6.  Run tests and analyze rich failure messages for quick diagnostics.

---

## Related Documentation and Resources

- [Assertions Reference](reference/assertions.md) — Using `EXPECT_THAT` and other assertions effectively.
- [Mocking Reference](reference/mocking.md) — Integrating matchers in mock expectations.
- [gMock Cookbook](gmock_cook_book.md) — Practical recipes for custom matchers and actions.
- [Matchers Reference](reference/matchers.md) — Detailed list of all built-in matchers.
- [Writing Custom Matchers](guides/real-world-mocking/custom-matchers-actions.mdx) — Hands-on guide for defining your own matchers.

---

This page fits into the API Reference section under GoogleTest Core APIs and relates closely to Assertions and Mocking documentation.

For mastering testing workflows, refer to Guides on core workflows and real-world mocking scenarios.

---