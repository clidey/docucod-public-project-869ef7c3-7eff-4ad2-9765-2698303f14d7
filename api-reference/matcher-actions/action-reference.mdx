---
title: "Actions"
description: "Description and reference for defining and using built-in and custom actions with GoogleMock. Guides readers through invoking custom behaviors on mock methods and advanced action composition patterns."
---

# Actions Reference

Actions in GoogleMock specify what a mocked function should do when it is invoked during a test. This documentation page provides a detailed guide to the built-in and custom actions available in GoogleMock, showing how to define behaviors for mock methods, invoke callables, compose multiple actions, and create parameterized actions.

All actions described here live in the `::testing` namespace.

---

## Returning Values from Mock Functions

The most common need is to specify what a mock method returns. GoogleMock provides several actions for this:

| Action | Description |
| --- | --- |
| `Return()` | Returns from a `void` mock function (no return value). |
| `Return(value)` | Returns the given `value`. The value is converted to the mock function's return type *at the time the expectation is set*, not when the action is executed. |
| `ReturnArg<N>()` | Returns the N-th (zero-based) argument passed to the mock method. |
| `ReturnNew<T>(a1, ..., ak)` | Returns a pointer to a newly allocated object of type `T` constructed with the given arguments. A fresh object is created on each invocation.

| `ReturnNull()` | Returns a null pointer.
| `ReturnPointee(ptr)` | Returns the value pointed to by `ptr`.
| `ReturnRef(variable)` | Returns a reference to the given variable.
| `ReturnRefOfCopy(value)` | Returns a reference to a copy of `value` that lives for the duration of the action.
| `ReturnRoundRobin({a1, ..., ak})` | Returns elements from the given list in round-robin order on successive calls.


### Example

```cpp
EXPECT_CALL(mock, Foo())
    .WillOnce(Return(42));

EXPECT_CALL(mock, Bar())
    .WillRepeatedly(ReturnNew<MyClass>(arg1, arg2));

int argument_copy;
EXPECT_CALL(mock, Baz(_)).WillOnce(ReturnRefOfCopy(argument_copy));
```


## Mocking Side Effects

Actions can modify mock function arguments or external variables to simulate side effects:

| Action | Description |
| --- | --- |
| `Assign(&variable, value)` | Assigns `value` to `variable`.
| `DeleteArg<N>()` | Deletes the N-th argument (must be a pointer).
| `SaveArg<N>(pointer)` | Saves the N-th argument to `*pointer` by copy.
| `SaveArgByMove<N>(pointer)` | Saves the N-th argument to `*pointer` by move semantics.
| `SaveArgPointee<N>(pointer)` | Saves the value pointed to by the N-th argument to `*pointer`.
| `SetArgReferee<N>(value)` | Assigns `value` to the variable referenced by the N-th argument.
| `SetArgPointee<N>(value)` | Assigns `value` to the variable pointed to by the N-th argument.
| `SetArgumentPointee<N>(value)` | Alias for `SetArgPointee<N>(value)` (deprecated).
| `SetArrayArgument<N>(first, last)` | Copies elements from the range `[first, last)` into the array pointed to by the N-th argument.
| `SetErrnoAndReturn(error, value)` | Sets system `errno` to `error` and returns `value`.
| `Throw(exception)` | Throws the given exception when the mock function is called. Requires exceptions support.


### Example

```cpp
EXPECT_CALL(mock, Mutate(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));

EXPECT_CALL(mock, DeletePtr(_))
    .WillOnce(DeleteArg<0>());
```


## Using Functions, Functors, or Lambdas as Actions

GoogleMock allows you to specify a callable (free function, lambda, functor, or method) to be invoked when a mock function is called. This can help implement custom behavior succinctly.

| Action | Description |
| --- | --- |
| `f` | Calls the callable `f` with the mock function's arguments.
| `Invoke(f)` | Calls the function or functor `f` with the mock function's arguments.
| `Invoke(object_pointer, &Class::method)` | Invokes the method on the object with the mock function's arguments.
| `InvokeWithoutArgs(f)` | Invokes the nullary callable `f` ignoring the mock function's arguments.
| `InvokeWithoutArgs(object_pointer, &Class::method)` | Invokes the nullary method on the object.
| `InvokeArgument<N>(arg1, arg2, ..., argk)` | Invokes the N-th (zero-based) argument to the mock function, which must be callable, with the given arguments.

To pass arguments by reference to the callable argument in `InvokeArgument`, wrap them in `std::ref()`.


### Example

```cpp
// Using Invoke() with static functions and methods
EXPECT_CALL(mock, Foo(_))
    .WillOnce(Invoke(&MyClass::StaticMethod))
    .WillOnce(Invoke(&obj, &MyClass::InstanceMethod));

// Using InvokeWithoutArgs()
EXPECT_CALL(mock, Bar(_))
    .WillOnce(InvokeWithoutArgs([] { return 123; }));

// Using InvokeArgument<N>()
EXPECT_CALL(mock, RegisterCallback(_))
    .WillOnce(InvokeArgument<0>(5, std::ref(data)));
```


## Default Action

| Action | Description |
| --- | --- |
| `DoDefault()` | Performs the default action as specified by `ON_CALL()` or the built-in default if none is set.


> **Note:** `DoDefault()` cannot be used inside composite actions such as `DoAll()`. Attempting to do so will cause a runtime error.


## Composite Actions

Composite actions enable multiple actions to be performed in sequence or to adapt the mock function arguments passed to another action.

| Action | Description |
| --- | --- |
| `DoAll(a1, a2, ..., an)` | Performs all of the actions `a1` to `an` in order; the return value of `an` is used as the final return.
| `IgnoreResult(a)` | Performs action `a` but ignores its return value. Useful when the mock returns void but you want to call a callable returning a value.
| `WithArg<N>(a)` | Passes the N-th argument of the mock function to action `a` and performs it.
| `WithArgs<N1, N2, ..., Nk>(a)` | Passes the selected arguments to the inner action `a`.
| `WithoutArgs(a)` | Invokes action `a` without passing any arguments.

### Notes
- The first `n-1` actions in `DoAll` must return `void`.
- Inner actions passed to `WithArg` and `WithArgs` do not need to be `Invoke()` actions, but can be any valid action.
- Repeated or reordered arguments are supported in `WithArgs`.


### Example

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoAll(SetArgPointee<0>(10), Return(true)));

EXPECT_CALL(mock, Bar(_, _))
    .WillOnce(WithArg<1>(Invoke(&helper, &Helper::DoWork)));

EXPECT_CALL(mock, Baz(_, _, _))
    .WillOnce(WithArgs<2, 0>(Invoke(DoSomething)));

EXPECT_CALL(mock, Qux(_))
    .WillOnce(WithoutArgs(Return(5)));
```


## Defining Custom Actions

When built-in actions are not sufficient, GoogleMock supports defining actions with:

- `ACTION` family macros for convenient inline definitions.
- Custom classes implementing `ActionInterface<F>`.
- Polymorphic actions via `MakePolymorphicAction()`.
- `ACTION_TEMPLATE` macro for actions with explicit template parameters.


### Defining an Action Using `ACTION` Macros

`ACTION` and its variants define actions with an action body and optional parameters.

```cpp
// Simple action returning the sum of arg0 and arg1
ACTION(Sum) {
  return arg0 + arg1;
}

// Parameterized action adding argument and parameter
ACTION_P(Plus, n) {
  return arg0 + n;
}
```

Use these in expectations:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(Sum());
EXPECT_CALL(mock, Bar(_))
    .WillOnce(Plus(10));
```

> These macros must be defined in namespace or global scope, not inside classes or functions.


### Defining a New Monomorphic Action

For precise control, implement `ActionInterface<F>`, where `F` is the mocked function's type.

```cpp
template <typename F>
class ActionInterface {
 public:
  virtual ~ActionInterface();
  virtual ReturnType Perform(const std::tuple<Arguments...>& args) = 0;
};
```

Wrap your implementation with `MakeAction` and use it in expectations.


### Defining a New Polymorphic Action

To create actions usable with different function types, define a class with a templated `Perform`:

```cpp
class ReturnSecondArgumentAction {
 public:
  template <typename Result, typename ArgumentTuple>
  Result Perform(const ArgumentTuple& args) {
    return std::get<1>(args);
  }
};

PolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() {
  return MakePolymorphicAction(ReturnSecondArgumentAction());
}
```

Use this like any other action:

```cpp
EXPECT_CALL(mock, Foo).WillOnce(ReturnSecondArgument());
```


### Defining an Action Template

When the action requires explicit template parameters, use `ACTION_TEMPLATE`:

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(std::get<k>(args));
}
```

Invoke with:

```cpp
EXPECT_CALL(mock, Foo(_, _)).WillOnce(DuplicateArg<1, unsigned char>(&output));
```


## Practical Tips & Best Practices

- Use `ReturnRef()` if your mock method returns a reference.
- Use `DoAll()` to chain side effects and a return value.
- Use `IgnoreResult()` when invoking actions returning values in void-returning mocks.
- When passing arguments to callables inside `InvokeArgument<N>()`, use `std::ref()` to pass by reference.
- Use `WithArg` / `WithArgs` / `WithoutArgs` to adapt arguments passed to inner actions.
- `DoDefault()` respects the `ON_CALL()` default if set; otherwise uses built-in defaults.

---

For detailed API usage, patterns, and more examples, see the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html).


---

## Sample Code Snippet: Using `InvokeArgument` with a Callable Argument

```cpp
using ::testing::InvokeArgument;
EXPECT_CALL(mock, RegisterCallback(_))
    .WillOnce(InvokeArgument<0>(5, std::ref(someObject)));
```

This will invoke the 0-th argument of the mock function (which must be a callable), passing `5` and a reference to `someObject`.


## Troubleshooting

- **Unreferenced parameter warnings**: GoogleMock may warn about unused parameters in actions defined with `ACTION*` macros; these can be safely ignored or suppressed via compiler pragmas.
- **`DoDefault()` in composites**: Using `DoDefault()` inside `DoAll()` or composite actions leads to runtime errors.
- **Reference return types**: Use `ReturnRef()` to return references; using `Return()` may cause copies and unexpected behavior.
- **Copyable values in actions**: Actions like `SetArgPointee()` store copies of values; ensure your types support copying.
- **Action argument mismatches**: If an action expects fewer arguments than the mock method, use `WithArgs` or `WithArg` to adapt.


---

## Summary

This page covers defining and using built-in and custom actions in GoogleMock, focusing on how to specify behaviors when mock methods are called. It provides guidance for:

- Returning specific values, references, or new objects.
- Creating side effects, such as modifying arguments or setting system state.
- Invoking functions, methods, functors, and lambdas with or without arguments.
- Composing multiple actions and adapting arguments passed to nested actions.
- Writing custom actions using macros, classes, and templates.

Practical tips, code snippets, and common pitfalls are included to help users effectively control mock behavior and create expressive tests.

---

<AccordionGroup title="Key Action Types">
<Accordion title="Value Returning Actions">
Includes `Return()`, `ReturnRef()`, `ReturnNew()`, `ReturnPointee()`, and round-robin return patterns.
</Accordion>
<Accordion title="Side Effect Actions">
Includes `Assign()`, `SetArgPointee()`, `DeleteArg()`, `SetArrayArgument()`, and similar ways to modify arguments or external state.
</Accordion>
<Accordion title="Callable Invocation Actions">
Actions such as `Invoke()`, `InvokeWithoutArgs()`, and `InvokeArgument<N>()` allow invoking functions, methods, or callable arguments passed to mocks.
</Accordion>
<Accordion title="Composite Actions">
`DoAll()`, `IgnoreResult()`, `WithArg<N>()`, `WithArgs<N1, N2, ...>()`, and `WithoutArgs()` enable complex composed behaviors.
</Accordion>
<Accordion title="Custom Actions">
Macro-based `ACTION*` definitions, implementing `ActionInterface<F>`, polymorphic actions, and action templates.
</Accordion>
</AccordionGroup>

<Check>
Remember: always specify expectations before exercising your mocks, and be mindful of the difference between type-based and run-time value conversions in actions like `Return()`.
</Check>

---