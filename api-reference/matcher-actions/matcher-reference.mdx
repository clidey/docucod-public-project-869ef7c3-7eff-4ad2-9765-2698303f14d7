---
title: "Matchers"
description: "A detailed catalogue of built-in matchers for GoogleTest and GoogleMock, including equality, containment, string, floating-point, and user-defined matchers. Examples show when and how to use each matcher for maximally clear assertions."
---

# Matchers

A detailed catalogue of built-in matchers for GoogleTest and GoogleMock, including equality, containment, string, floating-point, and user-defined matchers. Examples show when and how to use each matcher for maximally clear assertions.

---

## Overview

Matchers are the heart of GoogleMock's expressive and powerful verification system. They allow you to specify precise conditions on the arguments your mock methods receive, enabling readable, maintainable, and concise test conditions.

Each matcher is designed to match a single argument (or value) and can be used inside `EXPECT_CALL()`, `ON_CALL()`, or directly with `EXPECT_THAT()` and `ASSERT_THAT()` assertions.

This page catalogs the built-in matchers available and illustrates how to use and extend them effectively.

---

## Matcher Categories

Matchers fall into several key categories, each addressing common user scenarios.

### 1. Wildcard Matchers

These match any argument of the appropriate type:

- `_` — Matches any argument of the correct type.
- `A<type>()` or `An<type>()` — Matches any argument of type `type`.

### 2. Generic Comparison Matchers

The simplest and most common matchers, checking that the argument satisfies a comparison:

- `Eq(value)` or `value` — Matches arguments equal to `value`.
- `Ne(value)` — Matches arguments not equal to `value`.
- `Ge(value)`, `Gt(value)`, `Le(value)`, `Lt(value)` — Greater or less than comparisons.
- `IsTrue()`, `IsFalse()` — Matches if argument evaluates logically true/false.
- `Ref(variable)` — Matches arguments that reference the given variable.

#### Example:
```cpp
EXPECT_CALL(mock_obj, DoThis(Ge(5)));  // Argument must be >= 5
EXPECT_THAT(x, IsTrue());               // x must evaluate to true
EXPECT_CALL(mock_obj, Foo(Ref(bar)));  // Argument must be a reference to variable bar
```

### 3. Floating-Point Matchers

Matchers specially designed to compare floating-point values accounting for approximation and NaN values:

- `DoubleEq(expected)` and `FloatEq(expected)` — Matches floating-point values approximately equal to `expected` based on ULPs.
- `NanSensitiveDoubleEq(expected)` and `NanSensitiveFloatEq(expected)` — Same equality, but treat two NaNs as equal.
- `DoubleNear(expected, max_abs_error)` and `FloatNear(expected, max_abs_error)` — Matches within an absolute error bound.

These ensure floating-point comparisons are robust and express intent clearly.

### 4. String Matchers

Specialized matchers for C-style and C++ strings, including wide strings where supported:

- `StrEq(string)` and `StrNe(string)` — Exact equality or inequality.
- `StrCaseEq(string)` and `StrCaseNe(string)` — Case-insensitive equality or inequality.
- `HasSubstr(substring)` — Matches strings containing the substring.
- `StartsWith(prefix)` and `EndsWith(suffix)` — Matches strings with specified prefix or suffix.
- `IsEmpty()` — Checks if string is empty.
- `WhenBase64Unescaped(matcher)` — Matches strings that, when Base64 decoded, match a nested matcher.
- `MatchesRegex(regex)` and `ContainsRegex(regex)` — Matches strings fully or partially matching a regex.

#### Example:
```cpp
EXPECT_THAT(message, StartsWith("Hello"));
EXPECT_THAT(username, StrCaseEq("admin"));
EXPECT_THAT(payload, WhenBase64Unescaped(HasSubstr("secret")));
```

### 5. Container Matchers

Matchers to check STL-style containers or native arrays, useful for verifying contents, ordering, and sizes:

- `Contains(element_or_matcher)` — Container contains at least one matching element.
- `Contains(element_or_matcher).Times(n)` — Number of matching elements equals `n`.
- `Each(element_or_matcher)` — Every element matches.
- `ElementsAre(...)` and `ElementsAreArray(container_or_array)` — Matches container elements in order.
- `UnorderedElementsAre(...)` and `UnorderedElementsAreArray(...)` — Matches container elements ignoring order.
- `IsEmpty()` — Container is empty.
- `IsSubsetOf(...)` and `IsSupersetOf(...)` — Container is subset or superset of expected elements.
- `Pointwise(tuple_matcher, container)` — Verifies elements paired positionally satisfy a 2-tuple matcher.
- `UnorderedPointwise(...)` — Like Pointwise but order-independent.
- `SizeIs(matcher)` — Matches container based on size.
- `BeginEndDistanceIs(matcher)` — Matches container if the distance between `begin()` and `end()` satisfies matcher.
- `ContainerEq(container)` — Like `Eq(container)` but provides detailed error messages.

#### Example:
```cpp
EXPECT_THAT(vec, ElementsAre(1, Gt(0), _, 5));
EXPECT_THAT(set, Contains(Ge(10)));
EXPECT_THAT(map, UnorderedElementsAre(Pair("key", 42)));
EXPECT_THAT(vec, SizeIs(Lt(5)));
```

### 6. Pointer Matchers

Helpers to verify pointers and objects they point to:

- `IsNull()` / `NotNull()` — Checks pointer nullness.
- `Pointee(matcher)` — Pointer points to a value matching `matcher`. Works for raw and smart pointers.
- `Pointer(matcher)` — Pointer itself matches inner matcher.
- `Address(matcher)` — Checks address of the object matches.
- `WhenDynamicCastTo<T>(matcher)` — Matches if dynamic_cast to `T` succeeds and matches the inner matcher.

### 7. Member Matchers

Focus on verifying members or properties of objects passed:

- `Field(&Class::member, matcher)` — Matches objects where member variable matches inner matcher.
- `Field(name, &Class::member, matcher)` — Same with better error messages.
- `Property(&Class::method, matcher)` — Matches objects where method() return matches.
- `Property(name, &Class::m, matcher)` — Same with better error messages.
- `Key(matcher)` — Matches std::pair or map elements by the first (key) member.
- `Pair(matcher_for_first, matcher_for_second)` — Matches std::pair with both members matched.
- `FieldsAre(matcher...)` — Matches structured bindings or tuples piecewise.

### 8. Multi-argument Matchers

Matchers designed to verify multiple arguments as a unit through tuples:

- `Eq()`, `Ne()`, `Gt()`, `Ge()`, `Lt()`, `Le()` — Binary tuple comparators.
- `AllArgs(matcher)` — Equivalent to matcher of full argument tuple.
- `Args<indices...>(matcher)` — Match a selected subset of arguments as tuple.

### 9. Composite and Adapter Matchers

You can compose or adapt matchers to build complex logic:

- `AllOf(m1, m2, ...)` — Matches if all matchers match.
- `AllOfArray(container_of_matchers)` — Like AllOf but from a container.
- `AnyOf(m1, m2, ...)` — Matches if any matcher matches.
- `AnyOfArray(container_of_matchers)`
- `Not(matcher)` — Negates matcher.
- `Conditional(condition, matcher_true, matcher_false)` — Matches true or false matcher depending on `condition`.
- `MatcherCast<Type>(matcher)` — Cast matcher to another type unsafely.
- `SafeMatcherCast<Type>(matcher)` — Safe matcher cast with compile-time checks.
- `Truly(predicate)` — Turns a predicate function or functor into a matcher.
- `Matches(matcher)` — Turns a matcher into a predicate functor.

### 10. User-Defined Matchers

GoogleMock supports writing your own custom matchers:

- Using `MATCHER(name, description) { ... }` to write matchers conveniently.
- Using `MATCHER_P` and others to write parameterized matchers.
- Writing polymorphic and monomorphic matchers by implementing interfaces.

Example:
```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

### 11. Informative Failure Messages

Matchers can stream additional contextual information upon match success or failure to help diagnose test failures, enhancing clarity.

---

## Using Matchers in Tests

Matchers are frequently used with mock methods in `EXPECT_CALL` or in assertions via `EXPECT_THAT`.

### Example usage with mock methods:
```cpp
EXPECT_CALL(mock_obj, Compute(Eq(5), NotNull()));
EXPECT_CALL(mock_obj, Process(HasSubstr("abc")));
```

### Example usage with assertions:
```cpp
EXPECT_THAT(result, AllOf(Ge(0), Le(100)));
ASSERT_THAT(name_str, StartsWith("User_"));
```

---

## Tips and Best Practices

- **Explicit Argument Types:** Use `TypedEq<T>()` if matching overloaded method arguments to disambiguate.
- **Safety in Matcher Casts:** Prefer `SafeMatcherCast<T>()` over `MatcherCast<T>()` to prevent risky type conversions.
- **Composing Matchers:** Combine matchers logically using `AllOf()`, `AnyOf()`, and `Not()` for expressing complex conditions elegantly.
- **Validating Members:** Use `Field()` or `Property()` to check specific fields or properties inside complex objects rather than matching the whole object.
- **Matching Containers:** Use container matchers and nested matchers (e.g., `ElementsAre()`, `Contains()`) for checking collections clearly.
- **Readable Failure Messages:** Provide custom messages or add more info with `result_listener` in user-defined matchers to improve debugging.

---

## Troubleshooting Common Pitfalls

- **Unmatched Overloads:** When mocking overloaded functions, specify argument types explicitly or use `Const()`.
- **Incorrect Matcher Types:** Compile errors often indicate type mismatches; use `SafeMatcherCast` or explicitly typed matchers.
- **Uninteresting Calls Warnings:** Use `NiceMock<>` to suppress or add broad expectations with `_` matcher.
- **Floating-point Comparisons:** Avoid exact equality for floats; use `DoubleNear()` or `FloatEq()`.
- **Null Pointer Checks:** To avoid null pointer dereferencing, use `Pointee()` combined with `NotNull()` if necessary.

---

## Extending Matchers with `MATCHER` Macros

GoogleMock facilitates custom matcher creation with the `MATCHER` macros for rapid prototyping.

### Creating a simple matcher:
```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
```

### Parameterized matcher:
```cpp
MATCHER_P(IsDivisibleBy, divisor, "") {
  if (arg % divisor == 0) {
    return true;
  }
  *result_listener << "which has remainder " << (arg % divisor);
  return false;
}
```

### Using the matcher:
```cpp
EXPECT_THAT(value, IsDivisibleBy(3));
```

### Custom failure messages:
You can customize failure descriptions by providing a string expression that uses `negation` and parameters.

---

## Illustrative Code Examples

<CodeGroup>
```cpp
// Example: Using the Eq matcher
EXPECT_CALL(mock, SetValue(Eq(42)));
```
```python
# Python usage is not applicable for gMock C++ matcher concepts
```
```javascript
// JavaScript usage is not applicable for gMock C++ matcher concepts
```
</CodeGroup>

<CodeGroup>
```cpp
// Example: Matching container elements
EXPECT_CALL(mock, ProcessItems(ElementsAre(1, Gt(5), _)));

// Using Field matcher to match a member
EXPECT_THAT(foo, Field(&Foo::size, Ge(10)));
```
```python
# Python usage is not applicable
```
```javascript
// JavaScript usage is not applicable
```
</CodeGroup>

---

## References & Further Reading

- [Matchers Reference](docs/reference/matchers.md) — Detailed description of all matchers.
- [gMock Cookbook: Writing New Matchers Quickly](docs/gmock_cook_book.md#NewMatchers) — Step-by-step on custom matcher creation.
- [Mocking Reference](docs/reference/mocking.md#Matchers) — How to use matchers in the mocking framework.
- [Assertions Reference](docs/reference/assertions.md#EXPECT_THAT) — Using matchers in test assertions.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly introduction.

---

## Summary

Matchers empower precise argument validation by offering expressive, composable predicates over function parameters and values. This page catalogs the built-in matchers across categories such as equality, string matching, container validation, pointer checks, and floating-point comparison. It also guides users on creating custom matchers for bespoke needs, ensuring informative failure messages and easing test maintainability.

