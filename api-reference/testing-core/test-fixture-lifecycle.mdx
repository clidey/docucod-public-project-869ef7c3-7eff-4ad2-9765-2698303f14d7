---
title: "Test Cases and Fixtures"
description: "Details the creation and structuring of test cases and test fixtures in GoogleTest. Learn to define, initialize, and tear down environments efficiently for consistent, maintainable testing. Task-driven walkthroughs clarify when and how to use fixtures for real-world projects."
---

# Test Cases and Fixtures in GoogleTest

GoogleTest provides a powerful and flexible framework for writing C++ tests, allowing you to define individual test cases and organize them efficiently using test fixtures. This page details how to create, structure, and manage test cases and test fixtures, enabling you to write clean, maintainable tests with consistent setup and teardown workflows.

---

## Understanding Test Cases and Fixtures

### What is a Test Case?
A *test case* in GoogleTest represents a single test function checking a specific behavior or property of the code under test. Test cases are grouped logically in *test suites* (formerly called "test cases" in older versions) to organize related tests.

### The Role of Test Fixtures
Test fixtures allow multiple tests to share common setup and teardown code, reducing duplication and ensuring consistent test environments. Think of a fixture as a reusable context where multiple tests can operate on the same initial state or shared objects.

By employing fixtures, GoogleTest ensures **isolated tests** with fresh data in each test run, improving reliability and debuggability.

---

## Writing Simple Tests

The most basic test declaration uses the `TEST` macro, defining a test case without shared setup:

```cpp
TEST(TestSuiteName, TestName) {
  // Test code and assertions here
  EXPECT_EQ(Factorial(0), 1);
}
```

- **TestSuiteName** groups related tests.
- **TestName** uniquely identifies the test within the suite.

**Tips:**
- Avoid underscores (`_`) in test names; they can interfere with internal naming and cause compilation issues.
- Use descriptive names reflecting the behavior tested.

---

## Using Test Fixtures for Shared Setup

When multiple tests need to work with the same data or configuration, define a test fixture class by:

1. Deriving from `testing::Test`.
2. Declaring data members or helper functions.
3. Implementing `SetUp()` and/or `TearDown()` for per-test initialization and cleanup.
4. Optionally implementing static `SetUpTestSuite()` and `TearDownTestSuite()` for shared resources setup and teardown once per suite.

Example fixture for testing a `Queue` class:

```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    // Initialize queues
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  // Queues used in tests
  Queue<int> q0_;
  Queue<int> q1_;
  Queue<int> q2_;
};
```

Use the `TEST_F` macro to write tests using this fixture:

```cpp
TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q0_.Dequeue();
  EXPECT_EQ(n, nullptr);

  n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  EXPECT_EQ(q1_.size(), 0);
  delete n;

  n = q2_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 2);
  EXPECT_EQ(q2_.size(), 1);
  delete n;
}
```

**User Flow:**
- GoogleTest constructs a fresh `QueueTest` object for each test.
- Calls `SetUp()` (implicitly called via constructor or overridden).
- Runs the test body.
- Calls `TearDown()`.
- Deletes the fixture.

This isolation guarantees tests do not interfere with each other's state.

---

## Fixture Setup and Teardown Details

GoogleTest provides three levels of setup/teardown mechanisms:

| Level              | Methods                      | When Called                         |
|--------------------|------------------------------|-----------------------------------|
| Per-Test           | `SetUp()`, `TearDown()`      | Before and after each test         |
| Per-Test-Suite     | `SetUpTestSuite()`, `TearDownTestSuite()` | Before first and after last test in suite |
| Global Environment | `Environment::SetUp()`, `Environment::TearDown()` | Before/after all tests in program      |

### Choosing Between Constructor/Destructor vs SetUp()/TearDown()

- Prefer constructors/destructors for simple initialization without test failures.
- Use `SetUp()`/`TearDown()` when initialization or cleanup could fail or requires assertions.
- GoogleTest runs `SetUp()` before each test and `TearDown()` after each test.

### Example of Per-Test-Suite Fixture Setup

```cpp
class FooTest : public testing::Test {
 protected:
  static void SetUpTestSuite() {
    shared_resource_ = new ExpensiveResource();
  }

  static void TearDownTestSuite() {
    delete shared_resource_;
    shared_resource_ = nullptr;
  }

  void SetUp() override { ... }
  void TearDown() override { ... }

  static ExpensiveResource* shared_resource_;
};

ExpensiveResource* FooTest::shared_resource_ = nullptr;

TEST_F(FooTest, ExampleTest) {
  EXPECT_TRUE(shared_resource_->IsReady());
}
```

---

## Global Test Environments

Beyond test suite fixtures, GoogleTest also supports *global test environments* via the `testing::Environment` class. This is useful for setting up shared resources used across multiple test suites, e.g., initializing database connections or global configuration:

```cpp
class GlobalEnv : public testing::Environment {
 public:
  void SetUp() override {
    // Initialize global resources
  }
  void TearDown() override {
    // Cleanup global resources
  }
};

testing::Environment* const env = testing::AddGlobalTestEnvironment(new GlobalEnv);
```

**When Running Tests:**
- Global environments' `SetUp()` methods are called before any tests run.
- The tests then execute.
- Finally, `TearDown()` is called in reverse order after all tests finish.

**Important:**
- Don't delete the environment objects yourself; GoogleTest owns them.
- Setup and teardown only happen if there is at least one test to run.

---

## Summary of Test Fixture Usage

| Concept        | GoogleTest API       | Usage Scenario                                   |
|----------------|---------------------|------------------------------------------------|
| Simple test    | `TEST()`            | Tests requiring no shared context                |
| Fixture test   | `TEST_F()`          | Tests with shared per-test objects and setup     |
| Per-suite setup| `SetUpTestSuite()`  | Expensive shared resources across multiple tests |
| Global env     | `Environment`        | Setup/teardown once per test program              |

---

## Practical Best Practices

- **Isolate Tests:** Each test should run on a fresh fixture instance, avoiding side effects.
- **Prefer `EXPECT_*` over `ASSERT_*`:** Unless the test logically cannot continue after a failure, use non-fatal assertions to detect multiple issues at once.
- **Call `RUN_ALL_TESTS()` once:** It triggers running all registered tests and must return a status code indicating success/failure.
- **Avoid underscores in test and suite names:** This preserves internal consistency and better integration.
- **Use `SetUp()`/`TearDown()` for cases where assertions are needed during initialization or cleanup.**

---

## Troubleshooting Common Issues

- **No default constructor error when using `TEST_F`:** 
  Your test fixture must have a public default constructor. Define one explicitly if you have other constructors.

- **Test name collisions:** 
  Ensure test suite and test names are unique and don't include underscores.

- **Fixture setup not running:** 
  Confirm correctly overriding `SetUp()` (capital `U`!), not `Setup()`.

- **Global tests not running:**
  Make sure to add environments before calling `RUN_ALL_TESTS()`.

- **Fatal assertions not stopping test execution:**
  Fatal failures abort only the current function, not the entire test. Use `ASSERT_NO_FATAL_FAILURE` or check `HasFatalFailure()` to manage control flow.

---

## How Tests Run Internally

Every time you run a test:

1. GoogleTest creates a new test fixture instance.
2. Calls `SetUpTestSuite()` once before the first test in the suite (if defined).
3. Calls the fixture's constructor.
4. Calls `SetUp()`.
5. Executes the test body.
6. Calls `TearDown()`.
7. Calls the fixture's destructor.
8. Calls `TearDownTestSuite()` once after the last test in the suite (if defined).

This guarantees fresh state for every test while allowing expensive shared setup across tests.

---

## Example: Full Fixture Usage

```cpp
class QueueTest : public testing::Test {
 protected:
  static void SetUpTestSuite() {
    // Allocate expensive shared resources
    global_queue_ = new Queue<int>();
  }

  static void TearDownTestSuite() {
    // Clean up
    delete global_queue_;
    global_queue_ = nullptr;
  }

  void SetUp() override {
    // Prepare fresh state for each test
    local_queue_ = Queue<int>();
  }

  void TearDown() override {
    // Cleanup per-test resources if needed
  }

  Queue<int> local_queue_;
  static Queue<int>* global_queue_;
};

Queue<int>* QueueTest::global_queue_ = nullptr;

TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(local_queue_.size(), 0);
}

TEST_F(QueueTest, EnqueueWorks) {
  local_queue_.Enqueue(42);
  EXPECT_EQ(local_queue_.size(), 1);
}
```

With this pattern, your tests benefit from efficiency and clarity.

---

For complete details and advanced use cases, visit GoogleTest's [Testing Reference](https://github.com/google/googletest/blob/main/docs/reference/testing.md) and the [GoogleTest Primer](primer.md).

---