---
title: "Framework Initialization and Main Entrypoints"
description: "Shows how the test frameworks are initialized and invoked, including standard and platform-specific main entry points, custom main functions, and guidance for embedded and Windows environments. Useful for users customizing the test runner or integrating with build tools."
---

# Framework Initialization and Main Entrypoints

This document explains how to correctly initialize and invoke the GoogleTest and GoogleMock frameworks within your test executables. It covers the standard `main()` functions provided, how to customize initialization when needed, and platform-specific considerations for embedded and Windows environments. This knowledge is essential for users aiming to customize the test runner behavior or integrate GoogleTest more tightly into complex build or runtime environments.

---

## Overview

GoogleTest and GoogleMock provide default implementations of the `main()` function to simplify running your tests. Most users **do not** need to provide their own `main()` function; linking with the provided libraries suffices. However, when you need to perform custom setup, handle command-line flags differently, or integrate testing into specialized environments, writing your own `main()` function and initializing the framework manually becomes necessary.

This page details:

- The default main entry points (`gtest_main` and `gmock_main`)
- How to write a custom `main()`
- Platform-specific entry point nuances, especially for embedded platforms and Windows

---

## Default Main Entrypoints

### Linking with Provided Main Functions

GoogleTest offers two standard libraries that define `main()`:

- `gtest_main`: Provides a `main()` function that initializes GoogleTest and runs all tests.
- `gmock_main`: Extends `gtest_main` by additionally initializing GoogleMock along with GoogleTest.

By linking your test executable with either `gtest_main` or `gmock_main`, you benefit from:

- Automatic parsing of command-line flags relevant to the frameworks
- Calling the necessary initialization routines
- Running all registered tests
- Returning the aggregate test result status code

This approach is the most convenient for typical use cases.

### Sample Program Startup Flow with `gmock_main`

```c++
// The following main() is defined within the gmock_main library
int main(int argc, char** argv) {
  std::cout << "Running main() from gmock_main.cc\n";

  // Initialize GoogleMock and GoogleTest with command-line args
  testing::InitGoogleMock(&argc, argv);

  // Run all tests, returning 0 on success or 1 on failure
  return RUN_ALL_TESTS();
}
```

This default `main()` is platform-aware and adjusts for various environments as discussed below.

---

## Writing a Custom main() Function

If your testing scenario requires customized setup before running tests, you must write your own `main()`. This enables you to:

- Initialize other libraries or perform global setup
- Process additional command-line arguments
- Customize GoogleTest flag parsing
- Integrate with different build tools or test harnesses

### Essential Components of a Custom main()

1. **Initialize flags and the test framework** 

   Call `testing::InitGoogleTest(&argc, argv);` for GoogleTest or `testing::InitGoogleMock(&argc, argv);` if you also use GoogleMock.

   This function removes framework-specific flags from `argv` and sets up the library accordingly.

2. **Invoke test execution**

   Run `RUN_ALL_TESTS()` which executes all registered tests and returns zero if all pass.

3. **Return the test status code**

   Your `main()` must return the result of `RUN_ALL_TESTS()` to conform with test infrastructure requirements.

### Basic Example

```c++
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Example Using GoogleMock

```c++
#include <gmock/gmock.h>

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Notes

- The initialization **must** occur *before* calling `RUN_ALL_TESTS()`.
- The call to `InitGoogleTest` or `InitGoogleMock` parses relevant flags and removes them from the argument list, allowing you to process remaining user-defined flags if needed.
- Do not call `RUN_ALL_TESTS()` more than once.

---

## Platform-Specific Considerations

### Embedded/Arduino-style Platforms

On microcontroller or embedded systems (e.g., ESP8266, ESP32, NRF52 with Arduino), the traditional `main()` is replaced by `setup()` and `loop()` functions:

```c++
void setup() {
  testing::InitGoogleTest(); // or InitGoogleMock()
}

void loop() {
  RUN_ALL_TESTS();
}
```

- Initialization occurs during `setup()`
- Tests run continuously or once during `loop()` depending on system design

### Windows Mobile and Unicode

- On Windows Mobile, the entry point uses `_tmain` with `TCHAR` instead of `char`.
- GoogleTest and GoogleMock provide compatibility for wide string (Unicode) arguments.

Example for Windows Mobile:

```c++
#ifdef GTEST_OS_WINDOWS_MOBILE
#include <tchar.h>

int _tmain(int argc, TCHAR** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
#endif
```

### Other Normal Platforms (Linux, Windows Desktop, macOS)

- Standard `main(int argc, char** argv)` entry point
- Initialization and test running as demonstrated above

---

## Behind the Scenes: Initialization Flow

When you call `testing::InitGoogleTest()` or `testing::InitGoogleMock()`, the following occurs:

1. **Flag parsing:** Recognizes and removes framework-specific command-line flags (e.g., `--gtest_filter`, `--gmock_verbose`).
2. **Test registry population:** GoogleTest registers all compiled tests and suites.
3. **Environment setup:** Prepares global state and resources needed for running tests.
4. **GoogleMock setup:** Initializes GoogleMock-specific flags and resources if applicable.

This ensures seamless test discovery and execution.

---

## Troubleshooting Tips

<Tip>
If your tests are not running or the output differs from expected:

- Confirm your executable links against `gtest_main` or `gmock_main` if you don't define `main()`.
- If using a custom `main()`, ensure `InitGoogleTest` or `InitGoogleMock` is called before `RUN_ALL_TESTS()`.
- Make sure to return the result of `RUN_ALL_TESTS()` from your `main()`.
- For embedded platforms, confirm the use of `setup()`/`loop()` functions instead of `main()`.
- Check that command-line flags are correctly passed and recognized by the testing framework.
</Tip>

---

## Summary

- **Default main()** implementations in `gtest_main` and `gmock_main` handle initialization and test execution automatically.
- **Custom main()** functions allow pre-test setup and manual control over initialization.
- **Platform-specific adaptations** support embedded environments, Windows Unicode, and mobile platforms.
- Proper initialization ensures all tests run with flag support and consistent reporting.


---

## References and Additional Reading

- [Getting Started Guide](/overview/quickstart-integration/getting-started): Learn how to write and run tests with GoogleTest
- [Integration with Build Systems](/overview/quickstart-integration/integration-options): How to link and include GoogleTest libraries
- [Mocking Core API](/api-reference/core-apis/mocking-core): For tests using GoogleMock alongside GoogleTest
- [Writing Your First Test](/guides/getting-started/writing-your-first-test): Beginner-friendly test creation
- [Common Installation & Configuration Issues](/getting-started/setup-troubleshooting/common-issues): Troubleshooting setup problems


---

## Diagram: Test Initialization and Execution Flow

```mermaid
flowchart TD
  Start([Program Start]) -->|Invoke main()| Init["Call InitGoogleTest() or InitGoogleMock()"]
  Init --> FlagParse["Parse and strip GoogleTest/GoogleMock flags"]
  FlagParse --> Register["Register all compiled tests"]
  Register --> SetupEnv["Setup global test environment"]
  SetupEnv --> RunTests["Run RUN_ALL_TESTS() to execute all tests"]
  RunTests --> Collect["Collect and report results"]
  Collect --> End([Process Exit with test status code])

  subgraph Embedded Platform
  ESPInit["Initialize in setup()"]
  ESPLoop["Run tests in loop()"]
  End
  end

  %% Platform decision
  Start -->|Embedded| ESPInit
  ESPInit --> ESPLoop
  ESPLoop --> Collect
  
  %% Style
  classDef critical fill:#f96,stroke:#333,stroke-width:2px;
  Init,RunTests critical;
```
