---
title: "Portability and Configuration APIs"
description: "Documents macros and configuration hooks for adapting GoogleTest and GoogleMock to various platforms and compilers. Offers reference for customizing feature detection, platform flags, logging, synchronization, and other low-level internals as relevant for advanced integration scenarios."
---

# Portability and Configuration APIs

This page documents the macros and configuration hooks designed to adapt GoogleTest and GoogleMock to various platforms and compilers. It serves as a reference for customizing platform feature detection, platform flags, logging implementation, synchronization primitives, and other low-level internals essential for advanced integration and portability scenarios.

---

## Overview

GoogleTest and GoogleMock are designed to run across diverse environments and compiler setups. To achieve this, a set of macros and configuration points are provided to customize their internal behavior without altering core user-facing APIs.

This document focuses exclusively on those portability and configuration mechanisms, helping advanced users tailor the framework for specific platforms, compilers, or particular system capabilities.

---

## Environment Detection Macros

GoogleTest uses a comprehensive automatic detection strategy to determine platform and feature availability. However, you can override these options explicitly to ensure compatibility with your environment.

### Platform Macros

GoogleTest defines macros for the supported operating systems. Each is defined to `1` if applicable or is left undefined if not detected, for example:

- `GTEST_OS_WINDOWS`
- `GTEST_OS_LINUX`
- `GTEST_OS_MAC`
- `GTEST_OS_ANDROID`
- `GTEST_OS_CYGWIN`

**Note:** These macros are **only** defined internally and should not be set manually outside exceptional circumstances.

### Feature Support Macros

You can control or query support for key features like:

- `GTEST_HAS_PTHREAD` — Whether pthread is available and used.
- `GTEST_HAS_EXCEPTIONS` — Whether exception handling is enabled.
- `GTEST_HAS_RTTI` — Whether runtime type information (RTTI) is available.
- `GTEST_HAS_POSIX_RE` — Whether POSIX regular expressions are supported.
- `GTEST_HAS_FILE_SYSTEM` — Indicates whether a file system is available.
- `GTEST_HAS_DEATH_TEST` — Whether death tests are supported.

Overriding any of these can be done by defining the macro to `1` or `0` before including GoogleTest headers.

---

## Logging and Error Checking

GoogleTest provides macros for logging and assertions that can be customized through these macros:

- `GTEST_LOG_(severity)` — Logging macro for levels INFO, WARNING, ERROR, and FATAL.
- `GTEST_CHECK_(condition)` — Checks a condition and aborts with a fatal log if false.

Additionally, methods `LogToStderr()` and `FlushInfoLog()` can be overridden to redirect or control log flushing behavior.

### Example

```cpp
// Default logging illustrative usage
GTEST_LOG_(INFO) << "Starting test...";

// Checking conditions
GTEST_CHECK_(ptr != nullptr);
```

---

## Threading and Synchronization

Thread-safety is important for running tests in parallel or for certain death test implementations. GoogleTest provides internal synchronization primitives but also allows overriding these operations.

### Key Macros and Classes

- `GTEST_HAS_MUTEX_AND_THREAD_LOCAL_` — Defined if synchronization primitives and thread-local storage are provided externally. If defined, you must supply:
  - `GTEST_DECLARE_STATIC_MUTEX_(mutex)`
  - `GTEST_DEFINE_STATIC_MUTEX_(mutex)`

- `Mutex`, `MutexLock` — Classes that manage mutual exclusion.

- `ThreadLocal<T>` — Template to offer thread-local variable storage abstraction.

- `Notification` — Used internally to pause threads until notified.

If these macros are not set, GoogleTest will provide default implementations based on pthread or Windows threading primitives, or fall back to no-op versions on platforms without threading support.

### Thread Count Utility

- `GetThreadCount()` — Returns the number of threads currently running in the process or zero if unsupported.

---

## Flag Declaration and Access

GoogleMock (and GoogleTest) defines several runtime flags for configuration and debugging. The following macros help declare and define flags for use by the system and tests:

- `GMOCK_DECLARE_bool_(name)` / `GMOCK_DEFINE_bool_(name, default_val, doc)` — Declare and define boolean flags.
- `GMOCK_DECLARE_int32_(name)` / `GMOCK_DEFINE_int32_(name, default_val, doc)` — Integer flags.
- `GMOCK_DECLARE_string_(name)` / `GMOCK_DEFINE_string_(name, default_val, doc)` — String flags.

To access flags safely, use:

- `GMOCK_FLAG_GET(name)` — Retrieves the value.
- `GMOCK_FLAG_SET(name, value)` — Sets the value.

Flags can use either Abseil flags or GoogleTest’s built-in flag mechanism depending on the build configuration.

### Example

```cpp
// Declaring a flag
GMOCK_DEFINE_bool_(verbose, false, "Enable verbose output")

// Accessing a flag
if (GMOCK_FLAG_GET(verbose)) {
  std::cout << "Verbose enabled" << std::endl;
}
```

---

## Platform-Specific Utilities

Several platform-specific functions are abstracted to provide consistent behavior.

For example, the posix namespace wraps filesystem and IO function calls:

- `posix::FOpen()` opens a file, handling Windows unicode paths.
- `posix::Stat()`, `posix::RmDir()` abstract file/directory handling.
- `posix::IsATTY()` checks if a file descriptor is a terminal.
- `posix::GetEnv()` reads environment variables with embedded platform accommodations.

Embedding these platform differences provides portability across Windows, Linux, Mac, embedded platforms, and others.

---

## Compiler and Build Configuration Hooks

GoogleTest’s build system and internal macros enable fine-grained tuning:

- `GTEST_API_` macro marks symbols needing export for shared library builds.
- Macros like `GTEST_HAS_SEH` indicate compiler features such as Structured Exception Handling.
- Attributes such as `GTEST_NO_INLINE_`, `GTEST_NO_TAIL_CALL_` provide compiler-specific optimizations or behavior controls.
- Flags such as `GTEST_CREATE_SHARED_LIBRARY` and `GTEST_LINKED_AS_SHARED_LIBRARY` manage DLL build and usage.
- Compiler warning suppression macros for MSVC and Clang prevent build noise.

The CMake build scripts (`googletest/cmake/internal_utils.cmake`) reflect these configurations and provide an interface to adjust compilation flags, threading support, and library types.

---

## Customization and Extension Points

GoogleTest and GoogleMock include designated places for user-provided custom configurations:

- Custom headers such as `gtest/internal/custom/gtest-port.h` and `gmock/internal/custom/gmock-port.h` enable overriding platform detection, flag implementations, threading primitives, and logging.

Users typically place these in their project to inject platform-specific behavior or tailor GoogleTest’s internal implementation without patching the core source.

---

## Troubleshooting and Best Practices

- When porting to new or embedded platforms, confirm the correct setting or overriding of feature detection macros such as `GTEST_HAS_PTHREAD`, `GTEST_HAS_DEATH_TEST`, and platform macros.
- Use the flag declaration macros to define custom flags if you extend GoogleMock.
- Ensure thread-local and mutex implementations match your platform’s threading model when overriding `GTEST_HAS_MUTEX_AND_THREAD_LOCAL_`.
- Leverage the posix namespace functions for consistent file and environment operations.
- Enable and properly configure the logging macros for debugging complex test scenarios.

---

## Additional References

- For framework initialization and main entry points, see the [Framework Initialization and Main Entrypoints](/api-reference/platform-configuration/framework-initialization) page.
- For mocking core APIs and defining mock behavior, consult the [Mocking Fundamentals](/api-reference/core-apis/mocking-core) documentation.
- For configuring your project with GoogleTest, the [Configuring Your Project guide](/getting-started/configuration-quickstart/configure-project) offers practical onboarding.
- For extending or overriding platform-specific behavior, see the [Customization Points](googletest/include/gtest/internal/custom/README.md) and [GoogleMock Customization Points](googlemock/include/gmock/internal/custom/README.md).

---

## Example: Accessing GoogleMock Flags

Here is a snippet illustrating how to get and set GoogleMock flags programmatically:

```cpp
#include <iostream>
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  // Access verbose flag
  std::string verbose_level = GMOCK_FLAG_GET(verbose);
  std::cout << "GoogleMock verbose level: " << verbose_level << std::endl;

  // Set flag at runtime
  GMOCK_FLAG_SET(verbose, "info");

  std::cout << "Verbose level updated to: " << GMOCK_FLAG_GET(verbose) << std::endl;

  return 0;
}
```

This flexibility allows runtime tuning of GoogleMock behaviors via its flags.

---

## Summary

This API reference page covers the foundational portability and configuration macros for GoogleTest and GoogleMock. It provides vital mechanisms for platform detection, threading support, logging customization, and flag management that make the framework adaptable across diverse environments.

By leveraging these interfaces, advanced users and integrators can smoothly adapt GoogleTest/Mock to novel or constrained platforms, enforce consistent behaviors, and integrate runtime configuration hooks.

---