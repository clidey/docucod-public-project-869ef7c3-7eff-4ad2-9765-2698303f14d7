---
title: "Argument Matchers"
description: "A concentrated guide on the powerful matcher APIs for validating mock method call arguments in expressive, flexible ways. Includes built-in matchers, composing custom matchers, and usage within expectations."
---

# Argument Matchers

A concentrated guide on the powerful matcher APIs for validating mock method call arguments in expressive, flexible ways. This page focuses specifically on built-in matchers, composing custom matchers, and how matchers are used within mock method expectations in GoogleMock.

---

## Overview

Argument matchers allow you to specify the expectations on the arguments with which mock methods are called. They are central to creating meaningful and accurate mock interactions that both verify correct API usage and influence mock method behavior.

Matchers serve as predicates describing which arguments are considered a match for a mock call. They are used in `EXPECT_CALL` and `ON_CALL` statements to enforce expectations and define default or specific behaviors.

This page guides you through the most widely used built-in matchers, techniques for composing matchers, and the syntax to use them effectively within your tests.

---

## Built-In Matchers

GoogleMock provides a rich set of built-in matchers that cover the majority of common scenarios. These matchers are in the `::testing` namespace and can be used standalone or as building blocks for more complex conditions.

### Wildcard Matchers

- `_`: Matches any value of the correct type. The ultimate wildcard to express indifference.
- `A<T>()` or `An<T>()`: Matches any value of the given type `T`.

### Generic Comparison Matchers

| Matcher            | Meaning                                      |
|--------------------|----------------------------------------------|
| `Eq(value)` or `value` | Matches if argument == value.              |
| `Ne(value)`         | Matches if argument != value.                 |
| `Lt(value)`         | Matches if argument < value.                  |
| `Le(value)`         | Matches if argument <= value.                 |
| `Gt(value)`         | Matches if argument > value.                  |
| `Ge(value)`         | Matches if argument >= value.                 |
| `IsTrue()`          | Matches if argument evaluates to true.       |
| `IsFalse()`         | Matches if argument evaluates to false.      |
| `DistanceFrom(target, m)` | Matches if the distance between argument and target matches matcher `m`. |

### Pointer and Reference Matchers

- `IsNull()`: Matches any null pointer (raw or smart).
- `NotNull()`: Matches any non-null pointer.
- `Ref(variable)`: Matches an argument that references the given variable.
- `Pointee(m)`: Matches pointers that point to values matching matcher `m`.
- `Pointer(m)`: Matches pointers themselves against matcher `m`.
- `Address(m)`: Matches objects whose address matches `m`.
- `WhenDynamicCastTo<T>(m)`: For pointer or reference arguments, matches after dynamic_cast to type T if successful.

### String Matchers

- `StrEq(s)`: Case-sensitive equality.
- `StrNe(s)`: Case-sensitive inequality.
- `StrCaseEq(s)`: Equality ignoring case.
- `StrCaseNe(s)`: Inequality ignoring case.
- `StartsWith(prefix)`: Matches if argument starts with prefix.
- `EndsWith(suffix)`: Matches if argument ends with suffix.
- `HasSubstr(substr)`: Matches if argument contains substring.
- `IsEmpty()`: Matches empty strings.
- `ContainsRegex(regex)`: Matches strings that contain a regex.
- `MatchesRegex(regex)`: Matches strings that exactly match a regex.
- `WhenBase64Unescaped(m)`: Matches base64 unescaped string matching `m`.

### Container Matchers

- `ElementsAre(...)`: Matches a container whose elements exactly match the given sequence of matchers.
- `UnorderedElementsAre(...)`: Matches a container with elements matching matchers in any order.
- `ElementsAreArray(...)`: Like `ElementsAre` but taking an array or container.
- `UnorderedElementsAreArray(...)`: Like `UnorderedElementsAre` with arrays or containers.
- `Contains(m)`: Matches containers containing at least one element matching `m`.
- `Each(m)`: Matches containers where every element matches `m`.
- `SizeIs(m)`: Matches containers with a size that matches `m`.
- `IsSubsetOf(...)`: Matches containers that are subsets of expected matchers.
- `IsSupersetOf(...)`: Matches containers that are supersets of expected matchers.
- `Pointwise(m, container)`: Matches a container element-wise against another container through a 2-tuple matcher `m`.
- `UnorderedPointwise(m, container)`: Like `Pointwise` but ignoring element order.
- `WhenSorted(m)`: Matches containers whose sorted contents match `m`.
- `WhenSortedBy(comparator, m)`: Same as above but with a custom comparator.

### Multi-Argument Matchers

- `AllArgs(m)`: A syntactic sugar alias that equals `m`.
- `Args<N1, N2, ..., Nk>(m)`: Matches the tuple of selected arguments with matcher `m`.
- Tuple matchers such as `Eq()`, `Ne()`, `Lt()`, etc. can be used to match argument tuples.

### Composite Matchers

- `AllOf(m1, m2, ..., mn)`: Matches if the argument satisfies all matchers.
- `AnyOf(m1, m2, ..., mn)`: Matches if the argument satisfies any matcher.
- `Not(m)`: Matches if the argument does not satisfy matcher `m`.
- `Conditional(cond, m1, m2)`: Matches `m1` if `cond` is true; `m2` otherwise.

---

## Composing Matchers

Matchers can be composed to express rich constraints concisely and readably.

### Combining Matchers

Use combinators like `AllOf()`, `AnyOf()` and `Not()` to build complex matchers:

```cpp
EXPECT_CALL(foo, DoThis(AllOf(Gt(5), Ne(10))));
EXPECT_CALL(bar, DoThat(AnyOf(StrEq("hello"), StrEq("world"))));
EXPECT_CALL(baz, Get(_)).WillOnce(Return(NotNull()));
```

### Member and Property Matchers

Match specific fields or properties of arguments using `Field()` and `Property()`:

```cpp
EXPECT_CALL(mock, Foo(Field(&MyClass::bar, Ge(3))));
EXPECT_CALL(mock, Foo(Property(&MyClass::baz, StartsWith("John"))));
```

### Using `MatcherCast` and `SafeMatcherCast`

To resolve matcher type mismatches, you can cast matchers:

```cpp
EXPECT_CALL(mock, DoThis(SafeMatcherCast<Derived*>(base_ptr_matcher)));
```
`SafeMatcherCast<T>` only compiles when the cast is safe.

---

## Using Matchers with `EXPECT_CALL` and `ON_CALL`

Matchers are placed within the parentheses of `EXPECT_CALL` or `ON_CALL` to specify argument constraints:

```cpp
using ::testing::_;
using ::testing::Gt;
using ::testing::Return;

EXPECT_CALL(mock, DoSomething(Gt(5)))
    .WillOnce(Return(true));

ON_CALL(mock, ComputeValue(_))
    .WillByDefault(Return(42));
```

### Using `.With()` Clause

You can restrict expectations to calls matching a multi-argument matcher of the entire parameter tuple:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // First argument is less than second
```

### Order of Matcher Clauses

Modifiers must be used in specific order inside `EXPECT_CALL`:

```plaintext
EXPECT_CALL(mock, method(args...))
    .With(...)
    .Times(...)
    .InSequence(...)
    .After(...)
    .WillOnce(...)
    .WillRepeatedly(...)
    .RetiresOnSaturation();
```

Each clause has usage constraints, such as `.With()` can appear at most once and must be first.

---

## Defining Custom Matchers

Custom matchers express domain-specific conditions in an expressive way.

### Using `MATCHER` Macros

Easy to define matchers using macros:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

### Parameterized Matchers

Use parameterized macros to pass parameters:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}

EXPECT_THAT(some_value, HasAbsoluteValue(10));
```

### Writing Matcher Classes

For finer control, implement matcher interface classes with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods.

---

## Practical Tips & Best Practices

- Use `_` for arguments where you don't care about value.
- Use `ON_CALL` to specify mock behaviors without imposing call count constraints.
- Use `EXPECT_CALL` to set expectations and verify call counts and argument matches.
- To ignore uninteresting calls and suppress warnings, use `NiceMock`.
- To enforce strict verification and flag any uninteresting calls as failures, use `StrictMock`.
- Prefer composing matchers over writing complex predicate functions.
- Avoid side effects in matchers as gMock may invoke them multiple times or out of order.

---

## Common Pitfalls

- Omitting `EXPECT_CALL` for calls you want to verify leads to warnings or unverified behavior.
- Over-constraining tests with too many expectations can cause brittleness.
- Misusing `Return()` with move-only types in recurring calls will cause errors.
- Forgetting to wrap comma-containing types in parentheses in `MOCK_METHOD` declarations causes compilation errors.
- Attempting to mock overloaded methods without disambiguation results in compilation errors.

---

## Example Usage

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (int x));
};

using ::testing::Return;
using ::testing::Gt;

TEST(FooTest, ComputeReturnsExpected) {
  MockFoo mock;

  EXPECT_CALL(mock, Compute(Gt(5)))
      .WillOnce(Return(10));

  int result = mock.Compute(7);
  EXPECT_EQ(result, 10);
}
```

```cpp
using ::testing::_;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Ne;

EXPECT_CALL(mock, Method(AllOf(Gt(10), Ne(15))));  // Argument > 10 and != 15
```

---

## Advanced Topics

You can create custom composite matchers from existing matchers and write polymorphic matchers for generic use.

You can also match complex argument tuples using the `.With()` clause and multi-argument matchers like `AllArgs()` and `Args<>` to specify match conditions on subsets or reordered arguments.

Additionally, you can leverage matchers in assertions outside mock expectations with `EXPECT_THAT` and `ASSERT_THAT` for readable and expressive test validation.

---

## Troubleshooting

- **Compilation errors when using `MOCK_METHOD`**: Ensure parameters with commas are enclosed in parentheses or use type aliases.
- **Warnings on uninteresting calls**: Use `NiceMock` or add catch-all expectations with `_` and `Times(AnyNumber())`.
- **Unexpected call errors**: Verify arguments and sequence orders; check for missing or mismatched expectations.
- **Move-only types in mocks**: Use lambdas or callable objects rather than `Return()` actions for repeated calls.

For more comprehensive debugging, run tests with `--gmock_verbose=info` to see detailed mock call matching logs.

---

## Related Documentation

- [Mocking Reference](/docs/reference/mocking.md): Full details on creating mocks and setting expectations.
- [Matchers Reference](/docs/reference/matchers.md): Complete list of built-in matchers and examples.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes for effective mocking.
- [Using Assertions with Matchers](/api-reference/core-testing-apis/assertions-results.md#EXPECT_THAT): For integrating matchers in your tests.
- [Core Concepts Glossary](/overview/architecture-concepts/core-concepts-glossary.md): Foundational concepts for test structure.

---

## Source Code

For the in-depth implementation and tests illustrating argument matchers, see:

- [gmock-spec-builders.h](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-spec-builders.h)
- [gmock-matchers.h](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-matchers.h)
- [gmock-matchers_test.cc](https://github.com/google/googletest/blob/main/googlemock/test/gmock-matchers-comparisons_test.cc)
- [gmock-matchers_test.h](https://github.com/google/googletest/blob/main/googlemock/test/gmock-matchers_test.h)

---

This documentation provides the essential knowledge to harness GoogleMock's argument matchers effectively â€” enabling you to write robust, expressive, and maintainable tests that precisely specify expected mock interactions.