---
title: "Argument Matchers"
description: "Comprehensive guide to built-in and custom argument matchers for verifying call arguments. Includes practical matcher combinations and usage examples."
---

# Argument Matchers

This documentation focuses on the argument matchers provided by GoogleMock, enabling expressive and precise verification of mock method call arguments. Matchers allow you to specify what arguments are expected in mock method calls, how they should be matched, and help generate informative error messages when expectations are not met.

---

## Overview

A **matcher** operates on a *single* argument, testing if it satisfies specific criteria. You use them inside `ON_CALL()` or `EXPECT_CALL()` statements to control mock method behavior and expectations, or directly to validate values in assertions using `EXPECT_THAT()` or `ASSERT_THAT()`.


| Macro                           | Purpose                                 |
| -------------------------------|-----------------------------------------|
| `EXPECT_THAT(value, matcher)`  | Asserts `value` matches `matcher`.     |
| `ASSERT_THAT(value, matcher)`  | Fatal assertion version of above.       |


### Basic Usage Example

```cpp
using ::testing::Eq;

EXPECT_CALL(mock_object, DoSomething(Eq(5)));  // Expect argument equals 5
EXPECT_THAT(actual_value, Eq(expected_value)); // Check values with matcher
```

---

## Wildcard Matchers

| Matcher         | Description                                |
| --------------- | ------------------------------------------|
| `_`             | Matches any value of the correct type.    |
| `A<type>()` or `An<type>()` | Matches any value of the specified type. |

Use `_` inside `EXPECT_CALL` to ignore argument values when you don't care about them.

```cpp
EXPECT_CALL(mock, Foo(_, _)); // Expect Foo with any two arguments
```

---

## Generic Comparison Matchers

| Matcher             | Meaning                                  |
| --------------------|------------------------------------------|
| `Eq(value)` or `value` | Checks if argument is equal to `value`. |
| `Ne(value)`          | Argument not equal to `value`.            |
| `Ge(value)`          | Argument greater or equal to `value`.    |
| `Gt(value)`          | Argument greater than `value`.            |
| `Le(value)`          | Argument less or equal to `value`.       |
| `Lt(value)`          | Argument less than `value`.               |
| `IsTrue()`           | Argument evaluates to true.               |
| `IsFalse()`          | Argument evaluates to false.              |
| `IsNull()`           | Argument is a null pointer.                |
| `NotNull()`          | Argument is a non-null pointer.            |
| `Optional(m)`        | Argument is an `optional<>` with value matching `m`. |
| `VariantWith<T>(m)`  | Argument is a `variant<>` holding alternative `T` with value matching `m`. |
| `Ref(variable)`      | Argument is a reference to the variable passed. |
| `TypedEq<type>(value)` | Argument is precisely of type `type` and equal to `value`. Useful for overload disambiguation. |

Note:
- Use `Ref()` when you want to match an argument by reference.
- For types without copy constructors, wrap with `std::ref()` to avoid copies.

### Example

```cpp
EXPECT_CALL(mock, Process(Ne(0), Ge(10)));
EXPECT_CALL(mock, SetPointer(IsNull()));
```

---

## Floating Point Matchers

GoogleMock provides matchers for approximate equality of floating-point types:

| Matcher                      | Meaning                                                   |
|-----------------------------|-----------------------------------------------------------|
| `DoubleEq(a_double)`        | Argument double approximately equals `a_double` (NaNs unequal). |
| `FloatEq(a_float)`          | Argument float approximately equals `a_float` (NaNs unequal).   |
| `NanSensitiveDoubleEq(a_double)` | Argument double approximately equals including NaNs equal.   |
| `NanSensitiveFloatEq(a_float)`   | Argument float approximately equals including NaNs equal.    |
| `DoubleNear(a_double, max_abs_error)` | Argument double within a max absolute error, NaNs unequal. |
| `FloatNear(a_float, max_abs_error)`   | Argument float within a max absolute error, NaNs unequal.  |
| `NanSensitiveDoubleNear(a_double, max_abs_error)` | Argument double within error, NaNs equal.        |
| `NanSensitiveFloatNear(a_float, max_abs_error)`   | Argument float within error, NaNs equal.         |
| `IsNan()`                   | Argument is NaN of any floating-point type.               |

Example:

```cpp
EXPECT_CALL(mock, Compute(FloatNear(3.14f, 0.01f)));
```

---

## String Matchers

Matchers for C strings or C++ string types:

| Matcher           | Description                                           |
|-------------------|-------------------------------------------------------|
| `ContainsRegex(string)` | Argument matches given regex.                       |
| `MatchesRegex(string)`  | Matches given regex for entire input (full match).  |
| `HasSubstr(string)`     | Argument contains substring.                         |
| `StartsWith(prefix)`    | Argument starts with prefix.                         |
| `EndsWith(suffix)`      | Argument ends with suffix.                           |
| `StrEq(string)`         | Argument equals string exactly.                      |
| `StrNe(string)`         | Argument does not equal string.                      |
| `StrCaseEq(string)`     | Equals string case-insensitive.                      |
| `StrCaseNe(string)`     | Not equals string case-insensitive.                  |
| `IsEmpty()`             | Argument is an empty string.                          |
| `WhenBase64Unescaped(m)`| Argument base64-decoded string matches matcher `m`. |

Example:

```cpp
EXPECT_CALL(mock, Log(HasSubstr("error")));
EXPECT_THAT(name, StartsWith("John"));
```

---

## Container Matchers

Useful when matching STL-style containers or native arrays passed to mock methods.

| Matcher                  | Meaning                                                |
|--------------------------|--------------------------------------------------------|
| `IsEmpty()`              | Container is empty.                                    |
| `SizeIs(m)`              | Container size matches matcher `m` (e.g. `SizeIs(3)`).|
| `BeginEndDistanceIs(m)`  | Distance between `begin()` and `end()` matches `m`.  |
| `ElementsAre(e0, ...)`   | Container has exactly the listed elements in order.   |
| `ElementsAreArray(...)`  | Like `ElementsAre`, but from array or container.       |
| `UnorderedElementsAre(...)` | Like `ElementsAre`, order ignored.                   |
| `UnorderedElementsAreArray(...)` | Like `UnorderedElementsAre`, from array/container.  |
| `Contains(e)`            | Container contains at least one element matching `e`. |
| `Contains(e).Times(n)`   | Container contains exactly `n` elements matching `e`. |
| `Each(e)`                | All elements match matcher `e`.                        |
| `IsSubsetOf(...)`        | Container is subset of matchers (unordered).          |
| `IsSupersetOf(...)`      | Container is superset of matchers (unordered).        |
| `Pointwise(m, container)`| Container elements match pairs in order with `m`.    |
| `UnorderedPointwise(m, container)` | Container elements match pairs unordered.          |
| `WhenSorted(m)`          | Container sorted with `<` matches `m`.                 |
| `WhenSortedBy(comp, m)`  | Container sorted with `comp` matches `m`.              |

Examples:

```cpp
EXPECT_CALL(mock, ProcessData(ElementsAre(1, 2, 3)));
EXPECT_CALL(mock, ProcessData(UnorderedElementsAre(3, 1, 2)));
EXPECT_THAT(container, Each(Ge(0)));
EXPECT_THAT(container, SizeIs(Lt(5)));
```

---

## Member Matchers

Matchers for validation of object members:

| Matcher                                 | Description                      |
|-----------------------------------------|---------------------------------|
| `Field(&class::field, m)`                | Matches member variable against matcher `m`. Supports pointers. |
| `Field(field_name, &class::field, m)`   | Same as above but improves error messages by naming field.      |
| `Property(&class::property, m)`          | Matches return value of const getter member function with `m`.  |
| `Property(property_name, &class::property, m)` | Same as above with property name for messages.          |
| `Key(e)`                                | Matches `.first` field of pair with `e`.                      |
| `Pair(m1, m2)`                         | Matches `.first` and `.second` fields of pair with `m1`, `m2` respectively. |

Example:

```cpp
EXPECT_CALL(mock, Process(Field(&Foo::id, Eq(5))));
EXPECT_CALL(mock, Process(Property(&Foo::name, StartsWith("J"))));
EXPECT_THAT(map_var, Contains(Key(Ge(10))));
EXPECT_THAT(map_var, ElementsAre(Pair(1, "foo")));
```

---

## Multi-argument Matchers

Sometimes, you want to match several arguments together as a tuple.

| Matcher         | Description                                           |
|-----------------|-------------------------------------------------------|
| `AllArgs(m)`    | Equivalent to `m`. Used for clarity inside `.With()`. |
| `Args<N1,...,Nk>(m)` | Matches the tuple of selected arguments against matcher `m`. |

Example:

```cpp
EXPECT_CALL(mock, Range(Ne(0), _))
    .With(Lt());  // First arg less than second arg
EXPECT_CALL(mock, Cmd)
    .With(AllArgs(Le()));  // All arguments less or equal
EXPECT_CALL(mock, Cmd)
    .With(Args<0, 2>(Ge()));  // Logical relation on 1st and 3rd arg
```

---

## Composite Matchers

Combine multiple matchers into logical expressions.

| Matcher                  | Description                            |
|--------------------------|--------------------------------------|
| `AllOf(m1, m2, ..., mn)` | Match if all `mi` match.              |
| `AnyOf(m1, m2, ..., mn)` | Match if any `mi` matches.            |
| `Not(m)`                 | Match if `m` does not match.          |
| `Conditional(cond, m1, m2)` | Match `m1` if `cond` is true, else `m2`. |

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(1), Le(10))));
EXPECT_CALL(mock, Foo(Not(Eq(5))));
```

---

## Adapters and Casting

### SafeMatcherCast<T>(m)

Cast matcher `m` to type `Matcher<T>` safely, ensuring argument types are compatible and conversions are lossless for arithmetic types.

### MatcherCast<T>(m)

Less restrictive cast based on `static_cast`; do not misuse.

### Matches(m)

Use matcher `m` as a predicate functor in STL-like algorithms.

```cpp
const auto count = std::count_if(vec.begin(), vec.end(), Matches(Ge(10)));
```

---

## Custom Matchers

You can define your own matchers to test custom conditions or parameterize matchers. See the [gMock Cookbook - Writing New Matchers](gmock_cook_book.md#NewMatchers).

```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

For parameterized matchers:

```cpp
MATCHER_P(IsBetween, range, "") {
  return arg >= range.first && arg <= range.second;
}
EXPECT_CALL(mock, Foo(IsBetween(std::make_pair(1, 10))));
```

---

## Examples

### Simple Expectation on Argument

```cpp
EXPECT_CALL(mock, SetValue(Eq(42)));
```

### Any Value

```cpp
EXPECT_CALL(mock, Process(_));
```

### Multiple Argument Matching

```cpp
EXPECT_CALL(mock, MoveTo(Ge(0), Le(100)));
```

### Matching Container Elements

```cpp
EXPECT_CALL(mock, ProcessData(ElementsAre(1, 2, 3)));
```

### Matching Member Variables

```cpp
EXPECT_CALL(mock, Log(Field(&LogEntry::level, Eq(WARNING))));
```

### Matching Composite Conditions

```cpp
EXPECT_CALL(mock, Compute(AllOf(Ge(1), Lt(100))));
```

### Using Multi-argument Matcher

```cpp
EXPECT_CALL(mock, SetRange(_, _)).With(Le()); // The tuple of args is <=
```

---

## Tips and Best Practices

- Use `_` for arguments you don't care about to reduce test brittleness.
- Use `With()` carefully to express constraints on entire tuples of arguments.
- To avoid surprises, always disambiguate overloaded methods using explicit matchers or `Const()` wrapper.
- Use `SafeMatcherCast<T>()` when type conversions are necessary.
- Combine matchers with `AllOf()`, `AnyOf()`, and `Not()` for expressive conditions.
- For containers, prefer `ElementsAre()` for ordered checks and `UnorderedElementsAre()` for unordered.
- For pointer arguments, use `Pointee()` to verify the pointed-to value safely.
- Use custom matchers to encapsulate complex or domain-specific matching logic.

---

## Troubleshooting

- If you accidentally specify `WillOnce()` or `.With()` multiple times where only one is allowed, gMock will report errors — ensure clauses used at most once are correctly applied.
- Omit `Times()` to allow gMock to infer call cardinality based on actions; explicit `Times()` overrides this.
- Unmatched arguments in calls are detailed in error messages, including which argument failed to match.
- `RetiresOnSaturation()` can be used to make expectations inactive as soon as the call count reaches the specified cardinality.
- For overloaded methods, ambiguous calls lead to compilation failure; disambiguate using explicit parameter matchers or `Const()`.
- For move-only types, prefer lambdas or callable objects instead of `Return()` to generate fresh objects per call.

---

For detailed coverage of matchers, see the [Matchers Reference](reference/matchers.md) and for usage examples consult the [gMock for Dummies](docs/gmock_for_dummies.md) and [gMock Cookbook](docs/gmock_cook_book.md).

---

## Related Pages

- [Mocking Reference](docs/reference/mocking.md)
- [Mock Class and Method Macros](api-reference/mocking-matching-actions/mock-class-macros.md)
- [Expectations, Calls, and Cardinalities](api-reference/mocking-matching-actions/expectations-calls.md)
- [Actions and Return Value Control](api-reference/mocking-matching-actions/actions-and-more.md)
- [Mock Strictness and Behavior Modes](api-reference/mocking-matching-actions/mock-behaviors.md)
- [Matchers Reference](docs/reference/matchers.md)

---