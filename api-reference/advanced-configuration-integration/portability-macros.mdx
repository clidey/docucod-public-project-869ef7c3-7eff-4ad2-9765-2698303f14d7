---
title: "Platform & Compiler Portability Macros"
description: "Reference for internal macros and helpers managing compiler and OS portability, feature checks, and conditional compilation to ensure smooth integration with diverse build environments."
---

# Platform & Compiler Portability Macros

This reference details the internal macros and helper utilities within GoogleTest that ensure portability and smooth integration across diverse platforms, compilers, and build environments. These macros manage conditional compilation based on the presence of platform features, compiler capabilities, threading support, and other environment-specific attributes.

By leveraging these macros, GoogleTest adapts its behavior to various operating systems, compilers, and runtime capabilities. This ensures that testing code using GoogleTest is portable and functions consistently across systems such as Windows, Linux, macOS, Android, and embedded platforms.

---

## Overview of Portability Macros

The portability layer within GoogleTest primarily exists in the header `gtest-port.h`, which includes macros and utilities to detect environment features and platform specifics at compile time. These macros are central to enabling GoogleTest’s cross-platform behavior.

### Environment-Describing Macros

These user-configurable macros indicate the availability of various platform features. Typically, GoogleTest attempts automatic detection but users may override them as needed in build scripts.

| Macro                                  | Description                                           |
|---------------------------------------|-------------------------------------------------------|
| `GTEST_HAS_CLONE`                     | Indicates support for `clone(2)` system call (Linux). |
| `GTEST_HAS_EXCEPTIONS`                | Indicates if exceptions are enabled in the compiler.   |
| `GTEST_HAS_POSIX_RE`                  | POSIX regular expressions availability.                |
| `GTEST_HAS_PTHREAD`                   | Availability of pthreads API for threading support.    |
| `GTEST_HAS_RTTI`                     | Indicates if RTTI (RunTime Type Information) is enabled. |
| `GTEST_HAS_STD_WSTRING`               | Whether `std::wstring` is supported on the platform.   |
| `GTEST_HAS_FILE_SYSTEM`               | File system availability for file I/O support.         |
| `GTEST_HAS_SEH`                      | Support for Microsoft's Structured Exception Handling. |
| `GTEST_HAS_STREAM_REDIRECTION`       | Whether stream redirection using `dup` and `dup2` works. |
| `GTEST_LINKED_AS_SHARED_LIBRARY`     | Compile-time flag when tests link to gtest in shared mode. |
| `GTEST_CREATE_SHARED_LIBRARY`         | Compile-time flag when building gtest as a shared library. |
| `GTEST_DEFAULT_DEATH_TEST_STYLE`     | Default death test style (`fast` or `threadsafe`).      |

These macros are always defined as `1` or `0` after inclusion and should be used in conditional compilation via `#if`, never with `#ifdef`.

### Platform-Identifying Macros

GoogleTest automatically defines platform macros based on the target operating system and platform.

| Macro                          | Description                 |
| ------------------------------|-----------------------------|
| `GTEST_OS_WINDOWS`             | Generic Windows platform.   |
| `GTEST_OS_WINDOWS_DESKTOP`     | Windows desktop environment.|
| `GTEST_OS_WINDOWS_MINGW`       | MinGW environment on Windows. |
| `GTEST_OS_WINDOWS_MOBILE`      | Windows Mobile platform.    |
| `GTEST_OS_WINDOWS_PHONE`       | Windows Phone platform.     |
| `GTEST_OS_WINDOWS_RT`          | Windows Runtime environment.| 
| `GTEST_OS_LINUX`               | Linux platform.             |
| `GTEST_OS_LINUX_ANDROID`       | Android on Linux kernel.    |
| `GTEST_OS_MAC`                 | macOS platform.             |
| `GTEST_OS_IOS`                 | iOS platform.               |
| Other BSDs and UNIX variants   | (e.g., `GTEST_OS_FREEBSD`, `GTEST_OS_NETBSD`). |

Users must not define these but can query them for conditional behaviors.

### Feature-Indicating Macros

Macros indicating which test features are compiled in.

| Macro                   | Description                                   |
|-------------------------|-----------------------------------------------|
| `GTEST_HAS_DEATH_TEST`  | Support for death tests.                       |
| `GTEST_HAS_TYPED_TEST`  | Availability of typed tests.                   |
| `GTEST_HAS_TYPED_TEST_P`| Availability of type-parameterized tests.     |
| `GTEST_IS_THREADSAFE`   | GoogleTest is built with thread-safe support.|
| `GTEST_USES_RE2`        | Use of the RE2 regular expression library.     |
| `GTEST_USES_POSIX_RE`   | Use of POSIX regex.                            |
| `GTEST_USES_SIMPLE_RE`  | Use of GoogleTest’s own simple regex engine.  |
| `GTEST_HAS_ABSL`        | Built with Abseil support.                      |

### Miscellaneous Public Macros

| Macro                | Description                                    |
|----------------------|------------------------------------------------|
| `GTEST_FLAG(flag_name)` | References GoogleTest flag variables (`gtest_flag_name`). |


## Working with Compiler and Platform Detection

GoogleTest performs extensive compile-time detection of compiler features, platform types, and environment capabilities. This detection allows adapting GoogleTest to:

- Leverage exception handling if available.
- Detect threading capabilities and enable synchronization primitives accordingly.
- Use appropriate regular expression libraries.
- Handle wide string support and encoding differences (e.g., Windows UTF-16).
- Manage platform-specific system calls such as `clone(2)`, POSIX APIs, and Windows APIs.

GoogleTest mandates use of at least C++17, and enforces this with a compile-time error if a lower version is detected.

### Key Compiler Feature Checks

- Support for `__has_include`, `__has_attribute`, `__has_feature`, and `__has_cpp_attribute` is probed to tailor compilation.
- Compiler-specific warning suppression macros for MSVC and Clang are defined.
- Function attributes like `noinline` and `disable_tail_calls` are conditionally used based on compiler support.

These checks ensure GoogleTest compiles cleanly and runs correctly under different compilers.

## Threading and Synchronization

GoogleTest detects availability of threading libraries such as pthreads on Unix-like systems, and provides native abstractions for mutexes, locks, and thread-local variables accordingly.

- If `GTEST_IS_THREADSAFE` is set to 1, synchronization primitives such as `Mutex`, `MutexLock`, and `ThreadLocal<T>` behave as real synchronization objects.
- On Windows platforms, Windows native synchronization constructs are used.
- When threading is not supported, dummy implementations are provided to allow compilation but without thread safety guarantees.

Additionally, GoogleTest supports advanced threading constructs such as thread notifications and thread join utilities, essential for some test workflows.

## Regular Expressions Support

GoogleTest selects the available regular expression implementation:

- **RE2**: Used when Abseil support is enabled, providing high-performance regex.
- **POSIX Extended Regex**: Used on Unix-like systems with POSIX regex support.
- **Simple Regex**: A basic fallback regex engine provided internally by GoogleTest for platforms without POSIX or RE2.

This selection is transparent to users and is optimized for functionality and performance on the current platform.

## File System and I/O Utilities

GoogleTest abstracts file I/O and path operations:

- Portability wrappers exist to abstract differences in functions like `stat`, `fopen`, `fileno`, directory removal, etc.
- Special handling for Windows wide-character path handling using `_wfopen` is implemented.
- File I/O functions are guarded by `GTEST_HAS_FILE_SYSTEM` to allow usage on platforms without full file system support.

Standard input/output redirection and capturing are also handled conditionally using `GTEST_HAS_STREAM_REDIRECTION`.

## Usage Scenarios and Best Practices

- **Adapting GoogleTest to your platform**: Most users do not need to adjust these macros. However, in specialized or embedded environments, you can override macros such as `GTEST_HAS_PTHREAD` or feature detection macros to properly guide GoogleTest.
- **Cross-platform compatibility**: Use `#if` guards on `GTEST_OS_*` or feature macros in your test code to write portable tests that can behave differently or guard unsupported features.
- **Multi-threaded tests**: Testing on platforms where `GTEST_IS_THREADSAFE` is 1 ensures safe concurrent assertions and test execution.
- **Exceptions**: GoogleTest detects support for exceptions via `GTEST_HAS_EXCEPTIONS`; tests or mocks can conditionally compile exception-dependent code accordingly.

<Tip>
To troubleshoot platform-specific compilation or runtime issues, verify the values of these macros in your build environment using diagnostic output or static assertions.
</Tip>

## Example: Conditional Compilation Using Portability Macros

```cpp
#include "gtest/internal/gtest-port.h"

void PlatformSpecificFunction() {
#if GTEST_OS_WINDOWS
  // Windows-specific implementation.
#elif GTEST_OS_LINUX
  // Linux-specific implementation.
#else
  // Fallback implementation.
#endif

#if GTEST_HAS_PTHREAD
  // Use pthreads functionality.
#endif

#if GTEST_HAS_EXCEPTIONS
  try {
    // Code relying on exceptions.
  } catch (...) {
    // Handle exceptions.
  }
#endif
}
```

This style ensures tests and GoogleTest internals only compile and execute the correct code paths for the platform.


## Synchronization Primitives Overview

GoogleTest defines synchronization classes abstracted from platform details:

| Class / Macro           | Description                                  |
|------------------------|----------------------------------------------|
| `Mutex`                | Platform-specific mutex implementation.       |
| `MutexLock` / `GTestMutexLock` | RAII-style mutex guard.                   |
| `ThreadLocal<T>`       | Provides thread-local storage for type T.    |
| `Notification`         | Controller thread signal to start other threads.|

How these are implemented depends on `GTEST_IS_THREADSAFE` and platform.

## Internal Helper Utilities

- **`ImplicitCast_`**: Safe compile-time casting helper analogous to `static_cast` for upcasting.
- **`CheckedDowncastToActualType`**: Performs safe downcasting when RTTI is available.
- **Character utilities**: Functions like `IsXDigit`, `IsAlpha`, `ToLower`, and `ToUpper` for portable character classification.
- **File utilities**: Functions such as `GetFileSize`, `ReadEntireFile` for file introspection.
- **Command line utilities**: Functions to parse environment variables and command-line flags.

These utilities are used internally but may benefit advanced users seeking deeper customization.


## Practical Tips

* GoogleTest macros and classes related to portability are mostly internal. Users generally interact with GoogleTest APIs that rely on these under the hood.
* In embedded or constrained environments, adjusting these macros enables GoogleTest to compile and work with limited system features.
* When writing cross-platform test utilities or extensions, refer to these macros to conditionally compile code safely.
* The recommended approach to control behavior is to rely on the macros, not platform-specific preprocessor symbols.

## Troubleshooting Common Issues

* **Compilation fails due to missing platform features**: Check if the macros like `GTEST_HAS_PTHREAD` or `GTEST_HAS_EXCEPTIONS` are correctly detected or force them via compiler flags.
* **Threading issues on unsupported platform**: If `GTEST_IS_THREADSAFE` is 0, avoid tests that use multi-threading or rely on thread-local storage.
* **Unexpected regular expression behavior**: Confirm which regex engine is used (`GTEST_USES_RE2`, `GTEST_USES_POSIX_RE`, or `GTEST_USES_SIMPLE_RE`) to align your regex syntax.
* **Problems with wide strings on Windows**: Check `GTEST_WIDE_STRING_USES_UTF16_` to understand encoding assumptions.

## Related Documentation and Integration

For full integration details, environment setup, and build configuration, review:

- [Installation (Linux, macOS, Windows)](/getting-started/setup-requirements-installation/installation-multiplatform)
- [Framework Initialization and Main Entry Points](/api-reference/advanced-configuration-integration/framework-initialization)
- [Supported Platforms Overview](/overview/architecture-concepts/integration-and-platforms)

These pages provide actionable guidance on setting up GoogleTest properly with its portability features.

---

For source code details and to customize the portability macros, see the internal header:

```plaintext
https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h
```

Customizations and platform-specific overrides can be accessed via `custom/gtest-port.h`.

---

## Mermaid Diagram: Core Portability Macro Relationships

```mermaid
flowchart TD

  A[User Build System] -->|Defines Macros| B(GoogleTest Portability Macros)

  subgraph "Macro Groupings"
    B1[GTEST_HAS_* (Feature Flags)]
    B2[GTEST_OS_* (Platform Macros)]
    B3[Threading Support Macros]
    B4[Regex Engine Macros]
    B5[Synchronization Primitives]
  end

  B --> B1
  B --> B2
  B --> B3
  B --> B4
  B --> B5

  B3 -->|If pthread available| C[Pthread APIs]
  B3 -->|Else if Windows| D[Win32 APIs]
  B5 -->|Mutices etc.| E[Mutex, MutexLock, ThreadLocal]

  B4 -->|Selects| F[RE2]
  B4 -->|Selects| G[POSIX Regex]
  B4 -->|Selects| H[Simple Regex]
  
  E --> I[Test Framework]
  B1 --> I
  B2 --> I

  classDef os fill:#e3f2fd,stroke:#2196f3,color:#0d47a1;
  class B2 os;
  classDef feature fill:#fce4ec,stroke:#f06292,color:#880e4f;
  class B1 feature;

```

---