---
title: "Platform & Portability APIs"
description: "Documents macros, configuration hooks, and utilities designed to ensure GoogleTest’s compatibility with multiple compilers, platforms, and build systems. Useful for integrators and maintainers."
---

# Platform & Portability APIs

GoogleTest includes a series of macros, configuration hooks, and internal utilities designed to ensure compatibility and portability across a wide range of compilers, platforms, and build tools. This documentation covers these core platform abstraction mechanisms and customization points, essential for integrators and maintainers aiming to adapt GoogleTest to diverse environments.

---

## Overview

Platform and portability APIs are the foundation that enables GoogleTest to operate reliably across operating systems like Linux, Windows, MacOS, embedded systems, and various compiler toolchains. These APIs:

- Abstract differences in threading and synchronization primitives
- Provide macros to detect platform features and environment capabilities
- Manage cross-platform logging and error handling
- Enable customization for platform-specific behaviors

This layer protects test writers from low-level platform concerns, allowing them to focus on test logic without worrying about environment-specific quirks.


## Key Components

### Environment and Platform Macros

GoogleTest uses environment-describing macros to identify available features and platform specifics. These macros are automatically defined during compilation or can be overridden by users to control GoogleTest’s behavior.

Examples include:

- **Platform indicators:** `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, `GTEST_OS_ANDROID`, etc.
- **Feature flags:** `GTEST_HAS_PTHREAD` (thread availability), `GTEST_HAS_EXCEPTIONS`, `GTEST_HAS_RTTI`, `GTEST_HAS_FILE_SYSTEM`, and others.

These macros enable conditional compilation and guard platform-dependent code paths.

---

### Threading Support & Synchronization

GoogleTest internally abstracts synchronization using mutexes, locks, and thread-local storage, adapting to platform-specific APIs:

- On **Windows**, GoogleTest uses native Windows primitives (Critical Sections).
- On **POSIX** platforms, it relies on `pthread` mutexes and thread-local keys.
- If neither is available (e.g. single-threaded embedded targets), dummy implementations are used.

#### Mutex and Lock APIs

- `Mutex` and `MutexLock` classes provide RAII-based locking.
- Macros like `GTEST_DECLARE_STATIC_MUTEX_` and `GTEST_DEFINE_STATIC_MUTEX_` help declare and define static mutexes with proper initialization.

#### ThreadLocal Storage

- `ThreadLocal<T>` template abstracts thread-local storage for per-thread values.
- Implements via Windows TLS APIs or POSIX pthread keys depending on platform.
- Provides safe initialization and destruction of thread-local data.

These abstractions guarantee thread safety where supported and degrade gracefully otherwise.

---

### File System & I/O Abstractions

GoogleTest provides wrappers around common file and environment functions to smooth out platform differences:

- `posix::FOpen()`, `posix::Stat()`, `posix::RmDir()` etc. handle opening, checking, and removing paths/files.
- Wrapper functions normalize return values and handle Windows-specific quirks.
- Environment variables are accessed via `posix::GetEnv()` which returns `nullptr` in embedded or restricted platforms.

These utilities shield GoogleTest internals from platform-specific file system details, enabling features like test result file writing and death test support.

---

### Logging and Error Checking

To capture and represent test failures and internal assertions, GoogleTest provides:

- **Severity-based logging macros**: `GTEST_LOG_(severity)` where severity can be `INFO`, `WARNING`, `ERROR`, or `FATAL`.
- Functions `LogToStderr()` and `FlushInfoLog()` ensure logs can be redirected or flushed appropriately.
- Assert macros like `GTEST_CHECK_` abort execution on critical failures, printing detailed error messages.

These logs are uniform across platforms, helping developers debug failing tests no matter where they run.

---

### Regular Expression Usage

To enable test filtering and matching:

- GoogleTest uses **RE2**, **POSIX regex**, or its own simple regex implementation depending on platform detection.
- The **RE** class abstracts the underlying regex engine with a unified interface providing `FullMatch` and `PartialMatch`.

This abstraction lets test writers filter test execution by name or pattern transparently.

---

### Compile-Time Feature Detection & Flags

GoogleTest requires and enforces a minimum C++17 standard environment and also detects:

- Compiler-specific attributes support (e.g., `noinline`, `format`-style checking)
- Presence of exceptions, RTTI, structured exception handling (SEH) on Windows
- Thread safety capability

These are exposed via macros like `GTEST_HAS_EXCEPTIONS`, `GTEST_HAS_RTTI`, and annotations that can be customized.

Options for flags in GoogleTest can be customized/defined by users via macros or `-D` compiler flags to control logging verbosity, test behavior, etc.

---

## Customization Points

GoogleTest defines a set of macros and hooks that can be overridden to customize the behavior to your platform or integration needs. Notable macros:

- **Stack Trace Getter Customization:** Override `GTEST_OS_STACK_TRACE_GETTER_` to supply your own stack trace implementation.
- **Temp Directory Customization:** Override `GTEST_CUSTOM_TEMPDIR_FUNCTION_` to specify custom temporary directories.
- **Logging Macros:** Define `GTEST_LOG_(severity)` and `GTEST_CHECK_` macros to log in a platform-specific manner.
- **Threading Macros:** User platforms can declare whether native `Mutex` and `ThreadLocal` exist, providing corresponding declarations via `GTEST_DECLARE_STATIC_MUTEX_` and `GTEST_DEFINE_STATIC_MUTEX_`.

These extension points enable building GoogleTest for exotic environments such as embedded platforms or platforms with non-standard threading or filesystem models.

---

## Best Practices for Integration

- Always **check platform macros** (`GTEST_OS_*`, `GTEST_HAS_*`) when writing extensions to conditionally compile platform-specific code.
- Use GoogleTest's **Mutex** and **ThreadLocal** instead of platform APIs directly to ensure portability.
- Override customization macros only when you need to seamlessly integrate with your logging, file system, or stack tracing mechanisms.
- When building GoogleTest as a shared library, define `GTEST_CREATE_SHARED_LIBRARY=1` and for clients linking to it, define `GTEST_LINKED_AS_SHARED_LIBRARY=1`.
- Enforce **C++17 or newer** compliance in your build environment to avoid compatibility issues.


## Common Pitfalls & Troubleshooting

<Warning>
Overriding portability macros incorrectly or providing incompatible synchronization primitives can break thread safety and cause subtle concurrency bugs. Ensure that custom implementations strictly adhere to expected APIs.
</Warning>

<Note>
If your platform does not have a filesystem, streaming, or threading support, test features like death tests or output capturing may be unavailable or disabled by design.
</Note>

<Warning>
When cross-compiling, make sure your build environment correctly sets macros such as `GTEST_OS_WINDOWS`, `GTEST_HAS_PTHREAD`, etc., otherwise GoogleTest might misdetect capabilities.
</Warning>

---

## Example: Detecting Platform in Custom Code

```cpp
#include "gtest/internal/gtest-port.h"

#if GTEST_OS_WINDOWS
  // Windows-specific work
#elif GTEST_OS_LINUX
  // Linux-specific work
#else
  // Portable fallback code
#endif
```

## Example: Using GoogleTest Mutex

```cpp
#include "gtest/internal/gtest-port.h"

// Declare a static mutex
GTEST_DECLARE_STATIC_MUTEX_(my_mutex);

void ThreadSafeFunction() {
  GTEST_DEFINE_STATIC_MUTEX_(my_mutex);
  MutexLock lock(&my_mutex);

  // Critical section
}
```

## Example: Using ThreadLocal Variables

```cpp
static ThreadLocal<int> tls_int(0);  // Default init value 0

void SetTlsValue(int value) { tls_int.set(value); }
int GetTlsValue() { return tls_int.get(); }
```

---

## References & Related Documentation

- [Core Concepts & Terminology](/overview/core-concepts-architecture/core-concepts-terminology)
- [Integration & Extensibility](/overview/features-ecosystem/integration-and-extensibility)
- [Installing GoogleTest and GoogleMock](/getting_started/setup_requirements_install/installing_framework)
- [Test Lifecycle & Execution](/api-reference/core-testing-api/test-lifecycle-and-execution)
- [Common Installation Issues](/getting_started/troubleshooting/common_install_issues)

---

For integrators building GoogleTest for new platforms or embedding it into custom environments, understanding and properly using these portability APIs ensures robustness and maximum compatibility across diverse development scenarios.


---