---
title: "Test Macros and Fixtures"
description: "Reference for macros and classes to define unit tests and test suites, including TEST, TEST_F, and the use of test fixtures to enable shared setup and teardown logic. Highlights patterns for organizing and grouping tests for maintainability."
---

# Test Macros and Fixtures

This reference guides you through the essential macros and class-based constructs provided by GoogleTest to define, organize, and maintain unit tests and test suites. It focuses on the use of `TEST()`, `TEST_F()`, and test fixtures to enable shared setup and teardown logic across groups of tests, promoting ease of maintenance and clear test structure.

---

## Overview of Test Macros

GoogleTest provides macros that define individual tests, group related tests into suites, and enable sharing state and setup logic among tests to ensure clean, maintainable, and independent test cases.

### 1. `TEST()` — Basic Test Macro

The simplest way to define a test is with `TEST(TestSuiteName, TestName)`. This macro declares a test function:

- **Purpose:** Define individual, isolated tests without shared state.
- **Arguments:**
  - `TestSuiteName`: Groups related tests.
  - `TestName`: Identifies the specific test.

Both names should be valid C++ identifiers and should avoid underscores to prevent naming conflicts. Each `TEST()` creates a fresh test, and assertions inside determine if it passes or fails.

**Example:**
```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
}
```

This example shows a test suite named `FactorialTest` with two test cases verifying factorial results.

### Best Practices for `TEST()`

- Use it for simple, independent tests requiring no shared setup.
- Group logically related tests by using the same `TestSuiteName`.
- Avoid underscores `_` in suite and test names to prevent internal naming collisions.

---

### 2. `TEST_F()` — Tests with Fixtures

For tests requiring shared setup and teardown operations or state, GoogleTest uses *test fixtures*, which are C++ classes derived from `testing::Test`.

- **Use:** When multiple tests share complex or reusable data/setup.
- **Macro call:** `TEST_F(TestFixtureClass, TestName)`

The fixture class defines shared members, setup, and teardown methods:

**Steps to create a fixture:**

1. **Define a fixture class:**
   - Derive from `testing::Test`.
   - Place shared objects as protected members.
   - Override `SetUp()` and `TearDown()` if needed.
2. **Use `TEST_F`** to define multiple tests that use the fixture.

**Example:**
```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    // Setup shared queue state
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  Queue<int> q0_;  // empty queue
  Queue<int> q1_;  // queue with 1 element
  Queue<int> q2_;  // queue with 2 elements
};

TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q0_.Dequeue();
  EXPECT_EQ(n, nullptr);

  n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  EXPECT_EQ(q1_.size(), 0);
  delete n;

  n = q2_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 2);
  EXPECT_EQ(q2_.size(), 1);
  delete n;
}
```

**Lifecycle:** For each test in the fixture:
- GoogleTest constructs a fixture instance.
- Calls `SetUp()`.
- Runs the test function body.
- Calls `TearDown()`.
- Destroys the fixture instance.

### Tips and Best Practices for `TEST_F()` Fixtures

- Use the constructor to initialize immutable shared state and `SetUp()` for code that might fail or do runtime initialization.
- Avoid fatally failing assertions (`ASSERT_*`) in constructors or destructors; prefer `SetUp()` and `TearDown()`.
- Each test runs isolated from others via fresh fixture objects, eliminating side-effects.
- Use protected members to share common data.
- Name fixture classes following the pattern `FooTest` where `Foo` is the tested class.

---

## Organizing Tests for Maintainability

GoogleTest encourages organizing tests into suites that mirror the tested code structure. Maintaining logical groupings helps when scaling test codebases and facilitates easier debugging and navigation.

### Grouping Related Tests

- Group logically related tests within the same test suite name (`TEST` macro first argument) or fixture class (`TEST_F`).
- Tests inside a suite or fixture can share common setup and helper functions.

### Avoiding Underscores in Names

Avoid underscores in test suite and test names as these generate internal class names which can conflict or cause compiler errors due to reserved and special identifiers in C++.

### Test Isolation

Maintain independence between tests by avoiding shared mutable state outside fixtures.

---

## Using Test Fixtures for Shared Setup and Teardown Logic

Test fixtures allow grouping multiple tests that share the same configuration or need common resource setup and cleanup.

### Key Points About Fixtures

- Fixtures derive from `testing::Test`.
- They can override `SetUp()` and `TearDown()` to execute code before and after each test, respectively.
- Static methods `SetUpTestSuite()` and `TearDownTestSuite()` are available for per-suite setup/teardown, effective to share expensive resources across all tests within the suite.
- GoogleTest ensures each test gets a fresh fixture instance, preventing state leakage between tests.

### Example with Per-Suite Setup and Teardown

```cpp
class FooTest : public testing::Test {
 protected:
  static void SetUpTestSuite() {
    shared_resource_ = new HeavyResource();
  }

  static void TearDownTestSuite() {
    delete shared_resource_;
    shared_resource_ = nullptr;
  }

  void SetUp() override {
    // Per-test setup if needed
  }

  void TearDown() override {
    // Per-test cleanup
  }

  static HeavyResource* shared_resource_;
};

HeavyResource* FooTest::shared_resource_ = nullptr;

TEST_F(FooTest, Test1) {
  EXPECT_TRUE(shared_resource_->IsReady());
}

TEST_F(FooTest, Test2) {
  // shared_resource_ reused
}
```

---

## Summary

GoogleTest's test macros and fixtures offer a flexible and robust way to write, organize, and maintain tests:

- Use `TEST()` for simple, atomic, and independent unit tests.
- Use `TEST_F()` when multiple tests share common setup, state, or teardown logic implemented in a fixture class derived from `testing::Test`.
- Group your tests into meaningful suites and avoid underscores in names to ensure smooth compilation and clarity.
- Leverage per-suite setup and teardown for expensive shared resources with `SetUpTestSuite()` and `TearDownTestSuite()`.

These patterns foster scalable and maintainable test codebases while providing clear test isolation.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Issues with Test Macros and Fixtures">
<Accordion title="Compiler Errors Using `TEST_F()`"> 
Ensure your fixture class has a default constructor. If you provide a custom constructor, declare a default one as well. Check that `SetUp()` is spelled correctly (capital U) and is marked override if using C++11+.
</Accordion>
<Accordion title="Underscore in Test Names Causes Errors">
Avoid underscores in test suite and test names. They lead to internal class naming collisions and reserved identifier usage in C++. Rename test suites and tests to valid identifiers without underscores.
</Accordion>
<Accordion title="Test Results Always PASS Despite Failures">
Make sure your `main()` function returns the result of `RUN_ALL_TESTS()`. Ignoring the return value disables proper test failure reporting.
</Accordion>
<Accordion title="Shared State Leakage Between Tests">
Verify that shared state is owned properly and restored as needed. Use fixtures and fresh instances per test to avoid unintended side-effects.
</Accordion>
</AccordionGroup>

---

## Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [Assertions Reference](reference/assertions.md)
- [Testing Reference](reference/testing.md)
- [Advanced GoogleTest Topics](docs/advanced.md#same-data-multiple-tests)
- [Test Fixtures & Parameterized Testing Guide](guides/core-test-workflows/structured-fixtures-parameterized-tests)

<Source url="https://github.com/google/googletest" branch="main" paths={[{ path: "docs/primer.md", range: "64-183" }, { path: "docs/reference/testing.md", range: "132-320" }]} />