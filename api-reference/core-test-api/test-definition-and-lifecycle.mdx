---
title: "Test Definition & Lifecycle"
description: "Covers the main API for defining tests, managing test execution, and controlling the test run lifecycle. Includes core macros for declaring tests, managing fixtures, and integrating test event listeners."
---

# Test Definition & Lifecycle

GoogleTest offers a comprehensive API for defining tests, managing their execution, and controlling the overall lifecycle of test runs in C++. This page details the primary macros, classes, and utilities that define individual tests, test fixtures, parameterized tests, and test event handling.

---

## Writing and Defining Tests

At the heart of GoogleTest is the ability to write structured, maintainable tests. Tests are declared using specialized macros that generate the necessary boilerplate and register tests with the GoogleTest framework.

### TEST

```cpp
TEST(TestSuiteName, TestName) {
  ... test statements ...
}
```

- Defines a simple test named `TestName` in the suite `TestSuiteName`.
- Both names must be valid C++ identifiers without underscores.
- The test body contains the code under test along with assertions.

### TEST_F (Test Fixtures)

```cpp
TEST_F(TestFixtureName, TestName) {
  ... test statements ...
}
```

- Defines an individual test that uses a test fixture class `TestFixtureName`.
- The test suite name is the same as the fixture name.
- Fixture classes provide shared setup, teardown, and utilities for tests.
- The test body can reference fixture members and setup states.

### TEST_P (Value-Parameterized Tests)

```cpp
TEST_P(TestFixtureName, TestName) {
  ... statements, including GetParam() ...
}
```

- Defines a parameterized test variant within a fixture that inherits from `TestWithParam<T>`.
- Access the parameter via `GetParam()`.
- Requires instantiation using `INSTANTIATE_TEST_SUITE_P`.

### INSTANTIATE_TEST_SUITE_P

```cpp
INSTANTIATE_TEST_SUITE_P(InstantiationName, TestSuiteName, param_generator, name_generator_optional);
```

- Instantiates parameterized tests defined with `TEST_P`.
- `param_generator` can be one of GoogleTest's built-in generators (e.g., `Values()`, `Range()`, `Combine()`).
- Optionally provide a custom `name_generator` to generate unique test names per parameter.

### TYPED_TEST_SUITE and TYPED_TEST (Typed Tests)

- Typed tests allow running the same test logic over a fixed list of types.
- Define a fixture template parameterized by type, then associate the types with `TYPED_TEST_SUITE`.
- Write tests using `TYPED_TEST` which can access `TypeParam` as the type.

Example:

```cpp
template <typename T>
class MyTypedTest : public testing::Test {
  // Fixture setup
};
using MyTypes = ::testing::Types<int, double, char>;
TYPED_TEST_SUITE(MyTypedTest, MyTypes);

TYPED_TEST(MyTypedTest, DoesSomething) {
  TypeParam value = ...;
  EXPECT_TRUE(SomeFunction(value));
}
```

### TYPED_TEST_P and REGISTER_TYPED_TEST_SUITE_P (Type-Parameterized Tests)

- Similar to typed tests but allow defining tests without knowing types upfront.
- Register test names with `REGISTER_TYPED_TEST_SUITE_P`.
- Instantiate tests later with type lists using `INSTANTIATE_TYPED_TEST_SUITE_P`.

---

## Test Fixtures and Lifecycle Management

GoogleTest encourages reuse of common setup and teardown logic across multiple tests using fixtures.

### Test Fixtures

- A fixture is a C++ class derived from `testing::Test`.
- Provide `SetUp()` and `TearDown()` methods to prepare and clean up before and after each test.
- Per-test-suite setup/teardown can be implemented with static methods `SetUpTestSuite()` and `TearDownTestSuite()`, called once before the first and after the last test in the suite, respectively.

Example:

```cpp
class MyTestFixture : public testing::Test {
 protected:
  static void SetUpTestSuite() {
    // initialize shared expensive resources
  }
  static void TearDownTestSuite() {
    // clean up shared resources
  }
  void SetUp() override {
    // initialize per-test state
  }
  void TearDown() override {
    // clean up per-test state
  }
};
```

### Skipping Tests at Runtime

- The macro `GTEST_SKIP()` allows skipping test execution during runtime with optional messages.
- Can be used in test bodies or in `SetUp()` methods of fixtures or global environments.

---

## Test Event Listeners

GoogleTest provides an event listener API to trace and respond to test lifecycle events, enabling customization of output and integration with external tools.

### The `TestEventListener` Interface

- Receives events throughout the test program execution:
  - Test program start/end
  - Test iteration start/end
  - Environment setup/teardown
  - Test suite start/end
  - Individual test start/end
  - Test part results (assertions failures or successes)

### Common `TestEventListener` Methods

```cpp
void OnTestProgramStart(const UnitTest& unit_test);
void OnTestIterationStart(const UnitTest& unit_test, int iteration);
void OnEnvironmentsSetUpStart(const UnitTest& unit_test);
void OnTestSuiteStart(const TestSuite& test_suite);
void OnTestStart(const TestInfo& test_info);
void OnTestPartResult(const TestPartResult& test_part_result);
void OnTestEnd(const TestInfo& test_info);
void OnTestSuiteEnd(const TestSuite& test_suite);
void OnTestProgramEnd(const UnitTest& unit_test);
```

- Override only the needed methods by subclassing `EmptyTestEventListener` as a convenience.

### Using Custom Listeners

- Add a listener to the framework with:

```cpp
testing::UnitTest::GetInstance()->listeners().Append(new MyListener());
```

- Remove and delete the default printer if overriding default output:

```cpp
auto& listeners = testing::UnitTest::GetInstance()->listeners();
delete listeners.Release(listeners.default_result_printer());
listeners.Append(new MyListener());
```

---

## Utilities and Support Classes

### RegisterTest

```cpp
template <typename Factory>
TestInfo* RegisterTest(const char* test_suite_name, const char* test_name,
                       const char* type_param, const char* value_param,
                       const char* file, int line, Factory factory);
```

- Provides a way to register individual tests dynamically at runtime.
- The factory creates instances of your test fixture.
- Requires matching fixture types across tests in the same suite.
- Should be called before `RUN_ALL_TESTS()`.

### RUN_ALL_TESTS

```cpp
int RUN_ALL_TESTS();
```

- Runs all registered tests after GoogleTest is initialized.
- Returns `0` if all tests pass, `1` otherwise.
- Must be called only once, usually as the return value of `main()`.

### Getting Current Test Information

- Use `testing::UnitTest::GetInstance()->current_test_info()` to obtain a pointer to the currently executing testâ€™s information (or `nullptr` if none).
- Obtain suite name, test name, file, and line number from `TestInfo`.

---

## Best Practices and Common Pitfalls

- **No underscores in test names or suites:** To avoid clashes and undefined behavior, do not use underscores in test suite or test names.
- **Fixture consistency:** All tests in the same suite must use the same fixture class.
- **Manage shared expensive resources via `SetUpTestSuite()` and `TearDownTestSuite()` static methods.**
- **Fatal assertions abort only the current function:** Use `ASSERT_NO_FATAL_FAILURE` or exceptions to propagate fatal failures across subroutines.
- **Call `InitGoogleTest()` before `RUN_ALL_TESTS()`.**
- **Always handle the return value of `RUN_ALL_TESTS()`.**
- **Add custom event listeners for output customization or integration, remember to delete the default result printer if overriding it.**

---

## Example Flow: Writing and Running Tests

1. **Define tests:** Write `TEST`, `TEST_F`, or `TEST_P` macros for tests with or without fixtures and parameters.
2. **Initialize framework:** Call `testing::InitGoogleTest(&argc, argv);` in `main()`.
3. **Register dynamic tests (optional):** Use `RegisterTest` to add tests at runtime.
4. **Execute:** Run `RUN_ALL_TESTS();` which runs all tests in proper order.
5. **Listen to events (optional):** Attach custom `TestEventListener` to receive notifications.

---

This page serves as a gateway for the main GoogleTest API for defining and managing tests and their lifecycles. It bridges GoogleTest's high-level test writing macros with the underlying runtime mechanics such as test suite management, event notifications, and dynamic registration.

For details on assertions, mocking, parameterized tests, and advanced usage, please consult their dedicated pages.

---

**References:**
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [Assertions Reference](assertions.md)
- [Parameterized and Type-Parameterized Tests](advanced.md#value-parameterized-tests)
- [Mocking with GoogleMock](guides/core-workflows/mocking-with-gmock.md)
- [Test Event Listeners](advanced.md#extending-googletest-by-handling-test-events)

---
