---
title: "Matchers API"
description: "Documents the matcher library used to compare function arguments and results. Explains built-in matchers, composing custom matchers, and advanced usage patterns for expressive test specifications."
---

# Matchers API

This documentation details the matcher library used in GoogleMock to compare function arguments and return values during mocking. Matchers provide a powerful mechanism to specify constraints on mock method parameters, enabling expressive and readable test expectations. This page explains built-in matchers, how to compose custom matchers, advanced usage patterns, and practical tips for writing robust and maintainable test specifications.

---

## Overview of Matchers

Matchers are predicates that determine if a given value satisfies certain conditions. They enhance tests by allowing flexible yet precise argument matching when defining expectations on mocks.

- Simple literals are implicitly converted to equality matchers.
- The special matcher `_` matches any value and is useful for arguments you don't care about.
- Matchers can be combined, nested, and parameterized for complex conditions.

### Basic Usage Example

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;

// Expect the method `DoThis` to be called with argument exactly 5.
EXPECT_CALL(mock_obj, DoThis(Eq(5)));

// Using _ wildcard for any second argument.
EXPECT_CALL(mock_obj, DoThat(_, Gt(0)));
```

### Intent Behind Matchers

Matchers allow tests to focus on key argument properties, avoid over-specification, and improve resilience to implementation changes.

---

## Built-in Matchers

GoogleMock includes a comprehensive set of built-in matchers:

### Wildcard Matcher
- `_` : Matches any value of any type.

### Equality Matchers
- `Eq(value)` or simply `value` : Matches values equal to the specified value.
- `Ne(value)` : Matches values *not* equal to the specified value.

### Relational Matchers
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` : Less than, less or equal, greater than, greater or equal respectively.

### Boolean and Nullable Matchers
- `IsNull()` : Matches null pointers.
- `NotNull()` : Matches any non-null pointer.

### String Matchers
- `StrEq(string)` : Matches strings equal to specified.
- `StrNe(string)` : Matches strings not equal.
- `StrCaseEq(string)`, `StrCaseNe(string)` : Case-insensitive versions.
- `HasSubstr(substring)` : Matches strings containing the substring.
- `StartsWith(prefix)` : Matches strings starting with prefix.
- `EndsWith(suffix)` : Matches strings ending with suffix.

### Container Matchers
- `ElementsAre(e1, e2, ...)` : Matches containers with exact elements in order.
- `UnorderedElementsAre(e1, e2, ...)` : Matches containers with elements in any order.
- `ElementsAreArray(array_or_container)` : Matches containers matching array/another container exactly.
- `UnorderedElementsAreArray(array_or_container)` : Matches containers matching array/another container in any order.
- `Contains(elem_or_matcher)` : Matches containers containing an element.
- `Each(matcher)` : Matches containers where *all* elements satisfy the matcher.
- `SizeIs(size_matcher)` : Matches containers with size matching the matcher.

### Tuple and Field Matchers

- `Pair(m1, m2)` : Matches `std::pair` objects whose first and second elements match `m1` and `m2`.
- `Field(&Class::member, matcher)` : Matches an object whose member has a value matching `matcher`.
- `Property(&Class::getter_method, matcher)` : Matches an object whose getter method returns a value matching `matcher`.

### More Advanced Matchers

- `Pointee(matcher)` : Matches pointer arguments whose pointee matches `matcher`. Works with smart pointers as well.
- `ResultOf(callable, matcher)` : Matches objects mapped via `callable` to values matching `matcher`.
- `Not(matcher)` : Matches values not matching the given matcher.
- `AllOf(m1, m2, ...)` : Matches values satisfying *all* of the sub-matchers.
- `AnyOf(m1, m2, ...)` : Matches values satisfying *any* of the sub-matchers.
- `Truly(predicate)` : Uses an arbitrary unary predicate (function or functor) as matcher.

---

## Specifying Matchers in Expectations

Matchers are used with `EXPECT_CALL` or `ON_CALL` to specify which argument values to expect or to provide default behaviors.

```cpp
EXPECT_CALL(mock_obj, Func(Ge(5), _));  // First arg >= 5, second arg anything
ON_CALL(mock_obj, Func(_, Eq(10)))       // Default behavior for calls with second arg == 10
```

For methods with multiple arguments, provide a matcher for each argument.

Omitting the argument list implies all arguments are matched with `_` (only allowed for non-overloaded methods).

---

## Composing Matchers

Matchers can be combined to form expressive conditions.

### Logical combinations
- `AllOf(m1, m2, ...)` : All must match.
- `AnyOf(m1, m2, ...)` : Any must match.
- `Not(m)` : Negation.

### Matching multiple arguments as a tuple

Use `.With()` clause in `EXPECT_CALL` to match arguments collectively with a tuple matcher:

```cpp
EXPECT_CALL(mock_obj, Func(_, _))
    .With(Lt())  // Matches only calls where first arg < second arg
```

`Args<k1, k2, ...>(matcher)` matches selected arguments in order.

### Nested and Parameterized Matchers

Matchers can be nested. For example, match containers of objects whose member equals something:

```cpp
EXPECT_CALL(mock_obj, Func(ElementsAre(Field(&MyClass::id, Eq(42)))));
```

---

## Custom Matchers

While built-in matchers suffice for most cases, GoogleMock makes it straightforward to define custom matchers:

### Using the `MATCHER` macros for brevity

```cpp
MATCHER(IsEven, "checks if number is even") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(mock_obj, Func(IsEven()));
```

### Parameterized matchers

Use `MATCHER_P`, `MATCHER_P2`,... etc for matchers with parameters.

```cpp
MATCHER_P(IsDivisibleBy, divisor, "checks if divisible") {
  return (arg % divisor) == 0;
}

EXPECT_THAT(value, IsDivisibleBy(5));
```

### Writing matcher classes for full control

Define a matcher class implementing `MatchAndExplain`, `DescribeTo`, and `DescribeNegationTo` methods, then provide a factory function returning `testing::Matcher<T>`.

---

## Practical Tips and Best Practices

- Use `_` to simplify expectations when argument values don’t matter.
- Use `ON_CALL` for setting default behaviors without enforcing call expectations.
- Use `EXPECT_CALL` only to verify calls that your test cares about.
- Combine `EXPECT_CALL` with matchers to verify argument properties rather than exact values, improving test resilience.
- Use `RetiresOnSaturation()` to deactivate expectations after use, avoiding sticky expectation issues.
- Use sequences (`InSequence`) and ordering (`After`) to specify call order constraints.
- When working with overloaded methods, use `Const()` or specify overloads explicitly to avoid ambiguity.
- For move-only types, use lambdas in `WillOnce` or `WillRepeatedly` instead of `Return()`.
- Write custom matchers when you want to encapsulate complex argument validation logic.

---

## Troubleshooting

- An “uninteresting call” warning means a mock method was called without an `EXPECT_CALL` expectation. Consider using `NiceMock` to suppress such warnings if expected.
- Unexpected calls (calls not matching any existing expectation) always fail your test.
- Use the `--gmock_verbose` flag to adjust verbosity of matcher diagnostics (`info`, `warning`, `error`).
- For overloaded methods, ambiguous expectations can cause compilation errors; disambiguate using `Const()` or precise matcher types.

---

## Summary

Matchers are central to writing expressive, maintainable mock expectations in GoogleMock. Leveraging built-in matchers, composition techniques, and custom matchers empowers you to specify exactly what interactions your tests require, while providing actionable failure messages and minimizing fragile test code.

For an accelerated learning path, consider starting with the [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

---

## See Also

- [Defining and Using Mocks](api-reference/gmock-mocking-api/mock-object-definition)
- [Specifying Mock Expectations](api-reference/gmock-mocking-api/expectations-specification)
- [Actions and Side Effects](api-reference/gmock-mocking-api/mock-actions)
- [Nice, Naggy, and Strict Mocks](api-reference/gmock-mocking-api/nice-strict-mocks)
- [Core Assertions API](api-reference/gtest-core-api/core-assertions-api)

---

## Example: Using Matchers in an EXPECT_CALL

```cpp
using ::testing::_;          // Matches anything
using ::testing::Ge;         // Greater or equal
using ::testing::Contains;   // Container contains
using ::testing::Field;      // Match member variable

class Foo {
 public:
  virtual ~Foo() {}
  virtual void Bar(int n, const std::string& name, const std::vector<int>& list) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Bar, (int n, const std::string& name, const std::vector<int>& list), (override));
};

TEST(FooTest, UsesMatcher) {
  MockFoo mock;

  // Expect Bar() to be called with:
  // - first argument >= 10
  // - second argument starts with "abc"
  // - third argument contains at least one element equal to 7
  EXPECT_CALL(mock, Bar(Ge(10), StartsWith("abc"), Contains(7)));

  mock.Bar(15, "abcdef", {1, 7, 3});  // Matches
}
```

---

## Advanced Example: Custom Matcher

```cpp
MATCHER_P(IsSumEqualTo, expected_sum, "checks if sum is equal to expected") {
  return (arg.first + arg.second) == expected_sum;
}

TEST(MathTest, PairSum) {
  std::pair<int, int> p(3, 7);
  EXPECT_THAT(p, IsSumEqualTo(10));  // Succeeds
  EXPECT_THAT(p, Not(IsSumEqualTo(9)));  // Succeeds
}
```

---