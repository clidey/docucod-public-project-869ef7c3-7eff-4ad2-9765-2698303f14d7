---
title: "Matchers API"
description: "Reference of available matchers for argument and value verification, including composition and customization techniques. Enables precise and readable assertions in tests and mocks."
---

# Matchers API Reference

GoogleMock's **Matchers API** equips you with a rich suite of matchers for precise and readable argument verification in tests and mocks. Whether you want to assert specific values, verify complex conditions, or compose multiple criteria, this API lets you craft expectations that are clear, comprehensive, and maintainable.

---

## Overview

Matchers are fundamental building blocks used to match *single* function arguments or values during a test. This page details the available matchers, their usage in verifying arguments, and how to combine and customize them for powerful assertion expressions.

Matchers can be used in:

- `EXPECT_CALL(mock_object, method(matcher1, matcher2, ...))`
- `ON_CALL(mock_object, method(matcher1, matcher2, ...))`
- `EXPECT_THAT(actual_value, matcher)`

This API enables you to write expectations and assertions that behave like natural language expressions, making tests easier to read and diagnose.

---

## Basic Matchers

### Wildcard Matchers

- `_` — Matches any value of the correct type, equivalent to `A<type>()` or `An<type>()`.

Example:
```cpp
EXPECT_CALL(foo, Bar(_));  // Arguments can be anything.
```

- `A<type>()` or `An<type>()` — Matches any value of specified `type`.

Example:
```cpp
EXPECT_CALL(foo, Baz(A<int>()));  // Matches any int
```

---

### Generic Comparison Matchers

| Matcher          | Description                        | Example Usage                     |
|------------------|----------------------------------|----------------------------------|
| `Eq(value)` or `value` | Matches if argument == value           | `EXPECT_CALL(foo, Bar(Eq(5)));` or `EXPECT_CALL(foo, Bar(5));`
| `Ne(value)`      | Matches if argument != value           | `EXPECT_CALL(foo, Bar(Ne(0)));`
| `Gt(value)`      | Matches if argument > value            | `EXPECT_CALL(foo, Bar(Gt(5)));`
| `Ge(value)`      | Matches if argument >= value           | `EXPECT_CALL(foo, Bar(Ge(5)));`
| `Lt(value)`      | Matches if argument < value            | `EXPECT_CALL(foo, Bar(Lt(10)));`
| `Le(value)`      | Matches if argument <= value           | `EXPECT_CALL(foo, Bar(Le(10)));`
| `IsTrue()`       | Matches if argument evaluates to true | `EXPECT_CALL(foo, Bar(IsTrue()));`
| `IsFalse()`      | Matches if argument evaluates to false| `EXPECT_CALL(foo, Bar(IsFalse()));`
| `IsNull()`       | Matches if argument is a null pointer | `EXPECT_CALL(foo, Bar(IsNull()));`
| `NotNull()`      | Matches if argument is a non-null pointer | `EXPECT_CALL(foo, Bar(NotNull()));`
| `Ref(variable)`  | Matches reference to specific variable | `EXPECT_CALL(foo, Bar(Ref(my_var)));`

*Note:* Except `Ref()`, matchers copy the value to ensure safety. Use `std::ref()` to pass references if necessary, but don't modify the reference afterward.

---

### Floating-Point Matchers

Accurate floating-point comparison is crucial in tests. GoogleMock provides ULP-based and approximate equality comparisons:

| Matcher                           | Description                                     |
|---------------------------------|------------------------------------------------|
| `DoubleEq(value)`                | Matches double approximately equal to `value` (NaNs considered unequal) |
| `FloatEq(value)`                 | Matches float approximately equal to `value` (NaNs considered unequal)  |
| `NanSensitiveDoubleEq(value)`   | Matches double approximately equal, with NaN == NaN                    |
| `NanSensitiveFloatEq(value)`    | Matches float approximately equal, with NaN == NaN                     |
| `DoubleNear(value, abs_error)`  | Matches double within absolute error `abs_error` (NaNs unequal)         |
| `FloatNear(value, abs_error)`   | Matches float within absolute error `abs_error` (NaNs unequal)          |
| `NanSensitiveDoubleNear(value, abs_error)` | Same as above but NaN == NaN                              |
| `NanSensitiveFloatNear(value, abs_error)`  | Same as above but NaN == NaN                              |
| `IsNan()`                       | Matches any NaN floating-point value                   |

Example:
```cpp
EXPECT_CALL(foo, Bar(DoubleEq(3.14)));
EXPECT_THAT(actual_val, NanSensitiveFloatNear(2.71f, 0.001f));
```

---

### String Matchers

String arguments can be tested using a variety of matchers:

| Matcher                | Description                                   |
|------------------------|-----------------------------------------------|
| `StrEq(string)`        | Argument equals `string` exactly.             |
| `StrNe(string)`        | Argument not equal to `string`.                |
| `StrCaseEq(string)`    | Argument equals `string`, ignoring case.      |
| `StrCaseNe(string)`    | Argument differs from `string`, ignoring case.|
| `HasSubstr(string)`    | Argument contains `string` as a substring.    |
| `StartsWith(prefix)`   | Argument starts with `prefix`.                 |
| `EndsWith(suffix)`     | Argument ends with `suffix`.                    |
| `WhenBase64Unescaped(m)` | Argument is a base64 escaped string whose unescaped string matches matcher `m`. |
| `MatchesRegex(regex)`  | Argument matches regex entirely.               |
| `ContainsRegex(regex)` | Argument contains a regex match.               |

Example:
```cpp
EXPECT_CALL(foo, Bar(StrCaseEq("hello")));
EXPECT_THAT(name, StartsWith("Mr."));
EXPECT_THAT(data, ContainsRegex(std::string("foo.*bar")));
```

---

### Container Matchers

GoogleMock provides matchers to validate container contents in flexible ways:

| Matcher                       | Description                                         |
|-------------------------------|-----------------------------------------------------|
| `Contains(value_or_matcher)`  | Matches if container contains an element matching the argument. |
| `Each(value_or_matcher)`      | Matches if *all* elements in container match.       |
| `ElementsAre(e0, e1, ..., en)`| Matches container elements in order, each matching corresponding matcher or value. |
| `ElementsAreArray(container_or_array)` | Like `ElementsAre` but matcher values from container or array. |
| `UnorderedElementsAre(e0, ..., en)` | Matches container with elements matching the matchers in any order. |
| `UnorderedElementsAreArray(container_or_array)` | Like `UnorderedElementsAre` but matcher values from container or array. |
| `SizeIs(matcher)`             | Container size matches `matcher`.                   |
| `IsEmpty()`                   | Container is empty.                                 |
| `ContainerEq(container)`      | Container equals expected, with enhanced difference messages. |
| `IsSubsetOf(collection)`      | Container matches subset of collection matchers.  |
| `IsSupersetOf(collection)`    | Container matches superset of collection matchers.|
| `Pointwise(pair_matcher, container)` | Checks elements pairwise match pairs from another container. |
| `UnorderedPointwise(pair_matcher, container)` | Like `Pointwise` but unordered match.              |
| `WhenSorted(matcher)`         | Matches container when sorted (ascending) as `matcher`. |
| `WhenSortedBy(comparator, matcher)` | Matches container when sorted with comparator.

Example:
```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _, 5)));
EXPECT_THAT(my_vector, UnorderedElementsAreArray({1, 5, 3}));
EXPECT_THAT(map, Contains(Key(Ge(5))));
EXPECT_THAT(list, SizeIs(3));
```

---

### Member and Property Matchers

You can match objects by selected data members, or properties (callable methods without arguments):

| Matcher                                   | Description
|--------------------------------------------|---------------------------------------------------------|
| `Field(&Class::member, matcher)`          | Matches object whose member satisfies matcher.           |
| `Field(name, &Class::member, matcher)`    | Same, but provides field name for better messages.       |
| `Property(&Class::method, matcher)`       | Matches object whose method() result satisfies matcher.  |
| `Property(name, &Class::method, matcher)` | Same, but with method name for error messages.           |

Example:
```cpp
EXPECT_CALL(mock, Foo(Field(&Foo::value, Ge(3))));
EXPECT_THAT(foo_obj, Property("size", &Foo::size, Eq(10)));
```

---

### Pointer Matchers

Match pointers or their referenced values:

| Matcher                    | Description                                   |
|----------------------------|-----------------------------------------------|
| `Pointee(matcher)`         | Pointer points to a value matching `matcher` (non-null).
| `Pointer(matcher)`         | Pointer itself matches `matcher` (compares raw pointer).
| `Address(matcher)`         | Matches object whose address matches `matcher`.
| `WhenDynamicCastTo<T>(matcher)` | When dynamic_cast<T> applied, result matches matcher.

Example:
```cpp
EXPECT_CALL(foo, Bar(Pointee(Ge(5))));
EXPECT_THAT(ptr, Pointer(NotNull()));
EXPECT_THAT(obj, Address(Eq(&obj)));
EXPECT_THAT(base_ptr, WhenDynamicCastTo<Derived*>(Pointee(_)));
```

---

### Exception Matchers

To assert a callable throws exceptions:

| Matcher                            | Description                            |
|----------------------------------|----------------------------------------|
| `Throws<E>()`                    | Callable throws exception of type `E`.
| `Throws<E>(matcher)`             | Throws exception of type `E` satisfying matcher.
| `ThrowsMessage<E>(matcher)`      | Throws exception with message satisfying matcher.

Example:
```cpp
auto func = [] { throw std::runtime_error("error msg"); };
EXPECT_THAT(func, Throws<std::runtime_error>());
EXPECT_THAT(func, Throws<std::runtime_error>(HasSubstr("msg")));
EXPECT_THAT(func, ThrowsMessage<std::runtime_error>(HasSubstr("error")));
```

---

### Composite Matchers

Compose matchers for richer conditions:

| Matcher                 | Description                                  |
|-------------------------|----------------------------------------------|
| `AllOf(m1, m2, ..., mn)`| Matches if all sub-matchers match.
| `AnyOf(m1, m2, ..., mn)`| Matches if any sub-matcher matches.
| `Not(matcher)`          | Matches if matcher does *not* match.
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` true, else `m2`.

Example:
```cpp
EXPECT_THAT(value, AllOf(Gt(5), Ne(10)));
EXPECT_THAT(str, AnyOf(StartsWith("foo"), EndsWith("bar")));
EXPECT_THAT(x, Not(Eq(0)));
EXPECT_THAT(y, Conditional(flag, Eq(1), Eq(2)));
```

---

### Multi-argument Matchers

When needing to match all or selected arguments as a tuple rather than individually:

- `.With(multi_arg_matcher)` — inside `EXPECT_CALL` or `ON_CALL` restrict to calls where all arguments as tuple satisfy `multi_arg_matcher`.
- `Args<N1, N2, ..., Nk>(matcher)` — tuple of selected arguments matches `matcher`.
- `AllArgs(matcher)` — synonym for matching all args.

Example:
```cpp
EXPECT_CALL(mock, Func(_, _))
    .With(Lt());  // First argument < second argument

EXPECT_CALL(mock, Foo(_, _, _))
    .With(Args<0, 2>(Gt()));  // First argument > third argument
```

---

### Adapters and Casting

- `MatcherCast<T>(matcher)` — Cast matcher to type `Matcher<T>`. Requires safe static cast.
- `SafeMatcherCast<T>(matcher)` — Like `MatcherCast` but enforces lossless conversions.

Example:
```cpp
Matcher<int> m_int = MatcherCast<int>(Gt(5L));
EXPECT_CALL(foo, Bar(SafeMatcherCast<Derived*>(m_base_ptr)));
```

---

### Defining Custom Matchers

You can create your own matchers using `MATCHER` macros or by defining matcher classes implementing the matcher interface.

Example with `MATCHER`:
```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
EXPECT_THAT(value, IsEven());
```

For parameterized matchers, use `MATCHER_P`, `MATCHER_P2`, etc.

Example:
```cpp
MATCHER_P(InRange, range_end, "") {
  return arg < range_end;
}
EXPECT_THAT(value, InRange(10));
```

---

## Practical Tips and Common Pitfalls

- Always set expectations (`EXPECT_CALL`) before the code under test calls the mock.
- Use `_` or `A<type>()` to ignore arguments not relevant to your test.
- Use `RetiresOnSaturation()` to make expectations non-sticky when needed.
- Use composite matchers (`AllOf`, `AnyOf`) to succinctly describe complex conditions.
- For containers, prefer `ElementsAre` or `UnorderedElementsAre` over exact equality for better diagnostics.
- Use `NiceMock` to suppress warnings from uninteresting calls.
- Use `StrictMock` to turn uninteresting call warnings into errors for stricter tests.

---

## Summary

The Matchers API is a rich, expressive system empowering you to precisely verify argument values and properties in mocks and assertions. By combining built-in primitive matchers, container matchers, string matchers, and composite patterns, you can write clear, maintainable tests that catch precisely the behaviors your code must exhibit.

For mastery, combine these capabilities with the [Mocking API](reference/mocking.md), [Expectations & Actions](gmock_cook_book.md), and the [GoogleTest Assertions](reference/assertions.md).

---

## See Also

- [Matchers Reference](reference/matchers.md) — complete list of built-in matchers with examples.
- [Mocking Reference](reference/mocking.md) — how to use matchers in mocks.
- [gMock Cookbook](gmock_cook_book.md) — recipes for using matchers and actions.
- [Assertions Reference](reference/assertions.md) — including `EXPECT_THAT` and `ASSERT_THAT` using matchers.

---

## Example: Using Matchers in Mock Expectations and Assertions

```cpp
using ::testing::_;
using ::testing::Gt;
using ::testing::Eq;
using ::testing::ElementsAre;
using ::testing::StartsWith;

class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), ());
  MOCK_METHOD(int, Query, (const std::string& sql), ());
};

TEST(DatabaseTest, MockTest) {
  MockDatabase mock_db;

  // Expect Connect to be called with any URL starting with "db://"
  EXPECT_CALL(mock_db, Connect(StartsWith("db://")))
      .WillOnce(testing::Return(true));

  // Expect Query to be called with SQL string containing "SELECT"
  EXPECT_CALL(mock_db, Query(testing::HasSubstr("SELECT")))
      .WillRepeatedly(testing::Return(42));

  // Run code using mock_db...

  // Direct value verification with matcher:
  int result = 42;
  EXPECT_THAT(result, Eq(42));

  std::vector<int> numbers = {1, 2, 3};
  EXPECT_THAT(numbers, ElementsAre(1, Gt(1), 3));
}
```
