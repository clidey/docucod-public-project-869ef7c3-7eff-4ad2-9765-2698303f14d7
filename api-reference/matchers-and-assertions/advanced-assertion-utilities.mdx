---
title: "Advanced Assertion Utilities"
description: "Reference for assertion result and message handling APIs, enabling detailed failure messages, custom formatting, and integration with CI systems."
---

# Advanced Assertion Utilities

This page documents the advanced assertion result and message handling APIs provided by GoogleTest. These APIs enable you to incorporate detailed failure messages, apply custom formatting to assertions, and seamlessly integrate test results with continuous integration (CI) systems. Leveraging these utilities offers enhanced control over how assertion outcomes are presented and handled.

---

## Overview

GoogleTest builds on foundational assertions to provide sophisticated utilities that allow you to:

- Customize assertion failure messages with detailed contextual information.
- Construct predicate and predicate-format assertions for readable and meaningful test failure reporting.
- Record and manage test properties, which can be included in generated XML or JSON reports.
- Integrate smoothly with CI pipelines by leveraging enhanced output formats and streaming capabilities.

These utilities empower developers to improve test diagnostics and reporting clarity.

## Assertion Result Handling

### The `AssertionResult` Class

At the core of advanced assertion utilities is the `testing::AssertionResult` class.

- It represents the outcome of an assertion.
- It can denote success or failure.
- On failure, it carries a detailed message explaining why the assertion failed.

You create `AssertionResult` objects via the factory functions:

```cpp
AssertionResult AssertionSuccess();
AssertionResult AssertionFailure();
```

The class supports streaming messages into the failure object to build rich, readable messages:

```cpp
return testing::AssertionFailure() << "Expected even number but got " << n;
```

This becomes a part of the failure message when the assertion is evaluated.

### Usage Example

Defining a predicate that reports detailed message on failure:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}

// In a test:
EXPECT_TRUE(IsEven(Fib(5)));
```

When `IsEven` returns failure, the output will show the message "5 is odd", giving more clarity on the failure.

## Predicate Assertions

GoogleTest offers predicate assertion macros to enhance testing complex expressions.

### `EXPECT_PRED*` Macros

They accept predicate functions or functors that return `bool`. Failure messages include the values of the arguments.

Example:

```cpp
bool IsPositive(int n) { return n > 0; }
EXPECT_PRED1(IsPositive, value);
```

### `EXPECT_PRED_FORMAT*` Macros

For complete control over failure message formatting, use predicate-formatters that return `AssertionResult`.

They have the signature:

```cpp
testing::AssertionResult PredicateFormatter(const char* expr1, ..., T1 val1, ...);
```

Example:

```cpp
testing::AssertionResult AssertIsPositive(const char* expr, int n) {
  if (n > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " is not positive: " << n;
}
...
EXPECT_PRED_FORMAT1(AssertIsPositive, value);
```

This allows highly customized failure messages referencing both code and values.

### Multi-arity predicates

GoogleTest supports predicates with up to 5 arguments (`EXPECT_PRED1`, `EXPECT_PRED2`, ...).

## Assertion Helpers for Floating-Point

Floating-point comparison is fraught with subtlety due to rounding errors. GoogleTest provides predicate-format functions `FloatLE` and `DoubleLE`:

```cpp
EXPECT_PRED_FORMAT2(FloatLE, val1, val2);
EXPECT_PRED_FORMAT2(DoubleLE, val1, val2);
```

These verify that `val1 <= val2` approximately, considering floating-point precision and special values like NaN and infinity.

## Detailed Failure Message Construction

### Equality Failure Handling

GoogleTest constructs informative failure messages for equality assertions (`EXPECT_EQ`, etc.) including the expected and actual expressions and their runtime values. For string comparisons, diffs are shown when appropriate to highlight differences.

### Boolean Assertion Failures

Utility functions format failure messages for assertions like `EXPECT_TRUE` and `EXPECT_FALSE`, including actual and expected values.

### Handling Wide Strings

When wide strings (`wchar_t*` or `std::wstring`) are streamed to assertions, they are automatically converted to UTF-8 for readable output.

## Test Result Properties

GoogleTest lets you record *test properties* using `RecordProperty(key, value)`, which attaches key-value pairs to the current test case, test suite, or global test run.

- Properties are emitted in XML/JSON reports and can hold custom metadata.
- Keys must not conflict with reserved attribute names (such as `name`, `status`, `time`, etc.).
- Properties recorded outside any running test go to the suite or global scope accordingly.

```cpp
RecordProperty("MaxMemoryUsage", "512MB");
```

## Event Listener and Streaming Integration

GoogleTest supports event listeners which receive detailed notifications of test progress, assertions results, and test suite completion.

### Streaming Test Results

By specifying flags such as `--gtest_stream_result_to=host:port`, test results (including assertion messages) can be streamed over TCP. This enables integration with CI systems for real-time reporting.

### Output Formats

Supported formats include:

- **Text**: Default pretty console output with coloring and formatting.
- **XML**: Structured output suitable for tools like Jenkins.
- **JSON**: Machine-readable output with comprehensive test and failure details.

## Failure Handling Behavior

GoogleTest provides detailed control of failure behavior:

- Configure breakpoints on failures (`--gtest_break_on_failure`).
- Switch between catching exceptions or propagating them (`--gtest_catch_exceptions`).
- Control throw-on-failure behavior for integration with other frameworks (`--gtest_throw_on_failure`).

Failures carry full file paths, line numbers, and stack traces (when enabled) to assist debugging.

## Tips and Best Practices

- Prefer predicate-format assertions for complex conditions needing detailed diagnostics.
- Use `SCOPED_TRACE` to add trace context for failures in shared helper functions.
- Utilize `RecordProperty` to convey additional data to CI or reporting tools.
- Use floating-point predicate format macros instead of direct equality to avoid flaky tests due to precision issues.
- Keep in mind that fatal failures abort the current function, not the entire test—consider `HasFatalFailure()` or `ASSERT_NO_FATAL_FAILURE()` to manage test flow.

## Summary

The Advanced Assertion Utilities provide a robust and extensible framework to articulate and report test assertions with precision. Custom predicate assertion macros, detailed failure messages including diffs and stack traces, plus extensible reporting capabilities empower developers to write clear and diagnostic-friendly tests that integrate effectively with continuous integration workflows.

---

For complete usage, see the following reference documentation linked below.

---

## Additional Resources

- [Assertions Reference](../reference/assertions.md) — exhaustive documentation and examples of GoogleTest's assertion macros, including `EXPECT_PRED*` and `EXPECT_PRED_FORMAT*`.
- [Writing Effective Assertions Guide](../guides/core-testing-workflows/writing-effective-assertions.md) — practical advice and user-facing guidance on crafting clear assertions.
- [Matcher Library Reference](../api-reference/matchers-and-assertions/matcher-library.md) — foundational for integrating expressive matchers with `EXPECT_THAT`.
- [Integration & Platform Support](../overview/architecture-concepts/integration-and-platforms.md) — insights on output formats and CI integration.

To dive deeper and extend your testing beyond these utilities, explore related concepts in test suites, mocking, death tests, and parameterized testing.

---

## Examples

```cpp
// Example: Custom predicate-formatter that checks if a number is even.
testing::AssertionResult IsEven(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << "Expected even number: " << expr << " evaluates to " << n;
}

TEST(NumberTest, EvenCheck) {
  EXPECT_PRED_FORMAT1(IsEven, 3);  // Fails, message will be detailed.
}
```

```cpp
// Example: Record custom property for the test.
TEST(MemoryTest, Usage) {
  RecordProperty("MaxUsedMemoryMB", "512");
  ...
}
```

```bash
# Run tests and produce an XML report suitable for CI.
./my_tests --gtest_output=xml:reports/my_test_results.xml
```
