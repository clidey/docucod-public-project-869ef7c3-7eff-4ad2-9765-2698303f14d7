---
title: "Matcher Library"
description: "API documentation for writing and using matchers in test assertions. Includes built-in comparison, regex, and container matchers, plus guidance on custom matcher creation."
---

# Matcher Library

GoogleTest's matcher library is a powerful and expressive toolkit used primarily in conjunction with GoogleMock. It allows you to specify flexible, human-readable conditions to validate arguments in mock method calls and in assertions. This page provides comprehensive reference material for using built-in matchers, creating custom matchers, and combining matchers to express complex test conditions.

---

## Overview of Matchers

Matchers are predicate-like objects used to verify that function arguments fulfill expected criteria during tests. They underpin the expressive `EXPECT_CALL` and `EXPECT_THAT` macros, enabling readable and powerful test assertions.

A matcher object tests whether a value matches certain conditions and can also describe what it checks, which helps generate meaningful failure messages. They can be polymorphic (usable with different types) or monomorphic (targeting a specific type).

### Using Matchers

Matchers can be used in several ways:

- Directly in `EXPECT_CALL` to check mock method arguments.
- Within `EXPECT_THAT` assertions to validate general values.
- As predicates in STL algorithms (wrapped via `Matches(matcher)`).

GoogleTest offers a rich set of built-in matchers for standard use cases and the ability to define your own to suit specialized needs.

## Built-In Matchers

This section summarizes the most common categories of built-in matchers.

### Primitive Value Matchers

Matchers for equality and comparison:

| Matcher | Description |
|---------|-------------|
| `Eq(value)` | Matches values equal to `value` (uses `operator==`).
| `Ne(value)` | Matches values not equal to `value`.
| `Lt(value)` | Matches values less than `value`.
| `Le(value)` | Matches values less than or equal to `value`.
| `Gt(value)` | Matches values greater than `value`.
| `Ge(value)` | Matches values greater than or equal to `value`.
| `IsNan()` | Matches floating-point NaN values.

```cpp
EXPECT_CALL(mock, Foo(Eq(42)));            // exact match 42
EXPECT_THAT(value, AllOf(Gt(0), Lt(100))); // value in range (0,100)
```

### String Matchers

Specialized matchers for strings (`const char*`, `std::string`, and wide string types):

| Matcher           | Description                                                               |
|-------------------|---------------------------------------------------------------------------|
| `StrEq(str)`      | Exact match of strings (case-sensitive).
| `StrNe(str)`      | Strings not equal.
| `StrCaseEq(str)`  | Exact match ignoring case.
| `StrCaseNe(str)`  | Not equal ignoring case.
| `HasSubstr(sub)`  | Contains substring `sub`.
| `StartsWith(prefix)` | Begins with `prefix`.
| `EndsWith(suffix)`   | Ends with `suffix`.
| `MatchesRegex(regex)` | Matches regular expression fully.
| `ContainsRegex(regex)`| Contains regex substring.

```cpp
EXPECT_THAT(name, StartsWith("John"));
EXPECT_THAT(log, MatchesRegex("error \\[0-9\\]+:"));
```

### Pointer and Reference Matchers

Matchers that work on pointer and reference arguments:

| Matcher           | Description                                              |
|-------------------|----------------------------------------------------------|
| `_`               | Wildcard matcher that matches any argument of any type. |
| `IsNull()`        | Matches null pointers.
| `NotNull()`       | Matches any non-null pointer.
| `Ref(var)`        | Matches an argument that is a reference to `var`.
| `Pointee(m)`      | Matches a pointer whose target matches matcher `m`.
| `Pointer(m)`      | Matches a pointer that matches matcher `m` on the pointer itself.
| `Address(m)`      | Matches an object that has an address matching matcher `m`.

```cpp
EXPECT_CALL(mock, Foo(Pointee(Gt(0)))); // pointer points to positive value
```

### Container Matchers

Matchers for STL containers and container-like data structures:

| Matcher Name          | Semantics                                                      |
|-----------------------|----------------------------------------------------------------|
| `ElementsAre(...)`    | Matches a container whose elements match given matchers **in order**.
| `UnorderedElementsAre(...)` | Matches a container with elements matching given matchers in any order.
| `ElementsAreArray(...)` | Like `ElementsAre()`, but accepts an array or iterator range.
| `UnorderedElementsAreArray(...)` | Like `UnorderedElementsAre()`, but accepts an array or iterator range.
| `Contains(matcher)`   | Container contains at least one element matching `matcher`.
| `Each(matcher)`       | All elements in the container match `matcher`.
| `SizeIs(matcher)`     | Container size matches `matcher`.
| `WhenSorted(matcher)` | Container when sorted matches `matcher`.
| `Pointwise(pair_matcher, rhs_container)` | Element-wise matched container using a pair matcher.

Examples:

```cpp
EXPECT_CALL(mock, ProcessData(ElementsAre(Ge(5), _, Lt(10))));
EXPECT_THAT(vec, UnorderedElementsAre(1, 2, 3));
EXPECT_THAT(map, Contains(Pair("key", Eq("value"))));
```

### Tuple, Pair, and Field Matchers

For matching structured arguments:

- `Pair(m1, m2)` matches a `std::pair` with first and second matched by `m1` and `m2`.
- `Field(&Class::field, matcher)` matches an object whose member `field` matches `matcher`.
- `Property(&Class::property, matcher)` matches an object whose getter method returns a value matching `matcher`.
- `FieldsAre(m1, m2, ..., mn)` matches aggregates or tuples matching each matcher in order.

Example:

```cpp
EXPECT_THAT(p, Pair(Ge(5), HasSubstr("foo")));
EXPECT_THAT(object, Field(&Foo::count, Ge(1)));
EXPECT_THAT(object, Property(&Foo::name, StartsWith("Hello")));
```

### Combining Matchers

You can combine multiple matchers logically:

| Matcher | Meaning                              |
|---------|------------------------------------|
| `AllOf(m1, m2, ...)` | Matches if **all** matchers succeed.
| `AnyOf(m1, m2, ...)` | Matches if **any** matcher succeeds.
| `Not(m)`              | Matches if `m` does *not* match.

Example:

```cpp
EXPECT_THAT(value, AllOf(Gt(0), Lt(10), Not(Eq(5))));
```

### Special Matchers

- `Truly(predicate)` lets you use arbitrary unary predicates as matchers.
- `Conditional(cond, m1, m2)` uses `m1` if `cond` is true, else `m2`.
- `Optional(matcher)` matches `std::optional` or similar types.

---

## Writing Custom Matchers

GoogleTest allows you to write custom matchers to express domain-specific validation in tests.

### Using the MATCHER Macros

For quick, inline matchers:

```cpp
MATCHER(Name, "Description") {
  // 'arg' is the value being matched.
  return <boolean_expression>;
}
```

Example:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }

EXPECT_CALL(mock, Method(IsEven()));
EXPECT_THAT(value, IsEven());
```

You can also parameterize them:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}

EXPECT_THAT(x, HasAbsoluteValue(10));
```

You may stream additional information to `result_listener` to produce richer failure explanations.

### Writing Matcher Classes Manually

For advanced scenarios, define a class implementing the interface:

- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const` - test and optionally explain.
- `void DescribeTo(std::ostream* os) const` - description.
- `void DescribeNegationTo(std::ostream* os) const` - description of negation.

Then write a matcher factory function returning `testing::Matcher<T>`.

Example:

```cpp
class IsDivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, MatchResultListener* listener) const {
    if ((n % 7) == 0) return true;
    if (listener) *listener << "the remainder is " << (n % 7);
    return false;
  }

  void DescribeTo(std::ostream* os) const { *os << "is divisible by 7"; }
  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not divisible by 7";
  }
};

Matcher<int> IsDivisibleBy7() {
  return MakePolymorphicMatcher(IsDivisibleBy7Matcher());
}
```

---

## Using Matchers in Assertions

Matchers fully integrate with GoogleTest assertions:

- Use in `EXPECT_THAT(value, matcher)` to assert conditions.
- Use in `EXPECT_CALL(mock, Method(matcher, ...))` to set expectations on mock arguments.

Matchers produce failure messages that clearly express expected conditions and actual values encountered.

## Practical Tips & Best Practices

- Use `_` for arguments where you don't care about the value.
- Combine matchers to express rich conditions logically with `AllOf`, `AnyOf`, and `Not`.
- Use `Contains`, `ElementsAre` and related container matchers to validate collections precisely.
- Write custom matchers using `MATCHER` macros or by implementing matcher classes to encapsulate domain-specific validation logic.
- Remember that matcher evaluation may happen multiple times; your matchers must be pure functions with no side effects.

## Troubleshooting

- If a matcher fails unexpectedly, check that the input type matches the matcher type or use `SafeMatcherCast<T>(matcher)` to adjust.
- When matching pointers, be cautious with `NULL` handling; use `Pointee()` for matching the pointed-to values safely.
- For complex argument matching in mocks, use multi-argument matchers with `.With()` clause or `Args<>()` to customize argument tuple matching.

## Advanced Topics

- **Multi-Argument Matchers with `.With()`:** Restricts expectations to only when all arguments together match a tuple matcher.

- **Tuple Argument Matching via `Args<k...>()`:** Allows selecting subsets of arguments for matching.

- **Polymorphic Matchers:** Define matchers applicable to multiple types, inspired by or implemented as matcher factories.

- **Combining Matchers in Arrays:** Use `ElementsAreArray` and `UnorderedElementsAreArray` for flexible container matching.

- **Nested and Custom Matchers:** You can write matchers that compose other matchers for powerful, reusable validations.

---

## Example Usage

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;
using ::testing::HasSubstr;
using ::testing::ElementsAre;

// Expect mock method Foo to be called with any int greater than 5
EXPECT_CALL(mock_obj, Foo(Gt(5)));

// Expect vector to contain three elements: 1, any positive number, and string "end"
std::vector<std::string> v = {"1", "2", "end"};
EXPECT_THAT(v, ElementsAre("1", HasSubstr("2"), Eq("end")));

// Define a custom matcher for even integers
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock_obj, Bar(IsEven()));
```

---

## Related Documentation

- [Mocking Reference](docs/reference/mocking.md): Learn how matchers are used in mocking expectations.
- [GoogleTest Assertions Reference](docs/reference/assertions.md): Using matchers with assertions.
- [gMock Cookbook](docs/gmock_cook_book.md): Recipes and best practices for mocking and matchers.
- [gMock for Dummies](docs/gmock_for_dummies.md): Beginner-friendly guide to using gMock and matchers.

---

## Additional Resources

- GitHub repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- Matcher source code: [`googlemock/include/gmock/gmock-matchers.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-matchers.h)

---