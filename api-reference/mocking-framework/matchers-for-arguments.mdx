---
title: "Matchers for Argument Validation"
description: "List and explain argument matchers for flexible expectation setting, including built-in matchers (Eq, Ne, Ge, etc.) and guidance on writing custom matchers. Illustrative snippets and matcher combinations provided."
---

# Matchers for Argument Validation

The `Matchers for Argument Validation` page details the flexible and powerful argument matchers provided by GoogleMock (gMock) that allow you to specify fine-grained expectations on mock method parameters. Argument matchers enhance your ability to write expressive, maintainable, and precise tests by letting you validate not only exact values but also complex properties and relationships of function arguments.

---

## Overview

In gMock, argument matchers are used inside `EXPECT_CALL()` and `ON_CALL()` macros to specify what arguments a mock method is expected to be called with, or what arguments it should respond to for default behaviors. Matchers can also be used outside mock expectations to validate values.

They empower you to:

- Validate simple or complex argument values flexibly.
- Compose matchers to capture compound conditions.
- Write expressive and human-readable tests that focus on behavior.

---

## Built-in Matchers

GoogleMock provides a comprehensive list of built-in matchers to cover common testing needs. These matchers are all in the `::testing` namespace.

### Wildcard Matchers
- `_` — Matches any value of the appropriate type. Useful when argument value is irrelevant.
- `A<T>()` or `An<T>()` — Matches any value of type `T`.

### Generic Comparison Matchers
| Matcher | Description |
|---------|-------------|
| `Eq(value)` or just `value` | Argument equals `value` (`==`).
| `Ne(value)`                 | Argument not equal to `value` (`!=`).
| `Ge(value)`                 | Argument greater than or equal to `value` (`>=`).
| `Gt(value)`                 | Argument greater than `value` (`>`).
| `Le(value)`                 | Argument less than or equal to `value` (`<=`).
| `Lt(value)`                 | Argument less than `value` (`<`).
| `IsTrue()`                  | Argument converts to `true` in a boolean context.
| `IsFalse()`                 | Argument converts to `false` in a boolean context.
| `Ref(variable)`            | Argument is a reference to a specific variable.
| `TypedEq<T>(value)`        | Argument has the exact type `T` and is equal to `value` (helps disambiguate overloads).
| `DistanceFrom(target, matcher)` | Argument's distance from `target` (by `abs`) matches `matcher`.
| `DistanceFrom(target, distance_func, matcher)` | Like above but using a custom `distance_func`.
| `Optional(matcher)`        | Matches if argument is an `optional` that contains a value matching `matcher`.
| `VariantWith<T>(matcher)`  | Matches if argument is a `variant<>` holding type `T` with value matching `matcher`.

### Pointer and Nullity Matchers
- `IsNull()` — Argument is a raw or smart `nullptr`.
- `NotNull()` — Argument is a non-null pointer.
- `Pointee(matcher)` — Argument is a pointer (raw/smart) whose pointee matches `matcher`.
- `Pointer(matcher)` — Argument is a pointer matching `matcher` (matches pointer value, not pointee).
- `Address(matcher)` — The address of the argument matches `matcher`.
- `WhenDynamicCastTo<T>(matcher)` — Matches if `dynamic_cast<T>` to argument matches `matcher`.

### Floating-Point Matchers
- `DoubleEq(value)` / `FloatEq(value)` — Matches floating-point values approximately equal to `value` (treat NaNs as unequal).
- `NanSensitiveDoubleEq(value)` / `NanSensitiveFloatEq(value)` — Like above but treats NaNs as equal.
- `DoubleNear(value, max_error)` / `FloatNear(value, max_error)` — Matches floating-point values close to `value` with max absolute error.
- `NanSensitiveDoubleNear(value, max_error)` / `NanSensitiveFloatNear(value, max_error)` — Like above with NaN equality.
- `IsNan()` — Matches `NaN` values.

### String Matchers
- `StrEq(string)` / `StrNe(string)` — Matches C or C++ strings equal / not equal to `string`.
- `StrCaseEq(string)` / `StrCaseNe(string)` — Matches strings equal / not equal case-insensitively.
- `HasSubstr(string)` — Argument contains `string` as substring.
- `StartsWith(string)` — Argument starts with prefix `string`.
- `EndsWith(string)` — Argument ends with suffix `string`.
- `ContainsRegex(RE)` / `MatchesRegex(RE)` — Matches strings with the given regex.
- `WhenBase64Unescaped(matcher)` — Base64 unescape string then match with `matcher`.

### Container Matchers
- `IsEmpty()` — Matches empty containers or strings.
- `Contains(value_or_matcher)` — Container has at least one element matching the argument.
- `Contains(value_or_matcher).Times(n)` — The number of matching elements matches `n`.
- `Each(value_or_matcher)` — All elements of the container match the argument.
- `ElementsAre(m1, m2, ..., mn)` — Container has elements matching each matcher in order.
- `UnorderedElementsAre(m1, m2, ..., mn)` — Container has elements matching each matcher in any order.
- `ElementsAreArray()` / `UnorderedElementsAreArray()` — Like above but with a container, array or initializer-list.
- `IsSubsetOf(...)` / `IsSupersetOf(...)` — Partial matching sets against containers.
- `Pointwise(pair_matcher, container)` — Matches pairwise arguments between containers.
- `UnorderedPointwise(pair_matcher, container)` — Like `Pointwise` but ignores order.
- `SizeIs(matcher)` — Container size matches `matcher`.
- `BeginEndDistanceIs(matcher)` — Distance between `begin()` and `end()` matches `matcher`.
- `ContainerEq(container)` — Like `Eq(container)` but with informative mismatch messages.
- `WhenSortedBy(comparator, matcher)` / `WhenSorted(matcher)` — Container sorted by comparator matches `matcher`.

### Member Matchers
- `Field(&class::field, matcher)` — Matches objects whose field matches `matcher`. Applies also to pointer to object.
- `Field(field_name, &class::field, matcher)` — Same as above with better error messages.
- `Property(&class::property, matcher)` — Matches objects for which `property()` matches `matcher`. Property must be `const` and take no arguments.
- `Property(property_name, &class::property, matcher)` — Same as above with better error messages.
- `Key(matcher)` — Matches std::pair's `first` with `matcher`.
- `Pair(matcher1, matcher2)` — Matches std::pair, first field matches `matcher1`, second field matches `matcher2`.
- `FieldsAre(m1, m2, ..., mn)` — Matches tuple-like objects field by field.

### Exception Matchers
- `Throws<E>()` — Matches callable objects throwing exception of type `E`.
- `Throws<E>(matcher)` — Matches callable throwing exception of type `E` satisfying `matcher`.
- `ThrowsMessage<E>(matcher)` — Matches callable throwing `E` whose `what()` message matches `matcher`.

### Composite Matchers
- `AllOf(m1, m2, ..., mn)` — Matches if argument matches all sub-matchers.
- `AnyOf(m1, m2, ..., mn)` — Matches if argument matches any sub-matcher.
- `Not(matcher)` — Matches if argument does **not** match the `matcher`.
- `Conditional(cond, matcher_true, matcher_false)` — Matches using `matcher_true` if `cond` is `true` else `matcher_false`.
- `MatcherCast<T>(matcher)` and `SafeMatcherCast<T>(matcher)` — Casts a matcher to a target type with compile-time safety.
- `Truly(predicate)` — Matches argument if callable predicate returns `true`.

### Multi-Argument Matchers
Matchers that match multiple arguments as a tuple can be used with `.With()` or directly.
- Tuple matchers: `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()` match tuples element-wise using corresponding comparison.
- Selectors: `AllArgs(matcher)` is equivalent to `matcher` and reads better in `.With()`. `Args<N1, N2, ..., Nk>(matcher)` matches only selected arguments.

---

## User Guidance and Best Practices

### Using Matchers Effectively
- Use `_` (wildcard) to ignore argument values you don't care about.
- Compose matchers with `AllOf()`, `AnyOf()`, and `Not()` for complex conditions.
- Use `SafeMatcherCast<T>()` to match subtypes or compatible types safely.
- Use `Ref(variable)` when you want to check if the argument references a particular variable.
- Use `Pointee(matcher)` for validating the value pointed to by a pointer argument.

### Custom Matchers
- Define new matchers using `MATCHER()` and `MATCHER_P()` macros for concise custom logic.
- Use `MatchAndExplain()` to provide detailed match failure explanations.
- Use `DescribeTo()` and `DescribeNegationTo()` for clear human-readable messages.

### Matching Containers and Members
- Use container matchers (`ElementsAre`, `UnorderedElementsAre`, `Contains`, `Each`, etc.) to validate container contents with flexibility.
- Use field and property matchers to validate parts of complex objects without over-specification.
- Use `Pair()` and `Key()` for associative container elements.

### Common Pitfalls
- Do not rely on equality matching with implicit conversions; prefer explicit matchers like `Eq()`.
- Remember matchers are pure functions and cannot have side effects.
- Beware that matchers are evaluated multiple times by the framework.

---

## Practical Examples

### Basic Argument Matching
```cpp
EXPECT_CALL(mock_object, Process(42, _));  // First arg must be 42, second any value
EXPECT_CALL(mock_object, Process(Ge(10), Lt(100)));  // First arg >=10, second <100
```

### Using Composition
```cpp
EXPECT_CALL(mock_object, Update(
    AllOf(Ge(1), Ne(5))));  // Argument >= 1 and != 5
EXPECT_CALL(mock_object, Insert(AnyOf(Eq("apple"), Eq("banana"))));
```

### Matching Pointer Targets
```cpp
EXPECT_CALL(foo, SetValue(Pointee(Ge(0))));  // Pointer to a value >= 0
EXPECT_CALL(bar, SetObject(NotNull()));      // Non-null pointer
```

### Using Container Matchers
```cpp
std::vector<int> expected = {1, 3, 5};
EXPECT_CALL(mock_obj, ProcessNumbers(ElementsAre(1, 3, 5)));
EXPECT_CALL(mock_obj, ProcessNumbers(UnorderedElementsAre(5, 3, 1)));
EXPECT_CALL(mock_obj, ProcessNumbers(Contains(Ge(10))));
```

### Verifying Member and Property Values
```cpp
EXPECT_CALL(mock_obj, Handle(
  Field(&MyClass::count, Ge(1))));
EXPECT_CALL(mock_obj, Get(
  Property(&MyClass::name, StartsWith("Hi"))));
```

### Using Multi-Argument Matchers with `.With()`
```cpp
EXPECT_CALL(mock_obj, Foo(_, _))
    .With(Args<0,1>(Lt()));  // First arg less than second
```

### Defining a Custom Matcher
```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
EXPECT_CALL(mock_obj, Bar(IsEven()));
```

---

## Additional Resources
- [Matchers Reference](reference/matchers.md) — Complete list of all matchers.
- [gMock Cookbook](gmock_cook_book.md) — Includes recipes for custom matchers.
- [Using Assertions and Matchers Effectively](../guides/everyday-workflows/assertions-matchers.md) — Practical guidance.
- [Mocking Basics](../guides/mocking-and-advanced-techniques/mocking-basics.md) — Foundational mocking techniques.

---

## Best Practices

- Prefer `ON_CALL` for defining default behaviors without expecting calls.
- Use specific `EXPECT_CALL` only when you want to verify calls and arguments.
- Use `NiceMock` to suppress uninteresting call warnings, `StrictMock` to enforce strictness.
- Compose matchers to reduce over-specification and increase maintainability.
- Always set expectations before exercising mock methods; undefined behavior if called afterward.

---

**This page is dedicated to helping you harness GoogleMock's full power in argument validation to write robust and expressive unit tests.**

---

<Note>
All matcher examples assume `using ::testing::_;`, `using ::testing::Eq;`, and related imports.
</Note>
