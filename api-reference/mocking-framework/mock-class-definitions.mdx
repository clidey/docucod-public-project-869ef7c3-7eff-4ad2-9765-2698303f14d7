---
title: "Mock Class and Method Definitions"
description: "Guide to defining mock classes and functions using macros such as MOCK_METHOD. Covers templates and patterns for mock declarations, constructors, destructors, and customization points."
---

# Mock Class and Method Definitions

This guide provides a comprehensive overview of how to define mock classes and methods in GoogleMock, focusing particularly on the use of macros like `MOCK_METHOD`. It explains the syntax, templates, and common patterns for declaring mocks, constructors, destructors, and points for customization.

---

## Why Define Mock Classes?

Mock classes let you replace real classes with simulated versions to isolate and test your code's behavior. Using mocks, you specify which methods will be called, how many times, with what arguments, and what they should return. GoogleMock automates mock class generation, making it easy to create and maintain mocks in C++.

---

## Using `MOCK_METHOD` to Define Mock Methods

GoogleMock uses the `MOCK_METHOD` macro to declare mock methods inside mock classes. This macro automatically generates method implementations that integrate with GoogleMock’s behavior specifications.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- **ReturnType**: The method's return type.
- **MethodName**: The name of the method.
- **Args...**: The method's parameters, enclosed in parentheses.
- **Qualifiers**: Optional list of method qualifiers like `const`, `override`, `noexcept`, `Calltype(...)`, and reference qualifiers (`ref(&)`, `ref(&&)`).


### Example: Mocking an Interface

Given an interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};
```

Define the mock class as:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

This is all you need — `MOCK_METHOD` defines both the method and its necessary GoogleMock hooks.

<Note>
Always declare mock methods in the `public:` section even if the original methods are protected or private in the base class. This is necessary for `EXPECT_CALL` and `ON_CALL` to function correctly.
</Note>

---

## Handling Complex Signatures

### Commas in Types

Types with unprotected commas (e.g. templates like `std::pair<bool, int>`) confuse macro parsing. To avoid this:

1. **Wrap the type in parentheses:**

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

2. **Or use type aliases:**

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### Mocking Overloaded Methods

If the base class has overloaded methods, you can mock all versions as usual:

```cpp
MOCK_METHOD(int, Add, (Element x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));

MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

If you choose not to mock some overloads, add `using` declarations to avoid hiding them:

```cpp
using Foo::Add;
```

### Mocking Class Templates

Mock class templates work the same:

```cpp
template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

### Mocking Non-Virtual Methods

You can mock non-virtual methods by defining a mock class unrelated to the real class but mimicking its methods. Here is an example:

```cpp
class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

Use template-based dependency injection at compile-time to switch between real and mock implementations.

---

## Mock Class Constructors and Destructors

### Constructors

You don't need to write special constructors when using `MOCK_METHOD`; default constructors work fine. However, if you mock many methods with different signatures, compiling can slow down significantly because of constructor/destructor generation.

To speed up compilation:

- Declare your mock class constructor and destructor in the header but define them in a `.cc` file.

```cpp
// mock_foo.h
class MockFoo : public Foo {
 public:
  MockFoo();
  ~MockFoo() override;
  MOCK_METHOD(int, DoThis, (), (override));
};

// mock_foo.cc
#include "mock_foo.h"

MockFoo::MockFoo() {}
MockFoo::~MockFoo() {}
```

### Destructors

Destructors cannot be directly mocked because of C++ syntax. Instead, mock the destructor by creating a mock method (e.g. `Die()`) and calling it in the destructor:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```

You can then add expectations on `Die()` to verify destruction order.

---

## Special Cases and Advanced Topics

### Calling Mocked Methods with Macro-Expanded Names

`MOCK_METHOD` supports method names that are macro-expanded, such as Windows API macros. The mock will correctly compile and behave as expected.

### Const and Reference Qualified Methods

MOCK_METHOD supports qualifiers including `const`, reference qualifiers (`ref(&)` or `ref(&&)`), `noexcept`, and call type specifiers (like `Calltype(STDMETHODCALLTYPE)`). This allows mocking of methods with precise signatures.

### Mocking Methods With Move-Only Types

`MOCK_METHOD` supports mocking methods that accept or return move-only types like `std::unique_ptr`. Return values can be specified using lambdas or callable objects for repeated calls to generate fresh objects.

---

## Practical Tips and Best Practices

- **Always specify overrides:** When mocking virtual methods, mark them `override` to catch signature mismatches.
- **Wrap complex types:** Parenthesize return or argument types with internal commas.
- **Use type alias:** Wrapping complex types in alias names simplifies macro usage.
- **Mock all overloaded versions or use `using`:** To avoid hiding base methods.
- **Place mock methods in `public:`:** Regardless of original base access level.
- **Define delegates:** To forward calls to real or fake implementations if needed.
- **Retire saturated expectations:** Use `.RetiresOnSaturation()` to prevent sticky expectations causing unexpected errors.

---

## Troubleshooting Common Issues

<Warning>
- Failing to parenthesize types with commas leads to compilation errors.
- Forgetting to mark mock methods as `override` can create subtle bugs.
- Mock methods must be declared public to be accessible to the mocking framework.
- Incorrect qualifier usage (`const`, `noexcept`, etc.) can prevent proper overriding.
- Overloaded methods may require disambiguation using `Const()` or explicit parameter counts.
</Warning>

---

## Summary Example

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Reset, (), (override));
  MOCK_METHOD(std::pair<int, int>, GetPair, (), (override));
  MOCK_METHOD(void, Process, ((std::map<int, double>) map), (override));

  MOCK_METHOD(void, Die, ());
  ~MockFoo() override {
    Die();
  }

  MockFoo();
  ~MockFoo() override;
};

// In mock_foo.cc
MockFoo::MockFoo() {}
MockFoo::~MockFoo() {}
```

---

## See Also

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) – Great beginner's guide
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) – Recipes and advanced usage
- [EXPECT_CALL Reference](../api-reference/mocking-framework/setting-expectations.md) – How to specify call expectations
- [Actions Reference](../api-reference/mocking-framework/mock-actions.md) – Guide to mock method behaviors
- [Matchers Reference](../api-reference/assertions-matchers/expressive-matchers.md) – How to match arguments in mock calls

---

## Related Documentation

- [Setting Expectations & Sequences](../api-reference/mocking-framework/setting-expectations.md)
- [Nice, Naggy, and Strict Mocks](../api-reference/mocking-framework/strictness-modes.md)
- [Mock Actions and Side Effects](../api-reference/mocking-framework/mock-actions.md)

---

## Summary Diagrams

```mermaid
flowchart TD
  subgraph MockClassDeclaration
    A(MOCK_METHOD macro) --> B[Generates mock methods]
    B --> C[Defines mock method implementations]
  end

  subgraph MethodModifiers
    D[const, override, noexcept]
    E[ref(&), ref(&&)]
    F[Calltype(...)]
  end
  B --> D
  B --> E
  B --> F

  subgraph UsageFlow
    G[Define mock class inheriting interface]
    H[Use EXPECT_CALL / ON_CALL to set behavior]
    I[Exercise code with mock objects]
    J[GoogleMock verifies expectations on destruction]
  end
  A --> G --> H --> I --> J

  style A fill:#f9f,stroke:#333,stroke-width:2px;
  style G fill:#cfc,stroke:#2a2,stroke-width:2px;
  style H fill:#ccf,stroke:#22f,stroke-width:2px;
  style I fill:#fcc,stroke:#a22,stroke-width:2px;
  style J fill:#efe,stroke:#070,stroke-width:2px;
```
