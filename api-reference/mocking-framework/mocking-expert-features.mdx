---
title: "Expert Features: Variadic and Custom Actions"
description: "Reference for advanced features that enable dynamic behavior in mocks—including variadic actions, templated actions, and custom action templates (such as InvokeArgument). Covers mechanisms for extending the mocking framework with your own logic."
---

# Expert Features: Variadic and Custom Actions

This reference documents the advanced GoogleMock features that empower you to create dynamic and flexible mock behaviors. It covers variadic actions that accept variable argument lists, templated actions for reusable parameterized behaviors, and custom action templates, such as invoking callable arguments dynamically. Additionally, you learn mechanisms for extending GoogleMock's mocking framework with your own user-defined logic.

---

## Overview

GoogleMock’s core capabilities allow mocking methods with fixed argument lists. However, complex testing scenarios often require more flexible behaviors.

The **Expert Features** in this chapter enable:

- Writing **variadic actions** that can handle calls with varying arguments dynamically.
- Creating **templated actions** to define reusable, parameterized mock behaviors.
- Using **custom action templates** like `InvokeArgument` to invoke callable function arguments passed to mocks.
- Extending the mocking framework with your own **custom logic** for actions.

These tools unlock the ability to model highly dynamic mock interactions that respond to the exact invocation context.

---

## Variadic Actions

Variadic actions handle mock methods flexibly when the number or type of arguments is not fixed at compile time.

### When to Use

Some legacy or complex interfaces use **variadic functions** or function pointers with callbacks of varying signatures. Since GoogleMock cannot mock functions declared with ellipsis (`...`) directly, variadic actions let you provide behaviors for mocked methods that accept variable numbers of arguments indirectly.

### Key Features

- Variadic arguments are captured and forwarded to your custom action implementation.
- Allows invocation of callbacks or forwarding arguments as needed.

### Example: Invoking a Callable Argument

Suppose your mock method has a callable as an argument (a callback or function pointer) you want to invoke with specified parameters.

```cpp
using ::testing::InvokeArgument;

// Mock method:
MOCK_METHOD(bool, DoWork, (int task_id, std::function<void(int)> callback), (override));

// Expectation that invokes the callback with 42:
EXPECT_CALL(mock, DoWork(_, _))
    .WillOnce(InvokeArgument<1>(42));

// When DoWork is called, it calls the passed callback:
mock.DoWork(1, [](int result) {
  std::cout << "Callback invoked with: " << result << std::endl;
});
```

`InvokeArgument<N>(args...)` invokes the N-th argument (0-based) as a Callable with the provided arguments.

> **Tip:** If the callable accepts arguments by reference, pass them via `std::ref()` to avoid copying.

### Important Notes

- Variadic functions (declared with `...`) cannot be mocked directly in GoogleMock.
- Instead, provide overloaded methods or use variadic action constructs as above.

---

## Templated and Parameterized Actions

GoogleMock enables writing parameterized actions via macros or custom functors to perform complex behaviors depending on arguments or custom parameters.

### ACTION and Related Macros

- `ACTION(name) { statements; }` defines a simple action that runs given statements.
- `ACTION_P(name, param) { statements; }` defines an action parameterized by a single parameter.
- `ACTION_Pk` variants allow up to 10 parameters.

These macros give you quick definition of reusable custom mock behaviors:

```cpp
ACTION_P(AddValue, n) {
  return arg0 + n; // arg0 is the first mock function argument
}
...
EXPECT_CALL(mock, Foo(_))
    .WillOnce(AddValue(5)); // Returns arg0 + 5
```

### Implementing Action Classes

For finer control or polymorphic actions usable across multiple mock method signatures, define an action class with a `Perform` method templated on the result and argument tuple types:

```cpp
class ReturnSecondArgAction {
 public:
  template <typename Result, typename ArgumentTuple>
  Result Perform(const ArgumentTuple& args) const {
    return std::get<1>(args); // Return 2nd argument
  }
};

auto ReturnSecondArg() {
  return ::testing::MakePolymorphicAction(ReturnSecondArgAction());
}

...
EXPECT_CALL(mock, Func(_, _))
    .WillOnce(ReturnSecondArg());
```

### Best Practices

- Prefer lambdas or `ACTION_P` macros for simple parameterized actions.
- Use polymorphic actions when your custom action applies to multiple function signatures.
- For clarity, isolate complex logic in named callable objects or classes.

---

## Custom Action Templates and Extending GoogleMock

GoogleMock is designed to be extensible. If the provided actions do not meet your needs, you can extend the framework with your own:

### Writing Custom Actions

- Create a callable type (functor or lambda) compatible with the mocked function signature.
- Use `Invoke(callable)` or directly assign your callable to `WillOnce()`/`WillRepeatedly()`.

Example:

```cpp
struct MultiplyBy {
  int factor;
  int operator()(int x) const { return x * factor; }
};

EXPECT_CALL(mock, Process(_))
    .WillOnce(MultiplyBy{10});
```

### ActionInterface

For advanced cases, implement `testing::ActionInterface<F>` where `F` is the mocked function type:

```cpp
template <class F>
class MyAction : public ::testing::ActionInterface<F> {
 public:
  ResultType Perform(const ArgumentTuple& args) override {
    // your logic
  }
};
```

Use `MakeAction(new MyAction)` to create an `Action<F>` usable in expectations.

### Using Delegation

- Delegate mock method behavior to a real or fake object to keep consistency and reuse logic.
- See the gMock Cookbook section on Delegating Calls to a Fake or a Real Object.

### Managing Strictness

Control how uninteresting calls are handled with `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>` wrappers. Choose based on your desired test expressiveness and noise level.

---

## Practical Tips and Common Pitfalls

- Always set your expectations **before** exercising the mock.
- Avoid excessive or too-specific expectations; prefer clear, maintainable, and minimal prescriptions.
- Use `RetiresOnSaturation()` to prevent upper-bound-saturated expectations from blocking other matches.
- When invoking callable arguments, ensure they are still valid and correctly captured (use `std::ref`).
- For actions returning move-only types, prefer lambdas or functors instead of `Return(move(instance))`.

---

## Summary

This reference equips you with advanced GoogleMock techniques to make mocks behave with variable argument lists, reusable parameterization, and custom logic injection. You can now manipulate mocks in complex scenarios requiring dynamic call handling and interaction with callable arguments.

---

## Further Reading

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for custom matchers and actions
- [Mocking Reference](reference/mocking.md) — Detailed explanation of macros and classes
- [Actions Reference](docs/reference/actions.md) — Built-in and custom actions
- [Strictness and Mock Behavior Modes](docs/gmock_cook_book.md#NiceStrictNaggy) — Controlling uninteresting call behavior
- [Extending GoogleMock](guides/integration-advanced/extending-framework.md) — Guide to creating new matchers, actions, and mock extensions

---

Explore these sources and practice creating variadic and custom actions tailored to your sophisticated mocking needs for more powerful and maintainable tests.


