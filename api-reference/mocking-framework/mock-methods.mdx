---
title: "Defining Mock Methods"
description: "How to define and implement mock methods using MOCK_METHOD and related macros. Explains support for multiple signatures, call types, and C++ method qualifiers."
---

# Defining Mock Methods

This page explains how to define and implement mock methods using the `MOCK_METHOD` macro and related GoogleMock facilities. It covers support for multiple method signatures, handling C++ method qualifiers, and the proper use of mock macros in your mock classes.

## Overview of MOCK_METHOD

To create mock classes that can intercept and specify behavior for virtual methods, GoogleMock provides the `MOCK_METHOD` macro. This macro syntactically resembles a method declaration, allowing you to conveniently declare mock implementations inside your mock classes.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers...));
```

- **ReturnType**: The return type of the mocked method.
- **MethodName**: The name of the method to mock.
- **Args...**: The argument types and names as a parenthesized list.
- **Qualifiers...**: Optional comma-separated C++ qualifiers such as `const`, `override`, `noexcept`, reference qualifiers (`ref(&)`, `ref(&&)`), and calling conventions (`Calltype(...)`).

### Example

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

### Important Usage Notes

- Always place `MOCK_METHOD` declarations in the `public:` section of your mock class, even if the base class method is `private` or `protected`.
- Wrap argument types containing commas with an extra pair of parentheses to prevent parsing errors.
- You can use type aliases to avoid parentheses when dealing with complex argument types.

```cpp
class MyMock {
 public:
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());

  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

### Supported Qualifiers

You can specify the following qualifiers in the fourth parameter of `MOCK_METHOD`:

| Qualifier                  | Explanation                                                                                  |
|----------------------------|----------------------------------------------------------------------------------------------|
| `const`                    | Marks the mock method as a `const` method. Required if overriding a `const` base method.     |
| `override`                 | Marks the method as `override`. Recommended for overriding virtual methods to catch errors. |
| `noexcept`                 | Marks the method as `noexcept`. Necessary when overriding a `noexcept` method.              |
| `Calltype(calltype)`       | Specifies calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` for Windows COM interfaces. |
| `ref(&)` or `ref(&&)`      | Marks the method with reference qualifiers for lvalue or rvalue references respectively.     |

## Mocking Overloaded Methods

You can mock overloaded functions just like regular functions by providing full signatures.

```cpp
class Foo {
 public:
  virtual int Describe(int type) = 0;
  virtual int Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Describe, (int type), (override));
  MOCK_METHOD(int, Describe, (const char* name), (override));
};
```

### Avoiding Hidden Methods

If you do not mock all overloaded variants, the compiler may warn that some overloads are hidden. You can bring the remaining ones into scope with `using`:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Describe;  // Brings other overloads into scope
  MOCK_METHOD(int, Describe, (int type), (override));
};
```

## Mocking Method Qualifiers

`MOCK_METHOD` supports all relevant C++ method qualifiers:

- `const` methods must be qualified with `(const)`, e.g., `(const, override)`.
- Methods declared `noexcept` in the base class must use `(noexcept)`.
- Reference qualifiers such as `&` or `&&` are specified via `ref(&)` or `ref(&&)`.
- Calling conventions, needed especially on Windows, can be specified using `Calltype(...)`.

Example:

```cpp
MOCK_METHOD(bool, Foo, (int n), (const, noexcept, override));
MOCK_METHOD(int, Bar, (double x, double y), (Calltype(STDMETHODCALLTYPE)));
MOCK_METHOD(void, Baz, (), (ref(&), override));
```

## Handling Complex Argument and Return Types

Since the macro parses commas as separators, any argument or return types with commas (such as template types like `std::pair<int, int>`) must be enclosed in a pair of parentheses, or you should use type aliases.

```cpp
MOCK_METHOD((std::pair<int, int>), GetCoordinates, ());
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetCoordinates, ());
```

## Example: Complete Mock Class

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

This mock class can then be used in tests to set expectations and behaviors for the turtle's actions.

## Using MOCK_METHOD in Templates

Mock templates are defined similarly by using `MOCK_METHOD` inside template mock classes.

```cpp
template <typename Elem>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int GetSize() const = 0;
  virtual void Push(const Elem& x) = 0;
};

template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

This supports any element type while maintaining mock functionality.

## Legacy Macros

Older GoogleMock versions used `MOCK_METHODn`, `MOCK_CONST_METHODn` etc. The new `MOCK_METHOD` macro is preferred for clarity and flexibility. Migration from old macros is encouraged.

## Best Practices

- Keep `MOCK_METHOD` declarations public.
- Always specify `override` for clarity and to catch API mismatches at compile time.
- Use parentheses or type aliases for types containing commas.
- Mock every overload if you intend to use it to prevent compiler warnings.
- Use qualifiers like `const`, `noexcept`, and `Calltype()` to match the base class precisely.

## Troubleshooting Common Pitfalls

- **Parsing errors due to commas in types**: wrap the type in parentheses or use a typedef/using.
- **Compiler warnings about hidden base methods**: bring them into scope using `using BaseClass::MethodName;`.
- **Destructors cannot be mocked**: instead, mock a method and call it from the destructor if you need destructor observation.

## Related Facilities

- `EXPECT_CALL` to set expectations on mock methods.
- `ON_CALL` for setting default behaviors.
- `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to control behavior for unexpected/uninteresting calls.

For detailed usage, see [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html).

---

<AccordionGroup title="Example: Complex Return Types and Overloads">
<Accordion title="Handling Commas in Types">
```cpp
class MyMock {
 public:
  // Wrap return type in parentheses to avoid macro parse errors
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());

  // Wrap arguments containing commas
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

  // Or use type aliases
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```
</Accordion>
<Accordion title="Mocking Private and Protected Methods">
You always declare mock methods `public`, even if the original method is `private` or `protected`:

```cpp
class Base {
 protected:
  virtual void Foo() = 0;
};

class MockBase : public Base {
 public:
  MOCK_METHOD(void, Foo, (), (override));  // Must be public here
};
```
</Accordion>
<Accordion title="Using MOCK_METHOD with Qualifiers">
To correctly mock methods with qualifiers, specify them explicitly:

```cpp
MOCK_METHOD(void, Func, (), (const, override));
MOCK_METHOD(int, Func, (int x), (noexcept, override));
MOCK_METHOD(void, FuncRef, (), (ref(&), override));
MOCK_METHOD(int, FuncCalltype, (double), (Calltype(STDMETHODCALLTYPE)));
```
Note: For details on calling conventions, see platform-specific docs.
</Accordion>
</AccordionGroup>

---