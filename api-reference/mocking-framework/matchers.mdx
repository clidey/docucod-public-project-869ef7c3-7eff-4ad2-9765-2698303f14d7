---
title: "Matchers: Argument Matching & Patterns"
description: "Details the set of built-in and extensible argument matchers that enable expressive, reliable matching of method calls and arguments in mock expectations, including composing custom matchers for advanced scenarios."
---

# Matchers: Argument Matching & Patterns

GoogleMock offers a rich set of built-in and extensible argument matchers that enable expressive, reliable matching of method calls and their arguments in mock expectations. This page details how to use these matchers effectively, including how to write custom matchers for advanced testing scenarios.

---

## Understanding Matchers

Matchers are predicates used in `EXPECT_CALL`, `ON_CALL`, and `EXPECT_THAT` statements to specify which calls to mock methods are expected. Each matcher operates on a single argument or, in the case of multi-argument matchers, a tuple representing multiple arguments.

### Basic Matchers

- **Wildcard matcher `_`**: matches any value.
- **Value matchers**: Implicitly created from literal values (e.g., `5` means `Eq(5)`).
- **Type matchers `A<T>()` or `An<T>()`**: matches any value of type `T`.

### Using Matchers in `EXPECT_CALL` and `EXPECT_THAT`

When specifying expectations or assertions, you can use:

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;

EXPECT_CALL(mock_obj, Method(Eq(5), _));  // first arg equals 5, second arg anything
EXPECT_THAT(value, Gt(10));               // value greater than 10
```


## Parameterized Matchers

Matchers can be parameterized to express more complex conditions:

```cpp
MATCHER_P(IsDivisibleBy, n, "") {
  return (arg % n) == 0;
}

EXPECT_CALL(mock_obj, Method(IsDivisibleBy(3)));
```

- Use `MATCHER_P(name, param_name, description_string)` to define matchers with one parameter.
- Support for up to 10 parameters is available as `MATCHER_P2`, `MATCHER_P3`, ...
- The description should reference `negation` and parameters to provide meaningful failure messages.


## Composite Matchers

GoogleMock supports composing matchers using logical operators:

- `AllOf(m1, m2, ...)`: matches if **all** sub-matchers match.
- `AnyOf(m1, m2, ...)`: matches if **any** sub-matcher matches.
- `Not(m)`: negates a matcher.

Example:

```cpp
EXPECT_CALL(mock_obj, Method(AllOf(Gt(5), Ne(10))));
```


## Matching Containers

To validate elements of containers (e.g., vectors, lists, sets), use:

- `ElementsAre(e0, e1, ..., en)`: matches elements in **order**.
- `UnorderedElementsAre(e0, e1, ..., en)`: matches elements ignoring order.
- `ElementsAreArray(container_or_array)`: matches elements exactly from an array-like container.
- `UnorderedElementsAreArray(container_or_array)`: unordered version for arrays.
- `Contains(e)`: at least one element matches `e`.
- `Each(e)`: all elements match `e`.
- `SizeIs(m)`: container size matches matcher `m`.

Example:

```cpp
EXPECT_CALL(mock_obj, Method(ElementsAre(1, Gt(0), _)));
EXPECT_THAT(vec, UnorderedElementsAre(3, 1, 2));
```


## Member Matchers

Use these to match specific fields or properties of argument objects:

- `Field(&Class::field, matcher)`: matches an object whose member `field` matches `matcher`.
- `Field("field_name", &Class::field, matcher)`: same as above but with named field for better messages.
- `Property(&Class::getter, matcher)`: matches an object whose property (getter method) matches `matcher`.

Example:

```cpp
EXPECT_CALL(foo, Bar(Field(&Foo::bar, Ge(3))));
EXPECT_THAT(foo, Property(&Foo::name, StartsWith("John")));
```


## Pointer Matchers

To match pointer arguments or pointer-contained values:

- `IsNull()`: pointer is null.
- `NotNull()`: pointer is not null.
- `Pointee(m)`: pointer points to a value matching `m`.
- `Pointer(m)`: pointer itself matches `m` (can be raw or smart pointer).
- `Address(m)`: matches the address of the object against matcher `m`.
- `WhenDynamicCastTo<T>(m)`: after `dynamic_cast<T>`, matches `m`.

Example:

```cpp
EXPECT_CALL(mock_obj, Method(Pointee(Ge(3))));
```


## Multi-Argument Matchers

GoogleMock supports matching multiple arguments as a whole using tuple matchers:

- `AllArgs(m)`: matches all arguments as a tuple against matcher `m`.
- `Args<N1, N2, ..., Nk>(m)`: matches tuple of selected arguments at specified indices.
- Built-in 2-tuple matchers: `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`.

Example:

```cpp
EXPECT_CALL(mock_obj, Method(_, _))
    .With(AllArgs(Lt()));  // first arg < second arg
```


## Defining Custom Matchers

You can define your own matchers using the `MATCHER` macros:

- `MATCHER(name, description_string) { statements }`: defines a matcher `name`.
- `MATCHER_P(name, param, description_string) { statements }`: defines a parameterized matcher.

Inside the matcher definition, use the variable `arg` to access the value being matched.

Example:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }

EXPECT_CALL(mock_obj, Method(IsEven()));
```

To provide better failure information, stream messages to `*result_listener`.


## Casting Matchers

Sometimes you need to cast a matcher to match a different (but compatible) type.

- Use `SafeMatcherCast<T>(m)` for safe implicit conversions.
- Use `MatcherCast<T>(m)` for more general casts (less safe).

Example:

```cpp
Matcher<Base*> base_matcher = ...;
EXPECT_CALL(mock, Method(SafeMatcherCast<Derived*>(base_matcher)));
```


## Useful Additional Matchers and Utilities

- `Truly(predicate)`: uses an arbitrary unary predicate as a matcher.
- `Matches(m)`: converts a matcher `m` into a predicate for use in algorithms.
- `Optional(m)`: matches an `optional<>` holding a value matching `m`.
- `VariantWith<T>(m)`, `AnyWith<T>(m)`: match `std::variant` or `absl::any` holding values.


## Matcher Usage Tips

- Be careful to avoid side effects inside matchers; they must be pure functions.
- Use `Field` and `Property` matchers to focus checks on important parts of complex objects.
- Combine matchers logically with `AllOf`, `AnyOf`, `Not` for expressive expectations.
- Use `Contains` and `ElementsAre` to verify container contents flexibly.
- For complex or repetitive expectations, assign matchers to variables to reuse.


## Example: Using Matchers in an EXPECT_CALL

```cpp
#include <gmock/gmock.h>
using ::testing::_;  // wildcard matcher
using ::testing::Ge;
using ::testing::Pointee;
using ::testing::Field;

class MockTurtle {
 public:
  MOCK_METHOD(void, GoTo, (int x, int y), ());
  MOCK_METHOD(void, Forward, (int distance), ());
  MOCK_METHOD(void, Draw, (const std::string& desc), ());
};

TEST(DrawingTest, UsesMatchers) {
  MockTurtle turtle;

  // Expect GoTo called with x == 10, any y.
  EXPECT_CALL(turtle, GoTo(10, _));

  // Expect Forward called with a distance >= 100.
  EXPECT_CALL(turtle, Forward(Ge(100)));

  // Expect Draw called with a description starting with "Circle".
  EXPECT_CALL(turtle, Draw(StartsWith("Circle")));

  turtle.GoTo(10, 20);
  turtle.Forward(150);
  turtle.Draw("Circle with radius 10");
}
```


---

## Troubleshooting Common Matcher Issues

- **Type mismatch errors:** Check that the types of your matcher match the types of the mock method's arguments; use `SafeMatcherCast` to help.
- **Unexpected calls:** Make sure all calls are expected or use wildcard `_` matcher to allow anything.
- **Uninteresting call warnings:** Use `NiceMock` or add `EXPECT_CALL(mock, method).Times(AnyNumber())`.
- **Overly strict matchers:** Use more flexible matchers like `Ge()`, `Gt()`, or logical combinations instead of exact equality.
- **Combining multiple arguments:** Use multi-argument matchers with `.With()` and combinators like `AllArgs`, `Args<>()`.

<Tip>
Defining custom matchers with `MATCHER` macros allows highly expressive tests and better failure messages. Always include descriptions referencing `negation` to improve clarity.
</Tip>

---

## References & Next Steps

For further mastery, consult:

- [Mock Object Creation & Usage](../mocking-framework/mock-object-basics) for how matchers fit in mocks
- [Customizing Mock Behavior with Matchers and Actions](../guides/mocking-and-advanced-testing/using-matchers-and-actions) for strategies to use matchers and actions effectively
- [Matchers Reference](reference/matchers.md) for a treatise on all built-in matchers
- [gMock Cookbook: Writing New Matchers Quickly](gmock_cook_book.md#NewMatchers) for recipes on custom matcher design

Use this page as your definitive reference for composing and leveraging argument matchers to build robust, readable, and maintainable mock-based tests.

---

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-982"}]} />
