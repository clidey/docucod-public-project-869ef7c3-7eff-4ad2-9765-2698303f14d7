---
title: "Argument Matchers"
description: "Details built-in and custom matcher APIs for verifying arguments in mock expectations. Includes matcher interfaces, built-in matchers for equality, comparison, regex, and extension patterns."
---

# Argument Matchers

This documentation details the built-in and custom matcher APIs provided by GoogleMock for verifying arguments in mock expectations. It includes matcher interfaces, and extensive built-in matchers for equality, comparisons, regex, and extension patterns that empower users to express complex expectations on mock method arguments.

---

## Overview

Argument matchers allow you to specify flexible constraints on the arguments expected by mocked methods when setting up expectations with `EXPECT_CALL()`. Instead of hard-coding exact argument values, matchers let you express predicates such as "greater than 5", "starts with \"foo\"", or "any value".

Matchers are central to the value of GoogleMock, enabling expressive and robust tests that focus on intended behavior rather than brittle exact values.

All matchers are designed to be **pure functional predicates**, must not produce side effects, and support detailed failure messages that help diagnose why an argument did not match.

---

## Basic Matcher Concepts

- Matchers are used inside `EXPECT_CALL(mock_obj, MockMethod(matchers...))` to specify the expected arguments.
- The special matcher `_` matches any value of any type and is often used as a wildcard.
- Literal values used as arguments are implicitly converted to equality matchers (`Eq()`).
- Matchers can be combined, negated, parameterized, and customized.
- Built-in matchers cover common needs like equality, relational comparisons, string patterns, null pointers, container contents, and more.
- You can define *custom matchers* using `MATCHER` macros or by implementing the matcher interface.

---

## Using Built-in Matchers

### Equality and Comparison Matchers

- `Eq(value)`: Matches if the argument equals the specified value.
- `Ne(value)`: Matches if the argument is not equal to the specified value.
- `Gt(value)`, `Ge(value)`, `Lt(value)`, `Le(value)`: Match greater than, greater than or equal, less than, or less than or equal to respectively.

**Usage Example:**
```cpp
EXPECT_CALL(mock_obj, Foo(Ge(10), Eq("Hello"), Ne(nullptr)));
```

### Wildcard Matchers

- `_`: Matches any value of any type.
- `A<T>()` or `An<T>()`: Matches any value of type `T`.

**Usage Example:**
```cpp
EXPECT_CALL(mock_obj, Bar(_, A<int>(), An<std::string>()));
```

### Null Pointer Matchers

- `IsNull()`: Matches any null pointer (raw or smart pointers).
- `NotNull()`: Matches any non-null pointer.

### Reference Matcher

- `Ref(variable)`: Matches any argument that references the *same* variable instance.

### Floating Point Matchers

- `FloatEq(value)`, `DoubleEq(value)`: Approximate equality for floats or doubles.
- `FloatNear(value, tol)`, `DoubleNear(value, tol)`: Approximate equality within an absolute tolerance.

These matchers are crucial when comparing floating-point values to avoid precision issues.

### String Matchers

- `StrEq(string)`, `StrNe(string)`: Equality or inequality matchers for strings.
- `StrCaseEq(string)`, `StrCaseNe(string)`: Case-insensitive string equality or inequality.
- `HasSubstr(substring)`: Matches strings containing a substring.
- `StartsWith(prefix)`, `EndsWith(suffix)`: Matches strings with given prefix or suffix.
- `MatchesRegex(regex)`, `ContainsRegex(regex)`: Matches strings against a regex fully or partially.

**Usage Example:**
```cpp
EXPECT_CALL(mock_obj, Log(StrCaseEq("ERROR"), HasSubstr("out of memory")));
```

### Container Matchers

- `ElementsAre(...)`: Matches container with elements matching given matchers in order.
- `UnorderedElementsAre(...)`: Matches container with elements matching given matchers in any order.
- `ElementsAreArray(array)`, `UnorderedElementsAreArray(array)`: Same as above but takes an array or container.
- `Contains(matcher)`: Container contains *at least one* element matching `matcher`.
- `Each(matcher)`: All elements in container match the given matcher.
- `SizeIs(size_matcher)`: The container's size matches the given matcher.
- `Pointwise(tuple_matcher, container)`: Matches containers element-wise applying tuple matcher.
- `Pair(first_matcher, second_matcher)`: Matches `std::pair` objects.
- `Key(matcher)`: Matches the key of a `std::pair` or map element.

**Usage Example:**
```cpp
EXPECT_CALL(mock_obj, ProcessVector(ElementsAre(Gt(0), 10, _)));
EXPECT_CALL(mock_obj, LookupMap(Contains(Key(Eq(42)))));
```

### Pointer and Value Matchers

- `Pointee(matcher)`: Matches pointers that point to a value matching `matcher`. Treats `nullptr` as non-matching.
- `Pointer(matcher)`: Matches pointers themselves matching `matcher`.
- `Address(matcher)`: Matches objects with addresses matching `matcher`.

### Tuple and Member Matchers

- `Field(&Class::member, matcher)`: Matches objects whose field matches.
- `Property(&Class::getter, matcher)`: Matches objects whose property (getter method) matches.
- `FieldsAre(...)`: Matches multi-field aggregates or tuples.

### Composite Matchers

- `AllOf(m1, m2, ...)`: Matches if all sub-matchers match.
- `AnyOf(m1, m2, ...)`: Matches if any sub-matcher matches.
- `Not(m)`: Matches if matcher `m` does not match.
- `Conditional(cond, m1, m2)`: Matches `m1` if `cond` is true, otherwise `m2`.

### Predicate Matchers

- `Truly(predicate)`: Converts a unary predicate into a matcher.
- `Matches(matcher)`: Converts a matcher into a predicate for use in algorithms.

### Multi-argument Matchers

- `With(multi_argument_matcher)`: Matches the entire tuple of arguments as a whole.
- `Args<k1,k2,...>(matcher)`: Matches selected values from the argument tuple.

This feature is useful to express constraints across multiple arguments.

---

## Setting Expectations Using Matchers

When using `EXPECT_CALL(mock, Method(matchers...))`, the matchers determine which calls match the expectation. Only calls whose arguments match all specified matchers are counted.

**Examples:**
```cpp
EXPECT_CALL(mock, Foo(Ge(10), _, StrCaseEq("test")));
EXPECT_CALL(mock, Bar(_));  // Matches any call to Bar.
EXPECT_CALL(mock, Baz());   // For non-overloaded methods, same as Bar(_).
```

You can omit the argument list for non-overloaded methods to mean "any arguments".

Remember that specifying matchers too restrictively can make tests brittle, while specifying matchers too loosely may allow bugs to slip through.

---

## Writing Custom Matchers

You can quickly define new matchers using the `MATCHER` family of macros.

### Simple Custom Matcher

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
```
Allows usage:
```cpp
EXPECT_CALL(mock, Method(IsEven()));
```

### Parameterized Matcher

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return std::abs(arg) == value;
}
```
Allows usage:
```cpp
EXPECT_THAT(x, HasAbsoluteValue(10));
```

### Enhancing Failure Messages

Within the matcher body, stream additional explanations to `result_listener` to improve diagnostics.

---

## Best Practices with Matchers

- Use `_` to express "any value" when the argument value is not important.
- Prefer matchers over literal values to improve flexibility and diagnostic quality.
- Avoid overly strict matchers that constrain implementation unnecessarily.
- Use `With()` or multi-argument matchers to express cross-parameter constraints.
- When matching complex arguments, consider using container matchers or custom matchers to express intent clearly.
- Leverage built-in string and container matchers for common patterns.
- Create custom matchers when the built-in set doesn’t satisfy your needs.

---

## Troubleshooting Common Issues

- **Ambiguous Overloaded Methods:** When mocking overloaded methods, you may need to disambiguate which overload you mean by specifying argument matchers or wrapping matchers with `Matcher<Type>()`.
- **Unmatched Arguments:** When an expected method call fails due to mismatched arguments, the failure message will explain the mismatch using matchers’ `DescribeTo()` and `DescribeNegationTo()` methods.
- **Uninteresting Calls:** Calls to mock methods without expectations emit warnings by default. Use `NiceMock` to suppress warnings or add catch-all `EXPECT_CALL` clauses with `_` matcher to allow them.

---

## Related Capabilities

- To set *actions* when mock methods are called, use `ON_CALL()` or `EXPECT_CALL().WillOnce()/WillRepeatedly()` with actions that complement matchers.
- See [Matchers Reference](reference/matchers.md) for comprehensive list and details of all built-in matchers.
- Use `SafeMatcherCast<T>(m)` when you need to coerce matcher types safely (e.g., matching an `int` argument with `Matcher<long>`).
- Use `EXPECT_THAT(value, matcher)` assertions to verify values using matchers outside mocks.

---

## Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Mocking Reference](reference/mocking.md)
- [Matchers Reference](reference/matchers.md)
- [gMock Cookbook](gmock_cook_book.md#NewMatchers)

---

## Summary

Argument matchers are essential tools enabling expressive, flexible mock expectations. GoogleMock provides a rich set of built-in matchers for equality, comparisons, string operations, container contents, pointer properties, and tuple fields, alongside facilities to write custom matchers using simple macros. Using matchers effectively improves test resilience and diagnostic clarity.

---

<AccordionGroup title="Commonly Used Matchers">
<Accordion title="Equality and Comparison Matchers">
Use `Eq()`, `Ne()`, `Gt()`, `Ge()`, `Lt()`, `Le()` to specify exact or relational argument conditions.
</Accordion>
<Accordion title="Wildcard Matcher `_`">
Matches any argument value of any type.
</Accordion>
<Accordion title="String Matchers">
Includes `StrEq()`, `StrCaseEq()`, `HasSubstr()`, `StartsWith()`, `EndsWith()`, `MatchesRegex()`, and others.
</Accordion>
<Accordion title="Container Matchers">
Use `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, and more to match containers' contents.
</Accordion>
<Accordion title="Pointer Matchers">
Includes `IsNull()`, `NotNull()`, `Pointee()`, and pointer-related validations.
</Accordion>
<Accordion title="Custom Matchers">
Define custom matchers easily with `MATCHER` macros or full matcher interface classes.
</Accordion>
</AccordionGroup>