---
title: "Defining Mock Classes & Methods"
description: "Shows how to declare and implement mock classes and methods using core macros and templates. Covers syntax, signature matching, and integration with test cases."
---

# Defining Mock Classes & Methods

This page demonstrates how to declare and implement mock classes and their methods using GoogleMock's core macros and templates. It covers the essential syntax patterns, signature matching rules, and how to seamlessly integrate these mocks with your test cases for effective interaction-based testing.

---

## Overview of Mock Classes

Creating mock classes is fundamental to using GoogleMock effectively. A mock class mocks the behavior of a real class or interface, allowing you to specify expectations and behaviors for method calls during tests.

### Defining a Mock Class

To define a mock class:

1. Derive a new class from the interface or class you want to mock.
2. Use the `MOCK_METHOD` macro within the `public` section to declare mocked methods.
3. Match the method signatures precisely, including return types, argument types, qualifiers, and specifiers.

```cpp
#include <gmock/gmock.h>  // Include GoogleMock facilities

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar element, int count), (override));
};
```

> **Note:** Always put `MOCK_METHOD` declarations in the `public:` section regardless of the access level of the original methods. This allows GoogleMock macros like `ON_CALL` and `EXPECT_CALL` to work correctly.

### Method Signature Matching

- The `MOCK_METHOD` macro takes the method return type, method name, argument list enclosed in parentheses, and optionally a list of qualifiers in parentheses.
- Qualifiers include:
  - `const` (for const methods)
  - `override` (recommended for overriding virtual methods)
  - `noexcept`
  - Calling convention specifiers like `Calltype(STDMETHODCALLTYPE)`
  - Reference qualifiers like `ref(&)` or `ref(&&)`

```cpp
MOCK_METHOD(void, Foo, (int a, double b), (const, override));
```

- If your method arguments or return types contain commas (e.g., `std::pair` or `std::map`), wrap the entire type in extra parentheses or use type aliases to ensure correct macro parsing.

```cpp
// Using parentheses to group
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// Using type alias
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```

### Mocking Overloaded Methods

All overloads must be mocked separately:

```cpp
MOCK_METHOD(int, Add, (int x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));
MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

If you do not mock all overloads, consider using `using BaseClass::MethodName;` to avoid compiler warnings about hiding base class overloads.

### Mocking Class Templates

Class templates can be mocked similarly by templating the mock class:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### Mocking Non-virtual Methods

Instead of inheritance, you can mock classes with non-virtual methods by defining a mock class with the same method signatures but no inheritance. Use template programming to select between mock and real classes at compile time.

```cpp
class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

### Old-style `MOCK_METHODn` Macros

The older `MOCK_METHODn` macros remain supported but migration to `MOCK_METHOD` is recommended for better clarity and consistency.

---

## Using the `MOCK_METHOD` Macro

### Basic Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgumentTypes...), (Qualifiers));
```

- The argument list must be enclosed in parentheses. If any argument or return type contains commas, apply additional parentheses or use type aliases.
- Qualifiers are optional but necessary to faithfully mock the original method behavior.

### Example

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Tips for Defining Mocks

- Always declare mock methods in the `public:` section, even when mocking protected or private methods.
- To mock const methods, include `(const, override)` as qualifiers.
- For noexcept methods, include `(noexcept, override)`.
- For Windows-specific calling conventions, use `(Calltype(STDMETHODCALLTYPE), override)`.

### Mocking Private or Protected Methods

Declare the mock method as public in the mock derived class regardless of access in the base class.

```cpp
class Foo {
 protected:
  virtual void Resume();
 private:
  virtual int GetTimeout();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Resume, (), (override));
  MOCK_METHOD(int, GetTimeout, (), (override));
};
```

---

## Integrating Mocks with Tests

Once you've defined your mock class, you create instances of it in your tests. You then use `EXPECT_CALL` and `ON_CALL` macros to setup expectations and default behaviors.

```cpp
MockTurtle turtle;
EXPECT_CALL(turtle, PenDown()).Times(1);
ON_CALL(turtle, GetX()).WillByDefault(Return(10));

// Your testing code here that exercises the mock
```

Your test will verify at runtime that the calls match your expectations.

---

## Advanced Mock Class Usage

### Mocking Move-Only Types

GoogleMock supports mocking methods that accept or return move-only types such as `std::unique_ptr`. Use the standard `MOCK_METHOD` macro without `override` for non-virtual methods.

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
```

For return actions involving move-only types, prefer `WillOnce` with lambdas to generate fresh objects each time.

### Delegating Calls

You can delegate mock method calls to real or fake implementations within your mock class for default behavior.

### Defining Mock Constructors and Destructors

To speed up compilation, define your mock class constructors and destructors in the `.cc` file instead of inline.

### Combining with Strict, Nice, and Naggy Mocks

Use wrappers `StrictMock<YourMock>`, `NiceMock<YourMock>`, or `NaggyMock<YourMock>` to control warnings or errors on uninteresting calls.

```cpp
NiceMock<MockFoo> nice_foo;
StrictMock<MockFoo> strict_foo;
```

---

## Common Pitfalls and Best Practices

- *Set expectations before exercising the mock*: `EXPECT_CALL` statements must appear before the code that invokes the mock method.
- *Specify qualifiers precisely*: Catalyze issues if qualifiers like `const` or `noexcept` differ between mock and base classes.
- *Avoid mocking non-virtual methods unless using template-based techniques.*
- *Use type aliases or wrapping parentheses when types have commas* in them to avoid macro parsing errors.
- *Leverage sequences and call order constraints* (`InSequence`, `After`) when call ordering matters.

---

## Example: Complete Mock Class Definition

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual void AddItem(const std::string& item) = 0;
  virtual bool RemoveItem(int index) noexcept = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, AddItem, (const std::string& item), (override));
  MOCK_METHOD(bool, RemoveItem, (int index), (noexcept, override));
};
```

---

## Troubleshooting Tips

- Compilation errors often stem from incorrect mock method signatures, especially missing or extra qualifiers.
- If you get linking errors, verify that your mock methods are declared correctly and GoogleMock headers are included.
- If unexpected mock calls produce warnings or failures, ensure expectations are correctly set up and in scope.
- Use `--gmock_verbose=info` command line flag to get detailed mock call traces.
- Use `Mock::VerifyAndClearExpectations(&mock)` to force early verification of expectations if needed.

---

## See Also

- [gMock for Dummies](../guides/getting_started_workflows/using_mocks_and_matchers) for beginners learning to use mocks and matchers
- [Mocking Reference](../api-reference/mocking-framework/mock-classes-methods) for comprehensive mock API details
- [Setting Expectations & Actions](../api-reference/mocking-framework/expectations-actions) for configuring mock behaviors
- [Mocking Patterns and Best Practices](../guides/common_patterns_scenarios/mocking_patterns_and_strategies) for practical advice
- [Matchers Reference](../api-reference/mocking-framework/matchers) for argument matching techniques
- [GoogleTest Primer](../overview/getting-started-value/product-intro) for getting started

---

This page fits within the larger GoogleTest documentation by providing users with the precise know-how needed to declutter their tests, isolate components, and improve test reliability using GoogleMock's powerful mocking capabilities.