---
title: "Defining Mock Objects"
description: "Guides users through the process of defining mock classes and methods using GoogleMock macros and templates. Shows how to employ the MOCK_METHOD family and understand their integration with test cases."
---

# Defining Mock Objects

GoogleMock (gMock) empowers you to define mock classes and methods in C++ using intuitive macros and templates. This page guides you through declaring mock methods with the `MOCK_METHOD` macro, setting expectations using `EXPECT_CALL`, and specifying default behaviors with `ON_CALL`. By mastering these building blocks, you can create precise and readable tests that verify interactions with dependencies effortlessly.

---

## Overview of Defining Mock Objects

At the heart of gMock’s mocking capabilities lies the ability to declare mock classes and mock methods that simulate the behavior of real classes and interfaces.

- Use `MOCK_METHOD` macros inside mock classes to declare mock methods that override virtual functions of your interfaces.
- Use `ON_CALL` to define default behaviors that execute when no explicit call expectations match.
- Use `EXPECT_CALL` to set expectations on method invocations, specifying argument matchers, invocation counts, and actions.

The mocking syntax forms a domain-specific language that lets you express how your mock objects should behave and be verified in tests.


---

## Declaring Mock Methods with `MOCK_METHOD`

The `MOCK_METHOD` macro defines mock methods inside your mock class. It mirrors the signature of the real virtual method you want to mock.

### Syntax

```cpp
MOCK_METHOD(return_type, method_name, (argument_types...), (optional_qualifiers));
```

- **return_type**: The function's return type.
- **method_name**: Name of the method.
- **argument_types**: Parenthesized argument list.
- **optional_qualifiers**: Comma-separated qualifiers enclosed in parentheses such as `const`, `override`, `noexcept`, or calling convention specifiers.

### Key Qualifiers

| Qualifier                  | Purpose                                    |
| -------------------------- | ------------------------------------------ |
| `const`                    | Marks the method as a const member function. Required if overriding const methods. |
| `override`                 | Specifies the method overrides a virtual method. Recommended to catch mismatches. |
| `noexcept`                 | Declares the method as `noexcept`, matching the base method. |
| `Calltype(convention)`     | Sets the calling convention, e.g., for Windows interoperability. |
| `ref(&)` or `ref(&&)`      | Reference qualifiers if the base method has them. |

### Handling Commas in Types

Types like `std::pair<bool, int>` or templates with commas must be parenthesized or aliased to avoid parsing errors.

Example:

```cpp
class MyMock {
 public:
  // Incorrect: will cause compilation errors.
  // MOCK_METHOD(std::pair<bool, int>, GetPair, ());
  // MOCK_METHOD(bool, CheckMap, (std::map<int, double>, bool));

  // Correct: wrap types with parentheses
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

  // Or define aliases
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

### Best Practices

- Always put `MOCK_METHOD` declarations in the `public` section, even if the original method is protected or private.
- Use `override` to ensure your mock method signature matches the base class method.
- Ensure all pure virtual methods of your interface are mocked.

---

## Specifying Mock Object Behavior

### Using `ON_CALL` to Define Default Actions

`ON_CALL(mock_object, Method(matchers...))` lets you specify what happens by default when a mock method is called without an explicit `EXPECT_CALL` matching the invocation.

#### Syntax

```cpp
ON_CALL(mock_object, Method(matchers...))
    .With(multi_argument_matcher)?
    .WillByDefault(action);
```

- `.With()` is optional and restricts the call based on a multi-argument matcher.
- `.WillByDefault()` must be called exactly once to specify the action.

The specified default action applies if no matching `EXPECT_CALL` is found.

**Example:**

```cpp
ON_CALL(my_mock, GetPosition(_, _))
    .With(Lt())  // The first argument less than the second
    .WillByDefault(Return(true));
```

### Using `EXPECT_CALL` to Set Expectations and Actions

`EXPECT_CALL(mock_object, Method(matchers...))` sets an expectation that the mock method will be called with arguments matching the matchers.

#### Basic Syntax

```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .With(multi_argument_matcher)?
    .Times(cardinality)?
    .InSequence(sequences...)*
    .After(expectations...)*
    .WillOnce(action)*
    .WillRepeatedly(action)?
    .RetiresOnSaturation()?;
```

- All clauses except `WillOnce()`, `WillRepeatedly()` and `Times()` are optional.
- `.With()` can only occur once and must be the first clause.
- `.Times()` sets expectation cardinality (number of expected calls).
- `.InSequence()` enforces call order within sequences.
- `.After()` enforces calls after specified expectations.
- `.WillOnce()` defines actions for consecutive calls.
- `.WillRepeatedly()` defines fallback behavior after `WillOnce` actions.
- `.RetiresOnSaturation()` retires the expectation once saturated.

#### Cardinalities with `.Times()`

| Expression          | Meaning                                    |
| ------------------- | ------------------------------------------ |
| `AnyNumber()`       | Expect any number of invocations            |
| `AtLeast(n)`        | Expect at least n calls                      |
| `AtMost(n)`         | Expect at most n calls                       |
| `Between(m, n)`     | Expect between m and n calls (inclusive)   |
| `Exactly(n)` or `n` | Expect exactly n calls; `0` disallows calls |

If `.Times()` is omitted, gMock infers cardinality based on presence of `WillOnce` and `WillRepeatedly`.

#### Example

```cpp
using ::testing::Return;

EXPECT_CALL(my_mock, GetNumber())
    .Times(3)
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillOnce(Return(3));
```

This expects three calls, returning 1, 2, and 3 respectively.

Extensions like `.InSequence()` and `.After()` allow you to specify precise call ordering.

### Effective Use of `ON_CALL` vs. `EXPECT_CALL`

- Use `ON_CALL` to specify default behavior without intent to verify call occurrence.
- Use `EXPECT_CALL` when you want to verify that calls occur with specific arguments.
- Overusing `EXPECT_CALL` can lead to brittle tests; favor minimal necessary constraints.

---

## Working with Mock Classes

### Defining a Mock Class

To create a mock class:

1. Derive your mock from the interface or base class.
2. Use `MOCK_METHOD` for virtual functions you want to mock.

**Example:**

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int) = 0;
  virtual void Turn(int) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int), (override));
  MOCK_METHOD(void, Turn, (int), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Using Nice, Naggy, and Strict Mocks

- **NaggyMock** (default): Warns on uninteresting calls.
- **NiceMock**: Suppresses uninteresting call warnings.
- **StrictMock**: Treats uninteresting calls as failures.

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockTurtle> nice_turtle;
NaggyMock<MockTurtle> naggy_turtle;
StrictMock<MockTurtle> strict_turtle;
```

### Important Notes

- Always set expectations before exercising the mock.
- `EXPECT_CALL` statements specify future calls, not past calls.
- Virtual destructors are essential for base classes to avoid leaks and undefined behavior.

---

## Comprehensive Example

Here's a complete example showcasing mock class definition, default behaviors, expectations, and test usage:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

using ::testing::AtLeast;
using ::testing::Return;

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  // Default action: Forward returns immediately (void), GetX returns 0
  ON_CALL(turtle, GetX()).WillByDefault(Return(0));

  // Expect PenDown to be called at least once
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  // Exercise your production code using turtle mock
  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(10));
}
```

---

## Troubleshooting Common Issues

### Why Does gMock Warn About Uninteresting Calls?

If a mock method is called without any expectation (`EXPECT_CALL`), you get a warning about an uninteresting call. This is gMock reminding you to confirm whether you want to allow that or not.

**Solution:**
- Use `ON_CALL` to define default behavior.
- Use `EXPECT_CALL(...).Times(AnyNumber())` to explicitly allow any calls.
- Use `NiceMock` to suppress warnings.

### Why Am I Getting Multiple Failure Messages?

gMock reports failures at every violation, including times when the state hasn’t changed. These are different points in time reflecting the test flow.

### How to Assert That a Function Is Never Called?

Use:

```cpp
EXPECT_CALL(mock_obj, Method(_)).Times(0);
```

This sets the expectation that the method will not be invoked.

### How to Mock Methods with Complex or Move-Only Arguments?

- For move-only types like `std::unique_ptr`, `MOCK_METHOD` supports normal declaration.
- Set appropriate return actions using lambdas or `Return()` with `std::make_unique`.

### Virtual Destructor Reminder

Always ensure the interface you mock has a virtual destructor to avoid leaks and undefined behavior.

---

## Best Practices and Tips

- **Define all mock methods in the `public` section** to prevent access issues.
- **Use `override` qualifiers** on mocked methods to catch signature mismatches.
- **Set expectations before exercising mock objects** to avoid undefined behavior.
- **Combine `ON_CALL` and `EXPECT_CALL` effectively:** Set default behaviors with `ON_CALL`, and impose constraints using `EXPECT_CALL` only when necessary.
- **Prefer sequences or `.RetiresOnSaturation()` to manage call ordering and expectations lifecycle effectively.**
- **For overloaded methods, specify arguments precisely** to avoid ambiguity.
- **Use matchers (`_`, `Eq()`, custom matchers) to flexibly match arguments.**

---

## Related Documentation

- [Mocking Reference](../reference/mocking.md) — full API reference on macros, clauses, and classes.
- [gMock Cookbook](../gmock_cook_book.md) — comprehensive recipes for practical mocking scenarios.
- [gMock Cheat Sheet](../gmock_cheat_sheet.md) — concise summary of commonly used mocking syntax and patterns.
- [Introduction to Mocking](../../guides/mocking-real-world/intro-mocking.md) — tutorial-style guide for beginners.
- [Expectations and Behaviors](../../guides/mocking-real-world/expectations-behaviors.md) — guides on setting invocation counts and actions.

---

## Summary

By defining mock classes with `MOCK_METHOD` macros and controlling behavior via `EXPECT_CALL` and `ON_CALL` macros, GoogleMock enables powerful, readable, and reliable unit testing. This empowers you to test code interactions precisely while managing complexity and minimizing brittle test designs.

---

## Mermaid Diagram

```mermaid
flowchart TD
  A[Start: Define Mock Class] --> B[Declare MOCK_METHOD for virtual methods]
  B --> C[Set ON_CALL for default behaviors]
  C --> D[Set EXPECT_CALL to define expectations]
  D --> E[Exercise code using mock objects]
  E --> F[Mock methods called during test execution]
  F --> G{Does call match EXPECT_CALL?}
  G -- Yes --> H[Perform specified action]
  G -- No --> I{Does ON_CALL match?}
  I -- Yes --> J[Perform default action]
  I -- No --> K[Handle uninteresting call (warn or error)]
  H --> L[Verify expectations at test teardown]
  J --> L
  K --> L
  L --> M[End: Pass or Fail test]

  classDef decision fill:#f9f,stroke:#333,stroke-width:2px;
  class G,I decision;
```
