---
title: "Defining Mock Objects"
description: "Explains how to use the MOCK_METHOD macros and supporting utilities to declare mock classes, specify method signatures, and ensure compatibility with tested interfaces. Provides practical advice for integrating mocks into real-world C++ test code."
---

# Defining Mock Objects

GoogleMock offers a concise and powerful way to declare mock classes using the `MOCK_METHOD` macros. This page equips you with practical knowledge on defining mock classes, specifying method signatures, and ensuring your mock implementations align correctly with the interfaces you want to test.

---

## Overview

When testing C++ code, mock objects simulate behavior of real classes or interfaces to help validate interactions and internal logic. GoogleMock simplifies creating such mocks by generating method implementations via macros, eliminating boilerplate.

At its core, mocking involves:

- **Declaring mock methods** with correct signatures and qualifiers.
- **Setting expectations** on how and when these methods are called.
- **Specifying behaviors or return values** through actions.

This page focuses on the first step: using the `MOCK_METHOD` macros to define mock methods.

---

## MOCK_METHOD Macro

The fundamental macro to declare a mock method is `MOCK_METHOD`. Its syntax is:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specifiers));
```

- **ReturnType:** The return type of the method.
- **MethodName:** The method's name.
- **Args...:** A comma-separated list of argument types wrapped in parentheses.
- **Specifiers:** An optional comma-separated list of qualifiers wrapped in parentheses.

### Important Qualifiers (`Specifiers`)

Qualifiers control method behavior and compatibility. Common ones include:

- `const`: For mocking `const` methods.
- `override`: Recommended when overriding virtual methods.
- `noexcept`: For methods declared as `noexcept`.
- `Calltype(...)`: To specify calling convention (e.g., WINAPI) mainly on Windows.
- `ref(...)`: For reference qualifiers such as `ref(&)` or `ref(&&)`.

Always include qualifiers that match the base method to ensure correct overriding.

### Examples

```cpp
class MockExample {
 public:
  MOCK_METHOD(void, SimpleMethod, (int x, bool enabled));
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int value), (noexcept, override));
  MOCK_METHOD(bool, CallWinAPI, (int param), (Calltype(STDMETHODCALLTYPE)));
};
```

### Handling Types with Commas

Types containing commas (e.g., templates like `std::pair<bool, int>`) must be wrapped in extra parentheses to avoid parsing errors:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, ProcessMap, ((std::map<int, double>), bool));
```

Alternatively, create type aliases:

```cpp
using BoolInt = std::pair<bool, int>;
MOCK_METHOD(BoolInt, GetPair, ());
```

---

## Best Practices for Defining Mock Classes

### Public Access

Declare all `MOCK_METHOD` macros within the `public:` section regardless of the original method's accessibility (`public`, `protected`, `private`) in the base class. This is required for expectation and action macros (`EXPECT_CALL`, `ON_CALL`) to function properly.

### Mocking Overloaded Methods

Mock all overload variants you care about explicitly. If you mock only some overloads, other overloads from the base class may be hidden and cause warnings. Use `using BaseClass::MethodName;` inside your mock class to bring in unmocked overloads.

### Mocking Template Classes

For class templates, mock methods similarly, ensuring the mock class template inherits from the corresponding interface template:

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual void Push(const T& item) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(void, Push, (const T& item), (override));
};
```

### Mocking Non-Virtual Methods

GoogleMock can mock non-virtual methods by creating mock classes unrelated to the concrete classes but with matching method signatures. Use template-based injection to substitute between real and mock classes at compile time.

---

## Advanced Mocking Features

### Nice, Strict, and Naggy Mocks

- **NaggyMock** (default): Warns about uninteresting calls.
- **NiceMock**: Suppresses warnings for uninteresting calls.
- **StrictMock**: Treats uninteresting calls as failures.

For example:

```cpp
using ::testing::NiceMock;
NiceMock<MockExample> mock; // No warnings on uninteresting calls.
```

### Delegating Calls

- **To a Fake:** You can delegate mock method calls to a fake implementation to reuse logic.
- **To a Real Object:** Similarly, delegate calls to a real instance to validate real behavior alongside expectations.
- **To a Parent Class:** Call the parent class's implementation within an action to preserve known behavior.

### Mocking Destructors

You cannot mock destructors directly. Instead, declare a mock method like `Die()` and call it from your destructor. Then set expectations on `Die()` to track object destruction order.

---

## Practical Examples

### Defining a Mock Class

```cpp
#include <gmock/gmock.h>
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

### Mocking Overloads

```cpp
class Foo {
 public:
  virtual int Bar(int x) = 0;
  virtual int Bar(double x) const = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x), (override));
  MOCK_METHOD(int, Bar, (double x), (const, override));
};

// Use:
MockFoo mock;
EXPECT_CALL(mock, Bar(42));
EXPECT_CALL(Const(mock), Bar(3.14));
```

### Using `using` to Bring in Unmocked Overloads

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Bar;  // Brings unmocked overloads into scope
  MOCK_METHOD(int, Bar, (int x), (override));
};
```

### Handling Complex Return Types

```cpp
class MockFoo {
 public:
  using PairType = std::pair<bool, int>;
  MOCK_METHOD((PairType), GetPair, ());
};
```

### Delegating Calls to a Fake

```cpp
class FakeFoo : public Foo {
 public:
  int Compute(int x) override { return x * 2; }
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Compute, (int x), (override));

  void DelegateToFake() {
    ON_CALL(*this, Compute).WillByDefault(
        [this](int x) { return fake_.Compute(x); });
  }

 private:
  FakeFoo fake_;
};
```

---

## Common Pitfalls and Troubleshooting

- **Parsing Failures on Comma-Containing Types:** Always wrap such types with extra parentheses or define type aliases.
- **Missing Qualifiers:** Ensure you replicate method qualifiers (`const`, `override`, etc) exactly in mocks.
- **Access Level:** `MOCK_METHOD` must be declared `public`, even if overriding protected/private methods.
- **Overloaded Methods Ambiguity:** Bring unmocked overloads back into scope using `using BaseClass::MethodName`.

---

## Tips for Efficient Compilation

Large mock classes with many mocked methods can slow down compilation due to inlined constructors and destructors. Move mock class constructors and destructors into `.cc` files to speed up builds.

---

## Summary

GoogleMock's `MOCK_METHOD` macro is your key for concise, correct, and powerful mocking of C++ classes. Use it to replicate your interfaces precisely, handle qualifiers and overloaded functions safely, and build flexible, maintainable test doubles.

Start with simple mock declarations and progressively adopt advanced techniques like delegation, strictness modes, and careful overload resolution to craft robust test setups.

---

## Further Reading

- [`EXPECT_CALL` and `ON_CALL` Usage](../api-reference/mocking-framework/setting-expectations) - How to specify expectations and behaviors.
- [Matchers Reference](../api-reference/matchers-and-actions/builtin-matchers) - For argument matching.
- [Actions Reference](../api-reference/matchers-and-actions/mock-actions) - For return values and side effects.
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) - Practical recipes and advanced examples.

---

## References

- [GoogleMock MOCK_METHOD Macro](../docs/reference/mocking.md#MOCK_METHOD)
- [gMock for Dummies - Mock Class Writing](../guides/getting-started/first-mock)
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md)

---

## Code Example Revisited

```cpp
#include <gmock/gmock.h>

class MockCalculator : public Calculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
  MOCK_METHOD(void, Reset, (), (override));
  MOCK_METHOD(int, GetLastResult, (), (const, override));
};

// Usage in test:
using ::testing::Return;

TEST(CalculatorTest, AddWorks) {
  MockCalculator mock_calc;
  EXPECT_CALL(mock_calc, Add(3, 4)).WillOnce(Return(7));

  int result = mock_calc.Add(3, 4);
  EXPECT_EQ(result, 7);
}
```
