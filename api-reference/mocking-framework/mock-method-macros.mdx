---
title: "Mock Method Macros"
description: "Explains the MOCK_METHOD family of macros for defining mock methods of various signatures, including handling of qualifiers, call types, and customization options."
---

# Mock Method Macros

This document provides a comprehensive explanation of the `MOCK_METHOD` family of macros defined by GoogleTest's GoogleMock framework, designed to facilitate creating mock methods for testing C++ classes. Including how to define mock methods of various signatures, handle qualifiers like `const` and `noexcept`, configure call types, deal with overloaded and templated methods, and best practices for usage.

---

## Overview

The `MOCK_METHOD` macro simplifies the implementation of mock methods by automatically generating the necessary boilerplate code. It is used inside mock classes to declare mock methods that simulate behaviors of virtual functions from the interfaces under test.

### Basic Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- **ReturnType**: The return type of the method you want to mock.
- **MethodName**: The name of the mock method.
- **(Args...)**: Parenthesized list of parameter types the method accepts.
- **(Qualifiers)**: Optional parenthesized list including method qualifiers such as `(const, override)`.

> The macro **must** be placed in the `public:` section of the mock class, regardless of the access specifier of the method in the base class.


## Handling Method Qualifiers

The optional fourth parameter to `MOCK_METHOD` lets you specify method qualifiers. The recognized qualifiers affect the generated mock method signature:

| Qualifier                    | Description                                                                                      |
|------------------------------|------------------------------------------------------------------------------------------------|
| `const`                      | Marks the method as `const`. Required if overriding a `const` method.                           |
| `override`                   | Appends the `override` keyword to the method signature. Recommended when mocking virtual methods. |
| `noexcept`                   | Marks the method with `noexcept`. Required if overriding a `noexcept` method.                   |
| `Calltype(calltype)`         | Specifies the calling convention (e.g., `Calltype(STDMETHODCALLTYPE)`). Useful largely on Windows.|  
| `ref(&)` or `ref(&&)`        | Specifies the reference qualifier, for mocking methods with lvalue or rvalue reference qualifiers. |

Example with qualifiers:

```cpp
MOCK_METHOD(void, Foo, (int a), (const, override, noexcept));
```


## Special Considerations

### Commas in Arguments and Return Types

Unprotected commas in return or argument types confuse the macro since it interprets commas as separators between parameters. To resolve this:

- **Wrap the type in parentheses:**

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

- **Or use type aliases:**

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
using MapIntDouble = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

### Mocking Overloaded Methods

To mock overloaded methods, declare each overload separately using `MOCK_METHOD`. If you mock only some overloads, expose the others to the mock class's scope using `using` declarations to avoid hiding them:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Expose non-mocked overloads
  MOCK_METHOD(int, Add, (Element x), (override));
  // "Add" overload without parameters is not mocked here
};
```

### Mocking Const Methods

For const methods, add `(const)` to the qualifier list, and `(const, override)` if overriding a virtual method:

```cpp
MOCK_METHOD(int, GetValue, (), (const, override));
```

### Mocking Non-virtual Methods

While `MOCK_METHOD` generally mocks virtual methods, gMock can mock non-virtual methods by defining mock methods with matching signatures in unrelated mock classes. Usage requires static polymorphism or templates to switch implementations between production and tests.

### Calling Conventions on Windows

If you need to specify calling conventions (like `__stdcall`), use the `Calltype` qualifier:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE)));
```

## Example: Defining a Mock Class

Given an interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

You can define a mock class:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```


## Legacy `MOCK_METHODn` Macros

Before the introduction of generic `MOCK_METHOD`, gMock offered macros such as `MOCK_METHOD0`, `MOCK_CONST_METHOD1`, etc., which you might encounter in older codebases or legacy tests. It's recommended to migrate to the modern `MOCK_METHOD` syntax.

Legacy vs New Example:

| Old Macro              | New Macro                                      |
|------------------------|-----------------------------------------------|
| `MOCK_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int))`             |
| `MOCK_CONST_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))` |


## The Nice, Strict, and Naggy Mocks

If `EXPECT_CALL` is not set for a mock method, calling that method results in an *uninteresting call*:

- **NaggyMock (default):** Emits a warning on uninteresting calls.
- **NiceMock:** Suppresses warnings for uninteresting calls.
- **StrictMock:** Fails tests on uninteresting calls.

Use `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>` wrappers around your mock class to select the desired behavior:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;  // Suppresses warnings
```

These wrappers only affect uninteresting calls; unexpected calls (calls that do not match any expectation) cause failures regardless of these wrappers.


## Best Practices and Recommendations

- Always put `MOCK_METHOD` declarations in the public section of your mock class.
- Wrap complex return or argument types with parentheses or use type aliases to avoid parsing errors.
- Use qualifiers to correctly mock the original method's signature, including `const`, `noexcept`, and reference qualifiers.
- For overloaded methods, mock each signature you want to control.
- Use `ON_CALL` and `EXPECT_CALL` separately to set default behavior and expectations, respectively.
- Prefer creating interfaces and mock those instead of mocking concrete classes directly.


## Troubleshooting & Common Pitfalls

- **Compilation errors with commas:** Wrap return types or arguments containing commas in parentheses.
- **Missing `override` or `const` qualifiers:** Ensure you match the exact qualifiers of the method you're mocking.
- **Mock methods with call type:** On Windows, specify calling conventions using `Calltype()`.
- **Warnings on uninteresting calls:** Use `NiceMock` or add catch-all expectations with `.Times(AnyNumber())`.
- **Mocking const overloaded methods:** Use the `Const()` wrapper in `EXPECT_CALL` to specify const overloads.


## References

For further detailed explanations and advanced usage visit:

- [Using gMock for Dummies](gmock_for_dummies.md)
- [gMock Cookbook](gmock_cook_book.md)
- [Matchers Reference](matchers-reference.md)
- [Actions and Macros Reference](actions-and-macros.md)
- [Mock Strictness Wrappers](mock-strictness-wrappers.md)

---

## Illustrative Example

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(SomeTest, TurtleMoves) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(1);
  EXPECT_CALL(turtle, Forward(100)).Times(1);

  // Code that exercises the turtle using the mock...
}
```

This shows defining a mock class and setting method call expectations using `EXPECT_CALL`.


## Additional Notes

- Commas in template types or complex types must be protected as noted to avoid macro parsing issues.
- `const` qualifiers apply carefully depending on method constness, but top-level `const` on parameters is ignored by C++.

---

This page focuses exclusively on the `MOCK_METHOD` macros vital for defining mock methods in tests, complementing guides on setting expectations (`EXPECT_CALL`), default behaviors (`ON_CALL`), and mock strictness wrappers. Users should refer to related API references and user guides for comprehensive understanding and practical testing strategies.

---

<Source url="https://github.com/google/googletest" branch="main" paths='[{"path": "googlemock/include/gmock/gmock-function-mocker.h", "range": "1-258"},{"path": "docs/reference/mocking.md", "range": "1-220"},{"path": "docs/gmock_cook_book.md", "range": "1-550"}]' />