---
title: "Expectations and Cardinalities"
description: "Explains how to set precise expectations for mock calls using cardinalities (e.g., times, at least, at most). Details expectations setup, checking mechanisms, and result interpretation for robust behavioral verification in tests."
---

# Expectations and Cardinalities

GoogleMock's mechanism for verifying the behavior of mock objects hinges on setting precise *expectations* for how many times a method is called during a test. This page dives into the concept of **cardinalities**—the constraints that specify the *number* of expected calls—and explains how to set, check, and interpret these expectations effectively.

---

## Why Set Cardinalities?

Imagine you want to ensure a mock method `Foo()` is called exactly twice, but your test runs, and `Foo()` is called zero or three times—something is clearly off. Cardinalities let you state these expectations explicitly and catch such inconsistencies early. They bring clarity and robustness to your behavioral verification.


## Core Concept: Cardinality

A **cardinality** defines the *count* of expected calls to a mock function in a flexible, expressive way.

Cardinalities can be exact (e.g., exactly 3 times) or fuzzy (e.g., at least 1 time, between 2 and 4 times). Setting the right cardinality is essential to writing tests that are neither too brittle nor too permissive.


## How to Set Cardinalities

Use the `.Times()` clause of `EXPECT_CALL()` to specify the desired cardinality. GoogleMock offers several built-in cardinalities, all under the `::testing` namespace:

| Cardinality        | Description                                |
|--------------------|--------------------------------------------|
| `AnyNumber()`      | Call allowed any number of times           |
| `AtLeast(n)`       | Called at least `n` times                   |
| `AtMost(n)`        | Called at most `n` times                    |
| `Between(m, n)`    | Called between `m` and `n` times inclusively |
| `Exactly(n)` or `n`| Called exactly `n` times; `0` means never called |

### Examples
```cpp
using ::testing::AtLeast;
using ::testing::Exactly;
EXPECT_CALL(mock_obj, Foo()).Times(AtLeast(2));   // At least twice
EXPECT_CALL(mock_obj, Bar(5)).Times(Exactly(3));  // Exactly thrice
EXPECT_CALL(mock_obj, Baz()).Times(0);             // Must not be called
EXPECT_CALL(mock_obj, Quux()).Times(AnyNumber()); // Any number of calls allowed
```


## Cardinality Behaviors and Checks

Beneath the hood, cardinalities implement key operations:

- **IsSatisfiedByCallCount(call_count)**: Returns true if `call_count` meets the expectation.
- **IsSaturatedByCallCount(call_count)**: Returns true if `call_count` has reached or exceeded the upper bound.
- **IsOverSaturatedByCallCount(call_count)**: Returns true if the call count exceeds the maximum allowed.

These checks power gMock’s verification logic, which verifies expectations when mocks are exercised and also at destruction or manual verification.


## What Happens When Expectations Are Violated?

- If calls happen fewer times than expected (under-saturation), the test fails when the mock is destructed or when you explicitly verify.
- If calls happen more times than expected (over-saturation), gMock will report an error immediately on the surplus call.


## Inferring Cardinalities

If you omit `.Times()` in `EXPECT_CALL()`, gMock infers it based on presence of actions:

- No `WillOnce()` or `WillRepeatedly()` clauses: assumes `.Times(1)`.
- *n* `WillOnce()` clauses but no `WillRepeatedly()`: assumes `.Times(n)`.
- *n* `WillOnce()` clauses and one `WillRepeatedly()`: assumes `.Times(AtLeast(n))`.


## How to Choose the Right Cardinality?

- Use **`Exactly(n)`** when your test requires a precise number of calls.
- Use **`AtLeast(n)`** or **`Between(m, n)`** when some flexibility is acceptable.
- Use **`AtMost(n)`** to ensure an operation doesn’t happen too many times.
- Use **`AnyNumber()`** to indicate calls may happen any number of times, including none.


## Describing Cardinalities in Failure Messages

When gMock reports a failure related to cardinalities, it uses natural language descriptions to explain expectations and actual call counts. Some examples:

- "expected: called once; actual: never called"
- "expected: called at least twice; actual: called once"
- "expected: called between 2 and 4 times; actual: called 5 times"

These descriptions help quickly identify mismatch causes.


## Custom Cardinalities

GoogleMock encourages extensibility. Beyond built-in cardinalities, you may implement your own by adhering to the `CardinalityInterface`:

```cpp
class CardinalityInterface {
public:
  virtual ~CardinalityInterface() = default;
  virtual bool IsSatisfiedByCallCount(int call_count) const = 0;
  virtual bool IsSaturatedByCallCount(int call_count) const = 0;
  virtual void DescribeTo(std::ostream* os) const = 0;
};
```

And create a `Cardinality` object from your implementation. This enables specialized counting rules suited to your domain.


## Practical Tips & Best Practices

- **Set expectations before mock calls**: Always declare `.Times()` and `.WillOnce()` or `.WillRepeatedly()` before exercising mocks.
- **Use `.RetiresOnSaturation()` for limited calls**: Tag expectations to retire once saturated if overlapping matchers are set.
- **Avoid overly strict cardinalities**: Overly precise `.Times()` can cause brittle tests; consider fuzzy cardinalities when appropriate.
- **Use `AnyNumber()` to allow other calls**: Add catch-all expectations with `Times(AnyNumber())` when some calls are expected but others should be allowed.


## Troubleshooting Common Issues

- **Unexpected call count failures**:
  Ensure the number of mock calls matches your `.Times()` cardinalities.

- **Silent failures due to leaks**:
  Leaked mocks might delay verification; use `Mock::AllowLeak()` wisely or verify explicitly.

- **Confusing multiple expectations**:
  Remember gMock picks expectations in reverse order and that expectations are "sticky" unless retired.


## Summary

This page equips you to set and understand mock call cardinalities effectively, empowering you to write clear and robust expectations that catch subtle behavioral bugs without causing brittle tests.

For broader context, see the [Mock Objects and Methods](https://google.github.io/googletest/api/gmock_reference.html) API page and the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced patterns.

---

## Cardinalities API Reference

GoogleMock exposes the following built-in cardinality functions in the namespace `testing`:

```cpp
// Allows calls at least n times.
Cardinality AtLeast(int n);

// Allows calls at most n times.
Cardinality AtMost(int n);

// Allows calls any number of times.
Cardinality AnyNumber();

// Allows calls between min and max times.
Cardinality Between(int min, int max);

// Allows calls exactly n times.
Cardinality Exactly(int n);
```

The `Cardinality` objects are immutable and copyable handles representing the counting rules.


## Example: Using Times() with Cardinalities

```cpp
using ::testing::Exactly;
using ::testing::AtLeast;
using ::testing::_;
using ::testing::Return;

class MockTurtle {
public:
  MOCK_METHOD(void, PenDown, (), ());
};

TEST(DrawingTest, PenDownIsCalledCorrectly) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(Exactly(3));  // expect exactly three calls

  // simulate calls
  turtle.PenDown();
  turtle.PenDown();
  turtle.PenDown();
}
```


## Implementation Details (For Curious Users)

The built-in cardinalities like `Between` rely on the `BetweenCardinalityImpl` class, which validates invocation bounds and formats human-readable descriptions like "called between 3 and 5 times".


## Related Links & Navigation

- [Mock Objects and Methods API Reference](https://google.github.io/googletest/api/gmock_reference.html#mock-objects-and-methods)
- [Expectations, Cardinalities, and Verification Concepts](https://google.github.io/googletest/gmock_for_dummies.html#expectations)
- [gMock Cookbook — Writing New Cardinalities](https://google.github.io/googletest/gmock_cook_book.html#writing-new-cardinalities)


---

<AccordionGroup title="Cardinalities at a Glance">
<Accordion title="AnyNumber()">
This cardinality allows the mock method to be called any number of times, including zero. It never saturates and is satisfied by any call count.
</Accordion>
<Accordion title="AtLeast(n)">
Allows calls at least n times. If called fewer than n times, it is unsatisfied; it saturates only at infinite calls.
</Accordion>
<Accordion title="AtMost(n)">
Allows calls at most n times. After n calls, it saturates; calls beyond n cause an error.
</Accordion>
<Accordion title="Between(m, n)">
Allows calls between m and n times inclusively. It saturates at n calls and is satisfied when calls are between m and n.
</Accordion>
<Accordion title="Exactly(n)">
Allows calls exactly n times. It saturates immediately after n calls; fewer or more cause errors.
</Accordion>
</AccordionGroup>

<Tip>
When setting expectations with `.Times()`, use cardinalities deliberately to avoid brittle or overly lax tests. Prefer `Between` or `AtLeast` if you want flexibility, and `Exactly` for precise checks.
</Tip>

<Warning>
Calling mock methods more times than allowed by the cardinality causes immediate test failures. Use `.RetiresOnSaturation()` if you want the expectation to be deactivated automatically upon saturation.
</Warning>