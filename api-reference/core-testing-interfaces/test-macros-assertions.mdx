---
title: "Test Macros and Assertions"
description: "Covers the foundational macros and functions for declaring tests and making assertions. Includes detailed usage for EXPECT, ASSERT, predicate, and death test macros, enabling expressive and robust test logic."
---

# Test Macros and Assertions

GoogleTest provides a comprehensive set of macros and functions for declaring tests and making assertions, enabling developers to write expressive and robust test logic. This page describes the foundational test declaration macros and the rich assertion macros that verify program behavior, including standard assertions, predicate assertions, and death tests.

---

## Writing Tests with Macros

### TEST Macro

The `TEST` macro defines an independent test function within a named test suite. It is the simplest way to create tests.

```cpp
TEST(TestSuiteName, TestName) {
  // test code and assertions
}
```

- Both `TestSuiteName` and `TestName` must be valid C++ identifiers without underscores.
- Tests within a test suite are grouped logically and run independently.

### TEST_F Macro

`TEST_F` defines a test that uses a test fixture (shared setup/teardown logic and state).

```cpp
class MyFixture : public testing::Test {
 protected:
  void SetUp() override { /* Setup code */ }
  void TearDown() override { /* Cleanup code */ }
  // Shared resources
};

TEST_F(MyFixture, TestName) {
  // test body
}
```

- The first argument is the fixture class name.
- Each test uses a fresh fixture instance.

### Assertion Macro Variants: EXPECT vs ASSERT

Assertions come in pairs distinguished by their behavior on failure:

- `EXPECT_*`: Nonfatal failure; test continues.
- `ASSERT_*`: Fatal failure; current function returns immediately.

Preference is usually given to `EXPECT_*` to report multiple issues in one run; `ASSERT_*` is for critical failures that should abort further execution within the test.

---

## Core Assertion Macros

### Explicit Success and Failure

- `SUCCEED()`: Records a success; useful for documenting unconditionally passing points.
- `FAIL()`: Generates a fatal failure and aborts the current function.
- `ADD_FAILURE()`: Generates a nonfatal failure.
- `ADD_FAILURE_AT(file, line)`: Generates a nonfatal failure at specified location.

### Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Verify condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Verify condition is false.

### Binary Comparison Assertions

Compare two values with various relational operators:

| Macro           | Verifies                                       |
|-----------------|------------------------------------------------|
| `EXPECT_EQ`     | Values are equal (`==`).                        |
| `EXPECT_NE`     | Values are not equal (`!=`).                    |
| `EXPECT_LT`     | Left less than right (`<`).                     |
| `EXPECT_LE`     | Left less or equal right (`<=`).                |
| `EXPECT_GT`     | Left greater than right (`>`).                  |
| `EXPECT_GE`     | Left greater or equal right (`>=`).             |

Each has an `ASSERT_` variant that aborts on failure. These macros print detailed failure messages including the expressions and actual values.

### String Assertions

Specialized comparisons for C-style strings, to compare contents rather than pointers.

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ`: Verifies strings have same content.
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE`: Verifies strings differ in content.
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ`: Case-insensitive equality.
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE`: Case-insensitive inequality.

Wide strings (`wchar_t*`) are also supported.

---

## Predicate Assertions

Predicate assertions enable checking custom predicates with rich error messages.

### Simple Predicates

Macros `EXPECT_PRED1` through `EXPECT_PRED5` (and `ASSERT_` variants) verify predicates taking 1 to 5 arguments return `true`.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, 4); // succeeds
EXPECT_PRED2(IsEven, 3, 5); // fails
```

The failure message prints the predicate expression and argument values.

### Predicate Formatters

Use `EXPECT_PRED_FORMAT*` macros to supply your own predicate formatter function or functor, which returns a `testing::AssertionResult` with rich contextual messages.

Example:

```cpp
testing::AssertionResult AssertIsEven(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is not even";
}
EXPECT_PRED_FORMAT1(AssertIsEven, 3); // Fails with detailed message
```

---

## Floating-Point Assertions

Direct comparison with `EXPECT_EQ` isn't suitable due to rounding errors.

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ`: Checks float values equal within 4 ULPs.
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ`: Checks double values equal within 4 ULPs.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR`: Checks absolute difference within tolerance.

For advanced floating-point comparisons, use predicate-format assertions with `FloatLE` and `DoubleLE` predicate-format functions.

---

## Exception Assertions

Verify exception throwing behavior of code under test (requires exceptions enabled).

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW`: Fail if `statement` does not throw `exception_type`.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW`: Fail if `statement` does not throw *any* exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW`: Fail if `statement` throws any exception.

Example:

```cpp
EXPECT_THROW(Foo(), std::runtime_error);
EXPECT_NO_THROW(Bar());
```

Note compound statements can be tested:

```cpp
EXPECT_NO_THROW({ int x = 5; Foo(x); });
```

---

## Death Test Assertions

Death tests verify that code causes the process to terminate (crash, abort, or exit with failure).

### `EXPECT_DEATH` / `ASSERT_DEATH`

```cpp
EXPECT_DEATH(statement, matcher);
ASSERT_DEATH(statement, matcher);
```
- Verifies `statement` causes process termination with nonzero exit code.
- `matcher` is a string or matcher to verify `stderr` contents.

### `EXPECT_DEATH_IF_SUPPORTED` / `ASSERT_DEATH_IF_SUPPORTED`

Run `EXPECT_DEATH` or skip silently if death tests unavailable.

### `EXPECT_DEBUG_DEATH` / `ASSERT_DEBUG_DEATH`

Run death test only in debug builds.

### `EXPECT_EXIT` / `ASSERT_EXIT`

```cpp
EXPECT_EXIT(statement, predicate, matcher);
ASSERT_EXIT(statement, predicate, matcher);
```
- Verifies process terminates with exit status matching predicate.
- Checks `stderr` output matches matcher.
- `predicate` is a function accepting an `int` exit status.

Example predicates:

```cpp
::testing::ExitedWithCode(0);
::testing::KilledBySignal(SIGKILL);
```

Example:

```cpp
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

#### Important Notes:

- Death test statement runs in a child process; side effects won't propagate.
- Mocks should be permitted to leak in death tests expecting specific exit codes.
- Avoid multiple death assertions on the same source line.

---

## Additional Test Macros

### FRIEND_TEST

Declares an individual test as a friend of a class to access private members.

Usage inside class body:

```cpp
FRIEND_TEST(TestSuiteName, TestName);
```

### SCOPED_TRACE

Adds trace information (file, line, custom message) to failure messages within a scope.

```cpp
SCOPED_TRACE("message");
```

### GTEST_SKIP

Skip the current test dynamically.

```cpp
GTEST_SKIP() << "Skipping due to unmet precondition";
```

---

## Recording Additional Data

### RecordProperty

Log key-value pairs as properties associated with the current test, test suite, or global test run. Useful for logging metrics or additional info.

```cpp
RecordProperty("MaximumWidgets", max_widgets);
```

Restrictions:
- Keys cannot conflict with reserved XML attributes.
- The last value recorded is output in XML reports.

---

## Registering Tests Programmatically

`RegisterTest()` allows dynamic registration of tests by providing a factory callable that returns a new test instance.

Example:

```cpp
void RegisterMyTests(const std::vector<int>& values) {
  for (int v : values) {
    testing::RegisterTest(
      "MyFixture", ("Test" + std::to_string(v)).c_str(), nullptr,
      std::to_string(v).c_str(),
      __FILE__, __LINE__,
      [=]() -> MyFixture* { return new MyTest(v); });
  }
}
```

Ensure registration happens before `RUN_ALL_TESTS()`.

---

## Summary

By mastering these macros and assertions, you can write clear, maintainable, and robust C++ tests using GoogleTest. Start with `TEST` or `TEST_F` to define tests, guard critical failures with `ASSERT_*`, and prefer `EXPECT_*` for non-fatal checks. Use predicate and predicate-format assertions to capture complex conditions with meaningful failure diagnostics. Death tests enable verifying process termination semantics. Customize behavior and output through recorded properties and friend declarations as necessary.

[Explore related pages: Test Fixtures, Parameterized Tests, Advanced Assertions, Death Tests](../advanced.md), [Assertions Reference](assertions.md), [Testing Reference](testing.md).

---

<Accordion title="Typical User Workflow with Test Macros and Assertions">
1. Use `TEST` to declare simple tests without fixtures.
2. For tests requiring shared setup, define fixtures and use `TEST_F`.
3. Insert assertions (`EXPECT_`, `ASSERT_`) reflecting expected outcomes.
4. Enhance readability and failure diagnostics using predicate or predicate-format assertions.
5. When testing code that must terminate, use death test macros.
6. Optionally, dynamically register tests with `RegisterTest` for flexible test generation.
</Accordion>

<Accordion title="Best Practices and Common Pitfalls">
- Prefer `EXPECT_*` over `ASSERT_*` to allow multiple failures reporting.
- Avoid fatal assertions (`ASSERT_*`) in non-void functions to prevent confusing compile errors.
- Use `SCOPED_TRACE` to trace complex call stacks on failures inside helper functions.
- In death tests, avoid freeing resources as side effects won't affect the parent process.
- When mocking in death tests, allow leaks to avoid false positives.
- Avoid test or test suite names with underscores to comply with GoogleTest conventions.
- Use `FRIEND_TEST` to access private members for white-box testing.
</Accordion>

<Accordion title="Troubleshooting Assertion Failures">
- Ensure predicate functions used with predicate macros return `bool` or `AssertionResult`.
- Verify that streaming operator `<<` works for custom types or provide `PrintTo`/`AbslStringify` overrides.
- When an assertion does not behave as expected, check evaluation occurs only once (important for side-effects).
- If an `EXPECT_DEATH` or `ASSERT_DEATH` test fails, confirm the death test style and platform support.
</Accordion>

---

[Source code on GitHub](https://github.com/google/googletest/tree/main/googletest/include/gtest/gtest_pred_impl.h),
[Assertions Reference](assertions.md),
[Advanced Guide on Assertions and Test Writing](../advanced.md)

