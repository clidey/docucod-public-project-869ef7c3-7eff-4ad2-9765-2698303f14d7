---
title: "GoogleMock Matchers"
description: "Covers built-in and extensible matchers available in GoogleMock for argument checking and result validation, with syntax examples and guidance for matcher customization."
---

# GoogleMock Matchers


GoogleMock provides a powerful set of built-in and extensible matchers for validating function arguments and return values in mock expectations. These matchers allow C++ developers to specify precise verification criteria for their mock methods, creating tests that are both expressive and robust.

This page focuses exclusively on the matchers available within GoogleMock — how to use the built-in matchers to check arguments effectively, combine them for complex scenarios, and extend the functionality by creating custom matchers.

---

## Overview

Matchers in GoogleMock act as descriptive predicates against function arguments and results. They provide a readable and flexible DSL for expectation definitions in mocks.

Matchers are used primarily in `EXPECT_CALL` and `ON_CALL` macros, enabling you to specify what arguments a mock function should accept or how it should behave according to argument properties.

---

## Using Built-in Matchers

### Wildcard Matcher

Use `_` to match any value regardless of type or content.

```cpp
using ::testing::_;
EXPECT_CALL(mock_obj, Method(_, _));  // Matches any arguments
```

### Equality and Comparison Matchers

Implicit literal values are treated as equality matchers (`Eq(value)`). For complex comparisons, built-in matchers include:

- `Eq(value)` — matches if equal to `value`
- `Ne(value)` — not equal
- `Lt(value)` — less than
- `Le(value)` — less than or equal
- `Gt(value)` — greater than
- `Ge(value)` — greater than or equal

Example:

```cpp
EXPECT_CALL(mock_obj, UpdateCount(Ge(10)));  // Argument must be >= 10
```

### Pointer and Reference Matchers

- `IsNull()` matches null pointers (raw or smart pointers).
- `NotNull()` matches non-null pointers.
- `Pointee(matcher)` matches pointers pointing to a value satisfying `matcher`. Supports raw and smart pointers.
- `Ref(variable)` matches an argument that is a reference to a specific variable.

Example:

```cpp
EXPECT_CALL(mock_obj, ProcessPointer(Pointee(Eq(5))));
```

### String Matchers

GoogleMock provides specialized string matchers for more natural string verification:

- `StrEq(str)` — strings equal to `str` (case-sensitive)
- `StrNe(str)` — strings not equal
- `StrCaseEq(str)` — equal ignoring case
- `StrCaseNe(str)` — not equal ignoring case
- `HasSubstr(substr)` — string contains `substr`
- `StartsWith(prefix)`, `EndsWith(suffix)` — matching string starts/ends

Example:

```cpp
EXPECT_CALL(mock_obj, GetName(StartsWith("Alice")));
```

### Container Matchers

To match STL-style containers, use:

- `ElementsAre(e1, e2, ...)` — matches container elements in order
- `UnorderedElementsAre(e1, e2, ...)` — elements in any order
- `ElementsAreArray(array)` — matches elements against array or container
- `UnorderedElementsAreArray(array)` — unordered matching for array/container
- `Contains(matcher)` — container contains at least one element matching matcher
- `Each(matcher)` — all elements satisfy matcher
- `SizeIs(matcher)` — container size satisfies matcher

Example:

```cpp
using ::testing::ElementsAre;
EXPECT_CALL(mock_obj, ProcessVector(ElementsAre(1, 3, 5)));
```

### Tuple and Pair Matchers

- `Pair(matcher1, matcher2)` matches `std::pair` objects by their first and second element
- `Key(matcher)` matches key in a pair (helpful for maps)

Useful for matching map entries and associative containers.

---

## Combining Matchers

Matchers can be combined logically to express complex constraints:

- `AllOf(m1, m2, ...)` — matches if **all** matchers match (logical AND)
- `AnyOf(m1, m2, ...)` — matches if **any** matcher matches (logical OR)
- `Not(matcher)` — matches if inner matcher does **not** match (logical NOT)

Example:

```cpp
EXPECT_CALL(mock_obj, Foo(AllOf(Gt(5), Ne(10))));
```

matches if the argument is greater than 5 and not equal to 10.

---

## Multi-Argument Matchers

Use `.With()` clauses with a multi-argument matcher to impose constraints across multiple arguments at once.

Example: enforce that the first argument is less than the second:

```cpp
using ::testing::Lt;
EXPECT_CALL(mock_obj, Func(_, _))
    .With(Lt());  // Matcher on the tuple of arguments
```

Use `Args<k1, k2>(m)` to match specific argument subsets.

---

## Writing Custom Matchers

GoogleMock lets you easily define your own matchers to meet domain-specific needs.

### Simple Custom Matcher

Use `MATCHER(name, description) { ... }` macro.

- `arg` holds the value being matched
- Return `true` if match succeeds, `false` otherwise

Example:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock_obj, Func(IsEven()));
```

### Parameterized Custom Matcher

Use parameterized variants like `MATCHER_P(name, param, description) { ... }` for matchers with arguments.

Example:

```cpp
MATCHER_P(IsMultipleOf, n, "checks multiple of n") {
  return (arg % n) == 0;
}

EXPECT_CALL(mock_obj, Func(IsMultipleOf(3)));
```

### Advanced Custom Matcher Classes

For complex cases, implement a matcher class with:

- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Then create a factory function returning `testing::Matcher<T>`.

---

## Tips and Best Practices

- Use `_` as a wildcard when argument is not important to avoid brittle tests.
- Use `SafeMatcherCast<T>(m)` when matching types related by implicit casts to avoid compiler errors.
- Use `EXPECT_CALL` to enforce calls; use `ON_CALL` to define default behavior without expectations.
- Combine matchers with `AllOf`, `AnyOf`, and `Not` for expressive logic.
- Use sequence constraints (`InSequence`, `After`) for ordered expectations.
- For pointers, `Pointee(m)` avoids crash by rejecting null pointers automatically.
- When matching containers, use `ElementsAre` for order-sensitive and `UnorderedElementsAre` for order-insensitive matching.
- Write custom matchers for domain-specific predicates that built-ins cannot express.
- Create reusable matcher variables when expecting the same complex match multiple times.

---

## Example: Combining Matchers and Using Custom Matcher

```cpp
MATCHER_P(InRange, range, "checks value in inclusive range") {
  return arg >= range.first && arg <= range.second;
}

// Usage
EXPECT_CALL(mock, ProcessValue(AllOf(Ge(10), InRange(std::make_pair(15, 20)))));
```

---

## Troubleshooting

- Use `--gmock_verbose=info` to get detailed logs about matcher matching.
- If an `EXPECT_CALL` fails with unexpected argument errors, check argument matcher types and usage.
- Make sure no unintentional side effects occur inside matchers — they must be pure functions.
- When using overloaded methods, specify expected argument types explicitly to avoid ambiguous calls.
- Use `RetiresOnSaturation()` when an expectation should be deactivated after being fulfilled.
- Avoid over-specifying expectations to prevent brittle, maintenance-heavy tests.

---

## See Also

- [GoogleMock Mock Expectations and Actions](reference/mocking.md)
- [GoogleMock Defining Mock Classes](api-reference/googlemock-apis/mock-class-and-method-definition.md)
- [GoogleTest Assertions Reference](reference/assertions.md)
- [Writing Custom Matchers (Cookbook)](gmock_cook_book.md#NewMatchers)
- [Using Matchers in Mock Expectations](guides/core-workflows/introduction-to-mocking.md#Matchers)

---

## Source

See the implementation and tests:

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-635"},{"path": "googlemock/test/gmock-matchers_test.h", "range": "1-200"}]} />

