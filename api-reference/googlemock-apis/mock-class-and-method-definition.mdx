---
title: "Mock Class and Method Definition"
description: "Describes how to create mock classes and methods using core GoogleMock macros and utilities. Explains the syntax, options, and best practices for mocking functions and interfaces."
---

# Mock Class and Method Definition

This page describes the process of creating mock classes and methods using the core GoogleMock macros and utilities. It provides detailed explanations of the syntax, options, and best practices for mocking C++ functions and interfaces, enabling developers to efficiently define and control mock behavior in their tests.

---

## Overview of Mock Class Definition

When you want to verify interactions or specify behavior for your C++ classes in tests, the essential step is to define *mock classes*. GoogleMock facilitates this via the `MOCK_METHOD` macro, which generates mock method implementations that seamlessly integrate with the expectation and behavior specification framework.

### Defining a Mock Class

- Derive your mock class from the interface or base class you want to mock.
- Use the `MOCK_METHOD` macro inside the `public:` section of the mock class to declare each mocked method.
- The syntax of `MOCK_METHOD` closely mirrors the method signature in the base class.

Example:
```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

### Important Notes on Placement and Accessibility

- Always place `MOCK_METHOD` declarations in the **public** section, regardless of their access level in the base class. C++ allows changing access levels in subclasses, enabling `ON_CALL` and `EXPECT_CALL` to successfully reference these mock methods.
- This rule ensures proper interaction with GoogleMock's matching and expectation engine.

### When and Why Use `MOCK_METHOD`

`MOCK_METHOD` replaces hand-coded mocks, reducing boilerplate and increasing test reliability. It auto-generates method implementations that:

- Track call counts
- Support argument matching and capturing
- Allow specific behaviors and return values to be set dynamically

---

## Detailed Syntax of `MOCK_METHOD`

`MOCK_METHOD` takes three or four parameters:

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (OptionalSpecs...))
```

- `ReturnType`: The return type of the method.
- `MethodName`: The method's name.
- `(ArgTypes...)`: The function arguments enclosed in parentheses.
- `(OptionalSpecs...)`: Optional method qualifiers such as `const`, `override`, `noexcept`, calling conventions, and reference qualifiers enclosed in parentheses.

#### Accepted Specifiers:

| Qualifier              | Purpose                                                                                 |
|------------------------|-----------------------------------------------------------------------------------------|
| `const`                | Mock a `const` method. Required when overriding const-qualified methods.                |
| `override`             | Marks that the method overrides a virtual method. Recommended for clarity.              |
| `noexcept`             | Marks that the method is `noexcept`. Required when overriding such methods.             |
| `Calltype(x)`          | Specifies calling convention (e.g. `Calltype(STDMETHODCALLTYPE)`) useful for Windows.  |
| `ref(&)`, `ref(&&)`    | Marks reference qualifiers. Required when mocking methods with ref qualifiers.          |

### Handling Types with Commas

If your return type or argument types contain unprotected commas (e.g., template types like `std::pair<int, int>`), `MOCK_METHOD` cannot parse them correctly unless you either:

- Wrap the type(s) in extra parentheses, or
- Use type aliases (preferred for clarity).

Example:
```cpp
class MyMock {
 public:
  // Incorrect (won't compile):
  // MOCK_METHOD(std::pair<int, int>, GetPair, ());

  // Correct by adding parentheses:
  MOCK_METHOD((std::pair<int, int>), GetPair, ());

  // Preferred: Using type aliases:
  using IntPair = std::pair<int, int>;
  MOCK_METHOD(IntPair, GetPair, ());
};
```

---

## Mocking Special Cases

### Mocking Overloaded Methods

Simply declare each overload with `MOCK_METHOD` using the full method signature and specifiers, including `const` for const overloads. To avoid hiding overloads, use `using BaseClass::Method` where relevant.

### Mocking Class Templates

Mock templates like normal classes, with `MOCK_METHOD` inside the template definition.

### Mocking Non-Virtual Methods

You can mock non-virtual methods by defining a mock class that shares the same method signatures but does not inherit from the real class. Such mocks require compile-time dependency injection.

### Mocking Private or Protected Methods

Place mocked versions of private/protected methods as public in the mock class so expectations and calls succeed.

### Mocking Free Functions

Not possible directly. Instead, refactor the code to depend on interfaces, and mock those interfaces.

---

## Example: Defining a Mock Class

```cpp
class Widget {
 public:
  virtual ~Widget() {}
  virtual bool Resize(int width, int height) = 0;
  virtual std::string Draw() const = 0;
};

class MockWidget : public Widget {
 public:
  MOCK_METHOD(bool, Resize, (int width, int height), (override));
  MOCK_METHOD(std::string, Draw, (), (const, override));
};
```

---

## Recommended Best Practices

- Always use `override` in `MOCK_METHOD` specs to avoid mistakes in method overriding.
- Use type aliases to simplify complex template signatures with commas.
- Remember to put mocked methods in `public:` to ensure accessibility for expectations.
- For overloaded methods, mock **all** overloads you expect to be called.
- Prefer interface-based design to avoid mocking concrete classes.

---

## Troubleshooting Common Issues

- **Unprotected commas in types** cause compilation failures. Fix by adding parentheses or using type aliases.
- **Ambiguous overloads** when calling `EXPECT_CALL` or `ON_CALL` without arguments on overloaded methods. Provide full signatures or use `using` declarations.
- **Warnings or errors for const parameters in MSVC** usually mean the const is ignored and can be removed from method signatures.
- Remember that `MOCK_METHOD` must be invoked in **public** scope.

---

## Legacy `MOCK_METHODn` Macros

Older versions of GoogleMock used `MOCK_METHODn` macros (e.g., `MOCK_METHOD1`, `MOCK_CONST_METHOD1`) which have a different parameter ordering and syntax. Migration to `MOCK_METHOD` is recommended.

Example:
```cpp
// Old style
MOCK_METHOD1(Foo, bool(int));
// New style
MOCK_METHOD(bool, Foo, (int));
```

---

## Using Strict, Nice, and Naggy Mocks

GoogleMock provides three wrappers around mocks to control behavior on uninteresting calls:

- `NiceMock<T>`: suppresses warnings on uninteresting calls (calls without expectations).
- `NaggyMock<T>`: the default, warns on uninteresting calls.
- `StrictMock<T>`: treats uninteresting calls as errors.

Example:
```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock; // Warnings suppressed
```

Use these judiciously to balance test strictness and maintainability.

---

## Summary

This page has covered how to define mock classes and mock methods in GoogleMock using the `MOCK_METHOD` macro, including syntax details, qualifier options, handling special cases like overloaded or templated methods, best practices, and common pitfalls.

For further mastery, explore:

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced mocking scenarios.
- [Mock Expectations and Actions](../api-reference/googlemock-apis/mock-expectations-and-actions) for setting expectations on mocks.
- [GoogleMock Matchers](../api-reference/googlemock-apis/googlemock-matchers) to match method arguments flexibly.

---

<Check>
Ensure all mock methods use `MOCK_METHOD` in `public:` sections.
Use type aliases or parentheses to prevent parsing issues with commas.
Explicitly mark overridden methods `override`.
Be aware of strictness modes with Nice, Naggy, and Strict mocks.
</Check>

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-function-mocker.h", "range": "1-289"},{"path": "docs/gmock_cook_book.md", "range": "20-583"}]} />
