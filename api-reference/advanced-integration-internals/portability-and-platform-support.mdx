---
title: "Portability and Platform Support"
description: "Overview of the platform abstraction layers, key portability macros, and guidance for supporting GoogleTest and GoogleMock on custom or embedded platforms. Includes entry points for internal configuration."
---

# Portability and Platform Support

GoogleTest and GoogleMock are designed to operate seamlessly across a wide range of platforms, from major desktop operating systems to custom and embedded environments. This page provides a detailed overview of the platform abstraction layers, critical portability macros, and guidance for adapting the frameworks to support unique or constrained platforms.

---

## Platform Abstraction Layers

At the heart of GoogleTest and GoogleMock portability are carefully designed platform abstraction layers implemented primarily in internal headers like `gtest-port.h` and `gmock-port.h`. These layers encapsulate platform-specific behaviors, environment details, and system-level utilities, allowing the rest of the framework to operate with consistent semantics regardless of underlying OS or compiler differences.

### Key Features of the Abstraction Layer

- **Environment Detection Macros:** Detect and expose platform-specific attributes such as operating system, compiler capabilities, and feature support.
- **Synchronization Primitives:** Abstract mutexes, locks, and thread-local storage mechanisms tailored for the target platform's threading model.
- **Filesystem Utilities:** Unified file and directory operations that hide OS-specific API differences.
- **Regex Handling:** Conditional use of RE2, POSIX regex, or internal regex implementations depending on platform availability.
- **Exception and RTTI Support:** Macros indicating compiler support for exceptions and runtime type information.

The platform abstraction is deliberately extensible to allow for customizations necessary for non-standard or embedded platforms.

---

## Key Portability Macros and Environment-Describing Flags

GoogleTest defines a wide set of macros to describe both the environment where it runs and the features it can utilize. These macros are defined during compilation, either automatically or via user-provided overrides to fine-tune compatibility.

### Examples of Environment Macros

| Macro                          | Description                                                      | Value                         |
|-------------------------------|-----------------------------------------------------------------|-------------------------------|
| `GTEST_OS_WINDOWS`             | Compiled on a Windows platform                                  | 1 (if true), undefined (otherwise) |
| `GTEST_OS_LINUX`               | Compiled on a Linux platform                                    | 1 or undefined                 |
| `GTEST_HAS_PTHREAD`            | POSIX threading library available                               | 1 or 0                        |
| `GTEST_HAS_EXCEPTIONS`         | C++ exception support enabled                                  | 1 or 0                        |
| `GTEST_HAS_RTTI`               | Runtime type information is enabled                            | 1 or 0                        |
| `GTEST_HAS_FILE_SYSTEM`        | File system support available                                   | 1 or 0                        |
| `GTEST_HAS_DEATH_TEST`         | Death tests feature is supported                                | 1 or 0                        |

### Example Usage

```cpp
#if GTEST_OS_WINDOWS
  // Windows-specific code
#elif GTEST_OS_LINUX
  // Linux-specific code
#endif

#if GTEST_HAS_EXCEPTIONS
  // Code that requires exception handling
#endif
```

Users targeting platforms with incomplete or unique capabilities can override these macros via custom configuration headers.

---

## Supporting Custom and Embedded Platforms

GoogleMock provides an injection mechanism to adapt the framework to custom or embedded environments where some platform features may not exist or behave differently.

### Customization Points

- The `googlemock/include/gmock/internal/custom/` directory is a dedicated location for user-defined configuration overrides.
- In particular, `gmock-port.h` allows defining and declaring custom macros and flags that tailor the internals of GoogleMock.

### Flags and Macros Examples

```cpp
// Declare a flag
GMOCK_DECLARE_bool_(catch_leaked_mocks);
// Define and document a flag
GMOCK_DEFINE_bool_(catch_leaked_mocks, true, "Enables detection of leaked mocks");

// Access flag values
bool enabled = GMOCK_FLAG_GET(catch_leaked_mocks);
// Modify flag values
GMOCK_FLAG_SET(catch_leaked_mocks, false);
```

Custom platform support often involves adjusting these flags, adapting synchronization primitives, and ensuring compatibility with the build system.

---

## Threading and Synchronization Support

Thread-safety is fundamental to GoogleTest and GoogleMock, and platform-specific mutex and thread-local storage implementations are provided.

- On Windows platforms (except Windows Phone or Windows RT), a custom `Mutex` wraps the native critical section.
- On POSIX systems, `pthread_mutex_t`-based mutexes are used.
- For platforms without threading support, stub implementations that disable synchronization are supplied.

This abstraction ensures tests can run reliably across environments without altering test code.

### ThreadLocal Storage Example

```cpp
// Create thread-local variable with default value 100
testing::internal::ThreadLocal<int> thread_local_var(100);
thread_local_var.set(150);  // Set per-thread value
int value = thread_local_var.get();  // Get per-thread value
```

---

## File System and I/O Compatibility

The abstraction layer offers consistent file and directory operations across supported platforms, hiding API differences:

- File descriptor retrieval
- Path separator macros (
  `GTEST_PATH_SEP_`)
- Directory removal
- File stat operations
- Case-insensitive string comparisons

These are critical for core framework functionality such as test result logging, temporary file management, and death tests.

---

## Regular Expression Support

GoogleTest supports matching test output and other patterns using regex with conditional backends:

- **RE2:** Used when building with Abseil support.
- **POSIX Extended Regex:** The default on most UNIX-like systems.
- **Internal Simple Regex:** Fallback for platforms lacking POSIX regex.

What backend is used depends on the platform macros and build options.

---

## Initialization and Flag Parsing

GoogleMock's initialization (`InitGoogleMock`) handles flag parsing and configures the runtime based on recognized command-line flags, including verbose logging and default mock behavior.

It processes flags prefixed with `--gmock_` and removes recognized flags from `argv` during startup, enabling clean integration with other command-line options.

---

## Best Practices and Troubleshooting

- **Use Platform Macros:** Guard platform-specific code with the provided `GTEST_OS_*` and feature macros.
- **Customize via `gmock-port.h`:** When targeting non-standard environments, create or modify the port configuration as recommended.
- **Validate Threading Support:** Confirm your platform supports required threading or use the appropriate stubs.
- **Verify Regex Backend:** Ensure necessary libraries (RE2 or POSIX regex) are available if you depend on regex features.
- **Consult Community:** Problems with specific platforms often have known workarounds shared through community channels.

---

## Related Documentation

- [Prerequisites & Platform Support](/getting-started/environment-setup/prerequisites-platform-support) — for minimum compiler and environment requirements.
- [Setup Quickstart](/guides/getting-started/setup-quickstart) — on configuring GoogleTest and GoogleMock builds.
- [Common Installation Issues](/getting-started/troubleshooting-support/common-issues-and-fixes) — troubleshooting platform-related integration errors.
- [Community Support Channels](/getting-started/troubleshooting-support/community-support-channels) — for help and reporting platform-specific issues.

---

## Visual Overview Diagram

```mermaid
graph TD
  subgraph "GoogleTest and GoogleMock Portability Architecture"
    GTInternals["Internal Portability Headers\n(gtest-port.h, gmock-port.h)"]
    PlatformMacros["Environment & Feature Macros\n(GTEST_OS_*, GTEST_HAS_*)"]
    SyncPrimitives["Synchronization Primitives\nMutex, ThreadLocal"]
    FilesystemUtils["Filesystem & I/O Utilities"]
    RegexSupport["Regular Expression Abstraction\n(RE2 / POSIX / Simple Regex)"]
    FlagManagement["Flag Parsing & Runtime Config"]
  end
  subgraph "OS & Compiler"
    Windows["Windows"]
    Linux["Linux"]
    MacOS["MacOS"]
    Embedded["Embedded/Custom Platforms"]
  end

  Windows --> PlatformMacros
  Linux --> PlatformMacros
  MacOS --> PlatformMacros
  Embedded --> PlatformMacros

  PlatformMacros --> GTInternals
  GTInternals --> SyncPrimitives
  GTInternals --> FilesystemUtils
  GTInternals --> RegexSupport
  GTInternals --> FlagManagement

  FlagManagement --> "User Application"
  SyncPrimitives --> "Thread-Safe Test Execution"
  FilesystemUtils --> "File-based Logging & Death Tests"
  RegexSupport --> "Test Output Matching"

```

---

This page equips developers and integrators with the knowledge to confidently build, customize, and run GoogleTest and GoogleMock across a broad spectrum of platforms, ensuring maximum portability and reliable test execution in any environment.
