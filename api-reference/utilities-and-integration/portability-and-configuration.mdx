---
title: "Portability and Configuration"
description: "Overviews portability macros, platform detection, and configuration headers that enable consistent testing across different environments. Outlines key macros and options for customizing builds and behavior."
---

# Portability and Configuration

GoogleTest ensures consistent behavior and testing reliability across varied development environments through a robust set of portability macros, platform detection features, and configuration headers. This page overviews these foundational mechanisms that enable GoogleTest (and GoogleMock) to smoothly operate and integrate regardless of underlying platform or build variations.

---

## Overview

Portability macros and platform detection are essential for GoogleTest's versatility. They abstract away platform-specific differences, allowing test code to remain consistent and predictable across Windows, Linux, macOS, and other supported systems.

Configuration headers complement this by enabling project-wide or user-customized options to tailor builds and runtime behavior without modifying core code.

Together, these features empower you to develop portable tests with confidence and flexibility.

---

## Platform Detection

GoogleTest automatically detects the host platform during compilation, setting internal macros that describe the environment. This detection drives conditional compilation for platform-specific capabilities.

Some key macros include:

- `GTEST_OS_WINDOWS` and variants like `GTEST_OS_WINDOWS_DESKTOP`, `GTEST_OS_WINDOWS_MINGW`
- `GTEST_OS_LINUX` and `GTEST_OS_LINUX_ANDROID`
- `GTEST_OS_MAC` and `GTEST_OS_IOS`
- `GTEST_HAS_PTHREAD` for pthread threading support
- `GTEST_HAS_STD_WSTRING` for `std::wstring` availability

These flags are defined as 1 when the platform or capability is detected, otherwise they are undefined, never defined to 0. This design encourages clean `#if` checks rather than relying on macros being defined or not.

The detection machinery lives primarily in internal headers like `gtest/internal/gtest-port-arch.h` and `gtest/internal/gtest-port.h`.

---

## Portability Macros

Portability macros abstract compiler and platform differences. They comprise:

- Compiler feature checks (e.g., C++ standard support, availability of attributes and built-in functions)
- Platform-specific function and header replacements
- Calling conventions and symbol export/import macros
- Threading primitives availability (mutex, thread local storage, notifications)

Example portability adjustments include:

- Detecting availability of exception handling and RTTI (runtime type information) with macros like `GTEST_HAS_EXCEPTIONS` and `GTEST_HAS_RTTI`
- Defining `GTEST_API_` for symbol exporting; this helps build shared libraries compatible on Windows and Unix-like systems
- Wrapping standard functions and behaviors like `isatty()`, directory manipulation, and error string retrieval to abstract OS differences

These macros are designed for internal use but are exposed as public API where necessary so that tests and mocks can adapt behavior accordingly.

---

## Configuration Headers & Customization Points

GoogleTest provides key headers with build and behavior configuration controls:

- `gtest-port.h` (core portability and configuration definitions)
- `gmock-port.h` (GoogleMock-specific porting macros and flags)
- Customization injection through `custom/` directories where you can override macros or provide project-specific behavior without patching GoogleTest's core.

Example customization:

- Defining `GTEST_API_` to mark exported symbols.
- Overriding threading or logging macros if your platform uses alternative implementations.

Refer to headers under `googletest/include/gtest/internal/` and `googlemock/include/gmock/internal/` for the foundational definitions.

---

## Compiler and Linker Configuration Macros

GoogleTest includes CMake macros and functions (in files like `googletest/cmake/internal_utils.cmake`) that configure compiler and linker flags to set up builds correctly across compilers:

- Adjusts flags like `/MD` vs `/MT` on MSVC for static vs dynamic CRT linkage
- Enables stricter warning levels
- Removes incompatible flags
- Defines macros like `GTEST_HAS_PTHREAD` based on threading support

These macros ensure builds are consistent and avoid runtime crashes or subtle incompatibilities on different systems and compilers.

---

## Best Practices for Portability and Configuration

- **Trust the platform detection:** rely on GoogleTest's macros to guard platform-specific code rather than reinventing detection logic.
- **Use provided portability macros:** e.g., `GTEST_HAS_EXCEPTIONS` to conditionally compile exception-using code.
- **Customize only if necessary:** prefer using the provided customization points to modify logging or threading behaviors to avoid patching upstream code.
- **Configure builds using documented CMake macros:** to preserve cross-platform harmony.

---

## Troubleshooting Common Portability Issues

- Ensure your compiler and environment meet GoogleTest's minimum requirements, such as C++17 support.
- If GoogleTest macros like `GTEST_HAS_PTHREAD` are not set as expected, confirm your toolchain and OS compatibility.
- For build failures related to compiler flags, utilize the internal CMake functions to tune compilation settings.
- When linking shared libraries on Windows, verify that `GTEST_API_` and export definitions are correctly applied.

Refer to the [Prerequisites & System Requirements](../../getting-started/setup-prerequisites-installation/prerequisites-system-requirements) and [Troubleshooting Common Issues](../../getting-started/first-test-troubleshooting/troubleshooting-common-issues) guides for additional insights.

---

## Related Documentation

- [Mocking Framework - Portability Macros](../../api-reference/mocking-framework/defining-and-using-mocks)
- [Matchers and Expectations - Using Matchers](../../api-reference/matchers-and-expectations/using-matchers)
- [GoogleTest System Architecture](../../overview/inside-googletest/architecture-overview)
- [Installation & Integration Guide](../../getting-started/setup-prerequisites-installation/installation-integration)

---

GoogleTestâ€™s portability and configuration support serve as the backbone for writing robust, maintainable, and cross-platform compatible tests that behave reliably across diverse environments.


---

### See Also

- [GoogleTest Prerequisites & System Requirements](../../getting-started/setup-prerequisites-installation/prerequisites-system-requirements)
- [GoogleTest Installation & Build](../../getting-started/setup-prerequisites-installation/installation-integration)
- [GoogleMock Customization Points](../../googlemock/include/gmock/internal/custom/README.md)
- [GoogleTest macro references](../../overview/core-concepts/concept-mapping)

---

### Reference Excerpts

These are key macros and options you might encounter:

- `GTEST_OS_WINDOWS` - Detects Windows platform
- `GTEST_HAS_PTHREAD` - Indicates pthreads support
- `GTEST_API_` - Used as export/import specifier on supported platforms
- `GTEST_HAS_EXCEPTIONS` and `GTEST_HAS_RTTI` - Define availability of exceptions and RTTI

Use them to conditionally enable or disable features in your test code.

---

### Example: Conditional Compilation

```cpp
#ifdef GTEST_HAS_EXCEPTIONS
try {
  // code that might throw
} catch (...) {
  // exception handling
}
#else
// alternative logic without exceptions
#endif
```

### Example: Platform-Specific Code

```cpp
#if defined(GTEST_OS_WINDOWS)
  // Windows-specific implementation
#elif defined(GTEST_OS_LINUX)
  // Linux-specific implementation
#else
  // Fallback
#endif
```

---

For any complex build environment, start by applying these portability macros and configurations to maintain consistent test behavior.

---

<Callout title="Tip">
Leverage GoogleTest's configuration and platform macros extensively to avoid manual and error-prone platform detection. Prefer using standard macros for clean, maintainable, and portable test code.
</Callout>

<Callout title="Note">
Customizing configuration macros should be done through the designated injection points in the `custom/` folders to prevent upgrade and maintenance issues.
</Callout>