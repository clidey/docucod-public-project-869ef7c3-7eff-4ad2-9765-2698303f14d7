---
title: "Test Runner Initialization and Main Entrypoints"
description: "Describes how to initialize and launch tests using GoogleTest and GoogleMock's main entry functions. Covers main function customization and integration with standard and embedded platforms."
---

# Test Runner Initialization and Main Entrypoints

This page details how to initialize the GoogleTest and GoogleMock frameworks and launch test execution through their main entry functions. It focuses on writing and customizing your `main` function or using provided main implementations, as well as integrating with both standard desktop platforms and embedded environments.

---

## Overview

To execute tests written with GoogleTest and GoogleMock, your test program needs to perform two critical steps:

1. Initialize the testing framework by calling the appropriate `Init` function, which processes command-line flags and prepares internal components.
2. Launch all registered tests for execution using `RUN_ALL_TESTS()`.

This page explains how these steps are typically implemented and offers guidance on customizing test initialization for specific user needs.

---

## Using the Default main() Implementation

GoogleTest and GoogleMock provide default main functions for convenience. When you link your test binary against the `gtest_main` or `gmock_main` libraries, a suitable `main()` function is linked automatically.

- For GoogleTest-only projects, linking with `gtest_main` is recommended.
- For projects using GoogleMock alongside GoogleTest, link against `gmock_main`.

The default main function:

- Prints a startup message indicating it’s running `main()` from the library source file.
- Calls the framework initialization function:
  - `testing::InitGoogleTest(&argc, argv);` for GoogleTest alone.
  - `testing::InitGoogleMock(&argc, argv);` for GoogleMock (which includes GoogleTest).
- Calls `RUN_ALL_TESTS()` to run all tests and returns its result as the program exit status.

### Example: Running with Default main (GoogleMock)

```cpp
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  std::cout << "Running main() from gmock_main.cc\n";
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

> Note: You do not need to write a `main()` function yourself if the default satisfies your needs. Simply link with the provided main libraries.

---

## Writing a Custom main() Function

If you require custom setup prior to test execution — for example, initializing application globals, environment variables, or specialized logging — you can provide your own `main()` function.

Your custom `main()` **must**:

- Call either `testing::InitGoogleTest(&argc, argv);` or `testing::InitGoogleMock(&argc, argv);` **before** running tests to ensure all GoogleTest flags and internal structures are initialized.
- Call `RUN_ALL_TESTS()` exactly once to execute all registered tests.
- Return the result of `RUN_ALL_TESTS()` as the program exit status to properly signal success or failure.

### Minimal Custom main() Example

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);

  // Add any custom setup code here

  return RUN_ALL_TESTS();
}
```

### Important Guidelines

- Always pass `&argc` and `argv` to `InitGoogleTest()` or `InitGoogleMock()` to enable proper command-line flag parsing and removal from argv.
- Do not call `RUN_ALL_TESTS()` multiple times in a single program; this can corrupt internal state and cause undefined test behavior.
- Return the value of `RUN_ALL_TESTS()` from `main()` to ensure correct test pass/fail detection by automated test runners.

---

## Initialization Functions Explained

- `testing::InitGoogleTest(int* argc, char** argv)`
  - Parses GoogleTest-related flags (such as test filtering, output format, repeat counts).
  - Removes processed flags from `argv` so remaining command-line arguments can be used by user code.

- `testing::InitGoogleMock(int* argc, char** argv)`
  - Initializes GoogleMock and implicitly calls `InitGoogleTest()` too.
  - Use this function if your tests incorporate mocking with GoogleMock.

Both provide platform-neutral handling, including support for Windows wide strings and various command-line conventions.

---

## Embedded Platforms Initialization

GoogleTest and GoogleMock support embedded platforms that do not have a standard `main()` entry point. For example, platforms like ESP8266, ESP32, or NRF52 boards running Arduino require alternate program entry models.

On these platforms, the test framework exposes `setup()` and `loop()` functions:

- `setup()` function calls `testing::InitGoogleTest()` or `testing::InitGoogleMock()` to initialize the testing framework.
- `loop()` function repeatedly calls `RUN_ALL_TESTS()` to run the tests.

This model fits the embedded event loop architecture, allowing tests to run without a traditional `main()`.

### Example for ESP8266/ESP32/Arduino

```cpp
extern "C" {
void setup() {
  testing::InitGoogleMock();  // Initializes both GoogleMock and GoogleTest
}

void loop() {
  RUN_ALL_TESTS();
}
}
```

---

## How RUN_ALL_TESTS() Works

`RUN_ALL_TESTS()` triggers the entire suite of registered tests to execute:

1. Initializes internal test framework state.
2. Runs all tests sequentially, honoring ordering and dependencies.
3. Collects results, including passed tests, failed assertions, and crashes.
4. Runs global teardown hooks and clean-up.
5. Returns `0` if all tests succeeded, or `1` if any test failed.

You can wrap `RUN_ALL_TESTS()` in your own execution logic if needed but **must only call it once**.

---

## Practical Usage Tips

- **Use the provided `gtest_main` or `gmock_main` libraries whenever possible** to avoid writing boilerplate main code.
- **Customize only when necessary**, e.g., initializing third-party libraries or setting global state before tests.
- **Parse your application-level command line arguments after GoogleTest initialization** if you pass custom options.
- **Use embedded platform compatibility features** to run tests on non-traditional environments.

---

## Troubleshooting Common Issues

- **Tests not running or main() not invoked properly**
  - Ensure you link against `gtest_main` or `gmock_main` if not providing your own main.

- **Flags not working as expected**
  - Confirm you call `InitGoogleTest()` or `InitGoogleMock()` and pass argc/argv.

- **Multiple `RUN_ALL_TESTS()` calls leading to errors**
  - Only invoke `RUN_ALL_TESTS()` once per test binary.

- **Embedded tests failing to initialize**
  - Check the alternative entry points (`setup()`, `loop()`) are implemented correctly.

---

## Summary

Initializing and launching tests with GoogleTest and GoogleMock centers around proper invocation of framework startup functions and test execution through `RUN_ALL_TESTS()`. Utilizing provided main function implementations simplifies integration, but advanced users have full control to customize the test entry point to suit their environment.

---

## References and Related Documentation

- [GoogleTest Primer - Invoking the Tests](https://github.com/google/googletest/blob/main/docs/primer.md#invoking-the-tests)
- [Core Testing APIs - Test Case and Fixture Definition](./test-definition)
- [Mocking APIs - Defining Mocks](../mocking-apis/defining-mocks)
- [Real-World Testing Scenarios - Project Integration & Best Practices](../../guides/real-world-testing-scenarios/integration-and-best-practices)
- [GoogleMock Readme](https://github.com/google/googletest/blob/main/googlemock/README.md)

---

_For details on flags and advanced setup, see the [Advanced Guide](./advanced.md)._