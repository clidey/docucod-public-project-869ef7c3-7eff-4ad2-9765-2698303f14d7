---
title: "Defining Mock Objects"
description: "Guides users through declaring and implementing mock classes using GoogleMock, including usage of the MOCK_METHOD macro, handling const/cv specifiers, and modeling interfaces for robust, maintainable test doubles."
---

# Defining Mock Objects

This reference page guides you through declaring and implementing mock classes using GoogleMock. It focuses on using the `MOCK_METHOD` macro and related features to model interfaces with robust, maintainable test doubles.

---

## Overview

Mock objects are specialized test doubles that let you specify and verify interactions with the code under test. GoogleMock provides a declarative macro (`MOCK_METHOD`) that generates mock methods corresponding to virtual functions in the real interface.

The typical process of defining mock objects involves:

- Deriving a mock class from the interface or base class you want to mock.
- Declaring mock methods using the `MOCK_METHOD` macro in the public section of your mock class.
- Specifying optional qualifiers like `const` or `override` to match the original method signature.

GoogleMock generates method implementations behind the scenes, saving you from writing boilerplate code manually.

---

## Defining Mock Methods Using `MOCK_METHOD`

The `MOCK_METHOD` macro defines a mock method that matches the signature of the method being mocked. Its parameters are:

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgumentTypes...), (Qualifiers));
```

- **ReturnType**: The return type of the method.
- **MethodName**: The name of the mock method.
- **ArgumentTypes...**: The parameter types inside parentheses.
- **Qualifiers** _(optional)_: Comma-separated list inside parentheses specifying method qualifiers, such as `const`, `override`, `noexcept`, `Calltype(...)`, and `ref(...)`.

**Example:**

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Important Notes

- The `MOCK_METHOD` macro **must** be placed in the `public:` section of your mock class, even if the method being mocked is protected or private.
- Wrap return or argument types containing commas with an extra pair of parentheses to avoid parsing errors.

```cpp
MOCK_METHOD((std::pair<int, int>), GetCoordinates, ());
```

- Using type aliases instead of complex types with commas is also supported and recommended for clarity.

---

## Handling Method Qualifiers

To accurately mock methods, specify necessary qualifiers in the last macro parameter:

| Qualifier                     | Description                                   |
|-------------------------------|-----------------------------------------------|
| `const`                       | Marks the method as `const`. Required for overriding const methods. |
| `override`                    | Adds the `override` specifier. Recommended for virtual overrides. |
| `noexcept`                    | Marks method as `noexcept` if overridden method is noexcept. |
| `Calltype(...)`               | Specifies calling convention (e.g., `Calltype(STDMETHODCALLTYPE)`). Useful on Windows. |
| `ref(&)` or `ref(&&)`         | Marks method with reference qualifier. Use if the base method has one. |

**Example:**

```cpp
MOCK_METHOD(int, Foo, (double x), (const, override, noexcept));
```

This mocks a method `int Foo(double) const noexcept override`.

---

## Mocking Overloaded Methods

When mocking overloaded methods, declare each overload you want to mock with its exact signature and qualifiers:

```cpp
class Foo {
 public:
  virtual int Add(int x) = 0;
  virtual int Add(int x, int y) = 0;
  virtual Bar& GetBar() = 0;
  virtual const Bar& GetBar() const = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int x, int y), (override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

If you choose not to mock all overloads, use `using` declarations to bring base class overloads into scope and avoid hiding them unintentionally:

```cpp
using Foo::Add;  // Bring other overloads into scope
```

---

## Mocking Class Templates

Mocking class templates works the same way as regular classes. Define mock classes templated on the same parameters, and mock methods correspondingly:

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int Size() const = 0;
  virtual void Push(const T& elem) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, Size, (), (const, override));
  MOCK_METHOD(void, Push, (const T& elem), (override));
};
```

---

## Mocking Non-Virtual Methods

Though `MOCK_METHOD` requires virtual methods, GoogleMock supports mocking non-virtual methods via a different pattern called high-performance dependency injection. This involves:

- Defining an unrelated mock class with methods matching the signatures of the real class's non-virtual methods.
- Using templates or compile-time mechanisms to swap implementations at compile time.

Example:

```cpp
class ConcretePacketStream {
 public:
  void AppendPacket(Packet* p);
  const Packet* GetPacket(size_t num) const;
  size_t NumberOfPackets() const;
};

class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t num), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

Use template parameters or other dependency injection techniques to swap between the real and mock classes.

---

## ON_CALL vs EXPECT_CALL

- `ON_CALL` specifies default behavior for mock methods without asserting that the method must be called.
- `EXPECT_CALL` specifies both behavior and an expectation that a method will be called a certain number of times with specified argument matchers.

Use `ON_CALL` for default actions shared among many tests, and `EXPECT_CALL` when you want to verify behavior precisely.

---

## Nice, Naggy, and Strict Mocks

GoogleMock provides wrappers to control how uninteresting calls (calls without explicit expectations) are handled:

- `NiceMock<T>`: Suppresses warnings for uninteresting calls.
- `NaggyMock<T>`: Default behavior, warns on uninteresting calls.
- `StrictMock<T>`: Fails tests if uninteresting calls occur.

Usage is straightforward:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
```

Use these carefully to balance test strictness and maintenance.

---

## Practical Tips & Best Practices

- Always put `MOCK_METHOD` declarations in the public section of your mocks for accessibility.
- Use `override` qualifier in `MOCK_METHOD` to catch signature mismatches at compile time.
- Use type aliases to simplify complex return or argument types involving commas.
- When mocking overloaded methods, mock all the forms needed and consider bringing base overloads into scope with `using`.
- Prefer minimal expectations to avoid brittle tests; use `ON_CALL` for default behavior.
- Use sequences (`InSequence`) or ordering (`After`) to constrain call order when necessary.
- For methods with move-only arguments or return types, use lambdas or callable objects in actions.
- For complex actions or matching involving code reuse, define custom matchers and actions.
- Place mock class definitions close to the interface owner or in dedicated test support libraries to reduce maintenance overhead.

---

## Example: Defining a Complete Mock Class

```cpp
#include <gmock/gmock.h>

// The interface to be mocked.
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

// The mock class.
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

Then use this mock in tests to set expectations:

```cpp
using ::testing::AtLeast;
using ::testing::Return;

TEST(PainterTest, CallsPenDown) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  ON_CALL(turtle, GetX()).WillByDefault(Return(42));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

---

## Troubleshooting

### Warning When Mock Method Not Called

If you see warnings about uninteresting calls, consider:

- Suppressing excessive warnings using `NiceMock`.
- Explicitly writing `EXPECT_CALL(mock, Method()).Times(AnyNumber());` if the call is expected but unconstrained.

### Compiler Warnings on Const Parameters

Due to compiler quirks, the `const` on function parameters is often ignored for top-level types. Avoid using `const` in parameter types for mock methods unless necessary (e.g., for pointer or reference parameters).

### Mock Method Compilation Issues with Commas

Wrap complex return or argument types containing commas in parentheses, or use `using` declarations to create type aliases.

### Virtual Destructors

Always ensure interfaces you mock have a **virtual destructor** to avoid undefined behavior and resource leaks.

---

## References and Related Documentation

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — for recipes and techniques.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — concise syntax reference.
- [Matchers Reference](../api-reference/advanced-testing/matchers.mdx) — guide on using matchers with mocks.
- [EXPECT_CALL Syntax Reference](../api-reference/mocking/mock-expectations-actions.mdx) — detailed usage of expectation-building.
- [Using Mocks in Tests Guide](../guides/getting-started/first-mock.mdx) — a start-to-finish tutorial.

---

<Info>
Remember: The power of mocks lies in correctly modeling the interaction contract. Keep mocks focused, use default actions judiciously, and prefer clear, maintainable test expectations.
</Info>

<Check>
Ensure all overridden mock methods have matching qualifiers and signatures, and that `MOCK_METHOD` uses the public section of your mock class.
</Check>
