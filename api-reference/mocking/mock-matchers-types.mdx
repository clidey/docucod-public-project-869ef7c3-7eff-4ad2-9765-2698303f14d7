---
title: "Mock Matchers and Argument Specification"
description: "Details available argument matchers for mock functions, covering basic, composite, and custom matchers. Shows how to distinguish between similar calls and verify interaction patterns with precision."
---

# Mock Matchers and Argument Specification

This documentation provides a comprehensive overview of the argument matchers available for mock functions in GoogleMock (gMock). It covers basic, composite, and custom matchers, detailing ways to precisely distinguish between similar calls and verify interaction patterns in your unit tests.

---

## Introduction

When you create mock methods using `MOCK_METHOD` in your mock class, you want to specify *how* these methods are expected to be called and *with which arguments*. GoogleMock provides *argument matchers* as the primary mechanism to describe these expectations flexibly and intelligibly.

This page focuses on the argument matchers used within `EXPECT_CALL` and `ON_CALL` specifications and how to combine, customize, and apply them to achieve precise control over your mock interactions.

---

## Understanding Argument Matchers

### What Are Matchers?

Matchers act like predicates for method arguments. Instead of just checking for exact values, you can specify properties (e.g., greater than 5, not null, string starts with "hello") to match expected calls.

Matchers can be used with:

- **`EXPECT_CALL`** to specify _expected_ calls with argument conditions.
- **`ON_CALL`** to define default behaviors for calls matching certain arguments.

If no matcher is supplied for an argument, the wildcard matcher `_` is used implicitly, matching *any* value.

### Basic Syntax Example

```cpp
using ::testing::_;
using ::testing::Eq;

// Expect the mock method Foo to be called with argument exactly 10.
EXPECT_CALL(mock, Foo(Eq(10)));

// Expect the mock method Bar to be called with any argument.
EXPECT_CALL(mock, Bar(_));
```

### Omission of Arguments

For non-overloaded methods, you may omit the argument list entirely to specify matches on *any* arguments.

```cpp
EXPECT_CALL(mock, Foo);  // Matches calls to Foo with any arguments
```

For overloaded methods, argument specification is required to disambiguate the intended overload.

---

## Built-in Matchers

GoogleMock provides a rich set of built-in argument matchers in the namespace `testing` to help you express intent precisely. Some of the most commonly used are:

### Wildcard Matcher

- `_` (underscore)

  Matches any value.
  
  ```cpp
  EXPECT_CALL(mock, Foo(_)); // Matches any argument
  ```

### Equality and Inequality

- `Eq(value)` — Matches when argument equals value using `operator==`.
- `Ne(value)` — Matches when argument is not equal to value.

### Comparison Matchers

- `Gt(value)` / `Ge(value)` — Greater than / Greater or equal.
- `Lt(value)` / `Le(value)` — Less than / Less or equal.

### Special Matchers

- `IsNull()` / `NotNull()` — Matches `NULL` and non-`NULL` pointers/smart pointers.
- `Ref(variable)` — Matches if the argument is a reference to the specified variable (checks identity, not just equality).
- `Pointee(matcher)` — For pointer arguments, matches the value pointed to.

### String Matchers

- `StrEq(string)` — Case-sensitive string equality.
- `StrCaseEq(string)` — Case-insensitive string equality.
- `HasSubstr(substring)` — Checks if string contains substring.
- `StartsWith(prefix)`, `EndsWith(suffix)` — Checks prefixes and suffixes.

### Container Matchers

- `ElementsAre(...)` — Checks exact sequence of elements.
- `UnorderedElementsAre(...)` — Checks elements ignoring order.
- `Contains(element_matcher)` — Checks container contains at least one matching element.
- `Each(matcher)` — All elements satisfy matcher.

### Tuple and Pair Matchers

- `Pair(matcher1, matcher2)` — Matches `std::pair` whose first and second elements match the supplied matchers.
- `Field(&Class::member, matcher)` — For objects, matches a specific member with a matcher.
- `Property(&Class::method, matcher)` — For objects, matches return of a const method.

### Predicate Matchers

- `Truly(predicate)` — Uses an arbitrary unary predicate as a matcher.

---

## Composite Matchers

### Combining Matchers

You can combine matchers to express complex argument constraints:

- `AllOf(m1, m2, ...)` — Matches if *all* matchers match.
- `AnyOf(m1, m2, ...)` — Matches if *any* matcher matches.
- `Not(m)` — Logical negation.

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(5), Ne(10))));  // argument >= 5 and not 10
```

### Multi-argument Matcher with `.With()` Clause

Sometimes you want to express constraints on the *combined* argument tuple:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // First argument less than second
```

The `.With()` clause takes a matcher on `std::tuple<A1, A2, ..., An>` that matches all arguments together.

You can specify `.With()` only once, and it must be the first clause in an `EXPECT_CALL` or `ON_CALL`.

### Matching Selected Arguments

Use `Args<k1, k2, ...>(matcher)` to match specific argument positions with a tuple matcher:

```cpp
EXPECT_CALL(mock, Blah)
    .With(AllOf(Args<0, 1>(Lt()), Args<1, 2>(Lt())));
```

This example says argument 0 < argument 1 < argument 2.

### Parameterized Matchers

You can create your own matchers with parameters using:

- `MATCHER_P(name, param, description) { ... }`
- `MATCHER_P2`, `MATCHER_P3`, ... up to 10 parameters

Example:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}
// Usage
EXPECT_CALL(mock, Foo(HasAbsoluteValue(5)));
```

---

## Using Matchers in `EXPECT_CALL` and `ON_CALL`

Matchers are used inside the macro calls to refine which calls are expected or handled.

### Basic Usage

```cpp
EXPECT_CALL(mock, MethodName(MatcherForArg0, MatcherForArg1, ...));
ON_CALL(mock, MethodName(MatcherForArg0, MatcherForArg1, ...))
    .WillByDefault(Action);
```

You can omit matchers for arguments to default to `_` (any value) if the mocked method is not overloaded.

### Common Patterns

- Use `_` to ignore an argument.
- Use specific matchers like `Eq()`, `Ge()`, or compound ones like `AllOf()`.
- Use `.With()` to apply multi-argument constraints.

### Caution with Overloads

If your method is overloaded, always specify the argument list (or use disambiguation helpers like `Const()` for const-qualified overloads) to avoid ambiguity.

### Checking References

If you want to ensure that a particular argument is the same exact object, use `Ref(variable)`.

### Matching Pointer Arguments

To check the value pointed to by a pointer argument, use `Pointee(matcher)`. This safely fails on null pointers.

---

## Advanced Tips

### Combining `EXPECT_CALL`s for Complex Scenarios

Ordering of expectations is important as later `EXPECT_CALL`s override earlier ones. Use this to define a default catch-all expectation followed by specific ones.

```cpp
EXPECT_CALL(mock, Foo(_)).Times(AnyNumber());  // catch-all
EXPECT_CALL(mock, Foo(5)).Times(3);            // specific
```

### Using Matchers as Predicates

You can use a matcher wherever a predicate is expected by wrapping it with `Matches()`. This is particularly useful with algorithms:

```cpp
std::count_if(container.begin(), container.end(), Matches(Ge(10)));
```

### Creating Custom Matchers

Define new matchers to capture intricate argument properties using `MATCHER()`, `MATCHER_P()`, or implement the matcher interface directly for polymorphic or monomorphic matchers.

---

## Examples

### Simple Argument Matchers

```cpp
EXPECT_CALL(mock, Process(5, _));  // first arg must be 5, second any
EXPECT_CALL(mock, Describe(StrCaseEq("hello"))); // case-insensitive match
```

### Using `.With()` for Tuple Checks

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt()); // first arg < second arg
```

### Matching Pointer Arguments

```cpp
EXPECT_CALL(mock, HandleData(Pointee(Eq(42)))); // pointer's pointee == 42
```

### Matching References by Identity

```cpp
int x = 5;
EXPECT_CALL(mock, Foo(Ref(x))); // argument must be reference to x
```

### Custom Parameterized Matcher

```cpp
MATCHER_P(IsMultipleOf, factor, "") {
  return (arg % factor) == 0;
}

EXPECT_CALL(mock, Foo(IsMultipleOf(3)));
```

### Combining Matchers

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(10), Ne(15))));
```

---

## Troubleshooting

- **Ambiguous overloads:** If you get compilation errors due to ambiguous overloaded mocked methods, specify arguments fully or use disambiguation helpers like `Const()`.

- **Unexpected call errors:** If a mock method is called with arguments not matching any `EXPECT_CALL`, gMock reports an unexpected call error. Consider adding a catch-all expectation using `_`.

- **Uninteresting calls warnings:** Calls to mock methods without expectations generate warnings. Use `NiceMock` to suppress, or add `EXPECT_CALL(...).Times(AnyNumber())`.

- **Using references safely:** When using `Ref()`, ensure the referenced object outlives the expectation to avoid undefined behavior.

- **Default action missing:** If a mock function returns a type with no default value and no action is set, it will cause runtime failures. Set default actions using `ON_CALL` or provide `WillOnce` actions appropriately.

---

## Related Documentation and Resources

- [Mocking Reference](../mocking/mock-objects.md) — How to define and use mocks.
- [Matchers Reference](../../advanced-testing/matchers.md) — Full guide to matchers.
- [Mocking Expectations and Actions](../mocking/mock-expectations-actions.md) — Setting expectations, cardinalities, ordering, and actions.
- [gMock Cookbook](../../gmock_cook_book.md) — Practical recipes for advanced usage.

---

## Summary

Matchers empower you to describe exactly which calls your mocks should accept or expect. Combining basic matchers with `.With()`, `AllOf()`, and custom matchers gives you precise control over function call arguments, enabling robust and maintainable tests.

Use this knowledge to avoid brittle tests by specifying only necessary argument constraints and to troubleshoot common errors related to call matching.

---

## Source Code Reference

For the full implementation details of matchers and mock expectation specification, visit the source files:

- [`gmock/include/gmock/gmock-matchers.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-matchers.h)
- [`gmock/include/gmock/gmock-spec-builders.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-spec-builders.h)

---

## Example: Using Matchers to Distinguish Similar Calls

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (int x, int y), (override));
};

using ::testing::Eq;
using ::testing::_;
using ::testing::AllOf;
using ::testing::Gt;

MockFoo mock;

// Default expect any x and y.
EXPECT_CALL(mock, Compute(_, _))
    .WillRepeatedly(Return(0));

// Expect calls where x > y to return 1
EXPECT_CALL(mock, Compute(AllOf(Gt(1), _), _))
    .WillRepeatedly(Return(1));

// Expect calls where y == 10 to return 2
EXPECT_CALL(mock, Compute(_, Eq(10)))
    .WillRepeatedly(Return(2));

// Use the mock
EXPECT_EQ(mock.Compute(3, 10), 2); // Matches last EXPECT_CALL
EXPECT_EQ(mock.Compute(5, 2), 1);  // Matches 2nd EXPECT_CALL
EXPECT_EQ(mock.Compute(0, 0), 0);  // Matches 1st EXPECT_CALL
```

This demonstrates how matchers allow you to precisely control the behavior depending on argument values and distinguish between overlapping cases.

---

## Practical Tips

- Define complex argument checks as reusable matchers to improve readability.
- Prefer `.With()` with a multi-argument tuple matcher for cross-argument constraints.
- Use `Ref()` to check argument identity, not just equality.
- Use nested `Pointee()` for multi-level pointer matchers.
- When matching containers, consider `ElementsAre()` for order-sensitive and `UnorderedElementsAre()` for order-insensitive checks.

---