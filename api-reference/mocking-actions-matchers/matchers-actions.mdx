---
title: "Matchers & Actions for Mocks"
description: "Catalogs the matchers and action APIs tailored for use with mocks: argument matchers, result actions, and composing custom behaviors. Includes examples ranging from basic value-checking to invoking functors and capturing values during calls."
---

# Matchers & Actions for Mocks

This page catalogs the matchers and action APIs tailored for use with mocks within GoogleMock. It covers argument matchers, result actions, and the creation of custom behaviors for mock methods. Examples range from basic value checking to invoking functors and capturing values during calls, helping you simulate and verify complex interactions in your tests.

---

## Overview

Matchers and Actions form the backbone of GoogleMock's ability to specify detailed expectations on mock method calls. Matchers allow precise control over which arguments are considered a match for an expectation, while Actions specify the behavior a mock function should perform when invoked.

When building tests that leverage mock objects, you use matchers to describe argument constraints and actions to define what occurs upon those calls, such as returning specific values, modifying arguments, or invoking callbacks.

This page focuses exclusively on these APIs relating to mocks, assuming familiarity with the core mocking concepts. For the wider context, see the [Mock Objects and Methods](reference/mocking-actions-matchers/mock-objects-and-methods.md) and [Expectations and Sequences](reference/mocking-actions-matchers/expectations-and-sequences.md) pages.

---

## Matchers for Mock Arguments

Matchers are predicates that determine if a particular function argument satisfies the specified condition in an expectation. They allow flexible and expressive constraints beyond simple value equality.

### Basic Usage

Within an `EXPECT_CALL` or `ON_CALL` statement, you specify matchers corresponding to each argument of the mock method:

```cpp
EXPECT_CALL(mock_object, Method(Matcher1(), Matcher2(), ...));
```

- Literal values implicitly become equality matchers (i.e., `Eq(value)`).
- The wildcard matcher `_` matches any value and is useful when you don't care about certain arguments.

Example:

```cpp
EXPECT_CALL(turtle, GoTo(50, _));  // X coordinate must be 50, Y can be anything
```

### Combining Matchers

You can compose complex match criteria using combinators such as `AllOf()`, `AnyOf()`, `Not()`, and `AllOfArray()`, enabling conditions like "argument > 5 and not equal to 10":

```cpp
EXPECT_CALL(foo, DoThis(AllOf(Gt(5), Ne(10))));
```

### Multi-Argument Matching: `.With()` Clause

Sometimes it’s necessary to match multiple arguments together rather than independently. Use the `.With()` clause on `EXPECT_CALL` or `ON_CALL` to apply a matcher on the entire tuple of arguments as a whole:

```cpp
EXPECT_CALL(foo, Bar(_, _))
    .With(Lt());  // First argument less than second argument
```

This is particularly useful when argument relationships matter.

### Handling Overloaded Functions

For overloaded mock methods, you must specify all argument matchers to avoid ambiguity. Use helper wrappers like `Const()` if needed to disambiguate const overloads. See the [Select Overload](gmock_cook_book.md#SelectOverload) section in the Cookbook.

### Safe Casting of Matchers

Use `SafeMatcherCast<T>(m)` to cast matchers to a different type safely when mismatches between argument types and matcher types occur, such as matching an `int` argument with a `Matcher<long>`.

### Custom Matchers

You can define your own matchers using the `MATCHER`, `MATCHER_P`, and related macros for flexible, reusable predicates. This is useful for domain-specific constraints not covered by built-in matchers.

---

## Actions for Mock Methods

Actions define what a mock method does when invoked. They range from returning fixed or calculated results to modifying arguments or calling callbacks.

### Returning Values

- `Return(value)` returns a copy of the value.
- `ReturnRef(variable)` returns a reference.
- `ReturnPointee(ptr)` returns the value pointed to by a pointer.
- `ReturnNew<T>(args...)` returns a new object pointer created each time.

Example:

```cpp
EXPECT_CALL(mock, GetNumber())
    .WillOnce(Return(42))
    .WillRepeatedly(Return(7));
```

### Side Effects on Arguments

Use actions like `SetArgPointee<N>(value)`, `SetArrayArgument<N>(first, last)`, and `SaveArg<N>(pointer)` to set or capture output parameters or modify arguments during calls.

Example:

```cpp
EXPECT_CALL(mock, Mutate(true, _))
    .WillOnce(SetArgPointee<1>(5)); // Sets second argument to 5
```

### Calling Functions, Lambdas, or Methods

With `Invoke()`, you can specify a callable to run, either free functions, member functions, lambdas, or functors:

```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce(Invoke(MyFunction));
```

For zero-argument or ignoring mock arguments, use `InvokeWithoutArgs()`.

### Invoking Callable Arguments

If a mock method takes a callback or functor as an argument, `InvokeArgument<N>(args...)` invokes the N-th argument with the specified parameters.

Example:

```cpp
EXPECT_CALL(mock, DoThis(_, _))
    .WillOnce(InvokeArgument<1>(5)); // Calls the second argument as a callback with 5
```

### Composite Actions

You can combine multiple actions with `DoAll()`, run actions ignoring results with `IgnoreResult()`, or select subset of arguments for actions (`WithArg<N>`, `WithArgs<N1, N2...>`).

Example of chaining:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

### Writing Custom Actions

Define new actions easily with lambdas or `ACTION` macros. These can perform any logic needed and return values suitable for the mock method.

Example:

```cpp
ACTION(IncrementArg1) { return ++(*arg1); }
EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementArg1());
```

### Delegating Actions

You can delegate mock method calls to real or fake implementations by setting default actions to invoke those objects, allowing hybrid behaviors.

---

## Practical Examples

### Simple Matcher and Action

```cpp
// Mock method expects an int argument greater than 5
EXPECT_CALL(mock, Compute(Gt(5)))
    .WillOnce(Return(42));
```

### Matching Multiple Arguments

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt())  // first arg < second arg
    .WillOnce(Return(true));
```

### Returning Values Sequentially

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### Saving Arguments for Later Verification

```cpp
int saved;
EXPECT_CALL(mock, Process(_))
    .WillOnce(SaveArg<0>(&saved));

// later
EXPECT_EQ(saved, expected_value);
```

### Invoking a Callback Argument

```cpp
EXPECT_CALL(mock, DoAsync(_, _))
    .WillOnce(InvokeArgument<1>(true)); // calls second arg as callback with true
```

### Custom Matcher Class

```cpp
MATCHER(IsEven, "checks if the number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

### Defining a Mock Method with Qualifiers

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, DoWork, (int x), (const, override));
};
```

---

## Troubleshooting and Best Practices

- Always place `MOCK_METHOD` declarations in the `public:` section of your mock class, even when mocking protected or private methods. This ensures they are accessible to testing macros.
- Avoid over-specifying matchers and expectations; specify only what matters to keep tests maintainable and robust.
- Use `ON_CALL` to define default behaviors without setting expectations to reduce test brittleness.
- Use `NiceMock` to suppress warnings for uninteresting calls, and `StrictMock` to fail on unexpected calls.
- Make use of `InSequence` and `After` to control call ordering precisely.
- When matching tuples or multiple arguments together, remember to use `.With()` with appropriate tuple matchers.
- Beware of unprotected commas in arguments to `MOCK_METHOD`; either wrap types in parentheses or use `using` type aliases to avoid parsing errors.
- Always specify return values or behaviors for move-only types carefully using lambdas or `WillOnce` with callable objects.

---

## Additional Resources

- [Mock Objects and Methods Reference](reference/mocking-actions-matchers/mock-objects-and-methods.md)
- [Expectations and Sequences Reference](reference/mocking-actions-matchers/expectations-and-sequences.md)
- [gMock Cookbook](guides/writing-and-structuring-tests/gmock_cook_book.md) — for hands-on recipes and tips
- [Matchers Reference](api-reference/core-testing-api/matchers-api.md)
- [Actions Reference](reference/actions.md)
- [gMock for Dummies Tutorial](guides/getting-started/gmock_for_dummies.md)

Explore these to deepen your mastery of GoogleMock’s matchers and actions, and write tests that express your intent clearly and powerfully.

---

<AccordionGroup title="Matchers & Actions Details">
<Accordion title="Argument Matchers">
Matchers are predicates for mock arguments; use built-in matchers like `_` (wildcard), `Eq()`, `Ge()`, and combine with `AllOf()`, `AnyOf()` for expressive expectations.
</Accordion>
<Accordion title="Actions Overview">
Actions define what mock methods do when called: returning values, invoking callbacks, setting output parameters, or throwing exceptions.
</Accordion>
<Accordion title="Using .With() Clause">
Use `.With(matcher)` to match/mock methods using combined argument logic, matching the entire argument tuple instead of individual arguments.
</Accordion>
<Accordion title="Defining Custom Matchers and Actions">
Create custom matchers using `MATCHER` and actions using `ACTION` macros or lambdas for domain-specific requirements.
</Accordion>
<Accordion title="Common Pitfalls">
- Failing to wrap complex argument types in parentheses in `MOCK_METHOD`.
- Over-specifying expectations causing brittle tests.
- Forgetting to specify return values for move-only types.
- Misordering expectations affecting match precedence.
</Accordion>
<Accordion title="Best Practices">
- Use `ON_CALL` for default behavior and `EXPECT_CALL` only when verifying calls.
- Use `NiceMock` to suppress uninteresting-call warnings in unwary tests.
- Sequence expectations with `InSequence` for ordering or use `After` to model dependencies.
- Save arguments for later verification instead of complex match conditions.
</Accordion>
</AccordionGroup>
