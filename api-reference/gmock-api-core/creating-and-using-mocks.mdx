---
title: "Creating and Using Mock Classes"
description: "Step-by-step explanation of defining mock classes and methods, leveraging the MOCK_METHOD macros, and working with NiceMock, NaggyMock, and StrictMock wrappers for behavioral tuning."
---

# Creating and Using Mock Classes

This guide walks you through the step-by-step process of defining mock classes and methods using gMock's `MOCK_METHOD` macros. You will also learn how to leverage `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to finely tune mock object behavior according to your testing needs.

---

## Understanding Mock Classes

A mock class simulates the behavior of a real class for testing purposes. It implements the same interface as the real class but allows you to specify expectations and behaviors at runtime.

### Defining a Mock Class

Start by inheriting from the class you want to mock. Each virtual method you want to mock is declared publicly using the `MOCK_METHOD` macro:

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual std::string Describe(int type) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

*Note:* The destructor of the base class must be virtual to avoid undefined behavior.

### Handling Commas in Method Signatures

If method parameters or return types include commas (like templates), enclose them in an extra set of parentheses or use type aliases to prevent parsing errors:

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

  // or
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

### Public Scope for Mock Methods

Always declare mock methods in the `public:` section of your mock class, even if the original methods are `protected` or `private`.

### Mocking Overloaded Methods

You can mock each overloaded variant by declaring them separately:

```cpp
mockAdd(int);
mockAdd(Element);
mockAdd(int, Element);
// Use MOCK_METHOD with proper argument list and qualifiers
```

Use `using Base::MethodName` inside your mock to avoid hiding base class overloads you don't want to mock.

### Mocking Class Templates

Mock templates just as normal classes by templating your mock class:

```cpp
template <typename Elem>
class StackInterface {
 public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const Elem& x) = 0;
};

template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```


## Using MOCK_METHOD Macros

`MOCK_METHOD` supports optional specifiers:
- `const` – mark method as const
- `override` – specify it overrides a virtual method
- `noexcept` – for noexcept methods
- `Calltype(X)` – for special calling conventions
- `ref(&)` or `ref(&&)` – for reference qualifiers

Example:
```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE)));
MOCK_METHOD(int, Bar, (double x, double y), (const, Calltype(STDMETHODCALLTYPE)));
```

## Behavior Wrappers: NiceMock, NaggyMock, and StrictMock

By default, mock objects produce warnings on uninteresting calls (methods called without expectations). You can control this behavior using wrappers:

- `NiceMock<T>`: suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: prints warnings on uninteresting calls (default behavior).
- `StrictMock<T>`: treats uninteresting calls as errors, causing tests to fail.

Usage examples:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;    // Ignores uninteresting calls
NaggyMock<MockFoo> naggy_foo;  // Default, warns on uninteresting calls
StrictMock<MockFoo> strict_foo; // Fails on uninteresting calls
```

These wrappers subclass the mock class, so they can be used wherever the mock is accepted and support passing constructor arguments.


## Using Mock Classes in Tests

The typical workflow is:

1. Import necessary gMock names:

```cpp
using ::testing::Return;
```

2. Instantiate your mock:

```cpp
MockFoo foo;
```

3. Optionally, set default actions using `ON_CALL`:

```cpp
ON_CALL(foo, GetSize()).WillByDefault(Return(1));
```

4. Define expectations with `EXPECT_CALL`:

```cpp
EXPECT_CALL(foo, Describe(5)).Times(3).WillRepeatedly(Return("Category 5"));
```

5. Run your test code which exercises the mock:

```cpp
EXPECT_EQ(MyProductionFunction(&foo), "good");
```

6. At destruction, gMock verifies all expectations automatically.


## Best Practices and Tips

- Define all mock methods you expect to be called; missing mocks can cause compile-time or runtime issues.
- Use `NiceMock` in early development to avoid excessive warnings, and `StrictMock` when you want to enforce precise behavior.
- Use `ON_CALL` for setting defaults when you don't want to assert calls are made.
- Keep mock destructors virtual.
- Use `RetiresOnSaturation()` to retire expectations after upper bounds.

## Common Pitfalls

- Forgetting virtual destructor in base class leads to leaks.
- Mocking non-virtual methods requires a different pattern.
- Overloaded methods need careful mocking and disambiguation.
- Beware of unreasonable `EXPECT_CALL` orders; place more specific expectations after general ones.

## Troubleshooting Verification

You can explicitly verify and clear mock expectations anytime:

```cpp
using ::testing::Mock;

Mock::VerifyAndClearExpectations(&mock_obj);
Mock::VerifyAndClear(&mock_obj);  // also clears ON_CALL actions
```

Mark mock leaks allowed if you have ownership outside test:

```cpp
Mock::AllowLeak(&mock_obj);
```

---

For a comprehensive reference and additional recipes, see [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) and the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

---

<Info>
This page focuses specifically on creating and configuring mock classes and behaviors using `MOCK_METHOD` and mock wrappers. For setting expectations, controlling actions, and defining custom matchers, see related documentation in the gMock API Reference.
</Info>

---

# Quick Example

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(int, GetSize, (), (const));
  MOCK_METHOD(std::string, Describe, (int), ());
};

using ::testing::NiceMock;

TEST(FooTest, Example) {
  NiceMock<MockFoo> foo;

  ON_CALL(foo, GetSize()).WillByDefault(::testing::Return(10));
  EXPECT_CALL(foo, Describe(5)).Times(1).WillOnce(::testing::Return("five"));

  // Exercise
  EXPECT_EQ(10, foo.GetSize());
  EXPECT_EQ("five", foo.Describe(5));
}
```

---

# See Also

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock FAQ](https://google.github.io/googletest/gmock_faq.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)

# Source Code

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/gmock_cheat_sheet.md", "range": "1-193"},{"path": "docs/gmock_cook_book.md", "range": "1-950"},{"path": "docs/reference/mocking.md", "range": "1-856"}]} />