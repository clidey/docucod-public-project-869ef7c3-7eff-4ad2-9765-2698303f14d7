---
title: "Configuring Actions and Return Values"
description: "Describes how to control the outputs and side effects of mock methods, including built-in actions, custom actions, parameter manipulation, and advanced templates and variadics."
---

# Configuring Actions and Return Values

GoogleTest's GoogleMock provides powerful ways to control the behavior of mock methods, allowing you to specify return values and side effects precisely. This page covers how you can configure these actions including built-in actions, writing custom actions, manipulating parameters, and using advanced templating and variadic techniques to meet complex mocking needs.

---

## 1. Overview of Configuring Actions and Return Values

When setting up mocks, your primary goal is to simulate how the mock methods behave at runtime. GoogleMock gives you:

- **Built-in actions** like `Return()`, `ReturnRef()`, `SetArgPointee()`, etc., to specify straightforward return values and side effects.
- **Custom actions**, defined via lambda functions, functors, or macros to enable complex behaviors beyond simple value returns.
- Facilities to manipulate **parameters passed by reference or pointer** to emulate realistic side effects.
- Template-based macros and utilities that help you craft parameterized and variadic actions for greater flexibility.

With these tools, you can precisely model the expected behavior of dependencies in your unit tests.

---

## 2. Built-in Actions for Return Values and Side Effects

GoogleMock offers a comprehensive set of built-in actions that can be used directly in your tests:

### Return Value Actions

| Action                                  | Description                                                                |
|----------------------------------------|----------------------------------------------------------------------------|
| `Return()`                             | Returns from a `void` mock method.                                         |
| `Return(value)`                       | Returns the specified `value`. Conversion to the return type happens at expectation setup time, not execution time. |
| `ReturnNull()`                        | Returns a null pointer (useful for pointer return types).                  |
| `ReturnRef(variable)`                 | Returns a reference to an existing variable. Useful for methods returning references. |
| `ReturnRefOfCopy(value)`              | Returns a reference to a *copy* of the value which lives as long as the action. |
| `ReturnRoundRobin({v1, v2, ...})`      | Each call returns the next value in the list, cycling back to the start after the end. |
| `ReturnArg<N>()`                     | Returns the N-th argument passed to the mock method.                        |
| `ReturnPointee(ptr)`                 | Returns the value pointed to by `ptr`. Supports raw and smart pointers.    |

### Side Effect Actions

| Action                              | Description                                                                                  |
|------------------------------------|----------------------------------------------------------------------------------------------|
| `SetArgPointee<N>(value)`           | Sets the variable pointed to by the N-th argument (0-based) to the specified `value`.       |
| `SetArrayArgument<N>(first, last)` | Copies elements from `[first, last)` to the array pointed to by the N-th argument or iterator.| 
| `SetArgReferee<N>(value)`           | Sets the reference referred to by the N-th argument to `value`.                             |
| `SaveArg<N>(pointer)`               | Saves a copy of the N-th argument to `*pointer`.                                            |
| `SaveArgByMove<N>(pointer)`         | Moves the N-th argument into `*pointer`.                                                    |
| `SaveArgPointee<N>(pointer)`        | Saves the value pointed to by the N-th argument to `*pointer`.                              |
| `DeleteArg<N>()`                   | Deletes the pointer passed as the N-th argument.                                           |
| `Assign(&variable, value)`          | Assigns the `value` to the specified pointer `variable`.                                    |
| `SetErrnoAndReturn(error, value)`   | Sets `errno` to `error` and returns `value` (useful for simulating system calls).           |
| `Throw(exception)`                  | Throws the specified exception when the mock method is called (requires exceptions enabled).|

### Combining Actions

- Use `DoAll(a1, a2, ..., an)` to execute multiple actions in sequence where all but the last must return `void`, and the last action's return value is returned by the mock method.
- Use `IgnoreResult(a)` to perform action `a` and ignore its return value, useful when the mock method returns `void`.
- Use `WithArg<N>(a)`, `WithArgs<N1, N2, ...>(a)`, and `WithoutArgs(a)` to adapt which mock method arguments are passed to the action.

---

## 3. Using Functions and Lambdas as Actions

GoogleMock seamlessly lets you use free functions, member functions, lambdas, or functor objects as actions.

```cpp
using ::testing::Invoke;

class MockFoo {
 public:
  MOCK_METHOD(int, Sum, (int x, int y), (override));
};

int CalculateSum(int x, int y) { return x + y; }

MockFoo foo;
EXPECT_CALL(foo, Sum(_, _))
    .WillOnce(Invoke(&CalculateSum))
    .WillRepeatedly([](int x, int y) { return x * y; });

int result1 = foo.Sum(2, 3); // returns 5
int result2 = foo.Sum(2, 3); // returns 6 (lambda used repeatedly)
```

- Lambdas can ignore parameters if desired.
- Member functions can be invoked via `Invoke(object_ptr, &Class::Method)`.
- Use `InvokeWithoutArgs()` variants if the called function takes no parameters.

---

## 4. Custom Actions Using ACTION Macros

When your behavior can't be expressed with built-in actions or lambdas easily, define custom actions with `ACTION` or `ACTION_P` macros.

```cpp
ACTION(IncrementSecondArg) {
  (*arg1)++;
}

ACTION_P(AddValueToFirst, n) {
  return arg0 + n;
}

// Usage
EXPECT_CALL(mock, Foo(_, _))
    .WillOnce(IncrementSecondArg())
    .WillOnce(AddValueToFirst(5));
```

- You can define parameterized actions up to 10 parameters: `ACTION_P2`, `ACTION_P3`...
- These macros provide typed access to arguments (`arg0`, `arg1_type`, `args`, etc.).
- Parameterized actions give concise control over actions with additional data.

---

## 5. Advanced Templates and Variadic Actions

Advanced use cases involving templates and variadic arguments are supported via `ACTION_TEMPLATE`. This allows you to specify actions with explicit template parameters and value parameters for maximal flexibility.

Example for an action template with integral and type parameters:

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(std::get<k>(args));
}

// Usage: saves the k-th argument converted to type T to *output
EXPECT_CALL(mock, Foo(_, _)).WillOnce(DuplicateArg<1, unsigned char>(&n));
```

- Supports up to 10 explicit template parameters and 10 value parameters.
- Useful for writing reusable, type-safe actions.

---

## 6. Configuring Default and Repeated Actions

Use `ON_CALL` to specify default mock method behavior without setting call expectations:

```cpp
ON_CALL(mock, SomeMethod(_)).WillByDefault(Return(42));
```

- `ON_CALL` does not enforce the method to be called like `EXPECT_CALL` does.
- Use `WillOnce()` and `WillRepeatedly()` in `EXPECT_CALL` to specify one-time or repeated behaviors.
- The last matching `ON_CALL` or `EXPECT_CALL` has precedence.

**Best Practice:** Use `ON_CALL` for common default behaviors, and `EXPECT_CALL` for verifying specific calls and setting per-call actions.

---

## 7. Practical Tips, Best Practices, and Common Pitfalls

- **Use `ReturnRef` carefully:** The returned reference must remain valid for the duration of its use.
- **Avoid unintentional copies:** Know the difference between `Return`, `ReturnRef`, `ReturnRefOfCopy`.
- **Chaining actions:** `DoAll()` can combine side effects like `SetArgPointee` with return values.
- **Using `SaveArg` actions:** Helps verify complex arguments later instead of inlined matchers.
- **Beware of move-only types:** Use lambdas or `Return(ByMove(...))` for move-only return values.
- **Suppress unwanted warnings:** Use `NiceMock` if you want to ignore uninteresting calls.
- **Over-constraining expectations:** Avoid excessive `EXPECT_CALL` settings that make tests brittle.

---

## 8. Example Walkthrough

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::SetArgPointee;
using ::testing::DoAll;

class MockProcessor {
 public:
  MOCK_METHOD(bool, Process, (int input, int* result), (override));
};

TEST(ProcessorTest, ProcessesCorrectly) {
  MockProcessor mock;

  // When Process() is called, set *result = input*2, and
  // return true.
  EXPECT_CALL(mock, Process(_,_))
      .WillOnce(DoAll(SetArgPointee<1>(42), Return(true)));

  int output = 0;
  bool status = mock.Process(21, &output);

  EXPECT_TRUE(status);
  EXPECT_EQ(42, output);
}
```

This example shows setting a side effect and return value together, modeling a function that modifies an output parameter and returns a success flag.

---

## 9. Troubleshooting

- **Uninteresting calls warning:** Occurs if calls are made to methods without expectations. Use `NiceMock` or add `EXPECT_CALL(...).Times(AnyNumber())` if calls are expected but not verified.
- **Default return values:** If a mock method returns a non-void type but no action is set, GoogleMock returns the default-constructed value if available; otherwise, you must set a default return value using `ON_CALL` or `DefaultValue<T>::Set`.
- **Move-only return values:** Use lambdas or `Return(ByMove(std::move(obj)))` to handle them.
- **Action chaining errors:** When combining actions with `DoAll()`, ensure only the last action returns a non-void value.

---

## 10. Additional Resources and Cross References

- [`EXPECT_CALL` Reference](reference/mocking.md#EXPECT_CALL)
- [`ON_CALL` Reference](reference/mocking.md#ON_CALL)
- [Actions Reference](docs/reference/actions.md)
- [Mocking Cookbook](docs/gmock_cook_book.md#Setting-Expectations)
- [Writing New Actions](docs/gmock_cook_book.md#Writing-New-Actions)

Explore the [Matchers Reference](api-reference/gtest-api-core/using-matchers) for controlling argument matching, and the [Creating and Using Mock Classes](api-reference/gmock-api-core/creating-and-using-mocks) guide for a holistic mocking approach.

---

For example usages, deeper concepts, and troubleshooting, the GoogleMock GitHub repository and official GoogleTest documentation are invaluable resources.

---