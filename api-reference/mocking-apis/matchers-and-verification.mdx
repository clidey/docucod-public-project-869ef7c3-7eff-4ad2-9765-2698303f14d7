---
title: "Argument Matchers and Verification"
description: "Comprehensive guide to using argument matchers for mocks. Explains built-in matchers, matcher composition, custom matchers, and advanced matcher patterns to ensure precise and flexible expectations for mock methods."
---

# Argument Matchers and Verification

Unlock the full power of GoogleMock by mastering argument matchers that let you precisely specify and verify function call inputs on mock objects. This guide explains everything from the built-in matchers, composing complex matchers, creating custom matchers, and advanced patterns that empower comprehensive and flexible expectations on mock methods.

---

## 1. Understanding Argument Matchers

Argument matchers transform the way you specify expectations on mock method parameters. Instead of rigidly checking for exact values, matchers allow flexible, expressive criteria that tests must satisfy for the mock call to be considered valid.

### Basic Usage

- Matchers can match _any_ argument (`_`) or be more specific (`Eq(value)`, `Ge(min)`, `NotNull()`, etc).
- They form the core of the `.EXPECT_CALL()` macros to validate arguments passed to mocks.

#### Example:

```cpp
using ::testing::_;
using ::testing::Ge;

EXPECT_CALL(mock, ProcessValue(Ge(10)))  // Argument must be >= 10
    .Times(AtLeast(1));
```

---

## 2. Built-in Matchers

GoogleMock ships with a rich collection of argument matchers:

- **Wildcard Matcher**: `_` matches anything
- **Equality and Relational**: `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- **Nullability**: `IsNull()`, `NotNull()`
- **String Matchers**: `StrEq()`, `StrNe()`, `StrCaseEq()`, `HasSubstr()`, `StartsWith()`, `EndsWith()`
- **Pointer Matchers**: `Pointee()`, `WhenDynamicCastTo()` (requires RTTI)
- **Container Matchers**: `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, `SizeIs()`, `IsEmpty()`
- **Composite Matchers**: `AllOf()`, `AnyOf()`, `Not()`, `Truly()`

<Accordion title="Common Built-in Matcher Examples">

```cpp
EXPECT_CALL(foo, DoThis(_));                        // Matches any argument
EXPECT_CALL(foo, DoThis(Eq(42)));                   // Matches argument == 42
EXPECT_CALL(foo, DoThis(Ge(10)));                   // Argument >= 10
EXPECT_CALL(foo, DoThis(NotNull()));                 // Non-null pointer
EXPECT_CALL(foo, ReceiveString(StrEq("hello"))); // String equals "hello"
EXPECT_CALL(foo, Operate(Pointee(Gt(100))));        // Points to value > 100
EXPECT_CALL(foo, ProcessVector(ElementsAre(1, _, 3))); // First=1, third=3, second=anything
```

</Accordion>

---

## 3. Composite Matchers: Combining Matchers for Complex Criteria

Matchers can be combined and nested for nuanced checks using:

- `AllOf(...)`: all of the provided matchers must match
- `AnyOf(...)`: at least one must match
- `Not(m)`: negates matcher m

### Example - Multiple Constraints

```cpp
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Ne;

EXPECT_CALL(mock, SetVolume(AllOf(Gt(0), Ne(10))));  // Volume > 0 and != 10
```

### Multi-Argument Matchers with `.With`

Sometimes you want to match based on the combined value of multiple arguments.
Use `.With()` with a tuple matcher.

```cpp
using ::testing::Lt;
using ::testing::_;

EXPECT_CALL(mock, Move(_, _)).With(Lt());  // First argument < second argument
```

---

## 4. Custom Matchers

When built-in matchers are insufficient, you can create custom matchers easily.

### Using `MATCHER` Macro

Defines a matcher with a predicate on the argument value.

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

### Adding Parameters: `MATCHER_P` and Variants

```cpp
MATCHER_P(HasAbsoluteValue, val, "") {
  return abs(arg) == val;
}

EXPECT_CALL(mock, Foo(HasAbsoluteValue(10)));
```

### More Control: Implement MatcherInterface

For advanced uses, implement the matcher interface (`MatchAndExplain()`, `DescribeTo()`) directly for precise behavior and descriptive error messages.

---

## 5. Using Matchers as Predicates

Matchers can be used wherever predicates are accepted by wrapping them with `Matches()`:

```cpp
std::vector<int> v{1, 2, 3, 5};
int count = std::count_if(v.begin(), v.end(), Matches(Gt(2))); // counts elements > 2
```

---

## 6. Matching Complex Argument Types

### Matching Inside Objects

Validate members or properties via `Field()` and `Property()`:

```cpp
EXPECT_CALL(mock, Process(Field(&MyClass::id, Eq(5))));
EXPECT_CALL(mock, Check(Property(&MyClass::name, StartsWith("John"))));
```

### Matching Values Pointed To

`Pointee(m)` matches pointers whose pointee matches `m`.

```cpp
EXPECT_CALL(mock, ReceivePtr(Pointee(Ge(5))));
```

### Matching Containers

Matchers like `ElementsAre()`, `UnorderedElementsAre()` validate container contents flexibly:

```cpp
EXPECT_CALL(mock, AcceptVector(ElementsAre(1, _, 3)));  // 3 elements, 1 and 3 fixed
```

---

## 7. Best Practices for Expectations and Matchers

- **Use `_` or simple matchers to avoid brittle tests:** Match only what matters.
- **Prefer `ON_CALL()` for default behavior, `EXPECT_CALL()` for actual verification.**
- **Order matters:** Place more specific expectations later to override defaults.
- **Combine small matchers into a composable expression:** Easier to read, maintain, and extend.
- **Custom matchers should be pure and side-effect free.**

<Tip>
Be judicious with `EXPECT_CALL` to avoid over-specification, which leads to brittle tests. Use `ON_CALL` to set default behavior and reserve `EXPECT_CALL` for actual call verification.
</Tip>

---

## 8. Matcher Verification and Expectation Behavior

Matchers are primarily used in `EXPECT_CALL()` to specify which calls are expected on mocks. The framework verifies:

- Calls match the argument matchers.
- Calls happen the expected number of times (cardinality).
- Calls obey order constraints (`InSequence`, `After`).

If calls do not match the set matchers, GoogleMock reports detailed errors showing expected vs actual argument mismatch.

### Using `.With()`

Use `.With()` to apply a tuple matcher to the full set of arguments, useful when the relation between arguments matters.

### Partial and Complex Ordering

GoogleMock supports complex sequencing of calls using:

- `InSequence` blocks for total ordering.
- `After()` clause for partial ordering dependencies.
- `Sequence` objects for flexible DAG ordering.

### Retiring Expectations

Use `.RetiresOnSaturation()` to make an expectation inactive once fulfilled, allowing overlapping expectations to activate as needed.

---

## 9. Troubleshooting and Tips

- If you get warnings about uninteresting calls, consider if those calls should be expected, or use `NiceMock` to suppress warnings.
- For overloaded methods, disambiguate using `Const()` or explicit matcher types.
- For complex argument matching, save arguments with `SaveArg` for separate verification.
- When using complicated matchers in many places, assign matchers to variables for reuse and clarity.

---

## 10. Related Tools: SafeMatcherCast and MatcherCast

- Use `SafeMatcherCast<T>(m)` when you want the compiler to ensure safety when casting a matcher `m` to `Matcher<T>`, allowing implicit conversions without loss.
- Use `MatcherCast<T>(m)` for more permissive casting but potentially less safety.

---

## Sample Workflow Example

```cpp
using ::testing::_;
using ::testing::Ge;
using ::testing::Return;

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
};

TEST(CalculatorTest, AddsPositiveNumbers) {
  MockCalculator mock;
  EXPECT_CALL(mock, Add(Ge(0), Ge(0)))  // both args >= 0
      .WillOnce(Return(42));

  int result = mock.Add(10, 32);
  EXPECT_EQ(result, 42);
}
```

This example sets a matcher expecting both arguments to `Add()` to be non-negative. The test supplies arguments `(10, 32)`, which satisfy the matcher, and the mock returns `42`.

---

For more detailed information on argument matchers and verification, please read the [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md), the [Mocking Guide](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md), and the GoogleMock API reference sections.
