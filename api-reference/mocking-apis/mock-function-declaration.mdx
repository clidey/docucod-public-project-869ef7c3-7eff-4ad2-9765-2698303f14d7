---
title: "Mock Function Declaration and Setup"
description: "How to create, configure, and set up mock classes and methods using the provided macros. Demonstrates usage of MOCK_METHOD, fixture integration, and customization of mock behaviors."
---

# Mock Function Declaration and Setup

This page explains how to create, configure, and set up mock classes and methods using GoogleTest's mocking macros, focusing on the `MOCK_METHOD` macro, fixture integration, and customizing mock behaviors. It guides you through declaring mock methods inside classes, supports overloaded methods, and handles qualifiers like `const` and `override`.

---

## 1. Defining Mock Methods with `MOCK_METHOD`

At the heart of writing mock classes in GoogleTest lies the `MOCK_METHOD` macro. It enables you to declare mock versions of methods in your classes with minimal boilerplate.

### Syntax
```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- `ReturnType`: The return type of the mocked method.
- `MethodName`: The name of the mocked method.
- `(Args...)`: Exactly the list of argument types (with parentheses).
- `(Specs...)` (optional): Qualifiers like `const`, `override`, `noexcept`, reference qualifiers, or calling conventions.

### Example
```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, MoveTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Notes on Usage
- Always place `MOCK_METHOD` declarations in the `public:` section of your class, even if you mock protected or private methods. This allows `EXPECT_CALL` and `ON_CALL` macros to access them properly.

- When a method is `const`, `override`, `noexcept`, or uses reference qualifiers, include these in the fourth argument as a comma-separated list inside parentheses.

- To mock methods with calling conventions (e.g., `STDMETHODCALLTYPE` on Windows), add `Calltype(STDMETHODCALLTYPE)` to the specs.

### Handling Commas in Types
If your return type or arguments contain commas (e.g., templates like `std::map<int, std::string>`), the macro parser can get confused.

Solutions:

1. Wrap the type in an extra pair of parentheses:
```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

2. Use type aliases:
```cpp
using BoolAndInt = std::pair<bool, int>;
using MapIntDouble = std::map<int, double>;

MOCK_METHOD(BoolAndInt, GetPair, ());
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

---

## 2. Supporting Overloads and Qualified Methods

`MOCK_METHOD` seamlessly supports:

- **Overloaded functions**: Declare mock methods for each overload.

- **Const methods**: Use `(const)` specifier.

- **Reference qualifiers (`&`, `&&`)**: Use `ref(&)` or `ref(&&)` in specs.

- **Overloading on constness**:
```cpp
MOCK_METHOD(int, Value, (), (override));
MOCK_METHOD(int, Value, (), (const, override));
```

- **Methods overloaded on argument number or type**:
```cpp
MOCK_METHOD(void, Foo, (), (override));
MOCK_METHOD(int, Foo, (int), (const, override));
```

### Disambiguating Overloaded Methods
Sometimes the compiler needs help to pick the right overload in `EXPECT_CALL` or `ON_CALL`. Use helper functions like `Const()` or explicit matcher casts to disambiguate (see [Selecting Between Overloaded Functions](#SelectOverload) in [Mocking Basics Guide](guides/getting_started/mocking_basics.md)).

---

## 3. Mocking Class Templates

You can mock methods inside class templates just like normal classes.

Example:

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual void Push(const T& elem) = 0;
  virtual int GetSize() const = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(void, Push, (const T& elem), (override));
  MOCK_METHOD(int, GetSize, (), (const, override));
};
```

---

## 4. Mocking Non-Virtual Methods

GoogleMock primarily mocks virtual methods. To mock non-virtual methods, which can't be overridden, you create an unrelated mock class with the same method signatures and use compile-time polymorphism (e.g., templates). No `override` specifier is needed.

Example:

```cpp
class ConcreteStream {
 public:
  void Append(const Packet* p);
  size_t Count() const;
};

class MockStream {
 public:
  MOCK_METHOD(void, Append, (const Packet* p));
  MOCK_METHOD(size_t, Count, (), (const));
};

// Templates using either ConcreteStream or MockStream
```

---

## 5. Legacy Macros and Migration

Older GoogleMock versions used macros like `MOCK_METHODn`:

- `MOCK_METHOD1(Method, Ret(Args))` for 1-arg methods.
- Variants like `MOCK_CONST_METHODn`, `MOCK_METHODn_T`, and `MOCK_METHODn_WITH_CALLTYPE` for const methods, templates, and calling conventions.

They have been superseded by the more flexible `MOCK_METHOD`. Migration is recommended for clarity and better qualifier handling.

Old macro example:
```cpp
MOCK_METHOD0(Nullary, int());
MOCK_CONST_METHOD1(GetSize, int() const);
```

Equivalent new macro:
```cpp
MOCK_METHOD(int, Nullary, ());
MOCK_METHOD(int, GetSize, (), (const));
```

---

## 6. Using Mocks in Tests: Defining Expectations

After defining a mock class and methods, you use `EXPECT_CALL` or `ON_CALL` to set expectations and behaviors.

Basic workflow:

1. Include `gmock/gmock.h` and import the `testing` namespace.
2. Instantiate your mock class.
3. Use `EXPECT_CALL(mock, Method(args))` to specify expected calls and behaviors.
4. Use your code under test, passing mock objects.
5. GoogleMock automatically verifies expectations at mock destruction.

Example:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
};

TEST(PainterTest, DrawsCircle) {
  MockTurtle mock;
  EXPECT_CALL(mock, PenDown()).Times(AtLeast(1));
  Painter p(&mock);
  EXPECT_TRUE(p.DrawCircle(0, 0, 10));
}
```

---

## 7. Best Practices and Tips for `MOCK_METHOD`

- Always wrap argument lists and qualifiers properly with parentheses.
- Use type aliases to manage complex types with commas.
- Declare mock methods `public` regardless of base class access level.
- When mocking overloaded methods, mock all variants needed or bring base methods into scope with `using`.
- Use the `override` qualifier on mocked methods to catch signature mismatches.
- For move-only argument types or return values (e.g., `std::unique_ptr`), use lambdas or `Return(std::move(...))` carefully to avoid move-after-move errors.
- Use `NiceMock` or `StrictMock` template wrappers to suppress or enforce strict behavior on uninteresting calls.

---

## 8. Troubleshooting

- **Compilation errors from unprotected commas**: wrap types in extra parentheses or introduce type aliases.
- **Overloads ambiguous in `EXPECT_CALL`**: disambiguate using `Const()`, `TypedEq<T>`, or explicit casts.
- **Mock method not called or unexpected call failures**: check that expectations are set before the method is invoked.
- **Virtual destructor requirement**: always ensure base classes of mocks have virtual destructors to avoid leaks.
- **Slow compilation**: move mock class constructors and destructors out of header files and into `.cc` files.

---

## 9. Code Example: Defining and Using a Mock Class

```cpp
#include <gmock/gmock.h>
#include <string>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetValue() const = 0;
  virtual void SetName(const std::string& name) = 0;
  virtual bool Process(int x, int y) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetName, (const std::string& name), (override));
  MOCK_METHOD(bool, Process, (int x, int y), (override));
};

// Usage
TEST(FooTest, Example) {
  MockFoo mock;

  EXPECT_CALL(mock, GetValue())
      .WillOnce(testing::Return(10));
  EXPECT_CALL(mock, SetName(testing::_));
  EXPECT_CALL(mock, Process(5, 10))
      .WillRepeatedly(testing::Return(true));

  // Exercising mock
  int val = mock.GetValue();  // Returns 10
  mock.SetName("Test");
  bool result = mock.Process(5, 10);  // Returns true
}
```

---

## 10. Summary

Using `MOCK_METHOD` is fundamental to defining flexible, readable, and powerful mocks in GoogleTest. It supports complex signatures, qualifiers, overloaded methods, and fits seamlessly into the comprehensive expectation framework. Combined with `EXPECT_CALL` and `ON_CALL`, it enables precise control over testing interactions.

---

For more details, see [Mocking Basics Guide](guides/getting_started/mocking_basics.md), [EXPECT_CALL Reference](reference/mocking.md#EXPECT_CALL), and best practice sections in [gmock_cook_book.md](docs/gmock_cook_book.md).

---

<Callout type="note">
Always prefer `MOCK_METHOD` over legacy `MOCK_METHODn` macros for cleaner, future-proof code.
</Callout>

---

## Source

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-function-mocker.h", "range": "1-350"}]} />

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/mocking.md", "range": "1-300"}]} />