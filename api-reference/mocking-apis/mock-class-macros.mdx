---
title: "Mock Class & Method Macros"
description: "How to declare mock classes and methods using GoogleMock macros like MOCK_METHOD. Covers mock declaration syntax, handling of overloaded methods, argument forwarding, and tips for robust, maintainable test doubles."
---

# Mock Class & Method Macros

## Overview

GoogleMock uses the `MOCK_METHOD` macro to declare mock methods inside mock classes. This macro automatically generates all necessary boilerplate and plumbing to intercept calls, verify expectations, and control mock behavior. It forms the backbone of defining mocks in gMock, enabling effortless and consistent mock implementations.

Mock methods declared with `MOCK_METHOD` must be placed in the `public:` section of your mock class, regardless of the base method's access specifier. This ensures that frameworks like `ON_CALL` and `EXPECT_CALL` can correctly reference and interact with the mocks.


## Declaring Mock Methods Using `MOCK_METHOD`

The signature of the `MOCK_METHOD` macro is:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Arguments...), (Qualifiers));
```

- **ReturnType**: The method's return type.
- **MethodName**: The method's name.
- **Arguments...**: The method's parameter list, enclosed in parentheses.
- **Qualifiers** _(optional)_: Comma-separated list of method qualifiers, enclosed in parentheses, such as `const`, `override`, `noexcept`, or calling conventions.

### Example

Given an interface:

```cpp
class Foo {
 public:
  virtual ~Foo() {};
  virtual int GetValue() const = 0;
  virtual void SetValue(int value) = 0;
};
```

The mock class would be:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int value), (override));
};
```

This declares two mock methods that override the virtual methods in `Foo`.


## Handling Commas in Types

Unprotected commas in return or argument types can cause parsing errors in the macro because it expects arguments to be delimited by commas. For example:

```cpp
MOCK_METHOD(std::pair<bool, int>, GetPair, ()); // Fails compilation
```

To handle such cases, you have two options:

- **Wrap the type in parentheses:**

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  ```

- **Use a `using` alias for the complex type:**

  ```cpp
  using BoolIntPair = std::pair<bool, int>;
  MOCK_METHOD(BoolIntPair, GetPair, ());
  ```

Both approaches make the macro correctly parse the parameters.


## Qualifiers for Mock Methods

The fourth parameter accepts method qualifiers:

| Qualifier                | Purpose                                                        |
|--------------------------|----------------------------------------------------------------|
| `const`                  | Mark the mocked method as `const`. Required when overriding a `const` method. |
| `override`               | Mark the method with `override`. Recommended for overriding virtual methods. |
| `noexcept`               | Indicate the method is `noexcept`. Required when overriding such a method. |
| `Calltype(...)`          | Specify calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` for Windows COM.|
| `ref(&)`, `ref(&&)`      | Mark the method with reference qualifiers, e.g., lvalue or rvalue ref. Required when overriding such methods. |

Example:

```cpp
MOCK_METHOD(bool, Foo, (int x), (const, override, noexcept));
```


## Mocking Overloaded Methods

`MOCK_METHOD` handles overloaded functions gracefully. You simply declare mocks for each overloaded variant, ensuring the signature and qualifiers match. For constant overloaded methods, specify `(const, override)`.

```cpp
class Foo {
 public:
  virtual int Add(int x);
  virtual int Add(int x, int y);
  virtual const Bar& GetBar() const;
  virtual Bar& GetBar();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int x, int y), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
};
```

If you don’t mock all overloads, base class versions without mocks may get hidden. You can unhide them with `using Foo::MethodName;` inside your mock class.


## Mocking Templates

Class templates can be mocked the same way as normal classes by using `MOCK_METHOD` inside a template mock class.

Example:

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int GetSize() const = 0;
  virtual void Push(const T& x) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```


## Mocking Non-Virtual Methods

By default, gMock mocks virtual methods. To mock non-virtual methods (used in compile-time polymorphism), create a mock class unrelated to the real class but having method signatures matching the real class, and use templates to inject the mock or real class.

```cpp
class ConcretePacketStream {
 public:
  void AppendPacket(Packet* new_packet);
  const Packet* GetPacket(size_t packet_number) const;
  size_t NumberOfPackets() const;
};

class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};

// Usage:
template <class PacketStream>
void CreateConnection(PacketStream* stream) { ... }

// Use CreateConnection<ConcretePacketStream> in production
// Use CreateConnection<MockPacketStream> in test
```


## Old-Style Mock Macros (`MOCK_METHODn`)

Prior to 2018, gMock used `MOCK_METHODn` macros where `n` specifies the argument count. Migration to `MOCK_METHOD` is recommended, but the old macros are supported. Their syntax differs from `MOCK_METHOD`.

| Old macro syntax                                     | New macro syntax                                                   |
|-----------------------------------------------------|------------------------------------------------------------------|
| `MOCK_METHOD1(Foo, bool(int));`                      | `MOCK_METHOD(bool, Foo, (int));`                                 |
| `MOCK_CONST_METHOD1(Foo, bool(int));`                | `MOCK_METHOD(bool, Foo, (int), (const));`                        |
| `MOCK_METHOD1_T(Foo, bool(int));`                    | `MOCK_METHOD(bool, Foo, (int));`                                 |
| `MOCK_CONST_METHOD1_T(Foo, bool(int));`              | `MOCK_METHOD(bool, Foo, (int), (const));`                        |
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int));` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)));` |
| `MOCK_CONST_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int));` | `MOCK_METHOD(bool, Foo, (int), (const, Calltype(STDMETHODCALLTYPE)));` |


## Common Pitfalls & Best Practices

### Always Put `MOCK_METHOD` in `public`

Even for private or protected base methods, mock declarations must be public to allow expectations and calls.

### Use Parentheses or Aliases for Types with Commas

Wrap complex return or argument types containing commas with parentheses or type aliases to avoid parsing errors.

### Specify Qualifiers Explicitly

Make sure to include `const`, `override`, and other qualifiers as needed to match the base method's signature.

### Handle Overloads Carefully

Mock all overloaded versions you intend to use. Use `using BaseClass::MethodName;` to unhide unmocked overloads.

### Move Large Mock Class Implementations Out of Headers

To speed up compilation, define constructors/destructors of mock classes in source files.


## Illustrative Examples

### Simple Mock Class

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual bool Transform(Gadget* g) = 0;
  virtual void Resume();
  virtual int GetTimeOut();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Transform, (Gadget* g), (override));
  MOCK_METHOD(void, Resume, (), (override));     // protected method mocked nevertheless
  MOCK_METHOD(int, GetTimeOut, (), (override));  // private method mocked nevertheless
};
```

### Overloaded Methods

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int Add(Element x);
  virtual int Add(int times, Element x);
  virtual Bar& GetBar();
  virtual const Bar& GetBar() const;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```


## Troubleshooting Unexpected Compilation Errors

- **Parsing errors with types using commas**: Use parentheses or type aliases.
- **Compiler complaints about method qualifiers**: Confirm qualifier correctness and consider removing top-level const on parameters for MSVC.
- **Mock method not found or ambiguous**: Make sure argument lists are correct and explicit.


## Behind the Scenes: How `MOCK_METHOD` Works

The `MOCK_METHOD` macro expands into:

- A method definition that intercepts calls and forwards arguments to an internal function mocker.
- A registration mechanism for setting expectations and default behaviors.
- Methods for setting matchers and actions.

This powerful macro hides complex template and meta-programming to ensure type safety and expressive mocking in a concise syntax.


## Summary

The `MOCK_METHOD` macro is the central facility of GoogleMock to declare mock methods inside mock classes. By correctly specifying the return type, method name, argument list, and optional qualifiers, you define mock methods overriding your interfaces. It handles special cases like overloaded methods, complex types, and calling conventions.

Use the tools and best practices outlined here to write robust, maintainable mock classes that enable expressive and precise unit tests.


---

# Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — recipes on mocks, matchers, and actions
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — detailed API descriptions
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — beginner-oriented tutorial
- [Mock Strictness Levels](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy) — Nice, Naggy, Strict mocks explained


# See Also

Explore related documentation on:

- Setting Expectations and Actions (`EXPECT_CALL`, `ON_CALL`)
- Matchers for argument validation
- Advanced mocking techniques and custom matchers


---

**This page focuses exclusively on how to declare mock classes and methods using the `MOCK_METHOD` macros, illustrating syntax, handling of overloads, and best practices for declaring mocks that lead to robust, maintainable tests.**