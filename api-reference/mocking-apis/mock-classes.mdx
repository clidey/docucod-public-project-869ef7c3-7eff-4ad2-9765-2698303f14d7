---
title: "Mock Class and Method Declaration"
description: "Step-by-step documentation for declaring mock methods and classes using GoogleMock macros and templates. Covers syntax, supported method signatures, and customization for advanced mocking scenarios."
---

# Mock Class and Method Declaration

This page guides you through declaring mock classes and methods using GoogleMock macros and templates. It provides a clear step-by-step explanation of the `MOCK_METHOD` macro syntax, how to handle complex method signatures, and customization options for specific mocking scenarios. By following these instructions, you can define highly effective mock classes that enable comprehensive and maintainable tests.

---

## Overview of Mock Classes

GoogleMock makes creating mock classes straightforward by letting you define mocked methods simply using the `MOCK_METHOD` macro inside a class. These mock classes can substitute your interfaces or base classes during testing, allowing you to precisely specify expected behavior, method calls, and return values.

### Basic Syntax for Mock Methods

```cpp
class MyMockClass {
 public:
  MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Qualifiers));
};
```

- **ReturnType**: The return type of the method.
- **MethodName**: The name of the method being mocked.
- **(ArgTypes...)**: Parenthesized list of argument types.
- **(Qualifiers)**: Optional parenthesized list of method qualifiers such as `const`, `override`, `noexcept`, `Calltype(...)`, or reference qualifiers like `ref(&)`.

### Example: Simple Mock Class

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

This mock class overrides virtual methods from the base `Turtle` interface.

---

## Key Guidelines for Declaring Mock Methods

### 1. Always Declare Mock Methods in the `public` Section

Regardless of the original access level (public, protected, private), your `MOCK_METHOD` declarations must always be public. This allows expectations and calls like `ON_CALL` and `EXPECT_CALL` to access them.

```cpp
class Base {
 protected:
  virtual void Resume();
 private:
  virtual int GetTimeOut();
};

class MockBase : public Base {
 public:
  MOCK_METHOD(void, Resume, (), (override));   // Must be public
  MOCK_METHOD(int, GetTimeOut, (), (override)); // Must be public
};
```

### 2. Handling Commas in Template Types

Unprotected commas in return or argument types will break the parsing by `MOCK_METHOD`.

#### Problematic declarations:

```cpp
MOCK_METHOD(std::pair<bool, int>, GetPair, ());             // Won't compile
MOCK_METHOD(bool, CheckMap, (std::map<int, double>, bool)); // Won't compile
```

#### Solutions:

- **Wrap the type with extra parentheses:**

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

- **Use type aliases to simplify:**

  ```cpp
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
  ```

### 3. Mocking Overloaded Methods

GoogleMock allows mocking of overloaded functions without special syntax. Mock **all** overloaded methods you want to use to avoid hiding base class methods unintentionally.

```cpp
class Foo {
 public:
  virtual int Add(int x);
  virtual int Add(int times, int x);
  virtual int GetBar();
  virtual int GetBar() const;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(int, GetBar, (), (override));
  MOCK_METHOD(int, GetBar, (), (const, override));
};
```

To prevent hiding other overloads:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Bring other overloads into scope
  MOCK_METHOD(int, Add, (int x), (override));
};
```

### 4. Mocking Const and Noexcept Methods

Add `const` and `noexcept` qualifiers inside the qualifier list.

```cpp
MOCK_METHOD(int, GetValue, (), (const, override));
MOCK_METHOD(void, Save, (), (noexcept, override));
```

### 5. Specifying Calling Conventions

For platform-specific calling conventions (e.g., Windows `STDMETHODCALLTYPE`), use the `Calltype()` qualifier.

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

### 6. Reference Qualifiers

Mock methods with ref-qualifiers by using the `ref(&)` or `ref(&&)` qualifiers.

```cpp
MOCK_METHOD(void, Foo, (), (ref(&), override));
MOCK_METHOD(void, Foo, (), (ref(&&), override));
```

### 7. Mocking Class Templates

You can mock templated classes normally by templating the mock class and using `MOCK_METHOD` inside.

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const T& x) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### 8. Mocking Non-Virtual Methods (Hi-perf Dependency Injection)

You may mock non-virtual methods by creating an unrelated mock class with matching method signatures (without `override`). Use templates or conditionally select mock or real classes in tests vs production.

```cpp
class Concrete {
 public:
  void DoWork(int x);
};

class MockConcrete {
 public:
  MOCK_METHOD(void, DoWork, (int x));
};

template <typename Impl>
void UseImpl(Impl* obj) {
  obj->DoWork(42);
}
```

---

## Example: Full Mock Class for a Simple Interface

```cpp
#include <gmock/gmock.h>

class IFoo {
 public:
  virtual ~IFoo() = default;
  virtual int Compute(int value) const = 0;
  virtual void Reset() = 0;
};

class MockFoo : public IFoo {
 public:
  MOCK_METHOD(int, Compute, (int value), (const, override));
  MOCK_METHOD(void, Reset, (), (override));
};
```

---

## Best Practices and Tips

- Use `override` to catch signature mismatches when mocking virtual methods.
- Keep mock methods in the `public` section always.
- Prefer `using Base::method;` when mocking overloads partially.
- Use type aliases or parentheses to guard against comma issues in template types.
- For mocking with special calling conventions or qualifiers, use the appropriate macros with `Calltype`, `const`, `noexcept`, or `ref` qualifiers.
- For large mock classes, move constructors and destructors out of the header to speed up compilation.
- Consider wrapping your mock usage with `NiceMock` or `StrictMock` for controlling warnings on uninteresting calls.

---

## Common Pitfalls

- Forgetting to place mock methods in the `public` section causes linker errors or inaccessible methods.
- Omitting `override` can mask signature mismatches.
- Ignoring comma issues with complex types breaks compilation.
- Overlooking all overloads of a method results in hidden base class functions leading to unexpected behaviors.
- Misunderstanding const-ness in mocked methods causes compiler warnings or unexpected mock behavior.

---

## Summary

This page equips you to declare mock classes and methods effectively using GoogleMock's macros. Mastering the `MOCK_METHOD` macro with qualifiers and handling edge cases like overloaded methods, template types, and calling conventions enables robust and maintainable mock definitions. Integrate these best practices into your workflow to take full advantage of GoogleMock's powerful mocking capabilities.

---

## Additional Resources

- [gMock Cookbook: Creating Mock Classes](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#creating-mock-classes)
- [Mocking Reference](../reference/mocking.md#MOCK_METHOD)
- [gMock Cheat Sheet](https://github.com/google/googletest/blob/main/docs/gmock_cheat_sheet.md#defining-a-mock-class)
- [GoogleMock API: Defining Expectations](../api-reference/mocking-apis/expectations-sequences.mdx)
- [Writing Your First Test](../guides/getting-started/writing-your-first-test.mdx)

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock.h", "range": "1-150"},{"path": "docs/gmock_cook_book.md", "range": "20-300"}]} />