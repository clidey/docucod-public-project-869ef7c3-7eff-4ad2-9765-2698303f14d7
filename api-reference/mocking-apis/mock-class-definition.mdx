---
title: "Mock Class Definition & Method Mocking"
description: "Outlines the macros and utility templates for declaring mock classes and mocking methods, handling various C++ method signatures, qualifiers, and customizations. Includes code patterns for integrating mocks into test suites."
---

# Mock Class Definition & Method Mocking

GoogleMock provides robust macros and utility templates that allow you to define mock classes and mock methods seamlessly, supporting various C++ method signatures, qualifiers, and customizer options. This page details how you can declare mock methods, handle method overloading, and integrate mocks effectively into your test suites.

---

## Defining Mock Methods with `MOCK_METHOD`

The core macro for mocking methods in GoogleMock is `MOCK_METHOD`. It enables you to declare mock versions of your class's virtual or non-virtual methods conveniently. The macro's parameters closely mirror the method's signature, ensuring clarity and correctness when defining mocks.

### Syntax

```cpp
MOCK_METHOD(return_type, method_name, (argument_types...), (specifiers...));
```

- `return_type`: The return type of the method.
- `method_name`: The name of the method being mocked.
- `(argument_types...)`: The method's parameter list enclosed in parentheses.
- `(specifiers...)`: Optional qualifiers such as `const`, `override`, `noexcept`, `Calltype(...)`, and `ref(...)`.

### Common Specifiers

| Specifier           | Description                             |
|---------------------|---------------------------------------|
| `const`             | Marks the mock method as const. Required if overriding a const method. |
| `override`          | Marks the method with `override`. Recommended for overriding virtual methods. |
| `noexcept`          | Marks the mock method with `noexcept`. Required for overriding `noexcept` methods. |
| `Calltype(...)`     | Specifies calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` on Windows. |
| `ref(&)` or `ref(&&)` | Specifies reference qualifiers on methods. Required for overriding methods with such qualifiers. |

### Important Usage Notes

- Always place `MOCK_METHOD` declarations inside the `public` section of your mock class, regardless of the access level of the original method.
- When your `return_type` or argument types contain commas (e.g., `std::pair<bool, int>` or `std::map<int, double>`), either surround them with parentheses or use type aliases to prevent parsing issues.

### Example: Mocking Simple and Overloaded Methods

```cpp
class Foo {
public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual std::string Describe(int type) = 0;
};

class MockFoo : public Foo {
public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
};
```

### Example: Mocking Methods with Calling Conventions

If your mocked method uses a non-default calling convention (e.g., on Windows), specify it using `Calltype`:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE)));
MOCK_METHOD(int, Bar, (double x, double y), (const, Calltype(STDMETHODCALLTYPE)));
```

## Handling Overloaded Methods

GoogleMock supports mocking overloaded methods seamlessly. To avoid hiding other overloads:

- Mock all versions you need explicitly.
- Use `using BaseClass::MethodName;` to bring untouched overloads into scope and prevent compiler warnings.

Example:

```cpp
class MockPrinter : public Printer {
public:
  MOCK_METHOD(void, Print, (int n), (override));
  MOCK_METHOD(void, Print, (char c), (override));

  using Printer::Print;  // Bring other overloads into scope.
};
```

## Mocking Methods in Class Templates

You can mock template classes similarly to normal classes:

```cpp
template <typename T>
class StackInterface {
public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const T& x) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

## Mocking Non-Virtual Methods

GoogleMock supports mocking non-virtual methods using templates and a mock class unrelated to the real class. Use the same `MOCK_METHOD` macro without the `override` specifier.

Example:

```cpp
class ConcretePacketStream {
public:
  void AppendPacket(Packet* new_packet);
  const Packet* GetPacket(size_t packet_number) const;
  size_t NumberOfPackets() const;
};

class MockPacketStream {
public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

## Integration Tips for Mock Classes

- Place mock class definitions in dedicated headers (e.g., `_mock.h`) within your testing directories to minimize coupling with implementation code.
- Prefer to mock interfaces you own; if mocking external interfaces, encapsulate them or define the mock in the ownerâ€™s test package.
- Use inheritance and composition patterns (e.g., delegating to fakes) to reuse code and behaviors in mocks.

## Common Patterns & Best Practices

- **Suppressing Warnings on Uninteresting Calls:** Use `NiceMock<MockClass>` to ignore calls to methods without expectations, reducing test noise.
- **Enforcing Strict Behavior:** Use `StrictMock<MockClass>` to treat calls to unexpected methods as errors.
- **Setting Default Behaviors:** Use `ON_CALL` to specify default actions separate from expectations.

## Dealing with Destructors

You cannot directly mock destructors with `MOCK_METHOD`. Instead, add a separate `Die()` mock method and call it inside your destructor.

```cpp
class MockFoo : public Foo {
public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```

Use expectations on `Die()` to verify object destruction order or timing.

## Summary

Using `MOCK_METHOD` empowers you to mock nearly all forms of C++ methods, including overloaded, template, const, noexcept, and custom calling conventions. Proper placement, use of specifiers, and integration patterns help maintain clean and effective test suites.

---

<Info>
For detailed usage of setting expectations and behaviors, consult the [Setting Expectations & Behaviors](../api-reference/mocking-apis/expectations-behaviors.md) page.
</Info>

<Info>
Explore the [gMock Cookbook](../docs/gmock_cook_book.md) for recipes and best practice patterns when defining mocks.
</Info>