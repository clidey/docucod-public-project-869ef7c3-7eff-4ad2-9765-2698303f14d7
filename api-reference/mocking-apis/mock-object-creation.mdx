---
title: "Mock Object Creation & Configuration"
description: "Guidance on creating mock classes and functions using GoogleMockâ€™s macros and utilities. Details the MOCK_METHOD macro, strictness wrappers (NiceMock, StrictMock), and how to set up mocks for various use cases."
---

# Mock Object Creation & Configuration

This section provides comprehensive guidance on creating and configuring mock classes and functions in GoogleMock. It explains how to use the `MOCK_METHOD` macro for defining mocked methods, details the use of strictness wrappers like `NiceMock` and `StrictMock` to control the behavior of uninteresting calls, and shares best practices for setting up mocks for various use cases.

---

## Defining Mock Classes Using `MOCK_METHOD`

Mock classes mimic the behavior of real classes for testing purposes with the flexibility of specifying expected interactions and return values.

### Syntax of `MOCK_METHOD`

To create a mock method in a class, use the `MOCK_METHOD` macro inside the `public` section of your mock class:

```cpp
class MyMockClass {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
};
```

- **ReturnType**: The return type of the method.
- **MethodName**: The name of the function.
- **Args...**: The argument list enclosed in parentheses.
- **Specs...** (optional): A list of qualifiers such as `const`, `override`, `noexcept`, calling convention specifiers, or reference qualifiers.

### Qualifiers in `MOCK_METHOD`

| Qualifier                     | Purpose                                                           |
|-------------------------------|------------------------------------------------------------------|
| `const`                       | Marks the mocked method as `const`. Required for overriding `const` methods.
| `override`                    | Indicates method overrides a virtual method. Recommended.
| `noexcept`                    | Marks method as `noexcept`.
| `Calltype(...)`               | Specifies calling conventions (e.g., `Calltype(STDMETHODCALLTYPE)`) useful on Windows.
| `ref(&)` or `ref(&&)`         | Reference qualifiers on the method.

### Handling Types with Commas

Comma characters inside argument or return types can break `MOCK_METHOD` parsing.

#### Workaround 1: Extra Parentheses

Wrap the return or argument type containing commas in an extra pair of parentheses:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetResult, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

#### Workaround 2: Use Type Aliases

```cpp
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetResult, ());
using IntDoubleMap = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (IntDoubleMap, bool));
```

### Access Level of Mock Methods

All mock methods must be declared in the `public` section of your mock class, even if the original method in the base class is `private` or `protected`. This is essential to allow gMock to intercept and set expectations on these methods.

### Mocking Overloaded Methods

Overloaded methods are mocked by defining each overload separately using `MOCK_METHOD`, specifying appropriate qualifiers as needed.

```cpp
MOCK_METHOD(int, Add, (Element x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));
MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

If only some versions of overloaded methods are mocked, use `using` to bring non-mocked base versions into scope to prevent hidden overload warnings.

### Mocking Class Templates

Template classes are mocked similarly:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### Mocking Non-Virtual Methods

gMock can mock non-virtual methods by creating mock classes unrelated to the real class but with matching method signatures. Use template-based dependency injection to select between real and mock implementations at compile time.

### Avoid Mocking Free Functions Directly

It's not possible to mock free (non-member) functions directly in gMock. Instead, encapsulate such functions in an interface and mock the interface methods.

### Old-Style `MOCK_METHODn` Macros

Legacy macros like `MOCK_METHOD0`, `MOCK_CONST_METHOD0`, etc., are still supported but non-recommended. Prefer the generic `MOCK_METHOD` macro for new code.

---

## Controlling Mock Behavior with Strictness Wrappers

GoogleMock treats calls that do not match any expectation as either warnings or errors by default. You can control this behavior on a per-mock-object basis using the following wrappers:

### 1. `NiceMock`

Suppresses warnings on *uninteresting calls* (calls to mock methods with no explicit expectations).

Example:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoThis());
// Unset methods called on mock_foo will not produce warnings.
```

### 2. `StrictMock`

Treats all uninteresting calls as test failures. Use it when you want your tests to catch unexpected mock method invocations aggressively.

```cpp
using ::testing::StrictMock;
StrictMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoThis());
// Any call to other unset mock methods causes test failure.
```

### 3. `NaggyMock` (Default Behavior)

Issues warnings on uninteresting calls but does not fail the tests. This is the default mock behavior.

### Key Notes about Strictness Wrappers

- They only affect methods defined **directly** using the `MOCK_METHOD` macros in the mock class. Methods inherited from base classes are unaffected.
- Nesting wrappers (e.g., `NiceMock<StrictMock<MockFoo>>`) is unsupported.
- The mocked class is best to have a virtual destructor to avoid issues with these wrappers.
- Excessive use of strict or naggy mocks can lead to brittle tests. Use nice mocks as the default, strict mocks sparingly, mainly for pinpointing unexpected calls.

---

## Practical Tips for Creating Mocks

### Step-by-step Example to Define a Mock Class

Given an interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() = default;
  virtual void PenUp() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

Write the mock like this:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

The mock methods generate all code needed to intercept calls and allow expectations.

### Best Practices

- Always put `MOCK_METHOD`s in `public:` even if mocking protected or private methods.
- Use `override` in qualifiers to catch interface mismatches early.
- For methods with complex argument types containing commas, use type aliases or extra parentheses.
- Use `NiceMock` by default to suppress uninteresting call warnings.
- Reserve `StrictMock` for tests that require strict enforcement.
- Make use of `ON_CALL` to define default behaviors, and `EXPECT_CALL` to define expected invocations with verification.

### Example of Using Strictness Wrappers

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockTurtle> nice_turtle;
StrictMock<MockTurtle> strict_turtle;

EXPECT_CALL(nice_turtle, PenUp());
EXPECT_CALL(strict_turtle, PenUp());
```

Uninteresting calls on `nice_turtle` produce no warnings, on `strict_turtle` cause test failures.

---

## Common Pitfalls

- **Forgetting `override`**: Not marking mocked methods with `override` risks silent interface breakage.
- **Wrong access level**: Placing `MOCK_METHOD` in `private` or `protected` causes expectations and calls to fail.
- **Unprotected commas**: Failing to wrap complex types with commas in parentheses or use type aliases causes compilation errors.
- **Not using `NiceMock` for uninteresting calls**: Can clutter test output with warnings.
- **Nesting strictness wrappers**: Unsupported and causes ambiguous behavior.

---

## Summary

GoogleMock simplifies mock creation with `MOCK_METHOD`, enabling flexible testing of virtual and even non-virtual methods. Strictness wrappers `NiceMock`, `StrictMock`, and `NaggyMock` allow you to tune how unexpected mock method calls are treated, improving test clarity and reliability. Mastery of these tools is fundamental to writing clear, robust unit tests.

---

# Detailed Code Example

```cpp
#include <gmock/gmock.h>

// Original Interface
class Printer {
 public:
  virtual ~Printer() {}
  virtual void Print(int n) = 0;
  virtual void Print(char c) = 0;
};

// Mock Class
class MockPrinter : public Printer {
 public:
  MOCK_METHOD(void, Print, (int n), (override));
  MOCK_METHOD(void, Print, (char c), (override));
};

// Usage in test
void ExampleTest() {
  using ::testing::ExpectCall;
  using ::testing::NiceMock;

  NiceMock<MockPrinter> mock_printer;
  EXPECT_CALL(mock_printer, Print(7));

  mock_printer.Print(7); // Matches expectation, no warnings.
  mock_printer.Print('a'); // Uninteresting call, no warnings because NiceMock.
}
```

---

# Summary
- Use `MOCK_METHOD` in mock classes to generate mocked methods with proper signatures and qualifiers.
- Always declare mock methods in `public:` regardless of original method access level.
- Handle types with commas carefully using parentheses or type aliases.
- Leverage `NiceMock` to suppress warnings for uninteresting calls in most tests.
- Use `StrictMock` to catch unexpected calls aggressively.
- Avoid nested strictness wrappers and ensure virtual destructors for mock classes.

---

For further details on setting expectations, actions, and other mocking patterns, consult the [Expectations & Cardinalities](reference/mocking-apis/expectations-cardinalities), [Actions & Return Values](reference/mocking-apis/actions-and-return-values), and [Matchers](reference/mocking-apis/matchers) reference pages.

---

<Info>
This page fits within the broader Mocking APIs section and builds upon introductory guidance found in the 'gMock for Dummies' and extended usage covered in the 'gMock Cookbook'. For comprehensive understanding, users should explore code examples and pragmatic tips in those related guides.
</Info>
