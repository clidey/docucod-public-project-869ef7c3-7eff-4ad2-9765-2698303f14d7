---
title: "Actions"
description: "Reference available mock actions—such as returning values, invoking arguments, or delegating calls—to control mock behavior. Includes support for variadic arguments and custom actions, empowering sophisticated stubbing strategies."
---

# Actions Reference

Actions define the behavior of mock methods when they are called, enabling you to simulate return values, side effects, or arbitrary callable invocations. This guide provides a comprehensive reference to the built-in actions provided by GoogleTest's mocking framework (GoogleMock), empowering you to control sophisticated mock behavior with ease.

---

## Returning a Value

| Action                      | Description                                                                                                   |
|-----------------------------|---------------------------------------------------------------------------------------------------------------|
| `Return()`                  | Return from a `void` mock function.                                                                           |
| `Return(value)`             | Return the specified `value`. Note that the value is converted to the mock function’s return type **at the time the expectation is set**, not during execution. |
| `ReturnArg<N>()`            | Return the *N*-th (zero-based) argument passed to the mock function.                                           |
| `ReturnNew<T>(a1, ..., ak)` | Return a newly allocated object `new T(a1, ..., ak)`; a fresh object is created on each invocation.             |
| `ReturnNull()`              | Return a null pointer (e.g., `nullptr`).                                                                      |
| `ReturnPointee(ptr)`        | Return the value pointed to by `ptr` at the time the mock method is invoked.                                   |
| `ReturnRef(variable)`       | Return a reference to `variable`. Useful for returning references from mock methods.                          |
| `ReturnRefOfCopy(value)`    | Return a reference to an internal copy of `value`, which lives as long as the action instance.                 |
| `ReturnRoundRobin({a1, ...})` | Cycle through the list of values `a1` to `ak` on successive calls, restarting from the beginning after the last.  |

### Practical Tip

If you want to return a live, changing value rather than a single snapshot, prefer `ReturnPointee` over `Return` or `Return(std::ref(value))`. The latter evaluate and fix the return value at expectation creation time, leading to stale results.


## Side Effects

GoogleMock supports a range of actions for producing side effects, typically on output parameters or pointers.

| Action                     | Description                                                                                  |
|----------------------------|----------------------------------------------------------------------------------------------|
| `Assign(&variable, value)` | Assign `value` to `variable`.                                                              |
| `DeleteArg<N>()`           | Delete the pointer passed as the *N*-th argument to the mock function.                      |
| `SaveArg<N>(pointer)`      | Copy-assign the *N*-th argument of the mock method to `*pointer`.                           |
| `SaveArgByMove<N>(pointer)`| Move-assign the *N*-th argument to `*pointer`.                                             |
| `SaveArgPointee<N>(pointer)` | Copy the value pointed to by the *N*-th argument to `*pointer`.                           |
| `SetArgReferee<N>(value)` | Assign `value` to the reference passed as the *N*-th argument.                             |
| `SetArgPointee<N>(value)`  | Assign `value` to the object pointed to by the *N*-th argument.                            |
| `SetArrayArgument<N>(first, last)` | Copy the range `[first, last)` to the array or iterator passed as the *N*-th argument.|
| `SetErrnoAndReturn(error, value)` | Set the global `errno` to `error` and return `value`.                                   |
| `Throw(exception)`         | Throw the given exception (must be copyable). Available since GoogleMock v1.1.0.            |

### Best Practice

Chain actions that both set output arguments and return values using `DoAll()` to ensure return values correspond to the mocked function signature.


## Using a Function, Functor, or Lambda as an Action

GoogleMock supports calling arbitrary callables as mock method actions.

| Action                                    | Description                                                                         |
|-------------------------------------------|-------------------------------------------------------------------------------------|
| `f`                                       | Call the callable `f` with the arguments received by the mock method.               |
| `Invoke(f)`                               | Invoke a global/static function or functor `f` with all mock function arguments.    |
| `Invoke(object_pointer, &Class::method)` | Invoke a method on an object with all mock function arguments.                      |
| `InvokeWithoutArgs(f)`                     | Invoke a callable `f` that accepts no arguments.                                    |
| `InvokeWithoutArgs(object_pointer, &Class::method)` | Invoke a zero-argument method on an object.                                   |
| `InvokeArgument<N>(arg1, ..., argk)`      | Invoke the *N*-th argument of the mock function, which must be a callable, with the specified arguments. |

#### Notes

- In `InvokeArgument<N>(...)`, if an argument is passed by reference, wrap it in `std::ref()`.
- Callables passed to `Invoke()` or `InvokeWithoutArgs()` must be permanent objects; GoogleMock takes ownership.


## Default Action

| Action          | Description                                               |
|-----------------|-----------------------------------------------------------|
| `DoDefault()`   | Perform the default action of the mock function as given by `ON_CALL()` or the built-in default. Cannot be nested in composite actions. |


## Composite Actions

Certain actions allow performing multiple sub-actions sequentially or manipulating how arguments are passed to inner actions.

| Action                          | Description                                                                                                              |
|---------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)`        | Perform all actions `a1` to `an` in order. Only the last action's return value is used. The first `n-1` actions must return void. |
| `IgnoreResult(a)`               | Perform action `a` but ignore its return value (useful when combining actions in `DoAll()`).                             |
| `WithArg<N>(a)`                 | Pass only the *N*-th argument of the mock function to action `a`.                                                       |
| `WithArgs<N1, N2, ..., Nk>(a)` | Pass selected arguments to action `a` in the specified order.                                                          |
| `WithoutArgs(a)`                | Perform action `a` without any arguments.                                                                               |

---

## Defining Actions

GoogleMock lets you define custom actions using macros as well as by implementing interfaces or providing callable objects.

### Legacy Macros

- `ACTION(name) { return expr; }`: Define a custom action named `name`.
- `ACTION_P(name, param) { statements; }`: Define a parameterized action.

Example:

```cpp
ACTION(IncrementArg1) { return ++(*arg1); }
EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementArg1());
```

### Template-based Actions

- `ACTION_TEMPLATE()` enables greater flexibility allowing explicit template parameters.

### New-style Actions (Recommended)

Define a struct/class with a call operator compatible with the mock function signature, or use lambdas:

```cpp
struct MultiplyBy {
  template <typename T>
  T operator()(T arg) { return arg * multiplier; }
  int multiplier;
};
EXPECT_CALL(mock, Foo(_)).WillOnce(MultiplyBy{7});
```

### Tips

- Use `Invoke()` with lambdas or functors for complex behaviors.
- Actions with `&&`-qualified call operators can only be used with `WillOnce()`.


## Selecting and Ignoring Arguments in Actions

To adapt an action accepting fewer arguments, use:

- `WithArgs<N1, ..., Nk>(action)` to select and reorder arguments.
- `WithArg<N>(action)` for a single argument.
- `WithoutArgs(action)` to call an action with no arguments.

Alternatively, if defining an action function, use the `Unused` annotation for unneeded parameters.


## Sharing Actions

Actions are lightweight and copyable by reference to shared implementations. You can store an action in a variable and reuse it across multiple expectations.

**Caution:** Actions that maintain internal state (e.g., counters) should not be unintentionally shared as it alters behavior.


## Testing Asynchronous Behavior

Use actions combined with synchronization primitives (e.g., `absl::Notification`) to signal from mock methods when asynchronous events occur, enabling deterministic and robust tests.


## Mocking Side Effects

Use built-in actions such as `SetArgPointee<N>(value)` or `SetArrayArgument<N>(first, last)` to mock output parameter assignments. Chain these with other actions using `DoAll()` when a return value is needed.


## Changing Default Behavior Based on State or Call Count

Use sequences (`InSequence`) to express expected call orders and conditionally change return values, or maintain external state variables to drive mock behavior dynamically through lambdas.


## Setting the Default Value for a Return Type

`::testing::DefaultValue<T>` lets you specify the default value a mock method returns when no explicit action is set, helpful for complex or user-defined types.


## Setting Default Actions Per Method

`ON_CALL(mock, Method(args...)).WillByDefault(action)` sets default behaviors for calls that do not have explicit `EXPECT_CALL` expectations.


## Using Callables or Lambdas as Actions

Pass any compatible callable or lambda to `WillOnce()`, `WillRepeatedly()`, or in `EXPECT_CALL` to customize behaviors concisely.


## Invoking Mock Function Arguments

Use `InvokeArgument<N>(args...)` to call a callable argument passed into the mock method with specified arguments, e.g., invoking a callback.


## Ignoring Action Return Values

`IgnoreResult(action)` lets you discard the return value of an action, which is helpful when the mock method returns `void` or when combining multiple actions where some do not return `void`.


## Handling Variadic Arguments

GoogleMock does not support mocking variadic functions directly. Instead, provide overloads or wrap variadic calls in specific interfaces.


## Common Pitfalls and Tips

- Always use `MOCK_METHOD` in the `public` section, regardless of method visibility in the base class.
- Use parentheses or type aliases to handle commas in argument or return types.
- Use `ReturnRef()` when returning references from mock methods.
- When specifying multiple actions, be mindful of the inferred cardinality (`Times`).
- Use `RetiresOnSaturation()` to make expectations retire automatically once fully matched, making ordered sequences easier to manage.
- To reduce compiler load, consider moving mock class constructors/destructors out of headers.


---

## Example Usages

### Returning Different Values Over Multiple Calls

```cpp
using ::testing::Return;
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));

int val1 = mock.GetValue();  // 10
int val2 = mock.GetValue();  // 20
int val3 = mock.GetValue();  // 30
```

### Mocking A Method to Set an Output Argument

```cpp
using ::testing::SetArgPointee;
using ::testing::Return;

EXPECT_CALL(mock, GetData(_))
    .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));

int data;
bool result = mock.GetData(&data);
EXPECT_TRUE(result);
EXPECT_EQ(data, 42);
```

### Invoking a Callback Argument

```cpp
using ::testing::InvokeArgument;
EXPECT_CALL(mock, DoWork(_, _))
    .WillOnce(InvokeArgument<1>(5));  // Calls the 1st argument as a callback with 5
```

### Defining a Custom Action with a Lambda

```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce([](int x) { return x * 10; });
```

### Sharing an Action Across Expectations

```cpp
auto log_action = Invoke([](const std::string& msg) {
  std::cout << "Log: " << msg << std::endl;
});
EXPECT_CALL(mock, Log(_)).WillRepeatedly(log_action);
EXPECT_CALL(mock, Log("Error")).WillOnce(log_action);
```


---

For a complete list of available actions and detailed behavior, see the [GoogleMock Actions Reference](reference/actions.md).

------------

<AccordionGroup title="Additional References">
<Accordion title="Mocking Reference - ON_CALL and EXPECT_CALL Macros">
Dive deep into the syntax and correct usage of `ON_CALL` and `EXPECT_CALL` macros for setting behaviors and expectations.
</Accordion>
<Accordion title="gMock Cookbook - Using Actions">
Practical recipes and tips for advanced action scenarios including delegating calls, asynchronous testing, and combining actions.
</Accordion>
<Accordion title="gMock Cheat Sheet - Setting Default Actions and Expectations">
Quick guide for setting default mock behavior and expectations including examples.
</Accordion>
</AccordionGroup>

<Note>
Always define `MOCK_METHOD` macros in public sections, handle commas in types properly, and carefully consider expectation cardinalities and action combinations to avoid common pitfalls.
</Note>
