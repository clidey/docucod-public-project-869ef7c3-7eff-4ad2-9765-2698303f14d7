---
title: "Actions Reference"
description: "Comprehensive guide to built-in and custom actions in GoogleMock. Actions define what happens when a mock method is invoked; this page details the standard actions and templates for advanced customization."
---

# Actions Reference

[**Actions**](../gmock_for_dummies.md#actions-what-should-it-do) specify what a mock function should do when invoked. This page lists the built-in actions provided by GoogleTest. All actions are defined in the `::testing` namespace.

---

## Returning a Value

| Action                            | Description                                   |
| :-------------------------------- | :-------------------------------------------- |
| `Return()`                        | Return from a `void` mock function.           |
| `Return(value)`                   | Return `value`. If the type of `value` is     different to the mock function's return type, `value` is converted to the latter type *at the time the expectation is set*, not when the action is executed. |
| `ReturnArg<N>()`                  | Return the `N`-th (0-based) argument.         |
| `ReturnNew<T>(a1, ..., ak)`       | Return `new T(a1, ..., ak)`; a different      object is created each time. |
| `ReturnNull()`                    | Return a null pointer.                        |
| `ReturnPointee(ptr)`              | Return the value pointed to by `ptr`.         |
| `ReturnRef(variable)`             | Return a reference to `variable`.             |
| `ReturnRefOfCopy(value)`          | Return a reference to a copy of `value`; the  copy lives as long as the action. |
| `ReturnRoundRobin({a1, ..., ak})` | Each call will return the next `ai` in the list, starting at the beginning when the end of the list is reached. |

---

## Side Effects

| Action                             | Description                             |
| :--------------------------------- | :-------------------------------------- |
| `Assign(&variable, value)` | Assign `value` to variable. |
| `DeleteArg<N>()` | Delete the `N`-th (0-based) argument, which must be a pointer. |
| `SaveArg<N>(pointer)` | Save the `N`-th (0-based) argument to `*pointer` by copy-assignment. |
| `SaveArgByMove<N>(pointer)` | Save the `N`-th (0-based) argument to `*pointer` by move-assignment. |
| `SaveArgPointee<N>(pointer)` | Save the value pointed to by the `N`-th (0-based) argument to `*pointer`. |
| `SetArgReferee<N>(value)` | Assign `value` to the variable referenced by the `N`-th (0-based) argument. |
| `SetArgPointee<N>(value)` | Assign `value` to the variable pointed by the `N`-th (0-based) argument. |
| `SetArgumentPointee<N>(value)` | Same as `SetArgPointee<N>(value)`. Deprecated. Will be removed in v1.7.0. |
| `SetArrayArgument<N>(first, last)` | Copies the elements in source range [`first`, `last`) to the array pointed to by the `N`-th (0-based) argument, which can be either a pointer or an iterator. The action does not take ownership of the elements in the source range. |
| `SetErrnoAndReturn(error, value)` | Set `errno` to `error` and return `value`. |
| `Throw(exception)` | Throws the given exception, which can be any copyable value. Available since v1.1.0. |

---

## Using a Function, Functor, or Lambda as an Action

In the following, by "callable" we mean a free function, `std::function`, functor, or lambda.

| Action                              | Description                            |
| :---------------------------------- | :------------------------------------- |
| `f` | Invoke `f` with the arguments passed to the mock function, where `f` is a callable. |
| `Invoke(f)` | Invoke `f` with the arguments passed to the mock function, where `f` can be a global/static function or a functor. |
| `Invoke(object_pointer, &class::method)` | Invoke the method on the object with the arguments passed to the mock function. |
| `InvokeWithoutArgs(f)` | Invoke `f`, which can be a global/static function or a functor. `f` must take no arguments. |
| `InvokeWithoutArgs(object_pointer, &class::method)` | Invoke the method on the object, which takes no arguments. |
| `InvokeArgument<N>(arg1, arg2, ..., argk)` | Invoke the mock function's `N`-th (0-based) argument, which must be a function or a functor, with the `k` arguments. |

The return value of the invoked function (except `InvokeArgument`) is used as the return value of the action.

When defining a callable to be used with `Invoke*()`, you can declare any unused parameters as `Unused`:

```cpp
using ::testing::Invoke;
double Distance(Unused, double x, double y) { return sqrt(x*x + y*y); }
...
EXPECT_CALL(mock, Foo("Hi", _, _)).WillOnce(Invoke(Distance));
```

`Invoke(callback)` and `InvokeWithoutArgs(callback)` take ownership of `callback`, which must be permanent. The type of `callback` must be a base callback type instead of a derived one, e.g.

```cpp
  BlockingClosure* done = new BlockingClosure;
  ... Invoke(done) ...;  // This won't compile!

  Closure* done2 = new BlockingClosure;
  ... Invoke(done2) ...;  // This works.
```

In `InvokeArgument<N>(...)`, if an argument needs to be passed by reference, wrap it inside `std::ref()`. For example,

```cpp
using ::testing::InvokeArgument;
...
InvokeArgument<1>(5, string("Hello"), std::ref(foo))
```

calls the mock function's #1 argument, passing to it `5` and `string("Hello")` by value, and `foo` by reference.

---

## Default Action

| Action        | Description                                            |
| :------------ | :----------------------------------------------------- |
| `DoDefault()` | Do the default action (specified by `ON_CALL()` or the built-in one). |

> **Note:** due to technical reasons, `DoDefault()` cannot be used inside a composite action - trying to do so will result in a run-time error.

---

## Composite Actions

| Action                         | Description                                 |
| :----------------------------- | :------------------------------------------ |
| `DoAll(a1, a2, ..., an)`       | Do all actions `a1` to `an` and return the result of `an` in each invocation. The first `n - 1` sub-actions must return void and will receive a  readonly view of the arguments. |
| `IgnoreResult(a)`              | Perform action `a` and ignore its result. `a` must not return void. |
| `WithArg<N>(a)`                | Pass the `N`-th (0-based) argument of the mock function to action `a` and perform it. |
| `WithArgs<N1, N2, ..., Nk>(a)` | Pass the selected (0-based) arguments of the mock function to action `a` and perform it. |
| `WithoutArgs(a)`               | Perform action `a` without any arguments. |

---

## Defining Actions

| Macro                              | Description                             |
| :--------------------------------- | :-------------------------------------- |
| `ACTION(Sum) { return arg0 + arg1; }` | Defines an action `Sum()` to return the sum of the mock function's argument #0 and #1. |
| `ACTION_P(Plus, n) { return arg0 + n; }` | Defines an action `Plus(n)` to return the sum of the mock function's argument #0 and `n`. |
| `ACTION_Pk(Foo, p1, ..., pk) { statements; }` | Defines a parameterized action `Foo(p1, ..., pk)` to execute the given `statements`. |

The `ACTION*` macros cannot be used inside a function or class.

---

# Frequently Used Actions: Examples

### Returning a Value
```cpp
using ::testing::Return;
EXPECT_CALL(mock_obj, Foo(_))
    .WillOnce(Return(42));  // Returns 42 on first call
```

### Performing Side Effects
```cpp
using ::testing::SetArgPointee;
EXPECT_CALL(mock_obj, Mutate(_, _))
    .WillOnce(SetArgPointee<1>(5));  // Sets second argument to 5
```

### Combining Multiple Actions
```cpp
using ::testing::DoAll;
EXPECT_CALL(mock_obj, Mutate(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

### Calling a Function or Lambda as an Action
```cpp
using ::testing::Invoke;
EXPECT_CALL(mock_obj, Compute(_, _)).WillOnce(Invoke(&RealCompute));
```

### Invoking N-th Function Argument
```cpp
using ::testing::InvokeArgument;
EXPECT_CALL(mock_obj, DoSomething(_, _))
    .WillOnce(InvokeArgument<1>(42));  // Calls the second argument as callback with 42
```

### Ignoring Result of an Action
```cpp
using ::testing::IgnoreResult;
EXPECT_CALL(mock_obj, DoWork())
    .WillOnce(IgnoreResult(SomeFunctionReturningInt));
```

### Selecting Arguments to Pass in Action
```cpp
using ::testing::WithArgs;
EXPECT_CALL(mock_obj, Foo(_, _, _))
      .WillOnce(WithArgs<0, 2>(Invoke(&SomeFunc)));
```

---

## Tips and Best Practices

- Use `Return()` and related actions to specify the outcomes of mock methods clearly.
- Combine multiple side effects using `DoAll()`, but ensure the last action returns a compatible type.
- Use `Invoke()` or lambdas to delegate calls to actual functions or custom code.
- Use `InvokeArgument<N>(...)` to call callback arguments with specific parameters.
- Use `IgnoreResult()` if you want to use an action but ignore its return value.
- Use argument selection helpers (`WithArg`, `WithArgs`, `WithoutArgs`) to adapt actions expecting fewer or different arguments.

---

## Troubleshooting Common Issues

- **Return behavior unexpected?** Remember `Return(value)` converts `value` once when setting the action. For dynamic values, use lambdas or `ReturnPointee()`.
- **Compiling issues with comma in types?** Wrap complex return/argument types in parentheses or create aliases.
- **Uninteresting calls warnings?** Consider using `NiceMock<T>` or add catch-all `EXPECT_CALL` with `Times(AnyNumber())`.
- **Multiple `WillRepeatedly()` or `WillOnce()` order problems?** Follow proper chaining and use sequences or `RetiresOnSaturation()` to avoid sticky expectations.

---

## References

See the following pages for deeper dives:

- [gMock for Dummies](gmock_for_dummies.md)
- [gMock Cookbook](gmock_cook_book.md)
- [Matchers Reference](reference/matchers.md)
- [Mocking Reference](reference/mocking.md)
- [Expectations and Cardinalities](api-reference/mocking-apis/expectations-and-cardinalities)

---

For the complete alphabetical list of built-in actions, see [Full List of Actions (gMock source)](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-actions.h).