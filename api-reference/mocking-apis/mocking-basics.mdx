---
title: "Creating Mocks & Basic Expectations"
description: "Explains how to define mock classes, use the MOCK_METHOD macro, and set up basic expectations using EXPECT_CALL and ON_CALL. Provides step-by-step examples for simulating interfaces and verifying interaction patterns."
---

# Creating Mocks & Basic Expectations

GoogleTest's mocking framework, gMock, empowers you to create mock classes that simulate interfaces and verify the behavior of dependent components. This page guides you through the fundamental concepts of defining mocks, using the `MOCK_METHOD` macro to declare mock methods, and setting expectations with `EXPECT_CALL` and `ON_CALL`.

---

## Defining Mock Classes

A mock class is a test double that implements the same interface as a real class, allowing you to specify and validate how its methods are expected to be called. The typical process involves:

1. Deriving a class from the interface or base class you want to mock.
2. Using the `MOCK_METHOD` macro inside the mock class to declare each method to be mocked.

### Using `MOCK_METHOD`

`MOCK_METHOD` defines a mock method with a given return type, name, and argument list. It can also specify qualifiers such as `const`, `override`, or calling conventions.

```cpp
// General form:
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Qualifiers));
```

For example, to mock a method:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Handling Types with Commas

Since commas in argument or return types can confuse the macro parser, such types must be wrapped with parentheses or aliased:

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  using MapType = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapType, bool));
};
```

### Access Specifier

`MOCK_METHOD` declarations must always be in the `public` section, regardless of the method access in the original class. This enables external use of `EXPECT_CALL` and `ON_CALL`.

---

## Setting Expectations

Expectations define how you expect the mock methods to be called and what they should do. There are two main macros:

### `EXPECT_CALL`

Sets an expectation that a method **will be called**, specifying:

- Which mock object and method.
- Argument matchers.
- Call count (cardinality).
- Actions to perform when called.

Example:

```cpp
using ::testing::Return;

MockTurtle turtle;
EXPECT_CALL(turtle, Forward(100))
    .Times(1)  // Expect exactly one call with argument 100.
    .WillOnce(Return());  // Action on call (for void, Return() is trivial).

turtle.Forward(100);  // Matches expectation.
```

If a method has multiple calls with different behaviors, chain `WillOnce` clauses:

```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));

// Calls return 10, then 20, then always 30.
```

Omitting `.Times()` causes gMock to infer it based on actions used.

### `ON_CALL`

Defines the **default behavior** of a mock method without setting an expectation. Calls not matching any `EXPECT_CALL` will invoke the default behavior.

```cpp
ON_CALL(turtle, GetY()).WillByDefault(Return(0));
```

This is useful for methods where you don't care about exact call verification.

---

## Working with Mock Behavior Strictness

Mocks come with different default behaviors for handling calls to methods without explicit expectations:

- **NaggyMock** (default): warns on uninteresting calls.
- **NiceMock**: suppresses warnings on uninteresting calls.
- **StrictMock**: treats uninteresting calls as errors.

You can wrap your mock classes with these to control test strictness:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> my_mock;
```

---

## Practical Example

Suppose you have an interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void Forward(int distance) = 0;
};
```

You can write a mock class:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};
```

In your test:

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::_;

TEST(MyTest, MovesTurtleCorrectly) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenUp());
  EXPECT_CALL(turtle, Forward(50)).Times(1);

  // Exercise the code that uses turtle.
  turtle.PenUp();
  turtle.Forward(50);
}
```

You can also set default return values for other methods using `ON_CALL`.

---

## Tips and Best Practices

- Always declare mock methods in the public section.
- Use `EXPECT_CALL` only when verifying the invocation; otherwise use `ON_CALL`.
- To suppress noisy warnings about uninteresting calls, wrap mocks with `NiceMock`.
- When mocking overloaded methods, specify matchers explicitly to avoid ambiguity.
- Avoid nesting `NiceMock`, `NaggyMock`, and `StrictMock` wrappers.

---

## Troubleshooting

- If uninteresting calls produce warnings, consider switching to `NiceMock` or adding explicit expectations with `.Times(AnyNumber())`.
- Errors about default constructor absence usually mean you must provide an action or a default value.
- Beware of expectations that are too strict, which may cause brittle tests.
- Use `EXPECT_CALL` before any calls to the mock methods.

---

## Related Documentation

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes for advanced uses.
- [Writing Your First Test Case](https://google.github.io/googletest/getting-started/writing-tests.html): Introductory guide.
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html): Detailed matcher information.
- [Actions Reference](https://google.github.io/googletest/reference/actions.html): Built-in actions you can use.
- [Strictness, Nice & Naggy Mocks](https://google.github.io/googletest/reference/mocking.html#strictness-wrappers): Understanding mock behavior.

---