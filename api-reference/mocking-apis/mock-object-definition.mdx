---
title: "Mock Object Definition"
description: "API and macro reference for declaring mock methods and classes using GoogleMock (e.g., MOCK_METHOD, specifiers, and configuration options). Outlines the structures and conventions for integrating mocking into your codebase."
---

# Mock Object Definition

This page provides a detailed API and macro reference for declaring mock methods and classes using GoogleMock, with a focus on the `MOCK_METHOD` macro and its associated specifiers and options. It explains the conventions and structures you need to integrate mocking effectively into your C++ tests.

---

## Defining Mock Methods with MOCK_METHOD

The `MOCK_METHOD` macro is the cornerstone of mock class definitions in GoogleMock. It allows you to declare mock methods inside your mock classes that intercept calls and can have expectations and behaviors set on them.

### Syntax

```cpp
MOCK_METHOD(return_type, method_name, (args...), (specifiers));
```

- `return_type`: The return type of the mock method.
- `method_name`: The name of the method you want to mock.
- `args...`: A parenthesized list of argument types (and optionally names).
- `specifiers` (optional): A comma-separated list of qualifiers placed inside parentheses.

### Specifiers

The fourth parameter, *specifiers*, accepts a closed list of qualifiers to mimic the original method's properties. These include:

| Qualifier            | Effect                                                          |
|----------------------|-----------------------------------------------------------------|
| `const`              | Marks the mocked method as `const`. Must be used if overriding a `const` method. |
| `override`           | Marks the mocked method as `override`. Strongly recommended for virtual overrides. |
| `noexcept`           | Marks the mocked method as `noexcept`. Required if overriding such methods. |
| `Calltype(...)`      | Specifies the calling convention (e.g., for Windows `STDMETHODCALLTYPE`). |
| `ref(&)` / `ref(&&)` | Marks the method with the specified reference qualifier. Required if base method has reference qualifiers. |

Here is an example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

### Handling Argument Types with Commas

If your argument or return type contains commas (e.g., template types like `std::pair<int, int>`), wrap the type inside an extra set of parentheses or use a type alias:

```cpp
// Wrapping complex types in parentheses
MOCK_METHOD((std::pair<int, int>), GetPair, ());

// Using type aliases
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetPair, ());
```

### Access Level and Location

Always place `MOCK_METHOD` declarations in the `public:` section, regardless of whether the base method is `public`, `protected`, or `private`. This ensures test code can use `ON_CALL` and `EXPECT_CALL` with these mocks.

---

## Defining Mock Classes

To use `MOCK_METHOD`, define a mock class derived from the interface or base class you want to mock. For example:

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

No further implementation is needed; `MOCK_METHOD` generates the method bodies.

---

## Important Details & Best Practices

### Virtual Destructors

Your interface base classes _must_ have virtual destructors to avoid undefined behavior and memory leaks when deleting mock objects via base pointers.

Example:

```cpp
class Foo {
 public:
  virtual ~Foo() {}  // REQUIRED
  virtual int GetSize() const = 0;
};
```

### Overloaded Methods

You can mock overloaded methods by simply providing `MOCK_METHOD` declarations for each overload. If you only mock some overloads, bring the others into scope with `using` to avoid hiding them.

Example:

```cpp
class Foo {
 public:
  virtual int Add(int x);
  virtual int Add(double x);
};

class MockFoo : public Foo {
 public:
  using Foo::Add;  // Prevents hiding
  MOCK_METHOD(int, Add, (int x), (override));
};
```

### Mocking Class Templates

You can mock template interfaces by defining template mock classes:

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int GetSize() const = 0;
  virtual void Push(const T& x) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

---

## Utilities for Mock Behavior Control

### NiceMock, NaggyMock, StrictMock

GoogleMock offers wrappers to control uninteresting call behavior on mocks:

- **NiceMock<T>**: Ignores uninteresting calls (no warnings or failures).
- **NaggyMock<T>**: Prints warnings on uninteresting calls (default behavior).
- **StrictMock<T>**: Fails tests on uninteresting calls.

Use them by wrapping your mock:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_foo;

using ::testing::StrictMock;
StrictMock<MockFoo> strict_foo;
```

Only affects mock methods defined _directly_ in the mock class using `MOCK_METHOD`.

### AllowLeak

If a mock object's lifetime extends beyond the test scope without deletion, preventing automatic verification, you can suppress leak detection:

```cpp
Mock::AllowLeak(&mock_obj);
```

---

## Typical Usage Flow

1. Define your interface with virtual methods and a virtual destructor.
2. Create a mock class by inheriting and declaring mock methods with `MOCK_METHOD`.
3. Instantiate your mock object in your test.
4. Set expectations via `EXPECT_CALL`.
5. Use the mock in code under test.
6. GoogleMock automatically verifies expectations on destruction.

Example:

```cpp
using ::testing::Return;
using ::testing::AtLeast;

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};

TEST(FooTest, Example) {
  MockFoo foo;
  EXPECT_CALL(foo, GetSize())
      .Times(AtLeast(1))
      .WillRepeatedly(Return(42));

  // Use foo in tested code
  int size = foo.GetSize();
  EXPECT_EQ(size, 42);
}
```

---

## Additional Notes

- Never set expectations on mock methods after they have been exercised; the behavior is undefined.
- When mocking methods that accept or return move-only types (e.g., `std::unique_ptr`), define `MOCK_METHOD`s normally and supply lambdas or callables to `WillOnce` / `WillRepeatedly` to generate fresh move-only instances per call.
- For long or complex argument lists, consider refactoring or redispatching in the mock class to simplify the mocked interface.
- Use the GoogleMock verbosity flag (`--gmock_verbose`) to adjust diagnostic output for uninteresting calls.

---

## References

- [Mocking Reference](../reference/mocking.md#macros) - Full detailed description of mocking macros and classes.
- [gMock Cookbook](../guides/mocking-and-advanced-techniques/advanced-mocking-patterns.md) - Practical patterns and tips for effective mock usage.
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) - Quick reference and examples.
- [gMock for Dummies](../docs/gmock_for_dummies.md) - Beginner-friendly introduction and tutorial.

---

## Related API Concepts

- **EXPECT_CALL**: Setting expectations on mock method calls including argument matchers, call counts, and actions.
- **ON_CALL**: Setting default behavior when method calls don't have explicit expectations.
- **Matchers**: Granular argument validation.
- **Actions**: Defining method behavior on invocation.
- **Strictness Modes**: Controlling test strictness with `NiceMock`, `NaggyMock`, and `StrictMock`.

Use these in conjunction to write robust, maintainable tests with GoogleMock.

---

## Troubleshooting

- If you see warnings or errors about uninteresting calls, consider using `NiceMock` or adjusting verbosity.
- Virtual destructors are mandatory for correct mock cleanup.
- When mocking overloaded functions, be sure to declare each overload or use `using` to bring unmocked versions into scope.
- For compilation issues with complex argument types, try wrapping types in parentheses or using type aliases.

---

## Example - Complete Mock Class

```cpp
#include <gmock/gmock.h>

class FooInterface {
 public:
  virtual ~FooInterface() {}
  virtual int Compute(int x, int y) = 0;
  virtual std::string GetName() const = 0;
};

class MockFoo : public FooInterface {
 public:
  MOCK_METHOD(int, Compute, (int x, int y), (override));
  MOCK_METHOD(std::string, GetName, (), (const, override));
};
```

---

## Use Cases

- Simulate system dependencies or external APIs in unit tests.
- Verify interaction and call order.
- Control return values and side-effects conditionally.
- Support polymorphic and templated interfaces.

---

*This page focuses exclusively on defining mocks with `MOCK_METHOD` and mock class conventions, complementing other pages on setting expectations, matchers, actions, and strictness modes.*

---

<Source url="https://github.com/google/googletest" paths='[{"path":"googlemock/include/gmock/gmock-nice-strict.h"},{"path":"googlemock/src/gmock-spec-builders.cc"},{"path":"docs/reference/mocking.md"}]' />