---
title: "Creating and Using Mock Objects"
description: "How to define mock classes and methods using GoogleMock macros, with a focus on the MOCK_METHOD family. Includes lifecycle, instantiation, and the principles of behavior-driven testing."
---

# Creating and Using Mock Objects

Mock objects are at the heart of behavior-driven testing with GoogleMock, enabling you to replace real dependencies with controlled, observable stand-ins for testing purposes. This page guides you through defining mock classes and methods using GoogleMock's `MOCK_METHOD` family of macros, illuminating typical mock object lifecycles, instantiation strategies, and the best practices for composing effective mock behaviors.

---

## Overview

GoogleMock provides the `MOCK_METHOD` macro to define mock methods inside mock classes with signatures matching those of the interfaces or classes you want to mock. This macro greatly simplifies creating mock versions of classes, capturing calls, matching arguments, specifying return values, and verifying interactions.

- Mock classes inherit from the interface or base class you want to mock.
- `MOCK_METHOD` declares each mocked method and generates all relevant boilerplate.
- `NiceMock`, `NaggyMock`, and `StrictMock` wrappers control the strictness level of mocks regarding uninteresting calls.

Examples in this page illustrate defining mock classes, creating instances (including with non-default constructors), and controlling mock behavior for various testing scenarios.

---

## Defining Mock Classes and Methods

### Using `MOCK_METHOD`

The primary facility to define mock methods is the macro:

```cpp
MOCK_METHOD(return_type, method_name, (argument_types...), (specifiers));
```

- **return_type**: The return type of the method.
- **method_name**: The name of the method to mock.
- **argument_types**: The types of arguments, enclosed in parentheses.
- **specifiers**: Optional qualifiers such as `const`, `override`, `noexcept`, or calling conventions.

Basic example mocking virtual methods:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

### Handling Complex Types with Commas

If your argument or return types contain commas (e.g., templates like `std::pair<int, int>`), wrap the entire type in extra parentheses, or use type aliases to aid parsing:

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<int, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
// Or using aliases:
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetPair, ());
```

### Overridden Methods in Base Classes

`MOCK_METHOD` declarations must be placed in the `public:` section of your mock class regardless of the access level of the original methods — this makes invocation and mocking consistent.

### Mocking Constructors

Mocks may be instantiated with any arguments accepted by the base class constructors. When using `NiceMock`, `NaggyMock`, or `StrictMock` wrappers, the constructors of `MockClass` are inherited, allowing:

```cpp
NiceMock<MockFoo> nice_foo(5, "arg");
```

### Mocking Template Classes

Template classes are mocked just like normal classes, with the mock class providing `MOCK_METHOD` definitions:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### Key Qualifiers Supported

| Qualifiers              | Description                                          |
|-------------------------|------------------------------------------------------|
| `const`                 | Marks method as `const` (required if base method is) |
| `override`              | Indicates the method overrides a virtual method      |
| `noexcept`              | Method marked as `noexcept`                           |
| `Calltype(convention)`  | Sets calling convention for Windows interop          |
| `ref(&)` or `ref(&&)`   | Marks method with reference qualifiers                |


---

## Using `NiceMock`, `NaggyMock`, and `StrictMock`

Beyond raw mocks (`MockFoo`), GoogleMock provides wrappers that modify how uninteresting calls (calls to methods without expectations) are treated:

| Wrapper       | Behavior Regarding Uninteresting Calls                                |
|---------------|-----------------------------------------------------------------------|
| `NiceMock<T>` | Suppresses warnings for uninteresting calls (ignore silently)         |
| `NaggyMock<T>`| Warns on uninteresting calls (default for raw mocks)                  |
| `StrictMock<T>` | Treats uninteresting calls as test failures                          |


Usage example with a mock class `MockFoo`:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // No warnings on uninteresting calls
NaggyMock<MockFoo> naggy_foo;    // Warnings on uninteresting calls
StrictMock<MockFoo> strict_foo;  // Fails test on uninteresting calls
```

They function as subclasses of the original mock class and forward constructor arguments. This lets you substitute them seamlessly.

<Note>
Currently, mock objects behave as NaggyMocks by default. There is a planned shift to make mocks behave as NiceMocks by default for test maintainability.
</Note>

---

## Typical Mock Object Lifecycle

1. **Define a mock class** by inheriting from the interface to mock and adding `MOCK_METHOD` declarations for virtual methods.
2. **Create instances** of the mock in test functions or fixtures, possibly wrapping in `NiceMock` or `StrictMock` for strictness control.
3. **Set default actions** with `ON_CALL()` if desired, specifying what to do when methods are called without explicit expectations.
4. **Set expectations** with `EXPECT_CALL()`, specifying method calls, parameters, cardinality, and return or side effect behaviors.
5. **Exercise your code** that uses the mocked dependencies.
6. **At teardown**, GoogleMock verifies all expectations and reports unmet or excessive calls, helping catch interaction bugs.

---

## Example: Creating and Using a Mock

Given a base interface:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};
```

Define a mock class:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

Use the mock in a test:

```cpp
using ::testing::Return;
using ::testing::_; // wildcard matcher

TEST(FooTest, TestDescribe) {
  MockFoo foo;

  // Set default return value for GetSize
  ON_CALL(foo, GetSize()).WillByDefault(Return(10));

  // Expect Describe called once with any argument
  EXPECT_CALL(foo, Describe(_))
      .WillOnce(Return("Mocked Description"));

  // Exercise code
  EXPECT_EQ(foo.GetSize(), 10);
  EXPECT_EQ(foo.Describe("example"), "Mocked Description");
}
```

---

## Best Practices

- **Place `MOCK_METHOD` declarations in `public:`** section regardless of base class method access to ensure accessibility for mocking.
- **Use `NiceMock` for less strict tests** to avoid warnings that distract from test intent.
- **Use `StrictMock` when unanticipated calls should be treated as failures** to enforce stricter contract checking.
- **Avoid mocking methods inherited from base classes using `MOCK_METHOD` in derived mocks,** as strictness wrappers may not affect base class methods on some compilers.
- **Use type aliases or wrapping parentheses** when argument or return types involve templates with commas.
- **Construct mocks with appropriate arguments** if your base class has parameterized constructors, leveraging the wrappers' constructor forwarding.
- **Avoid setting expectations after exercising mocks**, as behavior becomes undefined; ensure all expectations are set before the system-under-test interacts with mocks.

---

## Troubleshooting

- **Compilation errors with `MOCK_METHOD` and commas in types:** Wrap the type with extra parentheses or define type aliases.
- **Unexpected warnings about uninteresting calls:** Consider switching to `NiceMock` to silence harmless warnings if intentional.
- **StrictMock unexpected call failure:** An unanticipated method call without matching expectation will fail immediately.
- **Mock destructor behavior:** If you need to verify timing of destructor calls, mock a separate method (e.g., `Die`) and call it in the destructor as `MOCK_METHOD` cannot mock the destructor.

---

## Further Learning

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Comprehensive detailing of macros and classes.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for common patterns.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for complex mocking scenarios.
- [Mock Strictness: Nice, Naggy, and Strict](https://google.github.io/googletest/guides/mocking-scenarios/mock-strictness-best-practices.html) — How to select the appropriate strictness level.

---

## Related Pages and Links

- [Writing and Running Your First Test](../../getting-started/gs-configuration-first-test/gs-first-test.md)
- [Creating and Using Basic Mocks](../guides/mocking-scenarios/creating-basic-mocks.md)
- [Mocking Reference](../docs/reference/mocking.md)
- [Matchers Reference](../api-reference/matcher-actions/matcher-reference.md)
- [Actions Reference](../api-reference/matcher-actions/action-reference.md)

---

For implementation details and test coverage, see the source file `googlemock/include/gmock/gmock-nice-strict.h` which defines the `NiceMock`, `NaggyMock`, and `StrictMock` class templates that manage mock strictness behaviors transparently.

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-nice-strict.h"}]} branch="main" />
