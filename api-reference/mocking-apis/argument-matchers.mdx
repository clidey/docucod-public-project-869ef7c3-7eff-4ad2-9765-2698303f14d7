---
title: "Argument Matchers"
description: "Reference for built-in and custom argument matchers in GoogleMock. Harness expressive matching for precise verification of mock interactions, with documentation on core and extension points for matchers."
---

# Argument Matchers Reference

Harness the full power of GoogleMock's argument matchers to precisely verify mock interactions in your C++ unit tests. This comprehensive guide covers all built-in and custom argument matchers, empowering you to express complex expectations effectively.

---

## Overview

Argument matchers serve as predicates on *single* function arguments. When setting expectations on mocked methods using `EXPECT_CALL()` or defining default behaviors with `ON_CALL()`, these matchers allow you to specify and verify the properties or values of arguments passed during mock interactions.

Beyond mocking, you can also use matchers directly to assert any value using `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)`. This approach offers expressive and human-readable assertions with rich failure diagnostics.

**Key Practices:**

- Prefer explicit equality matchers like `Eq()` over implicit conversions to avoid surprises.
- Use polymorphic matchers (`Eq(v)`, `Ge(v)`, etc.) for maximum flexibility across types.
- Leverage composite matchers like `AllOf()`, `AnyOf()`, and `Not()` to build expressive compound conditions.

---

## Wildcard Matchers

| Matcher              | Description                             |
| :------------------- | :------------------------------------ |
| `_`                  | Matches any value of the expected type. |
| `A<type>()` or `An<type>()` | Matches any value of the specified `type`. |

**Effectiveness:** Use `_` when argument values are unimportant. Use `A<T>()` / `An<T>()` to restrict matches to specific types when overload resolution or type inference is tricky.

---

## Generic Comparison Matchers

These matchers test the argument against a specified value or condition using fundamental comparison operators or predicates.

| Matcher               | Description                                                          |
| :-------------------- | :------------------------------------------------------------------- |
| `Eq(value)` or `value`| Matches if argument `== value`.                                     |
| `Ne(value)`           | Matches if argument `!= value`.                                     |
| `Ge(value)`           | Matches if argument `>= value`.                                     |
| `Gt(value)`           | Matches if argument `> value`.                                      |
| `Le(value)`           | Matches if argument `<= value`.                                     |
| `Lt(value)`           | Matches if argument `< value`.                                      |
| `IsTrue()`            | Matches if argument evaluates to true in a boolean context.         |
| `IsFalse()`           | Matches if argument evaluates to false in a boolean context.        |
| `DistanceFrom(target, matcher)` | Matches if the distance between the argument and `target` matches `matcher`. Distance computed as `abs(argument - target)` by default. |
| `DistanceFrom(target, get_distance, matcher)` | Matches if the distance computed by the functor `get_distance(argument, target)` matches `matcher`. |
| `IsNull()`            | Matches any null raw or smart pointer.                             |
| `NotNull()`           | Matches any non-null raw or smart pointer.                         |
| `Optional(matcher)`   | Matches an engaged `optional<>` whose value matches `matcher`.    |
| `VariantWith<T>(matcher)` | Matches a `variant<>` holding alternative of type T whose value matches `matcher`. |
| `Ref(variable)`       | Matches an argument that is a reference to the given variable.

**Note:** Except for `Ref()`, these matchers copy their stored values to ensure lasting validity. For non-copyable types, wrap arguments in `std::ref(...)` but ensure the referenced object remains alive and unmodified after setting the expectation.

---

## Floating-Point Matchers

Floating-point comparisons are complex due to rounding and special values like NaN. GoogleMock provides ULP-based comparison matchers that handle these complexities gracefully.

| Matcher                          | Description                                                          |
| :-------------------------------| :------------------------------------------------------------------- |
| `DoubleEq(double)`               | Matches `double` values approximately equal to the argument, considering two NaNs as unequal. |
| `FloatEq(float)`                 | Matches `float` values approximately equal to the argument, considering two NaNs as unequal. |
| `NanSensitiveDoubleEq(double)`  | Matches `double` values approximately equal to the argument, considering two NaNs as equal. |
| `NanSensitiveFloatEq(float)`    | Matches `float` values approximately equal to the argument, considering two NaNs as equal. |
| `DoubleNear(double, max_error)` | Matches a `double` that is within `max_error` absolute distance of the argument, two NaNs unequal. |
| `FloatNear(float, max_error)`   | Matches a `float` that is within `max_error` absolute distance of the argument, two NaNs unequal. |
| `NanSensitiveDoubleNear(double, max_error)` | Matches a `double` close to the argument within `max_error` and treats NaNs as equal. |
| `NanSensitiveFloatNear(float, max_error)`   | Matches a `float` close to the argument within `max_error` and treats NaNs as equal. |
| `IsNan()`                       | Matches any floating-point value that is NaN.                        |

**Usage Example:**

```cpp
EXPECT_THAT(result, DoubleNear(3.14, 0.01));
EXPECT_THAT(value, IsNan());
```

---

## String Matchers

Matchers capable of validating string contents using exact match, substring, prefix, suffix, and regular expressions. Supports narrow and wide strings.

| Matcher                      | Description                                                         |
| :---------------------------| :------------------------------------------------------------------ |
| `StrEq(string)`              | Matches a string exactly equal to the argument, case-sensitive.    |
| `StrNe(string)`              | Matches strings not equal to the argument.                         |
| `StrCaseEq(string)`          | Matches strings equal ignoring case.                               |
| `StrCaseNe(string)`          | Matches strings not equal ignoring case.                           |
| `HasSubstr(string)`          | Matches strings containing the given substring.                   |
| `StartsWith(prefix)`         | Matches strings starting with `prefix`.                            |
| `EndsWith(suffix)`           | Matches strings ending with `suffix`.                              |
| `ContainsRegex(regex_pattern)` | Matches strings matching the provided regex anywhere.             |
| `MatchesRegex(regex_pattern)` | Matches strings matching the regex fully (from start to end).     |
| `WhenBase64Unescaped(matcher)` | Matches a base64-url-safe encoded string whose decoded value matches `matcher`. |
| `IsEmpty()`                  | Matches empty strings or containers.                              |

**Examples:**

```cpp
EXPECT_THAT(str, StartsWith("Hello"));
EXPECT_THAT(str, ContainsRegex("foo.*bar"));
EXPECT_THAT(base64_encoded, WhenBase64Unescaped(EndsWith("!")));
```

---

## Exception Matchers

Matchers for verifying exceptions thrown by callable objects.

| Matcher                         | Description                                    |
| :------------------------------| :---------------------------------------------|
| `Throws<E>()`                   | Matches callables that throw an exception of type `E`. |
| `Throws<E>(matcher)`            | Matches callables that throw an exception of type `E` satisfying `matcher`. |
| `ThrowsMessage<E>(matcher)`     | Matches callables that throw an exception of type `E` whose `.what()` message matches `matcher`. |

**Example:**

```cpp
auto lambda = [] { throw std::runtime_error("error msg"); };
EXPECT_THAT(lambda, Throws<std::runtime_error>());
EXPECT_THAT(lambda, Throws<std::runtime_error>(HasSubstr("error")));
EXPECT_THAT(lambda, ThrowsMessage<std::runtime_error>(StrEq("error msg")));
```

---

## Container Matchers

Matchers tailored to validate STL-style container contents and properties with rich failure messages.

| Matcher                                | Description                                                            |
| :-------------------------------------| :--------------------------------------------------------------------- |
| `IsEmpty()`                           | Matches empty containers (`container.empty()`).                         |
| `SizeIs(matcher)`                    | Matches containers whose size matches `matcher`.                      |
| `BeginEndDistanceIs(matcher)`        | Matches containers where the distance between `begin()` and `end()` matches `matcher`. Useful when `size()` is not available. |
| `ContainerEq(container)`             | Matches containers equal to `container`, with detailed diff on mismatch. |
| `Contains(value_or_matcher)`         | Matches containers containing at least one element matching the value or matcher. Supports `.Times(n)` modifier to assert count. |
| `Each(value_or_matcher)`             | Matches containers whose *every* element matches `value_or_matcher`.  |
| `ElementsAre(m0, m1, ..., mn)`       | Matches containers with exactly `n+1` elements matching the matchers in order. |
| `ElementsAreArray(sequence)`         | Like `ElementsAre()`, but takes a container, array, or initializer list for matchers/values. |
| `UnorderedElementsAre(m0, m1, ..., mn)` | Matches containers with exactly `n+1` elements matching the matchers under *any* permutation. |
| `UnorderedElementsAreArray(sequence)` | Like `UnorderedElementsAre()`, but takes a container, array, or initializer list. |
| `IsSubsetOf(sequence)`               | Matches containers whose elements form a subset matching given sequence of matchers/values. |
| `IsSupersetOf(sequence)`             | Matches containers containing a superset matching given sequence of matchers/values. |
| `Pointwise(pair_matcher, sequence)`  | Matches containers element-wise using pairs `(actual_element, expected_element)` matched against `pair_matcher`. Order matters. |
| `UnorderedPointwise(pair_matcher, sequence)` | Like `Pointwise`, but ignores the order of elements. |
| `WhenSorted(matcher)`                | Matches containers that match matcher `m` when sorted using `<`.       |
| `WhenSortedBy(comparator, matcher)` | Matches containers that match matcher `m` when sorted with `comparator`. |

**Important Tips:**

- `ElementsAre*` are order-sensitive; prefer `UnorderedElementsAre*` for containers without defined element order such as unordered maps.
- Compose matchers for nested containers by nesting `ElementsAre()`, `UnorderedElementsAre()`, etc.
- Use `Pointee(...)` to match the dereferenced values for pointers to containers or nested pointers.

---

## Member Matchers

Designed to match fields, properties, keys, and pairs inside structured types.

| Matcher                                            | Description                                                        |
| :-------------------------------------------------| :-----------------------------------------------------------------|
| `Field(&Class::field, matcher)`                   | Matches object whose field `field` matches `matcher`.             |
| `Field(name, &Class::field, matcher)`              | Same as above, but includes field name for improved diagnostics. |
| `Property(&Class::property, matcher)`             | Matches object whose `property()` method result matches `matcher`.
  **Note:** `property()` must be `const` and have zero arguments. Avoid using on methods you do not own. |
| `Property(name, &Class::property, matcher)`        | Same as above with additional `property` name for better messages. |
| `Key(matcher)`                                    | Matches a `std::pair` whose `.first` matches `matcher`. Useful for map keys. |
| `Pair(matcher1, matcher2)`                        | Matches a `std::pair` whose `.first` and `.second` match `matcher1` and `matcher2` respectively. |
| `Address(matcher)`                                | Matches object whose address matches `matcher`.                    |
| `WhenDynamicCastTo<T>(matcher)`                   | Matches pointer or reference dynamically casted to `T` and matched against `matcher`. Requires RTTI.

**Example:**

```cpp
EXPECT_THAT(foo, Field(&Foo::count, Ge(10)));
EXPECT_THAT(map, Contains(Key(Le(5))));
EXPECT_THAT(pair, Pair(Ge(0), HasSubstr("ok")));
```

---

## Matching the Result of a Function, Functor, or Callback

| Matcher                                     | Description                                     |
| :------------------------------------------| :----------------------------------------------|
| `ResultOf(f, matcher)`                     | Matches if `f(argument)` matches `matcher`.    |
| `ResultOf(description, f, matcher)`       | Same as above, with better failure message labeling with `description`. |

**Example:**

```cpp
EXPECT_THAT(obj, ResultOf(&Foo::GetName, StartsWith("John")));
```

---

## Pointer Matchers

Enrich pointer matching beyond null tests.

| Matcher                 | Description                                                   |
| :---------------------- | :------------------------------------------------------------|
| `Pointee(matcher)`      | Matches if pointer (raw or smart) points to a value matching `matcher`. Null pointers always fail. |
| `Pointer(matcher)`      | Matches if pointer (raw or smart) itself matches `matcher`. This allows checking the pointer value itself.
|
| `Address(matcher)`      | Matches if the address of the argument matches `matcher`.     |
| `WhenDynamicCastTo<T>(matcher)` | Matches argument dynamically cast to type `T` against `matcher`. Matches null if cast fails (pointer version); fails immediately if cast fails (reference version). Requires RTTI. |

**Example:**

```cpp
EXPECT_CALL(mock, Foo(Pointee(Ge(5))));
EXPECT_THAT(ptr, Pointer(nullptr));
EXPECT_THAT(obj, Address(Eq(&target)));
```

---

## Multi-Argument Matchers

Although matchers match single arguments, GoogleMock allows matching a tuple of arguments from a mock function call using these special matchers:

| Matcher           | Description                                                              |
| :-----------------| :------------------------------------------------------------------------|
| `Eq()`            | Matches a 2-tuple `(x,y)` where `x == y`.                              |
| `Ge()`            | Matches 2-tuple `(x,y)` where `x >= y`.                                |
| `Gt()`            | Matches 2-tuple `(x,y)` where `x > y`.                                 |
| `Le()`            | Matches 2-tuple `(x,y)` where `x <= y`.                                |
| `Lt()`            | Matches 2-tuple `(x,y)` where `x < y`.                                 |
| `Ne()`            | Matches 2-tuple `(x,y)` where `x != y`.                                |
| `AllArgs(matcher)`| Matches all arguments as a tuple against `matcher`. Equivalent to `matcher` itself, syntactic sugar useful with `.With()`. |
| `Args<N1, N2, ..., Nk>(matcher)` | Matches selected function arguments (by zero-based indices) as a tuple against `matcher`.

**Example Usage:**

```cpp
EXPECT_CALL(mock, Func(_, _)).With(Lt()); // first argument is less than second
EXPECT_CALL(mock, Func(_, _, _)).With(Args<0, 2>(Ge()));
```

---

## Composite Matchers

Build complex conditions by logically combining multiple matchers.

| Matcher                       | Description                                    |
| :-----------------------------| :---------------------------------------------|
| `AllOf(m1, m2, ..., mn)`      | Matches if all of `m1`, ..., `mn` match.         |
| `AnyOf(m1, m2, ..., mn)`      | Matches if any of `m1`, ..., `mn` matches.       |
| `Not(matcher)`                | Matches if `matcher` does *not* match.          |
| `Conditional(cond, m1, m2)`  | Matches `m1` if `cond` is true; else matches `m2`.

**Example:**

```cpp
EXPECT_CALL(mock, Foo(AllOf(Gt(5), Ne(10))));
EXPECT_THAT(value, Not(Eq(0)));
```

---

## Adapters for Matchers

| Matcher                    | Description                                   |
| :-------------------------| :----------------------------------------------|
| `MatcherCast<T>(m)`       | Casts matcher `m` to type `Matcher<T>`. Use carefully; may bypass type safety. |
| `SafeMatcherCast<T>(m)`   | Safely casts matcher `m` to `Matcher<T>`, verifying implicit convertibility without loss (recommended over `MatcherCast`). |
| `Truly(predicate)`        | Turns a unary predicate function or functor into a matcher. Matches if predicate returns something boolean-convertible to true.

---

## Using Matchers as Predicates

Matchers implement predicate semantics and can be used directly as unary predicates.

| Matcher                              | Description                                 |
| :-----------------------------------| :--------------------------------------------|
| `Matches(matcher)`                   | Returns a predicate functor that returns true if the value matches `matcher`. |
| `ExplainMatchResult(matcher, value, listener)` | Evaluates whether `value` matches the `matcher`, streaming explanation to `listener`. |
| `Value(value, matcher)`              | Evaluates to true if `value` matches `matcher`. Useful as a convenience function.

---

## Defining Custom Matchers

GoogleMock provides flexible facilities to write your own matchers, either quickly using macros or more rigorously by implementing interfaces.

### Using the `MATCHER*` Macros

- `MATCHER(name, description) { /* return bool; */ }` defines a matcher named `name()`.
- `MATCHER_P(name, param, description) { /* return bool; */ }` defines a parameterized matcher.
- Up to `MATCHER_P10` support multiple parameters.

**Inside the matcher body:**

- `arg` is the value being matched.
- For parameterized matchers, parameters are available by name.
- You can stream additional failure info to `*result_listener`.

**Example:**

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
MATCHER_P(IsDivisibleBy, n, "") {
  if (arg % n == 0) return true;
  *result_listener << "remainder: " << (arg % n);
  return false;
}
```

Use such matchers:

```cpp
EXPECT_CALL(mock, Foo(IsEven()));
EXPECT_THAT(value, IsDivisibleBy(5));
```

### Writing New Matcher Classes

For more control or performance, implement matcher interfaces directly:

- Provide `MatchAndExplain(value, listener): bool`.
- Provide `DescribeTo(ostream*)` and optionally `DescribeNegationTo(ostream*)`.
- Add typedef `is_gtest_matcher`.

Then create a factory function returning `testing::Matcher<YourType>`.

---

## Practical Tips & Best Practices

- Use `ON_CALL()` to define default mock behaviors without imposing expectations; use `EXPECT_CALL()` when verifying calls actively.
- Use `NiceMock<T>` or `StrictMock<T>` to suppress or enforce warnings on uninteresting calls.
- Use `SafeMatcherCast<T>` for compatible cross-type matcher conversions to ensure safety.
- Wrap non-copyable arguments with `std::ref()` to avoid copying issues in matchers.
- Combine matchers with `AllOf()`, `AnyOf()`, and `Not()` to create powerful conditions.
- Use `FieldsAre()` and member matchers to focus assertions on specific parts of complex objects.
- Nested matchers and adapters like `Pointee()` can handle deep data structures and pointers gracefully.
- In multi-argument contexts, use tuple matchers like `Args<>` and relation matchers like `Lt()` to validate argument relations.

---

## Example: Matching a Pointer to a Value In Range

```cpp
EXPECT_CALL(mock, Foo(Pointee(AllOf(Ge(5), Le(10)))));
```

This expects `mock.Foo()` to be called with a pointer to a value between 5 and 10 inclusive.

## Example: Matching Arguments with Complex Conditions

```cpp
// Expect first argument less than second
EXPECT_CALL(mock, Bar(_, _))
    .With(Lt());

// Match only selected arguments of a method with many parameters
EXPECT_CALL(mock, Foo(_, _, _, _, _))
    .With(AllOf(Args<0, 2>(Gt(5)), Args<2, 4>(Lt(100))));
```

## Example: Defining a Custom Matcher

```cpp
MATCHER_P(IsDivisibleBy, n, "") {
  if (arg % n == 0) return true;
  *result_listener << "remainder " << arg % n;
  return false;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy(7)));
```

## Further Reading & Related Pages

- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md) — covers all built-in matchers.
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md) — guides on using mocks and expectations.
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) — recipes for advanced mocking and defining custom matchers.
- [Actions and Matchers in Practice](https://github.com/google/googletest/blob/main/guides/mocking-advanced-techniques/actions-and-matchers.md) — practical user guide.

---

For detailed function prototypes, macro usage, and implementation details, explore the `gmock/gmock-matchers.h` header and associated test files in the GoogleTest repository.

---

## Troubleshooting Common Issues

- **Matcher type mismatch:** Use `SafeMatcherCast<T>(m)` to adjust matcher types safely.
- **Unexpected match results:** Check for unintended implicit conversions; prefer explicit matchers like `Eq(value)`.
- **Uninteresting calls warnings/errors:** Use `NiceMock` to suppress or `StrictMock` to enforce.
- **Non-copyable arguments:** Wrap with `std::ref()` or use custom predicate matchers.

---

This reference equips you with all necessary tools to compose, combine, and customize argument matchers in GoogleMock, enhancing test expressiveness and reliability.
