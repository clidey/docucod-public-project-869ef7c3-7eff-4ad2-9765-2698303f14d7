---
title: "Configuring Actions and Behaviors"
description: "How to configure mock method behaviors with actions (e.g., returning values, invoking custom logic, throwing exceptions). Includes examples for ACTIONs, ACTION_TEMPLATE, and pre-built mock actions for custom test scenarios."
---

# Configuring Actions and Behaviors

This documentation explains how to configure mock method behaviors in GoogleMock using a variety of _actions_. Actions determine what a mocked method does when it is invoked—such as returning values, invoking custom logic, or throwing exceptions. This guide covers the usage of different actions including **ACTION**, **ACTION_TEMPLATE**, and pre-built mock actions for common test scenarios.

---

## Understanding Actions in GoogleMock

Actions in GoogleMock specify the behavior of mocked functions when called during tests. They allow you to simulate complex behaviors, side effects, and return values without providing full implementations.

Mock methods can be configured using several approaches:

- **Built-in Actions**: Use predefined actions like `Return()`, `SetArgPointee()`, `Throw()`, and `DoAll()` to compose complex behaviors.
- **Custom Actions**: Define custom behaviors with `ACTION` and `ACTION_TEMPLATE` macros that create callable functors.
- **Action Combinators**: Combine multiple actions sequentially or selectively operate on mock method arguments.

This flexibility empowers you to emulate real-world scenarios and edge cases effectively in your tests.

---

## Common Use Cases and Workflow

Imagine you are testing a class with dependency on an interface, and you want to simulate:

- Returning specific values when methods are called.
- Changing output arguments.
- Throwing exceptions to test error handling.
- Calling user-defined logic/lambdas on method invocations.

You configure these behaviors in your test setup using actions with `ON_CALL()` or `EXPECT_CALL()`. Actions can also be chained or parameterized to express complex behaviors succinctly.

### Workflow Example

```cpp
using ::testing::Return;
using ::testing::SetArgPointee;
using ::testing::DoAll;

class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), ());
  MOCK_METHOD(bool, FetchData, (int* out_data), ());
};

TEST(DatabaseTest, FetchDataReturnsExpected) {
  MockDatabase mock_db;

  // When Connect is called, return true.
  ON_CALL(mock_db, Connect).WillByDefault(Return(true));

  // When FetchData is called, set the argument pointed to by arg0 and return true.
  EXPECT_CALL(mock_db, FetchData)
      .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));

  int data;
  ASSERT_TRUE(mock_db.Connect("db://localhost"));
  ASSERT_TRUE(mock_db.FetchData(&data));
  ASSERT_EQ(data, 42);
}
```

---

## Using Built-in Actions

GoogleMock offers a broad range of built-in actions for common behaviors.

### Returning Values

- `Return()` — returns from a `void` mock function.
- `Return(value)` — returns a copy of `value`. Note: the value is converted at _expectation setup time_, not execution.
- `ReturnRef(variable)` — returns a reference to a variable.
- `ReturnPointee(pointer)` — returns the value pointed to by the pointer _at execution time_.
- `ReturnNew<T>(args...)` — returns a new instance of `T` constructed with `args` on each call.
- `ReturnRoundRobin({a1, ..., an})` — cycles through returning each value in the list sequentially.

### Side Effect Actions

- `Assign(&variable, value)` — assigns a value to a variable.
- `SetArgPointee<N>(value)` — assigns `value` to the variable pointed to by argument N.
- `SetArrayArgument<N>(first, last)` — copies range `[first, last)` into the array pointed to by argument N.
- `DeleteArg<N>()` — deletes the pointer argument at position N.
- `SaveArg<N>(pointer)` — saves the N-th argument to the provided pointer.
- `Throw(exception)` — throws the specified exception when the mock is called.

### Composite Actions

- `DoAll(a1, a2, ..., an)` — executes multiple actions sequentially per call, returning the result of the last action.
- `IgnoreResult(a)` — performs action `a` but discards its return value.
- `WithArg<N>(a)` — invokes action `a` with the N-th argument.
- `WithArgs<N1, N2, ..., Nk>(a)` — invokes action `a` with selected subset of arguments.
- `WithoutArgs(a)` — invokes action `a` with no arguments.
- `DoDefault()` — performs the default action defined by `ON_CALL()` or built-in default.

---

## Custom Actions Using ACTION and ACTION_TEMPLATE

If built-in actions do not fulfill your needs, GoogleMock allows defining your own custom actions via macros:

### ACTION Macro

Defines an action without parameters:

```cpp
ACTION(Name) {
  // Access mock function arguments as arg0, arg1, ...
  // Return value must be convertible to the mock method’s return type.
  return arg0 + 1;  // Example: returns argument 0 incremented
}

// Usage:
EXPECT_CALL(mock_object, Foo(_)).WillOnce(Name());
```

Inside the action body, arguments are accessible as `arg0`, `arg1` etc., representing the mock method arguments indexed 0-based.

### ACTION_P and ACTION_Pk Macros

Define parameterized actions with up to 10 parameters:

```cpp
ACTION_P(Name, param1) {
  return arg0 + param1;
}

ACTION_P2(Name2, param1, param2) {
  return arg0 * param1 + param2;
}

// Usage:
EXPECT_CALL(mock, Func(_)).WillOnce(Name(5));
EXPECT_CALL(mock, Func(_)).WillOnce(Name2(3, 4));
```

All arguments and parameters are inferred by the compiler to keep code terse.

### ACTION_TEMPLATE Macro

Defines template parameterized actions for cases requiring explicit template types:

```cpp
ACTION_TEMPLATE(MyAction,
                HAS_1_TEMPLATE_PARAMS(typename, T),
                AND_1_VALUE_PARAMS(param)) {
  // Use std::get<k>(args) to access mock method arguments
  *param = static_cast<T>(std::get<0>(args));
}

// Usage:
EXPECT_CALL(mock, Func(_)).WillOnce(MyAction<int>(&variable));
```

Here, `args` represents the tuple of all mock function arguments.

---

## Practical Tips & Best Practices

- **Use `ON_CALL` for Default Behaviors:** Set common default actions in your test fixture or mock constructor using `ON_CALL(...).WillByDefault(...)` to avoid over-constraining tests.
- **Reserve `EXPECT_CALL` for Calls You Intend to Verify:** Use `EXPECT_CALL` only where you want to assert a function is called (and how), combined optionally with `.WillOnce()` or `.WillRepeatedly()`.
- **Chain Actions Carefully:** When combining actions with `DoAll()`, ensure only the last action returns a value; preceding actions must return `void`.
- **Use `RetiresOnSaturation()` to Avoid Sticky Expectation Issues:** Applied to expectations that should become inactive once used, preventing unexpected call errors in repeated calls.
- **Invoke Lambdas/Functors for Dynamic Behavior:** Use lambda expressions or functor objects with `Invoke()` or custom actions for complex logic on mock invocations.
- **Wrap Temporary Values Appropriately:** When using `InvokeArgument<>`, wrap reference parameters in `std::ref()` to avoid copying and dangling references.
- **Choose between `Return()`, `ReturnRef()`, and `ReturnPointee()` Wisely:** Use `ReturnRef()` for returning references and `ReturnPointee()` to return the live pointed value at runtime.

---

## Examples

### Returning a Value

```cpp
EXPECT_CALL(mock_obj, GetId())
    .WillOnce(Return(100));
```

### Setting an Output Parameter

```cpp
EXPECT_CALL(mock_obj, FetchData(_))
    .WillOnce(SetArgPointee<0>(42));
```

### Performing Multiple Actions

```cpp
EXPECT_CALL(mock_obj, Process(_))
    .WillOnce(DoAll(SetArgPointee<0>(75), Return(true)));
```

### Throwing an Exception

```cpp
EXPECT_CALL(mock_obj, OpenFile(_))
    .WillOnce(Throw(std::runtime_error("File not found")));
```

### Defining a Custom Action

```cpp
ACTION(SquareArg) {
  return arg0 * arg0;
}

EXPECT_CALL(mock, Compute(_)).WillOnce(SquareArg());
```

### Using ACTION_TEMPLATE for a Parameterized Action

```cpp
ACTION_TEMPLATE(CopyArgTo,
                HAS_1_TEMPLATE_PARAMS(typename, k),
                AND_1_VALUE_PARAMS(dest)) {
  *dest = ::std::get<k>(args);
}

int saved_value;
EXPECT_CALL(mock, Func(_)).WillOnce(CopyArgTo<0>(&saved_value));
```

---

## Troubleshooting Common Pitfalls

- **Unexpected Result of Return():** `Return(value)` copies `value` at expectation setup, not at each call. For dynamic values, use lambdas or `ReturnPointee()`.
- **Reference Return Errors:** Use `ReturnRef()` for returning references. Using `Return()` with references may cause compiler errors.
- **Side Effects Not Happening:** When an action changes output arguments and returns a value, combine with `DoAll()` ensuring the return action is last.
- **Copy vs Move Only Types:** Custom actions or lambdas may be needed when mocking methods with move-only types.
- **Mock Method Not Called:** Verify expectations are set before the code under test calls the mock.

---

## Additional Resources

For further details on actions, see the comprehensive [Actions Reference](../reference/actions.md) and [gMock Cookbook](../gmock_cook_book.md). To understand setting expectations and matchers which control when and how actions are triggered, consult the [Specifying Expectations and Actions guide](../guides/mocking-and-behavior-verification/specifying-expectations-and-actions.mdx).

Explore concrete usage patterns and advanced behaviors in:
- [Using Functions and Lambdas as Actions](../gmock_cook_book.md#FunctionsAsActions)
- [Combining Actions with DoAll](../reference/actions.md#DoAll)
- [InvokeArgument for Callback Invocation](../reference/actions.md#InvokeArgument)

This page fits into the broader Mocking API reference alongside pages detailing [Defining Mocks](api-reference/mocking-apis/defining-mocks) and [Matchers and Verification](api-reference/mocking-apis/matchers-and-verification).

---

## See Also

- [gMock Cookbook](../gmock_cook_book.md) — practical recipes including action configuration.
- [Actions Reference](../reference/actions.md) — full built-in action list.
- [Mocking Reference - EXPECT_CALL and ON_CALL](../reference/mocking.md) — expectation setup.
- [Matchers Reference](../reference/matchers.md) — argument matching to control expectation triggers.

<Source url="https://github.com/google/googletest" branch="main" paths='[{"path": "googlemock/include/gmock/gmock-more-actions.h", "range": "1-238"}]' />