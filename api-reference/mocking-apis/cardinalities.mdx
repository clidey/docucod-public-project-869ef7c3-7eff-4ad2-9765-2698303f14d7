---
title: "Cardinalities and Call Expectations"
description: "Explains how to set and validate expected call counts for mocked methods, using GoogleMock’s Cardinality classes and helpers. Details flexible options for specifying allowed, required, or disallowed invocation patterns."
---

# Cardinalities and Call Expectations

GoogleMock’s cardinality system empowers you to precisely control and verify how many times a mock method is expected (or allowed) to be called during a test. This page explains how to set and validate these call counts using GoogleMock’s built-in Cardinality classes and helpers, providing flexible options to specify expected, allowed, or disallowed invocation patterns.

---

## Understanding Cardinalities

A **cardinality** defines the number of times a mock method may be called. Using cardinalities, you can express:

- That a method should not be called at all
- That a method should be called exactly _n_ times
- That a method should be called at least or at most _n_ times
- That the call count should fall within a range

Cardinalities give your tests clarity and precision without being brittle.

### Built-in Cardinalities

GoogleMock provides a set of factory functions returning immutable cardinality objects:

| Cardinality Function  | Meaning                                           |
|----------------------|---------------------------------------------------|
| `AnyNumber()`        | The method can be called any number of times.    |
| `AtLeast(n)`         | Called at least `n` times.                        |
| `AtMost(n)`          | Called at most `n` times.                         |
| `Between(m, n)`      | Called between `m` and `n` times (inclusive).   |
| `Exactly(n)` or `n`  | Called exactly `n` times.                         |

**Special cases:**

- `Exactly(0)` means the method should never be called.
- `Between(0, INT_MAX)` is equivalent to `AnyNumber()`.

### User-Defined Cardinalities

You can create custom cardinalities by implementing the `CardinalityInterface`:

```cpp
class CardinalityInterface {
 public:
  virtual ~CardinalityInterface() = default;

  virtual bool IsSatisfiedByCallCount(int call_count) const = 0;

  virtual bool IsSaturatedByCallCount(int call_count) const = 0;

  virtual void DescribeTo(std::ostream* os) const = 0;
};
```

Then use `MakeCardinality()` to create a Cardinality object from your implementation instance.

### How Cardinalities Work

- **IsSatisfiedByCallCount(int call_count):** Returns whether `call_count` satisfies the given cardinality.
- **IsSaturatedByCallCount(int call_count):** Returns whether reaching `call_count` saturates the expectation (i.e., no further calls allowed).
- **IsOverSaturatedByCallCount(int call_count):** Reports if the call count **exceeds** the allowed upper bound.

The framework verifies cardinalities at runtime, failing tests when cardinalities are violated.

---

## Using Cardinalities with EXPECT_CALL

You specify expected call counts in the `.Times()` clause of `EXPECT_CALL`:

```cpp
EXPECT_CALL(mock_object, Method(matchers))
    .Times(AtLeast(2))
    .WillOnce(Return(5))
    .WillRepeatedly(Return(10));
```

This expectation requires the method to be called at least twice; the first call returns 5, and all subsequent calls return 10.

### Omitted `.Times()` Clause

If omitted, GoogleMock infers the cardinality based on provided actions:

- No `WillOnce` or `WillRepeatedly` → `.Times(Exactly(1))`
- *n* `WillOnce` clauses but no `WillRepeatedly` → `.Times(Exactly(n))`
- *n* `WillOnce` clauses and one `WillRepeatedly` → `.Times(AtLeast(n))`

### Combining Multiple Expectations

GoogleMock applies the last matching expectation for a call. Earlier expectations can catch other cases or act as a fallback when combined with `.Times(AnyNumber())`. For example:

```cpp
EXPECT_CALL(mock, Foo(_))               // #1
    .Times(AnyNumber());
EXPECT_CALL(mock, Foo(7))                // #2
    .Times(2);
```

Here, calls to Foo(7) match #2 first (enforced to be called twice) before falling back to #1.

### Ensuring Calls Never Happen

You can disallow calls explicitly with `.Times(0)`, causing failures if the method is invoked:

```cpp
EXPECT_CALL(mock, DangerousMethod(_)).Times(0);
```

---

## Describing Cardinality Expectations

GoogleMock provides human-friendly descriptions of cardinalities and actual call counts, which appear in failure messages.

Example descriptions:

| Cardinality                 | Description                      |
|----------------------------|--------------------------------|
| `Exactly(1)`               | "called once"                  |
| `Exactly(3)`               | "called 3 times"               |
| `AtLeast(2)`               | "called at least twice"        |
| `AtMost(2)`                | "called at most twice"         |
| `Between(3, 5)`            | "called between 3 and 5 times"|
| `AnyNumber()`              | "called any number of times"  |
| `Exactly(0)`               | "never called"                 |

In error messages, GoogleMock reports:

- Expected call count description
- Actual call count description
- Whether the expectation is "satisfied", "over-saturated", or "unsatisfied"
- Whether the expectation is still "active" or "retired"

---

## Best Practices and Tips

- **Use `.Times()` thoughtfully:** Explicitly specify cardinalities when you want strict verification but rely on inference for simpler cases.

- **Remember expectation stickiness:** Expectations remain active after saturation unless `.RetiresOnSaturation()` is specified.

- **Avoid brittle tests:** Don't over-constrain call counts more than necessary.

- **Use sequences and `.After()` for call ordering:** Combine with cardinalities for complex interaction verification.

- **Leaking mocks:** If you leak mocks (never delete), verification does not happen. Use `Mock::AllowLeak()` if intentional.

- **Suppress uninteresting call warnings:** Use `NiceMock` or add a catch-all `EXPECT_CALL` with `AnyNumber()`.

---

## Code Examples

### Basic Cardinalities

```cpp
using ::testing::Exactly;
using ::testing::AtLeast;
using ::testing::AtMost;
using ::testing::Between;

EXPECT_CALL(mock, Function())
    .Times(Exactly(1));  // Should be called once

EXPECT_CALL(mock, Function())
    .Times(AtLeast(2));  // Called twice or more

EXPECT_CALL(mock, Function())
    .Times(Between(1, 3));  // Called 1 to 3 times

EXPECT_CALL(mock, Function())
    .Times(AtMost(5));  // Called 5 times or less
```

### Disallow Calls

```cpp
EXPECT_CALL(mock, DangerousOperation(_))
    .Times(0);  // Method should never be called.
```

### Using Cardinalities with Actions

```cpp
using ::testing::Return;
EXPECT_CALL(mock, GetValue())
    .Times(Exactly(3))
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillOnce(Return(30));

EXPECT_CALL(mock, GetValue())
    .WillRepeatedly(Return(0));  // For any additional calls
```

### Retiring Expectations When Saturated

```cpp
EXPECT_CALL(mock, Process(_))
    .Times(Exactly(2))
    .RetiresOnSaturation();

EXPECT_CALL(mock, Process(_))
    .Times(AnyNumber());  // Will be used after first expectation saturates
```

---

For a deeper dive into specifying behaviors and actions in conjunction with cardinalities, see [Actions](actions.md) and [EXPECT_CALL](mocking.md#EXPECT_CALL).

---

## Troubleshooting Cardinalities

- **Calls fewer than expected:** You will see an error detailing the expected cardinality and that the actual call count was lower than required.

- **Calls more than expected:** You will get an "over-saturated" error reporting that the method was called more times than allowed.

- **Unexpected calls:** Calls that don’t match any expectation trigger an error with detailed matching attempts.

- **Mixing `.Times()` with actions:** Make sure `.Times()` is consistent with the number of `WillOnce` and `WillRepeatedly` actions.

- **Incorrect use of `.RetiresOnSaturation()`:** This clause only applies to upper-bounded cardinalities. Use it to prevent "sticky" expectations causing failures.

---

## See Also

- [EXPECT_CALL Clause: Times](mocking.md#EXPECT_CALL.Times) — Details on integrating cardinalities in expectations
- [Cardinalities API](reference/mocking.md#Cardinalities) — Overview of cardinality functions
- [gMock Cookbook: Using Mocks](gmock_cook_book.md#SettingExpectations) — Practical examples and patterns
- [Actions API](actions.md) — Specify mock behaviors complementary to call expectations

---

<Info>
GoogleMock automatically verifies call counts on mock destruction unless `Mock::AllowLeak()` is used. Failures include human-readable messages describing call count mismatches using cardinality descriptions.
</Info>