---
title: "Matchers, Actions, and Customization"
description: "Catalogs default and custom matchers and actions available in GoogleMock, including techniques for combining, customizing, and injecting behavior into mock expectations."
---

# Matchers, Actions, and Customization

This page provides a detailed catalog of the matchers, actions, and customization techniques available in GoogleMock (gMock). These tools empower C++ developers to specify how mock objects behave, what arguments they expect, and how to verify those expectations, enabling robust and flexible interaction testing.

---

## 1. Introduction to gMock Matchers and Actions

GoogleMock is designed to test *interactions* between components by using **mock objects** with expectations set through _matchers_ and _actions_.

- **Matchers** describe what arguments a mock method is expected to receive.
- **Actions** define what happens when a mock method is called (e.g., what it should return, side effects, etc.).

This page catalogs standard/default matchers and actions and demonstrates how you can customize or combine them to tailor mock behavior precisely.


---

## 2. Matchers: Specifying Expected Arguments

Matchers help you describe the conditions that arguments should satisfy when mock methods are called.

### 2.1 Basic Matchers

- **Literal values** like `100` or `"abc"` implicitly create equality matchers.
- `_` matches any value (wildcard).
- `Eq(value)` explicitly matches equality.

Example:
```cpp
EXPECT_CALL(turtle, Forward(100));          // Matches argument equal to 100
EXPECT_CALL(turtle, GoTo(50, _));           // Matches x=50 and any y
EXPECT_CALL(turtle, GoTo);                   // Non-overloaded methods only; matches any call
```

### 2.2 Built-in Matchers for Common Conditions

- Relational: `Ge()`, `Gt()`, `Le()`, `Lt()`, `Ne()`
- Null pointers: `IsNull()`, `NotNull()`
- String Comparisons: `StrEq()`, `StrNe()`, `StartsWith()`, `EndsWith()`, `HasSubstr()`
- Container matchers: `ElementsAre()`, `ElementsAreArray()`, `UnorderedElementsAre()`, etc.

Example:
```cpp
EXPECT_CALL(turtle, Forward(Ge(100)));      // Argument >= 100
EXPECT_CALL(logger, Log(StrEq("error"))); // Exact string "error"
EXPECT_CALL(container, AddElements(ElementsAre(1, _, 3)));
```

### 2.3 Combining and Composing Matchers

- Use `AllOf()`, `AnyOf()`, and `Not()` to combine matchers logically.
- Match nested container elements.

Example:
```cpp
EXPECT_CALL(foo, Bar(AllOf(Gt(5), Ne(10))));  // arg > 5 && arg != 10
EXPECT_CALL(foo, Baz(Not(HasSubstr("bad"))));
```

### 2.4 Advanced Matchers

- **`Field()`** and **`Property()`**: Match based on fields or accessor methods of objects.

```cpp
EXPECT_CALL(foo, Process(Field(&Bar::x, Eq(5))));
EXPECT_CALL(bar, Handle(Property(&Baz::count, Ge(1))));
```

- **`Pointee(matcher)`**: Matches the value pointed to by a pointer argument.

```cpp
EXPECT_CALL(foo, SetValue(Pointee(Eq(42))));
```

- **Custom Matchers** can be defined using the `MATCHER` and `MATCHER_P*` macros or by implementing matcher classes.

### 2.5 Matchers for Overloaded Methods

- Use `Const()` to disambiguate const overloads.
- Use typed matchers like `TypedEq<T>` or explicit `Matcher<T>` casts for overload resolution.

```cpp
EXPECT_CALL(mock, GetBar())             // Non-const
EXPECT_CALL(Const(mock), GetBar())      // Const version
```

---

## 3. Actions: Defining Mock Method Behavior

Actions specify what a mock method does when called.

### 3.1 Return Values

- `Return(value)` returns a specific value.
- `ReturnRef(variable)` returns a reference.
- `ReturnPointee(ptr)` returns the value pointed to by `ptr` at invocation time.
- `ReturnNew<T>(args...)` returns a new object each invocation.
- `ReturnRoundRobin({v1, v2, ...})` cycles through return values.

### 3.2 Side Effects and Modifications

- `Assign(&var, value)` assigns `value` to a variable.
- `SetArgPointee<N>(value)` sets the value pointed to by the Nth argument.
- `SetArrayArgument<N>(first, last)` copies a range into an output array argument.
- `DeleteArg<N>()` deletes a pointer argument.

### 3.3 Combining Actions

- `DoAll(a1, a2, ..., an)` runs multiple actions; only last action's value is returned.
- `IgnoreResult(action)` ignores the return value of an action.

### 3.4 Invoking Callbacks or Other Functions

- `Invoke(f)` calls a free function, functor, or lambda with mock args.
- `Invoke(object_ptr, &Class::Method)` calls a method on an object.
- `InvokeWithoutArgs(f)` calls a function ignoring mock arguments.
- `InvokeArgument<N>(args...)` calls the Nth argument treating it as a callback.

### 3.5 Changing Behavior Over Calls

- Use `.WillOnce()` to specify actions for single calls.
- Use `.WillRepeatedly()` to specify default action after `WillOnce`s.
- Use `RetiresOnSaturation()` to retire expectations after their call count is met.

### 3.6 Returning Move-only and Complex Types

- Use lambdas or functors in `.WillOnce()` / `.WillRepeatedly()` to return `std::unique_ptr` or move-only types.

```cpp
EXPECT_CALL(mock, MakeBuzz(_))
    .WillRepeatedly([](StringPiece text) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

---

## 4. Expectations: Setting Up Mock Behavior

Expectations specify not only *what* happens but *how many times* and *in which order* mock methods should be called.

### 4.1 `EXPECT_CALL` Syntax

```cpp
EXPECT_CALL(mock_object, method_name(matchers...))
    .With(multi_arg_matcher)  // optional
    .Times(cardinality)       // optional
    .InSequence(sequences...) // optional
    .After(expectations...)   // optional
    .WillOnce(action)         // optional
    .WillRepeatedly(action)   // optional
    .RetiresOnSaturation();   // optional
```

### 4.2 Cardinalities

- `Times(0)`: method should not be called.
- `Times(AnyNumber())`: called any number of times.
- `Times(AtLeast(n))` and `Times(AtMost(n))` allow flexible bounds.
- Omission infers cardinality from actions.

### 4.3 Ordering Expectations

- Use `InSequence` or `Sequence` objects to enforce call order.
- Use `After()` to specify that calls happen after certain expectations.

### 4.4 Using `ON_CALL`

- Specifies default behavior of mock methods without imposing call count expectations.
- Use to define common behavior; use `EXPECT_CALL` when you want to verify calls.

### 4.5 Sticky Expectations and Multiple Matches

- Expectations are sticky by default and remain active after saturation.
- For expectations that retire automatically, use `RetiresOnSaturation()` or wrap them in sequences.
- The last matching expectation overrides earlier ones.

---

## 5. Customization Techniques

### 5.1 Defining Mock Classes

- Use `MOCK_METHOD(return_type, method_name, (args...), (qualifiers));` inside the `public` section.
- Qualifiers: `const`, `override`, `noexcept`, calling convention, reference qualifiers.
- Handle overloaded methods by defining mocks for each overload.
- Mocking non-virtual methods is possible but involves templates.

Example:
```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### 5.2 Using NiceMock, NaggyMock, and StrictMock

- **NaggyMock (default)** warns on uninteresting calls.
- **NiceMock** suppresses these warnings.
- **StrictMock** treats uninteresting calls as test failures.

Usage:
```cpp
NiceMock<MockTurtle> nice_turtle;
StrictMock<MockTurtle> strict_turtle;
```

### 5.3 Creating Custom Matchers

- Use `MATCHER`, `MATCHER_P`, ... macros to quickly define custom matchers.
- Implement the matcher interface classes for full control.

Example:
```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}
EXPECT_CALL(mock, Bar(IsDivisibleBy7()));
```

### 5.4 Creating Custom Actions

- Easily create actions using lambdas or functors with compatible signatures.
- For complex or polymorphic actions, implement `ActionInterface` or use `MakePolymorphicAction`.

Example:
```cpp
EXPECT_CALL(mock, Foo()).WillOnce([] { return 42; });
```

---

## 6. Best Practices and Tips

- Set expectations before the code under test calls the mock methods.
- Prefer `ON_CALL` for default behaviors and `EXPECT_CALL` for verifying interactions.
- Avoid over-specifying matchers or actions to keep tests maintainable.
- Use sequences to enforce exact call orders.
- Use `RetiresOnSaturation()` when expectations should deactivate automatically after usage.
- Use `ReturnPointee` or lambdas to return live data when values change dynamically.
- Prefer coding to interfaces to allow easy mocking.

---

## 7. Troubleshooting Common Pitfalls

- **Uninteresting Calls Warning**: Means a mock method was invoked without expectation; use `NiceMock` or add catch-all expectations if intended.
- **Unexpected Calls**: Occur when calls don't match any expectation; review your matchers and expectations.
- **Over-Specified Tests**: Too strict expectations lead to brittle tests; loosen matchers or cardinalities.
- **Order Violations**: Use `InSequence` and `After` clauses properly.
- **Mock Methods Not Called**: Verify that mocks are alive and expectations are set.

---

## 8. Example Code Snippets

### Defining a Mock Class
```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Setting Expectations With Matchers and Actions
```cpp
using ::testing::AtLeast;
using ::testing::_;
using ::testing::Return;

TEST(PaintTest, DrawCircle) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown())
      .Times(AtLeast(1));
  EXPECT_CALL(turtle, Forward(Ge(100)))
      .WillRepeatedly(Return());

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 50));
}
```

### Using Sequences for Ordered Calls
```cpp
{
  InSequence seq;
  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

### Returning Different Values Over Calls
```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));
```

### Delegating to a Fake Implementation
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Compute, (int n), (override));

  void DelegateToFake() {
    ON_CALL(*this, Compute)
        .WillByDefault([this](int n) { return fake_.Compute(n); });
  }

 private:
  FakeFoo fake_;
};
```

---

## 9. Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): A beginner-friendly introduction.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes and advanced usage.
- [Matchers Reference](reference/matchers.md): Complete list of built-in matchers.
- [Actions Reference](reference/actions.md): Comprehensive actions catalog.
- [Writing and Using Mocks](api-reference/mocking-apis/defining-mocks.md): Detailed guide and examples.

---

For further guidance, consult the GoogleTest documentation sections on [Writing and Organizing Tests](/api-reference/core-testing-apis/writing-tests) and [Assertions and Matchers](/api-reference/core-testing-apis/assertions) to integrate mocking smoothly in your test suites.
