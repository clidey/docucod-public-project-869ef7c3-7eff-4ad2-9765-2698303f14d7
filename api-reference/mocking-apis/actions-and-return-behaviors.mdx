---
title: "Actions & Return Behaviors"
description: "Reference for defining and applying actions—such as returning values, triggering exceptions, or invoking functions—in response to mock interactions. Includes user-defined action macros, advanced parameterization, and guidance for composing complex behaviors."
---

# Actions & Return Behaviors

GoogleMock allows you to precisely define what happens when a mocked method is called. This page provides a comprehensive reference on using **actions**—the behaviors your mock methods execute upon invocation—including returning values, throwing exceptions, invoking functions, and composing complex behaviors. Mastering actions empowers you to craft mocks that simulate realistic interactions and side effects, making your tests expressive and robust.

---

## Overview of Actions

An **action** in GoogleMock specifies what a mock function should do when called. While mocking primarily focuses on verifying calls and arguments, actions control the behavior seen by the code under test.

### Why Actions Matter

Imagine you mock a method that should return different values on each call, or one that modifies output parameters, or another that throws exceptions to test error handling. Actions let you encode all this behavior declaratively, ensuring your tests can mimic real object interactions faithfully.

---

## Returning Values and References

### `Return(value)`
Returns a specified value when a mock method is called.

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(42));
```

**Important:** The value is captured at expectation definition time, not at invocation. To get live values, see `ReturnRef` and `ReturnPointee` below.

---

### `ReturnRef(variable)`
Returns a reference to an existing variable.

```cpp
int x = 5;
EXPECT_CALL(mock, GetRef())
    .WillRepeatedly(ReturnRef(x));
```

Use this to return references safely. Trying to use `Return()` with references can cause compiler or runtime errors.

---

### `ReturnPointee(pointer)`
For mock methods returning by value, returns the value pointed to by a pointer, *evaluated at call time*.

```cpp
int x = 10;
EXPECT_CALL(mock, GetValue())
    .WillRepeatedly(ReturnPointee(&x));
x = 20;
// mock.GetValue() will return 20
```

Use this to always get the current value the pointer points to, useful for mocking methods that depend on external values.

---

### `ReturnRefOfCopy(value)`
Returns a reference to a copy of the given value. The copy’s lifetime lasts as long as the action.

```cpp
std::string s = "hello";
EXPECT_CALL(mock, GetString())
    .WillRepeatedly(ReturnRefOfCopy(s));
```

This is useful when the caller expects reference semantics, but you want to return a fresh copy each time.

---

### `ReturnNew<T>(args...)`
Creates and returns a new heap-allocated object of type `T` on each mock call.

```cpp
EXPECT_CALL(mock, CreateObject())
    .WillRepeatedly(ReturnNew<MyClass>(arg1, arg2));
```

Each call returns a distinct dynamically allocated object.

---

### `ReturnNull()`
Returns a null pointer.

---

### `ReturnRoundRobin({a1, a2, ..., an})`
Cycles through given return values in order, restarting when the list ends.

```cpp
EXPECT_CALL(mock, GetNumber())
    .WillRepeatedly(ReturnRoundRobin({3, 1, 4}));
```

Returns 3 on first call, 1 on second, 4 on third, then 3 again, and so on.

---

## Defining Side Effects and Output Arguments

Mock methods can also modify caller-provided arguments or global state.

### `SetArgPointee<N>(value)`
Sets the value pointed to by the `N`th argument (0-based) to the specified value.

```cpp
EXPECT_CALL(mock, Process(_))
    .WillOnce(SetArgPointee<0>(42));
```

This is useful for mocking output parameters.

---

### `SetArrayArgument<N>(first, last)`
Copies a range of values into the array or iterator pointed to by the `N`th argument.

```cpp
int values[3] = {1, 2, 3};
EXPECT_CALL(mock, FillBuffer(_))
    .WillOnce(SetArrayArgument<0>(values, values + 3));
```

---

### `DeleteArg<N>()`
Deletes the pointer held by the `N`th argument.

---

### `Assign(&variable, value)`
Assigns a new value to a user variable.

```cpp
int flag = 0;
EXPECT_CALL(mock, SomeMethod())
    .WillOnce(Assign(&flag, 1));
```

---

### `SaveArg<N>(pointer)`
Saves a copy of the N-th argument to the memory pointed to by `pointer`.

### `SaveArgByMove<N>(pointer)`
Moves the N-th argument into the memory pointed to by `pointer`.

### `SaveArgPointee<N>(pointer)`
Saves the value pointed to by the N-th argument.

Use these to capture arguments for later inspection in your tests.

---

## Throwing Exceptions

### `Throw(exception)`
Throws a copy of the given exception object when the mock method is called.

```cpp
EXPECT_CALL(mock, DoThing())
    .WillOnce(Throw(std::runtime_error("error occurred")));
```

Use this to simulate error conditions.

---

## Using Functions, Methods, Functors, or Lambdas as Actions

You can specify any callable matching the signature of the mocked method.

### Simple Function or Lambda

```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce([](int x) { return x * 2; });
```

---

### `Invoke(callable)`
Calls a free function or functor with the mock arguments.

```cpp
int Multiply(int x, int y) { return x * y; }
EXPECT_CALL(mock, Compute(_, _))
    .WillOnce(Invoke(Multiply));
```

---

### `Invoke(object_pointer, &Class::Method)`
Invokes a method on a provided object.

```cpp
struct Helper { int Add(int x, int y) { return x + y; } } helper;
EXPECT_CALL(mock, Compute(_, _))
    .WillOnce(Invoke(&helper, &Helper::Add));
```

---

### `InvokeWithoutArgs(callable)`
Invokes a callable with no arguments, ignoring the mock arguments.

```cpp
bool TriggerEvent() { ... }
EXPECT_CALL(mock, Notify())
    .WillOnce(InvokeWithoutArgs(TriggerEvent));
```

---

### `InvokeArgument<N>(args...)`
Invokes the N-th argument (which must be a callable) with supplied arguments.

```cpp
EXPECT_CALL(mock, RegisterCallback(_))
    .WillOnce(InvokeArgument<0>(42));
```

This calls the callback passed as the first argument with the value 42.

---

## Combining Multiple Actions

### `DoAll(a1, a2, ..., an)`
Executes all actions in sequence. Returns the value of the last action.

```cpp
EXPECT_CALL(mock, Process(_))
    .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));
```

Use it to combine side effects and return values.

### `IgnoreResult(action)`
Ignores the return value of an action, allowing it to be used in a mock method with `void` return type or in `DoAll`.

```cpp
EXPECT_CALL(mock, DoSomething())
    .WillOnce(IgnoreResult(Return(42)));
```

---

### `WithArg<N>(action)` and `WithArgs<N1, N2, ..., Nk>(action)`
Passes selected arguments to an inner action, adapting argument lists.

```cpp
bool Check(int x, int y) { return x < y; }
EXPECT_CALL(mock, Foo(_, _))
    .WillOnce(WithArgs<0,1>(Invoke(Check)));
```

This calls `Check` with the mock arguments 0 and 1.

---

### `WithoutArgs(action)`
Calls an inner action without any arguments.

---

## Defining Custom Actions

If built-in actions do not suffice, you can write your own:

### Using Lambdas or Functors

```cpp
struct MultiplyBy {
  int factor;
  int operator()(int x) { return x * factor; }
};
EXPECT_CALL(mock, Compute(_))
    .WillOnce(MultiplyBy{3});
```

### Using ACTION Macros

Older style uses `ACTION()` macros to define actions outside class context.

```cpp
ACTION(IncrementArg1) { return ++(*arg1); }
EXPECT_CALL(mock, Modify(_))
    .WillOnce(IncrementArg1());
```

Refer to GoogleMock's [Actions Reference](../gmock_for_dummies.md#actions-what-should-it-do) for full details.

---

## Advanced Parameterization

You can write parameterized actions with `ACTION_P` and friends:

```cpp
ACTION_P(Add, n) { return arg0 + n; }
EXPECT_CALL(mock, Compute(_))
    .WillOnce(Add(5));
```

Or create template-based custom actions for maximum flexibility.

---

## Best Practices & Tips

- **Prefer `ON_CALL` for default behavior** and `EXPECT_CALL` for expectations on calls.
- **Use `WillOnce` for specific call sequences** and `WillRepeatedly` for general behaviors.
- **Avoid over-specifying expectations** to keep tests maintainable and robust.
- **Use `RetiresOnSaturation()`** to deactivate expectations after their expected number of calls.
- **Use actions for realistic side effects**, such as modifying output parameters or throwing exceptions.
- **Capture call arguments with `SaveArg` actions** for detailed verification.
- **Use callables or lambdas as actions** to write expressive in-place behaviors instead of relying only on built-in actions.

---

## Troubleshooting Common Pitfalls

- Actions passed to `WillOnce()` are evaluated once at expectation definition – to return dynamic values, use lambdas or `ReturnPointee()`.
- Returning references with `Return()` causes undefined behavior; always use `ReturnRef()`.
- Sharing action objects with internal state may cause unexpected behavior; consider constructing new action objects for independent expectations.
- When combining actions like `SetArgPointee` and `Return`, use `DoAll()` to chain them.

---

## Related Documentation

- [Mock Object Definition](../mocking-apis/mock-object-definition)
- [Setting Expectations & Call Strictness](../mocking-apis/expectations-and-strictness)
- [Matchers Reference](../matchers-and-advanced-apis/built-in-matchers-reference)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Actions Reference](../reference/actions.md)

---

By mastering actions and return behaviors, you significantly enhance the power of your mocks, enabling you to write tests that precisely simulate complex scenarios and validate real-world interactions.


<Accordion title="Quick Example: Using Actions">
```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Calculate, (int a, int b), (override));
};

TEST(FooTest, ReturnsDynamicValue) {
  MockFoo mock;

  int counter = 0;
  EXPECT_CALL(mock, Calculate(_, _))
      .WillRepeatedly([&counter](int, int) {
        return ++counter;
      });

  EXPECT_EQ(mock.Calculate(1, 2), 1);
  EXPECT_EQ(mock.Calculate(3, 4), 2);
}
```
</Accordion>

<Note>
This page focuses on the *user-facing* usage of actions. Internal implementation details and API internals are not covered here.
</Note>
