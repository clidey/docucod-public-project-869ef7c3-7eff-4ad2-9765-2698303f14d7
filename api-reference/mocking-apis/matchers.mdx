---
title: "Matchers"
description: "Comprehensive overview of built-in and extensible matchers for verifying mock function arguments. Covers matcher composition, polymorphic vs. monomorphic matchers, and custom matcher creation patterns."
---

# Matchers

Comprehensive overview of built-in and extensible matchers for verifying mock function arguments in GoogleMock. This page explains matcher composition, polymorphic versus monomorphic matchers, and patterns for creating custom matchers.

---

## What Are Matchers?

Matchers are predicates used in expectations and assertions to specify the property that a function argument should satisfy. Rather than requiring exact values, matchers enable you to express flexible, readable constraints on the values passed to your mock methods.

This section guides you through the essential use and creation of matchers, helping you verify mock function arguments precisely and expressively.

---

## Built-in Matchers

GoogleMock provides a rich collection of built-in matchers, including:

- Wildcard matcher `_`: Matches anything.
- Equality matchers like `Eq(value)`, or simply the value itself (e.g., `5`).
- Comparison matchers: `Lt()`, `Le()`, `Gt()`, `Ge()`, `Ne()` for less than, less or equal, greater than, greater or equal, not equal.
- Pointer matchers: `IsNull()`, `NotNull()`, `Ref(variable)`.
- String matchers: `StrEq()`, `StrNe()`, `StartsWith()`, `EndsWith()`, `HasSubstr()` (works with C-style strings and STL string types).
- Container matchers: `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, `SizeIs()`.
- Tuple and pair matchers: `Pair()`, `Key()`, `FieldsAre()`.
- Floating point matchers: `FloatEq()`, `DoubleEq()`, handling near-equality and NaN.

### Example

Use the wildcard matcher to allow any argument:

```cpp
using ::testing::_;
EXPECT_CALL(mock_obj, Foo(_)); // Accepts any single argument
```

Specify an argument greater than or equal to 5:

```cpp
using ::testing::Ge;
EXPECT_CALL(mock_obj, Foo(Ge(5)));
```

Check that a pointer argument is not null:

```cpp
using ::testing::NotNull;
EXPECT_CALL(mock_obj, ProcessData(NotNull()));
```

Match a string argument starting with "Error":

```cpp
using ::testing::StartsWith;
EXPECT_CALL(mock_obj, LogMessage(StartsWith("Error")));
```

Validate a container argument with specific elements:

```cpp
using ::testing::ElementsAre;
EXPECT_CALL(mock_obj, ProcessList(ElementsAre(1, 2, 3)));
```

---

## Combining Matchers

Matchers can be composed using logical combinators:

- `AllOf(m1, m2, ...)`: Matches if all sub-matchers match.
- `AnyOf(m1, m2, ...)`: Matches if any sub-matcher matches.
- `Not(m)`: Matches if the sub-matcher does not match.

Example:

```cpp
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Ne;
EXPECT_CALL(mock_obj, Foo(AllOf(Gt(5), Ne(10))));
```

This expects `Foo` to be called with an argument greater than 5 but not equal to 10.

---

## Polymorphic vs. Monomorphic Matchers

### Monomorphic Matchers

- Matchers of type `Matcher<T>` that match values of exactly one specific type `T`.
- Match and describe values of said type.

Example: `Matcher<int>` matches only values of type `int`.

### Polymorphic Matchers

- Matchers that can match values of multiple types and can be converted to `Matcher<T>` as needed.
- Implemented typically as matcher factories returning polymorphic wrappers.

Example: `Eq(5)` can match `int`, `long`, `unsigned`, `double`, etc.

Most built-in matchers are polymorphic to allow flexible usage without specifying exact types.

---

## Casting Matchers

GoogleMock enforces matcher type safety, but provides utility functions:

- `SafeMatcherCast<T>(matcher)`: Casts `matcher` to a matcher of type `T` safely, ensuring implicit convertibility without losing data.
- `MatcherCast<T>(matcher)`: Casts `matcher` to `Matcher<T>` less restrictively but potentially unsafely; use with caution.

Example:

```cpp
using ::testing::SafeMatcherCast;
Matcher<Base*> base_matcher = ...;
EXPECT_CALL(mock_obj, Foo(SafeMatcherCast<Derived*>(base_matcher)));
```

---

## Using Matchers to Match Complex Argument Patterns

### Multi-argument Matchers and `.With()` clause

You can specify a matcher that matches *all* arguments as a tuple using the `With()` clause on `EXPECT_CALL`:

```cpp
using ::testing::_;
using ::testing::Lt;
EXPECT_CALL(foo, InRange(_, _)).With(Lt());
```

Here `With(Lt())` indicates the first argument must be less than the second argument.

You can also select specific argument positions with `Args<idx...>(matcher)`, e.g.,

```cpp
EXPECT_CALL(foo, Blah).With(AllOf(Args<0,1>(Lt()), Args<1,2>(Lt())));
```

This enforces `arg0 < arg1 < arg2`.

### Matching Members and Properties of Objects

To match parts of an argument object, use:

- `Field(&Class::member, matcher)`: Matches if the member variable of an object satisfies the matcher.
- `Property(&Class::getter, matcher)`: Matches if the return value of the getter method satisfies the matcher.

Example:

```cpp
EXPECT_CALL(mock, Foo(Field(&Foo::number, Ge(3))));
```

Matches a `Foo` object whose `number` member is at least 3.

### Matching Value Pointed to by Pointer

Use `Pointee(matcher)` to match a pointer argument whose pointee value matches the matcher.

```cpp
EXPECT_CALL(mock, Foo(Pointee(Ge(3))));
```

Matches if pointer points to a value greater or equal to 3.

Nested `Pointee()` can match pointer to pointer, e.g., `Pointee(Pointee(Lt(3)))`.

---

## Defining Custom Matchers

### Using MATCHER Macros

The simplest way to create a custom matcher is with the `MATCHER` family:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock_obj, Foo(IsDivisibleBy7()));
```

You can add detailed failure messages:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "the remainder is " << (arg % 7);
  return false;
}
```

Parameterizing the matcher:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}
EXPECT_THAT(x, HasAbsoluteValue(10));
```

You can define multi-parameter matchers using `MATCHER_P2`, `MATCHER_P3`, etc.

### Defining Matcher Classes

For larger or widely reused matchers, define a matcher class implementing the interface:

- `bool MatchAndExplain(const T& value, std::ostream* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Example for `int` divisible by 7:

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;
  bool MatchAndExplain(int n, std::ostream* os) const {
    bool result = (n % 7) == 0;
    if (!result && os != nullptr) {
      *os << "the remainder is " << (n % 7);
    }
    return result;
  }
  void DescribeTo(std::ostream* os) const { *os << "is divisible by 7"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is not divisible by 7"; }
};

Matcher<int> DivisibleBy7() {
  return DivisibleBy7Matcher();
}
```

### Polymorphic Matchers

To support multiple types, make `MatchAndExplain` a template method:

```cpp
class NotNullMatcher {
 public:
  using is_gtest_matcher = void;
  template <typename T>
  bool MatchAndExplain(T* p, std::ostream*) const {
    return p != nullptr;
  }
  void DescribeTo(std::ostream* os) const { *os << "is not NULL"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }
};

NotNullMatcher NotNull() { return NotNullMatcher(); }
```

---

## Matcher Usage Tips

- Matchers must be *pure functions* without side effects since gMock may call them multiple times, in any order.
- You can store complex matchers in variables for reuse, improving performance and clarity.
- Use parameterized matchers to create more expressive and informative assertions.
- Combine matchers robustly to avoid brittle tests by specifying only what truly matters.

---

## Summary

Matchers in GoogleMock let you specify expectations on function arguments with flexible, readable constraints. From simple equality to complex nested properties, and from built-in polymorphic matchers to powerful custom matcher definitions, they provide the expressive foundation to verify interactions in your tests.

When defining custom matchers, prefer `MATCHER*` macros for simplicity or implement the matcher interface directly for explicit control and polymorphism.

Finally, use matcher combinators and carefully choose matchers to write maintainable, robust tests that capture your intent precisely.

---

## Related Documentation

- [gMock Cookbook - Using Matchers](https://google.github.io/googletest/gmock_cook_book.html#Using_Matchers)
- [Matchers Reference](reference/matchers.md) (full built-in matchers)
- [Mocking Reference](reference/mocking.md#EXPECT_CALL) (using matchers in expectations)
- [Writing Custom Matchers Guide](guides/advanced-testing-patterns/custom-assertions-matchers.md)
- [Using Matchers in Assertions](reference/assertions.md#EXPECT_THAT)
- [gMock for Dummies - Expectations and Matchers](https://google.github.io/googletest/gmock_for_dummies.html#Match)

---

## Troubleshooting & Best Practices

- Always set expectations before calling mock methods.
- Avoid overly restrictive matchers; use wildcard `_` when argument value doesnâ€™t matter.
- For overloaded methods, specify matchers carefully to disambiguate.
- Suppress uninteresting call warnings with `NiceMock` if they clutter output.
- Use `SafeMatcherCast` to resolve type mismatches safely.

---

This page empowers you to leverage GoogleMock's matcher framework fully, bridging the gap between test intent and robust, maintainable test code.

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-478"},{"path": "docs/gmock_cook_book.md", "range": "431-988"},{"path": "googlemock/test/gmock-matchers_test.h", "range": "50-678"}]}/>
