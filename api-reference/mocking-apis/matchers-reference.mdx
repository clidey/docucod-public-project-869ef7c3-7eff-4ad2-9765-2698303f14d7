---
title: "Matchers Reference"
description: "Comprehensive documentation of built-in matchers for argument verification, plus extension mechanisms for custom matchers. Includes usage patterns for containers, strings, arithmetic, and logical matchers."
---

# Matchers Reference

GoogleMock provides a rich collection of built-in **matchers** that let you specify expectations on mocked function arguments with great precision and flexibility. This reference covers the variety of built-in matchers, including those for **primitive types**, **strings**, **containers**, **arithmetic**, **logical operators**, **tuples**, and how to **extend** the matcher library with your own custom matchers.

---

## What Are Matchers?

Matchers are predicates used to verify that an argument passed to a mock method meets specific conditions. Instead of hardcoding exact values, matchers enable expressive, composable, and reusable criteria. When used with `EXPECT_CALL` or `ON_CALL`, matchers determine which mock expectation applies based on the arguments.

For example:

```cpp
using ::testing::_;            // Wildcard matcher
using ::testing::Gt;           // Greater than
using ::testing::StartsWith;   // String matcher

EXPECT_CALL(foo, Bar(Gt(5)));           // Argument must be > 5
EXPECT_CALL(foo, Baz(StartsWith("abc")));  // Argument must start with "abc"
EXPECT_CALL(foo, DoSomething(_));       // Argument can be anything
```

Matchers allow you to craft tests that are *just right* — neither too brittle nor too loose.

---

## Categories of Built-in Matchers

### 1. Primitive and Arithmetic Matchers

- `Eq(value)` — Matches if argument == value.
- `Ne(value)` — Matches if argument != value.
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` — Less than, less or equal, greater than, greater or equal.
- `FloatingEq(value)` — Matches floating-point values approximately equal within a margin.
- `NanSensitiveFloatEq(value)` — Floating point matcher treating NaNs as equal.

**Example:**

```cpp
EXPECT_CALL(mock, Func(Eq(10)));        // argument == 10
EXPECT_CALL(mock, Func(Gt(0)));         // argument > 0
EXPECT_CALL(mock, Func(FloatingEq(3.14))); // approx match double
```

---

### 2. String Matchers

- `StrEq(str)`, `StrNe(str)` — Matches if string == or != str (case-sensitive).
- `StrCaseEq(str)`, `StrCaseNe(str)` — Matches ignoring case.
- `StartsWith(prefix)`, `EndsWith(suffix)` — Matches strings with specified prefix or suffix.
- `HasSubstr(substring)` — Matches strings containing the substring.

**Example:**

```cpp
EXPECT_CALL(mock, Foo(StrEq("hello")));           // exact match
EXPECT_CALL(mock, Foo(StrCaseEq("HELLO")));       // case-insensitive
EXPECT_CALL(mock, Foo(StartsWith("Test")));       // starts with "Test"
EXPECT_CALL(mock, Foo(HasSubstr("middle")));      // contains "middle"
```

---

### 3. Container Matchers

Matchers operating on STL Containers or array-like objects:

- `ElementsAre(m1, m2, ..., mn)` — Matches container with elements matching matchers `m1` to `mn` in order.
- `ElementsAreArray(container_or_array)` — Like `ElementsAre()`, but takes a container or array.
- `UnorderedElementsAre(m1, m2, ..., mn)` — Matches container with elements matching `m1` to `mn` in *any* order.
- `UnorderedElementsAreArray(container_or_array)` — Like `UnorderedElementsAre()`, but for containers or arrays.
- `Contains(element_matcher)` — Matches if container contains an element matching `element_matcher`.
- `Each(m)` — Matches if *all* elements match matcher `m`.
- `SizeIs(count_matcher)` — Matches container size.
- `WhenSorted(m)` — Match after sorting the container (ascending).
- `WhenSortedBy(comparator, m)` — Match after sorting with custom comparator.
- `Pointwise(tuple_matcher, rhs_container)` — Matches containers pairwise with another container.

**Example:**

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _)));     // 3 elems; first==1, second>0, third(any)
EXPECT_CALL(mock, Bar(Contains(StartsWith("foo")))); // At least one element starts with "foo"
EXPECT_CALL(mock, Baz(SizeIs(5)));                     // Container has size 5
EXPECT_CALL(mock, Qux(WhenSorted(ElementsAre(1,2,3)))); // Container sorted ascending equals {1,2,3}
```

---

### 4. Tuple and Pair Matchers

- `Pair(m1, m2)` — Matches a `std::pair`, whose `.first` satisfies `m1` and `.second` satisfies `m2`.
- `Key(matcher)` — Matches a pair’s key, like `.first` in a map, against matcher.
- `Property(&Class::Method, matcher)` — Matches if the method’s return value matches.
- `Field(&Class::field, matcher)` — Matches if a member variable’s value matches.
- `Args<N1, ...>(matcher)` — Matches the tuple composed of selected argument indices.
  - `AllArgs(matcher)` — Matches all arguments as a tuple, synonym for `Args<...>` with all indices.

**Example:**

```cpp
// Matching std::pair<int, std::string>
EXPECT_CALL(mock, Foo(Pair(Gt(10), StartsWith("name"))));

// Matching std::map<int, std::string> elements
EXPECT_THAT(my_map, Contains(Pair(Eq(5), StrEq("five"))));

// Matching a class Foo with int member `value`.
EXPECT_CALL(mock, Bar(Field(&Foo::value, Eq(7))));

// Matching one argument in the method (e.g. second argument).
EXPECT_CALL(mock, Func).With(Args<1>(Gt(10)));
```

---

### 5. Logical Combinators

- `AllOf(m1, m2, ...)` — Matches if *all* matchers succeed.
- `AnyOf(m1, m2, ...)` — Matches if *any* matcher succeeds.
- `Not(m)` — Matches if matcher `m` fails.
- `Conditional(cond, m1, m2)` — Matches either `m1` or `m2` based on condition.

**Example:**

```cpp
EXPECT_CALL(mock, Foo(AllOf(Gt(5), Lt(10))));   // 5 < arg < 10
EXPECT_CALL(mock, Foo(AnyOf(Eq(0), Eq(5), Eq(10)))); // arg is 0 or 5 or 10
EXPECT_CALL(mock, Foo(Not(Eq(0))));               // arg is not zero
```

---

### 6. Pointer Matchers

- `IsNull()` — Matches any null raw or smart pointer.
- `NotNull()` — Matches any non-null raw or smart pointer.
- `Pointee(matcher)` — Matches a pointer pointing to a value matching `matcher`.
- `Pointer(matcher)` — Matches if raw pointer or smart pointer itself matches `matcher`.

**Example:**

```cpp
EXPECT_CALL(mock, Foo(Pointee(Gt(0))));  // Points to a value > 0
EXPECT_CALL(mock, Bar(IsNull()));          // Null pointer
EXPECT_CALL(mock, Baz(NotNull()));         // Non-null pointer
```

---

### 7. Optional and Variant Matchers

- `Optional(m)` — Matches if optional is engaged and matches the inner matcher.
- `VariantWith<T>(m)` — Matches a value of `std::variant` type T with matcher `m`.
- `AnyWith<T>(m)` — Matches `absl::any` holding type T matching `m`.

---

## Using Matchers in GoogleMock

Matchers are typically used in `EXPECT_CALL` and `ON_CALL` to specify argument verification:

```cpp
EXPECT_CALL(mock_object, Method(matcher1, matcher2));
ON_CALL(mock_object, Method(matcher1, matcher2)).WillByDefault(Return(...));
```

- Wildcard matcher `_` matches any value.
- For overloaded methods, specify argument matchers explicitly to avoid ambiguity.
- You can combine matchers to express complex argument conditions.

---

## Extending the Matcher Set

GoogleMock supports writing custom matchers to handle specialized cases not covered by built-in matchers.

### Writing Custom Matchers Quickly

Use the `MATCHER` family of macros for convenient matcher creation:

```cpp
MATCHER(IsDivisibleBy3, "is divisible by 3") {
  return (arg % 3) == 0;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy3()));
```

Parametered matchers use `MATCHER_P` or `MATCHER_P2`, etc.:

```cpp
MATCHER_P(IsSumOf, other, "is sum equal to") {
  return arg + other == expected_sum;
}
EXPECT_CALL(mock, Bar(IsSumOf(5)));
```

### Writing Matcher Classes

For more control and better compile-time type safety, implement the matcher interface manually, providing:

- `bool MatchAndExplain(const T& value, std::ostream* listener) const` — match logic
- `void DescribeTo(std::ostream* os) const` — description
- `void DescribeNegationTo(std::ostream* os) const` — negation description

Then define a factory function returning `testing::Matcher<T>` using this class.

---

## Practical Tips for Matchers

- Matchers must be **pure functions**, they shouldn't have side effects.
- Matchers can be polymorphic and adapt based on the argument type.
- Combine matchers using logical combinators to express complex expectations.
- For ordered containers, use `ElementsAre`, for unordered, use `UnorderedElementsAre`.
- Use `With(Args<...>(m))` to match multiple arguments as a grouped tuple.

---

## Common Usage Patterns

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::HasSubstr;
using ::testing::ElementsAre;
using ::testing::Not;

// Match any call to Find with first argument "key" and second argument ignored
EXPECT_CALL(mock, Find(Eq("key"), _));

// Match string arguments starting with "Error"
EXPECT_CALL(mock, Log(HasSubstr("Error")));

// Match a container argument matching a vector with elements 1,2,3
EXPECT_CALL(mock, ProcessData(ElementsAre(1, 2, 3)));

// Combine matchers: argument is not null and points to value > 0
EXPECT_CALL(mock, Foo(NotNull(), Pointee(Gt(0))));
```

---

## Troubleshooting Matchers

- **Ambiguous calls**: For overloaded methods, always specify argument matchers.
- **Unexpected matching**: Use `--gmock_verbose=info` to log matcher matching.
- **Match failures**: Verify matcher types correspond exactly to argument types.
- **Non-pure matchers fault**: Don't produce side effects inside matchers.

---

## References & Further Reading

- [GoogleMock Cookbook - Matchers Section](https://google.github.io/googletest/gmock_cook_book.html#UsingMatchers)
- [Mocking Reference](reference/mocking.md)
- [gMock Matchers Header with Implementation](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-matchers.h)
- [Writing New Matchers Quickly](guides/mocking-and-advanced-techniques/advanced-mocking-patterns.md#CustomMatchers)

---

For comprehensive usage and detailed examples, refer to the [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and the [Matchers API Reference](reference/matchers.md).


<AccordionGroup title="Built-in Matchers Categories">
<Accordion title="Primitive and Arithmetic Matchers">
- Eq(), Ne(), Lt(), Le(), Gt(), Ge()
- FloatingEq(), NanSensitiveFloatEq()
- Examples:

```cpp
EXPECT_CALL(mock, Method(Eq(5)));
EXPECT_CALL(mock, Method(Gt(0)));
```
</Accordion>
<Accordion title="String Matchers">
- StrEq(), StrCaseEq(), StartsWith(), EndsWith(), HasSubstr()
- Examples:

```cpp
EXPECT_CALL(mock, Foo(StrEq("test")));
EXPECT_CALL(mock, Bar(StartsWith("prefix")));
```
</Accordion>
<Accordion title="Container Matchers">
- ElementsAre(), UnorderedElementsAre(), Contains(), Each(), SizeIs()
- Pointwise(), WhenSorted(), WhenSortedBy()
- Examples:

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, _, 3)));
EXPECT_CALL(mock, Foo(Contains(Gt(5))));
```
</Accordion>
<Accordion title="Tuple and Pair Matchers">
- Pair(), Key(), Field(), Property(), Args<>
- Examples:

```cpp
EXPECT_CALL(mock, Foo(Pair(Eq(1), StartsWith("hi"))));
EXPECT_CALL(mock, Bar(Field(&MyStruct::value, Gt(5))));
```
</Accordion>
<Accordion title="Logical Combinators">
- AllOf(), AnyOf(), Not(), Conditional()
- Enables combination of matchers
- Example: `AllOf(Gt(5), Lt(10))` matches values in (5, 10)
</Accordion>
<Accordion title="Pointer Matchers">
- IsNull(), NotNull(), Pointee(), Pointer()
- Works with raw and smart pointers
</Accordion>
</AccordionGroup>

<Tip>
Leverage the expressive matcher library to write precise and maintainable mock expectations, avoiding brittle tests. Combine matchers and use container matchers for complex data structures.
</Tip>

<Note>
When mocking overloaded methods, always specify argument matchers to resolve ambiguity.
</Note>

<Warning>
Avoid side effects inside custom matchers as matchers must be purely functional.
</Warning>

<Check>
Use the `--gmock_verbose=info` flag for debugging matcher evaluation and matching behavior.
</Check>

---

### Summary of Commonly Used Matchers

| Matcher               | Description                                      |
|-----------------------|------------------------------------------------|
| `_`                  | Matches anything                                |
| `Eq(val)`             | Matches equality (`== val`)                      |
| `Ne(val)`             | Not equal                                       |
| `Lt(val)`, `Gt(val)`  | Less than, greater than                          |
| `StrEq(str)`          | String equal, case-sensitive                     |
| `StartsWith(prefix)`  | String that starts with `prefix`                 |
| `Contains(substring)` | String contains `substring`                      |
| `ElementsAre()`       | Container with ordered elements matching matchers|
| `UnorderedElementsAre()` | Container with elements matching matchers in any order |
| `Pointee(matcher)`     | Pointer value matches matcher                    |


---

### Example: Using Matchers in a Mock

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(void, Process, (const std::vector<int>& data), ());
};

TEST(FooTest, ProcessVector) {
  MockFoo mock;

  EXPECT_CALL(mock, Process(::testing::ElementsAre(1, 2, 3)));

  std::vector<int> input = {1, 2, 3};
  mock.Process(input);
}
```

With the above, the call to `Process` must be with a vector containing exactly 1, 2, and 3 in this order.


---

For more in-depth knowledge and practical examples, consult:
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#UsingMatchers)
- [Matchers Reference](reference/matchers.md)
- [Mocking Reference](reference/mocking.md)
- [Matchers Header Source](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-matchers.h)
