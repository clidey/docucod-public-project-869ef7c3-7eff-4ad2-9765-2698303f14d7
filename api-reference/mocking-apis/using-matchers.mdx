---
title: "Using and Composing Matchers"
description: "Exhaustive reference for available matchers and matcher composition techniques, including arguments matching, custom matchers, and advanced matchers for containers, arithmetic, and custom logic. Shows how to leverage core and extended matcher sets."
---

# Using and Composing Matchers

An exhaustive reference for available matchers and matcher composition techniques in GoogleMock, including arguments matching, custom matchers, and advanced matchers for containers, arithmetic, and custom logic. Learn how to leverage core and extended matcher sets effectively.

---

## Introduction

Matchers in GoogleMock are powerful tools that let you specify flexible and expressive constraints on the arguments passed to mock methods. Whether you want to match exact values, ranges, properties of objects, or complex container contents, matchers provide a rich vocabulary to describe your expectations clearly and succinctly.

This page details available matchers and advanced composition techniques to help you harness their full power.

---

## Core Built-In Matchers

GoogleMock provides a comprehensive set of built-in matchers covering a wide range of use cases.

### Universal Matchers
- `_`
  - Matches any value of the appropriate type (wildcard).

- `Eq(value)`
  - Matches values equal to `value`.

- `Ne(value)`
  - Matches values not equal to `value`.

### Comparison Matchers
- `Lt(value)`
- `Le(value)`
- `Gt(value)`
- `Ge(value)`

### Boolean Matchers
- `IsTrue()`
- `IsFalse()`

### Null and Pointer Matchers
- `IsNull()`
- `NotNull()`
- `Pointee(matcher)`
  - Matches pointers that point to a value matching the inner matcher.

### String Matchers
- `StartsWith(prefix)`
- `EndsWith(suffix)`
- `HasSubstr(substring)`
- `MatchesRegex(regex)`

### Container Matchers
- `ElementsAre(elem_matchers...)`
  - Matches a container with elements matching the provided matchers in order.

- `UnorderedElementsAre(elem_matchers...)`
  - Matches container elements in any order.

- `ElementsAreArray(array_or_range)`
- `UnorderedElementsAreArray(array_or_range)`

- `Pair(key_matcher, value_matcher)`
  - Useful for matching map or associative container entries.

### Tuple and Multi-Argument Matchers
- `AllOf(matcher1, matcher2, ...)`
  - Matches if all contained matchers match (logical AND).

- `AnyOf(matcher1, matcher2, ...)`
  - Matches if any contained matcher matches (logical OR).

- `Not(matcher)`
  - Negates the given matcher.

- `Args<k1, ..., kn>(tuple_matcher)`
  - Matches the subset of arguments at positions k1 through kn against the tuple matcher.

- `AllArgs(tuple_matcher)`
  - Matches all arguments as a tuple.

- `With(tuple_matcher)`
  - Use inside `EXPECT_CALL` chained clause to match arguments collectively.

---

## Combining Matchers

Matchers can be composed and combined to express complex constraints.

### Logical Composition

- `AllOf()` combines multiple matchers where all conditions must be true.
- `AnyOf()` requires that at least one of the contained matchers matches.
- `Not()` negates a matcher, matching values that do *not* satisfy the original matcher.

### Nested Matchers

Matchers often support nested composition, such as nesting `ElementsAre` inside an `UnorderedElementsAre`, or using `Pair` inside container matchers.

### Reusing Matchers

Matchers are lightweight, copyable, and internally reference-counted. Defining a complex matcher once and reusing it across multiple expectations improves readability and test maintenance.

Example:

```cpp
Matcher<int> positive_and_even = AllOf(Gt(0), Truly([](int n) { return n % 2 == 0; }));
EXPECT_CALL(mock_obj, Foo(positive_and_even));
EXPECT_CALL(mock_obj, Bar(positive_and_even));
```

---

## Argument Matching Patterns

GoogleMock provides various ways to match arguments passed to mock methods:

### Exact Value Matching

```cpp
EXPECT_CALL(mock_obj, Foo(5, "hello"));
```

This matches calls where the first argument equals 5 and the second equals "hello".

### Wildcard Matching

Use `_` to match any argument of the appropriate type.

```cpp
EXPECT_CALL(mock_obj, Foo(_, "hello"));
```

Matches any first argument.

### Predicate Matching

Use `Truly()` to match arguments satisfying a user-defined predicate.

```cpp
EXPECT_CALL(mock_obj, Foo(Truly([](int x) { return x % 2 == 0; })));
```

### Member and Property Matching

Matchers can validate specific members or properties of an object argument using `Field()` or `Property()`.

```cpp
EXPECT_CALL(mock_obj, Foo(Field(&MyType::id, Eq(123))));
EXPECT_CALL(mock_obj, Foo(Property(&MyType::GetName, StartsWith("test"))));
```

Both work with pointers transparently.

### Matching Non-Copyable Arguments

If an argument cannot be copied, use `std::ref()` with matchers to avoid copies:

```cpp
EXPECT_CALL(mock_obj, Foo(Eq(std::ref(non_copyable_obj))));
```

Remember not to modify `non_copyable_obj` after setting expectations.

---

## Advanced Matchers

### Custom Matchers

Define your own matchers when built-ins don’t suffice.

#### Using MATCHER Macros

```cpp
MATCHER(IsDivisibleBy7, "is divisible by 7") {
  return (arg % 7) == 0;
}
```

#### Matcher Class

For more control, implement a matcher class with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()`.

Example:

```cpp
class BarPlusBazEqMatcher {
 public:
  using is_gtest_matcher = void;

  explicit BarPlusBazEqMatcher(int expected_sum) : expected_sum_(expected_sum) {}

  bool MatchAndExplain(const Foo& foo, std::ostream* os) const {
    return (foo.bar() + foo.baz()) == expected_sum_;
  }
  void DescribeTo(std::ostream* os) const { *os << "bar() + baz() equals " << expected_sum_; }
  void DescribeNegationTo(std::ostream* os) const { *os << "bar() + baz() does not equal " << expected_sum_; }

 private:
  const int expected_sum_;
};

::testing::Matcher<const Foo&> BarPlusBazEq(int expected_sum) {
  return BarPlusBazEqMatcher(expected_sum);
}
```

### Cardinalities and Multiplicity

Use matchers in conjunction with _cardinalities_ (see `Times()`) for flexible control over the number of expected calls.

### Matching Containers in Depth

Matchers like `ElementsAre()`, `UnorderedElementsAre()`, and `Pair()` allow detailed validation of containers including order and contents.

You can also use nested `ElementsAre` to match nested containers.

### Multi-Argument Constraints

Use `.With()` with multi-argument matchers to assert constraints involving multiple arguments collectively.

Example:

```cpp
EXPECT_CALL(mock_obj, Func(_, _))
    .With(Lt());  // First argument less than second.
```

### Matcher Casting and Overloaded Methods

Use `SafeMatcherCast<T>(matcher)` to cast matchers safely when type differences arise (e.g., matching `int` argument with a `Matcher<long>`).

To select among overloaded methods, use `Const()` for const overloads or specify matcher types explicitly.

---

## Practical Usage Tips

- Prefer `_` wildcards wherever argument values are unimportant.
- Use descriptive custom matchers to keep tests clear and concise.
- Combine multiple argument matchers with `AllOf` or `AnyOf` to express nuanced expectations.
- Use `With()` for inter-argument relations.
- Be mindful of matcher purity and avoid side effects.
- Save complex matchers to variables and reuse them to keep test code DRY (Don’t Repeat Yourself).

---

## Code Examples

### Basic Matcher Usage

```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;

EXPECT_CALL(mock_widget, DoSomething(Eq(42), _));
EXPECT_CALL(mock_widget, DoSomething(Gt(100), Eq("hello")));
```

### Combining Matchers

```cpp
using ::testing::AllOf;
using ::testing::Not;

EXPECT_CALL(mock_widget, ProcessValue(AllOf(Gt(10), Not(Eq(42)))));
```

### Custom Matcher Example

```cpp
MATCHER_P(IsApproximateTo, val, "is approx equal") {
  return fabs(arg - val) < 0.01;
}

EXPECT_CALL(mock, Compute(IsApproximateTo(3.14)));
```

### Container Matching

```cpp
using ::testing::ElementsAre;

EXPECT_CALL(mock, SetData(ElementsAre(1, 2, 3)));
```

### Matching Multiple Arguments as a Whole

```cpp
using ::testing::Lt;

EXPECT_CALL(mock, SetCoordinates(_, _)).With(Lt()); // x < y
```

### Matcher Cast for Overloads

```cpp
using ::testing::SafeMatcherCast;

// Assuming Foo has overloaded DoSomething(int) and DoSomething(long).
EXPECT_CALL(mock, DoSomething(SafeMatcherCast<int>(Ge(10))));
```

---

## Troubleshooting Common Pitfalls

- **Incorrect matcher types**: Use `SafeMatcherCast` to resolve type mismatches.
- **Overloaded method ambiguities**: Disambiguate with `Const()` or explicit matcher types.
- **Side effects in matchers**: Matchers must be side-effect free; avoid calling mocks inside matchers.
- **Matcher evaluation count**: Matchers may be called multiple times; keep them pure.
- **Unintended matcher combination**: Compose simple matchers carefully to avoid overly strict or lax constraints.

---

For more detailed scenarios, visit our [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and the [Matchers Reference](reference/matchers.md).

---