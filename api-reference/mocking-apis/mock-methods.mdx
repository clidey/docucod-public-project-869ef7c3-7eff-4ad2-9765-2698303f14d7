---
title: "Defining and Using Mock Methods"
description: "API documentation for defining mock classes and methods using GoogleMock, including the MOCK_METHOD macro, method signature constraints, and tips for integrating with production code. Learn to create robust and maintainable test doubles."
---

# Defining and Using Mock Methods

This guide provides a detailed reference for defining mock classes and methods using GoogleMockâ€™s `MOCK_METHOD` macro. It covers method signature constraints, qualifiers, usage considerations, and practical tips for integrating mocks into your testing workflow. Master these to create robust, maintainable test doubles that help you drive interaction-based testing in C++.

---

## Overview

GoogleMock enables you to create mock objects implementing interfaces or classes to verify interactions in your tests. The core building block is the mock method, defined with the `MOCK_METHOD` macro in a mock class.

Defining mock methods correctly allows you to specify how these methods behave when called, which calls are expected, argument constraints, and how often calls should occur.

---

## The `MOCK_METHOD` Macro

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- **`ReturnType`**: The return type of the mocked method.
- **`MethodName`**: The name of the method to mock.
- **`(Args...)`**: A parenthesized list of parameter types (with names optional).
- **`(Specs...)`**: An optional parenthesized list of qualifiers.

### Qualifiers (`Specs`) Supported

Include zero or more of the following, comma-separated within the fourth argument:

| Qualifier                 | Description                                                   |
|---------------------------|---------------------------------------------------------------|
| `const`                   | Marks the method as `const`. Required if overriding `const` methods. |
| `override`                | Marks the method as overriding a virtual method. Recommended when overriding. |
| `noexcept`                | Specifies the method as `noexcept`. Required for overriding `noexcept` methods. |
| `Calltype(...)`           | Defines calling convention (e.g., `Calltype(STDMETHODCALLTYPE)`). Useful for platform-specific ABI. |
| `ref(&)`, `ref(&&)`       | Specifies reference qualifiers (lvalue/ref-qualifiers), e.g., `ref(&)` for `&`. |

### Important Notes

- Always place `MOCK_METHOD` declarations in the **`public:`** section of your mock class, regardless of the original method's access level. This is necessary for `ON_CALL` and `EXPECT_CALL` macros to access and configure mocks appropriately.

- The macro requires arguments and qualifiers **to be enclosed in parentheses** explicitly.

- If the return type or argument types contain unprotected commas (e.g., template types like `std::pair<bool, int>`), you must either:

  1. Wrap the full type in parentheses: 
     ```cpp
     MOCK_METHOD((std::pair<bool, int>), GetPair, ());
     ```
  2. Or create type aliases before using them:
     ```cpp
     using BoolAndInt = std::pair<bool, int>;
     MOCK_METHOD(BoolAndInt, GetPair, ());
     ```

---

## Defining Mock Methods: Best Practices

### Overloaded Methods

You can mock overloaded methods by providing separate `MOCK_METHOD` declarations for each overloaded signature:

```cpp
MOCK_METHOD(int, Add, (int x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));
```

If you omit mocking some overloads, the unmocked overloads are hidden by default. To fix this, bring base class overloads into scope using the `using` statement:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add; // Brings unmocked overloads into scope
  MOCK_METHOD(int, Add, (int x), (override));
};
```

### Const and Non-const Methods

If the method you mock is `const`, add `const` in the fourth parameter list:

```cpp
MOCK_METHOD(int, GetValue, (), (const, override));
```

### Mocking Methods with Calling Conventions

Specify calling conventions as:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

This is especially useful on Windows platforms.

### Reference-qualified Methods

To mock methods with reference qualifiers (`&`, `&&`), use `ref` qualifier:

```cpp
MOCK_METHOD(int, Foo, (), (ref(&), override)); // Foo&()
```

### Mocking Template Classes

Mock template classes as you would normal classes, defining the `MOCK_METHOD` inside the template:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### Mocking Non-virtual Methods

Though limited, you can mock non-virtual methods by defining mock classes with methods matching the signatures, but unrelated to the base class. Use template-based injection to switch between concrete and mock implementations at compile time.

```cpp
class MockStream {
 public:
  MOCK_METHOD(void, AppendPacket, (Packet* new_packet));
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_num), (const));
};
```

Then inject the mock type as a template parameter.

### Mocking Private/Protected Methods

Declare mock methods in the `public:` section even if the original methods are protected or private:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, ProtectedMethod, (), (override));
  MOCK_METHOD(int, PrivateMethod, (), (override));
};
```

---

## Using `EXPECT_CALL` and `ON_CALL`

- `EXPECT_CALL(mock, Method(args))` sets an expectation that the mock method will be called matching the argument matchers. This sets behavioral constraints and triggers verification failures if violated.

- `ON_CALL(mock, Method(args))` defines default actions when the mock method is called with matching arguments but does *not* set expectations. Use it to define common behavior with no strict verification.

Refer to the [Call Expectations & Sequences](../mocking-apis/call-expectations) page for details on usage.

---

## Common Pitfalls and Tips

### Commas in Types

Unprotected commas in argument or return types cause parsing issues. Use:

- Parentheses around the type, or
- Type aliases to avoid syntax errors.

### Member Function Macro Placement

Declare all mock methods in `public:` sections of your mock classes, regardless of originating access level.

### Overload Disambiguation

When mocking overloaded methods, ensure all variants are mocked or use `using` declarations to prevent hidden base-class methods.

### Use Qualifiers Consistently

Include `const`/`override`/`noexcept` qualifiers as needed to suppress compiler warnings and ensure correct overriding behavior.

### Reduce Compilation Time

For large mock classes, define constructors and destructors out-of-line in `.cc` files to speed up compilation.

### Avoid Mocking Concrete Classes Directly

Favor interfaces and adaptor patterns over making concrete classes virtual and mocking them, to promote maintainability and encapsulation.

---

## Example Mock Class Definition

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

This mock class can be used in tests to verify interactions and control behaviors of `Turtle` instances.

---

## Advanced Usage

Refer to related pages for advanced control over:

- Specifying sequences of calls
- Setting cardinalities and call counts
- Customizing actions and behaviors
- Complex matchers and argument verification

---

## Troubleshooting

- Make sure your mocked methods are declared` public`.
- Confirm matching method qualifiers (`const`, `override`).
- Use `(Type)` or `using Alias = Type;` for return/argument types with commas.
- Verify all overloaded methods you wish to mock are declared or properly brought into scope.
- Check compiler warnings for clues about overriding mismatches.

---

## Summary

GoogleMock's `MOCK_METHOD` macro streamlines mock method declarations, enabling extensive control over method behavior and verification. Proper use ensures interaction-driven, precise, and maintainable unit tests that significantly improve code quality and robustness.

For deeper insights into usage patterns and testing workflows, refer to mock expectations, actions, and advanced mocking guides.

---

<Info>
Visit the GoogleMock official documentation for more details:
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
</Info>

<Source url="https://github.com/google/googletest" branch="main" paths='[{"path": "docs/gmock_cook_book.md", "range": "1-996"},{"path": "docs/gmock_cheat_sheet.md", "range": "1-203"},{"path": "docs/reference/mocking.md", "range": "1-675"}]' />