---
title: "Declaring and Using Mock Methods"
description: "An in-depth guide to declaring mock methods, specifying behaviors, and verifying invocations. Includes syntax, qualifiers, and the main entry points for building effective mocks."
---

# Declaring and Using Mock Methods

An in-depth guide to declaring mock methods, specifying behaviors, and verifying invocations. Includes syntax, qualifiers, and the main entry points for building effective mocks.

---

## Overview

GoogleMock (gMock) empowers you to create mock classes by declaring mock methods that simulate the behavior of real interfaces. This capability enables precise verification of how your code interacts with its dependencies during testing. By declaring mock methods, you can specify expected calls, control return values, simulate side effects, and validate interactions, all in a clean, declarative manner.

This page equips you with the essential syntax, qualifiers, and usage patterns for declaring and using mock methods effectively.

---

## Declaring Mock Methods

### Core Syntax

To declare a mock method, use the `MOCK_METHOD` macro inside the `public:` section of your mock class. Its signature resembles the actual method you want to mock:

```cpp
MOCK_METHOD(return_type, method_name, (args...), (optional_specs));
```

- `return_type`: The return type of the method (use parentheses if the type includes commas).
- `method_name`: The method's identifier.
- `(args...)`: The argument types in parentheses.
- `(optional_specs)`: Optional comma-separated qualifiers (see **Qualifiers** below).

The mock method generates an implementation that records calls, matches expectations, and performs specified actions automatically.

### Practical Examples

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

Here, each mock method perfectly matches the original interface, enabling you to control their behavior in tests.

### Handling Types with Commas

If the `return_type` or any argument type contains unprotected commas (e.g., `std::pair<int, bool>`), use one of the following:

- Wrap the type in parentheses:

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  ```

- Use type aliases:

  ```cpp
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  ```

This ensures `MOCK_METHOD` parses the types correctly.

---

## Qualifiers for Mock Methods

The fourth parameter of `MOCK_METHOD` lets you specify qualifiers that affect how the mock method is declared and overridden.

| Qualifier              | Description                                                                                       |
|------------------------|-------------------------------------------------------------------------------------------------|
| `const`                | Marks the mock method as `const`, required if mocking a `const` method.                         |
| `override`             | Specifies `override`, recommended for overriding virtual methods.                               |
| `noexcept`             | Marks the method as `noexcept`, required if overriding a `noexcept` method.                     |
| `Calltype(calltype)`   | Sets a call type, e.g., `Calltype(STDMETHODCALLTYPE)`, useful on Windows for calling conventions.|
| `ref(qualifier)`       | Adds a reference qualifier such as `ref(&)` or `ref(&&)` when overriding methods with ref qualifiers.|

**Example:**

```cpp
MOCK_METHOD(bool, CheckValue, ((const std::map<int, double>&) map), (const, override));
MOCK_METHOD(void, Process, (), (noexcept, override));
MOCK_METHOD(int, GetCount, (), (Calltype(STDMETHODCALLTYPE), override));
MOCK_METHOD(void, SetFlag, (), (ref(&), override));
```

---

## Declaring Mock Methods for Overloaded Functions

When mocking overloaded methods, declare mock methods for each overload you want to mock. Careful attention to constness and qualifiers is important.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));

  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

If you do not mock all overloads, some base class versions may become hidden; fix this using `using` declarations:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Bring unmocked overloads into scope
  MOCK_METHOD(int, Add, (Element x), (override));
};
```

---

## Mocking Non-Virtual Methods

gMock supports mocking non-virtual methods for high-performance dependency injection by declaring mock methods with the same signatures but without `override`:

```cpp
class ConcretePacketStream {
 public:
  void AppendPacket(Packet* new_packet);
  const Packet* GetPacket(size_t packet_number) const;
  size_t NumberOfPackets() const;
};

class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

Because there is no inheritance, selection between the real and mock class must be done at compile-time, typically using templates.

---

## Using `MOCK_METHOD` Inside Class Templates

You can mock class templates by using `MOCK_METHOD` normally within the template:

```cpp
template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

---

## Recommended Placement

Always place mock method declarations in the `public:` section, regardless of the base class method access level (public, protected, private). This ensures `EXPECT_CALL` and `ON_CALL` macros can reference mock methods.

---

## Using Mock Methods in Tests

Once declared, mock methods become the main entry points for:

- Setting expectations with `EXPECT_CALL`
- Defining default behaviors with `ON_CALL`
- Specifying call counts, argument matchers, return behaviors, and side effects
- Verifying at test end that interactions meet the expectations

Typical usage flow in tests:

```cpp
#include <gmock/gmock.h>

using ::testing::Return;

class MockTurtle : public Turtle { ... };  // with MOCK_METHODs

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(1);
  EXPECT_CALL(turtle, Forward(10))
      .Times(AtLeast(1));
  
  Painter p(&turtle);
  EXPECT_TRUE(p.DrawCircle(0, 0, 10));
}
```

If the mock methods are invoked out of expectations, gMock will report detailed errors immediately.

---

## Legacy `MOCK_METHODn` Macros

Before `MOCK_METHOD` became the standard, older macros existed:

- `MOCK_METHODn(MethodName, ReturnType(Args))`
- Variants for const methods: `MOCK_CONST_METHODn`
- Variants for call types: `_WITH_CALLTYPE`
- Variants for templates: suffixed with `_T`

Example equivalences:

| Old Macro | New Macro |
|-----------|------------|
| `MOCK_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int))` |
| `MOCK_CONST_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))` |
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))` |

While still supported, migrating to new `MOCK_METHOD` is encouraged.

---

## Best Practices and Tips

- **Always put mock methods in `public:`** for visibility to `EXPECT_CALL` and `ON_CALL`.
- **Use `override` qualifier** to ensure correct overriding and help compiler catch errors.
- **Wrap types with commas in parentheses or use aliases** to avoid parsing errors.
- **Mock all critical overloads** to prevent hiding base class methods.
- **Avoid mocking concrete classes unless necessary; prefer interfaces.**
- **For methods with reference qualifiers or call types, use appropriate qualifiers in specs.**
- **Use `NiceMock`, `NaggyMock`, or `StrictMock` templates for mock strictness control.**

---

## Troubleshooting Common Issues

- **Parsing errors with commas**: Wrap types containing commas in parentheses or use `using` aliases.
- **Missing `override` keyword**: May cause silent bugs; always mark overridden mock methods.
- **Hiding overloads**: Use `using BaseClass::Method;` for unmocked overloads to avoid hidden functions.

---

## See Also

- [GoogleMock for Dummies](gmock_for_dummies.md) for beginner friendly introduction.
- [gMock Cookbook](gmock_cook_book.md) for advanced recipes.
- [Mocking Reference](reference/mocking.md) for detailed API and usage.
- [Nice, Naggy, and Strict Mocks](reference/mocking.md#NiceStrictNaggy) to manage uninteresting call behavior.

---

## Summary

By mastering the `MOCK_METHOD` macro and its qualifications, you empower your tests to faithfully represent and verify expected interactions with dependencies. This documentation synthesizes practical examples and syntax clarity to ensure your mocks are precise, expressive, and robust across the full spectrum of C++ mocking scenarios.

---

<CardGroup cols={3}>
<Card title="Mocking Basics">
  Declare mock methods using `MOCK_METHOD` inside public sections for virtual methods.
</Card>
<Card title="Qualifiers">
  Use `const`, `override`, `noexcept`, `Calltype()`, and `ref()` to match your interface accurately.
</Card>
<Card title="Working with Overloads">
  Mock all overloads or use `using` to avoid hiding base methods.
</Card>
</CardGroup>