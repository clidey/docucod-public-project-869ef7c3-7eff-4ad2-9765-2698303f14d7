---
title: "Setting Expectations & Call Strictness"
description: "Explain how to express expected interactions, invocation counts, and call ordering using EXPECT_CALL, ON_CALL, and associated cardinality APIs. Explore strict, naggy, and nice mock variants for handling uninteresting or unexpected calls."
---

# Setting Expectations & Call Strictness

GoogleMock enables precise control over how mock objects respond to method calls and validates the interaction patterns expected in your tests. This page dives into the mechanisms for expressing *expectations* on mock method calls—specifying which interactions must occur, how often, in what order—and how GoogleMock handles *uninteresting* or *unexpected* calls with configurable strictness via special mock variants.

---

## Expressing Expected Interactions with `EXPECT_CALL`

At the heart of specifying what your code under test *should* do is the `EXPECT_CALL` macro. Each `EXPECT_CALL` documents a mock method invocation you expect to happen, defining:

- The method and matchers for its arguments.
- How many times it should be called (cardinality).
- The order and sequence constraints.
- What action to perform on each call (return values, side effects).

### Basic Syntax

```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .Times(cardinality)
    .With(multi_arg_matcher)     // optional
    .InSequence(sequence1, ...)
    .After(expectation1, ...)
    .WillOnce(action)
    .WillRepeatedly(action)
    .RetiresOnSaturation();
```

- The argument matchers restrict calls to those that match argument constraints.
- `Times()` controls the number of expected calls. If omitted, cardinality is inferred.
- `InSequence()` and `After()` specify call ordering.
- `WillOnce()` and `WillRepeatedly()` define behavior.
- `.RetiresOnSaturation()` causes an expectation to become inactive once saturated.

### Example: Specifying Call Counts and Actions

```cpp
using ::testing::Return;

EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));

// Here GetX() is expected to be called at least twice,
// returning 100, then 150, then 200 on subsequent calls.
```

### Cardinalities: How Many Times Must It Be Called?

GoogleMock supports flexible expression of expected call counts via cardinalities:

| Cardinality         | Meaning                   |
|---------------------|---------------------------|
| `AnyNumber()`       | Called any number of times|
| `AtLeast(n)`        | Called at least n times   |
| `AtMost(n)`         | Called at most n times    |
| `Between(m, n)`     | Called between m and n times (inclusive) |
| `Exactly(n)` or `n` | Called exactly n times    |

If no `.Times()` is set explicitly, GoogleMock infers the call count from `WillOnce` and `WillRepeatedly` usage:

- No `WillOnce` or `WillRepeatedly`: default to `Times(1)`.
- n `WillOnce`s without `WillRepeatedly`: inferred cardinality is `n`.
- n `WillOnce`s with `WillRepeatedly`: inferred cardinality is `AtLeast(n)`.

### Using `.With(multi_argument_matcher)`

The `.With()` clause allows you to express constraints on the mock method's full argument tuple. For example:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // first argument less than second
```

This clause must appear as the first modifier, and at most once.

---

## Setting Default Behaviors with `ON_CALL`

Where `EXPECT_CALL` expresses *must be called* expectations, `ON_CALL` defines default behavior without imposing call count constraints.

### Basic Syntax

```cpp
ON_CALL(mock_object, Method(matchers...))
    .With(multi_arg_matcher)   // optional
    .WillByDefault(action);    // required
```

`ON_CALL` specifies what your mock method *does* when called with matching arguments but does *not* expect the call.

### Example: Defining a Default Return

```cpp
ON_CALL(foo, GetSize())
    .WillByDefault(Return(10));
```

If no explicit `EXPECT_CALL` matches a call, then the matching `ON_CALL`'s behavior will be used. If none matches either, GoogleMock uses built-in default actions (e.g., returns 0 or default value).

---

## Controlling Call Order

### Enforcing Strict Sequences with `InSequence`

Creating a scoped `InSequence` object causes all expectations declared within to require calls to happen in the exact order declared.

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}

// The mock must receive FirstCall() before SecondCall(), else test fails.
```

### Specifying Partial Orders with `Sequence` Objects

For finer control over partial call orderings, you can assign expectations to one or more `Sequence` objects, which define a directed acyclic graph (DAG) of call order constraints.

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Setup())           .InSequence(s1, s2);
EXPECT_CALL(mock, Process()).Times(2).InSequence(s1);
EXPECT_CALL(mock, Validate())        .InSequence(s2);
```

This dictates that `Setup()` occurs before both processing and validation, but `Process()` and `Validate()` can happen in any relative order.

### The `.After()` Clause

`.After()` expresses that an expectation must only be matched *after* certain other expectations have been met.

```cpp
Expectation e1 = EXPECT_CALL(mock, Init());
EXPECT_CALL(mock, Run()).After(e1);
```

Up to five expectations or expectation sets can be specified with `.After()`.

---

## Handling Uninteresting and Unexpected Calls with Strictness Variants

By default, GoogleMock mocks are **naggy**:

- *Uninteresting calls*—method calls on mock methods with no matching `EXPECT_CALL`—emit warnings but allow the test to continue.
- *Unexpected calls*—method calls that do not match any `EXPECT_CALL` criteria—cause test failures.

GoogleMock allows modifying this behavior *per mock object* using wrapper classes:

| Variant       | Description                                                       |
|---------------|-------------------------------------------------------------------|
| `NiceMock<T>` | Suppresses warnings for uninteresting calls (ignores them).      |
| `NaggyMock<T>`| The default; logs warnings on uninteresting calls.                |
| `StrictMock<T>`| Treats all uninteresting calls as errors (test failures).        |

### Usage Examples

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

// Suppress warnings on uninteresting calls
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, DoSomething());

// Fail on uninteresting calls
StrictMock<MockFoo> strict_mock;
EXPECT_CALL(strict_mock, DoSomething());
```

Note:

- `NiceMock` and `StrictMock` only affect *uninteresting calls* (no expectations).
- They do not affect *unexpected calls* (calls that fail to match an expectation).
- They only work when mock methods are defined directly with `MOCK_METHOD` in the mock class.

### Impact on Testing

Using `NiceMock` results in cleaner test output at the cost of potentially hiding calls that were forgotten to be expected, making tests more resilient to unrelated changes. `StrictMock` enforces a rigid contract, useful when you want precise and comprehensive verification.

---

## Best Practices and Tips

- **Prefer `ON_CALL` for default behaviors**, reserve `EXPECT_CALL` for call count verification.
- **Order of `EXPECT_CALL`s matters**: newer expectations override older ones for matching calls.
- When specifying multiple behaviors on the same method, **put specific matchers last** so they take precedence.
- Use sequences or `.After()` to express call ordering precisely.
- To test that a method is never called, use `.Times(0)`.
- Use `NiceMock` to suppress verbose uninteresting call warnings during debugging or when they clutter output.
- Use `StrictMock` to enforce call expectations rigidly, especially in highly critical code paths.

---

## Troubleshooting Common Issues

- **Unexpected calls** cause test failures with detailed messages about mismatch.
- **Too many or too few actions specified** relative to expected call count generate warnings during expectation setup.
- Omitting `.WillByDefault()` in `ON_CALL` is a fatal error.
- Expect a default cardinality of one call unless you specify otherwise or add `.WillOnce()`/`.WillRepeatedly()`.

If in doubt, run your tests with `--gmock_verbose=info` to see detailed traces of mock calls, matches, and expectations.

---

## Summary of Core Expectation Clauses

| Clause               | Purpose                                            | Usage Constraints                                 |
|----------------------|---------------------------------------------------|--------------------------------------------------|
| `With()`             | Match all arguments as a tuple                     | At most once; must be first clause                |
| `Times()`            | Specify how many times expectation matches        | At most once; must precede InSequence, WillOnce  |
| `InSequence()`       | Add expectation to one or more sequences           | Can appear multiple times; before WillOnce        |
| `After()`            | Depend expectation after one or more others        | Can appear multiple times; before WillOnce        |
| `WillOnce()`         | Action on first to nth matching invocations        | Can appear multiple times; before WillRepeatedly  |
| `WillRepeatedly()`   | Action on all subsequent calls                      | At most once; last clause                           |
| `RetiresOnSaturation()` | Retire expectation when saturated                  | At most once; last clause                           |

---

For detailed information on writing expectations, matchers, and actions, refer to the [GoogleMock Mocking Reference](reference/mocking.md).

---

## References and Further Reading
- [EXPECT_CALL Clause Reference](reference/mocking.md#EXPECT_CALL)
- [ON_CALL Clause Reference](reference/mocking.md#ON_CALL)
- [NiceMock, NaggyMock, and StrictMock](docs/gmock_cook_book.md#NiceStrictNaggy)
- [Matcher and Action Tutorials](docs/gmock_cook_book.md#UsingMatchers)
- [Sequences and Partial Order of Calls](docs/gmock_cook_book.md#OrderedCalls)

---

<Accordion title="Example: Using Sequences to Enforce Call Order">
```cpp
using ::testing::Sequence;

Sequence s1, s2;

EXPECT_CALL(mock, Initialize())
    .InSequence(s1, s2);
EXPECT_CALL(mock, Process()).Times(2).InSequence(s1);
EXPECT_CALL(mock, Validate()).InSequence(s2);

// The above means:
// Initialize() must happen before Process() and Validate();
// Process() must happen twice in order before Validate();
```
</Accordion>