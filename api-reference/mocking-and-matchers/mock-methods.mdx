---
title: "Mock Method Definitions"
description: "Details the core APIs and macros (such as MOCK_METHOD) for defining mock methods that simulate class interfaces. Outlines support for various qualifiers, parameter handling, and integration with test verification."
---

# Mock Method Definitions

This documentation details the core APIs and macros, specifically the `MOCK_METHOD` macro, for defining mock methods that simulate class interfaces in GoogleMock. It outlines how to declare mock methods with or without various qualifiers such as `const`, `override`, `noexcept`, call types, and reference qualifiers, ensuring integration with test verification mechanisms.

---

## Overview of MOCK_METHOD

GoogleMock's `MOCK_METHOD` macro enables users to define mock methods within mock classes easily. These methods stand in place of real functions and allow verification of expected calls, arguments, and controlling return values or actions during tests.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```
- **ReturnType**: The return type of the method.
- **MethodName**: The name of the method being mocked.
- **Args**: A comma-separated list of argument types enclosed in parentheses.
- **Specs** (optional): Comma-separated list of qualifiers enclosed in parentheses.

Example:

```cpp
class MockExample {
 public:
  MOCK_METHOD(int, Compute, (int x, int y), (const, override));
};
```

### Qualifiers Supported

The optional 4th parameter accepts the following specifiers:

| Qualifier                   | Description                                                      |
| --------------------------- | ----------------------------------------------------------------|
| `const`                     | Makes the mocked method a `const` method (needed for overriding const methods).
| `override`                  | Marks the mock method as `override` (recommended when overriding virtual methods).
| `noexcept`                  | Marks the method `noexcept` (required if overriding noexcept methods).
| `Calltype(calltype)`        | Specifies a calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` for Windows COM interfaces.
| `ref(&)` or `ref(&&)`       | Specifies reference qualifiers, required to match overloaded methods with ref qualifiers.


### Important Rules & Restrictions

- Methods mocked with `MOCK_METHOD` **must be declared in the `public:` section**, regardless of their accessibility in the base class.
- For method parameters or return types that contain commas (e.g., templates like `std::pair` or `std::map`), wrap the type in parentheses or use a type alias to avoid parsing errors.

Example of protecting commas:

```cpp
class MyMock {
 public:
  MOCK_METHOD((std::pair<int, double>), GetPair, ());
  using MapType = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapType, bool));
};
```

---

## Declaring Mock Methods

### Basic Usage

Mock classes derive from the real interface and use `MOCK_METHOD` to define mocked functionality.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoSomething, (), (override));
  MOCK_METHOD(int, Calculate, (int x, int y), (const, override));
};
```

### Handling Overloaded Methods

To mock overloaded methods, declare all overloaded versions explicitly with `MOCK_METHOD`, specifying differing parameters and qualifiers as needed.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int x, int y), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
};
```

If you choose to mock only some overloads, use `using` declarations to bring unmocked ones into scope and avoid compiler warnings:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add; // bring other overloads into scope

  MOCK_METHOD(int, Add, (int x), (override));
  // Left other overloads unmocked intentionally.
};
```

### Mocking Class Templates

Class templates are mocked similarly:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### Supporting Calling Conventions

On Windows and other platforms, if a method uses a specific calling convention, specify it using `Calltype()` qualifier:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

---

## Special Cases and Advanced Usage

### Mocking Methods with Reference Qualifiers

C++ methods may be qualified on references (`&` or `&&`). These must be specified explicitly.

```cpp
MOCK_METHOD(int, Foo, (), (const, ref(&), override));
MOCK_METHOD(int, Foo, (), (ref(&&), override));
```

### Handling Unprotected Commas in Types

When return types or parameters contain unprotected commas, wrapping them in parentheses or creating type aliases resolves parsing issues.

Example:

```cpp
using PairType = std::pair<bool, int>;
MOCK_METHOD(PairType, GetPair, ());
```

### Mocking Non-Virtual Methods

GoogleMock also supports mocking non-virtual methods for high-performance dependency injection by using class templates that are unrelated to the original class but define the same method signatures with `MOCK_METHOD`. These mocks require template parameters to specify the concrete/mock types at compile-time.

---

## Integration with Expectations and Actions

While `MOCK_METHOD` defines mock methods, the behavior during tests is controlled with `ON_CALL` and `EXPECT_CALL`:

- **`ON_CALL`**: Defines the default behavior when a mock method is called.
- **`EXPECT_CALL`**: Sets expectations for how many times and with what arguments a mock method should be called.

Example:

```cpp
using ::testing::Return;

MockFoo mock;
ON_CALL(mock, GetSize()).WillByDefault(Return(10));
EXPECT_CALL(mock, DoSomething(42)).Times(1);
```

### Handling Uninteresting Calls

Calls to mock methods without expectations are called uninteresting calls.
By default, GoogleMock warns about these. Use `NiceMock<T>` to suppress warnings, or `StrictMock<T>` to treat them as errors.

---

## Old-Style Macros vs `MOCK_METHOD`

Before 2018, GoogleMock used `MOCK_METHODn` macros, where `n` is the number of parameters. These macros still exist for backward compatibility but `MOCK_METHOD` is preferred.

| Old Macro                          | New Equivalent                                               |
| --------------------------------- | ------------------------------------------------------------- |
| `MOCK_METHOD1(Foo, bool(int))`    | `MOCK_METHOD(bool, Foo, (int))`                               |
| `MOCK_CONST_METHOD1(Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (const))`                      |
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))` |

Users should transition to `MOCK_METHOD` for improved flexibility and modern C++ compatibility.

---

## Best Practices

- Always declare mock methods in the `public:` section of your mock class.
- Use `using` declarations when selectively mocking overloaded methods to keep unmocked overloads visible.
- Wrap return or argument types with commas in parentheses or use type aliases to prevent macro parsing errors.
- Use qualifiers (`const`, `override`, `noexcept`, reference qualifiers) diligently to match the signatures of overridden methods.
- Prefer `MOCK_METHOD` macros over legacy `MOCK_METHODn` macros.
- Control default behaviors and expectations using `ON_CALL` and `EXPECT_CALL` outside the mock class definition.

---

## Troubleshooting

### Compilation Errors from Commas in Parameter or Return Types
If you encounter errors related to commas in template types within `MOCK_METHOD`, either:

- Wrap the entire type with parentheses, e.g., `MOCK_METHOD((std::pair<int, int>), Method, ());`
- Use a `using` type alias to simplify the signature and avoid the commas directly in the macro.

### Mocking Private or Protected Methods
Always declare mock methods as `public:` in your mock class, even if the base method is private or protected. This ensures that GoogleMock's hooks for expectations and default behavior work properly.

### Using Mock Methods with Calling Conventions
When mocking methods that require non-default calling conventions on special platforms (mainly Windows COM interfaces), specify the call type with the `Calltype()` qualifier.

```cpp
MOCK_METHOD(bool, Enabled, (), (Calltype(STDMETHODCALLTYPE)));
```

### Mocking Overloaded Methods
Specify all overloads you use or use `using` declarations to include unmocked overloads to avoid hiding base class methods and compiler warnings.

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical recipes for defining and using mock methods.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) — Detailed explanations of mocking macros and methods.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly guide with examples and workflows.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for common mocking scenarios.

---

## Example: Defining a Mock Class with Mock Methods

```cpp
#include <gmock/gmock.h>

class Interface {
 public:
  virtual ~Interface() = default;
  virtual int Calculate(int x, int y) const = 0;
  virtual void DoWork() = 0;
};

class MockInterface : public Interface {
 public:
  MOCK_METHOD(int, Calculate, (int x, int y), (const, override));
  MOCK_METHOD(void, DoWork, (), (override));
};
```

This mock class can be used in tests to set expectations and simulate behavior.

---

# Mock Method Definitions: Summary

This page defines how to create mock method declarations in GoogleMock using the `MOCK_METHOD` macro. It covers syntax details, qualifiers, handling tricky parameter types, mocking overloaded and templated methods, and integration with testing expectations.


<AccordionGroup title="Common Questions">
<Accordion title="Why must MOCK_METHOD declarations always be public?">
Declaring mock methods `public:` allows external testing code to set expectations and configure behaviors without violating C++ access rules, including when mocking private or protected methods.
</Accordion>
<Accordion title="How do I handle return or argument types with commas?">
Wrap the type in parentheses or create a type alias. This prevents parsing errors caused by commas appearing as argument separators.
</Accordion>
<Accordion title="What if my method uses a non-default calling convention?">
Specify the calling convention via the `Calltype(calltype)` qualifier in the `MOCK_METHOD` macro.
</Accordion>
</AccordionGroup>

---