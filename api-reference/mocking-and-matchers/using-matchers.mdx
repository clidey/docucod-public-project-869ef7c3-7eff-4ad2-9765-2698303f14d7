---
title: "Using Matchers"
description: "Details the library of built-in matchers, interfaces for custom matcher creation, and practical matcher composition for argument validation in both assertions and mock object expectations. Includes examples using Eq, Ne, regex, and more expressive operators."
---

# Using Matchers

This page dives deep into the rich library of built-in matchers provided by GoogleMock, explains how you can craft your own custom matchers, and demonstrates practical ways to compose matchers to precisely control argument validation. Matchers form the backbone of verifying behavior both in assertions and mocking expectations, allowing flexible, expressive, and maintainable test specifications.

---

## 1. Introduction to Matchers

Matchers are predicates used to specify **what arguments** mock methods expect or assertions verify. They empower you to validate function parameters with a high degree of expressiveness — from simple equality checks to complex, domain-specific predicates.

If you've used `EXPECT_CALL(mock_obj, Foo(5))`, know that `5` implicitly acts as a matcher equivalent to `Eq(5)`. Beyond equality, the framework offers relational matchers (`Ge()`, `Ne()`, `Lt()`, etc), regex, container matching, and much more.

## 2. Using Built-in Matchers

Matchers work by matching arguments passed to mocked methods or values inspected by assertions.

### Wildcard Matcher `_`
Use `_` to match any value without restriction:

```cpp
using ::testing::_;
EXPECT_CALL(mock, Method(_));  // Accepts any argument.
```

### Equality Matchers `Eq` and `Ne`
Match exact equality or inequality:

```cpp
EXPECT_CALL(mock, Method(Eq(42)));  // Argument must be 42.
EXPECT_CALL(mock, Method(Ne(0)));   // Argument must not be 0.
```

### Relational Matchers
Match arguments using greater-than, less-than, and their variants:

```cpp
using ::testing::Ge;
EXPECT_CALL(mock, SetThreshold(Ge(10)));  // Argument >= 10.
```

### String Matchers
`StartsWith()`, `EndsWith()`, and `HasSubstr()` help verify string arguments:

```cpp
EXPECT_CALL(mock, Log(StartsWith("Error:")));
```

### Composing Matchers
Matchers can be combined via `AllOf()`, `AnyOf()`, and negated with `Not()`. For example:

```cpp
using ::testing::AllOf;
using ::testing::Ne;
using ::testing::Gt;
EXPECT_CALL(mock, Foo(AllOf(Gt(5), Ne(10)))); // Argument > 5 and != 10
```

### Container Matchers
Matchers like `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, and `Each()` validate STL-like container contents:

```cpp
using ::testing::ElementsAre;
EXPECT_CALL(mock, Process(std::vector<int>{1, 3, 5}));
EXPECT_CALL(mock, Process(ElementsAre(1, Gt(2), _)));  // Checks stage by stage
```

### Pointer and Optional Matchers
Matchers can verify pointer arguments and the content they point to:

```cpp
using ::testing::Pointee;
EXPECT_CALL(mock, Callback(Pointee(Eq(42))));  // Pointer points to value 42
```

Matchers like `IsNull()` and `NotNull()` explicitly match pointers:

```cpp
EXPECT_CALL(mock, Func(IsNull()));    // Argument is nullptr
EXPECT_CALL(mock, Func(NotNull()));   // Argument is non-null
```

## 3. Custom Matchers

When built-in matchers don't suffice, you can create **custom matchers** for domain-specific validation. The simplest way is using the `MATCHER` family of macros.

### Basic MATCHER Example

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(mock, Method(IsEven()));
```

If the match fails, `EXPECT_THAT(27, IsEven());` will print:

```
Value of: 27
Expected: is even
```

### Parameterized MATCHER_P Example

You can parameterize matchers with additional arguments:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}

EXPECT_THAT(-10, HasAbsoluteValue(10));
```

This prints descriptive messages including parameter values.

### Adding Custom Failure Explanations

Within a matcher, you can stream additional failure info to `result_listener`:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if (arg % 7 == 0) return true;
  *result_listener << "the remainder is " << (arg % 7);
  return false;
}
```

Failed assertions will show the remainder helping the user debug.

### Full Custom Matcher Classes

For advanced use cases, implement a matcher class with:

- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Example:

```cpp
class BarPlusBazEqMatcher {
 public:
  using is_gtest_matcher = void;
  explicit BarPlusBazEqMatcher(int sum) : expected_sum_(sum) {}

  bool MatchAndExplain(const Foo& foo, std::ostream* /*listener*/) const {
    return (foo.bar() + foo.baz()) == expected_sum_;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "bar() + baz() equals " << expected_sum_;
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "bar() + baz() does not equal " << expected_sum_;
  }

 private:
  const int expected_sum_;
};

::testing::Matcher<const Foo&> BarPlusBazEq(int sum) {
  return BarPlusBazEqMatcher(sum);
}
```

## 4. Multi-Argument Matchers with `.With()` Clause

In `EXPECT_CALL` and `ON_CALL`, the `.With()` clause lets you match the entire argument tuple as a single matcher, enabling inter-argument constraints.

Example - ensuring first argument less than the second:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // 2-tuple matcher Lt()
```

You can also use `Args<N1, ..., Nk>(matcher)` to match selected argument subsets.

## 5. Practical Matcher Composition

GoogleMock's matchers can be composed in elegant domain-specific ways:

### Example: Validating a Member Field

```cpp
using ::testing::Field;
using ::testing::Ge;
EXPECT_CALL(mock, SetFoo(Field(&Foo::bar, Ge(3))));
```

### Example: Matching Containers in Arguments

```cpp
using ::testing::ElementsAre;
EXPECT_CALL(mock, Process(ElementsAre(1, Gt(0), _, 5)));
```

### Example: Handling Pointers to Pointers

```cpp
using ::testing::Pointee;
EXPECT_CALL(mock, Func(Pointee(Pointee(Lt(3)))));
```

This matches a pointer to a pointer to a value less than 3.

## 6. Tips & Best Practices

- Use `_` when argument values are irrelevant to your test.
- Avoid over-specifying matchers, to keep tests resilient to implementation changes.
- Use `.With()` for inter-argument relationships, not just individual argument matchers.
- Share commonly used complex matchers by assigning them to matcher variables.
- Always keep matchers pure — they must have no side effects or dependence on mutable state.

## 7. Common Pitfalls

### Commas in Template Arguments
Use parentheses or type aliases to protect commas in complex types when mocking methods:

```cpp
// Wrap argument type with parentheses
MOCK_METHOD((std::pair<int, int>), GetPair, ());
// OR define for readability:
using PairInts = std::pair<int, int>;
MOCK_METHOD(PairInts, GetPair, ());
```

### Mutable Reference Parameters
Use `Ref(variable)` matcher to match arguments that must be references to a particular variable.

```cpp
int x = 5;
EXPECT_CALL(mock, Func(Ref(x)));
```

### Default Matcher Behavior
If no matcher is provided, GoogleMock uses `_` implicitly but only for non-overloaded methods. Overloaded methods require explicit matchers.

## 8. Matcher Examples

<CodeGroup>
```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::Ne;
using ::testing::Ge;
using ::testing::StartsWith;

// Match exact value 5
EXPECT_CALL(mock, Func(Eq(5)));

// Match any argument
EXPECT_CALL(mock, Func(_));

// Match a non-zero argument
EXPECT_CALL(mock, Func(Ne(0)));

// Match argument >= 10
EXPECT_CALL(mock, Func(Ge(10)));

// Match string starting with "Error:"
EXPECT_CALL(mock, Log(StartsWith("Error:")));
```
```cpp
// Parameterized matcher example
MATCHER_P(IsDivisibleBy, divisor, "") {
  return (arg % divisor) == 0;
}

// Usage
EXPECT_CALL(mock, Func(IsDivisibleBy(3)));
```
</CodeGroup>

---

## Summary

Matchers provide a powerful, expressive way to validate arguments to mock methods and values in assertions. This page covers:

- The built-in library of matchers including wildcards, equality, relational, string, container, and pointer matchers.
- Techniques for creating custom matchers, both simple with macros and advanced with classes.
- How to compose matchers logically and use `.With()` to validate multi-argument relationships.
- Practical tips and advice to write clear, maintainable tests.

For further information, explore the related pages:

- [Mock Method Definition](../mock-methods.md) — how to define mocks that use these matchers.
- [Defining Expectations](../defining-expectations.md) — how to combine expectations with matchers.
- [Actions and Side Effects](../actions-and-side-effects.md) — controlling mocked method behaviors.
- [Mastering Assertions and Matchers](../../guides/core-workflows/assertions-and-matchers.md) — deeper guidance on using assertions with matchers.

Consult the official [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) and [gMock Cookbook Matchers Section](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers) for practical recipes and advanced matcher usage.

---

<_RelatedLinks>
- [GoogleMock GitHub Repository](https://github.com/google/googletest)
- [Matchers Reference](reference/matchers.md)
- [GoogleTest Assertions Reference](reference/assertions.md#EXPECT_THAT)
</_RelatedLinks>
