---
title: "Mock Classes and Actions"
description: "Documents APIs for defining, configuring, and inspecting mock objects in C++. Covers the use of MOCK_METHOD macros, setup of strict/nice/naggy mocks, and assigning behavior with actions and return strategies. Includes practical examples of simulating dependencies and verifying interactions."
---

# Mock Classes and Actions Reference

This reference documents the APIs and patterns for defining, configuring, and inspecting mock objects in C++ using GoogleMock. It covers the use of the `MOCK_METHOD` macro for creating mock methods, configuring different mock behavior styles (strict, nice, naggy), and assigning behaviors with actions and return strategies. Practical examples illustrate simulating dependencies and verifying method interactions with precise control.

---

## Defining Mock Methods with `MOCK_METHOD`

Central to GoogleMock is the `MOCK_METHOD` macro, which lets you define mock implementations of virtual methods effortlessly within mock classes.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- `ReturnType`: The return type of the method.
- `MethodName`: The name of the mock method.
- `Args...`: Parenthesized list of argument types.
- `Qualifiers` (optional): Comma-separated list of special qualifiers such as `const`, `override`, and calling conventions.

### Important Qualifiers

| Qualifier                 | Use Case                                                  |
|---------------------------|-----------------------------------------------------------|
| `const`                   | Required if mocking a const method.                        |
| `override`                | Recommended if overriding a virtual method.               |
| `noexcept`                | Required if overriding a `noexcept` method.                |
| `Calltype(convention)`    | Specifies calling convention (e.g., Windows `STDMETHODCALLTYPE`). |
| `ref(&)` or `ref(&&)`    | Marks the method as reference-qualified (lvalue/rvalue).  |

### Handling Commas in Types

If your argument or return types contain commas (e.g., `std::pair` or template types), wrap the type in parentheses or use type aliases to avoid macro parsing issues:

```cpp
class MyMock {
 public:
  // Using parentheses:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());

  // Using type aliases:
  using BoolIntPair = std::pair<bool, int>;
  MOCK_METHOD(BoolIntPair, GetPair, ());
};
```

### Placement

Place all `MOCK_METHOD` declarations in the `public:` section of your mock class regardless of the original access level in the base class. This is necessary for GoogleMock to access these methods for setting expectations and actions.

### Example

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

---

## Configuring Mock Object Behavior

GoogleMock supports different levels of strictness in mocks to control how unmentioned (uninteresting) calls are handled.

### NaggyMock (Default Behavior)

Generates warnings when uninteresting calls occur but does not fail the test.

### NiceMock

Suppresses warnings for uninteresting calls, assuming no concern for these calls.

```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> nice_turtle;
```

### StrictMock

Fails the test immediately on any uninteresting call, enforcing a strict mock behavior.

```cpp
using ::testing::StrictMock;
StrictMock<MockTurtle> strict_turtle;
```

<Note>
The strictness wrappers only affect uninteresting calls (methods without expectations). Unexpected calls (calls that don’t match any expectation) always fail.
</Note>

---

## Setting Expectations with `EXPECT_CALL`

Use `EXPECT_CALL` to specify which mock methods should be called, their expected arguments, frequency, and behavior.

### Syntax

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .With(multi_arg_matcher)?
    .Times(cardinality)?
    .InSequence(sequence...)*
    .After(expectation...)*
    .WillOnce(action)*
    .WillRepeatedly(action)?
    .RetiresOnSaturation()?;
```

(*`?` means optional, `*` means zero or more uses*)

### Key Clauses Explained

- `.With(matcher)`: Matches the entire argument tuple as a whole.
- `.Times(cardinality)`: Specifies the expected number of calls (`Exactly(n)`, `AtLeast(n)`, `AnyNumber()`, etc.).
- `.InSequence(sequences...)`: Enforces call order along specified sequences.
- `.After(expectations...)`: Specifies calling order after other expectations complete.
- `.WillOnce(action)`: Defines behavior for a single call. Multiple invocations can chain behaviors.
- `.WillRepeatedly(action)`: Defines behavior for all subsequent calls after `WillOnce` are exhausted.
- `.RetiresOnSaturation()`: Deactivates expectation once its `Times` limit is reached, allowing other expectations to match later calls.

### Example

```cpp
using ::testing::Return;

EXPECT_CALL(mock_turtle, GetX())
    .Times(3)
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));
```

*Interpretation:* `GetX()` is expected to be called at least three times. The first call returns 10, second returns 20, and subsequent calls return 30.

---

## Defining Default Behavior with `ON_CALL`

Use `ON_CALL` to specify default behaviors for mock methods when no explicit expectation (`EXPECT_CALL`) applies.

### Syntax

```cpp
ON_CALL(mock_object, MethodName(matchers...))
    .With(multi_arg_matcher)?
    .WillByDefault(action);
```

- Must end with `.WillByDefault(action)` to define behavior.
- Does not set any call expectation, i.e., calls matching only `ON_CALL` are allowed but not verified.

### Example

```cpp
ON_CALL(mock_turtle, GetX())
    .WillByDefault(Return(0));
```

This means if no expectation applies and `GetX()` is called, it will return `0` instead of the default (which may be 0 or default constructed).

---

## Actions: Defining What Mock Methods Do

Actions specify the behavior of mock method calls.

### Common Built-in Actions

- `Return(value)`: Return a copy of the value.
- `ReturnRef(variable)`: Return a reference to a variable.
- `ReturnPointee(pointer)`: Return the value pointed to by a pointer at call time.
- `SetArgPointee<N>(value)`: Sets the `N`th argument's pointed-to value.
- `SetArrayArgument<N>(first, last)`: Copies an array into the `N`th output pointer argument.
- `Invoke(function_or_lambda)`: Calls a callable with the mock method arguments.
- `DoAll(action1, action2, ...)`: Combines multiple actions into one call.
- `Throw(exception)`: Throws specified exception.

### Example: Returning Different Values per Call

```cpp
EXPECT_CALL(mock_turtle, GetX())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### Example: Changing Output Argument

```cpp
using ::testing::SetArgPointee;

EXPECT_CALL(mock_mutator, Mutate(True, _))
    .WillOnce(SetArgPointee<1>(42));
```

### Advanced Usage: Custom Lambdas

You may specify custom callable objects, including lambdas, as actions:

```cpp
EXPECT_CALL(mock_foo, Bar(_))
    .WillOnce([](int x) { return x * 2; });
```

---

## Working with Mock Object Types

GoogleMock provides wrappers to control how strictly mock objects treat uninteresting calls.

| Mock Wrapper       | Behavior                                                        |
|--------------------|----------------------------------------------------------------|
| `NiceMock<T>`      | Suppresses uninteresting call warnings.                        |
| `NaggyMock<T>`     | Default mock: warns on uninteresting calls.                    |
| `StrictMock<T>`    | Fails test on uninteresting calls.                             |

You use them as follows:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock;
```

<Note>
These wrappers only affect calls to mock methods without any `EXPECT_CALL` set (uninteresting calls). Calls matching expectations are always checked and validated.
</Note>

---

## Ordering Expectations

To express expected call order, GoogleMock supports:

- **Sequences**: Group expectations into one or more sequences to enforce order.
- **`InSequence` scoped object**: Puts expectations defined within its scope into a sequence.
- **`.After()` clause**: Specifies that an expectation must occur after other expectations.

### Example Using `InSequence`

```cpp
using ::testing::InSequence;
{
  InSequence seq;
  EXPECT_CALL(mock, Start());
  EXPECT_CALL(mock, Process());
  EXPECT_CALL(mock, End());
}
```
The calls to `Start()`, `Process()`, and `End()` must occur in this order.

### Example Using `Sequence` and `.InSequence`

```cpp
using ::testing::Sequence;
Sequence seq1, seq2;
EXPECT_CALL(mock, Initialize()).InSequence(seq1);
EXPECT_CALL(mock, Load()).InSequence(seq1, seq2);
EXPECT_CALL(mock, Finalize()).InSequence(seq2);
```

---

## Chained Expectations

You can specify multiple expectations on the same method—with different argument matchers—to precisely control behavioral variations:

```cpp
EXPECT_CALL(mock, Foo(_)).Times(AnyNumber());
EXPECT_CALL(mock, Foo(42)).Times(2).WillRepeatedly(Return(true));
```

The last matching expectation that is still active is used.

---

## Controlling Mock Lifecycle and Verification

By default, GoogleMock verifies expectations when mock objects are destructed. You can also explicitly verify and clear expectations at any time using:

```cpp
Mock::VerifyAndClearExpectations(&mock_object);
Mock::VerifyAndClear(&mock_object);
Mock::AllowLeak(&mock_object);
```

- `VerifyAndClearExpectations`: Check and clear expectations only.
- `VerifyAndClear`: Checks and clears both expectations and default actions.
- `AllowLeak`: Mark mock to suppress leak detection.

<Warning>
Do not set new expectations on a mock after verifying/clearing it; behavior is undefined.
</Warning>

---

## Practical Example: Defining and Using a Mock Class

```cpp
#include <gmock/gmock.h>

class WidgetInterface {
 public:
  virtual ~WidgetInterface() {}
  virtual int GetValue() const = 0;
  virtual void SetValue(int val) = 0;
};

class MockWidget : public WidgetInterface {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int val), (override));
};

TEST(WidgetTest, ValueInteraction) {
  MockWidget mock_widget;

  // Define default action
  ON_CALL(mock_widget, GetValue()).WillByDefault(::testing::Return(10));

  // Set expectations
  EXPECT_CALL(mock_widget, SetValue(::testing::Gt(0))).Times(AtLeast(1));

  // Code under test
  mock_widget.SetValue(42);
  EXPECT_EQ(mock_widget.GetValue(), 10);
}
```

---

## Troubleshooting Common Issues

- **Macro Parsing Errors:** If `MOCK_METHOD` fails to parse due to commas in types, wrap complex types in parentheses or use type aliases.
- **Uninteresting Calls Warnings:** Use `NiceMock` or add catch-all expectations to suppress unwanted warnings.
- **Virtual Destructor Requirement:** Ensure mocked interfaces have virtual destructors to avoid memory issues.
- **Order of Setting Expectations:** Always set `EXPECT_CALL` before exercising the mock.
- **Return of Move-Only Types:** Use lambdas or callable objects with `WillOnce` and `WillRepeatedly` to return new move-only types per call.

---

## Additional Facilities

### `DefaultValue<T>` Class

Change or specialize the default value returned by mock methods of type `T` when no action is specified.

```cpp
::testing::DefaultValue<T>::Set(value);
::testing::DefaultValue<T>::Clear();
```

### `MockFunction<R(Args...)>`

Mock callable objects (like `std::function`) with a `Call` method.

```cpp
MockFunction<int(std::string)> mock_fn;
EXPECT_CALL(mock_fn, Call("hello")).WillOnce(Return(42));
```

---

This reference equips you to define precise, controllable mock classes and actions to simulate and verify interactions with dependencies in C++ tests effectively.

---

<AccordionGroup title="Quick Reference">
<Accordion title="Creating a Mock Class">
See [gMock for Dummies - Writing the Mock Class](https://google.github.io/googletest/gmock_for_dummies.html#WritingTheMockClass) and the “Defining a Mock Class” section for detailed examples.
</Accordion>
<Accordion title="Common Macros and Patterns">
- `MOCK_METHOD` for mock methods
- `EXPECT_CALL` to set expectations
- `ON_CALL` to set default behaviors
- `NiceMock`, `NaggyMock`, and `StrictMock` for mock strictness
- `Sequence` and `InSequence` for ordering calls
- Actions like `Return()`, `Invoke()`, `SetArgPointee()`
</Accordion>
<Accordion title="Best Practices & Tips">
- Always declare mock methods in `public:`
- Use `NiceMock` for suppressing warnings on uninteresting calls
- Set expectations before exercising mocks
- Use `.RetiresOnSaturation()` for non-sticky expectations
- Avoid mocking non-virtual/free functions directly
</Accordion>
</AccordionGroup>

---

## See Also

- [GoogleMock Core Matchers Reference](/api-reference/matcher-and-mocking-apis/core-matchers-reference)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)


<Source url="https://github.com/google/googletest" paths='[{"path": "docs/reference/mocking.md", "range": "1-350"}, {"path": "docs/gmock_cheat_sheet.md", "range": "1-140"}, {"path": "docs/gmock_for_dummies.md", "range": "1-240"}, {"path": "docs/gmock_cook_book.md", "range": "1-570"}]' branch="main" />