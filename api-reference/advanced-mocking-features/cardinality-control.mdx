---
title: "Controlling Call Counts (Cardinalities)"
description: "Reference the API for cardinality specification, such as times(N), AtLeast, AtMost, and custom call count logic. Shows how to apply these to mock method expectations for granular control over allowed or required invocations."
---

# Controlling Call Counts (Cardinalities)

Google Mock provides a powerful and expressive way to specify how many times a mock method is expected or allowed to be called. Cardinalities let you control the invocation count of mock methods, specifying exact or flexible expectations such as "exactly once", "at least N times", "at most N times", or even custom criteria.

This reference guides you through the API and semantics for cardinalities in GoogleMock, demonstrating how to achieve granular control over mock call counts and how to apply these controls to your test expectations.

---

## Overview of Cardinalities

A **cardinality** defines the expected *number* of times a mock function is called. It is used with Google Mock's `EXPECT_CALL` macro via the `.Times()` modifier.

By default, if you omit the `.Times()` clause, GoogleMock infers a cardinality based on the presence and number of `WillOnce()` and `WillRepeatedly()` clauses:
- No `WillOnce` or `WillRepeatedly`: inferred `Times(1)`
- *n* `WillOnce`s but no `WillRepeatedly`: inferred `Times(n)`
- *n* `WillOnce`s and one `WillRepeatedly`: inferred `Times(AtLeast(n))`

You can also explicitly specify the cardinality to precisely control your test expectations.

### Built-in Cardinalities
GoogleMock includes several built-in factory functions to create cardinalities:

| Cardinality              | Description                               |
|--------------------------|-------------------------------------------|
| `Exactly(n)` or `n`       | Expect exactly *n* calls                   |
| `AtLeast(n)`             | Expect *at least* *n* calls                |
| `AtMost(n)`              | Expect *at most* *n* calls                 |
| `Between(m, n)`          | Expect calls between *m* and *n* inclusive|
| `AnyNumber()`            | Allow any number of calls                   |


Example usage:
```cpp
EXPECT_CALL(mock_object, SomeMethod())
    .Times(Exactly(3));  // Expect to be called exactly 3 times

EXPECT_CALL(mock_object, AnotherMethod(_))
    .Times(AtLeast(1)); // Expect at least once

EXPECT_CALL(mock_object, YetAnotherMethod(_))
    .Times(AnyNumber()); // Allow any number of calls
```

## Using Cardinalities in Expectations

When writing `EXPECT_CALL`, you specify the allowable call count using `.Times()`:

```cpp
EXPECT_CALL(mock_obj, Foo(5))
    .Times(AtMost(2))
    .WillRepeatedly(Return(true));
```

This expectation allows up to two calls to `Foo(5)` during the test and returns `true` for each call.

### Omitting `.Times()` Clause

Omitting `.Times()` is common and relies on cardinality inference:

```cpp
EXPECT_CALL(mock_obj, Bar())
    .WillOnce(Return(10))
    .WillOnce(Return(20));
// Implicitly expects Bar() to be called exactly 2 times
```

### Specifying `.Times()` Explicitly

Use explicit cardinalities for clarity and stricter control:

```cpp
EXPECT_CALL(mock_obj, Baz(_))
    .Times(Between(2, 5))
    .WillRepeatedly(Return(false));
```

This allows between 2 to 5 calls to `Baz`, otherwise GoogleMock will report failures.

### Disallowing Calls

To ensure a mock method is *never* called with specific arguments:

```cpp
EXPECT_CALL(mock_obj, ForbiddenMethod(_))
    .Times(0);  // Disallow any calls with any arguments
```

GoogleMock will fail the test immediately if such calls occur.

## Cardinality API Details

GoogleMock’s cardinality logic is defined by the `CardinalityInterface`. All built-in cardinalities derive from this and implement:

- `IsSatisfiedByCallCount(int count)`  — Whether the current call count satisfies the expectation
- `IsSaturatedByCallCount(int count)` — Whether the call count has reached the maximum allowed
- `DescribeTo(std::ostream* os)`        — Emits a human-readable description (used in failure messages)

This design supports implementing custom cardinality criteria as needed.

### Built-in Cardinality Factory Functions

| Function        | Description                                  | Notes                                |
|-----------------|----------------------------------------------|-------------------------------------|
| `Exactly(int n)`  | Exactly `n` calls expected                   | Syntactic sugar for `Between(n, n)` |
| `AtLeast(int n)` | At least `n` calls expected                   | `Between(n, INT_MAX)`                |
| `AtMost(int n)`  | At most `n` calls expected                    | `Between(0, n)`                     |
| `Between(int m, int n)` | Between `m` and `n` calls inclusive       | Validates `0 <= m <= n`             |
| `AnyNumber()`    | Any number of calls                            | Equivalent to `AtLeast(0)`           |

Example:

```cpp
EXPECT_CALL(mock, Func())
    .Times(AtLeast(3));
```

### Custom Cardinalities

When the built-in cardinalities do not suffice, you may implement your own by subclassing `CardinalityInterface`. For example, a custom cardinality that expects calls an even number of times:

```cpp
class EvenNumberCardinality : public testing::CardinalityInterface {
public:
  bool IsSatisfiedByCallCount(int call_count) const override {
    return call_count % 2 == 0;
  }

  bool IsSaturatedByCallCount(int /*call_count*/) const override {
    return false;
  }

  void DescribeTo(std::ostream* os) const override {
    *os << "called even number of times";
  }
};

testing::Cardinality EvenNumber() {
  return testing::MakeCardinality(new EvenNumberCardinality);
}
```

Use as usual:

```cpp
EXPECT_CALL(mock, F())
    .Times(EvenNumber());
```


---

## Practical Guidelines and Best Practices

- **Specify `.Times()` when exact call counts matter.** The default inference is often sufficient, but explicit `Times()` clarifies your intent and helps maintain tests.

- **Use `AnyNumber()` for methods whose calls you neither want to restrict nor count.** This avoids warnings when methods are called unexpectedly but are not relevant to the test.

- **Use `AtLeast()`, `AtMost()`, or `Between()` for flexible expectations.** This is invaluable for tests where precise call counts fluctuate or partial failures are tolerated.

- **Combine cardinalities with sequences or `.After()` constraints** to finely control invocation order and dependencies between calls.

- **Avoid over-specifying calls**: too strict cardinalities make tests brittle and susceptible to break on harmless internal changes.

- **Disallow unwanted calls using `.Times(0)`** to immediately detect invalid behavior.

- When implementing **custom cardinalities**, ensure your predicates are clear and documented for maintainability.

---

## Illustrative Examples

### Basic Cardinality Usage

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, GetCount, (), ());
  MOCK_METHOD(void, SetValue, (int v), ());
};

TEST(FooTest, CardinalityExamples) {
  MockFoo foo;

  // Expect exactly 3 calls to GetCount().
  EXPECT_CALL(foo, GetCount()).Times(3).WillRepeatedly(Return(42));

  // Expect at least once calls to SetValue with any argument.
  EXPECT_CALL(foo, SetValue(testing::_)).Times(testing::AtLeast(1));

  // Allow any number of calls to SetValue(0).
  EXPECT_CALL(foo, SetValue(0)).Times(testing::AnyNumber());

  foo.GetCount();  // 1
  foo.GetCount();  // 2
  foo.GetCount();  // 3

  foo.SetValue(10);
  foo.SetValue(0);
  foo.SetValue(0);
}
```

### Using Between with flexible call counts

```cpp
EXPECT_CALL(foo, Calculate(_))
    .Times(testing::Between(2, 5))
    .WillRepeatedly(testing::Return(100));

// Allows 2 to 5 calls. More or fewer calls will cause failures.
```

### Disallow calls

```cpp
EXPECT_CALL(foo, DangerousMethod(testing::_))
    .Times(0);  // Must not be called

// Calling foo.DangerousMethod() results in test failure.
```

### Custom Even Number Cardinality

```cpp
EXPECT_CALL(foo, Ping())
    .Times(EvenNumber());  // only allows even numbers of calls

// Calls: 0, 2, 4, ... pass; odd calls fail
```

## Common Pitfalls

- **Multiple `.Times()` clauses:** Applying more than one `.Times()` to the same expectation is invalid and will produce runtime errors.

- **Omitting `.WillByDefault()` for `ON_CALL`:** `ON_CALL` requires one `WillByDefault()` clause.

- **Misplaced `.Times()` clauses:** `.Times()` must appear before other clauses like `.InSequence()`, `.WillOnce()`, etc.

- **Unintended exact calls inferred:** Beware that specifying `WillOnce()` clauses without `WillRepeatedly()` or explicit `.Times()` causes GoogleMock to expect exactly those calls; extra calls lead to failures.

- **Over-specifying expectations:** Setting cardinalities too strictly causes flaky tests upon benign changes.

## Debugging Failed Cardinality Checks

GoogleMock reports detailed messages when expectations related to call counts are unmet, including:

- The expected call count and range
- The actual number of calls made
- Whether an expectation is "unsatisfied", "over-saturated", or "retired"

Enable verbose logging using the `--gmock_verbose=info` flag to trace mock calls and clarify mismatch causes.

## Further Reading and References

- [gMock Cookbook: Working with Cardinalities](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#writing-new-cardinalities)
- [Expectations on Call (EXPECT_CALL & ON_CALL)](/api-reference/core-mocking-apis/expectations-on-call)
- [Matchers Reference for Argument Matching](reference/matchers.md)
- [Mock Object Behaviors: Nice, Naggy, Strict](/api-reference/core-mocking-apis/mock-object-behaviors)
- [FAQ: Why do I get unexpected call errors?](/faq/general-usage-faq/core-framework-questions)

---

## Mermaid Diagram: Cardinalities Usage Flow

```mermaid
flowchart TD
  A[Start Writing Expectation] --> B{Specify Cardinality?}
  B -- No --> C[Infer Cardinality (Times(1) or from WillOnce/WillRepeatedly)]
  B -- Yes --> D[Use Cardinality Factory (Exactly, AtLeast, AtMost, Between, AnyNumber)]
  C --> E[Apply Times(Cardinality) Clause]
  D --> E
  E --> F{Call Limit Reached?}
  F -- No --> G[Allow Call, Perform Action]
  F -- Yes --> H[Retire or Error Depending on Cardinality]
  G --> F
  H --> I[Report Failure if Call Exceeds Limits]
```

---

This documentation empowers you with the necessary knowledge to wield cardinalities confidently, tailoring your mock expectations to fit scenarios varying from strict correctness to flexible testing strategies.

---

<Note>
Always define expectations *before* exercising your mock methods. Setting `.Times()` too loosely or inconsistently with actions may lead to unexpected test failures.
</Note>
<Check>
Use `Mock::VerifyAndClearExpectations(mock_obj)` to verify and reset expectations explicitly if your mock object's lifecycle is complex.
</Check>
