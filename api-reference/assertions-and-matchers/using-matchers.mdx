---
title: "Matchers and Custom Matchers"
description: "Explains built-in and user-defined matchers, enabling expressive value comparisons and complex test validation. Includes examples of built-in matchers (Eq, Lt, Regex, etc.) and notes extension techniques for custom matchers."
---

# Matchers and Custom Matchers

GoogleTest's matchers provide a powerful, expressive way to specify expected values in your tests. This page explains both built-in matchers and how you can define your own custom matchers to achieve complex test validation with clear, meaningful diagnostics.

---

## Understanding Matchers

A **matcher** is a predicate object that tests whether a single argument satisfies certain conditions. Matchers are used primarily in GoogleMock calls such as `EXPECT_CALL` and `ON_CALL` to specify argument expectations, but they also work with the `EXPECT_THAT` and `ASSERT_THAT` macros to validate values directly in tests.

Using matchers helps make expectations more readable and failure messages more informative.

---

## Using Built-in Matchers

GoogleTest provides a rich library of built-in matchers that cover most comparison needs out-of-the-box.

### Wildcard Matchers
| Matcher          | Meaning                                         |
|------------------|------------------------------------------------|
| `_`              | Matches any value of the expected type.         |
| `A<T>()` or `An<T>()` | Matches any value of exactly type `T`.         |

#### Example
```cpp
EXPECT_CALL(mock, Foo(_)); // Accepts any argument.
EXPECT_CALL(mock, Foo(A<int>())); // Accepts any int argument.
```

### Generic Comparison Matchers
| Matcher         | Meaning                        |
|-----------------|--------------------------------|
| `Eq(value)` or literal | Matches if `argument == value`. |
| `Ne(value)`      | Matches if `argument != value`. |
| `Lt(value)`      | Matches if `argument < value`.  |
| `Le(value)`      | Matches if `argument <= value`. |
| `Gt(value)`      | Matches if `argument > value`.  |
| `Ge(value)`      | Matches if `argument >= value`. |
| `IsTrue()`       | Matches if `argument` is logically true. |
| `IsFalse()`      | Matches if `argument` is logically false. |
| `IsNull()`       | Matches if `argument` is a null pointer (raw or smart). |
| `NotNull()`      | Matches if `argument` is a non-null pointer. |
| `Optional(m)`    | Matches if an `std::optional` contains a value matching matcher `m`. |
| `VariantWith<T>(m)` | Matches if an `std::variant` holds a value of type `T` matching `m`. |
| `DistanceFrom(target, m)` | Matches if distance (abs diff) from `argument` to `target` matches `m`. |

#### Example
```cpp
EXPECT_CALL(mock, SetValue(Eq(5)));
EXPECT_THAT(val, Ge(10));
EXPECT_THAT(ptr, NotNull());
```

### Floating-Point Matchers
| Matcher                     | Meaning                                                    |
|-----------------------------|------------------------------------------------------------|
| `DoubleEq(x)`               | Matches `double` approximately equal to `x` (disallows NaNs).|
| `FloatEq(x)`                | Matches `float` approximately equal to `x` (disallows NaNs). |
| `NanSensitiveDoubleEq(x)`   | Matches `double` approx equal including NaN comparisons.    |
| `NanSensitiveFloatEq(x)`    | Matches `float` approx equal including NaN comparisons.     |
| `DoubleNear(x, eps)`        | Matches `double` near `x` within `eps`.                      |
| `FloatNear(x, eps)`         | Matches `float` near `x` within `eps`.                       |

### String Matchers
| Matcher                 | Meaning                                      |
|-------------------------|----------------------------------------------|
| `StrEq(s)`              | `argument` is equal to `s` (case-sensitive).|
| `StrNe(s)`              | `argument` is not equal to `s`.              |
| `StrCaseEq(s)`          | `argument` equals `s` ignoring case.         |
| `StrCaseNe(s)`          | `argument` not equals `s` ignoring case.     |
| `HasSubstr(s)`          | `argument` contains `s` as a substring.     |
| `StartsWith(prefix)`    | `argument` starts with `prefix`.             |
| `EndsWith(suffix)`      | `argument` ends with `suffix`.                 |
| `MatchesRegex(regex)`   | `argument` matches regex exactly.            |
| `ContainsRegex(regex)`  | `argument` contains a substring matching regex. |
| `WhenBase64Unescaped(m)`| Matches base64-encoded string whose unescaped value satisfies `m`. |

### Container Matchers
| Matcher                       | Meaning                                             |
|-------------------------------|-----------------------------------------------------|
| `Contains(e)`                | Container has at least one element matching `e`.   |
| `Contains(e).Times(n)`       | Container has exactly `n` matching elements.        |
| `Each(e)`                   | Every element in the container matches `e`.        |
| `ElementsAre(e0, e1, ..., en)` | Container has N+1 elements matching matchers in order. |
| `ElementsAreArray(...)`      | Like `ElementsAre` but from an array or container.   |
| `UnorderedElementsAre(...)`  | Container has elements matching matchers in any order. |
| `UnorderedElementsAreArray(...)` | Like `UnorderedElementsAre` but from an array or container. |
| `IsEmpty()`                  | Container is empty.                                  |
| `IsSubsetOf(...)`            | Container matches subset relation to given collection. |
| `IsSupersetOf(...)`          | Container matches superset relation to given collection. |
| `SizeIs(m)`                  | Container size matches matcher `m`.                 |
| `Pointwise(m, container)`    | Containers have same size and each pair matches tuple matcher `m`. |
| `UnorderedPointwise(m, container)` | As above but ignoring order.                     |

### Member Matchers
| Matcher                       | Meaning                                    |
|-------------------------------|---------------------------------------------|
| `Field(&Class::field, m)`     | Object's field matches `m`.                 |
| `Property(&Class::property, m)` | Returns of property method matches `m`.   |
| `Key(m)`                     | Map/Pair's key matches `m`.                 |
| `Pair(m1, m2)`               | Pair object: first matches `m1`, second matches `m2`. |

### Pointer Matchers
| Matcher                       | Meaning                                   |
|-------------------------------|--------------------------------------------|
| `Pointee(m)`                 | Pointer points to value matching `m`.     |
| `Pointer(m)`                 | Pointer value matches `m` (raw pointer).  |
| `Address(m)`                 | Address of object matches `m`.             |
| `WhenDynamicCastTo<T>(m)`   | Matches if `dynamic_cast<T>(argument)` matches `m`. |

### Composite Matchers
| Matcher                       | Meaning                                    |
|-------------------------------|---------------------------------------------|
| `AllOf(m1, m2, ...)`         | Matches if argument matches *all* matchers.|
| `AnyOf(m1, m2, ...)`         | Matches if argument matches *any* matcher. |
| `Not(m)`                     | Matches if argument does *not* match `m`.  |
| `Conditional(cond, m1, m2)`  | Uses `m1` if condition true, else `m2`.    |

### Using Multi-argument Matchers

Matchers can compare tuples of arguments. These are useful with `.With()` clauses or to match selected arguments.

| Matcher            | Meaning                              |
|--------------------|-------------------------------------|
| `Eq()`             | First tuple element == second tuple element. |
| `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()` | Similar comparisons on tuple elements. |
| `AllArgs(m)`       | Matches all arguments as a tuple with matcher `m`. |
| `Args<N1, N2,...>(m)` | Matches only selected argument indices with `m`. |

---

## Writing Custom Matchers

When built-in matchers arenâ€™t enough, GoogleTest allows you to create custom matchers.

### Basics of Defining a Matcher

Custom matchers are callable objects that test a condition on a value and describe themselves in failure messages. The simplest way to define one is using the `MATCHER` macro:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
```

Usage:

```cpp
EXPECT_CALL(mock, Foo(IsEven()));
EXPECT_THAT(value, IsEven());
```

If the match fails, failure messages will automatically show:

```
Value of: value
Expected: is even
  Actual: 7
```

### Parameterized Matchers

If your matcher needs parameters, use `MATCHER_P`, `MATCHER_P2`, ..., `MATCHER_P10` for multiple parameters:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}
```

Usage:

```cpp
EXPECT_THAT(x, HasAbsoluteValue(10));
```

The failure message will include the parameter values for clarity.

### Building More Complex Matchers

You may provide richer descriptions by:

- Streaming details to `*result_listener` inside the matcher body to explain failure.
- Using `EXPECT_` macros inside the matcher for concise checks and better assertion messages.

Example:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "the remainder is " << (arg % 7);
  return false;
}
```

This outputs detailed diagnostics when assertions fail.

### Implementing Matcher Classes

For advanced usage, you can implement matcher classes by defining methods:

- `bool MatchAndExplain(const T& value, MatchResultListener* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Then create factory functions returning `testing::Matcher<T>` instances.

### Writing Polymorphic Matchers

These can work with multiple types by templating the `MatchAndExplain` method. For example:

```cpp
class NotNullMatcher {
 public:
  template <typename T>
  bool MatchAndExplain(T* p, std::ostream*) const { return p != nullptr; }

  void DescribeTo(std::ostream* os) const { *os << "is not NULL"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }
};

inline testing::PolymorphicMatcher<NotNullMatcher> NotNull() {
  return testing::MakePolymorphicMatcher(NotNullMatcher());
}
```

### Composite Matchers

You can build matchers that wrap other matchers with enhanced behavior or combine several matchers.

---

## Best Practices and Tips

- Use `EXPECT_THAT` with matchers rather than complex Boolean expressions for clearer failures.
- Prefer explicit matchers like `Eq()` when testing equality to avoid surprising implicit conversions.
- Use `ON_CALL` to specify default actions and `EXPECT_CALL` to declare expected calls.
- Define custom matchers to provide detailed failure explanations and to keep tests maintainable.
- Suppress uninteresting call warnings with `NiceMock` or treat them as errors with `StrictMock` carefully.
- For matching members of objects, use `Field()` and `Property()` matchers.
- When matching containers, choose ordered (`ElementsAre`) vs unordered (`UnorderedElementsAre`) matchers depending on your container type.
- Use `Pointee()` matcher to check the value pointed to by raw or smart pointers.

---

## Practical Examples

### Using Built-in Matchers

```cpp
using ::testing::Eq;
using ::testing::Gt;
using ::testing::_;

EXPECT_CALL(mock_obj, SetAge(Gt(18)));
EXPECT_THAT(name, StartsWith("Dr."));
EXPECT_THAT(result, Optional(Eq(42)));
```

### Checking Container Contents

```cpp
#include <vector>
#include <string>
using ::testing::ElementsAre;
using ::testing::Contains;

std::vector<std::string> v = {"foo", "bar", "baz"};
EXPECT_THAT(v, ElementsAre("foo", "bar", "baz"));
EXPECT_THAT(v, Contains("bar"));
```

### Writing a Custom Matcher

```cpp
MATCHER_P(IsDivisibleBy, divisor, "") {
  return (arg % divisor) == 0;
}

EXPECT_THAT(value, IsDivisibleBy(5));
```

If this fails, the output will indicate the remainder:

```
Value of: value
Expected: is divisible by 5
  Actual: 23 (the remainder is 3)
```

---

## Troubleshooting

- **Unexpected mock call failures:** Ensure your matchers match the argument types precisely. Use `SafeMatcherCast` or specify typed matchers to handle type conversions.
- **Uninteresting calls warning:** Use `NiceMock` to suppress warnings or add catch-all `EXPECT_CALL`s.
- **Custom matcher error messages missing:** Use `result_listener` stream inside matcher for detailed explanations.
- **Matching pointer values:** Use `Pointee()` to match the pointed-to value; `IsNull()` and `NotNull()` for null pointer checks.

---

## Additional Resources

- [GoogleTest Assertions Reference](../reference/assertions.md) - for using matchers inside assertions.
- [Matchers Reference](../reference/matchers.md) - a detailed list of all built-in matchers.
- [gMock Cookbook](gmock_cook_book.md) - for practical recipes including defining mocks and custom matchers.
- [Advanced GoogleTest Topics](../advanced.md#writing-new-matchers) - for custom and polymorphic matcher creation.
- [GoogleMock README](googlemock/README.md) - overview and introduction to mocking.

---

You can apply matchers with macros like `EXPECT_THAT(value, matcher)`, enabling expressive, maintainable, and informative tests. For complex conditions, custom matchers are the best tool to keep tests clear and diagnostic-rich.
