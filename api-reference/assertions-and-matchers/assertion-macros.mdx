---
title: "Assertions: Macros and Predicate Utilities"
description: "Lists all standard assertion macros (EXPECT_*, ASSERT_*, etc.), their expected behaviors, and guidance on using predicates and custom assertion result types, to allow full control over test outcomes and messages."
---

# Assertions: Macros and Predicate Utilities

This page documents the comprehensive set of standard assertion macros provided by GoogleTest, detailing their expected behaviors and guidance on using predicate assertions and custom assertion result types. These facilities empower you to fully control test outcomes and tailor failure messages for maximum clarity.

To use the assertions documented here, include:

```cpp
#include <gtest/gtest.h>
```

---

## Overview of Assertion Macros

GoogleTest assertions come primarily in pairs:

- **`EXPECT_*`**: generates a nonfatal failure and lets the test continue.
- **`ASSERT_*`**: generates a fatal failure and aborts the current function.

All assertion macros support appending custom failure messages by streaming into them using the `<<` operator, e.g.:

```cpp
EXPECT_TRUE(my_condition) << "Custom failure message";
```

This lets you provide context to aid debugging directly at the failure point.

---

## Assertion Categories

### 1. Explicit Success and Failure
These macros let you mark explicit success or failure points in your code, useful when control flow determines test success.

- **`SUCCEED()`**
  - Marks an explicit success; does **not** cause the test to succeed by itself.
  - Currently produces no output but documents intentions clearly.

- **`FAIL()`**
  - Generates a fatal failure and aborts the current `void` function.

- **`ADD_FAILURE()`**
  - Generates a nonfatal failure, allowing test execution to continue.

- **`ADD_FAILURE_AT(file, line)`**
  - Generates a nonfatal failure reported at the specified *file* and *line number*.

#### Usage Example:

```cpp
switch (code) {
  case 1: ...; break;
  case 2: ...; break;
  default:
    FAIL() << "Unexpected code path.";
}
```

---

### 2. Generalized Assertions Using Matchers

- **`EXPECT_THAT(value, matcher)`**
- **`ASSERT_THAT(value, matcher)`**

Use these to assert that a *value* matches a [gMock matcher](matchers.md). Matchers read like expressive English statements and produce detailed failure reports.

#### Example:

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_message, MatchesRegex("Error \d+"));
ASSERT_THAT(value, AllOf(Gt(10), Lt(20)));  // value > 10 && < 20
```

If the assertion fails, the output clearly shows the *actual* and *expected* states.

---

### 3. Boolean Condition Assertions
These assertions check Boolean expressions or predicates.

- **`EXPECT_TRUE(condition)`**
- **`ASSERT_TRUE(condition)`**
- **`EXPECT_FALSE(condition)`**
- **`ASSERT_FALSE(condition)`**

If conditions evaluate to the wrong Boolean value, failure messages show the expression, its evaluated value, and optionally associated custom messages.

---

### 4. Binary Comparison Assertions
Verify relational or equality comparisons between two values.

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` — tests `val1 == val2`
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` — tests `val1 != val2`
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)` — tests `val1 < val2`
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)` — tests `val1 <= val2`
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)` — tests `val1 > val2`
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)` — tests `val1 >= val2`

Pointers are compared by address. Use special string comparison macros for C strings.

**Note:** Arguments are evaluated exactly once; they must be side-effect free or safe.

---

### 5. C-String Equality and Inequality Assertions
For comparing C-style strings (including `const char*` and wide strings).

- `EXPECT_STREQ(s1, s2)` / `ASSERT_STREQ(s1, s2)` — s1 and s2 have the same content.
- `EXPECT_STRNE(s1, s2)` / `ASSERT_STRNE(s1, s2)` — s1 and s2 differ in content.
- `EXPECT_STRCASEEQ(s1, s2)` / `ASSERT_STRCASEEQ(s1, s2)` — equal ignoring case.
- `EXPECT_STRCASENE(s1, s2)` / `ASSERT_STRCASENE(s1, s2)` — not equal ignoring case.

If wide strings are used, values are converted and printed in UTF-8.

---

### 6. Floating-Point Comparison Assertions
Due to floating-point rounding, exact equality checks are not reliable for floats/doubles. Use these specialized assertions:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)` — approximately equal `float`s within 4 ULPs.
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)` — approximately equal `double`s within 4 ULPs.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)` — difference does not exceed *abs_error*.

Infinity values and NaNs are handled gracefully with clear failure outputs.

---

### 7. Exception Assertions
Requires exceptions enabled for your build.

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(statement, exception_type)` — asserts `statement` throws exception of specified type.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(statement)` — asserts `statement` throws any exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(statement)` — asserts `statement` does **not** throw.

You can wrap multiple statements in braces `{ ... }` to test compound statements.

Example:

```cpp
EXPECT_NO_THROW({
  int x = 1;
  FuncThatShouldNotThrow(x);
});
```

---

### 8. Predicate Assertions
Useful for verifying complex predicate functions and receiving detailed failure messages showing argument values.

#### `EXPECT_PREDn` and `ASSERT_PREDn` (n=1 to 5)

These macros take a predicate and the appropriate number of arguments:

```cpp
EXPECT_PRED2(pred_func, val1, val2);
ASSERT_PRED3(pred_func, val1, val2, val3);
```

- The predicate returns `bool`. If it returns `true`, the assertion passes.
- On failure, the macro prints the predicate call and the values of the arguments.

If your predicate is overloaded or a template, you may need to supply explicit casts or template arguments to disambiguate.

#### `EXPECT_PRED_FORMATn` and `ASSERT_PRED_FORMATn` (n=1 to 5)

For more control over failure messages, define a *predicate-formatter* function returning `testing::AssertionResult`. It has signature:

```cpp
testing::AssertionResult MyPredicateFormatter(
    const char* expr1, const char* expr2, ..., 
    T1 val1, T2 val2, ...);
```

- The first arguments are the source expressions as strings; the rest are the evaluated values.
- Return `AssertionSuccess()` on pass, or `AssertionFailure() << "message"` on fail.

Usage:

```cpp
EXPECT_PRED_FORMAT2(MyPredicateFormatter, val1, val2);
```

##### Example Predicate-Formatter:
```cpp
testing::AssertionResult AssertMutuallyPrime(const char* m_expr,
                                             const char* n_expr,
                                             int m, int n) {
  if (MutuallyPrime(m, n))
    return testing::AssertionSuccess();
  return testing::AssertionFailure() << m_expr << " and " << n_expr
      << " (" << m << " and " << n << ") are not mutually prime.";
}
```

---

### 9. Windows HRESULT Assertions
For Windows applications, you can verify that COM-style `HRESULT` values indicate success or failure, with failure messages printing readable errors.

- `EXPECT_HRESULT_SUCCEEDED(expression)` / `ASSERT_HRESULT_SUCCEEDED(expression)` — expects a success HRESULT.
- `EXPECT_HRESULT_FAILED(expression)` / `ASSERT_HRESULT_FAILED(expression)` — expects a failure HRESULT.

Example:
```cpp
ASSERT_HRESULT_SUCCEEDED(shell.CoCreateInstance(L"Shell.Application"));
```

---

### 10. Death Assertions
Used to verify that code causes the process to terminate (crash), useful for testing error or consistency checks.

These spawn a new process to run the code under test.

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)`
- `EXPECT_DEATH_IF_SUPPORTED(statement, matcher)` / `ASSERT_DEATH_IF_SUPPORTED(statement, matcher)`
- `EXPECT_DEBUG_DEATH(statement, matcher)` / `ASSERT_DEBUG_DEATH(statement, matcher)`
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT(statement, predicate, matcher)`

`matcher` tests `stderr` output; can be a regex or a gMock matcher.

`predicate` checks exit status for `EXPECT_EXIT`/`ASSERT_EXIT`.

Example:
```cpp
EXPECT_DEATH(
  FooCrash(),
  "Error on line .*"
);
```

---

## Practical Tips and Best Practices

- Prefer `EXPECT_*` macros to allow a test to continue checking other assertions after a failure.
- Use `ASSERT_*` when subsequent code in the test should not run if an assertion fails.
- When comparing C strings, prefer `EXPECT_STREQ` / `ASSERT_STREQ` over `EXPECT_EQ` to compare **content**, not addresses.
- For complex conditions, use predicate assertions (`EXPECT_PRED*`) for better failure messages.
- Define predicate-formatter functions (`EXPECT_PRED_FORMAT*`) to customize assertion failure messages when predicates involve complex logic or argument types.
- Use `FAIL()` and `ADD_FAILURE()` to handle unexpected conditions and to signal nonfatal errors respectively.
- Stream messages into your assertions to provide extra diagnostic context.
- Pay attention to assertion placement — fatal assertions (`ASSERT_*`, `FAIL()`) must be used in `void` functions.
- For testing exceptions, use `EXPECT_THROW`, `EXPECT_ANY_THROW`, and `EXPECT_NO_THROW` with exception support enabled.
- When dealing with floating-point comparisons, prefer `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` to manage rounding errors and precision.

---

## Examples

### Using Basic Assertions

```cpp
TEST(FactorialTest, HandlesZeroAndPositive) {
  EXPECT_EQ(Factorial(0), 1);
  ASSERT_EQ(Factorial(3), 6) << "Factorial of 3 should be 6";
}
```

### Using Predicate Assertions

```cpp
// Binary predicate function
bool IsSumPositive(int a, int b) { return (a + b) > 0; }

TEST(PredicateExample, SumPositive) {
  EXPECT_PRED2(IsSumPositive, 3, 4);  // Passes
  EXPECT_PRED2(IsSumPositive, -5, 2);  // Fails with message including args
}
```

### Using Predicate-Format Assertions

```cpp
// Custom predicate-formatter
::testing::AssertionResult IsEvenPredicate(const char* expr, int n) {
  if (n % 2 == 0) return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << expr << " is odd, value: " << n;
}

TEST(PredicateFormatExample, Evenness) {
  EXPECT_PRED_FORMAT1(IsEvenPredicate, 4);  // Passes
  EXPECT_PRED_FORMAT1(IsEvenPredicate, 3);  // Fails with detailed message
}
```

---

## Troubleshooting

- **Problem:** Assertion failure messages are unclear or don't show values.
  - **Solution:** Use predicate assertions (`EXPECT_PRED*`) or predicate-format assertions (`EXPECT_PRED_FORMAT*`) to produce detailed messages showing argument values.

- **Problem:** Fatal assertions (`ASSERT_*`) used in non-void functions cause compiler errors.
  - **Solution:** Only use fatal assertions in `void` functions. For non-void functions, use nonfatal assertions (`EXPECT_*`) or refactor code.

- **Problem:** Comparing string pointers yields unexpected behavior.
  - **Solution:** Use string content comparison macros like `EXPECT_STREQ` / `ASSERT_STREQ` for C strings.

- **Problem:** Floating-point comparisons fail unexpectedly.
  - **Solution:** Replace `EXPECT_EQ` with `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` to allow for small rounding errors.

- **Problem:** Overloaded or templated predicate functions do not compile with predicate macros.
  - **Solution:** Explicitly cast predicate functions and specify template parameters as needed.

- **Problem:** Complex failure messages desired for predicates with non-streamable arguments.
  - **Solution:** Implement a predicate-formatter that returns `testing::AssertionResult` and provides a custom message.

---

For a complete list of assertions and detailed explanations of their behaviors, visit the [Assertions Reference](reference/assertions.md).

---

## Related Documentation

- **[Core Testing Concepts](../overview/core_fundamentals/core_concepts.md)** — foundational information on tests and assertions.
- **[Using Assertions](reference/assertions.md)** — full list and in-depth details of assertion macros.
- **[Predicate Assertions Guide](advanced.md#predicate-assertions-for-better-error-messages)** — practical guide on writing advanced predicate assertions.
- **[Writing Your First Test](../getting-started/first-test-and-validation/writing-your-first-test.md)** — for beginners focusing on test structure and basic assertions.
- **[Matchers Reference](matchers.md)** — for understanding and creating matchers used with `EXPECT_THAT`.
- **[Exception Assertions](reference/assertions.md#exceptions)** — detailed info on exception assertion uses.

---

The contents empower you to write expressive, precise tests with controlled outcomes, utilizing expressive assertions and predicate utilities that improve failure diagnosis and test clarity.