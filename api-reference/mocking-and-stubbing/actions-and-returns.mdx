---
title: "Actions & Custom Return Values"
description: "API documentation and examples for defining and customizing the actions a mock method performs, including returning values, invoking callbacks, and chaining actions. Features core and advanced action templates, as well as 'InvokeArgument', and multi-value action strategies."
---

# Actions & Custom Return Values

Explore how to define and customize the behaviors a mock method performs using GoogleMock. This guide details core and advanced action templates that shape mock method responses, including returning static or dynamic values, invoking callbacks, chaining multiple actions, manipulating output parameters, and using the specialized `InvokeArgument` action.

---

## Overview

In GoogleMock, **actions** specify the behavior of mock methods when called. Beyond simply returning a value, actions can:

- Return fixed or varying results (including references, pointers, or newly allocated objects).
- Execute side effects such as modifying output parameters.
- Invoke callbacks or function arguments passed to mock methods.
- Chain multiple actions to perform complex sequences.
- Customize behavior based on function arguments.

Setting actions allows tests to express what a mock method does, making mocks powerful tools for verifying interactions, simulating complex behaviors, and driving test logic.

---

## Core Action Templates

These foundational action templates help you quickly define common mock behaviors.

### Returning Values

#### Return()
- Returns from a `void` mock method.
- Example:
```cpp
EXPECT_CALL(mock, SomeVoidMethod()).WillOnce(Return());
```

#### Return(value)
- Returns the specified `value`.
- The `value` is converted to the method's return type **at the time the expectation is set**, not during execution.
- Example:
```cpp
EXPECT_CALL(mock, GetInt()).WillOnce(Return(42));
```

#### ReturnRef(variable)
- Returns a **reference** to the given variable.
- Useful when mocking methods returning references.
- Example:
```cpp
int x = 5;
EXPECT_CALL(mock, GetRef()).WillOnce(ReturnRef(x));
```

#### ReturnPointee(pointer)
- Returns the value pointed to by a pointer at the time the action is executed.
- Solves issues of returning live values instead of copies.
- Example:
```cpp
int x = 10;
EXPECT_CALL(mock, GetValue()).WillRepeatedly(ReturnPointee(&x));
x = 20;
EXPECT_EQ(20, mock.GetValue());
```

#### ReturnNew<T>(args...)
- Creates and returns a new `T` object with given constructor arguments on each call.
- Each call returns a fresh dynamically allocated object.
- Example:
```cpp
EXPECT_CALL(mock, MakeObj())
    .WillRepeatedly(ReturnNew<MyObj>(42, "data"));
```

#### ReturnNull()
- Returns a null pointer (raw or smart pointer types).
- Example:
```cpp
EXPECT_CALL(mock, GetPtr()).WillRepeatedly(ReturnNull());
```

#### ReturnRoundRobin({a1, ..., an})
- Cycles through a list of return values on successive calls.
- Useful for cyclic behavior simulation.
- Example:
```cpp
EXPECT_CALL(mock, GetStatus())
    .WillRepeatedly(ReturnRoundRobin({OK, ERROR, RETRY}));
```

### Side Effect Actions

#### Assign(&variable, value)
- Assigns `value` to the variable.
- Example:
```cpp
int flag = 0;
EXPECT_CALL(mock, SetFlag())
    .WillOnce(Assign(&flag, 1));
```

#### SetArgPointee<N>(value)
- Dereferences the N-th argument (0-based) and sets the pointee to `value`.
- Ideal for simulating `out` parameters.
- Safe for pointer and iterator arguments.
- Example:
```cpp
EXPECT_CALL(mock, FillBuffer(_, _))
    .WillOnce(SetArgPointee<1>(42));
```

#### DeleteArg<N>()
- Deletes the N-th argument assuming it is a pointer.
- Use with caution: ensures proper cleanup of dynamically allocated objects passed in.
- Example:
```cpp
EXPECT_CALL(mock, ProcessPtr(_))
    .WillOnce(DeleteArg<0>());
```

### Composite Action

#### DoAll(action1, action2, ..., actionN)
- Performs each action sequentially every time the mock method is called.
- All but the last must return `void`.
- The return value of the last action is the mock method's return value.
- Use to combine side effects and return values.
- Example:
```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoAll(
        SetArgPointee<0>(42),
        Return(true)));
```

### Ignoring Results

#### IgnoreResult(action)
- Executes `action` but discards its return value.
- Useful when the mock method returns void but the action returns something.
- Example:
```cpp
EXPECT_CALL(mock, VoidMethod())
    .WillOnce(IgnoreResult(Return(5)));  // Discards the return value 5.
```

---

## Using Function Objects and Callables as Actions

You may use functions, methods, functors, or lambdas wherever an action is expected.

- The callable must be compatible with the mock method signature (arguments convertible, return type convertible).
- You can ignore unused arguments by declaring them as `::testing::Unused`.
- Examples:

```cpp
int Add(int a, int b) { return a + b; }

EXPECT_CALL(mock, Sum(_, _))
    .WillOnce(&Add);

EXPECT_CALL(mock, ProcessData(_))
    .WillOnce([](const Data& d) { return d.IsValid(); });
```

You can also use member functions or methods:

```cpp
class Helper {
 public:
  bool Validate(int n);
};

Helper helper;
EXPECT_CALL(mock, Check(_))
    .WillOnce(Invoke(&helper, &Helper::Validate));
```

### InvokeWithoutArgs(callable)

Invokes a callable **without any arguments**, ignoring the mock method's arguments.

Example:

```cpp
bool DoSomething() { return true; }
EXPECT_CALL(mock, Run()).WillOnce(InvokeWithoutArgs(DoSomething));
```

---

## Advanced Action Templates

These templates support more complex mocking scenarios.

### InvokeArgument<N>(args...)

Invokes the mock method's N-th argument (0-based), which must be callable, with the supplied arguments.

- Use to simulate callback invocations passed as mock arguments.
- Args passed by value unless wrapped in `std::ref()` to pass by reference.

Example:

```cpp
EXPECT_CALL(mock, DoWork(_,_))
    .WillOnce(InvokeArgument<1>(5, std::ref(obj)));
```

This will invoke the second argument (callable) by calling it with `5` and `obj`.

### WithArg<N>(action)

Passes the N-th argument of the mock function to the `action`.

- Useful when the inner action only cares about a single argument.

Example:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(WithArg<0>(Invoke(&helper, &Helper::Process)));
```

### WithArgs<N1, N2, ..., Nk>(action)

Passes selected arguments from the mock function call to the inner `action`.

- Arguments can be repeated or reordered.

Example:

```cpp
EXPECT_CALL(mock, Bar(_, _, _))
    .WillOnce(WithArgs<2, 0>(Invoke(&cmp, &Cmp::Compare)));
```

---

## Best Practices & Common Pitfalls

- **Specify only what's necessary in arguments**: Use `_` matchers for flexibility.
- **Order your expectations with care**: Newer matching expectations override older ones.
- **Use `RetiresOnSaturation()` to deactivate expectations when done** to avoid saturation errors.
- **Be mindful when using `Return(value)` with move-only values**: The returned object is moved once; subsequent calls will cause undefined behavior.
- **Use lambdas or functors to generate fresh objects or unique pointers** each call.
- **Use `InvokeArgument` carefully when callbacks have reference parameters**: wrap reference arguments in `std::ref()` to avoid copying.
- **Chain side effects and return values with `DoAll`** when needed.
- **Suppress warnings for uninteresting calls using `NiceMock` or explicit `EXPECT_CALL(...).Times(AnyNumber())`**.

---

## Example: Combining Actions for Complex Behavior

```cpp
class MockProcessor {
 public:
  MOCK_METHOD(bool, Process, (int input, int* output), (override));
};

TEST(ExampleTest, ComplexAction) {
  MockProcessor mock;

  EXPECT_CALL(mock, Process(_, _))
      .WillOnce(
          DoAll(
              SetArgPointee<1>(123),  // Set output parameter
              Return(true)            // Return true from Process
          ));

  int out = 0;
  bool result = mock.Process(10, &out);

  EXPECT_TRUE(result);
  EXPECT_EQ(123, out);
}
```

This example shows a mock method with an output parameter and a return value, handled together with `DoAll`.

---