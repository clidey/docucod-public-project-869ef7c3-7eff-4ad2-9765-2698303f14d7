---
title: "Specifying Actions"
description: "Details APIs for defining and combining actions (e.g., return values, invoke callables, side effects) with your mocks. Includes high-utility macros and templates to control mock response behaviors flexibly."
---

# Specifying Actions

This page details how to define and combine actions that specify the behavior of mock methods in GoogleMock. Actions control what a mock function does when called, from returning values to invoking arbitrary callables or modifying arguments. With a rich set of built-in actions, users can flexibly model complex behaviors in their mocks.


## Overview of Mock Actions

Actions specify the behavior a mock method should execute when it is called during testing. They can:

- Return specific values or references
- Perform side effects such as modifying arguments
- Invoke given functions, methods, lambdas, or functors
- Compose multiple sub-actions into sequences

Actions are used primarily in conjunction with `EXPECT_CALL` and `ON_CALL` macros to define mock behavior.


## Returning Values

GoogleMock provides several built-in actions to return various types of values from mock methods:

| Action                         | Description |
|-------------------------------|-------------|
| `Return()`                    | Return from a `void` mock function.
| `Return(value)`               | Return the specified `value`, converted if needed when expectation is set.
| `ReturnArg<N>()`              | Return the N-th argument passed to the mock method.
| `ReturnNew<T>(a1, ..., ak)`  | Return a new instance of type `T` constructed with the provided arguments.
| `ReturnNull()`                | Return a null pointer.
| `ReturnPointee(ptr)`          | Return the value pointed to by the pointer `ptr` at call time.
| `ReturnRef(variable)`         | Return a reference to the specified variable.
| `ReturnRefOfCopy(value)`      | Return a reference to a copy of `value`.
| `ReturnRoundRobin({a1, ..., ak})` | On each call, return next element in the given list cycling back when exhausted.


### Example:
```cpp
using ::testing::Return;

EXPECT_CALL(mock, Foo())
    .WillOnce(Return(1))
    .WillRepeatedly(Return(2));
```
This example returns `1` on the first call and `2` thereafter.


## Side Effects

Actions can also produce side effects such as setting output arguments, saving arguments, deleting pointers, or throwing exceptions.

Common side effect actions include:

| Action                          | Description |
|--------------------------------|-------------|
| `Assign(&variable, value)`      | Assign `value` to `variable`.
| `DeleteArg<N>()`                | Delete the N-th (0-based) pointer argument.
| `SaveArg<N>(pointer)`           | Copy-assign the N-th argument to the pointed location.
| `SaveArgByMove<N>(pointer)`     | Move-assign the N-th argument.
| `SaveArgPointee<N>(pointer)`    | Save the value pointed to by the N-th argument.
| `SetArgReferee<N>(value)`       | Assign `value` to the reference at argument N.
| `SetArgPointee<N>(value)`       | Assign `value` to the pointee at argument N.
| `SetArrayArgument<N>(first, last)` | Copy elements from range `[first, last)` to array pointer at argument N.
| `SetErrnoAndReturn(error, value)` | Set `errno` and return `value`.
| `Throw(exception)`              | Throw the given exception.


### Example:
```cpp
using ::testing::SetArgPointee;
using ::testing::Return;

EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(42), Return(true)));
```
This side-effect sets the second argument pointed-to value to 42 and returns true.


## Using Existing Functions, Functors, or Lambdas as Actions

GoogleMock enables invoking any callable object when a mock method is called. This includes:

- Free functions
- Lambdas
- Member functions
- Functors

This capability makes it easy to reuse existing functions as mock behaviors.

### Invocation modes:

| Action                         | Description |
|-------------------------------|-------------|
| `Invoke(f)`                   | Calls callable `f` with the mock function's arguments.
| `Invoke(object_pointer, &class::method)` | Calls method on the given object with the mock's arguments.
| `InvokeWithoutArgs(f)`        | Invokes callable `f` with no arguments.
| `InvokeWithoutArgs(object_ptr, &class::method)` | Invokes no-argument method on object.
| `InvokeArgument<N>(args...)`  | Invokes the N-th (0-based) argument assuming it is a callable, forwarding `args...`.


### Important:
- When passing arguments by reference to `InvokeArgument`, wrap them using `std::ref()` to ensure references are preserved.
- Callables can ignore extra arguments if they don't use them.

### Example:
```cpp
using ::testing::Invoke;

int Add(int x, int y) { return x + y; }

EXPECT_CALL(mock, Compute(_, _))
    .WillOnce(Invoke(Add));
```


## Default Action

`DoDefault()` executes the default action set by `ON_CALL()` or the built-in default if none is set. Note that it cannot be used inside composite actions.


## Composite Actions

Sometimes you want a mock method to execute multiple actions in a single call. Composite actions let you do this.

| Action                         | Description |
|-------------------------------|-------------|
| `DoAll(a1, a2, ..., an)`      | Performs actions `a1` through `an` in order, returning the result of `an`. The first n-1 actions must return void.
| `IgnoreResult(a)`             | Invokes action `a` but ignores its result. Useful when action returns non-void and void is required.
| `WithArg<N>(a)`               | Pass the N-th argument of the mock function to action `a`.
| `WithArgs<N1, N2, ..., Nk>(a)` | Pass multiple selected arguments to action `a`.
| `WithoutArgs(a)`              | Invoke action `a` with no arguments.


### Example:
```cpp
EXPECT_CALL(mock, Func(_))
    .WillOnce(DoAll(SetArgPointee<0>(7), Return(true)));
```
Sets the pointed-to first argument to 7, then returns true.


## Defining New Actions

GoogleMock lets you define custom actions if built-in ones don't meet your needs.

### Simple ways:
- Use lambdas or functors with compatible signatures with the mock method.

### Legacy macros:
- `ACTION(name)` defines a parameterless action.
- `ACTION_P(name, param)` defines a parameterized action.
- `ACTION_Pk(name, p1, ..., pk)` defines multi-parameter parameterized actions.

Inside the action body, you can access mock function arguments as `arg0`, `arg1`, ...


### Example:
```cpp
ACTION(IncrementArg1) {
  return ++(*arg1);
}
EXPECT_CALL(mock, Foo()).WillOnce(IncrementArg1());
```

### Advanced:
Implement the `ActionInterface<F>` template for the mock function type `F`.

### Polymorphic actions:
- Implementations can be made polymorphic, usable with multiple function signatures using `MakePolymorphicAction()`.


## Best Practices and Tips

- When returning live values, use `ReturnPointee()` to defer evaluation until action execution time.
- Use `IgnoreResult()` when combining actions where one returns a non-void value but a void is expected.
- Use `WithArgs` and `WithArg` to adapt argument lists for inner actions.
- Wrap arguments with `std::ref()` when they need to be passed by reference in `InvokeArgument`.
- Avoid sharing stateful action objects across expectations unless intended.


## Summary of Key Built-in Actions

<AccordionGroup title="Built-in Actions Summary">
<Accordion title="Return Actions">
Return, ReturnArg, ReturnNew, ReturnNull, ReturnPointee, ReturnRef, ReturnRefOfCopy, ReturnRoundRobin
</Accordion>
<Accordion title="Side Effect Actions">
Assign, DeleteArg, SaveArg, SaveArgByMove, SaveArgPointee, SetArgReferee, SetArgPointee, SetArrayArgument, SetErrnoAndReturn, Throw
</Accordion>
<Accordion title="Callable Invocation Actions">
Invoke, InvokeWithoutArgs, InvokeArgument
</Accordion>
<Accordion title="Composite Actions">
DoAll, IgnoreResult, WithArg, WithArgs, WithoutArgs
</Accordion>
</AccordionGroup>


---

### Example: Using Various Actions Together
```cpp
using ::testing::_;                  // Wildcard matcher
using ::testing::DoAll;
using ::testing::Invoke;
using ::testing::Return;
using ::testing::SetArgPointee;

class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& host), ());
  MOCK_METHOD(bool, Query, (const std::string& query, int* result_count), ());
};

bool FakeConnect(const std::string& host) {
  return !host.empty();
}

TEST(DatabaseTest, Example) {
  MockDatabase db;

  ON_CALL(db, Connect(_)).WillByDefault(Invoke(FakeConnect));

  EXPECT_CALL(db, Query(_,_))
      .WillOnce(DoAll(SetArgPointee<1>(42), Return(true)));

  EXPECT_TRUE(db.Connect("localhost"));

  int results = 0;
  EXPECT_TRUE(db.Query("SELECT * FROM users", &results));
  EXPECT_EQ(42, results);
}
```

---

## Troubleshooting

- **Common Pitfall:** Using `Return()` to return move-only types repeatedly causes runtime errors because the moved-from object is empty after the first call. Instead, use lambdas to create new objects on each call.
- **Error:** `IgnoreResult()` requires a non-void returning action. Applying it to void-returning actions triggers compilation errors.
- **Unexpected Behavior:** Forgetting to wrap arguments by `std::ref()` in `InvokeArgument` when the callable expects a reference leads to unexpected copies.
- **Action Overflow:** Specifying more `WillOnce` actions than the expected call count leads to GoogleMock warnings.
- **Order of Modifiers:** Clauses on `EXPECT_CALL` and `ON_CALL` must follow the specified order. For example, `With()` must appear first.


For detailed diagnostics, use the `--gmock_verbose=info` command-line flag to see call traces.


## See Also

- [Mock Object Definition](/api-reference/mocking-api/mock-object-definition)
- [Expectations and Cardinalities](/api-reference/mocking-api/expectations-cardinalities)
- [Argument Matchers](/api-reference/matchers-actions-api/argument-matchers)
- [Mock Object Strictness Policies](/api-reference/mocking-api/nice-strict-mocks)
- [Matchers Reference](/api-reference/matchers-actions-api/argument-matchers)
- [Mocking Basics Guide](/guides/core-testing-workflows/mocking-basics)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)


## Source

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/actions.md", "range": "1-197"}]} />
<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/mocking.md", "range": "1-622"}]} />

