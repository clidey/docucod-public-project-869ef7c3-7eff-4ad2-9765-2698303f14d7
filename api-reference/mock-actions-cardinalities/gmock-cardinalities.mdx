---
title: "Cardinalities and Call Counts"
description: "Reference on specifying how many times mock methods are expected to be called (e.g., any number, exactly n, at least/most n), with practical examples for robust expectation management."
---

# Cardinalities and Call Counts

## Overview

In GoogleMock, cardinalities define how many times a mock method is expected to be called during a test. They help you precisely specify expectations ranging from 'any number of times' to 'exactly N times,' or a bounded range including 'at least' and 'at most' constraints. This page provides comprehensive guidance on specifying and understanding call counts with cardinalities, enriched with practical examples to write robust and maintainable tests.

---

## Understanding Cardinalities

A **Cardinality** in GoogleMock represents the number of calls a mock method is expected to receive. They are primarily used in the `.Times()` clause of `EXPECT_CALL()` statements to control how strictly you test the number of method invocations.

### Built-in Cardinalities

GoogleMock provides five main built-in cardinalities, all accessible via the `testing` namespace:

| Cardinality    | Meaning                                                   |
| -------------- | ----------------------------------------------------------|
| `AnyNumber()`  | The method can be called any number of times, including zero. |
| `AtLeast(n)`   | Expect the method to be called at least `n` times.         |
| `AtMost(n)`    | Expect the method to be called at most `n` times.          |
| `Between(m, n)`| Expect the method to be called at least `m` and at most `n` times. |
| `Exactly(n)` or `n` | Expect the method to be called exactly `n` times. If `n` is 0, the method should never be called. |

### Notes on Using Cardinalities

- If you omit the `.Times()` clause, GoogleMock infers the expected call count based on how many `.WillOnce()` and `.WillRepeatedly()` clauses you specify:
  - No action clauses: inferred as exactly one call (`Times(1)`).
  - `n` `.WillOnce()` clauses but no `.WillRepeatedly()`: inferred as `Times(n)`.
  - `n` `.WillOnce()` clauses and one `.WillRepeatedly()`: inferred as `Times(AtLeast(n))`.

- You can combine multiple expectations on the same method to cover different call counts or argument sets.
- Expectations in GoogleMock are "sticky" by default, meaning they remain active even after reaching their upper call bound, unless explicitly retired.

## Specifying Cardinalities with Examples

The following sections illustrate how to specify these cardinalities in your tests with actionable examples.

### AnyNumber()

Use `AnyNumber()` when you don't care how many times a mock method is called.

```cpp
using ::testing::AnyNumber;

EXPECT_CALL(mock_object, SomeMethod(_))
    .Times(AnyNumber()); // Accept zero or more calls

// Example usage:
// This call count is expected and allowed.
mock_object.SomeMethod(5);
mock_object.SomeMethod(10);
```

> **Tip:** Using `Times(AnyNumber())` is common to suppress warnings related to uninteresting calls.

### AtLeast(n)

The `AtLeast(n)` cardinality asserts the method will be called at least `n` times.

```cpp
using ::testing::AtLeast;

EXPECT_CALL(mock_object, SomeMethod(_))
    .Times(AtLeast(3)); // Expect 3 or more calls

// Tests fail if called less than 3 times.
mock_object.SomeMethod(1);
mock_object.SomeMethod(2);
mock_object.SomeMethod(3);
mock_object.SomeMethod(4); // Additional calls are fine.
```

> **Warning:** Passing a negative number to `AtLeast()` will terminate the test with an error.

### AtMost(n)

`AtMost(n)` allows you to assert the method will be called at most `n` times.

```cpp
using ::testing::AtMost;

EXPECT_CALL(mock_object, SomeMethod(_))
    .Times(AtMost(2)); // Expect at most 2 calls

mock_object.SomeMethod(1);
mock_object.SomeMethod(2);
// A 3rd call will cause failure
// mock_object.SomeMethod(3);  // This will fail
```

> **Warning:** Providing a negative value to `AtMost()` results in a run-time error.

### Between(m, n)

The `Between(m, n)` cardinality restricts call counts to a closed interval `[m, n]`.

```cpp
using ::testing::Between;

EXPECT_CALL(mock_object, SomeMethod(_))
    .Times(Between(2, 4)); // Expect between 2 and 4 calls inclusive

mock_object.SomeMethod(1);
mock_object.SomeMethod(2);
mock_object.SomeMethod(3);
// Calling less than 2 or more than 4 will result in test failure.
```

> **Important:**
> - Arguments must satisfy `0 <= m <= n`.
> - Passing invalid arguments results in immediate test failure.

### Exactly(n)

A common pattern is requiring a method to be called exactly `n` times. `Exactly(n)` is a shorthand for `Between(n, n)`.

```cpp
using ::testing::Exactly;

EXPECT_CALL(mock_object, SomeMethod(_))
    .Times(Exactly(3)); // Expect exactly 3 calls

mock_object.SomeMethod(1);
mock_object.SomeMethod(2);
mock_object.SomeMethod(3);
// A 4th call would fail the test.
```

> **Tip:** `Times(0)` (i.e. `Exactly(0)`) is the way to assert that a call must never happen.

## Behavior When Call Counts Are Out of Range

- **Too Few Calls:** GoogleMock reports a test failure if the actual number of calls is less than the cardinality's lower bound.
- **Too Many Calls:** GoogleMock reports an "over-saturation" error when calls exceed the upper bound.
- **Sticky Expectations:** Expectations remain active after saturation unless `.RetiresOnSaturation()` is used.

### Using `.RetiresOnSaturation()` to Make Expectations Inactive

```cpp
EXPECT_CALL(mock_object, SomeMethod(_))
    .Times(Exactly(2))
    .RetiresOnSaturation();

// After 2 calls, this expectation is inactive and won't match further calls.
```

## Creating Custom Cardinalities

GoogleMock lets users create custom cardinalities by implementing the `CardinalityInterface` api. This allows highly specialized behaviors - for example, expecting calls occur an even number of times.

```cpp
class EvenCardinality : public testing::CardinalityInterface {
 public:
  bool IsSatisfiedByCallCount(int call_count) const override {
    return call_count % 2 == 0;
  }
  bool IsSaturatedByCallCount(int /*call_count*/) const override {
    return false;  // never saturates
  }
  void DescribeTo(std::ostream* os) const override {
    *os << "called even number of times";
  }
};

testing::Cardinality EvenNumber() {
  return testing::MakeCardinality(new EvenCardinality);
}

// In usage:
EXPECT_CALL(mock_object, SomeMethod()).Times(EvenNumber());
```

## Practical Examples of Cardinalities in Use

### Example 1: At Least N Calls

```cpp
using ::testing::AtLeast;
class MockFoo {
 public:
  MOCK_METHOD(void, Bar, ());
};

MockFoo mock;
EXPECT_CALL(mock, Bar()).Times(AtLeast(1));
mock.Bar();  // Ok
```

### Example 2: Exactly N Calls with Sequence and Retire

```cpp
using ::testing::Exactly;
using ::testing::InSequence;

MockFoo mock;
{
  InSequence s;

  EXPECT_CALL(mock, Bar()).Times(Exactly(1)).RetiresOnSaturation();
  EXPECT_CALL(mock, Bar()).Times(Exactly(2));
}

mock.Bar();  // Matches first expectation
mock.Bar();  // Matches second expectation
mock.Bar();  // Matches second expectation
// Further calls will fail
```

### Example 3: Using AnyNumber to Accept Unrestricted Calls

```cpp
using ::testing::AnyNumber;

MockFoo mock;
EXPECT_CALL(mock, Bar()).Times(AnyNumber());

// Call Bar any number of times without causing a test failure.
mock.Bar();
mock.Bar();
```

### Example 4: Between Calls

```cpp
using ::testing::Between;

MockFoo mock;
EXPECT_CALL(mock, Bar()).Times(Between(2, 4));

mock.Bar();  // First call (not satisfied yet)
mock.Bar();  // Second call (lower bound met)
mock.Bar();  // Third call
mock.Bar();  // Fourth call (upper bound met)
// A 5th call produces an error
```

## Describing Call Counts

GoogleMock expresses call counts in human-friendly text:

- 0 calls: "never called"
- 1 call: "called once"
- 2 calls: "called twice"
- N calls (N>2): "called N times"

This is useful in failure messages to interpret expectation violations clearly.

## Common Pitfalls & Best Practices

- **Specify times explicitly for clarity:** Even though GoogleMock infers `.Times()`, be explicit for better readability and maintainability.
- **Avoid negative values:** Supplying negative call counts to cardinalities causes immediate test failures.
- **Use `.RetiresOnSaturation()` when chaining multiple expectations for the same method to avoid "sticky" expectation errors.**
- **Order expectations carefully:** More specific expectations should be declared after more general ones, as GoogleMock matches expectations in reverse order.

## Troubleshooting Call Count Issues

**Symptoms:**
- Unexpected test failures indicating too many or too few calls.
- "Upper bound violated" or "over-saturation" errors on methods.

**Tips:**
- Verify your `.Times()` clauses match the intended call frequency.
- Check whether you need `.RetiresOnSaturation()` to avoid sticky expectations.
- Use the `--gmock_verbose=info` flag when running tests to get detailed call trace output.
- Use sequences or `.After()` clauses to enforce call order if relevant.

## Summary

Cardinalities empower you to specify mock method call expectations precisely and flexibly. Understanding and effectively using `AnyNumber()`, `AtLeast()`, `AtMost()`, `Between()`, and `Exactly()`, along with control mechanisms like `.RetiresOnSaturation()`, allows you to craft robust tests that correctly verify your code's interactions.

---

For more detailed behavioral examples, additional reading on **Matchers**, **Actions**, and **Setting Expectations** in GoogleMock is recommended.

---

## References

- [Mocking Reference](../core-apis/gmock-mocking-api.md#Cardinalities)
- [gMock Cookbook: Setting Expectations](../gmock_cook_book.md#SettingExpectations)
- [gMock Cheat Sheet: Cardinalities](../gmock_cheat_sheet.md#CardinalityList)

---