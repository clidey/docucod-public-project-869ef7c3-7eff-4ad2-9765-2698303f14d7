---
title: "Portability Configuration & Abstractions"
description: "Describes macros, utility headers, and platform abstraction interfaces for ensuring compatibility across different compilers and platforms. Explains configuration entry points and customizability for advanced builds."
---

# Portability Configuration & Abstractions

GoogleTest is designed to work seamlessly across a wide array of compilers, operating systems, and platform environments. This page describes the fundamental configuration entry points, macros, utility headers, and platform abstraction interfaces that enable this compatibility. It explains how GoogleTest detects your platform, adapts to different compiler and OS features, and provides customization hooks for advanced build scenarios.

---

## 1. Understanding GoogleTest’s Portability Layer

To achieve true cross-platform compatibility, GoogleTest employs a carefully structured portability layer implemented primarily in the `gtest-port.h` internal header. This layer centralizes environment detection, feature toggles, synchronization primitives, and utility wrappers for system calls, allowing the rest of GoogleTest to remain platform-agnostic.

By leveraging this portability infrastructure, your tests automatically benefit from consistent behavior regardless of the underlying hardware or compiler differences.

### What This Means for You

- **No manual platform checks required:** GoogleTest internally detects key platform and compiler properties.
- **Macro-driven configuration:** Various environment-defining macros toggle feature availability.
- **Threading and synchronization:** Thread-safe tests are supported if your platform enables them.
- **Customizable:** Override or redefine macros and hooks if you need specialized behavior for your environment.

---

## 2. Platform Detection Macros

GoogleTest automatically defines a set of macros identifying the operating system and environment on which it is compiled. These macros follow the convention `GTEST_OS_<PLATFORM>` and are always defined to `1` for the detected platform or remain undefined otherwise.

Some key platform macros include:

| Macro                      | Platform Description            |
|----------------------------|--------------------------------|
| `GTEST_OS_WINDOWS`          | Windows (Desktop, MinGW, Mobile) |
| `GTEST_OS_LINUX`            | Linux                         |
| `GTEST_OS_MAC`              | Mac OS X                      |
| `GTEST_OS_IOS`              | iOS (Apple mobile OS)         |
| `GTEST_OS_CYGWIN`           | Cygwin                        |
| `GTEST_OS_FREEBSD`          | FreeBSD                       |
| `GTEST_OS_SOLARIS`          | Sun Solaris                   |
| `GTEST_OS_ANDROID` (*)      | Android OS (via Linux)        |

> *Android is detected via `GTEST_OS_LINUX_ANDROID`.*

#### Usage Example

You can conditionally compile code based on detected platforms using these macros:

```cpp
#if GTEST_OS_WINDOWS
  // Windows-specific implementations
#elif GTEST_OS_LINUX
  // Linux-specific implementations
#else
  // Fallback or unsupported platform
#endif
```

---

## 3. Feature Availability Macros

Beyond the OS-level macros, GoogleTest defines macros indicating the availability of certain platform features or compiler capabilities. All these macros are defined as `1` (enabled) or `0` (disabled) so that your tests and custom code can safely use `#if` directives without worrying about undefined macros.

Some common feature macros include:

| Macro                       | Feature Description                                |
|-----------------------------|---------------------------------------------------|
| `GTEST_HAS_PTHREAD`          | Indicates availability of POSIX pthreads          |
| `GTEST_HAS_EXCEPTIONS`       | Whether exception handling is enabled             |
| `GTEST_HAS_RTTI`             | Whether Run-Time Type Information is enabled      |
| `GTEST_HAS_STD_WSTRING`      | Availability of support for `std::wstring`        |
| `GTEST_HAS_FILE_SYSTEM`      | Whether file system APIs are available             |
| `GTEST_HAS_SEH`              | Structured Exception Handling on Windows          |
| `GTEST_HAS_CLONE`            | Presence of `clone(2)` system call support        |
| `GTEST_HAS_DEATH_TEST`       | Whether death-tests are supported on this platform|
| `GTEST_HAS_TYPED_TEST`       | Support for typed tests and type-parameterized tests|

#### Practical Notes

- GoogleTest detects these features automatically but allows you to override them via `-D` compiler flags.
- For example, if automatic pthread detection fails, you can explicitly define `-DGTEST_HAS_PTHREAD=1`.
- Many test features gracefully degrade if certain capabilities are disabled.

---

## 4. Core Utility Headers and Macros

### `gtest-port.h`

This is the principal portability header in GoogleTest. It:

- Declares all platform and feature macros.
- Defines utility functions and macros for:
  - Logging and assertions (`GTEST_CHECK_`, `GTEST_LOG_`).
  - Synchronization primitives (`Mutex`, `MutexLock`, `ThreadLocal`).
  - Threading abstractions depending on platform support.
  - String and file system utilities, adapted per OS.
  - Regex implementations (RE2, POSIX, or simple regex fallback) chosen by platform.
- Provides safe wrappers around system functions to unify cross-platform behavior.

### Key Macros:

| Macro                      | Purpose                                          |
|----------------------------|-------------------------------------------------|
| `GTEST_API_`               | Controls DLL export/import declarations          |
| `GTEST_DISABLE_MSC_WARNINGS_PUSH_` / `POP_` | Temporarily disables MSVC warnings    |
| `GTEST_HAS_POSIX_RE`       | Enables POSIX regex support                       |
| `GTEST_SNPRINTF_`          | Platform-adapted `snprintf` macro                |
| `GTEST_NO_INLINE_`         | Prevents function inlining for debugging/tracing |

---

## 5. Synchronization Abstractions

GoogleTest uses its portability layer to expose consistent synchronization primitives across platforms, critical for thread safety.

### Mutex and Lock

- `Mutex` and `MutexLock` classes are provided in `gtest-port.h`.
- Their implementation varies:
  - On POSIX platforms with pthreads: uses `pthread_mutex_t`.
  - On Windows: uses native `CRITICAL_SECTION`.
  - On single-threaded or unsupported platforms: dummy no-op implementations.

Using `MutexLock` acquires the mutex and releases it upon scope exit, following RAII idioms.

### ThreadLocal Storage

- Provides type-safe thread-local storage.
- Implemented using:
  - `__thread` or `thread_local` if available,
  - pthread TLS keys on POSIX,
  - Windows TLS APIs,
  - Dummy fallback when unsupported.

### Notification (advanced synchronization)

- A `Notification` class is available to synchronize thread starts, mainly used internally for advanced test coordination.
- Can be customized or replaced via macro overrides if desired.

---

## 6. Regular Expression Support

GoogleTest supports multiple regular expression backends, selected automatically:

- **RE2 Library** (preferred if bundled with Abseil): fast and powerful.
- **POSIX Extended Regular Expressions:** on most UNIX-like platforms.
- **Simple internal Regex implementation:** fallback for limited environments.

This abstraction allows your tests to use consistent regex-based assertions and matchers without worrying about the underlying details.

---

## 7. Customization Entry Points

GoogleTest allows advanced users to customize and override default behavior through macros and custom headers.

### Custom Headers

- Modify or supply your own `custom/gtest-port.h` for low-level portability overrides.
- Use `gtest/internal/custom/gtest-port.h` to define custom macros and platform-specific behavior.

### Custom Macros Available for User Definition

| Macro Name                  | Description                                   |
|-----------------------------|-----------------------------------------------|
| `GTEST_LOG_(severity)`       | Custom logging macro                          |
| `GTEST_CHECK_(condition)`    | Custom assert macro                           |
| `GTEST_HAS_NOTIFICATION_`    | Provide your own Notification implementation  |
| `GTEST_HAS_MUTEX_AND_THREAD_LOCAL_` | Provide your own Mutex and ThreadLocal implementations |
| `GTEST_API_`                 | Control symbol visibility and exporting        |
| `GTEST_OS_STACK_TRACE_GETTER_` | Override stack trace getter implementation |
| `GTEST_CUSTOM_TEMPDIR_FUNCTION_` | Override `testing::TempDir()` function      |

This flexibility allows integration into specialized environments such as embedded systems, custom OSes, or proprietary threading frameworks.

---

## 8. Practical Guide: Configuring Portability in Your Build

### Default Automatic Detection

By default, you do not need to define any platform macros manually. GoogleTest’s `gtest-port.h` inspects predefined compiler symbols, OS headers, and version identifiers to configure itself appropriately.

### When to Manually Define Macros

- If GoogleTest incorrectly detects the absence or presence of a feature.
- Non-standard or niche platforms where automatic detection fails.
- For disabling features such as exceptions or threads to reduce binary size.

### Example CMake Definitions

```cmake
add_compile_definitions(
  GTEST_HAS_PTHREAD=1
  GTEST_HAS_EXCEPTIONS=0
  GTEST_HAS_RTTI=1
  GTEST_LINKED_AS_SHARED_LIBRARY=1
)
```

### Building as a Shared Library (DLL)

- Define `GTEST_CREATE_SHARED_LIBRARY=1` when building GoogleTest itself.
- Define `GTEST_LINKED_AS_SHARED_LIBRARY=1` when building tests that link to GoogleTest DLL.

Pay careful attention when mixing static and shared builds to avoid linkage and runtime issues.

---

## 9. Troubleshooting and Best Practices

- **Issue: Thread Safety Missing**
  - Check if `GTEST_IS_THREADSAFE` is defined to 1.
  - On platforms without `pthread` or native threads, synchronization primitives are no-ops.

- **Issue: Build Fails on Platform Detection**
  - Verify your compiler defines standard macros.
  - Override problematic feature macros.

- **Best Practice: Use Standard Macros for Portability**
  - Always use `#if GTEST_HAS_*` or `GTEST_OS_*` for conditional compilation.
  - Avoid undefined or macro-guarded by `#ifdef` as the macros are always defined.

- **Advanced: Customize Portability for Specialized Environments**
  - Use the custom macros and headers to replace the default mutex, logging, or stack trace.
  - Useful for integration with platform-specific SDKs or test environments.

---

## 10. Further Reading and Related Documentation

- [Platform Portability & Compatibility](https://google.github.io/googletest/concepts/integration-and-portability/platform-portability)
- [Platform Detection Macros `gtest-port-arch.h`](https://google.github.io/googletest/api-docs/internal/gtest-port-arch_8h_source.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer)
- [Configuring and Integrating GoogleTest with CMake](https://google.github.io/googletest/integration-and-best-practices/integrating-with-build-systems)
- [Customization Points](https://google.github.io/googletest/customization.html)

---

With this detailed foundation, you can trust GoogleTest to robustly detect and adapt to your platform constraints, letting you focus on writing reliable, portable, and maintainable tests.
