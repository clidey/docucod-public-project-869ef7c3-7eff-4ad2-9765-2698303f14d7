---
title: "Using Matchers in GoogleTest"
description: "Documents the matcher interfaces and built-in matchers for fine-grained value inspection in assertions and death tests. Covers creation of custom matchers."
---

# Using Matchers in GoogleTest

This documentation page provides a comprehensive reference to using matchers within GoogleTest assertions and death tests, focusing on the matcher interfaces, the built-in set of matchers for fine-grained value inspection, and guidance on creating custom matchers.

---

## Overview of Matchers

Matchers enable expressive and readable assertions by allowing users to specify detailed criteria for expected values in tests. They are used primarily with the `EXPECT_THAT()` and `ASSERT_THAT()` macros, which check whether a value satisfies a given matcher.

Match results generate informative failure messages explaining why a value does or does not meet the matcher criteria.

### Basic Usage

Include the header `<gmock/gmock.h>` to access matcher functionality:

```cpp
#include <gmock/gmock.h>

using ::testing::Eq;
using ::testing::StartsWith;
using ::testing::AllOf;

EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(value, AllOf(Eq(5), Gt(2))); // value == 5 and > 2
```

Matchers let the assertion read like English and provide detailed feedback on failure.

---

## Matchers in Assertions

- Use `EXPECT_THAT(value, matcher)` for non-fatal checks.
- Use `ASSERT_THAT(value, matcher)` for fatal checks that abort the current test on failure.

For example:

```cpp
EXPECT_THAT(my_string, StartsWith("Test"));
ASSERT_THAT(my_number, AllOf(Ge(0), Le(10)));
```

---

## Built-in Matchers

Matchers fall into several categories, enabling versatile testing needs.

### Wildcard Matchers
- `_` : Matches any value of the correct type.
- `A<T>()` or `An<T>()` : Matches any value of type `T`.

### Comparison Matchers
- `Eq(value)` or just `value` : Equals `value` (`==`).
- `Ne(value)` : Not equals `value` (`!=`).
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` : Less than, less or equal, greater than, greater or equal.

### Null and Pointer Matchers
- `IsNull()` : Matches null raw or smart pointers.
- `NotNull()` : Matches non-null pointers.
- `Pointee(matcher)` : Pointer points to a value matching matcher.
- `Pointer(matcher)` : Pointer itself matches matcher.

### String Matchers
- `HasSubstr(string)` : Contains substring.
- `StartsWith(prefix)`, `EndsWith(suffix)` : String starts or ends with.
- `StrEq`, `StrNe`, `StrCaseEq`, `StrCaseNe` : Case-sensitive/case-insensitive string equality/non-equality.
- `ContainsRegex(regex)`, `MatchesRegex(regex)` : Regex matching.

### Floating-point Matchers
- `FloatEq(value)`, `DoubleEq(value)` : Approximate equality (ULP based).
- Variants supporting NaN equality: `NanSensitiveFloatEq`, `NanSensitiveDoubleEq`.

### Container Matchers
- `ElementsAre(...)`, `UnorderedElementsAre(...)` : Matches container elements in order or any order.
- `Contains(element_or_matcher)` : Container contains element.
- `Each(matcher)` : Every element matches.
- `SizeIs(matcher)` : Container size matches.
- `Pointwise(matcher, container)` : Pairwise matching with another container.

### Member and Property Matchers
- `Field(&Class::field, matcher)` : Object field matches.
- `Property(&Class::method, matcher)` : Object property method result matches.

### Exception Matchers
- `Throws<ExceptionType>()` : Callable throws exception of type.
- `Throws<ExceptionType>(matcher)` : Callable throws exception matching matcher.
- `ThrowsMessage<ExceptionType>(matcher)` : Exception’s `.what()` string matches.

### Composite Matchers
- `AllOf(m1, m2, ...)` : All matchers must match.
- `AnyOf(m1, m2, ...)` : At least one matcher must match.
- `Not(matcher)` : Negation.
- `Conditional(cond, m1, m2)` : Matches `m1` if `cond` true, else `m2`.

---

## Using Matchers for Function Arguments

Matchers are commonly used to specify expected argument values in mock object expectations with `EXPECT_CALL()` and behavior definitions with `ON_CALL()`.

Example:

```cpp
using ::testing::_;
using ::testing::Lt;
using ::testing::Return;

EXPECT_CALL(mock_object, Foo(Lt(5)))
    .WillOnce(Return(true));

ON_CALL(mock_object, Bar(_))
    .WillByDefault(Return(false));
```

- Use `_` to match any value if specific details of arguments don't matter.
- Multiple matchers can be combined with `AllOf()` or `AnyOf()`.
- You can match multiple arguments as a whole using `.With()` clause and multi-argument matchers on tuples, e.g. `.With(Args<0,1>(Lt()))`.

---

## Writing Custom Matchers

GoogleMock provides macros and APIs for creating custom matchers to express domain-specific validations, improving test readability and diagnostics.

### Quick Definition using `MATCHER` Macros

Define simple custom matchers at namespace scope with the `MATCHER` family:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

// Parameterized matcher
MATCHER_P(IsDivisibleBy, n, "") {
  *result_listener << "where the remainder is " << (arg % n);
  return (arg % n) == 0;
}
```

Use these in tests:

```cpp
EXPECT_THAT(value, IsEven());
EXPECT_THAT(value, IsDivisibleBy(7));
```

- The matcher body must be functional (no side effects).
- Use `arg` to access the value being matched.
- Use `result_listener` to produce custom failure explanations.

### Advanced Custom Matcher Classes

For more control and reusability, implement the Matcher interface manually:

- Provide `MatchAndExplain(value, listener)` method returning bool.
- Provide `DescribeTo(ostream*)` and `DescribeNegationTo(ostream*)` methods to output match description.

Example:

```cpp
class BarPlusBazEqMatcher {
 public:
  using is_gtest_matcher = void;
  explicit BarPlusBazEqMatcher(int sum) : expected_sum_(sum) {}

  bool MatchAndExplain(const Foo& foo, std::ostream* os) const {
    return (foo.bar() + foo.baz()) == expected_sum_;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "bar() + baz() equals " << expected_sum_;
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "bar() + baz() does not equal " << expected_sum_;
  }

 private:
  int expected_sum_;
};

::testing::Matcher<const Foo&> BarPlusBazEq(int expected_sum) {
  return BarPlusBazEqMatcher(expected_sum);
}
```

---

## Tips & Best Practices

- Prefer `EXPECT_THAT` with built-in matchers over manual assertions for clearer, rich diagnostics.
- Use `MATCHER` macros to rapidly create custom matchers for your domain.
- For complex logic or reusable matchers, implement the matcher interface class.
- Use `result_listener` or streaming in matchers to provide helpful failure messages.
- Avoid side effects in matcher logic as matchers may be evaluated multiple times.
- To match multiple arguments as a unit in mock expectations, use `.With()` and tuple-based matchers.
- Use `.InSequence`, `.After`, and `.Times` in `EXPECT_CALL` to express call ordering and cardinality.
- Use `NiceMock` or `StrictMock` to control warnings on uninteresting calls in mocks.

---

## Common Pitfalls and Troubleshooting

- Using a matcher with unintended implicit conversions may lead to false positives (e.g., matching a bool with a string without saying `Eq(...)`). Always prefer explicit matchers.
- Custom matchers must be pure functions without side effects.
- `MATCHER` macros must be declared at namespace/global scope, not inside functions or classes.
- Do not use fatal assertions inside matchers; matchers should return simple boolean results.
- When mocking overloaded functions, you might need to cast or disambiguate overloads.
- For pointers, `Pointee()` accounts for null pointer safely, avoiding crashes.

---

## Example: Using a Custom Matcher

```cpp
MATCHER(IsPositive, "") {
  if (arg > 0) return true;
  *result_listener << "which is " << arg << ", not positive";
  return false;
}

TEST(MyTest, CustomMatcherExample) {
  int val = -5;
  EXPECT_THAT(val, IsPositive());  // Fails with message explaining the value
}
```

## Example: Combining Matchers

```cpp
EXPECT_THAT(value,
            AllOf(Gt(5), Lt(10)));
```

Checks that `value` is greater than 5 and less than 10.

## Example: Matching Container Elements

```cpp
std::vector<int> v = {1, 2, 3};
EXPECT_THAT(v, ElementsAre(1, 2, 3));
EXPECT_THAT(v, Each(Ge(1)));
```

Matches an exact sequence and checks all elements are >= 1 respectively.

## Related Documentation

- [GoogleTest Assertions Reference](reference/assertions.md) — for usage with matchers and assertion macros.
- [GoogleMock Matchers Reference](reference/matchers.md) — detailed description of built-in matcher functions.
- [gMock Cookbook](guides/integration-real-world/custom-matchers-actions.mdx) — creating custom matchers and actions.
- [GoogleMock Mocking Reference](reference/mocking.md) — using matchers in mock expectations.
- [Writing Effective Tests](guides/writing-effective-tests/test-parameterization.mdx) — advanced test and matcher strategies.

---

## Summary

Matchers are a central mechanism to make assertions expressive, precise, and readable in GoogleTest and GoogleMock, allowing rich validations of arguments, containers, exceptions, and more.

Mastering built-in matchers and writing custom matchers empowers creating maintainable tests that clearly communicate intent and diagnose failures effectively.

Use the powerful combination of `EXPECT_THAT`, `EXPECT_CALL`, and custom matchers to write robust, expressive unit tests.

---

For details, see also the namespaces and headers to include:

```cpp
#include <gmock/gmock.h>
using ::testing::Eq;
using ::testing::NotNull;
using ::testing::StartsWith;
using ::testing::MATCHER;
```

---

With these tools, your tests can validate complex properties naturally, diagnose failures with clear messages, and improve long-term test quality and maintainability.

---

For further expertise, refer to the gMock Cookbook and GoogleTest Assertions Reference linked above.


---

<Source url="https://github.com/google/googletest" branch="main" paths='[{"path": "googletest/include/gtest/gtest-matchers.h", "range": "1-532"},{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-1100"}]' />