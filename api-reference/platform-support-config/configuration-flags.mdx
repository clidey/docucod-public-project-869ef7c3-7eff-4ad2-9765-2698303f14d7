---
title: "Framework Configuration & Initialization"
description: "Describes available framework-level flags, initialization routines, and programmatic setup/teardown APIs needed to configure the behavior of GoogleTest and GoogleMock according to different project requirements."
---

# Framework Configuration & Initialization

GoogleTest and GoogleMock provide a powerful and flexible C++ testing framework. To accommodate diverse project needs and environments, the framework offers a suite of configuration flags, initialization routines, and programmatic APIs for setup and teardown. This documentation focuses exclusively on these framework-level configuration and initialization capabilities, empowering you to customize GoogleTest and GoogleMock behavior to fit your project's requirements seamlessly.

---

## 1. Framework Initialization

Before running any tests, you must initialize the testing framework. Initialization ensures all configuration flags are parsed, environment readiness checks are performed, and internal subsystems are prepared.

### 1.1 InitGoogleTest

- **Purpose**: Initializes the GoogleTest framework, parses command-line flags, and handles setup before test execution.
- **Usage**: Call `InitGoogleTest(&argc, argv)` early in your `main()` function.

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- **Behavior**: 
  - Parses GoogleTest-specific flags (e.g., `--gtest_filter`, `--gtest_repeat`).
  - Removes recognized flags from `argv` and decrements `argc` accordingly.
  - Prepares internal states and configurations.

### 1.2 InitGoogleMock

Since GoogleMock depends on GoogleTest, its initialization includes GoogleTest initialization.

- **Purpose**: Initialize GoogleMock and GoogleTest together, parsing both sets of flags.
- **Usage**: Call `InitGoogleMock(&argc, argv)` instead of just GoogleTest initialization when using mocks.

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- **Flag Parsing**: Separates GoogleMock flags (`--gmock_verbose`, `--gmock_catch_leaked_mocks`) from others and removes them.


### 1.3 Initialization on Platforms Without argc/argv

On embedded platforms or environments without command-line arguments, `InitGoogleMock()` and `InitGoogleTest()` provide parameterless overloads to safely perform minimal initialization.


---

## 2. Framework-Level Flags

GoogleTest and GoogleMock support numerous command-line flags to customize test execution and framework behavior. These flags can be passed via the command line or set programmatically.

### 2.1 GoogleTest Flags

Commonly used flags include:

| Flag                 | Description                                            |
|----------------------|--------------------------------------------------------|
| --gtest_filter       | Selects tests to run by name/pattern                   |
| --gtest_repeat       | Runs tests multiple times                               |
| --gtest_shuffle      | Randomizes test execution order                         |
| --gtest_break_on_failure | Causes the test to break on the first failure         |
| --gtest_output       | Specifies test output format and file                   |

The full set is described in the [Installation Overview](https://github.com/google/googletest/blob/main/docs/setup-requirements/installation-overview.md).

### 2.2 GoogleMock Flags

Key GoogleMock flags are:

| Flag                        | Description                                                 |
|-----------------------------|-------------------------------------------------------------|
| --gmock_verbose             | Controls output verbosity (`info`, `warning`, or `error`)   |
| --gmock_catch_leaked_mocks | Reports leaked mock objects as failures (`true` or `false`) |
| --gmock_default_mock_behavior | Sets default mock strictness: 0=NiceMock, 1=NaggyMock, 2=StrictMock |

### 2.3 Programmatic Flag Access

Flags can also be queried or set programmatically via macros:

```cpp
bool verbose = GMOCK_FLAG_GET(verbose);  // Get flag
GMOCK_FLAG_SET(verbose, "info");         // Set flag
```

These macros are thread-safe and allow dynamic configuration within tests or setup code.

---

## 3. Programmatic Setup and Teardown APIs

While most configuration is done through command-line flags, GoogleTest also exposes APIs for programmatic control of the test environment.

### 3.1 Test Environment Lifecycle

You can register global test environment objects derived from `::testing::Environment`. These objects have virtual methods:

- `SetUp()` - invoked before any tests run.
- `TearDown()` - invoked after all tests finish.

This allows you to initialize and clean up shared resources.

```cpp
class MyEnvironment : public ::testing::Environment {
 public:
  void SetUp() override {
    // global setup code
  }
  void TearDown() override {
    // global teardown code
  }
};

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  ::testing::AddGlobalTestEnvironment(new MyEnvironment);
  return RUN_ALL_TESTS();
}
```


### 3.2 Initialization and Shutdown Control

In advanced scenarios, you can programmatically initialize and shutdown the testing framework without relying on command-line flags.

- `::testing::InitGoogleTest(&argc, argv);` initializes.
- `::testing::UnitTest::GetInstance()->Run();` runs tests.
- Custom teardown can be performed if needed before process exit.

---

## 4. Platform and Build Configuration Macros

GoogleTest adapts automatically to various platforms and compilers using a collection of macro definitions and internal flags. While normally transparent, understanding these can help diagnose cross-platform issues or customize builds.

### 4.1 Platform Detection Macros

GoogleTest internally defines macros such as `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, etc., reflecting the build platform.

### 4.2 Feature Flags

GoogleTest detects compiler and runtime features such as exception support (`GTEST_HAS_EXCEPTIONS`), RTTI availability (`GTEST_HAS_RTTI`), pthread support (`GTEST_HAS_PTHREAD`), and wide-string support (`GTEST_HAS_STD_WSTRING`).

You can override these by defining them explicitly during compile time if the automatic detection is inaccurate.

### 4.3 Thread Safety

The `GTEST_IS_THREADSAFE` macro indicates whether GoogleTest supports threads using platform primitives.

---

## 5. Best Practices and Troubleshooting

### 5.1 Recommended Initialization Flow

1. Call `InitGoogleMock()` if using mocks; otherwise, `InitGoogleTest()`.
2. Avoid manual parsing or modification of argc/argv before initialization.
3. Pass the possibly modified argc/argv to your test runner.

### 5.2 Common Pitfalls

- **Incorrect runtime library linkage on Windows:** Use `gtest_force_shared_crt` CMake option or build flags `-DGTEST_CREATE_SHARED_LIBRARY=1` and `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when using DLLs.
- **Flags not recognized:** Ensure flags are passed before initialization or correctly set before test execution.
- **Thread-safety issues:** Verify `GTEST_IS_THREADSAFE` macro or disable multithreading if unsupported.

### 5.3 Modifying or Extending Flags

You can create custom flag handling by extending the internal flag parsing mechanisms, although this is advanced and rarely needed.

---

## 6. Code Examples

### 6.1 Basic Initialization in Main

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  // Initialize both GoogleTest and GoogleMock.
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 6.2 Custom Test Environment

```cpp
class GlobalSetup : public ::testing::Environment {
 public:
  void SetUp() override {
    // Setup shared resources
  }
  void TearDown() override {
    // Cleanup
  }
};

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  ::testing::AddGlobalTestEnvironment(new GlobalSetup);
  return RUN_ALL_TESTS();
}
```

---

## 7. Summary Mermaid Diagram

```mermaid
flowchart TD
  Start([Program Start]) --> Init[Call InitGoogleTest or InitGoogleMock]
  Init --> ParseFlags{Parse Command-line Flags}
  ParseFlags -->|Recognized GTest/GMock flags| RemoveFlags[Remove Parsed Flags]
  RemoveFlags --> Prepare[Prepare internal state]
  ParseFlags -->|Unrecognized flags| PassOn[Leave flags unchanged]
  Prepare --> BeforeTests[Call Global Environments SetUp()]
  BeforeTests --> RunTests[RUN_ALL_TESTS()]
  RunTests --> AfterTests[Call Global Environments TearDown()]
  AfterTests --> Exit([Program Exit])

  classDef process fill:#f9f,stroke:#333,stroke-width:2px;
  class Start,Init,RemoveFlags,Prepare,BeforeTests,RunTests,AfterTests,Exit process;
  class ParseFlags,PassOn process;
```

This diagram shows the main flow users experience when initializing and running tests with configuration and initialization routines.

---

## 8. Additional Resources and Links

- [GoogleTest Installation Overview](https://github.com/google/googletest/blob/main/docs/setup-requirements/installation-overview.md)
- [GoogleMock Initialization and Flags](https://github.com/google/googlemock/blob/main/googlemock/src/gmock.cc)
- [Project Setup & Configuration](getting-started/first-test-experience/project-setup.md)
- [Integration & Dependencies](overview/fundamentals-and-architecture/integration-and-dependencies.md)
- [Mocking APIs Overview](api-reference/mocking-apis/mock-class-definition.md)

---

By mastering framework configuration and initialization, you unlock control over test behavior, adapt GoogleTest and GoogleMock to your project's environment, and set the foundation for robust, repeatable automated tests.