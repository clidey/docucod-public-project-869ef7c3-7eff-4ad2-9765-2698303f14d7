---
title: "Built-in Actions"
description: "Catalogue of built-in actions provided by GoogleMock, including common patterns like Return, Assign, Invoke, and how to specify side effects or advanced, variadic behaviors via action templates."
---

# Built-in Actions

This page provides a comprehensive catalogue of the built-in actions offered by GoogleMock. These actions determine the behavior of mocked functions when they are invoked during testing. From simple returns to complex side effects, GoogleMock supplies a rich set of predefined actions, including common patterns like `Return()`, `Assign()`, `Invoke()`, and advanced variadic behaviors through action templates.

Understanding and using these built-in actions effectively unlocks a powerful way to specify the behavior of your mocks and simulate a wide variety of real-world scenarios.

---

## Table of Contents

- [Overview of Built-in Actions](#overview-of-built-in-actions)
- [Actions for Returning Values](#actions-for-returning-values)
  - [`Return()` and Variants](#return-and-variants)
  - [`ReturnArg<N>()`](#returnargn)
  - [`ReturnNew<T>(...)`](#returnnewt)
  - [`ReturnNull()`](#returnnull)
  - [`ReturnPointee(ptr)`](#returnpointep)
  - [`ReturnRef(variable)` and `ReturnRefOfCopy(value)`](#returnrefvariable-and-returnrefofcopyvalue)
  - [`ReturnRoundRobin({a1, a2, ...})`](#returnroundrobin)
- [Actions for Mocking Side Effects](#actions-for-mocking-side-effects)
  - [`Assign(&variable, value)`](#assignvariable-value)
  - [`SetArgPointee<N>(value)`](#setargpointen)
  - [`SetArrayArgument<N>(first, last)`](#setarrayargumentnfirst-last)
  - [`DeleteArg<N>()`](#deleteargn)
  - [`SaveArg<N>(pointer)` and `SaveArgByMove<N>(pointer)`](#saveargnpointer-and-saveargbymovenpointer)
  - [`SetArgReferee<N>(value)`](#setargrefereenvalue)
  - [`SetErrnoAndReturn(error, value)`](#seterrnoandreturnerror-value)
- [Using Functions, Functors, and Lambdas as Actions](#using-functions-functors-and-lambdas-as-actions)
  - [`Invoke()` family](#invoke-family)
  - [`InvokeWithoutArgs()`](#invokewithoutargs)
  - [`InvokeArgument<N>(args...)`](#invokeargumentnargs)
- [Composite and Adaptor Actions](#composite-and-adaptor-actions)
  - [`DoAll(a1, a2, ..., an)`](#doalla1-a2---an)
  - [`IgnoreResult(action)`](#ignoreresultaction)
  - [`WithArg<N>(action)` and `WithArgs<N1, N2, ...>(action)`](#withargnaction-and-withargsn1-n2-action)
  - [`WithoutArgs(action)`](#withoutargsaction)
- [Defining Custom Actions with Macros](#defining-custom-actions-with-macros)
- [Best Practices and Common Pitfalls](#best-practices-and-common-pitfalls)
- [Troubleshooting Common Issues](#troubleshooting-common-issues)

---

## Overview of Built-in Actions

Actions in GoogleMock specify what happens when a mocked method is called. The built-in actions are ready-made behaviors you can plug into your mock expectations, letting you simulate returns, modify output parameters, invoke callbacks, and much more.

GoogleMock supports both *once-only* actions (`WillOnce`) and *reusable* actions (`WillRepeatedly`), with some actions optimized for move-only types and others for side-effect behaviors.

These built-in actions cover most common use cases, and their flexibility allows combining multiple actions together for complex scenarios.

---

## Actions for Returning Values

### `Return()` and Variants

- **`Return()`**
  - Used with `void` mock functions to indicate the function returns nothing.
  - Example:
  ```cpp
  EXPECT_CALL(mock_obj, VoidMethod()).WillOnce(Return());
  ```

- **`Return(value)`**
  - Returns a specific value when the mock function is called.
  - The `value` is converted to the return type *once at setup time*, not on each invocation.
  - Supports move-only types via `Return(ByMove(std::move(value)))` if you want move semantics.
  - Example:
  ```cpp
  EXPECT_CALL(mock_obj, IntMethod()).WillOnce(Return(42));
  ```

- **Important:** Using `Return(std::move(...))` repeatedly without `ByMove` causes runtime errors as the moved value will be consumed the first time.

---

### `ReturnArg<N>()`

- Returns the value of the Nth (0-based) argument passed to the mock function.
- Useful when your mock's return value should reflect one of its inputs.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, GetValue(_)).WillOnce(ReturnArg<0>());
  int result = mock_obj.GetValue(5);  // result == 5
  ```

---

### `ReturnNew<T>(a1, ..., a_k)`

- Returns a pointer to a *new* instance of type `T`, constructed using the provided arguments.
- A fresh object is created on each invocation.
- The caller owns the returned pointer and is responsible for deletion.
- Supports constructors with up to 10 arguments.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, CreateFoo())
      .WillOnce(ReturnNew<Foo>(42, "test"));
  Foo* foo = mock_obj.CreateFoo();
  delete foo;
  ```

---

### `ReturnNull()`

- Returns a null pointer or smart pointer.
- Useful for pointer-returning mock functions when you want to simulate absence or failure.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, GetPointer()).WillRepeatedly(ReturnNull());
  ```

---

### `ReturnPointee(ptr)`

- Returns the value pointed to by `ptr` when the mock function is called.
- The pointee's value is evaluated at *call time*, allowing dynamic changes.
- Works with raw and smart pointers.
- Example:
  ```cpp
  int x = 10;
  EXPECT_CALL(mock_obj, GetValue()).WillRepeatedly(ReturnPointee(&x));
  x = 20;
  EXPECT_EQ(mock_obj.GetValue(), 20);
  ```

---

### `ReturnRef(variable)` and `ReturnRefOfCopy(value)`

- **`ReturnRef(variable)`** returns a reference to an existing variable. The mocked method *must* return a reference type.
- **`ReturnRefOfCopy(value)`** returns a reference to a *copied* value. The copy is created once when the action is set and lives as long as the action.
- Use these to simulate functions that return references to internal or stable data.
- Examples:
  ```cpp
  EXPECT_CALL(mock_obj, GetRef()).WillOnce(ReturnRef(existing_object));
  EXPECT_CALL(mock_obj, GetCopyRef()).WillOnce(ReturnRefOfCopy(value));
  ```

**Important:** Using `ReturnRef()` on temporaries or non-lvalues is disallowed to avoid dangling references.

---

### `ReturnRoundRobin({a1, a2, ..., a_k})`

- Returns successive elements from the given list `a1, a2, ..., a_k` for each call, cycling back to the start after the last element.
- Useful for simulating sequences of return values that repeat.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, GetNumber())
      .WillRepeatedly(ReturnRoundRobin({1, 2, 3}));
  EXPECT_EQ(mock_obj.GetNumber(), 1);
  EXPECT_EQ(mock_obj.GetNumber(), 2);
  EXPECT_EQ(mock_obj.GetNumber(), 3);
  EXPECT_EQ(mock_obj.GetNumber(), 1);  // cycles back
  ```

---

## Actions for Mocking Side Effects

GoogleMock offers actions designed to modify output arguments or globally visible state, allowing simulation of side effects that are common in real APIs.

### `Assign(&variable, value)`

- Assigns `value` to the variable pointed to by `&variable`.
- The variable must be a pointer.
- Useful for setting global flags or external state in a test.
- Example:
  ```cpp
  int x;
  EXPECT_CALL(mock_obj, VoidFunc()).WillOnce(Assign(&x, 42));
  ```

---

### `SetArgPointee<N>(value)`

- Assigns `value` to the object pointed to by the Nth (0-based) argument, which must be a pointer.
- Useful for setting output parameters by pointer.
- You can combine with `DoAll` to chain with a return value.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, GetData(_)).WillOnce(SetArgPointee<0>(10));
  ```

---

### `SetArrayArgument<N>(first, last)`

- Copies the elements from the `[first, last)` range to the array pointed to by the Nth argument.
- Can be applied to pointers or iterators.
- Does not take ownership; the caller must ensure the source range is valid.
- Example:
  ```cpp
  std::vector<int> vals = {1, 2, 3};
  EXPECT_CALL(mock_obj, GetValues(_))
      .WillOnce(SetArrayArgument<0>(vals.begin(), vals.end()));
  ```

---

### `DeleteArg<N>()`

- Deletes the Nth argument, which *must be a pointer*.
- Useful when the mock function takes ownership of a pointer.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, SetPtr(_)).WillOnce(DeleteArg<0>());
  ```

---

### `SaveArg<N>(pointer)` and `SaveArgByMove<N>(pointer)`

- **SaveArg<N>(pointer)**: Copies the Nth argument to `*pointer`.
- **SaveArgByMove<N>(pointer)**: Moves the Nth argument to `*pointer`.
- Enable capturing the value or ownership of arguments for later inspection.
- Example:
  ```cpp
  int savedValue;
  EXPECT_CALL(mock_obj, Foo(_)).WillOnce(SaveArg<0>(&savedValue));
  ```

---

### `SetArgReferee<N>(value)`

- Assigns `value` to the Nth argument, which *must be a reference type*.
- Useful for mock functions that modify reference output parameters.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, ModifyRef(_)).WillOnce(SetArgReferee<0>(10));
  ```

---

### `SetErrnoAndReturn(error, value)`

- Sets the global `errno` variable to `error` and returns `value`.
- Useful for mocking system calls or libc functions that return error codes.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, SysCall()).WillOnce(SetErrnoAndReturn(ENOENT, -1));
  ```

---

## Using Functions, Functors, and Lambdas as Actions

GoogleMock allows using arbitrary callables as actions for unmatched flexibility.

### `Invoke()` family

- `Invoke(func)` invokes `func` with the mock function's arguments.
- Supports global/static functions, functors, lambdas, and member function pointers.
- Example:
  ```cpp
  int Func(int x) { return x*2; }
  EXPECT_CALL(mock_obj, Compute(_)).WillOnce(Invoke(Func));
  ```

- `Invoke(object_ptr, &Class::Method)` invokes the method on the object.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, Compute(_)).WillOnce(Invoke(&obj, &MyClass::Method));
  ```

### `InvokeWithoutArgs()`

- Invokes a callable with *no* arguments, ignoring the mock function's arguments.
- Useful when you want to run a function or lambda that does not depend on input.
- Examples:
  ```cpp
  EXPECT_CALL(mock_obj, Foo(_)).WillOnce(InvokeWithoutArgs([]() { DoWork(); }));
  ```

### `InvokeArgument<N>(args...)`

- Invokes the Nth argument (which must be callable) passed to the mock function, with the specified `args`.
- Allows simulating callbacks.
- Can pass arguments by reference using `std::ref()`.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, CallbackMethod(_, _))
      .WillOnce(InvokeArgument<1>(5));  // Calls 2nd argument with 5
  ```

---

## Composite and Adaptor Actions

### `DoAll(a1, a2, ..., an)`

- Runs all listed actions sequentially on each invocation.
- All but the last action must return `void`.
- The return value of the last action is used as the final return value.
- Useful to combine side effects and returns.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, Func(_))
      .WillOnce(DoAll(SetArgPointee<0>(10), Return(true)));
  ```

---

### `IgnoreResult(action)`

- Performs `action` but discards its return value.
- Useful for adapting actions that return values to `void`-returning mock functions or to comply with `DoAll` requirements.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, VoidFunc(_))
      .WillOnce(IgnoreResult(Return(5)));  // Ignores the int 5
  ```

---

### `WithArg<N>(action)` and `WithArgs<N1, N2, ...>(action)`

- Passes selected arguments of the mock function to `action`.
- Adapts an action that expects fewer or different arguments.
- `WithArg<N>` is a special case for passing a single argument.
- `'WithArgs'` supports multiple selected arguments in arbitrary order and repetition.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, Func(int, double, char))
      .WillOnce(WithArgs<2, 0>(Invoke(MyFunc)));  // Calls MyFunc(char, int)
  ```

---

### `WithoutArgs(action)`

- Calls an `action` with no arguments, ignoring any mock function arguments.
- Syntactic sugar for `WithArgs<>` with an action expecting zero arguments.
- Example:
  ```cpp
  EXPECT_CALL(mock_obj, Func(_, _))
      .WillOnce(WithoutArgs(Return(5)));
  ```

---

## Defining Custom Actions with Macros

GoogleMock offers macros to quickly define new actions:

- `ACTION(name) { statements; }`
  - Defines an action with no parameters.
  - Inside, refer to the Kth argument via `argK` and its type via `argK_type`.

- `ACTION_P(name, param) { statements; }`
  - Defines an action with one parameter.
  - Use `param` and `param_type` inside.

- Variants exist up to `ACTION_P10` for multiple parameters.


**Example:**
```cpp
ACTION(IncrementArg1) {
  return ++(*arg1);
}

// Usage:
EXPECT_CALL(mock_obj, Func(_)).WillOnce(IncrementArg1());
```

Actions defined this way allow straightforward, repeatable custom behaviors without boilerplate.

---

## Best Practices and Common Pitfalls

- **Use `ON_CALL` for default behaviors and `EXPECT_CALL` for expectations.**
  Overuse of `EXPECT_CALL` can lead to brittle tests.

- **Order your expectations carefully:** latest matching `EXPECT_CALL`s override earlier ones.

- **Use `RetiresOnSaturation()`** wisely when chaining multiple `WillOnce()` actions to avoid sticky expectations causing errors.

- **Avoid returning references to temporaries:** Use `ReturnRefOfCopy()` instead.

- **Be cautious with move-only types:** Use `Return(ByMove(...))` when returning move-only objects and prefer lambdas or callables for more complex logic.

- **Combine side effects with return values using `DoAll()`.** Remember only the last action can return a non-void value.

- **Suppress uninteresting call warnings with `NiceMock`, and enforce strict validity with `StrictMock`.**

- **Wrap arguments by reference with `std::ref()` when passing to `InvokeArgument()`.**

---

## Troubleshooting Common Issues

- If you see unexpected default return values, check if you have set the correct `ON_CALL` or `DefaultValue<T>::Set()`.

- If your mock method returns a move-only object and you use `Return()` repeatedly without `ByMove`, you'll get runtime errors.

- Unintended calls causing warnings? Verify whether to use `EXPECT_CALL(...).Times(AnyNumber())` or switch to `NiceMock`.

- If you want to test a method that returns a reference, ensure you use `ReturnRef()`, not `Return()`, otherwise compilation fails.

- If an action returns unused values and causes compiler errors in `DoAll`, wrap it in `IgnoreResult()`.

- Use `Invoke()` or `InvokeWithoutArgs()` correctly to avoid argument mismatches and ensure that the callable matches the expected function signature.

- If you encounter compilation errors mocking variadic or overloaded functions, check the appropriate use of `WithArgs`, explicit casts, or function pointer disambiguation.

---

For detailed explanations and many practical examples, please consult these related documentation pages:

- [Actions Reference](../actions.md)
- [Mocking Reference](../mocking.md)
- [gMock Cookbook - Using Actions](../gmock_cook_book.md#UsingActions)
- [API Reference - Built-in Matchers and Custom Actions](./builtin-matchers.md), (./custom-actions-matchers.md)

---