---
title: "Matchers Reference"
description: "Complete guide to GoogleTest matchers, enabling expressive assertions on values, containers, and complex types. Includes usage patterns for built-in, polymorphic, custom, and regex matchers, with practical code snippets."
---

# Matchers Reference

Complete guide to GoogleTest matchers, enabling expressive assertions on values, containers, and complex types. Includes usage patterns for built-in, polymorphic, custom, and regex matchers, with practical code snippets.

---

## Introduction to Matchers

Matchers form the core of expressive and powerful assertions in GoogleTest and GoogleMock. They allow you to specify rich conditions that values, objects, and container elements must satisfy during tests.

With matchers, tests become more readable and maintainable by expressing expectations almost like natural language, and by providing detailed failure messages that clarify why an assertion failed.

---

## Using Matchers with Assertions

Matchers are primarily used with the `EXPECT_THAT()` and `ASSERT_THAT()` assertion macros, which verify that a given value matches a specified matcher.

Example:

```cpp
#include <gmock/gmock.h>

using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(value1, StartsWith("Hello"));
EXPECT_THAT(value2, MatchesRegex("Line \\d+"));
ASSERT_THAT(value3, AllOf(Gt(5), Lt(10)));
```

If the assertion on `value1` fails, for instance, the failure message clearly states the mismatch:

```
Value of: value1
  Actual: "Hi, world!"
Expected: starts with "Hello"
```

---

## Categories of Built-in Matchers

GoogleTest provides a comprehensive set of built-in matchers categorized below.

### Basic Value Matchers

- **Equality and Comparison:** `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- **Boolean:** `IsTrue()`, `IsFalse()` (used internally by GoogleTest)
- **Wildcard:** `_` matches any value of any type
- **Nullness:** `IsNull()`, `NotNull()`

### String Matchers

Matchers that operate on strings (including wide strings, `std::string`, and C-style strings):

- **Exact match:** `StrEq()`, `StrNe()`, `StrCaseEq()`, `StrCaseNe()`
- **Substring:** `HasSubstr()`
- **Prefix/Suffix:** `StartsWith()`, `EndsWith()`
- **Regex-based:** `MatchesRegex()`, `ContainsRegex()`

### Container Matchers

Matchers for STL-style containers or native arrays:

- `ElementsAre()`, `ElementsAreArray()`: expects container elements to match in order
- `UnorderedElementsAre()`, `UnorderedElementsAreArray()`: expects container elements to match in any order
- `Contains()`: container must have at least one element matching the argument
- `Each()`: all elements match the provided matcher
- `SizeIs()`: container size satisfies a matcher
- `WhenSorted()`, `WhenSortedBy()`: match container after sorting
- `Pointwise()`, `UnorderedPointwise()`: element-wise matching of two containers

### Object and Member Matchers

- `Field(&Class::member, matcher)`: matches a member variable of an object
- `Property(&Class::getter, matcher)`: matches the result of a getter method
- `Key()`, `Pair()`: used with pairs and associative containers
- `Pointee(m)`: matches a pointer or smart pointer to an object matching `m`
- `Address(m)`: matches an object whose address matches `m`

### Composite Matchers

- `AllOf(...)`: logical AND
- `AnyOf(...)`: logical OR
- `Not(m)`: negation
- `Conditional(condition, m1, m2)`: chooses matcher based on condition

### Polymorphic Matchers

Many matchers are polymorphic and can adapt to different types automatically. For example, `Eq(value)` can match any type compatible with the value provided.

---

## Matcher Usage Patterns

### Simple Matching

Match a single value or argument against a matcher:

```cpp
EXPECT_THAT(my_value, Eq(42));
EXPECT_THAT(my_string, StartsWith("Test"));
```

### Parameterized Matchers

Matchers can be parameterized using the `MATCHER_P`, `MATCHER_P2`, ..., macros or by using built-in parameterized matchers:

```cpp
EXPECT_THAT(x, AllOf(Gt(5), Lt(10)));
EXPECT_THAT(s, HasSubstr("foo"));
```

### Combining Matchers

Use `AllOf()`, `AnyOf()`, and `Not()` to build expressive conditions:

```cpp
EXPECT_THAT(x, AllOf(Gt(5), Ne(7), Lt(10)));
EXPECT_THAT(name, AnyOf(StrEq("Alice"), StrEq("Bob")));
EXPECT_THAT(x, Not(Eq(0)));
```

### Matching Containers

Check container contents with exact order or unordered checks:

```cpp
std::vector<int> v = {1, 2, 3};
EXPECT_THAT(v, ElementsAre(1, 2, 3));
EXPECT_THAT(v, UnorderedElementsAre(3, 2, 1));
EXPECT_THAT(v, Contains(2));
```

### Matching Object Members

Validate specific members or properties of objects:

```cpp
class Foo {
 public:
  int x;
  std::string Name() const;
};

EXPECT_THAT(foo, Field(&Foo::x, Gt(5)));
EXPECT_THAT(foo, Property(&Foo::Name, StartsWith("John")));
```

### Matching Pointer Targets

For matching the object pointed to by a pointer smart or raw:

```cpp
int val = 10;
int* ptr = &val;
EXPECT_THAT(ptr, Pointee(Eq(10)));
```

### Custom and User-Defined Matchers

GoogleMock provides facilities to write your own matchers easily.

- Use the `MATCHER` and `MATCHER_P*` macros to quickly define new matchers.

- Implement the matcher interface directly for greater control.

Example:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_THAT(value, IsEven());
```

---

## Practical Tips and Best Practices

- Use `EXPECT_THAT` to leverage matchers, gaining readable tests and rich diagnostics.

- Combine matchers for complex conditions instead of writing complicated custom predicates.

- Use container matchers to validate collections precisely.

- Use `Ref()` when matching argument references.

- Use `SafeMatcherCast<T>()` to cast matchers between compatible types safely.

- Define custom matchers for reusable complex validation logic.

- Prefer `ON_CALL` for specifying default mock behavior and `EXPECT_CALL` for setting expectations.

- Use the rich set of built-in string matchers for string comparisons and regex matching.

- Be mindful that matchers must be pure functions with no side effects.

- For advanced usage, write polymorphic matchers that adapt to input types generically.

---

## Code Examples

### Basic Matcher Usage

```cpp
EXPECT_THAT(42, Eq(42));
EXPECT_THAT("Hello World", StartsWith("Hello"));
EXPECT_THAT(3.14, FloatEq(3.14));
```

### Container and Composite Matcher

```cpp
std::vector<int> v = {1, 2, 3};
EXPECT_THAT(v, ElementsAre(1, Gt(0), Lt(5)));
EXPECT_THAT(v, AllOf(Contains(2), SizeIs(3)));
```

### Matching Object Members

```cpp
struct Point {
  int x;
  int y;
};
Point p = {5, 10};
EXPECT_THAT(p, AllOf(Field(&Point::x, Ge(4)), Field(&Point::y, Lt(20))));
```

### Regex Matcher Example

```cpp
EXPECT_THAT("Error code: 1234", MatchesRegex("Error code: \\d+"));
```

### Writing a Custom Matcher

```cpp
MATCHER(IsPositive, "checks if value is positive") {
  return arg > 0;
}
EXPECT_THAT(value, IsPositive());
```

---

## Troubleshooting and Common Issues

### Matcher Not Matching as Expected

- Ensure the matcher type is compatible with the value.
- Use `SafeMatcherCast<T>()` to force safe type casts in complex scenarios.
- Stream explanations inside custom matchers to diagnose failures.

### Uninteresting Call Warnings in Mocks

- Use `NiceMock<T>` to suppress warnings on mock calls without expectations.
- Avoid suppressing these warnings blindly; consider adding broad expectations with `Times(AnyNumber())` for ignored calls.

### Complex Container Matching

- Use `ElementsAre()` and `UnorderedElementsAre()` depending on whether order matters.
- For nested containers, compose matchers.

### Using Regex Matchers

- Confirm your regex patterns are valid and compatible with the underlying regex engine.

---

## Reference Links

- [Assertions Reference](assertions.md) - how to use assertions with matchers.
- [Mocking Reference](mocking.md) - for usage of matchers in mock objects.
- [GoogleMock Cookbook](gmock_cook_book.md#NewMatchers) - guide on defining custom matchers and advanced usage.
- [Matchers Reference (this page)](matchers.md) - comprehensive API for matchers.

---

## See Also

- `EXPECT_THAT()` and `ASSERT_THAT()` macros in Assertions Reference.
- The rich set of built-in matchers: `Eq()`, `Gt()`, `Contains()`, `HasSubstr()`, etc.
- Custom matcher creation using `MATCHER` macros.
- Composite matcher construction with `AllOf()`, `AnyOf()`, `Not()`.

---

For deeper mastery of matchers, explore the related guides on [Assertions and Matchers](../guides/core-scenarios/assertions-matchers.mdx) and [Mocking](../api-reference/mocking/mocking.md).

<Source url="https://github.com/google/googletest" paths='[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-578"},{"path": "googlemock/test/gmock-matchers-comparisons_test.cc", "range": "140-720"}]' />