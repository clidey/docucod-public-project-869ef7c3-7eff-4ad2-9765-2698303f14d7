---
title: "Matchers API Reference"
description: "In-depth reference for standard and extended matchers used in GoogleTest and GoogleMock. Explains matcher syntax, chaining, composition, and scenario-based usage. Includes overview of custom matcher creation for advanced validation scenarios."
---

# Matchers API Reference

This page provides an in-depth reference for the **standard and extended matchers** offered by GoogleTest and GoogleMock. Matchers are essential for specifying the criteria that mock functions or assertions expect from arguments or return values. This documentation explains matcher syntax, how to combine them through chaining and composition, and application scenarios through practical examples. It also guides users on creating custom matchers for advanced and domain-specific validation.

---

## 1. Introduction to Matchers
Matchers serve as predicates to test whether a value satisfies certain conditions. They are fundamental to specifying expectations in mocks (`EXPECT_CALL`) and to making expressive assertions (`EXPECT_THAT`). Matchers can be:

- Simple values (e.g., `42` matches exactly `42`)
- Wildcards (e.g., `_` which matches any value)
- Predicate-like objects (e.g., `Ge(5)` matches any value greater or equal to 5)

Matchers are **type-safe and polymorphic**, meaning a single matcher expression like `Eq(5)` can be used with different types, so long as the operation is valid.

---

## 2. Basic Matchers Usage

### 2.1. The Wildcard Matcher
- `_` matches any argument regardless of its value or type.

Example:
```cpp
EXPECT_CALL(mock, Foo(_));  // Expect Foo to be called with any argument.
```

### 2.2. Equality Matcher
- `Eq(value)` matches arguments equal to `value`.
- You can use bare values directly as shorthand for `Eq`.

Example:
```cpp
EXPECT_CALL(mock, Bar(5));         // Matches Bar called with 5
EXPECT_CALL(mock, Bar(Eq(5)));     // Equivalent
```

### 2.3. Comparison Matchers
- `Ge(x)`: Greater or equal to `x`.
- `Gt(x)`: Greater than `x`.
- `Le(x)`: Less or equal to `x`.
- `Lt(x)`: Less than `x`.
- `Ne(x)`: Not equal to `x`.

Example:
```cpp
EXPECT_CALL(mock, Foo(Ge(10)));  // Foo called with argument >= 10
```

### 2.4. String Matchers
- `StrEq(s)`: String equality (`==`) match.
- `StrNe(s)`: Not equal strings.
- `StrCaseEq(s)`: Case-insensitive equal strings.
- `StrCaseNe(s)`: Case-insensitive non-equal.
- `HasSubstr(s)`: Contains substring `s`.
- `StartsWith(s)`: Starts with `s`.
- `EndsWith(s)`: Ends with `s`.

Example:
```cpp
EXPECT_CALL(mock, Print(StartsWith("Hello")));
```

### 2.5. Special Pointer Matchers
- `IsNull()`: Matches any null pointer.
- `NotNull()`: Matches any non-null pointer.
- `Pointee(m)`: Dereferences a pointer and matches its pointed-to value with matcher `m`.

Example:
```cpp
EXPECT_CALL(mock, LogData(Pointee(Ge(100))));
```

### 2.6. Ignoring Arguments
If you don’t care about the argument at all, use `_` to match anything. For non-overloaded methods, omitting arguments defaults to matching any value.

---

## 3. Combining and Composing Matchers

Matchers can be combined to refine criteria. GoogleTest provides the following combinators:

- `AllOf(m1, m2, ...)`: Matches if **all** sub-matchers match.
- `AnyOf(m1, m2, ...)`: Matches if **any** sub-matcher matches.
- `Not(m)`: Matches if the matcher `m` does not match.

Example:
```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(0), Lt(10), Ne(5))));
```

This expects `Foo` to be called with a value between 0 and 10 but not 5.

---

## 4. Advanced Matchers

### 4.1. Container Matchers
Matchers exist for STL-like containers allowing flexible matching of their contents.

- `ElementsAre(m1, m2, ...)`: Matches a container with elements matching the given matchers in order.
- `UnorderedElementsAre(m1, m2, ...)`: As above, but elements may be in any order.
- `ElementsAreArray(container_or_array)`: Like `ElementsAre` but takes a container or array.
- `UnorderedElementsAreArray(container_or_array)`: Like `UnorderedElementsAre` but takes a container or array.
- `Contains(m)`: Container has at least one element matching `m`.
- `Each(m)`: Every element matches `m`.
- `SizeIs(m)`: Container size matches `m`.

Example:
```cpp
EXPECT_CALL(mock, ProcessItems(ElementsAre(1, Ge(10), _)));
EXPECT_THAT(vec, UnorderedElementsAre(10, 2, 7));
```

### 4.2. Pair and Key Matchers
- `Pair(m1, m2)`: Matches `std::pair` whose first and second elements match `m1` and `m2` respectively.
- `Key(m)`: Matches `std::pair` or map element whose key matches `m`.

Example:
```cpp
EXPECT_THAT(my_map, Contains(Pair(Eq("foo"), Ge(3))));
```

### 4.3. Field and Property Matchers
- `Field(&Class::member, m)`: Matches an object whose member variable `member` matches matcher `m`.
- `Property(&Class::method, m)`: Matches an object whose `method()` return matches `m`.

These matchers can also operate on pointer types (null pointers fail automatically).

Example:
```cpp
EXPECT_THAT(foo, Field(&Foo::size, Ge(10)));
EXPECT_THAT(foo, Property(&Foo::Name, StartsWith("John")));
```

### 4.4. Tuple and Args Matchers
- `FieldsAre(m1, m2, ...)`: Matches aggregate or tuple types field-by-field.
- `Args<k1,k2,...>(m)`: Matches a tuple consisting of arguments at indices `k1, k2, ...` against matcher `m`.

Example:
```cpp
EXPECT_CALL(mock, Func(_, _)).With(Args<0,1>(Lt())); // First arg less than second
```

### 4.5. Conditional and Composite Matchers
- `Conditional(cond, m1, m2)`: Matches `m1` if `cond` is true, else `m2`.

---

## 5. Custom Matcher Creation

Advanced users may create custom matchers for domain-specific checks or complex validation.

### 5.1. Using MATCHER Macros for Quick Matchers
Define simple or parameterized matchers with `MATCHER` or `MATCHER_P` macros.

Example:
```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}
```

Usage:
```cpp
EXPECT_CALL(mock, Func(IsEven()));
EXPECT_THAT(x, HasAbsoluteValue(10));
```

You can stream custom failure details to `result_listener` inside the matcher for richer messages.

### 5.2. Writing New Matcher Classes
For full control, implement matcher classes that provide:

- `bool MatchAndExplain(const T& value, MatchResultListener*) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Then provide a factory function returning `testing::Matcher<T>`.

Example:
```cpp
class DivisibleBy7Matcher {
 public:
  bool MatchAndExplain(int n, std::ostream* os) const {
    int rem = n % 7;
    if (rem != 0 && os != nullptr) *os << "remainder is " << rem;
    return rem == 0;
  }
  void DescribeTo(std::ostream* os) const { *os << "is divisible by 7"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is not divisible by 7"; }
};

Matcher<int> DivisibleBy7() { return DivisibleBy7Matcher(); }
```

### 5.3. Polymorphic Matchers
Polymorphic matchers use templates within their `MatchAndExplain` method to accept multiple types. Use `MakePolymorphicMatcher()` to generate matchers from polymorphic classes.

Example:
```cpp
class NotNullMatcher {
 public:
  template <typename T>
  bool MatchAndExplain(T* p,
                       MatchResultListener*) const {
    return p != nullptr;
  }
  void DescribeTo(std::ostream* os) const { *os << "is not NULL"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }
};
PolymorphicMatcher<NotNullMatcher> NotNull() {
  return MakePolymorphicMatcher(NotNullMatcher());
}
```

---

## 6. Matcher Evaluation Tips and Best Practices

- **Specify only necessary argument matchers** to avoid brittle tests.
- Use `_` wildcard for arguments whose precise values do not matter.
- Use `SafeMatcherCast<T>(m)` when you need to relax type strictness safely.
- Use `With()` clause with a multi-argument matcher when argument relations matter.
- Combine matchers logically with `AllOf()`, `AnyOf()`, and `Not()` to express complex expectations clearly.
- Use container matchers to handle STL and array types concisely.
- When mocking overloaded methods, help disambiguate with explicit matcher or type specifications.
- When defining custom matchers, ensure purity: no side effects in matcher code.

---

## 7. Troubleshooting Common Matcher Issues

### 7.1. Ambiguous Overloads
If your mock method is overloaded, specifying an expectation may fail without help:

```cpp
EXPECT_CALL(mock, Foo(Eq(5)));          // May fail if Foo overloaded
EXPECT_CALL(mock, Foo(Matcher<int>(Eq(5))));  // Disambiguates
```

You can also use the `Const()` wrapper if overloading differs by const-ness:
```cpp
EXPECT_CALL(Const(mock), GetValue());   // Calls const GetValue()
```

### 7.2. Uninteresting vs Unexpected Calls
- **Uninteresting call**: No expectation is set for the method. Prints warning but test passes (unless using strict mocks).
- **Unexpected call**: An expectation is set but arguments do not match any expected pattern. Causes test failure.

To avoid uninteresting warnings, use:
- `NiceMock<>` to silence warnings.
- Catch-all expectations (`EXPECT_CALL(mock, Foo(_)).Times(AnyNumber());`) carefully ordered.

### 7.3. Matchers with Side Effects
Matchers must be **pure** functions without side effects. This is critical as matchers may be invoked multiple times or in unpredictable order.

### 7.4. Default Actions May Conflict
If you use `Return()` with move-only types, be mindful that the object is moved only once. For repetitive calls, consider using lambdas.

---

## 8. Code Examples

### 8.1. Basic Matcher Usage
```cpp
using ::testing::_;            // Wildcard matcher
using ::testing::Eq;           // Equality matcher
using ::testing::Ge;           // Greater or equal matcher
using ::testing::StartsWith;   // String matcher

EXPECT_CALL(mock, Foo(Ge(10)));           // Foo called with >= 10
EXPECT_CALL(mock, Print(StartsWith("Hi"))); // Print called with string starting with "Hi"
EXPECT_CALL(mock, Bar(_));                // Bar called with any argument
```

### 8.2. Combining Matchers
```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(0), Lt(100), Not(Eq(42)))));
```

### 8.3. Container Matchers
```cpp
EXPECT_CALL(mock, ProcessNumbers(ElementsAre(1, Ge(10), _)));
EXPECT_THAT(my_vec, UnorderedElementsAre(5, 3, 7));
```

### 8.4. Custom Matcher Example
```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "remainder is " << (arg % 7);
  return false;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

### 8.5. Using `Field` Matcher
```cpp
EXPECT_THAT(object, Field(&MyClass::count, Ge(5))); // object.count >= 5
```

### 8.6. Using `Pointee` Matcher
```cpp
EXPECT_CALL(mock, DoSomething(Pointee(Eq(42)))); // Argument points to 42
```

---

## 9. Related Documentation

To effectively use matchers, consult these related guides: 

- [gMock for Dummies](gmock_for_dummies.md) – Learn basic mocking and matcher usage.
- [gMock Cheat Sheet](gmock_cheat_sheet.md) – Quick reference for matchers, actions, and more.
- [Mocking Reference](reference/mocking.md) – Detailed API for mocking including matcher composition.
- [Assertions Reference](reference/assertions.md) – Using matchers inside assertions like `EXPECT_THAT`.
- [gMock Cookbook](gmock_cook_book.md#NewMatchers) – Advanced recipes including creating custom matchers.

---

This reference empowers you to apply expressive, precise matchers to verify behaviors and data in your C++ tests with GoogleTest and GoogleMock, helping you write robust and maintainable test suites.
