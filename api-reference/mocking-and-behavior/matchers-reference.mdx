---
title: "Matchers: Expressive Argument Matching"
description: "Documents the suite of built-in matchers, custom matcher support, and how to use matchers to finely control expectations on mock function arguments. Includes code examples for common pattern matches."
---

# Matchers: Expressive Argument Matching

GoogleMock (gMock) provides a rich set of *matchers*â€”powerful predicates used to specify expectations on mock method arguments. Matchers allow your tests to precisely control and verify the kinds of arguments your mock methods receive, enabling expressive, readable, and robust unit tests.

This documentation details the built-in matchers, how to compose and use them fluently, and how to define your own matchers tailored to your testing needs.

---

## What Are Matchers?

Matchers are predicate objects that test whether an argument passed to a mock method fulfills certain criteria. You can use them inside `EXPECT_CALL()` or `ON_CALL()` to match argument values precisely, without writing cumbersome custom checks.

A matcher can be:

- A **simple equality** check, like `Eq(5)` which tests if the argument equals 5.
- A **range**, e.g., `Ge(3)` which checks if the argument is greater or equal to 3.
- A **complex composite condition** built by combining other matchers.
- A **custom matcher** you define to test domain-specific properties.

Use matchers whenever you want your expectations to be *expressive* and *maintainable*.

## Using Matchers with `EXPECT_CALL` and `EXPECT_THAT`

Matchers can be passed as arguments inside mock method expectations:

```cpp
using ::testing::_;          // Matches anything
using ::testing::Eq;         // Equals matcher
using ::testing::Ge;         // Greater or equal matcher

EXPECT_CALL(mock_object, Foo(
    Ge(10),     // first argument >= 10
    _,          // second argument: anything
    Eq("bar") // third argument == "bar"
));
```

Alternatively, you can use matchers to assert general values, not necessarily arguments:

```cpp
using ::testing::HasSubstr;
using ::testing::StartsWith;

EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(error_message, HasSubstr("File not found"));
```

## Built-in Matcher Categories

### Wildcard Matchers

| Matcher            | Description                           |
|--------------------|-------------------------------------|
| `_`                | Matches *any* argument value.        |
| `A<type>()` or `An<type>()` | Matches any value of the specified type `type`. |

### Generic Comparison Matchers

| Matcher       | Meaning                                 |
|---------------|-----------------------------------------|
| `Eq(value)`   | Equals `value`.                         |
| `Ne(value)`   | Not equals `value`.                     |
| `Lt(value)`   | Less than `value`.                      |
| `Le(value)`   | Less than or equal to `value`.         |
| `Gt(value)`   | Greater than `value`.                   |
| `Ge(value)`   | Greater than or equal to `value`.      |
| `IsTrue()`    | Evaluates to `true` in a Boolean context. |
| `IsFalse()`   | Evaluates to `false` in a Boolean context.|
| `IsNull()`    | Argument is a null pointer (raw or smart). |
| `NotNull()`   | Argument is a non-null pointer.        |
| `Optional(m)` | Optional containing a value matching `m`. |
| `VariantWith<T>(m)` | Variant of type `T` containing a value matching `m`. |
| `Ref(variable)` | Argument is a reference to the specified variable. |

### Floating-Point Matchers

Due to the nature of floating-point operations, exact equality is often problematic. Use these approximate equality matchers:

| Matcher                     | Description                                              |
|-----------------------------|----------------------------------------------------------|
| `FloatEq(value)`            | `float` approximately equals `value`.                   |
| `DoubleEq(value)`           | `double` approximately equals `value`.                  |
| `NanSensitiveFloatEq(value)`| As above, but treats NaNs as equal.                      |
| `NanSensitiveDoubleEq(value)`| As above, but treats NaNs as equal.                      |
| `FloatNear(value, max_abs_error)` | `float` close to `value` within absolute error.        |
| `DoubleNear(value, max_abs_error)`| `double` close to `value` within absolute error.       |
| `NanSensitiveFloatNear(value, max_abs_error)`| As above, treating NaNs equal.                    |
| `NanSensitiveDoubleNear(value, max_abs_error)`| As above, treating NaNs equal.                  |
| `IsNan()`                  | Argument is a NaN floating-point value.                  |

### String Matchers

Apply to C-style strings or `std::string` objects:

| Matcher           | Description                                  |
|-------------------|----------------------------------------------|
| `ContainsRegex(s)` | Matches regex `s` anywhere in the string.    |
| `MatchesRegex(s)`  | Matches regex `s` against the entire string. |
| `HasSubstr(s)`    | Contains substring `s`.                       |
| `IsEmpty()`       | Is an empty string.                           |
| `StartsWith(s)`   | Starts with prefix `s`.                       |
| `EndsWith(s)`     | Ends with suffix `s`.                         |
| `StrEq(s)`        | String equals `s`.                            |
| `StrNe(s)`        | String not equal to `s`.                       |
| `StrCaseEq(s)`    | String equals `s` ignoring case.              |
| `StrCaseNe(s)`    | String not equal to `s`, ignoring case.       |
| `WhenBase64Unescaped(m)` | String is base64 encoded and unescaped string matches `m`. |

### Container Matchers

For matching STL-like containers:

| Matcher                           | Description                                       |
|---------------------------------|---------------------------------------------------|
| `BeginEndDistanceIs(m)`           | Distance between `begin()` and `end()` matches `m`. |
| `ContainerEq(container)`          | Exactly equals container; describes missing/excess elements if not. |
| `Contains(e)`                    | Contains element matching `e`.                    |
| `Contains(e).Times(n)`           | Contains `n` matching elements.                    |
| `Each(e)`                       | Every element matches `e`.                         |
| `ElementsAre(e0, e1, ..., en)`   | Has exactly the elements matching in the given order. |
| `ElementsAreArray(...)`          | As above, but matches taken from array or range.    |
| `IsEmpty()`                     | Is empty container.                               |
| `IsSubsetOf(...)`               | Matches subset of given matchers.                  |
| `IsSupersetOf(...)`             | Superset of given matchers.                         |
| `Pointwise(m, container)`       | Matches pairwise elements using matcher `m`.      |
| `SizeIs(m)`                     | Container size matches `m`.                         |
| `UnorderedElementsAre(...)`     | Matches elements in any order exactly.             |
| `UnorderedElementsAreArray(...)`| Same as above, with array or container.            |
| `UnorderedPointwise(m, container)` | Like `Pointwise()` but ignores order.             |
| `WhenSorted(m)`                 | Container matches when sorted with `<`.            |
| `WhenSortedBy(comp, m)`          | Container matches when sorted with given comparator.

### Member Matchers

Match individual members of objects or properties:

| Matcher                          | Description                                   |
|---------------------------------|-----------------------------------------------|
| `Field(&Class::field, m)`       | Member variable matches `m`.                  |
| `Field(name, &Class::field, m)` | As above, but with member name for better error messages. |
| `Property(&Class::property, m)`  | Return value of property's getter matches `m`. |
| `Property(name, &Class::property, m)` | As above, but with property name for better error messages. |
| `Key(e)`                       | For `std::pair`, the `first` field matches `e`. |
| `Pair(m1, m2)`                 | For `std::pair`, matches first with `m1` and second with `m2`. |
| `Pointee(m)`                   | Pointer points to a value matching `m`.       |
| `Pointer(m)`                   | The pointer value matches `m`. (Raw or smart pointers) |
| `Address(m)`                   | The address of the object matches `m`.         |
| `WhenDynamicCastTo<T>(m)`      | Dynamic cast to `T` matches `m`.                |

### Multi-argument Matchers

Use matchers that act on tuples of arguments:

| Matcher       | Description                                 |
|---------------|---------------------------------------------|
| `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()` | Match tuple `(x,y)` using the operator on `x` and `y`. |
| `Args<N1, N2, ..., Nk>(m)`    | Match subset of arguments at indices `N1, N2, ..., Nk` as a tuple with matcher `m`. |
| `AllArgs(m)`                  | Match all arguments using `m`.                 |

### Composite Matchers

Build matchers from multiple other matchers:

| Matcher             | Description                               |
|---------------------|-------------------------------------------|
| `AllOf(m1, m2, ...)` | Matches if all sub-matchers match.         |
| `AnyOf(m1, m2, ...)` | Matches if any sub-matcher matches.        |
| `Not(m)`             | Matches if the matcher `m` does not match. |
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` is true, else `m2`. |

### Adapters

Transform or cast matchers:

| Matcher            | Description                            |
|--------------------|----------------------------------------|
| `MatcherCast<T>(m)`  | Cast matcher `m` to type `Matcher<T>`. |
| `SafeMatcherCast<T>(m)` | Safe cast with additional compile-time checks.|  
| `Truly(predicate)`  | Turns any unary predicate into a matcher. |
| `Matches(m)(value)` | Evaluates to `true` if `value` matches `m`. |

## Matcher Usage Examples

Here are practical examples to demonstrate matcher usage:

### Matching Simple Arguments

```cpp
EXPECT_CALL(foo, Bar(5));       // Expects argument == 5
EXPECT_CALL(foo, Bar(Ge(10)));  // Argument >= 10
EXPECT_CALL(foo, Bar(_));        // Any argument
```

### Matching Pointer Arguments

```cpp
EXPECT_CALL(foo, Bar(IsNull()));       // Null pointer
EXPECT_CALL(foo, Bar(NotNull()));      // Non-null pointer
EXPECT_CALL(foo, Bar(Pointee(Ge(5)))); // Pointer to value >= 5
```

### Matching Strings

```cpp
EXPECT_CALL(foo, Bar(StartsWith("Hello")));    // Starts with "Hello"
EXPECT_CALL(foo, Bar(HasSubstr("world")));     // Contains "world"
EXPECT_CALL(foo, Bar(StrCaseEq("test")));      // Case-insensitive equality
```

### Matching Containers

```cpp
std::vector<int> expected = {1, 2, 3};
EXPECT_CALL(foo, Process(ContainerEq(expected)));
EXPECT_CALL(foo, Process(ElementsAre(1, _, 3)));
EXPECT_CALL(foo, Process(UnorderedElementsAre(3, 1, 2)));
```

### Matching Members of Objects

```cpp
EXPECT_CALL(foo, SetData(Field(&MyData::id, Eq(42))));
EXPECT_CALL(foo, Update(Property(&MyData::GetName, StartsWith("John"))));
```

### Combining Matchers

```cpp
EXPECT_CALL(foo, Bar(AllOf(Ge(5), Lt(10))));                 // argument in [5,10)
EXPECT_CALL(foo, Bar(AnyOf(Eq("yes"), Eq("ok"))));       // argument "yes" or "ok"
EXPECT_CALL(foo, Bar(Not(Contains("fail"))));               // argument does not contain "fail"
```

### Using Matchers with `EXPECT_THAT`

```cpp
EXPECT_THAT(result, ContainerEq(expected));
EXPECT_THAT(str, HasSubstr("abc"));
EXPECT_THAT(value, AllOf(Ge(1), Le(100)));
```

## Defining Custom Matchers

When the built-in matchers don't suffice, gMock offers several ways to create your own matchers with clear failure messages.

### Using `MATCHER` Macros

Simplest and recommended way for many cases:

```cpp
MATCHER(IsEven, "is an even number") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(foo, Bar(IsEven()));
EXPECT_THAT(value, IsEven());
```

You can stream additional details to a hidden `result_listener` to precisely explain failures:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "remainder was " << (arg % 7);
  return false;
}
```

### Writing Matcher Classes

For more advanced users, define a matcher class implementing:

- `bool MatchAndExplain(const T& value, std::ostream* listener) const;`
- `void DescribeTo(std::ostream* os) const;`
- `void DescribeNegationTo(std::ostream* os) const;`

Then wrap it in a `Matcher<T>` factory.

### Polymorphic Matchers

Define matcher classes with templated `MatchAndExplain` to match multiple types:

```cpp
class NotNullMatcher {
 public:
  template <typename T>
  bool MatchAndExplain(T* p, std::ostream*) const { return p != nullptr; }
  void DescribeTo(std::ostream* os) const { *os << "is not NULL"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }
};

inline testing::PolymorphicMatcher<NotNullMatcher> NotNull() {
  return testing::MakePolymorphicMatcher(NotNullMatcher());
}
```

## Tips and Best Practices

- Always *only* match what you *care* about; use `_` for unimportant arguments.
- Combine matchers with `AllOf`, `AnyOf`, and `Not` to express complex conditions clearly.
- Use `Field()` and `Property()` to test specific object members when full object equality is unnecessary.
- Use matcher variables to reuse complex matchers for readability.
- When testing order or sequences, combine matchers with the `InSequence` clause on expectations.
- For containers with unordered contents, prefer `UnorderedElementsAre`.
- Use `EXPECT_THAT` with matchers for powerful and readable assertions outside mocks.

## Common Pitfalls

- Avoid comparing C strings with `Eq` which compares pointers. Use string-specific matchers like `StrEq`.
- Overuse of strict argument matching can lead to brittle tests sensitive to internal changes.
- Remember that matchers must be *pure*: they cannot modify state or call mock functions themselves.
- Use `SafeMatcherCast` if you need to relax type strictness safely.

## Where to Learn More

- [Matchers Reference](reference/matchers.md) for comprehensive lists and details.
- [gMock Cookbook](guides/advanced-usage-patterns/mocking-actions-and-matchers.mdx) for advanced recipes on custom matchers and actions.
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) for quick matcher syntax.

---

This page provides your primary resource to effectively specify and control argument matching in GoogleMock, empowering your tests to validate exactly what matters with clear error messages and expressive syntax.
