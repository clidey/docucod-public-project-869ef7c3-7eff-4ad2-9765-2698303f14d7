---
title: "Portability, Flags, and Environment Utilities"
description: "Reference for macros, utility types, and environment helpers ensuring cross-platform compatibility. Explains flag definitions, porting macros, and configuration hooks available to adapt GoogleTest and GoogleMock to various compilers and platforms."
---

# Portability, Flags, and Environment Utilities

This reference page details the macros, utility types, and environment helpers that GoogleTest and GoogleMock provide to ensure compatibility and configurability across diverse platforms and compilers. It explains key flag definitions, portability macros, and hooks that allow users and integrators to adapt these frameworks to various building environments, operating systems, and compiler capabilities.

---

## Overview

GoogleTest and GoogleMock are designed to operate seamlessly on a wide range of platforms and compilers, from desktop systems (Windows, Linux, macOS) to embedded devices and mobile platforms. Achieving smooth portability requires identifying the environment, conditional compilation, and providing configuration macros to toggle features as needed.

This page focuses exclusively on these portability utilities and environment-related macros that allow you to customize and configure GoogleTest and GoogleMock behavior based on your platform, compiler, and build system.


## Platform and Compiler Detection Macros

GoogleTest and GoogleMock automatically detect many platforms and compilers using predefined macros. These macros are defined consistently and always set to 1 or undefined. Examples include:

- `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, `GTEST_OS_IOS`, and others for OS/platform identification.
- Sub-flags such as `GTEST_OS_WINDOWS_DESKTOP`, `GTEST_OS_WINDOWS_MINGW`, and `GTEST_OS_WINDOWS_PHONE` help differentiate Windows variants.

Knowing these macros allows your tests and integrations to conditionally enable or disable tests and features depending on the system.

### Example:
```cpp
#ifdef GTEST_OS_LINUX
// Enable Linux-specific test features
#endif
```

These macros are defined in `gtest/internal/gtest-port-arch.h` which detects platforms by probing compiler predefined macros.


## Feature and Capability Macros

Beyond platform detection, GoogleTest defines a series of macros indicating availability of key features:

- `GTEST_HAS_PTHREAD`: Indicates availability of POSIX threads support.
- `GTEST_HAS_EXCEPTIONS`: Indicates if C++ exceptions are enabled.
- `GTEST_HAS_RTTI`: Indicates if RTTI (runtime type information) is available.
- `GTEST_HAS_DEATH_TEST`: Indicates if death tests can be executed on the platform.
- `GTEST_HAS_FILE_SYSTEM`: Whether the platform provides a filesystem.
- `GTEST_IS_THREADSAFE`: Indicates whether GoogleTest is built as thread-safe.

You can override these macros in your build settings to tweak GoogleTest behavior for particular platforms or toolchains that are not auto-detected correctly.


## Configuration and Control Macros

GoogleTest supports controlling its build and runtime behavior via macros defined at compile time. These control macros allow enabling or disabling certain functionality:

- `GTEST_HAS_PTHREAD=1|0`: Force-enable or disable pthread support if auto-detection is incorrect.
- `GTEST_CREATE_SHARED_LIBRARY=1`: Build GoogleTest as a shared library (DLL).
- `GTEST_LINKED_AS_SHARED_LIBRARY=1`: Indicate that tests link against GoogleTest shared library.
- `GTEST_DEFAULT_DEATH_TEST_STYLE="fast"|"threadsafe"`: Set default death test style.

### Avoiding Macro Collisions

GoogleTest macros can sometimes clash with other libraries due to global macro names like `TEST`, `ASSERT_EQ`. You can prepend `-DGTEST_DONT_DEFINE_TEST=1` (and similar for other macros) to rename these macros and avoid conflict, requiring usage of prefixed macros like `GTEST_TEST` instead.


## Environment and Flag Utilities

To operate effectively in diverse environments and integrate with command line tooling, GoogleTest provides utility macros and functions:

### Flags

- GoogleTest and GoogleMock use a flag system to configure runtime behavior.
- Macros like `GTEST_DEFINE_bool_`, `GTEST_DEFINE_int32_`, and `GTEST_DEFINE_string_` define flags with default values and documentation.
- Accessors like `GTEST_FLAG(name)` or `GMOCK_FLAG(name)` let you get or set flag values programmatically.
- When built with Abseil, flags can integrate with Abseil's flag library.


### Environment Variables

- Functions like `GetEnv()` get environment variables safely across platforms.
- Parsers like `BoolFromGTestEnv()`, `Int32FromGTestEnv()`, and `StringFromGTestEnv()` read environment variables corresponding to GoogleTest flags.


## Synchronization Primitives and Threading Support

Thread safety is essential for many test scenarios. GoogleTest provides:

- `Mutex` and `MutexLock` implementations for mutual exclusion on both Windows and POSIX.
- `ThreadLocal<T>` to store thread-local variables.
- `Notification` primitive to coordinate thread start-up in GoogleTest internals.

These threading primitives are conditionally compiled depending on platform capabilities and are designed to be leak-safe and performance optimized.


## POSIX and Platform-Specific Wrappers

GoogleTest includes wrappers around POSIX functions to unify interface differences across platforms:

- File system calls like `Stat()`, `RmDir()`, and `IsDir()` have consistent signatures.
- I/O functions such as `Read()`, `Write()`, `Close()`, `FOpen()` adapt to Windows or POSIX implementations.
- String and file descriptor utilities like `StrCaseCmp()` and `IsATTY()` handle platform quirks.

These utilities make writing portable test code much easier by hiding platform-specific details.


## Porting Macros and Inline Attributes

GoogleTest defines macros to annotate functions and suppress warnings or enable specific compiler features:

- `GTEST_NO_INLINE_` prevents a function from being inlined for better debugging.
- `GTEST_NO_TAIL_CALL_` disables tail call optimizations.
- Disabling MSVC warnings around deprecated functions and constant conditions.

Users extending or integrating GoogleTest may define these macros or follow their usage to maintain cross-platform compatibility.


## Practical Tips and Best Practices

- Use the provided platform macros to selectively compile tests or features where supported.
- Override detection macros only if absolutely necessary, e.g., if your environment isn't detected properly.
- When building shared libraries or using GoogleTest as a DLL, always use the recommended `GTEST_CREATE_SHARED_LIBRARY` and `GTEST_LINKED_AS_SHARED_LIBRARY` flags.
- To avoid macro name conflicts in complex projects with multiple libraries, force rename GoogleTest macros and use prefixed versions.
- When using flags, consider Abseil integration if you use Abseil in your project for a unified flag experience.


## Example: Forcing pthread Support

If GoogleTest fails to detect pthreads correctly and your platform does support it:

```bash
# Add to your compiler flags
-DGTEST_HAS_PTHREAD=1
```

and ensure you link your test binary with pthread (e.g., `-lpthread` on Unix).


## Source and Further Reading

- Platform detection macros: [`gtest-port-arch.h`](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port-arch.h)
- Core portability utilities: [`gtest-port.h`](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h)
- GoogleMock port utilities: [`gmock-port.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/internal/gmock-port.h)
- Custom configuration injection hooks: [`custom/README.md`](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/custom/README.md)


---

## Troubleshooting Common Portability Issues

### Problem: GoogleTest Does Not Detect pthreads on Your Platform

**Solution:**
- Add `-DGTEST_HAS_PTHREAD=1` to your compiler flags.
- Ensure that the pthread library is linked to your executable.
- Use the CMake integration which automatically links pthread.

### Problem: Name Conflicts with GoogleTest Macros

**Solution:**
- Use the `-DGTEST_DONT_DEFINE_TEST=1` (and similar for other macros) to rename GoogleTest macros.
- Update your test code to use the prefixed macros, e.g., `GTEST_TEST` instead of `TEST`.

### Problem: Linking Problems with Shared Libraries on Windows

**Solution:**
- Use `-DGTEST_CREATE_SHARED_LIBRARY=1` when building the GoogleTest library.
- Use `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when building your test executable.
- Enable `gtest_force_shared_crt` option in CMake to unify runtime library usage.


## Summary

This page is essential for advanced users and integrators who require fine-grained control over platform compatibility and build environment support in GoogleTest and GoogleMock. By understanding these portability utilities and macros, you can customize and extend the framework safely and reliably across diverse use cases.


---


<AccordionGroup title="Key Macros and Utilities">
<Accordion title="Platform Detection Macros">
Use these to conditionally compile for platforms like Windows, Linux, macOS, Android, iOS, and embedded OSes.

Example: `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, `GTEST_OS_IOS`
</Accordion>
<Accordion title="Feature Flags">
Defines availability of key features: exceptions, pthreads, death tests, RTTI, thread safety, filesystem support.

Example: `GTEST_HAS_EXCEPTIONS`, `GTEST_HAS_PTHREAD`, `GTEST_HAS_DEATH_TEST`.
</Accordion>
<Accordion title="Synchronization primitives">
`Mutex`, `MutexLock`, `ThreadLocal<T>`, and `Notification` for cross-platform threading and synchronization support.
</Accordion>
<Accordion title="Flag Definition and Access Macros">
Macros like `GTEST_DEFINE_bool_`, `GMOCK_DEFINE_int32_` define configurable build/runtime flags with default values.

Use `GTEST_FLAG(name)` or `GMOCK_FLAG(name)` to get/set flags programmatically.
</Accordion>
</AccordionGroup>


## Related Pages

- [GoogleTest Primer](https://google.github.io/googletest/primer) — To get started with writing and running tests.
- [Integration and Dependencies](https://google.github.io/googletest/overview/architecture-and-integration/integration-and-dependencies) — For build system and platform integration guidance.
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md) — For mocking framework specifics.
- [Custom Configuration Points](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/custom/README.md) — For user customization hooks.


## References

- [`gtest-port.h`](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h)
- [`gtest-port-arch.h`](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port-arch.h)
- [`gmock-port.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/internal/gmock-port.h)



---