---
title: "Actions Reference"
description: "Catalog of built-in and custom action APIs for configuring how mocks behave (returning values, invoking functions, manipulating arguments). Covers gmock-actions.h and gmock-more-actions.h for advanced scripting."
---

# Actions Reference

Actions define the behavior of mocked functions in GoogleMock. This reference catalogs the built-in and custom action APIs available to configure mock methods—what they return, how they manipulate arguments, invoke functions, or throw exceptions.

All actions reside in the `::testing` namespace.

---

## Returning a Value

These actions specify what a mock function returns upon invocation:

| Action                          | Description                                                                                          |
|--------------------------------|------------------------------------------------------------------------------------------------------|
| `Return()`                     | Return from a `void` mock function (effectively does nothing).
| `Return(value)`                | Return `value`. The value is converted to the mock function's return type *at expectation set time*, not at call time.
| `ReturnArg<N>()`               | Return the N-th (0-based) argument of the mock function.
| `ReturnNew<T>(a1, ..., ak)`    | Create and return a new object of type `T` constructed with `(a1, ..., ak)`. A fresh object is created each call.
| `ReturnNull()`                 | Return a null pointer.
| `ReturnPointee(ptr)`           | Return the value pointed to by the pointer `ptr` at the time the action executes.
| `ReturnRef(variable)`          | Return a reference to `variable`.
| `ReturnRefOfCopy(value)`       | Return a reference to a copy of `value`; the copy lives as long as the action.
| `ReturnRoundRobin({a1,...,ak})` | Cycle through the elements in the list, returning each in turn for successive calls.

### Practical Tips

- Use `ReturnRef()` when your method’s return type is a non-const reference.
- Use `ReturnPointee()` to dynamically return a changing value referenced by a pointer.
- Avoid returning references to local variables to prevent dangling references.

---

## Side Effects

These actions perform side effects such as modifying out-parameters or deleting pointers:

| Action                             | Description                                                                                  |
|-----------------------------------|----------------------------------------------------------------------------------------------|
| `Assign(&variable, value)`         | Assigns `value` to `variable`.
| `DeleteArg<N>()`                   | Deletes the N-th argument, which must be a pointer.
| `SaveArg<N>(pointer)`              | Saves the N-th argument by copy assignment to `*pointer`.
| `SaveArgByMove<N>(pointer)`       | Saves the N-th argument by move assignment to `*pointer`.
| `SaveArgPointee<N>(pointer)`      | Saves the value pointed to by the N-th argument to `*pointer`.
| `SetArgReferee<N>(value)`         | Assigns `value` to the variable referred to by the N-th argument.
| `SetArgPointee<N>(value)`         | Assigns `value` to the variable pointed to by the N-th argument.
| `SetArgumentPointee<N>(value)`    | Deprecated synonym for `SetArgPointee<N>(value)`.
| `SetArrayArgument<N>(first, last)`| Copies elements `[first, last)` to the array/iterator pointed by the N-th argument.
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` and returns `value`.
| `Throw(exception)`                | Throws the supplied exception object. Available since v1.1.0.

### Use Cases

- Use `SetArgPointee` to mock functions with output pointer parameters.
- Use `DeleteArg` for functions that take ownership of pointer arguments.
- Use `Throw` to simulate exceptions in mocked functions.

---

## Invoking Functions, Functors, or Lambdas as Actions

You can specify an action that calls another callable, forwarding the arguments:

| Action                                            | Description                                                                          |
|--------------------------------------------------|--------------------------------------------------------------------------------------|
| `f`                                              | Invoke callable `f` with the mock's arguments.
| `Invoke(f)`                                       | Invoke the global/static function or functor `f` with the mock's arguments.
| `Invoke(object_pointer, &class::method)`         | Invoke the method on the given object with the mock's arguments.
| `InvokeWithoutArgs(f)`                            | Invoke callable `f` with *no* arguments.
| `InvokeWithoutArgs(object_pointer, &method)`     | Invoke object’s method with no arguments.
| `InvokeArgument<N>(args...)`                      | Invoke the N-th argument (which must be callable) with supplied `args...`.

#### Notes

- When passing by reference to `InvokeArgument`, use `std::ref()` to pass by reference instead of by value.

#### Example

```cpp
using ::testing::Invoke;
using ::testing::InvokeArgument;

// Directly invoke a free function.
EXPECT_CALL(mock, Foo(_, _)).WillOnce(Invoke(SomeFunction));

// Invoke a method on a helper object.
EXPECT_CALL(mock, Bar(_)).WillOnce(Invoke(&helper, &Helper::DoWork));

// Invoke the 1st argument (index 0) as a callback with parameters.
EXPECT_CALL(mock, RegisterCallback(_))
    .WillOnce(InvokeArgument<0>(5, std::ref(some_object)));
```

---

## Default Action

| Action        | Description                                                        |
|---------------|--------------------------------------------------------------------|
| `DoDefault()` | Performs the default action as specified by an `ON_CALL` or by GoogleMock’s built-in default.

> **Important:** `DoDefault()` cannot be used inside composite actions like `DoAll()` due to technical reasons; doing so results in a runtime error.

---

## Composite Actions

Chain or manipulate multiple actions into one:

| Action                          | Description                                                                   |
|--------------------------------|-------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)`       | Performs all actions `a1` through `an` in order; returns the result of `an`.
| `IgnoreResult(a)`               | Executes action `a` and ignores its result; useful when `a` returns a value but the mock needs `void`.
| `WithArg<N>(a)`                 | Passes the N-th argument of the mock function to the inner action `a`.
| `WithArgs<N1, N2, ..., Nk>(a)` | Passes selected arguments to `a`.
| `WithoutArgs(a)`                | Executes action `a` with no arguments, regardless of the mock function's arguments.

---

## Defining Your Own Actions

You can define custom actions using macros:

| Macro                         | Description                                                        |
|-------------------------------|------------------------------------------------------------------|
| `ACTION(Name) { ... }`         | Defines an action with no parameters.
| `ACTION_P(Name, param) { ... }`| Defines an action with one parameter.
| `ACTION_Pk(Name, p1, ..., pk)` | Defines a parameterized action with multiple parameters.

Inside the action body, you can access the mock function’s arguments using `arg0`, `arg1`, ..., and the return type via `return_type`.

Example:

```cpp
ACTION(DoubleFirstArg) { return 2 * arg0; }
...
EXPECT_CALL(mock, Method(_))
    .WillOnce(DoubleFirstArg());
```

### Recommendations

- Prefer lambdas or functors for new code instead of `ACTION` macros for better type safety and clarity.
- Use `ACTION_TEMPLATE` when writing template actions needing explicit template parameters.

---

## Best Practices and Common Pitfalls

- **Ordering of Actions:** `WillOnce` clauses are invoked sequentially; after they are exhausted, `WillRepeatedly` (if present) is repeated.
- **Sticky Expectations:** Expectations do not retire automatically after invocation unless `.RetiresOnSaturation()` is used.
- **Default Values:** Use `DefaultValue<T>::Set()` to define default return values for types.
- **Passing References:** Use `ReturnRef` or `ReturnPointee` to return references or pointer dereferenced values.
- **Handling Move-Only Types:** Use lambdas for move-only return types and input arguments.

---

## Example Usage

```cpp
using ::testing::Return;
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Invoke;

class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (int x, int* y), ());
};

TEST(FooTest, ComputeTest) {
  MockFoo mock;

  EXPECT_CALL(mock, Compute(_, _))
      .WillOnce(DoAll(SetArgPointee<1>(42), Return(7)))
      .WillRepeatedly(Return(0));

  int out = 0;

  int result = mock.Compute(5, &out);
  EXPECT_EQ(result, 7);
  EXPECT_EQ(out, 42);

  result = mock.Compute(10, &out);
  EXPECT_EQ(result, 0);
}
```

This test sets up `Compute` to *set* the output parameter pointed by the second argument to 42 and return 7 on the first call, then always return 0 afterwards.

---

## Related Topics
- [Mocking Reference](../reference/mocking.md) for general mocking constructs
- [Expectations and Sequencing](../googlemock-api/expectations-and-sequencing.md) to control call order
- [Matchers Reference](../googlemock-api/matcher-apis.md) for validating arguments
- [gMock Cookbook](../gmock_cook_book.md) for practical recipes

## Troubleshooting

- Use `--gmock_verbose=info` to get detailed call traces for debugging actions.
- If `DoDefault()` causes runtime errors inside composite actions, split the composite action.
- Verify all `WillOnce()` actions are compatible with the mock function's return type.

---

For more examples and advanced usage, refer to the [gMock for Dummies](../gmock_for_dummies.md) and [gMock Cookbook](../gmock_cook_book.md) guides.

---

<Source url="https://github.com/google/googletest" paths='[{"path":"docs/reference/actions.md","range":"1-233"},{"path":"googlemock/include/gmock/gmock-more-actions.h","range":"1-122"}]' />