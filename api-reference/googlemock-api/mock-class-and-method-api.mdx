---
title: "Mock Class and Method API"
description: "Explains the MOCK_METHOD macro, conventions for defining mock classes and methods, as well as configuration via NiceMock, NaggyMock, and StrictMock wrappers. Includes insights on interacting with mocks and handling unexpected calls."
---

# Mock Class and Method API

This page details the use of the `MOCK_METHOD` macro for creating mock methods within mock classes in GoogleMock, along with conventions for defining mock classes and methods. It also explains configuration of mock objects via the `NiceMock`, `NaggyMock`, and `StrictMock` wrappers, and provides guidance on interacting with mocks and handling unexpected calls.

---

## Defining Mock Methods with `MOCK_METHOD`

The `MOCK_METHOD` macro is the cornerstone for defining mocked methods that simulate behavior of real, usually virtual, functions in your tests.

### Basic Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- **ReturnType**: The type the method returns.
- **MethodName**: The name of the method you are mocking.
- **Args**: The method's argument list enclosed in parentheses.
- **Specs** *(optional)*: A list of qualifiers such as `const`, `override`, `noexcept`, or calltype modifiers.

### Example

To mock a simple interface:

```cpp
class MyInterface {
 public:
  virtual ~MyInterface() {}
  virtual int DoSomething(int x) = 0;
  virtual void DoStuff() const = 0;
};

class MockMyInterface : public MyInterface {
 public:
  MOCK_METHOD(int, DoSomething, (int x), (override));
  MOCK_METHOD(void, DoStuff, (), (const, override));
};
```

### Important Notes

- Place `MOCK_METHOD` calls in the `public` section of the mock class regardless of the access modifier in the base class. This ensures `EXPECT_CALL` and `ON_CALL` can bind.
- If your method argument or return types contain commas (e.g., `std::pair<bool, int>`), wrap the type in parentheses or create an alias to avoid parsing errors.

### Handling Const, Override, and Other Specifications

The 4th optional parameter allows you to specify method qualifiers:

| Qualifier           | Purpose                                                                                 |
|---------------------|-----------------------------------------------------------------------------------------|
| `const`             | Marks the mock method as `const`. Required if overriding a `const` method.              |
| `override`          | Recommended to indicate an override of a virtual method.                                |
| `noexcept`          | Required if overriding a `noexcept` method.                                            |
| `Calltype(convention)` | Sets the calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` for Windows COM calls. |
| `ref(&)` or `ref(&&)`| Marks the method with reference qualifiers when overriding such methods.                 |

Example:

```cpp
MOCK_METHOD(bool, Foo, (int x), (const, override, noexcept));
```

## Defining Mock Classes

Writing a mock class involves inheriting the interface you want to mock and defining mock methods for the virtual functions you want to simulate.

Tips for mock class definition:

- **Derive from the interface** you intend to mock.
- **Use `MOCK_METHOD` to declare each virtual method to be mocked**.
- **Add the `override` specifier** as a best practice to ensure methods correctly override base methods.
- **Place mock methods in the `public:` section** so that expectations can be set externally.

### Overloaded Methods

Mock overloaded methods by defining each overload with `MOCK_METHOD`, matching the signature exactly:

```cpp
class MockFoo : public Foo {
public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
};
```

If you only wish to mock some overloads, bring others into scope with `using` to avoid hiding:

```cpp
using Foo::Add;  // Bring other Add overloads into scope
```

### Mocking Class Templates

You can mock class templates normally by templating the mock:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### Mocking Non-Virtual Methods

While `MOCK_METHOD` requires virtual functions, you can also mock non-virtual functions using templates:

```cpp
class MockPacketStream {
public:
  MOCK_METHOD(void, AppendPacket, (Packet* new_packet));
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

Use templated client code to instantiate with either real or mock types.

## NiceMock, NaggyMock, and StrictMock Wrappers

GoogleMock provides three wrappers to control how uninteresting calls (calls for which you haven't explicitly set expectations) are handled:

| Wrapper       | Behavior on Uninteresting Calls          | Usage & Purpose                                  |
|---------------|-----------------------------------------|-------------------------------------------------|
| `NiceMock<T>` | Suppresses warnings                     | Use when uninteresting calls are acceptable and you want cleaner logs.          |
| `NaggyMock<T>`| Prints warnings (default behavior)      | Default mock behavior; warns but allows calls.  |
| `StrictMock<T>`| Treats uninteresting calls as test failures | Use for strict tests ensuring no unexpected calls.                            |

### Using Wrappers

These wrappers work as subclasses of your mock type and duplicate its interface:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;
StrictMock<MockFoo> strict_foo;
```

The wrappers inherit constructors, allowing you to pass arguments through to the base mock class.

### Key Caveats

- Wrappers only affect mock methods declared **directly** in the base mock class using `MOCK_METHOD`.
- Wrapping a type multiple times (e.g., `NiceMock<StrictMock<T>>`) is not supported.
- Make sure your mock classes have **virtual destructors** to avoid undefined behavior.

## Interacting with Mock Methods

### Setting Expectations

Use `EXPECT_CALL(mock_object, Method(matchers))` to specify expected calls and behaviors.
- Always set expectations before exercising code that uses the mocks.
- Use matchers (`_`, `Eq()`, etc) to specify argument criteria.
- Chain modifiers (`Times()`, `WillOnce()`, `WillRepeatedly()`, etc) to specify call counts and return behaviors.

### Handling Unexpected Calls

- If a method is called without an `EXPECT_CALL` set, it is an **uninteresting call** and handled according to the mock object's strictness.
- If a call does not match any expectation even though expectations exist, it is an **unexpected call**, leading to test failure.
- To explicitly forbid a call, use `EXPECT_CALL(foo, Bar(_)).Times(0);`.

### Practical Tips

- Use `EXPECT_CALL(...).Times(AnyNumber())` to allow unconstrained calling with no failures.
- Define default behaviors with `ON_CALL()` to handle calls gracefully without setting expectations.
- To trace and debug failures, run tests with the `--gmock_verbose=info` flag to see call matching info and stack traces.

## Common Pitfalls and Solutions

- **Compilation errors with commas in types**: Wrap types with commas in parentheses or define typedefs.
- **Mocking non-virtual methods**: Use templated mocks and dependency injection.
- **Uninteresting call warnings**: Decide whether to suppress warnings with `NiceMock` or make failures with `StrictMock`.
- **Mismatch in expectations**: Always set `EXPECT_CALL` before using the mock, and understand ordering and sticky expectations.

## Summary

This API reference equips you with the tools to create precise mock classes and methods via the `MOCK_METHOD` macro, configure mock object behavior with `NiceMock`, `NaggyMock`, and `StrictMock`, and manage interaction expectations comprehensively. Mastery of these components will empower you to write expressive, maintainable, and rigorous tests with GoogleMock.

## See Also

- [gMock For Dummies](../guides/advanced-and-real-world/mocking-basics-patterns.md) - Overview and detailed usage patterns
- [Mocking Reference](reference/mocking.md) - Complete reference on macros, classes, and usage
- [gMock Cookbook](docs/gmock_cook_book.md) - Recipes for advanced mocking techniques
- [NiceMock, StrictMock, NaggyMock](googlemock/include/gmock/gmock-nice-strict.h) - Implementation details and behaviors
- [Expectations and Sequencing](api-reference/googlemock-api/expectations-and-sequencing) - For ordering and call expectation handling

---

<Info>
This page fits into the GoogleMock API Reference section as the foundational guide for creating mocks with `MOCK_METHOD` and configuring common mocking behaviors. The concepts here are prerequisites for understanding expectations, actions, and advanced mock interactions addressed in related pages.
</Info>
