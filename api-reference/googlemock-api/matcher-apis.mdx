---
title: "Matcher APIs"
description: "Overview of matcher interfaces, usage in both assertions and mocks (using matchers for input and output verification), and details of built-in matchers and extension mechanisms."
---

# Matcher APIs

This page presents a comprehensive overview of GoogleMock's matcher interfaces, illustrating how matchers are used extensively for both input argument verification and output validation in assertions and mocks. It details built-in matchers, usage patterns, advanced composition, and how users can extend matchers to suit complex testing scenarios.

---

## Introduction to Matchers

Matchers are the heart of GoogleMock's expressive power, enabling users to validate function arguments and return values in a readable, precise manner. They behave like predicates with descriptive capabilities, allowing failures to print informative messages.

Match results can optionally provide detailed explanations, helping diagnose why a match succeeded or failed.

Matchers can be monomorphic (typed to a specific C++ type) or polymorphic (usable across multiple types). The matcher system supports built-in matchers for common needs and facilitates defining custom matchers.

---

## Using Matchers in Assertions and Mock Expectations

Matchers integrate seamlessly with GoogleMock's expectations (`EXPECT_CALL`) and GoogleTest assertions (`EXPECT_THAT`) to express conditions on function calls and allow flexible test specifications.

### Basic Usage

```cpp
EXPECT_CALL(mock_object, MethodName(MatcherForArg1, MatcherForArg2));
EXPECT_THAT(value, Matcher());
```

- Matches can be literal values, wildcards (`_`), or more complex matchers.
- Omitting the argument list for non-overloaded methods matches any arguments.

### Example

```cpp
using ::testing::_;  // wildcard matcher
using ::testing::Ge; // greater or equal

EXPECT_CALL(turtle, Forward(Ge(100))); // expects Forward called with argument >= 100
EXPECT_CALL(turtle, GoTo(50, _));      // x=50, y=anything
EXPECT_THAT(result, Eq(42));            // asserts result == 42
```

Matchers can be combined with other matchers to create fine-grained and composable conditions.

---

## Built-in Matchers

### Wildcard and Type Matchers

| Matcher      | Description                                 |
|--------------|---------------------------------------------|
| `_` or `A<T>()` | Matches any value of type `T`.               |
| `An<T>()`       | Synonym for `A<T>()`.                       |
| `IsNull()`      | Matches any null pointer (raw or smart).   |
| `NotNull()`     | Matches any non-null pointer.               |
| `Ref(variable)` | Matches an argument that references `variable`. |
| `IsNan()`       | Matches any floating point NaN.             |

### Equality and Comparison Matchers

| Matcher    | Meaning                                        |
|------------|------------------------------------------------|
| `Eq(val)`  | Matches value equal to `val`.                   |
| `Ne(val)`  | Matches value not equal to `val`.               |
| `Lt(val)`  | Matches values less than `val`.                 |
| `Le(val)`  | Matches values less than or equal to `val`.    |
| `Gt(val)`  | Matches values greater than `val`.              |
| `Ge(val)`  | Matches values greater than or equal to `val`. |

### String Matchers

| Matcher       | Description                                  |
|---------------|----------------------------------------------|
| `StrEq(s)`    | Matches string equal to `s`.                  |
| `StrNe(s)`    | Matches string not equal to `s`.              |
| `StrCaseEq(s)`| Case-insensitive equality.                    |
| `StrCaseNe(s)`| Case-insensitive inequality.                  |
| `HasSubstr(s)`| Matches string containing substring `s`.     |
| `StartsWith(s)`| Matches string starting with `s`.            |
| `EndsWith(s)` | Matches string ending with `s`.               |

### Container and Sequence Matchers

| Matcher                | Description                                          |
|------------------------|------------------------------------------------------|
| `ElementsAre(m1, ...)` | Matches a container whose elements match the list in order. |
| `UnorderedElementsAre(...)`| Matches container elements in any order.          |
| `Contains(m)`          | Matches if container contains an element matching `m`.|
| `Each(m)`              | Matches if all elements match `m`.                    |
| `SizeIs(m)`            | Matches container size with matcher `m`.              |
| `WhenSorted(...)`      | Matches a sorted version of the container.             |
| `Pointwise(tmatcher, container)` | Matches paired elements using a tuple matcher.    |

### Tuple and Pair Matchers

| Matcher       | Description                                   |
|---------------|-----------------------------------------------|
| `Pair(m1, m2)`| Matches a `std::pair` where first matches `m1` and second matches `m2`. |
| `Key(m)`      | Matches the key (first) in associative pairs. |
| `Field(&Class::field, m)`| Matches a member variable satisfying `m`.        |
| `Property(&Class::method, m)`| Matches a property method's return value.         |

### Logical Combinators

| Matcher                          | Description                                        |
|---------------------------------|----------------------------------------------------|
| `Not(m)`                        | Matches values not matching `m`.                    |
| `AllOf(m1, m2, ...)`           | Matches all of the specified matchers.              |
| `AnyOf(m1, m2, ...)`           | Matches any one of the specified matchers.          |
| `Conditional(cond, m1, m2)`    | Uses `m1` if `cond` is true, else `m2`.              |

### Others

| Matcher                         | Description                                    |
|--------------------------------|------------------------------------------------|
| `Truly(predicate)`             | Uses any unary predicate as matcher.            |
| `Optional(m)`                  | Matches engaged optional values matching `m`.  |
| `VariantWith<T>(m)`            | Matches `std::variant` when held type is `T` and matches `m`.
| `AnyWith<T>(m)`                | Matches `absl::any` holding a value of type `T` matching `m`.

---

## Using Matchers Effectively

### Combining Matchers

Matchers may be combined either with logical combinators (`AllOf()`, `AnyOf()`, `Not()`) or by nesting matchers, to express complex relations with clarity.

```cpp
EXPECT_CALL(mock, Foo(AllOf(Gt(0), Lt(10))));
EXPECT_THAT(container, Each(StartsWith("abc")));
```

### Matching Multiple Arguments as One

Sometimes you want to ensure relations across multiple arguments, e.g., first argument less than second. Use the `.With()` clause to specify multi-argument matchers:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // first arg less than second
```

### Selective Argument Matching

Omit argument lists in `EXPECT_CALL` to match any arguments, or use `_` as a wildcard matcher for individual arguments.

For overloaded methods, disambiguate using explicit matchers or the `Const()` wrapper for const overloads.

### Matchers as Predicates

Matchers can be used as predicates in STL algorithms via `Matches()`:

```cpp
std::count_if(v.begin(), v.end(), Matches(Ge(10)));
```

---

## Defining Custom Matchers

GoogleMock allows easy creation of new matchers for domain-specific needs. Several mechanisms exist:

### MATCHER and MATCHER_P Macros

Ideal for simple custom matchers:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }

MATCHER_P(IsDivisibleBy, divisor, "") { return (arg % divisor) == 0; }
```

These provide automatic descriptions and friendly failure messages, with optional custom explanatory text.

### Implementing Matcher Interface

For advanced scenarios, implement the matcher interface manually with a class fulfilling `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()`. Then wrap in `Matcher<T>`.

```cpp
class DivisibleByMatcher {
 public:
  using is_gtest_matcher = void;
  explicit DivisibleByMatcher(int divisor) : divisor_(divisor) {}

  bool MatchAndExplain(int n, std::ostream* os) const {
    if (n % divisor_ == 0) return true;
    if (os) *os << "which remainder is " << (n % divisor_);
    return false;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is divisible by " << divisor_;
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not divisible by " << divisor_;
  }

 private:
  int divisor_;
};

Matcher<int> DivisibleBy(int divisor) { return DivisibleByMatcher(divisor); }
```

---

## Matcher Internals and Behavior

- Matchers must be **purely functional** with no side effects.
- Copying matchers is inexpensive; they internally use reference counting.
- Matchers print values using a user-extensible value printer (see Advanced Guide for details on printing custom types).
- Composite matchers derive their descriptions from their constituent matchers.
- When matchers fail, they can explain precisely which part did not match.

---

## Matcher Integration with gMock

- `EXPECT_CALL` uses matchers to specify expected values and constraints on method arguments.
- `ON_CALL` can specify default behaviors with matchers matching certain arguments.
- Matchers are integral to composing flexible tests with precise expectations.

---

## Practical Tips & Best Practices

- Use `_` for arguments you don't care about to avoid brittle tests.
- Prefer using `ON_CALL()` to define default behavior and reserve `EXPECT_CALL()` for critical calls you want to verify.
- Combine matchers logically to reflect intent, avoiding overly complex matchers.
- Use matchers in assertions (`EXPECT_THAT()`) for expressive validations.
- When mocking overloaded or const/non-const variations, use `Const()` or explicitly specify matcher types.
- Build reusable matcher objects for complex conditions to improve readability and maintainability.

---

## Troubleshooting Common Matcher Issues

- **Type mismatches**: Ensure matcher types correspond or use `SafeMatcherCast<T>(m)` to resolve safe conversions.
- **Matcher syntax errors**: Use built-in macros and examples to avoid errors.
- **Custom matcher messages unclear**: Stream helpful diagnostic information to `result_listener` in custom matchers.

---

## Additional Resources

- [GoogleMock Basic Matchers](https://google.github.io/googletest/reference/matchers.html)
- [Matchers Reference](../reference/matchers.md)
- [Writing New Matchers Quickly](gmock_cook_book.md#NewMatchers)

---

## Summary

This page empowers users to utilize matchers strategically in GoogleMock and GoogleTest to create fluent, maintainable, and precise tests. Whether matching simple arguments or composing complex invariants, matchers provide the foundation for validating behavior robustly and clearly.

---

### See Also

- [Mock Class and Method API](api-reference/googlemock-api/mock-class-and-method-api.md)
- [Expectations and Sequencing](api-reference/googlemock-api/expectations-and-sequencing.md)
- [Actions Reference](api-reference/googlemock-api/actions-reference.md)
- [Assertions Reference](docs/reference/assertions.md)
- [Guides on Effective Use of Matchers and Actions](guides/advanced-and-real-world/effective-use-matchers-actions.md)
