---
title: "Platform and Portability APIs"
description: "API references for portability and compatibility layers. Covers macros and utility headers that help ensure your tests and mocks run consistently across different compilers and platforms, including port files and platform-specific customizations."
---

# Platform and Portability APIs

This reference page covers the core API components within GoogleTest focused on portability and compatibility layers. These utilities, macros, and headers are designed to provide a consistent and uniform testing experience across diverse compilers, operating systems, and platforms. Users leveraging GoogleTest for cross-platform C++ testing rely on these APIs to ensure that their tests and mocks behave predictably and can be built and run reliably regardless of the underlying environment.

---

## Overview

GoogleTest runs on many platforms, each with unique system capabilities, compiler behaviors, and threading models. The Platform and Portability APIs act as the backbone enabling GoogleTest's broad platform support by:

- Detecting the operating system and environment dynamically
- Abstracting platform-specific threading, synchronization, and filesystem operations
- Providing macros informing GoogleTest features available on the current build
- Ensuring compatibility through uniform interfaces and mechanisms

This section documents these APIs primarily through two core headers:

- `gtest/internal/gtest-port-arch.h` — defines platform detection macros
- `gtest/internal/gtest-port.h` — provides the bulk of portability utilities and feature macros

These headers together manage compiler feature detection, OS abstractions, thread support, file IO, assertions, logging, and more.

---

## Platform Detection Macros (`gtest-port-arch.h`)

These macros identify the platform on which GoogleTest is compiled. They allow conditional compilation tailored for platform-specific optimizations and handling.

### Key Platform Macros

The following are automatically defined to `1` where applicable:

| Macro Name                  | Description                                   |
|-----------------------------|-----------------------------------------------|
| `GTEST_OS_CYGWIN`            | Cygwin                                        |
| `GTEST_OS_WINDOWS_MINGW`     | MinGW Windows environments                     |
| `GTEST_OS_WINDOWS`           | Any Windows platform (Desktop, MinGW, Mobile) |
| `GTEST_OS_WINDOWS_DESKTOP`   | Windows Desktop applications                    |
| `GTEST_OS_WINDOWS_MOBILE`    | Windows Mobile versions                         |
| `GTEST_OS_WINDOWS_PHONE`     | Windows Phone                                  |
| `GTEST_OS_WINDOWS_RT`        | Windows Store App / WinRT                       |
| `GTEST_OS_MAC`               | Mac OS X                                       |
| `GTEST_OS_IOS`               | iOS (subset of Apple platforms)                 |
| `GTEST_OS_LINUX`             | Linux                                          |
| `GTEST_OS_LINUX_ANDROID`     | Android on Linux                                |
| `GTEST_OS_FREEBSD`           | FreeBSD                                        |
| `GTEST_OS_NETBSD`            | NetBSD                                         |
| `GTEST_OS_OPENBSD`           | OpenBSD                                        |
| And many others covering HP-UX, QNX, Solaris, Haiku, Fuchsia, embedded platforms (ESP8266, ESP32), and others.

### Usage

Use these macros to customize GoogleTest behavior or to implement platform-specific code:

```cpp
#ifdef GTEST_OS_WINDOWS
  // Platform-specific code for Windows
#endif

#ifdef GTEST_OS_LINUX
  // Linux-specific code
#endif
```


---

## Core Portability APIs (`gtest-port.h`)

This header encapsulates the rich set of utilities that GoogleTest uses internally to provide consistent behavior across platforms. While primarily for internal use, understanding these APIs empowers advanced users and maintainers to extend or customize GoogleTest functionality effectively.

### Environment Feature Macros

GoogleTest automatically defines the following macros to indicate presence or absence of platform/compiler capabilities (all set to `1` or `0`):

- `GTEST_HAS_PTHREAD` — pthreads threading support.
- `GTEST_HAS_EXCEPTIONS` — C++ exception handling enabled.
- `GTEST_HAS_RTTI` — Run-time type information available.
- `GTEST_HAS_STD_WSTRING` — `std::wstring` supported.
- `GTEST_HAS_FILE_SYSTEM` — access to file system APIs.
- `GTEST_HAS_STREAM_REDIRECTION` — support to redirect stdout/stderr (used in capturing and death tests).
- `GTEST_HAS_DEATH_TEST` — support for death tests.
- `GTEST_HAS_TYPED_TEST`, `GTEST_HAS_TYPED_TEST_P` — typed test support.
- `GTEST_IS_THREADSAFE` — GoogleTest runs thread-safe on the platform.

Users can override these via compiler definitions, but GoogleTest tries to detect them.

### Synchronization

GoogleTest provides cross-platform abstractions for synchronization through:

- `Mutex` and `MutexLock` — lightweight wrappers around platform-specific mutexes.
- `ThreadLocal<T>` — thread-local storage implementation.
- `ThreadWithParam<T>` — helper class to run parameterized functions in threads.

These abstractions enable GoogleTest to implement thread-safe test execution, death tests, and internal data sharing.

### Logging and Checking

GoogleTest implements cross-platform logging and assertion macros:

- `GTEST_LOG_(severity)` — logs messages with levels like `INFO`, `WARNING`, `ERROR`, and `FATAL`. FATAL logs terminate the test immediately.
- `GTEST_CHECK_(condition)` — assert-like macro that aborts the test on failure and logs the failed condition.

Logging macros are customizable via user overrides in custom port headers.

### Regular Expressions

GoogleTest uses one of several regex engines depending on platform:

- RE2 (via Abseil) when available.
- POSIX regex on platforms that support `<regex.h>`.
- A simplified internal regex as fallback.

These provide the backbone for pattern matching in assertions such as death tests.

### File and Stream Utilities

GoogleTest supplies platform-aware wrappers for common file and I/O operations:

- Opening, closing, and querying file status.
- Detecting if standard output/error are terminals.
- Reading environment variables safely.
- Redirecting stdout and stderr to capture test output.

### Threading and OS Functions

- `GetThreadCount()` returns the number of live threads or 0 if unknown.
- Sleep, yielding, and other threading primitives where necessary.

---

## Practical Usage Patterns

Users typically do not interact with Platform and Portability APIs directly. These APIs work behind the scenes to ensure your tests run consistently across platforms. However, in advanced scenarios:

- You may use platform macros (`GTEST_OS_*`) to conditionally compile tests or features.
- Override feature macros or customization points in custom port headers.
- Extend GoogleTest by implementing custom synchronization or environment behaviors.

### Example: Detecting Platform in a Test

```cpp
#include <gtest/internal/gtest-port-arch.h>

TEST(PlatformDetectionTest, IsWindows) {
#ifdef GTEST_OS_WINDOWS
  SUCCEED() << "Test running on Windows platform";
#else
  SUCCEED() << "Test NOT running on Windows";
#endif
}
```

### Example: Using Mutex in Thread-Safe Code

```cpp
#include "gtest/internal/gtest-port.h"

::testing::internal::Mutex mu;

void ThreadSafeIncrement(int& counter) {
  ::testing::internal::MutexLock lock(&mu);
  ++counter;
}
```

### Capturing Standard Output for Tests

```cpp
#include "gtest/internal/gtest-port.h"

::testing::internal::CaptureStdout();
printf("Hello World\n");
std::string output = ::testing::internal::GetCapturedStdout();
EXPECT_EQ(output, "Hello World\n");
```

---

## Customization Points

GoogleTest allows custom user overrides for parts of these portability APIs by:

- Defining macros in `custom/gtest-port.h` to customize logging, synchronization primitives, or environment-specific code.
- Overriding file system or threading support where platform lacks default implementations.

See the `custom/README.md` for details on extension hooks.

---

## Tips and Best Practices

- Always rely on `GTEST_OS_*` macros over standard compiler macros for platform detection within GoogleTest to maintain consistency.
- Do not modify internal portable APIs unless fully aware of platform implications.
- Prefer built-in GoogleTest synchronization primitives over native ones for test safety.
- Use `GTEST_HAS_*` macros to conditionally enable features in your tests if targeting unsupported or niche platforms.

---

## Troubleshooting Common Issues

### Platform Not Detected Correctly

If GoogleTest does not detect your platform correctly, verify your compiler defines standard OS macros like `_WIN32`, `__linux__`, `__APPLE__`, etc. You may define or override `GTEST_OS_*` macros as a last resort.

### Missing Thread Support

If your environment does not provide pthreads or native thread support, `GTEST_IS_THREADSAFE` will be 0. GoogleTest still works, but multi-threaded tests or synchronization may behave incorrectly.

Define `-DGTEST_HAS_PTHREAD=0` explicitly if your platform lacks pthreads to avoid build issues.

### Stream Redirection Unsupported

Embedded or mobile platforms typically lack stream redirection, disabling features like capturing stdout/stderr or death tests.

Enable `GTEST_HAS_STREAM_REDIRECTION` only if supported on your environment.

---

## Further Resources

- [Core Testing APIs Reference](/api-reference/core-testing-apis/test-definition-and-execution)
- [Threading and Synchronization Guide](#)
- [Custom Porting and Customization README](googletest/include/gtest/internal/custom/README.md)
- GoogleTest GitHub repository: [https://github.com/google/googletest](https://github.com/google/googletest)

---

<Source url="https://github.com/google/googletest" branch="main" paths='[{"path":"googletest/include/gtest/internal/gtest-port.h","range":"1-794"},{"path":"googletest/include/gtest/internal/gtest-port-arch.h","range":"1-61"}]' />