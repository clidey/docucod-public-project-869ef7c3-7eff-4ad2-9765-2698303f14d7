---
title: "Built-in Matchers"
description: "Covers the suite of built-in matchers provided by GoogleTest and GoogleMock for validating arguments, containers, and object properties. Illustrates usage patterns for most common matcher types and how to combine them effectively."
---

# Built-in Matchers

GoogleTest and GoogleMock provide a rich suite of built-in matchers to help you validate arguments, containers, and object properties in your tests. Matchers make it easy to specify expectations on mock method arguments or verify complex values using expressive, human-readable syntax.

---

## Overview

Matchers are predicate-like objects that determine whether a value satisfies certain criteria. They can range from simple equality checks to complex compositional matchers involving containers and object fields.

Using these built-in matchers with the `EXPECT_THAT()` assertion or inside `EXPECT_CALL()` clauses lets you write concise, expressive tests with detailed failure messages.

---

## Basic Usage

### Wildcard Matcher: `_`
The underscore matcher (`_`) matches any value regardless of type or contents.

```cpp
EXPECT_CALL(foo, Bar(_));  // Matches any argument.
```

### Matching Exact Values
Use `Eq(value)` or simply provide a literal or variable to check for exact matches.

```cpp
EXPECT_CALL(foo, Foo(42));                // Equivalent to Eq(42)
EXPECT_THAT(x, Eq(expected_value));       // Assert x == expected_value
```

### Negation
Use `Not(matcher)` to invert the match logic.

```cpp
EXPECT_THAT(value, Not(Eq(5)));  // Expects value != 5
```

---

## Using Matchers in `EXPECT_CALL` and `EXPECT_THAT`

Matchers can be used to constrain method arguments in `EXPECT_CALL`:

```cpp
EXPECT_CALL(mock, DoSomething(Ge(5)));  // Argument >= 5
EXPECT_CALL(mock, DoSomething(AllOf(Ge(1), Le(10))));  // Between 1 and 10
```

Or to validate values directly with `EXPECT_THAT`:

```cpp
EXPECT_THAT(result, StartsWith("Hello"));
EXPECT_THAT(container, ElementsAre(1, 2, 3));
```

---

## Common Built-in Matchers

These foundational matchers cover simple value comparisons, pointer checks, container contents, tuples, and more.

### Comparison Matchers

- `Eq(value)` - Equal to *value*.
- `Ne(value)` - Not equal to *value*.
- `Lt(value)` - Less than *value*.
- `Le(value)` - Less than or equal to *value*.
- `Gt(value)` - Greater than *value*.
- `Ge(value)` - Greater than or equal to *value*.

### Wildcard and Boolean

- `_` - Matches anything.
- `IsNull()` - Matches null pointers.
- `NotNull()` - Matches non-null pointers.
- `IsNan()` - Matches floating-point NaN values.

### String Matchers

- `StrEq(str)` - Matches strings equal to `str`.
- `StrNe(str)` - Matches strings not equal to `str`.
- `StrCaseEq(str)` - Matches strings equal to `str` ignoring case.
- `StrCaseNe(str)` - Matches strings not equal to `str` ignoring case.
- `HasSubstr(substring)` - Checks if a string contains the substring.
- `StartsWith(prefix)` - Matches strings starting with prefix.
- `EndsWith(suffix)` - Matches strings ending with suffix.

---

## Matching Containers

### Elements Are

`ElementsAre(m1, m2, ..., mn)` checks that a container has exactly *n* elements matching corresponding matchers in order.

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(2), _)));
```

This asserts the container's first element equals 1, second element is > 2, and third element matches anything.

### Unordered Elements Are

`UnorderedElementsAre(m1, m2, ..., mn)` asserts container has exactly these elements in any order.

```cpp
EXPECT_THAT(vec, UnorderedElementsAre(3, 1, 2));
```

### Arrays and Lists

You can use:

- `ElementsAreArray(array_or_container)`
- `UnorderedElementsAreArray(array_or_container)`

to match sequence containers or arrays against element matchers or values.

---

## Composing Matchers

### Combining Matchers

- `AllOf(m1, m2, ...)` - Matches if all matchers match.
- `AnyOf(m1, m2, ...)` - Matches if any matcher matches.

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Gt(5), Ne(10))));
```

### Matchers for Tuples and Multiple Arguments

- `With(multi_arg_matcher)` can be used in `EXPECT_CALL()` to match all arguments as a single tuple.
- `Args<k1, k2, ...>(matcher)` applies matcher to a tuple of selected arguments.

Example:

```cpp
EXPECT_CALL(foo, Bar(_, _)).With(Lt());
```

Says the first argument must be less than the second (leaf matcher for tuples like `Lt()` provided).

### Matching Fields and Properties

- `Field(&Class::field, matcher)` matches an object whose member field matches `matcher`.
- `Property(&Class::property_method, matcher)` matches an object whose no-arg const method returns a result matching `matcher`.

Example:

```cpp
EXPECT_THAT(foo, Field(&Foo::bar, Ge(3)));
EXPECT_THAT(foo, Property(&Foo::name, StartsWith("John")));
```

`Field()` and `Property()` also work on pointers, handling null pointers properly.

### Matching Pointer Values

- `Pointee(matcher)` matches pointers whose pointee matches `matcher`, treating null pointers as failures.

Nested usage is supported, e.g. `Pointee(Pointee(Lt(3)))`.

### Containers Size and Count

- `SizeIs(matcher)` matches container sizes.
- `Contains(matcher)` matches containers containing at least one element matching `matcher`.
- `Each(matcher)` requires all elements to satisfy `matcher`.

---

## Specialized Matchers

### Floating-point Approximate Equality

- `FloatEq(value)`, `DoubleEq(value)` approximate equality using ULPs.
- `FloatNear(value, max_abs_error)`, `DoubleNear(value, max_abs_error)` with absolute error bounds.
- `NanSensitiveFloatEq(value)` matches NaNs as equal.

### Conditional Matchers

`Conditional(cond, matcher_true, matcher_false)` selects matchers based on a boolean condition.

### Variant, Any, Optional

- `VariantWith<T>(matcher)` matches `std::variant` holding value of type `T` matching `matcher`.
- `AnyWith<T>(matcher)` matches absl::any or similar containing `T` matching `matcher`.
- `Optional(matcher)` matches optional-like objects whose value satisfies `matcher`.

---

## Defining Custom Matchers

You can define your own matchers for complex or domain-specific validations using the `MATCHER` and `MATCHER_P*` macros.

Example custom matcher:

```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
EXPECT_CALL(mock, Bar(IsDivisibleBy7()));
```

For parameterized matchers:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") { return abs(arg) == value; }
EXPECT_THAT(x, HasAbsoluteValue(10));
```

See the [Custom Matchers & Extensions](custom-matchers-extensions) documentation for detailed guidance.

---

## Best Practices & Tips

- Use simple matchers like `_` when arguments are not relevant.
- Compose matchers for fine-grained control of arguments.
- Use `With()` in `EXPECT_CALL` to match all arguments as a tuple for inter-dependent argument conditions.
- Use container matchers (`ElementsAre`, `UnorderedElementsAre`) for clear container content expectations.
- Use `Field()` and `Property()` to validate object internals without requiring full object equality.
- Use `SafeMatcherCast<T>(m)` to relax strict typing of matchers where appropriate.
- Prefer parameterized matchers for reusable and readable test constraints.

---

## Troubleshooting and Common Pitfalls

- Ensure your matchers do not have side effects as gMock may invoke them multiple times unpredictably.
- When matching overloaded methods, use explicit types or `Const()` wrapper to disambiguate.
- For complex matchers on non-copyable types, consider writing custom predicates using `Truly()`.
- Beware of uninteresting calls — if you see warnings about them, either suppress with `NiceMock` or add explicit `EXPECT_CALL(...).Times(AnyNumber())`.
---

## Useful Links

- [Matchers Reference](https://google.github.io/googletest/gmock_cook_book.html#Matchers) — Detailed documentation and usage examples
- [Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#WritingNewMatchers) — How to add custom matchers
- [Mocking Reference](reference/mocking.md) — Related macros and mock concepts
- [Assertions Reference](reference/assertions.md#EXPECT_THAT) — Using matchers in assertions

---

## Summary

Built-in matchers enable expressive and powerful validations of function arguments and values in GoogleMock tests, covering primitive types, strings, containers, tuples, pointers, and object internals. Their composability and rich semantics facilitate writing maintainable, readable tests with clear failure reports.