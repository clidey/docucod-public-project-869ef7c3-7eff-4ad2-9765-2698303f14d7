---
title: "Mock Creation and Basics"
description: "Explains how to declare and define mock classes and methods using key macros and utilities. Coverage includes MOCK_METHOD, fundamental patterns, qualifiers, and integration with GoogleTest."
---

# Mock Creation and Basics

This page explains how to declare and define mock classes and methods using Google's testing framework macros and utilities. Key focuses include the usage of the `MOCK_METHOD` macro, fundamental mocking patterns, method qualifiers, and the integration of mocks with GoogleTest for robust unit testing.

---

## Overview

GoogleMock enables you to define mock classes for interfaces or virtual methods, allowing you to precisely describe the expected interactions in your tests. The essence is to create mock classes where each method you want to mock is declared with the `MOCK_METHOD` macro.

`MOCK_METHOD` generates the boilerplate needed to track calls, match arguments, and define behaviors, simplifying the task of creating mocks.

Additionally, GoogleMock offers modifiers like `NiceMock`, `NaggyMock`, and `StrictMock` that control the behavior of uninteresting calls â€” calls to mock methods without explicit expectations.

---

## Defining a Mock Class and Methods with `MOCK_METHOD`

To mock a class, you typically:

1. Derive your mock class from the interface or base class with virtual methods.
2. Declare mock methods inside your derived class with `MOCK_METHOD`.

### Syntax

```cpp
// General macro form
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- `ReturnType`: The return type of your method.
- `MethodName`: Name of the method you're mocking.
- `(Args...)`: Parameter list surrounded by parentheses.
- `(Qualifiers)`: Optional - method qualifiers like `const`, `override`, `noexcept`, calling convention, or reference qualifiers.

### Key Details

- You must put `MOCK_METHOD` declarations in the `public:` section even if the original methods are `protected` or `private`. This is necessary because testing code must access these mock methods.
- For const methods, add `(const)` qualifier.
- For overridden virtual methods, it is recommended to add `(override)` qualifier for clarity.
- For methods with calling conventions (e.g., Windows' `STDMETHODCALLTYPE`), use `Calltype(...)` inside the qualifier list.
- If your argument or return types contain commas (e.g., template types), you must wrap the type in extra parentheses or use a using-alias to avoid macro parsing errors.

### Example

```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

### Handling Commas in Types

```cpp
class MockPair {
 public:
  // This will not compile due to the comma inside std::pair
  // MOCK_METHOD(std::pair<int, int>, GetPair, ());

  // Correct approach: wrap the type in parentheses
  MOCK_METHOD((std::pair<int, int>), GetPair, ());

  // Alternatively, use typedef or using alias
  using IntPair = std::pair<int, int>;
  MOCK_METHOD(IntPair, GetPair, ());
};
```

---

## Working with Mock Objects in Tests

### Work Flow

1. Include `#include <gmock/gmock.h>` to access GoogleMock macros and utilities.
2. Instantiate your mock objects.
3. Use `EXPECT_CALL` to declare expectations on mock methods. Use `ON_CALL` to specify default behaviors.
4. Run the code under test that interacts with the mocks.
5. GoogleMock automatically verifies expectations on mock destruction.

### Example Usage

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};

TEST(FooTest, DescribeWorks) {
  MockFoo mock;

  ON_CALL(mock, GetSize()).WillByDefault(Return(42));
  EXPECT_CALL(mock, Describe("test")).Times(1).WillOnce(Return("mocked"));

  auto size = mock.GetSize();     // returns 42 by default action
  auto description = mock.Describe("test");  // returns "mocked"

  EXPECT_EQ(size, 42);
  EXPECT_EQ(description, "mocked");
}
```

---

## The Nice, the Naggy, and the Strict Mocks

GoogleMock provides wrappers around a mock class which modify the behavior regarding uninteresting calls (calls to mocked methods without explicit expectations).

- **NiceMock<T>**: Suppresses warnings for uninteresting calls. Useful for noisy tests where you do not care about all method calls.
- **NaggyMock<T>**: Generates warnings for uninteresting calls. This is the default mode.
- **StrictMock<T>**: Treats uninteresting calls as test failures, enforcing that all calls are expected.

### Usage

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;   // Ignores uninteresting calls silently
NaggyMock<MockFoo> naggy_mock; // Warns on uninteresting calls
StrictMock<MockFoo> strict_mock; // Fails on uninteresting calls
```

They behave as subclasses of the mocked class and support all its constructors.

### Important Notes

- They only affect methods mocked *directly* in the class, not in base classes.
- They require the base mock class to have a virtual destructor to work correctly.
- Nesting them (e.g., `NiceMock<StrictMock<MockFoo>>`) is not supported.

---

## Common Patterns and Best Practices

- **Mock Class Design**: Define only the needed virtual functions as mocks.
- **Qualifiers**: Always specify `const` and `override` qualifiers to ensure proper overriding.
- **Expectations & Default Behavior**: Use `EXPECT_CALL` to specify calls you want to verify, `ON_CALL` to set default behavior for other calls.
- **Uninteresting Calls**: Use `NiceMock` to suppress spurious warnings.
- **Handling Non-Default Constructors**: `NiceMock`, `NaggyMock`, and `StrictMock` can be constructed with any arguments that the underlying mock class accepts.

---

## Advanced Topics

### Mocking Methods Returning Non-Default-Constructible Types

You must provide a default action if the return type doesn't have a default constructor, or the test will fail at runtime.

Example:

```cpp
class NotDefaultConstructible {
 public:
  explicit NotDefaultConstructible(int);
};

class MockFoo {
 public:
  MOCK_METHOD0(ReturnNonDefaultConstructible, NotDefaultConstructible());
};

// In your test:
ON_CALL(mock_foo, ReturnNonDefaultConstructible())
  .WillByDefault(Return(NotDefaultConstructible(42)));
```

### Mock Methods with Non-Default Constructors

Mocks can be instantiated with complex constructors transparently by passing arguments through `NiceMock`, `NaggyMock`, or `StrictMock`, like this:

```cpp
NiceMock<MockBar> mock_bar("hello");
StrictMock<MockBar> strict_bar('a', 'b', "c", "d", 1, 2, "e", "f", true, false);
```

### Allowing Mock Leaks

In some contexts, you may want to allow a mock object to leak intentionally and skip verification, for example:

```cpp
Mock::AllowLeak(mock_pointer);
```

This can help in tests where mocks are owned elsewhere and cannot be reliably deleted.

---

## Troubleshooting

- If you see warnings about "Uninteresting mock function call", consider switching to `NiceMock` for your mock objects or explicitly specify expectations.
- If the test fails because of missing or mismatch call expectations, use `EXPECT_CALL` with specific matchers.
- If mocking methods returning or taking non-copyable or move-only arguments (like `std::unique_ptr`), ensure using the modern `MOCK_METHOD` macro and set proper actions (e.g., lambdas) as `Return()` cannot be reused with moved-from objects.
- If you get compilation errors about ambiguous overloads, specify mocks for all overloaded variants and use `using BaseClass::Method;` if hiding occurs.

---

## Summary

This page covered key concepts and practical instructions for:

- Declaring mock classes using `MOCK_METHOD`
- Qualifying mock methods correctly
- Using `NiceMock`, `NaggyMock`, and `StrictMock` to control mock strictness
- Working with mocks that need non-default constructors
- Setting expectations and default behaviors for mocks
- Common patterns to avoid pitfalls when writing mocks

For detailed scenarios, refer to the [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) and the [gMock Cheat Sheet](https://github.com/google/googletest/blob/main/docs/gmock_cheat_sheet.md).

---

## Additional Example: Complete Mock Declaration

```cpp
#include <gmock/gmock.h>

class Interface {
 public:
  virtual ~Interface() {}
  virtual int Compute(int a) const = 0;
  virtual void Reset() = 0;
};

class MockInterface : public Interface {
 public:
  MOCK_METHOD(int, Compute, (int a), (const, override));
  MOCK_METHOD(void, Reset, (), (override));
};

// Usage inside a test
using ::testing::NiceMock;

NiceMock<MockInterface> mock_obj;
EXPECT_CALL(mock_obj, Compute(42)).WillOnce(testing::Return(100));

int result = mock_obj.Compute(42); // returns 100
mock_obj.Reset();
```

---

## Integration with GoogleTest

Mocks integrate seamlessly with GoogleTest assertions, and verify expectations upon mock destruction. Use this to catch unwanted behavior early in your tests without extra verification code.

---