---
title: "Matchers and Predicates"
description: "Covers built-in and custom matchers, matcher composition, and utilities for validating arguments in mocks and assertions. Explains matcher interfaces, helpers, and best practices for argument validation."
---

# Matchers and Predicates

Matchers and predicates are foundational elements in GoogleTest and GoogleMock that allow you to verify, capture, and precisely validate arguments passed to mocked methods and tested expressions. This documentation covers how to use built-in and custom matchers effectively, how to compose them, and how to employ predicates for complex argument validation.

---

## Overview

A **matcher** tests a *single* argument, validating whether it satisfies some criteria. Matchers can be used in:

- `EXPECT_CALL()` or `ON_CALL()` to specify expectations and default behaviors on mock methods,
- `EXPECT_THAT()` or `ASSERT_THAT()` assertions to validate value properties directly,
- predicates and actions allowing flexible argument checking and manipulation.

Matchers serve as powerful, readable predicates with detailed failure explanations, making tests more robust and diagnostics clearer.

---

## Using Built-In Matchers

GoogleTest provides a rich collection of built-in matchers categorized by their purpose.

### Wildcard Matchers

| Matcher          | Description                            |
| ---------------- | ------------------------------------ |
| `_`              | Matches any value of the expected type. |
| `A<type>()`, `An<type>()` | Matches any value of the specified type `type`. |

### Generic Comparison Matchers

| Matcher        | Meaning                                |
| -------------- | ------------------------------------ |
| `Eq(value)` or `value` | Matches `argument == value`.        |
| `Ne(value)`    | Matches `argument != value`.          |
| `Lt(value)`    | Matches `argument < value`.           |
| `Le(value)`    | Matches `argument <= value`.          |
| `Gt(value)`    | Matches `argument > value`.           |
| `Ge(value)`    | Matches `argument >= value`.          |
| `IsTrue()`     | Matches `argument` evaluating to true.
| `IsFalse()`    | Matches `argument` evaluating to false.
| `IsNull()`     | Matches pointer arguments that are null.
| `NotNull()`    | Matches pointer arguments that are not null.

### Container Matchers

| Matcher               | Description                                         |
| --------------------- | -------------------------------------------------- |
| `Contains(e)`         | Matches containers containing an element matching `e`.
| `ElementsAre(e0, e1, ..., en)` | Matches container elements in order against specified matchers or values.
| `UnorderedElementsAre(e0, ..., en)` | Matches containers with same elements as specified, but order ignored.
| `SizeIs(m)`           | Matches containers with size matching matcher `m`.
| `IsEmpty()`           | Matches empty containers.
| `Pointwise(m, c)`     | Matches corresponding elements from actual container and `c` using matcher `m` for pairs.

### String Matchers

| Matcher               | Description                                         |
| --------------------- | -------------------------------------------------- |
| `StartsWith(prefix)`  | Matches strings starting with `prefix`.
| `EndsWith(suffix)`    | Matches strings ending with `suffix`.
| `HasSubstr(string)`   | Matches strings containing `string` as substring.
| `StrEq(string)`       | Matches strings exactly equal to `string`.
| `StrCaseEq(string)`   | Matches strings equal ignoring case.
| `WhenBase64Unescaped(m)` | Matches base64 encoded string whose decoded string matches `m`.

### Exception Matchers

| Matcher                    | Description                                             |
| -------------------------- | ------------------------------------------------------- |
| `Throws<E>()`              | Matches callables that throw an exception of type `E`.
| `Throws<E>(m)`             | Matches callables throwing exception of type `E` satisfying matcher `m`.
| `ThrowsMessage<E>(m)`      | Matches callables throwing exception of type `E` with message matching `m`.

### Composite Matchers

Matchers can be composed for more expressive conditions:

| Matcher              | Description                                                  |
| -------------------- | ------------------------------------------------------------ |
| `AllOf(m1, ..., mn)` | Matches if all constituent matchers `m1` to `mn` match.      |
| `AnyOf(m1, ..., mn)` | Matches if any constituent matcher matches.                  |
| `Not(m)`             | Matches if the matcher `m` does not match.                   |
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` is true, else `m2`.                 |

### Matchers for Member Access

| Matcher                                 | Description                                                  |
| ------------------------------------- | ------------------------------------------------------------ |
| `Field(&Class::field, m)`              | Matches an object whose member `field` matches matcher `m`.    |
| `Property(&Class::property, m)`        | Matches an object whose property method `property()` returns a value matching `m`.
| `Key(m)`                              | Matches a pair whose first element matches `m`.
| `Pair(m1, m2)`                       | Matches a pair whose first and second elements match `m1` and `m2` respectively.

### Pointer and Reference Matchers

| Matcher                          | Description                                    |
| -------------------------------- | ---------------------------------------------- |
| `Pointee(m)`                    | Matches pointers (raw or smart) pointing to values matching `m`.
| `Pointer(m)`                    | Matches pointers (raw or smart) matching `m`.
| `Ref(variable)`                 | Matches any argument that is a reference to the specified variable.
| `Address(m)`                    | Matches the address of the argument.

### Multi-Argument Matchers

Matchers that operate over argument tuples in multi-argument methods:

| Matcher       | Description                                                  |
| ------------- | ------------------------------------------------------------ |
| `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()` | Match tuple arguments via operator comparisons.
| `Args<N1, N2, ..., Nk>(m)`  | Matches selected arguments at positions N1, N2, ..., Nk as a tuple against matcher m.
| `AllArgs(m)`                | Matches all arguments as a tuple against matcher m.

---

## Writing Custom Matchers

GoogleMock allows defining custom matchers for special validation scenarios.

### Using `MATCHER` Macros

Simplest method - define a matcher macro in namespace scope:

```cpp
MATCHER(Name, description_string) {
  // Inside the body, 'arg' is the value to match
  // Return true if arg matches, false otherwise
  return (arg meets your condition);
}
```

Example:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "the remainder is " << (arg % 7);
  return false;
}
```

Use in expectations:

```cpp
EXPECT_CALL(mock_obj, Method(IsDivisibleBy7()));
EXPECT_THAT(value, IsDivisibleBy7());
```

Descriptions can be customized with negation awareness:

```cpp
MATCHER(IsDivisibleBy7, absl::StrCat(negation ? "isn't" : "is", " divisible by 7")) {
  ...
}
```

### Parameterized Matchers

Use `MATCHER_P` or variants for matchers with parameters:

```cpp
MATCHER_P(HasAbsoluteValue, value, "") { return std::abs(arg) == value; }
```

Usage:

```cpp
EXPECT_THAT(x, HasAbsoluteValue(10));
```

You can specify descriptions referencing parameter values and negations.

### Defining Matcher Classes

For more control or reusability, define a matcher class implementing:

- `bool MatchAndExplain(const T& value, std::ostream* listener) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Set `using is_gtest_matcher = void;` alias inside the class.

Example:

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    if (n % 7 == 0) return true;
    if (os) *os << "the remainder is " << (n % 7);
    return false;
  }

  void DescribeTo(std::ostream* os) const { *os << "is divisible by 7"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is not divisible by 7"; }
};

::testing::Matcher<int> DivisibleBy7() {
  return DivisibleBy7Matcher();
}
```

---

## Using Matchers in Expectations and Assertions

### Inside `EXPECT_CALL` and `ON_CALL`

Matchers specify the criteria for argument matching. Use `_` to accept any
value or more specific matchers for precise control.

Example:

```cpp
EXPECT_CALL(mock_turtle, Forward(Ge(10))).Times(AtLeast(1));
```

### With `EXPECT_THAT` and `ASSERT_THAT`

Validate values directly using matchers:

```cpp
EXPECT_THAT(str, StartsWith("Hello"));
EXPECT_THAT(value, AllOf(Gt(0), Lt(10)));
```

---

## Composing Matchers

Combine multiple conditions:

- `AllOf(m1, m2, ...)` — all must match
- `AnyOf(m1, m2, ...)` — any must match
- `Not(m)` — negation of match

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(1), Le(10))));
```

Use `Args<>` and `With()` to match argument tuples:

```cpp
EXPECT_CALL(mock, Func(_, _))
   .With(AllOf(Args<0,1>(Lt()), Args<1>(Ge(5))));
```

---

## Predicates and Custom Predicate Assertions

Beyond matchers, predicates are functions or functors returning Boolean or
`AssertionResult`. Use them in assertions for richer failure messaging.

### Using Predicate Assertions

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
```

### Using Predicate-Formatter Assertions

For custom failure messages:

```cpp
testing::AssertionResult AssertPositive(const char* expr, int val) {
  if (val > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " is not positive";
}

EXPECT_PRED_FORMAT1(AssertPositive, value);
```

### Using Matchers as Predicates

Match any stl algorithm predicate:

```cpp
int count = std::count_if(v.begin(), v.end(), Matches(Ge(10)));
```

---

## Tips and Best Practices

- Prefer existing matchers and predicates over ad hoc boolean checks.
- Use expressive matcher composition for clarity.
- Define custom matchers for reusable complex validation logic.
- Use parameterized matchers to customize behavior with arguments.
- Avoid side effects in matchers; they should be purely functional.
- Use `SafeMatcherCast<T>(m)` to handle slight type mismatches safely.
- When mocking overloaded methods, clarify overloads using `Const()`, typed matchers, or explicit casting.
- Use `EXPECT_CALL` sparingly to set actual call expectations; prefer `ON_CALL` for default behaviors.
- Provide helpful descriptions and failure explanations in custom matchers.

---

## Troubleshooting

- If your matcher fails to compile, verify argument types and usage context.
- If unexpected calls occur in mocks, ensure correct expectations are set.
- Use `--gmock_verbose=info` to debug matcher and expectation matching flows.
- If you see unexpected matcher failure messages, add detailed explanation to `MatchAndExplain` or employ predicate-format assertions.

---

## References and Further Reading

- [Matchers Reference](reference/matchers.md) — full list of built-in matchers.
- [Mocking Reference](reference/mocking.md) — how to define and use mocks.
- [gMock Cookbook](gmock_cook_book.md) — recipes for advanced mock usage.
- [Custom Matchers Guide](guides/advanced-testing-patterns/custom-assertions-and-matchers.mdx) — defining your own matchers.
- [Assertions Reference](reference/assertions.md) — deeper details on assertions including predicate assertions.
- [gMock for Dummies](gmock_for_dummies.md) — beginner-friendly introduction.

---

<Source url="https://github.com/google/googletest" paths='[{"path": "googletest/include/gmock/gmock-matchers.h", "range": "1-1050"}]' />