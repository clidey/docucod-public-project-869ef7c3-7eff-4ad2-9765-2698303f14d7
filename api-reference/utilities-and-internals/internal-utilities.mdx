---
title: "Internal Utilities & Type Traits"
description: "API documentation for core internal utilities and type traits that support advanced behaviors within the framework. Intended for contributors and advanced integrators seeking to understand or extend GoogleMock internals."
---

# Internal Utilities & Type Traits

This documentation covers core internal utilities and type traits used by GoogleMock. It is intended for contributors and advanced integrators who seek to understand or extend the internals of the framework. This page explains key utilities for type categorization, argument handling, failure reporting, logging, and container support.

---

## Type Categories and Safe Type Conversions

GoogleMock internally classifies C++ types into specific kind categories to enable safe and optimized matcher casts. The main categories are:

- `kBool`: Boolean types
- `kInteger`: Integer types (excluding bool)
- `kFloatingPoint`: Floating-point types
- `kOther`: All other types

### Determining Type Kind

The `KindOf<T>` template struct evaluates the category of type `T`. It is specialized for built-in types. For example:

```cpp
KindOf<bool>::value == kBool;
KindOf<int>::value == kInteger;
KindOf<float>::value == kFloatingPoint;
KindOf<std::string>::value == kOther;
```

### Lossless Arithmetic Conversion Check

To guarantee safe conversions between matcher argument types, GoogleMock uses `LosslessArithmeticConvertible<From, To>`. This template returns `true` if converting from arithmetic type `From` to `To` is guaranteed lossless, e.g., no information or sign loss.

Rules include:

- Bool converts losslessly to integers and floating-point types.
- Integer conversions are lossless only if size and signedness are compatible (e.g., smaller unsigned to larger signed is safe).
- Floating-point conversions are lossless only if target is at least as wide as the source.

Example usage:

```cpp
static_assert(LosslessArithmeticConvertible<unsigned char, int>::value, "Safe conversion");
static_assert(!LosslessArithmeticConvertible<int, unsigned int>::value, "Unsafe conversion");
```

## Matcher Argument Handling

### Getting Raw Pointers

The `GetRawPointer` function extracts the underlying raw pointer from various pointer-like types:

- For smart pointers (e.g. `std::unique_ptr`), returns the raw pointer via `.get()`.
- For `std::reference_wrapper`, returns the address of the referenced object.
- For raw pointers, returns the pointer as is.

This utility ensures consistent access to raw pointers when matching or invoking mock methods.

Example:

```cpp
std::unique_ptr<int> sp(new int(5));
int* raw = GetRawPointer(sp);  // returns int*
```

### Type Conversion Helpers

To assist safe upcasting and downcasting of argument types, GoogleMock defines:

- `ImplicitCast_<ToType>(expr)`: A safe variant of `static_cast` to upcast types in the class hierarchy.
- `CheckedDowncastToActualType<Derived, Base>(Base* base)`: Performs a `static_cast` but with RTTI checks when available, verifying the actual object type.

## Failure Reporting and Logging

GoogleMock reports failures and logs messages accordingly using:

- `FailureReporterInterface`: An interface for reporting fatal or non-fatal failures.
- `GoogleTestFailureReporter`: Implements failure reporting by forwarding to GoogleTest's assertion framework.

### Assertion Helpers

- `Assert(condition, file, line, msg)`: Aborts the process with a message if condition is false.
- `Expect(condition, file, line, msg)`: Generates a non-fatal failure message if condition is false.

### Logging Severity Levels

- `kInfo`: Informational logs
- `kWarning`: Warning logs

Defined verbosity levels for controlling runtime logging:

- `info`: Print all logs
- `warning`: Print warnings and errors only (default)
- `error`: Print errors only

### Log Visibility and Printing

- `LogIsVisible(LogSeverity)`: Returns if a log of given severity should be printed based on verbosity flag.
- `Log(LogSeverity, message, stack_frames_to_skip)`: Prints message to stdout with optional stack trace if verbosity and severity permit.

## Container Adaptation and Type Traits

GoogleMock adapts various containers and native arrays to a common STL-style container interface for uniform matcher and action support.

- `StlContainerView<RawContainer>` provides:
  - `type`: The adapted container type.
  - `const_reference`: A const reference type to the container view.
  - `ConstReference(raw_container)`: Returns a const reference view.
  - `Copy(raw_container)`: Returns a copy if necessary.

### Specializations

- For native arrays `Element[N]`, adapts using `NativeArray<Element>` which acts as an STL-style container wrapper.
- For tuple representations of arrays (pointer and size), similar adaptation applies.

### NativeArray

Wraps a native array providing:

- `size()`
- `begin()`, `end()` iterators
- Equality operator

to function like an STL container.

## String and Identifier Utilities

- `JoinAsKeyValueTuple(names, values)`: Joins vectors of strings as key-value tuple representations used in error messages.
- `ConvertIdentifierNameToWords(id_name)`: Converts camel-case or underscore-separated identifier strings to a human-readable lowercase space-separated phrase.

Example:

```cpp
ConvertIdentifierNameToWords("FooBar123") == "foo bar 123";
```

## Miscellaneous Utilities

- Macros and inlines for compiler warning suppression and platform compatibility.
- Logging mutex to prevent interleaved logs in multithreaded tests.
- Base64 decode utility for internal use.
- `WithoutMatchers`: A marker type to resolve ambiguity in parameterless expectations.

## Usage Notes

**Important:**

- These utilities and traits are *internal* and may change without notice.
- They are foundational for mocking behaviors, matcher type safety, and logging.

---

<AccordionGroup title="Key Utilities Summary">
<Accordion title="TypeKind Enumeration and KindOf Template">
Defines the categorization of C++ fundamental types for safe matcher casting and specialization.
</Accordion>
<Accordion title="LosslessArithmeticConvertible Template">
Ensures safe, lossless conversion between arithmetic types for matcher argument compatibility.
</Accordion>
<Accordion title="GetRawPointer Function">
Extracts the underlying raw pointer from smart pointers, raw pointers, or reference wrappers uniformly.
</Accordion>
<Accordion title="Failure Reporting and Logging">
Abstracts failure report dispatching to Google Test's assertion framework; handles log verbosity.
</Accordion>
<Accordion title="StlContainerView and NativeArray">
Adapts native arrays and raw container data to STL-like containers for matcher support.
</Accordion>
</AccordionGroup>