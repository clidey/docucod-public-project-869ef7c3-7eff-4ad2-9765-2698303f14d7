---
title: "Matchers API"
description: "Reference for GoogleTest’s powerful matchers, enabling expressive verification of test values including comparisons, regular expressions, and custom matchers. Explains usage scenarios and extension mechanisms."
---

# Matchers API Reference

GoogleTest provides an expressive and powerful set of *matchers* that allow you to verify test values with fine-grained, readable checks. This page documents the built-in matchers, explains how to apply them in common scenarios, and guides on how to extend them with your own logic.

---

## What Are Matchers?

Matchers are predicates expressing expectations on values supplied to your tests. These predicates go beyond simple comparisons — they support a rich diversity of checks including:

- Equality and inequality
- Ordering relations
- String operations like substring, prefix, suffix
- Regular expression matches
- Container element validation
- Pointer nullness and pointee checks

A matcher ultimately answers the question: *Does this value satisfy this condition?* and can produce detailed failure messages explaining why.

<Info>
Using matchers with GoogleMock `EXPECT_CALL` or GoogleTest `EXPECT_THAT` makes your test expectations more expressive and diagnostic.
</Info>

## Using Built-in Matchers

### Basic Comparison Matchers

Use these matchers for simple, intuitive comparisons:

| Matcher | Description |
|---------|-------------|
| `Eq(value)` | Matches any value equal to `value`.
| `Ne(value)` | Matches any value not equal to `value`.
| `Lt(value)` | Matches any value less than `value`.
| `Le(value)` | Matches any value less than or equal to `value`.
| `Gt(value)` | Matches any value greater than `value`.
| `Ge(value)` | Matches any value greater than or equal to `value`.

Example:
```cpp
EXPECT_THAT(actual, Eq(expected));
EXPECT_THAT(size, Ge(0));
```

### Wildcard Matchers

- `_` or `A<T>()` & `An<T>()`: Match any value of type `T`.
- `IsNull()`: Matches any `nullptr` pointer.
- `NotNull()`: Matches any non-null pointer.

Example:
```cpp
EXPECT_CALL(mock, Foo(_));      // Expect Foo called with any argument.
EXPECT_THAT(ptr, NotNull());    // Check pointer is not null.
```

### String Matchers

- `StrEq(str)`: Equals string `str` considering case.
- `StrNe(str)`: Not equal to string `str` considering case.
- `StrCaseEq(str)`: Equals string `str`, ignoring case.
- `StrCaseNe(str)`: Not equal to string `str`, ignoring case.
- `HasSubstr(sub)`: Contains substring `sub`.
- `StartsWith(prefix)`: Starts with `prefix`.
- `EndsWith(suffix)`: Ends with `suffix`.

Example:
```cpp
EXPECT_THAT(name, StartsWith("John"));
EXPECT_THAT(message, HasSubstr("error"));
```

### Container Matchers

Matchers tailored for STL-like containers:

- `ElementsAre(...)`: Matches containers with elements matching the listed matchers in order.
- `UnorderedElementsAre(...)`: Matches containers with the listed elements in any order.
- `ElementsAreArray(array)`: Matches container elements against an array or iterator range.
- `UnorderedElementsAreArray(array)`: Same as `ElementsAreArray()`, but ignores order.
- `Contains(element_matcher)`: Matches containers that contain at least one element satisfying the matcher.
- `Each(element_matcher)`: Matches containers where every element satisfies the matcher.
- `SizeIs(size_matcher)`: Matches containers whose size satisfies the given matcher.

Example:
```cpp
std::vector<int> v = {1, 3, 5};
EXPECT_THAT(v, ElementsAre(1, _, Gt(4)));
EXPECT_THAT(v, Contains(Eq(3)));
```

### Pointer and Smart Pointer Matchers

- `Pointee(matcher)`: Matches if pointer points to a value matching `matcher`, fails if pointer is null.
- `Pointer(matcher)`: The pointer itself matches the given pointer matcher (e.g., `IsNull()`).

Example:
```cpp
std::unique_ptr<int> p = std::make_unique<int>(5);
EXPECT_THAT(p, Pointee(Eq(5)));
```

### Tuple & Pair Matchers

- `Pair(first_matcher, second_matcher)`: Matches pairs where first and second fields match respective matchers.
- `Key(matcher)`: Matches pairs (e.g., map entries) whose `.first` matches `matcher`.

Example:
```cpp
std::map<int, std::string> m = {{1, "foo"}};
EXPECT_THAT(m, Contains(Pair(1, "foo")));
EXPECT_THAT(m, Contains(Key(Ge(1))));
```

### Logical Combinators

Use these to combine multiple matchers:

- `AllOf(...)`: Matches if *all* sub-matchers match.
- `AnyOf(...)`: Matches if *any* sub-matchers match.
- `Not(matcher)`: Matches if the sub-matcher does not match.

Example:
```cpp
EXPECT_THAT(x, AllOf(Ge(0), Le(10)));   // x between 0 and 10 inclusive
EXPECT_THAT(name, Not(HasSubstr("bad")));
```

### Advanced Matchers

- `ResultOf(callable, matcher)`: Matches if `matcher` matches the result of applying `callable` to the value.
- `DistanceFrom(target, matcher)` (and overloads): Matches values whose distance from `target` matches `matcher`.
- `Optional(value_matcher)`: Matches engaged optionals whose value matches `value_matcher`.
- `WhenBase64Unescaped(matcher)`: Matches a base64-encoded string whose decoded value matches `matcher`.
- `WhenDynamicCastTo<T>(matcher)`: Matches pointers or references that dynamically cast to `T` and satisfy `matcher`.

### Floating Point Matchers

- `FloatEq(value)`, `NanSensitiveFloatEq(value)`: Approximate equality for floats.
- `DoubleEq(value)`, `NanSensitiveDoubleEq(value)`: Approximate equality for doubles.
- `FloatNear(value, max_abs_error)`, `DoubleNear(value, max_abs_error)`: Approximate equality within an absolute error.

---

## Writing Custom Matchers

Sometimes built-in matchers cannot express the predicate you need. GoogleTest offers powerful macros and interfaces to create your own custom matchers with comprehensive diagnostics.

### Using the `MATCHER` Macros

The simplest way to write a custom matcher is using `MATCHER` or its parameterized variants.

```cpp
MATCHER(IsEven, "checks if value is even") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_THAT(n, IsEven());
```

If your matcher requires parameters:

```cpp
MATCHER_P(HasAbsoluteValue, val, "matches absolute value") {
  return abs(arg) == val;
}

// Usage:
EXPECT_THAT(x, HasAbsoluteValue(5));
```

The last argument to the macro lets you customize the description string printed in failures, with access to `negation` (bool) and parameters.

### Implementing the Matcher Interface

For advanced scenarios needing more control or performance, implement the matcher interface directly:

```cpp
class DivisibleByMatcher {
 public:
  using is_gtest_matcher = void;  // Signifies a matcher

  explicit DivisibleByMatcher(int divisor) : divisor_(divisor) {}

  template <typename T>
  bool MatchAndExplain(const T& value, testing::MatchResultListener* listener) const {
    if (value % divisor_ == 0) return true;
    *listener << " (remainder " << (value % divisor_) << ")";
    return false;
  }

  void DescribeTo(std::ostream* os) const { *os << "is divisible by " << divisor_; }
  void DescribeNegationTo(std::ostream* os) const { *os << "isn't divisible by " << divisor_; }

 private:
  int divisor_;
};

::testing::Matcher<int> DivisibleBy(int divisor) {
  return ::testing::MakePolymorphicMatcher(DivisibleByMatcher(divisor));
}
```

---

## Practical Tips & Best Practices

- **Use Matchers to Improve Test Readability:** They make tests declarative, easy to understand, and maintain.
- **Prefer Built-in Matchers First:** They produce better diagnostics and maintain consistency.
- **Use `SafeMatcherCast<T>(m)` When Needed:** This safely casts between matcher types, enabling reuse.
- **Combine Matchers for Complex Logic:** Use `AllOf()`, `AnyOf()`, and `Not()` to build expressive conditions.
- **Avoid Side Effects in Matchers:** Matchers must be purely functional and have no observable side effects.

### Common Pitfalls

- Forgetting that `Pointee()` fails if the pointer is `nullptr`.
- Mixing up `EXPECT_CALL` with `ON_CALL`: the latter sets default behavior, the former sets expectations.
- Overusing `EXPECT_CALL` without necessity, leading to brittle tests.
- Passing matchers of incompatible types without `SafeMatcherCast`.

### Debugging Matcher Failures

Match failures print descriptions of what was expected and what was actually seen, including detailed explanations from the matcher where applicable. Use the diagnostic output to understand why a test failed and adjust matchers or values accordingly.

---

## Code Examples

### Using Basic Matchers

```cpp
using ::testing::Eq;
using ::testing::Gt;

EXPECT_THAT(value, Eq(expected));
EXPECT_THAT(count, Gt(0));
```

### Combining Matchers

```cpp
using ::testing::AllOf;
using ::testing::Not;
using ::testing::HasSubstr;

EXPECT_THAT(name, AllOf(StartWith("Mr."), Not(HasSubstr("Foo"))));
```

### Matching Container Elements

```cpp
using ::testing::ElementsAre;
using ::testing::Gt;

std::vector<int> v{1, 3, 5};
EXPECT_THAT(v, ElementsAre(1, Gt(2), 5));
```

### Custom Matcher Example

```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "the remainder is " << (arg % 7);
  return false;
}

EXPECT_THAT(number, IsDivisibleBy7());
```

---

## Extending Matchers

For full details on extending and creating custom matchers, see the [Custom Assertions and Matchers Guide](../guides/advanced-usage/custom-assertions.md). It covers advanced patterns, troubleshooting, and integration tips.

---

## Additional Resources

- [EXPECT_THAT Assertion Reference](../api-reference/core-testing-framework/assertions-and-failures.md#EXPECT_THAT)
- [Mocking with GoogleMock](../guides/core-workflow/writing-mocks.md)
- [Matchers, Assertions & Result Evaluation](../concepts/core-architecture/matchers-expectations.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)

Explore these to understand how matchers fit within test assertions, mocking, and the overall testing workflow.

---

## Summary
Matchers are a cornerstone of expressive, readable, and maintainable test code in GoogleTest, letting you assert complex properties on values and mock interactions. From elementary comparisons to elaborate container and tuple validations, matchers provide a rich API to precisely express your test expectations.

By leveraging built-in matchers, combinators, and custom matcher facilities, you empower your tests with robust diagnostics and avoid brittle, verbose code. This documentation offers the foundation and examples to master the matchers API and craft your own extensions.

---

<Callout title="Usage Reminder">
For best practice, use `EXPECT_THAT(value, matcher)` or `EXPECT_CALL(mock, Method(matcher, ...))` with matchers as arguments to assert test conditions clearly and powerfully.
</Callout>


