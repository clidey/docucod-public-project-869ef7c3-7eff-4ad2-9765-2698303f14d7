---
title: "Assertions and Failure Reporting"
description: "An in-depth overview of assertion macros, the AssertionResult class, and mechanisms for qualifying test outcomes. Includes equality, inequality, exception, and predicate assertions, with explanations on interpreting and extending test feedback."
---

# Assertions and Failure Reporting

An in-depth overview of assertion macros, the `AssertionResult` class, and mechanisms for qualifying test outcomes in GoogleTest. This documentation covers equality, inequality, exception, and predicate assertions, and explains how to interpret and extend test feedback.

---

## Introduction to Assertions

GoogleTest assertions are macros designed to verify and document the correctness of code under test. Each assertion evaluates a condition and reports success, a nonfatal failure, or a fatal failure.

- **Nonfatal failures** (generated by `EXPECT_` macros) record a failure but allow the current test to continue.
- **Fatal failures** (generated by `ASSERT_` macros) record a failure and abort the function immediately.

Custom failure messages can be appended to assertions using the streaming `<<` operator, enabling enhanced diagnostics.


## Explicit Success and Failure Assertions

Sometimes you want to explicitly signal success or failure unrelated to a condition.

- `SUCCEED()` generates a success signal. It does not guarantee the overall test passes.

- `FAIL()` generates a fatal failure and immediately aborts the current void function.

- `ADD_FAILURE()` generates a nonfatal failure and allows the test to continue.

- `ADD_FAILURE_AT(file, line)` generates a nonfatal failure and reports it at the specified file and line number.

Example:

```cpp
switch (value) {
  case 1:
    ...
    break;
  default:
    FAIL() << "Unexpected value: " << value;
}
```


## Generalized Assertions Using Matchers

GoogleTest supports flexible assertions using [matchers](matchers.md) through:

- `EXPECT_THAT(value, matcher)`
- `ASSERT_THAT(value, matcher)`

These allow elegant, readable tests with powerful, extensible matching semantics.

Example:

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_other_string, MatchesRegex("Line \\d+"));
ASSERT_THAT(num, AllOf(Gt(5), Lt(10)));
```

On failure, descriptive messages are generated outlining expected and actual values.


## Boolean Condition Assertions

These assertions check simple Boolean conditions.

| Macro             | Description                       |
|-------------------|---------------------------------|
| EXPECT_TRUE(cond)  | Verifies that `cond` is `true`. |
| ASSERT_TRUE(cond)  | Verifies that `cond` is `true`. |
| EXPECT_FALSE(cond) | Verifies that `cond` is `false`|
| ASSERT_FALSE(cond) | Verifies that `cond` is `false`|

Example:

```cpp
EXPECT_TRUE(IsValid(user_input)) << "User input not valid";
ASSERT_FALSE(IsErrorFlagSet()) << "Error flag unexpectedly set";
```


## Binary Comparison Assertions

Assertions to compare two values, evaluated exactly once. They work for both narrow and wide strings, pointers, arithmetic types, and more.

| Macro               | Description                             |
|---------------------|---------------------------------------|
| EXPECT_EQ(val1,val2) | Checks `val1 == val2`                  |
| ASSERT_EQ(val1,val2) | Checks `val1 == val2`                  |
| EXPECT_NE(val1,val2) | Checks `val1 != val2`                  |
| ASSERT_NE(val1,val2) | Checks `val1 != val2`                  |
| EXPECT_LT(val1,val2) | Checks `val1 < val2`                   |
| ASSERT_LT(val1,val2) | Checks `val1 < val2`                   |
| EXPECT_LE(val1,val2) | Checks `val1 <= val2`                  |
| ASSERT_LE(val1,val2) | Checks `val1 <= val2`                  |
| EXPECT_GT(val1,val2) | Checks `val1 > val2`                   |
| ASSERT_GT(val1,val2) | Checks `val1 > val2`                   |
| EXPECT_GE(val1,val2) | Checks `val1 >= val2`                  |
| ASSERT_GE(val1,val2) | Checks `val1 >= val2`                  |

**Important:**

- For C strings, pointer equality tests the memory addresses, **not** string content.
- Use `EXPECT_STREQ` and related macros for string content equality.

Example:

```cpp
EXPECT_EQ(user.age, 42) << "Age mismatch";
ASSERT_NE(pointer, nullptr) << "Pointer must not be nullptr";
```


## String Comparison Assertions

Specialized macros for comparing C strings, including null safety and case-insensitive options.

| Macro                 | Description                                   |
|-----------------------|-----------------------------------------------|
| EXPECT_STREQ(s1,s2)   | Checks that C strings `s1` and `s2` are equal (content-wise) |
| ASSERT_STREQ(s1,s2)   | Checks that C strings `s1` and `s2` are equal (fatal)        |
| EXPECT_STRNE(s1,s2)   | Checks that C strings differ                   |
| ASSERT_STRNE(s1,s2)   | Checks that C strings differ (fatal)            |
| EXPECT_STRCASEEQ(s1,s2) | Checks C strings equal ignoring case        |
| ASSERT_STRCASEEQ(s1,s2) | Checks C strings equal ignoring case (fatal) |
| EXPECT_STRCASENE(s1,s2) | Checks C strings differ ignoring case        |
| ASSERT_STRCASENE(s1,s2) | Checks C strings differ ignoring case (fatal) |

These macros handle wide strings (`wchar_t*`) and NULL pointers robustly.

Example:

```cpp
EXPECT_STREQ(expected_cstr, actual_cstr);
ASSERT_STRCASEEQ("hello", user_input);
EXPECT_STRNE("error", log_message);
```


## Floating-Point Comparison Assertions

Direct equality of floating-point values is unreliable due to rounding. GoogleTest provides macros that compare within defined tolerances.

| Macro             | Description                                    |
|-------------------|------------------------------------------------|
| EXPECT_FLOAT_EQ(val1,val2)  | Checks floats approximately equal (4 ULP)   |
| ASSERT_FLOAT_EQ(val1,val2)  | Checks floats approximately equal (fatal)   |
| EXPECT_DOUBLE_EQ(val1,val2) | Checks doubles approximately equal (4 ULP)  |
| ASSERT_DOUBLE_EQ(val1,val2) | Checks doubles approximately equal (fatal)  |
| EXPECT_NEAR(val1,val2,abs_error) | Checks values within absolute error       |
| ASSERT_NEAR(val1,val2,abs_error) | Checks values within absolute error (fatal) |

Example:

```cpp
EXPECT_FLOAT_EQ(computed_value, expected_value);
ASSERT_NEAR(calculated_pi, 3.14, 0.01);
```

The macros handle infinity and NaN values with well-defined semantics.


## Exception Assertions

Require exceptions enabled in your build. These macros verify that code throws or does not throw exceptions.

| Macro                   | Description                                      |
|-------------------------|-------------------------------------------------|
| EXPECT_THROW(stmt, exc)  | Verify `stmt` throws exception of type `exc`    |
| ASSERT_THROW(stmt, exc)  | Same as above, fatal                              |
| EXPECT_ANY_THROW(stmt)   | Verify `stmt` throws any exception               |
| ASSERT_ANY_THROW(stmt)   | Same as above, fatal                              |
| EXPECT_NO_THROW(stmt)    | Verify `stmt` throws no exceptions                |
| ASSERT_NO_THROW(stmt)    | Same as above, fatal                              |

Example:

```cpp
EXPECT_THROW(DoSomething(), std::runtime_error);
ASSERT_NO_THROW(ProcessData());
```

These macros accept compound statements using braces.


## Predicate Assertions

For complex conditions, predicate assertions provide better diagnostics compared to simple `EXPECT_TRUE()` on complex expressions.

### Ordinal Predicate Assertions

Macros named `EXPECT_PREDn` and `ASSERT_PREDn` where n  is from 1 to 5.

- `EXPECT_PRED1(pred, val1)`: passes if `pred(val1)` is true.
- `EXPECT_PRED2(pred, val1, val2)`: passes if `pred(val1, val2)` is true.

and so on up to 5 arguments.

The predicate function or functor must return `bool`. Arguments are streamed in the failure message for easier debugging.

Example:

```cpp
bool IsPrime(int n) { ... }
EXPECT_PRED1(IsPrime, 7);
```

### Predicate Formatter Assertions

Macros named `EXPECT_PRED_FORMATn` and `ASSERT_PRED_FORMATn` where n is from 1 to 5.

They accept predicate formatter functions or functors with this signature:

```cpp
testing::AssertionResult PredicateFormatter(const char* expr1, ..., const char* exprn, T1 val1, ..., Tn valn);
```

Returns `AssertionSuccess()` on success; `AssertionFailure()` with custom messages otherwise.

Example:

```cpp
testing::AssertionResult IsEvenFormatter(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << " which is not even.";
}
EXPECT_PRED_FORMAT1(IsEvenFormatter, 4);
```

These allow full control over failure messages when predicates fail.


## Streaming Custom Failure Messages

All assertions support streaming additional failure messages with `<<`. This can be text, values, or complex custom messages.

Example:

```cpp
EXPECT_EQ(x.size(), y.size()) << "Sizes don't match";
EXPECT_TRUE(IsValid(x)) << "Invalid x: " << x.info();
```


## AssertionResult Class

In addition to the macros, `testing::AssertionResult` allows creation of custom assertion results, encapsulating success/failure and messages.

- `AssertionSuccess()`: returns a success object.
- `AssertionFailure()`: returns a failure object that can be appended with message streaming.

Example predicate function using `AssertionResult`:

```cpp
testing::AssertionResult IsPositive(int n) {
  if (n > 0) return testing::AssertionSuccess() << n << " is positive";
  else return testing::AssertionFailure() << n << " is not positive";
}

EXPECT_TRUE(IsPositive(value));
```

This approach improves readability and diagnostics in test logs.


## Common Pitfalls & Best Practices

- Use `EXPECT_` macros when continuing the test after failure is desirable.
- Use `ASSERT_` macros when failure should stop the test immediately.
- Use string equality assertions for C strings; avoid comparing pointers directly.
- Avoid side effects inside expressions passed to assertions; arguments are evaluated exactly once but in unspecified order.
- Use predicate assertions or custom matchers for complex validations to get detailed error reporting.
- For floating-point comparisons, prefer `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` over `EXPECT_EQ`.
- Stream clear, contextual messages for easier debugging.


## Examples

### Boolean Condition

```cpp
EXPECT_TRUE(IsReady()) << "System not ready";
ASSERT_FALSE(IsError()) << "Unexpected error flag";
```

### Equality

```cpp
EXPECT_EQ(expected_value, actual_value) << "Value mismatch";
ASSERT_NE(nullptr, pointer) << "Pointer was null";
```

### String Comparison

```cpp
EXPECT_STREQ("Hello", greeting.c_str()) << "Greeting mismatch";
ASSERT_STRCASEEQ("OK", response.status.c_str()) << "Status mismatch";
```

### Floating-point Comparison

```cpp
EXPECT_FLOAT_EQ(3.1415f, calculated_pi) << "Pi calculation error";
EXPECT_NEAR(2.718, e_value, 0.01) << "e calculation error";
```

### Exception

```cpp
EXPECT_THROW(DoWork(), std::runtime_error);
ASSERT_NO_THROW(InitializeSystem());
```

### Predicate Assertion

```cpp
bool IsSorted(const std::vector<int>& v) { ... }
EXPECT_PRED1(IsSorted, numbers) << "Numbers are not sorted";
```

### Custom AssertionResult Predicate

```cpp
testing::AssertionResult IsPositive(int n) {
  if (n > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is not positive";
}
EXPECT_TRUE(IsPositive(value));
```

## Troubleshooting

- Failure messages include file and line number.
- Use `SCOPED_TRACE()` to add contextual trace information to failures.
- Fatal failures inside non-void-returning functions will cause confusing compilation errors; consider refactoring or using nonfatal assertions.
- For unexpected crashes or premature test exit, ensure death tests are properly isolated.
- If tests do not run, verify filters and disabled tests flags.

## Further Reading

- [Matchers Reference](matchers.md): for rich matching support
- [Advanced Usage: Predicate Assertions](advanced.md#predicate-assertions)
- [Guides: Writing Your First Test](guides/core-workflow/getting-started-tests.md)
- [API Reference: Test Registration](api-reference/core-testing-framework/test-registration-and-execution.md)

---

