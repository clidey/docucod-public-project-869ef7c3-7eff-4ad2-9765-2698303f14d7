---
title: "Matchers"
description: "Matcher APIs to specify flexible and expressive argument constraints for mock method expectations and assertions. Covers standard library and user-defined matchers, including advanced syntax for capturing detailed interactions."
---

# Matchers

Matchers in GoogleMock enable you to specify flexible and expressive constraints on the arguments of mock methods. They allow you to precisely describe **what kind** of arguments you expect when a mock method is called, supporting both simple and complex argument validations.

This reference covers the entire spectrum of matchers available, including standard library matchers, user-defined custom matchers, and advanced constructs for composing and combining matchers. These empower you to write robust and readable tests that target detailed interaction behaviors.

---

## Overview

Matchers act as predicates for arguments in mock method expectations and assertions. Instead of testing only for exact argument equality, matchers can express constraints like:

- "argument is greater than 5"
- "argument is a non-null pointer"
- "string argument contains a substring"
- "container has elements matching certain criteria"

This rich expressiveness allows you to avoid brittle tests, focusing on relevant properties rather than concrete values.

Common usage includes methods like `EXPECT_CALL` where you specify matchers for each argument, or assertions using `EXPECT_THAT` that leverage matchers directly.

---

## Core Concepts

### Wildcard and Basic Type Matchers

- `_` : Matches anything (wildcard matcher).
- `Eq(value)` or just a literal `value` : Matches arguments equal to the specified value.
- `Ne(value)`, `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` : Comparison-based matchers.

### Polymorphic Matchers

Matchers like `Eq()` or `Gt()` are polymorphic, meaning they can be used to match compatible types (e.g., `Eq(5)` can match `int`, `long`, etc.). This polymorphism enhances usability in generic code.

### Logical Combinators

- `AllOf(m1, m2, ...)` : Matches if **all** sub-matchers match.
- `AnyOf(m1, m2, ...)` : Matches if **any** sub-matcher matches.
- `Not(m)` : Matches if the matcher `m` does **not** match.

These combinators allow for complex expressions.

### Tuple and Tuple-like Matchers

- `Pair(m1, m2)` : Matches a 2-element pair where first matches `m1` and second matches `m2`.
- `FieldsAre(m1, m2, ..., mn)` : Matches each field of an aggregate or tuple-like object.

### Container Matchers

- `ElementsAre(m1, m2, ..., mn)` : Matches a container whose elements exactly match the given sequence of matchers.
- `UnorderedElementsAre(m1, m2, ..., mn)` : Matches a container where elements match the given matchers in any order.
- `Contains(m)` : Matches container having at least one element matched by `m`.
- `Each(m)` : Matches container where all elements match `m`.

### Pointer and Optional Matchers

- `IsNull()` and `NotNull()` : For pointer arguments.
- `Pointee(m)` : Matches pointers to values matching `m`.
- `Optional(m)` : Matches optional values containing values that match `m`.

### Member and Property Matchers

- `Field(&Class::member, m)` : Matches a class or pointer to a class whose member matches `m`.
- `Property(&Class::property_method, m)` : Matches based on a property's getter method return value.

### Specialized Matchers

- `Ref(variable)` : Matches an argument that references exactly the specified variable.
- `WhenDynamicCastTo<T>(m)` : Matches pointers or references dynamically cast to type `T` matching `m`.
- `DistanceFrom(target, m)` : Matches values within a distance constraint to a target.

### Argument Tuple Matchers

- `With(m)` : In `EXPECT_CALL` or `ON_CALL`, matches the whole argument list as a tuple against matcher `m`.
- `Args<k1, ..., kn>(m)` : Matches selected argument indices as a tuple.

### Approximate Floating-Point Matchers

- `FloatEq(value)` / `DoubleEq(value)` : Matches floating-point values approximately equal to `value`.
- `FloatNear(value)` / `DoubleNear(value)` : Matches with user-defined absolute error.
- Nan-sensitive variants match NaN values as equal.

---

## Using Matchers in Mock Expectations

Example:

```cpp
using ::testing::_;
using ::testing::Gt;
using ::testing::Return;

EXPECT_CALL(mock_obj, ProcessData(Gt(5), _))
    .WillOnce(Return(true));
```

Here, the first argument must be greater than 5; the second argument can be anything.

If you want to be permissive on arguments, use `_` or omit the argument list (only for non-overloaded methods).

---

## Defining Custom Matchers

You can define simple custom matchers easily with the `MATCHER` macro:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
```

Use it as:

```cpp
EXPECT_CALL(mock_obj, Foo(IsEven()));
EXPECT_THAT(value, IsEven());
```

You can add descriptive failure output by streaming to the provided `result_listener`:

```cpp
MATCHER(IsDivisibleBy3, "") {
  if (arg % 3 == 0) return true;
  *result_listener << "which leaves remainder " << (arg % 3);
  return false;
}
```

For parameterized matchers, use `MATCHER_P`, `MATCHER_P2`, ... up to `MATCHER_P10`.

Example:

```cpp
MATCHER_P(InRange, bound, "") {
  return arg >= 0 && arg <= bound;
}
EXPECT_THAT(number, InRange(10));
```

Provides better error reporting than raw predicates.

---

## Advanced Matcher Composition

Match nested structures by combining basic matchers.

Example: validating a map entry

```cpp
EXPECT_THAT(std::map<int, string>{{1, "foo"}},
            Contains(Pair(1, StartsWith("f"))));
```

Use logical combinators to express complex conditions:

```cpp
EXPECT_CALL(mock_obj, Foo(AllOf(Gt(0), Ne(5))));
```

---

## Common Pitfalls and Tips

- Always specify expectations prior to calling mock methods.
- Avoid overly rigid matchers that specify too much detail.
- Use `_` matcher for unconstrained arguments.
- For move-only types, use lambdas or functors to produce fresh objects.
- Use `SafeMatcherCast<T>` to safely cast matchers to the appropriate type.
- Use `Ref(variable)` carefully; the matched argument must be the exact variable.

---

## Troubleshooting Matcher Failures

- Read error messages carefully: they describe expected vs actual argument.
- Enable `--gmock_verbose=info` for detailed call and expectation tracing.
- Look for mismatch details provided by matchers, often with explanation strings.
- Use matcher composition for more granular diagnostics.

---

## Practical Examples

Matching any value:

```cpp
EXPECT_CALL(mock, Foo(_));
```

Matching a string starting with "Hello":

```cpp
EXPECT_CALL(mock, Foo(StartsWith("Hello")));
```

Matching a container with exactly four elements, first is 1, second > 0:

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _, 5)));
```

Matching an unordered container with elements matching 1, 2, 3 (any order):

```cpp
EXPECT_CALL(mock, Foo(UnorderedElementsAre(1, 2, 3)));
```

Matching a pointer to a value greater than 5:

```cpp
EXPECT_CALL(mock, Foo(Pointee(Gt(5))));
```

Using `With` to assert multi-argument relational conditions:

```cpp
EXPECT_CALL(mock, Bar(_, _))
    .With(Lt());  // first arg < second arg
```

---

## Summary

Matchers are an integral part of creating expressive, maintainable mock expectations in GoogleMock. They allow you to specify exactly which arguments are considered valid for calls to mocked methods and support a broad spectrum of argument validation strategies.

By composing matchers, defining your own, and leveraging built-in utilities, you align your tests with intended behavior rather than concrete values, improving resilience and clarity.

---

## Related Documentation

- [Mocking Reference](../docs/reference/mocking.md) — using mocks and setting expectations
- [Matchers Reference](../docs/reference/matchers.md) — full list of built-in matchers
- [gMock for Dummies](../docs/gmock_for_dummies.md) — introductory tutorial
- [gMock Cookbook](../docs/gmock_cook_book.md#NewMatchers) — advanced matcher recipes
- [Assertions Reference](../docs/reference/assertions.md#EXPECT_THAT) — using matchers in assertions
- [Actions Reference](../docs/api-reference/gmock-mocking-apis/actions.mdx) — for specifying mock behaviors

---

## Next Steps

Explore defining custom matchers using `MATCHER` and `MATCHER_P` macros for domain-specific logic.

Use matchers in combination with `EXPECT_CALL` and `ON_CALL` to precisely specify and customize mock behaviors and expectations.

Consult the [gMock Cookbook](../docs/gmock_cook_book.md) for practical patterns and advanced usages.

Consider integrating matchers with GoogleTest assertions (`EXPECT_THAT`) to verify non-mock-related program state verifications.

---

<Source url="https://github.com/google/googletest" paths='[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-1023"}]' />