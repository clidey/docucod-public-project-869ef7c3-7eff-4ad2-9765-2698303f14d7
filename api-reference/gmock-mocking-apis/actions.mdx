---
title: "Actions"
description: "Built-in and customizable action APIs that define what a mock method should do upon invocation. Reference for returning values, throwing exceptions, invoking callbacks, or composing complex behaviors, with practical examples."
---

# Actions Reference

Actions define what a mock method should do when it is invoked. GoogleMock provides a rich set of built-in actions and flexible APIs that allow you to return values, throw exceptions, invoke callbacks, and compose complex behaviors. All actions reside in the `::testing` namespace.

---

## 1. Returning Values

Control what a mock function returns using these actions:

| Action                     | Description                                                                                                                        |
|----------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| `Return()`                 | For `void` functions, simply returns.                                                                                            |
| `Return(value)`            | Returns the specified `value`. The type of `value` is converted to the mock function's return type at the time the action is set. |
| `ReturnArg<N>()`           | Returns the `N`-th (zero-indexed) argument passed to the mock.                                                                    |
| `ReturnNew<T>(a1,...,ak)`  | Returns a pointer to a new instance of type `T` created with constructor arguments `a1` to `ak`. A new object is created each call.|
| `ReturnNull()`             | Returns a null pointer.                                                                                                           |
| `ReturnPointee(ptr)`        | Returns the value pointed to by `ptr` at call time (useful to return a live value).                                               |
| `ReturnRef(variable)`       | Returns a reference to the given variable.                                                                                        |
| `ReturnRefOfCopy(value)`    | Returns a reference to a copy of `value`, which lives for the lifetime of the action object.                                     |
| `ReturnRoundRobin({a1,...,ak})` | Returns elements from the list sequentially, cycling when the end is reached.                                                  |

### Example: Returning Values

```cpp
using ::testing::Return;

class MockFoo {
 public:
  MOCK_METHOD(int, GetOne, (), ());
  MOCK_METHOD(int, GetFromArg, (int a), ());
  MOCK_METHOD(int*, GetNewIntPointer, (), ());
};

MockFoo foo;
EXPECT_CALL(foo, GetOne())
    .WillOnce(Return(42));
EXPECT_CALL(foo, GetFromArg(_))
    .WillRepeatedly(ReturnArg<0>());
EXPECT_CALL(foo, GetNewIntPointer())
    .WillRepeatedly(ReturnNew<int>(5));

int value = foo.GetOne();             // returns 42
int arg = foo.GetFromArg(6);         // returns 6
int* p = foo.GetNewIntPointer();     // returns newly allocated int with value 5
```

---

## 2. Side Effects

Actions can modify arguments or external state as side effects:

| Action                  | Description                                                                                   |
|-------------------------|-----------------------------------------------------------------------------------------------|
| `Assign(&variable, value)`     | Assigns `value` to the variable pointed to by `&variable`.                                      |
| `DeleteArg<N>()`              | Deletes the `N`-th argument assumed to be a pointer.                                          |
| `SaveArg<N>(pointer)`          | Copies the `N`-th argument into `*pointer` via copy-assignment.                               |
| `SaveArgByMove<N>(pointer)`    | Moves the `N`-th argument into `*pointer` via move-assignment.                               |
| `SaveArgPointee<N>(pointer)`   | Copies the value pointed to by the `N`-th argument into `*pointer`.                          |
| `SetArgReferee<N>(value)`     | Assigns `value` to the reference passed as the `N`-th argument.                             |
| `SetArgPointee<N>(value)`     | Assigns `value` to the pointer passed as the `N`-th argument.                               |
| `SetArrayArgument<N>(first, last)` | Copies elements from `[first, last)` to the array or iterator pointed to by the `N`-th argument.| 
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` and returns `value`.                                                 |
| `Throw(exception)`            | Throws the given exception object.                                                            |

### Example: Mocking Side Effects

```cpp
using ::testing::;
class MockMutator {
 public:
  MOCK_METHOD(void, Mutate, (int* value), ());
};

MockMutator mutator;
int x = 0;
EXPECT_CALL(mutator, Mutate(_))
    .WillOnce(SetArgPointee<0>(5));
mutator.Mutate(&x);
// x == 5 now
```

---

## 3. Using Callables as Actions

You can specify a function, functor, or lambda to be called when the mock method is invoked.

| Action                                            | Description                                                                              |
|-------------------------------------------------|------------------------------------------------------------------------------------------|
| `f`                                              | Calls callable `f` with the mock arguments.                                             |
| `Invoke(f)`                                      | Calls function or functor `f` with the mock arguments.                                  |
| `Invoke(object_pointer, &Class::method)`        | Calls `method` on `object_pointer` passing mock arguments.                             |
| `InvokeWithoutArgs(f)`                           | Calls `f` without passing any arguments.                                               |
| `InvokeWithoutArgs(object_pointer, &Class::method)` | Calls method with no arguments on object_pointer.                                  |
| `InvokeArgument<N>(arg1, arg2, ..., argk)`      | Calls the `N`-th argument (a callable) passed to the mock, with specified arguments.    |

Note: When passing arguments by reference to `InvokeArgument`, wrap them with `std::ref()`.

### Example: Using Functions and Callables

```cpp
using ::testing::Invoke;

int Sum(int x, int y) { return x + y; }

class Helper {
public:
  int TimesTwo(int x) { return 2 * x; }
};

MockFunction<int(int,int)> mock;
Helper helper;
EXPECT_CALL(mock, Call(_, _))
    .WillOnce(Invoke(Sum))
    .WillRepeatedly(Invoke(&helper, &Helper::TimesTwo));

int s = mock.AsStdFunction()(3, 4);  // Calls Sum(3,4), returns 7
int t = mock.AsStdFunction()(5, 0);  // Calls helper.TimesTwo(5), returns 10
```

---

## 4. Default and Composite Actions

| Action             | Description                                                                                           |
|--------------------|-----------------------------------------------------------------------------------------------------|
| `DoDefault()`      | Performs the default action as if no action was specified. Can be used in `ON_CALL` but not in composite actions. |
| `DoAll(a1, a2, ..., an)` | Performs multiple actions in order. Only the result of the last action is returned.                 |
| `IgnoreResult(a)`  | Performs action `a` and discards its result (makes it appear as returning `void`). Requires `a` to return a non-void value. |
| `WithArg<N>(a)`    | Calls action `a` passing only the `N`-th argument of the mock function.                              |
| `WithArgs<N1, ..., Nk>(a)` | Calls action `a` passing selected arguments by index.                                               |
| `WithoutArgs(a)`   | Calls action `a` without passing any arguments.                                                  |

### Example: Combining Actions

```cpp
using ::testing::;

MockFunction<bool(int*)> mock;

// Set argument pointed to by arg 0 to 5 and then return true
EXPECT_CALL(mock, Call(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));

int n = 0;
bool result = mock.AsStdFunction()(&n);
// result == true
// n == 5
```

---

## 5. Defining Custom Actions

For custom behaviors that the built-in actions cannot express, you can define your own actions:

- **Simple Actions:** Use the `ACTION(name) { ... }` macro to define a custom action at namespace scope. The parameters are accessible as `arg0`, `arg1`, ..., and you can return a value.
- **Parameterized Actions:** Use `ACTION_P(name, param)` or its variants (`ACTION_P2`, etc.) to define actions with parameters.
- **Polymorphic Actions:** Implement classes with a templated `Perform<Result>(args)` method and wrap them with `MakePolymorphicAction()` to support multiple function signatures.

### Example: Custom ACTION

```cpp
ACTION(IncrementArg0) {
  return arg0 + 1;
}

EXPECT_CALL(mock, DoSomething(5))
    .WillOnce(IncrementArg0());

// Will return 6 when DoSomething(5) is called
```

### Example: Parameterized ACTION_P

```cpp
ACTION_P(AddN, n) {
  return arg0 + n;
}

EXPECT_CALL(mock, DoSomething(5))
    .WillOnce(AddN(10));  // Returns 15
```

---

## 6. Practical Tips and Best Practices

- **Evaluating Arguments Once:** `EXPECT_CALL` and `ON_CALL` evaluate their arguments exactly once, ensuring side-effect free expectations.
- **Default Actions:** You can set default return values for types globally using `DefaultValue<T>::Set()`, or per-mock-method using `ON_CALL()`.
- **Multiple Actions:** Chain multiple `WillOnce()` calls to specify sequential behaviors, ending optionally with a `WillRepeatedly()` for fallback.
- **Ignoring Return Values:** Use `IgnoreResult()` to discard the return of an action when adapting non-`void` actions to `void` mocks.
- **Ordering Calls:** Use sequences (`InSequence` and `After`) for specifying strict or partial call order.
- **Uninteresting vs. Unexpected Calls:** Uninteresting calls are those with no `EXPECT_CALL` set and cause warnings by default; unexpected calls violate set expectations and cause errors.

---

## 7. Troubleshooting

- Ensure mock methods are virtual to be mockable.
- Beware of lifetime when returning references or pointers; `ReturnRef()` returns a reference to a live variable, whereas `Return()` holds a copy.
- When returning move-only types (e.g., `std::unique_ptr`), prefer lambdas or functors over `Return()`.
- Use `DoAll()` to combine side effects and return values.
- Remember that actions set in `WillOnce()` are consumed in order and that the number of `WillOnce()` calls must align with the `Times()` clause or the call cardinality.
- Use `InvokeArgument<N>()` correctly by wrapping reference arguments in `std::ref()` if needed.

---

## 8. Additional Resources

For deeper learning and examples, consult:

- [gMock Cookbook - Actions Section](https://google.github.io/googletest/gmock_cook_book.html#using-actions)
- [gMock for Dummies - Actions](https://google.github.io/googletest/gmock_for_dummies.html#actions-what-should-it-do)
- [API Reference - Actions](https://google.github.io/googletest/reference/gmock_gmock-actions.html)
- [Matchers Reference](https://google.github.io/googletest/reference/gmock_matchers.html)
- Guides on [Expectations and Mocking](https://google.github.io/googletest/gmock_cook_book.html#mocking-and-setting-expectations)

---

This documentation page fits within the GoogleMock API Reference as the definitive source for all built-in and custom action APIs controlling mock method behavior during tests. Use it as your reference when designing, composing, or debugging mock actions.
