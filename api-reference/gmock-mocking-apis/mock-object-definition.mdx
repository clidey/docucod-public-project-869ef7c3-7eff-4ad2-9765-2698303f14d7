---
title: "Mock Object Definition"
description: "Key macros and classes for declaring and instrumenting mock classes and methods. Walks through the syntax, main attributes, and underlying mechanisms (e.g., MOCK_METHOD) enabling seamless creation of mocks that integrate with the GoogleMock engine."
---

# Mock Object Definition

Mock Object Definition introduces the core macros and classes used to declare and instrument mock classes and methods in GoogleMock. This page walks you through the syntax and key attributes of mock declaration, focusing primarily on the `MOCK_METHOD` macro that seamlessly integrates mock methods with the GoogleMock engine.

---

## Overview of Mock Object Definition

Mock objects simulate the behavior of real objects by defining mock classes with methods that track interactions and respond as specified in tests. The `MOCK_METHOD` macro is the fundamental tool for instrumenting mock methods within such classes. It transforms ordinary method declarations into mock methods that can expect calls, validate arguments, and execute mock behaviors.

### Defining a Mock Class

To define a mock class, follow this simple pattern:

- Derive your mock class from the original interface or base class.
- In the `public:` section, declare mock methods using the `MOCK_METHOD` macro.

#### Syntax of MOCK_METHOD

```cpp
class MyMockClass {
public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (qualifiers));
};
```

- **ReturnType**: The return type of the method.
- **MethodName**: The name of the method you want to mock.
- **Args...**: Parenthesized argument list. If any argument or return type contains commas (e.g., in templated types), enclose the entire type in extra parentheses or define a type alias to avoid preprocessing errors.
- **qualifiers (optional)**: A list of method qualifiers such as `(const, override)`, `(noexcept)`, `Calltype(...)`, or reference qualifiers like `ref(&)`.

#### Examples

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));

  // Handling complex types:
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());

  // Qualifiers:
  MOCK_METHOD(void, Foo, (int x), (const, noexcept, override));
};
```

> **Tip:** Always place `MOCK_METHOD` declarations in the public section, even if mocking methods originally declared as protected or private. This allows the mocking framework to access these methods externally via `ON_CALL` and `EXPECT_CALL`.

---

## Handling Arguments with Commas

Since the macro parser treats commas specially, argument types containing unprotected commas will cause compilation errors.

### Solutions:

- **Wrap types containing commas in an extra pair of parentheses:**

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

- **Use type aliases:**

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());

using MapIntDouble = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

---

## Mocking Virtual Methods

`MOCK_METHOD` is designed to mock virtual methods by overriding them in the mock class. Always:

- Add `override` in the qualifiers whenever overriding a virtual method.
- Add `const` qualification if the original method is const.
- Match other qualifiers such as `noexcept` or calling conventions when needed.

```cpp
MOCK_METHOD(int, Add, (int value), (const, override));
```

---

## Mocking Overloaded Methods

Mocking overloaded methods is straightforward. Provide separate `MOCK_METHOD` declarations for each overload, specifying parameters and qualifiers explicitly.

If you do not mock all overloads, the compiler will warn about hidden methods. To fix this, you can bring base class overloads into scope:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Bring other overloads into scope
  MOCK_METHOD(int, Add, (int value), (override));
};
```

---

## Mocking Class Templates

Mock generic class templates as you would normal classes, with templated mock classes:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& elem), (override));
};
```

---

## Mocking Non-Virtual Methods

Although mocking non-virtual methods directly is not possible via typical virtual method overriding, GoogleMock supports mocking non-virtual methods by defining mock classes unrelated to the real class but having methods with identical signatures.

In such cases, use template parameters or compile-time polymorphism to switch implementations.

```cpp
class MockPacketStream {
 public:
  MOCK_METHOD(void, AppendPacket, (Packet* new_packet));
  MOCK_METHOD(const Packet*, GetPacket, (size_t index), (const));
};

template <typename PacketStream>
void UseStream(PacketStream* stream) { ... }

UseStream<MockPacketStream>(&mock_stream);
```

---

## Mocking Private or Protected Methods

Put `MOCK_METHOD` declarations in the `public:` section regardless of the original access specifiers. This is allowed and required for proper mocking through `ON_CALL` and `EXPECT_CALL`.

Example:

```cpp
class Foo {
 protected:
  virtual void Resume();
 private:
  virtual int GetTimeout();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Resume, (), (override));
  MOCK_METHOD(int, GetTimeout, (), (override));
};
```

---

## Old-Style MOCK_METHODn Macros

GoogleMock previously used a family of macros like `MOCK_METHOD1`, `MOCK_CONST_METHOD2`, etc., now deprecated in favor of the generic `MOCK_METHOD`. For new code, always prefer `MOCK_METHOD`.

---

## Mock Types: NiceMock, StrictMock, NaggyMock

GoogleMock supports controlling mock behavior when uninteresting calls occur:

- **NaggyMock** (default): Warns on unexpected calls but allows them.
- **NiceMock**: Suppresses warnings on uninteresting calls.
- **StrictMock**: Treats uninteresting calls as test failures.

Example usage:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock_foo;
StrictMock<MockFoo> strict_mock_foo;
```

Use these wrappers to adjust warning behavior according to your testing needs.

---

## Best Practices

- Set expectations before exercising the mock object.
- Use `ON_CALL` for default behavior without introducing expectations.
- Use `EXPECT_CALL` only when you want to verify that a call happens.
- Avoid excessive use of `StrictMock` as it can make tests brittle.
- Use type aliases to handle complex template types in mock methods.

---

## Summary

This page equips you to create mock classes and methods efficiently with `MOCK_METHOD`. Using the macro correctly enables you to emulate real class interfaces, set detailed expectations, and control mock method behavior seamlessly integrated with GoogleMock's verification engine.

For a productive mocking workflow, apply these concepts, and use the links below to extend your understanding with related reference and how-to guides.

---

## Related Documentation & Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical recipes for mocking
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for mocking syntax
- [Mocking and Setting Expectations](../guides/core-testing-workflows/mocking-and-expectations) — Detailed guide on writing mock expectations
- [Matchers Reference](../api-reference/gmock-mocking-apis/matchers) — Matchers for argument validation
- [Actions Reference](../api-reference/gmock-mocking-apis/actions) — How to specify mock method behavior
- [Mock Strictness Policies](../api-reference/gmock-mocking-apis/strictness-policies) — Control the strictness of mocks

---

## Code Example

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Usage in a test
#include <gtest/gtest.h>
using ::testing::AtLeast;
using ::testing::Return;

TEST(TurtleTest, MovesPenUp) {
  MockTurtle mock_turtle;

  EXPECT_CALL(mock_turtle, PenUp()).Times(AtLeast(1));
  ON_CALL(mock_turtle, GetX()).WillByDefault(Return(100));

  mock_turtle.PenUp();
  EXPECT_EQ(mock_turtle.GetX(), 100);
}
```

This simple example demonstrates defining mock methods and setting expectations and default behavior.

---

## Troubleshooting

- **Compilation errors with commas in types?** Use parentheses or typedef aliases around templated types.
- **Missing `override` qualifier warnings?** Add `(override)` to `MOCK_METHOD` qualifiers.
- **Uninteresting call warnings?** Use `NiceMock` or add explicit `EXPECT_CALL` with `Times(AnyNumber())`.
- **Ambiguous overloaded methods?** Specify all overloads you want to mock or use `using BaseClass::Method` to bring unmocked overloads into scope.

---

## Additional Tips

- Move large mock classes' constructor and destructor definitions out of the header into `.cc` files to improve compilation speed.
- Treat mocking concrete classes cautiously; prefer mocking interfaces where possible.
- Consider delegating calls from mocks to fake or real objects to combine default behavior with verification.

---

## Mermaid Diagram: Mock Object Interaction Overview

```mermaid
classDiagram
  class MockClass {
    +MOCK_METHOD(...) : void
    +EXPECT_CALL(...)
    +ON_CALL(...)
  }

  MockClass --> "1..*" ::testing::Expectation : creates
  MockClass --> ::testing::NiceMock : may be wrapped in
  MockClass --> ::testing::StrictMock : may be wrapped in
  ::testing::Expectation --> ::testing::Sequence : can belong to
  ::testing::Expectation --> ::testing::Action : defines behavior
```

This diagram summarizes the relationships between mock classes, expectations, sequences, and actions in GoogleMock.
