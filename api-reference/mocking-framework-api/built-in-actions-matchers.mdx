---
title: "Built-in Actions and Matchers"
description: "An alphabetical reference to the built-in actions (Invoke, Return, etc.) and matchers offered by GoogleMock. Also explains how to compose and extend these, and when to use more advanced or custom alternatives."
---

# Built-in Actions and Matchers

An alphabetical reference to the built-in actions (Invoke, Return, etc.) and matchers offered by GoogleMock. This page also explains how to compose and extend these, and when to use more advanced or custom alternatives.

---

## Overview

When writing unit tests using GoogleMock, **actions** specify what a mocked method should do when invoked, and **matchers** help you define what arguments you expect when those methods are called. This documentation serves as a quick reference for the built-in actions and matchers available in the `::testing` namespace.

GoogleMock provides you with a powerful toolkit to define precise behaviors for mocks and verify their interactions clearly, helping you write robust, clear, and maintainable tests.

## Built-in Actions

Actions define the behavior of mock methods when they're called. You can specify return values, side effects, or invoke callbacks with arguments.

| Action                       | Description                                                                                                                                                                                                                                                                                      |
|-----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Return()`                  | Returns from a `void` mock function. Useful to explicitly define return with no value.                                                                                                                                                                                                           |
| `Return(value)`             | Returns the specified `value`. If the `value` type differs from the mock function return type, it is converted at expectation setup time, not at execution time.                                                                                                                                |
| `ReturnArg<N>()`            | Returns the `N`-th (0-based) argument passed to the mock method. Useful for forwarding input to output.                                                                                                                                                                                         |
| `ReturnNew<T>(a1, ..., ak)` | Returns a newly created object allocated with `new T(a1, ..., ak)` each time the action is executed. Ownership is assumed by the caller.                                                                                                                                                       |
| `ReturnNull()`              | Returns a null pointer.                                                                                                                                                                                                                                                                          |
| `ReturnPointee(ptr)`        | Returns the value pointed to by `ptr`. Handy when the data pointed to by the pointer may change over time.                                                                                                                                                                                       |
| `ReturnRef(variable)`       | Returns a reference to `variable`. This can be used with functions returning references.                                                                                                                                                                                                       |
| `ReturnRefOfCopy(value)`    | Returns a reference to a copy of `value`. The copy lasts as long as the action object. Useful to return a stable reference without unexpected modifications.                                                                                                                                   |
| `ReturnRoundRobin({a1,...})`| Cycles through and returns elements from the list `{a1, ..., ak}` on each call, wrapping to the start when the end is reached.                                                                                                                                                                  |

### Side Effect Actions

| Action                        | Description                                                                                                                                                             |
|------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Assign(&variable, value)`    | Assigns `value` to `variable`. Useful for modifying external state during a mock call.                                                                                   |
| `DeleteArg<N>()`              | Deletes (calls `delete` on) the `N`-th (0-based) argument, which must be a pointer. Useful for ownership transfer scenarios.                                           |
| `SaveArg<N>(pointer)`         | Saves a copy of the `N`-th argument to `*pointer`. Helpful when you want to capture arguments for later assertions.                                                   |
| `SaveArgByMove<N>(pointer)`   | Moves the `N`-th argument into `*pointer`. Useful for move-only types.                                                                                                  |
| `SaveArgPointee<N>(pointer)` | Saves the value pointed to by the `N`-th argument into `*pointer`. Use for pointers when you want the pointed-to data, not the pointer itself.                        |
| `SetArgReferee<N>(value)`    | Assigns `value` to the variable referenced by the `N`-th argument. Good for modifying output parameters passed by reference.                                          |
| `SetArgPointee<N>(value)`    | Assigns `value` to the variable pointed to by the `N`-th argument pointer. Ideal for output arguments passed by pointer.                                             |
| `SetArrayArgument<N>(first, last)` | Copies elements from `[first, last)` into an array or iterator pointed to by the `N`-th argument. Useful for outputting arrays or sequences.                    |
| `SetErrnoAndReturn(error, value)` | Sets the `errno` to `error` and returns `value`. Helpful to simulate system call error conditions.                                                               |
| `Throw(exception)`            | Throws the provided exception. Useful for testing exception handling paths. Supported when exceptions are enabled.                                                    |

### Action Composition

GoogleMock supports composing actions for complex behaviors.

- `DoAll(a1, a2, ..., an)`: Performs actions `a1` through `an` sequentially. All but the last must return void. The return value of `an` is used as return value.
- `IgnoreResult(a)`: Performs action `a` and ignores its return value. Turns return value to `void`.
- `WithArg<N>(a)`: Passes mock function’s `N`-th argument to action `a`.
- `WithArgs<N1,N2,...>(a)`: Passes selected arguments to action `a`.
- `WithoutArgs(a)`: Calls action `a` without any arguments.

---

## Using Functions, Functors, and Lambdas as Actions

You can use any callable type as an action:

```cpp
EXPECT_CALL(mock, Foo(_)).WillOnce(Invoke(&MyFunction));
EXPECT_CALL(mock, Bar(_)).WillOnce(Invoke(&my_object, &MyClass::Method));
EXPECT_CALL(mock, Baz(_)).WillOnce([](int x) { return x * 2; });
```

Additionally:

- `InvokeWithoutArgs(f)` calls `f` with no arguments.
- `InvokeArgument<N>(args...)` calls the mock function’s `N`-th argument (which must be a callable) with given arguments.

When arguments should be passed by reference to a callable, wrap them using `std::ref()` to avoid copying.

---

## Built-in Matchers

Matchers specify what argument values are expected when a mock method is called. The special matcher `_` (underscore) matches any argument.

| Matcher           | Description                                                                                                          |
|-------------------|----------------------------------------------------------------------------------------------------------------------|
| `_`               | Wildcard matcher. Matches any value.                                                                                 |
| `Eq(value)`       | Matches values equal to `value` using `operator==`.                                                                 |
| `Ne(value)`       | Matches values not equal to `value`.                                                                                  |
| `Gt(value)`       | Matches values greater than `value`.                                                                                  |
| `Ge(value)`       | Matches values greater than or equal to `value`.                                                                      |
| `Lt(value)`       | Matches values less than `value`.                                                                                     |
| `Le(value)`       | Matches values less than or equal to `value`.                                                                         |
| `Not(matcher)`    | Matches values that do not match `matcher`.                                                                           |
| `AllOf(...)`      | Matches values that satisfy **all** of the supplied matchers (logical AND).                                           |
| `AnyOf(...)`      | Matches values that satisfy **any** of the supplied matchers (logical OR).                                           |
| `Contains(value)` | Matches containers that contain an element equal to `value`.                                                         |
| `StartsWith(str)` | Matches strings starting with `str`.                                                                                  |
| `HasSubstr(str)`  | Matches strings containing `str` as a substring.                                                                      |
| `IsNull()`        | Matches null pointers or null smart pointers.                                                                         |
| `NotNull()`       | Matches non-null pointers or smart pointers.                                                                           |
| `Pointee(m)`      | Matches pointers (raw or smart) whose pointed-to value matches matcher `m`.                                          |
| `Field(&Class::member, m)` | Matches objects whose `member` matches matcher `m`.                                                               |
| `Property(&Class::method, m)` | Matches objects whose `method()` return value matches `m`.                                                      |
| `Truly(predicate)`| Matches values for which the unary predicate returns true. Useful for arbitrary custom matching.                     |
| `ElementsAre(...)`| Matches containers whose elements match a sequence of matchers.                                                     |
| `UnorderedElementsAre(...)` | Matches containers whose elements match matchers in any order.                                                  |

### Combining and Composing Matchers

Complex conditions can be expressed by composing matchers with:

- `AllOf(m1, m2, ...)` — all must match.
- `AnyOf(m1, m2, ...)` — any must match.
- `Not(m)` — negation.

You can also match multiple arguments as a whole using `.With()` clauses and tuple matchers.

---

## Extending and Customizing Actions and Matchers

If built-in actions and matchers don't meet your needs, GoogleMock allows you to create custom ones:

- **Custom Matchers:** Quickly create matchers with macros like `MATCHER()` or for parameterized matchers use `MATCHER_P()`. For advanced use, implement matcher interfaces directly.

- **Custom Actions:** Define actions using lambdas, functors, or the `ACTION` family of macros. For more control, implement `ActionInterface` or use `MakePolymorphicAction` to make versatile actions.

---

## When to Use Built-in vs Custom

- Use built-in **actions and matchers** for most cases: they cover common patterns like returning values, forwarding arguments, setting output arguments, throwing exceptions, and matching standard argument predicates.

- Compose multiple built-in actions with `DoAll()` or argument selectors (`WithArg`, `WithArgs`) for complex behaviors without writing new code.

- When behavior or matching logic is unique or complex, write your custom actions or matchers, ensuring clarity and maintainability.

---

## Practical Tips

- **Default Actions:** If you don't specify an action, GoogleMock uses suitable default returns (like 0, false, or default-constructed values).

- **Order of Actions:** When multiple `WillOnce` actions are specified, they are executed in order of declaration; after exhaustion, `WillRepeatedly` applies.

- **Reference Returns:** Use `ReturnRef()` to return references safely.

- **Pointer Output Arguments:** Use `SetArgPointee<N>(value)` to set out parameters.

- **Avoid Side Effects in Matchers:** Matchers must be pure functions with no side effects.

- **Suppress Uninteresting Call Warnings:** Use `NiceMock` to silence warnings about calls with no expectations.

- **Dealing With Overloads:** Use explicit casting and `Const()` wrapper to disambiguate overloaded methods.

---

## Example: Using Actions and Matchers

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::_;
using ::testing::Gt;
using ::testing::DoAll;
using ::testing::SetArgPointee;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (int x, int* y), ());
};

TEST(FooTest, Example) {
  MockFoo foo;

  // Expect Bar to be called with first arg > 5 and set *y to 10.
  EXPECT_CALL(foo, Bar(Gt(5), _))
      .WillOnce(DoAll(SetArgPointee<1>(10), Return(42)));

  int output = 0;
  int result = foo.Bar(7, &output);
  EXPECT_EQ(42, result);
  EXPECT_EQ(10, output);
}
```

---

## Troubleshooting

- **Uninteresting Call Warning:** Seen when a mock method is called without expectations. Use `NiceMock` or add an explicit `EXPECT_CALL` with `.Times(AnyNumber())` to suppress.

- **Overlapping Expectations:** More specific expectations must be declared after general ones, as GoogleMock selects the last matching expectation.

- **Actions Exhausted Warning:** Specify `WillRepeatedly()` for actions to cover calls beyond the number of `WillOnce()` clauses.

- **Unexpected Call Failures:** Verify that argument matchers cover all possible call scenarios.

---

## Further Reading and References

- [gMock Cookbook](gmock_cook_book.md) — Practical recipes and usage examples
- [Actions Reference](reference/actions.md) — Detailed list of built-in actions
- [Matchers Reference](reference/matchers.md) — Complete list of matchers
- [Mocking Reference](reference/mocking.md) — Understanding mocks, expectations, and spec builders

---

## Source Links

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/actions.md", "range": "1-100"},{"path": "docs/reference/mocking.md", "range": "1-120"}]} />

---