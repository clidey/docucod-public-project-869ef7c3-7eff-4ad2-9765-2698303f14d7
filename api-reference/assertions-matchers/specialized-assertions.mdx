---
title: "Death Tests and Special Assertions"
description: "Reference for death-test macros to verify abnormal program termination and handling of hard errors, enabling robust error-path testing. Covers both platform-specific and cross-platform support details."
---

# Death Tests and Special Assertions

This reference page provides comprehensive information on GoogleTest's death-test macros designed to validate abnormal program termination and handling of hard errors. It enables users to write robust error-path tests by verifying that their code terminates as expected under fatal conditions. Coverage includes key macros, platform-specific considerations, cross-platform support details, usage patterns, and best practices for writing death tests.

---

## 1. Overview of Death Tests

Death tests allow you to write assertions that verify whether a piece of code causes your program to terminate unexpectedly. This includes aborts, crashes, calls to `exit()`, or signals that lead to process termination.

The primary motivation is ensuring that code enforcing critical invariants or preconditions terminates the program when those conditions are violated, preventing operations on corrupted or invalid state.

Death tests are crucial because such abnormal terminations cannot be tested with normal assertions since code after termination is never reached.


### Why Use Death Tests?

- **Verify assertions and fail-fast behavior:** Confirm that your code triggers fatal checks on invalid inputs.
- **Validate error handling paths:** Check that error conditions lead to termination when appropriate.
- **Improve robustness:** Detect unhandled conditions that should abort program execution.


## 2. Death Test Macros

GoogleTest provides several macros for death tests, each designed to suit different testing scenarios.

| Macro                    | Description                                                      |
|--------------------------|----------------------------------------------------------------|
| `EXPECT_DEATH(statement, matcher)` | Tests that `statement` causes the process to die with output matching `matcher`. |
| `ASSERT_DEATH(statement, matcher)` | Same as `EXPECT_DEATH` but aborts the test on failure.
| `EXPECT_DEATH_IF_SUPPORTED(statement, matcher)` | Like `EXPECT_DEATH` but safely skips test if death tests unavailable.
| `ASSERT_DEATH_IF_SUPPORTED(statement, matcher)` | Like `ASSERT_DEATH` with the support fallback.
| `EXPECT_DEBUG_DEATH(statement, matcher)` | Expects death only in debug mode; does nothing in release.
| `ASSERT_DEBUG_DEATH(statement, matcher)` | Assert version of debug death test.
| `EXPECT_EXIT(statement, predicate, matcher)` | Verifies the process exits with a status satisfying `predicate` and output matching `matcher`.
| `ASSERT_EXIT(statement, predicate, matcher)` | Assert version of exit test.


## 3. How to Use Death Tests

Writing a death test involves wrapping a statement inside the death macro and providing a matcher to check the error output.

Example: Verify division by zero causes program termination with the right error message.

```cpp
TEST(MathDeathTest, DivisionByZero) {
  EXPECT_DEATH(
      { int x = 1 / 0; },
      "\bdivision by zero\b");  // Regex matched on stderr
}
```


### Important Notes

- The code inside `EXPECT_DEATH` runs in a separate subprocess, so side effects are not visible to the parent test.
- Use regular expressions in the matcher to flexibly match error output.
- The statement can be a compound block, as shown above.


## 4. Death Test Styles and Platform Details

GoogleTest supports two main death test styles:

| Style       | Description                                                                                                      |
|-------------|------------------------------------------------------------------------------------------------------------------|
| **fast**    | On POSIX: uses `fork()` to create a child process to run the test code that must die. Fast but not thread-safe. |
| **threadsafe** | On POSIX and Windows: runs the death test in a subprocess re-executing the test binary with flags to run only the death test. Safer for multithreaded tests but slower. |


By default, the style is `fast`. You can set via

```cpp
GTEST_FLAG_SET(death_test_style, "threadsafe");
```

or on the command line with `--gtest_death_test_style=threadsafe`.


### Platform Support

- On POSIX (Linux, macOS, Cygwin), `fork()` or `clone()` are used.
- On Windows, `CreateProcess()` is used along with command line re-execution.
- Not all platforms support death tests; use `EXPECT_DEATH_IF_SUPPORTED` to write portable tests.


## 5. Best Practices for Writing Death Tests

- Test what *must* cause termination, not incidental failures.
- Match output string errors with regular expressions to account for minor variations.
- Keep death tests isolated to avoid interference with threading or resource management.
- Use the naming convention of test suites ending with "DeathTest" to help GoogleTest order tests safely.


## 6. Common Pitfalls and Troubleshooting

- **Mock Objects & Death Tests:** Objects owned by the code under test may leak if the process dies; suppress error reports using `Mock::AllowLeak(mock_obj);`.

- **Multiple Death Assertions on a Line:** Avoid multiple death macros on the same line, as they can cause compilation errors.

- **Non-Terminating Death Tests:** If your test seems to hang, it may be because the code never terminates or deadlocks in the subprocess.

- **Use of Assertions Inside Death Statements:** Be cautious using `ASSERT_*` inside death statements; if they do not abort, the death test may fail silently.


## 7. Step-by-Step Work Flow to Implement a Death Test

<Steps>
<Step title="Identify code that should cause abnormal termination">
Locate code paths that have assert statements, calls to `abort()`, or invalid operations expected to kill the program.
</Step>
<Step title="Write a test using EXPECT_DEATH or ASSERT_DEATH">
Wrap the code triggering termination in a death test macro, specifying a matching pattern for the error output.
</Step>
<Step title="Run tests to verify behavior">
Run your test binary with `--gtest_death_test_style=fast` (default) or `threadsafe` for robustness.
</Step>
<Step title="Adjust matchers for robustness">
Refine your output matcher expression for stable matching (avoid matching volatile data like addresses or line numbers if not essential).
</Step>
<Step title="Handle platform differences">
If targeting multiple platforms, use `EXPECT_DEATH_IF_SUPPORTED` to safely run tests where death tests are available.
</Step>
</Steps>

## 8. Related Macros and Special Assertions

GoogleTest also provides specialized assertions for testing error conditions and program state:

- **EXPECT_THROW / ASSERT_THROW:** Verify code throws C++ exceptions.
- **EXPECT_EXIT / ASSERT_EXIT:** Check for program termination with specific exit code and message.
- **EXPECT_DEBUG_DEATH:** Run death test only in debug builds.

Refer to the [Assertions Reference - Death Assertions](reference/assertions.md#death) for detailed usage.


## 9. Code Example of a Death Test

```cpp
#include <gtest/gtest.h>

void CrashIfNegative(int x) {
  if (x < 0) {
    fprintf(stderr, "Fatal error: negative input\n");
    abort();
  }
}

TEST(MyDeathTest, CrashOnNegativeInput) {
  EXPECT_DEATH(CrashIfNegative(-1), "Fatal error: negative input");
  // This call should not crash.
  CrashIfNegative(1);
}
```


## 10. Further Tips

- Use **multi-line statements** inside death tests for clarity.
- Avoid non-trivial side effects inside death tests since child process termination discards them.
- For asynchronous or multithreaded code, prefer `threadsafe` style or isolate death tests to avoid deadlocks.


## 11. How Death Tests Integrate into GoogleTest

Death tests run the tested code inside a subprocess to isolate the test failure and allow the main test binary to continue running other tests.

This subprocess is spawned differently depending on platform and style:

- POSIX `fork/clone` or
- Windows `CreateProcess` with re-execution of test binary and filtering to a single death test.

Failure to terminate or unexpected termination results in detailed failure messages.


## References

- [GoogleTest Death Assertions](../reference/assertions.md#death)
- [Advanced Topics - Death Tests](../docs/advanced.md#death-tests)
- [gMock Cookbook - Using Death Tests](../guides/writing-effective-tests/death-tests.md)
- [FAQ on Death Test Hangs](../docs/faq.md#My-death-test-hangs-or-seg-faults-How-do-I-fix-it)


## Cross-References in Documentation

- For how to mock methods that may trigger death, refer to [Mocking Framework API](../api-reference/mocking-framework/setting-expectations.md).
- For controlling verbosity during death tests and assertions, see [Assertions and Test Results](../api-reference/core-testing/test-results-and-reporting.md).
- Building your first test with death tests: [Writing Your First Test Guide](../guides/getting-started/writing-your-first-test.md).
- Advanced test writing techniques with death tests: [Writing Effective Tests](../guides/writing-effective-tests/death-tests.md).


---

<CardGroup cols={2}>
<Card title="Example Death Test">
```cpp
TEST(MyDeathTest, CrashesOnNullPointer) {
  EXPECT_DEATH(
      {
        int* ptr = nullptr;
        *ptr = 42;
      },
      "segmentation fault|access violation");
}
```
</Card>
<Card title="Death Test Command Line">
To run death tests in threadsafe mode:

```shell
./my_test_binary --gtest_death_test_style=threadsafe
```
</Card>
</CardGroup>

---

## 12. Troubleshooting Common Death Test Issues

<Accordion title="Death Test Hangs or Segfaults">
If a death test appears to hang or segfault:

- Confirm the statement under test actually terminates on failure.
- Switch death test style from "fast" to "threadsafe" and observe behavior.
- Avoid interactions with non-thread-safe global resources inside death tests.
- When using mock objects inside death tests, remember to call `Mock::AllowLeak(mock_obj)` to prevent leak detector failures.
</Accordion>

<Accordion title="Matcher Not Matching Expected Output">

- Use a relaxed regular expression avoiding volatile details like addresses.
- Check if stderr is actually capturing the error output (some platforms may differ).
- Try simpler regexps and iterate.
</Accordion>

<Accordion title="Compilation Issues with Death Tests">

- Check parentheses and statement blocks inside the death macro.
- Use compound statements if multiple lines.
- Avoid macros or code generating ambiguous syntax inside death macros.
</Accordion>


---

## 13. Summary

This page explained how to write and leverage death tests in GoogleTest, using macros like `EXPECT_DEATH`, `ASSERT_DEATH`, and `EXPECT_EXIT` to verify abnormal program termination conditions robustly and portably. We covered macro syntax, platform and style considerations, best practices, pitfalls, and troubleshooting tips.

Writing effective death tests ensures your program's critical fail-fast guarantees are upheld and error paths are tested thoroughly.


## 14. Source

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/advanced.md", "range": "476-578"},{"path": "reference/assertions.md", "range": "418-499"}]}/>
