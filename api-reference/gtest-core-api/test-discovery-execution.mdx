---
title: "Test Discovery & Execution"
description: "Guides users through defining test cases and suites, auto-discovery of tests, and executing them via the default main entry point. Illustrates configuring and controlling test execution flow, including parallel and selective runs, with usage examples."
---

# Test Discovery & Execution

This guide walks you through defining test cases and suites in GoogleTest, the automatic discovery of tests across your codebase, and executing them using the default main entry point. It demonstrates ways to configure and control test execution flow, including selective test runs and parallel execution, with practical usage examples that empower you to master your test lifecycle.

---

## 1. Overview of Test Discovery

GoogleTest automatically discovers all tests defined via the TEST() and TEST_F() macros in your compiled test binaries. There is no need to register tests manually. When you run the test binary, GoogleTest enumerates all available tests and executes them according to your configuration.

### Key Points:
- Tests are organized into *test suites* (formerly "test cases").
- Each test case belongs to exactly one test suite.
- GoogleTest identifies test suites and tests through the TEST and TEST_F macros.
- Test discovery works out of the box with the default main() function generated by `gtest_main`.

### Example:

```cpp
TEST(MathTest, CanAdd) {
  EXPECT_EQ(2 + 2, 4);
}

TEST_F(NetworkTest, HandlesTimeout) {
  SetUpConnection();
  EXPECT_TRUE(WaitForResponseWithTimeout());
}
```

Both `MathTest.CanAdd` and `NetworkTest.HandlesTimeout` are automatically discovered.

## 2. Defining Tests

### 2.1 Simple Tests: `TEST`

The `TEST` macro defines a test within a named test suite.

Syntax:

```cpp
TEST(TestSuiteName, TestName) {
  // Test code here
}
```

Each test is an isolated function run by the framework.

### 2.2 Fixture-Based Tests: `TEST_F`

Use `TEST_F` when your tests need shared setup and teardown via C++ fixture classes.

Example:

```cpp
class DatabaseTest : public ::testing::Test {
 protected:
  void SetUp() override {
    // Setup code
  }
  void TearDown() override {
    // Teardown code
  }
};

TEST_F(DatabaseTest, InsertsRecord) {
  ASSERT_TRUE(InsertRecord());
}
```

### 2.3 Parameterized Tests

GoogleTest supports both value-parameterized and type-parameterized tests for running the same test logic with multiple inputs. See the [Value and Type Parameterized Tests](../api-reference/gtest-core-api/test-parameterization) page for details.

## 3. Running Tests

With the default test binary entry point (using `gtest_main`), simply executing the test binary will:

- Discover all tests automatically.
- Run all tests.
- Output test results.

### Command Line Invocation

```bash
./my_test_binary
```

### Output Example

```
[==========] Running 3 tests from 2 test suites.
[----------] Global test environment set-up.
[----------] 2 tests from MathTest
[ RUN      ] MathTest.CanAdd
[       OK ] MathTest.CanAdd (0 ms)
[ RUN      ] MathTest.CanSubtract
[       OK ] MathTest.CanSubtract (0 ms)
[----------] 2 tests from MathTest (0 ms total)
[----------] 1 test from NetworkTest
[ RUN      ] NetworkTest.HandlesTimeout
[       OK ] NetworkTest.HandlesTimeout (5 ms)
[----------] 1 test from NetworkTest (5 ms total)
[----------] Global test environment tear-down
[==========] 3 tests from 2 test suites ran. (5 ms total)
[  PASSED  ] 3 tests.
```

## 4. Selective Test Execution

You may want to run only specific tests or test suites. GoogleTest supports filtering:

### 4.1 Using `--gtest_filter`

```bash
./my_test_binary --gtest_filter=MathTest.*
```

Runs all tests in the `MathTest` suite.

```bash
./my_test_binary --gtest_filter=MathTest.CanAdd
```

Runs only the single test `MathTest.CanAdd`.

Wildcards and negative patterns are supported. For instance:

```bash
./my_test_binary --gtest_filter=-NetworkTest.*
```

Runs all tests except those in `NetworkTest`.

### 4.2 Running Tests in Batches

You can combine `--gtest_filter` with other flags to run batches of tests to parallelize execution, especially useful in CI environments.

## 5. Parallel and Repeated Execution

GoogleTest supports additional command-line flags for controlling execution:

- `--gtest_repeat=N` : Run all tests N times.
- `--gtest_shuffle` : Run tests in a random order to detect inter-test dependencies.
- `--gtest_repeat=-1` : Run tests indefinitely.

For multi-threaded parallel test execution, integration with build tools or frameworks is required. This guide focuses on the basic flow.

## 6. Custom Main Function

If you choose not to use `gtest_main`, you must provide a main function which calls:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This function initializes GoogleTest and runs all discovered tests.

## 7. Control Test Flow Programmatically

GoogleTest offers API functions to control test execution within the code:

- `InitGoogleTest(&argc, argv)` : Initializes the framework.
- `RUN_ALL_TESTS()` : Runs all tests discovered.
- `UnitTest::GetInstance()->listeners()` : For adding custom test listeners.

This is advanced use; typical users rely on command-line flags.

## 8. Diagnosing Test Failures and Output

GoogleTest outputs detailed failure messages, including:
- Location of the failing assertion
- Expected vs. actual values
- Stack traces (if configured)

If tests fail unexpectedly, consider running with verbose flags:

```bash
./my_test_binary --gtest_verbose=info
```

This outputs detailed traces of test discovery and run sequences to help diagnose failures.

## 9. Integration With GoogleMock

Tests that use GoogleMock (gMock) for mocking support follow the same test execution flow as above. In such tests, mock expectations are verified at the end of each test case or at mock destruction time.

## 10. Practical Example

```cpp
#include <gtest/gtest.h>

// Simple math test suite
TEST(MathTest, Add) {
  EXPECT_EQ(1 + 1, 2);
}

// Test fixture
class DatabaseTest : public testing::Test {
 protected:
  void SetUp() override {
    // Setup DB connection
  }
  void TearDown() override {
    // Cleanup
  }
};

TEST_F(DatabaseTest, Insert) {
  ASSERT_TRUE(true);  // Simulate success
}

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Run the compiled test binary to auto-discover and execute the tests.

---

## Troubleshooting

### Common Issues

- **Tests not running:** Ensure that tests have correct macro definitions `TEST` or `TEST_F`, and the test binary links against GoogleTest properly.
- **‘No tests found’ error:** Check that tests are defined in compilation units linked into the test binary.
- **Unexpected test failures:** Use `--gtest_filter` and `--gtest_verbose=info` to isolate problems.

### Tips

- Always define tests before running them - GoogleTest discovers tests at runtime from the compiled binary.
- Avoid side effects or dependencies across tests by properly isolating tests.

---

## References

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) - an introduction to GoogleTest and its core features.
- [Writing Your First Test](https://github.com/google/googletest/blob/main/docs/writing_tests.md) - step-by-step guide.
- [Running Tests](https://github.com/google/googletest/blob/main/docs/running_tests.md) - controlling test execution flow.
- [Test Parameterization](../api-reference/gtest-core-api/test-parameterization) - advanced test setups.
- Related guides on mocks and test integration in the documentation.

---

## Mermaid Flowchart of Test Discovery and Execution Flow

```mermaid
flowchart TD
  Start([Start Test Binary]) --> Init[InitGoogleTest()] 
  Init --> Discover[Test Discovery]
  Discover --> Decide{Run All Tests?}
  Decide -->|Yes| RunAll[Run All Tests]
  Decide -->|No| Filter[Apply --gtest_filter]
  Filter --> RunFiltered[Run Filtered Tests]
  RunAll --> Report[Report Results]
  RunFiltered --> Report
  Report --> End([Exit with Status])
```
