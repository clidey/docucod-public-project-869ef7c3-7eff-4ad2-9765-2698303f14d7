---
title: "Defining Mock Methods (MOCK_METHOD & Macros)"
description: "Learn how to declare mock methods in your C++ mock classes using the core MOCK_METHOD macro and its variants, supporting different constness, noexcept, override, and argument signatures. This page explains macro syntax, usage patterns, type requirements, and signature validation for robust mock construction."
---

# Defining Mock Methods (MOCK_METHOD & Macros)

Learn how to declare mock methods in your C++ mock classes using the core `MOCK_METHOD` macro and its variants, supporting different constness, noexcept, override, and argument signatures. This page explains macro syntax, usage patterns, type requirements, and signature validation to help you build robust mocks.

---

## Overview of MOCK_METHOD

`MOCK_METHOD` is the fundamental macro that generates mock methods inside your mock classes. It simplifies mocking virtual, overloaded, const, noexcept, and ref-qualified member functions by automatically generating both declarations and definitions.

### Basic Syntax

```cpp
MOCK_METHOD(return_type, method_name, (args...), (optional_specifiers));
```

- **`return_type`**: The method's return type. If the return type contains commas (e.g., `std::pair<int, int>`), parenthesize it.
- **`method_name`**: Name of the method you want to mock.
- **`(args...)`**: The argument list, enclosed in parentheses.
- **`(optional_specifiers)`**: An optional parenthesized list of qualifiers affecting the mocked method.


### Example: Simple Mock Method

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

In the above, `PenUp()` and `Forward(int)` are non-const, while `GetX()` is a const method.

---

## Qualifiers and Specifiers

You can supply a comma-separated list of method qualifiers in the optional fourth parameter. These control the constness, exception specification, override, calling convention, and reference qualifiers of the mock method.

| Qualifier                   | Description                              |
|-----------------------------|------------------------------------------|
| `const`                     | Marks the method as const-qualified. Required if overriding a const method. |
| `override`                  | Marks the method as overriding a virtual method. Recommended for safety. |
| `noexcept`                  | Marks the method as `noexcept`. Required if overriding a noexcept method. |
| `Calltype(calltype)`        | Specifies calling convention, e.g., `Calltype(STDMETHODCALLTYPE)` on Windows.| 
| `ref(&)` or `ref(&&)`       | Specifies lvalue or rvalue reference qualifiers for methods.

### Example: Const, Override and Noexcept

```cpp
MOCK_METHOD(int, GetValue, (), (const, override, noexcept));
```

---

## Handling Comma-Containing Types

Return types or argument types with unprotected commas cause parsing issues because the macro parameters are separated at commas. To fix this:

### Wrap the type in parentheses

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

### Or define a type alias

```cpp
using PairInt = std::pair<int, int>;
MOCK_METHOD(PairInt, GetPair, ());
```

Both solutions prevent macro parsing errors.

<Note>
When using parentheses around types, the macro removes them, so it remains valid C++.
</Note>

---

## Declaring Mock Methods in the Public Section

Always place `MOCK_METHOD` calls within the `public:` section of your mock class, even when mocking protected or private base class methods. This is necessary for `ON_CALL` and `EXPECT_CALL` to access the mock methods.

### Example: Mocking Private or Protected Methods

```cpp
class Base {
 protected:
  virtual void Resume();
 private:
  virtual int GetTimeout();
};

class MockDerived : public Base {
 public:
  MOCK_METHOD(void, Resume, (), (override));  // placed in public
  MOCK_METHOD(int, GetTimeout, (), (override));  // placed in public
};
```

---

## Mocking Overloaded Methods

You can mock overloaded methods by declaring each overload using `MOCK_METHOD` with their respective signatures and specifiers.

<Note>
If you do not mock all overloads, compiler warnings may occur due to hidden base methods. Use `using Base::MethodName;` to bring base overloads into scope.
</Note>

### Example: Overloaded Methods

```cpp
class Foo {
 public:
  virtual int Add(int x);
  virtual int Add(int times, int x);
  virtual const Bar& GetBar() const;
  virtual Bar& GetBar();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
};
```

---

## Mocking Class Templates

Mock class templates follow the same pattern as non-template classes. Declare the template parameters and use `MOCK_METHOD` inside the mock template.

### Example: Mocking Templates

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int GetSize() const = 0;
  virtual void Push(const T& x) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

---

## Mocking Non-Virtual Methods Using High-Perf Dependency Injection

Though traditional mocking requires virtual methods, you can mock non-virtual methods for high-performance scenarios. Your mock class will not inherit from the real class but implement similarly named methods mocked using `MOCK_METHOD` without the `override` specifier.

### Example

```cpp
class RealPacketStream {
 public:
  void AppendPacket(Packet* p);
  const Packet* GetPacket(size_t i) const;
  size_t GetPacketCount() const;
};

class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t i), (const));
  MOCK_METHOD(size_t, GetPacketCount, (), (const));
};
```

You use templates or compile-time polymorphism to switch between the real and mock implementations at compile time.

---

## Old-Style MOCK_METHODn Macros

Before `MOCK_METHOD` was introduced, GoogleMock offered a series of `MOCK_METHODn` and `MOCK_CONST_METHODn` macros, where `n` specified the number of arguments.

- The order of parameters was `MOCK_METHODn(MethodName, ReturnType(Args))`
- The `MOCK_METHOD` macro is recommended for new code because it is more consistent and flexible.

### Migration Table

| Old Macro                             | New Equivalent                                             |
|-------------------------------------|------------------------------------------------------------|
| `MOCK_METHOD1(Foo, bool(int))`      | `MOCK_METHOD(bool, Foo, (int))`                            |
| `MOCK_CONST_METHOD1(Foo, bool(int))`| `MOCK_METHOD(bool, Foo, (int), (const))`                   |
| `MOCK_METHOD1_T(Foo, bool(int))`    | `MOCK_METHOD(bool, Foo, (int))`                            |
| `MOCK_CONST_METHOD1_T(Foo, bool(int))`| `MOCK_METHOD(bool, Foo, (int), (const))`                 |
| With Call Type Suffix                | Use `Calltype()` qualifier in `MOCK_METHOD`'s specifier     |

### Example

```cpp
// Old macro
MOCK_METHOD1(Foo, bool(int));
// New macro
MOCK_METHOD(bool, Foo, (int));
```

---

## Ref-Qualified Methods

`MOCK_METHOD` supports mocking methods with ref qualifiers like `&` or `&&` by specifying `ref(&)` or `ref(&&)` in the macro specifiers.

### Example

```cpp
MOCK_METHOD(int, RefQualifiedOverloaded, (), (const, ref(&), override));
MOCK_METHOD(int, RefQualifiedOverloaded, (), (const, ref(&&), override));
MOCK_METHOD(int, RefQualifiedOverloaded, (), (ref(&), override));
MOCK_METHOD(int, RefQualifiedOverloaded, (), (ref(&&), override));
```

---

## Best Practices & Tips

- Use `MOCK_METHOD` in the public section of your mock class regardless of the visibility of the base method.
- Parenthesize return and argument types that contain commas.
- Add the `override` specifier when mocking virtual functions for correctness.
- Use `const` specifier for const methods.
- Use `noexcept` when overriding noexcept methods.
- For complex interfaces or large projects, consider placing mock classes in dedicated test or mocking directories.
- To simplify interface mocking, consider creating adapter methods or wrapper mocks with trimmed argument lists.

---

## Common Pitfalls

- Forgetting to parenthesize types with commas in `MOCK_METHOD` will result in compiler errors.
- Mock methods defined outside the public section will cause accessibility issues.
- Not marking mocked methods as `override` can potentially lead to subtle bugs.
- Mixing old-style `MOCK_METHODn` macros with `MOCK_METHOD` macros can cause confusion.

---

## Example: Comprehensive Mock Class

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int Compute(int x) const noexcept = 0;
  virtual void Process(std::string& data) = 0;
  virtual std::pair<int, bool> GetPair() = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Compute, (int x), (const, noexcept, override));

  // Note we parenthesize the return type due to comma.
  MOCK_METHOD((std::pair<int, bool>), GetPair, (), (override));

  MOCK_METHOD(void, Process, (std::string& data), (override));
};
```

This mock class handles const, noexcept, ref qualifiers, and comma-containing types correctly.

---

## Troubleshooting

- **Compilation errors related to commas:** Confirm you have properly parenthesized types with embedded commas or use type aliases.
- **Access errors on mock methods:** Ensure all `MOCK_METHOD` macros are declared in the public section of your mock class.
- **Overload resolution issues:** Use explicit casting or `using` declarations to make overloaded methods visible if some overloads are not mocked.
- **Const mismatch errors:** Match the constness in the specifier exactly with the base method.
- **Call type issues on Windows:** Use the `Calltype()` specifier to specify calling conventions.

For more, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [Mocking Reference](https://google.github.io/googletest/reference/mocking.html#MOCK_METHOD).

---

## See Also

- [`EXPECT_CALL` and `ON_CALL` Usage](../core-mocking-apis/expectations-on-call)
- [gMock Cookbook for Recipes and Patterns](../gmock_cook_book.md)
- [Matchers Reference](../matchers-and-actions/argument-matching)
- [Actions Reference](../matchers-and-actions/actions-for-mocks)

---

## Summary Diagram: Mock Method Declaration Flow

```mermaid
flowchart TD
  A[Start Mock Class Definition]
  A --> B[Declare MOCK_METHOD in public section]
  B --> C{Does the method have commas in return/args?}
  C -->|Yes| D[Parenthesize the comma-containing types or use typedef]
  C -->|No| E[Write method signature normally]
  D --> E
  E --> F{Are specifiers needed?}
  F -->|Yes| G[Add specifiers like (const, override, noexcept, Calltype, ref)]
  F -->|No| H[Omit specifiers]
  G --> I[Compile & verify mock]
  H --> I
  I --> J{Did compilation succeed?}
  J -->|Yes| K[Use MOCK_METHOD-generated mock methods]
  J -->|No| L[Troubleshoot parsing & specifiers]
  L --> I
```

---