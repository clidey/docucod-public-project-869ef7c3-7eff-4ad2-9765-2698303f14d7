---
title: "Internal Utilities"
description: "Covers internal utility functions, type traits, meta-programming constructs, and logging mechanisms. Intended for maintainers and those customizing the framework internals."
---

# Internal Utilities

This page documents the internal utility functions, type traits, meta-programming constructs, and logging mechanisms used within the GoogleTest framework. These utilities underpin GoogleTest's functionality and are primarily intended for maintainers and developers customizing GoogleTest internals. Users should be aware that these are not part of the public API and may change without notice.

---

## Overview

GoogleTest leverages a collection of internal utilities and meta-programming techniques to provide robust and extensible testing functionality. This includes support for managing assertions, logging, type classification, container adaptation, string manipulation, and error reporting.

The utilities include:

- **TypeTraits and Categorization:** Utilities for classifying C++ types into categories such as Boolean, integer, floating point, and others help in safely managing implicit conversions and matcher type casting.

- **Container Adapters:** Lightweight wrappers like `NativeArray` and `StlContainerView` adapt native C++ arrays and STL-style containers for uniform processing within the framework.

- **Assertion Reporting:** Classes and functions help in reporting assertion results, managing fatal and non-fatal failures, and generating detailed messages.

- **Logging and Verbosity Control:** Logging utilities support different verbosity levels controlled by flags, including info and warning levels.

- **String Manipulation:** Utilities for converting identifiers to human-friendly words, joining vectors of strings as tuples, and converting wide strings to UTF-8 strings for readable output.

- **Function Utilities:** Template tools to work with function signatures, such as extracting argument types and applying functions to tuples.

- **Compiler and Platform Compatibility Macros:** To support a wide range of platforms and compilers, the utilities also include macros like warning suppression directives and platform feature checks.

## Key Components and Utilities

### 1. Type Classification for Matcher Safety

GoogleTest internal utilities categorize types into four kinds:

- `kBool`: Boolean types
- `kInteger`: Integer types excluding bool
- `kFloatingPoint`: Floating point types
- `kOther`: Everything else

This categorization enables the framework to determine when matcher argument conversions are lossless or whether a cast is safe in complex matcher expressions.

#### Template: `KindOf<T>`
Maps any type `T` to one of the above `TypeKind` enum values, defining the kind of the type.

#### Trait: `LosslessArithmeticConvertible<From, To>`
Determines if arithmetic type `From` can be losslessly converted to arithmetic type `To`. It considers kind compatibility, width, and signedness.

### 2. Failure Reporting

Assertions and failures are reported via:

- An interface `FailureReporterInterface` that abstracts failure reporting (fatal and non-fatal).

- A function to get the current failure reporter.

- Inline utility functions `Assert()` and `Expect()` to assert or expect Boolean conditions, reporting fatal or non-fatal failures respectively.

- Internal class `GoogleTestFailureReporter` which integrates GoogleMock failures into GoogleTest's reporting system.

### 3. Logging Utilities

Log messages honor a verbosity setting controlled via `--gmock_verbose`. Severity levels supported include:

- `kInfo` (informational messages)
- `kWarning` (warnings)

Functions include:

- `LogIsVisible(severity)`: Checks if messages of a given severity should be logged according to verbosity level.

- `Log(severity, message, stack_frames_to_skip)`: Prints the message to standard output conditionally based on severity, optionally including a stack trace.

### 4. String Utilities

- `JoinAsKeyValueTuple(names, values)`: Joins vectors of names and values into a human-readable tuple-like string, e.g. `(key1: val1, key2: val2)`.

- `ConvertIdentifierNameToWords(id_name)`: Converts C++ identifiers into a lower-case, spaced word list â€” for example, `FooBar123` -> `foo bar 123`. This improves error message readability.

- `Base64Unescape(encoded, decoded)`: Decodes a Base64 or web-safe Base64 encoded string into the decoded form.

### 5. Pointer Utilities

`GetRawPointer(p)` template utility obtains a raw pointer from smart pointers or reference wrappers, or returns the raw pointer itself.

### 6. Container View Templates

- `StlContainerView<RawContainer>`: Template adapter that provides uniform access to STL-style containers and native arrays.

- For native arrays, specializations wrap arrays and pointers with size as containers.

### 7. Compile-Time Function Traits

Template struct `Function<F>` extracts return and argument types from function signatures, aiding generic handling of function types in matchers and callbacks.

### 8. Assertion Support

- `Invalid<T>()`: Generates an invalid value of type `T` which will assert and abort on execution. It's used for placeholder or unreachable code paths.

- `IllegalDoDefault(file, line)`: Reports incorrect usage of `DoDefault()` in composite actions.

- `WithoutMatchers`: A marker class to resolve parameterless expectations properly.

### 9. Compiler Warning Suppression Macros

Macros like `GMOCK_INTERNAL_WARNING_PUSH()` and `GMOCK_INTERNAL_WARNING_POP()` manage warning states across different compilers such as MSVC and Clang.

### 10. Platform Type Definitions

Macro `GMOCK_WCHAR_T_IS_NATIVE_` distinguishes whether `wchar_t` is a native type or a typedef, influencing internal type handling.

---

## Practical Usage Insights

While these utilities are not part of the public API, understanding them can assist advanced users and maintainers in troubleshooting obscure failures, extending GoogleTest internally, or writing compatible mock matchers.

### Common Scenarios

- When defining matchers or mock methods involving pointer types or smart pointers, `GetRawPointer()` ensures correct raw pointer extraction.

- Converting complex identifiers to readable words via `ConvertIdentifierNameToWords` improves logged messages and diagnostics.

- Logging utilities help adjust verbosity of GoogleMock internal messages for more or less detail based on the testing context.

- Handling Base64-encoded strings is important for specific matching or decoding scenarios, assisted by `Base64Unescape()`.

### Best Practices & Pitfalls

- Do not use these internal utilities directly from user tests or production code; they may change without notice.

- Use official GoogleTest APIs such as `EXPECT_*` and `ASSERT_*` for assertions and failure reporting.

- Understand that internal failure reporting interfaces integrate seamlessly with GoogleTest's event and reporting framework to provide detailed error output.

- Leverage container views like `StlContainerView<>` in GoogleMock matchers if implementing custom container-related matchers.

---

## Examples

### Converting an Identifier to Words

```cpp
std::string words = ConvertIdentifierNameToWords("FooBar123");
// words == "foo bar 123"
```

### Joining Key-Value Pairs as Tuple

```cpp
std::vector<const char*> keys = {"id", "name"};
Strings values = {"123", "test"};
std::string joined = JoinAsKeyValueTuple(keys, values);
// joined == "(id: 123, name: test)"
```

### Extracting Raw Pointer

```cpp
std::unique_ptr<int> ptr(new int(5));
const int* raw_ptr = GetRawPointer(ptr);  // returns ptr.get()

int x = 10;
std::reference_wrapper<int> ref(x);
raw_ptr = GetRawPointer(ref);  // returns &x

int* raw = new int(7);
raw_ptr = GetRawPointer(raw); // returns raw
```

---

## Troubleshooting

### Common Issues

- **Misusing Internal APIs:** Accessing these internal utilities from user code leads to fragile tests; always use public APIs.

- **Failure to Report Proper Messages:** If custom failure reporting is needed, use GoogleTest's public `AssertionResult`, `SCOPED_TRACE`, and assertion macros rather than internal failure mechanisms.

- **Logging Doesn't Appear:** Ensure `--gmock_verbose` flag is set appropriately (e.g., `--gmock_verbose=info` to see all logs).

- **Base64 Decoding Fails:** Passed data might be malformed or not standard base64; validate input before decoding.

### Debugging Tips

- Enable verbose output to trace internal states: `--gmock_verbose=info`.

- Use `SCOPED_TRACE` to add contextual traces around failing assertions.

- Consult GoogleTest's event listener APIs when extending or modifying failure reporting.

---

## Reference

| Utility                                         | Description                                  |
| -----------------------------------------------|----------------------------------------------|
| `GetRawPointer(p)`                             | Extracts raw pointer from smart pointers    |
| `JoinAsKeyValueTuple(names, values)`           | Joins key-value pairs as tuple string       |
| `ConvertIdentifierNameToWords(id_name)`        | Converts C++ identifier to spaced words     |
| `FailureReporterInterface`                      | Interface for reporting failures             |
| `Assert(condition, file, line, msg)`           | Causes fatal failure if condition false     |
| `Expect(condition, file, line, msg)`           | Causes non-fatal failure if condition false |
| `LogIsVisible(severity)`                        | Checks log visibility for severity           |
| `Log(severity, message, stack_frames_to_skip)` | Prints log messages if severity visible      |
| `Base64Unescape(encoded, decoded)`             | Decodes Base64 encoded string                 |
| `StlContainerView<RawContainer>`                | Adapter for container views                   |
| `Function<F>`                                   | Template to extract function signature info |
| `Invalid<T>()`                                 | Generates an invalid value of type T          |

---

## See Also

- [GoogleTest Assertions Reference](../reference/assertions.md) for public assertion APIs.
- [GoogleMock Matchers and Predicates](../api-reference/advanced-mocking-apis/matchers-and-predicates.mdx) for argument matching utilities.
- [Test Infrastructure](../api-reference/core-testing-apis/test-infrastructure.mdx) for core test execution details.
- GoogleTest Primer for beginner-friendly guides to assertions and tests.

---

## Source

This documentation is derived from the header `gmock/internal/gmock-internal-utils.h` and associated implementation `gmock-internal-utils.cc` files in the GoogleTest repository.

<Source url="https://github.com/google/googletest" paths='[{"path": "googlemock/include/gmock/internal/gmock-internal-utils.h"}, {"path": "googlemock/src/gmock-internal-utils.cc"}]' />