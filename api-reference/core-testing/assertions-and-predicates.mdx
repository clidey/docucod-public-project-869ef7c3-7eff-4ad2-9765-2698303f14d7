---
title: "Assertions & Predicates"
description: "Documents all assertion macros (EXPECT, ASSERT and their variants), predicate-based assertions, and user-defined assertion flows, highlighting how to check values, handle errors, and report detailed failure information. Includes guidance on both fatal and non-fatal checks, with sample error outputs and expected behaviors."
---

# Assertions & Predicates

This page details all assertion macros provided by GoogleTest, focusing on assertion variants (`EXPECT`, `ASSERT`), predicate-based assertions, and user-defined assertion workflows. It explains how to verify values using these assertions, handle errors, and generate rich failure reports. Both fatal and non-fatal checks are covered, with examples to illustrate typical usage and expected output.

---

## Understanding Assertions

Assertions express expectations about your program’s behavior in your test code. They are the fundamental building blocks for validating code correctness in GoogleTest.

### Assertion Variants

- **`EXPECT_` Macros:** Non-fatal assertions. Failures are logged but allow the current test function to continue executing.
- **`ASSERT_` Macros:** Fatal assertions. Failures abort the current test function immediately.

Both types support streaming of custom failure messages with `<<`, allowing you to describe failure context clearly.

### Common Assertion Scenarios

- Simple boolean conditions (`EXPECT_TRUE`, `ASSERT_FALSE`)
- Equality and inequality checks (`EXPECT_EQ`, `ASSERT_NE`, etc.)
- String equality/inequality, with case sensitive and insensitive options (`EXPECT_STREQ`, `EXPECT_STRNE`, `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`)
- Floating-point comparisons (`EXPECT_FLOAT_EQ`, `ASSERT_DOUBLE_EQ`, `EXPECT_NEAR`)
- Exception assertions (`EXPECT_THROW`, `ASSERT_NO_THROW`, etc.)
- Predicate assertions for custom validators

---

## Predicate Assertions

Sometimes, you want to assert complex conditions beyond simple comparisons — especially where explanation of failure with the actual values involved is important.

GoogleTest offers predicate assertions that enable this expressive verification.

### Predicate Assertion Types

- **`EXPECT_PREDn` / `ASSERT_PREDn` macros:**
  - Take a predicate function or functor returning `bool` and `n` arguments.
  - On failure, print the predicate invocation and the values of each argument.
  - Support up to 5 arguments.

- **`EXPECT_PRED_FORMATn` / `ASSERT_PRED_FORMATn` macros:**
  - Use predicate-formatter functions or functors returning `testing::AssertionResult`.
  - Provide richer, customized failure messages.
  - Receive as arguments both the expressions as strings and the evaluated values.

### Why Use Predicate Assertions?

A raw `EXPECT_TRUE(expr)` often does not provide context about which part of the complex expression failed or the values involved. Predicate assertions help make failures more descriptive without cluttering tests with manual message formatting.

### Example: Using a Boolean Predicate Function

```cpp
// Returns true if n is even.
bool IsEven(int n) {
  return (n % 2) == 0;
}

// Use in test:
EXPECT_PRED1(IsEven, value);
```

On failure, you get:

```
IsEven(value) evaluates to false, where
value evaluates to 3
```

### Example: Using `AssertionResult` Predicate

Improve failure messages by defining predicates returning `AssertionResult`.

```cpp
testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0)
    return testing::AssertionSuccess();
  else
    return testing::AssertionFailure() << n << " is odd";
}

// Use in test
EXPECT_TRUE(IsEven(value));
```

If `value` is 3, failure output will be:

```
Value of: IsEven(value)
  Actual: false (3 is odd)
Expected: true
```

### Example: Predicate-Formatter Function

Create fully customized failure messages, especially for arguments that cannot be printed normally.

```cpp
testing::AssertionResult AssertIsEven(const char* expr, int n) {
  if ((n % 2) == 0)
    return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}

// Use in test:
EXPECT_PRED_FORMAT1(AssertIsEven, value);
```

Failure prints:

```
value evaluates to 3, which is not even.
```

### Arguments Evaluation

Predicate assertions evaluate each argument exactly once, avoiding unintended side effects from multiple evaluations.

---

## Assertion Macros in Detail

Below is a concise reference for predicate and other assertions.

### Unary Predicate Assertions

| Macro                     | Usage Example                      | Description                                     |
|---------------------------|----------------------------------|------------------------------------------------|
| `EXPECT_PRED1(pred, v1)`  | `EXPECT_PRED1(IsPositive, x);`    | Tests bool `pred(v1)`. Non-fatal failure on false.
| `ASSERT_PRED1(pred, v1)`  | `ASSERT_PRED1(IsPositive, x);`    | Same as above, fatal failure on false.
| `EXPECT_PRED_FORMAT1(pred_format, v1)` | `EXPECT_PRED_FORMAT1(AssertIsEven, x);` | Uses a predicate-formatter returning `AssertionResult` to format failure.
| `ASSERT_PRED_FORMAT1(pred_format, v1)` | `ASSERT_PRED_FORMAT1(AssertIsEven, x);` | Same as above, fatal failure.

### Binary Predicate Assertions

Support up to 5 arguments with corresponding macros: `EXPECT_PRED2` ... `EXPECT_PRED5` and their `ASSERT_` variants.

Example:

```cpp
// Returns whether sum of two ints is positive.
bool SumIsPositive(int a, int b) { return a + b > 0; }
EXPECT_PRED2(SumIsPositive, a, b);
```

If false, failure reports the values of `a` and `b`.

---

## Fatal vs. Non-Fatal Behavior

| Macro Type  | Failure Behavior                               |
|-------------|-----------------------------------------------|
| `EXPECT_*`  | Logs failure, current function continues      |
| `ASSERT_*`  | Logs failure, current function returns early  |

Use ASSERT macros for conditions that invalidate further testing in the current function.

---

## Failure Output Format

GoogleTest failure output includes:

- The expectation expression.
- Actual values of involved variables (using `<<` streaming when possible).
- Custom failure messages from predicate-formatter if provided.

**Example failure for `ASSERT_PRED2` with predicate function:**

```
SumIsPositive(a, b) evaluates to false, where

a evaluates to -2
b evaluates to -5
```

**Example failure for `EXPECT_PRED_FORMAT1` with predicate-formatter:**

```
x evaluates to 3, which is not even.
```

---

## User-Defined Assertion Flows

You can create custom predicates and predicate-formatters for complex validation and tailored error reporting.

### Writing a Predicate Function

Return `bool` or `testing::AssertionResult`.

```cpp
bool IsEven(int n) { return n % 2 == 0; }

// or

testing::AssertionResult IsEvenDetailed(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}
```

### Writing a Predicate-Formatter

Accept expression strings and values, return `AssertionResult`.

```cpp
testing::AssertionResult AssertSumIsPositive(const char* e1, const char* e2, int a, int b) {
  int sum = a + b;
  if (sum > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << e1 << " + " << e2 << " (" << a << " + " << b << ") evaluates to " << sum << ", which is not positive.";
}

// Usage:
EXPECT_PRED_FORMAT2(AssertSumIsPositive, x, y);
```

This results in clear failure messages that include both expressions and values.

---

## Best Practices

- Use `EXPECT_*` when test can continue after failure; use `ASSERT_*` when failure invalidates further checks.
- When checking predicates with multiple arguments, prefer predicate assertions over raw `EXPECT_TRUE` for better diagnostics.
- For complex predicates or when default message is insufficient, implement predicate-formatter functions.
- Stream custom messages into assertions to provide insight into test failures.
- Ensure predicate functions and formatters evaluate arguments exactly once to avoid side effects.
- Use `SCOPED_TRACE` or custom message streaming in complex call chains to add context to failures.

---

## Example: Full Predicate Assertion

```cpp
bool IsValidTriangle(int a, int b, int c) {
  return (a + b > c) && (a + c > b) && (b + c > a);
}

testing::AssertionResult AssertValidTriangle(const char* e1, const char* e2, const char* e3, int a, int b, int c) {
  if (IsValidTriangle(a, b, c)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << e1 << ", " << e2 << ", and " << e3 <<  " do not form a valid triangle: sides are " << a << ", " << b << ", and " << c << ".";
}

TEST(GeometryTest, TriangleTest) {
  int x = 2, y = 3, z = 10;
  EXPECT_PRED_FORMAT3(AssertValidTriangle, x, y, z);
}
```

Failure message:

```
x, y, and z do not form a valid triangle: sides are 2, 3, and 10.
```

---

## Common Pitfalls and Troubleshooting

- **Multiple evaluations of predicate arguments:** Predicate assertions in GoogleTest are designed to evaluate each argument exactly once. If you observe side-effects, review your predicate for unintended modifications.

- **Unexpected continuation after fatal assertion:** Remember `ASSERT_*` macros abort the *current function*, but not the entire test. Use `ASSERT_NO_FATAL_FAILURE` or exception-based approaches to propagate fatal failures through calls.

- **Incorrect predicate signature:** Predicate-formatters must accept expressions as `const char*` strings followed by predicate argument values and return `AssertionResult` objects.

- **Mismatch of argument counts:** Use the appropriate `PRED1` through `PRED5` macros corresponding to the number of arguments.

- **Assertion in non-void functions:** Fatal assertions (`ASSERT_*`) can only be used inside `void`-returning functions to avoid compilation errors.

- **Streaming unsupported types:** To enhance failure message readability, teach GoogleTest how to print your custom types by defining `operator<<`, `PrintTo()`, or `AbslStringify()` overloads.

---

## Summary

GoogleTest's assertions and predicates API offers a flexible and expressive way to verify test expectations with rich diagnostics. Predicate assertions bridge the gap between boolean expressions and detailed failure messages, enabling clear reports with evaluated argument values. With support for fatal and non-fatal variants and user-defined assertion flows, you can write robust, maintainable tests.

---

For related information, see:
- [Assertions Reference](../reference/assertions.md)
- [Advanced GoogleTest Topics](../docs/advanced.md#predicate-assertions-for-better-error-messages)
- [Testing Reference - TEST macros](../reference/testing.md#TEST)
- [GoogleTest Primer](primer.md) for basic test writing
- [Using Matchers with ASSERT_THAT](../reference/assertions.md#EXPECT_THAT)