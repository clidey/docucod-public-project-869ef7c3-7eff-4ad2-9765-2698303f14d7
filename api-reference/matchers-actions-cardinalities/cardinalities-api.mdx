---
title: "Cardinalities API"
description: "API for controlling and verifying how many times a mock method is expected to be called. Learn to use built-in cardinality classes and factory functions to assert exact, minimum, or maximum call counts with clarity."
---

# Cardinalities API

GoogleMock provides a powerful mechanism to control and verify how many times each mocked method is expected to be called during tests. This capability is primarily expressed through **cardinalities**, which specify the expected number of invocations for a mock function.

This documentation covers the built-in cardinality classes and factory functions that let you assert **exact**, **minimum**, **maximum**, or **range**-based call expectations with clarity and precision.

---

## Overview of Cardinalities

A **Cardinality** in GoogleMock is an immutable object that encapsulates the specification of how many times a mock method should be called. It is used with `.Times()` inside `EXPECT_CALL` expressions to assert call count expectations.

Cardinalities may describe:

- An exact number of calls,
- At least a number of calls,
- At most a number of calls,
- A bounded range of calls,
- Or allow any number of calls.

If `.Times()` is omitted, GoogleMock uses inference rules based on `.WillOnce()` and `.WillRepeatedly()` clauses.

---

## Built-In Cardinalities

The GoogleMock framework defines several commonly-used cardinality factory functions, all available in the `testing` namespace:

| Cardinality              | Meaning                                                                                  |
|--------------------------|------------------------------------------------------------------------------------------|
| `AnyNumber()`            | The method can be called any number of times (including zero).                          |
| `AtLeast(n)`             | The method is expected to be called at least *n* times (with *n* ≥ 0).                  |
| `AtMost(n)`              | The method is expected to be called at most *n* times (with *n* ≥ 0).                   |
| `Between(m, n)`          | The method is expected to be called between *m* and *n* times, inclusive.               |
| `Exactly(n)` or `n`      | The method is expected to be called exactly *n* times (with *n* ≥ 0).                   |

### Example Usage

```cpp
using ::testing::Exactly;
using ::testing::AtLeast;
using ::testing::AtMost;
using ::testing::AnyNumber;
using ::testing::Between;

EXPECT_CALL(mock_object, SomeMethod())
    .Times(Exactly(3));                    // Expect exactly 3 calls
EXPECT_CALL(mock_object, OtherMethod(_))
    .Times(AtLeast(1));                   // Expect at least 1 call
EXPECT_CALL(mock_object, AnotherMethod(_))
    .Times(AtMost(5));                    // Expect at most 5 calls
EXPECT_CALL(mock_object, YetAnotherMethod(_))
    .Times(Between(2, 4));                // Expect between 2 and 4 calls
EXPECT_CALL(mock_object, CatchAllMethod(_))
    .Times(AnyNumber());                  // Expect any number of calls
```

---

## Cardinality Interface

Each cardinality implements the `CardinalityInterface` abstract class with the following responsibilities:

- **ConservativeLowerBound()**: Returns a conservative estimate of the minimum number of calls allowed.
- **ConservativeUpperBound()**: Returns a conservative estimate of the maximum number of calls allowed.
- **IsSatisfiedByCallCount(int)**: Returns `true` if the given number of calls satisfies the cardinality.
- **IsSaturatedByCallCount(int)**: Returns `true` if the given number of calls saturate the cardinality (meaning the upper bound has been reached).
- **DescribeTo(ostream*)**: Produces a human-readable description of the expectation.

A **Cardinality** instance wraps this interface and provides copyable, immutable handles.

---

## Details of Built-in Cardinalities

### 1. AnyNumber()
Allows any number of calls, zero or more.

**Behavior:**
- Lower bound = 0
- Upper bound = `INT_MAX` (effectively unbounded)
- Never saturated.

**Description Example:** "called any number of times"

### 2. AtLeast(n)
Allows the method to be called at least `n` times.

**Constraints:**
- `n` must be >= 0.

**Behavior:**
- Lower bound = `n`
- Upper bound = `INT_MAX`
- Saturated only if infinite upper bound is reached (never actually saturated)

**Description Examples:**
- `AtLeast(0)` => Same as `AnyNumber()`: "called any number of times"
- `AtLeast(1)` => "called at least once"
- `AtLeast(3)` => "called at least 3 times"

### 3. AtMost(n)
Allows the method to be called at most `n` times.

**Constraints:**
- `n` must be >= 0.

**Behavior:**
- Lower bound = 0
- Upper bound = `n`
- Saturated once call count >= `n`

**Description Examples:**
- `AtMost(0)` => "never called"
- `AtMost(1)` => "called at most once"
- `AtMost(3)` => "called at most 3 times"

### 4. Between(min, max)
Allows between `min` and `max` calls inclusive.

**Constraints:**
- `min` and `max` must be >= 0.
- `max` must be >= `min`.

**Behavior:**
- Lower bound = `min`
- Upper bound = `max`
- Saturated if call count >= `max`

**Description Examples:**
- `Between(0, 0)` => "never called"
- `Between(3, 3)` => "called 3 times"
- `Between(3, 5)` => "called between 3 and 5 times"
- `Between(0, INT_MAX)` equals `AnyNumber()`. 

### 5. Exactly(n)
Requires exactly `n` calls.

**Equivalent to:** `Between(n, n)`

**Constraints:**
- `n` must be >= 0.

**Behavior:**
- Lower bound = `n`
- Upper bound = `n`
- Saturated if call count >= `n`

**Description Examples:**
- `Exactly(0)` => "never called"
- `Exactly(1)` => "called once"
- `Exactly(3)` => "called 3 times"

---

## How Cardinalities Affect Expectations

When used with `.Times()` in `EXPECT_CALL`, cardinalities specify the expected call count window.

- If call count < lower bound: the expectation is **unsatisfied**.
- If call count >= upper bound: the expectation is **saturated**.
- If call count > upper bound: the call **over-saturates** and causes a test failure.

Example: `EXPECT_CALL(mock, Foo()).Times(AtMost(2));` expects zero, one, or two calls and errors on the third.

### Inferring Cardinalities
When `.Times()` is omitted, GoogleMock infers the cardinality based on `.WillOnce()` and `.WillRepeatedly()`:

- No `.WillOnce()` or `.WillRepeatedly()`: infers `Times(Exactly(1))`.
- *n* `.WillOnce()` clauses, no `.WillRepeatedly()`: infers `Times(Exactly(n))`.
- *n* `.WillOnce()` clauses with `.WillRepeatedly()`: infers `Times(AtLeast(n))`.

---

## Descriptions and Messages

GoogleMock provides human-friendly descriptions of call count constraints, for example:

- "never called"
- "called once"
- "called twice"
- "called 3 times"
- "called at most twice"
- "called at least twice"
- "called any number of times"
- "called between 3 and 5 times"

These are included in failure messages to help you understand why a test failed.

GoogleMock also describes actual call counts during verification, e.g., "called once" or "never called".

---

## Best Practices

- Use cardinalities to precisely express how often a mocked function is expected to be called.
- For calls expected a fixed number of times, use `Exactly(n)`.
- For flexible minimum requirements, use `AtLeast(n)`.
- For limiting calls to a maximum, use `AtMost(n)`.
- To specify a range, use `Between(m, n)`.
- For unbounded calls, `AnyNumber()` allows all.
- Combine with `.RetiresOnSaturation()` to automatically deactivate expectations when saturated.

---

## Troubleshooting

- **Negative numbers for cardinalities:** Will cause runtime errors.
- **Call count exceeds upper bound:** Indicates over-saturation and test failure.
- **No `.Times()` specified:** Ensure the inference rule matches your intent.
- **Expectations with no matching calls:** Verify if you should relax `.Times()`.

Using GoogleMock’s verbose flags (`--gmock_verbose=info`) can provide detailed traces for mock call count mismatches.

---

## Summary

The Cardinalities API in GoogleMock empowers you to define clear, expressive numerical constraints on how often mocked methods should be invoked. Whether you want strict exactness, minimum, maximum, or ranged expectations, built-in cardinalities let you write readable, maintainable, and robust tests.

---

## Related Links

- [EXPECT_CALL - Times clause](./mocking.md#EXPECT_CALL.Times)
- [Mocking Reference](./mocking.md)
- [gMock Cookbook - Setting Expectations](../guides/mocking-best-practices/writing-expectations-actions.mdx)
- [GoogleMock Cheat Sheet](./gmock_cheat_sheet.md)
- [gMock for Dummies - Setting Expectations](./gmock_for_dummies.md#SettingExpectations)

---

## Code Example: Verifying Call Counts

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Exactly;
using ::testing::AtLeast;
using ::testing::AtMost;

class MockPrinter {
 public:
  MOCK_METHOD(void, Print, (const std::string& text), ());
};

TEST(PrintTest, CallCounts) {
  MockPrinter printer;

  EXPECT_CALL(printer, Print("Hello"))
      .Times(Exactly(2));       // Expected exactly two calls.

  EXPECT_CALL(printer, Print("World"))
      .Times(AtLeast(1));       // Expected at least one call.

  EXPECT_CALL(printer, Print("!"))
      .Times(AtMost(3));        // Expected at most three calls.

  printer.Print("Hello");
  printer.Print("Hello");
  printer.Print("World");
  printer.Print("!");
}
```

---

## Internal Implementation Note

The cardinalities are implemented with a `CardinalityInterface` abstract class which users can also extend to define custom cardinalities if needed. Built-in implementations are provided via factory functions returning `Cardinality` objects that manage lifetime safely.

---