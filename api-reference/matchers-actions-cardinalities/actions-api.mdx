---
title: "Actions API"
description: "Reference for specifying default and custom behaviors (actions) for mocked methods. Explore standard actions, define custom actions with parameters, and extend mock behavior using the powerful action macro system."
---

# Actions API

This reference page details how to specify default and custom behaviors (actions) for mocked methods in GoogleMock. It explores the spectrum of standard built-in actions, explains how to define your own actions with parameters, and demonstrates extendibility using the powerful action macro system. Actions determine what a mock function does when calledâ€”whether returning fixed values, performing side effects, or invoking user-defined callables.

---

## Understanding Actions in Mocking

When you use a mock method, you often want to control the behavior it exhibits when called. This is the domain of **actions**. An action defines what happens each time a mock method matching an expectation is invoked.

- By default, void-returning functions simply return.
- For functions returning built-in types or pointers, GoogleMock returns a default constructed or zero value.
- You can override or supplement this behavior by specifying explicit actions in your tests.

Actions can be simple (like returning a constant), complex (chaining multiple side effects), or user-defined by lambdas, functors, or macros. This flexibility lets you tailor mock behavior exactly to your testing needs.

---

## Built-In Actions

GoogleMock provides a comprehensive set of built-in actions in the `::testing` namespace. Here's an overview of the most commonly used ones grouped by category.

### Returning Values

| Action | Description |
|--------|-------------|
| `Return()` | Return from a `void` mock function immediately. |
| `Return(value)` | Return the specified `value`. If the value type differs from the mock method's return type, the conversion occurs at the moment the expectation is set, not when the method is called. |
| `ReturnArg<N>()` | Return the `N`-th (zero-based) argument passed to the mock method. Useful for forwarding inputs as outputs. |
| `ReturnNew<T>(a1, ..., aK)` | Construct and return a new object of type `T` created with the given constructor parameters on each call. This returns a different object every invocation. |
| `ReturnNull()` | Return a null pointer. Works with raw and smart pointers. |
| `ReturnPointee(ptr)` | Return the value pointed to by `ptr` at the time the method is invoked, enabling live value returning. |
| `ReturnRef(variable)` | Return a reference to a variable, useful when your mock method's return type is a reference. |
| `ReturnRefOfCopy(value)` | Return a reference to a copy of `value`; the copy persists as long as the action object lives. |
| `ReturnRoundRobin({a1, ..., aK})` | On each call, return the next value in the list cycling back after the last item. |

### Side Effect Actions

| Action | Description |
|--------|-------------|
| `Assign(&variable, value)` | Assign `value` to `variable` as a side effect. |
| `DeleteArg<N>()` | Delete the pointer stored in the `N`-th argument, which must be a pointer type. |
| `SaveArg<N>(pointer)` | Save a copy of the `N`-th argument to the location pointed to by `pointer`. |
| `SaveArgByMove<N>(pointer)` | Save the `N`-th argument by moving it to `*pointer`. Useful for move-only types. |
| `SaveArgPointee<N>(pointer)` | Save the object pointed to by the `N`-th argument to `*pointer`. |
| `SetArgReferee<N>(value)` | Assign `value` to the object referenced by the `N`-th argument. |
| `SetArgPointee<N>(value)` | Assign `value` to the object pointed to by the `N`-th argument (pointer or iterator). |
| `SetArrayArgument<N>(first, last)` | Copy elements from the range `[first, last)` into the array or iterator pointed to by the `N`-th argument. |
| `SetErrnoAndReturn(error, value)` | Set `errno` to `error`, then return `value`. Useful for simulating error conditions. |
| `Throw(exception)` | Throw the specified exception. The exception must be copyable. This enables testing exception handling behavior.

### Function, Functor, or Lambda Based Actions

You can use existing callables directly as actions:

| Action | Description |
|--------|-------------|
| `f` (a callable) | Directly invoke the callable `f` with the arguments passed to the mock function. |
| `Invoke(f)` | Similar to above but explicitly calls a global/static function or functor, taking ownership of `f`. |
| `Invoke(object_ptr, &class::method)` | Invoke method on the given object pointer, forwarding mock call arguments. |
| `InvokeWithoutArgs(f)` | Invoke callable `f` without passing arguments. Useful for zero-argument functions or side effects. |
| `InvokeWithoutArgs(object_ptr, &class::method)` | Similar, but for invoking a method with no arguments. |
| `InvokeArgument<N>(arg1, ..., argK)` | Invoke the `N`-th argument (which must itself be callable) with specified arguments.

For callable arguments that require reference parameters, use `std::ref()` to pass references explicitly.

### Composite Actions

If multiple effects are needed in sequence, combine actions using:

| Action | Description |
|--------|-------------|
| `DoAll(a1, a2, ..., aN)` | Perform all actions from `a1` to `aN` in order. Only the last action's result is returned. The first `n-1` actions must return void. |
| `IgnoreResult(a)` | Invoke action `a` and discard its return value. Useful when using a non-void action where a void return is required. |
| `WithArg<N>(a)` | Pass the `N`-th argument of the mock function to inner action `a`. |
| `WithArgs<N1, N2, ..., Nk>(a)` | Pass multiple specified arguments to the inner action `a`. |
| `WithoutArgs(a)` | Perform action `a` without passing any arguments from the mock call.

---

## Defining Custom Actions

When built-in actions don't suffice, you can define your own custom actions easily.

### Using Lambdas, Functors, or Callables

You can write a callable with a compatible signature and use it directly in `WillOnce()` or `WillRepeatedly()`. For example:

```cpp
MockFunction<int(int)> mock;
EXPECT_CALL(mock, Call).WillOnce([](int x) { return x * 2; });
EXPECT_EQ(4, mock.AsStdFunction()(2));
```

If your action involves move-only state or you want to guarantee it's invoked at most once, define `operator()() &&` with an rvalue qualifiers. This is compatible with `WillOnce()`.

### Using the `ACTION` Macros

For C++11 or earlier style actions or multi-parameter actions with parameters, GoogleMock offers a family of macros:

- `ACTION(Name) { ... }` to define an action with zero parameters.
- `ACTION_P(Name, param) { ... }` to define a parameterized action with one parameter.
- `ACTION_Pk(Name, p1, ..., pk) { ... }` for multiple parameters (up to 10).

Inside the body, use predefined symbols to access arguments, for example:

- `arg0`, `arg1`, ... to access the mock function's arguments.
- `return_type` for the return type.
- `args` as a tuple of all arguments.

Example:

```cpp
ACTION(IncrementArg1) { (*arg1)++; }
EXPECT_CALL(mock, Foo).WillOnce(IncrementArg1());
```

### Writing New Template Actions

Using `ACTION_TEMPLATE` macro, you can define an action with template and value parameters explicitly for advanced use cases:

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(std::get<k>(args));
}
EXPECT_CALL(mock, Foo(_, _)).WillOnce(DuplicateArg<1, unsigned char>(&n));
```

### Implementing `ActionInterface<F>` Directly

When you need fine control, implement `ActionInterface<F>` with template parameter `F` being the mock function signature. Provide a method:

```cpp
Result Perform(const ArgumentTuple& args);
```

called when the action is invoked.

GoogleMock provides utilities to convert your implementation to an `Action<F>` which is compatible with `WillOnce()` and `WillRepeatedly()`.

### Polymorphic Actions

For actions you want to use across multiple mock function types, implement a polymorphic action class with a templated `Perform<Result>(args)` method, and wrap it with `MakePolymorphicAction()` to get a `PolymorphicAction` object usable in any compatible mock function.

Example:

```cpp
class ReturnSecondArgumentAction {
 public:
  template <typename Result, typename ArgumentTuple>
  Result Perform(const ArgumentTuple& args) {
    return std::get<1>(args);
  }
};

PolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() {
  return MakePolymorphicAction(ReturnSecondArgumentAction());
}
EXPECT_CALL(mock, Func()).WillOnce(ReturnSecondArgument());
```

---

## Practical Tips and Common Pitfalls

- **Evaluation time of arguments:** Be aware that `Return(value)` converts `value` at the time of expectation setting, not at call time. To return a value that can change during the test, use actions like `ReturnPointee()` or write custom lambdas.
- **Using move-only return types (e.g. `std::unique_ptr`)**: Use `WillOnce(Return(ByMove(std::move(ptr))))` to return move-only objects.
- **Combining side effects and return values:** Use `DoAll()` to chain side-effect actions with a return action, ensuring the last action returns the appropriate value.
- **Sharing actions:** If an action carries state, do not share the same instance across multiple expectations unless intended.
- **Using `IgnoreResult()` carefully:** Only apply this to non-void-returning actions.
- **Passing arguments by reference in `InvokeArgument` and others:** Use `std::ref()` to correctly forward references.
- **Beware of unprotected commas in `MOCK_METHOD`:** Wrap types with commas in extra parentheses or use type aliases.

---

## Example Overview

```cpp
using ::testing::Return;
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Invoke;
using ::testing::WithArgs;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (int x, int* out), (override));
};

MockFoo mock;

// Set a side effect of writing 42 to the output pointer, and return 1.
EXPECT_CALL(mock, Bar)
    .WillOnce(DoAll(SetArgPointee<1>(42), Return(1)));

// Use a lambda action that ignores the arguments.
EXPECT_CALL(mock, Bar)
    .WillRepeatedly([](int x, int* out) {
      *out = x * 2;
      return 0;
    });

// Using Invoke with a free function.
int MultiplyBy3(int x, int* out) {
  *out = x * 3;
  return *out;
}
EXPECT_CALL(mock, Bar).WillOnce(Invoke(MultiplyBy3));

// Using WithArgs to select a subset of arguments for the inner action.
EXPECT_CALL(mock, Bar)
    .WillOnce(WithArgs<0,1>(Invoke(MultiplyBy3)));

// Invoke the N-th argument (a callable) passed to the mock.
EXPECT_CALL(mock, Bar)
    .WillOnce(InvokeArgument<1>(5));  // Calls *out(5) if out is callable.
```

---

## Troubleshooting Common Issues

- **Uninteresting calls warnings:** Suppress with `NiceMock`, or set `EXPECT_CALL(...).Times(AnyNumber())` to explicitly allow.
- **Unexpected calls errors:** Verify expectations match call arguments.
- **Excess actions warning:** Ensure the number of `WillOnce()` calls does not exceed the expectation cardinality.
- **Too few actions warning:** Check if the number of `WillOnce()` calls is less than the minimum expected.
- **Move-only type errors:** Confirm usage with `WillOnce` rather than `WillRepeatedly` if returning moved values.

---

## Related Documentation

- [Mocking Reference](mocking.md): Core details on `MOCK_METHOD`, `EXPECT_CALL`, and `ON_CALL`
- [Matchers API](argument-matchers.md): Understanding argument matchers used with expectations
- [Mocking Best Practices](writing-expectations-actions.md): How to write clear, maintainable mocks and actions
- [gMock for Dummies](gmock_for_dummies.md): Beginner-friendly introduction to mocking and actions
- [Actions Reference](actions.md): Comprehensive list of built-in actions

---

## Summary
This page empowers GoogleMock users to specify what happens when mocked methods are invoked. From simple return values to complex sequences of side effects, understanding and controlling mock actions lets you sculpt test doubles that behave exactly as you need, increasing test precision and robustness.