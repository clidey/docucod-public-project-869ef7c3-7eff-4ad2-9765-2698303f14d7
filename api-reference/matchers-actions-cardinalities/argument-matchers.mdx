---
title: "Matchers API"
description: "Complete API listing of built-in argument matchers for use in mock expectations and assertions. Understand how to compose, combine, and customize matchers for expressive and maintainable tests."
---

# Matchers API Reference

This page provides a comprehensive API listing and detailed explanation of the built-in argument matchers available in Google Mock (gMock). Matchers are essential for expressing expectations on mock method arguments and for writing expressive assertions. You will learn how to use individual matchers, combine them, and create custom matchers to validate function calls in your tests.

---

## What Are Matchers?

A **matcher** is a predicate-like object that determines whether a single argument satisfies a condition. Matchers are passed to `EXPECT_CALL()` or `ON_CALL()` macros to specify expectations or default behaviors on mock method arguments. You can also use matchers in assertions via `EXPECT_THAT()` to check values.

---

## Using Matchers

Matchers are employed to specify the expected arguments in mocked methods or assertions. For example:

```cpp
using ::testing::Eq;
using ::testing::_;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (int), ());
};

MockFoo mock;
EXPECT_CALL(mock, Bar(Eq(5))) // Expects Bar to be called with 5.
    .WillOnce(Return(10));

int result = mock.Bar(5); // Returns 10
```

If you need to check a value directly in a test, use `EXPECT_THAT`:

```cpp
EXPECT_THAT(some_value, Eq(42));
EXPECT_THAT(some_string, StartsWith("Hello"));
```

---

## Wildcard Matchers

| Matcher                | Description                        |
|-----------------------|----------------------------------|
| `_`                   | Matches any value of the correct type. |
| `A<type>()` or `An<type>()` | Matches any value of the specified `type`. |

**Examples:**

```cpp
EXPECT_CALL(mock, Foo(_));                    // Any argument
EXPECT_CALL(mock, Foo(A<int>()));             // Any int
EXPECT_CALL(mock, Foo(An<const char*>()));    // Any C string pointer
```

---

## Generic Comparison Matchers

| Matcher                 | Meaning                                       |
|-------------------------|-----------------------------------------------|
| `Eq(value)` or `value`  | argument == value                             |
| `Ne(value)`             | argument != value                             |
| `Lt(value)`             | argument < value                              |
| `Le(value)`             | argument <= value                             |
| `Gt(value)`             | argument > value                              |
| `Ge(value)`             | argument >= value                             |
| `IsTrue()`              | argument evaluates to true                    |
| `IsFalse()`             | argument evaluates to false                   |
| `DistanceFrom(target, m)` | The distance between argument and target matches matcher `m` (default distance is `abs(argument - target)`). |
| `DistanceFrom(target, get_distance, m)` | Distance computed by `get_distance(argument, target)` matches `m`. |
| `Optional(m)`           | argument is an `optional<>` and contains a value matching `m`. |
| `VariantWith<T>(m)`     | argument is a `variant<>` holding alternative type `T` with value matching `m`. |
| `Ref(variable)`         | argument is a reference to `variable`.       |
| `TypedEq<type>(value)`  | argument has type `type` and equals `value` (useful with overloaded functions). |

**Examples:**

```cpp
EXPECT_CALL(mock, Foo(Eq(10)));
EXPECT_CALL(mock, SetFlag(IsTrue()));
EXPECT_THAT(v, Ge(5));
EXPECT_THAT(opt, Optional(Eq(expected)));
```

> **Note:** Except for `Ref()`, matchers copy the argument value internally. Use `std::ref()` wrapper for types that are not copyable or to avoid copies.

---

## Floating-Point Matchers

Use these for approximate equality and handling NaN values safely.

| Matcher                 | Description                                              |
|-------------------------|----------------------------------------------------------|
| `FloatEq(a_float)`      | argument is `float` approximately equal to `a_float` (NaNs unequal). |
| `DoubleEq(a_double)`    | argument is `double` approximately equal to `a_double` (NaNs unequal). |
| `NanSensitiveFloatEq(a_float)` | `float` approx equal; NaNs considered equal.          |
| `NanSensitiveDoubleEq(a_double)` | `double` approx equal; NaNs considered equal.         |
| `FloatNear(value, max_abs_error)` | value within `max_abs_error` of argument (float).      |
| `DoubleNear(value, max_abs_error)` | value within `max_abs_error` of argument (double).     |
| `NanSensitiveFloatNear(value, max_abs_error)` | Same as `FloatNear`, but NaNs equal.                   |
| `NanSensitiveDoubleNear(value, max_abs_error)` | Same as `DoubleNear`, but NaNs equal.                 |
| `IsNan()`                | argument is NaN of floating-point type.                   |

---

## String Matchers

Designed for matching C strings, `std::string`, and wide strings.

| Matcher                | Meaning                                      |
|------------------------|----------------------------------------------|
| `StrEq(string)`        | argument equals string.                       |
| `StrNe(string)`        | argument does not equal string.               |
| `StrCaseEq(string)`    | equals string ignoring case.                  |
| `StrCaseNe(string)`    | not equals string ignoring case.              |
| `StartsWith(prefix)`   | argument starts with `prefix`.                |
| `EndsWith(suffix)`     | argument ends with `suffix`.                   |
| `HasSubstr(string)`    | argument contains `string` as substring.     |
| `IsEmpty()`            | argument is empty string.                      |
| `MatchesRegex(regex)`  | argument matches entire regex.                 |
| `ContainsRegex(regex)` | argument contains substring matching regex.  |
| `WhenBase64Unescaped(m)` | argument decoded from base64 matches `m`.  |

**Examples:**

```cpp
EXPECT_THAT(str, StartsWith("Hello"));
EXPECT_THAT(str, HasSubstr("world"));
EXPECT_THAT(str, MatchesRegex(".*foo.*"));
```

---

## Exception Matchers

Used to verify that callable objects throw exceptions of specific types or with specific messages.

| Matcher                    | Description                               |
|----------------------------|-------------------------------------------|
| `Throws<E>()`              | callable throws exception of type `E`.   |
| `Throws<E>(m)`             | callable throws exception `E` satisfying matcher `m`. |
| `ThrowsMessage<E>(m)`      | exception `E` thrown has message matching `m`. |

**Example:**

```cpp
auto fn = [] { throw std::runtime_error("error"); };
EXPECT_THAT(fn, Throws<std::runtime_error>());
EXPECT_THAT(fn, ThrowsMessage<std::runtime_error>(HasSubstr("error")));
```

---

## Container Matchers

Designed for STL-style containers (and compatible types like arrays).

| Matcher                      | Meaning                                                        |
|------------------------------|----------------------------------------------------------------|
| `IsEmpty()`                  | container is empty `container.empty() == true`.               |
| `Contains(e)`                | container contains at least one element matching `e`.         |
| `Contains(e).Times(n)`       | contains elements matching `e` exactly `n` times.             |
| `ElementsAre(e0, e1, ..., en)` | container elements exactly match these in order.           |
| `ElementsAreArray(...)`      | same as `ElementsAre` but from array, container, or iterators.|
| `UnorderedElementsAre(e0, e1, ..., en)` | container elements match these, any order.              |
| `UnorderedElementsAreArray(...)` | same as above but from arrays or ranges.                    |
| `IsSupersetOf(...)`          | container contains a superset of the expected elements.        |
| `IsSubsetOf(...)`            | container contains a subset of the expected elements.          |
| `Pointwise(m, container)`    | container elements match pairwise using matcher `m`.          |
| `UnorderedPointwise(m, container)` | same as Pointwise but ignores order.                      |
| `BeginEndDistanceIs(m)`      | distance between `begin()` and `end()` matches `m`.            |
| `SizeIs(m)`                  | container size matches matcher `m`.                            |
| `ContainerEq(container)`     | container equals expected container, with helpful mismatch information. |
| `Each(e)`                    | all elements in container match `e`.                           |

**Example:**

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(set, Contains(Ge(10)));
EXPECT_THAT(sock_addrs, SizeIs(AnyOf(0, 2, 4)));
```

---

## Member Matchers

For verifying specific members or properties within complex objects.

| Matcher                         | Meaning                                                |
|---------------------------------|--------------------------------------------------------|
| `Field(&class::field, m)`       | object’s `field` matches `m`.                          |
| `Field(field_name, &class::field, m)` | same as above with better error message.          |
| `Property(&class::property, m)` | `property()` getter matches `m`.                      |
| `Property(property_name, &class::property, m)` | same as above with better error message.     |
| `Key(e)`                        | `pair.first` matches `e`.                              |
| `Pair(m1, m2)`                  | `pair.first` matches `m1` and `pair.second` matches `m2`. |
| `FieldsAre(m_1, m_2, ..., m_n)` | Each field of supported object matches corresponding matcher. |

**Notes:** `Property()` should only be used on member functions you own due to fragility.

**Example:**

```cpp
EXPECT_THAT(my_obj, Field(&MyClass::foo, Ge(42)));
EXPECT_THAT(my_pair, Pair(Ge(0), StartsWith("foo")));
EXPECT_THAT(my_struct, FieldsAre(1, "hello", Lt(5.0)));
```

---

## Matching Function or Functor Results

| Matcher             | Description                                  |
|---------------------|----------------------------------------------|
| `ResultOf(f, m)`    | `f(argument)` matches matcher `m`.          |
| `ResultOf(description, f, m)` | Same as above with better error message. |

---

## Pointer Matchers

Matchers related to pointer-based arguments.

| Matcher                | Meaning                                       |
|------------------------|-----------------------------------------------|
| `IsNull()`             | argument is a null pointer (raw or smart).   |
| `NotNull()`            | argument is a non-null pointer (raw or smart). |
| `Pointee(m)`           | pointer points to a value matching matcher `m`. |
| `Pointer(m)`           | pointer itself matches matcher `m`.           |
| `Address(m)`           | address of argument matches matcher `m`.       |
| `WhenDynamicCastTo<T>(m)` | dynamic_cast to `T` matches matcher `m`.    |

**Example:**

```cpp
EXPECT_CALL(mock, Foo(Pointee(Eq(42))));
EXPECT_THAT(ptr, NotNull());
EXPECT_THAT(obj, Address(Eq(&some_var)));
```

---

## Multi-argument Matchers

While matchers apply to single arguments, these support matching multiple arguments as tuples.

| Matcher                | Description                                        |
|------------------------|--------------------------------------------------|
| `AllArgs(m)`           | All arguments as tuple match `m`.                 |
| `Args<N1, N2, ...>(m)` | Selected argument indices tuple match `m`.        |
| `Eq()`, `Ge()`, `Gt()`, `Le()`, `Lt()`, `Ne()` | Match 2-tuple relations like equality, inequality etc. |

**Example:** Check first arg less than second arg.

```cpp
EXPECT_CALL(mock, Func(_, _)).With(Lt());
EXPECT_CALL(mock, Func(_, _)).With(AllArgs(Lt()));
EXPECT_CALL(mock, Func(_, _, _)).With(Args<0, 2>(Eq()));
```

---

## Composite Matchers

Combine matchers in expressive logical ways.

| Matcher            | Meaning                              |
|--------------------|------------------------------------|
| `AllOf(m1, m2, ...)` | Matches if all sub-matchers match.  |
| `AnyOf(m1, m2, ...)` | Matches if any sub-matcher matches. |
| `Not(m)`             | Matches if `m` does not match.       |
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` true, else `m2`. |

---

## Adapters for Matchers

| Adapter                | Description                              |
|------------------------|----------------------------------------|
| `MatcherCast<T>(m)`    | Casts matcher `m` to `Matcher<T>`.     |
| `SafeMatcherCast<T>(m)` | Safely casts matcher `m` to `Matcher<T>`. |
| `Truly(predicate)`     | Creates a matcher using a predicate function or functor. |

---

## Creating Custom Matchers

You can define your own matchers to encapsulate logic that isn’t covered by the built-ins.

Use the `MATCHER` family of macros for ease:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }

MATCHER_P(IsDivisibleBy, divisor, "") {
  *result_listener << "where the remainder is " << (arg % divisor);
  return (arg % divisor) == 0;
}
```

Then use in expectations and assertions:

```cpp
EXPECT_CALL(mock, Foo(IsEven()));
EXPECT_THAT(value, IsDivisibleBy(3));
```

The matcher body must be pure functional (no side effects). Use `*result_listener` to add helpful failure diagnostics.

---

## Best Practices

- Use `ON_CALL` for defining default behaviors that do not specify call expectations.
- Use `EXPECT_CALL` when you want to specify and verify that a call must occur with particular arguments.
- When matching complex argument structures, combine matchers like `AllOf`, `AnyOf`, and `Not`.
- Use named matchers to improve readability and maintainability of your tests.
- Avoid over-specifying expectations to prevent brittle tests.
- Use `SafeMatcherCast` when matching arguments with types that need safe conversion.

---

## Troubleshooting

- If unexpected calls happen, check that all expected calls are covered and argument matchers correctly describe input.
- Beware that default matchers make copies of values; for non-copyable objects, use `std::ref` or write custom matchers.
- Use `NiceMock` and `StrictMock` wrappers to control strictness and warnings around uninteresting calls.
- If matching overloaded methods, use `TypedEq` or `SafeMatcherCast` to disambiguate.
- For failure diagnostics, run tests with `--gmock_verbose=info` for detailed matcher call trace.

---

## Related Documentation and Resources

- [Mocking Reference](../reference/mocking.md) — How to create mock classes and configure expected behaviors.
- [Creating and Using Mocks Guide](../../guides/mocking-best-practices/creating-mocks.mdx) — Best practices in defining mocks.
- [Writing Expectations and Actions](../../guides/mocking-best-practices/writing-expectations-actions.mdx) — How to use `EXPECT_CALL`, `ON_CALL`, matchers, and actions.
- [Custom Matchers Guide](../../guides/advanced-testing-scenarios/custom-actions-matchers.mdx) — How to extend matchers and actions.
- [Assertions Reference](../reference/assertions.md) — Using matchers with GoogleTest assertions.
- [Matchers API](../matchers-actions-cardinalities/argument-matchers.md) — More extensive details.

---