---
title: "Test Entry Points and Initialization"
description: "Documents the entry point APIs for initializing GoogleMock and GoogleTest, including the provided main() implementations (gmock_main.cc and gtest_main.cc), custom initialization options, and guidelines for integration with different build systems."
---

# Test Entry Points and Initialization

## Overview

This documentation covers the essential entry points and initialization mechanisms provided by GoogleMock and GoogleTest. Users will learn how to properly initialize the testing framework, understand the role of the provided `main()` implementations, and integrate GoogleTest and GoogleMock initialization into their C++ projects and build systems.

This guide is vital for developers who want to ensure seamless startup of their test applications, whether they rely on the default `main()` implementations or need custom setup for special cases or platform constraints.

---

## 1. Initialization Functions

### 1.1 InitGoogleTest

GoogleTest initialization is performed by the `testing::InitGoogleTest()` function, which must be called before running any tests. Its responsibilities include:

- Parsing GoogleTest-specific command-line flags.
- Removing recognized flags from the argument list.
- Setting up necessary internal states for test discovery and execution.

By convention, this function accepts command-line arguments `argc` and `argv` (as pointers), but there are also overloads for Windows Unicode environments.

#### Usage Example
```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 1.2 InitGoogleMock

Because GoogleMock depends on GoogleTest, GoogleMock provides `testing::InitGoogleMock()` which calls `InitGoogleTest()` internally and additionally parses GoogleMock-specific flags. It supports multiple overloads to handle different platforms and argument types, including:

- Standard `int* argc, char** argv`.
- Windows-specific `int* argc, wchar_t** argv`.
- A no-argument overload for embedded or Arduino-like platforms.

#### Key Responsibilities

- Parses and consumes all GoogleMock flags (like `--gmock_verbose`).
- Initializes GoogleTest framework.
- Prepares both GoogleTest and GoogleMock for running tests.

#### Usage Example
```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

#### Windows Unicode Example
```cpp
int wmain(int argc, wchar_t** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

#### Embedded/Arduino Example
```cpp
void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

---

## 2. Default `main()` Implementations

GoogleTest and GoogleMock provide pre-built `main()` functions that users can link against to avoid writing their own entry points. These implementations handle all necessary initialization and test running.

### 2.1 GoogleTest `main()` - `gtest_main`

- Found in the file `src/gtest_main.cc`.
- Parses command-line flags using `InitGoogleTest()`.
- Calls `RUN_ALL_TESTS()` and returns its result.

#### Typical Use Case
Link your tests against `gtest_main` instead of `gtest` when you want a standard `main()` stub.

Example:
```cpp
// No need to write main(), link with gtest_main instead.
```

### 2.2 GoogleMock `main()` - `gmock_main`

- Found in the file `src/gmock_main.cc`.
- Calls `InitGoogleMock()` which initializes both GoogleTest and GoogleMock.
- Runs all tests with `RUN_ALL_TESTS()`.
- Outputs a console message before running tests.

#### Typical Use Case
Link your test executable with `gmock_main` when you want a pre-built `main()` that includes GoogleMock support.

Example command line link:
```cmake
target_link_libraries(my_tests gmock_main)
```

---

## 3. Custom Main Function Guidelines

While most users rely on the provided `main()` functions, some projects require customized initialization or integration with other frameworks.

### 3.1 Writing a Custom Main

If you require custom logic before or after tests run, implement your own `main()` following this best practice:

1. Call `testing::InitGoogleTest()` or `testing::InitGoogleMock()` early to parse flags and initialize the frameworks.
2. Perform any custom pre-test setup.
3. Call `RUN_ALL_TESTS()` once only.
4. Return the result of `RUN_ALL_TESTS()` as your program exit code.

#### Sample Custom Main
```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  // Custom setup code here

  int result = RUN_ALL_TESTS();

  // Custom teardown code here

  return result;
}
```

### 3.2 Important Notes

- Do **not** ignore the return value of `RUN_ALL_TESTS()`; it must be returned by `main()` for correct test reporting in CI.
- Call `RUN_ALL_TESTS()` only once; repeated calls may break advanced features.
- Always initialize the framework using the `Init` functions before running tests.

---

## 4. Platform-Specific Initialization

### 4.1 Embedded and Arduino Platforms

On platforms like ESP8266, ESP32, or Arduino with NRF52, the entry point is different. GoogleTest and GoogleMock provide special `setup()` and `loop()` functions to run tests:

```cpp
void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

### 4.2 Windows Unicode Entry Point

Windows applications compiled in Unicode mode may require using `wmain` or `_tmain`. GoogleMock's `InitGoogleMock()` accepts wide-character arguments to support this.

```cpp
int wmain(int argc, wchar_t** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 5. Handling Command-Line Flags

GoogleMock and GoogleTest parse their respective flags during the init calls:

- Recognized flags are removed from `argv` and the count is adjusted accordingly.
- Unrecognized flags remain untouched for the application to handle or report errors.

Example recognized flags:

- GoogleMock: `--gmock_verbose`, `--gmock_default_mock_behavior`, etc.
- GoogleTest: `--gtest_filter`, `--gtest_output`, etc.

If a flag is unrecognized by GoogleMock but known to your application, it will still appear in `argv` post-initialization.

---

## 6. Integration with Build Systems

### 6.1 Linking with `gmock_main` or `gtest_main`

Your build system (e.g., CMake or Bazel) should link your test binaries against these libraries to automatically obtain a proper `main()`:

- `gtest_main` for test-only projects.
- `gmock_main` when using mocks.

Example CMake:
```cmake
find_package(GTest REQUIRED)
find_package(GMock REQUIRED)

add_executable(my_tests test_main.cpp ...)
target_link_libraries(my_tests GMock::gmock_main GTest::gtest)
```

### 6.2 When to Write a Custom `main()`

Write your own `main()` only if:

- You need pre- or post-test logic.
- Your platform requires non-standard initialization.
- You want custom behavior beyond the default test runner.

Otherwise, prefer the convenience of linking with `gmock_main` or `gtest_main`.

---

## 7. Troubleshooting Common Initialization Issues

### Symptoms

- Tests not running or no output.
- Flags are ignored or cause errors.
- Linker errors related to `main()`.

### Resolutions

- Ensure you call `InitGoogleTest()` or `InitGoogleMock()` before running tests.
- Confirm you linked against `gmock_main` or `gtest_main` if not providing your own `main()`.
- Check argument passing to `InitGoogle*()` matches your platform's types.
- Avoid multiple calls to `RUN_ALL_TESTS()`.

---

## 8. Summary Diagram: Initialization Flow

```mermaid
flowchart TD
  Start([Program Start]) --> InitMock["Call testing::InitGoogleMock() or InitGoogleTest()"]
  InitMock --> ParseFlags["Parse and Remove Framework Flags"]
  ParseFlags --> CustomSetup["Optional: Custom User Setup"]
  CustomSetup --> RunTests["Run RUN_ALL_TESTS() once"]
  RunTests --> CustomTeardown["Optional: Custom User Teardown"]
  CustomTeardown --> End([Program Exit with RUN_ALL_TESTS() return code])
```

---

## 9. References and Next Steps

- Explore [GoogleTest Primer: Authoring Your First Test](/guides/getting-started/primer-basics) to understand writing tests after setup.
- See [Integrating with Build Systems](/guides/integration-scenarios/build-system-integration) for configuring CMake or Bazel projects.
- Consult [Troubleshooting Common Issues](/getting-started/troubleshooting-help/common-issues) if initialization problems arise.
- For mocking, review [Introduction to Mocking](/guides/getting-started/mocking-primer) and [Mock Methods API](/api-reference/core-mocking-apis/mock-methods).

---

## Appendix: Complete Minimal Custom Main Example

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  // Initialize GoogleMock and GoogleTest.
  testing::InitGoogleMock(&argc, argv);

  // Optional: pre-test setup can go here.

  // Run all tests and store the result.
  int test_result = RUN_ALL_TESTS();

  // Optional: post-test teardown can go here.

  // Return test result as program exit code.
  return test_result;
}
```

---

This comprehensive guide empowers users to initialize and start running tests effectively, adapting to their platform or project-specific requirements with confidence.