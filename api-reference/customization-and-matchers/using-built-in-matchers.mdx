---
title: "Using Built-in Matchers"
description: "Reference to the suite of provided matchers for comparing values, strings, containers, and more. Demonstrates matcher syntax, composition, and integration into test assertions."
---

# Using Built-in Matchers

GoogleTest provides a rich and expressive suite of **built-in matchers** designed to make your test assertions both concise and highly descriptive. These matchers help you compare values, strings, containers, and more with readable syntax that integrates seamlessly into your test code. This documentation focuses solely on these matchers, demonstrating their syntax, composition capabilities, and usage within assertions.

---

## Overview of Built-in Matchers
Built-in matchers offer a declarative way to specify which values are expected or accepted as arguments in mock method calls or to validate values directly in assertions using `EXPECT_THAT` or `ASSERT_THAT`.

### What is a Matcher?
A matcher is a predicate-like object that matches a single argument based on some condition. Unlike traditional value-based assertions, matchers enable more expressive and flexible conditions, such as ranges, partial string matches, and container structure validations.

### Using Matchers in Assertions

```cpp
EXPECT_THAT(actual_value, matcher);
ASSERT_THAT(actual_value, matcher);
```

These macros check whether the `actual_value` satisfies the `matcher` condition, providing informative failure messages that explain mismatches clearly.

### Using Matchers in GoogleMock Expectations
When setting expectations on mock methods, matchers specify which argument values the expectation applies to:

```cpp
EXPECT_CALL(mock_object, MethodName(matcher1, matcher2, ...));
```

You can combine matchers to target specific argument patterns while allowing flexibility where you don't need exact matches.

---

## Categories of Built-in Matchers
GoogleTest organizes built-in matchers into categories to cover common testing needs:

### 1. Wildcard Matchers
- `_`: Matches any value of the expected type.
- `A<T>()` or `An<T>()`: Matches any value of type `T`.

Example:

```cpp
EXPECT_CALL(mock, Method(_)); // Accepts any argument
EXPECT_CALL(mock, Method(A<int>())); // Accepts any int
```

### 2. Generic Comparison Matchers
Match argument values using common relational operators:

| Matcher       | Meaning                             |
|---------------|-----------------------------------|
| `Eq(v)`       | equals value `v`                   |
| `Ne(v)`       | not equals value `v`               |
| `Lt(v)`       | less than `v`                     |
| `Le(v)`       | less than or equal to `v`          |
| `Gt(v)`       | greater than `v`                  |
| `Ge(v)`       | greater than or equal to `v`       |

Example:

```cpp
EXPECT_CALL(mock, SetValue(Ge(10))); // Argument >= 10
```

### 3. Floating-Point Matchers
Use specialized matchers that correctly handle floating-point comparisons, including NaNs and approximate equality:

- `DoubleEq(value)`, `FloatEq(value)`: approximate equality.
- `NanSensitiveDoubleEq(value)`, `NanSensitiveFloatEq(value)`: treat NaNs as equal.
- `DoubleNear(value, max_abs_error)`, `FloatNear(value, max_abs_error)`: approximate within error bounds.

### 4. String Matchers
Convenient matchers for common string validation:

| Matcher              | Description                               |
|----------------------|-------------------------------------------|
| `StartsWith(prefix)` | Matches if string starts with `prefix`   |
| `EndsWith(suffix)`   | Matches if string ends with `suffix`      |
| `HasSubstr(substr)`  | Matches if string contains `substr`       |
| `StrEq(str)`         | Matches strings exactly equal to `str`   |
| `StrNe(str)`         | Matches strings not equal to `str`        |
| `StrCaseEq(str)`     | Case-insensitive equality                 |
| `StrCaseNe(str)`     | Case-insensitive inequality               |
| `ContainsRegex(re)`  | Matches strings matching regex anywhere   |
| `MatchesRegex(re)`   | Matches entire string against regex       |
| `WhenBase64Unescaped(m)` | For Base64-encoded strings decoded and matched by `m` |

Example:

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(value, HasSubstr("world"));
```

### 5. Container Matchers
Match common aspects of STL-style containers:

| Matcher                         | Description                               |
|---------------------------------|-------------------------------------------|
| `ElementsAre(elem_matchers...)` | Matches container elements in order     |
| `ElementsAreArray(container)`    | Like `ElementsAre`, from array or container |
| `UnorderedElementsAre(...)`      | Matches elements in any order            |
| `UnorderedElementsAreArray(...)`| Like `UnorderedElementsAre` but from array/container |
| `Contains(matcher)`              | At least one element matches             |
| `Each(matcher)`                 | All elements match                        |
| `SizeIs(matcher)`               | Container size matches condition          |
| `BeginEndDistanceIs(matcher)`   | Distance between iterators matches       |
| `IsSubsetOf(container)`         | Container is subset of another            |
| `IsSupersetOf(container)`       | Container is superset of another          |
| `Pointwise(m, container)`       | Matches pairwise elements via matcher `m` |
| `WhenSorted(matcher)`            | Matches if container sorted matches `m` |
| `WhenSortedBy(comparator, m)`  | Matches when sorted with comparator       |

Example:

```cpp
EXPECT_THAT(vec, ElementsAre(1, Gt(0), _, 5));
EXPECT_THAT(set, Contains(42));
EXPECT_THAT(map, Contains(Pair(Eq("key"), _)));
```

### 6. Member Matchers
Match specific fields or properties within objects:

| Matcher              | Matches                                                     |
|----------------------|------------------------------------------------------------|
| `Field(&Class::field, matcher)` | Object's field matches matcher                      |
| `Property(&Class::getter, matcher)` | Object's getter result matches matcher            |
| `Key(matcher)`       | For pairs and maps, matches the `first` element (key)     |
| `Pair(matcher1, matcher2)` | Matches pair elements with two matchers respectively       |

Example:

```cpp
EXPECT_THAT(obj, Field(&MyClass::value, Ge(10)));
EXPECT_THAT(pair, Pair(Eq(1), HasSubstr("foo")));
```

### 7. Pointer Matchers

- `IsNull()`: Matches null pointers (raw or smart).
- `NotNull()`: Matches non-null pointers.
- `Pointee(matcher)`: Matches if the pointed-to value matches `matcher`.
- `Pointer(matcher)`: Matches by comparing pointer values.
- `Address(matcher)`: Matches by comparing object's address.
- `WhenDynamicCastTo<T>(matcher)`: Matches if `dynamic_cast<T>` succeeds and matches the inner matcher (requires RTTI).

### 8. Multi-Argument Matchers
Support matching a subset or tuple of the arguments:

- `AllArgs(matcher)`: Matches whole tuple of arguments (identity of matcher).
- `Args<N1, N2, ..., Nk>(matcher)`: Matches a selection tuple of arguments.

Example:

```cpp
EXPECT_CALL(mock, Method(_, _)).With(AllArgs(Eq()));
EXPECT_CALL(mock, Method(_, _)).With(Args<0,1>(Gt()));
```

### 9. Composite Matchers
Combine multiple matchers:

- `AllOf(m1, m2, ..., mn)`: Matches if all matchers match.
- `AnyOf(m1, m2, ..., mn)`: Matches if any matcher matches.
- `Not(m)`: Matches if `m` does not match.
- `Conditional(cond, m1, m2)`: Matches `m1` if `cond` true, else `m2`.

Example:

```cpp
EXPECT_THAT(value, AllOf(Gt(5), Ne(10)));
EXPECT_THAT(value, Not(Lt(0)));
```

### 10. Adapters for Matchers

- `MatcherCast<T>(m)`: Explicitly casts matcher `m` to a matcher for `T`.
- `SafeMatcherCast<T>(m)`: Performs type-safe casting with checks.
- `Truly(predicate)`: Turns an arbitrary predicate (function or functor) into a matcher.

Example:

```cpp
EXPECT_CALL(mock, Foo(Truly([](int x){return x%2==0;})));
```

---

## Practical Matcher Usage Examples

### 1. Simple Equality and Wildcard
```cpp
EXPECT_CALL(mock, ProcessData(Eq(42), _));
EXPECT_THAT(value, Eq(100));
```

### 2. Range Match with Composite Matchers
```cpp
EXPECT_CALL(mock, SetLevel(AllOf(Ge(1), Le(10))));
EXPECT_THAT(result, AnyOf(Eq("ok"), Eq("success")));
```

### 3. String Matching
```cpp
EXPECT_THAT(name, StartsWith("John"));
EXPECT_THAT(log, HasSubstr("Warning"));
EXPECT_THAT(response, MatchesRegex("[0-9]+ units"));
```

### 4. Container Validation
```cpp
EXPECT_THAT(numbers, ElementsAre(1, Gt(0), _, 5));
EXPECT_THAT(map, Contains(Pair(Eq("key"), _)));
EXPECT_THAT(data, Each(Lt(100)));
```

### 5. Member Field Matching
```cpp
EXPECT_THAT(user, Field(&User::age, Ge(18)));
EXPECT_THAT(entry, Pair(Eq("id"), StartsWith("abc")));
```

### 6. Pointer and Optional Type Matching
```cpp
EXPECT_THAT(ptr, NotNull());
EXPECT_THAT(opt_value, Optional(Eq(10)));
EXPECT_THAT(smart_ptr, Pointee(Ge(0)));
```

---

## Crafting Effective Matchers

- Use **wildcard matcher** `_` when the argument value doesn't matter.
- Use **specific matchers** (`Eq()`, `Gt()`, etc.) to enforce constraints selectively.
- Combine matchers for **complex conditions** via `AllOf()`, `AnyOf()`, and `Not()`.
- For **container arguments**, leverage `ElementsAre()`, `Contains()`, and related matchers to verify contents without verbose loops.
- Use **member matchers** (`Field()`, `Property()`) to pinpoint object internals without writing verbose code.
- Cast matchers explicitly with `SafeMatcherCast<T>()` when needed for overloaded functions or type mismatches.

<Tip>
When writing expectations with mock methods, prefer starting with **catch-all** expectations using `_` and `Times(AnyNumber())` to avoid noisy warnings about uninteresting calls. Then add **specific** expectations that verify behavior critical for your tests.
</Tip>

<Warning>
Avoid over-specifying expectations. Excessively strict matchers make tests brittle and hard to maintain.
</Warning>

---

## Troubleshooting Common Matcher Pitfalls

### Issue: Unexpected Match Failures
Verify you are not implicitly relying on constructor conversions that change behavior. Use explicit matchers like `Eq()` or `TypedEq<type>()` for clarity.

### Issue: Matcher Does Not Seem to Match Correctly
Make sure the matcher type matches the argument type or explicitly cast using `SafeMatcherCast<T>()`.

### Issue: Uninteresting Mock Function Calls Warning
Add a catch-all expectation with `Times(AnyNumber())` or wrap your mock in `NiceMock` to suppress these warnings.

### Issue: Overloaded Method Ambiguity
Disambiguate overloaded methods in expectations using typed matchers or explicit static casts.

---

## Related Topics and Next Steps

- [Defining Custom Matchers](https://github.com/google/googletest/blob/main/api-reference/customization-and-matchers/defining-custom-matchers) for crafting domain-specific assertions.
- [Assertions and Expectations](https://github.com/google/googletest/blob/main/api-reference/gtest-core-apis/assertions-and-expectations) to combine with matcher usage.
- [Mocking Basics and Advanced Mocking Patterns](https://github.com/google/googletest/blob/main/guides/core-testing-workflows/mocking-basics.md) for integrating matchers into mock expectations.
- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md) for a complete list and detailed explanation.

---

## Summary
This page equips you with comprehensive reference and practical guidance for using Google's built-in matchers effectively within GoogleTest and GoogleMock. Matchers provide the power to verify complex conditions on values and method arguments clearly and concisely. By mastering these matchers, you can write expressive, maintainable, and robust tests that accurately reflect your verification goals.

---

## Code Example Snippet
```cpp
#include <gmock/gmock.h>
using ::testing::_;
using ::testing::Ge;
using ::testing::HasSubstr;
using ::testing::ElementsAre;

class MockFoo {
 public:
  MOCK_METHOD(void, Process, (int, const std::string&), ());
};

TEST(FooTest, ExampleMatchers) {
  MockFoo mock;

  EXPECT_CALL(mock, Process(Ge(10), HasSubstr("test")));

  mock.Process(12, "my test string");  // Matches expectation
}
```
