---
title: "Argument Matchers"
description: "Complete guide to built-in and custom argument matchers for flexible expectation definition. Covers commonly used matchers, composition, polymorphic matchers, and extension points for user-defined matchers."
---

# Argument Matchers

GoogleMock's argument matchers provide powerful, flexible ways to specify expectations for mock method arguments. They enable precise control over which calls match and facilitate detailed test assertions.

This guide offers a complete overview of built-in and custom argument matchers: from simple wildcards to polymorphic matchers, composition techniques, and extending matchers to meet specialized needs.

---

## Table of Contents

- [What Are Argument Matchers?](#what-are-argument-matchers)
- [Basic Matchers](#basic-matchers)
- [Comparison Matchers](#comparison-matchers)
- [String Matchers](#string-matchers)
- [Pointer and Reference Matchers](#pointer-and-reference-matchers)
- [Composite Matchers](#composite-matchers)
- [Multi-argument Matchers and Selectors](#multi-argument-matchers-and-selectors)
- [Custom Matchers](#custom-matchers)
- [Polymorphic Matchers](#polymorphic-matchers)
- [Best Practices and Tips](#best-practices-and-tips)
- [Troubleshooting Common Pitfalls](#troubleshooting-common-pitfalls)

---

## What Are Argument Matchers?

Argument matchers tell GoogleMock how to identify and validate arguments passed to mock methods. Instead of fixed values, matchers act as predicates that test the properties of arguments, enabling flexible and expressive expectations.

Matchers can be used inside `EXPECT_CALL()` and `ON_CALL()` to:

- Specify exact or partial argument matches,
- Combine multiple match conditions,
- Match complex or nested argument types,
- Verify call patterns based on argument characteristics.

Example:

```cpp
EXPECT_CALL(mock, Foo(Ge(5), NotNull()));
```
Here, `Foo` is expected to receive a first argument ≥ 5 and a second argument that is a non-null pointer.

---

## Basic Matchers

### Wildcards

- `_`: Matches any value of the correct type (a universal wildcard).
- `A<T>()` or `An<T>()`: Matches any value of type `T`. Useful when you want the matcher to be explicit about the type.

Example:

```cpp
EXPECT_CALL(mock, Bar(_));  // Accepts any argument.
EXPECT_CALL(mock, Bar(A<int>()));  // Matches any int.
```

### Equality and Inequality

- `Eq(value)` or simply `value`: Matches arguments equal to `value`.
- `Ne(value)`: Matches arguments not equal to `value`.

Use `Eq` explicitly for clarity and to avoid surprises with implicit conversions.

Example:

```cpp
EXPECT_CALL(mock, SetValue(Eq(42)));
```

### Truth Values

- `IsTrue()`: Matches arguments evaluating to `true`.
- `IsFalse()`: Matches arguments evaluating to `false`.


---

## Comparison Matchers

Matchers comparing values or tuples:

| Matcher | Description |
|---------|-------------|
| `Ge(value)` | Matches argument >= value |
| `Gt(value)` | Matches argument > value |
| `Le(value)` | Matches argument <= value |
| `Lt(value)` | Matches argument < value |

Example:

```cpp
EXPECT_CALL(mock, Update(Ge(0)));  // Argument >=0
```

---

## String Matchers

GoogleMock offers matchers for strings (both narrow and wide).

| Matcher | Description |
|---------|-------------|
| `StrEq(s)` | Matches string exactly equal to `s` |
| `StrNe(s)` | Matches string not equal to `s` |
| `StrCaseEq(s)` | Matches string equal to `s`, ignoring case |
| `StrCaseNe(s)` | Matches string not equal to `s`, ignoring case |
| `HasSubstr(s)` | Matches string containing substring `s` |
| `StartsWith(s)` | Matches string starting with `s` |
| `EndsWith(s)` | Matches string ending with `s` |
| `ContainsRegex(regex)` | Matches string matching the regex anywhere |- exact match is `MatchesRegex(regex)` |
| `WhenBase64Unescaped(m)` | Matches base64-encoded strings that decode to matching `m` |

Example:

```cpp
EXPECT_CALL(mock, SetName(StartsWith("Dr.")));
```

---

## Pointer and Reference Matchers

- `IsNull()`: Matches any null raw or smart pointer.
- `NotNull()`: Matches any non-null raw or smart pointer.
- `Ref(variable)`: Matches an argument that references the given variable. Useful to test for reference identity.
- `Pointee(matcher)`: Matches a pointer whose pointee matches `matcher`. It accounts for null pointers by automatic failing.
- `Pointer(matcher)`: Matches a pointer (raw or smart) that matches the given matcher on the raw pointer.
- `Address(matcher)`: Matches an object whose address matches the matcher.
- `WhenDynamicCastTo<T>(matcher)`: Matches if dynamic_cast to type `T` succeeds and matches the given matcher.

Example:

```cpp
EXPECT_CALL(mock, Process(Pointee(Eq(5))));  // Pointer to 5
int x = 10;
EXPECT_CALL(mock, Update(Ref(x)));  // Argument references x
```

---

## Composite Matchers

You can combine matchers to form logical compositions:

- `AllOf(m1, m2, ...)`: Matches if all `m1` to `mn` match.
- `AnyOf(m1, m2, ...)`: Matches if any of `m1` to `mn` match.
- `Not(m)`: Matches if `m` does not.
- `Conditional(cond, m1, m2)`: Matches `m1` if `cond` is true, else `m2`.

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(0), Lt(10))));
EXPECT_CALL(mock, Bar(Not(IsNull())));
```

---

## Multi-argument Matchers and Selectors

Some built-in matchers operate on tuples representing multiple arguments:

- `Eq()`, `Ne()`, `Ge()`, `Gt()`, `Le()`, `Lt()`: act on pairs of arguments (2-tuples).

To match subsets or reorderings of arguments:

- `AllArgs(m)`: Matches all arguments as a tuple against matcher `m`.
- `Args<N1, N2, ..., Nk>(m)`: Matches only the selected argument indices (0-based) against `m`.

Supports advanced validations on argument tuples in `.With()` clauses in `EXPECT_CALL` or `ON_CALL`.

Example:

```cpp
EXPECT_CALL(mock, Func(_, _))
    .With(Lt());  // First arg < second arg
EXPECT_CALL(mock, Func(_, _, _))
    .With(Args<0, 2>(Gt()));  // Arg0 > Arg2
```

---

## Custom Matchers

GoogleMock allows defining custom matchers with expressive messages.

- Use the `MATCHER(name, description)` macro for a simple matcher.
- Use `MATCHER_P(name, param, description)` and variants (`MATCHER_P2`, etc.) for parameterized matchers.

Example:

```cpp
MATCHER(IsDivisibleBy, "", "is divisible by " + PrintToString(n)) {
  if (arg % n == 0) return true;
  *result_listener << "the remainder is " << (arg % n);
  return false;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy(3)));
```

Alternatively, implement matcher interfaces directly for advanced usage and better type control.

---

## Polymorphic Matchers

Polymorphic matchers behave correctly for multiple types without explicit casts.

Examples include:

- `Eq(value)` can match any type convertible to the value's type.
- `A<T>()` matches any value of type `T`.
- `IsNull()`, `NotNull()` match any pointer type.

You can create polymorphic matchers by defining matcher classes with templated `MatchAndExplain()` methods and returning `MakePolymorphicMatcher()` wrappers.

Example:

```cpp
class IsEvenMatcher {
 public:
  template <typename T>
  bool MatchAndExplain(const T& x, MatchResultListener* listener) const {
    return x % 2 == 0;
  }
  void DescribeTo(std::ostream* os) const { *os << "is even"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is odd"; }
};

PolymorphicMatcher<IsEvenMatcher> IsEven() {
  return MakePolymorphicMatcher(IsEvenMatcher());
}

EXPECT_CALL(mock, Foo(IsEven()));
```

---

## Best Practices and Tips

- Use `_` generously for arguments you don't care about to avoid brittle tests.
- Prefer explicit matchers like `Eq()` over relying on implicit conversions.
- When matching containers, use `ElementsAre()`, `UnorderedElementsAre()`, and related matchers for clarity.
- Use `.With()` on `EXPECT_CALL` to enforce relations between arguments as a tuple.
- When matching move-only types, use lambdas or functors for actions.
- Use `Ref()` when you want to ensure the argument is a reference to a specific object.
- Write custom matchers with clear, helpful failure messages.
- Take advantage of polymorphic matchers to simplify overloads and implicit casts.

---

## Troubleshooting Common Pitfalls

- **Overly strict matchers make tests fragile:** Avoid matching every argument if not necessary.
- **Mismatch between expected argument and matcher types:** Use `SafeMatcherCast<T>()` to adapt matchers safely.
- **Unexpected calls due to lack of catch-all expectations:** Add `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` to permit all other calls.
- **Unintended copies with non-copyable types:** Use `Eq(std::ref(obj))` and avoid modifying `obj` after.
- **Side effects in matchers:** Matchers must be pure functions without side effects.

---

For more detailed examples and advanced concepts, please refer to the following related documentation:

- [Mock Methods and Macros](mock-methods-api.md) — How to define mocks.
- [Expectations and Call Specification](expectations-api.md) — Using `EXPECT_CALL` and `ON_CALL` effectively.
- [Actions and Return Behaviors](actions-api.md) — How to specify mock behaviors.
- [Using GoogleMock Effectively](using-googlemock-effectively.md) — Best practices and workflows.

---

<Check>
Maximize test clarity, maintainability, and robustness by using matchers thoughtfully. Master basic to polymorphic matchers to handle any argument type.
</Check>

<Note>
Explore custom matchers when existing ones don’t suffice. Use `MATCHER` macros for quick definitions and implement the matcher interface for more control.
</Note>

<Tip>
Use the `.With()` clause in `EXPECT_CALL` for multi-argument argument validations, especially when argument interdependency matters.
</Tip>

## Code Example: Using Various Argument Matchers

```cpp
using ::testing::_;         // Wildcard
using ::testing::Eq;        // Equality
using ::testing::Ne;        // Inequality
using ::testing::Gt;        // Greater than
using ::testing::StartsWith;
using ::testing::Pointee;
using ::testing::Ref;

class MockFoo {
public:
  MOCK_METHOD(void, Process, (int a, const std::string& s, int* p), ());
};

TEST(FooTest, MatchersExample) {
  MockFoo mock;

  // Expect Process to be called with:
  // - first arg > 10
  // - second arg starting with "hello"
  // - third arg pointing to 42
  int x = 42;
  EXPECT_CALL(mock, Process(Gt(10), StartsWith("hello"), Pointee(Eq(x))));

  int value = 42;
  mock.Process(15, "hello world", &value);  // Matches
}
```

---

## Additional Resources

- [Matchers Reference](matchers.md) — Catalog of all standard matchers.
- [gMock Cookbook](gmock_cook_book.md) — Recipes and examples for mocking and matchers.
- [Writing New Matchers Quickly](gmock_cook_book.md#NewMatchers) — Defining custom matchers.
- [Expectations and Call Specification](expectations-api.md) — Using matchers in `EXPECT_CALL`.

---

<Source url="https://github.com/google/googletest" paths=[{"path":"googlemock/include/gmock/gmock-matchers.h","range":"1-1000"},{"path":"googlemock/test/gmock-matchers-comparisons_test.cc","range":"1-300"},{"path":"googlemock/include/gmock/gmock-spec-builders.h","range":"1-400"}]" branch="main" />
