---
title: "Assertions and Test Macros"
description: "Definitive guide to GoogleTest assertions—including equality, exception, and fatal/non-fatal conditions—empowering developers to write expressive, robust unit tests. Includes code snippets and expected failure behaviors."
---

# Assertions and Test Macros

GoogleTest provides a rich suite of assertions and test macros to help C++ developers write clear, expressive, and robust unit tests. This guide covers the different types of assertions—including equality assertions, exception assertions, and fatal vs non-fatal conditions—empowering you to verify program correctness and handle expected failures gracefully.

---

## 1. Understanding Assertions

Assertions are the foundation of writing tests. Their primary purpose is to confirm that your code behaves as expected at runtime by verifying values, conditions, or interactions.

### 1.1 Types of Assertions

- **Predicate Assertions:** Validate boolean expressions.
- **Equality Assertions:** Compare values or objects for equality or inequality.
- **Exception Assertions:** Check if code throws or does not throw expected exceptions.
- **Fatal vs Non-Fatal:** Fatal assertions abort the current test immediately on failure, while non-fatal assertions continue execution.

Use the right type depending on how critical the condition is and how soon you want the test to stop when it fails.

### 1.2 When to Use Assertions

Begin your test with conditions that must hold; these often warrant **fatal assertions**. Use **non-fatal assertions** when you want to collect multiple failures in one test run for comprehensive feedback.

---

## 2. Key Assertion Macros

GoogleTest offers a rich set of macros to write assertions succinctly. Below are the most vital and common ones.

### 2.1 Equality Assertions

These check if values are equal or not.

- `ASSERT_EQ(expected, actual)` — **Fatal**, test stops if fails.
- `EXPECT_EQ(expected, actual)` — Non-fatal, test continues.
- `ASSERT_NE(expected, actual)` and `EXPECT_NE(expected, actual)` — Checks inequality.

**Example:**
```cpp
TEST(MathTest, Addition) {
  int sum = Add(2, 3);
  ASSERT_EQ(5, sum);  // Stops test here if sum != 5
  EXPECT_NE(10, sum); // Reports failure but keeps running
}
```

### 2.2 Predicate Assertions

Use for generic boolean expressions.

- `ASSERT_TRUE(condition)` / `EXPECT_TRUE(condition)` — expects `true`
- `ASSERT_FALSE(condition)` / `EXPECT_FALSE(condition)` — expects `false`

Example:
```cpp
EXPECT_TRUE(IsPrime(7));
ASSERT_FALSE(IsPrime(4));
```

### 2.3 Exception Assertions

To verify exception handling behavior.

- `ASSERT_THROW(statement, ExceptionType)`
- `EXPECT_THROW(statement, ExceptionType)`
- `ASSERT_ANY_THROW(statement)`
- `EXPECT_ANY_THROW(statement)`
- `ASSERT_NO_THROW(statement)`
- `EXPECT_NO_THROW(statement)`

Example:
```cpp
ASSERT_THROW(ParseData("bad input"), std::invalid_argument);
EXPECT_NO_THROW(ParseData("good input"));
```

### 2.4 Fatal vs Non-Fatal Assertions

- **Fatal (`ASSERT_*`)**: On failure, immediately abort the current test function. Use when further testing is meaningless.
- **Non-Fatal (`EXPECT_*`)**: On failure, continue running the test. Useful for checking multiple related conditions.

Use fatal assertions early in tests to validate critical preconditions.

---

## 3. Expressive Assertions for Advanced Checks

### 3.1 Using `EXPECT_THAT` with Matchers

GoogleTest integrates well with GoogleMock matchers for expressive assertions on complex types.

Example:
```cpp
EXPECT_THAT(vec, ::testing::ElementsAre(1, 2, 3));
EXPECT_THAT(name, ::testing::StartsWith("John"));
```

### 3.2 Custom Assertions

You can create your own assertions using predicate formatter functions. This enhances readability and custom failure messages.

Example:
```cpp
::testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << n << " is not even.";
}

EXPECT_PRED_FORMAT1(IsEven, value);
```

---

## 4. Common Usage Patterns and Recommendations

### 4.1 Use `ASSERT_*` to Halt on Critical Failures

If a failure means the rest of the test is invalid (e.g., resource initialization), use fatal assertions.

### 4.2 Use `EXPECT_*` to Continue Testing After Minor Failures

For multiple non-dependent checks, prefer non-fatal assertions to get full failure reports at once.

### 4.3 Prefer `EXPECT_EQ` Over Manual Boolean Checks

Example:
```cpp
EXPECT_EQ(expected_size, container.size());
```

This gives clearer failure messages compared to `EXPECT_TRUE(container.size() == expected_size)`.

### 4.4 Avoid Over-Specification

Write assertions that focus on intent, avoid testing internal implementation details.

### 4.5 Clear Failure Messages

Ensure failure messages are meaningful and provide the context to accelerate debugging.

---

## 5. Examples of Assertion Usage

### Example: Testing Mathematical Operations
```cpp
TEST(CalculatorTest, TestAddition) {
  Calculator calc;
  EXPECT_EQ(10, calc.Add(7, 3));
  EXPECT_NE(0, calc.Add(1, 1));
}
```

### Example: Testing Exception Throwing
```cpp
TEST(ParserTest, HandlesBadInput) {
  Parser parser;
  ASSERT_THROW(parser.Parse(""), std::invalid_argument);
  EXPECT_NO_THROW(parser.Parse("valid input"));
}
```

### Example: Test with Multiple Assertions
```cpp
TEST(StringUtilsTest, TestStringManipulation) {
  std::string s = "Hello World";
  EXPECT_EQ(11, s.size());
  EXPECT_TRUE(s.find("World") != std::string::npos);
  EXPECT_THAT(s, ::testing::HasSubstr("Hello"));
}
```

---

## 6. Troubleshooting Assertion Failures

- **Assertion fails unexpectedly?** Run tests with verbose output (`--gtest_verbose=info`) to trace the exact failure point.

- **Unclear error messages?** Use `EXPECT_THAT` with matchers for better context.

- **Test continues after fatal failures?** Verify that you are not mixing fatal and non-fatal assertions wrongly.

- **Multiple failures hide root cause?** Consider limiting assertions or splitting tests to isolate failures.

---

## 7. Supplementary Resources

- [Using Assertions and Matchers Guide](https://github.com/google/googletest/blob/main/guides/core-testing-workflows/using-assertions-and-matchers.mdx)
- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md)
- [GoogleMock Cheat Sheet](https://github.com/google/googletest/blob/main/docs/gmock_cheat_sheet.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)

---