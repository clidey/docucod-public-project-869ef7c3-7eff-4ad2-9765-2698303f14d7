---
title: "Core & Polymorphic Matchers"
description: "Presents the built-in matching constructs for value, comparison, and equivalence checks, covering shipping matchers like Eq, Ne, Lt, and polymorphic matchers for generic code. Includes usage patterns, limitations, and custom extension guidance."
---

# Core & Polymorphic Matchers

This page presents the rich set of built-in matchers provided by GoogleMock, designed for value, comparison, and equivalence checks. It covers fundamental matchers like `Eq`, `Ne`, `Lt`, and others, alongside polymorphic matchers that provide flexibility for generic code. You'll find usage patterns, practical tips, limitations, and guidance on extending matchers with your own implementations.

---

## Overview of Matchers

Matchers are predicates that specify criteria to verify function argument values during testing. They help you express expectations in a natural, declarative way and generate clear, descriptive failure messages.

Matchers in GoogleMock come in two flavors:

- **Core Matchers:** Basic, commonly-used matchers for equality and relational comparisons.
- **Polymorphic Matchers:** Matchers that adapt to the type of the value being matched, allowing reuse across different argument types.

The combination of these matchers enables precise and flexible argument validation in mocks.

---

## Commonly Used Core Matchers

GoogleMock provides a comprehensive set of comparison matchers, each serving a specific purpose:

| Matcher | Description |
| ------- | ----------- |
| `Eq(value)` | Matches if the argument is equal to the specified value, using `operator==`.
| `Ne(value)` | Matches if the argument is not equal to the specified value.
| `Lt(value)` | Matches if the argument is less than the specified value.
| `Le(value)` | Matches if the argument is less than or equal to the specified value.
| `Gt(value)` | Matches if the argument is greater than the specified value.
| `Ge(value)` | Matches if the argument is greater than or equal to the specified value.

These can be used directly in `EXPECT_CALL()` or `EXPECT_THAT()` assertions to specify expectations clearly.

### Example Usage of Core Matchers

```cpp
using ::testing::Eq;
using ::testing::Lt;
using ::testing::Ne;

EXPECT_CALL(mock, Foo(Eq(42)));
EXPECT_THAT(value, Lt(10));
EXPECT_THAT(obj.member, Ne(expected_value));
```

In these examples, `Foo()` is expected to be called with `42`, `value` must be less than `10`, and `obj.member` must not equal `expected_value`.

---

## Polymorphic Matchers

Polymorphic matchers provide generic, type-agnostic matching capabilities. You can use them across various types without explicit type annotations. Some key polymorphic matchers include:

| Matcher | Description |
| ------- | ----------- |
| `_` (underscore) | Matches any value of any type (wildcard).
| `IsNull()` | Matches any null raw or smart pointer.
| `NotNull()` | Matches any non-null raw or smart pointer.
| `Ref(variable)` | Matches an argument that is a reference to the exact variable.
| `IsNan()` | Matches any floating-point NaN value.
| `FloatingEq(value)` / `DoubleEq(value)` | Floating-point approximate equality with unit-in-the-last-place tolerance.

These polymorphic matchers simplify test writing by working automatically with the argument types.

### Example Usage of Polymorphic Matchers

```cpp
using ::testing::_;
using ::testing::NotNull;
using ::testing::Ref;

EXPECT_CALL(mock, Bar(_));           // Accepts any argument.
EXPECT_CALL(mock, Baz(NotNull()));   // Expects non-null pointer.

int some_var;
EXPECT_CALL(mock, Quux(Ref(some_var)));  // Expects argument to be a reference to some_var.
```

These allow you to express looser or more precise conditions without boilerplate.

---

## Composite and Advanced Matchers

GoogleMock provides ways to build composite matchers for complex scenarios:

- `AllOf(m1, m2, ...)`: Matches if *all* sub-matchers match.
- `AnyOf(m1, m2, ...)`: Matches if *any* sub-matcher matches.
- `Not(m)`: Matches if `m` does not match.
- `Between(m, n)`: Matches if value is in the inclusive range between `m` and `n` (via a user-defined matcher or combination).

You can also create custom matchers that evaluate multiple arguments together with `.With()` clause in `EXPECT_CALL`.

### Using Multi-Argument Matchers

When matching multiple arguments as a tuple, use `.With()` with a matcher of the arguments tuple. For example, to expect that the first argument is less than the second:

```cpp
EXPECT_CALL(mock, Function(_, _))
    .With(Lt());  // Built-in matcher working on two-argument tuple
```

Note: The matcher inside `.With()` must be a matcher of the tuple type of all arguments.

---

## String Matchers

Specialized matchers exist to compare string types, supporting:

- `StrEq(str)`: Case-sensitive equality.
- `StrNe(str)`: Case-sensitive inequality.
- `StrCaseEq(str)`: Case-insensitive equality.
- `StrCaseNe(str)`: Case-insensitive inequality.
- `HasSubstr(substring)`: Contains specified substring.
- `StartsWith(prefix)`: String starts with prefix.
- `EndsWith(suffix)`: String ends with suffix.

### Example

```cpp
EXPECT_THAT("hello world", StartsWith("hello"));
EXPECT_THAT(my_str, HasSubstr("world"));
```

These work with `std::string`, C strings, and in some cases, wide strings.

---

## Using Matchers with Standard Containers

GoogleMock integrates with STL and compatible containers through matchers like:

- `ElementsAre(elem1, elem2, ...)`: Matches container elements *in order*.
- `UnorderedElementsAre(elem1, elem2, ...)`: Matches container elements in *any order*.
- `Contains(matcher)`: Matches if the container has at least one element matching the matcher.

For associative containers, `Key(inner_matcher)` and `Pair(first_matcher, second_matcher)` help match keys and key-value pairs.

### Example

```cpp
EXPECT_CALL(mock, Process(std::vector<int>{1, 2, 3}));
EXPECT_CALL(mock, Process(ElementsAre(1, 2, 3)));
EXPECT_CALL(mock, Process(UnorderedElementsAre(3, 2, 1)));
EXPECT_CALL(mock, Process(Contains(Ge(10))));
```

---

## Writing Custom Matchers

If built-in matchers do not suffice, you can define your own matcher using:

- The `MATCHER` and `MATCHER_P` macros for quick definitions
- Implementing the matcher interface for full control

A simple matcher to check divisibility by 7 looks like:

```cpp
MATCHER(IsDivisibleBy7, "is divisible by 7") {
  return (arg % 7) == 0;
}
```

You can also provide meaningful descriptions and explain match failures clearly by streaming messages to `result_listener`.

---

## Best Practices & Limitations

- **Matchers Must Be Pure:** Matchers must have no side effects and behave deterministically.
- **Use Polymorphic Matchers for Generality:** They simplify code and reduce template complexity.
- **Order Your Expectations:** More specific expectations should be declared after general ones.
- **Be Cautious With Move-Only Types:** Built-in actions might not always support move-only arguments fully; lambdas can work around this.

---

## Extending Matchers

You can extend GoogleMock's matcher ecosystem by:

- Writing parameterized matchers with `MATCHER_P`, `MATCHER_P2`, etc.
- Using matcher combinators like `AllOf()`, `AnyOf()`, and `Not()`
- Implementing polymorphic matchers using `MakePolymorphicMatcher()`.

---

## Troubleshooting & Debugging

- When a matcher fails, GoogleMock explains which part failed and why.
- Use `EXPECT_THAT` with informative matchers for readable assertions.
- For advanced debugging, enable verbose logging with `--gmock_verbose=info`.

---

## Summary

The Core & Polymorphic Matchers page equips you with the essential tools to validate function arguments precisely and flexibly. Starting from basic equality and comparison to powerful polymorphic matchers and container-aware checks, this page sets the foundation for writing robust mock-based tests. Custom matcher creation is explained for advanced scenarios.

Explore related pages on [Using Matchers](https://github.com/google/googletest/blob/main/docs/guides/core-scenarios/using-matchers.md) and [Writing New Matchers Quickly](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#writing-new-matchers-quickly) for deeper insights.

---

[Back to API Reference](../api-reference.md)
