---
title: "Test Execution and Configuration"
description: "Explains available options for running tests, executing subsets, configuring output, and handling command-line flags. Details the mechanics of test discovery, execution flow, and reporting formats."
---

# Test Execution and Configuration

This section provides a detailed guide for running your tests, managing subsets, configuring outputs, and handling command-line flags within GoogleTest and GoogleMock. Whether you're running all tests, filtering specific ones, or controlling output formats, you'll find all necessary options and best practices here to efficiently manage your testing workflow.

---

## 1. Test Discovery and Execution Flow

GoogleTest automatically discovers tests through the use of the `TEST()` and `TEST_F()` macros (among others). Each test is registered at runtime, so you don't need to explicitly list or enumerate tests to run them.

- **Registration:** Tests are registered with a global registry during test program initialization.
- **Execution:** When you call `RUN_ALL_TESTS()`, GoogleTest executes each test suite and test in a deterministic order.
- **Isolation:** Each test runs in a fresh fixture instance, ensuring independence and repeatability.

The test program typically follows this flow:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);  // Parses flags and initializes
  return RUN_ALL_TESTS();                 // Runs all tests
}
```

### Filtering Tests

You can run only a subset of tests by specifying filters using the `--gtest_filter` flag. The filter supports positive and negative patterns separated by a hyphen (`-`), and patterns can contain wildcards (`*` and `?`). Examples:

- `--gtest_filter=MySuite.Test*` runs all tests in `MySuite` whose names start with `Test`.
- `--gtest_filter=MySuite.*-MySuite.BadTest` runs all tests in `MySuite` except `BadTest`.

The filtering mechanism also respects disabled tests (`DISABLED_` prefix) which are excluded by default unless explicitly included.

### Test Sharding

For large test suites or parallel testing, environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` allow test sharding. Each shard runs a subset of tests determined by the test index modulo total shards. The framework handles this automatically during test selection.

---

## 2. Command-Line Flags and Configuration Options

GoogleTest and GoogleMock provide a robust flags system to control test execution, verbosity, output format, filtering, and more. These flags are typically passed via the command line to the test executable and parsed during initialization.

### Common Flags Overview

| Flag                             | Description                                                                                          |
|----------------------------------|--------------------------------------------------------------------------------------------------|
| `--gtest_list_tests`             | Lists all available tests without running them.                                                  |
| `--gtest_filter=POSITIVE[-NEGATIVE]` | Runs tests matching positive patterns but not negative patterns.                                      |
| `--gtest_repeat=N`               | Repeats the entire test N times; negative values repeat forever.                                  |
| `--gtest_shuffle`                | Randomizes the order tests are run.                                                               |
| `--gtest_random_seed=N`          | Sets the seed for test shuffling.                                                                 |
| `--gtest_color=[yes|no|auto]`   | Controls colored output; defaults to 'auto'.                                                      |
| `--gtest_output=[xml|json][:path]` | Writes test results to an XML or JSON file at `path`. Default file name is `test_detail.xml` for XML. |
| `--gtest_brief`                  | Only prints test failures in console output.                                                     |
| `--gtest_print_time`             | Prints the time elapsed for each test; defaults to true.                                         |
| `--gtest_also_run_disabled_tests` | Runs tests marked as disabled in addition to regular tests.                                      |
| `--gtest_break_on_failure`       | Causes debug breakpoints on failure if running with a debugger.                                  |
| `--gtest_throw_on_failure`       | Causes failed assertions to throw exceptions for integration with other test frameworks.         |
| `--gtest_catch_exceptions`       | Enables catching exceptions to treat them as failures (default enabled).                         |

### GoogleMock Specific Flags

| Flag                               | Description                                                    |
|------------------------------------|----------------------------------------------------------------|
| `--gmock_verbose=[info|warning|error]` | Controls verbosity of GoogleMock output; levels include all info, warnings only, and errors only. |
| `--gmock_default_mock_behavior=[0|1|2]` | Sets default mock behavior: 0=NiceMock, 1=NaggyMock, 2=StrictMock. |
| `--gmock_catch_leaked_mocks`      | If true (default), reports leaked mock objects as failures.    |

---

## 3. Output Configuration and Reporting

### Text Console Output

By default, GoogleTest prints comprehensive test results to the console, including which tests ran, which passed, failed, or were skipped.

- Use `--gtest_brief` to limit console output to failures only.
- Use `--gtest_print_time=0` to disable elapsed time printing per test.
- Colored output is enabled by default on terminals but can be controlled via `--gtest_color`.

### Test Result Files

GoogleTest supports generating structured test results in XML or JSON formats, suitable for integration with CI systems and test reporting tools.

- Use the `--gtest_output` flag to specify the format and location, e.g.:
  - `--gtest_output=xml:filename.xml`
  - `--gtest_output=json:directory/`

When a directory path is specified, files are named based on the test executable name and made unique if needed.

### Streaming Test Results

On Linux/macOS, test results can be streamed over the network to a server using:

- `--gtest_stream_result_to=host:port`

This is mainly for real-time integration with custom test harnesses.

---

## 4. Handling Subsets and Selective Execution

### Running Disabled Tests

Tests prefixed with `DISABLED_` are skipped by default. To include them, use the flag:

```bash
--gtest_also_run_disabled_tests
```

### Running Specific Tests

For precise test selection, leverage:

- `--gtest_filter` as explained.
- Test sharding environment variables.

Advanced users can turn off specific tests or control execution by code, but these flags cover the most common use cases.

### Repeat and Retry

You can repeatedly run tests to hunt for flaky tests:

```bash
--gtest_repeat=10
```

Use a negative value to repeat indefinitely.

### Fail-Fast Behavior

Enable fail-fast mode to stop test execution after the first failure:

```bash
--gtest_fail_fast
```

This can speed up debugging by preventing subsequent tests from running after a failure.

---

## 5. Initialization and Command-Line Parsing

GoogleMock extends GoogleTest's command-line flags by introducing its own through `InitGoogleMock()`.

- Call `testing::InitGoogleMock(&argc, argv);` early in your `main()`. This will initialize GoogleTest and parse GoogleMock-specific flags.
- GoogleMock flags have the `--gmock_` prefix.
- Unrecognized flags remain in `argv` after initialization for user processing.

Example:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  // Run tests
  return RUN_ALL_TESTS();
}
```

Flags specific to GoogleMock include verbosity control (`--gmock_verbose`) and default mock behavior (`--gmock_default_mock_behavior`). Flags consumed by GoogleMock are removed from `argv`, enabling cleaner further command-line processing.

---

## 6. Practical Usage Scenarios and Examples

### Running All Tests with Verbose GoogleMock Output

```bash
./my_test_binary --gmock_verbose=info
```

This runs all tests with GoogleMock in informational verbosity mode.

### Running Only Specific Tests Matching a Pattern

```bash
./my_test_binary --gtest_filter=MySuite.MyTest
```

Runs only the specified test.

### Including Disabled Tests

```bash
./my_test_binary --gtest_also_run_disabled_tests
```

Runs all tests, including those disabled.

### Generating XML Test Report

```bash
./my_test_binary --gtest_output=xml:reports/test_results.xml
```

Outputs test results in XML format, stored in a specified location.

### Running Tests in Multiple Shards

Set environment variables:

```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0
./my_test_binary
```

Run subsequent shards by changing `GTEST_SHARD_INDEX` to 1, 2, and 3 for parallel test execution.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Command-Line and Initialization Issues">
<Accordion title="Unrecognized Flags Remain in argv After Initialization">
GoogleMockâ€™s `InitGoogleMock` removes recognized googlemock flags (`--gmock_...`) but leaves others untouched. Ensure you pass GoogleMock flags with the correct prefix and format. If flags appear unrecognized, confirm flag spelling and placement before calling initialization.
</Accordion>
<Accordion title="Tests Not Running Due to Filter or Disable Flags">
If no tests run, check if `--gtest_filter` excludes all tests or if tests are disabled (prefixed `DISABLED_`). Use `--gtest_also_run_disabled_tests` to include disabled tests.
</Accordion>
</AccordionGroup>

<AccordionGroup title="Output and Reporting Problems">
<Accordion title="Empty or Missing Output Files">
Ensure you specify valid paths to `--gtest_output`. If running multiple times with shuffle, unique output files are generated unless specified. Confirm write permissions to the output directory.
</Accordion>
<Accordion title="No Colored Output on Terminal">
Verify `--gtest_color=auto` or `yes` is used, and your terminal supports colors. Some remote terminals or CI servers may disable colors; override with flag.
</Accordion>
</AccordionGroup>

---

## 8. Summary Diagram of Test Execution Flow

```mermaid
graph TD
  A[Start: main() begins] --> B[Call InitGoogleMock(argc, argv)]
  B -->|Parses GoogleTest & GoogleMock flags| C[Flags initialized]
  C --> D[RUN_ALL_TESTS() called]
  D --> E{Are tests registered?}
  E -->|No| F[Warn: No tests linked]
  E -->|Yes| G[Filter tests with --gtest_filter]
  G --> H{Tests to run?}
  H -->|No| I[Exit or fail if configured]
  H -->|Yes| J[Shuffle tests if enabled]
  J --> K[Set up global environments]
  K --> L[Run each Test Suite & Test]
  L --> M{fail_fast enabled & failure?}
  M -->|Yes| N[Skip remaining tests]
  M -->|No| O[Continue running tests]
  O --> P[Tear down global environments]
  P --> Q[Generate output reports if enabled]
  Q --> R[Exit with test pass/fail status]
```

---

## 9. Additional Tips and Best Practices

- **Always call `InitGoogleMock()` before running tests** to ensure all flags and environments are properly initialized.
- Use **`--gtest_filter`** to isolate flaky or failing tests quickly during development.
- When running tests repeatedly, configure **`--gtest_repeat`** and consider enabling **`--gtest_recreate_environments_when_repeating`** if your test environment needs fresh setup each time.
- Utilize **`--gtest_output`** to generate detailed reports consumable by CI tools.
- Leverage **sharding** for large test suites to accelerate test execution in CI pipelines.
- Configure **verbosity** via `--gmock_verbose` to debug mocks effectively.

---

## 10. Common Flag Defaults

| Flag                          | Default Value         |
|-------------------------------|-----------------------|
| `--gtest_filter`              | `*` (all tests)       |
| `--gtest_repeat`              | `1`                   |
| `--gtest_shuffle`             | `false`               |
| `--gtest_color`               | `auto`                |
| `--gtest_print_time`          | `true`                |
| `--gmock_verbose`             | `warning`             |
| `--gmock_default_mock_behavior` | `1` (NaggyMock)       |


---

For detailed flag references, please see the [GoogleTest Flag Reference](https://github.com/google/googletest/blob/main/docs/advanced.md#running-tests) and GoogleMock initialization documentation.

---

## References

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleTest Test Fixtures & Test Case Management](https://docs.google.com/document/d/1MfuxFgk/view) (API Reference)
- [GoogleMock Initialization and Flags](https://github.com/google/googletest/blob/main/googlemock/src/gmock.cc)
- [Core GoogleTest Command Line Flags](https://github.com/google/googletest/blob/main/googletest/src/gtest.cc)

---

For additional context on mock configuration and test organization, refer to these pages:

- Core Testing API > Test Fixtures & Test Case Management
- Core Testing API > Assertions and Matchers
- Mocking API > Defining and Using Mock Objects


---

# Example

```bash
# Run all tests, output results to XML file, with verbose GoogleMock output
./my_test_binary --gtest_output=xml:results.xml --gmock_verbose=info

# Run a subset of tests matching pattern, shuffle test order, color output disabled
./my_test_binary --gtest_filter=MySuite.* --gtest_shuffle --gtest_color=no

# Run all tests repeatedly with fail-fast enabled
./my_test_binary --gtest_repeat=10 --gtest_fail_fast

# Run tests with sharding environment variables
export GTEST_TOTAL_SHARDS=5
export GTEST_SHARD_INDEX=2
./my_test_binary
```


---

# Conclusion

This guide equips you to control your GoogleTest and GoogleMock test execution with flexible options. From selective running, output configuration, verbosity control, to sharding and repetition, you can streamline your testing pipeline and integrate smoothly into your development and CI workflows.

For deep integration and advanced configuration, explore related guides and the API Reference for test fixtures, assertions, and mocking techniques.

---

<Check>
Remember to always call `InitGoogleMock` or `InitGoogleTest` before running tests to properly initialize flags and the environment.
</Check>

<Note>
Incorrect or missing flags, especially in complex environments and CI pipelines, often cause tests to be skipped or report unexpected results. Verify your flags and environment variables carefully.
</Note>

<Info>
GoogleMock flags are prefixed with `--gmock_`. They are removed from the command line once parsed, so custom flags coexist with GoogleTest flags without conflicts.
</Info>
