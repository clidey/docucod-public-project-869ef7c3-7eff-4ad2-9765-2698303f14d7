---
title: "Test Cases, Fixtures, and Lifecycle"
description: "Learn to define and organize your tests with Google's xUnit-style Test, TestSuite, and TestInfo classes. Understand how to use test fixtures for setup and teardown, and leverage the test discovery and execution lifecycle features to manage your test environment comprehensively."
---

# Test Cases, Fixtures, and Lifecycle

GoogleTest provides a robust framework to define, organize, and run tests using familiar xUnit-style classes such as `Test`, `TestSuite`, and `TestInfo`. This page guides you through how to write tests in GoogleTest, use test fixtures effectively for setup and teardown, and understand the lifecycle of test execution and discovery.

---

## 1. Test Cases and Test Suites

### Overview

A **test case** (recently renamed **test suite**) is a collection of logically related tests. GoogleTest runs the tests grouped in these suites independently, maintaining isolation for more reliable results.

Each test case contains individual **tests** (test functions), which should test specific behaviors or functionalities.

### Defining Tests

Tests are defined using the `TEST()` macro, which requires two parameters: the test suite name and the test name. Both names must be valid C++ identifiers without underscores.

```cpp
TEST(MathTest, Addition) {
  EXPECT_EQ(2 + 2, 4);
}

TEST(MathTest, Subtraction) {
  EXPECT_EQ(5 - 2, 3);
}
```

Tests within the same test suite allow logical grouping of related tests.

### Testing Independence

GoogleTest ensures each test runs independently by creating a fresh test fixture object for each test. Tests should never depend on side effects or outcomes from other tests.

---

## 2. Test Fixtures: Sharing Setup and Teardown

Sometimes multiple tests require common setup and cleanup. GoogleTest supports this via *test fixtures*â€”classes derived from `testing::Test` which provide a common environment for a group of tests in a test suite.

### Writing a Test Fixture

```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    // Setup code executed before each test.
    q1_.Enqueue(1);
  }

  void SetUp() override {
    // Additional setup before each test (optional).
  }

  void TearDown() override {
    // Cleanup after each test (optional).
  }

  Queue<int> q0_;
  Queue<int> q1_;
};
```

### Using a Fixture in Tests

Use `TEST_F()` with the fixture class as the first parameter instead of `TEST()`.

```cpp
TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
}
```

Each `TEST_F` runs with a fresh instance of the fixture, running the fixture constructor and optionally `SetUp()` and `TearDown()` around the test.

### Per-Test and Per-Suite Setup

In addition to per-test setup, GoogleTest supports per-test-suite (test case) setup and teardown to optimize resource-heavy initialization shared by many tests.

Define these as `static` methods inside your test fixture class:

```cpp
class FooTest : public testing::Test {
 public:
  static void SetUpTestSuite() {
    shared_resource_ = new HeavyResource();
  }

  static void TearDownTestSuite() {
    delete shared_resource_;
    shared_resource_ = nullptr;
  }

  static HeavyResource* shared_resource_;
};

HeavyResource* FooTest::shared_resource_ = nullptr;
```

GoogleTest calls `SetUpTestSuite()` once before the first test in the suite and `TearDownTestSuite()` once after the last test.

---

## 3. TestInfo and TestSuite Classes

GoogleTest internally maintains metadata about tests and test suites via the:

- `testing::TestSuite`: holds all tests belonging to the suite
- `testing::TestInfo`: stores data about individual tests

### TestInfo

Provides test-level information, such as:

- Test suite name
- Test name
- File and line number where the test is defined
- Parameter type and value for parameterized tests
- Test result and status after running

```cpp
const testing::TestInfo* info =
    testing::UnitTest::GetInstance()->current_test_info();

std::cout << "Running test: " << info->test_suite_name() << "." << info->name() << std::endl;
```

### TestSuite

Enables inspection of the entire suite, including counts of successful, failed, skipped tests, and elapsed time.

```cpp
const testing::TestSuite* suite =
    testing::UnitTest::GetInstance()->GetTestSuite(0);
std::cout << "Total tests: " << suite->total_test_count() << std::endl;
```

---

## 4. Test Lifecycle and Execution Flow

GoogleTest orchestrates testing in the following lifecycle:

### Initialization

- Call `testing::InitGoogleTest()` to parse flags and prepare the framework.

### Test Registration

- `TEST()` / `TEST_F()` and related macros register all tests automatically.

### Running Tests

- `RUN_ALL_TESTS()` executes all registered tests.
- Each test runs with:
  - Creation of a fresh test fixture instance
  - `SetUp()` call
  - User test body execution
  - `TearDown()` call
  - Destruction of fixture instance

### Test Reporting

- GoogleTest reports results on the console and can generate XML/JSON reports.

### Tear-down

- After running all tests, `TearDownTestSuite()` and global environment tear-down occur.

---

## 5. Example: Writing a Complete Test with Fixture

```cpp
#include <gtest/gtest.h>

// A simple FIFO queue interface
template <typename T>
class Queue {
 public:
  void Enqueue(const T& value) { data_.push_back(value); }
  T Dequeue() {
    if (data_.empty()) throw std::out_of_range("empty");
    T front = data_.front();
    data_.pop_front();
    return front;
  }
  size_t size() const { return data_.size(); }
 private:
  std::list<T> data_;
};

// Test fixture
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    q1_.Enqueue(1);
  }
  Queue<int> q0_;
  Queue<int> q1_;
};

// Tests
TEST_F(QueueTest, EmptyQueueHasZeroSize) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueReturnsFirstElement) {
  EXPECT_EQ(q1_.Dequeue(), 1);
  EXPECT_EQ(q1_.size(), 0);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 6. Troubleshooting Test Fixtures

- **Test fixture constructor not called?** Make sure your fixture class has a public default constructor.
- **Test failures due to shared mutable state?** Ensure each test uses a fresh fixture instance to avoid state leakage.
- **SetUp() not called?** Confirm the method signature is correct and overridden with `override`.
- **Using assertions in constructors or destructors causes compile errors?** Use `SetUp()` and `TearDown()` instead because GoogleTest does not support fatal assertions in constructors or destructors.
- **Tests not running?** Ensure they are registered with the `TEST()` or `TEST_F()` macros.

---

## 7. Additional Topics and References

- **Parameterized Tests:** Define tests with parameters using `TEST_P` and instantiate them with `INSTANTIATE_TEST_SUITE_P`.
- **Typed Tests:** Write tests that run the same logic over a list of types with `TYPED_TEST_SUITE` and `TYPED_TEST`.
- **Event Listeners:** Customize test execution reporting by implementing `TestEventListener`.

For more on these topics, explore:
- [Parameterized and Typed Tests](reference/testing.md#parameterized-and-typed-tests)
- [Test Event Listener](reference/testing.md#TestEventListener)
- [GoogleTest Primer](primer.md)

---

### Mermaid Diagram: Test Lifecycle Overview

```mermaid
flowchart TD
  Start([Start Test Run]) --> Init[testing::InitGoogleTest()] --> RegisterTests[Register Tests via TEST/TEST_F]
  RegisterTests --> RunTests[RUN_ALL_TESTS()]
  RunTests -->|For each Test| CreateFixture[Test Fixture Object Created]
  CreateFixture --> SetUp[Test Fixture SetUp()]
  SetUp --> Execute[Test Body Executed]
  Execute --> TearDown[Test Fixture TearDown()]
  TearDown --> DestroyFixture[Test Fixture Object Destroyed]
  DestroyFixture --> CheckNext{More Tests?}
  CheckNext -->|Yes| CreateFixture
  CheckNext -->|No| TearDownSuite[Tear Down Test Suite]
  TearDownSuite --> End([Test Run End])

  classDef func fill:#ddf,stroke:#333,stroke-width:1px;
  class Init,RegisterTests,RunTests,CreateFixture,SetUp,Execute,TearDown,DestroyFixture,TearDownSuite func;
```

---

<Note>
This page focuses on how to define tests, organize them with fixtures, and understand the lifecycle of test execution in GoogleTest. For mocking and expectations, please refer to the [Mocking Reference](mocking.md). For detailed test-writing practices, see the [GoogleTest Primer](primer.md).
</Note>
