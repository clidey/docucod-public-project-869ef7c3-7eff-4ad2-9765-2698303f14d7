---
title: "Assertions & Failures"
description: "Comprehensive reference for GoogleTest’s assertion macros, error handling strategies, and supporting assertion results. Explains fatal vs non-fatal assertions, writing custom assertions, and interpreting failure outputs."
---

# Assertions & Failures Reference

This document provides a comprehensive guide to GoogleTest's assertion macros, error handling strategies, and mechanisms to report assertion results. Here, you will understand the difference between fatal and non-fatal assertions, learn how to write custom assertions, and interpret failure outputs effectively.

---

## 1. Assertion Macros Overview

GoogleTest provides a variety of assertion macros designed to help you verify your code’s behavior during tests. Each assertion macro exists in two forms:

- **`EXPECT_` macros** generate *nonfatal* failures allowing the test function to continue execution after failure.
- **`ASSERT_` macros** generate *fatal* failures that abort the current function upon failure.

You can append a custom failure message to any assertion using the streaming `<<` operator, for example:

```cpp
EXPECT_TRUE(condition) << "Condition failed because foo was " << foo;
```

Almost anything printable to an `ostream` can be streamed in, including strings, numbers, and user-defined types with `operator<<`.

---

## 2. Explicit Success and Failure

Sometimes tests need to report success or failure explicitly to document control flow or unreachable states.

### `SUCCEED()`

Marks the point as successful, but does not cause the overall test to succeed (which requires no failures).

### `FAIL()`

Generates a fatal failure and aborts the current void-returning function. Example usage is in unreachable code branches:

```cpp
switch(value) {
  case 1: handle_case_1(); break;
  case 2: handle_case_2(); break;
  default: FAIL() << "Unhandled case " << value;
}
```

### `ADD_FAILURE()` & `ADD_FAILURE_AT(file, line)`

These generate nonfatal failures generally to report unexpected or incorrect states while continuing test execution.

---

## 3. Generalized Assertions with Matchers

### `EXPECT_THAT(val, matcher)` and `ASSERT_THAT(val, matcher)`

These assertions let you verify that a value matches a complex matcher expression, providing expressiveness and informative failure messages.

Example:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(value, AllOf(Gt(5), Lt(10)));
```

Matchers are powerful predicates that describe expected properties and have detailed messages upon failure to aid debugging.

For a comprehensive list of built-in matchers and writing your own, refer to the [Matchers Reference](reference/matchers.md).

---

## 4. Boolean Condition Assertions

These simplify testing boolean outcomes.

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` - succeeds if the condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` - succeeds if the condition is false.

Use these for simple control flow verifications.

---

## 5. Binary Comparison Assertions

Commonly used assertions compare two values for equality, inequality, or relational order.

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` - checks `val1 == val2`.
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` - checks `val1 != val2`.
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)` - checks `val1 < val2`.
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)` - checks `val1 <= val2`.
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)` - checks `val1 > val2`.
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)` - checks `val1 >= val2`.

**Notes:**

- These use pointer equality for pointers, except C string comparison requires string-specific assertions.
- Arguments are always evaluated once.

---

## 6. String Comparison Assertions

Specialized assertions exist for **C-style strings**, including wide strings. When using `std::string` objects, prefer the binary comparison assertions.

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` - verifies string contents are equal.
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)` - verifies string contents are not equal.
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)` - case-insensitive equality.
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)` - case-insensitive inequality.

---

## 7. Floating-Point Comparison Assertions

Due to rounding and precision, exact equality of floating-point numbers is unreliable. GoogleTest provides the following safe comparison assertions:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)` - approximate equality for `float`, with a tolerance of 4 ULPs.
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)` - approximate equality for `double`, with 4 ULPs tolerance.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)` - checks if values are within an absolute bound.

These assertions handle infinities and NaNs consistently.

---

## 8. Exception Assertions

When exceptions are enabled, GoogleTest supplies assertions to verify exception-throwing behavior.

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(statement, exception_type)` - expects that the statement throws the specified exception.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(statement)` - expects any exception is thrown.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(statement)` - expects no exceptions thrown.

Useful for verifying error handling paths.

---

## 9. Predicate Assertions

These allow asserting more complex conditions with clear failure messages.

- `EXPECT_PREDn(pred, val1, ..., valn)` / `ASSERT_PREDn(pred, val1, ..., valn)` where n ranges from 1 to 5.

The predicate is a function or functor returning true or false for the given arguments.

Example:

```cpp
bool IsPrime(int n);
EXPECT_PRED1(IsPrime, 7); // Checks if 7 is prime
```

Failure messages print predicate values for clarity.

---

## 10. Windows HRESULT Assertions

For Windows platforms, these assertions verify `HRESULT` success or failure.

- `EXPECT_HRESULT_SUCCEEDED(expression)` / `ASSERT_HRESULT_SUCCEEDED(expression)` - passes if the HRESULT represents success.
- `EXPECT_HRESULT_FAILED(expression)` / `ASSERT_HRESULT_FAILED(expression)` - passes if the HRESULT represents failure.

The error messages include the human-readable translation of the HRESULT code.

---

## 11. Death Assertions

Death assertions confirm that a piece of code terminates the test process, useful for detecting fatal errors or invalid program states.

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)` - checks that the statement causes process termination and the output matches `matcher`.
- `EXPECT_DEATH_IF_SUPPORTED(statement, matcher)` / `ASSERT_DEATH_IF_SUPPORTED(statement, matcher)` - conditional based on platform death test support.
- `EXPECT_DEBUG_DEATH(statement, matcher)` / `ASSERT_DEBUG_DEATH(statement, matcher)` - only in debug mode.
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT(statement, predicate, matcher)` - checks specific exit status predicate.

These execute in a child process and verify standard error messages.

---

## 12. Fatal vs Non-Fatal Failures

- **Fatal Failures (ASSERT_):** Immediately return from the current function, preventing further execution.
- **Non-Fatal Failures (EXPECT_):** Record the failure but continue execution within the current function.

Use fatal assertions when failure invalidates further test logic; use non-fatal for multiple checks within a test.

---

## 13. Writing Custom Assertions

GoogleTest allows you to write custom assertions to express complex test conditions:

- Define a function returning `testing::AssertionResult`.
- The function returns `AssertionSuccess()` if the condition passes.
- Returns `AssertionFailure()` with an informative message otherwise.

Example:

```cpp
#include <gtest/gtest.h>

testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return testing::AssertionSuccess();
  else
    return testing::AssertionFailure() << n << " is not even";
}

TEST(NumberTest, IsEven) {
  EXPECT_PRED1(IsEven, 4);  // Success
  EXPECT_PRED1(IsEven, 3);  // Fails with message
}
```

Custom assertions enhance message clarity and test expressiveness.

---

## 14. Interpreting Failure Outputs

When assertions fail, GoogleTest prints detailed messages:

- The expression tested.
- The expected condition.
- Actual values involved (including argument and return values when applicable).
- The source file and line number.
- For mock-related assertions, extra context such as which expected calls were tested.

This helps quickly identify the cause and location of test failures for efficient debugging.

---

## 15. Practical Tips and Best Practices

- Use `EXPECT_` macros to allow tests to continue after failed checks where possible.
- Use `ASSERT_` macros when subsequent test logic depends on a prior condition.
- Stream additional info messages inside assertions to clarify failure context.
- Consider writing custom assertions for complex checks to improve failure messages.
- Learn to read failure output for clues: expected vs actual, and argument mismatches are the most common failure causes.

---

## 16. Troubleshooting Common Issues

- **Silent Failures:** Ensure assertions are actually triggered; assertions inside helper functions must be carefully checked.
- **Misuse of `ASSERT_` in constructors/destructors:** Fatal failures in constructors/ destructors abort test execution; prefer `EXPECT_` or refactor.
- **Comparing Pointers vs Strings:** Use the string-specific assertions (`EXPECT_STREQ`) when comparing C strings.
- **Floating-point failures:** Use `EXPECT_NEAR` or `EXPECT_FLOAT_EQ` for approximate comparisons.

For comprehensive diagnostic advice, consult the guides on GoogleTest assertions and debugging techniques.

---

For further examples and tutorials, explore related documentation such as [Rich Assertions Guide](../guides/core-workflows/rich-assertions.md) and [Matchers Reference](reference/matchers.md).

<Info>
For understanding how assertions integrate into test lifecycle and execution, see the [Test Lifecycle & Execution](test-lifecycle-and-execution.md) page.
</Info>

---

**End of Assertions & Failures Reference**
