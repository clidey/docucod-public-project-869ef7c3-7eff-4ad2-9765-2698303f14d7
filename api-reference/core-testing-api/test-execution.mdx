---
title: "Test Execution and Configuration"
description: "Details on main entry points, custom main() integration (gtest_main/gmock_main), test runner flags, and environment/command-line options relevant for controlling test discovery and output. Includes how to initialize and configure the testing environment."
---

# Test Execution and Configuration

GoogleTest and GoogleMock provide robust entry points and flexible configuration options that empower you to control test discovery, execution, and output formatting easily. Whether you use default main() implementations or provide custom entry points, each test program can be initialized and configured to fit your project's needs while producing reliable and informative test runs.

---

## 1. Main Entry Points and Initialization

The `main()` function is the common starting point for running GoogleTest and GoogleMock-based tests. Typically, users do not need to implement their own `main()` function, as GoogleTest and GoogleMock provide ready-to-use main implementations, but custom main functions are supported when advanced control or integration is required.

### Using Default Main Implementations

- **gtest_main library**: Provides a `main` that initializes GoogleTest and runs all tests. Simply link against `gtest_main` instead of `gtest`.
- **gmock_main library**: Provides a `main` that initializes both GoogleMock and GoogleTest and executes the tests, simplifying use when mocking functionality is needed.

Both these pre-built mains take care of:

- Parsing and processing command-line flags relevant to GoogleTest and GoogleMock.
- Initializing the testing frameworks properly including setting up internal state.
- Running `RUN_ALL_TESTS()` and returning its result as the program exit code.

### Writing a Custom main()

If custom setup or argument processing is required before or after running tests, you can write your own `main()` as follows:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  // Initialize GoogleMock (also initializes GoogleTest).
  testing::InitGoogleMock(&argc, argv);

  // Run all tests and return the result.
  return RUN_ALL_TESTS();
}
```

**Important:** Always call `InitGoogleMock()` or `InitGoogleTest()` before running your tests to ensure command-line flags are correctly parsed and internal state is established.

You can also use `InitGoogleMock()` with no arguments for embedded or specialized platforms where argc/argv are unavailable.

### Platform-Specific Entrypoints

On Arduino-like platforms or embedded systems, customized entry points such as `setup()` and `loop()` may be used, calling GoogleMock initialization and `RUN_ALL_TESTS()` accordingly.

---

## 2. Test Runner Flags and Command-Line Options

GoogleTest supports a rich set of command-line flags that allow you to control which tests run, how many times they execute, filtering, shuffling, output format, and more.

### Commonly Used Flags

| Flag                     | Description |
|--------------------------|-------------|
| `--gtest_filter=pattern` | Runs only tests whose full names match the given shell wildcard pattern.
| `--gtest_repeat=N`       | Runs tests N times in succession.
| `--gtest_shuffle`        | Randomizes the order tests are run in.
| `--gtest_random_seed=N`  | Specifies the random seed used by `--gtest_shuffle`.
| `--gtest_output=xml[:file]` | Produces XML test report; useful for CI systems.
| `--gtest_color=(yes|no|auto)` | Controls colorized output.

These flags must be passed to your test executable and are parsed by `InitGoogleTest()` or `InitGoogleMock()`.

### Controlling Test Discovery

- **Filter tests by name:** Use `--gtest_filter` to specify which test suites and/or tests to run.
- **Exclude tests:** Prepend `-` to the filter pattern to exclude tests.
- **Example:** `--gtest_filter=MathTest.*:-MathTest.HandleNegative` runs all tests in `MathTest` except `HandleNegative`.

### Controlling Test Execution

- **Repeat runs:** Use `--gtest_repeat=N` to detect flaky tests or validate stability over multiple runs.
- **Randomize order:** Use `--gtest_shuffle` to detect order dependencies.

### Output Configuration

- **XML output:** Enables outputting test results in XML format compatible with many CI tools.
- **Verbose logs:** You can set the verbosity of GoogleMock using the `--gmock_verbose` flag.

---

## 3. Environment Initialization and Configuration

### Invoking Initialization

Call one of the following before running tests:

- `testing::InitGoogleTest(&argc, argv)`
- `testing::InitGoogleMock(&argc, argv)` (which also initializes GoogleTest)

These functions parse the framework-specific flags from `argv` and remove them before forwarding unrecognized arguments back to the user's program.

### Behavior of Initialization Calls

- Parses relevant flags (e.g., `--gtest_filter`, `--gtest_repeat`).
- Sets up internal structures for test registration and execution.
- Supports Windows wide-char arguments via overloads.

### Custom Flags and Initialization

If your test program requires custom flags, parse them after calling `InitGoogleTest()` or `InitGoogleMock()` to ensure the framework flags do not interfere.

Example:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);

  // Parse custom flags here

  return RUN_ALL_TESTS();
}
```

---

## 4. Running Tests

Once initialized, invoke:

```cpp
int result = RUN_ALL_TESTS();
```

This call:

- Runs all tests registered with GoogleTest.
- Applies any filters or repetitions configured via flags.
- Automatically manages test suite and fixture lifecycles.
- Returns 0 if all tests succeed, or 1 if any test fails.

Your program's `main()` function should return the value of `RUN_ALL_TESTS()` to signal success or failure based on test results.

---

## 5. Example: Custom main() Using GoogleMock

```cpp
#include <gmock/gmock.h>
#include <iostream>

int main(int argc, char** argv) {
  std::cout << "Starting tests..." << std::endl;
  testing::InitGoogleMock(&argc, argv);

  int ret = RUN_ALL_TESTS();

  std::cout << "Tests complete." << std::endl;
  return ret;
}
```

This straightforward example shows initialization with GoogleMock's `InitGoogleMock` and test execution with `RUN_ALL_TESTS()`. It ensures proper setup and teardown of all components.

---

## 6. Troubleshooting Common Issues

- **Tests not running:** Confirm that you linked against `gtest_main` or `gmock_main` or provided your own `main()`.
- **Flags not recognized:** Must call `InitGoogleTest()` or `InitGoogleMock()` before parsing flags or running tests.
- **`RUN_ALL_TESTS()` returns non-zero:** One or more tests have failed.
- **Tests execute in incorrect order:** Check if `--gtest_shuffle` is enabled.
- **Verbose or detailed output needed:** Use `--gmock_verbose=info` or `--gtest_output` flags for more logging.

See the [Troubleshooting & Validation](https://github.com/google/googletest/blob/main/docs/quickstart_and_troubleshooting/troubleshooting_validation.md) for more tips.

---

## 7. Summary of Key Functions and Flags

| Function / Flag               | Description                               |
|------------------------------|-------------------------------------------|
| `testing::InitGoogleTest()`  | Initializes GoogleTest with argc/argv.    |
| `testing::InitGoogleMock()`  | Initializes GoogleMock and GoogleTest.    |
| `RUN_ALL_TESTS()`            | Executes all registered tests.             |
| `--gtest_filter=`            | Filters which tests to run.                 |
| `--gtest_repeat=`            | Repeats tests N times.                      |
| `--gtest_shuffle`            | Randomizes order of tests.                  |
| `--gtest_output=`            | Produces test reports (e.g., XML).         |
| `--gmock_verbose=`           | Sets gMock verbosity level.                 |

Refer to the official documentation for comprehensive lists of flags and configuration options.

---

<Callout title="Best Practices & Tips">

- Always use the pre-built `gtest_main` or `gmock_main` binaries unless you need custom control.
- Invoke initialization functions as early as possible before any test logic.
- Pass command-line flags to the test binary to finely control test scope and reporting.
- Return the result of `RUN_ALL_TESTS()` from `main()` to integrate smoothly with CI systems.
- Explore verbose modes and XML outputs for richer debugging and reporting.

</Callout>