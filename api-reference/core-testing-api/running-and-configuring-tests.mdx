---
title: "Running and Configuring Tests"
description: "Documents test discovery, command-line options, main runner integration, test filters, and test environment configuration. Covers customization hooks to integrate GoogleTest into build pipelines and tooling."
---

# Running and Configuring Tests

This section explains how to run tests with GoogleTest, customize test execution, configure test environments, and integrate GoogleTest into build pipelines and tooling. It covers test discovery workflows, command-line options and filters, running tests via the main runner, and hooks for customization.

---

## Test Discovery and Execution Workflow

GoogleTest automatically discovers all tests defined with the `TEST` and `TEST_F` macros (and their variants). This eliminates the manual step of enumerating tests before running them. When invoking the test runner executable:

1. The framework collects and registers all declared tests.
2. Appropriate filtering, sharding, and ordering are applied.
3. Global test environments (if any) are set up.
4. Each test suite and its tests are run in sequence.
5. The framework provides configurable output detailing test progress and results.
6. Global environments are torn down after tests finish.

This automated discovery and execution process ensures consistent, reliable test runs optimized for both debugging and continuous integration.

## Integrating the Test Runner into Your Build

Most users simply link their test targets with `gtest_main` instead of `gtest`, which supplies a `main()` function containing the typical boilerplate needed to initialize and run all tests.

If customization is needed, you can provide your own `main()` function, initialize GoogleTest explicitly via `testing::InitGoogleTest(&argc, argv)`, and then invoke `RUN_ALL_TESTS()`. The return value serves as your program's exit code and should **never be ignored** as it indicates the overall test run status.

### Example of a Custom `main()` Function

```cpp
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This approach allows integrating GoogleTest-based test programs seamlessly into build and test pipelines.

## Command-Line Options and Flags

GoogleTest supports extensive runtime configuration through command-line flags, allowing you to tailor test execution behavior. Common flags include:

- **Test Selection and Filtering:**
  - `--gtest_filter=` — Specify which tests to run by matching test suite and test names.
  - `--gtest_also_run_disabled_tests` — Run disabled tests as well.
  - `--gtest_list_tests` — List available tests without running them.
  - `--gtest_fail_if_no_test_linked` — Fail if no tests are linked.
  - `--gtest_fail_if_no_test_selected` — Fail if no tests match the filter.

- **Test Execution Control:**
  - `--gtest_repeat=` — Repeat tests multiple times (negative values repeat indefinitely).
  - `--gtest_shuffle` — Randomize test order with a seed.
  - `--gtest_random_seed=` — Specify the seed for test shuffling.
  - `--gtest_fail_fast` — Stop execution on first test failure.
  - `--gtest_break_on_failure` — Break into debugger on assertion failure.

- **Output and Reporting:**
  - `--gtest_output=` — Generate XML or JSON reports (`xml:<file>` or `json:<file>`).
  - `--gtest_brief` — Display only failures.
  - `--gtest_print_time` — Show or hide test timing.
  - `--gtest_color` — Control colored output: `yes`, `no`, `auto`.
  - `--gtest_shuffle` — Shuffle test execution order.

- **Test Runtime Behavior:**
  - `--gtest_catch_exceptions` — Enable or disable catching exceptions from tests.
  - `--gtest_throw_on_failure` — Throw exceptions or abort on assertions.

These flags can also be set via environment variables—each flag maps to an uppercase env var prefixed with `GTEST_`, e.g., `GTEST_FILTER`.

### Filtering Tests Example

```bash
./my_tests --gtest_filter=MySuite.MyTest:OtherSuite.*-MySuite.DisabledTest
```

This runs tests named `MyTest` in `MySuite`, all tests in `OtherSuite`, except `MySuite.DisabledTest`.

## Writing Custom Test Main Functions

While the provided `gtest_main` target handles most use cases, advanced scenarios require defining your own main function.

When writing your own `main()`, invoke `testing::InitGoogleTest(&argc, argv)` before calling `RUN_ALL_TESTS()`. This ensures flags are parsed correctly and the framework is initialized.

You can also customize runtime behavior by installing test event listeners, adding global test environments, or managing command-line arguments.

## Test Environment Setup and Tear-Down

GoogleTest supports global test environments for setup and teardown logic that should run before and after all tests. To define an environment:

1. Derive from `::testing::Environment`.
2. Override `SetUp()` and `TearDown()`.
3. Register your environment before running tests using `testing::AddGlobalTestEnvironment()`.

Example:

```cpp
class MyEnv : public ::testing::Environment {
 public:
  void SetUp() override {
    // Setup global resources.
  }
  void TearDown() override {
    // Release global resources.
  }
};

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  ::testing::AddGlobalTestEnvironment(new MyEnv);
  return RUN_ALL_TESTS();
}
```

Global environments run setup once before the first test and teardown after the last test. You can register multiple environments, which will be set up in registration order and torn down in reverse.

## Sharding and Parallel Test Execution

GoogleTest supports test sharding to distribute test execution across multiple machines or processes.

To enable sharding:

- Set environment variables `GTEST_TOTAL_SHARDS` to the total number of shards.
- Set `GTEST_SHARD_INDEX` to the index of the current shard.

GoogleTest will run a disjoint subset of tests on each shard, ensuring all tests run exactly once collectively. If your tests use sharding, make sure your tests are safely parallelizable.

## Test Ordering and Randomization

By default, tests are run in the order they are defined. You can randomize test order by enabling the `--gtest_shuffle` flag. GoogleTest uses a seeded random shuffle:

- The seed is printed on each test run output.
- You can specify the seed explicitly with `--gtest_random_seed=`.
- Using the same seed allows reproduction of test failure orders.

### Best Practices

- Use shuffling to uncover implicit dependencies between tests.
- Use the repeat flag to catch flaky or intermittent failures.

## Event Listeners and Output Customization

GoogleTest publishes detailed test lifecycle events via the `TestEventListener` interface. Developers can:

- Create custom listeners by subclassing `TestEventListener` or `EmptyTestEventListener`.
- Add listeners via `UnitTest::GetInstance()->listeners().Append()`.
- Remove default console output listener to suppress standard output.

This enables integration with custom reporting tools, GUIs, progress indicators, or other specialized test infrastructure.

### Example: Custom Listener

```cpp
class MyListener : public ::testing::EmptyTestEventListener {
  void OnTestStart(const ::testing::TestInfo& test_info) override {
    printf("Starting test %s.%s\n", test_info.test_suite_name(), test_info.name());
  }

  void OnTestEnd(const ::testing::TestInfo& test_info) override {
    printf("Finished test %s.%s\n", test_info.test_suite_name(), test_info.name());
  }
};

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  auto& listeners = ::testing::UnitTest::GetInstance()->listeners();
  delete listeners.Release(listeners.default_result_printer());  // Disable default
  listeners.Append(new MyListener());
  return RUN_ALL_TESTS();
}
```

## Using Test Properties

Tests can log arbitrary key/value properties during execution using `RecordProperty()`. These properties appear in XML/JSON reports, useful for adding metadata or performance data.

- Call `testing::Test::RecordProperty(key, value)` from within tests or fixtures.
- Valid keys cannot conflict with reserved attributes (`name`, `file`, etc.).

Example:

```cpp
TEST(FooTest, Bar) {
  RecordProperty("MaxItems", 50);
  RecordProperty("TimeoutMs", "30");
}
```

## Handling Test Failures and Output

GoogleTest differentiates between:

- **Fatal failures** (`ASSERT_*`) that abort current test function.
- **Non-fatal failures** (`EXPECT_*`) that continue test execution.

Describe failures using assertion macros that provide rich diagnostics to help debug.

Detailed failure information including location, messages, and stack traces are included in console and XML/JSON reports.

## Summary Mermaid.js Diagram of Test Execution Flow

```mermaid
flowchart TD
  Start([Start Test Program]) --> Init[InitGoogleTest(&argc,&argv)]
  Init --> Discover[Discover All Registered Tests]
  Discover --> Filter[Filter Tests Based on --gtest_filter]
  Filter --> ListTests{--gtest_list_tests?}
  ListTests -- Yes --> ListOutput[List Available Tests]
  ListOutput --> End([Exit 0])
  ListTests -- No --> SetupEnv[Set up Global Test Environments]
  SetupEnv --> RunSuites[Run All Test Suites]

  subgraph RunSuitesLoop[For each Test Suite]
    RunSuites --> SetupSuite[SetUpTestSuite()]
    SetupSuite --> RunTests[Run Tests in Suite]
    RunTests --> TearDownSuite[TearDownTestSuite()]
  end

  RunSuitesLoop --> TearDownEnv[Tear down Global Test Environments]
  TearDownEnv --> GenerateReport[Generate Test Output (console, XML, JSON)]
  GenerateReport --> End
```

## Troubleshooting Common Issues

- **Tests not running**: Verify that tests are linked and not filtered out by `--gtest_filter`.
- **Unexpected test failures**: Use `--gtest_break_on_failure` to stop in debugger at failure.
- **Disabled tests not running**: Include `--gtest_also_run_disabled_tests`.
- **Test order dependencies**: Use `--gtest_shuffle` to randomize test order and locate flaky dependencies.
- **Global environment failures**: Confirm `SetUp()` and `TearDown()` in `Environment` handle errors gracefully.

## See Also

- [GoogleTest Primer](primer.md) — Introduction and basic usage
- [Advanced GoogleTest Topics](advanced.md) — Detailed techniques and flags
- [Assertions Reference](reference/assertions.md) — Full list of assertion macros
- [Testing Reference](reference/testing.md) — API details for Test, TestSuite, and more
- [Writing Your First Tests Guide](guides/core-workflows/writing-first-tests) — Step-by-step test creation
- [Parameterizing Tests](guides/advanced-testing-strategies/parameterized-and-typed-tests) — For data-driven testing

---

## Important Notes

- Always call `InitGoogleTest()` before `RUN_ALL_TESTS()`.
- Do not ignore the return value of `RUN_ALL_TESTS()`.
- Global test environments must be registered before tests run.
- Filtering and sharding allow targeting specific subsets for efficient test runs.
- GoogleTest’s listener API enables rich customization of test reporting and integration.

---

For more detailed examples and code snippets, see the [googletest/test](https://github.com/google/googletest/tree/main/googletest/test) and [samples](samples.md) directories.

---

# License and Attribution

The information and examples are based on the official GoogleTest source code and documentation provided under the BSD 3-Clause License by Google Inc.

---