---
title: "Assertions and Matchers"
description: "Details the set of assertion macros (EXPECT_*, ASSERT_*) and matcher APIs available in GoogleTest. Includes usage scenarios for equality, exceptions, floating point, and custom assertions and matchers. Guides users in selecting the right assertion for their test scenario and showcases matcher composability for enhanced readability."
---

# Assertions and Matchers

GoogleTest offers a powerful and flexible set of assertion macros and matcher APIs designed to help you verify the correctness of your code. This page details the available assertion macros (`EXPECT_*`, `ASSERT_*`), the matcher framework, and guidance for selecting the appropriate assertion for your test scenarios. You'll also find examples demonstrating assertion usage with built-in types, exception handling, floating-point comparisons, and how to define custom assertions and matchers.

---

## 1. Overview of Assertions

Assertions in GoogleTest come in two main flavors:

- **Non-fatal assertions (`EXPECT_*`)**: These report failures but allow the test to continue, enabling multiple checks in the same test.
- **Fatal assertions (`ASSERT_*`)**: These abort the current test function upon failure, useful when further steps depend on the assertion.

### Choosing Between `EXPECT_` and `ASSERT_`

Use `ASSERT_*` when failure means the test cannot proceed meaningfully (e.g., a resource is unavailable).
Use `EXPECT_*` when you want to verify multiple conditions regardless of earlier failures.

---

## 2. Built-in Assertion Macros

GoogleTest provides a rich set of macros out of the box:

- `EXPECT_EQ(val1, val2)` and `ASSERT_EQ(val1, val2)` for equality.
- `EXPECT_NE(val1, val2)` and `ASSERT_NE(val1, val2)` for inequality.
- Comparison operators: `EXPECT_LT`, `EXPECT_LE`, `EXPECT_GT`, `EXPECT_GE` and corresponding `ASSERT_` versions.
- Floating point comparisons: `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, `EXPECT_NEAR`.
- Exception assertions: `EXPECT_THROW(statement, exception_type)`, `EXPECT_NO_THROW(statement)`, and their `ASSERT_` variants.
- String assertions: `EXPECT_STREQ`, `EXPECT_STRNE`, `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`.

### Example: Equality and Inequality
```cpp
TEST(FooTest, EqualityTests) {
  int x = 5;
  int y = 5;
  int z = 7;

  EXPECT_EQ(x, y);  // passes
  ASSERT_NE(x, z);  // passes
}
```

### Example: Floating Point
```cpp
TEST(MathTest, FloatingPointComparison) {
  double pi = 3.1415926535;
  EXPECT_NEAR(pi, 3.14, 0.01);  // passes
}
```

---

## 3. Exception Assertions

GoogleTest allows assertions about exceptions thrown by your code.

- `EXPECT_THROW(statement, ExceptionType)`: Expects statement to throw the specified exception type.
- `EXPECT_ANY_THROW(statement)`: Expects statement to throw any exception.
- `EXPECT_NO_THROW(statement)`: Expects statement to not throw exceptions.

Example:
```cpp
TEST(ExceptionTest, ThrowsOnInvalidInput) {
  EXPECT_THROW(FunctionThatThrows(-1), std::invalid_argument);
  EXPECT_NO_THROW(FunctionThatThrows(10));
}
```

---

## 4. Using Matchers for Expressive Assertions

Matchers are predicate-like objects that can be combined and composed to convey complex conditions cleanly. They integrate seamlessly with GoogleTest assertions.

### Basic Usage
Matchers can be used with `EXPECT_THAT` and `ASSERT_THAT` macros:

```cpp
using ::testing::StartsWith;
using ::testing::HasSubstr;

EXPECT_THAT("Hello, world!", StartsWith("Hello"));
EXPECT_THAT("Testing", HasSubstr("ing"));
```

### Built-in Matchers Include:
- `_` (wildcard matcher that matches anything)
- `Eq(value)` for equality
- `Ne(value)`, `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`
- String matchers: `StartsWith()`, `EndsWith()`, `HasSubstr()`
- Container matchers: `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, etc.
- Pointer matchers: `NotNull()`, `IsNull()`, `Pointee()`

### Composing Matchers
Matchers can be combined using logical operators:
- `AllOf()` for AND conditions
- `AnyOf()` for OR conditions
- `Not()` for negation

Example:
```cpp
EXPECT_THAT(value, AllOf(Gt(10), Lt(20)));  // value is > 10 and < 20
EXPECT_THAT(name, AnyOf(StartsWith("Dr."), StartsWith("Prof.")));
```

---

## 5. Defining Custom Assertions and Matchers

When built-in assertions or matchers don't suffice, GoogleTest lets you create your own:

### Custom Assertions
You can define assertion functions/methods returning `::testing::AssertionResult` to embed nuanced validation logic.

Example:
```cpp
::testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << n << " is not even";
}

TEST(CustomAssertionTest, CheckEvenNumbers) {
  EXPECT_TRUE(IsEven(4));
  EXPECT_FALSE(IsEven(5));
}
```

### Custom Matchers
Define matchers for reusability and clearer error messages using macros or classes. The simplest is the `MATCHER` macro:

```cpp
MATCHER(IsEven, "is an even number") {
  return (arg % 2) == 0;
}

EXPECT_THAT(4, IsEven());
EXPECT_THAT(5, Not(IsEven()));
```

### Parameterized Matchers
You can define matchers with parameters using macros like `MATCHER_P`:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "is divisible by " #divisor) {
  return (arg % divisor) == 0;
}

EXPECT_THAT(10, IsDivisibleBy(5));
```

Refer to the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#writing-new-matchers-quickly) for extensive recipes.

---

## 6. Practical Guidance and Best Practices

- Prefer `EXPECT_*` for non-critical checks to gather multiple failures in one run.
- Use `ASSERT_*` when subsequent test logic depends on the assertion.
- Use matchers to write readable and maintainable assertions, especially when working with containers, strings, pointers, or complex conditions.
- Suppress overly strict expectations to avoid test brittleness.
- Leverage custom assertions for domain-specific checks with detailed messages.

### Example: Using Matchers with Containers
```cpp
std::vector<int> numbers = {1, 3, 5, 7};
EXPECT_THAT(numbers, ElementsAre(1, _, 5, Ge(6)));
```

---

## 7. Troubleshooting Common Issues

### Assertion Failures
- Check failure messages carefully; they will include the expected vs actual values.
- Use `--gtest_break_on_failure` to debug failing assertions interactively.

### Unexpected Exceptions
- Confirm your code throws the expected exception type.
- Use `EXPECT_ANY_THROW` if exception type is nondeterministic.

### Matcher Misuse
- Ensure types matched by matchers correspond to the argument types.
- Use explicit casts or `SafeMatcherCast` if necessary.

### Floating Point Failures
- Prefer `EXPECT_NEAR` over `EXPECT_EQ` for floating point comparisons to tolerate rounding errors.

---

## 8. Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [Matchers Reference](matchers.md)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Writing Your First Test](guides/core_testing_workflows/writing_first_test.md)
- [Customizing Assertions and Matchers](guides/advanced_testing_patterns/customizing_assertions_matchers.md)

---

This page is a focused guide to assertions and matchers. For an overview of GoogleTestâ€™s architecture or detailed API references on mocking and test execution, please see the other documentation pages.