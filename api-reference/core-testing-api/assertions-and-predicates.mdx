---
title: "Assertions and Predicate Macros"
description: "Comprehensive documentation of assertion macros (ASSERT_*, EXPECT_*) and predicate utilities, enabling expressive test conditions. Explains fatal vs. non-fatal failures, predicate handling, and custom assertion results, empowering precise test expectations and diagnostics."
---

# Assertions and Predicate Macros

This page offers comprehensive documentation of GoogleTest's assertion macros (`ASSERT_*` and `EXPECT_*`) and predicate utilities, enabling developers to write expressive and precise test conditions. It covers the behavior differences between fatal and non-fatal assertions, predicate assertions that improve error messages, the use of matchers, exception assertions, string and floating-point comparisons, and advanced predicate formatting.

## Overview of Assertions

GoogleTest uses assertions to verify expected conditions within tests. Each assertion comes as a pair:

- **`EXPECT_` macros**: Generate nonfatal failures upon failure, allowing the current test to continue running.
- **`ASSERT_` macros**: Generate fatal failures, which abort the current function immediately.

All assertions support streaming of additional information via the `<<` operator to provide custom failure messages.

```cpp
EXPECT_TRUE(my_condition) << "My condition is not true";
```

Any type streamable to `ostream` can be appended as a failure message, including C strings and C++ string objects. Wide strings (`wchar_t*` or `std::wstring`) are translated to UTF-8.

## Explicit Success and Failure

### SUCCEED

`SUCCEED()` generates a success event. Note that it doesn't force the overall test to pass; it serves mainly for documentation and may aid in expressing intent.

### FAIL

`FAIL()` generates a fatal failure, aborting the current (void) function.

### ADD_FAILURE

`ADD_FAILURE()` generates a nonfatal failure, allowing the test to proceed.

### ADD_FAILURE_AT

`ADD_FAILURE_AT(file, line)` generates a nonfatal failure at the specified source location.

## Boolean Condition Assertions

These verify boolean expressions explicitly.

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Verify that the condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Verify that the condition is false.

If the assertion fails, GoogleTest prints the evaluated expression, the actual value, and the expected value.

## Binary Comparison Assertions

These check relationships between two values. The list includes:

| Macro       | Purpose                                         |
|-------------|------------------------------------------------|
| `EXPECT_EQ` / `ASSERT_EQ` | Check equality                             |
| `EXPECT_NE` / `ASSERT_NE` | Check inequality                           |
| `EXPECT_LT` / `ASSERT_LT` | Less than                                   |
| `EXPECT_LE` / `ASSERT_LE` | Less or equal                              |
| `EXPECT_GT` / `ASSERT_GT` | Greater than                                |
| `EXPECT_GE` / `ASSERT_GE` | Greater or equal                            |

- Equality macros compare pointers by address by default; for comparing C strings by value use `EXPECT_STREQ`.
- On failure, detailed messages include the expressions and their evaluated values.

## String Comparisons

GoogleTest provides specialized assertions for comparing **C strings (null-terminated character arrays)**, including wide C strings (`wchar_t*`):

| Macro               | Description                                   |
|---------------------|-----------------------------------------------|
| `EXPECT_STREQ` / `ASSERT_STREQ` | Verify two C strings have the same contents  |
| `EXPECT_STRNE` / `ASSERT_STRNE` | Verify two C strings have different contents |
| `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ` | Case-insensitive equality                  |
| `EXPECT_STRCASENE` / `ASSERT_STRCASENE` | Case-insensitive inequality                |

For `std::string` or `std::wstring`, use `EXPECT_EQ`/`ASSERT_EQ`.

### Notes and Tips

- Comparing to `nullptr` is supported; e.g., `EXPECT_EQ(c_string_pointer, nullptr)`.
- Wide string assertions convert to UTF-8 for failure messages.

## Floating-Point Comparisons

Comparing floating-point numbers directly for equality is error-prone due to rounding. GoogleTest provides the following assertions for approximate equality:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`: Verify two `float` values are approximately equal within 4 ULPs.
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`: Verify two `double` values are approximately equal within 4 ULPs.
- `EXPECT_NEAR` / `ASSERT_NEAR`: Verify that the absolute difference between two floating points is within a specified absolute error.

### Handling Infinity and NaN

- `EXPECT_NEAR` treats infinity parameters consistently, allowing exact or infinite differences to be properly checked.
- Comparing with NaN values always fails.

## Exception Assertions

Provided exceptions are enabled in the build environment, these verify exception throwing behaviors.

| Macro                  | Description                                 |
|------------------------|---------------------------------------------|
| `EXPECT_THROW(stmt, exception_type)` / `ASSERT_THROW` | Checks that `stmt` throws an exception matching `exception_type`.
| `EXPECT_ANY_THROW(stmt)` / `ASSERT_ANY_THROW` | Checks `stmt` throws any exception.
| `EXPECT_NO_THROW(stmt)` / `ASSERT_NO_THROW` | Checks `stmt` does not throw any exception.

- The statement `stmt` can be a compound statement inside `{}`.

## Predicate Assertions

GoogleTest supports predicate-based assertions that give better error messages by printing the values of all arguments when they fail.

### Simple Predicates

- `EXPECT_PRED1(pred, val1)` / `ASSERT_PRED1`: Use unary predicates returning `bool`.
- `EXPECT_PRED2(pred, val1, val2)` / `ASSERT_PRED2`: Use binary predicates.
- Similarly for up to 5 arguments.

The `pred` can be a function or functor taking the corresponding number of arguments and returning `bool`. On failure, the macros show which arguments caused the failure.

### Predicate-Formatter Assertions

- `EXPECT_PRED_FORMAT1(pred_formatter, val1)` / `ASSERT_PRED_FORMAT1`: Use with predicate-formatter functions that return `testing::AssertionResult`.
- Predicate-formatters have the signature:

  ```cpp
  testing::AssertionResult PredicateFormatter(const char* expr1,
                                              const T1& val1);
  ```

- They receive the textual expressions of arguments and their values, allowing custom failure messages.

### Example Predicate Formatter

```cpp
testing::AssertionResult AssertIsEven(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}

EXPECT_PRED_FORMAT1(AssertIsEven, x);
```

## Windows HRESULT Assertions

GoogleTest provides assertions for checking HRESULT values:

- `EXPECT_HRESULT_SUCCEEDED(expr)` / `ASSERT_HRESULT_SUCCEEDED`: Verify that the expression results in a success HRESULT.
- `EXPECT_HRESULT_FAILED(expr)` / `ASSERT_HRESULT_FAILED`: Verify that the expression results in a failure HRESULT.

Failure messages incorporate human-readable system messages when available.

## Death Assertions

Death assertions verify that a statement causes the process to terminate in a specific way, often used to test code that should crash or exit on error.

- `EXPECT_DEATH(stmt, matcher)`: Asserts `stmt` causes abnormal termination and stderr output matches `matcher`.
- `ASSERT_DEATH`, `EXPECT_DEATH_IF_SUPPORTED`, `EXPECT_DEBUG_DEATH` follow similar behaviors with different execution modes.
- `EXPECT_EXIT(stmt, predicate, matcher)`: Asserts `stmt` terminates with an exit status matching `predicate` and stderr output matching `matcher`.

The `matcher` can be a string interpreted as a regex or a GoogleMock matcher for `std::string`. The default death test style can be specified with the flag `--gtest_death_test_style` (values: `fast` or `threadsafe`).

### Example

```cpp
EXPECT_DEATH(DoSomething(42), "My error");
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

## Using Matchers in Assertions

GoogleTest supports matchers to enable expressive and readable tests. Use `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` to assert that `value` satisfies the given `matcher`.

Matchers allow testing complex properties, for example:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_value, AllOf(Gt(5), Lt(10)));
EXPECT_THAT(my_collection, ElementsAre(1, 2, 3));
```

## Best Practices

- Use non-fatal assertions (`EXPECT_*`) when it's useful to continue tests despite failures.
- Use fatal assertions (`ASSERT_*`) when continuation would be unsafe or meaningless.
- Use predicate assertions to get richer failure information when testing complex conditions.
- Provide custom failure messages using streaming operators to clarify test intent.
- When working with exceptions, verify your build supports them and use exception assertions.
- For death tests, follow death test naming conventions (test suite names ending with `DeathTest`) and manage threading carefully.

## Troubleshooting Common Pitfalls

- Remember `ASSERT_*` can only be used in void-returning functions.
- Predicate assertions evaluate arguments exactly once.
- Use specialized string assertions for comparing C strings rather than generic equality assertions.
- Use floating-point comparisons like `EXPECT_FLOAT_EQ` instead of `EXPECT_EQ` to avoid pitfalls with rounding.

## References

Detailed information and examples for all assertion macros can be found in the [GoogleTest Assertions Reference](reference/assertions.md).

For predicate assertions and predicate-formatters, see the [Predicate Assertions section of the advanced guide](guides/advanced.md#MoreAssertions).

For integrating matchers, check the [Matchers Reference](reference/matchers.md).

Details on death tests are covered in the [Advanced Usage Guide](guides/advanced_usage_best_practices/death_tests).

# Examples

### Custom Failure Message in Assertion

```cpp
ASSERT_EQ(x.size(), y.size()) << "Vectors have different sizes: "
                                  << x.size() << " vs. " << y.size();
```

### Predicate Assertion with a Predicate Function

```cpp
bool IsEven(int n) { return (n % 2) == 0; }

EXPECT_PRED1(IsEven, value);
```

### Predicate-Formatter Assertion

```cpp
testing::AssertionResult CheckIsPositive(const char* expr, int val) {
  if (val > 0)
    return testing::AssertionSuccess();
  else
    return testing::AssertionFailure() << expr << " is negative: " << val;
}

EXPECT_PRED_FORMAT1(CheckIsPositive, my_var);
```

### Floating-Point Comparison

```cpp
EXPECT_FLOAT_EQ(3.14159f, computed_pi_value);
EXPECT_NEAR(expected_value, actual_value, epsilon);
```

### Death Test

```cpp
EXPECT_DEATH({ DoDangerousStuff(); }, "Fatal error");
```

### Exception Assertions

```cpp
EXPECT_THROW({ FunctionMayThrow(); }, std::runtime_error);
EXPECT_NO_THROW({ FunctionDoesNotThrow(); });
```

---

This concludes the comprehensive documentation on GoogleTest's assertion macros and predicate utilities, enabling you to write precise, clear, and effective tests with rich diagnostics and control over test execution flow.
