---
title: "Creating and Using Mock Objects"
description: "Documentation for the MOCK_METHOD macro, mock class inheritance, and the instantiation and configuration of mock objects. Explains how to substitute real objects with mocks, including qualifiers (constness, override/final), ref qualifiers, and call type specifications."
---

# Creating and Using Mock Objects

This documentation focuses on how to create and use mock objects in GoogleMock using the `MOCK_METHOD` macro. It explains how to define mock class methods, substitute real objects for mocks, and configure their behavior through qualifiers, such as constness, override, ref qualifiers, and calling conventions.

---

## 1. Overview of Mock Class Creation

Mock classes simulate the behavior of real classes during testing. You write mock classes that inherit from interfaces or base classes, and use the `MOCK_METHOD` macro to declare mock methods. These macros generate method declarations needed for runtime call interception and expectation verification.

### Defining a Mock Method

```cpp
class MyMockClass {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...));
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
};
```

- **ReturnType**: The return type of the method being mocked.
- **MethodName**: The name of the method.
- **(Args...)**: The parameter list enclosed in parentheses.
- **(Specs...)**: Optional qualifiers such as `const`, `override`, `noexcept`, calling conventions, or reference qualifiers.

### Important Notes

- Place `MOCK_METHOD` declarations in the **public** section of your mock class, regardless of the original method's access (public, protected, or private). This enables `ON_CALL` and `EXPECT_CALL` to work as expected.
- Override virtual methods using `(override)` to maintain compiler checks and clarity.

---

## 2. Handling Qualifiers and Special Method Types

### Qualifiers in `MOCK_METHOD`

You can specify the following qualifiers in the optional fourth `Specs` parameter:

| Qualifier                   | Description                                  |
| --------------------------- | -------------------------------------------- |
| `const`                     | Marks the mock method as `const`. Required if overriding a const method.
| `override`                  | Marks the method with `override`. Recommended.
| `noexcept`                  | Marks the method with `noexcept`. Required for overriding noexcept methods.
| `Calltype(convention)`      | Sets call type (e.g., `STDMETHODCALLTYPE`), useful on Windows.
| `ref(&)` / `ref(&&)`         | Applies reference qualifiers, needed for methods that have them.

For example:

```cpp
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool), (const, override));
```

### Dealing with Commas in Types

If the return type or parameter types contain commas (like templated types), wrap the type in extra parentheses:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

Alternatively, use `using` to create type aliases for complex types:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());

using MapIntDouble = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

---

## 3. Mocking Inherited and Overloaded Methods

### Mocking Overloaded Functions

You can mock overloaded methods by specifying their exact signatures:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int Add(Element x);
  virtual int Add(int times, Element x);
  virtual Bar& GetBar();
  virtual const Bar& GetBar() const;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

**Tip:** If you don't mock all overloads of a method, the compiler warns about hidden overloads. Fix this by bringing the missing overloads into scope:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;
  MOCK_METHOD(int, Add, (Element x), (override));
  // Not mocking int Add(int times, Element x);
};
```

---

## 4. Mocking Non-Virtual Methods

GoogleMock can mock **non-virtual** methods for high-performance dependency injection by creating mock classes unrelated to the real classes, but containing methods with matching signatures.

Example:

```cpp
// Real class with non-virtual methods
class ConcretePacketStream {
 public:
  void AppendPacket(Packet* new_packet);
  const Packet* GetPacket(size_t packet_number) const;
  size_t NumberOfPackets() const;
};

// Mock class (no inheritance)
class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

You must specify which class to use at compile-time by templating your code accordingly:

```cpp
template <class PacketStream>
void CreateConnection(PacketStream* stream) { ... }

CreateConnection<ConcretePacketStream>(...);  // Production
CreateConnection<MockPacketStream>(...);      // Testing
```

---

## 5. Mocking Private and Protected Methods

Place `MOCK_METHOD` declarations in the **public** section of your mock class, regardless of whether the method is public, protected, or private in the base class.

```cpp
class Foo {
 public:
  virtual bool Transform(Gadget* g) = 0;
 protected:
  virtual void Resume();
 private:
  virtual int GetTimeOut();
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Transform, (Gadget* g), (override));

  MOCK_METHOD(void, Resume, (), (override));    // Mocks protected method, declared public here
  MOCK_METHOD(int, GetTimeOut, (), (override)); // Mocks private method, declared public here
};
```

This allows expectations and actions to be set on these methods.

---

## 6. Mocking Class Templates

Template classes can be mocked easily by providing templated mock classes.

Example:

```cpp
template <typename Elem>
class StackInterface {
 public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const Elem& x) = 0;
};

template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

---

## 7. Common Mocking Patterns and Tips

### Using Qualifiers Correctly

- Always use `override` when mocking virtual methods.
- Use `const` qualifier if the original method is `const`.
- Specify `noexcept` if overriding a method declared `noexcept`.
- Use the `Calltype(...)` specifier for non-default calling conventions.
- Use `ref(...)` specifiers to handle reference qualified methods.

### Avoiding Parsing Errors with Commas

Wrap complex return types or argument types that contain commas in extra parentheses or create type aliases.

### Mock All Overloads to Avoid Warnings

Mock every overload or bring unspecified base class overloads into scope using `using` declarations.

### Putting `MOCK_METHOD` in Public Section

Always declare mock methods in the mock class's public section to ensure test framework access.

---

## 8. Using Mock Objects in Your Tests

### Creating Mock Objects

Mock objects can be instantiated like normal objects.

You may use `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>` to control how uninteresting calls are treated:

- `NiceMock` suppresses warnings on uninteresting calls.
- `NaggyMock` issues warnings on uninteresting calls (default behavior).
- `StrictMock` treats uninteresting calls as errors.

Example:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;   // Warnings suppressed
StrictMock<MockFoo> strict_mock;  // Uninteresting calls cause failures
```

### Setting Default Actions and Expectations

Use `ON_CALL()` to specify default behavior without requiring calls.

Use `EXPECT_CALL()` to specify expected calls with argument matchers, call counts, and actions.

---

## 9. Summary

The `MOCK_METHOD` macro is central for defining mock methods. It requires careful attention when dealing with qualifiers, overloaded methods, templated classes, and methods with complex argument or return types.

Always declare mock methods publicly, mock all overloads to avoid compiler warnings, and wrap types containing commas properly. To manage uninteresting calls, choose from `NiceMock`, `NaggyMock`, or `StrictMock` wrappers.

By following these practices, mock objects serve as powerful substitutes for real objects in your tests, enabling precise control and verification of behavior.

---

## 10. Additional Resources

- [gMock Cookbook](gmock_cook_book.md) for detailed recipes and usage tips
- [Mocking Reference](reference/mocking.md) for complete API documentation
- [gMock for Dummies](gmock_for_dummies.md) for beginner guidance
- [gMock Cheat Sheet](gmock_cheat_sheet.md) for quick syntax reference
- [Legacy gMock FAQ](gmock_faq.md) for common troubleshooting
