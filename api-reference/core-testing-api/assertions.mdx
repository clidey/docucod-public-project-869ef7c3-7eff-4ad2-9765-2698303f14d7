---
title: "Assertions and Checks"
description: "Reference for standard and custom assertion macros used to validate code behavior. Covers fatal and non-fatal failures, exception checking, and writing user-defined assertions to extend GoogleTest's expressive power."
---

# Assertions and Checks

Reference for standard and custom assertion macros used to validate code behavior. Covers fatal and non-fatal failures, exception checking, and writing user-defined assertions to extend GoogleTest's expressive power.

---

## Overview

GoogleTest provides a rich set of assertion macros that serve as the foundation for verifying your C++ code’s correctness. These assertions facilitate validation of conditions, comparison of values, and detection of expected exceptions—all while generating detailed, human-readable messages on failures.

Assertions come in two primary flavors:

- **EXPECT_***: Non-fatal failures that allow the current test function to continue.
- **ASSERT_***: Fatal failures that abort the current test function immediately.

By using these macros, you can precisely control test execution flow based on the success or failure of individual checks.

Each assertion supports custom failure messages using the streaming `<<` operator, enabling highly informative diagnostics.

---

## Categories of Standard Assertions

### Explicit Success and Failure

- `SUCCEED()` — Marks an explicit success. Useful when the outcome of control flow needs to be unambiguously indicated.
- `FAIL()` — Generates a fatal failure and aborts the current void-returning function.
- `ADD_FAILURE()` — Adds a non-fatal failure, allowing continued execution.
- `ADD_FAILURE_AT(file, line)` — Adds non-fatal failure at a specified file and line number.


### Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` — Checks that the condition evaluates to true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` — Checks that the condition evaluates to false.


### Binary Comparison

These assertions compare two values with their respective relational operators:

- Equality and inequality: `EXPECT_EQ(val1, val2)`, `ASSERT_EQ(val1, val2)`, `EXPECT_NE`, `ASSERT_NE`.
- Ordering: `EXPECT_LT`, `ASSERT_LT`, `EXPECT_LE`, `ASSERT_LE`, `EXPECT_GT`, `ASSERT_GT`, `EXPECT_GE`, `ASSERT_GE`.

**Important notes:**
- When comparing C strings, use string comparison assertions (`EXPECT_STREQ`, etc.) instead of these to compare contents.
- The arguments are evaluated exactly once.
- GoogleTest prints the actual values upon failure to aid debugging.


### String Comparisons

Special assertions are provided for C-style strings (including wide-character strings):

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ` — Validate that two C strings have equal contents.
- `EXPECT_STRNE` / `ASSERT_STRNE` — Validate that two C strings are different.
- `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ` — Case-insensitive equality.
- `EXPECT_STRCASENE` / `ASSERT_STRCASENE` — Case-insensitive inequality.

Note that these macros handle wide strings and null pointers gracefully, printing helpful failure messages.


### Floating-Point Comparisons

Due to the nature of floating-point representations, exact equality is rarely appropriate for floats and doubles. GoogleTest provides macros to compare floating-point numbers with a tolerance based on Units in the Last Place (ULPs) or an explicit error bound.

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ` — Check float equality within 4 ULPs.
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ` — Check double equality within 4 ULPs.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR` — Validate that the absolute difference does not exceed the specified error.


### Exception Assertions

Testing code that throws exceptions is also supported, provided exceptions are enabled in your build:

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW` — Expects the code to throw a specific exception.
- `EXPECT_ANY_THROW` / `ASSERT_ANY_THROW` — Expects the code to throw any exception.
- `EXPECT_NO_THROW` / `ASSERT_NO_THROW` — Verifies the code does not throw any exceptions.


### Predicate Assertions

For complex validation beyond simple boolean checks, predicate assertions enable detailed failure messages with argument values.

- `EXPECT_PRED1`, `EXPECT_PRED2`, ... / `ASSERT_PRED1`, `ASSERT_PRED2`, ... — Use predicates (functions or functors returning bool) on 1-5 arguments.

- `EXPECT_PRED_FORMAT*` / `ASSERT_PRED_FORMAT*` — Use predicate-formatters for even more control over failure messages. Predicate-formatters return `testing::AssertionResult` instead of bool.

This approach helps in verifying complex conditions cleanly and ensuring failure messages are informative.


### Windows HRESULT Assertions

Specifically on Windows, GoogleTest supports assertions for HRESULT values returned by COM APIs:

- `EXPECT_HRESULT_SUCCEEDED(expr)` / `ASSERT_HRESULT_SUCCEEDED` — Checks for success HRESULT.
- `EXPECT_HRESULT_FAILED(expr)` / `ASSERT_HRESULT_FAILED` — Checks for failure HRESULT.

Assertions print both the HRESULT value and its textual description upon failure.


### Death Assertions

To verify that a particular code snippet causes process termination (e.g., through a fatal assertion), Death Test assertions are provided:

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH` — Verifies that `statement` causes process exit with non-zero status and output matching `matcher` regex/string.
- `EXPECT_DEATH_IF_SUPPORTED` / `ASSERT_DEATH_IF_SUPPORTED` — Like `EXPECT_DEATH` but only runs the test if death tests are supported.
- `EXPECT_DEBUG_DEATH` / `ASSERT_DEBUG_DEATH` — Runs death tests only in debug builds.
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT` — Verifies exact exit code or signal specified by predicate, and output matching matcher.

See the **Advanced GoogleTest Topics** guide for comprehensive usage patterns and caveats for death tests.

---

## Writing Custom Assertions

While GoogleTest provides an extensive standard assertion set, you can extend it by writing your own assertions for domain-specific checks. This is commonly done using one of two techniques:

1. **Predicate assertions** using functions returning `bool` or `testing::AssertionResult` that can be wrapped in GoogleTest's macros like `EXPECT_PRED_FORMAT*`.
2. Defining macros that assist in constructing expressive and detailed failure messages.

A custom assertion generally:

- Takes relevant input values.
- Performs the validation.
- Returns `testing::AssertionSuccess()` on success or
  `testing::AssertionFailure() << "informative message"` on failure.

This approach gives you maximum flexibility to provide rich diagnostics while integrating seamlessly with GoogleTest’s reporting.


## Practical Tips & Best Practices

- Use `ASSERT_*` macros when a failure should abort the current test immediately (e.g., null pointer checks before dereferencing).
- Use `EXPECT_*` macros to continue running the test to report multiple failures.
- To catch exceptions and handle fatal failures gracefully, use GoogleTest’s `catch_exceptions` flag or write listeners with `AssertionException`.
- Stream additional information into assertion macros especially for failures involving complex structures.
- When writing death tests, ensure the test focuses only on code that causes the termination.
- Use predicate and predicate-format assertions to improve readability and maintainability of complex condition checks.
- Use `SCOPED_TRACE` to add contextual information to nested or repeated assertions.
- Avoid using `ASSERT_*` in functions returning non-void unless you understand the consequences.


## Common Failure and Troubleshooting Scenarios

- **Failure to abort on fatal assertions in subroutines:** This happens because fatal assertions only abort the current function. Use `ASSERT_NO_FATAL_FAILURE()` to verify subroutine calls or check `Test::HasFatalFailure()` right after.
- **Incorrect evaluation of C strings with `EXPECT_EQ` or `ASSERT_EQ`:** Use `EXPECT_STREQ` or `ASSERT_STREQ` instead to compare string contents.
- **Expectation of exceptions without exceptions enabled:** Confirm that your build enables exceptions (`GTEST_HAS_EXCEPTIONS` is true).
- **Death tests failing to detect process termination or output mismatch:** Verify that your death test style flags and environment support death tests.


## Example Usages

### Basic Assertion with Custom Message

```cpp
EXPECT_TRUE(IsValid(input)) << "Input: " << input << " is invalid.";
```

### Comparing Values with Equality

```cpp
ASSERT_EQ(result, expected) << "Mismatch in computation.";
```

### String Equality Check

```cpp
EXPECT_STREQ(output.c_str(), "expected output");
```

### Floating Point Nearness Check

```cpp
EXPECT_NEAR(computed_value, expected_value, 0.01);
```

### Exception Checking

```cpp
EXPECT_THROW(FunctionThatShouldThrow(), std::runtime_error);
EXPECT_NO_THROW(FunctionThatShouldNotThrow());
```

### Predicate Assertion

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, value);
```

### Predicate-Formatter Assertion

```cpp
testing::AssertionResult IsPositive(const char* expr, int val) {
  if (val > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << val << ", which is not positive.";
}
EXPECT_PRED_FORMAT1(IsPositive, value);
```

### Death Test

```cpp
ASSERT_DEATH({ CrashFunction(); }, "Segmentation fault");
```

---

## Related APIs and Macros

- [`EXPECT_*`, `ASSERT_*`, `FAIL()`, `ADD_FAILURE()`](assertions.md)
- [`EXPECT_THROW`, `EXPECT_NO_THROW`, `EXPECT_ANY_THROW`](assertions.md#exceptions)
- [`EXPECT_DEATH`, `ASSERT_DEATH`, `EXPECT_EXIT`](assertions.md#death)
- Predicate-based macros: [`EXPECT_PRED*`, `EXPECT_PRED_FORMAT*`](assertions.md#predicates)
- [`SCOPED_TRACE`](testing.md#SCOPED_TRACE) and `ScopedTrace` for adding contextual failure traces.
- `Test::HasFatalFailure()` and `HasNonfatalFailure()` for query of test failure status.
- `Test::RecordProperty()` for adding metadata to tests.

---

## Additional Resources

Learn more about advanced assertions, custom predicates, and matcher integration in:

- [Assertions Reference](reference/assertions.md)
- [Advanced GoogleTest Topics](advanced.md)
- [Testing Reference](testing.md)
- [Matchers Reference](matchers.md)

For mocking and interaction testing, refer to the [Mocking Reference](mocking.md).

---

[GoogleTest Repository](https://github.com/google/googletest)

---