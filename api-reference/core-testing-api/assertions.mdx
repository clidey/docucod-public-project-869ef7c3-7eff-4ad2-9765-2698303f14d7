---
title: "Assertions"
description: "Covers the suite of built-in assertions for expressing expectations in tests, such as 'ASSERT_TRUE', 'EXPECT_EQ', fatal/non-fatal failures, and custom user-defined assertions. Provides examples, macros, usage guidelines, and return-value handling details."
---

# Assertions

This page details GoogleTest's suite of built-in assertions, empowering you to express expectations about your code's behavior within tests. You'll find explanations of macros such as `ASSERT_TRUE`, `EXPECT_EQ`, the distinction between fatal and non-fatal failures, as well as how to define custom assertions. Practical examples, best practices, usage guidelines, and details on handling assertion return values are provided to help you master test validation.

---

## Understanding GoogleTest Assertions

**Assertions** are the fundamental building blocks of tests in GoogleTest. They verify that your code behaves as expected. When an assertion fails, GoogleTest reports the failure, including file location and an explanatory message.

- **Fatal assertions** (`ASSERT_*` macros) will abort the current function upon failure.
- **Non-fatal assertions** (`EXPECT_*` macros) will record the failure but allow execution to continue.

Using the appropriate assertion type affects the flow of your tests. Use `EXPECT_*` to gather multiple failures per test and `ASSERT_*` when a failure should prevent further checks.

### Core Assertion Macro Pairs

GoogleTest provides pairs of macros for the same condition:

| Assertion             | Description                              |
|-----------------------|------------------------------------------|
| `ASSERT_TRUE(condition)` / `EXPECT_TRUE(condition)` | Checks if condition is true.
| `ASSERT_FALSE(condition)` / `EXPECT_FALSE(condition)` | Checks if condition is false.
| `ASSERT_EQ(val1, val2)` / `EXPECT_EQ(val1, val2)` | Checks equality (`val1 == val2`).
| `ASSERT_NE(val1, val2)` / `EXPECT_NE(val1, val2)` | Checks inequality (`val1 != val2`).
| `ASSERT_LT(val1, val2)` / `EXPECT_LT(val1, val2)` | Checks less than (`val1 < val2`).
| `ASSERT_LE(val1, val2)` / `EXPECT_LE(val1, val2)` | Checks less than or equal (`val1 <= val2`).
| `ASSERT_GT(val1, val2)` / `EXPECT_GT(val1, val2)` | Checks greater than (`val1 > val2`).
| `ASSERT_GE(val1, val2)` / `EXPECT_GE(val1, val2)` | Checks greater than or equal (`val1 >= val2`).

#### Example: Using `EXPECT_EQ` and custom messages

```cpp
int actual = ComputeValue();
int expected = 42;
EXPECT_EQ(actual, expected) << "Value mismatch: expected 42";
```

If the assertion fails, GoogleTest prints the failure details, including your custom message.

---

## Fatal and Non-fatal Failures

- **Fatal failures** (`ASSERT_*`, `FAIL()`) immediately abort the current function, stopping further code in that test.
- **Non-fatal failures** (`EXPECT_*`, `ADD_FAILURE()`) record a failure but let the test continue running.

### Important Guidelines

- Use `ASSERT_*` when a failure means the rest of the test is invalid or could crash.
- Use `EXPECT_*` to collect multiple errors in one run.

### Caveats for Fatal Assertions

Fatal assertions cannot be used in non-void functions due to control flow semantics. If you need to check fatal conditions in such functions, use non-fatal assertions or restructure your code.

---

## Explicit Success and Failure

Sometimes your test's success or failure is based on control flow rather than a boolean expression.

- **`SUCCEED()`**: generates a success marker. Never fails and serves as documentation or for tracking.
- **`FAIL()`**: generates a fatal failure and aborts the current function.
- **`ADD_FAILURE()`**: generates a non-fatal failure, allowing the test to continue.

Examples:

```cpp
// Use FAIL() when reaching an unexpected code path
switch (value) {
  case 1:
    ...
    break;
  default:
    FAIL() << "Unexpected case: " << value;
}

// Use SUCCEED() to mark explicit success
if (condition_met) SUCCEED();
```

---

## String Assertions

GoogleTest offers specialized macros to compare C strings (null-terminated char arrays) with content comparison rather than pointer comparison:

| Assertion | Description |
| --- | --- |
| `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` | Asserts that C strings have the same content.
| `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)` | Asserts that C strings do not have the same content.
| `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)` | Asserts that C strings are equal ignoring case.
| `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)` | Asserts that C strings are not equal ignoring case.

Wide-character strings (`wchar_t*`) are supported similarly.

```cpp
const char* actual = "hello";
const char* expected = "hello";
EXPECT_STREQ(actual, expected);
```

### Notes

- For std::string objects, use `EXPECT_EQ` to compare contents.
- Null pointers are handled correctly: two null pointers compare equal; a null and non-null pointer compare unequal.

---

## Floating-Point Assertions

Due to round-off errors, direct equality tests may not always behave as expected with floating-point values. GoogleTest provides specialized macros to compare floats and doubles with an acceptable tolerance.

| Assertion | Description |
| --- | --- |
| `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)` | Checks that two `float` values are approximately equal to within 4 ULPs.
| `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)` | Checks that two `double` values are approximately equal to within 4 ULPs.
| `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)` | Checks that the difference between `val1` and `val2` is within `abs_error`.

Examples:

```cpp
EXPECT_FLOAT_EQ(3.14159f, ComputePi());
ASSERT_NEAR(CalculateValue(), expected_value, 0.001);
```

---

## Exception Assertions

If your build environment supports exceptions, GoogleTest provides assertions to verify whether code throws or does not throw exceptions.

| Assertion | Usage |
| --- | --- |
| `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(statement, exception_type)` | Verifies `statement` throws `exception_type`.
| `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(statement)` | Verifies `statement` throws any exception type.
| `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(statement)` | Verifies `statement` does not throw any exception.

Example:

```cpp
EXPECT_THROW(DoSomething(), std::runtime_error);
ASSERT_NO_THROW(DoSafeOperation());
```

---

## Predicate Assertions

Predicate assertions provide a way to verify complex conditions with detailed failure messages.

### Basic Predicate Assertions

Macros like `EXPECT_PRED1`, `EXPECT_PRED2`, ..., `ASSERT_PRED1`, etc., take a predicate function (returning bool) and one or more arguments.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, 4);  // Succeeds
EXPECT_PRED1(IsEven, 3);  // Fails
```

Arguments to the predicate are evaluated exactly once.

### Predicate-Formatter Assertions

For more expressive failure messages, predicate-formatters return `AssertionResult` objects with customized error messages. These macros include:

- `EXPECT_PRED_FORMAT1` through `EXPECT_PRED_FORMAT5`
- `ASSERT_PRED_FORMAT1` through `ASSERT_PRED_FORMAT5`

Example Predicate-Formatter:

```cpp
using ::testing::AssertionResult;

AssertionResult AssertIsEven(const char* expr, int n) {
  if (n % 2 == 0) return AssertionSuccess();
  return AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}

EXPECT_PRED_FORMAT1(AssertIsEven, value);
```

This approach shows the expression and why it failed, improving test diagnostics.

### Tips for Predicate Assertions

- Use them to generate clearer, tailored failure messages.
- You can specify predicate functions or functors.
- Argument evaluation count is precisely one.

---

## Death Assertions

Death tests verify that certain code causes program termination.

Key macros:

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)`
- `EXPECT_DEATH_IF_SUPPORTED` / `ASSERT_DEATH_IF_SUPPORTED`
- `EXPECT_DEBUG_DEATH` / `ASSERT_DEBUG_DEATH`
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT(statement, predicate, matcher)`

The `statement` is executed in a separate process. The `matcher` verifies stderr output, while the `predicate` validates the exit status.

Example:

```cpp
EXPECT_DEATH({ CrashFunction(); }, "Error message regex");
EXPECT_EXIT(NormalExit(), ::testing::ExitedWithCode(0), "Success");
```

### Important Notes

- Death tests should be named in test suites ending with `DeathTest` for ordering and thread-safety reasons.
- Avoid side-effects in death tests since they occur in a child process.

---

## Skipping Execution

`GTEST_SKIP()` allows dynamically skipping test execution with an optional message.

Example:

```cpp
TEST(MyTest, SkipExample) {
  if (!IsFeatureAvailable()) {
    GTEST_SKIP() << "Feature not available";
  }
  ...;
}
```

Tests skipped this way will be reported accordingly.

---

## Logging Additional Test Information

Use `RecordProperty(key, value)` within tests or fixtures to log key-value pairs that output to XML reports.

Example:

```cpp
RecordProperty("MaxWidgets", ComputeMaxWidgets());
```

**Constraints:**

- Keys must be valid XML attribute names and must not conflict with reserved attributes like `name`, `status`, `time`, etc.
- Works during test execution and in fixture setup/teardown.

---

## Custom and User-Defined Assertions

GoogleTest supports creating custom assertion macros or functions:

- You can use `AssertionResult` to build detailed predicate-format assertions.
- Use predicate assertions (`EXPECT_PRED*` or `EXPECT_PRED_FORMAT*`) for custom checks.

Example for a custom assertion:

```cpp
AssertionResult IsPrime(int n) {
  if (CheckPrime(n)) return AssertionSuccess();
  return AssertionFailure() << n << " is not prime";
}

TEST(NumberTest, IsPrime) {
  EXPECT_PRED_FORMAT1(IsPrime, 7);
}
```

---

## Return-Value Handling

Assertions macros are designed for void-returning functions because `ASSERT_*` aborts the current function on failure.

If you need to use assertions in non-void functions, prefer non-fatal assertions (`EXPECT_*`) or restructure your code (e.g., use out-parameters).

---

## Best Practices

- Prefer `EXPECT_*` for checks where continuing after failure helps reveal multiple issues.
- Use `ASSERT_*` to halt tests when further operations depend on a condition.
- Stream custom failure messages for clearer diagnostics.
- Avoid fatal assertions in constructors or destructors—use `SetUp()` and `TearDown()` instead.
- Use `SCOPED_TRACE` to add context information to assertions in subroutines.
- Record properties to supplement reports with additional metadata.

---

## Examples

### Basic Assertion

```cpp
TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(3), 6);
  ASSERT_TRUE(Factorial(2) > 0);
}
```

### Custom Predicate Assertion

```cpp
AssertionResult IsEven(int n) {
  if (n % 2 == 0) return AssertionSuccess();
  return AssertionFailure() << n << " is odd";
}

TEST(NumberTest, EvenCheck) {
  EXPECT_PRED_FORMAT1(IsEven, 4);  // Passes
  EXPECT_PRED_FORMAT1(IsEven, 5);  // Fails with message "5 is odd"
}
```

### Death Test

```cpp
TEST(MyDeathTest, CrashesOnNull) {
  EXPECT_DEATH({ Foo(nullptr); }, "Null pointer error");
}
```

### Skipping a Test

```cpp
TEST(SomeTest, SkippedFeature) {
  if (!IsFeatureReady()) {
    GTEST_SKIP() << "Skipping due to unready feature";
  }
  // Test code
}
```

### Logging Properties

```cpp
TEST(ConfigTest, RecordsMaxAttempts) {
  int max_attempts = ComputeMaxAttempts();
  RecordProperty("max_attempts", max_attempts);
  EXPECT_GT(max_attempts, 0);
}
```

---

For the full list of assertion types and detailed usage, see the [Assertions Reference](../reference/assertions.md) and the [Using Assertions Effectively guide](../guides/core-workflows/using-assertions.mdx). To learn about advanced patterns such as predicate assertions, death tests, and exception handling, consult the [Advanced GoogleTest Topics](../docs/advanced.md).


---

## Troubleshooting and Tips

- Ensure arguments to assertion macros are side-effect-free or have well-understood evaluation behavior, as macros evaluate them exactly once, but order is undefined.
- Avoid fatal assertions in functions with non-void return types.
- Use `SCOPED_TRACE` for contextualizing failures inside helper functions.
- Use `EXPECT_FATAL_FAILURE` and `EXPECT_NONFATAL_FAILURE` macros (from `gtest-spi.h`) to verify that expected failures occur in utility code.
- When tests fail unexpectedly, check that your logic corresponds to assertion fatality needs.

---

## Resources

- [Assertions Reference](../reference/assertions.md)
- [Using Assertions Effectively Guide](../guides/core-workflows/using-assertions.mdx)
- [GoogleTest Primer - Assertions Section](../docs/primer.md#assertions)
- [Advanced GoogleTest Topics - More Assertions](../docs/advanced.md#more-assertions)
- [Testing Reference - Assertions](../reference/testing.md#assertions)

---

_This documentation captures the practical knowledge from GoogleTest's core source and test code to provide you actionable, precise guidance on assertions usage._

---

<Accordion title="Common Assertion Macros">
| Macro               | Description                              |
|---------------------|------------------------------------------|
| `EXPECT_TRUE(cond)`  | Verifies `cond` is true (non-fatal).       |
| `ASSERT_TRUE(cond)`  | Verifies `cond` is true (fatal).           |
| `EXPECT_EQ(a, b)`    | Verifies `a == b` (non-fatal).             |
| `ASSERT_EQ(a, b)`    | Verifies `a == b` (fatal).                  |
| `EXPECT_STREQ(s1,s2)`| Verifies C strings are equal (non-fatal).  |
| `ASSERT_STREQ(s1,s2)`| Verifies C strings are equal (fatal).      |
| `EXPECT_DEATH(stmt, re)` | Death test, expects `stmt` to terminate process matching regex `re`.
| `GTEST_SKIP()`       | Skips current test dynamically.
| `FAIL()`             | Generates an immediate fatal failure.
| `ADD_FAILURE()`      | Generates an immediate non-fatal failure.
</Accordion>

<Accordion title="Using SCOPED_TRACE">
Use SCOPED_TRACE to add context information inside subroutines to assertion failure messages, helping identify the invocation point:

```cpp
void SubTest(int n) {
  EXPECT_EQ(n % 2, 0);
}

TEST(MyTest, CheckEven) {
  SCOPED_TRACE("Checking inputs");
  for (int i = 0; i < 4; i++) {
    SubTest(i);
  }
}
```

This shows which loop iteration failed.
</Accordion>

<Accordion title="Tips for Writing Assertions">
- Prefer `EXPECT_*` unless test cannot sensibly continue.
- Always stream custom failure messages for clarity.
- Use predicate-format assertions to clarify complex conditions.
- Avoid fatal assertions in non-void-returning functions.
- Use `RecordProperty` to collect additional test metadata.
- Follow naming conventions for disabled tests (prefix `DISABLED_`).
</Accordion>

---

[Back to Guides](../guides/core-workflows/using-assertions.mdx) | [GoogleTest Primer](../docs/primer.md) | [Assertions Reference](../reference/assertions.md)