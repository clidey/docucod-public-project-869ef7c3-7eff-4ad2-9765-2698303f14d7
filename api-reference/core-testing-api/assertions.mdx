---
title: "Assertions and Expectations"
description: "Documentation for the wide range of assertion macros (equality, exception, floating point, death, etc.), their intended usage, and the difference between fatal and non-fatal variants. Examples clarify how to ensure robust, readable test verification."
---

# Assertions and Expectations

This page provides a comprehensive reference for the wide range of assertion macros provided by GoogleTest, designed to verify code behavior in C++ testing. It details how to use these macros, the difference between fatal and non-fatal variants, and gives practical examples to create robust, readable tests.

## Understanding Assertions in GoogleTest

Assertions are the fundamental building blocks in GoogleTest that check whether specific conditions hold true in your tests. They come in pairs:

- **EXPECT_**: Non-fatal checks that report failures but allow the test to continue.
- **ASSERT_**: Fatal checks that abort the current test function on failure.

You can append custom failure messages to any assertion using the stream operator (`<<`). This greatly enhances debugging by providing contextual information.

```cpp
EXPECT_TRUE(condition) << "Condition failed because ...";
ASSERT_EQ(expected, actual) << "Mismatch in values";
```


---

## 1. Explicit Success and Failure

Sometimes you want to explicitly record success or failure in a test.

### SUCCEED()

Force a success. Does not make the overall test pass by itself but documents intent.

```cpp
SUCCEED();
```

### FAIL()

Force a fatal failure that aborts the current void function immediately.

```cpp
FAIL() << "Unexpected error happened";
```

### ADD_FAILURE()

Report a non-fatal failure allowing test to continue.

```cpp
ADD_FAILURE() << "This part failed, but test continues";
```

### ADD_FAILURE_AT(file, line)

Report failure at a specific source location; useful when validating complex tests.

```cpp
ADD_FAILURE_AT("foo.cc", 42) << "Value is incorrect";
```


---

## 2. Generalized Assertion with Matchers

`EXPECT_THAT` and `ASSERT_THAT` enable writing expressive assertions using matchers, which provide powerful ways to specify complex conditions.

### Syntax

```cpp
EXPECT_THAT(value, matcher);
ASSERT_THAT(value, matcher);
```

Example: checking a string starts with "Hello":

```cpp
using ::testing::StartsWith;

EXPECT_THAT(message, StartsWith("Hello"));
```

This produces readable, informative failure messages when mismatched.

More about matchers: [Matchers Reference](matchers.md)


---

## 3. Boolean Condition Assertions

Test basic boolean conditions in your tests.

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` verifies the condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` verifies the condition is false.

Example:

```cpp
EXPECT_TRUE(user.IsActive()) << "User should be active";
ASSERT_FALSE(data.IsEmpty());
```


---

## 4. Binary Comparison Assertions

These compare two values using common comparison operators. Arguments must be comparable and can be streamed for failure messages.

| Macro | Meaning |
| --- | --- |
| EXPECT_EQ(val1, val2) / ASSERT_EQ | Verifies equality (val1 == val2). For pointers, tests pointer equality; for C strings, use EXPECT_STREQ instead. |
| EXPECT_NE(val1, val2) / ASSERT_NE | Verifies inequality (val1 != val2). |
| EXPECT_LT(val1, val2) / ASSERT_LT | Verifies less than (val1 < val2). |
| EXPECT_LE(val1, val2) / ASSERT_LE | Verifies less than or equal (val1 <= val2). |
| EXPECT_GT(val1, val2) / ASSERT_GT | Verifies greater than (val1 > val2). |
| EXPECT_GE(val1, val2) / ASSERT_GE | Verifies greater than or equal (val1 >= val2). |

Example:

```cpp
EXPECT_EQ(5, ComputeValue()) << "Computation failed";
ASSERT_LT(received, max_allowed) << "Received too large";
```

Tips:
- When comparing C strings, **do not use** `EXPECT_EQ`; use the string comparators instead.
- Values are evaluated exactly once, preventing side effects.


---

## 5. String Comparison Assertions

For comparing **C strings** (e.g., `const char*`), these macros check string content and optionally ignore case.

| Macro | Meaning |
| --- | --- |
| EXPECT_STREQ(str1, str2) / ASSERT_STREQ | Verifies two C strings have the same content. |
| EXPECT_STRNE(str1, str2) / ASSERT_STRNE | Verifies two C strings differ. |
| EXPECT_STRCASEEQ(str1, str2) / ASSERT_STRCASEEQ | Verifies two C strings are equal ignoring case. |
| EXPECT_STRCASENE(str1, str2) / ASSERT_STRCASENE | Verifies two C strings differ ignoring case. |

Example usage:

```cpp
EXPECT_STREQ("hello", greeting.c_str());
ASSERT_STRCASEEQ("foo", "FOO");
```

Note:
- Comparison of wide C strings (`wchar_t*`) is supported.


---

## 6. Floating-Point Comparison

Due to rounding errors, floating-point numbers need special comparison.

| Macro | Meaning |
| --- | --- |
| EXPECT_FLOAT_EQ(val1, val2) / ASSERT_FLOAT_EQ | Checks `float` values approximately equal within 4 ULPs. |
| EXPECT_DOUBLE_EQ(val1, val2) / ASSERT_DOUBLE_EQ | Checks `double` values approximately equal within 4 ULPs. |
| EXPECT_NEAR(val1, val2, abs_error) / ASSERT_NEAR | Checks values are within an absolute error bound. |

Example:

```cpp
EXPECT_FLOAT_EQ(3.14f, result) << "Calculation off";
ASSERT_NEAR(expected, actual, 0.001) << "Values differ too much";
```

Tips:
- Avoid `EXPECT_EQ` for floats/doubles.
- ULP-based comparisons adapt to floating-point precision nuances.


---

## 7. Exception Assertions

Verify that your code correctly throws or does not throw exceptions. Exceptions must be enabled in your build.

| Macro | Meaning |
| --- | --- |
| EXPECT_THROW(statement, exception_type) / ASSERT_THROW | Verifies `statement` throws the specified exception type. |
| EXPECT_ANY_THROW(statement) / ASSERT_ANY_THROW | Verifies `statement` throws any exception. |
| EXPECT_NO_THROW(statement) / ASSERT_NO_THROW | Verifies `statement` does not throw. |

Example:

```cpp
EXPECT_THROW(DoWork(), MyExceptionType);
ASSERT_NO_THROW(Initialize());
```

Notes:
- Statements can be compound statements inside braces.


---

## 8. Predicate Assertions

For complex Boolean expressions or user-defined predicates, predicate assertions provide clearer failure messages.

### Simple predicates

Use `EXPECT_PRED1` ... `EXPECT_PRED5` and `ASSERT_PRED1` ... `ASSERT_PRED5` to check predicates with 1 to 5 arguments.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
```

### Predicate with detailed formatting

Use `EXPECT_PRED_FORMAT*` and `ASSERT_PRED_FORMAT*` with a predicate-formatter:

```cpp
AssertionResult IsEvenFormatted(const char* expr, int n) {
  if (n % 2 == 0) return AssertionSuccess();
  return AssertionFailure() << expr << " evaluates to " << n << ", which is odd.";
}
EXPECT_PRED_FORMAT1(IsEvenFormatted, value);
```

Tips:
- Helpful for predicates where you want custom explanations on failure.


---

## 9. Windows HRESULT Assertions

Special macros designed to check HRESULT success or failure returned by Windows COM APIs.

| Macro | Meaning |
| --- | --- |
| EXPECT_HRESULT_SUCCEEDED(expression) / ASSERT_HRESULT_SUCCEEDED | Checks HRESULT indicates success. |
| EXPECT_HRESULT_FAILED(expression) / ASSERT_HRESULT_FAILED | Checks HRESULT indicates failure. |

Example:

```cpp
ASSERT_HRESULT_SUCCEEDED(shell.CoCreateInstance(L"Shell.Application"));
EXPECT_HRESULT_FAILED(funcThatFails());
```

Failure messages include the human-readable HRESULT error message.


---

## 10. Death Assertions

Check that a piece of code causes the process to terminate as expected.

| Macro | Meaning |
| --- | --- |
| EXPECT_DEATH(statement, matcher) / ASSERT_DEATH | Verifies process dies with stderr matching `matcher`. |
| EXPECT_DEATH_IF_SUPPORTED(statement, matcher) / ASSERT_DEATH_IF_SUPPORTED | Same as `EXPECT_DEATH` if supported, else no check. |
| EXPECT_DEBUG_DEATH(statement, matcher) / ASSERT_DEBUG_DEATH | Run the death test only in debug mode. |
| EXPECT_EXIT(statement, predicate, matcher) / ASSERT_EXIT | Verifies process terminates with exit status satisfying predicate and stderr output matching matcher. |

Example:

```cpp
EXPECT_DEATH(DoCrash(), "Fatal error on line .*" );
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

Notes:
- `matcher` can be a regular expression or matcher for stderr output.
- `predicate` checks exit code or termination signal.


---

## Usage Tips & Best Practices

- **Choose between EXPECT_ and ASSERT_ carefully:** Use `ASSERT_` when subsequent test code depends on the assertion passing (e.g., to prevent undefined behavior).
- **Avoid over-specifying test expectations:** Too strict tests break easily; specify only necessary checks.
- **Use matchers with `EXPECT_THAT` for expressive tests.**
- **Keep tests isolated** and fail fast to pinpoint issues easily.
- **For floating-point comparisons, use specialized macros** instead of standard equality tests.
- **Use death assertions to verify fatal failures or crashes**, especially when testing assert-like behavior.
- **Use predicate assertions with descriptive messages** for complex checks.


---

## Troubleshooting Common Issues

- _Assertion macro doesn’t abort as expected:_ Ensure you use `ASSERT_` instead of `EXPECT_` for fatal failures.
- _Incorrect string comparison:_ Use `EXPECT_STREQ` or `EXPECT_STRCASEEQ` for C strings rather than `EXPECT_EQ`.
- _Floating-point precision issues:_ Prefer `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR`.
- _Death tests fail silently or hang:_ Check that test code actually triggers the termination; watch for threading issues.
- _Unclear failure messages:_ Add custom failure messages using streaming or use predicate-format assertions.


---

## Examples

### Basic Equality Check with Custom Message

```cpp
TEST(MathTest, SumWorks) {
  int result = Add(2, 2);
  EXPECT_EQ(result, 4) << "Add() should correctly sum the inputs.";
}
```

### Checking String Start with Matcher

```cpp
using ::testing::StartsWith;

TEST(ApiTest, ReturnsGreeting) {
  std::string greeting = GetGreeting();
  ASSERT_THAT(greeting, StartsWith("Hello"));
}
```

### Floating-point Approximate Equality

```cpp
TEST(FloatTest, ComputesPiApprox) {
  float pi_approx = ComputePi();
  EXPECT_FLOAT_EQ(pi_approx, 3.14159f);
}
```

### Expect an Exception is Thrown

```cpp
TEST(ExceptionsTest, ThrowsOnInvalidInput) {
  EXPECT_THROW(ProcessInput("bad"), InvalidInputException);
}
```

### Expect Death

```cpp
TEST(DeathTest, TerminatesOnNullPointer) {
  EXPECT_DEATH(Process(nullptr), "Null pointer detected");
}
```


---

For a complete list of assertion macros, detailed explanations of matchers, and advanced usage examples, see the [Assertions Reference](reference/assertions.md).

# See Also

- [Matchers Reference](matchers.md) — For advanced argument matching in assertions
- [gMock for Dummies](guides/getting-started/exploring-mock-objects) — Understand mocking interplay with assertions
- [Mocking Best Practices](guides/real-world-workflows/mocking-best-practices) — How to use expectations properly
- [Advanced GoogleTest Topics](guides/advanced-and-integration-guides/ci-integration-and-best-practices) — For sophisticated test management


<Info>
Remember: Use `EXPECT_` assertions if your test can continue after a failure and `ASSERT_` assertions when continuing execution does not make sense.
</Info>

<Check>
Always verify that your assertions clearly communicate the intent of your test and provide actionable failure messages.
</Check>
