---
title: "Assertions and Expectations"
description: "Provides a thorough reference to all assertion macros, including equality, comparison, fatal/non-fatal failures, and user-defined assertions. Covers keys to effective failure reporting and debugging."
---

# Assertions and Expectations

GoogleTest provides a rich suite of assertion macros and expectation APIs designed to help you verify conditions in your C++ tests clearly and effectively. This reference document covers fundamental and advanced assertion macros, predicates, user-defined assertions, and best practices for crafting informative failure messages.

---

## 1. Understanding Assertion Types

- **Fatal vs Nonfatal Failures**
  - **Fatal (ASSERT_)**: Immediately aborts the current function, preventing further code execution within that context.
  - **Nonfatal (EXPECT_)**: Reports failure but allows the current function to continue.

- **Assertion Placement**
  - Fatal assertions (`ASSERT_*`, `FAIL()`) must be used in functions that return void.
  - Nonfatal assertions (`EXPECT_*`, `ADD_FAILURE()`) can be used anywhere.

<Tip>
Always choose ASSERT_ macros when continuing after a failure risks misleading test execution, and EXPECT_ macros when you want to collect multiple failures in one run.
</Tip>

---

## 2. Basic Boolean and Comparison Assertions

Use these to verify simple conditions and value comparisons:

| Assertion Macro | Meaning                                                        | Example                         |
|-----------------|----------------------------------------------------------------|--------------------------------|
| `EXPECT_TRUE(cond)`, `ASSERT_TRUE(cond)` | Assert *cond* is true                             | `EXPECT_TRUE(isValid());`       |
| `EXPECT_FALSE(cond)`, `ASSERT_FALSE(cond)` | Assert *cond* is false                           | `EXPECT_FALSE(hasErrors());`    |
| `EXPECT_EQ(val1, val2)`, `ASSERT_EQ(val1, val2)` | Assert *val1 == val2*                       | `EXPECT_EQ(sum, expectedSum);`  |
| `EXPECT_NE(val1, val2)`, `ASSERT_NE(val1, val2)` | Assert *val1 != val2*                       | `ASSERT_NE(ptr, nullptr);`       |
| `EXPECT_LT(val1, val2)`, `ASSERT_LT(val1, val2)` | Assert *val1 < val2*                        | `EXPECT_LT(score, maxScore);`    |
| `EXPECT_LE(val1, val2)`, `ASSERT_LE(val1, val2)` | Assert *val1 <= val2*                       | `EXPECT_LE(count, limit);`       |
| `EXPECT_GT(val1, val2)`, `ASSERT_GT(val1, val2)` | Assert *val1 > val2*                        | `EXPECT_GT(rate, threshold);`   |
| `EXPECT_GE(val1, val2)`, `ASSERT_GE(val1, val2)` | Assert *val1 >= val2*                       | `ASSERT_GE(age, 18);`            |

<Note>
For C strings (e.g., `const char*`), use `EXPECT_STREQ()` and `EXPECT_STRNE()` instead of `EXPECT_EQ` and `EXPECT_NE` to compare string contents rather than pointer addresses.
</Note>

### Example:
```cpp
EXPECT_EQ(x, y) << "Expected x to be equal to y";
ASSERT_TRUE(isReady());
EXPECT_STREQ("hello", str);
```

---

## 3. String-Specific Assertions

GoogleTest provides string-focused assertions that compare C strings with correct semantics.

| Assertion Macro            | Description                                   | Example                             |
|----------------------------|-----------------------------------------------|------------------------------------|
| `EXPECT_STREQ(a, b)`       | Checks if C strings *a* and *b* are equal     | `EXPECT_STREQ("foo", cstr);`      |
| `EXPECT_STRNE(a, b)`       | Checks if C strings *a* and *b* are not equal | `EXPECT_STRNE(cstr1, cstr2);`       |
| `EXPECT_STRCASEEQ(a, b)`   | Case-insensitive string equality              | `EXPECT_STRCASEEQ("FOO", "foo");`|
| `EXPECT_STRCASENE(a, b)`   | Case-insensitive string inequality            | `EXPECT_STRCASENE("bar", "baz");`|

<Info>
Wide strings (`wchar_t*` or `std::wstring`) are also supported and will be printed as UTF-8 on failure.
</Info>

---

## 4. Floating-Point Comparisons

Due to rounding errors, exact equality is rare. Use these approximate comparisons:

| Assertion Macro              | Description                             | Details                        |
|------------------------------|---------------------------------------|-------------------------------|
| `EXPECT_FLOAT_EQ(a, b)`     | Checks `float` values approximately equal | Approximately 4 ULPs difference |
| `EXPECT_DOUBLE_EQ(a, b)`    | Checks `double` values approximately equal| Approximately 4 ULPs difference |
| `EXPECT_NEAR(a, b, abs_error)` | Checks values differ by no more than `abs_error` | Useful for absolute tolerances    |

### Example:
```cpp
EXPECT_FLOAT_EQ(3.1415f, result);
ASSERT_NEAR(computed_value, expected_value, 1e-6);
```

---

## 5. Exception Assertions

Requires exceptions enabled.

| Assertion Macro       | Description                                   | Example                               |
|-----------------------|-----------------------------------------------|--------------------------------------|
| `EXPECT_THROW(stmt, exc_type)` | Expects `stmt` to throw `exc_type` exception | `EXPECT_THROW(divide(-1), std::runtime_error);` |
| `EXPECT_ANY_THROW(stmt)` | Expects `stmt` to throw any exception           | `EXPECT_ANY_THROW(doRiskyOperation());`         |
| `EXPECT_NO_THROW(stmt)` | Expects `stmt` not to throw any exception        | `EXPECT_NO_THROW(doSafeOperation());`           |

.

---

## 6. Predicate Assertions for Complex Conditions

When simple assertions don't provide informative output, predicates help.

- `EXPECT_PRED1(pred, val1)` ... up to `EXPECT_PRED5(pred, val1, ..., val5)` allow predicates with 1 to 5 arguments.
- `EXPECT_PRED_FORMAT*` accept a *predicate-formatter* that returns `testing::AssertionResult` for rich failure info.

### Use Case:
If you have a complex predicate like whether two numbers are mutually prime:

```cpp
bool MutuallyPrime(int a, int b) { ... }

EXPECT_PRED2(MutuallyPrime, 3, 4);  // passes
EXPECT_PRED2(MutuallyPrime, 4, 10); // fails
```

For detailed error reporting, define a predicate-formatter:

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* a_expr, const char* b_expr, int a, int b) {
  if (MutuallyPrime(a, b)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << a_expr << " and " << b_expr << " are not mutually prime";
}

EXPECT_PRED_FORMAT2(AssertMutuallyPrime, 4, 10);
```

---

## 7. Generalized Assertions with Matchers

With Google Mock matchers integrated, `EXPECT_THAT` and `ASSERT_THAT` combine expressive matching with assertions.

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
ASSERT_THAT(numbers, AllOf(Ge(5), Lt(10)));
```

Matchers allow flexible, human-readable assertions over values, containers, strings, exceptions, and more.

---

## 8. Explicit Success, Failure, and Skipping

- `SUCCEED()` generates a success record without ending the test.
- `FAIL()` triggers a fatal failure immediately.
- `ADD_FAILURE()` generates a non-fatal failure.
- `GTEST_SKIP()` skips the current test at runtime with a provided message.

### Usage example:
```cpp
TEST(SomeTest, SkipsOnCondition) {
  if (!HasNetwork()) {
    GTEST_SKIP() << "Network unavailable";
  }
  ... // test code
}
```

---

## 9. Predicate Assertions with `AssertionResult`

Improve error messages in predicates by returning `testing::AssertionResult` instead of `bool`.

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is not even";
}

EXPECT_TRUE(IsEven(value));
```

This reports the actual failure message instead of a generic true/false.

---

## 10. Handling Failures in Subroutines

By default, `ASSERT_*` aborts the current function, but the calling function continues.

To stop test execution on sub-function failures:

- Use `ASSERT_NO_FATAL_FAILURE(statement);` to assert *no fatal failure* inside `statement`.
- After calling a subroutine, check `if (testing::Test::HasFatalFailure()) return;` to stop flow.

---

## 11. Logging Additional Information

You can log custom key-value properties inside tests which will be output in XML reports using:

```cpp
RecordProperty("key", value_or_string);
```

The last recorded value for a key is output per test or test suite.

---

## 12. Tips and Best Practices

- Use `SCOPED_TRACE()` to add context messages that propagate through assertion failures in helper functions and nested calls.
- Prefer using matchers (`EXPECT_THAT`) over complex predicates for clarity.
- Use typed or parameterized tests for repetitive assertions over many types or inputs.
- When writing death tests, structure tests carefully to isolate failures.
- Teach GoogleTest how to print custom types using `AbslStringify()` or `PrintTo()` functions for better failure message clarity.

---

## 13. Examples

### Checking equality with failure message
```cpp
EXPECT_EQ(factorial(4), 24) << "Factorial of 4 should be 24";
```

### Using predicate-formatter
```cpp
testing::AssertionResult IsSorted(const int* start, const int* end) {
  for (const int* p = start; p + 1 != end; p++) {
    if (*(p + 1) < *p)
      return testing::AssertionFailure() << "Sequence is not sorted.";
  }
  return testing::AssertionSuccess();
}

EXPECT_PRED_FORMAT2(IsSorted, arr, arr + size);
```

### Using matchers
```cpp
EXPECT_THAT(vec, ::testing::ElementsAre(1, 2, 3));
EXPECT_THAT(name, ::testing::StartsWith("John"));
```

### Skipping tests
```cpp
TEST(FooTest, SkipIfNoNetwork) {
  if (!NetworkAvailable()) {
    GTEST_SKIP() << "Test skipped: no network.";
  }
  // test code
}
```

---

## 14. Troubleshooting Common Issues

- Fatal assertions in non-void functions cause confusing compile errors.
- Using assertions inside constructors or destructors is not supported; use `SetUp()`/`TearDown()` instead.
- Complex predicates might hide values; prefer using `testing::AssertionResult` for clearer messages.
- For absolute control of failure tracing and context, use `SCOPED_TRACE`.

---

## 15. Further Reading and Links
- [GoogleTest Primer](primer.md) – Basics of testing with GoogleTest
- [Matchers Reference](matchers.md) – Comprehensive list of matchers
- [gMock Cookbook](gmock_cook_book.md) – Guides on mocking and assertions
- [Advanced GoogleTest Topics](advanced.md) – Deep dive into assertions and failure handling
- [Common Setup Issues & Solutions](../getting-started/troubleshooting-faq/common-setup-issues)

---

This page fits into the API Reference under `Core Testing API` and complements guides on writing tests and organizing test suites.

---

*Use the assertion macros judiciously to ensure your tests are both robust and informative, accelerating your debugging and development workflow.*


---
