---
title: "Assertions and Expectations"
description: "Detailed API reference for the full suite of assertions and expectations provided by GoogleTest, including equality, exception, and death test assertions. Also covers custom assertion macros and fine-tuning test failure severity (fatal vs. non-fatal)."
---

# Assertions and Expectations

This reference details GoogleTest's Assertions and Expectations, which form the backbone of verifying code correctness through testing. Here you'll find descriptions of assertion macros to validate conditions and values within your tests, as well as the expected interactions when using GoogleMock to specify mock behaviors.

---

## 1. Core Assertions Overview

Assertions verify conditions in your code during test execution and report failures in case the conditions aren't met. They come in two main types:

- **Nonfatal Assertions (`EXPECT_`)**: On failure, they log an error but allow the current test to continue.
- **Fatal Assertions (`ASSERT_`)**: On failure, they immediately abort the current function or test.

### 1.1 Explicit Success and Failure

- `SUCCEED()` generates a success
- `FAIL()` produces a fatal failure immediately
- `ADD_FAILURE()` generates a nonfatal failure

```cpp
EXPECT_TRUE(condition) << "Helpful failure message";
FAIL() << "Test failed due to invalid state.";
```

## 2. Predicate Assertions

Predicates allow complex evaluations with better failure messages.

### 2.1 EXPECT_PRED

Verify predicates with up to five arguments:

```cpp
EXPECT_PRED2(IsMutuallyPrime, a, b);
```

On failure, prints input values to help diagnose issues.

### 2.2 EXPECT_PRED_FORMAT

More customizable predicate with user-defined failure message formatting.

## 3. Binary Comparison Assertions

Compare two values usually with operators like `==`, `!=`, `<`, etc.

- `EXPECT_EQ(val1, val2)`: Verifies `val1 == val2`
- `EXPECT_NE(val1, val2)`: Verifies `val1 != val2`
- `EXPECT_LT(val1, val2)`, `EXPECT_LE(val1, val2)`, `EXPECT_GT(val1, val2)`, `EXPECT_GE(val1, val2)`

```cpp
EXPECT_EQ(expected_value, actual_value);
EXPECT_NE(ptr1, ptr2);
```

> **Note:** When comparing C strings, use `EXPECT_STREQ` or `EXPECT_STRNE` for content comparison.

## 4. String Comparison Assertions

For null-terminated C-style strings:

- `EXPECT_STREQ(str1, str2)`: Expect equal contents
- `EXPECT_STRNE(str1, str2)`: Expect different contents
- `EXPECT_STRCASEEQ` and `EXPECT_STRCASENE` for case-insensitive comparisons

## 5. Floating-Point Comparison

Due to rounding errors, approximate comparisons are recommended.

- `EXPECT_FLOAT_EQ(val1, val2)`: Approx equality within 4 ULPs for `float`
- `EXPECT_DOUBLE_EQ(val1, val2)`: Approx equality for `double`
- `EXPECT_NEAR(val1, val2, abs_error)`: Verifies difference within absolute error bound

## 6. Exception Assertions

Verify exceptions thrown or not thrown by code.

- `EXPECT_THROW(statement, exception_type)`
- `EXPECT_ANY_THROW(statement)`
- `EXPECT_NO_THROW(statement)`

Useful for test scenarios requiring exception validation.

## 7. GoogleMock Expectations

In GoogleMock, expectations allow specification of mock method calls and their expected behavior.

### 7.1 EXPECT_CALL Macro

Use `EXPECT_CALL(mock_object, Method(matchers))` to specify that a mock method is expected to be called with specific argument matchers. Optionally chain clauses to control call count, ordering, and behavior:

```cpp
EXPECT_CALL(mock_object, Method(matchers))
    .With(multi_argument_matcher)
    .Times(cardinality)
    .InSequence(sequences...)
    .After(expectations...)
    .WillOnce(action)
    .WillRepeatedly(action)
    .RetiresOnSaturation();
```

- `.With()`: Advanced multi-argument matching
- `.Times()`: Specify expected invocation count (e.g., `AnyNumber()`, `Exactly(n)`)
- `.InSequence()`: Impose a strict call order
- `.After()`: Defines partial ordering dependencies
- `.WillOnce()`, `.WillRepeatedly()`: Define mock actions
- `.RetiresOnSaturation()`: Retire expectation once saturated

### 7.2 ON_CALL Macro

Defines default mock method behavior without enforcing call expectations.

```cpp
ON_CALL(mock_object, Method(matchers))
    .With(multi_argument_matcher)
    .WillByDefault(action);
```

- `.With()` is optional and restricts behavior with multi-argument matchers.
- `.WillByDefault()` is mandatory and defines the default action.

### 7.3 Common Expectations and Usages

```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::Return;
using ::testing::Exactly;
using ::testing::AnyNumber;

EXPECT_CALL(mockObj, Func(5))
    .Times(Exactly(3))
    .WillRepeatedly(Return(10));

ON_CALL(mockObj, Func(_))
    .WillByDefault(Return(0));
```

### 7.4 Sequences and Ordering

Use `Sequence` and `InSequence` to enforce call order:

```cpp
Sequence s1, s2;
EXPECT_CALL(mockObj, A())
    .InSequence(s1, s2);
EXPECT_CALL(mockObj, B())
    .InSequence(s1);
EXPECT_CALL(mockObj, C())
    .InSequence(s2);
```

### 7.5 Managing Expectations Lifecycle

- Expectations are verified automatically upon mock destruction.
- Use `Mock::VerifyAndClearExpectations(&mockObj);` to check early.
- Use `Mock::AllowLeak(&mockObj);` to suppress leak detection and verification.

### 7.6 Handling Uninteresting and Unexpected Calls

- Uninteresting calls: methods without `EXPECT_CALL` are “uninteresting”. By default, warnings are issued.
- Unexpected calls: calls that don’t match any active expectation; always errors.
- Use `NiceMock<T>` and `StrictMock<T>` to control how uninteresting calls are treated.

## 8. Examples

### 8.1 Basic Assertion Example

```cpp
TEST(MyTest, IsPositive) {
  int x = 5;
  EXPECT_GT(x, 0) << "x should be positive";
}
```

### 8.2 Using EXPECT_CALL and ON_CALL

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, GetValue, (), ());
};

MockFoo mock;

ON_CALL(mock, GetValue()).WillByDefault(Return(42));
EXPECT_CALL(mock, GetValue()).Times(2).WillOnce(Return(10)).WillOnce(Return(20));

int a = mock.GetValue();  // Returns 10
int b = mock.GetValue();  // Returns 20
int c = mock.GetValue();  // Returns 42 (default)
```

### 8.3 Sequence Example

```cpp
using ::testing::InSequence;

{
  InSequence seq;
  EXPECT_CALL(mockObj, MethodA());
  EXPECT_CALL(mockObj, MethodB());
}

// Calls to mockObj.MethodB() before MethodA() will fail.
```

### 8.4 Partial Ordering with After

```cpp
using ::testing::Expectation;

Expectation e1 = EXPECT_CALL(mockObj, Init());
EXPECT_CALL(mockObj, Start()).After(e1);
```

## 9. Best Practices

- Set expectations **before** exercising code that triggers mock calls.
- Use `ON_CALL` for default behavior; use `EXPECT_CALL` to verify expected calls.
- Be deliberate with the use of `Times()`, especially with `.Times(0)` to forbid calls.
- Use argument matchers to loosen or tighten expectation matching precisely.
- Utilize `Sequence` or `.After()` to impose order only when necessary to avoid brittle tests.
- Use `RetiresOnSaturation()` for expectations that should automatically deactivate after their limit.
- Consider `NiceMock`, `NaggyMock`, and `StrictMock` to control warning and failure behavior for uninteresting calls.

## 10. Troubleshooting

### 10.1 Unexpected Call Failures

- Ensure all expected calls are declared prior to mock usage.
- Check argument matchers; an unexpected call usually means arguments did not match any expectation.

### 10.2 Too Many or Too Few Calls

- Verify `Times()` clauses correctly specify cardinality.
- Remember that multiple `WillOnce()` actions may imply call counts.

### 10.3 Uninteresting Call Warnings

- Use `NiceMock` to suppress warnings if uninteresting calls are intentional.
- Add catch-all `EXPECT_CALL` with `.Times(AnyNumber())` if certain methods are called but not of primary interest.

### 10.4 Mock Object Leak Detection

- Use `Mock::AllowLeak(&mockObj);` to mark intentional leaks.
- Ensure mocks are properly deleted to trigger verification.

---

For advanced usage, including custom actions, matchers, and asynchronous testing, see the [gMock Cookbook](gmock_cook_book.md) and [Mocking Reference](docs/reference/mocking.md).

---

# Related Links

- [EXPECT_CALL](docs/reference/mocking.md#EXPECT_CALL)
- [ON_CALL](docs/reference/mocking.md#ON_CALL)
- [Matchers Reference](reference/matchers.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Writing Custom Matchers and Actions](guides/advanced-usage/custom-matchers-actions.md)
- [Mock Strictness and Lifecycle](guides/mocking-patterns/mock-strictness-lifecycle.md)
- [GoogleTest Assertions Reference](docs/reference/assertions.md)
- [Mocking Patterns and Workflows Guide](guides/mocking-patterns/setting-expectations-actions.md)

---

<Source url="https://github.com/google/googletest" paths='[{"path":"docs/reference/assertions.md","range":"1-142"},{"path":"docs/reference/mocking.md","range":"1-561"},{"path":"docs/gmock_cook_book.md","range":"1-721"}]' />