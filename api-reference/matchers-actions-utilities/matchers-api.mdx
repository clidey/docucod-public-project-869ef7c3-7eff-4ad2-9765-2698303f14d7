---
title: "Matchers Library"
description: "Reference for built-in and composable matchers used in assertions and mock expectations. Details on writing readable value checks and extending with custom matchers."
---

# Matchers Library

This documentation page offers a comprehensive reference to the matchers provided by GoogleMock, which are fundamental building blocks for validating values in expectations and assertions. Matchers allow you to specify fine-grained conditions on mock method arguments and test expressions with expressive, readable syntax.

---

## Overview of Matchers

Matchers work as predicates that test whether an argument or value satisfies a condition. They are particularly powerful when combined with GoogleMock's `EXPECT_CALL` and GoogleTest's `EXPECT_THAT` assertions to verify detailed properties of values.

There are many built-in matchers covering common scenarios, and users can create custom matchers using provided macros or by defining matcher classes.


## Using Matchers

You can use matchers in various contexts:

- **In `EXPECT_CALL` statements:** to specify which arguments are expected when a mock method is invoked.
- **In `EXPECT_THAT` or `ASSERT_THAT`:** to verify arbitrary expressions meet certain criteria.

Matchers can be simple, like equality checks, or more complex, such as matching multiple arguments as tuples or validating containers.


## Basic Matcher Examples

```cpp
using ::testing::Eq;
using ::testing::_;
using ::testing::Gt;

// Expect mock_foo.Bar() to be called with argument 42
EXPECT_CALL(mock_foo, Bar(Eq(42)));

// Expect mock_foo.SetPosition() with any two arguments
EXPECT_CALL(mock_foo, SetPosition(_, _));

// Check if variable matches a condition (greater than 10)
EXPECT_THAT(value, Gt(10));
```


## Common Matchers

| Matcher          | Description                                             | Example Usage                     |
| ---------------- | ------------------------------------------------------- | -------------------------------- |
| `_`              | Matches anything (wildcard).                            | `EXPECT_CALL(foo, Bar(_));`      |
| `Eq(val)`        | Matches any value equal to `val`.                       | `EXPECT_THAT(x, Eq(5));`          |
| `Ne(val)`        | Matches any value not equal to `val`.                   | `EXPECT_THAT(x, Ne(0));`          |
| `Lt(val)`        | Matches values less than `val`.                          | `EXPECT_THAT(x, Lt(10));`         |
| `Le(val)`        | Less than or equal to `val`.                            | `EXPECT_THAT(x, Le(20));`         |
| `Gt(val)`        | Greater than `val`.                                     | `EXPECT_THAT(x, Gt(-1));`         |
| `Ge(val)`        | Greater than or equal to `val`.                         | `EXPECT_THAT(x, Ge(100));`        |
| `IsNull()`       | Matches null pointers or smart pointers equal to nullptr. | `EXPECT_THAT(ptr, IsNull());`    |
| `NotNull()`      | Matches non-null pointers or smart pointers.            | `EXPECT_THAT(ptr, NotNull());`    |
| `Ref(var)`       | Matches a reference bound to the specified variable.    | `EXPECT_CALL(mock, Foo(Ref(x)));` |
| `StrEq(s)`       | Matches strings that are equal to `s`.                   | `EXPECT_THAT(str, StrEq("hello"));` |
| `StartsWith(s)`  | Matches strings that start with `s`.                     | `EXPECT_THAT(str, StartsWith("test"));` |
| `EndsWith(s)`    | Matches strings that end with `s`.                       | `EXPECT_THAT(str, EndsWith("ing"));` |
| `HasSubstr(s)`   | Matches strings containing `s` as substring.            | `EXPECT_THAT(str, HasSubstr("mid"));` |
| `Pointee(m)`     | Matches a pointer whose pointee matches `m`.            | `EXPECT_THAT(ptr, Pointee(Eq(5)));` |
| `Field(&Class::field, m)` | Matches if the `field` of an object matches `m`.   | `EXPECT_THAT(obj, Field(&Foo::x, Eq(10)));` |
| `Property(&Class::getter, m)` | Matches if getter method return matches `m`.       | `EXPECT_THAT(obj, Property(&Foo::GetVal, Gt(0)));` |
| `Contains(m)`    | Matches containers containing at least one element matching `m`. | `EXPECT_THAT(vec, Contains(42));` |
| `Each(m)`       | Matches if all elements in a container match `m`.       | `EXPECT_THAT(vec, Each(Ge(0)));`   |
| `ElementsAre(...)` | Matches a sequence of elements with exact order and matching conditions. | `EXPECT_THAT(vec, ElementsAre(1, 2, 3));` |
| `UnorderedElementsAre(...)` | Like `ElementsAre`, but ignores order.            | `EXPECT_THAT(set, UnorderedElementsAre(3, 1, 2));` |
| `Pointwise(matcher, container)` | Matches containers element-wise by pairing elements with the matcher. | `EXPECT_THAT(vec, Pointwise(Eq(), expected));` |


## Custom Matchers

You can extend matchers easily:

### Using MATCHER Macros

Create readable matchers quickly:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

// Usage:
EXPECT_CALL(foo, Bar(IsDivisibleBy7()));
```

For parameterized matchers, use `MATCHER_P`, `MATCHER_P2`, ... up to 10 parameters.

Example:

```cpp
MATCHER_P(InRange, n, "") {
  return arg >= 0 && arg <= n;
}

EXPECT_THAT(x, InRange(10));
```


### Implementing Matcher Interfaces

Advanced users can implement the `MatcherInterface<T>` for full control over matching behavior and description.


## Chaining and Combining Matchers

Matchers can be combined using:

- `AllOf(m1, m2, ...)`: matches if all matchers match.
- `AnyOf(m1, m2, ...)`: matches if any matcher matches.
- `Not(m)`: negates matcher `m`.

Example:

```cpp
EXPECT_THAT(value, AllOf(Ge(0), Le(10))); // Value between 0 and 10.
```

## Matching Tuples and Multiple Arguments as a Whole

Matchers like `With` (in expectations) and `Args` allow matching multiple arguments collectively as a tuple.

Example with `With`:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // first argument less than second
```

## Matching Containers

Matchers for container content and properties are available:

- `IsEmpty()`: matches empty containers or strings.
- `Contains(m)`: container contains an element matching `m`.
- `Each(m)`: all elements match `m`.
- `ElementsAre(...)`: matches elements in order.
- `UnorderedElementsAre(...)`: matches elements ignoring order.
- `SizeIs(m)`: matches container size.
- `WhenSorted(m)`: matches container after sorting.


## Special Matchers

- `SafeMatcherCast<T>(m)`: safely casts matcher `m` to target type `T` when types differ but conversions are safe.
- `MatcherCast<T>(m)`: a less safe cast with broader allowance.


## Tips and Best Practices

- Prefer matchers over manual checks; they produce clearer test failure messages.
- Use parameterized matchers to keep tests readable and reusable.
- Use `ON_CALL` to specify default actions separately from `EXPECT_CALL` which sets expectations.
- Use `NiceMock` to suppress warnings about uninteresting calls.
- Use `StrictMock` to treat uninteresting calls as failures.
- Use `InSequence` or `After` clauses to order expectations.


## Examples

### Basic Equality Matcher

```cpp
EXPECT_CALL(mock_obj, Foo(Eq(123)));
```

### Wildcard Matcher

```cpp
EXPECT_CALL(mock_obj, Foo(_));  // All calls to Foo with any argument
```

### Custom Matcher

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
EXPECT_CALL(mock, Bar(IsEven()));
```

### Matching Containers

```cpp
std::vector<int> vec = {1, 2, 3};
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(vec, Contains(2));
EXPECT_THAT(vec, Each(Gt(0)));  // all elements > 0
```

### Combining Matchers

```cpp
EXPECT_THAT(val, AllOf(Ge(10), Le(20)));  // val between 10 and 20
EXPECT_THAT(str, AnyOf(StrEq("foo"), StrEq("bar")));
```

### Matching Pointers

```cpp
EXPECT_THAT(ptr, Pointee(Eq(5)));  // ptr points to value equal to 5
```

### Matching Fields of an Object

```cpp
EXPECT_THAT(person, Field(&Person::age, Ge(18)));
```

### Matching Properties via Getters

```cpp
EXPECT_THAT(obj, Property(&MyClass::GetName, StrEq("John")));
```


## Advanced Topics

- **Safe and explicit casting:** When matcher types differ from argument types, `SafeMatcherCast` ensures no unsafe conversions.
- **Using matchers with smart pointers and user-defined types:** Matchers work transparently with smart pointers, containers, and user classes.
- **Polymorphic matchers:** Many matchers adapt to different argument types seamlessly.


## Extending and Writing Your Own Matchers

GoogleMock supports easy creation of matchers using macros (`MATCHER`, `MATCHER_P`, etc.) or implementing matcher interface classes for deeper control.

You can describe custom failure messages to make tests more expressive and helpful.


## Understanding Match Explanation and Debugging

Matchers provide detailed diagnostics to explain why a match failed or succeeded, improving test debuggability.

Using `--gmock_verbose=info` can give insight into mock function invocation and matcher usage.


## See Also

- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cookbook](guides/real-world-testing/scenarios-patterns)
- [GoogleTest Assertions Reference](docs/reference/assertions.md)

---

## Code & Example Snippets

Here are some representative code snippets illustrating matcher usage:

### Matcher on a Mock Method

```cpp
using ::testing::Return;
using ::testing::_;

class MockFoo {
 public:
  MOCK_METHOD(int, GetSize, (), (const));
  MOCK_METHOD(std::string, Describe, (int type));
};

MockFoo mock;
EXPECT_CALL(mock, GetSize()).WillOnce(Return(5));
EXPECT_CALL(mock, Describe(42)).WillOnce(Return("Answer"));
```

### Using `EXPECT_THAT` with Matchers

```cpp
using ::testing::Gt;
using ::testing::StartsWith;

int actual_value = 10;
EXPECT_THAT(actual_value, Gt(5));

std::string name = "Michael";
EXPECT_THAT(name, StartsWith("Mic"));
```

### Custom Matcher Using `MATCHER`

```cpp
MATCHER(IsEven, "is even") {
  return (arg % 2) == 0;
}

EXPECT_THAT(4, IsEven());   // passes
EXPECT_THAT(5, IsEven());   // fails
```

### Matching Container Elements

```cpp
std::vector<int> numbers = {1, 2, 3};
EXPECT_THAT(numbers, ElementsAre(1, 2, 3));
EXPECT_THAT(numbers, Contains(2));
EXPECT_THAT(numbers, Each(Gt(0)));
```


## Troubleshooting Common Issues

- **Matcher type mismatches:** Use `SafeMatcherCast` or explicit casts.
- **Overloaded method ambiguity:** Use `Const()` or specify matchers with explicit types.
- **Uninteresting calls causing warnings:** Use `NiceMock` or add catch-all expectations with `Times(AnyNumber())`.


## Best Practices

- Use matchers to express only constraints that matter.
- Avoid over-specifying expectations; keep tests maintainable.
- Use factory macros (`MATCHER*`) for quick matcher definitions.
- Write clear descriptive messages in custom matchers.
- Scope expectations clearly and use sequences for ordering.


---

This concludes the Matchers Library reference to GoogleMock’s matcher utilities.

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/include/gmock/gmock-matchers.h", "range": "1-600"}]} />