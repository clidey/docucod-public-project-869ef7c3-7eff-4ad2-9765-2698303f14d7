---
title: "Actions Library"
description: "Overview of built-in and custom actions for defining what mocked methods do when called. Covers standard actions, value returning, invoking callbacks, custom templates, and variadic actions."
---

# Actions Library

This documentation provides a comprehensive overview of the built-in and custom actions in GoogleMock that define what mocked methods do when invoked. Actions specify the behavior of mock functions and enable precise control over return values, side effects, and invocation logic for your mock methods.

All actions described here are defined in the `::testing` namespace and can be used with `EXPECT_CALL()` and `ON_CALL()` to tailor the behavior of mock methods during your tests.

---

## 1. Introduction to Actions

When you use a mock object, the behavior of its methods must be defined to specify what should happen when they are called. Actions represent the behavior associated with mock methods. They include returning specific values, invoking callbacks, modifying arguments, and combining multiple behaviors.

### Why Use Actions?

- **Simulate realistic behavior** for dependencies in your tests without actual implementations.
- **Control return values dynamically** to test different scenarios.
- **Inject side effects** such as setting output parameters or invoking callbacks.
- **Chain multiple behaviors** to execute complex logic in your mocks.


## 2. Built-in Actions Overview

### Returning Values

| Action             | Description                                                                                                      |
| ------------------ | ---------------------------------------------------------------------------------------------------------------- |
| `Return()`         | Returns from a `void` method (i.e., does nothing).                                                               |
| `Return(value)`    | Returns the specified `value`. Value is converted to the mock method’s return type at the **time the expectation is set**, not when called. |
| `ReturnArg<N>()`   | Returns the `N`-th (0-based) argument of the mock method call.                                                   |
| `ReturnNew<T>(...)`| Returns a new instance of type `T` constructed with the provided arguments. A new object is created on each invocation. |
| `ReturnNull()`     | Returns a null pointer.                                                                                           |
| `ReturnPointee(ptr)`| Returns the value pointed to by `ptr` at call time (useful for returning live values).                            |
| `ReturnRef(variable)`| Returns a reference to a variable (for mock methods returning a reference).                                      |
| `ReturnRefOfCopy(value)`| Returns a reference to a copy of `value` that persists as long as the action.                                  |
| `ReturnRoundRobin({a1, ..., ak})` | Cycles through a list of values, returning each in turn repeatedly.                                        |

### Side Effects

| Action                      | Description                                                                                       |
| --------------------------- | ------------------------------------------------------------------------------------------------- |
| `Assign(&variable, value)`  | Assigns `value` to the given variable.                                                           |
| `DeleteArg<N>()`            | Deletes (calls `delete`) on the `N`-th argument, which must be a pointer.                         |
| `SaveArg<N>(pointer)`       | Saves the `N`-th argument into the object pointed to by `pointer` using copy assignment.          |
| `SaveArgByMove<N>(pointer)` | Saves the `N`-th argument into the object pointed to by `pointer` using move semantics.           |
| `SaveArgPointee<N>(pointer)`| Saves the value pointed to by the `N`-th argument into `*pointer`.                                |
| `SetArgReferee<N>(value)`  | Assigns `value` to the variable referenced by the `N`-th argument.                               |
| `SetArgPointee<N>(value)`  | Assigns `value` to the object pointed to by the `N`-th argument.                                 |
| `SetArgumentPointee<N>(value)` | Alias for `SetArgPointee<N>(value)`. Deprecated, avoid use.                                 |
| `SetArrayArgument<N>(first, last)` | Copies a range [`first`, `last`) into the array or iterator pointed to by the `N`-th argument. |
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` and returns `value`.                                                  |
| `Throw(exception)`          | Throws the specified exception when invoked.                                                    |

### Using Functions, Functors, or Lambdas as Actions

| Action Description |
| ------------------ |
| Simply provide a callable (function, lambda, functor) that will be invoked with the arguments of the mock method. The callable’s return value is used as the mock method’s return value.
| Use `Invoke(f)` to invoke global/static functions or functors with the mock method’s arguments.
| Use `Invoke(object_pointer, &Class::Method)` to invoke a member method on the object with the mock method’s arguments.
| Use `InvokeWithoutArgs(f)` or `InvokeWithoutArgs(object_pointer, &Class::Method)` to invoke callables **without any arguments**, regardless of mock method’s signature.
| Use `InvokeArgument<N>(args...)` to invoke the `N`-th argument of the mock method, which must be a callable, with supplied arguments. Wrap arguments in `std::ref()` for passing by reference.

### Controlling Return Behavior

| Action             | Description                                                                                                             |
| ------------------ | ----------------------------------------------------------------------------------------------------------------------- |
| `DoDefault()`      | Performs the default action of the mock method, which may be set by `ON_CALL()` or the built-in default if none set.     |

### Composite Actions

| Action                          | Description                                                                                                      |
| -------------------------------|-----------------------------------------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)`       | Performs all actions `a1` to `an` in order for each invocation and returns the result of action `an`. The first `n-1` actions must return `void` and receive read-only arguments.
| `IgnoreResult(a)`              | Performs action `a` but ignores its return value. Useful when `a` returns non-void but you want a void context.   |
| `WithArg<N>(a)`                | Passes only the `N`-th argument of the mock call to action `a`.                                                |
| `WithArgs<N1, N2, ..., Nk>(a)`| Passes selected arguments to action `a` by their indices.                                                       |
| `WithoutArgs(a)`               | Invokes the action `a` without arguments.                                                                       |

### Defining Custom Actions Quickly

- Define new actions using simple lambdas or functors with call operators matching the mock method's signature.
- Use the `ACTION()` macro family (`ACTION`, `ACTION_P`, `ACTION_P2`, etc.) to define parameterized actions without verbose syntax.
- For fine control or polymorphic actions across different function types, implement `ActionInterface<F>` or use `MakePolymorphicAction()`.

---

## 3. Using Actions: Practical User Workflows

### Setting Default Behavior with ON_CALL

`ON_CALL(mock_object, Method(matchers...))` defines what the mock method should do when called but does NOT set an expectation that it must be called. Combine with `.WillByDefault(action)` to set the default behavior.

Example:

```cpp
ON_CALL(my_mock, Foo(_))
    .WillByDefault(Return(42));
```

This makes calls to `Foo` return `42` unless overridden by an expectation.

### Setting Expectations with EXPECT_CALL

`EXPECT_CALL(mock_object, Method(matchers...))` creates an expectation that the mock method will be called with matching arguments. Chain clauses like `.WillOnce(action)` and `.WillRepeatedly(action)` to define behavior.

Example:

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(10))
    .WillRepeatedly(Return(20));
```

Here, the first call returns `10`, and subsequent calls return `20`.

### Combining Multiple Actions with DoAll

If you need multiple side effects or actions on a single call, use `DoAll()`.

Example:

```cpp
EXPECT_CALL(mock, Process(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

This sets the first argument (assumed pointer) to `5` and returns `true`.

### Invoking a Callable Argument

When a mock method receives a function or functor as an argument, you can invoke it with `InvokeArgument<N>(args...)`.

Example:

```cpp
EXPECT_CALL(mock, AsyncOperation(_))
    .WillOnce(InvokeArgument<0>(result));
```

This calls the first argument (assumed callable) with `result`.

### Creating Custom Actions

If built-in actions don't fit your needs, write lambdas or functors:

```cpp
struct MultiplyBy {
  int factor;
  int operator()(int arg) { return arg * factor; }
};
EXPECT_CALL(mock, Compute(_))
    .WillOnce(MultiplyBy{7});
```

---

## 4. Best Practices and Common Pitfalls

- **Avoid side effects in matchers and actions** that are hard to reason about.
- Use `ON_CALL` to set default mock behavior without enforcing call expectations.
- Use `EXPECT_CALL` sparingly to verify specific call orders, counts, or arguments.
- Be cautious when using `Return(value)` with move-only types; prefer lambdas to return new objects each time.
- Use `RetiresOnSaturation()` with expectations to release them after usage.
- For complex behaviors, chain actions using `DoAll`.
- When invoking callable arguments, wrap by-reference parameters with `std::ref()`.
- Use `IgnoreResult()` to adapt returning actions for void-return methods or when chaining.

---

## 5. Example Code Snippets

### Returning Sequential Values

```cpp
EXPECT_CALL(mock, GetNumber())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillOnce(Return(3));
```

### Returning Values in a Round Robin

```cpp
EXPECT_CALL(mock, GetColor())
    .WillRepeatedly(ReturnRoundRobin({"red", "green", "blue"}));
```

### Setting an Output Parameter then Returning True

```cpp
EXPECT_CALL(mock, GetData(_))
    .WillOnce(DoAll(SetArgPointee<0>(42), Return(true)));
```

### Invoking a Callback Argument

```cpp
EXPECT_CALL(mock, FetchData(_, _))
    .WillOnce(InvokeArgument<1>(true, 100));
```

### Ignore Return Value

```cpp
EXPECT_CALL(mock, Process())
    .WillOnce(IgnoreResult(DoWork));
```

### Custom Lambda Action

```cpp
EXPECT_CALL(mock, Calculate(_))
    .WillOnce([](int x) { return x * x; });
```

### DoAll with Multiple Side Effects

```cpp
EXPECT_CALL(mock, Update(_, _))
    .WillOnce(DoAll(SetArgPointee<0>(5), SetArgPointee<1>("done"), Return(true)));
```

---

## 6. Troubleshooting

- If your mock method returns a move-only type, do not use `Return(std::move(obj))` with `WillRepeatedly()`; instead use a lambda or `ON_CALL` with a factory.
- If an unexpected call occurs without a matching `EXPECT_CALL`, gMock emits a warning or failure.
- Use `--gmock_verbose` flag to trace mock calls and reasons for matched/unmatched expectations.
- Make sure you do not evaluate side-effect expressions inside `Return()` multiple times unintentionally.
- Use `RetiresOnSaturation()` to avoid sticky expectations causing call count issues.

---

## References & Further Reading

- [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#UsingActions)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)

---

## Summary

This page thoroughly covers the built-in and customizable actions in GoogleMock. You learn how to make your mock methods perform specific behaviors, return values, manipulate arguments, invoke callbacks, and combine actions to simulate complex scenarios.

Understanding actions is central to unlocking the full power of GoogleMock for interaction-based testing, enabling you to create expressive, maintainable, and robust test doubles that behave exactly as your tests require.