---
title: "Actions Reference"
description: "Documentation of available mock actions, composable utilities, and helpers for defining mock behaviors in response to method calls. Serves as a go-to handbook for quickly simulating return values, sequences, and complex behaviors."
---

# Actions Reference

This reference documents the comprehensive set of mock actions provided by GoogleTest to define how your mocked methods should behave when invoked. It focuses exclusively on the built-in actions, composable utilities, and helpers to help you simulate return values, side effects, sequences, and complex behaviors in your mock objects. Leveraging these actions allows you to create precise and reactive mock behaviors, integral to robust unit testing.

---

## Table of Contents

- [Basics of Actions](#basics-of-actions)
- [Using Actions to Return Values](#using-actions-to-return-values)
- [Side Effect Actions](#side-effect-actions)
- [Using Callables as Actions](#using-callables-as-actions)
- [Composite Actions](#composite-actions)
- [Defining Custom Actions](#defining-custom-actions)
- [Advanced Action Utilities](#advanced-action-utilities)

---

## Basics of Actions

**Actions** in GoogleTest define what a mocked method does when it is called. Actions are specified in expectation clauses like `.WillOnce()` and `.WillRepeatedly()`.

- Actions execute in the order declared, allowing fine control over mock method behavior.
- An action must return a value matching the mocked method's return type, or be void if the mocked method returns void.

Common scenarios fulfilled by actions include returning specific values, invoking callbacks, modifying output arguments, throwing exceptions, or invoking custom functions.


## Using Actions to Return Values

Actions that control the return values of mock methods are fundamental and include the following:

### Return Actions

| Action                           | Description                                                                                                                |
|---------------------------------|----------------------------------------------------------------------------------------------------------------------------|
| `Return()`                      | Returns immediately from a void mock method.                                                                                 |
| `Return(value)`                 | Returns a fixed `value`. Conversion to the mock function return type occurs when the expectation is defined, not at call time. |
| `ReturnArg<N>()`                | Returns the N-th (0-based) argument of the mock function call.                                                                |
| `ReturnNew<T>(args...)`         | Creates and returns a new object of type `T`, constructed from provided arguments, on each call.                             |
| `ReturnNull()`                  | Returns a null pointer (or equivalent null returned by smart pointers).                                                      |
| `ReturnPointee(ptr)`            | Returns the value pointed to by the pointer `ptr` at call time. Useful for returning dynamic values.                        |
| `ReturnRef(variable)`           | Returns a reference to the given variable.                                                                                   |
| `ReturnRefOfCopy(value)`        | Returns a reference to a copy of `value`. The copy lives as long as the action.                                              |
| `ReturnRoundRobin({v1, ..., vn})` | Returns values in round-robin fashion cycling through the provided list.                                                    |

#### Example: Returning Specific Values

```cpp
using ::testing::Return;

EXPECT_CALL(mock, GetNumber())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));

EXPECT_EQ(1, mock.GetNumber());  // 1st call
EXPECT_EQ(2, mock.GetNumber());  // 2nd call
EXPECT_EQ(3, mock.GetNumber());  // 3rd call onwards
```

### Tips
- Avoid returning temporaries with `Return` if their lifetime is critical; prefer `ReturnPointee` for dynamic values.
- When returning references, ensure the referenced object outlives the mock invocation.


## Side Effect Actions

Some mock methods perform work through side effects rather than returns. GoogleTest provides actions to simulate these behaviors:

| Action                             | Purpose                                                                                       |
|-----------------------------------|-----------------------------------------------------------------------------------------------|
| `Assign(&variable, value)`         | Assigns `value` to a variable.                                                               |
| `DeleteArg<N>()`                   | Deletes the N-th (0-based) argument which must be a pointer.                                  |
| `SaveArg<N>(pointer)`              | Saves the value of the N-th argument to a pointer.                                           |
| `SaveArgByMove<N>(pointer)`        | Moves the N-th argument value to a pointer.                                                  |
| `SaveArgPointee<N>(pointer)`       | Saves the value pointed to by the N-th argument (pointer) to a location.                     |
| `SetArgReferee<N>(value)`          | Assigns `value` to the variable referenced by the N-th argument.                             |
| `SetArgPointee<N>(value)`          | Assigns `value` to the location pointed to by the N-th argument.                            |
| `SetArrayArgument<N>(first, last)` | Copies a range of elements to the N-th argument which is a pointer or iterator.              |
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` and returns `value`.                                                |
| `Throw(exception)`                 | Throws a copyable exception when the mock method is called.                                 |

#### Example: Setting an Output Argument

```cpp
using ::testing::SetArgPointee;

EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(SetArgPointee<1>(5));  // Sets 5 into 2nd argument
```

### Tips
- Chain side effect actions with return actions using `DoAll()` to both modify arguments and return values.


## Using Callables as Actions

Beyond predefined actions, your mock methods can invoke custom functions, functors, or lambdas to define their behavior.

| Action                         | Description                                                                                      |
|-------------------------------|------------------------------------------------------------------------------------------------|
| `f`                          | Calls the callable `f` with the mock's arguments, acting as the action's behavior.               |
| `Invoke(f)`                   | Like `f` above, supports global/static functions or functors.                                  |
| `Invoke(object_ptr, &method)` | Invokes a member method on `object_ptr` with the mock's method arguments.                       |
| `InvokeWithoutArgs(f)`        | Calls callable `f` with no arguments regardless of mock method arguments.                       |
| `InvokeWithoutArgs(obj, &method)` | Calls a no-argument member method on `obj`.                                                  |
| `InvokeArgument<N>(args...)`  | Invokes the N-th argument of the mock method (a callable) with provided arguments.              |

#### Example: Lambda as Action

```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce([](int x) { return x * 2; });

EXPECT_EQ(4, mock.Compute(2));
```

#### Example: Invoking a Callback Argument

```cpp
using ::testing::InvokeArgument;

EXPECT_CALL(mock, PerformOperation(_, _))
    .WillOnce(InvokeArgument<1>(42));  // Calls 2nd argument as callback with 42
```

### Tips
- Use `std::ref()` when you want to pass arguments by reference to `InvokeArgument`.
- Callables used in actions will be owned by the action and deleted appropriately.


## Composite Actions

Composite actions combine multiple behaviors into one. GoogleTest includes:

| Action          | Purpose                                                                              |
|-----------------|--------------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)` | Executes multiple actions sequentially and returns the result of the last action.  |
| `IgnoreResult(a)`         | Executes action `a` and ignores its return value, useful when return value is not needed. |
| `WithArg<N>(a)`           | Passes the specified argument of the mock function to inner action `a`.             |
| `WithArgs<N1, N2, ..., Nk>(a)` | Passes a selected subset of arguments to `a`.                                    |
| `WithoutArgs(a)`          | Calls action `a` without any arguments.                                             |

#### Example: Performing Multiple Side Effects and Returning a Value

```cpp
EXPECT_CALL(mock, Mutate(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

### Tips
- The last action in `DoAll()` must return a value matching the mock method's return type.
- Use `IgnoreResult` to convert returning actions to `void` return actions when chaining.


## Defining Custom Actions

If built-in actions are insufficient, you can define new actions by:

- Writing a callable (function, lambda, or functor) compatible with the mock function signature.
- Using GoogleTest macros like `ACTION`, `ACTION_P`, etc., for convenient action creation.
- Implementing `ActionInterface<F>` for fine-grained control and polymorphism.

### Example: Simple Custom Action Using ACTION Macro

```cpp
ACTION(DoubleArg0) {
  return arg0 * 2;
}

EXPECT_CALL(mock, Foo( _ ))
    .WillOnce(DoubleArg0());
```


### Tips
- Use `ACTION_P` and related macros for parameterized custom actions.
- Implement polymorphic actions with `MakePolymorphicAction` for actions usable in multiple mock signatures.


## Advanced Action Utilities

GoogleTest provides additional utilities to manage complex mocking scenarios:

### Default Value and Default Behavior

You can customize the global or per-mock default return values when no expectation is matched using `DefaultValue<T>::Set()` or by setting default behaviors with `ON_CALL()`.

### Retiring Expectations

The `.RetiresOnSaturation()` clause allows expectations to become inactive after matching the expected number of calls to avoid overlap in scenarios with overlapping matchers.

### Strictness Wrappers

Mock objects can be wrapped with `NiceMock`, `NaggyMock`, or `StrictMock` to control warnings/errors on uninteresting or unexpected calls.

### Delegating Calls

Mock methods can delegate their behavior to real or fake implementations to reuse behavior.

---

### Troubleshooting Tips

- If your mock method is called but causes warnings or failures about uninteresting calls, consider adding explicit expectations or wrapping the mock in `NiceMock`.
- Beware that using `Return(std::move(...))` repeatedly with move-only types will fail after the first call.
- Use sequences (`InSequence`) and ordering (`After`) to specify call order precisely.

---

## See Also

- [EXPECT_CALL - Mocking Reference](../mocking.md#EXPECT_CALL) - How to set expectations including actions.
- [Matchers Reference](../matchers.md) - Argument matchers used in expectations.
- [GoogleTest Mocking Cookbook](../gmock_cook_book.md) - Recipes and best practices for mocks and actions.
- [Mocking APIs Overview](../mocking.md) - High-level conceptual overview.

<Callout type="tip">
Remember to place `EXPECT_CALL` before exercising the mocks so that the expectations are applied correctly. Default mock method behavior can be set via `ON_CALL` and `DefaultValue<T>` but will not automatically enforce call expectations.
</Callout>
