---
title: "Cardinalities and Call Counting"
description: "Covers APIs to specify and verify how many times mock methods are expected to be called. Explains Cardinality interfaces, available cardinality specifiers (e.g. Exactly, AtLeast, AnyNumber), and integration with test expectations."
---

# Cardinalities and Call Counting

GoogleMock provides powerful APIs to specify and verify how many times your mock methods are expected to be called during test execution. This documentation covers the **Cardinality** interfaces, common cardinality specifiers like `Exactly`, `AtLeast`, `AnyNumber`, and their integration into test expectations via the `Times()` clause. Understanding cardinalities helps you precisely express your intent about the expected number of calls, improving the robustness and clarity of your tests.

---

## Overview of Cardinalities

A **Cardinality** defines constraints on the number of times a mock method may be invoked. GoogleMock offers several built-in cardinalities that allow you to specify exact counts, minimums, maximums, ranges, or no limits on the number of calls expected.

### What Cardinalities Do for You

When writing mock expectations using the `EXPECT_CALL()` macro, the `.Times()` clause accepts a cardinality to define call count constraints. This flexibility lets you precisely express:

- Methods that should be called exactly _n_ times.
- Methods allowed to be called any number of times.
- Methods expected to be called at least or at most _n_ times.
- Methods that must be called within a specific range `_m_` to `_n_` times.

This capability enables fine-grained testing to ensure your code interacts with collaborators exactly as intended.

## Built-in Cardinality Specifiers

The following cardinalities are available in the `::testing` namespace:

| Cardinality         | Meaning                                                           | Usage Example                           |
| ------------------- | ----------------------------------------------------------------- | ------------------------------------- |
| `AnyNumber()`       | Expect any number (including zero) of calls.                      | `.Times(AnyNumber())`                  |
| `AtLeast(n)`        | Expect at least _n_ calls (zero or more beyond _n_ allowed).       | `.Times(AtLeast(3))`                   |
| `AtMost(n)`         | Expect at most _n_ calls (including zero).                        | `.Times(AtMost(5))`                    |
| `Between(m, n)`     | Expect between _m_ and _n_ calls, inclusive (0 ≤ m ≤ n).          | `.Times(Between(1, 3))`                |
| `Exactly(n)` (or n) | Expect exactly _n_ calls (zero means the method should not be called). | `.Times(Exactly(2))` or `.Times(2)`   |

### Usage Notes

- The `.Times()` clause is optional. When omitted, GoogleMock infers an appropriate cardinality based on the presence of `.WillOnce()` and `.WillRepeatedly()` clauses.
- Using `.Times(0)` prevents any calls to the method, causing failures if called.

## Cardinality Interface

GoogleMock's cardinalities implement the `CardinalityInterface` abstract class:

```cpp
class CardinalityInterface {
 public:
  virtual ~CardinalityInterface() = default;

  // Returns a conservative lower bound on allowed call count.
  virtual int ConservativeLowerBound() const { return 0; }

  // Returns a conservative upper bound on allowed call count.
  virtual int ConservativeUpperBound() const { return INT_MAX; }

  // Returns true if exactly call_count calls satisfy the cardinality.
  virtual bool IsSatisfiedByCallCount(int call_count) const = 0;

  // Returns true if call_count saturates the cardinality (upper bound).
  virtual bool IsSaturatedByCallCount(int call_count) const = 0;

  // Prints a human-readable description of the cardinality.
  virtual void DescribeTo(std::ostream* os) const = 0;
};
```

Users typically use built-in factory functions to create cardinalities without directly implementing this interface.

## Cardinality Factory Functions

| Function                 | Description                             | Example Usage           |
|--------------------------|---------------------------------------|------------------------|
| `Cardinality AtLeast(int n)`  | At least _n_ calls                    | `AtLeast(2)`            |
| `Cardinality AtMost(int n)`   | At most _n_ calls                     | `AtMost(3)`             |
| `Cardinality AnyNumber()`      | Any number of calls                   | `AnyNumber()`           |
| `Cardinality Between(int m, int n)` | Between _m_ and _n_ calls (inclusive) | `Between(1, 3)`         |
| `Cardinality Exactly(int n)`  | Exactly _n_ calls                    | `Exactly(1)` or `1`     |

### Example

```cpp
EXPECT_CALL(mock, Foo())
    .Times(AtLeast(2));  // Expects Foo() to be called 2 or more times
```

## Behavior of Built-in Cardinalities

Each cardinality imposes rules on whether a given call count satisfies or saturates it:

- `IsSatisfiedByCallCount(call_count)`: returns true if `call_count` fulfills the cardinality.
- `IsSaturatedByCallCount(call_count)`: returns true if the maximum allowed calls have been reached (meaning no *more* calls are expected).

For example:

| Cardinality       | Call Count | IsSatisfiedByCallCount | IsSaturatedByCallCount |
|-------------------|------------|-----------------------|-----------------------|
| `Exactly(2)`      | 1          | false                 | false                 |
|                   | 2          | true                  | true                  |
|                   | 3          | false                 | true                  |
| `AtLeast(2)`      | 1          | false                 | false                 |
|                   | 2          | true                  | false                 |
|                   | 3          | true                  | false                 |
| `AnyNumber()`     | any        | true                  | false                 |

## Descriptions and Call Count Messages

GoogleMock generates human-friendly descriptions of cardinalities and actual call counts to improve test failure messages.

Examples of description outputs are:

| Call Count | Description          |
|------------|----------------------|
| 0          | never called         |
| 1          | called once          |
| 2          | called twice         |
| >2         | called N times       |

Cardinalities describe themselves in English, e.g., "called exactly once", "called at least twice", or "called any number of times." These descriptions appear in failure output to clarify expectation mismatches.

## Using `.Times()` and Cardinalities in Tests

Here's a simple illustration demonstrating cardinalities used in test expectations:

```cpp
using ::testing::Exactly;
using ::testing::AtLeast;
using ::testing::AnyNumber;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (), ());
};

TEST(FooTest, Example) {
  MockFoo mock;

  // Expect that Bar() is called exactly twice.
  EXPECT_CALL(mock, Bar()).Times(Exactly(2));

  mock.Bar();  // 1st call
  mock.Bar();  // 2nd call
}

TEST(FooTest, AnotherExample) {
  MockFoo mock;

  // Bar() can be called any number of times, including zero.
  EXPECT_CALL(mock, Bar()).Times(AnyNumber());

  // No calls required for this test
}

TEST(FooTest, YetAnotherExample) {
  MockFoo mock;

  // Bar() must be called at least once.
  EXPECT_CALL(mock, Bar()).Times(AtLeast(1));

  mock.Bar();  // 1st call
}
```

## Creating Custom Cardinalities

GoogleMock makes it easy to define custom cardinalities by implementing the `CardinalityInterface` and creating a `Cardinality` object via `MakeCardinality()`.

### Example: EvenNumber Cardinality

This cardinality expects the method to be called an even number of times.

```cpp
class EvenCardinality : public testing::CardinalityInterface {
 public:
  bool IsSatisfiedByCallCount(int call_count) const override {
    return call_count % 2 == 0;
  }

  bool IsSaturatedByCallCount(int /*call_count*/) const override {
    return false;  // never saturates
  }

  void DescribeTo(std::ostream* os) const override {
    *os << "called even number of times";
  }
};

Cardinality EvenNumber() {
  return MakeCardinality(new EvenCardinality);
}

// Usage:
EXPECT_CALL(mock, Foo()).Times(EvenNumber());
```

Such customization enables tailor-made expectations matching your test requirements.

## Best Practices and Tips

- **Use the correct cardinality to express your intent clearly:** Avoid arbitrary `.Times(AnyNumber())` calls where specific counts should be verified.
- **Omit `.Times()` to let GoogleMock infer cardinalities automatically** when using `.WillOnce()` / `.WillRepeatedly()`.
- **Use `.Times(0)` explicitly to prevent unwanted calls to a method.**
- **Consider combining cardinalities with sequences or prerequisites in complex call orders.**
- **Custom cardinalities expand expressiveness but consider readability for maintainability.**

## Troubleshooting Common Issues

- **Call count mismatches:** If GoogleMock reports unexpected call counts during verification, check if your `.Times()` specification matches the actual usage.
- **Over-saturation errors:** This occurs when a mock method is called more times than specified by the upper bound of the cardinality.
- **Under-satisfaction errors:** When expected call counts are not met by test execution.
- **Conflicting expectations:** Multiple expectations on the same mock method with overlapping cardinalities or argument matchers can cause ambiguity.

For detailed troubleshooting, consult the [Troubleshooting Common Test Issues](../../guides/integration-and-troubleshooting/troubleshooting-common-issues) guide.

---

## Additional Resources

- [Mocking API Reference](../../api-reference/core-apis/mocking) — learn how to use `EXPECT_CALL` and `.Times()`
- [gMock Cheat Sheet – Cardinalities Section](../../docs/gmock_cheat_sheet.md#CardinalityList) — quick reference for cardinality usage
- [gMock Cookbook – Writing New Cardinalities](../../docs/gmock_cook_book.md#WritingNewCardinalities) — in-depth guide to custom cardinalities
- [Understanding Uninteresting vs Unexpected Calls](../../docs/gmock_cook_book.md#uninteresting-vs-unexpected) — relates to call expectations

---

## Summary
This page covers how to control and verify the number of times mock methods are called using GoogleMock’s cardinalities. It explains built-in cardinalities such as `Exactly(n)`, `AtLeast(n)`, `AtMost(n)`, `Between(m, n)`, and `AnyNumber()`. Additionally, it shows how to define your own cardinalities by implementing the `CardinalityInterface`. Proper use of these cardinalities in `.Times()` clauses of `EXPECT_CALL()` assertions allows you to precisely validate the interaction frequency between your code under test and its dependencies.


---

### Source
For complete examples and tests on cardinalities, refer to the test file: [`gmock-cardinalities_test.cc`](https://github.com/google/googletest/blob/main/googlemock/test/gmock-cardinalities_test.cc)

For implementation details of cardinalities, see: [`gmock-cardinalities.h`](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-cardinalities.h) and [`gmock-cardinalities.cc`](https://github.com/google/googletest/blob/main/googlemock/src/gmock-cardinalities.cc)

---
