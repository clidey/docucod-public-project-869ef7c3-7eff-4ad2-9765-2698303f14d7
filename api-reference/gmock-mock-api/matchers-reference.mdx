---
title: "Matchers Reference"
description: "Provides a detailed catalog of built-in and extensible matchers for argument and result verification, including practical examples. Explains matcher composition, custom matchers, and convenient utilities for robust test assertions."
---

# Matchers Reference

Provides a detailed catalog of built-in and extensible matchers for argument and result verification, including practical examples. Explains matcher composition, custom matchers, and convenient utilities for robust test assertions.

---

## Introduction to Matchers

Matchers are fundamental building blocks in GoogleMock that allow you to specify what argument values are expected in mocked method calls or to verify values in assertions. A matcher matches a *single* argument and can be used in various contexts such as `EXPECT_CALL`, `ON_CALL`, and assertions like `EXPECT_THAT`.

Matchers add expressive, readable constraints to your tests and assertions, empowering tests that clearly document expected behaviors.

## Using Matchers

Matchers are most commonly used inside `EXPECT_CALL` or `ON_CALL` statements when setting expectations or default behaviors on mock methods. They are also used in the `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` macros for rich assertions on values.

### Basic Example

```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::Eq;

EXPECT_CALL(mock_object, Method(Eq(5), _));  // Expects first argument == 5, second can be anything
EXPECT_THAT(result_value, Eq(10));          // Asserts that result_value == 10
```

## Categories of Built-in Matchers

GoogleMock ships with a comprehensive set of matchers designed to cover common use cases:

### Wildcard Matchers

| Matcher         | Description                                     |
|-----------------|------------------------------------------------|
| `_`             | Matches any argument of the correct type       |
| `A<type>()`     | Matches any value of the specified `type`     |
| `An<type>()`    | Same as `A<type>()`                            |

### Generic Comparison Matchers

| Matcher           | Description                                                       |
|-------------------|------------------------------------------------------------------|
| `Eq(value)` or `value` | Matches arguments equal to `value` (uses `operator==`)            |
| `Ne(value)`       | Not equal to `value`                                              |
| `Lt(value)`       | Less than `value`                                                 |
| `Le(value)`       | Less than or equal to `value`                                    |
| `Gt(value)`       | Greater than `value`                                              |
| `Ge(value)`       | Greater than or equal to `value`                                 |
| `IsTrue()`        | Argument evaluates to true in boolean context                     |
| `IsFalse()`       | Argument evaluates to false in boolean context                    |
| `IsNull()`        | Argument is a nullptr (raw or smart pointer)                      |
| `NotNull()`       | Argument is non-null pointer                                      |
| `Optional(m)`     | Argument is an `optional<>` containing a value matching `m`      |
| `VariantWith<T>(m)` | Argument is a variant holding type `T` with value matching `m`    |
| `Ref(variable)`   | Matches a reference to specific variable                         |
| `TypedEq<type>(value)` | Matches argument of specific type equal to `value`. Useful for overloaded methods. |

### Floating-Point Matchers

Provided for comparisons that tolerate rounding errors, using ULP-based approximation and optional epsilon bounds.

| Matcher                    | Description                                                      |
|----------------------------|-----------------------------------------------------------------|
| `DoubleEq(value)`          | `double` approximately equal to `value` (NaNs unequal)          |
| `FloatEq(value)`           | `float` approximately equal to `value` (NaNs unequal)           |
| `NanSensitiveDoubleEq(value)` | `double` approx equal (NaNs equal)                             |
| `NanSensitiveFloatEq(value)`  | `float` approx equal (NaNs equal)                              |
| `DoubleNear(value, error)` | `double` close to `value` within `error`, NaNs unequal          |
| `FloatNear(value, error)`  | `float` close to `value` within `error`, NaNs unequal           |
| `NanSensitiveDoubleNear(value, error)` | Similar but treats NaNs equal                             |
| `NanSensitiveFloatNear(value, error)`  | Similar but treats NaNs equal                             |
| `IsNan()`                  | Matches any NaN floating value                                   |

### String Matchers

Matchers specifically for comparing strings (compatible with narrow and wide strings). They support substring, prefix, suffix, and regex matching.

| Matcher            | Description                                                          |
|--------------------|----------------------------------------------------------------------|
| `StrEq(string)`    | String exactly equal to `string`                                    |
| `StrNe(string)`    | String not equal to `string`                                        |
| `StrCaseEq(string)`| Case-insensitive equality                                           |
| `StrCaseNe(string)`| Case-insensitive inequality                                         |
| `StartsWith(prefix)` | String starts with `prefix`                                      |
| `EndsWith(suffix)` | String ends with `suffix`                                           |
| `HasSubstr(string)`| String contains `string` as substring                              |
| `ContainsRegex(string)` | Matches regex pattern (match anywhere in string)                  |
| `MatchesRegex(string)`  | Matches regex pattern (whole string)                            |
| `WhenBase64Unescaped(m)` | Base64-escaped string whose unescaped form matches `m`             |

Example:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_string, HasSubstr("world"));
EXPECT_THAT(my_string, MatchesRegex("Line \\d+"));
```

### Exception Matchers

Useful for verifying that callable objects throw expected exceptions.

| Matcher                  | Description                                               |
|--------------------------|----------------------------------------------------------|
| `Throws<E>()`            | Throws exception of type `E`                             |
| `Throws<E>(m)`           | Throws exception of type `E` matching matcher `m`        |
| `ThrowsMessage<E>(m)`    | Throws exception of type `E` with message matching `m`   |

Example:

```cpp
auto lam = [] { throw std::runtime_error("oops!"); };
EXPECT_THAT(lam, Throws<std::runtime_error>());
EXPECT_THAT(lam, ThrowsMessage<std::runtime_error>(HasSubstr("oops")));
```

### Container Matchers

Matchers for STL-style containers and arrays supporting detailed inspection.

| Matcher                 | Description                                                               |
|-------------------------|---------------------------------------------------------------------------|
| `IsEmpty()`             | Matches an empty container                                                |
| `SizeIs(m)`             | Container size matches matcher `m` (e.g. `SizeIs(2)`)                    |
| `BeginEndDistanceIs(m)` | Distance between begin/end iterators matches `m` (for containers lacking `size()`) |
| `Eq(container)` or `ContainerEq(container)` | Exactly matches container members; `ContainerEq` provides detailed diff |
| `Contains(e)`           | Container contains an element matching `e`                              |
| `Contains(e).Times(n)`  | Container contains `n` elements matching `e`; can test absence as `Times(0)` |
| `Each(e)`               | All elements match matcher `e`                                           |
| `ElementsAre(e0, e1, ..., en)` | Matches container elements at each position exactly                    |
| `ElementsAreArray(...)` | Like `ElementsAre`, but from array, range, or container                  |
| `UnorderedElementsAre(...)` | Matches container elements ignoring order                               |
| `UnorderedElementsAreArray(...)` | Like `UnorderedElementsAre`, but from array, range, container           |
| `IsSubsetOf(...)`       | Container is subset matching some elements                              |
| `IsSupersetOf(...)`     | Container is superset matching some elements                            |
| `Pointwise(m, container)` | Matches container elements pairwise with `container` using matcher `m`  |
| `UnorderedPointwise(m, container)` | Like `Pointwise` ignoring order                                     |
| `WhenSorted(m)`         | Container matches as if sorted ascending                               |
| `WhenSortedBy(comparator, m)` | Container matches as if sorted with custom comparator                   |

Examples:

```cpp
using ::testing::ElementsAre;
using ::testing::Contains;

EXPECT_THAT(my_vector, ElementsAre(1, 2, 3));
EXPECT_THAT(my_vector, Contains(Gt(10)));
EXPECT_THAT(my_map, Contains(Key(Gt(5))));
EXPECT_THAT(my_set, Each(Lt(100)));  
```

### Member Matchers

Matchers that check fields or properties of objects.

| Matcher                        | Description                                            |
|-------------------------------|--------------------------------------------------------|
| `Field(&Class::field, m)`      | `argument.field` matches `m`                            |
| `Field(field_name, &Class::field, m)` | Same as above with better error messages            |
| `Property(&Class::property, m)`| `argument.property()` matches `m`                       |
| `Property(property_name, &Class::property, m)` | Same as above with better error messages         |
| `Key(m)`                      | Matches pair/map where `first` matches `m`               |
| `Pair(m1, m2)`               | Matches pair where `first` matches `m1` and `second` `m2`|
| `FieldsAre(m...)`             | Matches tuple-like types field-wise with matchers        |

Example:

```cpp
EXPECT_THAT(obj, Field(&Foo::x, Ge(10)));
EXPECT_THAT(pair, Pair(Eq(5), StrEq("foo")));
EXPECT_THAT(my_tuple, FieldsAre(1, "hello"));
```

### Multi-Argument Matchers

Useful when matching tuples of arguments as a single value.

| Matcher          | Description                                  |
|------------------|----------------------------------------------|
| `Eq()`, `Ge()`, etc. | Match 2-tuples where first and second parts satisfy relations |
| `AllArgs(m)`      | Applies matcher `m` to all arguments as a tuple          |
| `Args<N1,N2,...>(m)` | Applies matcher `m` to subset of arguments (template indices) |

Example:

```cpp
EXPECT_CALL(mock, Func(_, _)).With(Lt());  // expects first < second
EXPECT_CALL(mock, Func(_, _)).With(AllArgs(Lt()));
EXPECT_CALL(mock, Func(_, _, _)).With(Args<0,2>(Ge()));
```

### Composite Matchers

Combine multiple matchers logically:

| Matcher         | Description                               |
|-----------------|-------------------------------------------|
| `AllOf(m1, m2, ...)` | Matches if all matchers match            |
| `AnyOf(m1, m2, ...)` | Matches if any matcher matches            |
| `Not(m)`           | Matches if inner matcher does not match    |
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` true else `m2`  |

Example:

```cpp
EXPECT_THAT(value, AllOf(Ge(10), Le(20)));
EXPECT_THAT(str, Not(StartsWith("bad")));
```

### Adapters for Matchers

| Matcher                 | Description                                         |
|-------------------------|-----------------------------------------------------|
| `MatcherCast<T>(m)`     | Casts matcher `m` to type `Matcher<T>`               |
| `SafeMatcherCast<T>(m)` | Like `MatcherCast` but safer with static checks      |
| `Truly(predicate)`      | Convert any unary predicate to a matcher            |

### Defining Custom Matchers

GoogleMock lets you define your own matchers easily using a family of macros:

- `MATCHER(name, description) { ... }` for simple matchers.
- `MATCHER_P(name, param, description) { ... }` for parameterized matchers.
- Higher parameter versions up to `MATCHER_P10`.

Inside the matcher body you implement pure functions describing the matching logic and optionally provide better failure explanations.

Example:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }

MATCHER_P(IsDivisibleBy, n, "") {
  if ((arg % n) == 0) {
    return true;
  }
  *result_listener << "remainder is " << (arg % n);
  return false;
}
```

Use custom matchers in expectations:

```cpp
EXPECT_CALL(mock, Func(IsEven()));
EXPECT_THAT(value, IsDivisibleBy(3));
```

### Practical Tips and Best Practices

- Always use matchers that reflect your testing intent without being overly strict.
- Use wildcards (`_`) where argument values are not significant.
- Prefer `ON_CALL` for setting default mock behaviors without expectations.
- Use `EXPECT_CALL` only when you want to verify calls.
- Leverage composed and multi-argument matchers for concise and powerful expectations.
- Define custom matchers to improve readability and reuse complex matching logic.
- Use `SafeMatcherCast` when type conversions are necessary.
- Remember that matchers are pure and must not have side effects.

### Troubleshooting Common Issues

- **Incorrect Match Due to Implicit Conversion:** Always be explicit with matchers like `Eq()` to avoid unintended matches.
- **Ambiguity With Overloaded Methods:** Use `TypedEq<type>` or explicitly disambiguate the overload.
- **Too Strict Expectations:** Avoid specifying arguments or call counts tighter than necessary to prevent brittle tests.
- **Uninteresting vs Unexpected Calls:** `NiceMock` can suppress warnings for uninteresting calls; `StrictMock` treats them as errors.

---

For comprehensive guidance on matchers usage, mock objects, and setting expectations, consult the GoogleMock Cookbook and the Mocking Reference. The Assertions Reference complements these with how to use matchers in test assertions.


## See Also

- [GoogleMock for Dummies](docs/gmock_for_dummies.md) — Getting started with mocks and matchers.
- [Mocking Reference](docs/reference/mocking.md) — Creating mocks and defining expectations.
- [Expectations and Actions](api-reference/gmock-mock-api/mock-expectations-and-actions.md) — Behavior control in mocks.
- [Assertions Reference](docs/reference/assertions.md) — Using matchers within assertions.
- [Matchers Reference](docs/reference/matchers.md) — (this page) Detailed matcher catalog and usage.
- [gMock Cookbook](docs/gmock_cook_book.md) — Recipes for advanced matcher use and extension.

---

### Code Examples

```cpp
// Example: Matching exact and wildcard arguments in EXPECT_CALL.
using ::testing::_;
using ::testing::Eq;
using ::testing::Gt;

class MockFoo {
 public:
  MOCK_METHOD(void, Bar, (int x, const std::string& s), ());
};

TEST(FooTest, UsesMatchers) {
  MockFoo mock;

  // Expect Bar to be called with first argument exactly 5, second argument anything.
  EXPECT_CALL(mock, Bar(Eq(5), _));

  // Expect Bar to be called with first argument greater than 10, and string starting with "test".
  EXPECT_CALL(mock, Bar(Gt(10), StartsWith("test")));

  mock.Bar(5, "hello");    // Matches first expectation.
  mock.Bar(11, "test123"); // Matches second expectation.
}
```

```cpp
// Example: Using a custom matcher for even numbers.
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

TEST(FooTest, CustomMatcher) {
  int value = 4;
  EXPECT_THAT(value, IsEven());  // Passes.
  EXPECT_THAT(5, IsEven());      // Fails with message "Expected: is even. Actual: 5"
}
```

```cpp
// Example: Matching container elements.
using ::testing::ElementsAre;
using ::testing::Contains;

TEST(ContainerTest, ElementsAreMatcher) {
  std::vector<int> v = {1, 2, 3};

  EXPECT_THAT(v, ElementsAre(1, 2, 3));             // Matches exact elements.
  EXPECT_THAT(v, Contains(Gt(2)));                  // At least one element greater than 2.
  EXPECT_THAT(v, Each(Gt(0)));                       // All elements greater than 0.
}
```

---

