---
title: "Built-in Matchers"
description: "Detailed reference to the full set of built-in matchers for argument validation, including comparisons, container operations, string matchers, and logical compositions. Covers their syntax, typical usage, and extension mechanisms for writing custom matchers."
---

# Built-in Matchers Reference

This documentation provides a detailed reference to the comprehensive set of built-in matchers available in GoogleTest and GoogleMock for argument validation. Matchers transform expectations on mock function arguments into expressive and readable assertions, covering comparisons, container content checks, string operations, and logical combinations. This reference guides you through their syntax, typical use cases, and techniques for extending them by writing custom matchers.

---

## Introduction to Built-in Matchers

Matchers enable writing assertions and expectations that read almost like English and deliver precise, informative failure messages. By using matchers, you can specify not just exact values but properties, ranges, or structural conditions about the arguments involved in tests.

Matchers are used primarily with mock objects and in generalized assertions like `EXPECT_THAT(value, matcher)`. They play a fundamental role in validating function call arguments, verifying container contents, and checking string patterns.

**Note:** All matchers reside in the `::testing` namespace by default.

---

## Categories of Built-in Matchers

This reference organizes matchers into key categories to help you navigate what you need for your testing scenarios.

### 1. Wildcard Matchers

- `_` — Matches any value of the correct type. Useful when the argument is unimportant.
- `A<type>()` or `An<type>()` — Matches any value of the specified type.

**Example:**
```cpp
EXPECT_CALL(mock, Foo(_));  // Argument can be anything.
EXPECT_CALL(mock, Bar(A<int>()));  // Argument can be any int.
```

### 2. Generic Comparison Matchers

These matchers perform standard comparison operations using operators like `==`, `!=`, `<`, `>`, etc.

| Matcher       | Semantics               |
| ------------- | ----------------------- |
| `Eq(value)`   | Argument is equal to value        |
| `Ne(value)`   | Argument is not equal to value        |
| `Lt(value)`   | Argument is less than value         |
| `Le(value)`   | Argument is less than or equal to value        |
| `Gt(value)`   | Argument is greater than value         |
| `Ge(value)`   | Argument is greater than or equal to value        |
| `IsTrue()`    | Argument evaluates to true ( bool context) |
| `IsFalse()`   | Argument evaluates to false ( bool context) |
| `IsNull()`    | Argument is a null pointer (raw or smart) |
| `NotNull()`   | Argument is a non-null pointer |
| `Optional(m)` | Argument is an `optional<>` containing a value matching `m` |
| `VariantWith<T>(m)` | Argument is a `variant<>` holding alternative of type T matching `m` |
| `Ref(variable)` | Argument is a reference to given variable |

**Tips:** Use `TypedEq<type>(value)` to resolve overload ambiguities when matching specific types.

**Example:**
```cpp
EXPECT_CALL(mock, SetValue(Eq(42)));
EXPECT_CALL(mock, ProcessPointer(NotNull()));
```

### 3. Floating-Point Matchers

Due to rounding issues, direct equality checks on floats/doubles are error-prone. Use the following approximate matchers:

| Matcher                       | Description                                              |
| ----------------------------- | -------------------------------------------------------- |
| `FloatEq(a_float)`             | Approximately equals to `a_float` for `float`s (ULP-based) |
| `DoubleEq(a_double)`           | Approximately equals to `a_double` for `double`s (ULP-based) |
| `NanSensitiveFloatEq(a_float)` | Like `FloatEq` but treats NaN equal to NaN                 |
| `NanSensitiveDoubleEq(a_double)` | Like `DoubleEq` but treats NaN equal to NaN              |
| `FloatNear(a_float, max_abs_error)` | Matches `float` value within given absolute error      |
| `DoubleNear(a_double, max_abs_error)` | Matches `double` value within absolute error          |
| `NanSensitiveFloatNear(a_float, max_abs_error)` | Like `FloatNear` but treats NaN equal                |
| `NanSensitiveDoubleNear(a_double, max_abs_error)`| Like `DoubleNear` but treats NaN equal               |
| `IsNan()`                    | Matches any NaN floating-point value                     |

**Example:**
```cpp
EXPECT_THAT(3.14, DoubleNear(3.1415, 0.01));
EXPECT_THAT(value, FloatEq(0.5));
```

### 4. String Matchers

Matchers designed to work with C strings (`const char*`) and C++ `std::string` objects, covering equality, substrings, prefixes, suffixes, and regular expressions.

| Matcher               | Description                                               |
| --------------------- | ---------------------------------------------------------- |
| `StrEq(string)`       | Argument is equal to `string` (case-sensitive)            |
| `StrNe(string)`       | Argument is not equal to `string` (case-sensitive)        |
| `StrCaseEq(string)`   | Argument is equal to `string` ignoring case                |
| `StrCaseNe(string)`   | Argument is not equal to `string` ignoring case            |
| `HasSubstr(string)`   | Argument contains `string` as a substring                   |
| `StartsWith(string)`  | Argument starts with `string`                               |
| `EndsWith(string)`    | Argument ends with `string`                                 |
| `MatchesRegex(string)`| Argument fully matches the regular expression `string`    |
| `ContainsRegex(string)`| Argument contains substring that matches regex `string`   |
| `WhenBase64Unescaped(m)` | Matches a base64 escaped string whose unescaped content matches `m` |

**Example:**
```cpp
EXPECT_THAT(s, StartsWith("Hello"));
EXPECT_THAT(filename, ContainsRegex(".*\\.txt$"));
```

### 5. Container Matchers

Matchers specialized for validating the contents and properties of STL-style containers, native arrays, and other iterable sequences.

| Matcher                 | Description                                                  |
| ----------------------- | ------------------------------------------------------------ |
| `SizeIs(matcher)`       | Container size matches `matcher` (e.g. SizeIs(2))            |
| `BeginEndDistanceIs(matcher)` | Distance between `begin()` and `end()` matches matcher   |
| `ContainerEq(container)`| Container equals another with detailed diff messages        |
| `Contains(element_or_matcher)` | Container contains at least one element matching this     |
| `Each(element_or_matcher)` | Every element matches the given matcher                       |
| `Contains(e).Times(n)`   | Number of elements matching `e` is `n` (can test for absence with `Times(0)`) |
| `ElementsAre(e0, e1, ..., en)` | Container has these elements in this order                |
| `ElementsAreArray(begin, end)` | Like `ElementsAre` but accepts an initializer list or range  |
| `UnorderedElementsAre(e0, e1, ..., en)` | Contains elements matching the matchers, in any order  |
| `UnorderedElementsAreArray(begin, end)` | Like `UnorderedElementsAre` but accepts a range        |
| `IsSubsetOf(container_or_range)` | Container elements form a subset of the given elements   |
| `IsSupersetOf(container_or_range)` | Container elements form a superset of the given elements |
| `Pointwise(matcher_on_pairs, container)` | Element-wise pairwise matching using the given matcher |
| `UnorderedPointwise(matcher_on_pairs, container)` | Same as Pointwise but order doesn't matter            |
| `IsEmpty()`             | Container is empty                                          |

**Examples:**
```cpp
EXPECT_THAT(my_vector, ElementsAre(1, 2, 3));
EXPECT_THAT(my_set, UnorderedElementsAre(3, 1, 2));
EXPECT_THAT(my_map, Contains(Key(Eq("foo"))));
EXPECT_THAT(my_list, Each(Gt(0)));
```

### 6. Member and Property Matchers

Matchers that allow matching on specific fields, properties, or members of objects.

| Matcher                       | Description                                                  |
| ----------------------------- | ------------------------------------------------------------ |
| `Field(&Class::member, matcher)` | Matches if the member variable satisfies `matcher`             |
| `Field("name", &Class::member, matcher)` | Same as above, with field name for better error messages  |
| `Property(&Class::method, matcher)` | Matches if the zero-arg const method's return value satisfies matcher |
| `Property("name", &Class::method, matcher)` | Same as above, with property name for better error messages |

**Example:**
```cpp
EXPECT_THAT(foo, Field(&Foo::x, Ge(10)));
EXPECT_THAT(object, Property(&Object::status, Eq("ok")));
```

### 7. Pointer Matchers

Matchers for pointers and smart pointers, considering the pointer value or the pointee.

| Matcher                | Description                                                   |
| ---------------------- | ------------------------------------------------------------- |
| `Pointee(matcher)`     | Pointer points to a value matching `matcher`                   |
| `Pointer(matcher)`     | Pointer value itself matches `matcher`                         |
| `Address(matcher)`     | Address of object matches `matcher`                            |
| `WhenDynamicCastTo<T>(matcher)` | Matches a pointer or reference that dynamic_cast to `T` satisfies the matcher |

**Example:**
```cpp
EXPECT_CALL(mock, Foo(Pointee(Eq(42))));
EXPECT_THAT(ptr, Pointer(IsNull()));
```

### 8. Logical and Composite Matchers

Match on logical combinations of other matchers.

| Matcher               | Description                                                   |
| --------------------- | ------------------------------------------------------------- |
| `Not(matcher)`        | Matches if `matcher` does not match                            |
| `AllOf(m1, m2, ..., mn)` | Matches if all matchers match                                  |
| `AnyOf(m1, m2, ..., mn)` | Matches if any matcher matches                                  |
| `Conditional(cond, m1, m2)` | Matches `m1` if `cond` is true, else matches `m2`            |

**Example:**
```cpp
EXPECT_THAT(val, AllOf(Gt(0), Lt(10)));
EXPECT_THAT(val, Not(Eq(5)));
```

### 9. Using Matchers in Assertions

You can assert that a value matches a matcher using:

- `EXPECT_THAT(value, matcher)`
- `ASSERT_THAT(value, matcher)`

Matchers provide descriptive failure messages for easy debugging.

---

## Examples of Matcher Usage

### Basic Matching
```cpp
using ::testing::Eq;
EXPECT_THAT(x, Eq(5));
EXPECT_THAT(p, NotNull());
EXPECT_THAT(s, StartsWith("prefix"));
```

### Container Matching
```cpp
using ::testing::ElementsAre;
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(set, UnorderedElementsAre(3, 1, 2));
```

### Matching Struct Members
```cpp
struct Foo { int a; std::string b; };
Foo foo{};
EXPECT_THAT(foo, AllOf(Field(&Foo::a, Eq(10)), Field(&Foo::b, StartsWith("he"))));
```

### Matching Pointer Targets
```cpp
int value = 42;
int* ptr = &value;
EXPECT_THAT(ptr, Pointee(Eq(42)));
```

### Combining Matchers
```cpp
EXPECT_THAT(x, AllOf(Gt(5), Lt(10)));
EXPECT_THAT(ptr, Not(IsNull()));
```

### Parameterized Matchers
```cpp
using ::testing::HasSubstr;
EXPECT_THAT(str, HasSubstr("needle"));
```

---

## Writing Custom Matchers

GoogleMock provides simple macros to write your own matchers quickly:

- `MATCHER(name, description_string) { /* return bool */ }` — defines a matcher with no parameters.
- `MATCHER_P(name, param, description_string) { /* use 'param' */ }` — parameterized matcher with one parameter.
- Up to `MATCHER_P10` are available for multi-parameter matchers.

Inside your matcher body, use `arg` for the value being matched, and `result_listener` to emit additional diagnostic information on match failures or success.

**Example:**
```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_THAT(value, IsEven());
```

For more complex cases, implement the matcher interface manually using classes with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods.

---

## Best Practices and Tips

- Use `EXPECT_THAT()` for expressive assertions involving matchers.
- Prefer built-in matchers whenever possible for better diagnostics.
- Use `SafeMatcherCast<T>(m)` to cast matchers to compatible types safely.
- Employ logical combinators (`AllOf`, `AnyOf`, `Not`) to build complex conditions.
- When matching containers, choose `ElementsAre` to enforce order, or `UnorderedElementsAre` for unordered contents.
- For pointer arguments, use `Pointee()` to validate the target object.
- Use `Field()` and `Property()` to match sub-objects or getter results.
- Write custom matchers with `MATCHER` macros for reusable, domain-specific validations.
- Avoid matchers with side effects; they should be purely functional for repeatability.

---

## Troubleshooting

- If matchers do not match as expected, check argument types and consider using `TypedEq` or `SafeMatcherCast` to resolve overload ambiguities.
- Unexpected calls on mocks can be due to matcher mismatches; enabling verbose output (`--gmock_verbose=info`) can help trace matches.
- Use `NiceMock` to suppress warnings on uninteresting calls if noise is excessive.
- Ensure that string matchers and regex matchers are used on appropriate string types to avoid surprises.

---

## Additional Resources

- [Matchers Reference (detailed)](/docs/reference/matchers.md)
- [Mocking Reference with Matcher Usage](/docs/reference/mocking.md)
- [Using and Customizing Matchers Guide](/guides/core-workflows/using-matchers.mdx)
- [gMock Cookbook with Recipes](/docs/gmock_cook_book.md#WritingNewMatchersQuickly)
- [Assertions Reference with EXPECT_THAT usage](/docs/reference/assertions.md#EXPECT_THAT)
- [Example gMock Matchers Tests](https://github.com/google/googletest/blob/main/googlemock/test/gmock-matchers-test.cc)

---

This page fits within the API Reference's coverage of Matchers and Actions, providing a fundamental understanding that underpins mocking workflows and tailored assertion writing.

---