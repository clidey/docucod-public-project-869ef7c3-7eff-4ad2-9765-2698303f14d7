---
title: "Matchers: Verifying Arguments"
description: "Reference for built-in and custom matchers to validate arguments passed to mocked methods. Explains syntax, composition, negation, and best practices for robust test conditions. Shows how to extend the matcher system for custom needs."
---

# Matchers: Verifying Arguments

Matchers in GoogleMock are powerful tools to verify the arguments passed to mocked methods. They serve as predicates, allowing you to specify how strict or flexible your argument validation should be. This reference covers the use of built-in matchers, their composition, negation, and guidance for writing custom matchers, empowering you to write expressive and robust tests.

---

## Why Use Matchers?

When setting expectations on mock methods, confirming the exact arguments passed ensures your code interacts with dependencies as intended. Matchers help you express those constraints in expressive and readable ways, avoiding over-specification while verifying essential behaviors.


## Basic Usage of Matchers

Matchers can be used wherever you specify function arguments in `EXPECT_CALL()` or `ON_CALL()`. For example:

```cpp
// Expects the turtle to move forward by exactly 100 units.
EXPECT_CALL(turtle, Forward(100));
```

If you want to accept any argument for a parameter without restriction, use the wildcard matcher `_`:

```cpp
using ::testing::_;

// Expects a jump to some point having x coordinate 50 and any y coordinate.
EXPECT_CALL(turtle, GoTo(50, _));
```

Literal values like `100` or `50` are implicitly converted to equality matchers (`Eq`), so you do not have to wrap them explicitly.


## Built-in Matchers

GoogleMock includes a rich set of built-in matchers for many types and scenarios. Some commonly used matchers include:

- `_` : Matches any argument.
- `Eq(value)` : Matches arguments equal to `value`.
- `Ne(value)` : Matches arguments not equal to `value`.
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` : Match less than, less or equal, greater than, and greater or equal respectively.
- `Not(matcher)` : Negates the specified matcher.
- `Contains(substring)` : For strings or containers, matches if it contains a given element or substring.
- `StartsWith(prefix)`, `EndsWith(suffix)` : Match string beginnings or endings.
- `IsNull()`, `NotNull()` : Match pointer values that are `NULL` or not.
- `Pointee(matcher)` : Matches pointers whose pointee satisfies `matcher`.
- `Field(&Class::field, matcher)`, `Property(&Class::prop, matcher)` : Match specific fields or properties of objects.

Example:

```cpp
EXPECT_CALL(foo, ProcessData(Ge(0), _));  // First arg >= 0, second arg anything
EXPECT_CALL(logger, Log(StartsWith("Error")));  // Message starts with "Error"
EXPECT_CALL(db, GetUser(_)).WillOnce(Return(nullptr));  // Return nullptr
```


## Combining Matchers

Matchers can be composed logically to build more complex conditions:

- `AllOf(m1, m2, ...)` : Matches if all provided matchers match.
- `AnyOf(m1, m2, ...)` : Matches if any one matcher matches.
- `Not(m)` : Matches if matcher `m` does not match.

Example:

```cpp
using ::testing::AllOf;
using ::testing::AnyOf;

// Matches x where x >= 5 and x != 10.
EXPECT_CALL(foo, Bar(AllOf(Ge(5), Ne(10))));

// First argument must be "foo" or "bar".
EXPECT_CALL(foo, Baz(AnyOf(Eq("foo"), Eq("bar"))));
```


## Parameterized Matchers

You can create parameterized matchers with custom logic for more specific scenarios. For instance:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "is divisible by " + ::testing::PrintToString(divisor)) {
  return (arg % divisor) == 0;
}

EXPECT_CALL(mock, Compute(IsDivisibleBy(7)));
```


## Common Matcher Constructs

### Wildcard Matcher `_`

Matches anything without restriction.

### Literal Values

Literals (integers, strings, enums) are implicitly converted to equality matchers.

### Ref Matcher

Matches a reference to a specific variable. For example,

```cpp
int n = 5;
EXPECT_CALL(mock, Foo(Ref(n))); // Matches argument that is reference to n
```


## Matching Argument Tuples as a Whole

Matchers can be applied to tuples of arguments for complex relational checks across parameters. This is done via `.With()` clauses in `EXPECT_CALL` or `ON_CALL`:

```cpp
EXPECT_CALL(mock, Foo(_, _)).With(Lt());  // first argument less than second
```

This requires use of matchers supporting tuple matching like `Lt()` that work on pairs.


## Matchers for Containers

You can validate container contents using matchers:

- `ElementsAre(...)` : Matches containers with exactly the provided elements in order.
- `UnorderedElementsAre(...)` : Matches containers with exactly those elements in any order.
- `Contains(matcher)` : Matches containers that contain at least one element satisfying the matcher.
- `Each(matcher)` : Matches containers where every element satisfies the matcher.

Example:

```cpp
EXPECT_CALL(mock, ProcessVector(ElementsAre(1, Gt(5), _)));  // Vector of 3 elements
EXPECT_CALL(mock, AcceptSet(UnorderedElementsAre(1, 2, 3)));  // Unordered set
```

Use `Key(matcher)` and `Pair(key_matcher, value_matcher)` to match map keys and entries.


## Handling Overloaded Methods

If methods in your mock are overloaded, you must help resolve the ambiguity by specifying parameter matchers or using cast helpers for const and non-const versions.

Example:

```cpp
EXPECT_CALL(mock, GetBar()).WillOnce(ReturnRef(bar1));
EXPECT_CALL(Const(mock), GetBar()).WillOnce(ReturnRef(bar2));
```


## Safe Matcher Casts

Sometimes you need to cast matchers between related types carefully to prevent errors:

```cpp
EXPECT_CALL(foo, Bar(SafeMatcherCast<Derived*>(base_matcher)));
```

This ensures type-safe conversions of matchers.


## Best Practices

- Favor `ON_CALL()` for specifying default behaviors without implying call expectations. Use `EXPECT_CALL()` when you want to verify calls.
- Limit use of strict cardinalities to necessary cases; overly restrictive expectations cause brittle tests.
- Suppress uninteresting call warnings with `NiceMock` if they obscure your test's meaning.
- Group related calls in sequences (`InSequence`) to enforce call order when needed.
- Use parameterized and composite matchers to reduce error-prone exact matching.
- Avoid over-specifying argument validation; be as flexible as the test needs.


## Extending with Custom Matchers

You can define your own custom matchers for specialized validation scenarios in three main ways:

1. **Using `MATCHER` macros** for quick inline matchers:

```cpp
MATCHER(IsEven, "is even") {
  return (arg % 2) == 0;
}
```

2. **Implementing matcher interface classes** for detailed control and reusable polymorphic matchers.

3. **Composing existing matchers** using logical combinators (`AllOf`, `AnyOf`, `Not`).

Refer to the [Writing Custom Assertions and Matchers Guide](https://google.github.io/googletest/guides/advanced.html#writing-custom-assertions-and-matchers) for detailed recipes.


## Sample Matcher Usage Example

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (int x, int y), (override));
};

using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Ne;
using ::testing::_;
using ::testing::Return;

TEST(FooTest, MatcherExample) {
  MockFoo mock;

  EXPECT_CALL(mock, Compute(AllOf(Gt(0), Ne(42)), _))
      .WillOnce(Return(100));

  int result = mock.Compute(10, 5);  // Expected call matches predicate.
  EXPECT_EQ(result, 100);
}
```


## Troubleshooting Matcher Usage

- **Ambiguous overloads**: Always specify parameter matchers explicitly with overloaded methods to avoid compiler errors.
- **Side effects in matchers**: Matchers must be pure and free of side effects; avoid calling mock methods within matchers.
- **Default behaviors**: If your mock returns unexpected default values, explicitly use `ON_CALL()` or set default `DefaultValue<T>`s.
- **Unexpected call failures**: Use `EXPECT_CALL()` to restrict expected calls; unexpected calls cause test failures.


## Related Topics

- [Mocking Reference](reference/mocking.md): Defines how mock classes and macros work.
- [Mocking API: EXPECT_CALL and ON_CALL](reference/mocking-api/call-expectations.md): Details call expectations and default behaviors.
- [Actions Reference](reference/actions.md): How to define mock behaviors.
- [Cardinalities: Controlling Call Counts](reference/mocking-api/cardinalities.md): To manage how many times calls are expected.
- [gMock Cookbook](gmock_cook_book.md): Extensive recipes for mocking scenarios.


---

_For detailed descriptions of built-in matchers and how to craft custom ones, refer to the [Matchers Reference](reference/matchers.md) in the API docs._