---
title: "Argument Matchers"
description: "Comprehensive overview of matcher APIs for validating arguments in mock method calls. Highlights standard matchers, composition strategies, and how to apply them in expectations for robust and readable tests."
---

# Argument Matchers

GoogleMock provides a powerful set of APIs called **Argument Matchers** to validate the arguments passed to mock method calls. Argument matchers enable you to precisely specify what values or properties mock methods are expected to be called with, enhancing the clarity, expressiveness, and robustness of your tests.

---

## Introduction to Argument Matchers

When setting expectations with `EXPECT_CALL(mock_object, method(args))`, argument matchers let you specify constraints on the `args`. Matchers allow flexibility to capture exact values, ranges, patterns, or complex conditions.

- **Literal values** (e.g., `42`, `"hello"`) are interpreted as `Eq` (equals) matchers.
- A special matcher `_` matches any value of the correct type.
- Matchers can be combined logically or composed to define complex argument conditions.

### Why Use Matchers?

Matchers let you write tests that:

- Don't over-specify inputs, avoiding brittle tests sensitive to unrelated changes.
- Validate argument properties instead of exact values (e.g., argument greater than a threshold).
- Match multiple arguments as a tuple for relational constraints (e.g., first arg less than second).
- Enhance diagnostics by producing meaningful failure messages on mismatch.

### Basic Syntax

```cpp
using ::testing::_;  // wildcard matcher
using ::testing::Ge; // argument >= value

EXPECT_CALL(mock, Foo(42, _));       // expect foo called with 42 and any second arg
EXPECT_CALL(mock, Foo(_, Ge(5)));    // expect second arg >= 5
```

---

## Categories of Built-in Matchers

### Wildcard Matchers

| Matcher             | Description                         |
|---------------------|-----------------------------------|
| `_`                 | Matches any value of the correct type.
| `A<T>()` / `An<T>()`| Matches any value of type `T`.

Example:
```cpp
EXPECT_CALL(mock, ProcessData(_));  // Don't care what argument is passed.
EXPECT_CALL(mock, ProcessData(A<int>()));  // Matches any int.
```

### Value Comparison Matchers

Matchers that compare argument values:

| Matcher           | Meaning                               |
|-------------------|-------------------------------------|
| `Eq(value)`       | Matches if argument == value.        |
| `Ne(value)`       | Matches if argument != value.        |
| `Lt(value)`       | Matches if argument < value.         |
| `Le(value)`       | Matches if argument <= value.        |
| `Gt(value)`       | Matches if argument > value.         |
| `Ge(value)`       | Matches if argument >= value.        |
| `IsTrue()`        | Matches if argument evaluates to true.  |
| `IsFalse()`       | Matches if argument evaluates to false. |

Literal values can be used instead of `Eq()`. Beware of implicit conversions:
```cpp
EXPECT_CALL(mock, Foo(true));    // expects true
EXPECT_CALL(mock, Foo(Eq(true))); // equivalent
EXPECT_THAT(val, Eq(expected));   // preferred over implicit literal
```

### Floating-Point Matchers

To account for rounding errors, use approximate matchers:

| Matcher                  | Description                                  |
|--------------------------|----------------------------------------------|
| `FloatEq(value)`         | Matches argument approximately equal to value (float).
| `DoubleEq(value)`        | Matches argument approximately equal to value (double).
| `NanSensitiveFloatEq(value)` | Matches float values including NaN equality.
| `NanSensitiveDoubleEq(value)`| Matches double values including NaN equality.
| `FloatNear(value, epsilon)`| Matches float near value within epsilon.
| `DoubleNear(value, epsilon)`| Matches double near value within epsilon.

Example:
```cpp
EXPECT_CALL(mock, Compute(DoubleNear(3.14, 0.01)));
```

### String Matchers

Match C strings or `std::string` by contents or pattern:

| Matcher              | Description                                   |
|----------------------|-----------------------------------------------|
| `StrEq(string)`      | Exactly equal strings.
| `StrNe(string)`      | Not equal strings.
| `StrCaseEq(string)`  | Equal ignoring case.
| `StrCaseNe(string)`  | Not equal ignoring case.
| `StartsWith(prefix)` | Argument starts with prefix.
| `EndsWith(suffix)`   | Argument ends with suffix.
| `HasSubstr(string)`  | Argument contains substring.
| `ContainsRegex(regex)`  | Matches regular expression.
| `MatchesRegex(regex)`   | Matches regex fully (start-to-end).
| `WhenBase64Unescaped(m)` | Matches base64 unescaped argument.

Example:
```cpp
EXPECT_CALL(mock, Write(StartsWith("Hello")));
EXPECT_THAT(result, HasSubstr("error"));
```

### Container Matchers

Useful for STL containers or arrays:

| Matcher                | Description                                         |
|------------------------|-----------------------------------------------------|
| `Contains(e)`          | Container has an element matching `e`.              |
| `Each(m)`              | All elements match `m`.                             |
| `ElementsAre(e0, ...)` | Container has these elements exactly in this order. |
| `ElementsAreArray`     | Like `ElementsAre` but from array or container.
| `UnorderedElementsAre` | Matches elements ignoring order.
| `IsEmpty()`            | Container is empty.
| `SizeIs(m)`            | Container size matches `m`.
| `Pointwise(m, container)` | Corresponding elements match tuple matcher `m`.
| `UnorderedPointwise(m, container)`| Like `Pointwise`, ignoring order.

Example:
```cpp
EXPECT_CALL(mock, Process(VectorThatHas(Contains(42))));
EXPECT_THAT(container, ElementsAre(1, _, Ge(3)));
```

### Member and Property Matchers

Matchers that inspect a member field or property of an argument:

| Matcher                                      | Description                                   |
|----------------------------------------------|-----------------------------------------------|
| `Field(&Class::field, m)`                   | Matches argument where `field` matches `m`.
| `Field(name, &Class::field, m)`             | Same but improves error messages.
| `Property(&Class::method, m)`                | Matches argument where method() matches `m`.
| `Property(name, &Class::method, m)`          | Same but with name.
| `Key(m)`                                     | Matches `first` key in `std::pair`.
| `Pair(m1, m2)`                               | Matches `std::pair` with first and second matching.
| `Address(m)`                                 | Matches address of argument.
| `Pointee(m)`                                 | Argument points to value matching `m`.
| `Pointer(m)`                                 | Matches raw pointer stored in argument pointer or smart pointer.

Example:
```cpp
EXPECT_CALL(mock, Update(Field(&User::age, Ge(18))));
EXPECT_THAT(map, Contains(Key(42)));
```

### Multi-Argument Matchers

Match multiple arguments at once (tuples):

| Matcher                 | Description                                  |
|-------------------------|----------------------------------------------|
| `AllArgs(m)`            | Matches all arguments passed (tuple match).
| `Args<N1, N2, ...>(m)`  | Matches selected args (by zero-based indices) against `m`.
| `Eq()`, `Ge()`, `Gt()`, etc | Matchers for 2-tuples comparing arguments pairwise.

Use `.With()` clause to apply multi-argument matchers in expectations.

Example:
```cpp
EXPECT_CALL(mock, Range(_, _)).With(Lt());  // first arg < second arg
EXPECT_CALL(mock, Func(_, _, _)).With(Args<1, 2>(Ge())); // args 1 >= args 2
```

### Composite Matchers

Combine basic matchers into logical composites:

| Matcher          | Description                               |
|------------------|-------------------------------------------|
| `AllOf(m1,...,mn)` | All matchers must match (logical AND).
| `AnyOf(m1,...,mn)` | Any matcher matches (logical OR).
| `Not(m)`          | Negates matcher `m`.
| `Conditional(cond, m1, m2)` | Matches `m1` if condition is true, else `m2`.

Example:
```cpp
EXPECT_CALL(mock, Foo(AllOf(Gt(10), Lt(20))));
```

### Adapters and Utilities

- `MatcherCast<T>(m)` and `SafeMatcherCast<T>(m)` convert matchers to different types safely.
- `Truly(pred)` allows using arbitrary predicates as matchers.
- `Matches(m)` lets you treat matchers as predicates usable in STL algorithms.

---

## Using Matchers in Expectations

### Setting Argument Expectations in `EXPECT_CALL`

```cpp
using ::testing::_;
using ::testing::Return;
using ::testing::Gt;

EXPECT_CALL(mock, Process(_));                     // accept any argument
EXPECT_CALL(mock, Process(Gt(10)));                // only values > 10
EXPECT_CALL(mock, Process(StartsWith("test")));  // string argument
```

### Omitting Argument List for Non-overloaded Methods

You can set expectations without specifying argument matchers.
This is equivalent to matching any arguments:

```cpp
EXPECT_CALL(mock, Method).Times(3);  // expects Method called 3 times w/ any args
```

Requires method to be non-overloaded to avoid ambiguity.

### Arguments Match as Tuples with `.With()` Clause

To specify relational constraints on multiple arguments at once, use `.With()`:

```cpp
EXPECT_CALL(mock, Update(_, _))
    .With(Lt());  // first argument less than second
```

`AllArgs(m)` is equivalent to `m` inside `.With()` but sometimes clearer.

### Overloaded Function Disambiguation

Use `Const()` to disambiguate const overloads.
Use `Matcher<T>()`, `TypedEq<T>()`, or similar to select overloads by argument type.

Example:

```cpp
EXPECT_CALL(mock, GetBar());               // non-const
EXPECT_CALL(Const(mock), GetBar());        // const
EXPECT_CALL(printer, Print(An<int>()));   // int overload
EXPECT_CALL(printer, Print(TypedEq<char>('a'))); // char overload
```

### Multiple Expectations on the Same Method

Newest matching expectation takes precedence.
More specific expectations should appear *after* more general ones.

```cpp
EXPECT_CALL(mock, Foo(_));            // general
EXPECT_CALL(mock, Foo(42)).Times(2);  // specific
```

---

## Writing Custom Matchers

### Quick Definition with `MATCHER` Macros

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

You can parameterize matchers with `MATCHER_P`, `MATCHER_P2`, ...

### Full Custom Matcher Interface

Implement `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods.
Use `MakePolymorphicMatcher()` to create polymorphic matchers.

Example:

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    const int rem = n % 7;
    if (rem != 0 && os != nullptr) *os << "remainder is " << rem;
    return rem == 0;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is divisible by 7";
  }
  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not divisible by 7";
  }
};

Matcher<int> DivisibleBy7() {
  return DivisibleBy7Matcher();
}
```

---

## Practical Guidance

- Specify argument matchers only when necessary to keep tests maintainable.
- Use `_` when argument value does not matter.
- Combine matchers with `AllOf()`, `AnyOf()`, and `Not()` to express complex logic.
- Use `Pointee()` to match values pointed by pointers.
- Use `.With()` clause to specify constraints on full argument tuples.
- Disambiguate overloads using `Const()` or type casts when needed.

---

## Troubleshooting Matchers

- Using literals without `Eq()` may cause surprising implicit conversions.
- Omitting matcher for overloaded methods causes ambiguous calls.
- Matchers must be pure functions without side effects.
- `MATCHER*()` macros cannot be used inside function or class scopes.
- Remember that matchers evaluate multiple times unpredictably.

---

For further information, see the [Matchers Reference](matchers.md) and [gMock Cookbook](gmock_cook_book.md#NewMatchers).

---

## Code Example: Matching Arguments with Expectation

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::_;      // wildcard
using ::testing::Eq;     // equality matcher
using ::testing::Gt;     // greater than matcher

class MockFoo {
 public:
  MOCK_METHOD(bool, Process, (int n), ());
};

TEST(FooTest, ArgumentMatching) {
  MockFoo mock;

  // Expect Process called once with any argument
  EXPECT_CALL(mock, Process(_)).Times(1);

  // Expect Process called with an argument > 10
  EXPECT_CALL(mock, Process(Gt(10))).WillOnce(testing::Return(true));

  EXPECT_TRUE(mock.Process(42));
}
```

---

## Code Example: Using `With()` for Multi-Argument Matchers

```cpp
struct Point {
  int x, y;
  Point(int a, int b) : x(a), y(b) {}
};

class MockShape {
 public:
  MOCK_METHOD(void, DrawLine, (int x1, int y1, int x2, int y2));
};

using ::testing::AllOf;
using ::testing::Args;
using ::testing::Lt;
using ::testing::_; 

TEST(ShapeTest, DrawLineOrder) {
  MockShape shape;

  // Expect DrawLine called with args where x1 < x2 and y1 < y2
  EXPECT_CALL(shape, DrawLine(_, _, _, _))
      .With(AllOf(Args<0, 2>(Lt()), Args<1, 3>(Lt())));

  shape.DrawLine(1, 1, 2, 3);  // matches
}
```

---

## Additional Tips

- Use `Ref(variable)` matcher to match arguments by reference instead of by value copy.
- Use `SafeMatcherCast<T>` when matching arguments whose types differ but are convertible.
- Combine `Contains()`, `ElementsAre()`, and other container matchers for testing collections.
- Use `Not()` to negate matchers and invert their logic.

---

## References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Matchers Reference](matchers.md)
- [gMock Cookbook](gmock_cook_book.md)
- [Setting Expectations and Default Actions](guides/mocking-best-practices/setting-expectations.mdx)
- [Using Matchers for Argument Verification](guides/mocking-best-practices/using-matchers.mdx)
- [EXPECT_CALL Macro and Modifiers](api-reference/core-mocking-apis/call-expectations.mdx)

