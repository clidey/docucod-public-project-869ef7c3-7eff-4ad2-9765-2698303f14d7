---
title: "Assertions and Verification Utilities"
description: "Explain how to use assertions to verify that mock method expectations are met, with details on integrating GoogleTest assertions within GoogleMock scenarios. Addresses fatal/non-fatal failures, combining with GoogleTest, and common assertion best practices."
---

# Assertions and Verification Utilities

GoogleMock leverages and extends the powerful assertion framework of GoogleTest to help you verify that your mock method expectations are met precisely. This page explains how to use assertions within GoogleMock scenarios, manage failures effectively, and integrate mock verification seamlessly into your tests.

---

## 1. Purpose of Assertions in GoogleMock

Assertions in GoogleMock serve two main purposes:

- **Verifying Expected Calls:** Ensure that mock methods are called with expected arguments and the expected number of times.
- **Reporting Failures:** Provide clear, actionable diagnostics when expectations are violated.

Unlike simple checks, GoogleMock assertions integrate deeply with the mock framework, automatically verifying expectations at strategic points such as mock object destruction, explicit verification invocations, or test completion.

---

## 2. How GoogleMock Performs Verification

GoogleMock automatically verifies that all expectations on a mock object are satisfied when:

- The mock object is destructed.
- You explicitly call `::testing::Mock::VerifyAndClearExpectations(mock_object)`.

This reduces boilerplate and ensures test failures are caught as soon as an expectation is unmet.

<Check>
Tip: Call `VerifyAndClearExpectations()` if you want to check expectations before the mock is destructed, such as after a test phase or before handing off the mock.
</Check>

---

## 3. Types of Failures and Their Semantics

GoogleMock distinguishes between:

- **Fatal Failures:** Stop the current test immediately.
- **Non-Fatal Failures:** Record the failure but continue executing the test.

By default, GoogleMock reports **non-fatal failures** when expectations fail. This allows other tests and cleanup to proceed gracefully.

<Note>
You can combine GoogleMock assertions with GoogleTest fatal assertions (`ASSERT_*`) in your test bodies when failure should abort further test execution.
</Note>

---

## 4. Using Verification Functions

### `Mock::VerifyAndClearExpectations(void* mock_obj)`

This function verifies all expectations on a mock object and clears them if successful. It returns `true` on success and `false` on failure.

```cpp
// In your test code
MockFoo mock;
EXPECT_CALL(mock, Foo(5));
// Exercise code using mock...

ASSERT_TRUE(::testing::Mock::VerifyAndClearExpectations(&mock));
```

Calling this function multiples times on the same mock object is safe.

### `Mock::VerifyAndClear(void* mock_obj)`

This function clears both the expectations and default actions on the mock object after verifying expectations.

Use this if you want to reset the entire mock state.

---

## 5. Diagnostic Messages and How to Interpret Them

When an expectation fails, GoogleMock generates detailed messages including:

- The source location where the expectation was set.
- The expected call count and actual call count.
- The status of the expectation (satisfied, saturated, over-saturated).
- Argument matcher mismatches with expected and actual argument descriptions.
- Call stack traces if verbosity is set to `info`.

### Example failure message when call counts don't match:

```
Actual function call count doesn't match EXPECT_CALL(mock, Foo(5))...
         Expected: to be called once
           Actual: never called - unsatisfied and active
```

### Typical reasons for failures:

- The mock method was called fewer times than expected (unsatisfied).
- The mock method was called more times than expected (over-saturated).
- Arguments passed to the mock method do not match the expectation's matchers.
- The call was made out of the specified order when using sequences or pre-requisites.

---

## 6. Best Practices for Writing Assertions with GoogleMock

- **Set expectations before invoking code under test.** `EXPECT_CALL` must be called before the mock method is exercised to avoid undefined behavior.

- **Use `.Times()` to specify how many times a method should be called.** See the `Cardinalities` documentation for flexible call count specifications.

- **Combine `EXPECT_CALL` with GoogleTest assertions** when verifying side effects or outputs beyond call interactions.

- **Explicitly call `Mock::VerifyAndClearExpectations` in tests that create mocks on the heap or whose destruction timing is unpredictable.**

- **Interpret warnings about uninteresting calls as hints to either add explicit expectations or suppress them using `NiceMock`.**

- **Use sequences and pre-requisites judiciously to verify call orders and dependencies without making tests brittle.**

---

## 7. Integrating with GoogleTest Assertions

Because GoogleMock is built on top of GoogleTest, you can seamlessly integrate mock expectations verification with other `EXPECT_*` and `ASSERT_*` assertions.

Example:

```cpp
TEST(FooTest, WorksCorrectly) {
  MockFoo mock;
  EXPECT_CALL(mock, Bar(42)).Times(1);

  Foo foo(&mock);
  foo.DoSomething();

  // Verify mocks
  EXPECT_TRUE(::testing::Mock::VerifyAndClearExpectations(&mock));

  // Additional GoogleTest assertions
  EXPECT_EQ(foo.GetResult(), expected_value);
}
```

---

## 8. Handling Common Assertion Failures

### Failure: Too Few Calls

Occurs when a method is called fewer times than expected. The diagnostic will indicate the expected cardinality and actual call count.

### Failure: Too Many Calls

Occurs when a method is called more times than expected.

#### How to fix:

- Review `.Times()` clauses.
- Use `.RetiresOnSaturation()` if you want expectations to retire after being satisfied.
- Flexibly match multiple calls using `AnyNumber()`, `AtLeast(n)`, or `Between(m, n)` cardinalities.

### Failure: Unexpected Call

Happens when a call does not match any `EXPECT_CALL` expectations.

#### How to fix:

- Add applicable catch-all expectations with `.Times(AnyNumber())`.
- Adjust matchers to cover expected argument variants.

### Failure: Argument Mismatch

Indicates that the method was invoked but one or more arguments do not satisfy the specified matchers.

Review matchers and called arguments carefully and adjust accordingly.

---

## 9. Verbosity and Debugging Aids

GoogleMock supports a verbosity flag that controls how much information is printed during test execution:

- `--gmock_verbose=info` displays detailed information about matching calls and failures including stack traces.
- `--gmock_verbose=warning` (the default) shows warnings about uninteresting calls.
- `--gmock_verbose=error` shows only errors.

Use increased verbosity during test debugging to get more insights.

---

## 10. Example: Verifying Expectations in a Typical Test

```cpp
#include "gmock/gmock.h"
using ::testing::_;
using ::testing::Exactly;
using ::testing::Return;

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), ());
};

TEST(CalculatorTest, AddsNumbers) {
  MockCalculator mock;

  // Expect Add to be called exactly twice with any arguments.
  EXPECT_CALL(mock, Add(_, _)).Times(Exactly(2)).WillRepeatedly(Return(5));

  // Exercise code that calls mock.Add()
  int res1 = mock.Add(2, 3);
  int res2 = mock.Add(4, 1);

  EXPECT_EQ(res1, 5);
  EXPECT_EQ(res2, 5);

  // Explicitly verify that expectations are met.
  ASSERT_TRUE(::testing::Mock::VerifyAndClearExpectations(&mock));
}
```

---

## 11. Leveraging `AssertionResult` in Custom Verifications

If you create custom verification logic in your tests, you can return `::testing::AssertionResult` to integrate with the GoogleTest assertion framework.

```cpp
::testing::AssertionResult CheckCallCounts(const MockFoo& mock) {
  if (...) {
    return ::testing::AssertionSuccess();
  } else {
    return ::testing::AssertionFailure() << "Call counts did not match";
  }
}

TEST(FooTest, CustomVerification) {
  MockFoo mock;
  // ... set expectations and do work ...

  EXPECT_TRUE(CheckCallCounts(mock));
}
```

This approach gives you flexibility to provide custom messages and integrate deeply.

---

## 12. Troubleshooting Summary

<AccordionGroup title="Troubleshooting Assertion Failures">
<Accordion title="Expectations Verified at Destruction But Tests Pass Without Calls">

If mock objects are leaked (never destructed), their expectations may not be verified, causing false positives. Use `Mock::AllowLeak()` to mark intended leaks or ensure proper cleanup.

</Accordion>
<Accordion title="Uninteresting Call Warning When Not Interested in Calls">

Use `NiceMock<T>` instead of `T` to suppress warnings on uninteresting calls. Alternatively, add catch-all `EXPECT_CALL(...).Times(AnyNumber())` if you intend to allow any number of calls.

</Accordion>
<Accordion title="Mismatch in Call Order or Prerequisites">

Use `InSequence` or `.After()` clauses carefully to specify intended call order. Verify call order matches expectations to avoid unexpected call failures.

</Accordion>
<Accordion title="Too Few or Too Many WillOnce() Actions Specified">

Check that `WillOnce()` calls correspond correctly to the `.Times()` cardinality. If `.Times()` is inferred, `WillOnce()` actions count towards it. Consider adding a `WillRepeatedly()` for actions after all `WillOnce()` calls.

</Accordion>
<Accordion title="Unexpected Calls Despite EXPECT_CALL">

Newer `EXPECT_CALL`s shadow older ones. Ensure that the most specific expectations come after more general ones.

</Accordion>
</AccordionGroup>

---

## 13. Additional Resources

- [GoogleMock MOCK_METHOD & Macros](./mock-method-macros.md) — for defining mock methods.
- [Defining Expectations with EXPECT_CALL & ON_CALL](./expectations-on-call.md) — for setting expectations and default behaviors.
- [Mock Object Behaviors (Nice, Naggy, Strict)](./mock-object-behaviors.md) — for handling uninteresting call warnings.
- [Cardinality Control](./cardinality-control.md) — for specifying call count expectations.
- [Matchers Reference](../matchers-and-actions/argument-matching.md) — for defining argument matchers in expectations.
- [Actions for Mocks](./actions-for-mocks.md) — for defining function behaviors.

For deeper understanding, refer to the [gMock Cookbook](../../guides/advanced-testing-patterns/custom-matchers-actions.md) and GoogleTest Assertion Reference.

---

## 14. Summary

GoogleMock automatically verifies that all mock expectations are satisfied by asserting on the count, order, and arguments of mock function calls. Use `Mock::VerifyAndClearExpectations()` to explicitly check and reset expectations in tests. GoogleMock provides detailed diagnostics on failures, integrates smoothly with GoogleTest assertions, and offers controls for verbosity to aid debugging. Proper use of these verification utilities ensures robust, maintainable, and easily diagnosable tests.

---

## 15. Example: Full Mock Verification Workflow

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::_;
using ::testing::Return;

class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (), ());
  MOCK_METHOD(int, GetData, (int id), ());
};

TEST(DatabaseClientTest, FetchData) {
  MockDatabase mock_db;

  // Set expectations
  EXPECT_CALL(mock_db, Connect()).WillOnce(Return(true));
  EXPECT_CALL(mock_db, GetData(42)).Times(2).WillRepeatedly(Return(100));

  // Code that uses mock_db
  ASSERT_TRUE(mock_db.Connect());
  EXPECT_EQ(mock_db.GetData(42), 100);
  EXPECT_EQ(mock_db.GetData(42), 100);

  // Explicitly verify
  EXPECT_TRUE(::testing::Mock::VerifyAndClearExpectations(&mock_db));
}
```

This test ensures the database is connected once and data requested twice as expected.

---