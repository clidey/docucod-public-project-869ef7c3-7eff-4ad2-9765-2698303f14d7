---
title: "Actions and Return Behaviors"
description: "Describes how to specify mock method responses using built-in and custom actions. Covers core APIs, the mechanics of action macros, and techniques for chaining or parameterizing actions, with code snippets for common use cases."
---

# Actions and Return Behaviors

Actions in GoogleMock specify what a mocked function should do when called. Configuring the behavior of your mock methods is crucial to creating meaningful, reliable tests that emulate real interactions under controlled conditions. This reference details the built-in actions provided by GoogleMock, how to combine them, and how to write custom actions for advanced scenarios.

---

## Overview

When your mock methods are called, you control their behavior with actions. Actions can return values, invoke functions, modify output parameters, or influence state. GoogleMock provides a rich set of built-in actions to address common needs, as well as facilities to compose multiple behaviors or customize actions using functors, lambdas, or your own implementations.

The actions you specify associate with `EXPECT_CALL` or `ON_CALL` statements using `WillOnce()`, `WillRepeatedly()`, `WillByDefault()`, and the like.

---

## Returning Values from Mock Methods

### Basic Return

- `Return(value)` returns the specified `value`. Note that `value` is converted to the return type of the mock method **when the expectation is set**, not upon each call.

```cpp
using ::testing::Return;

EXPECT_CALL(foo, GetNumber())
    .WillOnce(Return(10));
```


### Returning References

If the mock method returns a reference, use `ReturnRef(variable)` to return a reference to `variable`:

```cpp
using ::testing::ReturnRef;

Bar bar;
EXPECT_CALL(foo, GetBar())
    .WillOnce(ReturnRef(bar));
```

### Returning Live Values

If you want to return values that may change during test execution (not a value captured when the expectation was defined):

- Use `ReturnPointee(pointer)` to return what `pointer` points to at the time of invocation.
- Use `ReturnRef(variable)` to return a reference (live access) to a variable.

```cpp
int x = 0;
EXPECT_CALL(foo, GetValue())
    .WillRepeatedly(ReturnPointee(&x));  // Reflects latest value of x
```


### Other Specialized Return Actions

| Action                         | Description                                   |
|-------------------------------|-----------------------------------------------|
| `ReturnNew<T>(args...)`        | Returns `new T(args...)`. Creates a new object on every call. |
| `ReturnNull()`                 | Returns a null pointer.                        |
| `ReturnRoundRobin({a1, ..., an})` | Cycles through the given list of return values on successive calls.|  


---

## Performing Side Effects and Manipulations

Actions also let you perform side effects on the arguments of the call, such as modifying output parameters or deleting pointer arguments.

### Common Side Effect Actions

| Action                      | Description                                                             |
|----------------------------|-------------------------------------------------------------------------|
| `SetArgPointee<N>(value)`  | Sets the value pointed to by the N-th (0-based) argument to `value`.    |
| `SetArrayArgument<N>(first, last)` | Copies a range `[first, last)` into the array or iterator argument `N`.    |
| `DeleteArg<N>()`           | Deletes the pointer given as the N-th argument.                         |
| `SaveArg<N>(pointer)`      | Saves a copy of the N-th argument into `*pointer`.                      |
| `SetArgReferee<N>(value)` | Assigns `value` to the reference given as the N-th argument.           |

For example, setting a function's output parameter:

```cpp
using ::testing::SetArgPointee;

EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(SetArgPointee<1>(5));  // Sets second arg to 5
```

Chaining side effects with return values can be done using `DoAll()` (see next section).

---

## Combining Multiple Actions

Sometimes you want to perform several things in one function call, e.g., modify an output argument and then return a value.

### `DoAll`

`DoAll(a1, a2, ..., an)` executes all the actions `a1` to `an` sequentially for each call. Only the return value of the last action is forwarded as the mock function's return value.

```cpp
EXPECT_CALL(foo, Bar(_))
    .WillOnce(DoAll(SetArgPointee<0>(7),
                    Return(true)));
```

Here, the first argument of `Bar` is set to 7, then `Bar` returns `true`.

### Ignoring Return Values

If you have an action that returns a value but you want to ignore it (e.g., inside `DoAll()`), use `IgnoreResult(action)`:

```cpp
EXPECT_CALL(foo, Bar())
    .WillOnce(DoAll(IgnoreResult(SomeFunction()), Return(42)));
```


### Selecting Arguments Passed to Inner Action

Sometimes your custom action only applies to a subset of the arguments of the mocked function. Use:

- `WithArg<N>(action)` to pass just the N-th argument.
- `WithArgs<N1, N2, ...>(action)` to pass multiple selected arguments.
- `WithoutArgs(action)` to pass no arguments to the action.

Example:

```cpp
bool CheckLabel(const std::string& label) { return label == "OK"; }

EXPECT_CALL(foo, Process(_, _, _))
    .WillOnce(WithArg<1>(Invoke(CheckLabel)));
```

---

## Invoking Functions, Methods, and Callables

You can invoke existing functions, functors, lambdas, or methods on an object as mock actions.

| Usage                                      | Behavior                                                               |
|--------------------------------------------|------------------------------------------------------------------------|
| `Invoke(f)`                                | Calls global or functor `f` with mock function's arguments.            |
| `Invoke(object, &Class::Method)`           | Calls member method on `object` with mock arguments.                   |
| `InvokeWithoutArgs(f)`                      | Calls callable `f` without passing any mock arguments.                 |
| `InvokeArgument<N>(args...)`                | Invokes the N-th argument passed to the mock (which must be callable) with `args...`. |

Example invoking a lambda:

```cpp
EXPECT_CALL(foo, DoThis(_))
    .WillOnce(Invoke([](int x) { return x * 2; }));
```

Example invoking a function pointer argument:

```cpp
EXPECT_CALL(foo, RunCallback(_))
    .WillOnce(InvokeArgument<0>(5)); // Calls callback->Run(5)
```

Remember to use `std::ref()` if you want to pass references in `InvokeArgument`.

---

## Defining Custom Actions

### Using Lambdas, Functors, or Function Objects

For many needs, simply provide a lambda or a callable object with the signature compatible with the mock method:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int x) { return x + 10; });
```

The callable will receive the mock function's arguments and can return a suitable value.

### Legacy Macros: ACTION, ACTION_P, ACTION_TEMPLATE

You can define actions using the `ACTION` family of macros for concise reusable actions. For example:

```cpp
ACTION(IncrementArg1) { return ++(*arg1); }

EXPECT_CALL(mock, Foo(_))
    .WillOnce(IncrementArg1());
```

For parameterized actions use `ACTION_P`:

```cpp
ACTION_P(Add, n) { return arg0 + n; }
EXPECT_CALL(mock, Foo(_))
    .WillOnce(Add(5));
```

Advanced users can define template actions with `ACTION_TEMPLATE` for explicit template parameters.

### Implementing `ActionInterface`

For the highest control, implement `::testing::ActionInterface<F>` where `F` is the mock function type. Your class must provide a `Perform()` method that executes the action.

See `NewMonoActions` and `NewPolyActions` sections in the source for exact details.

---

## Special Use Cases

### Returning Move-Only Types

Mocking methods that return or accept move-only types (e.g., `std::unique_ptr`) works natively by using lambdas or move-capable callables.

Example:

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (const std::string& text), (override));

EXPECT_CALL(mock, MakeBuzz(_))
    .WillRepeatedly([](const std::string& text) {
      return std::make_unique<Buzz>(text);
    });
```

Avoid `Return(std::move(...))` for move-only types with `WillRepeatedly()` since the moved-from object will be empty after the first call.

### Deleting a Mock Argument

Use `DeleteArg<N>()` to delete a pointer argument automatically after the call.

### Invoking Mock Object Methods or Functions Inside Actions

You can call other mock methods within an action by wrapping calls in lambdas.

### Combining Delegation to Fakes or Real Objects

You can delegate actions to a real or fake implementation using `ON_CALL` and lambdas, enabling partial mocking.

Example:

```cpp
ON_CALL(mock, Foo(_)).WillByDefault([&real](int x) {
  return real.Foo(x);
});
```

---

## Best Practices and Tips

- **Order of `WillOnce()` matters:** Each `WillOnce()` action applies to exactly one call.
- **`WillRepeatedly()` sets behavior after all `WillOnce()`'s are exhausted.**
- **Use `DoAll()` when multiple side-effects are needed in one call.**
- **Avoid over-specifying actions to keep tests maintainable. Use `ON_CALL` for defaults and `EXPECT_CALL` for verifications.**
- **Use `IgnoreResult()` to adapt return-value actions for void mock methods.**
- **Prefer lambdas or callable objects for simplicity and flexibility over legacy macros when possible.**
- **Use `InvokeArgument` to test mocks that receive callbacks or functors as arguments.**
- **For asynchronous tests, combine actions with synchronization objects like `Notification` to coordinate behavior.**

---

## Additional References

For detailed syntax, coverage, and examples of mock actions and behaviors, see:

- [Mocking Reference: Actions](../../reference/mocking.md#UsingActions)
- [gMock Cookbook: Using Actions](../gmock_cook_book.md#UsingActions)
- [Matchers and Actions Reference](../reference/actions.md)
- [gMock Cheat Sheet](../gmock_cheat_sheet.md#ActionList)


---

## Summary

Actions in GoogleMock define the behavior of mocked methods on invocation. They cover returning values, performing side effects such as modifying arguments, invoking callbacks, combining multiple actions, and writing custom callable actions. This flexibility enables precise and expressive test setups, crucial for interaction-based testing.

By mastering actions, you gain control over mocked dependencies, can simulate complex scenarios, and ensure your tests faithfully represent intended behaviors while maintaining maintainability.

---

## See Also

- `EXPECT_CALL` and `ON_CALL` usage for setting actions [Mocking Reference](../../reference/core-mocking-apis/call-expectations.md)
- Argument Matchers for constraining when actions trigger [Argument Matchers](../../reference/matchers-and-actions/argument-matchers.md)
- Strictness modes (`NiceMock`, `StrictMock`) and their effect on action invocation [Strictness Modes](../../reference/core-mocking-apis/strictness-modes.md)

---

## Example Quick Setup

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (int x), (override));
};

TEST(FooTest, ExampleAction) {
  MockFoo mock;

  // Returns 42 for first call, then returns 100 for all subsequent calls.
  EXPECT_CALL(mock, Compute(_))
      .WillOnce(Return(42))
      .WillRepeatedly(Return(100));

  EXPECT_EQ(42, mock.Compute(10));
  EXPECT_EQ(100, mock.Compute(20));
  EXPECT_EQ(100, mock.Compute(30));
}
```

---
