---
title: "Matchers Reference"
description: "Documents all built-in and extensible matchers for expressing expectations and predicates in test assertions. Explains matcher combinators, custom matcher creation, and practical examples for validating test outcomes."
---

# Matchers Reference

Matchers are the powerful predicates used in GoogleMock to specify the expectations on mock method arguments and to verify values in assertions. They provide expressive, readable, and extensible ways to validate test outcomes and interactions.

This reference covers built-in matchers provided by GoogleMock, how to combine them, and how to create custom matchers for your specific needs.

---

## Table of Contents

- [Introduction to Matchers](#introduction-to-matchers)
- [Using Built-in Matchers](#using-built-in-matchers)
  - [Wildcard Matcher](#wildcard-matcher)
  - [Equality and Comparison Matchers](#equality-and-comparison-matchers)
  - [String Matchers](#string-matchers)
  - [Pointer Matchers](#pointer-matchers)
  - [Container Matchers](#container-matchers)
- [Combining Matchers](#combining-matchers)
  - [Logical Combinators](#logical-combinators)
  - [Multi-argument Matchers](#multi-argument-matchers)
- [Parameterized Matchers](#parameterized-matchers)
- [Custom Matchers](#custom-matchers)
- [Advanced Matcher Usage](#advanced-matcher-usage)
- [Practical Examples](#practical-examples)

---

## Introduction to Matchers

Matchers in GoogleMock are function objects that determine whether a value satisfies a given condition. They are fundamental in setting expectations on mock method calls and verifying values with expressive assertions.

Matchers can be:

- Polymorphic: can match values of many types depending on context.
- Monomorphic: match only specific types.

The simplest matcher is the wildcard matcher `_`, which matches any argument.

You generally use matchers inside `EXPECT_CALL` and `EXPECT_THAT` assertions.

```cpp
EXPECT_CALL(mock, Foo(Ge(5), Eq("hello"), _));
EXPECT_THAT(value, HasSubstr("test"));
```

---

## Using Built-in Matchers

GoogleMock provides a rich library of built-in matchers for the most common comparison and validation needs.

### Wildcard Matcher

- `_`: Matches any value of the correct type.

Example:

```cpp
EXPECT_CALL(mock, Process(_));  // Expects Process called with any argument.
```

### Equality and Comparison Matchers

- `Eq(value)`: Matches equal values (`value` is compared with `==`). `Eq(value)` is implicitly used when you specify a value instead of matcher.
- `Ne(value)`: Not equal to `value`.
- `Lt(value)`, `Le(value)`: Less than, less or equal.
- `Gt(value)`, `Ge(value)`: Greater than, greater or equal.

Example:

```cpp
EXPECT_CALL(mock, Foo(Ge(10)));  // Foo() called with argument >= 10
EXPECT_CALL(mock, Foo(Eq(5)));    // Foo() called with argument == 5
```

### String Matchers

For strings (`std::string`, C strings, string views), you have:

- `StrEq(str)`: Matches strings exactly (case sensitive).
- `StrNe(str)`: Not equal strings.
- `StrCaseEq(str)`: Equal ignoring case.
- `StrCaseNe(str)`: Not equal ignoring case.
- `HasSubstr(substring)`: Contains substring.
- `StartsWith(prefix)`: Starts with given string.
- `EndsWith(suffix)`: Ends with given string.

Example:

```cpp
EXPECT_CALL(mock, SetName(HasSubstr("admin")));
EXPECT_THAT(user_input, StartsWith("Hello"));
```

### Pointer Matchers

- `IsNull()`: Matches any `NULL` or `nullptr` pointer.
- `NotNull()`: Matches any non-null pointer.
- `Ref(var)`: Matches a reference argument referring to `var` (checks address equality).
- `Pointee(matcher)`: Matches pointers pointing to a value matching `matcher`. Works with raw and smart pointers.

Example:

```cpp
EXPECT_CALL(mock, ProcessPointer(Pointee(Ge(0))));
EXPECT_CALL(mock, SetCallback(NotNull()));
```

### Container Matchers

For STL-style containers and arrays:

- `ElementsAre(m1, m2, ..., mn)`: Matches a container with exactly `n` elements, each matching the respective matcher.
- `UnorderedElementsAre(...)`: Matches container elements ignoring order.
- `ElementsAreArray(array_or_container)`: Matches elements from an array or container.
- `UnorderedElementsAreArray(array_or_container)`: Like above, ignoring order.
- `Contains(matcher)`: Matches if at least one element matches.
- `Each(matcher)`: Matches if every element matches.
- `SizeIs(size_matcher)`: Matches if container size satisfies `size_matcher`.
- `IsEmpty()`: Matches empty containers or strings.

Example:

```cpp
EXPECT_CALL(mock, ProcessList(ElementsAre(1, Ge(10), _)));
EXPECT_THAT(vec, Each(Lt(100)));
EXPECT_THAT(set, Contains(42));
```

---

## Combining Matchers

### Logical Combinators

- `AllOf(m1, m2, ..., mn)`: Matches if **all** matchers match.
- `AnyOf(m1, m2, ..., mn)`: Matches if **any** matcher matches.
- `Not(m)`: Matches if `m` does **not** match.

Example:

```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(5), Lt(10)))); // Argument between 5 and 10 (inclusive)
EXPECT_THAT(value, Not(HasSubstr("fail")));
```

### Multi-argument Matchers

Sometimes you want to match all arguments of a function call as a whole tuple.

- `.With(multi_arg_matcher)`: Used in `EXPECT_CALL` or `ON_CALL` to restrict matching to calls where all arguments as one tuple match `multi_arg_matcher`.

- `Args<k1, k2, ..., kn>(matcher)`: Matches selected arguments in specified positions as a tuple.

- Built-in 2-tuple matchers like `Lt()`, `Eq()` are available for matching argument tuples.

Example:

```cpp
EXPECT_CALL(mock, SetPoint(_, _))
    .With(Lt());  // Expects first < second argument
EXPECT_CALL(mock, SetRange(_, _))
    .With(AllOf(Args<0,1>(Ge()), Args<1, 2>(Lt())));
```

---

## Parameterized Matchers

GoogleMock provides macros to define new matchers that take parameters:

- `MATCHER(name, description) { ... }`: Defines a matcher `name` with a custom logic.
- `MATCHER_P(name, param_name, description) { ... }`: Matcher with one parameter.
- And similarly `MATCHER_P2`, ..., `MATCHER_P10` for more parameters.

Inside the matcher body, you can access:

- `arg`: the value to match.
- Parameters by their names.
- `result_listener`: an object to stream explanations for failure.

Example:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy7()));

MATCHER_P(InClosedRange, low, hi, "") {
  return low <= arg && arg <= hi;
}

EXPECT_THAT(value, InClosedRange(10, 20));
```

Matchers can have custom failure messages and also explain why a match failed.

---

## Custom Matchers

Custom matchers are a key part of GoogleMock's extensibility. You can write custom matcher classes implementing the `MatcherInterface<T>` or use the polymorphic matcher patterns. Defining your own matchers lets you test domain-specific invariants or complex conditions succinctly and with meaningful messages.

Example polymorphic matcher (checks for non-null pointers):

```cpp
class NotNullMatcher {
 public:
  using is_gtest_matcher = void;

  template <typename T>
  bool MatchAndExplain(T* p, MatchResultListener* /*listener*/) const {
    return p != nullptr;
  }

  void DescribeTo(std::ostream* os) const { *os << "isn't NULL"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is NULL"; }
};

inline PolymorphicMatcher<NotNullMatcher> NotNull() {
  return MakePolymorphicMatcher(NotNullMatcher());
}
```

Using this matcher:

```cpp
EXPECT_CALL(mock, Foo(NotNull()));
```

---

## Advanced Matcher Usage

- **SafeMatcherCast&lt;T&gt;(m)**: Casts a matcher `m` to the correct type `T`, useful for working with types that can be implicitly converted.

- **Matcher Combinators**: Variadic versions of `AllOf` and `AnyOf` are supported, including array-based variants.

- **Matching Optional and Variant Types**: Matchers like `Optional()` and support for `std::variant` provide coverage for modern C++ types.

- **Matchers for Tuples and Structs**: `FieldsAre(...)` lets you specify compound matching requirements over tuples or aggregate structs.

- **Matchers for Keys and Pairs**: Useful for matching map keys or key/value pairs.

---

## Practical Examples

### Matching a Method Called With Specific Arguments

```cpp
EXPECT_CALL(mock, SetValue(Ge(10), StrCaseEq("test")));
```

### Matching a Container With Specified Elements

```cpp
EXPECT_CALL(mock, UpdateList(ElementsAre(1, Gt(5), _)));
```

### Matching Pointer Arguments

```cpp
EXPECT_CALL(mock, ProcessData(Pointee(Lt(100))));
```

### Custom Matcher for Even Numbers

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_THAT(value, IsEven());
```

### Matching Arguments Using Multi-argument Matcher

```cpp
EXPECT_CALL(mock, SetRange(_, _)).With(Lt());  // First arg < second arg
```

---

## Tips and Best Practices

- Use `_` when you don't care about an argumentâ€™s value.
- Prefer `ON_CALL` to specify default mock behavior without forcing expectations.
- Use `EXPECT_CALL` with matchers for precise tests.
- Combine matchers using `AllOf`, `AnyOf`, and `Not` for complex argument constraints.
- Define custom matchers to improve test clarity and failure diagnostics.
- Avoid over-specifying expectations; balance precision with maintainability.

---

For full matcher syntax and advanced examples, consult the [gMock Cookbook - Writing New Matchers](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers.md).

---

## See Also

- [GoogleMock Mocking Reference](reference/mocking.md)
- [GoogleMock Actions and Macros](reference/matchers-and-actions/actions-and-macros.md)
- [GoogleTest Assertions Reference](reference/assertions.md)
- [gMock for Dummies](docs/gmock_for_dummies.md)

---

## Further Reading

- [gMock Cookbook: Custom Matchers](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers)
- [Matchers Reference (online)](https://google.github.io/googletest/reference/matchers.html)

---

<Info>
Matchers provide an extremely expressive way to specify complex verification on method arguments and test values, improving test readability and diagnostic quality. Use them to write robust and maintainable tests.
</Info>
