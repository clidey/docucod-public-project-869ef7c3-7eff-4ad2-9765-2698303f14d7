---
title: "Return and Invoke Actions (gmock Actions)"
description: "Document available action templates and macros for controlling mock responses, from simple returns to invoking callbacks and elaborate parameter handling. Covers both common actions and variadic/action templates for flexible mock configuration."
---

# Return and Invoke Actions (gmock Actions)

This reference documents the available built-in action templates and macros provided by GoogleMock for controlling the behavior of mock functions. Whether you need simple return values, invoking callbacks that are passed as function arguments, or complex parameter handling with variadic templates, this guide covers the common actions and flexible action templates used to configure mock responses.

---

## Overview of Actions

In GoogleMock, **actions** specify what should happen when a mocked method is invoked. These can be simple returns of constant values, invoking a stored callback argument, chaining multiple side effects, or other complex behaviors.

Users typically specify actions with `.WillOnce()`, `.WillRepeatedly()`, or `.WillByDefault()` clauses on `EXPECT_CALL` or `ON_CALL` statements.

This reference focuses on:

- Simple return actions
- Invoking the N-th argument as a callback (including passing arguments)
- Action macros and templates for defining new flexible actions

---

## Built-in Return Actions

GoogleMock provides a set of ready-to-use actions that return values from mock functions:

- **`Return()`**: Returns from a `void` mock function.

- **`Return(value)`**: Returns a fixed value specified at expectation time (note the value is copied or converted _when the expectation is set_, not each time the action is executed).

- **`ReturnRef(variable)`**: Returns a reference to the specified variable, useful for reference return types.

- **`ReturnPointee(pointer)`**: Returns the value pointed to by a pointer at the time the action executes, enabling live return values that may change after expectation setting.

- **`ReturnNew<T>(...)`**: Dynamically allocates and returns a new object every time the mock function is called.

- **`ReturnNull()`**: Returns a null pointer.

- **`ReturnRoundRobin({a1,...,an})`**: Returns successive values from a list in a round-robin fashion.

Use these actions to make your mocks return constant or dynamic values as needed.

---

## Invoking the Nth Argument as a Callable: `InvokeArgument` Action

One of the powerful GoogleMock action utilities is `InvokeArgument<N>(args...)`, which invokes the N-th (zero-based) argument of the mock function call as a callable (e.g., function pointer, functor, lambda), passing in provided arguments.

### Usage

```cpp
using ::testing::InvokeArgument;

EXPECT_CALL(mock_obj, Method(_, _))
    .WillOnce(InvokeArgument<1>(5));  // Calls the 2nd argument callable with 5
```

### Key Notes

1. The N-th argument must be callable (function pointer, functor, lambda, callback, etc.).
2. Arguments listed in `InvokeArgument<N>(args...)` are passed by value by default.
3. To pass arguments by reference, wrap them with `std::ref()`:

   ```cpp
   InvokeArgument<1>(5, std::ref(foo));
   ```

4. If the callable expects a const reference and you do not use `std::ref()`, the callable will receive a reference to a _copy_ of the temporary value, avoiding dangling references.

### Example

```cpp
EXPECT_CALL(mock, Process(_, _))
    .WillOnce(InvokeArgument<1>(42, "hello", std::ref(my_object)));
```

This will call the second argument (a callable) with `(42, "hello", my_object&)`.

---

## Defining Actions Using Macros and Templates

GoogleMock allows powerful extensibility through the following:

### ACTION Macros

- `ACTION(name) { /* statements returning mock return value */ }`
  - Defines an action `name()`.
  - Use `arg0`, `arg1`, ... to refer to the mock function arguments by position.

- `ACTION_P(name, param) { /* statements */ }`
  - Defines a parameterized action `name(param)`.
  - Use `param` and `arg0`, `arg1`, ... as above.

- `ACTION_Pk(name, p1, ..., pk) { /* statements */ }`
  - Defines actions with multiple parameters.

These macros capture the called arguments and enable custom behaviors on mock calls.

**Example:**
```cpp
ACTION(IncrementArg1) { return ++(*arg1); }
EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementArg1());
```

### ACTION_TEMPLATE

For advanced usage, use `ACTION_TEMPLATE` to create generic actions with explicit template parameters.

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(::std::get<k>(args));
}

EXPECT_CALL(mock, Foo(_, _)).WillOnce(DuplicateArg<1, unsigned char>(&n));
```

This enables parameterized and type-safe generic actions.

---

## Composite and Side-Effect Actions

- **`DoAll(a1, a2, ..., an)`**: Executes multiple actions in sequence where first `n-1` actions must return void; returns last action's result.

- **`IgnoreResult(a)`**: Executes action `a` ignoring its return value; useful when the mocked method returns void but underlying callable returns a value.

- **`WithArg<N>(action)`** and **`WithArgs<N1, N2, ..., Nk>(action)`**: Call the given action with selected arguments from the mock invocation, enabling flexible action composition.

- **`WithoutArgs(action)`**: Calls the given action ignoring all arguments.

These enable building complex behaviors from simpler operations.

---

## Using Functions, Methods, Functors, and Lambdas as Actions

- **`Invoke(f)`**: Invokes function/functor `f` passing mock arguments.

- **`Invoke(object_pointer, &Class::Method)`**: Invokes a method on object with mock arguments.

- **`InvokeWithoutArgs(f)`**: Invokes a callable without arguments.

- Can be used with lambdas or any callable compatible with the mock signature.

### Example

```cpp
using ::testing::Invoke;

int Add(int x, int y) { return x + y; }

EXPECT_CALL(mock, Sum(_, _))
    .WillOnce(Invoke(Add));

// or lambda
EXPECT_CALL(mock, IsReady())
    .WillOnce([] { return true; });
```

---

## Best Practices & Tips

- If your mock method returns a reference, use `ReturnRef()` instead of `Return()`.

- If you need to return live or changing data, use `ReturnPointee()` to return a value pointed to by the given pointer.

- For callable arguments invoked later, remember to use `std::ref()` to pass by reference to avoid copying temporaries.

- Use `DoAll()` to chain multiple side effects; ensure the last action returns the required return type.

- When passing actions that return a value to mock methods returning `void`, wrap with `IgnoreResult()`.

- Prefer lambdas or functors for complex mock behaviorsâ€”easier to write and debug.

- Use the `ACTION` family of macros or `ACTION_TEMPLATE` for reusable custom actions.

- Use `InvokeArgument<N>` to trigger callbacks passed as mock function parameters in a clean and robust way.

---

## Related Topics

- [Expectations and Call Behaviors (EXPECT_CALL, ON_CALL)](/api-reference/core-mocking-apis/expectations-on-call)
- [Matchers and Argument Matching](/api-reference/matchers-and-actions/argument-matching)
- [Defining Mock Methods (MOCK_METHOD macro)](/api-reference/core-mocking-apis/mock-method-macros)
- [Custom Matchers and Actions Guide](/guides/advanced-testing-patterns/custom-matchers-actions)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes and best practices

---

For detailed syntax, templates, and macro definitions, refer to `googlemock/include/gmock/gmock-more-actions.h` and the [Actions Reference](../reference/actions.md) in the GoogleMock documentation.

---

<Note>
This page documents only actions for controlling mock responses and invoking function arguments, allowing flexible and expressive mock behaviors in C++ tests. It does not cover the full mocking API or argument matchers.
</Note>