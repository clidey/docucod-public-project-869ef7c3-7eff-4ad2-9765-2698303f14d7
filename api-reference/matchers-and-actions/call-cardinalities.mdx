---
title: "Call Count Expectations (Cardinalities)"
description: "Reference for specifying expected call counts using predefined and custom cardinalities in mock expectations. Guides users through AtLeast, AtMost, AnyNumber, Exactly, and custom cardinality extensions."
---

# Call Count Expectations (Cardinalities)

GoogleMock provides powerful tools to specify and control **how many times** a mock method is expected to be called during a test. These expectations are expressed through _cardinalities_â€”predefined or custom specifications of allowed call counts.

This reference page guides you through the essential cardinality constructs available, including `AtLeast()`, `AtMost()`, `AnyNumber()`, `Exactly()`, and the ability to create your own via custom cardinality extensions. Understanding and properly using these call count specifications is crucial for delivering robust, meaningful mock-based tests.

---

## Overview of Cardinalities

A cardinality defines the allowed number of invocations for a mock method. It acts as a flexible and expressive contract in your expectations set with `EXPECT_CALL()`. The cardinality determines what call counts are:

- **Satisfied**: The current number of calls meets the expectation.
- **Saturated**: The upper limit of calls has been reached.
- **Over-saturated**: Calls have exceeded the upper-bound.

### Key Cardinality Functions

- `AnyNumber()` - no limit on the call count.
- `AtLeast(n)` - called at least `n` times.
- `AtMost(n)` - called at most `n` times.
- `Between(m, n)` - called between `m` and `n` times inclusively.
- `Exactly(n)` - called exactly `n` times.

_Most other cardinalities are built on top of these primitives._

### Example Use

```cpp
EXPECT_CALL(mock_object, SomeMethod())
    .Times(AtLeast(2))   // Expect method to be called two or more times.
    .WillRepeatedly(Return(true));

EXPECT_CALL(mock_object, AnotherMethod())
    .Times(Exactly(3));  // Expect method exactly three times.
```

---

## Detailed Cardinality Descriptions

### 1. AnyNumber()

- **Description:** Specifies that the mock function may be called any number of times (zero or more).
- **Behavior:** Always satisfied regardless of call count.
- **Saturation:** It never saturates since the upper bound is effectively unlimited.
- **Bounds:** Lower bound = 0, Upper bound = INT_MAX (practically unlimited).

```cpp
// Expect method to be called any number of times.
EXPECT_CALL(mock_obj, Foo())
    .Times(AnyNumber());
```

### 2. AtLeast(n)

- **Description:** Called at least `n` times.
- **Behavior:** Not satisfied if calls are fewer than `n`; satisfied otherwise.
- **Saturation:** Never saturates as no upper bound is enforced.
- **Bounds:** Lower bound = `n`, Upper bound = INT_MAX.

```cpp
EXPECT_CALL(mock_obj, Bar())
    .Times(AtLeast(2));  // At least two calls expected.
```

### 3. AtMost(n)

- **Description:** Called at most `n` times (including zero).
- **Behavior:** Satisfied if calls are between 0 and `n`, inclusive.
- **Saturation:** Saturates when call count reaches `n`.
- **Bounds:** Lower bound = 0, Upper bound = `n`.

```cpp
EXPECT_CALL(mock_obj, Baz())
    .Times(AtMost(3));  // No more than 3 calls.
```

### 4. Between(m, n)

- **Description:** Called between `m` and `n` times inclusively.
- **Behavior:** Satisfied if the call count is within these bounds.
- **Saturation:** Saturates after `n` calls.
- **Bounds:** Lower bound = `m`, Upper bound = `n`.

```cpp
EXPECT_CALL(mock_obj, Quux())
    .Times(Between(1, 4));  // Called between 1 and 4 times.
```

### 5. Exactly(n)

- **Description:** Called exactly `n` times.
- **Behavior:** Satisfied only when call count equals `n`.
- **Saturation:** Saturates exactly when calls reach `n`.
- **Bounds:** Lower bound = `n`, Upper bound = `n`.

```cpp
EXPECT_CALL(mock_obj, Quuz())
    .Times(Exactly(2));  // Called exactly twice.
```

### Error Checking

Construction of cardinalities with invalid arguments triggers run-time failures via GoogleTest's non-fatal assertion mechanism. For example,

- Negative call counts are disallowed.
- For `Between(m, n)`, `n` must be >= `m` and both >= 0.

Example:

```cpp
EXPECT_NONFATAL_FAILURE({ AtLeast(-1); }, "The invocation lower bound must be >= 0");
EXPECT_NONFATAL_FAILURE({ Between(2, 1); }, "The invocation upper bound (1) must be >= the invocation lower bound (2)");
```

---

## Cardinality Evaluation Methods

Using a cardinality, GoogleMock performs checks during test execution:

| Method                         | Purpose                                                   |
|-------------------------------|-----------------------------------------------------------|
| `IsSatisfiedByCallCount(n)`   | Checks if `n` calls meet the cardinality expectation.    |
| `IsSaturatedByCallCount(n)`   | Checks if `n` calls have saturated the expectation.      |
| `IsOverSaturatedByCallCount(n)` | Checks if `n` calls exceed the upper limit allowed.      |

These internally enforce your test's constraints and generate informative errors if violated.

---

## Descriptions for Call Counts

GoogleMock provides human-readable descriptions for call counts to help diagnostics:

| Call Count  | Description       |
|-------------|-------------------|
| 0           | "never called"    |
| 1           | "called once"    |
| 2           | "called twice"   |
| >= 3        | "called <n> times" |

This helps generate error messages telling you exactly how many times your mock methods were called.

---

## Example: Setting Expectations with Cardinalities

```cpp
using ::testing::AtLeast;
using ::testing::AtMost;
using ::testing::AnyNumber;
using ::testing::Exactly;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (), ());
};

TEST(MockFooTest, CallsWithCardinality) {
  MockFoo mock;

  // Expect Bar() called exactly once.
  EXPECT_CALL(mock, Bar()).Times(Exactly(1));
  mock.Bar();  // OK

  // Expect Bar() called at least twice.
  EXPECT_CALL(mock, Bar()).Times(AtLeast(2));
  mock.Bar();
  mock.Bar();  // OK

  // Expect Bar() called any number of times.
  EXPECT_CALL(mock, Bar()).Times(AnyNumber());
  mock.Bar();
  mock.Bar();
}
```

---

## Extending Cardinalities with Custom Implementations

GoogleMock lets you define your own cardinalities by implementing `CardinalityInterface`. This is useful when your test needs non-standard call count logic.

Example: A cardinality for even number of calls.

```cpp
class EvenCardinality : public testing::CardinalityInterface {
 public:
  bool IsSatisfiedByCallCount(int call_count) const override {
    return (call_count % 2) == 0;
  }

  bool IsSaturatedByCallCount(int /* call_count */) const override {
    return false;  // Never saturates
  }

  void DescribeTo(std::ostream* os) const override {
    *os << "called even number of times";
  }
};

// Factory function
testing::Cardinality EvenNumber() {
  return testing::MakeCardinality(new EvenCardinality);
}

// Usage example
EXPECT_CALL(mock, Foo()).Times(EvenNumber());
```

This lets you fully control the semantics and descriptions of your custom expectations.

---

## Best Practices and Tips

- **Be explicit when necessary:** Use cardinalities like `AtLeast` and `Between` to allow flexible ranges matching your use case.

- **Avoid overly strict expectations:** Using `Exactly(n)` can make tests brittle if implementation details change.

- **Use `AnyNumber()` sparingly:** It disables call count verification; use only when you accept any number of calls.

- **Combine with Actions:** Pair cardinalities with `WillOnce()` and `WillRepeatedly()` to customize mock method behavior.

- **Check for invalid cardinalities:** Provide positive and consistent bounds to avoid run-time failures.

- **Custom cardinalities:** Implement only when predefined ones do not fit your scenario.

- **Read error messages carefully:** Failure messages describe call counts in natural language (e.g., "called twice") to help you quickly identify issues.

---

## Troubleshooting

- **Test fails with unexpected call counts:** Verify that the `Times()` clause matches the expected calls.

- **Runtime errors on cardinality creation:** Check that negative numbers or invalid ranges are not passed.

- **Call count does not saturate when expected:** Understand the difference between `IsSatisfied`, `IsSaturated`, and upper bounds.

- **Use verbose output:** Use `--gmock_verbose=info` flag to observe detailed messages about expectation evaluations.

---

## Related Documentation

- [EXPECT_CALL and ON_CALL macros](api-reference/mocking-apis/expect-call-and-on-call)
- [Mock Actions](api-reference/matchers-and-actions/mock-actions)
- [Matchers Reference](api-reference/matchers-and-actions/argument-matchers)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)

---

Harness the full power of GoogleMock by mastering cardinalities to set precise expectations on your mocks and write tests that express exactly how your code interacts with dependencies.