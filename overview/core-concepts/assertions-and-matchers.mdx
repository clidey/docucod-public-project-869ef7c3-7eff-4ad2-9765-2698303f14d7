---
title: "Assertions and Matchers"
description: "Discover the rich assertion set provided by GoogleTest, covering everything from simple checks to powerful matchers for complex conditions. Gain clarity on how expressive assertions accelerate bug detection and reporting."
---

# Assertions and Matchers

GoogleTest provides a powerful, expressive set of assertions and matchers that allow you to precisely verify program behavior in your C++ tests. This documentation focuses on the rich assertion macros in GoogleTest and how to use them effectively, from simple validations to advanced predicate assertions and string or floating-point comparisons.

---

## Why Assertions and Matchers Matter

Assertions are the building blocks of any test in GoogleTest. They verify whether program states or values meet expected conditions. Matchers complement assertions by enabling flexible and readable checks on values, ranging from simple equality to complex property-based matching.

Using expressive assertions and matchers accelerates bug detection by providing clear, actionable failure messages that pinpoint the root causes of problems. They empower you to write tests that are both concise and easy to understand.

---

## Basic Assertions

GoogleTest offers a wide variety of assertion macros. They come in pairs:

- `EXPECT_*`: generate nonfatal failures, allowing the test function to continue.
- `ASSERT_*`: generate fatal failures and abort the current function.

**Example:**

```cpp
// Verify container sizes are equal
ASSERT_EQ(x.size(), y.size()) << "Vectors x and y differ in length";

for (int i = 0; i < x.size(); ++i) {
  EXPECT_EQ(x[i], y[i]) << "Vectors x and y differ at index " << i;
}
```

You can stream custom failure messages with `<<`. Wide strings and strings stream correctly, with wide strings automatically converted to UTF-8 for output.

### Common Assertions

- Boolean checks: `EXPECT_TRUE(condition)`, `EXPECT_FALSE(condition)`
- Equality: `EXPECT_EQ(val1, val2)`, `EXPECT_NE(val1, val2)`
- Relational: `EXPECT_LT`, `EXPECT_LE`, `EXPECT_GT`, `EXPECT_GE`
- String comparisons:
  - `EXPECT_STREQ(str1, str2)`: compare C strings by content
  - `EXPECT_STRNE(str1, str2)`: assert C strings differ
  - Case-insensitive variants: `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`
- Floating point:
  - `EXPECT_FLOAT_EQ(val1, val2)`, `EXPECT_DOUBLE_EQ(val1, val2)`: approximate equality with ULP tolerance
  - `EXPECT_NEAR(val1, val2, abs_error)`: absolute error bound
- Exception assertions: `EXPECT_THROW`, `EXPECT_NO_THROW`, `EXPECT_ANY_THROW`
- Death assertions for testing process termination (see separate documentation)

---

## Predicate Assertions for Complex Conditions

For verifying complex predicates that return a boolean or richer result, GoogleTest provides predicate assertion macros:

- `EXPECT_PRED1`, `EXPECT_PRED2`, ..., `EXPECT_PRED5`
- `ASSERT_PRED1`, ..., `ASSERT_PRED5`

These macros accept a predicate function or functor and up to 5 arguments to check. On failure, they provide clear messages showing the argument values.

**Example:**

```cpp
bool MutuallyPrime(int m, int n);  // User-defined predicate

EXPECT_PRED2(MutuallyPrime, 3, 4);  // Succeeds
EXPECT_PRED2(MutuallyPrime, 4, 6);  // Fails with informative message
```

### Predicate-Formatter Assertions

If you want full control over failure messages, use predicate-formatter macros:

- `EXPECT_PRED_FORMAT1`, ..., `EXPECT_PRED_FORMAT5`
- `ASSERT_PRED_FORMAT1`, ..., `ASSERT_PRED_FORMAT5`

Here, the predicate-formatter is a function or functor that, given the expressions and their values, returns a `testing::AssertionResult` object, which can carry detailed failure information.

**Example:**

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* m_expr, const char* n_expr, int m, int n) {
  if (MutuallyPrime(m, n))
    return testing::AssertionSuccess();

  return testing::AssertionFailure() << m_expr << " and " << n_expr
         << " are not mutually prime (" << m << " and " << n << ")";
}

EXPECT_PRED_FORMAT2(AssertMutuallyPrime, 3, 4);  // Succeeds
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, 4, 6);  // Prints detailed failure
```

---

## String Assertions

GoogleTest distinguishes C strings and `std::string` objects:

- Use `EXPECT_STREQ` and related assertions to compare C strings by contents.
- Use `EXPECT_EQ` to compare `std::string` objects and other types.

Wide string assertions exist as well, converting to UTF-8 for output on failure.

---

## Floating-Point Assertions

Due to floating-point rounding and representation, simple equality is unreliable.

GoogleTest provides specialized assertions:

- `EXPECT_FLOAT_EQ`, `ASSERT_FLOAT_EQ`: allow a tolerance of 4 ULPs.
- `EXPECT_DOUBLE_EQ`, `ASSERT_DOUBLE_EQ`: allow tolerance of 4 ULPs for doubles.
- `EXPECT_NEAR`, `ASSERT_NEAR`: check absolute error bounds explicitly.

These assertions generate helpful messages explaining differences and edge cases such as infinities and NaNs.

---

## Using gMock Matchers Within Assertions

Matchers provide expressive and composable ways to specify expected values or properties, making your assertions more flexible and readable.

Use `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)` to combine matchers with assertions.

**Example:**

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(container, ElementsAre(1, Gt(0), _, 5));
EXPECT_THAT(string_val, MatchesRegex("\d+"));
```

### Matcher Composition

Matchers can be combined with logical combinators like `AllOf()`, `AnyOf()`, and `Not()`. They are polymorphic and can match multiple types.

You can write custom matchers for domain-specific validation and get rich failure messages.

---

## Best Practices and Tips

- **Choose ASSERT_ or EXPECT_ carefully:** use `EXPECT_` to continue test after failure; use `ASSERT_` if failing means the test can't proceed safely.
- **Write custom failure messages:** Provide context to clarify assertion failures.
- **Use predicate assertions for complex conditions:** they produce clearer diagnostics.
- **Use matchers to improve readability:** match partial properties instead of exact equality when appropriate.
- **Be aware of argument evaluation:** Assertions evaluate arguments exactly once except in failures.
- **Prefer `nullptr` over `NULL` or `0` for pointers:** This avoids ambiguities.

---

## Common Pitfalls

- Using `ASSERT_*` in non-void functions causes compilation errors. Use `EXPECT_*` or refactor functions to `void` if you need fatal failures.
- Mixing `ASSERT_*` and `EXPECT_*` incorrectly may lead to tests aborting too early or not early enough.
- Using pointer equality assertions (`EXPECT_EQ` on pointers) when content equality is intendedâ€”use string assertions for C strings.
- Forgetting to specify types when using overloaded predicate functions in predicate assertions.

---

## Additional Resources

For a more in-depth guide on using assertions and matchers, and to explore advanced features like custom matchers, predicate-formatters, and floating-point assertion nuances, see:

- [Assertions Reference](reference/assertions.md)
- [GoogleTest Primer](docs/primer.md)
- [Advanced GoogleTest Topics](docs/advanced.md#predicates)
- [gMock Cookbook (Matchers)](docs/gmock_cook_book.md)

---

### Summary

This page outlined the rich assertion set provided by GoogleTest, covering basic assertions, predicate assertions for complex condition checks, string and floating-point assertions, and integration with gMock matchers for expressive tests. Understanding these assertions empowers you to write clear, maintainable, and informative tests that accelerate bug detection.

---

## Code Examples

### Simple Assertion

```cpp
EXPECT_EQ(result, expected) << "Detailed failure message";
```

### Predicate Assertion

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, value);
```

### Predicate-Formatter Assertion

```cpp
testing::AssertionResult IsEvenFormatted(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}
EXPECT_PRED_FORMAT1(IsEvenFormatted, value);
```

### Using Matchers

```cpp
EXPECT_THAT(container, ElementsAre(1, 2, 3));
EXPECT_THAT(string_value, StartsWith("prefix"));
```

---

## Troubleshooting

- If an assertion or predicate assertion fails, carefully examine the failure message. It typically includes the evaluated expressions and values.
- When using predicate assertions with overloaded functions, explicitly specify function template arguments or static casts to avoid compilation errors.
- Ensure nonvoid functions do not contain fatal assertions, or refactor accordingly.
- Wide string mismatches print UTF-8 converted strings for easier debugging.
- Use `GTEST_SKIP()` to skip tests with preconditions unmet without failure.

---

Embrace these powerful assertions and matchers to write tests that are expressive, precise, and give you deep insights into your code's correctness.
