---
title: "Extending with GoogleMock"
description: "Highlights the way GoogleTest and GoogleMock are seamlessly unified, letting users mock C++ classes and functions to facilitate advanced testing scenarios. Briefly orients the user to the capabilities of GoogleMock and links to key headers for deeper exploration."
---

# Extending with GoogleMock

## Unlock Advanced Testing by Mocking C++ Classes and Functions

GoogleTest and GoogleMock unite seamlessly, empowering C++ developers to create flexible and powerful tests by mocking classes and functions. This page introduces you to the capabilities of GoogleMock, showing how it extends GoogleTest to facilitate advanced testing scenarios where you control and verify interactions precisely.


### Why Use GoogleMock?

In complex C++ projects, writing tests that depend solely on real objects can be slow, fragile, or even infeasible. GoogleMock provides the ability to create *mock objects* that simulate behavior and interactions of real C++ classes or functions. You can specify:

- Which methods should be called,
- With what arguments,
- How many times,
- What values to return,
- And precisely verify these during test execution.

This approach accelerates test execution, isolates components under test, and improves test maintainability.

### What is GoogleMock?

GoogleMock is a C++ mocking framework integrated with GoogleTest. It uses declarative macros like `MOCK_METHOD` that let you effortlessly define mock classes by specifying the signatures of virtual functions to be mocked. Unlike hand-written mocks, GoogleMock auto-generates the implementation, saving time and avoiding errors.

You mock interactions rather than implementations, enabling interaction-based testing to ensure your code calls external dependencies correctly.

### Core Capabilities of GoogleMock

- **Mocking Virtual Methods:** Define mock classes by inheriting interfaces or concrete classes with virtual methods and specify mocked methods using the simple `MOCK_METHOD` macro.
- **Mocking Non-Virtual Methods:** Use advanced dependency injection by defining unrelated mock classes with matching signatures, and substitute using templates.
- **Handling Overloaded and Template Methods:** Naturally mock overloaded virtual functions or class templates without extra ceremony.
- **Mocking Private and Protected Methods:** Declare mock methods in the `public:` section even when overriding non-public base methods, enabling full visibility.
- **Control Mock Behavior:** Define expected call counts, argument matchers, return actions, or side effects in rich and readable syntax.
- **Manage Mock Strictness:** Use `NiceMock`, `NaggyMock`, or `StrictMock` wrappers to control how GoogleMock treats uninteresting or unexpected calls, balancing noise and rigor.
- **Mocking Free Functions:** Though direct mocking of free functions is not supported, you can abstract them into interfaces and mock the interfaces.
- **Delegation Patterns:** Delegate calls to fakes, real objects, or parent classes to combine mocking with real logic.

### Defining a Mock Class Example

```cpp
#include <gmock/gmock.h>

class MyInterface {
 public:
  virtual ~MyInterface() = default;
  virtual int DoWork(int a, double b) = 0;
  virtual void Reset() = 0;
};

class MockMyInterface : public MyInterface {
 public:
  MOCK_METHOD(int, DoWork, (int a, double b), (override));
  MOCK_METHOD(void, Reset, (), (override));
};
```

This mock class can immediately be used to set expectations and simulate behavior in tests.

### Handling Complex Arguments with Commas

Types like `std::pair<bool, int>` or complex template types with commas require using parentheses or type aliases in `MOCK_METHOD`:

```cpp
class MockFoo {
 public:
  using BoolInt = std::pair<bool, int>;
  MOCK_METHOD(BoolInt, GetPair, ());
};
```

### Mocking Overloaded Methods

Simply define mocks for each overload, and if you don't override all versions, use `using` to bring others into scope:

```cpp
class Base {
  virtual int Add(int x);
  virtual int Add(double y);
};

class MockBase : public Base {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  // We only mock int version.
  using Base::Add;
};
```

### Controlling Mock Object Behavior

GoogleMock distinguishes between *expectations* (`EXPECT_CALL`), which verify calls occur as specified, and *default actions* (`ON_CALL`), which specify what happens when calls occur without expectations.

You can specify:

- Actions to return values or side-effect.
- Call cardinalities (times called).
- Sequences and ordering.
- How strictly unexpected or uninteresting calls are treated.

### Managing Mock Strictness

GoogleMock provides wrappers to adjust warnings and failures for calls without expectations:

- **NaggyMock (default):** Warns on uninteresting calls.
- **NiceMock:** Suppresses these warnings, reducing noise in tests.
- **StrictMock:** Treats uninteresting calls as errors, enforcing strict verification.

Example:

```cpp
using ::testing::NiceMock;
NiceMock<MockMyInterface> mock;
EXPECT_CALL(mock, DoWork(5));
mock.DoWork(5); // Ok
mock.Reset(); // No warning
```

### Where to Start Next?

- Dive deeper into mocking syntax and patterns in the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).
- Explore detailed usage with matchers and actions in the [Reference Mocking API](https://google.github.io/googletest/reference/mocking.html).
- If you're new to mocking in C++, see [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for an easy start.

---

### Key GoogleMock Header Files

To start using GoogleMock, include the primary header:

```cpp
#include <gmock/gmock.h>
```

This includes everything you need for mocking classes, defining expectations, matchers, and actions.

For strictness control, include:

```cpp
#include <gmock/gmock-nice-strict.h>
```

These headers define `NiceMock`, `NaggyMock`, and `StrictMock`.


---

### Practical Tips & Best Practices

- Always place `MOCK_METHOD` macros in the `public:` section of your mock class, even if mocking non-public base methods.
- Use type aliases or parentheses to handle argument or return types with commas.
- Prefer defining clear expectations with `EXPECT_CALL` in your tests and use `ON_CALL` for default behavior.
- Use `NiceMock` during development to reduce distracting warnings, switch to `StrictMock` for strict verification.
- Avoid mocking concrete classes as much as possible; prefer coding to interfaces towards more maintainable tests.

---

### Common Pitfalls

- Calling mock methods without setting expectations leads to warnings or errors depending on strictness settings.
- `MOCK_METHOD` macro requires precise syntax; unprotected commas in arguments cause compilation failures.
- Mixing expectations after code execution results in undefined behavior. Always set expectations before exercising mocks.
- Not overriding all overloads can cause unexpected hiding; bring others into scope with `using`.

---

By mastering these techniques on this page, you enable your tests to model C++ interactions precisely, leading to faster, cleaner, and more robust test suites.
