---
title: "Integration with Build Systems"
description: "Explains how GoogleTest is integrated or consumed within typical C++ projects for a seamless developer experience. Covers support for major build tools like CMake and Bazel, and outlines the relevant entry points and files that facilitate integration."
---

# Integration with Build Systems

Seamlessly integrating GoogleTest into your C++ project unlocks efficient test discovery, compilation, and execution. This page guides you through the practical steps and best practices for consuming and building GoogleTest with popular build tools, ensuring a smooth developer experience.

---

## Why Integration Matters

GoogleTest isn't just a testing framework; its full power is realized through deep integration with your build system. Proper integration:

- Automates compilation and linking of test binaries
- Guarantees consistent compiler/linker flags across sources and tests
- Simplifies dependency management of GoogleTest and GoogleMock code
- Enables robust and maintainable CI pipelines for automated testing

Getting integration right saves you from frustrating build errors and manual work.

## Supported Build Tools

GoogleTest supports integration with several major build systems out of the box, including:

- **CMake** (recommended for cross-platform projects)
- **Bazel** (Google's own build system heavily used in large-scale C++ projects)

Effective integration involves adding GoogleTest (and optionally GoogleMock) as dependencies and handling compiler flags correctly.

---

## Building and Linking GoogleTest with CMake

GoogleTest provides ready-to-use CMake scripts that make integration straightforward.

### Standalone Build

For new projects or working standalone, follow these steps:

1. Clone the GoogleTest repository:

   ```bash
   git clone https://github.com/google/googletest.git -b main
   cd googletest
   mkdir build && cd build
   ```

2. Configure the build to include GoogleMock (default):

   ```bash
   cmake ..
   ```

   Or disable GoogleMock if you don't need it:

   ```bash
   cmake .. -DBUILD_GMOCK=OFF
   ```

3. Build the libraries:

   ```bash
   make  # or cmake --build . --config Release on Windows
   ```

4. Optionally install to system directories:

   ```bash
   sudo make install
   ```

### Incorporating GoogleTest into Your CMake Project

Instead of building GoogleTest separately, embed it directly in your project:

- Add GoogleTest as a subdirectory:

  ```cmake
  add_subdirectory(path/to/googletest)
  ```

- Link your test targets against `gtest` and `gmock` libraries:

  ```cmake
  target_link_libraries(your_test_target PRIVATE gtest gmock)
  ```

- Ensure to set C++17 or later standard:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

### Using FetchContent to Download GoogleTest at Configure Time

To avoid manual cloning, leverage `FetchContent` in your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests tests.cpp)
target_link_libraries(my_tests PRIVATE gtest gmock)
``` 

By doing so, GoogleTest is downloaded and built as part of your build process.

### Handling Compiler Runtimes on Windows

Be aware that GoogleTest links to the C runtime statically by default, which may clash with your projectâ€™s dynamic runtime. Set the CMake option:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This makes GoogleTest use shared runtimes and prevents linker errors.

---

## Integrating with Bazel

Projects using Bazel can add GoogleTest as a dependency by adding the following in their `WORKSPACE` file:

```starlark
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.zip"],
    strip_prefix = "googletest-release-1.17.0",
)
```

Then, in your `BUILD` files, include dependencies:

```starlark
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

This enables you to build and run GoogleTest-based tests via Bazel in one step.

---

## Important Entry Points and Files

- **Headers:**
  - The main header to include is `<gmock/gmock.h>`, which pulls in GoogleMock and GoogleTest foundational APIs.
  - For basic tests without mocking, include `<gtest/gtest.h>`.

- **Initialization:**
  - Call `testing::InitGoogleMock(&argc, argv);` once early in your `main()` to initialize GoogleTest and GoogleMock flags.

- **Build Scripts:**
  - `CMakeLists.txt` at the root of the googletest repo configures building of GoogleTest and GoogleMock.

- **Main Executable:**
  - `gmock_main.cc` provides a default `main()` implementation that initializes the framework and runs all tests - link against `gmock_main` to use this.

---

## Best Practices for Integration

- **Consistent Compiler Settings:** Ensure your project and GoogleTest use identical compiler versions, flags, and C++ standard settings to prevent ABI incompatibilities.

- **Use Subdirectory or FetchContent:** Embedding GoogleTest via add_subdirectory or FetchContent offers tighter integration and easier maintenance.

- **Prefer Static or Shared Linking Wisely:** Decide whether to link GoogleTest statically or as a shared library based on your deployment and test setup.

- **Isolate Test Targets:** Create dedicated executable targets for tests to manage dependencies cleanly.

- **Automate Test Execution:** Integrate `RUN_ALL_TESTS()` in your test executables and hook them in your CI/CD systems.

- **Update Regularly:** Keep GoogleTest updated to leverage latest bug fixes and features.

---

## Troubleshooting Common Integration Issues

- **Linker Errors:** Often caused by mismatches in runtime libraries or missing GoogleTest libraries in your link line.

- **Duplicate Symbols:** Ensure GoogleTest and GoogleMock are not built multiple times with different settings.

- **Compiler Version Mismatch:** Avoid mixing objects compiled with different compilers or compiler versions.

- **Undefined `main()` Function:** Either link against `gmock_main` or provide your own `main()` that calls `InitGoogleMock` and `RUN_ALL_TESTS()`.

- **GoogleMock Flags Not Parsed:** Ensure `InitGoogleMock()` is called before executing tests.

---

## Getting Started Preview

To begin integrating GoogleTest:

- Set up your project build scripts using CMake or Bazel as shown above.
- Include `<gtest/gtest.h>` or `<gmock/gmock.h>` as needed in your test sources.
- Call `InitGoogleMock()` in your `main()` or link against provided main.
- Link your test executables against the appropriate GoogleTest and GoogleMock libraries.

For detailed build system instructions, see [GoogleTest README](https://github.com/google/googletest/blob/main/README.md) and [Getting Started Guide](../getting-started/prerequisites-installation/installation-methods).

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [README.md in GoogleTest](https://github.com/google/googletest/blob/main/README.md)
- [GoogleTest Primer](../docs/primer.md)
- [Building GoogleTest with CMake](../googletest/README.md)
- [Mocking with GoogleMock](../docs/gmock_cheat_sheet.md)

---

This page is part of the broader documentation on integrating GoogleTest and GoogleMock, enabling you to adopt these robust frameworks in your projects with confidence and efficiency.
