---
title: "High-Level Architecture (with Diagram)"
description: "See a mermaid diagram depicting the architecture of GoogleTest and GoogleMock, illustrating the relationships between test code, core libraries, runner, and extension points. This visual helps users quickly orient themselves within the system."
---

# High-Level Architecture (with Diagram)

## Understanding the Architecture of GoogleTest and GoogleMock

To effectively leverage the power of GoogleTest and GoogleMock, it helps to visualize how the components fit together under the hood. This page presents a clear architectural diagram illustrating the main parts of the framework and their relationships, enabling you to grasp the flow of test execution, extensibility points, and how mocking integrates seamlessly with test running.

---

### Architecture Overview

GoogleTest and GoogleMock combine to provide a comprehensive C++ testing and mocking framework. At a high level, the architecture consists of:

- **Test Code**: Your C++ source code containing tests and mocks.
- **GoogleTest Core Library**: Provides test execution, assertions, fixtures, and discovery.
- **GoogleMock Extension**: Integrates with GoogleTest, enabling mock class creation, expectation setting, and behavior simulation.
- **Test Runner**: The executable that initiates test discovery, executes tests, and reports results.
- **Extension Points**: Customization interfaces that allow you to tailor behavior, such as adding new matchers or actions.

Understanding these interactions helps you write better tests, configure mocks correctly, and extend the framework for advanced use cases.

---

### Component Descriptions & Responsibilities

| Component                | Description & User Value                                   |
|--------------------------|-----------------------------------------------------------|
| **Test Code**            | Contains your test cases and mock class definitions. This is where you implement tests that verify your code behavior and set expectations on mocks to validate interactions. |
| **GoogleTest Core**      | Handles test registration, automatic discovery, execution flow, and assertion evaluation. It orchestrates running all tests and encapsulates useful test features like fixtures and parameterized tests. |
| **GoogleMock Framework** | Built on top of GoogleTest, it empowers you to create mock objects, define expectations, specify behaviors, and verify interactions with collaborators programmatically. |
| **Test Runner**          | The executable that runs your tests. It initializes the framework, triggers test execution, and collates and outputs the results including any mocking verification failures. |
| **Extension Points**     | User-customizable interfaces to add new matchers, actions, or other functionality to tailor the framework precisely to your testing needs. |

---

### How It All Works Together (User Flow)

1. **Write Tests and Mocks**
   - You write unit tests using GoogleTest and specify mocks with GoogleMock.
   - Define mock classes with `MOCK_METHOD` macros and set expectations using `EXPECT_CALL`.

2. **Compilation and Linking**
   - Core GoogleTest and GoogleMock libraries are linked into your test executable.
   - Your tests and mocks become discoverable through registration mechanisms.

3. **Test Discovery and Execution**
   - When you run the test executable, the test runner starts.
   - Tests are automatically discovered and executed in sequence.

4. **Mock Behavior and Verification**
   - As tests run, calls to mock methods check against expectations.
   - Unmatched or excessive calls generate immediate, detailed error feedback.
   - When the test finishes, GoogleMock verifies that all expectations are satisfied.

5. **Results Reporting**
   - Results including pass/fail status and diagnostic information are output.

---

### Mermaid Diagram of GoogleTest and GoogleMock Architecture

```mermaid
graph TD
  %% Subgraph for User Test Code
  subgraph "User Test Code"
    TC[Test Code (Tests & Mocks)]
  end

  %% Core Test Framework
  GTC["GoogleTest Core Library"]
  GMC["GoogleMock Extension"]
  TR[Test Runner]

  %% Extension Points
  EP["Extension Points (Custom Matchers, Actions)"]

  %% Relationships
  TC -->|Defines Tests & Mocks| GTC
  TC -->|Defines & Uses Mock Classes| GMC
  TR -->|Initializes & Runs| GTC
  TR -->|Initializes & Runs| GMC
  GTC -->|Orchestrates Test Discovery & Execution| TR
  GMC -->|Extends Behavior of| GTC
  GMC -->|Uses Extensions| EP
  GTC -->|Supports Extension| EP

  %% Output
  TR -->|Reports Test & Mock Results| User["Test Output"]
```

---

### Practical Benefits of Understanding This Architecture

- **Orientation**: Quickly situate components you're working with, from writing test code to observing results.
- **Debugging**: Know where to look when tests fail — test runner logs, GoogleMock expectation failures, or core test assertion errors.
- **Customization**: Recognize where and how you can introduce your own extensions via the extension points.
- **Integration Insight**: Appreciate how GoogleMock operates within GoogleTest rather than being a separate tool.

---

### Tips for Success

- Keep your mock class definitions close to the interfaces they mock to reduce maintenance.
- Use the automatic test registration and discovery system — avoid manual test lists.
- Prefer `ON_CALL` for default mock behaviors and reserve `EXPECT_CALL` for interactions you want to verify explicitly.
- Leverage extension points when standard matchers or actions don’t meet your needs.

---

### Next Steps

- Explore the [What is GoogleTest?](overview/introduction-value/what-is-googletest) page to grasp the fundamentals of the core test framework.
- Dive into [Introduction to Mocking](overview/core-concepts/mocking-basics) to understand mock class creation and usage.
- Review [Key Benefits](overview/introduction-value/value-proposition-key-benefits) for productivity and robustness advantages.


---

<Info>
This overview focuses strictly on the high-level architecture and relationships of GoogleTest and GoogleMock, mapping explicitly to components and workflow users interact with directly or indirectly. For detailed API usage or internal implementation, please refer to appropriate sections like the mocking guide or API Reference.
</Info>
