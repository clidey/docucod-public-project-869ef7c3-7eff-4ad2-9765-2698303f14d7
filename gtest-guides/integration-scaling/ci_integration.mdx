---
title: "Integrating with CI/CD Pipelines"
description: "Learn how to automate test execution using continuous integration systems. Get example scripts, recommended flags, and reporting strategies for quick feedback and reliability."
---

# Integrating with CI/CD Pipelines

Automating your GoogleTest and GoogleMock test execution in Continuous Integration / Continuous Deployment (CI/CD) pipelines accelerates feedback, enforces code quality gates, and guarantees reliable test results at every code change. This guide walks you through practical steps, example scripts, recommended flags, and reporting strategies to seamlessly embed your C++ tests into common CI systems.

---

## Workflow Overview

### What This Guide Helps You Achieve
Integrate GoogleTest and GoogleMock-based test binaries into automated build pipelines, enabling automatic execution, reliable test result capture, and actionable feedback in your CI/CD environment.

### Prerequisites
- A working C++ project with GoogleTest and/or GoogleMock tests compiled into executables.
- Basic familiarity with your CI/CD platform (e.g., Jenkins, GitHub Actions, GitLab CI).
- Access to the project repository and configuration ability of the CI pipeline.

### Expected Outcome
- Automated test runs triggered by code changes or scheduled events.
- Proper test output formats and logs consumable by CI for pass/fail analysis.
- Use of recommended test execution flags to optimize run stability and verbosity.

### Time Estimate
20-40 minutes depending on familiarity with your CI system and test setup complexity.

### Difficulty Level
Intermediate – requires basic understanding of CI pipelines and test build artifacts.

---

## Step-by-Step Instructions

### 1. Prepare Your Test Executables

Make sure your tests are built and produce runnable test binaries. Typically, these are executables linked against `gtest_main` or `gmock_main`, which supply a main function invoking `RUN_ALL_TESTS()`.

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

When built, your test binaries should:
- Accept command-line arguments to control test behavior.
- Return `0` if all tests pass, non-zero otherwise.

### 2. Select Suitable Test Execution Flags

Use GoogleTest flags to configure test runs for CI environments. Common flags include:

| Flag                         | Purpose                                                                               |
|------------------------------|---------------------------------------------------------------------------------------|
| `--gtest_output=xml:<file>`  | Produces an XML report consumable by CI tools (e.g., JUnit format).                    |
| `--gtest_color=no`           | Disables colored output which may interfere with CI log parsers.                     |
| `--gtest_break_on_failure`   | Optionally break on failures to facilitate interactive debugging (use carefully).    |
| `--gtest_repeat=N`           | Repeat test runs N times to detect flaky tests (optional).                           |

**Example:**

```bash
./my_tests --gtest_output=xml:report.xml --gtest_color=no
```

This command runs your tests, disables colors for console output clarity, and dumps a detailed JUnit-compatible XML report to `report.xml`.

### 3. Integrate Test Commands in Your CI Pipeline

Add steps in your CI configuration scripts to build and run tests. Example snippets for popular CI systems:

#### Jenkins Pipeline (Declarative):
```groovy
pipeline {
  agent any

  stages {
    stage('Build') {
      steps {
        sh 'cmake --build build'
      }
    }

    stage('Test') {
      steps {
        sh './build/my_tests --gtest_output=xml:report.xml --gtest_color=no'
      }
      post {
        always {
          junit 'report.xml'
        }
      }
    }
  }
}
```

#### GitHub Actions Workflow (YAML):
```yaml
name: Run Tests

on: [push, pull_request]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Build
      run: |
        mkdir -p build
        cd build
        cmake ..
        make

    - name: Run Tests
      run: ./build/my_tests --gtest_output=xml:report.xml --gtest_color=no

    - name: Upload Test Results
      uses: actions/upload-artifact@v3
      with:
        name: test-results
        path: report.xml
```

Adjust paths and command-line flags according to your build and test setup.

### 4. Configure Test Result Reporting and Alerts

Most CI systems recognize the JUnit XML reports produced by `--gtest_output` flags and can present test results graphically. Configure these in your pipeline to:
- Display pass/fail counts and summary.
- Highlight failed tests with stack traces.
- Trigger notifications or block merges on failures.

### 5. Optimize Test Stability in CI Context

Implement best practices to avoid flaky tests and enhance usability:
- Run tests with `--gtest_repeat` if prone to intermittent failures.
- Use `--gtest_shuffle` to randomize test execution order and detect test dependencies.
- Limit output verbosity with `--gtest_filter` to run only relevant tests.

Example:
```bash
./my_tests --gtest_output=xml:report.xml --gtest_repeat=3 --gtest_shuffle --gtest_color=no
```

---

## Example: Running GoogleTest with XML Output in a Shell Script

Create a shell script `run_tests.sh`:

```bash
#!/bin/bash

set -e

BUILD_DIR=build
TEST_BINARY=$BUILD_DIR/my_tests

if [ ! -f "$TEST_BINARY" ]; then
  echo "Test executable not found. Please build first."
  exit 1
fi

# Run tests with XML output for CI
$TEST_BINARY --gtest_output=xml:report.xml --gtest_color=no

# The exit status will convey success or failure
```

Make it executable:

```bash
chmod +x run_tests.sh
```

Invoke this script from your CI pipeline as the test execution step.

---

## Troubleshooting & Tips

### Common Issues

- **Tests do not run or report failures correctly:** Ensure tests return the exit code from `RUN_ALL_TESTS()`. Linking with `gtest_main` or `gmock_main` provides a valid `main()`.
- **XML report not generated or empty:** Confirm the `--gtest_output=xml:<file>` flag is passed and your working directory allows file creation.
- **Color codes pollute CI logs:** Use `--gtest_color=no` to disable terminal color output.
- **Build or linking errors:** Verify correct linking against `gtest` and `gmock` libraries and matching `gmock_main` or `gtest_main` when using the main function provided by Google Test/Mock.

### Best Practices

- Always capture XML reports for CI integration to leverage your CI system’s reporting.
- Use filtering (`--gtest_filter`) to selectively run tests when troubleshooting.
- Make builds and tests reproducible by fixing seeds and randomization settings if needed.
- Automate test failure notifications in the CI platform for fast feedback.

### Performance Considerations

- Parallelize test execution by splitting test binaries or using test sharding if supported by your CI environment.
- Avoid unnecessary rebuilding during continuous integration by caching dependencies and build artifacts.

---

## Next Steps & Related Content

- Explore the [Building and Running Tests Guide](/gtest-guides/getting-started/build_and_run) for comprehensive build pipeline integration.
- Learn about advanced [Optimizing Test Performance](/gtest-guides/integration-scaling/optimizing_tests) to speed up your CI runs.
- Read the [Test Execution & Flags Reference](/api-reference/core-apis/running-tests) for complete options.
- See the [Adding Mocks to Your Tests Guide](/gtest-guides/getting-started/adding_mocks) to combine efficient testing with dependency mocking.

---