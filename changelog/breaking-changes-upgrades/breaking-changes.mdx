---
title: "Breaking Changes & Migrations"
description: "Identify key breaking changes in each release, with migration instructions and context to minimize the risk of disruption. Explains rationale behind significant shifts and provides actionable advice for updating tests and integrations."
---

# Breaking Changes & Migrations

This page serves as your essential guide to identifying and navigating the key breaking changes across GoogleTest and GoogleMock releases. It explains critical shifts in behavior or APIs, reasons behind these updates, and equips you with actionable steps to migrate your tests and integrations effectively.

---

## Understanding Breaking Changes

When a breaking change occurs in GoogleTest or GoogleMock, it means that existing code relying on previous behavior may stop compiling, run incorrectly, or produce different results. This page helps minimize disruption by detailing these changes and the rationale behind them, enabling you to update your tests confidently.

Breaking changes often arise due to improvements in correctness, safety, or to support new C++ standards (minimum C++17 for recent versions).

---

## Migration Strategies

To smoothly adapt to breaking changes, follow these steps:

1. **Review Release Notes Thoroughly**: Start by reading the detailed release notes for your target version. Review the list of breaking changes and deprecated APIs.

2. **Audit Your Mock and Test Code**: Identify locations where your code relies on affected APIs or behaviors.

3. **Update Mock Definitions and Expectation Syntax**: For Mock classes, ensure all `MOCK_METHOD` usages align with the updated syntax, especially if you previously used older macros (`MOCK_METHODn`). Wrap complex types with parentheses or use type aliases to avoid parsing issues.

4. **Adjust Strictness and Default Behaviors**: Changes to uninteresting call handling or default mock behaviors may affect warnings or test failures. Use `NiceMock` or `StrictMock` wrappers judiciously, and apply `.Times(AnyNumber())` where necessary to express allowed calls without strict expectations.

5. **Refactor to Leverage New Features**: Consider migrating to new idiomatic patterns like enhanced matchers, actions, and hook usage where possible, taking advantage of improved interfaces.

6. **Run Tests with Verbose Mock Output**: Employ the `--gmock_verbose=info` flag during testing to get detailed diagnostics on mock calls, expectations, and mismatches.

7. **Iterate and Validate**: Gradually apply changes and verify each step with your test suites to isolate problems efficiently.

---

## Key Breaking Changes to Know

### 1. Transition to `MOCK_METHOD` Macro

Older GoogleMock versions used a family of macros like `MOCK_METHOD0`, `MOCK_CONST_METHOD1` to define mocks. The newer, unified `MOCK_METHOD` macro replaces these:

- Syntax changed from `MOCK_METHOD1(Foo, bool(int))` to `MOCK_METHOD(bool, Foo, (int))`.
- Constness, noexcept, and other qualifiers are now specified explicitly in an optional specs parameter.
- Wrapping argument or return types containing commas (e.g., `std::pair`, `std::map`) in parentheses or using type aliases is required.

**Migration tips:**

- Prefer the new `MOCK_METHOD` macro for clearer, more flexible definitions.
- Example migration:
  ```cpp
  // Old style
  MOCK_CONST_METHOD1(Foo, bool(int));

  // New style
  MOCK_METHOD(bool, Foo, (int), (const));
  ```

- Use type aliases or parentheses for complex types:
  ```cpp
  using PairBoolInt = std::pair<bool, int>;
  MOCK_METHOD(PairBoolInt, GetPair, ());
  // Or
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  ```

### 2. Changes to Mock Object Strictness and Uninteresting Calls

By default, mocks generate warnings on uninteresting calls — calls without `EXPECT_CALL`. In recent updates:

- The default verbosity and behavior of mocks around uninteresting calls may differ.
- Use `NiceMock<T>` to suppress uninteresting call warnings.
- Use `StrictMock<T>` to treat uninteresting calls as errors.
- Explicitly opt into ignored calls by attaching `.Times(AnyNumber())` to an expectation.

**Migration tips:**

- Audit your tests for warnings that may now be errors.
- Wrap mocks with `NiceMock` if you want to silence noise without losing verification.
- When upgrading, run tests with `--gmock_verbose=info` to fully understand call matching.

### 3. Changes in Default Actions and Expectation Ordering

GoogleMock now ensures:

- The last declared `EXPECT_CALL` that matches a call takes precedence.
- Actions declared in `ON_CALL` are overridden by actions declared in `EXPECT_CALL`.
- Sequence and ordering clauses (`InSequence`, `After`) strictly enforce call order.

**Migration tips:**

- Confirm that expectations are declared in the correct order to reflect desired call precedence.
- Use `Sequence` objects or `InSequence` scopes for enforcing call order and dependencies.
- Prefer `After()` clauses to express complex partial orderings when required.

### 4. Minimum Compiler and C++ Standard Requirements

- GoogleTest and GoogleMock now require _at least C++17_ for building and running.
- Older compilers or C++ standards are no longer supported.

**Migration tips:**

- Ensure your build environment uses a C++17-compliant compiler.
- Update your build configurations (CMake, Bazel, etc.) to specify `-std=c++17` or later.

### 5. Initialization Flags Parsing Behavior

- `InitGoogleMock()` now removes recognized GoogleMock flags (e.g., `--gmock_verbose`) from argv.
- Unrecognized flags remain intact.
- This behavior helps prevent conflicts and simplifies argument parsing.

**Migration tips:**

- Adapt your test runners if they parse `argv` manually.
- Use the `GMOCK_FLAG_GET` macros to programmatically access flag values.

---

## Common Pitfalls & Troubleshooting

<Tip>
**Using `MOCK_METHOD` with types containing commas:** Always use parentheses or type aliases for return or argument types containing commas to avoid confusing macro parsing.
</Tip>

<Tip>
**Verbose output for debugging:** Use `--gmock_verbose=info` to see detailed logs on calls, matched expectations, and reasons for mismatches.
</Tip>

<Warning>
**Uninteresting calls warnings/errors:** Switching from NaggyMock (default) to StrictMock may cause previously passing tests to fail. Suppress noise with `NiceMock` or explicitly allow uninteresting calls.
</Warning>

<Note>
**Destructor mocking:** You cannot mock destructors directly. Use a dummy mock method (e.g., `Die()`) called in the destructor for testing destruction order.
</Note>

---

## Practical Migration Example

Convert this old Mock class:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_CONST_METHOD1(Bar, bool(int arg));
};
```

to the new style:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Bar, (int arg), (const, override));
};
```

Ensure:

- The method qualifiers (`const`, `override`) are specified explicitly.
- Use consistent naming and style.

Then check usage of mocks with `EXPECT_CALL`, replacing deprecated constructs and ensuring order and cardinality are explicitly defined according to the new recommendations.

---

## Additional Resources

- [GoogleMock Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — comprehensive guide to mock definitions and expectations.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — practical recipes for using mocks effectively.
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — start here for foundational knowledge.
- [Breaking Changes & Upgrade Guides](./upgrade-guides) — further migration instructions.

---

## Summary

This page helps you identify and manage breaking changes in GoogleTest and GoogleMock releases by providing clear migration paths, rationale for changes, and practical user guidance to keep your test suites reliable and maintainable.

Remember, frequent consultation of release notes, combined with running tests in verbose mode, will greatly ease your migration journey.

---

## Troubleshooting

<AccordionGroup title="Common Issues During Migration">
<Accordion title="Unrecognized mock macro errors">
Make sure your mocks use the new `MOCK_METHOD` macro syntax. Replace any old `MOCK_METHODn` macros.
</Accordion>
<Accordion title="Unexpected 'Uninteresting mock function call' warnings">
Use `NiceMock` wrapper or explicitly add `.Times(AnyNumber())` for calls you want to ignore.
</Accordion>
<Accordion title="Compilation errors with commas in template types">
Wrap the return or argument types containing commas within parentheses, or use type aliases.
</Accordion>
<Accordion title="Tests failing due to call order mismatch">
Use `Sequence` objects or `InSequence` to express call order dependencies explicitly.
</Accordion>
</AccordionGroup>

---

## Code Example: Adjusting to New `MOCK_METHOD` Syntax

```cpp
#include <gmock/gmock.h>

class MockDatabase {
 public:
  // Old style (deprecated)
  // MOCK_METHOD1(GetUser, User(int id));

  // New style
  MOCK_METHOD(User, GetUser, (int id), (override));

  // If method is const
  MOCK_METHOD(bool, IsConnected, (), (const, override));
};
```

```cpp
using ::testing::Return;

TEST(MockDatabaseTest, GetUserReturnsExpectedValue) {
  MockDatabase mock_db;
  User expected_user;

  EXPECT_CALL(mock_db, GetUser(5))
      .WillOnce(Return(expected_user));

  User user = mock_db.GetUser(5);
  EXPECT_EQ(user, expected_user);
}
```

---

## Summary Table of Common Breaking Changes

| Breaking Change                         | Impact                                   | Recommended Action                         |
|---------------------------------------|------------------------------------------|-------------------------------------------|
| Old MOCK_METHODn macros deprecated    | Compile errors or warnings                | Use `MOCK_METHOD` with explicit qualifiers |
| Strictness mode changes                | Tests with uninteresting calls fail      | Use `NiceMock` or add `.Times(AnyNumber())`|
| Minimum C++17 required                 | Build failures with older compilers      | Update compiler and build configuration   |
| Flag parsing in InitGoogleMock changed| Arguments removed after parsing           | Adjust test runners if parsing argv manually|
| Call order enforcement enhanced       | Tests fail with call order mismatches    | Add sequences and `InSequence` where needed|

---

For questions or help with migrating, visit [Where to Get Help](../../faq/community-resources-and-support/where-to-get-help.md) or consult the official GitHub repository issues.
