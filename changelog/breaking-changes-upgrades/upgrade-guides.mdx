---
title: "Upgrade Guides"
description: "Scenario-based guides for upgrading from one major version to the next. Covers code examples, environment prerequisites (like C++17 changes), and troubleshooting tips to ensure a seamless upgrade experience."
---

# Upgrade Guides

Scenario-based guides for upgrading from one major version of GoogleTest to the next. These guides are designed to walk you through the key steps, code changes, environment requirements, and troubleshooting strategies you need to ensure a smooth transition and preserve test reliability.

---

## 1. Why Upgrade? Understanding the Value

Upgrading GoogleTest between major versions is essential to benefit from improved test framework capabilities, increased compatibility with modern C++ standards, and resolved issues that impact your testing workflow. These guides help you manage the upgrade process with confidence, minimizing downtime and exposure to breaking changes.

Key reasons to upgrade include:

- **Access to new features** such as enhanced test macros, improved mocking support, and extended assertions.
- **Compliance with required environment** updates like mandating C++17 standard support.
- **Adaptation to breaking changes** like API adjustments or test registration improvements that ensure your tests run reliably.

---

## 2. Preparing Your Environment

Before beginning the upgrade:

- **Verify compiler support for C++17 or later**, as recent GoogleTest versions mandate this standard. Most modern compilers support it, but ensure your build environment includes:
  - GCC 7.1 or later
  - Clang 6.0 or later
  - MSVC 2017 Update 3 or later

- **Update your build tooling** to match recommendations:
  - Use CMake 3.14+ to enable seamless integration with GoogleTest's `FetchContent` capabilities.
  - Confirm your build system accepts `-std=c++17` or equivalent flags.

- **Check third-party dependencies or custom build setups** for any compatibility hurdles.

---

## 3. Key Upgrade Steps and Code Examples

This section walks through common upgrade scenarios, illustrating necessary code modifications and build configurations.

### 3.1 Transitioning to C++17

Ensure you specify the C++ standard explicitly in your CMake or build setup. For CMake projects:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

If this is not possible in your project (e.g., legacy C code base), add the standard via compiler flags:

```bash
-DCMAKE_CXX_FLAGS='-std=c++17'
```

This change is non-negotiable as GoogleTest 1.17.x and later depend on C++17 language features for core functionality.

### 3.2 Using GoogleTest as a Subdirectory with FetchContent

GoogleTest now supports fetching its source as part of your build seamlessly.

In your `CMakeLists.txt`, add:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows dynamic runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(your_test_exe test.cpp)
target_link_libraries(your_test_exe gtest_main)
add_test(NAME your_test COMMAND your_test_exe)
```

This updates your build to use the latest recommended method without the need to manually clone or embed GoogleTest.

### 3.3 Migrating from Legacy Mock Macro to `MOCK_METHOD`

Prior major releases replaced all older mocking macros with the unified `MOCK_METHOD` macro. Ensure your mocks are updated accordingly.

Example before upgrade:

```cpp
MOCK_METHOD0(Foo, void());
```

Example after upgrade:

```cpp
MOCK_METHOD(void, Foo, (), ());
```

Failure to update may result in deprecation warnings or compilation errors.

### 3.4 Handling Runtime Library Mismatch on Windows

If you encounter linker errors related to conflicting runtimes (e.g., `MTd_StaticDebug` vs `MDd_DynamicDebug`), add the following line to your CMake configuration:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This forces GoogleTest to link against the dynamic runtime libraries, aligning with your application's settings.

---

## 4. Troubleshooting Common Issues

### 4.1 Build Failures Due to Missing C++17 Support

Symptoms:
- Compiler errors about unavailable features or syntax errors.

Resolution:
- Confirm compiler version and flags.
- Explicitly set standard in CMake.

### 4.2 Test Failures After Upgrade Related to Mock Behavior

Symptoms:
- Unexpected failures or no longer honored expectations in mocks.

Resolution:
- Verify updated use of `MOCK_METHOD` macros.
- Check strictness mode changesâ€”adjust mocks to handle uninteresting calls explicitly.
- Enable verbose mock output during troubleshooting.

### 4.3 Runtime Errors on Windows Related to DLL and Runtime Library Linking

Symptoms:
- Linker errors regarding runtime library mismatch.

Resolution:
- Use `gtest_force_shared_crt` CMake option.
- Align your project's runtime library settings with GoogleTest.

---

## 5. Best Practices for Smooth Upgrades

- **Start by updating your build environment** to meet prerequisites before changing test code.
- **Test your entire test suite after upgrade in an isolated environment** to catch regressions early.
- **Use Google's recommended CMake FetchContent method** to incorporate GoogleTest, ensuring you always get compatible versions.
- **Incrementally migrate deprecated syntax** with automated tooling or scripts where applicable.
- **Monitor and update mocking strategies** especially related to expectations and call orders.
- **Consult official upgrade notes for any breaking changes** that may affect your use case.

---

## 6. Further Assistance and Resources

- Review the comprehensive [Breaking Changes & Migrations](https://github.com/google/googletest/blob/main/docs/changelog/breaking-changes.md) for detailed notes on major transitions.
- Consult the [Version Timeline & Release Notes](https://github.com/google/googletest/releases) to track feature introductions and bug fixes.
- Use the [GoogleTest Primer](https://google.github.io/googletest/primer.html) to familiarize yourself with modern best practices.
- For build system related queries, refer to the [Build System Integration Guide](../../guides/integration_and_effectiveness/build_system_integration.md).

---

## Appendix: Example Upgrade Workflow

<Steps>
<Step title="Backup Your Current Tests">
Ensure your test code and build system configurations are safely backed up or committed to version control.
</Step>
<Step title="Update Build Environment">
Upgrade your compiler and build tools to versions supporting C++17, update CMake to 3.14 or later.
</Step>
<Step title="Adjust Build Scripts">
Incorporate CMake FetchContent for GoogleTest or upgrade your existing GoogleTest source integration.
</Step>
<Step title="Refactor Mock Macros">
Change all legacy mock macros to the new `MOCK_METHOD` format as needed.
</Step>
<Step title="Compile and Run Tests">
Rebuild your tests and run them fully to identify any failures arising due to the upgrade.
</Step>
<Step title="Fix Identified Issues">
Use logs and verbose output to fix mock strictness issues or runtime configuration mismatches.
</Step>
<Step title="Confirm and Document">
Verify all tests pass, then document the upgrade and update your project's dependencies.
</Step>
</Steps>

---

These Upgrade Guides serve as your trusted companion to navigate the transition between major GoogleTest versions with clarity and confidence. Align your projects with the best-supported environments and practices to leverage the full power of GoogleTest's latest advancements.


[GoogleTest Primer](https://google.github.io/googletest/primer.html) | [Breaking Changes & Migrations](https://github.com/google/googletest/blob/main/docs/changelog/breaking-changes.md) | [Build System Integration Guide](../../guides/integration_and_effectiveness/build_system_integration.md) | [Version Timeline & Release Notes](https://github.com/google/googletest/releases)