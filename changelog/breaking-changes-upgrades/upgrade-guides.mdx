---
title: "Upgrade Guides"
description: "Step-by-step instructions, practical tips, and best practices to guide users through upgrading to major new versions. This page covers actions needed for changes in build systems, APIs, and runtime behavior, referencing relevant configuration files and entry points to streamline and de-risk the upgrade process."
---

# Upgrade Guides

This page provides clear, step-by-step instructions designed to help you navigate major version upgrades of GoogleTest. It focuses on changes that directly impact your build setup, API use, and runtime behavior, making upgrading safer and more predictable.

---

## Understanding the Upgrade Journey

Upgrading between major versions in GoogleTest can involve updates to build systems like CMake or Bazel, modifications to API calls, and adjustments to runtime initialization and configuration. This guide walks you through these essential actions, referencing key configuration files and entry points, so you can smoothly transition your projects to newer versions.

> **Why follow these guides?**
>
> Major version upgrades often introduce improved features and fixes but also bring breaking changes. This guidance helps you avoid common pitfalls and minimize disruptions.

---

## 1. Preparing Your Build Environment

Your project’s build system is the foundation for using GoogleTest effectively. Major upgrades may change the way GoogleTest integrates with CMake or Bazel.

### Key Actions:

- **Review and update CMakeLists.txt or Bazel BUILD files.**
  - For CMake, ensure you link against the appropriate GoogleTest targets and verify compiler and C++ standard settings meet the version’s requirements.
  - For Bazel, update dependencies and rules as needed to align with new GoogleTest releases.

- **Verify compatibility:**
  - Confirm your toolchain supports the minimum required C++ standard (C++17 or higher for recent versions).
  - Check for any deprecated or removed build options that the new version no longer supports.

### Practical Tips:

- Use the GoogleTest’s provided CMake targets (`gtest`, `gtest_main`, `gmock`, `gmock_main`) rather than manually specifying source files.
- Take advantage of bundled GoogleMock integration if your tests use mocks.

### Common Pitfalls:

- Neglecting to update your compiler or failing to specify the required C++ standard can cause build errors.
- Mixing old and new build configurations may lead to unexpected linkage or symbol conflicts.

---

## 2. Adapting to API Changes

Between major versions, GoogleTest may introduce changes in API signatures, naming, or behavior to improve the testing experience.

### Essential Considerations:

- **Initialization Entrypoints:**
  - The primary initialization function remains `InitGoogleTest()`. Confirm your `main()` function calls this correctly and returns `RUN_ALL_TESTS()`.

- **Macros and Test Fixtures:**
  - Validate that your use of assertions, parameterized tests, and typed tests aligns with updated macro definitions and usage patterns.

- **GoogleMock Integration:**
  - If combining with GoogleMock, ensure mock method declarations use the newer `MOCK_METHOD` syntax where applicable.
  - Review changes in expectation setting and action specification (e.g., usage of `EXPECT_CALL`, `ON_CALL`, and actions such as `Return`, `Invoke`, and `DoAll`).

### Actionable Steps:

- Examine your mock classes for any deprecated `MOCK_METHODn` macros and migrate to the modern `MOCK_METHOD` macro format, handling qualifiers like `const` and `override` explicitly.
- When upgrading tests with complex mocking setups, re-verify the default behaviors and expectation sequences, as changes in the internal mock engine may affect invocation ordering and call verification.
- Update test fixtures and parameterized test patterns to conform to the latest recommendations.

### Practical Tips:

- Prefer using `ON_CALL` to define default mock behaviors and reserve `EXPECT_CALL` for actual verification.
- Use `NiceMock` and `StrictMock` wrappers thoughtfully to control test verbosity and strictness.

### Common Problems:

- Ignoring the necessary migration from old mocking macros can cause compilation failures.
- Over-constraining expectations leads to brittle tests; relax using sequences or cardinalities where appropriate.

---

## 3. Adjusting Runtime Behavior and Configuration

Runtime behavior in GoogleTest influences test execution order, output formatting, parallelism, filtering, and more.

### Upgrade-Related Updates:

- Review command-line flag usage and environment variables for test filtering, sharding, and output reporting to ensure they are supported and behave as expected.
- Check for changes to default verbosity or output formats in test runners.
- If integrating GoogleTest into a larger CI/CD pipeline, verify that the test executables comply with updated initialization protocols and flag parsing.

### How To Proceed:

- Use `InitGoogleTest()` properly in your main entry points, especially when embedding your tests in other frameworks or platforms.
- Confirm your test binaries link correctly against `gtest_main` or implement compatible `main()` functions.
- Update your test execution scripts or build definitions to reflect any changes in flag names or accepted ranges.

### Troubleshooting:

- Unexpected results or no tests run? Double-check initialization and filtering options.
- Test failure reporting looks different or less verbose? Adjust verbosity flags accordingly.

---

## 4. Reference Configurations and Entry Points

Maintaining key configuration files and entry points is critical for seamless upgrades.

### Files to Review:

- **Build files:** `CMakeLists.txt`, `BUILD.bazel`
- **Test runner entry:** `main()` source files
- **Mock definitions:** Header files containing mock classes

### Recommendations:

- Keep your mock classes and test fixtures organized and up-to-date to reduce maintenance overhead.
- Prefer separating mock definitions into dedicated files when mocking third-party interfaces.
- Centralize your test entry points to uniformly manage initialization and shutdown.

---

## 5. Additional Resources

To successfully upgrade, consider consulting these key resources:

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — for foundational test writing and concepts
- [Mocking Reference](../changelog/feature-bug-log/new-features) — details of GoogleMock APIs and macros
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — practical techniques and troubleshooting for mocks
- [Breaking Changes & Deprecations](../changelog/breaking-changes-upgrades/breaking-changes) — specific breaking changes in recent versions
- [Detailed Release Notes](../changelog/release-history/detailed-release-notes) — for in-depth change logs

---

## Troubleshooting Common Upgrade Issues

- **Build errors related to `MOCK_METHOD` macros:**
  - Wrap complex template or type-return values in parentheses or introduce type aliases.

- **Unexpected warnings for uninteresting mock calls:**
  - Use `NiceMock` wrappers or add catch-all expectations with `EXPECT_CALL(...).Times(AnyNumber())`.

- **Linker errors with test executables:**
  - Verify linking against `gtest_main` or confirm the correct `main()` function implementation.

- **Tests silently skip or do not execute:**
  - Double-check filtering flags and ensure `RunAllTests()` is called in `main()`.

- **Unexpected test ordering or failures due to sequencing:**
  - Use `InSequence` or explicit `Sequence` objects to control call order expectations.

---

## Summary

Upgrading major versions of GoogleTest requires careful attention to build system changes, API migrations—especially around mock definitions—and updated runtime initialization. By following the detailed steps here, consulting configuration files, and leveraging GoogleTest’s initialization patterns, users can ensure smooth, error-free upgrades while maintaining confidence in their project's testing quality.
