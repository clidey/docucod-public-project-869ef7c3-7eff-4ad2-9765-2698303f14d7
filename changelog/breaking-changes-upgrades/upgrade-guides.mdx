---
title: "Upgrade Guides and Migration Tips"
description: "Actionable guidance for upgrading to major GoogleTest versions. Includes practical migration steps, backwards compatibility notices, and known challenges to help users adapt their tests with minimal friction."
---

# Upgrade Guides and Migration Tips

GoogleTest evolves continuously, introducing improvements, enhancements, and at times, changes that require adapting existing test suites. This page provides actionable, user-focused guidance to smoothly upgrade your GoogleTest and GoogleMock usage across major releases. Whether migrating between major versions or integrating new features, these insights aim to minimize friction and ensure that your tests remain robust and maintainable.

---

## 1. Understanding the Upgrade Landscape

GoogleTest adheres to semantic versioning principles, with occasional breaking changes introduced in major releases and best-effort backward compatibility maintained for minor and patch versions. While most upgrades are seamless, certain API and behavior modifications require proactive migration steps.

Keep the following in mind:

- **Breaking changes**: These commonly relate to macro updates (`MOCK_METHOD` syntax changes), mock behavior defaults, or usage patterns now enforced.
- **Deprecations**: Some features or macros may be deprecated in minor versions and removed in subsequent majors.
- **Behavior changes**: Improvements in mock object behavior modes or default actions that might impact test pass/fail results.

We recommend reviewing release notes carefully to identify changes that affect your codebase.

---

## 2. Transitioning to the Modern MOCK_METHOD Macro

### Background

In 2018, GoogleTest introduced a unified `MOCK_METHOD` macro replacing the older set of macros named `MOCK_METHODn`. This modern macro improves clarity, reduces boilerplate, and supports method qualifiers such as `const`, `noexcept`, and calling conventions.

### Migration Steps

1. **Identify all usages of `MOCK_METHODn` and `MOCK_CONST_METHODn` macros.**
2. **Replace them with `MOCK_METHOD` using the following pattern:**
   ```cpp
   // Old style
   MOCK_METHOD1(Foo, void(int));
   MOCK_CONST_METHOD2(Bar, int(int, double));

   // New style
   MOCK_METHOD(void, Foo, (int));
   MOCK_METHOD(int, Bar, (int, double), (const));
   ```
3. **Wrap argument or return types containing commas with extra parentheses or typedefs:**
   ```cpp
   // Wrap return type
   MOCK_METHOD((std::pair<int, int>), GetPair, ());

   // Or use typedef for readability
   using Pair = std::pair<int, int>;
   MOCK_METHOD(Pair, GetPair, ());
   ```
4. **Add qualifiers like `override`, `noexcept`, or reference qualifiers as needed:**
   ```cpp
   MOCK_METHOD(int, Foo, (double), (const, override));
   MOCK_METHOD(void, Bar, (), (noexcept, override));
   ```
5. **Ensure all `MOCK_METHOD` declarations are in the `public:` section of your mock class, regardless of the base methodâ€™s access level.**

### Important Notes

- The new `MOCK_METHOD` macro must be used in all modern GoogleTest versions from 1.10.0 onwards.
- Retain `MOCK_METHODn` macros only if you cannot upgrade your compiler or reuse legacy code with older GoogleTest releases.

For detailed usage, see the [MOCK_METHOD macro reference](https://google.github.io/googletest/reference/mocking.html#MOCK_METHOD).

---

## 3. Adapting to Mock Class Behavior Modes: NiceMock, NaggyMock, and StrictMock

GoogleMock supports controlling how uninteresting mock method calls are treated via behavior modes:

- **NaggyMock (default)**: Prints warnings on uninteresting calls.
- **NiceMock**: Suppresses warnings for uninteresting calls.
- **StrictMock**: Treats uninteresting calls as test failures.

### Migration Advice

- Actively choose the appropriate behavior mode for your mocks to reduce noise and maintain test strictness.
- Convert frequently noisy mocks to `NiceMock` to suppress unnecessary warnings.
- Use `StrictMock` cautiously to enforce stronger contract verification.

Example migration:

```cpp
// Before
MockFoo mock_foo;
EXPECT_CALL(mock_foo, DoThis());

// After
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoThis());
```

Note that nested wrapping like `NiceMock<StrictMock<MockFoo>>` is **not supported**.

Refer to the [Mock Class Behavior Modes documentation](https://google.github.io/googletest/reference/mocking.html#mock-class-behavior-modes) for detailed guidance.

---

## 4. Expectation Setting Best Practices

Migrating users often face test brittleness due to over-specifying expectations or improper use of `EXPECT_CALL` and `ON_CALL`.

### Key Recommendations

- Use `ON_CALL` to set default behavior without enforcing call counts.
- Use `EXPECT_CALL` only when you want to verify calls or their counts.
- Avoid overly strict ordering or call count assertions unless behavior requires it.
- Prefer idioms like sequences (`InSequence`, `Sequence`) to express call ordering smoothly.
- Use `Times(AnyNumber())` for expected but unconstrained calls to reduce unintended failures.

This approach produces tests resilient to internal implementation changes and easier to maintain.

See the [Knowing When to Expect](https://google.github.io/googletest/gmock_cook_book.html#UseOnCall) section of the gMock Cookbook for examples.

---

## 5. Handling Methods with Move-Only Types

Modern C++ code often uses move-only types (e.g., `std::unique_ptr`). GoogleMock supports mocking functions with move-only arguments and return types.

### Migration Notes

- Define mocks with `MOCK_METHOD` normally for methods that take or return move-only types.
- Use lambdas in `.WillOnce()` or `.WillRepeatedly()` for actions, rather than `Return()` with move-only objects:

```cpp
EXPECT_CALL(mock, MakeBuzz("hello"))
    .WillRepeatedly([](StringPiece text) {
        return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

- Avoid actions that internally copy arguments when mocking move-only types.

For legacy code, remove any workaround patterns involving proxy mock methods that unwrap move-only params.

See [Mocking Methods That Use Move-Only Types](https://google.github.io/googletest/gmock_cook_book.html#mocking-move-only) for details.

---

## 6. Upgrading Custom Matchers and Actions

GoogleMock encourages extending expectations using custom matchers and actions.

### Custom Matchers

- Transition from legacy, verbose matcher definitions to use the streamlined `MATCHER` and `MATCHER_P` macros.
- Ensure matcher definitions remain pure functions without side effects.

### Custom Actions

- Prefer functors or lambdas compatible with mock function signatures over the older `ACTION` macros.
- For polymorphic actions used across different mock methods, define template-based implementations leveraging `MakePolymorphicAction`.

Review the [Extending gMock with Custom Matchers and Actions](https://google.github.io/googletest/gmock_cook_book.html#custom-matchers) for hands-on recipes.

---

## 7. Verifying and Working With Mock Object Lifetimes

- Mock objects verify expectations automatically upon destruction.
- If your mock objects have complex ownership (e.g., heap allocation passed to tested code), consider calling `Mock::VerifyAndClearExpectations()` early to force verification.

Example:

```cpp
Mock::VerifyAndClearExpectations(mock_ptr);
```

- If you want to deliberately ignore leak reports, use `Mock::AllowLeak()`.

---

## 8. Troubleshooting Common Upgrade Issues

- **Unexpected or uninteresting calls warnings:** Review your `EXPECT_CALL` and `ON_CALL` usage, add `NiceMock` wrappers, or provide catch-all `EXPECT_CALL(...).Times(AnyNumber())` constructs.
- **Compilation errors with move-only types:** Transition to lambda-based actions and avoid copying.
- **Slow compilation with large mocks:** Separate constructor and destructor definitions into `.cc` files to reduce compile-time cost.

---

## 9. Resources for Smooth Migration

- **Release Notes and Changelogs:** Always consult [Version History](https://github.com/google/googletest/releases) and [Breaking Changes](./breaking-changes) documents.
- **Migration Guides:** The present page plus [changelog/breaking-changes-upgrades/breaking-changes](./breaking-changes) provide in-depth details.
- **gMock Cookbook:** Essential pattern recipes and best practices.
- **API Reference:** For `MOCK_METHOD`, expectations, actions, and mocks behavior modes.

---

## 10. Summary

Upgrading GoogleTest involves careful adoption of new macros, behaviors, and idioms to maintain test reliability and clarity. Embrace modern `MOCK_METHOD`, behavior modes, and well-structured expectations. Regularly consult the official documentation and community resources to stay aligned with best practices.

---

## Appendix: Example Migration Snippet

```cpp
// Legacy
class MockFoo : public Foo {
 public:
  MOCK_METHOD1(FooMethod, bool(int));
  MOCK_CONST_METHOD2(BarMethod, void(const std::string&, double));
};

// Modern
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, FooMethod, (int), (override));
  MOCK_METHOD(void, BarMethod, (const std::string&, double), (const, override));
};

// Usage with behavior mode
#include <gmock/gmock.h>
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, FooMethod(42))
    .WillOnce(Return(true));
```

---

## Related Documentation

- [Breaking Changes and Upgrade Guidance](./breaking-changes)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [MOCK_METHOD Macro Reference](https://google.github.io/googletest/reference/mocking.html#MOCK_METHOD)
- [Mock Class Behavior Modes](https://google.github.io/googletest/reference/mocking.html#mock-class-behavior-modes)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [GoogleTest Primer](../overview/welcome-introduction/what-is-googletest) for foundational concepts

---

For further assistance, consult the [Support Channels](../faq/community-support/support-channels) and the community forums.
