---
title: "Feature Additions & Improvements"
description: "An itemized catalog of new capabilities, feature releases, and enhancements in each version. Details technical and functional expansions, enabling users to discover emerging possibilities and plan for future testing workflows."
---

# Feature Additions & Improvements

An itemized catalog of new capabilities, feature releases, and enhancements in each version of GoogleTest and GoogleMock. This page focuses on detailing technical and functional expansions to enable users to discover emerging possibilities, optimize their testing workflows, and plan for future test suite enhancements.

---

## Recent Additions and Enhancements

### Expanded Mocking Capabilities

- **Enhanced MOCK_METHOD macro:**
  - Introduced flexible qualifiers like `const`, `override`, `noexcept`, and platform-specific call qualifiers such as `Calltype(STDMETHODCALLTYPE)` to safely mock complex method signatures.
  - Improved handling of move-only types (`std::unique_ptr`): Mock methods now support move-only argument and return types seamlessly, enabling modern C++ idioms in tests.
  - Support for overloading: Users can mock overloaded methods including const and non-const variants with no extra boilerplate.

- **Unprotected commas workaround:**
  - Usage of wrapping argument or return types with parentheses or type aliases to avoid parsing issues, making mocks more user-friendly.

- **Mock Object Configurations (NiceMock, NaggyMock, StrictMock):**
  - Fine-grained control over behavior on uninteresting calls: suppress warnings, emit warnings, or fail tests.
  - These wrappers inherit constructors enabling easy substitution without code changes.

### Improved Expectation and Action Management

- **EXPECT_CALL enhancements:**
  - Chainable clauses for precise expectation control:
    - `.With()` for multi-argument matching as a tuple.
    - `.Times()` specifying cardinality with expressive types like `AtLeast(n)`, `AtMost(n)`, `Between(m, n)`, and `AnyNumber()`.
    - `.InSequence()` and `.After()` for flexible ordering constraints, supporting linear and partial orderings of expected calls.
    - Actions including `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` to tune call behaviors and lifecycles.

- **ON_CALL for setting defaults:**
  - Separates behavior specification from call expectations.
  - Allows defining default behaviors (e.g., return values, side effects) that act when no explicit `EXPECT_CALL` matches.

- **Advanced Action Utilities:**
  - `ReturnPointee()` to return live values from pointers at call-time instead of copies.
  - `DoAll()` to sequence multiple actions in a single call.
  - `Invoke()`, `InvokeWithoutArgs()`, and `InvokeArgument<N>()` to flexibly delegate calls to functions, functors, lambdas or invoke callback parameters.
  - Action adaptors such as `WithArgs<N1, ..., Nk>()` to reorder or filter arguments passed to an action.
  - `IgnoreResult()` to accommodate actions returning values in void-returning mocks.

### New Matcher Features and Customization

- **Matcher enhancements:**
  - Rich set of built-in matchers covering primitive types, containers, objects with fields and properties, pointers, strings, and floating-point.
  - Support for custom user-defined matchers via `MATCHER`, `MATCHER_P`, and class-based implementations.
  - Matcher combinators like `AllOf()`, `AnyOf()`, `Not()`, and multi-argument matchers using `.With()` clause.
  - Safe and explicit matcher casting to handle type conversions while retaining type safety.
  - Integration with Googletest assertion macros via `EXPECT_THAT` for expressive testing.

- **Predicate assertions:**
  - `EXPECT_PRED*` and `EXPECT_PRED_FORMAT*` provide fine-grained control and rich diagnostics for complex predicate-based assertions.

### Testing Enhancements

- **Typed and Parameterized Tests:**
  - Support for value-parameterized tests (`TEST_P`) enables reusing test logic with multiple input values.
  - Typed tests (`TYPED_TEST`) and type-parameterized tests (`TYPED_TEST_P`) provide reusable test logic across multiple data types.
  - Facilities to create abstract test suites that can be instantiated multiple times with different parameters or types.
  - Customizable test name generation for parameterized tests for clearer test reporting.

- **Death Tests:**
  - Added `EXPECT_DEATH`, `EXPECT_DEATH_IF_SUPPORTED`, `EXPECT_EXIT` macros for verifying program termination and error conditions.
  - Supports two death test styles (`fast` and `threadsafe`) to better fit single-threaded or multi-threaded test environments.

- **Shared Resources:**
  - Introduced per-test-suite setup/teardown (`SetUpTestSuite()`, `TearDownTestSuite()`) to share expensive resources safely among tests in the same suite.
  
- **Scoped Traces:**
  - `SCOPED_TRACE` macro and `ScopedTrace` class to add contextual information in assertion failure messages, simplifying diagnosis of failures in nested or reused test code.

### Usability and Tooling

- **Improved diagnostics:**
  - Verbose logging flags (`--gmock_verbose=info|warning|error`) to control the amount of information printed during tests.
  - Stack traces in warnings and failure messages to quickly locate issues.

- **Integration and Extensibility:**
  - Event Listener API to observe and customize test execution progress and output.
  - Compatibility improvements with build systems and coverage tools.

### Best Practices and Performance

- **Compilation efficiency:**
  - Recommendation to move mock construction/destruction definitions out-of-line to improve build times when mocking many methods.

- **Thread Safety:**
  - Guidelines for safely using mocks in multi-threaded tests to avoid undefined behavior.

- **Test Flakiness & Scaling:**
  - Parallel execution, sharding support and best practices to keep test suites performant and reliable at scale.

---

## Practical Tips and Common Scenarios

- Focus on setting expectations with `EXPECT_CALL` *before* exercising mock objects.
- Use `ON_CALL` for default behaviors without enforcing call expectations, reducing brittleness.
- Utilize `NiceMock` to suppress warnings on uninteresting calls where appropriate.
- Employ `StrictMock` when uninteresting calls indicate a logic error in tests.
- Prefer expressive matchers over concrete values to tolerate reasonable variations and avoid overspecification.
- Use `.RetiresOnSaturation()` on expectations in sequences or iterative call scenarios to prevent upper bound violations.
- When mocking non-virtual methods or free functions, consider interface extraction or mocking function objects.
- Use `DelegateToFake()` pattern to combine mocks and fakes, delegating behavior while preserving verification.
- To test asynchronous code interactively, combine actions with synchronization primitives like `Notification`.

---

## Example: Defining and Using a Mock Class with New Features

```cpp
#include <gmock/gmock.h>

class Interface {
 public:
  virtual int Compute(int a, int b) const noexcept = 0;
  virtual std::unique_ptr<int> MakeValue() = 0;
  virtual void Action() = 0;
  virtual ~Interface() = default;
};

class MockInterface : public Interface {
 public:
  MOCK_METHOD(int, Compute, (int a, int b), (const, noexcept, override));
  MOCK_METHOD(std::unique_ptr<int>, MakeValue, (), (override));
  MOCK_METHOD(void, Action, (), (override));
};

using ::testing::Return;
using ::testing::ReturnNew;
using ::testing::NiceMock;

TEST(MockUse, BasicExample) {
  NiceMock<MockInterface> mock;

  ON_CALL(mock, Compute).WillByDefault(Return(42));

  EXPECT_CALL(mock, Compute(5, 10))
      .Times(1)
      .WillOnce(Return(15));

  EXPECT_CALL(mock, MakeValue())
      .WillOnce([] { return std::make_unique<int>(99); });

  // Use mock
  int result = mock.Compute(5, 10);
  auto val = mock.MakeValue();
  mock.Action();

  EXPECT_EQ(result, 15);
  EXPECT_EQ(*val, 99);
}
```

---

For additional detail, best practices, and patterns in feature usage, please refer to the linked guides and references.

---