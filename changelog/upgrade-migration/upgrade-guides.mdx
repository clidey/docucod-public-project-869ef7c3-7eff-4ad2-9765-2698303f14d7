---
title: "Upgrade & Migration Guides"
description: "Practical, version-specific instructions for upgrading existing codebases to the latest GoogleTest release. This includes tips for adapting to required compiler versions and C++ standard updates."
---

# Upgrade & Migration Guides

GoogleTest evolves to continuously improve usability, compatibility, and functionality. This page provides practical, version-specific instructions to help you upgrade existing codebases to the latest GoogleTest and GoogleMock releases. It also covers tips for adapting your projects to required compiler versions and updates to the mandated C++ standard.

---

## 1. Overview of Upgrade Considerations

Upgrading GoogleTest ensures you benefit from the latest features, fixes, and performance improvements. However, certain releases introduce changes that require adjustments to your code or build environment.

- **Compiler and C++ Standard Requirements:** Modern GoogleTest releases require a C++17-compliant compiler. Make sure your project is configured accordingly.
- **API Changes and Deprecations:** Some macros, classes, and behaviors might have changed or been deprecated. You may need to modify mocks or expectations.
- **Behavioral Changes in Mocking:** Changes in mock strictness policies and default behaviors can affect your tests' outcome.

This guide helps you navigate these updates with clear steps and examples.

---

## 2. Preparing for Upgrade

### 2.1 Confirm Compiler Compatibility and Build Settings

GoogleTest now mandates an environment with C++17 support. To verify and adjust your project:

- Ensure your compiler is recent enough to support C++17 (e.g., GCC 7+, Clang 6+, MSVC 2017+).
- Set your build system to enable C++17. With CMake, add:

	```cmake
	set(CMAKE_CXX_STANDARD 17)
	set(CMAKE_CXX_STANDARD_REQUIRED ON)
	```

- Remove or update any legacy flags that conflict with C++17.

<Tip>
Adopting C++17 unlocks language modernizations and performance improvements crucial for GoogleTest’s internals.
</Tip>

### 2.2 Analyze and Refactor Mock Classes

Significant changes occurred in mock macros and mock strictness handling (see Breaking Changes doc for full details). Pay attention to:

- Transition from old `MOCK_METHODn` macros to the generic `MOCK_METHOD` macro.
- Mark mock methods with appropriate qualifiers (`const`, `override`) explicitly.
- For mocks of classes with non-virtual destructors, consider adding virtual destructors to avoid undefined behavior.

<Note>
Ensure that your mock method declarations are in the `public` section regardless of base class method access level to allow mocks to work correctly.
</Note>

### 2.3 Adapt to Strict Mocking and Expectation Behaviors

GoogleMock has refined how it treats uninteresting and unexpected calls:

- Using `NiceMock`, `NaggyMock`, or `StrictMock` controls warnings and failures for uninteresting calls.
- Add catch-all expectations with `EXPECT_CALL(...).Times(AnyNumber())` where needed to avoid unexpected call errors.

<Warning>
Tests may start failing unexpectedly if they relied on old default behaviors. Consider adopting recommended strictness policies gradually.
</Warning>

---

## 3. Migrating Existing Mock Definitions

### 3.1 Replacing Legacy `MOCK_METHODn` Macros

The older family of macros `MOCK_METHOD0`, `MOCK_CONST_METHOD1`, etc. have been superseded by the unified `MOCK_METHOD` macro. For example:

```cpp
// Old style:
MOCK_CONST_METHOD1(Foo, bool(int));

// New style:
MOCK_METHOD(bool, Foo, (int), (const, override));
```

Key points:

- Wrap argument or return types with commas in extra parentheses or use type aliases to handle template types.
- Specify qualifiers like `const`, `override` as a fourth parameter tuple.

<Tip>
Automate this refactoring using search and replace tools or scripts for large codebases.
</Tip>

### 3.2 Adding `override` and Correct Qualifiers

Explicitly mark all mock methods overriding base virtual methods with `override`. If the base method is marked `const` or `noexcept`, do the same in the mock method.

Example:

```cpp
MOCK_METHOD(int, Calculate, (int x), (const, override, noexcept));
```

---

## 4. Adjusting for Behavioral Changes

### 4.1 Mock Strictness Levels

Mock objects are **naggy** by default (warn on uninteresting calls). You can switch to:

- `NiceMock<T>` to ignore such warnings.
- `StrictMock<T>` to treat uninteresting calls as test failures.

Evaluate your tests' tolerance for strictness. When converting:

```cpp
using ::testing::StrictMock;
StrictMock<MockFoo> mock_foo;
```

You may need to add general expectations to prevent unexpected call failures.

### 4.2 Handling Uninteresting vs Unexpected Calls

- *Uninteresting calls* have no matching expectation; warnings or errors depend on mock strictness.
- *Unexpected calls* contradict expectations set by `EXPECT_CALL` and always fail.

Ensure your tests set appropriate expectations or use `NiceMock` to suppress warnings.

<Check>
Use `EXPECT_CALL(mock, MethodName(_)).Times(AnyNumber());` to allow any number of calls.
</Check>

### 4.3 Retiring Expectations

To prevent sticky expectations causing test failures in repeated calls, consider adding `.RetiresOnSaturation()` where appropriate. This is especially useful when you expect multiple calls with the same signature but want to avoid overlapping matching.

Example:

```cpp
EXPECT_CALL(mock, Foo(5))
    .Times(2)
    .RetiresOnSaturation();
```

---

## 5. Special Migration Tips and Best Practices

### 5.1 Mocking Non-Virtual Functions

Previously complex, now supported through unrelated mock classes mimicking method signatures. Adopt the approach where possible to avoid forced virtual methods on concrete classes.

### 5.2 Delegating to Fakes or Real Implementations

Where keeping complex behaviors is desirable, use delegation patterns to fake or real objects within mocks to minimize rewriting logic.

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (), (override));
  void DelegateToFake() {
    ON_CALL(*this, Bar).WillByDefault([this]() { return fake_.Bar(); });
  }
 private:
  FakeFoo fake_;
};
```

### 5.3 Mock Class Constructors and Destructors

For faster compilation and better behavior:

- Declare mock class constructors and destructors explicitly in header.
- Implement trivial constructor/destructor in `.cc` files.
- Ensure mock class destructor is virtual.

### 5.4 Verifying Mocks Early

If mocks have a lifecycle outside test scope, call `Mock::VerifyAndClearExpectations(&mock_object);` before deleting mocks to force expectation verification.

---

## 6. Troubleshooting and Common Pitfalls

### 6.1 Warning "Uninteresting function call encountered"

This indicates a mock method was called without a corresponding `EXPECT_CALL`. If it's expected, switch to `NiceMock` or add catch-all expectations.

### 6.2 Compilation Errors Related to Qualifiers and Commas

- Use parentheses to wrap complex return or argument types with commas.
- Confirm matching qualifiers (`const`, `override`) in your mock declarations.

### 6.3 Linking and Build Failures after Upgrade

- Confirm your build system uses a C++17-compatible compiler.
- Adjust CMake or build config accordingly.

### 6.4 Tests Failing after Enabling StrictMock

- Add proper expectations for all used mock methods.
- Check for calls to mock methods not covered by expectations.

---

## 7. Additional Resources

- [Breaking Changes & Deprecations](https://google.github.io/googletest/changelog/upgrade-migration/breaking-changes) — Detailed list of breaking changes
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical techniques and recipes
- [Mock Classes & Method Macros](https://google.github.io/googletest/api/gmock_api_reference.html#mocks) — Detailed mock method API
- [Getting Started Guides](https://google.github.io/googletest/getting_started.html) — For initial setup and usage

---

By carefully following these guides, you can transition your codebase smoothly to the latest GoogleTest framework version, unlocking safer, more maintainable, and more powerful tests.
