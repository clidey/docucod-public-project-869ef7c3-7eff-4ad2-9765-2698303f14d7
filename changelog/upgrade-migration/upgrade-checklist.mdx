---
title: "Upgrade Checklist & Best Practices"
description: "Concise steps and best practices for safely upgrading GoogleTest/GoogleMock, including dependency planning and integration testing. Streamlines the upgrade process and helps prevent common issues."
---

# Upgrade Checklist & Best Practices

Upgrading GoogleTest and GoogleMock to a newer version is a critical process that requires careful planning and execution to ensure stability and compatibility in your C++ testing environment. This guide provides concise steps and best practices to help you safely upgrade your testing framework, manage dependencies effectively, and validate integration smoothly.

---

## 1. Pre-Upgrade Preparation

### Assess Compatibility and Requirements
- **Confirm C++17 Compliance:** GoogleTest and GoogleMock now require a minimum C++17 standard. Make sure your build environment supports this.
  
- **Review Deprecations and Breaking Changes:** Check the latest deprecation policies and breaking changes to understand removed features or altered behaviors that may impact your tests.

- **Update Build System Configurations:** If you use CMake or Bazel, update the dependencies accordingly to pull in the latest GoogleTest/GoogleMock sources or binaries.

### Backup Current Setup
- Save your existing framework version and test snapshots.
- Document customizations and overrides you may have applied.

### Plan Dependencies
- Identify downstream projects or test suites that depend on GoogleTest/GoogleMock.
- Coordinate upgrades with those teams or projects.


## 2. Upgrade Execution Steps

### 2.1 Download and Integrate New Version
- Use official release sources or package managers.
- For CMake: Adjust `FetchContent` or `find_package` references to point to the desired version.
- For Bazel: Update workspace `MODULE.bazel` and build files accordingly.

### 2.2 Update Mock Declarations
- Refactor mock classes to use the modern `MOCK_METHOD` macro instead of deprecated `MOCK_METHODn` variants.
- Wrap mock objects with `NiceMock` or `StrictMock` as needed based on test behavior strictness:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;  // Suppresses warnings for uninteresting calls
StrictMock<MockFoo> strict_foo;  // Fails on uninteresting calls
```

- Ensure destructors in mock classes are virtual for compatibility with `NiceMock` and `StrictMock`.

### 2.3 Manage Expectations and Default Actions
- Use `ON_CALL` to specify default actions for mocked methods when calls aren't expected.
- Use `EXPECT_CALL` only when verifying calls, minimizing over-specification for maintainable tests.
- Set `EXPECT_CALL(...).Times(AnyNumber())` to ignore calls intentionally.

### 2.4 Leverage New Features and Fixes
- Embrace updated expressive assertions and matchers; check if applicable to enhance test clarity.
- Explore improvements in mocking behaviors such as refined matchers and actions from the new API.


## 3. Integration Testing

### Validate Test Coverage
- Run all existing tests to verify compatibility.
- Observe for any unexpected failures or warnings.

### Troubleshoot Common Upgrade Issues
- **Uninteresting Call Warnings:** If you encounter excessive warnings, consider using `NiceMock` or adjusting expectations.
- **Mock Destruction and Verification:** Ensure mock objects are destructed properly to trigger verification.
- **Compile Errors:** Often caused by deprecated macros or missing `(override)` qualifiers in mock declarations.

### Continuous Integration (CI)
- Update CI scripts to use the new GoogleTest/GoogleMock flags as needed.
- Test flag configurations such as `--gmock_verbose` to control log verbosity.


## 4. Post-Upgrade Best Practices

### Maintain Clean Mock Usage
- Favor `ON_CALL` for default behavior and use `EXPECT_CALL` selectively.
- Avoid over-constraining tests which increase maintenance overhead.

### Suppress Unimportant Warnings When Appropriate
- Use `NiceMock` for mock objects where uninteresting calls should be silent.

### Keep Mocks and Fakes Clear and Simple
- Delegate to fakes or real objects if suitable, to reduce complex mocking.

### Monitor for Deprecated Features
- Regularly review deprecation schedules and update test code accordingly.


## 5. Additional Tips

- **Migration Guides:** Consult detailed migration instructions on [Breaking Changes & Migration Notes](../changelog/upgrade-migration/breaking-changes) for version-specific advice.
- **Mock Verification:** Use `Mock::VerifyAndClearExpectations()` to force verification if object lifetimes are uncertain.
- **Handle Overloaded Methods:** Use `Const()` helper or explicit casts to disambiguate overloaded mock methods.
- **Leverage New Matchers and Actions:** Incorporate custom matchers and actions to achieve expressive and maintainable tests.


---

## Related Documentation

- [Deprecations & Removal Schedule](../changelog/upgrade-migration/deprecation-policy): Understand which features have been deprecated and their removal timeframes.
- [Mocking Reference](../docs/reference/mocking.md): Comprehensive guide on declaring mocks and setting expectations.
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md): Quick reference for mock class definitions, default actions, and expectation syntax.
- [Integration with CI Systems](../guides/integration-and-real-world-use/integration-ci.mdx): Best practices for running automated tests with GoogleTest and GoogleMock.
- [Breaking Changes & Migration Notes](../changelog/upgrade-migration/breaking-changes): Detailed migration steps for major GoogleTest/GoogleMock versions.

---

## Summary

Upgrading GoogleTest and GoogleMock demands careful adherence to modern API usage and dependency updates, emphasizing safe mock declaration adjustments and effective expectation setting. Following this checklist streamlines your transition while avoiding common pitfalls such as unhandled uninteresting calls or deprecated macros. Post-upgrade, embracing new expressive features and maintaining clean mock/test structure will improve your testing workflow robustness.

---