---
title: "Migration and Upgrade Guide"
description: "Access practical step-by-step instructions for upgrading your code base, including dependency updates, deprecated APIs, and best practices for taking advantage of new features while retaining stability."
---

# Migration and Upgrade Guide

Welcome to the Migration and Upgrade Guide for GoogleTest. This guide provides you with step-by-step instructions to smoothly upgrade your codebase to use the latest GoogleTest versions. It helps you handle dependency updates, deprecated APIs, and adopt new best practices to leverage new features while maintaining code stability.

---

## 1. Preparing for the Upgrade

### 1.1 Verify C++ Standard Compatibility

GoogleTest 1.17.0 and beyond require **C++17 or higher**. Before upgrading, ensure your build environment supports at least C++17.

- If you previously used an older standard, update your compiler flags accordingly.
- For CMake, set `CMAKE_CXX_STANDARD` to 17 or higher.

### 1.2 Review External Dependencies

GoogleTest is moving toward taking a dependency on [Abseil](https://github.com/abseil/abseil-cpp) in future releases.

While not yet mandatory, preparing your code and build environment for this dependency helps future-proof your project.

---

## 2. Updating GoogleTest APIs

### 2.1 Replace Deprecated Macros and Methods

Some older macros and APIs have been replaced or deprecated. Common migration points include:

- **Move to the new `MOCK_METHOD` syntax in GoogleMock:** The older `MOCK_METHODn` variants have been replaced by `MOCK_METHOD` with unified syntax.

  ```cpp
  // Old style
  MOCK_METHOD1(Foo, bool(int));

  // New style
  MOCK_METHOD(bool, Foo, (int));
  ```

- **Death tests naming convention:** Test suites containing death tests must have names ending with `DeathTest`.

  ```cpp
  // Correct
  TEST(MyClassDeathTest, DiesOnBadInput) { ... }

  // Incorrect
  TEST(MyClassTest, DiesOnBadInput) { ... }
  ```

- **Avoid underscores in test and suite names:** GoogleTest now discourages underscores to prevent issues with test identification and filtering.

### 2.2 Refactor Fatal Assertions in Constructors

Since fatal assertions (`ASSERT_*`) cannot reside in constructors and destructors, shift any such fatal checks into `SetUp()` or `TearDown()` methods.

---

## 3. Leveraging New Features

### 3.1 Enhanced Parameterized and Typed Tests

GoogleTest's support for value-parameterized and typed tests has deepened:

- Use `TEST_P` and `TYPED_TEST` for flexible, reusable test logic across values and types.
- Favor `INSTANTIATE_TEST_SUITE_P` (new name replacing `INSTANTIATE_TEST_CASE_P`) for activation.

Example of parameterized test migration:

```cpp
// Old
INSTANTIATE_TEST_CASE_P(MyTestInstance, FooTest,
                      testing::Values(1, 2, 3));

// New
INSTANTIATE_TEST_SUITE_P(MyTestInstance, FooTest,
                      testing::Values(1, 2, 3));
```

### 3.2 Advanced Mocking Improvements

- Utilize the enhanced `ON_CALL` and `EXPECT_CALL` macros to clearly separate behavior setting from expectation enforcement.
- Use `NiceMock` and `StrictMock` wrappers judiciously to control uninteresting call reporting.
- Delegate mock behaviors to “fake” or real objects for better testing fidelity.

---

## 4. Compilation and Build Upgrades

### 4.1 Faster Mock Compilation

Move non-inline mock class constructors and destructors into implementation (`.cc`) files to speed up compilation.

```cpp
// Header
class MockFoo : public Foo {
 public:
  MockFoo();
  ~MockFoo();

  MOCK_METHOD(int, Bar, (), (override));
};

// Source
MockFoo::MockFoo() {}
MockFoo::~MockFoo() {}
```

### 4.2 Handling Linker and Build Issues

- Ensure that your compiler and linker settings remain consistent, particularly on Visual Studio to avoid runtime mismatches.
- Use the recommended CMake configurations from the [Installing GoogleTest](../getting-started/setup-prerequisites-installation/installing-googletest.md) guide.

---

## 5. Migration Troubleshooting

### 5.1 Troubleshooting Common Breakages

- Naming issues with tests containing underscores:
  - Rename suites and tests to remove underscores.

- Assertion failures from fatal assertions inside constructors:
  - Move such logic to `SetUp()`.

- Incomplete instantiation of parameterized tests:
  - Add `INSTANTIATE_TEST_SUITE_P` statements for each `TEST_P`.

- Mocking warnings for uninteresting calls:
  - Use `NiceMock` or add `EXPECT_CALL(...).Times(AnyNumber())` for expected but uninteresting calls.

### 5.2 Using the Migration Guide and Breaking Changes Documents

Consult the [Breaking Changes](../changelog/upgrade-migration/breaking-changes.md) and [Migration Guide](../changelog/upgrade-migration/migration-guide.md) for detailed instructions and examples tailored for common upgrade scenarios.

---

## 6. Best Practices for Stable Upgrades

- Always incrementally upgrade and test in small steps.
- Use continuous integration pipelines to run the full suite and catch regressions early.
- Whenever possible, refactor tests to use new assertions and parameterized test facilities for better readability and maintainability.
- Leverage test environment and fixture lifecycle methods (`SetUpTestSuite()`, `TearDownTestSuite()`) to reduce expensive setup when upgrading.

---

## 7. Additional Resources

- [GoogleTest Primer](../guides/getting-started/primer.md) — Getting started with test basics.
- [Writing Effective Tests: Assertions and Matchers](../guides/writing-effective-tests/assertions-matchers.md) — Master more expressive checks.
- [Breaking Changes and Migration](../changelog/upgrade-migration/breaking-changes.md) — Detailed incompatible changes.
- [GoogleMock Cookbook](../docs/gmock_cook_book.md) — Practical mocking examples.
- [FAQ on Installation and Build Troubleshooting](../faq/getting-started-common-issues/installation-build-troubleshooting.md) — Help fixing build issues.

---

For any further assistance, visit the [GoogleTest GitHub Repository](https://github.com/google/googletest) or engage with the community and issue tracker.

---

### Callout
<Tip>
Upgrading GoogleTest is an opportunity to improve your test suite’s reliability and maintainability by embracing modern C++ features and the latest GoogleTest enhancements.
</Tip>

<Tip>
Always review the detailed Breaking Changes document to understand implications for your own test code.
</Tip>

<Tip>
Use continuous integration with automated test runs to verify upgrade reliability before merging changes.
</Tip>

---