---
title: "Upgrade Instructions & Best Practices"
description: "Clear, stepwise guidance for upgrading to the latest versions, addressing migration hurdles and offering troubleshooting tips for frequent upgrade scenarios."
---

# Upgrade Instructions & Best Practices

This guide provides clear, stepwise instructions to upgrade your GoogleTest environment to the latest versions while addressing common migration challenges and offering troubleshooting tips. Whether you are installing GoogleTest as a standalone library or integrating it into your existing build system, this documentation will help ensure a smooth transition.

---

## 1. Preparing for the Upgrade

### 1.1 Ensure C++17 Support

The latest releases of GoogleTest require your build environment to support at least C++17. This is a mandatory prerequisite for successful compilation.

**Action Steps:**
- Verify your compiler version supports C++17.
- In CMake-based builds, specify the standard explicitly:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- If using other build systems, configure compiler flags accordingly (e.g., `-std=c++17`).

<Tip>
Having your project build with C++17 not only enables GoogleTest upgrades but also unlocks modern C++ language features beneficial for test and application code.
</Tip>

### 1.2 Review Supported Platforms and Compatibility

Check your platform, compiler, and build system compatibility against the [Supported Platforms & Compatibility](overview/integration-and-ecosystem/supported-platforms-and-compatibility) documentation.


## 2. Upgrading GoogleTest

### 2.1 Standalone Build Upgrade

If using GoogleTest as a standalone library, follow these steps:

<Steps>
<Step title="Clone the Latest Version">
```bash
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
```
</Step>
<Step title="Create Build Directory">
```bash
mkdir build
cd build
```
</Step>
<Step title="Configure with CMake">

- To build GoogleTest and GoogleMock (default):

  ```bash
  cmake ..
  ```

- To build **only** GoogleTest:

  ```bash
  cmake .. -DBUILD_GMOCK=OFF
  ```

</Step>
<Step title="Compile and Install">
- On Unix-like systems:

  ```bash
  make
  sudo make install
  ```

- On Windows, open the generated solution (`.sln`) in Visual Studio and build.

- On macOS, use the generated Xcode project.
</Step>
</Steps>

<Check>
Ensure your `PATH` and include directories are updated post-installation to use the new version.
</Check>

### 2.2 Integration in Existing CMake Projects

There are several ways to incorporate GoogleTest as part of your project build:

- **Find the Installed Package:**

  ```cmake
  find_package(GTest CONFIG REQUIRED)
  target_link_libraries(your_target GTest::gtest GTest::gmock)
  ```

- **Add GoogleTest As a Subdirectory:**

  This approach embeds GoogleTest sources in your project and builds it together with your code. It ensures consistent compiler and linker settings.

  ```cmake
  add_subdirectory(path/to/googletest)
  target_link_libraries(your_target gtest gmock)
  ```

- **FetchContent Integration (Recommended for Easy Maintenance):**

  Add the following to your `CMakeLists.txt`:

  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
  )
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Visual Studio dynamic runtime compatibility
  FetchContent_MakeAvailable(googletest)

  add_executable(your_test your_test.cpp)
  target_link_libraries(your_test gtest_main)
  add_test(NAME your_test COMMAND your_test)
  ```

<Tip>
This approach requires **CMake 3.14** or later.
</Tip>

### 2.3 Handling Visual Studio Runtime Library Conflicts

By default, Visual Studio uses dynamic CRTs, but GoogleTest defaults to static CRTs. Mismatched runtimes lead to link errors like:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

To resolve this, use the `gtest_force_shared_crt` CMake option to enforce dynamic CRT linkage consistently:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```


## 3. Best Practices for Upgrading

### 3.1 Avoid Over-Constraining Tests

- Prefer using `ON_CALL()` to set default mock behaviors rather than excessive `EXPECT_CALL()` which can tightly couple tests to implementation details.
- Use `NiceMock` to suppress warnings for uninteresting calls, but reserve `StrictMock` for tests that must catch unexpected calls.

### 3.2 Use Semantic Versioning Awareness

Stay informed of breaking changes mentioned in the [Breaking Changes & Deprecations](changelog/upgrade-migration/breaking-changes) to prepare your tests and codebase accordingly.

### 3.3 Update Build Flags and Dependencies

- Ensure compiler and linker flags are updated to support C++17 and any relevant runtime options.
- Review dependencies such as Abseil, which GoogleTest plans to adopt in upcoming versions.

### 3.4 Migrate Mocking Macros

- Use the modern `MOCK_METHOD` macro instead of the deprecated `MOCK_METHODn` macros.
- Properly qualify mocked methods with `override`, `const`, `noexcept`, and other qualifiers as needed.


## 4. Troubleshooting Common Upgrade Issues

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Build Fails Due to C++ Version">
Verify your compiler flags include C++17 support:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```
If using older build systems, upgrade your compiler or use a newer toolchain.
</Accordion>
<Accordion title="Linker Errors with Conflicting CRT on Windows">
Set the CMake option `gtest_force_shared_crt` to `ON`:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
Ensure all project targets link to compatible runtime libraries.
</Accordion>
<Accordion title="Unexpected Mock Warnings During Tests">
Consider wrapping mocks in `NiceMock<>` to suppress warnings from uninteresting calls, or explicitly set expectations for all calls used.

Check for missing or incomplete `EXPECT_CALL` specifications.
</Accordion>
<Accordion title="Test Failures Due to API Changes or Deprecations">
Review the [Breaking Changes & Deprecations](changelog/upgrade-migration/breaking-changes) and modify your tests accordingly.

Use migration guides and sample code for reference.
</Accordion>
</AccordionGroup>


## 5. Additional Recommendations

### 5.1 Use FetchContent for Continuous Integration

Automating dependency download and build through CMake's `FetchContent` simplifies maintenance and ensures your builds always use the correct GoogleTest version.

### 5.2 Prefer Consistent Compiler Flags

Make sure GoogleTest and your project share the same compiler and linker flags to avoid subtle bugs or binary incompatibilities, especially on Windows.

### 5.3 Review Updated Features

Newer GoogleTest releases may provide improved macros, matchers, and testing flows. Review the [What's New in Recent Releases](changelog/release-history/what-s-new) for ideas on enhancing your tests.


## 6. Useful Links and References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleTest Primer](docs/index.md#googletest-primer)
- [Installing with CMake](getting-started/installation-config/installing-cmake)
- [Breaking Changes & Deprecations](changelog/upgrade-migration/breaking-changes)
- [Mocking Reference](docs/reference/mocking.md)
- [Running and Interpreting Your Tests](guides/gtest-core-guides/running-tests)
- [Troubleshooting Setup Issues](getting-started/first-run-validation/troubleshooting-setup)


<Tip>
For complex upgrades, consider running your test suites incrementally and verifying successful execution before progressing further.
</Tip>

---

Upgrading GoogleTest with deliberate preparation and following these best practices ensures reliable tests and smooth continuity in your development workflows.
