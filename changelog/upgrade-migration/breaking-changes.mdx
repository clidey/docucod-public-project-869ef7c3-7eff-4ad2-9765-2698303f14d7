---
title: "Breaking Changes & Migration Steps"
description: "Announces any breaking changes introduced in recent versions and outlines clear steps for migrating existing tests, mocks, or integrations. Helps users eliminate upgrade blockers by understanding root causes and solutions."
---

# Breaking Changes & Migration Steps

This page details the critical breaking changes introduced in recent GoogleTest versions and provides clear, actionable migration steps to help users update their existing test suites, mocks, and integrations successfully. By understanding these changes and following the outlined procedures, you can avoid upgrade blockers and maintain reliable, maintainable test code.

---

## 1. Breaking Change Overview

GoogleTest strives for backward compatibility wherever possible. However, on occasion, intrinsic limitations or necessary improvements lead to breaking changes that affect how tests and mocks are defined or executed. These changes typically stem from deeper language or framework constraints that, when unaddressed, may cause silent errors or confusing behavior.

This page focuses exclusively on breaking changes that impact the user-facing testing and mocking workflows and *not* on internal implementation adjustments.


## 2. Critical Breaking Changes

### 2.1. Prohibition of Underscores (`_`) in Test Suite and Test Names

**What changed?**
GoogleTest now warns and may fail to run tests if the test suite name or test name contains underscores (`_`), especially when they appear at the start or end, or consecutively within names.

**Reason:**
Under the hood, GoogleTest generates class names by concatenating the test suite and test names with underscores. Certain patterns involving underscores, like leading underscores followed by uppercase letters or consecutive underscores, produce class names that are reserved by C++ or cause duplication.

**Impact:**
If your test names or test suite names contain underscores, this can cause name collisions or compilation errors in future compiler or GoogleTest versions.

**Migration steps:**
- Avoid using underscores in the names of your tests and test suites.
- Rename existing tests to use camel case or mixed case without underscores.
- For example:
  ```cpp
  // Avoid:
  TEST(My_TestSuite, Test_Case) { ... }

  // Use instead:
  TEST(MyTestSuite, TestCase) { ... }
  ```

**Additional Notes:**
- Underscores anywhere inside the names are disallowed to prevent collisions such as `TEST(Time, Flies_Like_An_Arrow)` being indistinguishable from `TEST(Time_Flies, Like_An_Arrow)`.
- This restriction applies to both test suite and individual test names.


### 2.2. Changes Related to Mock Method Declaration and Expectation

With evolving C++ standards and GoogleMock improvements, mock method declarations must precisely match the signature and qualifiers of the methods they mock. This includes constness, noexcept specifications, and reference qualifiers.

**Impact:**
- Failing to declare mocks with the correct qualifiers leads to compilation errors or silent failures where the mock may not properly intercept calls.
- Mocks of overloaded methods must specify overloads unambiguously.

**Migration steps:**
- Always include the `(override)` specifier in `MOCK_METHOD` declarations.
- For const methods, include `(const, override)`.
- For noexcept methods, include `(noexcept, override)` as appropriate.
- For methods with reference qualifiers (`&` or `&&`), use the `ref()` specifier.

Example:
```cpp
class Foo {
  virtual int Bar() const noexcept = 0;
  virtual void Baz() & = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (), (const, noexcept, override));
  MOCK_METHOD(void, Baz, (), (ref(&), override));
};
```


### 2.3. Default Argument Handling in `EXPECT_CALL` and `ON_CALL`

GoogleMock used to be more lenient when matching calls with default arguments. Now, arguments must typically match expectations explicitly.

**Impact:**
- Calls relying on default arguments may require explicit matchers.

**Migration steps:**
- Use appropriate matchers (`_` for "anything") in `EXPECT_CALL` and `ON_CALL` when ignoring certain arguments.
- Avoid over-specifying expectations unnecessarily.


### 2.4. Strict Enforcement of Call Order and Cardinality

GoogleMock enforces expectations strictly:
- Calls beyond the `Times()` limit are failures.
- Matching expectations are searched from newest to oldest.
- Calls must respect explicit sequences or `After()` clauses.

**Impact:**
- Test code that had ambiguous or insufficiently specified mocks might start failing.

**Migration steps:**
- Inspect failing tests for mismatched call counts or orders.
- Use `RetiresOnSaturation()` for expectations you want deactivated after saturation.
- Use sequences to enforce order only when needed.

Example:
```cpp
EXPECT_CALL(mock, Foo(7))
  .Times(2)
  .RetiresOnSaturation();
EXPECT_CALL(mock, Foo(_))
  .Times(AnyNumber());
```


### 2.5. Handling of NULL vs nullptr in Assertions

GoogleTest encourages using `nullptr` instead of `NULL`.

**Impact:**
- Use `EXPECT_EQ(ptr, nullptr)` instead of `EXPECT_EQ(NULL, ptr)` to avoid template resolution issues.

**Migration steps:**
- Update NULL comparisons to use C++11 `nullptr`.


### 2.6. Death Test Restrictions

Death tests execute in subprocesses and impose restrictions on global state and multithreading.

**Impact:**
- Tests may fail or deadlock if multithreading occurs outside the immediate death test code.

**Migration steps:**
- Ensure all threading occurs inside `EXPECT_DEATH` or `ASSERT_DEATH` blocks.
- Consider setting `--gtest_death_test_style=threadsafe` for safer runs, albeit slower.


## 3. Migration Steps: How to Adapt Your Code

### 3.1. Renaming Tests to Avoid Underscores

- Review all `TEST()` and `TEST_F()` macros for test names and suite names containing `_`.
- Use find-and-replace across your codebase to replace underscores with camelCase or PascalCase equivalents.
- Re-run your tests and fix failures promptly.


### 3.2. Correcting Mock Method Declarations

- For every `MOCK_METHOD` in your mock classes, verify it matches the base method signature precisely, including `const`, `noexcept`, and `ref` qualifiers.
- Add `(override)` if missing.
- For overloaded methods, use disambiguation helpers like `Const()` or explicit type casts in `EXPECT_CALL()` or `ON_CALL()`.


### 3.3. Refining Expectations and Default Behaviors

- Add `.Times(AnyNumber())` on expectations where you allow unrestricted calls.
- Use `ON_CALL()` to specify default behavior for methods that are called but not explicitly expected.
- Introduce sequences or `After()` clauses only where precise call order is crucial.


### 3.4. Updating Assertions for null Pointer Comparisons

- Replace `EXPECT_EQ(NULL, ptr)` with `EXPECT_EQ(ptr, nullptr)` or `EXPECT_THAT(ptr, ::testing::IsNull())`.
- Avoid `EXPECT_NE(NULL, ptr)`, using `EXPECT_TRUE(ptr != nullptr)` instead.


### 3.5. Death Test Adjustments

- Move mock expectations inside `EXPECT_DEATH` blocks if their side effects need to be observed.
- Eliminate or delay thread creation outside death test code.
- Use the `threadsafe` death test style if needed.


## 4. Troubleshooting Common Upgrade Failures

- **Compilation fails with name-related errors:** Likely caused by underscore violations in test or suite names. Check all test names for underscores and rename.

- **Mock method signature mismatch errors:** Compare your mock class declarations against the latest base class/method definitions to ensure qualifiers align.

- **Unexpected call failures in mocks:** Review your `EXPECT_CALL` and `ON_CALL` definitions. Add `.Times()` clauses or default behaviors.

- **Death test hangs or crashes:** Confirm threads aren’t active outside `EXPECT_DEATH`, and try the `threadsafe` death test style.

## 5. Best Practices Moving Forward

- **Adopt naming conventions** disallowing underscores in test suite and test names.
- **Explicitly specify qualifiers** in your mock methods and expectations to avoid ambiguity.
- **Use ON_CALL for defaults** and EXPECT_CALL for verifications, avoiding over-specification.
- **Keep death test code isolated** and deterministic.
- Regularly validate your test suite with `--gmock_verbose=info` to capture unexpected interactions early.
- When introducing new mocks, use `NiceMock` for relaxed expectations during development.

## 6. Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — Getting started with writing tests
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly guide for mocks
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Comprehensive reference on mocking
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Advanced mock patterns and recipes
- [FAQ: General Usage & Troubleshooting](https://google.github.io/googletest/faq.html#getting_started)
- [Changelog: Recent Releases & Highlights](../version-history/recent-releases)

---

<Check>
Always keep test and suite names free of underscores to avoid naming collisions.
Verify mock method signatures for exact match to avoid compilation errors.
Use ON_CALL for default mock behaviors and EXPECT_CALL sparingly for verification.
Follow death test best practices to ensure reliability in concurrent environments.
</Check>

---