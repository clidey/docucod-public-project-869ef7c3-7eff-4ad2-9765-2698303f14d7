---
title: "Breaking Changes & Deprecations"
description: "Clear documentation of any breaking changes, removed or deprecated APIs, and significant behavioral modifications. Users learn exactly what could impact their code and what action is needed to maintain compatibility."
---

# Breaking Changes & Deprecations

This document provides a clear and detailed overview of all breaking changes, deprecated features, removed APIs, and significant behavioral modifications affecting users of GoogleMock. Understanding these changes will help you maintain compatibility and update your code accordingly.

---

## 1. Overview of Breaking Changes

Whenever a new release includes changes that may impact existing code, this section catalogs those changes along with their implications. Users should carefully review each item to determine necessary migration steps.

### Key Points

- Breaking changes typically involve API modifications, changed behaviors, or removed features.
- Deprecations announce features or APIs that remain available for now but are slated for removal in future releases.
- Detailed migration instructions, if applicable, are provided to assist in smooth transitions.

---

## 2. Removed or Deprecated APIs

### 2.1 Removal of Old-Style `MOCK_METHODn` Macros

GoogleMock previously supported a family of `MOCK_METHODn` and related macros (such as `MOCK_CONST_METHODn` and `_WITH_CALLTYPE` variants). These macros have been deprecated and **removed** in favor of the modern, uniform, and more flexible `MOCK_METHOD` macro that accepts qualifiers as parameters.

**Impact:**

- Existing code using `MOCK_METHOD1`, `MOCK_CONST_METHOD1`, `MOCK_METHOD1_WITH_CALLTYPE`, etc., will fail to compile.
- Users must migrate to the modern `MOCK_METHOD` syntax.

**Migration Example:**

Before:
```cpp
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD1(Bar, void(int));
MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Baz, int(int));
```

After:
```cpp
MOCK_METHOD(bool, Foo, (int), (override));  // Add 'override' if overriding
MOCK_METHOD(void, Bar, (int), (const, override));
MOCK_METHOD(int, Baz, (int), (Calltype(STDMETHODCALLTYPE), override));
```

Reference: See the `docs/gmock_cook_book.md` for detailed examples on using `MOCK_METHOD`.

---

### 2.2 Strict Requirements on Virtual Methods

All methods you intend to mock **must be virtual**, including destructors if you expect polymorphic behavior.

**Impact:**

- Mocking non-virtual methods directly is no longer supported, except via the high-performance dependency injection pattern described in the cookbook.
- Ensure your base classes declare destructors as virtual to avoid undefined behaviors and heap corruption in tests.

Reference: See [Legacy gMock FAQ](docs/gmock_faq.md) for explanations.

---

### 2.3 Access Level for Mocked Methods

`MOCK_METHOD` macros **must be declared in the `public:` section** of the mock class, regardless of the access control of the method in the base class. This is essential for test code to set expectations and provide default actions.

**Impact:**

- Moving existing mock method declarations into `public:` if they were in `protected:` or `private:` sections is mandatory.

Example:
```cpp
class MockFoo : public Foo {
public:
  MOCK_METHOD(bool, Transform, (Gadget* g), (override));  // Even if Transform is protected or private in base
};
```

---

### 2.4 Changes to Strictness Modes: `NiceMock`, `NaggyMock`, and `StrictMock`

- **Default mock objects now behave as `NaggyMock` by default**, warning on uninteresting calls but not failing tests.

- `NiceMock<T>` suppresses warnings on uninteresting calls.

- `StrictMock<T>` treats uninteresting calls as failures, causing tests to fail.

**Impact:**

- Consider explicitly specifying the strictness mode to enforce or suppress warnings as appropriate.
- Be cautious when migrating between these modes as it affects test robustness and maintainability.

Example:
```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, SomeMethod()).Times(1);
```

---

## 3. Behavioral Modifications

### 3.1 Expectation Matching Order

GoogleMock searches expectations in **reverse order of declaration** to allow general rules to be overridden by more specific expectations declared later.

**Impact:** This behavior has become a firm part of expectation resolution and should be considered when adding new expectations.

Example:
```cpp
EXPECT_CALL(mock, Foo(_));  // #1: general catch-all
EXPECT_CALL(mock, Foo(5));  // #2: more specific
// Calls with argument 5 match #2 first
```

---

### 3.2 Sticky Expectations

Expectations by default remain **active after they reach their upper invocation limits**, causing errors on calls beyond the limit, unless:

- They are part of a sequence,
- Or chained with `.RetiresOnSaturation()`.

**Impact:**

- To have expectations retire when saturated, use `.RetiresOnSaturation()`.
- This behavior reduces brittleness in tests and improves clarity.

Example:
```cpp
EXPECT_CALL(mock, GetX())
    .WillOnce(Return(10))
    .RetiresOnSaturation();
```

---

### 3.3 Overload and Const Qualification Handling

Mocking overloaded methods and const-qualified versions follows strict syntax rules:

- Always mock **all overloaded variants** to avoid warnings and hiding.
- Use `const` in specs for const methods.

Example:
```cpp
MOCK_METHOD(int, Add, (Element x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));
MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

---

### 3.4 Default Actions and `ON_CALL`

- `ON_CALL` specifications define **default behaviors** but do not set expectations.
- `EXPECT_CALL` defines expectations that enforce method call verification.
- Uninteresting calls without expectations generate warnings by default.

**Impact:**

- Configure default behaviors with `ON_CALL` to avoid uninteresting call warnings where appropriate.
- Add catch-all `EXPECT_CALL`s to explicitly allow expected non-specified calls, e.g. `.Times(AnyNumber())`.

Reference: For detailed guidance, see the [Setting Expectations](docs/gmock_cook_book.md#UseOnCall) section of the cookbook.

---

### 3.5 Deprecation of Legacy Mocking Patterns

Patterns such as:

- Mocking non-virtual methods through related mock classes with wrappers.
- Using manual mock class implementations instead of `MOCK_METHOD` macros.

Are discouraged and may be removed in future releases.

Prefer defining interfaces with virtual methods and using `MOCK_METHOD` in public mock classes.

---

## 4. Migration Guidance

To migrate existing codebases, consider the following steps:

1. **Replace old `MOCK_METHODn` macros** with the modern `MOCK_METHOD` syntax, paying careful attention to qualifiers and call types.
2. **Ensure virtual destructors** are declared in base classes.
3. **Move all `MOCK_METHOD` declarations to `public:`** in your mocks.
4. **Explicitly declare strictness mode** (`NiceMock`, `NaggyMock`, `StrictMock`) on mocks as needed.
5. **Review expectations for correct ordering** and use `.RetiresOnSaturation()` where necessary.
6. **Add or adjust `ON_CALL` default actions** to handle uninteresting calls gracefully.

For detailed examples and explanations, consult the [gMock Cookbook](docs/gmock_cook_book.md) and [Mocking Reference](docs/reference/mocking.md).

---

## 5. Troubleshooting Common Breakage

### Compilation Errors Related to `MOCK_METHOD` Macros

- Errors indicating inability to parse arguments usually arise from unprotected commas in argument types. **Solution:** wrap complex types (e.g., `std::pair<bool, int>`) in parentheses or use type aliases.

### Unexpected Calls or Warnings

- Use `--gmock_verbose=info` to get detailed call traces.
- Consider upgrading test strictness or adding `EXPECT_CALL`s appropriately.

### Virtual Destructor Issues

- Failing heap checkers or crashes during mock object deletion usually indicate missing virtual destructors in interfaces.

### Mock Method Access Errors

- Ensure mocks declare `MOCK_METHOD` macros in `public:` to avoid access errors.

For more help, consult the [Legacy gMock FAQ](docs/gmock_faq.md) and [Troubleshooting & Common Issues](getting-started/troubleshooting-learn/common-setup-issues).

---

## 6. Summary

GoogleMockâ€™s recent breaking changes emphasize cleaner, consistent, and more robust mock declarations and behaviors:

- Removal of legacy `MOCK_METHODn` macros in favor of `MOCK_METHOD`.
- Enforced virtual methods and public mock interface declarations.
- Clearer strictness modes affecting uninteresting call handling.
- Enhanced expectation ordering and lifetime management semantics.

Taking these into account ensures modern, maintainable, and reliable test suites.

---

## 7. Additional Resources

- [gMock Cookbook](docs/gmock_cook_book.md): Detailed recipes and migration examples.
- [Mocking Reference](docs/reference/mocking.md): API documentation and usage details.
- [Legacy gMock FAQ](docs/gmock_faq.md): Troubleshooting common issues and questions.
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md): Quick reference for mocking syntax and best practices.
- [Strictness and Unexpected Calls](api-reference/mocking-apis/strictness-and-unexpected-calls.md): Guidance on handling uninteresting/unexpected calls.

---

<Source url="https://github.com/google/googletest" />
