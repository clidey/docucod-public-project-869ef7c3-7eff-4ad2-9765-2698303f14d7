---
title: "Breaking Changes & Deprecations"
description: "Catalog of significant breaking changes and deprecated functionality for each version, with explanations of their impact and paths forward for your codebases."
---

# Breaking Changes & Deprecations

This page serves as your centralized catalog for significant **breaking changes** and **deprecated functionality** across GoogleTest and GoogleMock versions. It provides clear explanations of the impact of these changes on your existing test codebases and offers practical guidance on how to adapt and migrate safely.

---

## Understanding Breaking Changes and Deprecations

When upgrading GoogleTest and GoogleMock, certain changes may require modifications in your test code. These **breaking changes** indicate features or behaviors that no longer function as before, often necessitating code updates. Conversely, **deprecated features** are those marked for future removal, urging users to migrate sooner rather than later.

This page focuses exclusively on documenting these important transitions to ensure your tests continue to operate reliably.

---

## How to Use This Page

- Identify the version of GoogleTest or GoogleMock you are migrating from and to.
- Review the listed breaking changes and deprecated features relevant to that version.
- Understand the rationale behind each change to grasp its impact.
- Follow the provided migration guidance to update your test code accordingly.

We recommend always reading the respective version's release notes for comprehensive details.

---

## Catalog of Notable Breaking Changes and Deprecations

### General Notes

- GoogleTest and GoogleMock are designed to maintain backwards compatibility as much as possible.
- However, some changes are necessary to improve correctness, usability, or to align with modern C++ standards (currently requiring C++17).
- Before upgrading, please ensure your codebase complies with all interface and behavior changes noted here.

---

### Breaking Changes

#### 1. Dropped Support for C++ Versions Below C++17

- Starting from recent releases, the minimum required C++ standard is C++17.
- This enables the use of modern language features that simplify code and improve performance.

**Impact:**
- Legacy codebases compiling with older C++ standards must be updated.
- Users should ensure their build environment supports C++17 or later.

#### 2. MOCK_METHOD Macro Changes and Best Practices

- The newer `MOCK_METHOD` macro replaces the older `MOCK_METHODn` macros.
- It requires careful use of parentheses around complex argument types to parse correctly.

**Impact:**
- Existing mocks using legacy macros should be migrated for future compatibility.
- A common pitfall is unprotected commas in argument lists causing compilation errors.
  - Solution: wrap such types in extra parentheses or use type aliases.

#### 3. Virtual Destructor Requirement for Mocked Classes

- All classes to be mocked **must have a virtual destructor**.

**Impact:**
- If your base class lacks a virtual destructor, deleting mock objects through base pointers will cause undefined behavior, memory leaks, or crashes.
- Add a virtual destructor to all base classes intended for mocking.

#### 4. Expectation Search Order Is Reverse Chronological

- The search for matching expectations (`EXPECT_CALL`) proceeds from the **newest to the oldest**.

**Impact:**
- Expect more specific expectations to come **after** generic ones to effectively override.
- This design allows setting default mock behaviors early, with specific overrides added later.

#### 5. Sticky Expectations and `.RetiresOnSaturation()` Behavior

- By default, expectations remain active after being satisfied ("sticky").
- To make an expectation retire (deactivate) after reaching its expected call count, use `.RetiresOnSaturation()`.

**Impact:**
- Without `.RetiresOnSaturation()`, exceeding a call count triggers immediate test failure.
- Using `.RetiresOnSaturation()` allows expectations in a sequence or multiple expectations on the same method.

---

### Deprecated Features

#### 1. Old-Style `MOCK_METHODn` Macros

- The family of macros `MOCK_METHOD0`, `MOCK_METHOD1`, etc., are deprecated.
- `MOCK_METHOD` is preferred due to better parsing and extensibility.

**Recommended Action:**
- Migrate to `MOCK_METHOD` where possible for better compatibility and future-proofing.

#### 2. Mocking Non-Virtual Methods

- Direct mocking of non-virtual methods is discouraged and has limited support via template techniques.

**Recommended Action:**
- Refactor such methods to interfaces or use dependency injection where feasible.
- Avoid mocking non-virtual methods unless explicitly supported.

#### 3. Warnings for Uninteresting Calls

- Warnings printed for mock method calls without expectations (`EXPECT_CALL`) are intended behavior.
- The use of `NiceMock` and `StrictMock` controls the severity of such warnings and errors.

---

## Migration Guidance

### Virtual Destructors

If you see heapcheck failures when deleting mocks via base pointers:

```cpp
class Base {
  // Add this to avoid memory leaks
  virtual ~Base() {}
};
```

### Using MOCK_METHOD

Wrap complex argument types containing commas in parentheses:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

Or, use type aliases:

```cpp
typedef std::pair<int, int> IntPair;
MOCK_METHOD(IntPair, GetPair, ());
```

### Expectations and `.RetiresOnSaturation()`

To avoid "sticky" expectation issues when expecting a method to be called several times with different behaviors:

```cpp
using ::testing::InSequence;
...
{
  InSequence seq;
  EXPECT_CALL(mock, Foo()).WillOnce(Return(1)).RetiresOnSaturation();
  EXPECT_CALL(mock, Foo()).WillOnce(Return(2)).RetiresOnSaturation();
}
```

### Handling Uninteresting Calls

If you want to suppress warnings about calls to mock methods without expectations, wrap your mock in `NiceMock`:

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
```

To make such calls errors, use `StrictMock`.

---

## Additional Notes and Best Practices

- Use `ON_CALL` for specifying default behaviors without enforcing call count expectations.
- Use `EXPECT_CALL` only to verify that certain interactions occur.
- To debug why an expectation is not satisfied, run tests with the flag `--gmock_verbose=info` to trace mock calls.
- Beware of Microsoft Visual C++ warnings on mock methods with `const` parameters; simplifying parameter types may help.
- Avoid mocking variadic functions directly; refactor them or wrap them with overloads.

---

## Related Documentation

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) provides recipes for mocking techniques and advanced mocking.
- [Mocking Reference](../reference/mocking.md) covers macros, classes, and detailed mocking APIs.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) is a beginner-friendly tutorial.
- [Expectations and ON_CALL](../reference/mocking-apis/expectations-and-on-call.md) details expectations and default behavior setup.

---

## Resources

- Official GitHub Repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- Legacy FAQ: [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)

---

## Summary
This page ensures that you clearly understand any major changes that could affect your test suites and guides you to adjust your code to maintain test integrity and correctness across GoogleTest and GoogleMock versions.

---

For detailed release notes and version timelines, refer to the [Version Timeline](version-timeline.md) and [What's New](what-s-new.md) pages in the changelog section.
