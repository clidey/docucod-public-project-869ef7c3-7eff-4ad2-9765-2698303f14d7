---
title: "Breaking Changes"
description: "Highlights updates that may require user action—such as modified APIs, required compiler changes, or changed default behaviors. Aimed at helping users anticipate and mitigate disruptions."
---

# Breaking Changes

This page outlines significant changes in GoogleMock that may impact your existing tests and mock implementations. These alterations potentially require you to update your code—such as modifying mock method declarations, adapting to new behaviors around expectations and strictness, or adjusting usage patterns for mock objects and methods.

Understanding these breaking changes will help you anticipate and mitigate disruptions as you upgrade to newer versions of GoogleMock.

---

## 1. Transition from `MOCK_METHODn` to `MOCK_METHOD`

### What Changed
GoogleMock evolved its macro-based mocking interface by introducing the generic `MOCK_METHOD` macro in 2018, which replaced the older family of macros named `MOCK_METHODn` (where `n` corresponds to the number of method parameters). The new macro offers a more consistent and flexible approach to declaring mock methods.

### Why It Matters
Existing mock classes using `MOCK_METHODn` macros will continue to work, but migrating to `MOCK_METHOD` offers several benefits:

- **Cleaner syntax:** `MOCK_METHOD` explicitly separates the return type, method name, and argument list.
- **Improved overload and qualifier support:** It supports `const`, `override`, `noexcept`, call types, and reference qualifiers in a single, uniform syntax.
- **Better compiler compatibility:** The new macro handles tricky cases like unprotected commas in types more gracefully.

### What to Do
- **Migrate old mocks** to use `MOCK_METHOD`:

```cpp
// Old style:
MOCK_METHOD1(Foo, bool(int));

// New style:
MOCK_METHOD(bool, Foo, (int), (override));
```

- **Use the fourth parameter** to specify qualifiers correctly, e.g.,

```cpp
MOCK_METHOD(void, Process, (int), (const, noexcept));
```

- **Wrap types containing commas in extra parentheses** or use type aliases to avoid parsing issues:

```cpp
// Wrap the return type in parentheses
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// Or use a type alias
using BoolIntPair = std::pair<bool,int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```

- **Ensure mock methods are declared in the `public:` section** of your mock class regardless of the base class access level.


## 2. Introduction of Strictness Modifiers for Mocks: `NiceMock`, `NaggyMock`, and `StrictMock`

### What Changed
GoogleMock provides three distinct behaviors regarding uninteresting mock calls (calls to mocked methods without expectations):

- **`NiceMock<T>`:** Suppresses warnings for uninteresting calls, making tests cleaner when calls are expected but not explicitly verified.
- **`NaggyMock<T>`:** The current default behavior that prints warnings for uninteresting calls.
- **`StrictMock<T>`:** Treats uninteresting calls as test failures, enforcing exact verification.

These modifiers wrap your mock classes to control how strictly calls outside expectations are handled.

### Why It Matters
The addition and gradual default shift to `NiceMock` reflect Google’s recommendation to write tests that are less brittle and easier to maintain. However, if your tests rely on the previous default behavior (`NaggyMock`), or if you want to strictly verify all calls, you may need to adjust your mocks accordingly.

### What to Do
- **Choose the strictness level explicitly:**

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

// Use strict mock to enforce expectations on all mocks
StrictMock<MyMock> mock_strict;

// Use nice mock to suppress warnings for calls without EXPECT_CALL
NiceMock<MyMock> mock_nice;
```

- **Avoid nesting strictness modifiers.** `NiceMock<StrictMock<T>>` or vice versa is not supported.

- **Ensure your mock classes have virtual destructors** to avoid issues with strictness wrappers.

- **Remember that strictness modifiers only affect uninteresting calls, not unexpected ones.** Unexpected calls (not matched by any expectation) always cause failures.


## 3. Changes in Default Action and Expectation Rules

### What Changed
- Expectations defined later take precedence (“newer overrides older”) when matching calls.
- When no `Times()` is specified and there are multiple `WillOnce()` or `WillRepeatedly()` actions, GoogleMock infers the cardinality to fit the actions.
- Calls to mock methods without any expectations will:
  - Trigger warnings with `NaggyMock`
  - Be ignored silently in `NiceMock`
  - Cause failures in `StrictMock`

- Expectation retirement behavior can be controlled explicitly with `.RetiresOnSaturation()`.

### Why It Matters
These changes refine how GoogleMock matches calls with expectations, improving flexibility but also risking surprising behaviors if your tests assume a different matching order or behavior.

### What to Do
- **Review your `EXPECT_CALL`s order and use chaining appropriately:**

```cpp
EXPECT_CALL(mock, Foo())
    .WillOnce(Return(1))
    .WillOnce(Return(2));
```

- **Explicitly specify `.RetiresOnSaturation()` when needed to disable repetitive matching of saturated expectations.
- Use `ON_CALL()` for setting default behaviors without imposing call expectations.


## 4. Overloads and Qualifiers in Mock Methods

### What Changed
The new mocking syntax fully supports:

- Overloading methods based on argument count, types, and constness.
- Reference-qualified methods (`&`, `&&`), `noexcept`, and Windows-specific calling conventions (`Calltype(STDMETHODCALLTYPE)`).

### Why It Matters
Complex interfaces with overloads and special qualifiers can now be mocked more precisely and correctly.

### What to Do
- **Use `MOCK_METHOD` with appropriate qualifiers:**

```cpp
MOCK_METHOD(int, OverloadedMethod, (), (override));
MOCK_METHOD(int, OverloadedMethod, (int), (const, override));
```

- **For reference qualifiers:**

```cpp
MOCK_METHOD(int, DoSomething, (), (const, ref(&), override));
MOCK_METHOD(int, DoSomething, (), (const, ref(&&), override));
```

- **For Windows calling conventions, specify `Calltype`:**

```cpp
MOCK_METHOD(void, Func, (), (Calltype(STDMETHODCALLTYPE), override));
```

- If your compiler produces warnings about const parameters, consider removing top-level `const` on parameters since it's ignored in C++.


## 5. Mocking Move-Only Types

### What Changed
GoogleMock now supports mocking methods that accept and return move-only types (e.g., `std::unique_ptr`). This is a vital addition for modern C++ codebases.

### Why It Matters
You can now directly mock interfaces using move-only types without complex workarounds.

### What to Do
- Use `MOCK_METHOD` as usual with move-only types:

```cpp
MOCK_METHOD(std::unique_ptr<MyClass>, Create, (int x), (override));
```

- For return values, avoid `Return(std::move(...))` in `WillRepeatedly()`. Instead, use lambdas that create new objects each invocation.

- When mocking methods that take move-only arguments, prefer lambdas or functors for defining actions.

- Legacy workarounds using proxy mock methods for move-only types are no longer necessary but can still be used.


## 6. Mocking Expectations, Logging, and Diagnostics Improvements

### What Changed
- Added finer control over expectation chaining, with `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` modifiers.
- Enhanced diagnostics for uninteresting and unexpected calls, including stack traces and detailed matching explanations when using `--gmock_verbose=info`.
- Revised error messages and warnings for more clarity.

### Why It Matters
These changes help create more robust, informative, and maintainable tests.

### What to Do
- Enable verbose logging when troubleshooting with `--gmock_verbose=info`.
- Use sequences (`Sequence` and `InSequence`) and dependencies (`After`) to specify call order requirements.
- Appropriately combine `ON_CALL` and `EXPECT_CALL` to separate default behavior and verification.


## 7. Deprecated or Removed Features

- Old `MOCK_METHODn` macros are still supported but superseded by `MOCK_METHOD`.
- Nesting of strictness wrappers is unsupported and discouraged.
- Some legacy macros for call types are deprecated in favor of unified syntax.


## Troubleshooting Common Issues Related to Breaking Changes

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Compilation Failures with MOCK_METHOD">
If you encounter compilation errors related to commas in types, wrap return types or argument types containing commas with an additional set of parentheses or use type aliases.
</Accordion>
<Accordion title="Warnings About Uninteresting Calls">
If tests flood with warnings about uninteresting calls, consider using `NiceMock` to suppress them or explicitly specify expectations with `.Times(AnyNumber())`.
</Accordion>
<Accordion title="Tests Failing Due to Unexpected Calls">
Unexpected calls that violate expectations cause failures; review your expectations and consider adding catch-all `EXPECT_CALL` with wildcard matchers to allow untested calls.
</Accordion>
<Accordion title="Issues with Overloaded Methods">
Use the `Const()` wrapper or explicit casts to disambiguate overloaded method expectations.
</Accordion>
</AccordionGroup>


## Summary

This page focuses exclusively on breaking changes related to GoogleMock's mocking and expectation features, guiding you to adapt your tests and mocks when upgrading.

Key topics include:

- Migration from `MOCK_METHODn` to the generic `MOCK_METHOD` macro
- Use and impact of strictness modifiers: `NiceMock`, `NaggyMock`, and `StrictMock`
- Updated rules for expectation matching and call order
- Full support for overloads, qualifiers, and call types
- Enhanced mocking for move-only types
- Improved diagnostics and logging behavior
- Known deprecated features and migration recommendations

For detailed examples and deeper guidance, please consult the [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md), the [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md), and the [FAQ on mocking challenges](https://github.com/google/googletest/blob/main/docs/gmock_faq.md).

---

<Note>
Always review your existing test suites to identify mocks and expectations affected by these changes and incrementally apply the recommended fixes to ensure test stability and maintainability.
</Note>

---

## Resources

- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [Legacy gMock FAQ](https://github.com/google/googletest/blob/main/docs/gmock_faq.md)
- [Mocking Strategies and Strictness Guide](https://github.com/google/googletest/blob/main/concepts/mocking-strategies-extensibility/strictness-and-behavior.md)

---

## Additional Tips

- To leverage new mocking features with minimal disruption, consider:
  - Starting with new mocks using `MOCK_METHOD` and strictness wrappers.
  - Gradually migrating legacy mocks.
  - Keeping your tests as declarative and focused on behavior rather than implementation specifics.

- Use `ON_CALL()` for setting default mock behaviors and reserve `EXPECT_CALL()` for asserting specific interactions.
- Utilize sequence and order modifiers (`InSequence`, `After`) judiciously to verify call ordering without making tests brittle.

---

For a comprehensive overview of all recent changes, see the [Recent Changes Changelog](https://github.com/google/googletest/blob/main/docs/changelog/recent-changes.md).

---

All URLs point to the official [GoogleTest GitHub repository](https://github.com/google/googletest).
