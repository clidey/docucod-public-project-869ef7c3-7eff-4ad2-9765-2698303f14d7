---
title: "Upgrade Instructions & Best Practices"
description: "Step-by-step recommendations and practical guidance for upgrading to newer versions of GoogleTest and GoogleMock. Includes preparation tips, checks for code compatibility, and strategies to validate successful migration."
---

# Upgrade Instructions & Best Practices for GoogleMock

This documentation provides detailed, step-by-step guidance focused specifically on upgrading to newer versions of GoogleTest and GoogleMock. It includes preparation steps, compatibility checks, migration strategies, and validation techniques to ensure a smooth and successful transition when adopting new releases of the mocking framework.

---

## 1. Preparing for the Upgrade

Upgrading GoogleMock requires careful preparation to minimize disruptions and ensure compatibility with your existing test code:

- **Review the Current Version:** Identify the GoogleMock and GoogleTest versions currently in your project.
- **Backup Your Test Code:** Always back up your test projects and dependencies before starting the upgrade.
- **Read the Release Notes:** Check for any breaking changes, deprecated APIs, or relevant new features in the target version.
- **Check Compiler Compatibility:** Ensure your compiler supports at least C++17, as required by version 1.17.x and later.

<Tip>
Ensure your build environment supports the required C++ standard (C++17 or newer) to avoid compilation errors during upgrade.
</Tip>

## 2. Verifying Code Compatibility

Before upgrading, verify that your existing mock classes and tests conform to the updated GoogleMock APIs and recommended usage patterns:

- **MOCK_METHOD Macro Usage:**
  - Confirm that `MOCK_METHOD` macros are used in the `public:` section of mock classes regardless of the access level of base methods.
  - Wrap arguments containing commas in parentheses or define type aliases to avoid parsing errors.
- **Mock Strictness Wrappers:** Consider usage of `NiceMock`, `NaggyMock`, or `StrictMock` to control uninteresting call warnings after upgrade.
- **Overloaded and Template Methods:** Check if overloaded or templated mock methods are declared properly with the updated macro signatures.
- **Deprecations:** Avoid old-style `MOCK_METHODn` macros; migrate to the modern `MOCK_METHOD` macro with signature splitting.

<Warning>
Failing to wrap template or comma-containing argument types in parentheses in `MOCK_METHOD` causes compilation errors.
</Warning>

## 3. Upgrade Workflow and Migration Steps

Follow this recommended workflow to upgrade seamlessly:

### 3.1 Update GoogleMock and GoogleTest Dependencies

- Update your project import or package version references to the target GoogleTest/GoogleMock release.
- For CMake builds, ensure linking against the correct libraries (e.g., `gmock_main`, `gmock`) and verify the CMake pkg-config files reflect the new version.
- Validate that your build environment respects threading flags such as `GTEST_HAS_PTHREAD`.

### 3.2 Migrate Mock Class Definitions

- Replace any usage of legacy `MOCK_METHODn` macros with the newer `MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers...))` format.
- Simplify complex types in macro arguments using aliases or explicit parentheses.
- Add `(override)` and other qualifiers such as `(const)`, `(noexcept)` as needed to precisely match base methods.

Example:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, IsReady, (), (const, override));
  MOCK_METHOD(std::pair<int, double>, GetPair, (int a, int b));
};
```

### 3.3 Adjust Mock Strictness Semantics

- Decide which mock strictness mode fits your tests after upgrade:
  - **NiceMock** suppresses warnings on uninteresting calls and causes fewer failures from unexpected calls.
  - **NaggyMock** (default) warns on uninteresting calls but continues.
  - **StrictMock** fails tests on uninteresting calls.
- Wrap your mock declarations accordingly to maintain expected test behavior:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, IsReady()).Times(1);
```

<Tip>
Migrating to `NiceMock` is recommended in most cases unless test rigor requires strict enforcement of all calls.
</Tip>

### 3.4 Verify Expectations and Matchers

- Review all `EXPECT_CALL` and `ON_CALL` statements for argument matcher correctness.
- Ensure that partial or variadic matchers and complex argument compositions are compatible with any changes in matcher semantics.
- Confirm that uninteresting calls, parameterless expectations, and ordered calls are updated to reflect changed defaults or new options.

### 3.5 Update Custom Matchers and Actions

- If you use custom matchers or actions, verify their compatibility with any new matcher or action interfaces.
- Use polymorphic matchers or parameterized macros where applicable for maintainability.

### 3.6 Testing the Upgrade

- Run all tests and observe for failures related to mock calls.
- Use `--gmock_verbose=info` flag during test runs to gain detailed insights into mock call matching and expectation verification.
- Adjust expectations or strictness modes as necessary.
- Where failures arise due to changed behavior, consult the breaking changes section in release notes to understand necessary code modifications.

## 4. Best Practices for Smooth Upgrades

To ensure your migration stays robust and maintainable:

- **Use Modern Macros:** Standardize all new mocks to use the current `MOCK_METHOD` macro.
- **Consistent Qualifiers:** Always include qualifiers like `const` and `override` for overridden virtual methods for clarity and compiler enforcement.
- **Control Strictness Explicitly:** Prefer `NiceMock` in large codebases to reduce brittle test failures, especially during refactors.
- **Centralize Type Aliases:** Use `using` aliases for complex types passed to mock methods to simplify macro declarations and improve readability.
- **Validate Mock Object Lifecycles:** Confirm proper destruction or use of `Mock::VerifyAndClearExpectations()` to enforce expectations on mocks not destructed due to unusual ownership.
- **Leverage Sequences and Ordering:** Use `InSequence()` and expectations ordering clauses to handle complex interaction scenarios.

## 5. Common Pitfalls and Troubleshooting

### Compilation Errors
- **Parsing failure of `MOCK_METHOD` macro** due to unwrapped commas.
- **Missing `override` qualifier** causing warnings or errors in stricter compiler modes.
- **Incompatible C++ standards** (must be C++17 or above).

### Runtime Issues
- **Uninteresting call warnings/failures:** Adjust mock strictness modes or add missing `EXPECT_CALL`.
- **Order mismatch failures:** Use `InSequence` or `After` clauses to enforce call order clearly.
- **Incorrect matcher usage:** Double-check complex matchers and argument references.

### Test Flakiness
- **Multi-threading pitfalls:** Ensure mock configuration and expectations are set before accessing mocks across threads.
- **State-dependent mock behavior:** Use `InSequence` or explicit state variables to simulate realistic mock dynamics.

<Tip>
If tests behave unexpectedly, rerun with `--gmock_verbose=info` to trace exact mock interactions and expectation violations.
</Tip>

## 6. Validating a Successful Upgrade

Confirm the upgrade by:

- Running all test suites with zero unexpected failures or warnings.
- Confirming existing tests cover new behavior or changed APIs adequately.
- Optionally, running tests using multiple strictness wrappers (`NiceMock`, `StrictMock`) for incremental hardening.
- Verifying build completes without errors related to thread flags, compiler mismatches, or macro uses.

## 7. Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — for practical recipes on using mocks.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — covers mock setup and expectations.
- [Mock Strictness Modes](https://google.github.io/googletest/guides/mocking-scenarios/mock-strictness-best-practices.html) — detailed guide on `NiceMock`, `NaggyMock`, and `StrictMock`.
- [Release Notes & Changelog](https://github.com/google/googletest/releases) — check for specific upgrade notes.

---

For further guidance, always align with your project's testing goals and codebase maturity. Leveraging GoogleMock's full strengths will ensure manageable, readable, and resilient test suites.

---

<Info>
For issues upgrading, visit the [GoogleTest GitHub Issues](https://github.com/google/googletest/issues) to see if others have encountered similar challenges or to ask for assistance.
</Info>

<Source url="https://github.com/google/googletest" />
