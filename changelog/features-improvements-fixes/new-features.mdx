---
title: "New Features & Enhancements"
description: "A showcase of newly added features, enhancements, and user experience improvements in each release—highlighting practical examples or sample usage where appropriate. Stay informed about ways to level up your testing capabilities."
---

# New Features & Enhancements

Explore the latest additions and improvements within GoogleMock’s mocking framework. This page highlights newly introduced features, enhancement details, and user experience optimizations in each release, designed to empower your C++ testing workflows with practical examples and refined capabilities.

---

## Highlights of Recent Features and Enhancements

### Streamlined Mock Method Declarations with `MOCK_METHOD`
GoogleMock continues to advance the usability of the `MOCK_METHOD` macro, simplifying mock method declarations. Key improvements facilitate mocking:

- Methods with complex signatures, including templated and overloaded functions.
- Use of qualifiers like `const`, `override`, `noexcept`, as well as calling conventions via `Calltype(...)` for platform-specific needs.
- Handling of methods with argument lists that contain commas, through explicit parentheses wrapping or type aliases.

This update improves clarity and reduces common compile errors, enabling smoother mock class definitions.

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Compute, (std::pair<int, int>), (override));
  MOCK_METHOD(void, Process, (const std::map<int, std::string>&), (override));
};
```

### Enhanced Control over Mock Call Expectations with `EXPECT_CALL`
The `EXPECT_CALL` API has been refined to allow more expressive and controlled expectations:

- **Flexible Cardinalities**: Use built-in cardinalities like `AnyNumber()`, `AtLeast(n)`, and `Exactly(n)` to precisely specify call counts.
- **Argument Matching**: Combine individual argument matchers with `.With()` for multi-argument constraints, allowing complex relation checks between arguments.
- **Sequence and Ordering Clauses**:
  - `InSequence(...)` for ordered expectations.
  - `After(...)` for partial ordering or dependency between calls.
- **Action Specification**: Chain multiple `.WillOnce()` and a single `.WillRepeatedly()` to define varying behaviors across calls.
- **RetiresOnSaturation()** clauses for automatically marking expectations inactive when saturated, preventing unintended matching after upper bounds.

Example:

```cpp
EXPECT_CALL(mock_obj, SaveData(_, _))
    .With(Lt())  // Example multi-argument matcher
    .Times(Exactly(3))
    .InSequence(s1)
    .WillOnce(Return(true))
    .WillRepeatedly(Return(false));
```

### Default Behavior Customization Using `ON_CALL`
`ON_CALL` is now more ergonomically designed to define default mock behaviors without enforcing call expectations:

- You can specify multi-argument matcher constraints using `.With()`.
- Ensure the default behavior with exactly one `.WillByDefault()` clause.
- Facilitate layering of default behaviors that can be selectively overridden by `EXPECT_CALL` clauses.

Example usage for setting default behavior:

```cpp
ON_CALL(mock_obj, Compute(_))
    .WillByDefault(Return(-1));
```

### Mock Strictness Tiers: `NiceMock`, `NaggyMock`, and `StrictMock`
Refinements in strictness wrappers allow you to choose the most fitting policy for test stability and verbosity:

- **NiceMock**: Suppresses warnings on unexpected (uninteresting) calls, ideal for reducing noise in tests not tightly verifying all interactions.
- **NaggyMock (Default)**: Emits warnings for uninteresting calls, allowing detection of potential test omissions.
- **StrictMock**: Converts uninteresting calls to test failures, enforcing strict interaction verification.

These wrappers inherit from the original mock class seamlessly, preserving constructor support and enabling you to call methods just like the base mock.

Example:

```cpp
NiceMock<MockClass> nice_mock; // Ignored uninteresting calls
StrictMock<MockClass> strict_mock; // Fails on uninteresting calls
```

### Advanced Use Cases

- **Mocking Non-Virtual Methods:** GoogleMock supports mocking non-virtual methods using standalone mock classes unrelated to the original class. This technique enables mocking via templates to substitute production code with mocks at compile time.

- **Delegating Calls:** Easily delegate mock method behaviors either to a real object or a fake:

```cpp
ON_CALL(*mock_obj, SomeMethod(_))
    .WillByDefault([this](ArgType arg) { return real_obj_.SomeMethod(arg); });
```

- **Custom Matchers and Actions:** Users can extend GoogleMock by defining expressive custom matchers with `MATCHER` macros or custom actions for complex side effects or return behaviors. These empower more readable and maintainable tests by encoding domain-specific constraints.

### Increased Thread-Safety and Performance
Mock method invocations and expectation matching are fully thread-safe. Locking strategies ensure consistent behavior even in concurrent test environments. Performance optimizations include deferred deletion of default actions to avoid deadlocks and reduced compilation times by moving mock class constructors and destructors outside header bodies.

---

## Practical Tips and Best Practices

### Using `EXPECT_CALL` Wisely
- Set expectations *before* exercising code.
- Use `ON_CALL` to define default behaviors without verifying calls.
- Prefer setting broad expectations (e.g., `.Times(AnyNumber())`) when you want to ignore calls.
- Use sequences (`InSequence`) or partial orders (`After`) to express order relations in complex interactions.
- Use `.RetiresOnSaturation()` for expectations with limited invocations to prevent oversaturation errors.

### Simplifying Complex Method Signatures
Refactor or delegate complicated method signatures in mocks for usability, for example:

```cpp
void ComplexMethod(int a, float b, std::string s) override {
  MockComplexMethod(a, s);
}
MOCK_METHOD(void, MockComplexMethod, (int, const std::string&));
```

This approach reduces the burden of specifying matchers or expectations on lengthy argument lists.

### Troubleshooting Common Pitfalls
- Ensure virtual destructors on mocked classes to avoid memory issues.
- Beware of hiding base class methods when mocking overloaded functions; use `using Base::Method;` if necessary.
- Avoid ambiguities with overloaded methods by explicitly specifying argument matchers or using `Const()` to disambiguate const-overloads.
- For methods involving move-only types, prefer lambdas or callable objects in `WillOnce` and `WillRepeatedly` actions instead of `Return`.

---

## Resources and Further Reading

- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md): Comprehensive API reference for mocks, including macros, classes, and usage examples.
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md): Practical recipes and detailed guides to get the most out of GoogleMock.
- [gMock for Dummies](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md): A beginner-friendly introduction to mocking concepts and APIs.
- [Mock Strictness and Lifecycle Guide](https://github.com/google/googletest/blob/main/guides/mocking-patterns/mock-strictness-lifecycle.md): Learn about mock strictness and managing mock lifetimes.
- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-api/matchers.md): Detailed documentation on matchers for matching mock method arguments.
- [Actions Reference](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-api/actions.md): How to specify mock method behaviors and side effects.

---

By staying informed about these advancements, you can craft more robust, maintainable, and expressive unit tests, leveraging GoogleMock’s enhanced capabilities to accelerate your C++ test-driven development.

---

*For a broader understanding of the entire GoogleTest and GoogleMock ecosystem, consider exploring [Feature Summary](../overview/features-workflows/feature-summary), [Quickstart Workflow](../overview/features-workflows/quickstart-workflow), and [Mocking Architecture Overview](../concepts/core-architecture/mocking-architecture-overview).*

---