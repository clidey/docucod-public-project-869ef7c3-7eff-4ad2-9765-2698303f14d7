---
title: "Breaking Changes"
description: "Summarizes all changes that may disrupt existing code, including removals, deprecated features, and behavioral changes in major releases. Each change includes migration notes and references to affected core files."
---

# Breaking Changes

This page summarizes all changes that may disrupt existing code when upgrading major versions of GoogleTest and GoogleMock. It focuses on removals, deprecated features, and behavioral changes that require user attention. Each breaking change includes migration notes and references to affected core files to guide users through the upgrade process safely and efficiently.

---

## Understanding Breaking Changes

Breaking changes are modifications in the API or behavior that can cause existing test code to fail to compile or behave differently. These changes typically occur in major version releases and require careful review and adjustment of your test code.

**Why pay attention to this page?**

- To avoid runtime errors or compilation failures after upgrading.
- To know exactly which functions or macros are affected.
- To follow recommended migration paths to maintain test stability.

---

## Categories of Breaking Changes

### 1. Deprecations and Removals

Features that have been deprecated in previous versions may be removed.
Users should replace deprecated usages with recommended alternatives.

### 2. Behavioral Changes

Changes in default behaviors or semantics that can affect test outcomes.
Examples include changes in mock matching rules or default return values.

### 3. API Signature Changes

Altered function signatures, modified macro arguments, or removed overloads that require code updates.

---

## Important Breaking Changes in Recent Major Releases

### Change: New `MOCK_METHOD` Macro Signature

The `MOCK_METHOD` macro was updated to a new signature that better supports modern C++ features like move-only types and ref qualifiers.

**Impact:**
- Existing mock declarations using the old `MOCK_METHODn` family macros should migrate to the new `MOCK_METHOD` macro.
- Wrapping return and argument types containing commas with parentheses may be needed to prevent parsing errors.

**Migration Tip:**
- Replace `MOCK_METHODn` macros with `MOCK_METHOD`.
- If your argument types include commas (e.g., `std::pair<int, int>`), write:

  ```cpp
  MOCK_METHOD((std::pair<int, int>), MethodName, ());
  ```

**Affected Files:**
- Core mocking header files (e.g., `gmock/gmock.h`)

---

### Change: Mock Strictness Handling Refinements

The behavior and interaction of `NiceMock`, `NaggyMock`, and `StrictMock` wrappers around mock objects have been refined to improve clarity and reduce unexpected failures.

**Impact:**
- Tests relying on implicit behaviors of mocks may see differences in warnings or failures.

**Migration Tip:**
- Explicitly specify mock strictness where needed.
- Use `NiceMock<YourMock>` to suppress uninteresting call warnings.
- Use `StrictMock<YourMock>` to enforce strict call expectations.

**Related Reading:**
- [Managing Mock Strictness](../api-reference/mocking-framework/nice-strict-mocks.md)

---

### Change: Enhanced Matchers and `SafeMatcherCast` Behavior

The function `SafeMatcherCast<T>(matcher)` now enforces stricter type safety rules to prevent runtime mismatches.

**Impact:**
- Some implicit casts that previously worked might now produce compile errors.

**Migration Tip:**
- Review and update matcher casts to meet the enforced requirements.
- Use explicit matcher conversions where needed.

**Affected Files:**
- `gmock/gmock-matchers.h`,
- Matcher implementation headers

---

### Change: Default Return Values and Actions Behavior

Default actions for mock methods returning complex or move-only types have changed to improve safety.

**Impact:**
- Mock methods returning move-only types like `std::unique_ptr` now require explicit `WillOnce` or `WillRepeatedly` clauses specifying return behavior.

**Migration Tip:**
- Use lambdas or `Return()` with freshly constructed values to define mock return behavior.

Example:

```cpp
EXPECT_CALL(mock, MakeBuzz("hello"))
    .WillOnce([](StringPiece text) { return std::make_unique<Buzz>(); });
```

**See Also:**
- [Mocking Methods That Use Move-Only Types](../docs/gmock_cook_book.md#MockingMethodsThatUseMoveOnlyTypes)

---

### Change: Removal of Legacy `MOCK_METHODn` Macros

The old `MOCK_METHODn` macros are deprecated and removed in the latest major releases.

**Impact:**
- Codebases using legacy macros must switch to the modern `MOCK_METHOD` macro syntax.

**Migration Tip:**
- Update all mock method declarations.
- Follow the new syntax as shown in this page and related mocking reference.

---

### Change: Strict Enforcement of Mock Method Declaration Location

Mock methods must be declared in the `public:` section of the mock class, regardless of whether the original method in the base class is `public`, `protected`, or `private`.

**Impact:**
- Changing the access level of mock methods in mock classes to `public` is mandatory.

**Migration Tip:**
- Review mock class definitions and move all `MOCK_METHOD` declarations into the `public:` section.

---

## Migration Approach

To upgrade your test code smoothly:

1. **Audit Your Mock Classes:**
   - Replace old `MOCK_METHODn` macros with the new `MOCK_METHOD` macro.
   - Wrap types containing commas with parentheses in `MOCK_METHOD`.
   - Ensure all mock methods are declared `public`.
2. **Set Explicit Default Actions:**
   - For move-only return types, specify `.WillOnce()` or `.WillRepeatedly()` with lambdas or factories.
3. **Review Strictness Modifiers:**
   - Use `NiceMock` or `StrictMock` wrappers appropriately for desired warning behavior.
4. **Update Matchers:**
   - Modify usages of `SafeMatcherCast` to follow the new strict typing.
5. **Test Thoroughly:**
   - Build and run your tests with increased verbosity (`--gmock_verbose=info`) to catch hidden issues.
6. **Consult Related Documentation:**
   - Review related pages in the Mocking Reference and gMock Cookbook for detailed guidance.

---

## Troubleshooting Common Issues

- **Compilation Errors After Upgrade:** Often related to missing parentheses in `MOCK_METHOD` or incorrect access level of mock methods.
- **Unexpected Test Failures:** Enable verbose logging with `--gmock_verbose=info` to trace mock calls and matcher selections.
- **Uninteresting Call Warnings:** Use `NiceMock` or explicitly add catch-all expectations with `.Times(AnyNumber())`.
- **Mocking Move-Only Types:** Ensure proper default actions or use lambda expressions to return fresh values each call.

---

## References and Further Reading

- [Mocking Reference](../docs/reference/mocking.md)
- [gMock Cookbook](../docs/gmock_cook_book.md)
- [gMock for Dummies](../docs/gmock_for_dummies.md)
- [Argument Matchers Documentation](../api-reference/advanced-features-and-configuration/matchers.md)
- [Mock Strictness and Management](../api-reference/mocking-framework/nice-strict-mocks.md)
- [Migration & Upgrades FAQ](../faq/troubleshooting-integration/migration-and-upgrades.md)

---

### Related Core Files

The following core files may be involved in breaking changes and migrations:
- `include/gmock/gmock-matchers.h`
- `include/gmock/gmock.h`
- `include/gmock/gmock-actions.h`
- `include/gmock/gmock-generated-actions.h`

---

### For Developers

Regularly consult this page before upgrading to a new major version to avoid surprises in your test suites and CI pipelines. Adoption of the migration steps and careful review of warnings will ensure test continuity and maintainable test code.

---