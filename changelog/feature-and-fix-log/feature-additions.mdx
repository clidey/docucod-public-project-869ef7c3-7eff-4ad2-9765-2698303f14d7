---
title: "New Features & Improvements"
description: "Summarizes the latest features and enhancements to the GoogleTest and GoogleMock frameworks. Explains how these changes empower new workflows, improve developer ergonomics, or add new supported scenarios."
---

# New Features & Improvements

This page highlights the latest features and improvements introduced to the GoogleTest and GoogleMock frameworks. These enhancements empower users with more flexible testing workflows, improved developer ergonomics, and broadened support for complex mocking scenarios.

---

## 1. Enhancements in Mocking Facilities

### Improved `MOCK_METHOD` Macro Flexibility

- The generic `MOCK_METHOD` macro now robustly supports methods with complex signatures including those with move-only types and methods having qualifiers such as `const`, `noexcept`, and reference qualifiers.
- Offers better support for mocking overloaded and template methods, facilitating cleaner mock class definitions.

### Richer Qualifier Support

- You can specify method qualifiers within the `MOCK_METHOD` macro, such as `const`, `override`, `noexcept`, and `Calltype(...)` for calling conventions (particularly beneficial on Windows).
- This allows precise matching of method signatures and enhances compatibility with modern C++ constructs.

### Delegation Patterns

- GoogleMock now has streamlined patterns for delegating calls to either a fake implementation or the real object, enabling hybrid testing approaches.
- This lets users reuse complex fake logic while still tracking interactions through mocks.

### Better Handling of Move-Only Types

- Natively supports mocking methods accepting or returning move-only types like `std::unique_ptr`, simplifying tests that depend on modern C++ practices.
- Users can now specify actions with lambdas to handle move-only semantics cleanly.

### Mock Classes for Non-Virtual Methods

- Introduces patterns to mock non-virtual methods by defining unrelated mock classes with matching signatures, expanding mock capabilities to cover more cases.

## 2. Enhanced Expectation and Behavior Control

### Expectation Ordering and Sequencing

- Advanced support for full and partial ordering of expectation calls using `InSequence`, `Sequence` and `After` clauses helps express accurately ordered or partially ordered call graphs.
- `RetiresOnSaturation()` clauses have been improved to retire expectations when saturated, avoiding unexpected repeated call errors.

### Richer Matchers and Argument Validation

- New mechanisms support matching multiple arguments as a tuple with the `.With()` clause, allowing complex constraints across multiple parameters.
- Enhanced support for safe casting and combining of matchers helps express more precise and correct argument expectations.

### Actions Flexibility

- Multiple actions can be chained using `DoAll()`, allowing mock methods to perform side-effects and return values in a single expectation.
- Support for invoking callable arguments (`InvokeArgument`) or lambdas with partial or no arguments (`InvokeWithoutArgs`) enables fine-grained stub behavior.

## 3. Improved Default Action and Behavior Modifiers

### Using `ON_CALL` to Set Default Behaviors

- Encourages using `ON_CALL` for defining default actions instead of overusing `EXPECT_CALL`, resulting in less brittle, more flexible tests.

### Nice, Naggy, and Strict Mocks

- Introduced `NiceMock`, `NaggyMock`, and `StrictMock` wrappers let users control how uninteresting calls are handled â€“ by suppressing warnings, emitting warnings, or treating them as failures respectively.

### DefaultValue<T> Enhancements

- `DefaultValue<T>` allows setting global default return values for types not supported automatically, improving test consistency and reducing boilerplate.

## 4. Better Diagnostics and Verbosity Controls

- New command-line flags and settings allow controlling verbosity of mock call logging (`--gmock_verbose`), enabling detailed call traces and context for debugging failed expectations.
- Improved error messages explain unmet expectations, ordering faults, unsatisfied prerequisites, and unexpected calls with actionable details.

## 5. Optimizations and Usability

### Compilation Optimizations

- Guidance for reducing large mock class compilation times by moving constructor and destructor definitions to `.cc` files helps maintain large codebases.

### Matchers and Actions as Reusable Objects

- Matchers and actions are lightweight and copyable; encouraging sharing complex matchers and actions amongst multiple expectations improves code clarity and efficiency.

### Legacy Support and Migration Path

- Legacy `MOCK_METHODn` macros are supported but users are urged to migrate to the modern `MOCK_METHOD` syntax for improved features and clarity.

## 6. Sample Usage Highlights

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(int, ComplexMethod, (const std::unique_ptr<Bar>& bar), (override));
  MOCK_METHOD(void, SetValue, (int x), (override));
};

using ::testing::Return;
using ::testing::_; // wildcard matcher

TEST(Example, MultipleReturnValues) {
  MockFoo mock;
  EXPECT_CALL(mock, ComplexMethod(_))
      .WillOnce(Return(10))
      .WillOnce(Return(20))
      .WillRepeatedly(Return(30));

  EXPECT_EQ(10, mock.ComplexMethod(nullptr));
  EXPECT_EQ(20, mock.ComplexMethod(nullptr));
  EXPECT_EQ(30, mock.ComplexMethod(nullptr));
}
```

```cpp
using ::testing::InSequence;

TEST(Example, OrderedCalls) {
  MockFoo mock;
  {
    InSequence s;
    EXPECT_CALL(mock, SetValue(1));
    EXPECT_CALL(mock, SetValue(2));
    EXPECT_CALL(mock, SetValue(3));
  }
  mock.SetValue(1);
  mock.SetValue(2);
  mock.SetValue(3);
}
```

---

### References

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [GoogleTest Overview](https://google.github.io/googletest/overview.html)
- [Breaking Changes](https://google.github.io/googletest/changelog/migrations-upgrades/breaking-changes.html)
- [Upgrade Guide](https://google.github.io/googletest/changelog/migrations-upgrades/upgrade-guide.html)

### Troubleshooting & Best Practices

- Prefer `ON_CALL` to define default mock behavior and `EXPECT_CALL` only when verifying call counts or argument matching.
- Use the macro `MOCK_METHOD` in the public section of mock classes even when mocking protected/private methods.
- When mocking move-only types, use lambdas for defining actions to avoid move-semantic pitfalls.
- Use `NiceMock` or `StrictMock` wrappers to control strictness and verbosity of warnings on uninteresting calls.

### Next Steps

- Explore advanced matcher and action usage to implement custom behaviors.
- Use tools for sequencing and call ordering to verify complex interaction flows.
- Integrate GoogleMock in your CI pipelines with appropriate verbosity and leak detection.
