---
title: "Breaking Changes & Deprecations"
description: "Documents all breaking changes, removed APIs, and deprecated behaviors in a concise, discoverable format. Includes practical details on code impacts and links to mitigation strategies."
---

# Breaking Changes & Deprecations

This page documents all breaking changes, removed APIs, and deprecated behaviors in GoogleTest and GoogleMock. It provides users with clear information on how the changes impact existing code, what has been removed or altered, and actionable guidance on upgrading and mitigating migration challenges.

---

## 1. Overview

Over time, some APIs and behaviors in GoogleMock evolve to improve usability, correctness, or maintainability. This page consolidates all such breaking changes and deprecations that affect users working with mocks, tests, and expectations.

### Key User Impacts

- Some macros and methods have changed signatures or semantics.
- Certain deprecated constructs will be removed in future releases.
- Migration instructions are provided when applicable.


## 2. Breaking Changes

### 2.1 Migration from Old-Style Mocking Macros to `MOCK_METHOD`

GoogleMock has deprecated the older `MOCK_METHODn` macros in favor of the unified `MOCK_METHOD` macro introduced in 2018. The key reasons and guidance include:

- **Unified Syntax:** `MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers))` replaces the older style.
- **Support for Method Qualifiers:** The new macro supports `const`, `override`, `noexcept`, `Calltype()`, and reference qualifiers.
- **Fixes Issues with Argument Parsing:** Properly handles complex types with commas by requiring parentheses or type aliases.

Users should update mock classes as follows:

```cpp
// Old style
MOCK_METHOD1(Foo, bool(int));

// New style
MOCK_METHOD(bool, Foo, (int), ());
```

This change improves compile-time errors and consistency.


### 2.2 Mock Method Requirement: Placement in Public Section

Irrespective of the access modifier in the base class, mock methods defined with `MOCK_METHOD` **must be placed in the public section** of the mock class. This allows `EXPECT_CALL` and `ON_CALL` to reference the mock methods correctly. Failure to follow this rule will result in compilation or linkage errors.

Example:

```cpp
class Foo {
 protected:
  virtual void DoWork() = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoWork, (), (override));
};
```


### 2.3 Handling Complex Types in Mock Method Parameters and Return Types

If your mocked method has argument or return types containing commas, such as `std::pair<int, int>`, you must either:

- Enclose the type in parentheses in `MOCK_METHOD` to avoid parsing issues:

  ```cpp
  MOCK_METHOD((std::pair<int, int>), GetPair, (), (override));
  ```

- Or define a typedef/using alias and use it:

  ```cpp
  using IntPair = std::pair<int, int>;
  MOCK_METHOD(IntPair, GetPair, (), (override));
  ```


### 2.4 Strict Requirement for Virtual Destructors in Mocked Classes

To avoid undefined behavior and enable proper cleanup, your base classes must declare **virtual destructors** when mocking classes. Without a virtual destructor:

- Destructors of derived mock classes won't be called.
- Memory leaks or corruption can occur.

Example fix:

```cpp
class Foo {
 public:
  virtual ~Foo() = default;  // Mark destructor virtual
  ...
};
```


### 2.5 Behavior Changes in StrictMock and NiceMock

- `StrictMock<T>` now treats *uninteresting calls* (calls to mock methods without explicit expectations) as test failures, increasing strictness.
- `NiceMock<T>` suppresses warnings for uninteresting calls, providing a quieter test output.
- By default, mock classes behave like `NaggyMock<T>`, emitting warnings but not failures on uninteresting calls.

Users must choose the mock wrapper according to desired strictness levels.


### 2.6 Removal of Nesting of Strictness Wrappers

Nesting of wrappers like `NiceMock<StrictMock<T>>` is **not supported** and may exhibit incorrect behavior due to C++ limitations.

Use a single wrapper only:

```cpp
NiceMock<MockFoo> nice_mock;  // Valid
// Do not do:
NiceMock<StrictMock<MockFoo>> nested_mock;  // Invalid
```


## 3. Deprecated APIs and Behaviors

### 3.1 Old-Style MOCK_METHODn Macros

While still supported for backward compatibility, `MOCK_METHODn` family macros are deprecated.
Migrate to the new `MOCK_METHOD` macro for better support and future compatibility.


### 3.2 Deprecated `MOCK_METHOD` Qualifier Extensions

Previously accepted qualifiers like `override` without parentheses are now recommended to be enclosed in parentheses.

**From:**
```cpp
MOCK_METHOD(void, Foo, (), override); // Discouraged
```

**To:**
```cpp
MOCK_METHOD(void, Foo, (), (override)); // Correct
```


### 3.3 Deprecated Default Behavior for Uninteresting Calls

- The default behavior prints warnings for uninteresting calls. 
- You can suppress warnings by using `NiceMock` or explicit expectations with `Times(AnyNumber())`.
- Completely ignoring or suppressing this warning without intent is discouraged as it may hide test issues.


### 3.4 Mocking Non-Virtual Methods

While mocking non-virtual methods remains unsupported directly, `MOCK_METHOD` expects virtual methods. The recommended workaround is:

- Use interface extraction and mock the interface.
- Use template-based compile-time injection techniques if non-virtual mocking is necessary.


## 4. Migration Guides and Tips

### 4.1 Migrating Existing Mock Classes

1. Replace all `MOCK_METHODn` macros with `MOCK_METHOD`.
2. Ensure all mock methods reside in the `public` section.
3. Add or verify virtual destructors in the base classes.
4. Review usages of `NiceMock`, `NaggyMock`, and `StrictMock` to align with desired strictness.


### 4.2 Managing Uninteresting Calls

- Use `NiceMock` when you want to suppress warnings for unexpected but allowed calls.
- Use `StrictMock` when you want errors on unexpected calls.
- Add explicit `EXPECT_CALL(...).Times(AnyNumber())` where calls are allowed but not explicitly verified.


### 4.3 Refactoring to Avoid Deprecated Patterns

- Avoid nesting strictness wrappers.
- Use parentheses in macro qualifiers consistently.
- Prefer interface-based design over mocking concrete classes directly.


## 5. Removed APIs

- Nesting of `NiceMock<StrictMock<...>>` and similar combinations.
- Completely unsupported old `MOCK_METHODn_WITH_CALLTYPE` macro variants may be removed in future versions.


## 6. Practical Examples

### 6.1 Correct Mock Method Definition

```cpp
class Foo {
 public:
  virtual void Bar(int a) const noexcept = 0;
  virtual ~Foo() = default;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Bar, (int a), (const, noexcept, override));
};
```

---

## 7. Troubleshooting Common Migration Issues

- **Compilation errors related to `MOCK_METHOD` args parsing:** Wrap argument types containing commas with parentheses or use `using` aliases.
- **Linker errors related to mock methods:** Confirm mock methods are public.
- **Runtime test failures on unexpected calls:** Verify use of `StrictMock` or add proper expectations.
- **Warnings about uninteresting calls:** Consider using `NiceMock` or explicitly handle allowed calls with `.Times(AnyNumber())`.


## 8. Further Reading and Links

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Detailed recipes on mock usage.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): APIs for mocks.
- [Strictness Modes](https://google.github.io/googletest/concepts/mock-strictness.html): Concepts of NiceMock, NaggyMock, StrictMock.
- [Migration Tips](https://google.github.io/googletest/changelog/migration-tips.html): Broader upgrade guidances.

---

This page streamlines your migration path by identifying and explaining breaking changes and deprecated patterns that impact GoogleMock usages, empowering you to keep your tests robust, up-to-date, and easy to maintain.