---
title: "Upgrade Checklist"
description: "A practical, step-by-step checklist for preparing, executing, and validating an upgrade to the latest compatible GoogleTest version. Minimizes risk and provides confidence in the upgrade process."
---

# Upgrade Checklist

This Upgrade Checklist provides a practical, step-by-step guide for preparing, executing, and validating an upgrade to the latest compatible version of GoogleTest. Whether you maintain a large codebase or just want a structured process to minimize risk, this checklist ensures confidence and consistency throughout the upgrade journey.

---

## 1. Preparation

### Understand Your Current Environment
- Identify the currently used GoogleTest and GoogleMock versions.
- Review your project's dependency and build system configurations related to GoogleTest.

### Review Release Notes and Compatibility
- Read through the [Release History](https://github.com/google/googletest/releases) to understand new features, bug fixes, and deprecations.
- Check for any [Breaking Changes and Migrations](../upgrade-guidance/breaking-changes) relevant to your current version.
- Identify deprecated APIs from the [Deprecations and Removals](../upgrade-guidance/deprecations) page.

### Assess Test Code and Mock Usage
- Audit your test code for use of deprecated or obsolete mocking macros such as old `MOCK_METHODn`.
- Ensure that your mocks are using the newer, recommended macro style (`MOCK_METHOD` with 3 or 4 parameters).
- Take note if your code uses unprotected commas in mock methods and prepare to apply fixes if necessary.

### Dependency and Build System Setup
- Verify that the build system supports the required C++17 standards or higher.
- Update your build configurations (CMake, Bazel, pkg-config) to point to the new GoogleTest version's include and library directories.
- If using CMake, confirm that you link against the appropriate `gmock_main` or `gtest_main` targets.

## 2. Execution

### Implement Incremental Upgrades
- Prefer upgrading to intermediary minor or patch releases if your current version is old.
- Run your entire test suite after each incremental step to catch issues early.

### Update Mock Definitions and Usage
- Adapt all mock class definitions to use the new `MOCK_METHOD` macro format:

  ```cpp
  class MyMock {
   public:
    MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
  };
  ```

- Wrap argument or return types with parentheses if they contain unprotected commas:

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  ```

- Use `NiceMock`, `NaggyMock`, and `StrictMock` wrappers for controlling uninteresting call behaviors appropriately.

### Set Mock Expectations Thoughtfully
- Use `ON_CALL` to define default mock behavior without strict call expectations.
- Apply `EXPECT_CALL` only when you must verify that a call happens.
- Avoid overconstraining expectations to reduce test brittleness.

### Verify Thread Safety and Synchronization
- Make sure mock setups happen in one thread, with calls allowed from multiple threads if applicable.
- Utilize proper synchronization primitives if your actions or matchers interact with shared state.

### Run Full Test Suite
- Execute the full test suite with high verbosity if needed (`--gmock_verbose=info`) to get detailed call traces.
- Observe warnings about uninteresting or unexpected calls and adjust expectations accordingly.

## 3. Validation

### Confirm Expectation Satisfaction
- Verify that all `EXPECT_CALL` expectations are satisfied during test execution.
- Utilize `Mock::VerifyAndClearExpectations()` for explicit verification in complex scenarios.

### Analyze Warnings and Failures
- Investigate any warnings about uninteresting calls, excessive calls, or unsatisfied prerequisites.
- Check for problems due to retired expectations or ordering constraints when using `InSequence` or `After` clauses.

### Fix Issues and Rerun
- Apply fixes to mocks or test scenarios where calls don't match expectations or arguments.
- Rerun the test suite until clean passes are obtained.

### Confirm No Memory Leaks
- Ensure mocks are not leaked by calling `Mock::AllowLeak()` intentionally only when necessary.
- Use tools like Valgrind or AddressSanitizer to validate.

### Validate Build and Linkage
- Confirm that tests link and run against the correct version of GoogleTest and GoogleMock libraries.
- Check that `gmock_main` or `gtest_main` is properly included to avoid missing entry points.

## 4. Best Practices

### Use the Newer Mock Macros
- Transition all old-style `MOCK_METHODn` macros to the templated `MOCK_METHOD` usage.
- Avoid macro name collisions by using qualified mock names and namespaces.

### Minimize Expectation Count
- Prefer `ON_CALL` default actions and only add `EXPECT_CALL` where verification is needed to reduce test fragility.

### Sequence Control with Care
- Use `InSequence` and `After` only when call ordering matters.
- For complex call order dependencies, consider partial order graphs with multiple `Sequence` objects.

### Debugging Support
- Use `--gmock_verbose=info` for detailed mock call tracing to speed up troubleshooting.
- Leverage the built-in matchers and composite matchers to keep argument validation clear and maintainable.

## 5. Troubleshooting

### Unexpected Calls
- Occur when calls do not match any existing `EXPECT_CALL`.
- Use diagnostic verbosity and check matchers for correctness.

### Uninteresting Calls Warning
- Happens when calls are made with no `EXPECT_CALL` set.
- Suppress by adding `EXPECT_CALL(...).Times(AnyNumber())` or wrapping mocks with `NiceMock`.

### Excessive Calls
- Result from calls exceeding specified `.Times()` upper bound.
- Adjust call counts or add `.RetiresOnSaturation()` to expectations.

### Matching Issues
- Caused by argument mismatches.
- Refine argument matchers and consider using `.With()` clause for multi-argument matching.

### Memory Leak Errors
- Often due to mocks not being destroyed.
- Use `Mock::AllowLeak()` sparingly and fix ownership issues.

### Build Failures
- Usually due to missing dependencies or incompatible compiler settings.
- Confirm C++17 support and correct inclusion of headers and linking of libraries.

## 6. Additional Resources

- [Mocking Reference](../reference/mocking.md): Detailed explanation of mock constructs and matchers.
- [gMock Cookbook](../gmock_cook_book.md): Recipes for mock usage patterns and advanced mocking techniques.
- [Breaking Changes and Migrations](../upgrade-guidance/breaking-changes): Essential for understanding what changed in recent releases.
- [Deprecations and Removals](../upgrade-guidance/deprecations): Help with migrating away from deprecated features.
- [Troubleshooting & Quick Validation](../../getting-started/first-run-usage/troubleshooting-quick-validation): Common issues and their resolutions.

---

## Summary

This Upgrade Checklist empowers you to perform GoogleTest upgrades methodically, reducing risk and ensuring your tests continue to provide valuable verification. Following preparation, execution, and validation phases systematically helps maintain test stability and confidence.

For deeper insights into mocks, expectations, and actions involved in upgrade migration, consult the Mocking Reference and gMock Cookbook. Keep an eye on breaking changes and deprecations described in upgrade guidance documentation to align your codebase with the latest standards.

---

<Callout title="Tip">
Always run your full test suite after each upgrade step to catch regressions early.
</Callout>

<Callout title="Note">
Use `ON_CALL` for default mock behaviors and reserve `EXPECT_CALL` for specified call verifications, to keep tests maintainable and robust.
</Callout>

---

## Example of Modern Mock Definition

```cpp
class MockWidget {
 public:
  // Mock a method with a move-only argument, const qualifier, and override.
  MOCK_METHOD(bool, ProcessData, (const std::unique_ptr<Data>& data), (const, override));

  // Mock a method returning a pair with complex types, using parentheses to protect commas.
  MOCK_METHOD((std::pair<int, std::string>), ComputeResult, (int param1, (std::map<int, double>) param2));
};
```


## Example Upgrade Steps

1. Update the package or git submodule for GoogleTest to the latest compatible release.
2. Adjust your build scripts to point to the new include paths and libraries.
3. Replace any deprecated macros in your mock classes with the latest `MOCK_METHOD` usage.
4. Fix any mismatched mock method signatures, especially those with unprotected commas.
5. Run tests with `--gmock_verbose=info` for detailed diagnostics.
6. Address failures or warnings by refining expectations or default actions.
7. Validate no memory leaks exist post-upgrade.
8. Update your CI and build environment with the new version.

---

By adopting this checklist, you will ensure a smooth and reliable transition to the latest GoogleTest version, making the most of its improved capabilities and maintaining high-quality test coverage.
