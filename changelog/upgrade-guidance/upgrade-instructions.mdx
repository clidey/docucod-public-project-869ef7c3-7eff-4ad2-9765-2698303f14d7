---
title: "Upgrade Instructions"
description: "Step-by-step upgrade guides for major and minor releases, highlighting required actions, configuration options, and troubleshooting for common upgrade challenges. Designed to help teams move forward with confidence, make informed tradeoffs, and address compatibility quickly."
---

# Upgrade Instructions

Upgrade Instructions provide structured, clear guidance tailored to teams moving between major and minor versions of GoogleTest and GoogleMock. This documentation focuses on actionable steps, configuration options, and troubleshooting advice specifically designed to smooth the upgrade process for developers using the mocking framework.

---

## 1. Introduction

Upgrading GoogleTest and GoogleMock requires attention to specific version changes, compatibility requirements, and potential adjustments to both build configurations and test code. This guide helps you navigate those requirements confidently, minimizing disruption and ensuring smooth transitions.

Upgrades often involve:
- Adjusting your projectâ€™s C++ standard support, notably to C++17 for recent versions.
- Updating build system integrations especially with CMake and Bazel.
- Revising mock method definitions to match new syntaxes or fixes.
- Managing breaking changes with guided migration steps.

Use this documentation as your definitive path to successfully update your testing infrastructure and avoid common pitfalls.

## 2. Preparing for an Upgrade

### 2.1 Validate Your Environment

Ensure your development environment meets new requirements:
- Minimum supported compiler versions complying with C++17 (see [System Requirements & Supported Platforms](../../getting-started/setup-prerequisites-installation/system-requirements-supported-platforms.md))
- Confirm threading and filesystem support is intact for parallel test execution.

### 2.2 Backup and Version Control

Before upgrading, commit and back up your existing test code and build configurations. This safeguards against regressions and enables rollback if needed.

### 2.3 Review Release Notes

Check the detailed release notes linked in the Version Timeline for each version you are skipping or adopting. Identify any breaking changes or deprecated features.

## 3. Upgrading Build and Integration Setup

### 3.1 CMake Integration

If you integrate GoogleTest/GoogleMock via CMake:
- Update your `find_package` calls to the new version.
- If building from source, re-check the build configurations, especially the `gtest_force_shared_crt` option on Windows.
- Adjust compiler flags to respect updated C++17 standards; ensure your CMakeLists include `target_compile_features(gtest PUBLIC cxx_std_17)` or equivalent.
- Link your tests against `gmock_main` or `gmock` appropriately depending on the usage of the main function.

Example:
```cmake
find_package(GTest CONFIG REQUIRED)
target_link_libraries(my_test PRIVATE GTest::gmock_main)
```

### 3.2 Bazel Integration

- Update your WORKSPACE and BUILD files to reference the updated GoogleTest repository version.
- Verify that Bazel build rules reflect changes in library names or package layouts.

### 3.3 Package Configuration

- When using pkg-config (`.pc` files), ensure your `gmock.pc` and `gmock_main.pc` are updated according to the installed version.

## 4. Updating Mock Classes and Test Code

### 4.1 Mock Method Definitions

The `MOCK_METHOD` macro is central to defining mock methods. Upgrades may introduce syntactical or behavioral changes; review all mocks for:
- Correct use of qualifiers such as `const`, `override`, and calling conventions.
- Proper handling of return types containing commas (wrap types in parentheses or use type aliases).
- Updated mocking conventions for non-virtual and overloaded methods.

Example:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(string, Describe, (const char* name), (override));
  MOCK_METHOD(string, Describe, (int type), (override));
};
```

### 4.2 Adjusting Mock Expectations and Behaviors

Upgraded versions may tighten or clarify expectations such as:
- Usage of `ON_CALL` versus `EXPECT_CALL` for setting default and expected behaviors.
- Careful management of cardinalities using `.Times()`, `.WillOnce()`, and `.WillRepeatedly()`.
- Making use of strictness wrappers like `NiceMock`, `NaggyMock`, or `StrictMock` to control handling of uninteresting calls.

### 4.3 Migrating Complex Matchers and Actions

- Revisit custom matchers or actions to ensure they comply with updates to the Matcher and Action Framework.
- When using fallbacks or delegations, verify that new template or lambda-based approaches are utilized where applicable.

## 5. Handling Breaking Changes

Consult [Breaking Changes & Migration Notes](breaking-changes.md) for comprehensive list and detailed migration guidance. Common categories include:
- Changes in assertion usage and macros.
- Revised death test semantics and suite restructuring.
- Updates in mock method definition and invocation.

Follow migration examples carefully and test incrementally.

## 6. Troubleshooting Common Upgrade Issues

### 6.1 Build Failures

- Verify compiler compatibility and C++ standard enforcement.
- Confirm all mock macros usages are up to date syntactically.
- Check linkage errors related to `gmock_main` when using main function variants.

### 6.2 Test Failures Due to Verification

- Review new strictness modes that may cause previously unreported uninteresting calls to fail.
- Add explicit expectations or use `NiceMock` during transition.

### 6.3 Mock Object Lifetime Issues

- Make sure to properly manage lifetimes; explicit verification may be necessary using `Mock::VerifyAndClearExpectations()`.

## 7. Best Practices for Smooth Upgrades

- Upgrade through major versions stepwise, not skipping several versions when possible.
- Maintain clear separation between setting default mock behaviors (`ON_CALL`) and strict expectations (`EXPECT_CALL`).
- Use the verbosity flag `--gmock_verbose=info` to trace mock call matching during initial upgrade debugging.
- Employ continuous integration with flaky test detection while upgrading.

## 8. Example Upgrade Workflow

<Steps>
<Step title="Environment Preparation">
Check compiler and platform requirements; update C++ standard to C++17 if needed.
</Step>
<Step title="Update Build Configuration">
Adjust CMakeLists or Bazel files to link with updated GoogleTest/GoogleMock.
</Step>
<Step title="Revise Mock Definitions">
Update all `MOCK_METHOD` macros to comply with new syntax and attributes.
</Step>
<Step title="Update Mock Expectations">
Audit usage of `ON_CALL`, `EXPECT_CALL`, and cardinalities.
</Step>
<Step title="Run Tests with Increased Verbosity">
Use `--gmock_verbose=info` to detect unexpected mock calls.
</Step>
<Step title="Fix Test Failures and Migrate Expectations">
Adjust expectations and test logic according to updated behaviors.
</Step>
<Step title="Validate Full Test Suite">
Run all tests to ensure full compliance.
</Step>
</Steps>

## 9. Additional Resources

- [Mocking Reference](../../docs/reference/mocking.md) - for detailed mocking API behavior.
- [gMock Cheat Sheet](../../docs/gmock_cheat_sheet.md) - quick reference for mocks.
- [Mocking Workflow Guide](../../guides/mocking-best-practices/mocking-workflow.md) - best practices in creating and controlling mocks.
- [Version Timeline](../release-history/version-timeline.md) - to identify version-specific changes.
- [Breaking Changes & Migration Notes](breaking-changes.md) - critical for migration steps.

## 10. Contact and Support

If you encounter unexpected upgrade issues, consult community forums and issue trackers as summarized in [Finding Help](../../faq/support-community/finding-help.md), and consider contributing back solutions through the contribution guidelines.

---

This upgrade guide is designed to help you take concrete, informed steps toward reliable adoption of new GoogleTest and GoogleMock versions, minimizing disruptions, and maximizing testing confidence.

---

_Source files:_
- [googlemock/README.md](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [docs/reference/mocking.md](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [docs/gmock_cook_book.md](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [googlemock/src/gmock_main.cc](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc)
- CMake files in [googletest/cmake/](https://github.com/google/googletest/tree/main/googletest/cmake)

---

<Check>
Ensure your upgrade plan references the relevant migration details from the [Breaking Changes & Migration Notes](breaking-changes.md) and [Version Timeline](../release-history/version-timeline.md) for precise, version-specific advice.
</Check>