---
title: "Upgrade Guides and Best Practices"
description: "Stepwise upgrade instructions tailored to common scenarios—single project, CI/CD integration, and large teams. Includes troubleshooting tips and links to relevant migration resources."
---

# Upgrade Guides and Best Practices

This guide provides a clear, step-by-step approach to upgrading GoogleTest and GoogleMock in your projects. It is tailored to diverse scenarios — from individual projects to large teams integrating continuous integration (CI/CD) pipelines. Along with upgrade instructions, it offers practical troubleshooting advice and important references to ensure smooth migration.

---

## Contents

1. [Introduction](#introduction)
2. [General Upgrade Strategy](#general-upgrade-strategy)
3. [Upgrading a Single Project](#upgrading-a-single-project)
4. [Integrating Upgrades in CI/CD Pipelines](#integrating-upgrades-in-cicd-pipelines)
5. [Managing Upgrades in Large Teams](#managing-upgrades-in-large-teams)
6. [Common Pitfalls and Troubleshooting](#common-pitfalls-and-troubleshooting)
7. [Additional References and Resources](#additional-references-and-resources)

---

## Introduction

GoogleTest and GoogleMock evolve regularly, offering new features, improvements, and sometimes breaking changes. Adopting the latest versions enables you to benefit from enhanced reliability, richer APIs, and better integration with contemporary development tools while maintaining test stability.

This document focuses on upgrade workflows aimed specifically at helping teams and individual developers navigate version updates with confidence and minimize disruption.

---

## General Upgrade Strategy

Upgrading GoogleTest and GoogleMock involves several key steps structured around your project complexity and integration environment:

- **Review Change Logs and Breaking Changes** to understand new features and migration requirements.
- **Update Build Configurations** (e.g., CMake, Bazel) to fetch and link the updated libraries.
- **Adapt Test Code** where APIs have changed, using provided migration instructions.
- **Run Full Test Suites** to verify behavioral consistency.
- **Iterate** to fix issues and adapt to new APIs.

Always ensure you have backups or version control snapshots before starting a migration.

---

## Upgrading a Single Project

### Step 1: Examine Release Notes and Breaking Changes

Start by consulting the latest [GoogleTest Release Highlights](https://github.com/google/googletest/blob/main/README.md#release-highlights) and the [Changelog - Breaking Changes and Migration Notes](https://github.com/google/googletest/blob/main/docs/changelog/upgrade-guidance/breaking-changes.md). Identify features and deprecated APIs relevant to your test base.

### Step 2: Update Build Files

- **CMake users:** Adjust your `FetchContent` or submodule references to point to the desired release tag or branch in GoogleTest repository.
  ```cmake
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/refs/tags/v1.17.0.zip
  )
  FetchContent_MakeAvailable(googletest)
  ```
- **Bazel users:** Update workspace rules to fetch the new version.

### Step 3: Compile and Run Tests

Rebuild your tests against the updated libraries. GoogleTest and GoogleMock emit clear compilation errors and warnings if your tests use deprecated or changed APIs.

### Step 4: Migrate Test Code

If your tests use APIs marked for deprecation or modified in behavior, consult the migration instructions in the [Breaking Changes and Migration Notes](https://github.com/google/googletest/blob/main/docs/changelog/upgrade-guidance/breaking-changes.md). Common scenarios include:

- Changes in `MOCK_METHOD` declarations.
- Adjustments in expectation setting (`EXPECT_CALL`, `ON_CALL`).
- Updated matcher syntax and custom matcher requirements.

### Step 5: Verify Test Results

Run your full unit and integration test suite. Use GoogleMock’s verbose flags (`--gmock_verbose=info`) if tests fail to gain detailed insight into failing expectations.

<Tip>
Start with incremental version bumps and test early, especially when upgrading across multiple minor or major releases.
</Tip>

---

## Integrating Upgrades in CI/CD Pipelines

### Step 1: Automate Version Pinning

In your CI configuration, explicitly specify the GoogleTest and GoogleMock versions, avoiding floating tags. This prevents unintended breaking updates.

### Step 2: Continuous Verification

Add workflows that automatically build and run tests using new GoogleTest versions on merge requests or scheduled runs.

### Step 3: Monitor Failures and Warnings

Utilize GoogleMock’s verbose reporting flags:

```bash
--gmock_verbose=info
```

to capture call traces and failures for easier debugging within CI logs.

### Step 4: Use Feature Flags Judiciously

Be aware of GoogleTest and GoogleMock flags impacting test behavior and verbosity (e.g., `--gmock_catch_leaked_mocks`, `--gmock_verbose`). Set them explicitly in CI to maintain consistent test environments.

### Step 5: Gradually Roll Out Upgrades

For large teams, integrate the new GoogleTest version on separate branches, allowing teams to adapt before merging to main branches.

---

## Managing Upgrades in Large Teams

### Centralize Upgrade Coordination

Assign responsibility to a team or individual for maintaining the GoogleTest/GMock version, including handling API migrations and communicating important changes.

### Provide Migration Guides

Distribute concise internal upgrade instructions highlighting breaking changes, best practices, and deprecated features, referencing this and related official GoogleTest materials.

### Use Strict Mock Modes Selectively

Strict mocks help catch discrepancies early but can increase test brittleness. Balance use of `StrictMock`, `NiceMock`, and `NaggyMock` based on team testing maturity and maintenance overhead.

### Advocate Best Practices

Encourage patterns such as:

- **Coding to interfaces** to simplify mocking (see gMock Cookbook).
- **Minimal expectations** leveraging `ON_CALL` vs. overusing `EXPECT_CALL` to avoid test brittleness.
- Using **sequence and expectations ordering** features thoughtfully.

### Encourage Use of Verbose Diagnostics

Educate team members to leverage flags like `--gmock_verbose=info` to diagnose failing tests quickly.

---

## Common Pitfalls and Troubleshooting

- **Uninteresting calls warnings:** When tests print warnings about uninteresting calls, use `NiceMock` or explicitly set expectations with suppression.

- **Mock method signature mismatches:** Carefully reflect method qualifiers (`const`, `override`, `noexcept`, reference qualifiers) in your `MOCK_METHOD` declarations.

- **Handling overloaded methods:** Mock all relevant overloads or use `using BaseClass::Method;` to avoid hiding base implementations.

- **Compilation slowdowns:** For large mocks, move constructor and destructor definitions out-of-class to `.cc` files.

- **Mocking non-virtual or free functions:** Consider testing patterns such as dependency injection or wrapping functions in interfaces for mocking.

- **Verbose output noise:** Use the `--gmock_verbose` flag to tune the volume and level of detail.

<Tip>
If encountering unexpected test failures or behavior, run tests with `--gmock_verbose=info` to observe detailed call matching and expectation information.
</Tip>

---

## Additional References and Resources

- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md): Recipes and examples for mocking techniques.
- [Breaking Changes and Migration Notes](https://github.com/google/googletest/blob/main/docs/changelog/upgrade-guidance/breaking-changes.md): Detailed guide to API and behavior changes.
- [Setting Expectations](https://github.com/google/googletest/blob/main/api-reference/mocking-framework/setting-expectations.md): The syntax and semantics of `EXPECT_CALL` and `ON_CALL`.
- [Strictness Modes](https://github.com/google/googletest/blob/main/api-reference/mocking-framework/strictness-modes.md): Understanding `NiceMock`, `NaggyMock`, and `StrictMock`.
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md): Getting started with GoogleTest and GoogleMock.
- [Common Installation Problems](https://github.com/google/googletest/blob/main/getting-started/troubleshooting/common-problems.md): Diagnosing typical configuration and build issues.

Refer to the [Navigation Map](https://github.com/google/googletest/wiki) for comprehensive coverage of related topics.

---

###### This document was generated based on the latest product context and official release guidance.

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/changelog/upgrade-guidance/upgrade-instructions.md", "range": "1-100"}]} />
