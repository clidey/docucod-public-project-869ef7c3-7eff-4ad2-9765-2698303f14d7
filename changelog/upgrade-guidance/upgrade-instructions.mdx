---
title: "How to Upgrade Your Project"
description: "Step-by-step instructions for upgrading to the latest GoogleTest version—including dependency management (CMake, Bazel, direct source), resolving common upgrade issues, and post-upgrade verification steps."
---

# How to Upgrade Your Project

Upgrading your project to the latest version of GoogleTest is essential to leverage improvements, fix bugs, and maintain compatibility with modern C++ environments. This guide walks you through a clear, actionable process to smoothly upgrade GoogleTest and GoogleMock within your project, covering dependency management, common upgrade issues, and post-upgrade verification.

---

## 1. Understanding Your Upgrade Paths

GoogleTest provides multiple ways to integrate the framework into your project. You need to choose the upgrade method that matches your existing setup:

- **Using CMake**: Upgrading via CMake is the most common approach for projects managing their builds with CMake.
- **Using Bazel**: If your project uses Bazel as the build system, follow the Bazel integration upgrade instructions.
- **Direct Source Integration**: For projects embedding the GoogleTest source directly, manual replacement and configuration updates may be necessary.

Each method requires specific steps to ensure correct linkage and compatibility.

---

## 2. Upgrading Via CMake

### Step 1: Update to the Latest GoogleTest Release

1. Fetch the latest GoogleTest source from the official [GitHub repository](https://github.com/google/googletest):

    ```bash
    git clone https://github.com/google/googletest.git -b <latest_version>
    cd googletest
    ```

2. Alternatively, if using `FetchContent` in your project’s `CMakeLists.txt`, simply update the version tag or commit hash:

    ```cmake
    include(FetchContent)
    FetchContent_Declare(
      googletest
      URL https://github.com/google/googletest/archive/<latest_commit_hash>.zip
    )
    FetchContent_MakeAvailable(googletest)
    ```

### Step 2: Adjust Compiler and Linker Settings

- Confirm your project builds with **C++17 or higher**, as GoogleTest requires C++17 features.
- Check for any compiler-specific flags related to threading or exceptions. GoogleTest supports pthread where available; ensure `GTEST_HAS_PTHREAD` is set appropriately.
- For Windows with Visual Studio projects, verify `gtest_force_shared_crt` option if dealing with dynamic vs static runtime conflicts.

### Step 3: Update Your CMake Build Targets

- If your project links to `gtest` and `gmock` explicitly, verify the new versions of these libraries are used.
- Use targets like `GTest::gtest`, `GTest::gmock`, and `GTest::gtest_main` to simplify linking.

### Step 4: Rebuild and Install

```bash
mkdir build
cd build
cmake ..
make
sudo make install
```

> This process also installs 
> - pkgconfig files including `googlemock.pc`
> - Updated CMake config files to help your project find the right versions

### Step 5: Verify Upgrade

- Run existing GoogleTest/GoogleMock-based tests to confirm behavior.
- Look for warnings or deprecation notices on the console output.

---

## 3. Upgrading Via Bazel

1. Update your Bazel workspace to use the latest `googletest` release:

   ```python
   http_archive(
       name = "com_google_googletest",
       urls = [
           "https://github.com/google/googletest/archive/<latest_commit_hash>.zip",
       ],
       strip_prefix = "googletest-<latest_commit_hash>",
   )
   ```

2. Sync your workspace and deps:

   ```bash
   bazel sync
   bazel build //...
   ```

3. Update your BUILD files if necessary, especially if your project assumes older version specifics.

4. Re-run your test targets to confirm upgrade success.

---

## 4. Upgrading Direct Source Integration

If your project embeds GoogleTest source code directly:

1. Replace the `googletest` directory with the latest source snapshot.
2. Replace the `googlemock` directory likewise if used.
3. Update your internal include paths to point to the new source.
4. Rebuild your project.

> Note: This method requires careful management of header and source files, and is prone to breakage if API changes occur between versions.

---

## 5. Resolving Common Upgrade Issues

### A. Compilation or Linker Errors

- **Mismatch of C++ standard**: Ensure your build uses at least C++17.
- **Conflicting runtimes on Windows**: Use `gtest_force_shared_crt` to align runtimes.
- **Missing pthread linkage**: Add threading libraries (`-lpthread`) explicitly in your build or rely on CMake `find_package(Threads)`.

### B. Deprecated MOCK_METHOD Syntax

GoogleMock has modernized the `MOCK_METHOD` macro syntax, now supporting:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- Check your mock declarations and update accordingly.
- See the [Mocking Reference](docs/reference/mocking.md#macros) for detailed usage.

### C. Changes in Expectation Precedence or Behavior

- New expectations override older ones; review ordering of `EXPECT_CALL` in your tests.
- For managing saturated expectations, consider using `.RetiresOnSaturation()` to avoid call count breaches.

### D. Uninteresting Calls Warnings

- By default, unexpected calls emit warnings.
- Wrap mocks in `NiceMock` to suppress, or `StrictMock` to treat as errors.
- See the [Nice, Naggy, and Strict Mocks](guides/mocking-techniques/strictness-and-mock-behavior.md) guide for strategies.

### E. Move-Only Argument or Return Types

- Newer GoogleMock versions support mocking methods with move-only types like `std::unique_ptr`.
- Use lambdas or `WillOnce([](...) { ... })` for specifying return behaviors involving move-only types.

---

## 6. Post-Upgrade Verification Steps

After upgrading GoogleTest and GoogleMock:

1. **Build Validation:**

   - Ensure your project compiles cleanly without warnings related to GoogleTest.

2. **Run Tests:**

   - Execute your entire test suite with `RUN_ALL_TESTS()`. Expect zero failures.

3. **Check Mock Behavior:**

   - Look for spurious warnings about uninteresting calls or unmet expectations.
   - Adjust mocks according to upgraded expectations.

4. **Validate Integration:**

   - Verify integration points, especially if your project uses advanced features like:
     - Custom matchers or actions.
     - Parameterized or typed tests.
     - Complex sequences or call ordering.

5. **Update Documentation:**

   - Refresh your project's internal documentation or README to reflect upgraded versions and any new usage patterns.

---

## 7. Additional Tips & Best Practices

- Always pin your GoogleTest and GoogleMock versions explicitly in build scripts to prevent unexpected breakage during continuous integration runs.
- Use CMake `find_package(GTest CONFIG REQUIRED)` whenever possible to benefit from installed library management.
- Familiarize yourself with the latest [Mocking Reference](docs/reference/mocking.md) and [gMock Cookbook](docs/gmock_cook_book.md) after upgrading to harness new capabilities.
- Consider running tests with `--gmock_verbose=info` flag for detailed diagnostics when troubleshooting mock-specific issues.

---

## 8. Troubleshooting Quick Reference

| Issue                           | Cause                                  | Solution                                         |
|--------------------------------|----------------------------------------|-------------------------------------------------|
| Test executable fails to build | C++ standard mismatch                  | Set `CMAKE_CXX_STANDARD` to 17 or above         |
| Linker errors involving pthread | Missing pthread linkage                 | Link with `Threads::Threads` or `-lpthread`     |
| Unexpected call warnings       | No matching `EXPECT_CALL` for calls    | Use `NiceMock` or add `EXPECT_CALL` with `AnyNumber()` |
| MOCK_METHOD macro errors        | Old macro usage or syntax errors       | Update to new `MOCK_METHOD` macro syntax         |
| Runtime errors on move-only returns | Using `Return(std::move(...))` repeatedly | Replace with lambdas or use `ReturnPointee()`    |

---

## 9. References & Further Reading

- [GoogleTest Primer](docs/primer.md) — Core Concepts and Test Writing
- [Mocking Reference](docs/reference/mocking.md) — Detailed Mocking API
- [gMock Cookbook](docs/gmock_cook_book.md) — Recipes and Tips
- [Installation: CMake & Bazel](getting-started/setup-installation/installation-cmake-bazel.mdx) — Build and Install Details
- [Mock Strictness Levels Guide](guides/mocking-techniques/strictness-and-mock-behavior.mdx) — Managing Mock Warnings
- [Breaking Changes & Migration Notes](changelog/upgrade-guidance/breaking-changes.mdx) — Important Upgrade Considerations
- [Troubleshooting Common Setup Issues](getting-started/quickstart-validation/troubleshooting-common-issues.mdx)
- GoogleTest Project on GitHub: https://github.com/google/googletest

---

Upgrading GoogleTest and GoogleMock is crucial for keeping your tests reliable, efficient, and compatible with modern toolchains. Following this guide will ensure a smooth transition and encourage best practices that help maintain high-quality test suites.
