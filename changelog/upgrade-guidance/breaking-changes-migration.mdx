---
title: "Breaking Changes & Migration Notes"
description: "Outlines any breaking API changes, mandatory migrations, or adjustments required when upgrading between major versions. Practical migration scenarios give developers actionable next steps to keep their projects working seamlessly."
---

# Breaking Changes & Migration Notes

This page provides an essential guide for developers upgrading between major versions of GoogleMock and GoogleTest, focusing specifically on breaking API changes and required migration steps. By following the practical migration scenarios and actionable instructions presented here, you can ensure your existing tests continue to function correctly without disruption.

---

## Understanding Breaking Changes

Breaking changes occur when APIs are modified in a way that existing code using earlier versions will no longer compile or behave as expected. These changes require deliberate migration efforts.

In GoogleMock, breaking changes may include:

- Altered method signatures in mock classes
- Changes in semantics or behavior of key mocking constructs
- Updates to macro usage or expectation syntax
- Removal or deprecation of previously supported features

This page helps you identify these changes and provides guidance on adapting your tests effectively.

---

## Key Migration Scenarios

### 1. Mock Method Declaration Updates

GoogleMock's `MOCK_METHOD` macro is the primary way to declare mock methods. While older macro variants (`MOCK_METHODn`) are still supported, migrating to the new generic `MOCK_METHOD` macro is strongly recommended for improved consistency and maintainability.

**Migration tips:**

- Wrap argument types containing commas in parentheses to avoid parsing errors. For example:

  ```cpp
  // Before (causes compile error):
  MOCK_METHOD(std::pair<bool, int>, GetPair, ());

  // After:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  ```

- Use the new macro format:
  ```cpp
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specifiers));
  ```

- Include qualifiers such as `(const)`, `(override)`, and calling conventions as needed.

- Make sure to place mock method declarations in public sections regardless of the original method's protection.

---

### 2. Expected Call Specification and Argument Matching

GoogleMock expects `EXPECT_CALL` statements to be set before invoking mock methods. The syntax and semantics have been refined over versions.

**Important considerations:**

- The matcher parameters must be specified accurately. Use `_` for wildcard matchers where arguments are not important.
  
- The last matching expectation is used (newer expectations override older ones). Arrange your expectations accordingly.

- To enforce call order, use sequences (`InSequence`) or partial ordering via `After`.

- Use cardinalities such as `Times(0)` to specify disallowed calls.

- New `With` clause allows matching on the entire set of arguments as a tuple.

---

### 3. Handling Uninteresting and Unexpected Calls

Breaking changes may affect default behavior for uninteresting or unexpected calls.

**Recommendations:**

- Use `ON_CALL` to specify default mock behaviors, reducing unwanted warnings about uninteresting calls.
- Apply `NiceMock`, `NaggyMock`, or `StrictMock` wrappers to tune the strictness of your mocks based on test needs.
- Be aware that `StrictMock` treats uninteresting calls as errors, which may break tests during migration.

---

### 4. Managing Expectation Lifetimes: Retiring Expectations

New behavior regarding *sticky* expectations means expectations remain active (matching calls) even after their call count is saturated unless:

- The `.RetiresOnSaturation()` modifier is applied
- The expectation is part of an `InSequence` clause

This behavioral change may require revisiting your expectations to avoid upper-bound failures in tests.

---

### 5. Mock Delegation Patterns

GoogleMock supports delegating mock calls to fakes or real objects for default behavior while still verifying calls.

- When migrating, reevaluate your use of delegation to ensure it aligns with updated syntax for `ON_CALL` and expectations.

- Delegation macros and lambdas may be adjusted for newer standards requiring explicit type signatures.

---

### 6. Support for Move-only Types

Later versions fully support mocking methods that take or return move-only types like `std::unique_ptr`.

**Migration advice:**

- Update mock method declarations to use the generic `MOCK_METHOD` for move-only argument support.
- Use lambdas in `WillOnce`/`WillRepeatedly` actions to correctly produce or consume move-only types.
- Avoid legacy workarounds delegating move-only arguments to non-move mock methods.

---

## Practical Migration Steps

<Steps>
<Step title="Audit Your Mock Declarations">
Review all mock classes and replace any old-style `MOCK_METHODn[_T][_WITH_CALLTYPE]` macros with the generic `MOCK_METHOD` macro as described above. Wrap all argument types with commas properly.
</Step>
<Step title="Verify Expectation Syntax">
Ensure all `EXPECT_CALL` statements are set before exercising mocks. Use matchers to specify expected arguments precisely, and verify that newer expectations are specified last for overrides.
</Step>
<Step title="Adjust for Sticky Expectations">
Apply `.RetiresOnSaturation()` to expectations where you want them to become inactive after the upper bound is reached, especially if multiple calls with the same arguments are expected but limited.
</Step>
<Step title="Control Mock Strictness">
Use `NiceMock` or `StrictMock` wrappers explicitly in your tests to control warnings and errors on uninteresting calls. This can avoid surprises from changed default mock behaviors.
</Step>
<Step title="Refactor Delegated Mocks">
Confirm that any delegate-to-fake or delegate-to-real strategies use up-to-date syntax and explicitly specify default actions via `ON_CALL`.
</Step>
<Step title="Update Mock Actions for Move-only Types">
Where your mock methods involve move-only types, ensure your action clauses return or consume these types correctly, usually via lambdas.
</Step>
<Step title="Run Tests with Verbose Logging for Debugging">
Enable `--gmock_verbose=info` while running your tests to see detailed matching attempts, helping to identify failing expectation setups.
</Step>
</Steps>

---

## Common Pitfalls & Troubleshooting

- **Compilation Errors Due to Unwrapped Commas:** Always use parentheses around argument types with commas in `MOCK_METHOD`.
- **Order of `EXPECT_CALL`s Causes Shadowing:** Put general expectations first and more specific ones later.
- **Sticky Expectations Lead to Upper Bound Failures:** Use `.RetiresOnSaturation()` or sequences to retire expectations.
- **Unexpected Uninteresting Call Warnings:** Use `ON_CALL` to set default behaviors or wrap mocks with `NiceMock`.
- **Mismatch in Delegation Causing Silent Failures:** Check that delegate-to-fake or real object uses follow updated patterns.

---

## Example Migration Code Snippet

```cpp
// Before (old MOCK_METHODn macro variant):
class MockFoo {
 public:
   MOCK_METHOD2(Bar2, bool(int x, int y));
};

// After (modern, generic MOCK_METHOD macro):
class MockFoo {
 public:
   MOCK_METHOD(bool, Bar2, (int x, int y), (override));
};

// Applying RetiresOnSaturation:
EXPECT_CALL(mockFoo, Bar2(0, _))
    .Times(2)
    .RetiresOnSaturation();

// Setting default actions with ON_CALL:
ON_CALL(mockFoo, Bar2(_, _)).WillByDefault(Return(true));

// Using NiceMock for suppressing warnings:
using ::testing::NiceMock;
NiceMock<MockFoo> mockFoo;
```

---

## Additional Resources

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Detailed API reference including macro usage and class definitions.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Practical recipes for using GoogleMock effectively.
- [Mocking Best Practices](https://google.github.io/googletest/guides/mocking-best-practices/creating-mocks): Guidance on creating mocks and writing expectations.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html): Quick reference of mocking constructs.
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html): Answers to common issues especially relevant when migrating legacy tests.

For further assistance, review the official [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md) and community tutorials.

---

Embracing these migration notes will help you upgrade your GoogleMock tests confidently, ensuring test reliability across major releases.