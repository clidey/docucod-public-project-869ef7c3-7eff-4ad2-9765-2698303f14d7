---
title: "Deprecations and Removals"
description: "Lists deprecated features, APIs, and practices, along with their planned removal timelines and suggested alternatives. Helps users proactively refactor code and maintain long-term compatibility."
---

# Deprecations and Removals

This page provides a comprehensive overview of deprecated features, APIs, and practices within GoogleTest and GoogleMock, highlighting their scheduled removal timelines and recommending alternative approaches. By proactively addressing these deprecations, you ensure your codebase remains compatible with future versions and benefits from improved functionality and maintainability.

---

## Understanding Deprecation

Deprecation is a formal announcement that certain features or APIs are outdated and will be removed in upcoming releases. This process allows you to transition your tests and mocks smoothly without sudden breakage. Deprecated elements are fully supported for a defined period, but users are strongly encouraged to update their code to use recommended alternatives promptly.

<Info>
Ensure you monitor GoogleTest's issue tracker and release notes for the latest deprecation announcements and timelines.
</Info>

## Key Deprecated Features and APIs

### 1. Old-Style `MOCK_METHODn` Macros

The previous family of mock method macros (`MOCK_METHOD0`, `MOCK_CONST_METHOD1`, etc.) that relied on specifying argument counts is officially deprecated in favor of the generic and more flexible `MOCK_METHOD` macro introduced in 2018.

**Why migrate?**
- Simplifies mock method declarations with a clearer signature syntax.
- Supports qualifiers like `const`, `noexcept`, and call types uniformly.
- Avoids pitfalls with overloaded and templated methods.

**Migration example:**

```cpp
// Deprecated style:
MOCK_METHOD1(Foo, bool(int));

// New style:
MOCK_METHOD(bool, Foo, (int), (override));
```

**Migration tip:** Wrap complex argument types containing commas with parentheses or use type aliases to aid parsing.

---

### 2. Unprotected Commas in Mock Method Signatures

Previously, `MOCK_METHOD` would fail compiling if argument or return types contained unprotected commas (e.g., `std::pair<bool, int>`). It's required now to wrap such types in parentheses or define type aliases.

**Example fix:**

```cpp
// Problematic:
MOCK_METHOD(std::pair<bool, int>, GetPair, ());  // Error

// Fix 1 - parentheses:
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// Fix 2 - type alias:
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```

---

### 3. Strict Enforcement of `MOCK_METHOD` Placement

Mock method declarations using `MOCK_METHOD` **must be placed in the `public:` section** of your mock class, even if the original method is `protected` or `private`. This ensures the mocking framework can access and manipulate these methods during tests.

Failing to adhere to this leads to compilation or runtime errors.

---

### 4. Deprecation of Non-Standard Calling Conventions Handling

While `MOCK_METHOD` supports specifying calling conventions via `Calltype(...)`, some legacy macros and patterns to enforce this are deprecated. Always use the `Calltype` qualifier in the fourth parameter of `MOCK_METHOD` instead.

Example:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE), override));
```

---

### 5. Transition from NaggyMock Default Behavior

Previously, mock objects defaulted to naggy behavior (warning on uninteresting calls). Future plans aim to make `NiceMock` the default to reduce unnecessary noise.

**Action:**
- Explicitly choose `NaggyMock` if you require warnings.
- Prefer `NiceMock` for cleaner test outputs unless stricter behavior is needed.

---

### 6. Removal of Legacy Action Macros

The older macro-based mechanisms for defining actions (`ACTION`, `ACTION_P`) remain supported but are discouraged in favor of modern C++11+ lambda-based or functor-based actions.

**Benefits of migrating:**
- Improved readability and maintainability.
- Better compiler diagnostics.
- Easier integration with modern C++ codebases.

Example modern action:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int x) { return x * 2; });
```

---

### 7. Deprecated Practices in Mock Class Destructor Monitoring

Directly mocking destructors using `MOCK_METHOD` is not supported. Instead, continue to use the endorsed pattern of adding a mock method (e.g., `Die()`) called from the destructor for verification.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```

---

## Planned Removals and Timeline

- **`MOCK_METHODn` and associated old mocking macros:** Expected removal in the next major release after a prolonged deprecation period. Immediate migration is strongly recommended.
- **Unprotected comma support in signatures:** No changes planned but strict parsing enforced to avoid compilation errors.
- **Legacy action macros (`ACTION`, `ACTION_P`):** Deprecation warning will escalate; users should adopt modern lambdas and functors.

<Tip>
Follow the official GoogleTest [GitHub releases](https://github.com/google/googletest/releases) and [breaking changes](https://github.com/google/googletest/blob/main/docs/changelog/upgrade-guidance/breaking-changes.md) pages for precise timelines.
</Tip>

## Recommended Alternatives and Best Practices

- Always use the `MOCK_METHOD` macro with the full and explicit modern syntax.
- Use type aliases or parentheses to handle complex argument or return types.
- Place mock methods in the `public:` section of your mock classes.
- Favor lambda expressions or `std::function` based actions for mock behavior customization.
- Use `NiceMock<T>` to suppress warnings on uninteresting calls unless strict checking is needed.
- For verifying destruction, use a dedicated mock method called from the destructor.

## Troubleshooting Deprecated-Related Issues

<AccordionGroup title="Common Deprecation-Related Questions">
<Accordion title="Compilation fails due to comma in MOCK_METHOD signature">
Wrap complex types containing commas in extra parentheses or use type aliases to mitigate parsing errors, e.g., `MOCK_METHOD((std::pair<int, int>), Foo, ());`.
</Accordion>
<Accordion title="Why do I get errors when MOCK_METHOD macros are in protected/private sections?">
Mock methods must reside in a `public:` access section to allow GoogleMock code to access them. Refactor your mock class accordingly.
</Accordion>
<Accordion title="Is there an alternative to old `MOCK_METHODn` macros?">
Yes. Use the `MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers))` syntax exclusively for new code and migrate existing code.
</Accordion>
<Accordion title="What if I want warnings on uninteresting calls but the default will be NiceMock soon?">
Explicitly wrap your mocks with `NaggyMock<T>` to restore warning behavior.
</Accordion>
</AccordionGroup>

## Useful Links

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Detailed API documentation and modern usage tips
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for writing effective mocks
- [Breaking Changes and Migrations](https://google.github.io/googletest/changelog/upgrade-guidance/breaking-changes.html) — Deep dive on upgrade paths
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick syntax reference

---

This page is part of the [Changelog > Upgrade and Migration Guides](../../changelog/upgrade-guidance) section. Ensure you also consult the [Latest Release Notes](../../changelog/release-history/latest-release-notes) and [Upgrade Checklist](../../changelog/upgrade-guidance/upgrade-checklist) to ensure a smooth transition.
