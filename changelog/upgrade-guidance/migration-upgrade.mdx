---
title: "Migration & Upgrade Guide"
description: "Actionable advice for updating existing projects, covering deprecated and removed APIs, required code modifications, and configuration changes. Designed to streamline your path through version transitions."
---

# Migration & Upgrade Guide

This guide serves as your practical companion for updating existing projects to newer versions of GoogleTest and GoogleMock. It focuses on actionable advice concerning deprecated and removed APIs, necessary code changes, and configuration adjustments, making your version transition streamlined and predictable.

---

## 1. Overview of Migration and Upgrade

When evolving your test code with newer releases of GoogleTest and GoogleMock, it's critical to understand what APIs have changed, which are deprecated or removed, and how to adapt your code and build environment accordingly. This guide focuses exclusively on the migration aspects rather than internal implementation details, aiming to empower you to smoothly upgrade without disruptions.

---

## 2. Deprecated and Removed APIs

### 2.1 Deprecated Features

- **MOCK_METHOD Macro Updates:**
  - The mocking macros have undergone syntax refinements. For instance, all argument types in `MOCK_METHOD` macros that contain commas must now be enclosed in parentheses.
  - Users should replace usage of legacy mocking macros with the updated `MOCK_METHOD` specifying the method signature clearly.

- **Global Initialization Functions:**
  - Rather than calling `testing::InitGoogleTest()` and `testing::InitGoogleMock()` separately, use the unified `testing::InitGoogleMock()` which also initializes GoogleTest.

- **Strictness Behavior in Mocks:**
  - Usage patterns around `StrictMock`, `NiceMock`, and `NaggyMock` have been clarified to reduce warnings and unexpected test failures.

### 2.2 Removed Features

- Certain older macro variants and deprecated expectation behaviors have been removed to streamline the API and improve runtime correctness.
- Legacy methods of mock method definition without explicit parentheses around argument types are no longer supported.

---

## 3. Required Code Modifications

### 3.1 Adjusting Mock Method Syntax

Ensure that:

- Mock methods that have parameters with commas are wrapped in parentheses to disambiguate the macro parsing.

**Before:**
```cpp
MOCK_METHOD(int, SomeMethod, (std::pair<int, int> param));
```

**After:**
```cpp
MOCK_METHOD(int, SomeMethod, ((std::pair<int, int>) param));
```

Alternatively, confirm the updated macro usage per the latest gMock Cookbook recommendations.

### 3.2 Initialization Routine Updates

In your test main function or setup, replace separate initialization calls with the combined call:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This ensures proper and streamlined initialization of both GoogleTest and GoogleMock.

### 3.3 Handling Disabled Tests and Test Suite Fixtures

Tests or test suites prefixed with `DISABLED_` are automatically excluded from execution. Confirm that your code does not mix `TEST_F` and `TEST` macros within the same test suite, as this can cause runtime failures.

---

## 4. Configuration Changes

### 4.1 Command-Line Flags

GoogleTest flags have been expanded and refined to offer better control over test execution. Some flags to pay attention to when upgrading:

- `--gtest_throw_on_failure`: Enables exceptions on failures.
- `--gtest_fail_fast`: Stops test execution upon first failure.
- `--gtest_recreate_environments_when_repeating`: Controls whether test environments are rebuilt when repeating tests.

Use `testing::GTEST_FLAG_GET(flag_name)` in your code to programmatically inspect current flag values. The flags parsing is improved to strip recognized flags from argument lists, which affects custom command-line parsing.

### 4.2 Build System Considerations

- On Windows, use `gtest_force_shared_crt` in CMake to fix runtime linkage issues.
- Make sure to link against `gmock_main` if you use the provided main function from GoogleMock.

---

## 5. Best Practices and Tips

- **Mock Strictness:** Use `NiceMock` or `NaggyMock` to control warnings about unexpected calls.
- **Expectation Setup:** Define all expectations before invoking any mock methods to avoid sticky expectations.
- **Use Modern C++ Standards:** GoogleTest requires at least C++17, so ensure your compiler and build setup supports this.
- **Verify Environment Compatibility:** Check for pthread and platform-specific dependencies, particularly if working on embedded or less common platforms.

---

## 6. Troubleshooting Common Issues

- **Linker Errors:** Ensure your project links correctly with both GoogleTest and GoogleMock libraries.
- **Unexpected Test Behavior:** Confirm mocks are defined and expectations set following the updated macros and usage guidelines.
- **Flags Parsing:** When custom flags coexist with GoogleTest flags, make sure to separate unknown flags properly to prevent GoogleTest from consuming them.

Consult the [Troubleshooting Setup Issues](https://github.com/google/googletest/blob/main/docs/getting-started/first-test-validation/troubleshooting-setup.md) guide for deeper diagnostics.

---

## 7. Step-by-Step Upgrade Flow

<Steps>
<Step title="Review Deprecated and Removed APIs">
Identify any deprecated or removed API usages in your existing tests and mocks, especially around the `MOCK_METHOD` macros and test initialization routines.
</Step>
<Step title="Update Mock Definitions">
Modify your mock classes to comply with the new `MOCK_METHOD` syntax, wrapping multi-parameter types in parentheses.
</Step>
<Step title="Adjust Test Initialization">
Replace separate initialization calls with a unified call to `testing::InitGoogleMock()` in your main function.
</Step>
<Step title="Verify Command-Line Flags Usage">
Update any scripts or code that pass or manipulate GoogleTest flags. Use official flag accessors and ensure flags are passed correctly.
</Step>
<Step title="Run and Validate Tests">
Build and execute your tests to confirm compatibility with the newer version. Address any failures or compilation errors based on updated API semantics.
</Step>
</Steps>

---

## 8. Additional Resources and References

- [Breaking Changes Overview](../breaking-changes.md): Detailed changelog highlighting significant API changes.
- [gMock Cookbook](https://github.com/google/googletest/blob/main/googlemock/docs/cook_book.md): Practical recipes for mock usage including strictness and expectation setup.
- [Initialization and Main Functions](../../api-reference/core-apis/initialization-and-main.md): Guidance on test runner setup and main() implementations.
- [Supported Platforms & Requirements](../../getting-started/prerequisites-installation/supported-platforms-requirements.md): Verify compiler and platform compatibility.
- [Troubleshooting Setup Issues](../../getting-started/first-test-validation/troubleshooting-setup.md): Stepwise guide to resolve common integration problems.

---

## 9. Summary

Upgrading your test code to the latest GoogleTest and GoogleMock involves updating mock macros, consolidating initialization calls, and adapting to refined command-line flag handling. This guide provides clear instructions and best practices to ensure your test suites evolve smoothly with minimal disruption.

<Tip>
Regularly consult the official release notes and the breaking changes overview during upgrades to anticipate impacts and adopt new API features for better test robustness.
</Tip>