---
title: "Breaking Changes & Migration Notes"
description: "Catalogues API or behavioral changes that may require test updates or codebase modification. Provides decision makers with early visibility into significant migrations or removals."
---

# Breaking Changes & Migration Notes

This documentation details API and behavioral modifications in GoogleMock that may require updates to your test code or other codebases depending on it. It serves to provide you with early visibility into important migrations, removals, or incompatibilities introduced across versions to aid smooth upgrades.

---

## 1. Transition to C++17 as Minimum Requirement

Starting with recent releases, GoogleMock requires a C++17-compliant compiler and standard library. This change implies:

- Legacy build environments or compilers not supporting C++17 will no longer successfully compile GoogleMock.
- Your test projects must enable and configure C++17 or later compliance.

Refer to the [System Requirements & Supported Platforms](https://google.github.io/googletest/getting-started/setup-prerequisites-installation/system-requirements.html) page for detailed environment support.

---

## 2. Adoption of New `MOCK_METHOD` Macro Syntax

The older family of macros (`MOCK_METHODn`, `MOCK_CONST_METHODn`, etc.) remain supported but are deprecated.

The new unified `MOCK_METHOD` macro syntax improves expressiveness and compatibility with modern C++ features.

### Key Implications:

- Refactor mock method definitions to use the new syntax for better compile-time error diagnostics and future-proofing.
- Parentheses are now necessary around return types or argument types containing commas; alternatively, use type aliases.

```cpp
// Old style (still works but discouraged):
MOCK_METHOD1(Foo, bool(int));

// New style (recommended):
MOCK_METHOD(bool, Foo, (int), (override));

// Handling types with commas using parentheses:
MOCK_METHOD((std::pair<int, int>), GetPair, (), (const));
```

See the [Mocking Reference](https://google.github.io/googletest/docs/reference/mocking.html#MOCK_METHOD) and the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#SimplerInterfaces) for detailed migration instructions.

---

## 3. Improved Strictness and Behavior of Expectations

GoogleMock has refined its default semantics for the following scenarios which may affect existing tests:

- **Expectation Stickiness:**
  - Expectations remain active (“sticky”) until they are saturated or explicitly retired.
  - To avoid some brittle failures on repeated calls, consider using `.RetiresOnSaturation()` or explicit sequences.
- **Uninteresting Calls:**
  - Calls to mock methods with no expectations generate warnings by default (naggy behavior).
  - Using `NiceMock` or `StrictMock` wrappers can suppress or escalate these warnings to errors.

### Migration tips:

- Review tests relying on implicit call counts or behaviors that might have changed due to stricter cardinality enforcement.
- Introduce explicit `.Times()` clauses and `.RetiresOnSaturation()` where necessary.
- Add catch-all expectations (`EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`) to handle permitted but unspecified calls.

Consult the [Nice, Strict, and Naggy Mocks documentation](https://google.github.io/googletest/api/gmock_nice_strict_mocks.html) for best practices.

---

## 4. Updated Matcher Interface and Custom Matcher Macros

Enhancements in matcher interfaces and new polymorphic matcher patterns may require:

- Updating custom matchers from legacy APIs to the polymorphic matcher model allowing better type inference and error messages.
- Transitioning custom matchers to use `MATCHER` and `MATCHER_Pk` macros where applicable for matchers with parameters.

Basic example of migration:

```cpp
// Legacy matcher:
class DivisibleBy7Matcher {
 public:
  bool MatchAndExplain(int n, std::ostream* os) const { ... }
  void DescribeTo(std::ostream* os) const { ... }
};
Matcher<int> DivisibleBy7() { return DivisibleBy7Matcher(); }

// Polymorphic matcher using MATCHER macro:
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
```

See the [Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers) section of the gMock Cookbook for detailed guidelines.

---

## 5. Changes to Default Actions and Return Value Handling

- Default values for return types are now more strictly controlled. If your tests depended on implicit defaults, verify behavior.
- For methods returning references or move-only types, use the appropriate actions (`ReturnRef()`, lambdas) explicitly.


---

## 6. Migration Steps and Best Practices

To ensure the smoothest upgrade:

1. **Verify Compiler and Build Environment**
   - Confirm C++17 support in your compiler toolchain.
   - Adjust build configurations and flags accordingly.

2. **Update Mock Classes and Methods**
   - Replace old `MOCK_METHODn` macros with new `MOCK_METHOD` syntax.
   - Wrap complex types with parentheses or typedef them.

3. **Review Expectation Clauses**
   - Audit `EXPECT_CALL` statements for cardinality and stickiness.
   - Add `.RetiresOnSaturation()` when appropriate.
   - Include catch-all expectations using wildcards for unspecified calls.

4. **Refactor Custom Matchers and Actions**
   - Adopt polymorphic matcher macros and interfaces for new and existing custom matchers.
   - Use `MATCHER_P`-family macros for parameterized matchers.

5. **Adjust Test Code for Behavioral Changes**
   - Test your suite under increased verbosity (`--gmock_verbose=info`) to identify unexpected matches or failures.
   - Use sequences and `After` constructs to manage call ordering if applicable.

<Callout>
**Note:** Changes that might affect performance or behavior in subtle ways should be carefully regression-tested in your environment.
</Callout>

---

## 7. Deprecated and Removed Features

- The legacy `MOCK_METHODn` macro family is supported for compatibility but will be removed in the future.
- Some legacy matcher interfaces and `ACTION*` macro styles are discouraged in favor of modern polymorphic equivalents.

For removal timelines and replacement strategies, track the [official GoogleTest GitHub repository](https://github.com/google/googletest) release notes.

---

## 8. Troubleshooting Common Migration Issues

- **Compilation errors about overloaded/mock methods:**
  Use fully qualified `MOCK_METHOD` syntax and disambiguate overloads with explicit matcher types or the `Const()` wrapper.

- **Unmatched expectations or unexpected calls:**
  Use verbose logging (`--gmock_verbose=info`) to trace how calls are matched to expectations.

- **Crashes due to virtual destructors missing:**
  Ensure all base classes being mocked have virtual destructors.

- **Warnings on uninteresting calls despite default actions:**
  Add explicit expectations with `.Times(AnyNumber())` or switch mocks to `NiceMock`.

- **Tests failing due to changed expectation stickiness:**
  Adjust expectations to retire upon saturation where necessary.

---

## 9. Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for detailed usage
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for core API
- [System Requirements & Supported Platforms](https://google.github.io/googletest/getting-started/setup-prerequisites-installation/system-requirements.html)
- [Mocking Workflow Guide](https://google.github.io/googletest/guides/core-workflows/mocking-workflow.html)
- [Migration Guide](https://google.github.io/googletest/guides/integration-and-scenarios/migration-guide.html)

---

## Summary

This document catalogs significant breaking changes and migration steps in GoogleMock. It guides developers to upgrade codebases for C++17 compliance, migrate to new macro syntaxes, adapt to expectation stickiness changes, and update custom matchers and actions. Adhering to best practices ensures tests remain robust, maintainable, and compatible with evolving GoogleMock releases.
