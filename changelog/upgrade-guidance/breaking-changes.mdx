---
title: "Breaking Changes & Migration Notes"
description: "Documents any backward-incompatible updates, removed or replaced APIs, changed behaviors, or required migration steps. Helps developers assess upgrade risk and plan transitions accordingly."
---

# Breaking Changes & Migration Notes

This page documents all backward-incompatible changes, removed or replaced APIs, altered behaviors, and mandatory migration steps related to GoogleMock. It empowers developers to evaluate upgrade risks and plan their transition strategies efficiently.

---

## Understanding Breaking Changes

Backward-incompatible updates in GoogleMock can affect your existing tests and mocks. This page ensures you grasp these changes clearly, so you can adjust your code with confidence and minimize disruption.

Breaking changes may include:

- API removals or replacements
- Behavioral modifications in mocking macros or expectations
- Updates to default behaviors or matcher semantics
- Changes imposing new constraints or syntactic requirements

Before upgrading, carefully review the details below and follow the migration instructions.

## Recent Breaking Changes and Migration Recommendations

### 1. Modernization of MOCK_METHOD Syntax

- Transitioned from legacy `MOCK_METHODn` macros to the comprehensive `MOCK_METHOD` macro supporting qualifiers like `const`, `override`, and reference qualifiers.
- **Migration:**
  - Replace deprecated `MOCK_METHODn` macros with `MOCK_METHOD` for better readability and maintainability.
  - Use the 4th parameter of `MOCK_METHOD` to specify qualifiers explicitly.

*Example:*
```cpp
// Old
MOCK_CONST_METHOD1(Foo, int(int));

// New
MOCK_METHOD(int, Foo, (int), (const, override));
```

### 2. Enforcing `MOCK_METHOD` Placement

- All `MOCK_METHOD` declarations **must** be placed in the `public:` section of the mock class, regardless of the original method's access level.
- This requirement ensures consistent access for macros like `EXPECT_CALL` and `ON_CALL`.

*Migration Note:* Move any `MOCK_METHOD` declarations from `private` or `protected` sections to `public:`.

### 3. Changes in Expectation Matching Order

- GoogleMock now matches mock function calls against expectations and default actions by searching **backwards** (i.e., the most recently declared matching expectation applies).

*Implication for Users:*
- More specific expectations should be declared **after** more general ones.
- This enables setting default behaviors early and overriding them with specific expectations later.

### 4. Introduction of `RetiresOnSaturation()` Clause

- Expectations are *sticky* by default — they remain active even after reaching their invocation upper bound, causing errors for additional matching calls.
- To avoid this, use `.RetiresOnSaturation()` to instruct an expectation to become inactive once saturated.

*Migration Tip:* Review your tests for expectation saturation errors and add `.RetiresOnSaturation()` where appropriate, especially in sequences of consecutive `WillOnce()` calls.

### 5. Enhanced Handling of Overloaded and Const Methods

- Mocking overloaded functions or functions overloaded on const qualifiers requires explicit disambiguation:
  - Use `Const()` wrapper for const method overloads.
  - Specify exact matcher types or use `TypedEq` to resolve ambiguity.

*Example:*
```cpp
EXPECT_CALL(mock, GetBar()).WillOnce(ReturnRef(bar1));        // Non-const
EXPECT_CALL(Const(mock), GetBar()).WillOnce(ReturnRef(bar2)); // Const
```

### 6. Better Support for Move-Only Types

- Now you can define mock methods that take or return move-only types (e.g., `std::unique_ptr`) directly using `MOCK_METHOD`.
- Default actions return a null or default instance as appropriate.
- For repeated returns of new objects, use lambdas or functors rather than `Return(std::move(...))` to avoid runtime errors.

*Migration Highlight:* Replace legacy delegation patterns and prefer lambdas for generating fresh move-only objects per call.

### 7. Default Behavior Control via ON_CALL

- `ON_CALL` defines default behavior without setting expectations, differentiating it clearly from `EXPECT_CALL`.
- Multiple `ON_CALL`s for the same method apply with newest having precedence, separate from expectation precedence.

*Migration Advice:* Use `ON_CALL` for common mock behavior setup and `EXPECT_CALL` only where verification is needed.

### 8. Strictness Wrappers and Uninteresting Call Management

- New behavior clarifies distinctions between uninteresting calls (no matching `EXPECT_CALL`) and unexpected calls (calls not matching set expectations).
- We recommend using `NiceMock` to suppress uninteresting call warnings and `StrictMock` to treat uninteresting calls as errors.

*Migration Note:* Consider adopting appropriate strictness wrappers for your mock classes to reflect desired test strictness.

## Migration Guidance

To smoothly adapt your tests to the latest GoogleMock changes, follow these steps:

1. **Audit your mock classes** for deprecated macro usage (`MOCK_METHODn`) and update to the modern `MOCK_METHOD` syntax.
2. **Ensure all mocked methods are declared public** in your mock classes, moving any `MOCK_METHOD` declarations accordingly.
3. **Review the order of `EXPECT_CALL` statements**, placing more general expectations first and more specific ones afterward.
4. **Add `.RetiresOnSaturation()`** to expectations that should deactivate when saturated to prevent unintended upper-bound errors.
5. **Explicitly disambiguate overloaded and const methods** using `Const()` and type-specific matchers.
6. **Update mocks working with move-only types** by replacing legacy delegation with direct `MOCK_METHOD` and lambdas for return values.
7. **Adopt strictness wrappers (`NiceMock`, `StrictMock`)** where suppression or enforcement of uninteresting call warnings is desired.
8. **Leverage `ON_CALL` to set default behaviors** where calls are expected but do not require verification.

## Troubleshooting Common Breakage Patterns

- **Unexpected mock function call errors:** Check for argument mismatches and ensure expectations are declared correctly and in right order.
- **Upper bound violations:** Add `.RetiresOnSaturation()` or adjust cardinalities.
- **Compilation errors around mock method declarations:** Ensure `MOCK_METHOD` macros are in `public:` and properly qualified.
- **Ambiguous overload errors:** Disambiguate using `Const()`, `TypedEq`, or fully specify matcher types.
- **Failures with move-only types:** Use lambdas instead of `Return(std::move(...))`.

## Legacy Support

While older versions of gMock had macros like `MOCK_METHODn` and non-standard behaviors, current versions promote consistency, maintainability, and correctness through the unified `MOCK_METHOD` macro and clearer semantics for expectations, actions, and strictness.

Avoid reverting to legacy approaches unless absolutely necessary.

---

## Additional Resources

- [Mocking Reference](../reference/mocking.md): Comprehensive overview of mocking constructs.
- [Legacy gMock FAQ](../gmock_faq.md): Answers to common user questions involving breaking changes.
- [gMock Cookbook](../gmock_cook_book.md): Practical recipes for defining and using mocks.
- [Expectations and Actions Guide](../../guides/mocking-techniques/expectations-and-actions.md): Detailed guide on expectation setting and behavior definition.
- [Mock Strictness Guide](../../guides/mocking-techniques/strictness-and-mock-behavior.md): Explanation of NiceMock, NaggyMock, and StrictMock usage.

For upgrade steps covering the entire product, consult the [How to Upgrade Your Project](../upgrade-guidance/upgrade-instructions.md) page.

---

### Practical Tips

- Start by running your existing tests with increased verbose output (`--gmock_verbose=info`) to identify unexpected/missing expectations.
- Add `.RetiresOnSaturation()` proactively to prevent sticky expectation errors in iterative WillOnce sequences.
- Organize your `EXPECT_CALL`s carefully; remember, the last matching expectation takes precedence.
- Use `ON_CALL` extensively for default behavior, reserving `EXPECT_CALL` for important call verifications.
- Embrace strictness wrappers to maintain clean test runs and manageable warning levels.

---

## Troubleshooting

If you encounter unexpected failures after upgrading:

- Verify that mock method declarations use the recommended `MOCK_METHOD` syntax.
- Confirm all mock methods live in the `public:` section.
- Check for correct use of qualifiers and disambiguation on overloaded or const methods.
- Adjust expectation cardinality using `.Times()` or `.RetiresOnSaturation()`.
- Consider the order of `EXPECT_CALL` statements to ensure correct matching.

Use the [Legacy gMock FAQ](../gmock_faq.md) for helpful diagnostics related to typical pitfalls post-migration.

---

## Summary
This page equips you with the knowledge to recognize breaking changes in GoogleMock and follow clear migration paths, reducing upgrade friction. Leveraging the upgraded syntax and behavior best practices will ensure your mocks remain maintainable, expressive, and robust.

---

*This document is focused solely on breaking changes and migration notes affecting mocking with GoogleMock, positioning it within the transition and upgrade section of the documentation.*
