---
title: "Breaking Changes and Migrations"
description: "A clear summary of any breaking changes introduced in recent versions, with concise migration instructions and references to affected features or files. Essential for teams upgrading across major versions."
---

# Breaking Changes and Migrations

GoogleTest evolves with enhancements and improvements that sometimes introduce breaking changes. This page clearly summarizes any such breaking changes introduced in recent major releases, along with concise migration instructions to guide your upgrade process. It is essential reading for teams planning to upgrade across major versions to maintain a smooth testing environment.

---

## What Is Covered Here

This page focuses exclusively on changes that may impact existing user tests and mocks written with GoogleTest and GoogleMock. It highlights:

- Breaking changes affecting core macros, APIs, or behaviors in GoogleTest and GoogleMock
- Required code or test changes for a successful migration
- Deprecated features with removal timelines
- References to affected headers, macros, or test patterns

---

## Understanding Breaking Changes

### Why Breaking Changes Happen

Breaking changes are sometimes necessary for:

- Improving API clarity or usability
- Correcting long-standing issues or bugs
- Enhancing safety and correctness guarantees
- Removing rarely used or obsolete features

### Identifying Breaking Changes

Typical signs that a change is breaking:

- Public APIs or macro signatures have changed
- Behavioral changes that affect test outcomes or mock verifications
- Removed or renamed macros or classes
- Changes in default settings that alter test execution flow

---

## Migration Basics

To migrate across major versions with breaking changes, you should:

1. **Review the breaking changes listed here** carefully for the versions you are upgrading to
2. **Update your test mocks and test code** as recommended
3. **Run your full test suite** to identify incompatibilities and verify fixes
4. **Consult additional migration guides or upgrade checklists** as needed

---

## Notable Breaking Changes in Recent Versions

### MOCK_METHOD Macro Redesign

GoogleTest unified and modernized mock method declarations by introducing the generic `MOCK_METHOD` macro, replacing the old `MOCK_METHODn` family:

- Old style: `MOCK_METHOD1(Foo, bool(int))`
- New style: `MOCK_METHOD(bool, Foo, (int))`

**Impact:**

- Migration requires updating mock class definitions to the new macro syntax
- Changes the order and grouping of parameters
- Supports richer qualifiers like `const`, `override`, `noexcept`, and calling conventions

**Migration Tip:** Use parentheses around return types or argument types containing commas, e.g.,

```cpp
MOCK_METHOD((std::pair<int, bool>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
```

See the [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#MOCK_METHOD) and [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#mocking-classes) for detailed migration examples.

---

### Const and Overloaded Method Handling in Mocks

- GoogleMock now requires explicit use of `(const)` qualifier in `MOCK_METHOD` for const methods.
- Overloaded methods must all be mocked using the new macro and can require use of `Const()` wrapper in expectations for const overload disambiguation.

**Impact:**

- Ensure all overloaded methods are mocked.
- Use `Const()` wrappers to make expectations explicit.

Example:

```cpp
EXPECT_CALL(Const(mock_foo), GetBar()).WillOnce(ReturnRef(bar));
```

See [Mocking Reference - SelectOverload](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#selecting-between-overloaded-functions) for details.

---

### Uninteresting vs Unexpected Calls Behavior

GoogleMock clearly distinguishes:

- *Uninteresting calls*: Methods with **no** `EXPECT_CALL` but invoked. Causes warnings by default.
- *Unexpected calls*: Calls that don't match any existing `EXPECT_CALL`. Always an error.

**Change:**

- Added facilities like `NiceMock<T>` and `StrictMock<T>` to customize whether warnings are shown or treated as errors for uninteresting calls.

**Impact:**

- Migrate uninteresting call warnings by wrapping mocks in `NiceMock` or `StrictMock` as needed.
- Avoid blindly adding `EXPECT_CALL` to silence warnings.

See [gMock Cookbook - The Nice, the Strict, and the Naggy](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#the-nice-the-strict-and-the-naggy) for best practices.

---

### Actions and Matchers Enhancements

Improvements to actions and matchers might cause minor incompatibilities:

- `EXPECT_CALL` now infers cardinalities differently when `WillOnce`/`WillRepeatedly` are used.
- Parameterized matchers and actions now require careful attention to typing and ownership to avoid compile errors.

**Impact:**

- Review and adapt actions using lambdas or functors to match new expectations.
- When using `Return()` with move-only types, prefer lambdas or `ReturnPointee()` for safety.

See [gMock Cookbook - Using Actions](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#using-actions) and [Creating and Using Mocks](https://github.com/google/googletest/blob/main/guides/mocking-and-advanced-techniques/creating-and-using-mocks.md).

---

### Verifying and Clearing Mocks

- Added new APIs `Mock::VerifyAndClearExpectations` and `Mock::VerifyAndClear` to verify and clear expectations explicitly.

**Impact:**

- You can now force verification before destruction to detect silent failures.

```cpp
ASSERT_TRUE(Mock::VerifyAndClearExpectations(&mock_object));
```

See [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#classes) for details.

---

### Deprecated and Removed Features

- The old `MOCK_METHODn` macros are deprecated although still supported, and will be removed in future releases. Migrate to the unified `MOCK_METHOD` macro.
- Deprecated named flags or behaviors may be removed.

---

## Common Migration Pitfalls and Solutions

### Compilation Failures from Changed Macro Signatures

Ensure your mock method declarations are updated and correct, especially with:

- Correct parentheses around types with commas
- Proper qualifier order (e.g., `(const, override)`)

### Ambiguous Calls to Overloaded Methods

Use `Const()` to disambiguate const methods in expectations.

### Unintended Mock Behavior due to Missing Expectations

Uninteresting call warnings alert you to missing expectations or unexpected calls. Use `NiceMock` or add catch-all expectations carefully.

### Problems with Move-Only Types

Use lambdas with `WillOnce` or `WillRepeatedly` to provide fresh objects on each call.

---

## Step-by-Step Migration Workflow

<Steps>
<Step title="Prepare">
Review the GoogleTest release notes and breaking changes documented here for your target version.
</Step>
<Step title="Update Mock Classes">
Convert `MOCK_METHODn` macros to the new `MOCK_METHOD` macro syntax;
add explicit `const` and other qualifiers as needed.
</Step>
<Step title="Fix Test Expectations">
Adjust your `EXPECT_CALL` and `ON_CALL` statements, using `Const()` for const overloads
and adding catch-all expectations for uninteresting calls.
</Step>
<Step title="Fix Actions and Matchers">
Review all custom and complex actions/matchers;
update lambdas and functors as per new recommended patterns.
</Step>
<Step title="Run and Debug">
Run your full test suite with `--gmock_verbose=info` to check for warnings or failures;
address them before proceeding.
</Step>
<Step title="Finalize">
Add `Mock::VerifyAndClearExpectations()` calls in tests where mock lifetime is non-trivial.
</Step>
</Steps>

---

## Troubleshooting Tips

- When a mock method seems not mocked, confirm it is declared `virtual` and overridden with `MOCK_METHOD`.
- Use `--gmock_verbose=info` to get detailed expectation matching information.
- Check for missing virtual destructors in interfaces to avoid object lifecycle issues.
- Ensure expectations are set before the mock method is called.
- For move-only types, ensure actions create fresh objects on each call.

---

## Additional Resources

- [Migration Checklist](./upgrade-checklist)
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [Breaking Changes and Removals](./deprecations)

---

## Summary

This page provides a focused, user-centric summary of breaking changes and migrations specific to GoogleTest and GoogleMock. It empowers users to upgrade safely by highlighting critical API shifts, updated macro usage, behavior changes, and strategies to maintain test stability and accuracy.

---