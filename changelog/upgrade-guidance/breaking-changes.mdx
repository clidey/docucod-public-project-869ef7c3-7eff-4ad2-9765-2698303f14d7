---
title: "Breaking Changes"
description: "Explains updates that are incompatible with previous versions, including migration steps, removed features, and critical behavioral differences. Helps users assess the impact on their code and avoid hidden pitfalls."
---

# Breaking Changes

The Breaking Changes page is your essential guide for understanding modifications in GoogleTest and GoogleMock that are incompatible with previous versions. It helps you identify updates requiring code adjustments, migrating paths, or adapting to removed or modified features.

---

## Understanding Breaking Changes

When working with evolving libraries like GoogleTest, certain updates introduce breaking changesâ€”alterations that shift APIs, deprecate or remove features, or change behavior in ways that may impact existing codebases. This page provides detailed guidance on such changes, so you can quickly assess their impact and apply necessary modifications.

### Why Pay Attention to Breaking Changes?

- Avoid hidden failures that arise silently due to API incompatibilities.
- Plan migration with minimal disruption.
- Leverage newly recommended patterns replacing obsolete or changed features.

---

## Migration and Upgrade Guidance

### Key Points:

- **Plan Upgrades Carefully**: Review breaking changes before upgrading your GoogleTest and GoogleMock libraries.
- **Identify Removed Features**: Some APIs or macros may no longer exist or have changed usage.
- **Adopt New Practices**: Some behaviors previously considered defaults might now require explicit handling.

*Example:* If a macro or method was removed or renamed, update your test code accordingly to use the new recommended alternatives.

---

## Removed or Modified Functionality

- **Macros and Methods**: Certain mock method and matcher macros could be deprecated or replaced. For instance, older `MOCK_METHODn` macros are replaced by the generic `MOCK_METHOD` macro.
- **Default Actions Behavior**: The way default actions are inferred or applied might have altered, affecting how mock methods behave when no explicit expectations are set.

Review the method signatures in your mocks, and adapt calls to `ON_CALL` and `EXPECT_CALL` as needed.

---

## Behavioral Changes

- **Sticky Expectations**: Expectations are "sticky" by default, which means they remain active even when their invocation upper bounds are reached, potentially causing test failures unless marked with `RetiresOnSaturation()` or placed inside a sequence.
- **Verbose Flags Behavior**: The handling of verbosity flags (`--gmock_verbose`) might be changed, impacting the amount of diagnostics printed during uninteresting or unexpected calls.

*Tip:* Use `NiceMock` or `StrictMock` to control the behavior on uninteresting calls as per your test style needs.

---

## Practical Migration Tips

### Step 1: Audit Your Mock Classes

- Check that all mock methods use the `MOCK_METHOD` macro with correct qualifiers (e.g., `(override)`, `(const)`).
- Replace deprecated macros or patterns with the latest syntax.

### Step 2: Review Usage of `ON_CALL` and `EXPECT_CALL`

- Ensure default actions are explicitly specified via `ON_CALL(method).WillByDefault(action)` when necessary.
- Update expectations to reflect new cardinality inference rules.

### Step 3: Adjust Call Order and Retirement

- Use `RetiresOnSaturation()` on expectations that should become inactive after they are met.
- Use `InSequence` or `Sequence` to enforce call order as per your original test intent.

### Step 4: Leverage Updated Matchers and Actions

- For custom and parameterized matchers, ensure they follow the updated interface and macro usage.
- Update any use of deprecated or less efficient actions with recommended patterns.

### Step 5: Run Tests with Verbose Output

- Use `--gmock_verbose=info` while migrating to observe detailed match and expectation activity.
- Address any warnings or errors flagged based on the new enforcement rules.

---

## Common Pitfalls and How to Avoid Them

- **Unexpected Silent Failures**: Without explicit expectations, some mock calls may receive default behaviors unnoticed, potentially obscuring test failures. Use `EXPECT_CALL` or `NiceMock` to get best visibility.
- **Misordered Calls**: Tests once tolerant of call order can fail. Leverage `InSequence` or partial order with `After` clauses.
- **Overly Sticky Expectations Causing Failures**: Remember to retire expectations once saturated if not expecting further invocations.
- **Incorrect Use of Matchers**: Verify that matchers suit the argument types and follow correct usage to avoid ambiguous or incorrect matches.

---

## Troubleshooting

- If you encounter unexpected errors related to mock expectations, first verify that expectations and default actions comply with the new matching and cardinality rules.
- Review the log output when `--gmock_verbose=info` is enabled for detailed diagnostic messages.
- Consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for updated idioms and examples.

---

## Summary

This page is critical when upgrading GoogleTest and GoogleMock to newer versions. It ensures you understand what code must change, how default behaviors shifted, and how to adapt your tests to keep them stable and maintainable.

---

## Helpful Links

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Introductory guide to mocking.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Detailed API descriptions.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes for practical mocking.
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html): Learn about matchers and their use.
- [GoogleTest Overview - Core Concepts](../overview/introduction-core-concepts/core-concepts-terminology.html): Understand testing basics and terminology.

---

## Additional Recommendations

- Always write `EXPECT_CALL` statements *before* code that exercises the mock.
- Prefer using `ON_CALL` to specify default behaviors without expectations.
- Use `NiceMock` to suppress warnings for uninteresting calls during early test development.
- Switch to `StrictMock` to enforce stricter verification as tests mature.
- Always check test output and warnings upon upgrading to preempt surprises.

---

For the fuller modeling of your testing code, ensure your mock method declarations use the `MOCK_METHOD` macro correctly with qualifiers such as `override` and `const` when required. Use matchers and actions to define precise mock behaviors, and pay attention to changes in cardinality and call order semantics.

---

_Last updated based on GoogleTest and GoogleMock main branch as of June 2024._
