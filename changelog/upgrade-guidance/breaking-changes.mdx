---
title: "Breaking Changes & Deprecations"
description: "Explicit callout of any backward-incompatible changes in new versions, as well as deprecations or removals of key features, APIs, or build requirements. Highlights migration pain points so teams can plan their transitions with minimal downtime."
---

# Breaking Changes & Deprecations

This page highlights the **backward-incompatible changes** and **deprecated features** in GoogleTest and GoogleMock. It is essential reading when upgrading to newer versions, as it alerts you to changes that may impact your existing codebases and test suites.

## Overview

GoogleTest and GoogleMock strive to maintain backward compatibility. However, new features, improvements, and refactors occasionally require breaking changes or deprecations. Understanding these is critical to ensure smooth migration and minimal disruption.

---

## Key Breaking Changes

### 1. Mock Method Syntax and Behavior

- The classic `MOCK_METHODn` macros continue to be supported but are **deprecated** in favor of the modern, uniform `MOCK_METHOD` macro. Migrating to `MOCK_METHOD` improves clarity and supports qualifiers like `const`, `override`, and `noexcept` more cleanly.

- The `MOCK_METHOD` macro enforces placement in the `public` section of mock classes regardless of the base method's access level. Violating this may cause compilation errors.

- The 4th parameter of `MOCK_METHOD` now officially accepts a closed list of qualifiers including `const`, `override`, `noexcept`, `Calltype(...)`, and `ref(...)`. Not specifying these correctly might produce compilation failures or incorrect behavior.

### 2. Strictness Modifiers: NiceMock, NaggyMock, StrictMock

- The mock wrappers `NiceMock`, `NaggyMock`, and `StrictMock` are now implemented as **template subclasses** of your mock class that modify mock behavior toward uninteresting calls. 

- **Important:** These strictness modifiers apply *only* to mock methods defined **directly** in the mock class using `MOCK_METHOD*` macros. If a mock method is inherited from a base class, the strictness modifiers may not affect that method’s behavior.

- Nesting strictness modifier wrappers (e.g., `NiceMock<StrictMock<MockFoo>>`) is **not supported** and will cause compilation errors.

- If your code creates mocks using strictness modifiers where the base mock class already has one, a static assertion will trigger. This guards against redundant or conflicting strictness specifications.

### 3. Default Actions and ON_CALL Behavior

- Every `ON_CALL` declaration **must** have exactly one `.WillByDefault()` clause. Omitting `WillByDefault` in an `ON_CALL` is now a runtime error.

- The `.With()` clause in `ON_CALL` and `EXPECT_CALL` must be used at most once and, if specified, must appear as the first modifier.

- `EXPECT_CALL` and `ON_CALL` clauses evaluate their arguments exactly once per statement as per standard usage. Overloading or macro expansions that violate this may cause unexpected side effects.

### 4. Expectation Matching and Ordering

- `EXPECT_CALL` statements are matched in **reverse order** of definition. More recent declarations take precedence.

- The order of modifier clauses after `EXPECT_CALL` is strictly enforced. For example, `.With()` must come before `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`.

- `.RetiresOnSaturation()` marks an expectation to become inactive once saturated, helping avoid errors from excessive calls.

- Functions with multiple `WillOnce()` clauses followed by a `WillRepeatedly()` clause will infer their cardinality as `Times(AtLeast(n))`, where *n* is the count of `WillOnce()` clauses.

### 5. Move-Only Types Support

- Full support for mocking methods with **move-only** types (e.g., `std::unique_ptr`) as parameters or return types is now provided via `MOCK_METHOD` and related actions.

- Returning move-only types with `Return()` in `WillOnce` is allowed only once, as subsequent attempts to move the value will cause errors. To produce different values on repeated calls, use lambdas or functors to create new instances.

- Legacy workarounds using helper mock methods are **deprecated**.

### 6. Verbosity and Warning Flags

- The flag `--gmock_verbose` controls the amount of information shown for mock call events and uninteresting calls with valid values: `info`, `warning` (default), and `error`.

- Setting this flag to invalid values defaults to `warning` behavior.

- Increasing verbosity to `info` enables detailed traces of mock calls and matched expectations to aid debugging.

- `NiceMock` suppresses uninteresting call warnings, whereas `NaggyMock` emits warnings, and `StrictMock` treats uninteresting calls as failures.

### 7. Testing in Multi-Threaded Contexts

- To avoid undefined behavior, **set expectations and default actions only when no other threads are invoking the mock's methods**.

- Mock methods called concurrently are safe. Actions run in the caller’s thread.

- Global resources like `DefaultValue<T>` should not be modified concurrently with other mock activity.

### 8. Removal and Deprecation Notices

- The family of macros `MOCK_METHODn`, `MOCK_CONST_METHODn`, etc., while still supported, will be future-deprecated. Moving to the unified `MOCK_METHOD` macro is strongly recommended.

- Certain older internal APIs related to mock verification and mock object lifetime management are deprecated.

- The legacy `ACTION` macros are discouraged for new code; prefer lambda-based or functor-based actions.

## Migration Tips

To migrate your existing tests smoothly:

- Convert legacy `MOCK_METHODn` macros to the `MOCK_METHOD` form, adding necessary qualifiers.

- Review all `EXPECT_CALL` and `ON_CALL` usages to ensure proper use of clauses and their ordering.

- Use `WillByDefault` in every `ON_CALL`.

- If using strictness modifiers (`NiceMock`, `NaggyMock`, `StrictMock`), ensure your mock methods are declared directly in the mock class.

- Replace deprecated patterns with their modern counterparts, such as move-only type actions with lambdas.

- Leverage the verbosity flag `--gmock_verbose=info` to trace failing mocks during upgrade.

- Use `.RetiresOnSaturation()` when applicable to avoid accidentally re-matching saturated expectations.

- Avoid nesting strictness wrappers.

- If facing unexpected match or verification failures, review call order, argument matchers, and expectations precedence carefully.

<Tip>
Migrating to the new `MOCK_METHOD` macro syntax not only future-proofs your tests but also improves readability and compatibility with C++ language features like `const` and `override`. Start by modernizing one mock class at a time.
</Tip>

<Note>
Always verify your upgraded tests with higher verbosity settings and heap checks enabled. This ensures that mock ownership, expectations, and default actions behave correctly in real test scenarios.
</Note>

---

## Examples of Breaking Changes

### Modernizing Mock Methods

```cpp
// Old Style
class MockFoo {
 public:
  MOCK_CONST_METHOD1(Foo, bool(int));
};

// New Style
class MockFoo {
 public:
  MOCK_METHOD(bool, Foo, (int), (const, override));
};
```

### Enforcing Single .With() Clause

```cpp
// Incorrect - causes runtime failure
EXPECT_CALL(mock, Method(_))
    .With(Lt())
    .With(Gt());

// Correct
EXPECT_CALL(mock, Method(_))
    .With(Lt());
```

### Using `.RetiresOnSaturation()`

```cpp
EXPECT_CALL(mock, Method(7))
    .Times(2)
    .RetiresOnSaturation();
```

Ensures that after two calls matching `Method(7)`, this expectation is no longer active, allowing other expectations to match subsequently.

---

## Troubleshooting Common Upgrade Issues

- **Compilation Errors on MOCK_METHOD Usage**:
  - Ensure argument types with commas are wrapped in extra parentheses or replaced with typedefs.
  - Check for missing qualifier parameters like `const` or `override`.
  - Confirm macros are placed in public sections.

- **Unexpected Behavior in Mock Strictness**:
  - Strictness modifiers have no effect on inherited mock methods; declare all mocked methods in the mock class.
  - Avoid nesting strictness wrappers.

- **Warnings or Errors About Missing WillByDefault Clauses**:
  - Add `.WillByDefault()` to all `ON_CALL` statements.

- **Failure in Sequences or Order**:
  - Confirm `.InSequence()` and `.After()` clauses are used properly and in the correct order.

- **Mock Methods Not Matching Expected Calls**:
  - Check order of `EXPECT_CALL` statements (last matching rule).
  - Use `--gmock_verbose=info` to track call matching.

- **Default Return Values for Non-Default-Constructible Types**:
  - Set explicit default values using `DefaultValue<T>::Set()` or specify actions in `ON_CALL`.

---

## Summary

This page provides a comprehensive overview of all backward-incompatible changes, deprecated features, and critical usage notes to guide migration to newer GoogleTest and GoogleMock versions. It emphasizes modern mock declaration practices, strictness modifier behaviors, expectation syntax rules, default action requirements, and move-only types support.

For more detailed examples, usage patterns, and troubleshooting support, refer to the related reference documentation and guides.

---

## Related Documentation

- [Mocking Reference](../../api-reference/mocking-framework/define-and-use-mocks.md) — Detailed explanation of mock method macros and behavior expectations.
- [gMock Cookbook](../../docs/gmock_cook_book.md) — Recipes on advanced mocking techniques and migration tips.
- [Nice, Naggy, and Strict Mocks](../../api-reference/mocking-framework/mock-behavior-modes.md) — Understanding mock behavior modifiers.
- [gMock for Dummies](../../docs/gmock_for_dummies.md) — Beginner-friendly introduction to mock writing.
- [Legacy gMock FAQ](../../docs/gmock_faq.md) — Frequently asked questions regarding legacy behaviors and migration.
- [GoogleMock README](../../googlemock/README.md) — Official overview and philosophy.

---

## Next Steps

- Review your existing mocks and update to the `MOCK_METHOD` macro syntax.
- Audit all usages of `EXPECT_CALL` and `ON_CALL` for clause order and required `.WillByDefault()` usage.
- Consider employing `NiceMock` or `StrictMock` thoughtfully to control test noise and enforcement.
- Enable `--gmock_verbose=info` during test runs to gain visibility into mocks and expectations.
- Use `.RetiresOnSaturation()` in cases where multiple expectations overlap to avoid spurious errors.
- Consult the [Upgrade Instructions](./upgrade-instructions.md) for detailed step-by-step guidance.

---