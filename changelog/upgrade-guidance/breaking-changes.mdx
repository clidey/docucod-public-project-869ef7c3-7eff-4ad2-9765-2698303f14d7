---
title: "Breaking Changes and Migration Notes"
description: "Details API, build, or behavioral changes that may impact backward compatibility. Each update includes context, rationale, and step-by-step migration advice, helping users avoid common pitfalls."
---

# Breaking Changes and Migration Notes

This page documents API, build, and behavioral changes in GoogleTest and GoogleMock that affect backward compatibility. Each update includes context on what changed, the rationale behind the change, and detailed, step-by-step migration instructions. This guidance empowers users to smoothly upgrade their tests and avoid common pitfalls.

---

## Understanding Breaking Changes

When upgrading to a newer version of GoogleTest or GoogleMock, you need to be aware of breaking changes that may impact your existing test code. Breaking changes can include:

- Modified or removed APIs
- Changed method signatures or behavior
- Updated build requirements or configurations
- Behavioral changes that affect test outcomes

This page helps you anticipate and resolve such changes to maintain the reliability and correctness of your test suites.

---

## Recent Breaking Changes and How to Migrate

Below are selected breaking changes introduced in recent GoogleTest and GoogleMock releases, accompanied by clear migration advice.

### 1. Mock Method Signature Updates

**Context:** To enhance consistency and modern C++ support, some mock methods have updated their signatures, including added qualifiers such as `const`, `override`, or `noexcept`.

**Impact:** Mock classes using `MOCK_METHOD` must update their method declarations accordingly.

**Migration Steps:**

1. Identify failing compilations or warnings related to mock methods.
2. Review your mock method declarations.
3. Add missing qualifiers such as `(const)`, `(override)`, or `(noexcept)` to `MOCK_METHOD` macros.

**Example:**

```cpp
// Before
MOCK_METHOD(void, Resume, ());

// After
MOCK_METHOD(void, Resume, (), (override));
```

---

### 2. Handling Uninteresting Calls with NiceMock and StrictMock

**Context:** By default, uninteresting calls (calls for which no explicit expectation is set) produce warnings. To control this, GoogleMock introduced `NiceMock` (suppresses warnings) and `StrictMock` (treats uninteresting calls as failures).

**Impact:** Tests may fail or become noisy when upgrading if using default mocks.

**Migration Steps:**

- To suppress warnings, replace your mock with `NiceMock<YourMockClass>`.
- To enforce stricter checking, use `StrictMock<YourMockClass>`.

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> mock_foo;      // No warnings on uninteresting calls.
StrictMock<MockFoo> mock_foo;    // Fail on uninteresting calls.
```

**Tip:** Use these wrappers only for mock classes with methods declared via `MOCK_METHOD` directly.

---

### 3. Expectations Ordering Clarifications

**Context:** GoogleMock expects calls to fulfill expectations based on declaration ordering, but supports explicit ordering via `InSequence` and `After`. Improper ordering can trigger unexpected failures.

**Impact:** Tests with sequencing may fail if upgraded GoogleMock enforces stricter call order.

**Migration Steps:**

- Use `InSequence` blocks to enforce call order.
- Use explicit `After()` prerequisites to define dependencies between calls.

Example for sequence enforcement:

```cpp
using ::testing::InSequence;
{
  InSequence seq;
  EXPECT_CALL(mock, Initialize());
  EXPECT_CALL(mock, Execute());
}
```

Example for partial order with `After()`:

```cpp
Expectation init = EXPECT_CALL(mock, Initialize());
EXPECT_CALL(mock, Execute()).After(init);
```

---

### 4. Updated Default Actions and Expectation Behaviors

**Context:** The handling of default actions for mock methods, especially when none is specified, has evolved to align more closely with intuitive behavior.

**Impact:** Calls matching an `EXPECT_CALL` without specified actions now behave predictably; missing default return values may cause runtime errors.

**Migration Steps:**

- Always specify default actions for mock methods that return non-default-constructible types via `ON_CALL` or `EXPECT_CALL`.

```cpp
ON_CALL(mock, GetValue()).WillByDefault(Return(42));
EXPECT_CALL(mock, GetValue());  // Uses default action.
```

- Clear default actions using `Mock::VerifyAndClear()` when resetting mocks.

---

### 5. Move-Only Type Support in Mocking

**Context:** Recent GoogleMock versions fully support mocking methods with move-only argument and return types, such as `std::unique_ptr`.

**Impact:** Older workaround patterns are no longer required.

**Migration Steps:**

- Use `MOCK_METHOD` normally with move-only types.
- Use lambdas or callable objects for complex actions.

Example:

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));

EXPECT_CALL(mock_buzzer_, MakeBuzz("hello"))
    .WillOnce([](StringPiece) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

---

## Common Pitfalls and Troubleshooting

### Compilation Errors Related to Mock Method Qualifiers

- **Cause:** Discordance between mock method qualifiers (`const`, `override`, `noexcept`) and base class.
- **Solution:** Ensure mock methods have matching qualifiers. Use explicit qualifiers in `MOCK_METHOD`.

### Uninteresting Call Warnings

- **Cause:** Calls to mocked methods without expectations.
- **Solution:** Use `NiceMock` to suppress warnings or add broad `EXPECT_CALL` with `Times(AnyNumber())`.

### Excessive Call Failures

- **Cause:** Mock method called more times than expected.
- **Solution:** Adjust `Times()` constraints or add `.RetiresOnSaturation()` to expectations.

### Default Action Exhaustion Warnings

- **Cause:** Number of `WillOnce()` actions exhausted without `WillRepeatedly()`.
- **Solution:** Add `WillRepeatedly()` clause or increase expected call counts.

---

## Migration Workflow

When upgrading:

1. **Review** the release notes and breaking change documentation for your target version.
2. **Build** your test suite with the new version. Note compilation or runtime failures.
3. **Identify** affected mock classes and test cases.
4. **Apply** required code changes:
   - Update mock method declarations.
   - Add or adjust mock expectations.
   - Use `NiceMock` or `StrictMock` as needed.
5. **Run** your tests and verify behavior.
6. **Consult** the documentation and community resources if issues arise.

---

## Additional Resources

For comprehensive understanding, consult the following pages:

- [Mock Class and Method Definitions](/api-reference/mocking-framework/mock-class-definitions): Detailed usage of `MOCK_METHOD` and mock class design.
- [Setting Expectations & Sequences](/api-reference/mocking-framework/setting-expectations): How to specify call expectations and ordering.
- [Mock Actions](/api-reference/mocking-framework/mock-actions): Defining return behaviors and side effects.
- [Nice, Naggy, and Strict Mocks](/api-reference/mocking-framework/strictness-modes): Controlling uninteresting call handling.
- [Upgrade Guides and Best Practices](/changelog/upgrade-guidance/upgrade-instructions): Step-by-step migration scenarios.

Additionally, the [Recent Changes and New Features](/changelog/release-highlights/recent-changes) page highlights new capabilities that may impact your usage.

---

## Summary

Careful attention to breaking changes ensures your tests remain robust and maintainable. This page centralizes crucial migration knowledge to smooth your transition between GoogleTest and GoogleMock versions.

---

_For detailed API reference and conceptual guides, see the documentation navigation._

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_cook_book.md", "range": "1-1000"},{"path": "docs/reference/mocking.md", "range": "1-4000"},{"path": "docs/reference/assertions.md", "range": "1-2000"}]} />
