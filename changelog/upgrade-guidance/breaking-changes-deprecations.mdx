---
title: "Breaking Changes & Deprecations"
description: "Highlights changes between versions that require user action, such as API modifications, removals, or requirement shifts. This includes callouts for deprecated features and recommended strategies to update affected code."
---

# Breaking Changes & Deprecations

This page details version-to-version changes in GoogleTest and GoogleMock that require your attention when upgrading. It highlights modifications that affect your existing test code or mock definitions, including API changes, entity deprecations, behavioral shifts, and compatibility concerns. By reviewing these changes carefully, you can maintain your tests’ stability and leverage improvements safely.

---

## 1. Overview

GoogleTest and GoogleMock strive to maintain backward compatibility, but some changes necessitate user action to adapt test code or build configurations. 

This page focuses exclusively on **breaking changes** and **deprecated features**:

- APIs that have been removed or altered.
- Behavioral changes that impact test outcomes.
- Deprecated macros, functions, or classes, with migration guidance.

For a comprehensive release history, including new features and bug fixes, consult the [Full Version History](https://github.com/google/googletest/blob/main/docs/changelog/release-highlights/full-version-history.md).


## 2. Notable Breaking Changes

### 2.1 MOCK_METHOD Macro Usage

- **Parsing Comma-Containing Types**: Recent versions mandate wrapping return types or argument types containing commas in an extra pair of parentheses when using `MOCK_METHOD`. 

  ```cpp
  // Correct way to mock a method returning a pair:
  MOCK_METHOD((std::pair<int, int>), GetPair, ());
  
  // Correct way to mock a method with argument having commas:
  MOCK_METHOD(void, DoSomething, ((std::map<int, double>), bool));
  ```

- Alternatively, define type aliases for complex types to avoid wrapping.

- Failure to adhere leads to compilation errors.

### 2.2 Strict Enforcement of Public MOCK_METHOD Declarations

- `MOCK_METHOD` **must always appear in the `public:` section** of mock classes, even when mocking protected or private base class methods. 

- This ensures `ON_CALL` and `EXPECT_CALL` work reliably from outside the mock.

- Declaring them outside `public:` leads to linkage or access errors.

### 2.3 Move-Only Type Support in Mocked Methods

- Modern GoogleMock fully supports mocking methods with move-only parameters (e.g., `std::unique_ptr<T>`).

- Older workarounds that redirect methods with move-only parameters to mock methods without move-only arguments are no longer necessary.

  ```cpp
  // Old workaround:
  MOCK_METHOD(bool, DoShareBuzz, (Buzz* buzz, Time ts));
  bool ShareBuzz(std::unique_ptr<Buzz> buzz, Time ts) override {
    return DoShareBuzz(buzz.get(), ts);
  }
  ```

- You can now mock move-only parameter methods directly with `MOCK_METHOD`.

- When returning move-only types, supply lambdas or `WillOnce` with rvalues instead of `Return()` with moved objects, to avoid runtime errors.

### 2.4 EXPECT_CALL and ON_CALL Behavior Changes

- **Default cardinality inference** when no `.Times()` is specified has been formalized:
  - No actions specified → `Times(1)` is assumed.
  - `n` `WillOnce` clauses and no `WillRepeatedly` → `Times(n)`.
  - `n` `WillOnce` clauses and one `WillRepeatedly` → `Times(AtLeast(n))`.

- This change affects test expectations when upgrading from older versions.

### 2.5 Deprecation of Old-Style `MOCK_METHODn` Macros

- The legacy `MOCK_METHODn` and `MOCK_CONST_METHODn` macros are **deprecated**.

- The recommended approach is to use the generic `MOCK_METHOD` macro, which is more flexible and supports qualifiers and move-only types.

### 2.6 Strictness Mode Classes Usage

- `NiceMock<T>`, `NaggyMock<T>`, and `StrictMock<T>` must wrap mock classes **directly**, not other strictness wrappers (no nesting). 

- Mock methods in base classes of `T` may not be affected by these wrappers due to compiler limitations.

- Only mock methods defined directly in the mock class `T` benefit from these strictness modifiers.

### 2.7 Removal of Deprecated Macros and Methods

- Certain internal and outdated macros and methods have been removed or renamed.

- Users relying on GoogleTest/GoogleMock internals marked private or internal should consult migration guides.

### 2.8 Initialization Function Flag Parsing Behavior

- `InitGoogleMock()` now handles GoogleMock command-line flags (e.g., `--gmock_verbose=info`) by removing recognized flags from `argv`.

- Your test runners or frameworks may need adaptation if they parse or manipulate `argv` directly.

## 3. Migration Strategies and Recommendations

### 3.1 Handling Complex Types in MOCK_METHOD

- If your mock methods have types with commas, prefer type aliases or extra parentheses.

- Review your mock interfaces for any complex signatures and adopt fixes.

### 3.2 Use `public:` for Mock Methods

- Audit mock classes to confirm `MOCK_METHOD` declarations are in `public:` sections.

### 3.3 Adopt New Move-Only Support

- Refactor any workaround mock methods to use the direct `MOCK_METHOD` declarations with move-only types.

- Use lambdas or callables for `WillOnce` or `WillRepeatedly` when returning move-only objects.

### 3.4 Update `EXPECT_CALL` Usage

- Explicitly specify call count with `.Times()` when relying on default behavior might fail.

- Use `.WillOnce()` and `.WillRepeatedly()` carefully to avoid unexpected test failures.

### 3.5 Transition from Old-Style Macros

- Refactor legacy `MOCK_METHODn` macros to the new `MOCK_METHOD` macro for cleaner, newer syntax and compatibility.

### 3.6 Use Strictness Wrappers Appropriately

- Wrap your mock classes directly in `NiceMock<>`, `NaggyMock<>`, or `StrictMock<>` when you want specific strictness behavior.

- Avoid nesting strictness wrappers.

### 3.7 Adapt Test Initialization

- Adjust test runners to call `InitGoogleMock()` properly and handle the removal of GoogleMock flags from `argc` and `argv`.

- This ensures proper flag parsing and obviates conflicts.

## 4. Deprecated Features and Alternatives

| Deprecated Feature                 | Recommendation / Alternative                                            |
|----------------------------------|------------------------------------------------------------------------|
| `MOCK_METHODn` family macros      | Use `MOCK_METHOD` with qualifiers and parentheses as needed.           |
| Declaring `MOCK_METHOD` in private or protected sections | Always declare in `public:` section.                                   |
| Delegation pattern for move-only types | Use direct `MOCK_METHOD` declarations supporting move-only arguments. |
| Nesting `NiceMock` / `NaggyMock` / `StrictMock` wrappers | Wrap once directly around mock class.                                  |
| Use of `Return()` with moved objects | Use lambdas or `WillOnce` with fresh objects instead.                  |


## 5. Troubleshooting Common Upgrade Issues

### Symptoms:
- Compilation errors involving parsing of mock method signatures.
- Access or linkage errors on mocked methods.
- Unexpected runtime behaviors or verification failures on calls.
- Warning or errors related to uninteresting or unexpected call handling.

### Solutions:
- Inspect mock method declarations for correct use of parentheses or alias types.
- Ensure `MOCK_METHOD` declarations are under `public:`.
- Specify `.Times()` explicitly if default inference causes issues.
- Review strictness wrappers usage and remove nesting.
- Adjust test initialization code per new `InitGoogleMock` behavior.

## 6. Additional Resources

- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md): Detailed guide to mock macros and usage.
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md): Recipes on advanced mocking patterns.
- [Strictness Modes Explained](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-framework/strictness-modes.md): Understanding NiceMock, NaggyMock, and StrictMock.
- [Matchers and Actions Reference](https://github.com/google/googletest/blob/main/docs/api-reference/matchers-and-actions/builtin-matchers.md): Built-in matchers and mock actions.
- [Full Version History](https://github.com/google/googletest/blob/main/docs/changelog/release-highlights/full-version-history.md): Complete changelog with additional context.

## 7. Summary

Keeping your GoogleTest and GoogleMock code compatible requires awareness of key breaking changes and deprecations around mocking macros, strictness modifiers, and move-only types. This page summarizes concrete user-facing adjustments introduced in recent versions, ensuring smooth upgrades and stable test suites.

For detailed upgrade instructions and full version details, refer to the [How to Upgrade](https://github.com/google/googletest/blob/main/docs/changelog/upgrade-guidance/upgrade-instructions.md) and the full changelog.

---