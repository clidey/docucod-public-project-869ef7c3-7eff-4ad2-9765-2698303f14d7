---
title: "Upgrade Steps & Best Practices"
description: "Follow actionable upgrade checklists and workflow advice for moving between major versions. Includes environment preparation, compatibility checks, and validation steps to minimize risk."
---

# Upgrade Steps & Best Practices

This guide walks you through a practical, risk-minimizing workflow to upgrade GoogleMock between major versions. It focuses on actionable checklists, environment preparation, compatibility verification, and validation practices to ensure a smooth transition.

---

## 1. Preparing Your Environment

Before beginning an upgrade, set up your environment to catch potential issues early and isolate risks.

### 1.1 Backup and Version Control

- Ensure your codebase is fully committed and pushed to a remote repository.
- Tag the current stable version to easily rollback if needed.

### 1.2 Isolate the Upgrade

- Create a dedicated branch for the upgrade work.
- Avoid mixing upgrade changes with unrelated feature development to simplify troubleshooting.

### 1.3 Review Deprecated Features

- Consult the [Deprecation & Removal Notices](deprecation-notices.md) for features removed or flagged for removal.
- Plan to refactor or remove deprecated usages.

### 1.4 Review Breaking Changes

- Read the [Breaking Changes & Migration Guide](breaking-changes.md) carefully.
- Identify any API changes or behavioral differences that may affect your code.

## 2. Upgrade Checklist

Follow this step-by-step checklist to apply the upgrade while minimizing disruptions.

### 2.1 Upgrade GoogleMock Library

- Update your build dependencies to the target major version.
- Resolve all dependency version constraints and ensure successful compilation.

### 2.2 Update Mock Classes and Methods

- Replace legacy `MOCK_METHODn` macros with the generic `MOCK_METHOD` macro when applicable.
- Make all mock methods publicly accessible, as mandated by recent changes.
- Verify that mock method signatures align with the new API, adjusting qualifiers (e.g., `const`, `override`) as needed.

### 2.3 Update Test Code

- Modify `EXPECT_CALL` and `ON_CALL` usages to comply with any changes in syntax or semantics.
- Refactor any uses of deprecated or removed features flagged in the previous step.
- Adopt new strictness wrappers (`NiceMock`, `NaggyMock`, `StrictMock`) suitably to control warnings and errors on uninteresting calls.

### 2.4 Verify Default Actions

- Check default actions for mock methods especially where custom default behavior was defined via `ON_CALL`.
- Ensure that mocked methods returning complex or move-only types are appropriately handled.

### 2.5 Migrate to New Features

- Consider adopting new gMock features such as enhanced matchers, actions, and cardinality controls to improve test clarity and maintenance.

## 3. Compatibility Checks

Validate that the upgrade does not break existing behavior.

### 3.1 Build and Compile

- Perform clean builds with all tests enabled.
- Fix all compilation errors caused by API changes.

### 3.2 Run Tests With Increased Verbosity

- Use the `--gmock_verbose=info` flag during test runs to enable detailed mock call tracing.
- Analyze logs for unexpected uninteresting calls, mismatches, or failures.

### 3.3 Verify Mock Expectations

- Confirm all expectations are satisfied without unexpected calls.
- Investigate and fix tests with failures due to changed mock method behaviors or call order.

### 3.4 Validate on Different Platforms

- If applicable, run the tests on all supported platforms and compilers to catch platform-specific issues.

## 4. Validation and Troubleshooting

During and after the upgrade, keep these best practices in mind.

### 4.1 Stepwise Commit and Test

- Commit frequently with meaningful commit messages.
- Run tests after every significant change to isolate errors.

### 4.2 Use Mock Leak Detection

- Enable `--gmock_catch_leaked_mocks` to detect leaked mocks which can mask test failures.

### 4.3 Suppress Noisy Warnings Appropriately

- Convert noisy warnings about uninteresting calls to errors using `StrictMock` when needed.
- Use `NiceMock` to suppress expected but unimportant warnings.

### 4.4 Troubleshoot Common Migration Issues

- For signature clashes or const-correctness warnings, verify parameter const qualifiers and ref-qualifiers carefully.
- For unexpected call matches, explicitly add catch-all `EXPECT_CALL` statements with `.Times(AnyNumber())`.
- When mocking methods with move-only types, prefer lambdas or explicit `Return()` with freshly constructed objects.

### 4.5 Rollback If Necessary

- If the upgrade introduces significant instability, use your version control to rollback to the previous version and analyze the problems in isolation.

## 5. Best Practices for Future Upgrades

### 5.1 Keep gMock Updated Frequently

- Avoid large upgrade jumps; update incrementally across minor and patch versions.

### 5.2 Use the Newest Syntax and Conventions

- Migrate to the generic `MOCK_METHOD` macro and public mock methods early.

### 5.3 Maintain Clear Test and Mock Structuring

- Organize mocks and expectations logically, use strictness wrappers to manage noise.

### 5.4 Monitor Deprecation Notices

- Regularly review the deprecation pages and changelogs to prepare your code proactively.

### 5.5 Leverage Verbosity Flags

- Use `--gmock_verbose=info` while developing and troubleshooting tests to gain insight on mock behavior.

### 5.6 Document Mock and Test Changes

- Add inline comments or commit messages explaining migration decisions for easier future upgrades.

## 6. Additional Resources

- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Practical recipes for using mocks.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): API details for mock class definitions and methods.
- [Breaking Changes & Migration Guide](breaking-changes.md): Detailed notes on changes affecting upgrades.
- [Deprecation & Removal Notices](deprecation-notices.md): Information on deprecated and removed features.
- [gMock FAQ](https://google.github.io/googletest/gmock_faq.html): Troubleshooting common issues.

---

# Quick Upgrade Workflow Summary

```
1. Backup and branch your code.
2. Review deprecation and breaking changes.
3. Update GoogleMock library dependency.
4. Refactor mocks: switch to MOCK_METHOD, public methods.
5. Update expectations and default actions.
6. Build and run all tests with --gmock_verbose=info.
7. Fix errors, address warnings using strictness wrappers.
8. Validate on all platforms.
9. Commit incrementally.
10. Monitor for new deprecation notices regularly.
```

---

<Tip>
Always set expectations before exercising mocks. Use the verbose flag to understand call matching and failures during upgrade testing.
</Tip>

<Note>
Maintaining clean separation of upgrade work helps isolate issues and reduces debug time.
</Note>

---

# Version Compatibility Matrix (Illustrative)

| GoogleMock Version | Compatible GoogleTest Version | Notes                         |
|--------------------|-------------------------------|-------------------------------|
| 1.x                | 1.x                           | Legacy support                 |
| 2.x                | 2.x                           | Major improvements, new APIs  |

Consult RELEASE NOTES for exact compatibility.

---

# Contact and Support

For further assistance during your upgrade process, visit the [GoogleTest Support & Community page](support-community-faq/find-help-community.md) to find official resources, forums, and report issues.

---

# Appendix: Common Pitfalls During Upgrade

| Issue                                           | Cause                                        | Resolution                              |
|------------------------------------------------|----------------------------------------------|----------------------------------------|
| Compilation errors on MOCK_METHOD usage         | Legacy `MOCK_METHODn` macros and commas     | Migrate to generic `MOCK_METHOD` macro |
| Unexpected uninteresting call warnings          | Missing catch-all expectations or `NiceMock` usage | Add `EXPECT_CALL(...).Times(AnyNumber())` or use `NiceMock` |
| Warning about const parameter mismatch           | MSVC bug and const correctness               | Remove top-level const from parameters|
| Test failures on call order                       | Changed call order requirements               | Use sequences (`InSequence`/`After`) as needed |
| Default action not called as expected             | Missing `ON_CALL` or default action setup    | Define proper `ON_CALL` handlers         |
| Leaked mock objects detected                       | Mock not deleted or leaked intentionally     | Enable heap checker or call `Mock::AllowLeak()`|

---

# Timeline for Migration

| Task                                  | Time Estimate | Description                            |
|-------------------------------------|---------------|------------------------------------|
| Codebase backup and preparation      | 1 hour        | Branching and reviewing changes     |
| Library upgrade & dependency update  | 30 minutes    | Update build setup                  |
| Mock class refactoring                | 1-2 days      | Macro replacement and signature fixes |
| Test code update                     | 1-2 days      | Expectation and action adjustments  |
| Full test verification               | Variable      | Testing, fixing, iteration           |

Plan accordingly to minimize disruption.

---

# Sample Code Snippet: Upgrading Mock Methods

Before:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD1(Bar, bool(int x));
  MOCK_CONST_METHOD0(GetValue, int());
};
```

After:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Bar, (int x), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
};
```

---

# Running Tests with Verbosity

When running test executables after upgrading:

```bash
./test_binary --gmock_verbose=info
```

This enables:

- Detailed trace of each mock call and matched expectation
- Helpful diagnostics for mismatched or uninteresting calls

Combine with:

```bash
--gtest_stack_trace_depth=5
```

for optimized stack trace output.

---

# Troubleshooting Links

- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting-qa/common-issues.md)
- [gMock FAQ](https://google.github.io/googletest/gmock_faq.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)


<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/changelog/upgrade-guidance/step-by-step-upgrade.md", "range": "0-100"}]} />
