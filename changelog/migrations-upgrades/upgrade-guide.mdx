---
title: "Upgrade Guide"
description: "Provides actionable, step-by-step instructions for upgrading to the latest version, including prerequisites (such as required C++ standards), common migration tasks, and troubleshooting tips."
---

# Upgrade Guide

This Upgrade Guide provides detailed, step-by-step instructions to help you smoothly transition to the latest version of GoogleTest. It covers essential prerequisites like required C++ standards, common migration tasks encountered during upgrades, and troubleshooting tips to resolve issues that might arise.

---

## 1. Prerequisites for Upgrading

Before upgrading your project to the latest GoogleTest version, ensure your environment meets the following requirements:

- **C++ Language Standard**: The latest GoogleTest release requires at least **C++17** support.
  - This is enforced in the codebase (see `gtest-port.h`), which triggers a compilation error for earlier standards.
  - To comply, set your compiler to use C++17 or higher. For example, in CMake, add:
  
    ```cmake
    set(CMAKE_CXX_STANDARD 17)
    set(CMAKE_CXX_STANDARD_REQUIRED ON)
    ```

- **Supported Platforms and Compilers**: Verify that your compiler and platform are supported per Google's [Foundational C++ Support Policy](https://opensource.google/documentation/policies/cplusplus-support).
  - Reference the supported platforms table [here](https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md).

- **Build Tooling**: Update your build system to accommodate changes in dependencies or flags. For example, GoogleTest has tightened support for threading and exception handling which might affect build configurations.


<Tip>
Using C++17 as the minimum language standard enables GoogleTest to leverage modern language features, improving testing robustness and consistency.
</Tip>

---

## 2. Common Migration Tasks

### 2.1 Update Your Compiler Flags

- Ensure your compiler flags explicitly request C++17 or higher.
- For compilers with less automatic detection, manually add flags such as:
  - GCC/Clang: `-std=c++17`
  - MSVC: Use `/std:c++17` or higher.

### 2.2 Adjust Build System for GoogleTest

- If you build GoogleTest or GoogleMock as part of your project using CMake, confirm your `CMakeLists.txt` uses at least CMake 3.14 to support googletest's `FetchContent` functionality.
- Example snippet integrating GoogleTest via `FetchContent`:

  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
  )
  # For Windows: Prevent overriding the parent project's compiler/linker settings
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  FetchContent_MakeAvailable(googletest)

  add_executable(example example.cpp)
  target_link_libraries(example gtest_main)
  add_test(NAME example_test COMMAND example)
  ```

- Confirm that other build system integration (Bazel, Makefiles) uses appropriate language standards and supports the `gtest_force_shared_crt` option if needed on MSVC builds.

### 2.3 Adjust for Runtime Library Conflicts on Windows

- On Visual Studio projects, GoogleTest links statically to the runtime by default, which can conflict with projects using dynamic linking.
- Use the `gtest_force_shared_crt` CMake option to align runtime linkage dynamically:
  
  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```

- This prevents linker errors related to mismatched runtime libraries (e.g., `LNK2038` errors referencing `RuntimeLibrary` values).

### 2.4 Review Macro Name Clashes

- In C++, macros do not respect namespaces and can clash with other library macros.
- If your code or dependencies define macros that conflict with GoogleTest, use the `GTEST_DONT_DEFINE_<MACRO>` flags to instruct GoogleTest to rename its macros.
- For example, to avoid conflict on `TEST` macro:

  ```plaintext
  -DGTEST_DONT_DEFINE_TEST=1
  ```

  Then use `GTEST_TEST` explicitly.

### 2.5 Threading and Pthread Support

- GoogleTest is thread-safe if pthread support is enabled on your platform.
- You may force pthread usage on or off via:

  ```plaintext
  -DGTEST_HAS_PTHREAD=1
  or
  -DGTEST_HAS_PTHREAD=0
  ```

- When using your own build scripts, ensure you link against pthreads appropriately to avoid linker errors.

### 2.6 Shared Library (DLL) Build Adjustments

- If you want to build GoogleTest as a shared library (DLL on Windows), you need to add:

  ```plaintext
  -DGTEST_CREATE_SHARED_LIBRARY=1
  ```

- Tests building against the DLL should add:

  ```plaintext
  -DGTEST_LINKED_AS_SHARED_LIBRARY=1
  ```

- Note: Even if not necessary today for some compilers (e.g., GCC), adding these is recommended to future-proof your builds.

---

## 3. Troubleshooting Tips

### 3.1 Compilation Errors Related to C++ Standard

- If you encounter errors like
  
  ```plaintext
  #error C++ versions less than C++17 are not supported.
  ```

  ensure your build system sets the compiler to use C++17 or greater.

### 3.2 Linker Errors for Runtime Library Mismatches

- MSVC linking errors mentioning `RuntimeLibrary` mismatch indicate incompatible runtime linking.
- Use `gtest_force_shared_crt` option in CMake or adjust your project settings to unify runtime linkage.

### 3.3 Macro Redefinition or Name Clashes

- Errors about macro redefinition often relate to GoogleTest macros conflicting with other libraries.
- Define `GTEST_DONT_DEFINE_<MACRO>` flags to prevent GoogleTest from defining them.

### 3.4 Missing pthreads or Thread Support

- On platforms where pthreads are assumed but unavailable, force disable threading support with `-DGTEST_HAS_PTHREAD=0`.
- Adjust linking flags to include pthreads if needed.

<Tip>
Running a small test project with GoogleTest after upgrade can quickly validate environment compatibility before full project integration.
</Tip>

---

## 4. Summary of Upgrade Steps

1. Verify your compiler supports **C++17 or later** and update your build environment accordingly.
2. Adjust GoogleTest build integration in your project (CMake, Bazel, etc.) to use supported methods and required compiler flags.
3. Address runtime linkage and macro conflicts, especially on Windows/MSVC.
4. Validate threading support and adjust flags for pthread usage.
5. Test your existing test suites and fix any arising build or run-time issues following detailed error messages.

---

## 5. Additional Resources

- [Supported Platforms](https://github.com/google/googletest/blob/main/docs/platforms.md) — Confirm platform, compiler, and toolchain compatibility.
- [Prerequisites](https://google.github.io/googletest/getting-started/setup-basics/prerequisites) — Understand environment and language requirements.
- [CMake Integration Guide](https://google.github.io/googletest/guides/integration-and-best-practices/build-integration) — For step-by-step build system setup.
- [Breaking Changes](https://google.github.io/googletest/changelog/migrations-upgrades/breaking-changes) — Important changes that may affect your upgrade.
- [Deprecations](https://google.github.io/googletest/changelog/migrations-upgrades/deprecations) — Features being phased out.
- [FAQ & Common Issues](https://google.github.io/googletest/getting-started/troubleshooting-help/faq-common-issues) — Troubleshooting help.

---

By following this guide, users can confidently upgrade GoogleTest with minimal disruptions, ensuring compatibility and leveraging the latest framework improvements.
