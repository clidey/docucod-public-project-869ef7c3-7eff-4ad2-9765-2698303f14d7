---
title: "Upgrade & Migration Guides"
description: "Step-by-step guides for upgrading between major versions. Highlights critical migration actions (e.g., moving to C++17 support), common pitfalls to avoid, and verification tips for successful adoption."
---

# Upgrade & Migration Guides

GoogleTest evolves with improvements that occasionally require users to upgrade between major versions thoughtfully. This page delivers clear, step-by-step upgrade and migration guides tailored to each major release transition, focusing specifically on the critical actions users must perform to upgrade their test suites and mocking code smoothly.

## Why This Guide Matters

Upgrading to a new major version of GoogleTest often includes support for newer C++ standards (like moving to C++17), breaking API updates, and changes in mock object behaviors. Without careful migration, developers may encounter subtle compilation issues, runtime errors, or test failures. This guide is your companion to ensure your testing harness remains robust and compatible.

---

## Upgrade Path Workflow

Upgrading GoogleTest and GoogleMock involves:

1. **Understanding Required Changes**: Identify breaking changes impacting your codebase.
2. **Preparation**: Ensure your environment meets upgraded prerequisites like C++17 support.
3. **Code Adaptation**: Modify your test code and mocks according to the migration steps.
4. **Verification**: Run your test suite and verify all tests pass successfully.

Each of these steps is elaborated to facilitate thorough and error-free migrations.

---

## Key Migration Highlights

### 1. Transition to C++17 Support

GoogleTest now mandates a compiler that supports at least C++17. Before upgrading:

- Confirm that your compiler and build environment are set to use C++17 or later.
- Update your build scripts or project settings accordingly.

Migrating to C++17 unlocks language features that GoogleTest leverages for enhanced performance, cleaner code, and improved compliance.

### 2. Mocking API Changes

GoogleMockâ€™s API has evolved with adjustments in macros like `MOCK_METHOD`, and refinements in mock object behavior.

#### What to Update:

- **Use the new `MOCK_METHOD` macro syntax** exclusively for defining mock methods.
- For const methods or those with qualifiers, ensure `const` and `override` specifiers are correctly used in the macro.
- Audit the use of deprecated `MOCK_METHODn` macros and migrate them to the new format.

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, SetName, (const std::string& name), (override));
};
```

#### Mock Strictness Modifiers

- Use `NiceMock<T>`, `NaggyMock<T>`, and `StrictMock<T>` wrappers to specify the strictness behavior of your mocks as before.
- Review tests that rely on expectations set after mock object creation to assure no undefined behavior occurs.

### 3. Handling Deprecated and Removed Features

- Review deprecation notices for features scheduled for removal (detailed in the [Deprecation Notices](../deprecations-future-plans/deprecation-notices) page).
- Replace deprecated functions and macros with recommended alternatives.

---

## Common Pitfalls to Avoid

- **Not setting C++17 during compilation**: This results in cryptic compiler errors.
- **Using outdated MOCK_METHOD macros**: Leads to compilation failures or unexpected runtime behavior.
- **Alternating `EXPECT_CALL` and mock function calls**: Expectations must be set *before* mock methods are invoked.
- **Neglecting to call `InitGoogleMock` before running tests**: Essential for proper flag parsing and initialization.

<Tip>
Always build and run your tests incrementally: make one change, rebuild, and validate. This helps isolate issues.
</Tip>

---

## Verifying Your Migration

After completing migration steps:

1. **Run your full test suite**. No unexpected failures or warnings should occur.
2. If you encounter failures:
   - Use `--gmock_verbose=info` to get detailed insights on mock call matching.
   - Check for improper use of mock lifetimes or missing expectations.
3. Utilize tools such as heap checkers if you suspect leaks related to mocks.

---

## Sample Migration Scenario: Upgrading From Version X to Version Y

### Step 1: Update build environment

- Switch C++ standard to C++17.
- Update compiler versions if necessary.

### Step 2: Refactor mock classes

- Replace all old-style `MOCK_METHODn` macros with `MOCK_METHOD`.
- Verify all mocks properly declare `override` and `const` qualifiers.

### Step 3: Review and adjust test code

- Ensure `EXPECT_CALL` and `ON_CALL` clauses are set *prior* to exercise code.
- Confirm correct use of strictness wrappers (`NiceMock`, `StrictMock`) as per new behaviors.

### Step 4: Rebuild and run tests

- Look for warnings about uninteresting calls or expectation mismatches.
- Use verbose mode to debug mismatched expectations.

### Step 5: Leverage new features

- Consider making use of improved matchers and actions documented in [gMock Cheat Sheet](../guides/core_workflows/googlemock-quickstart) post-migration.

---

## Additional Upgrade Resources

- [Breaking Changes Overview](../migrations-upgrades/breaking-changes): Detailed list of API and behavior changes.
- [Deprecation Notices](../deprecations-future-plans/deprecation-notices): Features marked for removal.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes useful for migrating mocking patterns.
- [gMock Cheat Sheet](../guides/core_workflows/googlemock-quickstart): Quick reference for modern mock API usage.

---

## Troubleshooting Migration Issues

<AccordionGroup title="Common Migration Issues and Solutions">
<Accordion title="Compiler Errors Related to MOCK_METHOD Macros">
Sometimes you see errors caused by incorrect macro formatting or missing qualifiers.

**Resolution:** Verify mock method declarations use the new `MOCK_METHOD` macro correctly, including necessary qualifiers `(const, override)` for const or overridden methods.
</Accordion>
<Accordion title="Unexpected Mock Function Call Failures After Upgrade">
Behavior around uninteresting or unexpected calls may change.

**Resolution:** Use strictness wrappers appropriately and ensure `EXPECT_CALL` is set before exercising mocks. Run tests with `--gmock_verbose=info` to diagnose.
</Accordion>
<Accordion title="Linker or Build Failures">
Upgrading C++ standard requirements may cause build errors.

**Resolution:** Confirm your build configuration enables at least C++17 support. Update compiler and linker settings.
</Accordion>
</AccordionGroup>

---

## Final Notes

Upgrading GoogleTest, especially its mocking component GoogleMock, requires attention to C++ standards, updated APIs, and managing mock expectations carefully. Following these migration guides minimizes disruptions and helps you adopt the latest features confidently, continuing to write reliable, maintainable tests.


---

_For further assistance, visit the [GoogleTest GitHub repository](https://github.com/google/googletest) or consult the broader [Changelog and Migration Section](../migrations-upgrades/upgrade-migration-guides)._