---
title: "Breaking Changes"
description: "Details on behavioral or API changes that require user action. Explains the impact, motivators, and specific upgrade paths to mitigate disruption. Essential for users maintaining production code or upgrading across major versions."
---

# Breaking Changes

This page details behavioral and API changes in GoogleTest and GoogleMock that require user action. Understanding these changes is critical for maintaining existing tests and ensuring smooth upgrades, especially when crossing major versions. Changes outlined here explain their impact, motivation, and specific upgrade paths to mitigate disruption.

---

## 1. Overview of Breaking Changes

GoogleTest and GoogleMock strive to maintain backward compatibility. However, as the frameworks evolve to support modern C++ features and improve usability, some changes inevitably alter behavior or APIs in ways that may break existing test code. These are communicated clearly to help users plan their upgrades.

Breaking changes generally fall into the following categories:

- API signature changes
- Semantics modifications affecting test execution or mock behavior
- Removal or deprecation of old macros or idioms
- Compiler or platform support updates affecting test code

This page focuses specifically on **gMock** (GoogleMock) related breaking changes since mocking is a common source of subtle issues during upgrades.

---

## 2. Notable Breaking Changes in GoogleMock

### 2.1 MOCK_METHOD Macro Signature Evolution

The legacy `MOCK_METHODn` macros have been replaced by the unified `MOCK_METHOD` macro:

- **Old Style:** `MOCK_METHOD1(Foo, bool(int))`
- **New Style:** `MOCK_METHOD(bool, Foo, (int), (override))`

While the old macros remain supported, the new `MOCK_METHOD` macro brings several benefits including:

- Consistency with C++ method declarations
- Support for qualifiers like `const`, `override`, `noexcept`, and calling conventions
- Better error messages and cleaner code

**User Impact:**

Tests using the old `MOCK_METHODn` macros can continue to use them but are encouraged to migrate to the new form for cleaner code and future compatibility.

---

### 2.2 Qualifiers and Overrides on Mock Methods

The new `MOCK_METHOD` requires explicit usage of qualifiers:

- Use `(const)` for mocking `const` methods.
- Use `(override)` when overriding a virtual method.
- Use `(noexcept)` if the method in the interface is marked `noexcept`.
- On Windows, `Calltype(X)` may be needed for calling convention specification.

**Example:**

```cpp
MOCK_METHOD(int, GetValue, (), (const, override));
```

This explicitness is necessary to correctly mock methods, especially with overloaded signatures.

---

### 2.3 Enhanced Support and Restrictions for Mocking Method Signatures

- Unprotected commas in template or compound types within `MOCK_METHOD` must be wrapped in extra parentheses or type aliases.
- Mock methods must be declared `public:` inside the mock class, regardless of the access level in the base class.
- Overloaded methods must be mocked explicitly with the correct qualifiers.

**User Impact:**

Test authors may need to adjust existing mock classes to conform to these rules.

For example, the following will fail to compile without parentheses:

```cpp
// Will not compile
MOCK_METHOD(std::pair<bool, int>, GetPair, ());

// Must be either wrapped in parentheses
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// Or use type alias
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

---

### 2.4 Mocking Non-virtual Methods

GoogleMock now supports mocking non-virtual methods using a high-performance dependency injection technique, by defining mocks that are unrelated to the real class but match method signatures.

**Example:**

```cpp
class ConcretePacketStream {
 public:
  void AppendPacket(Packet* new_packet);
  const Packet* GetPacket(size_t packet_number) const;
  size_t NumberOfPackets() const;
};

class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};
```

**User Impact:**

For projects using this feature, update mock class definitions accordingly.

---

### 2.5 Handling Move-Only Types in Mocks

Since April 2017, gMock supports mocking methods that accept or return move-only types such as `std::unique_ptr`. The mock method signature uses `MOCK_METHOD` as usual.

**Key Points:**

- When returning move-only types, prefer lambdas or callables over `Return(std::move(...))` to avoid runtime errors.
- Some built-in actions do not compile with move-only arguments; user-defined lambdas or functors may be necessary.

**Legacy Workaround:**

Older code may forward methods with move-only types to mock methods using raw pointers (e.g., a `DoShareBuzz` helper). This is no longer required with modern gMock versions.

---

### 2.6 Differences in Expectation Matching Order

gMock matches function calls to expectations in **reverse order** of their declaration, meaning newer `EXPECT_CALL`s override older ones. This design allows common behaviors to be specified early (e.g., in constructors or setup) and specialized later (e.g., in individual tests).

**User Impact:**

Users should order their expectations accordingly to avoid surprising matches. For example, put catch-all expectations **before** more specific ones.

---

### 2.7 Retiring Saturated Expectations

By default, gMock does not retire an expectation when its call count limit is reached, causing it to remain sticky and potentially produce failures on subsequent calls.

To mitigate this, gMock introduced the `.RetiresOnSaturation()` clause, which makes the expectation inactive once saturated.

**Example:**

```cpp
EXPECT_CALL(mock, Foo(7))
    .Times(2)
    .RetiresOnSaturation();
EXPECT_CALL(mock, Foo(_))
    .Times(AnyNumber());
```

This ensures calls to `Foo(7)` beyond 2 will match the catch-all instead of causing failures.

---

### 2.8 StrictMock and NiceMock Behavior Changes

- By default, mock objects produce warnings on uninteresting calls (calls to mock methods without an explicit expectation).
- `NiceMock<T>` suppresses such warnings.
- `StrictMock<T>` treats uninteresting calls as errors.

**User Impact:**

Tests that did not explicitly expect all mock calls may fail under `StrictMock`. Adjust tests accordingly by adding catch-all expectations if necessary.

---

### 2.9 Setting Expectations Before Calls

gMock requires all `EXPECT_CALL`s be set **before** the mock method is invoked. Failure to do so leads to undefined behavior.

Users must avoid setting expectations after passing mocks to the code under test or after invoking mock methods.

---

### 2.10 Virtual Destructors in Mocked Interfaces

All classes intended for mocking **must** have virtual destructors to avoid undefined behavior and memory leaks.

If a base class destructor is non-virtual, deleting mocks via base pointers will cause incomplete destruction.

**User Action:**

Audit interfaces and add virtual destructors where missing.

---

### 2.11 Logging and Diagnostic Changes

- gMock may print warnings about uninteresting calls along with argument and stack trace info.
- To assist debugging, run your test with `--gmock_verbose=info` to trace mock calls and expectations.

---

### 2.12 Other API Changes and Deprecations

- Deprecated old macro sets such as `MOCK_METHODn` encourage migration to the new `MOCK_METHOD` macro.
- Several internal and deprecated APIs have been removed to improve codebase maintainability.

If your code depends on deprecated components, refer to the migration guides.

---

## 3. Migration and Upgrade Recommendations

To efficiently migrate code with breaking changes:

- Audit all mock classes to migrate to the new `MOCK_METHOD` macro and explicitly specify qualifiers like `(override)` and `(const)`.
- Verify that all mocked classes have virtual destructors.
- Ensure all `EXPECT_CALL`s are declared before any calls.
- Use `.RetiresOnSaturation()` to avoid expectation stickiness if needed.
- When upgrading to stricter mock behavior (`StrictMock`), add catch-all expectations for uninteresting calls if appropriate.
- Wrap complex argument types with parentheses or type aliases in `MOCK_METHOD` declarations.
- Replace `Return(std::move(...))` with lambdas or callables that create new instances for move-only return types.

Consult the [Upgrade Guide](/changelog/migrations-upgrades/upgrade-guide) and [Breaking Changes](/changelog/migrations-upgrades/breaking-changes) pages for detailed migration workflows.

---

## 4. Troubleshooting Common Breakage Scenarios

### 4.1 Unexpected Calls and Warnings

If you encounter warnings about "uninteresting function calls" or unexpected failures:

- Confirm that all relevant `EXPECT_CALL`s are set prior to any invocation.
- Check the order of expectations—later expectations override earlier ones.
- Add catch-all expectations with `_` matcher and `Times(AnyNumber())` to handle unexpected calls.
- Use `NiceMock` to suppress uninteresting call warnings where appropriate.

### 4.2 Compilation Errors Related to MOCK_METHOD

Errors may arise from:

- Unprotected commas in complex types — wrap with extra parentheses.
- Incorrect qualifiers (missing `override` or `const`).
- Misuse of mock macros outside `public:` sections.

### 4.3 Runtime Failures with Move-Only Types

- Avoid using `Return(std::move(...))` with `WillRepeatedly()`.
- Prefer lambdas or functors to return move-only types dynamically.

### 4.4 Virtual Destructor Issues

- Missing virtual destructors in base classes can cause memory leaks or tests passing incorrectly.
- Add virtual destructors or adjust class designs accordingly.

---

## 5. Best Practices Going Forward

- Always use the modern `MOCK_METHOD` macro with explicit qualifiers.
- Limit expectations to only those necessary; use `ON_CALL` for default behaviors.
- Write clear expectations with explicit cardinalities and sequences.
- Use `RetiresOnSaturation()` to manage expectation lifetimes clearly.
- Utilize `NiceMock` and `StrictMock` thoughtfully based on test strictness.
- Employ `--gmock_verbose=info` during test failures for diagnostic clarity.
- Integrate migration and upgrade checks into your CI pipeline to catch breaking changes early.

---

## 6. Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly introduction to mocking
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) — Common issues and edge cases
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for advanced mocking techniques
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — API details
- [Breaking Changes](../migrations-upgrades/breaking-changes.md) — Core page for breaking change announcements
- [Upgrade Guide](../migrations-upgrades/upgrade-guide.md) — Step-by-step migration instructions

---

For a smooth upgrade experience, closely follow the recommendations on this page and consult the linked resources tailored for GoogleMock users.


---