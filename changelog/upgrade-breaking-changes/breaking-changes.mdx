---
title: "Breaking Changes & Migrations"
description: "Describes breaking API or behavioral changes, removed features, and version compatibility updates. Includes migration steps and code adaptation guidance to help users resolve any upgrade blockers."
---

# Breaking Changes & Migrations

This page details breaking API or behavioral changes introduced in recent versions of GoogleMock. It covers removed or altered features, incompatibilities with previous versions, and steps to migrate your codebase smoothly. You will find practical guidance on how to update your mocks, expectations, and tests to align with the latest GoogleMock behavior and macros.

---

## 1. Overview of Breaking Changes

GoogleMock evolves to offer clearer syntax, better performance, and improved usability. However, some updates introduce breaking changes that require user action to maintain compatibility. This page focuses exclusively on such changes, helping you avoid upgrade blockers by understanding what has changed and how to adapt.

### Key reasons for breaking changes:
- Modernizing macro usage (moving from legacy `MOCK_METHODn` to unified `MOCK_METHOD`)
- Enhancements in call qualifier support (e.g., `noexcept`, reference qualifiers)
- Improvements in default action and expectation handling
- Clarifications and strictness improvements in expectations and mock behavior


## 2. Major Breaking Changes and How to Migrate

### 2.1. Transition from Legacy `MOCK_METHODn` Macros

The legacy macros (`MOCK_METHOD0`, `MOCK_CONST_METHOD1`, etc.) are fully supported but deprecated. GoogleMock now recommends using the generic `MOCK_METHOD` macro for all mocking needs.

#### What has changed?
- Unified macro: `MOCK_METHOD(ReturnType, MethodName, (Args...), (Modifiers));`
- Modifiers include qualifiers like `const`, `override`, `noexcept`, `Calltype(...)`, and `ref(...)`.
- Better support for modern C++ features and cleaner syntax.

#### Migration Steps:
- Replace all `MOCK_METHODn(...)` or `MOCK_CONST_METHODn(...)` macros with `MOCK_METHOD`.
- Wrap argument types containing commas in extra parentheses or use type aliases to avoid parsing issues.
- Add qualifiers explicitly in the 4th parameter, e.g., `(const, override)`, `(noexcept)`, `(Calltype(STDMETHODCALLTYPE), override)`.

**Example:**
```cpp
// Legacy macro
MOCK_CONST_METHOD1(Foo, int(int));

// Modern macro
MOCK_METHOD(int, Foo, (int), (const, override));
```

### 2.2. Support for `noexcept` and Reference Qualifiers

GoogleMock now fully supports mocking methods with `noexcept` specifiers and reference qualifiers (`&`, `&&`). This requires using the new macro syntax.

#### What to do?
- Use `(noexcept)` in the last parameter list when mocking `noexcept` methods.
- Use `ref(&)` or `ref(&&)` to specify reference qualifiers on the mocked method.

**Example:**
```cpp
MOCK_METHOD(int, Compute, (), (const, noexcept, override));
MOCK_METHOD(int, Modify, (), (ref(&), override));
```

### 2.3. Changes in Default Behavior of Uninteresting Calls

By default, calls to mock methods with no specified expectations generate warnings (`naggy` behavior). This behavior is unchanged; however, understanding how to control this is crucial.

- Use `NiceMock<T>` to suppress warnings on uninteresting calls.
- Use `StrictMock<T>` to treat uninteresting calls as errors.

This strictness control allows tests to be more robust and enforce precise call patterns.

### 2.4. Removal of Non-Virtual Method Mocking Workarounds

While still possible, mocking non-virtual methods through template tricks has been deemphasized. The favored approach is to mock interfaces or use dependency injection.

### 2.5. Migration for Overloaded Methods and Constness

GoogleMock's `MOCK_METHOD` macro supports overloading by differentiating methods with argument types, counts, and qualifiers, including const.

Ensure that all overloaded versions you intend to mock are declared explicitly along with using declarations if hiding occurs.

**Example:**
```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add; // bring in base overloads
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int count, int x), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
};
```

### 2.6. Delegation to Real Objects or Fakes

Advanced users might delegate mock calls to real or fake implementations. Ensure any migration reflects changes in delegating techniques, especially if using lambdas for delegation.

---

## 3. Migration Checklist

Follow these steps to ensure a smooth transition:

- [ ] Replace legacy macros with `MOCK_METHOD`.
- [ ] Add explicit qualifiers like `const`, `override`, `noexcept`, etc.
- [ ] Handle types with commas by wrapping in parentheses or using aliases.
- [ ] Check all overloaded methods are correctly mocked.
- [ ] Use `NiceMock` or `StrictMock` for controlling uninteresting call verbosity.
- [ ] Review all default actions using `ON_CALL` and expectations with `EXPECT_CALL`.
- [ ] Avoid mocking non-virtual methods unless strictly necessary.
- [ ] If delegating calls, update delegation syntax to comply with new standards.
- [ ] Test thoroughly to catch mismatches in call expectations or failures due to stricter matching.

---

## 4. Troubleshooting Common Migration Issues

### 4.1. Compilation Errors with Comma in Types

Wrap types with commas inside extra parentheses in `MOCK_METHOD`. Alternatively, define type aliases.

### 4.2. Inconsistent Behavior With Overloads

Use `using BaseClass::MethodName;` in mocks to avoid hiding base class overloads.

### 4.3. Unexpected Warnings About Uninteresting Calls

Switch to `NiceMock` if uninteresting calls should be ignored, or add catch-all expectations with `.Times(AnyNumber())`.

### 4.4. Issues Mocking `noexcept` or Reference Qualified Methods

Verify that the qualifiers are accurately added inside the macro's last argument list.

---

## 5. References for Further Assistance

- **gMock Cookbook:** Detailed recipes and migration examples [gmock_cook_book.md](https://google.github.io/googletest/gmock_cook_book.html)
- **Mocking Reference:** Macro syntax and expectations [mocking.md](https://google.github.io/googletest/reference/mocking.html)
- **gMock for Dummies:** Beginner friendly overview [gmock_for_dummies.md](https://google.github.io/googletest/gmock_for_dummies.html)
- **gMock Cheat Sheet:** Quick reference to common patterns [gmock_cheat_sheet.md](https://google.github.io/googletest/gmock_cheat_sheet.html)

---

## 6. Summary

Adapting your code for GoogleMock's breaking changes enhances test clarity, correctness, and compatibility with modern C++ standards. Follow the outlined migration steps for seamless transitions and leverage extensive guides to master new mock syntax and best practices.

<Quote>
Embrace the evolution of mocking with clear, precise mocks that empower robust, maintainable tests.
</Quote>

---

##### Example Migration Code Snippet
```cpp
// Before:
MOCK_CONST_METHOD1(Foo, int(int));

// After:
MOCK_METHOD(int, Foo, (int), (const, override));

// Handling a method with noexcept and reference qualifier:
MOCK_METHOD(int, Bar, (), (noexcept, ref(&), override));

// Using a type alias for complex argument type:
using MapType = std::map<int, std::string>;
MOCK_METHOD(bool, CheckMap, (MapType), (override));
```

---

## 7. Diagram: User Flow for Migrating to New MOCK_METHOD Macro

```mermaid
flowchart TD
    Start([Start Migration]) --> Analyze[Analyze Existing Mock Macros]
    Analyze -->|Uses MOCK_METHODn| ReplaceLegacy[Replace with MOCK_METHOD]
    ReplaceLegacy --> AddQualifiers[Add Qualifiers (const, override, noexcept, ref)]
    AddQualifiers --> HandleCommas[Wrap or Alias Complex Types]
    HandleCommas --> VerifyOverloads[Verify Overloaded Methods & Using Declarations]
    VerifyOverloads --> Test[Run and Validate Tests]
    Test --> FixIssues[Fix Compilation or Behavior Issues]
    FixIssues --> Test
    Test --> Done([Migration Complete])
```
