---
title: "Breaking Changes"
description: "A clear list of backward-incompatible changes with practical examples, directly addressing upgrade pain points for users and offering guidance for resolving common issues."
---

# Breaking Changes

This page provides a clear, practical list of backward-incompatible changes in GoogleTest and GoogleMock. Designed to directly assist users upgrading between versions, it highlights common upgrade pain points and offers concrete examples and actionable guidance to resolve typical issues arising from breaking changes.

---

## Overview

When upgrading GoogleTest, you may encounter changes that break compatibility with your existing tests or mock classes. This document outlines those breaking changes explicitly, focusing on **what behavior or usage has changed from a user's perspective**, along with how to adapt your code.

Our goal is to save you debugging time and provide clear migration instructions by demonstrating the impact of each breaking change and typical resolutions.

---

## 1. Test and Test Suite Naming Restrictions

Due to internal implementation constraints involving generated class names, test suite and test names must **avoid underscores (`_`)** in specific ways.

- Test suite and test names **cannot start or end with an underscore**.
- Names **cannot contain consecutive underscores (`__`)**.
- Avoid underscores anywhere in the name to prevent ambiguous class names.

### What happens if you violate this?
Your tests might compile and run initially but lead to subtle failures or compiler errors in future versions or different compilers.

### Example and Recommendation
```cpp
// Problematic:
TEST(Time_Flies, Like_An_Arrow) {
  ...
}

// This generates class name: Time_Flies_Like_An_Arrow_Test, which conflicts
// with
TEST(Time, Flies_Like_An_Arrow) {
  ...
}

// Recommended:
TEST(TimeFlies, LikeAnArrow) {
  ...
}
```

For a detailed explanation, see the [FAQ: Why should test suite names and test names not contain underscore?](../docs/faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore)

---

## 2. Default Constructor Requirements for Test Fixtures

GoogleTest requires that your test fixture classes have accessible **default constructors**.

- If you declare any non-default constructors, you must explicitly declare a default constructor for the fixture.
- This is mandatory even if your default constructor is empty.

### Common Error
```plaintext
no matching function for call to `FooTest::FooTest()`
```

### Resolution
Add an explicit default constructor:
```cpp
class FooTest : public ::testing::Test {
 public:
  FooTest() = default;  // Explicit default constructor
  FooTest(int x);       // Example non-default constructor
};
```

For more info, see [FAQ: I have a fixture class `FooTest`, but `TEST_F(FooTest, Bar)` gives me error "no matching function for call to FooTest::FooTest()". Why?](../docs/faq.md#i-have-a-fixture-class-foo-test-but-test_ffoo-test-bar-gives-me-error-no-matching-function-for-call-to-foo-test-foo-test)

---

## 3. Assertion Macros Restrictions in Constructors and Destructors

GoogleTest restriction: **Fatal assertions such as `ASSERT_*` and `FAIL()` cannot be used inside constructors or destructors of test fixtures**.

### Why?
This is due to C++ language rules and the way GoogleTest handles assertions without exceptions.

Attempting to use them will cause compiler errors or undefined behavior.

### Recommended Practice
Put initialization logic that can fail into `SetUp()` and cleanup logic requiring assertions into `TearDown()` instead.

### Example
```cpp
class MyTest : public ::testing::Test {
 protected:
  MyTest() {
    // WRONG! Do NOT use ASSERT_* here
  }
  void SetUp() override {
    ASSERT_TRUE(Initialize());  // Correct
  }
};
```

More details in [FAQ: My compiler complains "void value not ignored as it ought to be." What does this mean?](../docs/faq.md#my-compiler-complains-void-value-not-ignored-as-it-ought-to-be)

---

## 4. Changes to Mock Method Declaration and Use

### 4.1 Transition to New `MOCK_METHOD` Macro

Older macro families `MOCK_METHODn` and `MOCK_CONST_METHODn` are deprecated. You **must use** the new unified `MOCK_METHOD` macro in all new and updated code:

```cpp
// Old style (deprecated):
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD1(Bar, int(double));

// New style (recommended):
MOCK_METHOD(bool, Foo, (int), (override));
MOCK_METHOD(int, Bar, (double), (const, override));
```

- This change provides better support for qualifiers, ref-qualifiers, and noexcept.
- See the [Mocking Reference](../docs/reference/mocking.md#MOCK_METHOD) for detailed syntax.

### 4.2 Qualifications Must Match Exactly

`MOCK_METHOD` now requires that qualifiers (e.g. `const`, `override`, `noexcept`) match the overridden method’s qualifiers exactly.

Failing to specify the right qualifiers will cause compilation errors.

```cpp
// If base class method is const
virtual int GetValue() const;

// Mock method MUST include (const):
MOCK_METHOD(int, GetValue, (), (const, override));
```

### 4.3 Handling Commas in Types

Unparenthesized commas in return or parameter types will cause macro parsing errors.

Wrap such types in parentheses or use typedefs/using aliases.

Example:
```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
// Or with alias
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetPair, ());
```

### 4.4 Move-Only Types Supported

Methods accepting or returning move-only types like `std::unique_ptr` are now fully supported with `MOCK_METHOD`.

Example:
```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (std::string text), (override));
```

- When returning move-only types repeatedly, prefer using lambdas instead of `Return()`.

More info in the [Mocking Cookbook](../docs/gmock_cook_book.md#mocking-methods-that-use-move-only-types).

---

## 5. `EXPECT_CALL` Must Precede Mock Method Calls

Setting expectations **after** a mock method has been called leads to **undefined behavior**.

Always write `EXPECT_CALL()` before the code under test calls the mock methods.

Additionally, when multiple `EXPECT_CALL`s target the same method, the last matching expectation overrides earlier ones.

Arrange expectations carefully, from generic to specific, so that unintended shadowing does not occur.

See [FAQ: My GoogleMock expectations are not working as expected. What should I do?](../faq/troubleshooting/mocking-problems.md) for troubleshooting.

---

## 6. Mock Objects Verification Behavior

Mock objects automatically verify expectations when destructed. However, if your mock object is heap-allocated and ownership is transferred, the destructor may be delayed or never called—leading to missed verification.

### Action:
- Use `Mock::VerifyAndClearExpectations(&mock_object)` to force verification explicitly.
- Do not set expectations after calling `VerifyAndClearExpectations`.

Example:
```cpp
MockFoo* foo = new MockFoo;
EXPECT_CALL(*foo, Bar());
foo->DoWork();
EXPECT_TRUE(Mock::VerifyAndClearExpectations(foo));
```

More details in the [Mocking Cookbook](../docs/gmock_cook_book.md#forcing-a-verification).

---

## 7. Death Test Naming and Thread Safety

To avoid unexpected test ordering and threading issues, test suites containing death tests should be named ending with `DeathTest`.

If a test fixture class is used for both death and non-death tests, use `using` or `typedef` aliases to separate the suites while sharing code.

Example:
```cpp
class FooTest : public ::testing::Test {};
using FooDeathTest = FooTest;
TEST_F(FooTest, NormalTest) { ... }
TEST_F(FooDeathTest, DeathTest) { EXPECT_DEATH(...); }
```

Ensure your program is safe to run multiple instances side-by-side due to the death test implementation style.

See [Guide on Death Tests](../guides/advanced-and-best-practices/death-tests.md) and [FAQ Section](../docs/faq.md#my-death-test-hangs-or-seg-faults-how-do-i-fix-it) for details.

---

## 8. Removal of Deprecated Macros and Features

Some old macros and patterns have been deprecated and removed:

- `MOCK_METHODn` family replaced by unified `MOCK_METHOD`
- Legacy death test styles deprecated; configure `--gtest_death_test_style` to use modern modes.
- Deprecated GoogleMock action macros superseded by lambda or functor actions.

Please update your code accordingly to avoid compilation errors.

---

## Troubleshooting Common Issues Post-Upgrade

### Failure: No default constructor on test fixture
**Cause:** Your fixture defines a non-default constructor and lacks an explicit default one.
**Fix:** Add a default constructor as shown in section 2.

### Compilation error: MOCK_METHOD macro parsing fails
**Cause:** Unparenthesized commas in argument or return types.
**Fix:** Wrap complex types in parentheses or use `using` aliases as in section 4.3.

### Unexpected behavior: Mock methods invoked without matching EXPECT_CALL
**Cause:** `EXPECT_CALL` not defined before mock method invocation.
**Fix:** Move `EXPECT_CALL` calls before exercising mocks.

### Death tests hanging or crashing
**Cause:** Multiple threads running when death test starts.
**Fix:** Follow the death test naming and style guidance, avoid threads outside death tests.

---

## Summary
This document empowers you to identify and resolve backward-incompatible changes impacting GoogleTest and GoogleMock usage. By adhering to the naming conventions, updating mock declarations, and respecting lifecycle rules, you can smoothly transition to newer GoogleTest versions without disruption.

Always consult the relevant sections of the [GoogleTest FAQ](../docs/faq.md) and [Mocking Reference](../docs/reference/mocking.md) for further details.

If you encounter complex migration scenarios, please reach out on the GoogleTest community forums or check existing migration guides linked below.

---

## Additional Resources
- [FAQ: Naming Rules and Test Discovery](../docs/faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore)
- [Mocking Reference](../docs/reference/mocking.md#MOCK_METHOD)
- [Mocking Cookbook](../docs/gmock_cook_book.md#mocking-methods-that-use-move-only-types)
- [Death Tests Guide](../guides/advanced-and-best-practices/death-tests.md)
- [FAQ: Mock Expectations Not Working](../faq/troubleshooting/mocking-problems.md)
- [Migration Guides](../changelog/breaking-migrations/migration-guides.md)

---

<Tip>
Always back up your tests before upgrading. Run incremental tests to isolate breakages and refer to this page for actionable guidance.
</Tip>

<Warning>
Breaking changes can disrupt test suites. Follow the guidance carefully and consult community channels if migration issues persist.
</Warning>
