---
title: "Breaking Changes & Migrations"
description: "Catalogs incompatibilities between major versions, migration instructions, and detailed explanations for removing or altering behavior, minimizing user disruption during upgrades."
---

# Breaking Changes & Migrations

This page catalogs incompatibilities between major versions of the GoogleMock framework, provides detailed migration instructions, and explains changes that remove or alter behaviors. Its goal is to minimize disruption for users during upgrades, ensuring you have clear guidance to safely transition your tests and mocks to newer versions.

---

## Understanding Breaking Changes

Upgrades to GoogleMock occasionally introduce changes that are not backward compatible. These changes can affect how mocks are defined, expectations are set, or how particular features behave at runtime. This page highlights such changes so that you can anticipate the impact and prepare migration plans.

Breaking changes typically involve:

- Modification or removal of existing API behavior.
- Changes in mock strictness or default behaviors.
- Alterations to mock method declaration macros or qualifiers.
- Adjustments in expectation matching semantics or ordering.

Understanding these changes helps maintain your test stability and leverage new framework improvements.

## Migration Instructions

When upgrading across GoogleMock major versions, follow these steps to address breaking changes:

1. **Review Release Notes:** Always start by reading the latest release notes for specific breaking change highlights.

2. **Adjust Mock Class Definitions:** 
    - If the mocking macros (`MOCK_METHOD` variants) have changed in signature or qualifiers, update your mock classes accordingly.
    - Pay attention to changes required when mocking const methods, overloaded methods, or methods with unusual calling conventions.

3. **Update Expectations and Actions:**
    - Some behaviors or defaults in `EXPECT_CALL` or `ON_CALL` may have changed. Review and revise your expectation cardinalities, action sequences, or ordering constraints to align with the new logic.
    
4. **Handle Strictness Mode Changes:**
    - New versions may adjust how uninteresting or unexpected calls are handled. Consider whether you need to migrate existing mocks from the Naggy default to NiceMock or StrictMock wrappers to suppress warnings or enforce errors.

5. **Verify and Fix Test Failures:**
    - Run tests with increased verbosity (e.g., `--gmock_verbose=info`) to understand failures related to changed mock behavior.
    - Use the detailed output to identify which mocks or expectations need adjustment.

6. **Leverage New Features:**
    - Apply recommended practices from upgraded documentation to improve your mocks, such as delegating to real or fake objects, or using new matchers.

7. **Consult Migration Guides:**
    - Refer to specific migration guides or upgrade best practices pages linked at the bottom of this document.

## Common Breaking Changes Examples

### Mock Method Declaration Syntax

Modern GoogleMock versions recommend the `MOCK_METHOD` macro with four parameters:

```cpp
MOCK_METHOD(return_type, MethodName, (args...), (qualifiers));
```

Old-style `MOCK_METHODn` macros are deprecated and should be replaced. Keep an eye for changes in handling of `const`, `override`, and calling convention specifiers.

### Default Strictness Behavior

Previous defaults treated uninteresting calls with warnings (NaggyMock). New versions encourage explicit use of `NiceMock` or `StrictMock` to suppress warnings or treat uninteresting calls as errors, respectively.

Example migrant:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
```

### Expectation Ordering

If your tests rely on specific call order, confirm that sequences (`InSequence`) and `After` clauses are maintained, as some changes refined their semantics or behavior.

### Actions and Return Value Handling

Improvements in move-only type handling require adjusting lambdas or expectation actions that deal with `std::unique_ptr` or similar. Prefer lambdas over direct `Return(std::move(...))` in repeated calls.

### Removal of Deprecated Features

Certain older gMock features or macros might be removed. Review and remove any deprecated usage.

## Troubleshooting Migration Issues

If after migrating you encounter unexpected test failures:

- Increase logging verbosity with `--gmock_verbose=info` to trace expectation processing and mock calls.
- Verify all mocked methods are correctly declared as virtual and mocked with appropriate qualifiers.
- Confirm you do not mix mocking styles that have changed behavior (e.g., mixing NaggyMock and StrictMock in incompatible ways).
- Review the order of `EXPECT_CALL` statements; remember newer expectations override older ones.
- Check for changes in default return values or side effects and adjust your `ON_CALL` or `EXPECT_CALL` as needed.

---

## Migration Support Resources

- **Full Version History:** Review [Full Version History](../changelog/release-history/full-version-history) for complete breaking change lists and notes.
- **Upgrade Guides & Best Practices:** See [Upgrade Guides & Best Practices](../changelog/upgrade-notices/upgrade-guides) for detailed migration workflows.
- **Mocking Reference:** Understand current mock declaration and expectation mechanisms via the [Mocking Reference](../api-reference/mocking-framework/mock-definition).
- **gMock for Dummies:** Revisit beginner-friendly explanations and patterns at [gMock for Dummies](../docs/gmock_for_dummies.md).
- **Using Mocks to Isolate Dependencies:** Learn modern mocking patterns and usage in [Using Mocks to Isolate Dependencies](../guides/mocking-and-advanced-patterns/using-mocks).

---

## Summary

Upgrading GoogleMock involves paying attention to breaking changes that impact mock class definitions, expectation syntax, strictness, and behavior of actions. This page equips you with the necessary background to approach upgrades confidently and avoid common pitfalls. Careful review of related migration documentation and leveraging verbose mock logging will facilitate a smooth transition.

---

<Callout type="tip">
Use `EXPECT_CALL(mock, Method()).RetiresOnSaturation()` to avoid upper-bound errors on repeated calls when migrating from versions with different default retirement behavior.
</Callout>

<Callout type="warning">
Ensure all mock destructors are virtual after migration to avoid memory leaks and undefined behavior.
</Callout>

<Callout type="note">
Remember that mock expectations should be set before exercising the mock, and expectations cannot be added after verification or use without undefined behavior.
</Callout>