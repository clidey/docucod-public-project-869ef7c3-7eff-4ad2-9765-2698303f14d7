---
title: "Breaking Changes & Migration Steps"
description: "Explicit guidance for handling breaking changes in major/minor releases. This page includes direct migration instructions and notes on affected APIs, ensuring users avoid the most common update pitfalls."
---

# Breaking Changes & Migration Steps

This page provides explicit guidance for handling breaking changes introduced in major and minor releases of GoogleMock and GoogleTest. Here, you will find clear migration instructions, identification of affected APIs, and practical notes to avoid common pitfalls during updating. This ensures your test suites continue to function correctly and efficiently with the latest versions.

---

## Overview of Breaking Changes

GoogleTest and GoogleMock prioritize stability while evolving to meet modern C++ standards and user needs. Occasionally, changes affect backward compatibility, often to improve safety, expressiveness, or usability of mocking and testing interfaces. This page focuses solely on these disruptive changes impacting your mock definitions, expectations, and behaviors.

Understanding these changes early will help avoid test breakage and maximize your migration success.

## Migration Workflow

Follow these steps when upgrading across versions with breaking changes:

1. **Review Breaking Changes Listed Below**: Identify all relevant changes that might impact your tests.

2. **Check API Dependencies**: Determine whether your mocks or expectations use deprecated or changed signatures.

3. **Apply Migration Recommendations**: Follow the specific instructions and code examples provided to update mock definitions and usage.

4. **Verify Test Behavior**: Run your full test suite to catch any failures arising from the upgrade and address them iteratively.

5. **Use Diagnostic Flags**: Consider running tests with `--gmock_verbose=info` to get detailed traces of mock calls during migration troubleshooting.

### Practical Tip

> Begin migration in a small, contained test environment before rolling changes out to large codebases. This minimizes disruption and isolates update impact.

## Key Breaking Changes & Migration Notes

### 1. MOCK_METHOD Macro Update

- **Change:** GoogleMock replaced the old macro family `MOCK_METHODn` with a single, uniform `MOCK_METHOD` macro.
  - Old style: `MOCK_METHOD1(Foo, bool(int))`
  - New style: `MOCK_METHOD(bool, Foo, (int))`

- **Migration:**
  - Wrap return types or argument types containing commas with an extra set of parentheses.
  - Add explicit specifiers like `(const)`, `(override)`, or `(Calltype(STDMETHODCALLTYPE))` as needed.

```cpp
// Old macro no longer recommended
MOCK_METHOD1(Foo, bool(int));
// New macro usage
MOCK_METHOD(bool, Foo, (int), (override));

// Dealing with comma in type
MOCK_METHOD((std::pair<int, int>), Bar, ());
```

- **Why:** This improves readability, handles overloading, and unifies the mocking syntax.

### 2. Reference Qualifiers in Mocked Methods

- **Change:** Support for mocking methods with reference qualifiers (e.g., `&` or `&&`) was introduced.

- **Migration:** Add `ref(&)` or `ref(&&)` qualifiers to `MOCK_METHOD` specifiers when mocking such methods.

```cpp
// Mocking a method with l-value reference qualifier
MOCK_METHOD(int, Foo, (), (ref(&), const, override));
```

- **Note:** Omitting this qualifier leads to compilation errors or unexpected behavior.

### 3. Strictness Wrappers: NiceMock, NaggyMock, StrictMock

- **Observation:** Uninteresting calls (calls to mock methods with no `EXPECT_CALL`) behavior defaults to warning.

- **Impact:** Migrating to strictness wrappers can change test outcomes:
  - `NiceMock` suppresses uninteresting call warnings.
  - `StrictMock` treats them as test failures.

- **Migration Guidance:**
  - Use `NiceMock<YourMock>` to avoid noisy warnings during migration.
  - Switch to `StrictMock<YourMock>` only when you want precise enforcement.

```cpp
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoSomething());
```

### 4. Changes in EXPECT_CALL and ON_CALL Interactions

- **Change:** The order in which multiple `EXPECT_CALL` or `ON_CALL` statements are defined affects which expectation is matched (newest overrides older).

- **Migration:** Be mindful of the order of `EXPECT_CALL` statements for overlapping matchers; place more specific expectations after general ones.

- **Example:**

```cpp
EXPECT_CALL(mock, Foo(_)).Times(AnyNumber());  // General catch-all
EXPECT_CALL(mock, Foo(42)).Times(1).WillOnce(Return(true));  // More specific
```

- **Diagnostic:** Use `--gmock_verbose=info` to trace expectation matching.

### 5. Addressing Move-Only Types

- **Change:** Full support for mocking methods with move-only arguments/returns like `unique_ptr` added in recent versions.

- **Migration:** If mocking methods with move-only parameters:
  - Use `MOCK_METHOD` with standard syntax.
  - Specify actions using lambdas or callable wrappers instead of `Return(std::move(...))` directly.

- **Example:**

```cpp
MOCK_METHOD(std::unique_ptr<Foo>, MakeFoo, (), (override));

EXPECT_CALL(mock, MakeFoo())
    .WillRepeatedly([]() { return std::make_unique<Foo>(); });
```

- **Warning:** Avoid `Return(std::move(ptr))` for repeated calls; use lambdas instead.

### 6. Deprecation and Removal of Legacy Macros

- The old macros such as `MOCK_METHOD0`, `MOCK_CONST_METHOD1`, and the `_WITH_CALLTYPE` variants are deprecated.
- **Migration:** Transition to the general `MOCK_METHOD` macro with proper specifiers.

### 7. Using WillByDefault vs WillRepeatedly

- `ON_CALL` requires `.WillByDefault()` as the only action clause.
- `EXPECT_CALL` uses `.WillOnce()` and `.WillRepeatedly()` for specifying call behaviors.
- Mixing or misordering of these clauses can cause compile-time or runtime errors.

### 8. RetiresOnSaturation Usage

- When expecting calls to methods that might overshoot the expected call count, `.RetiresOnSaturation()` helps automatically retire expectations after saturation.
- Without migrating to this model, tests may fail unexpectedly.

### 9. Constness and Overloaded Function Handling

- When mocking overloaded or `const`-qualified methods, use `(const)` and `Const()` wrappers for disambiguation.
- For example, to mock const overload:

```cpp
// MOCK_METHOD of const method
MOCK_METHOD(int, GetValue, (), (const, override));

// Expectation disambiguation
EXPECT_CALL(Const(mock), GetValue())
    .WillOnce(Return(10));
```

### 10. Diagnostic Enhancements for Uninteresting and Unexpected Calls

- Adding clarity on warnings such as "Uninteresting mock function call" helps identify missing expectations.
- Migration to newer gMock versions may result in more verbose logging during testing, controllable by `--gmock_verbose`.

## Troubleshooting & Common Pitfalls During Migration

- **Unintended Test Breakages:** Often stem from incorrect overload resolution or mismatch in expectations order.
- **Compilation Errors:** Due to missing qualifiers such as `override`, `const`, `ref(&)`, or incorrect macro usage.
- **Silent Test Flakiness:** May occur when uninteresting calls are missed; address by explicitly adding expectations or using NiceMock.

## Practical Migration Example

Suppose you have old-style mocks:

```cpp
class OldMockFoo : public Foo {
 public:
  MOCK_METHOD1(DoSomething, bool(int));
};
```

You would migrate to:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, DoSomething, (int), (override));
};
```

Also, add expectations explicitly for uninteresting calls if warnings disrupt your workflow.

## Additional Resources

For detailed explanations, best practices, and examples on mocking, expectations setting, and controlling mock behavior, consult the following:

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Expectations Reference](https://google.github.io/googletest/api/gmock_cook_book.html#SettingExpectations)
- [Strict, Nice, and Naggy Mocks](https://google.github.io/googletest/api/gmock_cook_book.html#NiceStrictNaggy)
- [Move-Only Types Mocking Guide](https://google.github.io/googletest/gmock_cook_book.html#MockingMoveOnlyTypes)

To trace and debug during migration, run your tests with:

```shell
./your_test_executable --gmock_verbose=info
```

---

By carefully reviewing and applying the migration steps detailed here, you will ensure smooth adaptation to new versions of GoogleMock and GoogleTest, maintaining test reliability and taking advantage of the improved design and capabilities.

---

## Common Pitfalls

- **Forgotten `override` or `const` specifiers:** Leads to subtle bugs or compilation failures.
- **Wrong macro syntax with unprotected commas:** Always wrap complex types with parentheses or use type aliases.
- **Ignoring call strictness levels:** May result in unexpected behavior or test noisiness.
- **Ordering expectations improperly:** More general expectations placed after specific ones override them.
- **Incorrect handling of move-only types:** Use lambdas for returning new instances.

## Summary Diagram of Migration Flow

```mermaid
flowchart TD

  Start([Start Migration]) --> ReviewChanges[Review Breaking Changes]
  ReviewChanges --> CheckMocks[Check Mocks & Expectations]
  CheckMocks -->|Uses Old Macros| UpdateMacros[Update to MOCK_METHOD]
  UpdateMacros --> AddQualifiers[Add const, override, ref(&) qualifiers]
  CheckMocks -->|Uses Move-only Types| AdjustActions[Adjust Actions for move-only types]
  AddQualifiers --> VerifyTests[Verify and Test]
  AdjustActions --> VerifyTests
  CheckMocks -->|Uses Strictness Wrappers| HandleStrictness[Use NiceMock or StrictMock as appropriate]
  HandleStrictness --> VerifyTests
  VerifyTests --> Done([Migration Complete])
```

---

## Troubleshooting Migration

### Symptom: Compilation Fails With Macro Errors
- **Cause:** Incorrect `MOCK_METHOD` syntax or missing qualifiers.
- **Solution:** Double-check argument parentheses, return types with commas are wrapped; add all needed specifiers.

### Symptom: Unintentional Test Failures Due to Call Matching
- **Cause:** Wrong order or missing expectations; strictness wrapper side effects.
- **Solution:** Place more specific `EXPECT_CALL` after generic ones, use `NiceMock` to reduce noise temporarily.

### Symptom: Unexpected Runtime Warnings:
- **Cause:** Uninteresting calls without matched expectations.
- **Solution:** Add `EXPECT_CALL(...).Times(AnyNumber())` for expected uninteresting calls or switch to `NiceMock` during migration.

---

For further help, join the community discussions or consult the community documentation:

- [Community-Created Documentation](https://github.com/google/googletest/blob/main/docs/community_created_documentation.md)

---

_Last Updated: June 2024_

<Source url="https://github.com/google/googletest" />
