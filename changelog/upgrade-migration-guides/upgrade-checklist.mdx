---
title: "Upgrade Checklist"
description: "A practical, step-by-step guide helping users prepare for and execute upgrades. Includes environmental prerequisites, checks for deprecations, and verification of post-upgrade test health."
---

# Upgrade Checklist

Prepare your GoogleTest and GoogleMock environment confidently with this practical step-by-step upgrade checklist. Designed to guide you through the prerequisite environment validation, deprecation awareness, and post-upgrade verification, this checklist ensures your upgrade is smooth, your tests remain reliable, and help you avoid common pitfalls.

---

## 1. Environment Prerequisites

Before upgrading, verify your environment meets all necessary requirements to support the newer versions.

- **C++ Standard Compatibility**
  - Ensure your compiler supports **at least C++17**, as versions 1.17.x and above require this.
  - Confirm the compiler version meets GoogleTest's support policy.

- **Toolchain and Build System**
  - Use a compatible version of **CMake** (3.14 or higher recommended).
  - Ensure your build tools (e.g., make, ninja) and linker are configured for reproducible builds.

- **Platform Support**
  - Confirm your OS and platform are supported as per GoogleTest's supported platforms matrix.

- **Third-Party Dependencies**
  - If you rely on Abseil libraries, verify their versions align with your GoogleTest version requirements.

- **Threading and System Capabilities**
  - Confirm POSIX threads or equivalent threading support is enabled and properly configured for your platform.

<Tip>
Run `gtest-port.h` and `gtest-port-arch.h` compatibility checks if available to catch unsupported builds early.
</Tip>

---

## 2. Pre-Upgrade Checks

### 2.1 Review Deprecation Notices

- Check for any deprecated GoogleTest or GoogleMock APIs in your current code.
- Pay particular attention to modifications around:
  - `MOCK_METHOD` macros syntax updates.
  - Changes to default behaviors around mock method strictness (e.g., usage of `NiceMock`, `StrictMock`, and `NaggyMock`).
  - Removal timelines for deprecated features (see [Deprecations & Removal Timeline](https://github.com/google/googletest) for version-specific details).

### 2.2 Assess Custom Mock Implementations

- Verify your mock classes and usage of `MOCK_METHOD` have no legacy macro usage (`MOCK_METHODn`). Migrate to the generic `MOCK_METHOD` syntax if needed.
- Check any use of unsupported qualifiers or call types in mock method declarations.

### 2.3 Review Test Initialization Code

- Ensure your test initialization uses the recommended `InitGoogleTest` and `InitGoogleMock` functions.
- Validate your use of GoogleMock flags is current, particularly the `--gmock_verbose` flag which controls mock call verbosity.

<Note>
Running with verbosity `--gmock_verbose=info` can assist in diagnosing deprecated or unexpected mock usage prior to upgrade.
</Note>

---

## 3. Upgrade Execution Checklist

### 3.1 Backup

- Take a snapshot of your current test code and build environment.
- Backup current dependency versions and configuration files (CMakeLists, Bazel BUILD files).

### 3.2 Apply Upgrade

- Update your GoogleTest and GoogleMock libraries to the target release version.
- Update your build configuration to link against new versions as needed.
- Replace deprecated API usages based on deprecation notices.

### 3.3 Update Mock Classes and Tests

- Refactor mock classes for any required changes in mocking syntax or strictness mode.
- Consider wrapping your mocks with `NiceMock` or `StrictMock` depending on your testing policies.
- Adjust expectations and default actions to align with updated mocking API semantics.

<Tip>
If using move-only types in mocks, verify that they are supported by your new GoogleMock version, as support has improved in recent releases.
</Tip>

---

## 4. Post-Upgrade Verification

### 4.1 Build Validation

- Build your entire test suite against the upgraded libraries.
- Fix compilation errors stemming from API changes or new compiler requirements.

### 4.2 Run Tests

- Execute your full test suite.
- Pay special attention to warnings or errors about uninteresting or unexpected mock calls.
- Use `--gmock_verbose=info` to get detailed logs of mock expectations and calls.

### 4.3 Address Failures

- Resolve expectation mismatches, especially those related to stricter mock call verification.
- Adjust tests that fail due to deprecated or changed behaviors.

### 4.4 Monitor for Deprecated or Removed Feature Usage

- Review test logs for any warnings indicating use of soon-to-be-removed features.
- Plan to refactor those tests proactively.

---

## 5. Practical Tips and Best Practices

- **Use `ON_CALL` Primarily**
  - Define default mock behaviors with `ON_CALL`, and use `EXPECT_CALL` only to specify important behavioral expectations.

- **Control Strictness**
  - Use `NiceMock` to suppress warnings for uninteresting calls.
  - Use `StrictMock` to enforce stricter call validation.
  - Avoid `NaggyMock` unless specifically debugging.

- **Update Your Mock Method Macros**
  - Use the standardized `MOCK_METHOD` macro with qualifiers.
  - Wrap complex return or argument types with parentheses if they contain commas.

- **Watch Call Ordering Constructs**
  - If you use `InSequence` or `After`, verify they still align with your test flow after upgrade.

- **Default Values and Actions**
  - Use `DefaultValue<T>::Set()` and `ON_CALL` to manage method return defaults efficiently.

- **Use Verbosity Flags for Diagnostics**
  - Run tests with `--gmock_verbose=info` during troubleshooting.
  - Combine with `--gtest_stack_trace_depth` to control stack trace output volume.

---

## 6. Troubleshooting

If you encounter issues during or after upgrade:

- Check the [Troubleshooting Common Issues](https://google.github.io/googletest/getting-started/troubleshooting-help/common-issues) guide.
- Review the [Breaking Changes & Migration Steps](https://google.github.io/googletest/changelog/upgrade-migration-guides/breaking-changes-migration) for version-specific migration notes.
- Analyze failed mock expectations using verbose logging to identify call mismatches.
- Verify that your mocking macros adhere to the latest recommended form.

---

## 7. Additional Resources

- [GoogleTest User's Guide](https://google.github.io/googletest/)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Breaking Changes & Migration Guide](https://google.github.io/googletest/changelog/upgrade-migration-guides/breaking-changes-migration)
- [Deprecation Notices](https://google.github.io/googletest/changelog/release-notes-history/deprecation-notices)
- [Common Issues Troubleshooting](https://google.github.io/googletest/getting-started/troubleshooting-help/common-issues)

---

By following this checklist, you can confidently upgrade your GoogleTest environment, harness the latest capabilities, and maintain robust test stability and reliability.

---