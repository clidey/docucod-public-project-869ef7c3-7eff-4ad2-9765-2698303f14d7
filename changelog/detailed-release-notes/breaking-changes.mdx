---
title: "Breaking Changes & Migrations"
description: "Understand all breaking changes, removed or altered APIs, and what actions are needed to migrate codebases. This page offers step-by-step migration advice, example before-and-after code snippets, and highlights known backward-compatibility issues."
---

# Breaking Changes & Migrations

Understand all breaking changes, removed or altered APIs, and what actions are needed to migrate codebases. This page offers step-by-step migration advice, example before-and-after code snippets, and highlights known backward-compatibility issues.

---

## Overview

This documentation covers breaking changes introduced in recent versions of GoogleMock, especially those affecting the mock class interfaces defined via `MOCK_METHOD`. It guides users through migration steps to adapt existing codebases to updated APIs, highlights removed or altered API constructs, and addresses backward-compatibility concerns.

Migrating your code safely ensures your tests continue to function correctly and take advantage of the latest improvements and bug fixes.

---

## Key Breaking Changes

### Transition from Old-Style `MOCK_METHODn` Macros to Generic `MOCK_METHOD`

Older macOS and legacy codebases might still use the old family of macros `MOCK_METHODn`, `MOCK_CONST_METHODn`, and their variants. These macros have been deprecated in favor of the uniform and more flexible generic `MOCK_METHOD` macro.

#### What Changed?

- **Old macros:**  `MOCK_METHOD1(Foo, bool(int))` syntax.
- **New macro:**  `MOCK_METHOD(bool, Foo, (int))` syntax.

#### Migration Steps

<Steps>
<Step title="Identify old macros">
Search for any usage of `MOCK_METHODn`, `MOCK_CONST_METHODn`, and variants in your mock class definitions.
</Step>
<Step title="Rewrite with new macro">
Rewrite each old macro usage to the new `MOCK_METHOD` form. This involves swapping the method name and return type, placing the arguments in parentheses as the third parameter, and adding optional qualifiers such as `(const, override)` as a fourth parameter.
</Step>
<Step title="Handle call type and templates">
For methods that specify Windows calling conventions (e.g., `STDMETHODCALLTYPE`), use the `Calltype(...)` qualifier in the new macro.

Update template mocks by removing the `_T` suffix and applying the new macro syntax.
</Step>
<Step title="Test the mocks and fix compilation errors">
Rebuild your tests and verify that all mocks compile successfully. Address any syntax errors due to misplaced parentheses or commas.
</Step>
</Steps>

#### Example

```cpp
// Old style
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD2_T_With_CALLTYPE(STDMETHODCALLTYPE, Bar, int(double, char));

// New style
MOCK_METHOD(bool, Foo, (int), (override));
MOCK_METHOD(int, Bar, (double, char), (const, override, Calltype(STDMETHODCALLTYPE)));
```

---

### Comma Handling in `MOCK_METHOD` Arguments

In complex method signatures with template types containing commas (e.g., `std::pair`, `std::map`), `MOCK_METHOD` may fail to parse correctly.

#### What Changed?

- You must now wrap types that contain commas in parentheses or provide type aliases.

#### Migration Steps

- Wrap the return or argument types that contain commas in extra parentheses.
- Alternatively, define type aliases for complex types.

#### Example

```cpp
// Incorrect - won't compile
MOCK_METHOD(std::pair<bool, int>, GetPair, ());
MOCK_METHOD(bool, CheckMap, (std::map<int, double>, bool));

// Correct - wrap with parentheses
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

// Or use type aliases
using BoolAndInt = std::pair<bool, int>;
using MapIntDouble = std::map<int, double>;
MOCK_METHOD(BoolAndInt, GetPair, ());
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

---

### Mock Methods Must Always Be Public

A fundamental design decision in GoogleMock requires that all `MOCK_METHOD` declarations must be placed in the `public:` section of your mock classes, regardless of the access level of the method in the base class.

#### Migration Steps

- Move any `MOCK_METHOD` declarations in `protected:` or `private:` sections into `public:`.

#### Why?

This approach allows `ON_CALL` and `EXPECT_CALL` to access mock methods from outside the class without violating C++ access control rules.

#### Example

```cpp
class Foo {
protected:
  virtual void Resume();
private:
  virtual int GetTimeout();
};

class MockFoo : public Foo {
public:
  MOCK_METHOD(void, Resume, (), (override));
  MOCK_METHOD(int, GetTimeout, (), (override));
};
```

---

### Overloaded Method Mocking Requires Careful Declaration

Mocking overloaded methods remains supported and unchanged, but failure to mock all overloads can produce compiler warnings due to hiding base class methods.

#### Migration Steps

- Mock all overloads explicitly using `MOCK_METHOD`.
- If you want to mock only selected overloads, use `using BaseClass::MethodName;` to bring in the others to avoid hiding.

#### Example

```cpp
class Foo {
  virtual int Add(int x);
  virtual int Add(int times, int x);
  virtual Bar& GetBar();
  virtual const Bar& GetBar() const;
};

class MockFoo : public Foo {
public:
  using Foo::Add; // Bring in other overloads.
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));

  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

---

### Strictness Wrappers Behavior Update

GoogleMock provides `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to control the behavior of uninteresting mock calls. Be aware:

- **NiceMock** suppresses warnings for uninteresting calls.
- **NaggyMock** (default) emits warnings.
- **StrictMock** treats uninteresting calls as test errors.

Ensure your tests explicitly use these wrappers where needed to control noise and failures resulting from mock method calls without expectations.

---

## Migration and Compatibility Tips

- Always set expectations **before** exercising mock objects. Setting expectations after mock usage leads to undefined behavior.
- Use `RetiresOnSaturation()` in `EXPECT_CALL`s when the expectation should be disabled once fulfilled to avoid sticky expectations pitfalls.
- For mocking non-virtual functions, use template-based dependency injection as described in the gMock Cookbook.
- When encountering unexpected syntax errors related to `MOCK_METHOD`, verify that complex types with commas are correctly parenthesized or aliased.
- Review your mock class to ensure all destructors are declared virtual to avoid undefined behavior.
- Suppress warnings or errors about uninteresting calls by adopting `NiceMock` or defining catch-all expectations with `.Times(AnyNumber())`.

---

## Troubleshooting Common Migration Issues

<AccordionGroup title="Migration Troubleshooting">
<Accordion title="Unexpected Compiler Errors on MOCK_METHOD Usage">
Verify proper use of parentheses around template argument types that contain commas. Use typedefs to simplify complex types.
</Accordion>
<Accordion title="Uninteresting Call Warnings Persist After ON_CALL">
Define expectations with `EXPECT_CALL` rather than relying solely on `ON_CALL`, or switch to `NiceMock` to suppress warnings.
</Accordion>
<Accordion title="Mock Methods Declared in wrong access section cause linkage errors">
Ensure all `MOCK_METHOD` macros appear in the `public:` section of your mock classes, even if overriding protected or private base methods.
</Accordion>
<Accordion title="Conflicts with old MOCK_METHODn macros">
Fully migrate to the generic `MOCK_METHOD` macro; remove old `MOCK_METHODn` macros to avoid conflicts.
</Accordion>
</AccordionGroup>

---

## Summary

Migrating to the newest GoogleMock APIs ensures compatibility, improved syntax, better strictness control, and simpler mocking strategies. Follow the detailed steps outlined above to update your mocks safely and keep your tests robust.

For further guidance, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html), [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html), and the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html).

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — detailed recipes and migration tips.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — API details for mocks and expectations.
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) — common issues and explanations.

---

_Last updated: main branch_

<Source url="https://github.com/google/googletest" paths={[{"path": "docs/gmock_cook_book.md", "range": "1-9999"},{"path": "docs/gmock_faq.md", "range": "1-9999"},{"path": "docs/reference/mocking.md", "range": "1-9999"}]} />