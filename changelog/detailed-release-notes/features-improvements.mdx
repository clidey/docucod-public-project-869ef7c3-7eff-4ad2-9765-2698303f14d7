---
title: "Features & Improvements"
description: "Catalogs newly introduced capabilities, enhancements to existing APIs, and performance optimizations for each release—helping users determine the value of upgrading."
---

# Features & Improvements

This page catalogs the newly introduced capabilities, enhancements to existing APIs, and performance optimizations for each GoogleTest and GoogleMock release. It is designed to help users quickly understand the value of upgrading, the scope of changes, and focus on how these improvements affect their testing practices.

---

## Recent Feature Highlights

### 1. Enhanced Mocking Capabilities

- **Modernized Mocking Syntax**: Adoption of the generalized `MOCK_METHOD` macro simplifies mock class definitions by supporting method qualifiers such as `const`, `override`, `noexcept`, and custom calling conventions. This has streamlined mock creation and reduced boilerplate, especially for overloaded and templated methods.

- **Improved Support for Move-Only Types**: Mock methods now seamlessly support move-only types like `std::unique_ptr` as return values or parameters, enabling more types of APIs to be effectively tested with mocks.

- **Strictness Modes**: Introduction of `NiceMock`, `NaggyMock`, and `StrictMock` wrappers around mock classes provides granular control over how uninteresting and unexpected calls are handled. It allows users to balance test noise and strictness, tailoring feedback in their test environments.

### 2. Expanded Expectation and Action Controls

- **Flexible Expectation Ordering**: Support for partial ordering of expectations via `InSequence` and `.After()` clauses allows test authors to specify precise call order requirements, supporting complex testing scenarios involving multiple mocks and intricate interaction patterns.

- **Action Compositions and Custom Actions**: Users can combine multiple actions via `DoAll()`, use lambdas or callable objects as actions, and define polymorphic and parameterized custom actions with templates and macros, enabling highly expressive mock behaviors and side effects.

- **Default Actions and ON_CALL Enhancements**: The `ON_CALL` macro lets users define default behaviors separately from expectations, avoiding brittle tests. Additionally, action chains and conditional default behaviors improve mock responsiveness.

### 3. Matchers and Argument Validation

- **Multi-Argument and Tuple Matchers**: The `.With()` clause and multi-argument matchers allow users to impose constraints on the entire set of mock method arguments as a whole, beyond simple element-wise matching.

- **Extended Container and Pointer Matchers**: Built-in matchers for STL containers, smart pointers, and nested pointers (using `Pointee`) help validate complex argument structures.

- **Custom Matcher Support**: The `MATCHER` macros and matcher classes enable users to write expressive custom matchers with detailed failure explanations, facilitating domain-specific validation.

### 4. Usability and Performance Improvements

- **Improved Test Output and Diagnostics**: The verbosity flag (`--gmock_verbose`) controls the granularity of test logs, with detailed traces and call matching information aiding debugging.

- **Heap and Leak Detection Enhancements**: Tools like `Mock::AllowLeak` and heap checker integration help identify issues with mock object lifecycles.

- **Compilation Speed Optimizations**: Moving mock class constructor and destructor definitions to separate translation units reduces compile times when mocks are included in many files.

- **Thread-Safe Mocking**: GoogleMock ensures safe mock usage in multi-threaded tests by serializing access to expectations and allowing concurrent mock invocations with internal synchronization.

### 5. Integration and Extended Use Cases

- **Mocking `std::function` and Callbacks**: The `MockFunction` template simplifies mocking callback-based code by providing an easy way to define mock function objects supporting arbitrary signatures.

- **Mocking Non-Virtual Methods and Free Functions**: Techniques and patterns to mock non-virtual methods using templates and adapters to abstract free functions support broader applicability.

- **Delegation Patterns**: Delegation of calls to real objects or fake implementations facilitates complex test scenarios requiring partial mocking or fallback behaviors.

---

## Detailed Feature Insights

### MOCK_METHOD Macro Enhancements

This macro unifies mocking syntax and supports qualifiers:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

Qualifiers may include `const`, `override`, `noexcept`, `Calltype(...)` for calling conventions, and reference qualifiers like `ref(&)`.

When argument or return types include commas, users can wrap them in parentheses or define type aliases.

### Expectation Syntax and Ordering

Expectations are set with `EXPECT_CALL`:

```cpp
EXPECT_CALL(mock_obj, Method(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action)
    .InSequence(sequences...)
    .After(expectations...)
    .RetiresOnSaturation();
```

- `Times()` specifies how often the call must happen (e.g., `Exactly(n)`, `AtLeast(n)`).
- Call order can be enforced strictly with `InSequence` or partially ordered with `After`.
- Expired expectations are retired automatically, unless overridden by `.RetiresOnSaturation()`.

### Default Behavior with ON_CALL

Set default behavior without asserting the call:

```cpp
ON_CALL(mock_obj, Method(matchers...))
    .WillByDefault(action);
```

This separates behavior from expectation, helping avoid brittle tests sensitive to call frequency.

### Strictness Wrappers

Control warnings and failures on uninteresting calls:

| Wrapper         | Behavior on Uninteresting Calls                 |
|-----------------|------------------------------------------------|
| `NiceMock`      | Suppresses warnings (quiet)                     |
| `NaggyMock`     | Warns (default behavior)                        |
| `StrictMock`    | Treats as errors (fail test)                    |

Example:

```cpp
NiceMock<MockFoo> nice_foo;
StrictMock<MockFoo> strict_foo;
```

### Actions and Side Effects

Actions specify behavior when mock methods are called:

- Built-in actions like `Return()`, `ReturnRef()`, `ReturnPointee()`, `Invoke()`, `DoAll()`, and `SetArgPointee()` for side effects.
- Lambdas, functors, and methods can be used as actions for flexible behaviors.

Example:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(Return(42))
    .WillRepeatedly([](int x) { return x + 1; });
```

### Matchers

Matchers validate arguments:

- Use predefined matchers like `_` (wildcard), `Eq()`, `Ge()`, `Lt()`, `NotNull()`, `ElementsAre()`, and composite matchers like `AllOf()`, `AnyOf()`.
- Match entire argument tuples using `.With()` and multi-argument matchers.
- Define custom matchers using `MATCHER` and `MATCHER_P*` macros.

Example:

```cpp
EXPECT_CALL(mock, Process(HasSubstr("foo"), Ge(5))).WillOnce(Return(true));
```

### Multi-threading and Safety

- gMock serializes access to expectations internally, allowing safe concurrent calls.
- Actions run in the thread that invoked the mock method.
- Users must ensure no concurrent expectation setup or teardown.

---

## Practical Recommendations

- **Set expectations before exercising mocks** to avoid undefined behavior.
- Use **`ON_CALL`** for default behaviors, and **`EXPECT_CALL`** only when you want to verify calls.
- Prefer **NiceMock** to reduce noise during development, and **StrictMock** for strict verification.
- Use **sequence and ordering controls** to express precise interaction patterns without brittle tests.
- Combine **actions, matchers, and cardinalities** thoughtfully to describe expected behaviors.
- When mocking **move-only types**, use lambdas for actions creating new instances.

---

## Example: Mock with Expectations and Actions

```cpp
class MockStack : public StackInterface<int> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const int& x), (override));
};

TEST(StackTest, PushIncreasesSize) {
  MockStack stack;

  ON_CALL(stack, GetSize()).WillByDefault(Return(0));
  EXPECT_CALL(stack, Push(5));

  EXPECT_CALL(stack, GetSize())
      .WillOnce(Return(1))
      .WillRepeatedly(Return(1));

  stack.Push(5);
  EXPECT_EQ(stack.GetSize(), 1);
  EXPECT_EQ(stack.GetSize(), 1);
}
```

---

## Further Learning and References

- [Mocking Reference](reference/mocking.md) — Full API details on mocking macros and classes
- [gMock Cookbook](docs/gmock_cheat_sheet.md) — Concise recipes and usage patterns
- [Actions Reference](reference/actions.md) — All action types and usage
- [Matchers Reference](reference/matchers.md) — Available matchers and combinations
- [Mock Strictness Policies](concepts/scalability-and-extensibility/strictness-modes.mdx)
- [Migration and Upgrade Guides](changelog/migration-and-upgrade-guides/index.md)

---

<Note>
For optimal usage, ensure your mock classes have virtual destructors and that you follow the recommendation to set expectations before exercising mocks. Explore strictness modes to manage test verbosity and robustness.
</Note>

<Check>
Check related sections in the [Mocking API Reference](api-reference/mocking-api/creating-mock-objects) and the [gMock Cookbook](docs/gmock_cheat_sheet.md) for comprehensive usage patterns.
</Check>

---