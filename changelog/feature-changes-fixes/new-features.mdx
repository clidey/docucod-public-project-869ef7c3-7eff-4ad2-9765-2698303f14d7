---
title: "New Features & Enhancements"
description: "Discover the latest capabilities introduced to GoogleTest, with clear explanations of how new features can improve your development and testing experience."
---

# New Features & Enhancements

Discover the latest capabilities introduced to GoogleTest, with clear explanations of how new features can improve your development and testing experience.

---

## Overview

This page highlights the recent feature additions and enhancements in GoogleTest, focusing specifically on those that affect mock object creation, expectation management, and mock behavior control with GoogleMock. It guides users through practical usage, illustrating how these improvements can help make your tests more expressive, maintainable, and robust.

Whether you are a new or experienced user, understanding these updates will enable you to leverage GoogleMock fully, enabling more precise verification of interactions and smoother test workflows.

---

## Key Feature Additions

### 1. Simplified Mock Method Declaration with `MOCK_METHOD`

- GoogleMock continues to use the modern and versatile `MOCK_METHOD` macro to define mock methods within mock classes, allowing clear, concise declaration of virtual methods with complex signatures.

- Support for qualifiers such as `const`, `override`, `noexcept`, `Calltype(...)` (for calling convention specification), and reference qualifiers (`ref(&)`, `ref(&&)`) remains comprehensive, enabling exact signature mock coverage.

- Users benefit from improved parsing by wrapping complex argument types with parentheses or by using type aliases, avoiding common pitfalls caused by unprotected commas in types.

#### Practical Tip

- Always define `MOCK_METHOD`s in the `public` section regardless of the original method's access level to allow external setting of expectations.

### 2. Enhanced Expectation Syntax: `EXPECT_CALL`

- `EXPECT_CALL` continues to enable specifying precise expectations on mock methods regarding arguments, number of calls (cardinalities), call order, and call behavior.

- Chainable clauses such as `.Times()`, `.WillOnce()`, `.WillRepeatedly()`, `.InSequence()`, `.After()`, and `.RetiresOnSaturation()` give users granular control over interactions to closely mimic real use cases.

- The `.With()` clause can restrict expectations to apply only when the entire arguments tuple matches a multi-argument matcher.

- Expectation ordering improvements such as full support for sequences and partial ordering allow writing stable, readable tests respecting complex call orders.

#### Example

```cpp
using ::testing::Return;
using ::testing::InSequence;

{
  InSequence seq;
  EXPECT_CALL(mock, Initialize())
      .Times(1);
  EXPECT_CALL(mock, Process(_))
      .Times(AtLeast(1))
      .WillRepeatedly(Return(true));
  EXPECT_CALL(mock, Cleanup())
      .Times(1);
}
```

### 3. Default Behaviors via `ON_CALL`

- `ON_CALL` statements let users specify the default behavior of mock methods when calls donâ€™t have explicit expectations set, improving test stability and reducing boilerplate `EXPECT_CALL`s.

- Support for chaining `.With()` and mandatory `.WillByDefault()` clauses alongside flexible matchers reduces accidental over-specification.

- By distinguishing default action definitions from expectations, tests become clearer in intent and maintainable.

### 4. Mock Behavior Wrappers: NiceMock, NaggyMock, StrictMock

- These templated wrappers control how mock objects handle uninteresting calls (i.e., calls without explicit expectations).

- `NiceMock<T>` suppresses warnings for uninteresting calls on the mock, making tests less noisy without changing failures.
  
- `NaggyMock<T>` (the current default behavior) prints warnings on uninteresting calls.

- `StrictMock<T>` treats uninteresting calls as errors, enforcing strict validation.

- Wrappers inherit constructors transparently, preserving typical usage patterns.

#### Best Practices

- Use `NiceMock` for tests where you want to suppress warnings and focus on verifying explicitly expected calls.

- Use `StrictMock` to enforce rigorous call validation when interaction correctness is critical.

### 5. Improved Handling for Overload Resolution and Argument Matching

- Techniques such as using `Const()` wrappers and `SafeMatcherCast` help disambiguate overloaded methods and adapt matchers to argument types.

- Users can compose complex argument matchers with combinators like `AllOf()`, `AnyOf()`, `Not()`, and tuple matchers using `.With()` clause on expectations.

### 6. Advanced Action Support

- Actions can be composed, chained (using `DoAll()`), or created from lambdas, member functions, and functors for customized side effects and return values.

- Support for mocking side effects, such as changing output arguments via `SetArgPointee()`, and invoking callbacks (such as via `InvokeArgument<>`) allows more natural testing of asynchronous and interactive APIs.

---

## User Workflows

### Defining Mock Classes

1. Derive your mock class from the interface or base class.
2. Use `MOCK_METHOD` macros for each virtual method you want to mock.
3. Use type aliases or parentheses for complex argument types containing commas.
4. If needed, wrap mock classes in `NiceMock`, `NaggyMock`, or `StrictMock` depending on desired behavior.

### Setting Expectations

1. Before exercising the code under test, write `EXPECT_CALL` statements targeting your mock objects.
2. Specify argument matchers to constrain the calls you expect.
3. Use `.Times()` to define call counts clearly; omit it for defaults.
4. Use `.WillOnce()` or `.WillRepeatedly()` with appropriate actions to define method outcomes.
5. Use `.InSequence()` and `.After()` to enforce call ordering when necessary.

### Defining Default Actions

1. Use `ON_CALL` to specify what mock methods should do when called without explicit expectations.
2. Use the `.With()` clause if you want to restrict defaults more precisely.
3. Ensure `.WillByDefault()` is set as it is mandatory.

### Handling Uninteresting Calls

- By default, GoogleMock warns about calls that lack expectations but lets them pass.
- If warnings are noisy, wrap the mock in `NiceMock` to suppress uninteresting call warnings.
- For strict validation, use `StrictMock`.

### Debugging and Verbosity

- Use the `--gmock_verbose=info` flag when running tests to get detailed call logs, useful for diagnosing failing expectations.
- Adjust verbosity to `warning` or `error` to reduce noise as needed.

---

## Best Practices and Tips

- Always set expectations before exercising the mocks to avoid undefined behavior.
- Use catch-all `EXPECT_CALL` with `Times(AnyNumber())` or `WillRepeatedly()` to suppress warnings for calls you consider uninteresting.
- Use sequences to specify order-sensitive expectations clearly and maintainably.
- Prefer `ON_CALL` for default behavior setup and use `EXPECT_CALL` only when verifying calls.
- Inherit and leverage mock wrappers for clean test code and better control of mock strictness.
- Modularize mocks by mocking interfaces owned by your project rather than external concrete classes.
- Use call actions and argument matchers to model and verify complex interactions effectively.

---

## Troubleshooting Common Issues

- If you see warnings about uninteresting calls unexpectedly, verify that your `EXPECT_CALL` or `ON_CALL` statements are correctly specified.
- If calls fail unexpectedly, run tests with `--gmock_verbose=info` to trace call matching logic.
- Use `RetiresOnSaturation()` in expectations when you want them to retire after fulfilling their call count to avoid unwanted sticky behavior.
- For mocking methods with complex or move-only types, consider using lambdas or custom actions.
- Make sure the mocked class destructor is `virtual` to avoid memory and verification issues.

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for practical recipes on mocking
- [Mocking Reference](../docs/reference/mocking.md) for authoritative API details
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick syntax
- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for beginner guidance
- [Mocking Policies and Behaviors](https://google.github.io/googletest/googletest/advanced-mocking/mocking-policies-and-behaviors.html) for strictness tuning

---

Embrace these enhancements to write clearer, more maintainable, and robust mock-based tests with GoogleTest and GoogleMock.

---

## Source

This documentation was generated based on the GoogleTest open source repository:

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_cook_book.md", "range": "all"},{"path": "docs/reference/mocking.md", "range": "all"},{"path": "docs/gmock_for_dummies.md", "range": "all"},{"path": "docs/gmock_cheat_sheet.md", "range": "all"},{"path": "googlemock/include/gmock/gmock-nice-strict.h", "range": "all"}]}/>
