---
title: "New Features & Improvements"
description: "Highlights newly added functionality and upgraded behaviors across the framework, with practical details and references to impacted components."
---

# New Features & Improvements

This page highlights the latest additions and enhancements made specifically to the GoogleTest and GoogleMock framework. It details new functionalities, upgraded behaviors, and valuable refinements aimed at improving both usability and flexibility within mock class creation and testing workflows.

---

## 1. Introduction

The `New Features & Improvements` documentation focuses on changes that impact how users define mocks, set expectations, and control mock behavior. These improvements are designed to empower users to write clearer, more maintainable tests, enhance interaction support, and provide more control over mock behaviors.

This content complements the foundational documents such as the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html), [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html), and the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html), serving as a practical changelog that guides users through new capabilities.

## 2. Enhanced Mock Method Declarations

- **Refined `MOCK_METHOD` Macro**: The `MOCK_METHOD` macro has evolved to better handle complex C++ scenarios, such as:
  - Supporting function qualifiers like `const`, `override`, `noexcept`, and calling conventions (`Calltype(...)`).
  - Handling comma-containing types by allowing wrapping types in parentheses or using type aliases to ensure correct parsing.

  This facilitates user intent expression when defining mocks, simplifying the creation of accurate mock classes.

### Example of Updated `MOCK_METHOD` Usage
```cpp
class MyMock {
 public:
  // Wrap return type with parentheses to handle commas
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());

  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

## 3. Advanced Mocking Features

- **Mocking Non-virtual Methods**: Improved support for mocking non-virtual methods by allowing unrelated mock classes matching the signatures, enabling high-performance dependency injection and compile-time selection of production vs test implementations.

- **Mocking Overloaded Methods**: Enriched capability to mock overloaded virtual functions, including const overloads, with strategies to avoid compiler warnings, such as using `using` declarations to bring base class methods into scope.

- **Mocking Class Templates**: Templates can be mocked naturally, preserving constness and override specifiers.

- **Delegation Patterns**:
  - Delegate mock method calls to a *fake* or *real* implementation to reuse logic and verify interactions more easily.
  - Delegate to parent class implementations selectively to transparently forward calls.

These patterns improve test design by reducing duplication and leveraging existing implementations.

## 4. Mock Strictness Management

Users can control how strictly mocks treat uninteresting calls (calls to methods without explicit expectations):

- **`NiceMock<T>`**: Suppresses warnings for uninteresting calls, making mocks less noisy when irrelevant calls occur.

- **`NaggyMock<T>`**: Prints warnings on uninteresting calls; this is the default for raw mocks currently.

- **`StrictMock<T>`**: Treats uninteresting calls as test failures, enforcing tighter correctness.

These wrappers integrate seamlessly with existing mock classes, inheriting constructors, and preserving user code workflows.

## 5. Improved Matchers and Actions

- **Rich Set of Matchers**: Enhanced matchers for validating function arguments, including the ability to combine matchers logically and specify complex multi-argument constraints.

- **Custom Matcher Support**: Facilities to write quick custom matchers using macros or full class implementations for polymorphic or monomorphic matchers.

- **Action Compositions**: Users can compose multiple actions to run in sequence when a mock method is called using `DoAll()`, improving expressiveness.

- **Stateful and Stateless Actions**: The framework supports sharing action objects efficiently or defining stateful actions for complex behaviors.

- **Asynchronous Testing**: Providing patterns to help test asynchronous code synchronously using notifications ensures easier test writing and debugging.

## 6. Expectation Syntax and Usage

- **Clarified `EXPECT_CALL` and `ON_CALL` Usage**: Clear guidance on when and how to use `ON_CALL` for default behaviors and `EXPECT_CALL` for verifying calls helps avoid over-specification and brittle tests.

- **Ordering Calls**: Support for strictly ordered calls via `InSequence` and partially ordered call graphs via the `After` clause enhances interaction testing.

- **Expectation Retirement**: The `.RetiresOnSaturation()` clause allows expectations to become inactive once their call count is met, preventing shadowing by more general expectations.

- **Handling Uninteresting vs Unexpected Calls**: The distinctions are highlighted, with best practices and example patterns showing how to write resilient tests.

## 7. Compiler and Performance Improvements

- **Reduced Compilation Overhead**: Advice to factor mock class constructors and destructors into separate `.cc` files to reduce build times is reinforced.

- **Handling Move-Only Types**: Mocking of methods with move-only arguments and return types like `std::unique_ptr` is now straightforward, with best practice examples.

- **Simplified Macros and Warnings**: Updated macro behavior reduces confusing compiler warnings especially on MSVC when mocking const methods.

## 8. Error Handling, Debugging, and Verbosity Controls

- **Verbose Output Flags**: Use of the `--gmock_verbose` flag with levels `info`, `warning`, and `error` controls the amount of diagnostic output, making tests easier to debug or cleaner in CI logs.

- **Helpful Failure Messages**: Clear descriptive error output aids users in quickly identifying mismatches in expectations, invocation counts, or argument values.

- **Support in IDEs**: Integration with tools like Emacs is facilitated for easier navigation from test failures to source lines.

- **Leak Detection and Verification**: Helpers to force mock verification before object destruction and detect leaked mocks help maintain test quality.

## 9. Practical Tips and Best Practices

- Use `ON_CALL` primarily for setting default behavior without strict expectations.
- Use `EXPECT_CALL` sparingly to check call counts and arguments for robust test assertions.
- Prefer `NiceMock` to reduce noise unless strict call validation is needed.
- Use sequences or `RetiresOnSaturation` to handle ordered or multi-invocation expectations properly.
- Define mocks in ownership contexts where they are properly destructed to ensure verification.

---

## Related Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Detailed recipes and examples for mocking.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Beginner-friendly gait through mocking concepts.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Official reference on macros, classes, and usage.
- [Managing Mock Strictness](https://google.github.io/googletest/reference/mocking-framework/nice-strict-mocks.html): Details on NiceMock, NaggyMock, and StrictMock.
- [Setting Expectations and Actions](https://google.github.io/googletest/api/gmock_reference.html#Use): Guides on fine-tuning mock behavior.

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_cook_book.md", "range": "all"},{"path": "docs/gmock_cheat_sheet.md", "range": "all"},{"path": "docs/gmock_for_dummies.md", "range": "all"},{"path": "docs/reference/mocking.md", "range": "all"},{"path": "googlemock/include/gmock/gmock-nice-strict.h", "range": "all"}]} />