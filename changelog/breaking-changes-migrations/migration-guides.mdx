---
title: "Migration Guides"
description: "Provides targeted instructions and best practices for upgrading between major releases, including code samples and toolchain advice. Simplifies the path to adopting new versions while avoiding common pitfalls."
---

# Migration Guides

The Migration Guides page provides targeted, practical instructions designed to make upgrading your GoogleMock library between major releases clear, manageable, and efficient. Here you'll find best practices, step-by-step workflows, and code samples that help you navigate the complexities of evolving APIs and new behaviors without breaking existing tests.

---

## Why Migration Guides Matter

Upgrading a critical testing framework like GoogleMock may expose you to breaking changes, deprecated features, or updated usage patterns. This page focuses specifically on guiding you through such transitions with user-centric advice aimed at minimizing disruption and maximizing the value of new releases.

Whether you're moving from an older major version or adopting new mocking capabilities, this page helps you understand the required adjustments in your code and test setups, empowering you to keep your test suites robust and maintainable.

---

## Key Areas Covered

### 1. Migrating from Old Mocking Macros to `MOCK_METHOD`

GoogleMock introduced a modern and more consistent mocking macro called `MOCK_METHOD`, which replaces older macros like `MOCK_METHODn`.

**What To Do:**

- Replace old-style macros such as `MOCK_METHOD1`, `MOCK_CONST_METHOD1`, and their variants with the unified `MOCK_METHOD` macro.
- Use the following pattern to define mocked methods:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
};
```

- For methods with const, override, noexcept, or other qualifiers, include them in the specs argument in parentheses:

```cpp
MOCK_METHOD(bool, DoWork, (int), (const, override, noexcept));
```

**Pitfall to Avoid:**
- Method return types or argument types containing commas need extra care. Wrap complex types in parentheses or use `using` aliases to prevent parsing errors.

Example:

```cpp
// Incorrect - will not compile
MOCK_METHOD(std::pair<bool, int>, GetPair, ());

// Correct - wrap types with commas
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// Or use aliases
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```

---

### 2. Handling Move-Only Types in Mock Methods

Modern codebases increasingly utilize move-only types such as `std::unique_ptr`. GoogleMock added support for mocking methods that accept or return move-only types.

**What To Do:**

- Use the `MOCK_METHOD` macro as usual. GoogleMock supports move-only types naturally.

Example:

```cpp
class MockBuzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz, int64_t timestamp), (override));
};
```

- When returning move-only objects, avoid using `Return(std::move(...))` more than once; the source object will be consumed after the first call.
- For changing behaviors based on move-only parameters, prefer using lambdas for actions.

---

### 3. Migrating to Use `NiceMock` and `StrictMock`

GoogleMock supports varying strictness levels for mocks to control how uninteresting calls are treated.

- `NiceMock<T>` suppresses warnings on unexpected but uninteresting calls.
- `StrictMock<T>` treats any uninteresting call as a test failure.

**Suggestion:**

- Replace manual suppression of warnings by wrapping your mock classes with `NiceMock` or `StrictMock` as appropriate.

Example:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

---

### 4. Updating Flag Usage and Initialization

GoogleMock has refined its flag handling and initialization procedures.

**What To Do:**

- Initialize GoogleMock in your test's main function with `InitGoogleMock(&argc, argv);`.
- Be aware of the `--gmock_verbose` flag controlling mock verbosity:

  - `info`: Logs all mock calls and detailed match info.
  - `warning`: Logs warnings and errors (default).
  - `error`: Logs errors only.

Use `--gmock_verbose=info` to debug complex expectation failures.

Example:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

### 5. Code Sample: Transitioning from `MOCK_METHOD1` to `MOCK_METHOD`

Old style:

```cpp
class MockFoo {
 public:
  MOCK_METHOD1(Foo, bool(int));
  MOCK_CONST_METHOD1(Bar, int(double) const);
};
```

New style:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(bool, Foo, (int), (override));
  MOCK_METHOD(int, Bar, (double), (const, override));
};
```

Best practice is to always include the `override` specifier for clarity.

---

### 6. Practical Tips & Common Pitfalls

- Always put `MOCK_METHOD` declarations in the `public` section.
- Remember wrapping complex template argument types in an extra set of parentheses to parse correctly.
- When mocking overloaded methods, define mocks for all overloads you intend to use.
- To avoid unexpected failures, use `NiceMock` during active development, and switch to `StrictMock` to catch unexpected calls in stable tests.
- Use `RetiresOnSaturation()` to deactivate expectations once their expected call count is reached, enabling fallback behaviors.

---

## Troubleshooting Migration

If you encounter unexpected behaviors after migration:

- Use the `--gmock_verbose=info` flag to gain insight into which calls are matched to which expectations.
- Check your mocking macros for correct syntax, especially for complex method signatures.
- Verify that destructors on base interfaces are virtual to avoid subtle memory issues.
- Ensure expectations are set *before* invoking mock methods.

---

## Additional Resources

- [gMock Cookbook](gmock_cook_book.md): Recipes for advanced mocking use cases.
- [gMock for Dummies](gmock_for_dummies.md): Beginner-friendly tutorial.
- [Mocking Reference](reference/mocking.md): Full API details on mocking classes and methods.
- [Breaking Changes & Deprecations](changelog/breaking-changes-migrations/breaking-changes.mdx): Comprehensive list of breaking changes.

For smooth migration, consult these documents alongside applying your code changes.

---

## Summary

This page focuses on empowering users to upgrade safely and efficiently between major GoogleMock releases. It emphasizes adapting to modernized `MOCK_METHOD` macros, handling move-only types, leveraging strictness controls (`NiceMock`/`StrictMock`), proper initialization, and flag usage. Practical code examples and common pitfalls help prevent migration friction and maintain test stability.

---

## Feedback and Contribution

If you have specific migration questions or want to contribute migration recipes, please refer to the [GoogleTest GitHub repository](https://github.com/google/googletest).


<Check>
Following this guide guarantees your upgrade path is aligned with best practices and reduces common pitfalls faced during major version transitions.
</Check>