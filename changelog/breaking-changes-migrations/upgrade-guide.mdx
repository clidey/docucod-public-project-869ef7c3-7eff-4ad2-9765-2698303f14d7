---
title: "Upgrade Guide"
description: "Step-by-step, practical instructions for upgrading from previous versions of GoogleTest and GoogleMock, highlighting required actions for compatibility and best practices to leverage new features, as well as tips to address common upgrade pitfalls."
---

# Upgrade Guide

This guide provides step-by-step, practical instructions for upgrading from previous versions of GoogleTest and GoogleMock. It highlights the necessary actions to maintain compatibility, leverage new features, and avoid common pitfalls during upgrade. Whether moving from significantly older releases or incremental versions, this guide will help you navigate the process smoothly and continue writing effective tests.

---

## 1. Compatibility and Requirements

### 1.1 Minimum C++ Standard

Starting from version 1.17.0, GoogleTest and GoogleMock require your compiler and projects to support at least **C++17**. Ensure your build environment is configured accordingly, or your upgrade will fail at compilation.

### 1.2 Platform and Compiler Support

GoogleTest follows Google's [Foundational C++ Support Policy](https://opensource.google/documentation/policies/cplusplus-support#c_language_standard) and supports a range of platforms and compiler versions. Review the [Supported Platforms](https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md) list to confirm your target environment is included and updated.

> <Note> For detailed platform-specific issues or integration tips, see the [Platforms and Integration guide](/guides/advanced-usage/platforms-and-integration).</Note>

---

## 2. Core Upgrade Actions

Upgrading revolves around addressing changes in core functionality, API usage, and recommended best practices.

### 2.1 Test Suites and Fixture Updates

* The API now prefers the term **TestSuite** instead of the older and deprecated **TestCase** terminology. Migrate your test suite naming and related references accordingly.
* Fixtures should consistently be used per test suite to avoid issues with test isolation and setup/teardown.

### 2.2 Code Modernization

* **Ensure all tests comply with C++17 standards** and adapt any deprecated constructs.
* Refactor any tests that rely on deprecated fixtures or macro usage.
* Avoid underscores `_` in test names as this usage is discouraged and may cause warnings.

### 2.3 Handling the main() Function

* Most users can rely on linking with `gtest_main` or `gmock_main` libraries, which provide a default `main()`.
* If you provide a custom `main()`, verify it calls `testing::InitGoogleTest(&argc, argv);` before running `RUN_ALL_TESTS()`.
* For customized setup before tests run, place the code within appropriate fixture or environment SetUp methods rather than in `main()`.

### 2.4 Parameterized and Typed Tests

* Follow new conventions when registering and instantiating parameterized tests using `TEST_P`, `INSTANTIATE_TEST_SUITE_P`, and `TYPED_TEST_SUITE` macros.
* Review usage of generator functions `Range()`, `Values()`, `Combine()`, and `ConvertGenerator()` for value-parameterized tests to ensure compatibility.

---

## 3. Leveraging New Features

The latest versions of GoogleTest and GoogleMock introduce advanced capabilities to improve testing quality and developer productivity.

### 3.1 Enhanced Assertion Support

* Rich assertion macros provide clearer failure messages and better diagnostics via the `AssertionResult` framework.
* Use `ASSERT_*` macros to halt test execution immediately when necessary; `EXPECT_*` macros to continue and catch multiple issues.

### 3.2 Event Listeners and Custom Test Reporting

* Implement custom `TestEventListener`s to hook into the test lifecycle for reporting, logging, or metrics.
* Manage and extend test output beyond the standard console and XML, leveraging the event listener infrastructure.

### 3.3 Improved Mocking Features

* Use `MOCK_METHOD` macros with explicit signature clarity.
* Control mocking strictness with wrappers like `NiceMock`, `NaggyMock`, and `StrictMock`.
* Combine matchers and actions with `.With()` and create complex interaction sequences.

### 3.4 Global Environments

* Leverage `Environment` subclasses to set up and tear down global state once for all tests.
* Register environments with `AddGlobalTestEnvironment()` before calling `RUN_ALL_TESTS()`.

---

## 4. Best Practices for Smooth Upgrade

### 4.1 Validate your Upgrade

* Build and run all existing tests after upgrading, paying attention especially to failures or warnings related to:
  - Deprecated fixtures or API calls
  - Naming conventions causing warnings
  - Changes in parameterized test registrations

* Use the internal sample tests and validation tests provided to confirm your setup is valid.

### 4.2 Review Test Organization

* Group related tests logically into suites reflecting your code structure.
* Use test fixtures (`TEST_F`) for sharing test data among related tests.
* Use parameterized tests (`TEST_P`) and typed tests (`TYPED_TEST`) to reduce duplication and cover data variations cleanly.

### 4.3 Upgrade Your Build System and Dependencies

* If using CMake, review your integration against the updated approach:
  - Link against `gtest_main` and `gmock_main` for default entry points.
  - Ensure compile flags enforce C++17.
  - If building shared libraries, use proper flags such as `-DGTEST_CREATE_SHARED_LIBRARY=1` and `-DGTEST_LINKED_AS_SHARED_LIBRARY=1`.

* Keep thread and platform support macros up to date based on your environment.

---

## 5. Common Pitfalls and Troubleshooting

<AccordionGroup title="Avoiding Upgrade Pitfalls">
<Accordion title="Linker Errors with gtest_main or gmock_main">
Ensure your test executables link against `gtest_main` or `gmock_main`. These libraries supply a default `main()` function. If you implement your own `main()`, do not link with these to avoid multiple-definition errors.
</Accordion>
<Accordion title="Compilation Fails Due to Missing C++17 Support">
Confirm your compiler supports C++17 and your build system specifies this standard explicitly. Refer to your compiler documentation and set the `-std=c++17` flag or equivalent.
</Accordion>
<Accordion title="Tests Skipped or Not Running as Expected">
Check your use of filters, disabled tests, and sharding. Understand that tests marked as disabled with prefix `DISABLED_` won't run unless flags like `--gtest_also_run_disabled_tests` are used.
</Accordion>
<Accordion title="Unexpected Test Failures Post-Upgrade">
Review changes in assertion macros and fixture behavior. Remember that each test has its own fresh fixture instance; shared state must be explicitly managed.
</Accordion>
</AccordionGroup>

---

## 6. Step-by-Step Upgrade Workflow

<Steps>
<Step title="Prepare Your Environment">
Confirm compiler compatibility and platform support. Update your build system to enforce C++17.
</Step>
<Step title="Update GoogleTest and GoogleMock Libraries">
Pull the latest source or binaries. Prefer linking against combined releases including both.
</Step>
<Step title="Review and Refactor Tests">
Rename `TestCase` terms to `TestSuite`. Replace deprecated macros. Fix naming conventions.
</Step>
<Step title="Adapt Parameterized and Typed Tests">
Review and update your `TEST_P`, `INSTANTIATE_TEST_SUITE_P`, `TYPED_TEST_SUITE` usages.
</Step>
<Step title="Run Validation Tests and Your Test Suite">
Run the built-in validation tests provided by GoogleTest. Then run your full test suite to detect any new errors.
</Step>
<Step title="Address Failures and Warnings">
Fix issues found in above runs, focusing on test isolation, assertion usage, and environment setup.
</Step>
<Step title="Leverage New Features">
Consider integrating advanced assertion macros, event listeners for custom reporting, and enhanced mocking techniques.
</Step>
</Steps>

---

## 7. Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — learn the basics of test writing.
- [Testing Reference](https://google.github.io/googletest/reference/testing.html) — detailed API specs.
- [Mocking Guides (Mocking for Dummies, Cookbook)](https://google.github.io/googletest/gmock_for_dummies.html) — start and advance your mocking skills.
- [Supported Platforms](https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md) — check platform and compiler compatibility.
- [Build Instructions (CMake)](https://github.com/google/googletest/tree/main/googletest) — for building and integration.
- [Breaking Changes & Migrations](../breaking-changes-migrations/breaking-changes.md) — detailed migration guidance.

For further help and troubleshooting, consult the [Troubleshooting Common Issues](/getting-started/troubleshooting-validation/common-issues) documentation.

---

By following this upgrade guide, you will ensure a smooth transition to the latest GoogleTest and GoogleMock versions with minimal disruption while unlocking powerful new testing capabilities and improvements.