---
title: "Upgrade & Migration Guides"
description: "Step users through the recommended process for upgrading between major versions. Highlight required changes in test code, configuration files, and build integration, and reference domain-specific terminology or updated APIs."
---

# Upgrade & Migration Guides

This guide walks you through the recommended process for upgrading your projects between major versions of GoogleTest and GoogleMock. It focuses specifically on changes that affect your test code, configuration files, and build integration, highlighting updates to APIs and terminology that require your attention.

---

## 1. Understanding the Upgrade Necessity

Upgrading between major versions often introduces backward-incompatible changes that improve testing capabilities or enforce better practices. These changes can affect your mocking macros, test setup, and build configuration. This guide ensures you tackle these adjustments efficiently to preserve existing test coverage and take advantage of new features.


## 2. Migration Workflow

Follow this step-by-step workflow to upgrade your GoogleTest and GoogleMock usage smoothly:

<Steps>
<Step title="Review Release Notes for the Target Version">
Familiarize yourself with the official release notes and breaking changes in the new major version. Pay special attention to any changes in mock macros, new language standard requirements (e.g., C++17), and supported platforms.
</Step>
<Step title="Update Build Configuration">
Adjust your build system to meet new requirements:

- Set the C++ standard to C++17 (or higher) if not already.
- Ensure your build scripts link against the correct GoogleTest and GoogleMock libraries matching the new version.
- Update any pkg-config or CMake configuration files accordingly.
- If using CMake, adjust options such as `gtest_force_shared_crt` to resolve runtime linking issues.
</Step>
<Step title="Refactor Test Code to Use Updated Mocking APIs">
GoogleMock has modernized its mocking macros and APIs. Key changes:

- Migrate old-style `MOCK_METHODn` macros to the new generic `MOCK_METHOD` macro for cleaner and more consistent mock method declarations.
- Use updated qualifiers `(const, override)`, `(noexcept)`, or `Calltype(...)` as per your method signatures.
- Adjust for stricter mock behavior policies, adapting usage of `NiceMock`, `StrictMock`, and `NaggyMock` wrappers.
</Step>
<Step title="Update Test Initialization">
Replace any deprecated initialization functions:

- Replace `testing::InitGoogleTest()` and `testing::InitGoogleMock()` calls with `testing::InitGoogleMock()` only, which now also initializes GoogleTest.
- Ensure your test binaries properly call this initialization in `main()` or embedded main functions (e.g., in CMake's gmock_main).
</Step>
<Step title="Run and Verify Tests">
Build and run your tests to verify compliance. Address any compile or runtime errors arising from API changes, macro renames, or stricter type enforcement.
</Step>
</Steps>

---

## 3. Key Changes to Note

### 3.1 C++17 Requirement

Starting from version 1.17.0, GoogleTest and GoogleMock require an environment supporting at least C++17. Ensure your compiler and build flags conform:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### 3.2 MOCK_METHOD Macro Modernization

The old-style `MOCK_METHODn` macros are deprecated. You must migrate to the generic `MOCK_METHOD` macro for defining mocks:

**Old style:**
```cpp
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD2(Bar, int(int, int));
```

**New style:**
```cpp
MOCK_METHOD(bool, Foo, (int));
MOCK_METHOD(int, Bar, (int, int), (const));
```

This change improves readability, supports qualifiers, and resolves parsing issues.

### 3.3 Test Initialization

GoogleMock encapsulates GoogleTest initialization. Your test program's main function should call only:

```cpp
testing::InitGoogleMock(&argc, argv);
```

Previously, you might have called `testing::InitGoogleTest()` and `testing::InitGoogleMock()` separately, which is no longer necessary.

### 3.4 Build Integration

- If using CMake, update your `FetchContent` or `find_package` to target the new version tag or commit sha.
- Update linkage to use new targets such as `GTest::gmock_main` or `GTest::gmock` accordingly.
- Adjust `gtest_force_shared_crt` as needed to avoid linking mismatches on MSVC.

### 3.5 Mock Strictness and Behavior

The default behavior of mocks regarding uninteresting calls has changed to improve test robustness and reduce false negatives. When upgrading:

- Review your use of `NiceMock`, `StrictMock`, or default mocks.
- Adjust your test expectations if you encounter new warnings or failures relating to unexpected or uninteresting calls.

---

## 4. Example Migration: MOCK_METHOD

Consider a mock class before upgrading:

```cpp
class MockFoo {
 public:
  MOCK_METHOD0(DoSomething, void());
  MOCK_CONST_METHOD1(GetValue, int(int x));
};
```

After migration to the new macro syntax:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, DoSomething, ());
  MOCK_METHOD(int, GetValue, (int x), (const));
};
```

---

## 5. Troubleshooting Common Upgrade Issues

### 5.1 Compile Errors Related to MOCK_METHOD

**Symptom:** Errors related to `MOCK_METHOD` undefined or mismatched macro expansion.

**Solution:** Confirm your test files include the updated mock headers and that your build is using the upgraded GoogleTest version.

### 5.2 Linking Errors on MSVC Related to Runtime Library

**Symptom:** Linking errors like `mismatch detected for 'RuntimeLibrary'`.

**Solution:** Set `-Dgtest_force_shared_crt=ON` in your CMake configuration to unify runtime linkage between your test project and GoogleTest.

### 5.3 Unexpected Test Failures Due to Strict Mock Behavior

**Symptom:** Tests fail on uninteresting mock calls after upgrading.

**Solution:** Review your mock usage; wrap mocks with `NiceMock` if you want to suppress warnings, or fix your expectations to anticipate these calls.

---

## 6. References and Further Reading

- [GoogleTest v1.17.0 Release Notes](https://github.com/google/googletest/releases/tag/v1.17.0)
- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [MOCK_METHOD Macro Reference](https://google.github.io/googletest/reference/mocking.html#mock_method)
- [Build Integration Guide](https://google.github.io/googletest/build_integration.html)
- [Mock Strictness and Behavior Guide](https://google.github.io/googletest/mock_strictness_and_behavior.html)

---

## 7. Summary

Upgrading between major versions of GoogleTest and GoogleMock requires attentiveness to API modernizations, notably the `MOCK_METHOD` macro refinements, the mandatory C++17 standard, and revised mock object behavior defaults. Adjusting your build environment and ensuring proper test initialization help maintain stability while benefitting from the latest enhancements.

Ensure you test thoroughly and review warnings or failures tied to mocks for a seamless transition.

---

## 8. Contact and Support

For help during your upgrade:
- Check the [FAQ and Troubleshooting](https://github.com/google/googletest/tree/main/docs/faq)
- Engage with the community via issues on the [GoogleTest GitHub repository](https://github.com/google/googletest)
- Review other guides such as the Mocking API Reference and the gMock Cookbook for deeper understanding.

---

*Happy upgrading and testing!*  