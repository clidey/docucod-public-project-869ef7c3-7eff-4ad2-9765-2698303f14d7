---
title: "Upgrade & Migration Guides"
description: "Actionable, step-by-step instructions and recommendations for migrating projects between major versions. Covers code updates, configuration changes, and outlines new dependencies (for example, the coming Abseil dependency)."
---

# Upgrade & Migration Guides

GoogleMock evolves continuously, introducing improvements and occasionally making breaking changes to enhance testing reliability, usability, and maintainability. This guide equips you with actionable, step-by-step instructions and practical recommendations to migrate your test projects smoothly between major GoogleMock versions.

---

## 1. Preparing for Migration

Before upgrading to a newer major version of GoogleMock, thoroughly review the release notes and breaking changes documentation. Understand which deprecated features have been removed and which new dependencies or compiler requirements (such as Abseil or C++17 enforcement) are introduced.

### Key Steps

- **Audit Existing Test Code:** Identify usages of deprecated mocking macros or behaviors.
- **Backup Your Codebase:** Always keep a backup or maintain your code under version control to support rollback if needed.
- **Update Build Configurations:** Ensure your build environment supports required compiler versions and flags, for example, C++17, and integrate new dependencies like Abseil when specified.

<Tip>
Integrate GoogleMock via supported build systems such as CMake or Bazel and use provided installation targets (`gmock`, `gmock_main`) to ensure compatibility.
</Tip>

## 2. Updating Mock Declarations and Macros

Recent versions standardize and modernize mocking macros. The old `MOCK_METHODn` and related macros are superseded by the unified `MOCK_METHOD` macro, which improves readability and flexibility.

### Migration Actions

- Replace all `MOCK_METHOD0`, `MOCK_CONST_METHODn`, `MOCK_METHODn`, and other legacy macros with `MOCK_METHOD`.

Example migration:

```cpp
// Deprecated
MOCK_CONST_METHOD1(Foo, bool(int));

// Modern
MOCK_METHOD(bool, Foo, (int), (const, override));
```

- When mocking template methods or methods with qualifiers such as `const`, `override`, or `noexcept`, use the fourth macro parameter to specify these.
- Be mindful of argument types requiring parentheses due to commas (e.g., STL containers).

<Tip>
Using type aliases or wrapping argument types in parentheses ensures `MOCK_METHOD` parses arguments with commas correctly.
</Tip>

## 3. Handling Strictness and Uninteresting Calls

GoogleMock provides three strictness wrappers to control warnings and failures on uninteresting calls: `NiceMock`, `NaggyMock`, and `StrictMock`.

### Migrating Strictness Controls

- By default, mocks behave like `NaggyMock` (warn on uninteresting calls).
- To suppress warnings on uninteresting calls, wrap mocks in `NiceMock<T>`.
- To make uninteresting calls cause failures, wrap mocks in `StrictMock<T>`.

Example:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
```

Ensure that your mocks and expectations are adjusted accordingly to prevent unwanted warnings or test failures after migration.

## 4. Revising Expectation and Action Syntax

Expectations and actions have been refined for better expressiveness and control.

### Notable Updates

- Use `EXPECT_CALL` and `ON_CALL` macros with consistent matcher specifications.
- Take advantage of new clauses like `.RetiresOnSaturation()`, `.With()`, `.After()`, and `.InSequence()` for precise control over call order, cardinality, and default actions.
- For default behaviors on mocks, replace deprecated patterns with appropriate `ON_CALL(...).WillByDefault(...)` patterns.

### Example

```cpp
EXPECT_CALL(mock, Foo(_))
    .Times(2)
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .RetiresOnSaturation();

ON_CALL(mock, Foo(_))
    .WillByDefault(Return(0));
```

## 5. Updating Build and Configuration Setup

Newer GoogleMock versions may enforce stricter C++ standards or require new dependencies.

### Updates to Build Files

- Use the updated CMake support files located under `googletest/cmake/`, such as `internal_utils.cmake`.
- Ensure that your compiler uses C++17 or newer as required.
- Adjust your build scripts to account for new flag definitions and threading libraries.
- Link your tests against the correct GoogleMock libraries, e.g., `gmock_main` if you rely on the default main.

<Tip>
The build files internally adjust compiler flags (such as warnings, exception settings) to optimize GoogleMock compilation and should be included as recommended.
</Tip>

## 6. Refactoring Custom Actions and Matchers

If you maintain custom matchers or actions, verify compatibility with the latest GoogleMock APIs.

### Recommendations

- Prefer C++11+ lambdas or `ACTION`/`MATCHER` macros over legacy callback styles.
- Use polymorphic matcher interfaces when possible for flexibility.
- Avoid internal dependencies on deprecated macros or internal namespaces.

## 7. Testing Migration Success

After making code and build changes:

- Run the full test suite to identify failed tests due to API or behavioral changes.
- Use the `--gmock_verbose=info` flag when running tests to get detailed insights into mock call matches and expectation failures.
- Adjust your mocks and expectations as needed, leveraging new features to simplify tests where possible.

<Warning>
Gradual migration is recommended. Avoid bulk replacements without testing to reduce disruption.
</Warning>

## 8. Deprecations and Removal Notices

Review the breaking changes list for features deprecated or removed in recent versions, such as:

- Legacy `MOCK_METHODn` macros
- Former default behaviors for uninteresting calls
- Support for pre-C++17 compilers

Adjust your code accordingly to prevent build failures and runtime issues.

---

## Additional Resources

- [GoogleMock Breaking Changes](https://github.com/google/googletest/blob/main/googlemock/CHANGELOG.md#breaking-changes)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Strictness and Nice Mocks Guide](https://google.github.io/googletest/guides/mocking-scenarios/strictness-and-nice-mocks.html)
- [GoogleMock Repository on GitHub](https://github.com/google/googletest)

---

By following this migration guide, you will ensure your test projects stay reliable, maintainable, and ready to leverage the latest capabilities of GoogleMock. Always perform incremental upgrades and validate tests early and often to minimize disruptions.
