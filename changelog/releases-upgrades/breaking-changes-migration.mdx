---
title: "Breaking Changes & Migration Steps"
description: "Details all backwards-incompatible changes, deprecated APIs, and removal notices for each release. Includes practical migration advice and code adaptation tips, ensuring users' test suites remain functional, stable, and current throughout upgrades."
---

# Breaking Changes & Migration Steps

This page delivers a focused and practical guide to all backwards-incompatible changes, deprecated APIs, and removal notices in GoogleTest's mocking framework (GoogleMock). It is designed to ensure your test suites remain functional, stable, and current throughout product upgrades by providing detailed migration advice and code adaptation tips.

---

## Understanding Breaking Changes

Breaking changes refer to API modifications or behavioral shifts that require users to update their test code to maintain compatibility with new versions of GoogleMock. This page helps you: 

- Identify which APIs or features have been deprecated or removed.
- Understand how these changes impact your test code.
- Find clear, actionable migration steps to adapt your tests.


## Migrating Nicely Between Versions

GoogleMock remains committed to minimizing disruption whenever possible. When breaking changes are unavoidable, the product documentation and changelog provide explicit migration instructions and example code to guide you, ensuring a smooth transition.


## The Nice, the Naggy, and the Strict — Default Mock Behavior Changes

### Background

Previously, mock objects created using GoogleMock defaulted to **naggy** behavior — they would print warnings on uninteresting calls (i.e., function calls without an `EXPECT_CALL` specification), but allow such calls.

In recent changes, GoogleMock is moving towards making mocks behave as **nice** by default — suppressing such warnings for uninteresting calls, thereby promoting more maintainable and less noisy test output.

### What This Means for You

- **NaggyMock<T>** and **Mock<T>** are currently equivalent; both generate warnings on uninteresting calls.
- In future releases, `Mock<T>` will behave like `NiceMock<T>`, which suppresses warnings for uninteresting calls.
- **StrictMock<T>** remains unchanged — uninteresting calls are treated as test failures.

### Migration Advice

If your existing tests rely on seeing warnings for all uninteresting calls, you should explicitly switch to `NaggyMock<T>` or retain the current default mock behavior.

For example:

```cpp
using ::testing::NaggyMock;

NaggyMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoSomething());
```

To embrace the new, less noisy default, migrate tests to use `NiceMock<T>` explicitly if you want to suppress warnings on uninteresting calls:

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoSomething());
```


## Changes to `NiceMock`, `NaggyMock`, and `StrictMock`

- These wrappers now "inherit" constructors from their base mock class, allowing instantiation with constructor arguments transparently:

```cpp
NiceMock<MockFoo> nice_mock(5, "hello");
```

- They only impact mock methods defined directly in the mock class using the `MOCK_METHOD` macro. Mock methods inherited from base classes may not be affected due to compiler limitations.

- Mixing wrappers is not supported. For example, `NiceMock<StrictMock<MockFoo>>` is not supported.

- Using `NiceMock`, `NaggyMock`, or `StrictMock` requires that the mock class have a *virtual destructor* to work correctly.


## Deprecated and Removed APIs

This section highlights APIs and usages that have been marked deprecated or removed in recent GoogleMock releases.

### Old-Style `MOCK_METHODn` Macros

The family of `MOCK_METHODn` macros (e.g., `MOCK_METHOD1`, `MOCK_CONST_METHOD2`) have been superseded by the more versatile and expressive `MOCK_METHOD` macro introduced in 2018.

**Migration:** Replace old-style macros with the new `MOCK_METHOD` syntax:

```cpp
// Old
MOCK_METHOD1(Foo, bool(int));

// New
MOCK_METHOD(bool, Foo, (int));
```

#### Notes:
- For const methods, add `(const)` qualifier.
- For methods with multiple specifiers, list all, e.g. `(const, override)`.
- Wrapping type parameters with parentheses is necessary to handle commas properly.

### Uninteresting Calls Warning Behavior

Warnings on uninteresting calls can be suppressed by adopting `NiceMock<T>` or by explicitly adding expectations with `.Times(AnyNumber())` for such methods.

**Do not** suppress warnings by adding empty `EXPECT_CALL` expectations, as this makes tests brittle and verbose.

### `EXPECT_CALL` Clause Ordering Changes

GoogleMock enforces a strict order of modifier clauses in `EXPECT_CALL` and `ON_CALL` macros. Misordering clauses such as `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` now results in compile or runtime errors.

**Migration:** Refactor calls to follow the prescribed order:

```cpp
EXPECT_CALL(mock, Method(args...))
    .With(matcher)          // Optional, must be first clause
    .Times(cardinality)     // Optional
    .InSequence(seq1, seq2) // Optional
    .After(expectations...) // Optional
    .WillOnce(action)       // Optional
    .WillRepeatedly(action) // Optional
    .RetiresOnSaturation(); // Optional, must be last
```

### `ON_CALL` Usage

Every `ON_CALL` statement requires exactly one `.WillByDefault()` action clause. Omitting it or adding multiple `.WillByDefault()` clauses is invalid.


## Migration Step-by-Step Guide

Follow these steps for a smooth upgrade:

<Steps>
<Step title="Audit Your Tests for Mock Objects">
Review your tests to identify usages of mock objects, focusing on:
- Whether you create mocks as `Mock<T>`, `NaggyMock<T>`, `NiceMock<T>`, or `StrictMock<T>`
- Calls on mock methods lacking explicit `EXPECT_CALL`
</Step>
<Step title="Adjust Default Mock Behavior">
If you rely on warnings for uninteresting calls, prepend your mocks with `NaggyMock<T>`. Otherwise, for a quieter test log, switch to `NiceMock<T>`. Always use `StrictMock<T>` if you want uninteresting calls to fail.
</Step>
<Step title="Replace Old `MOCK_METHODn` Macros">
Modernize mock class definitions using the new `MOCK_METHOD` macro syntax for better clarity and extensibility.
</Step>
<Step title="Reorder `EXPECT_CALL` and `ON_CALL` Clauses">
Ensure your expectations use modifier clauses in the correct order as per GoogleMock specification.
</Step>
<Step title="Verify Virtual Destructors for Mocks">
Confirm that mock classes have virtual destructors; otherwise, `NiceMock`, `NaggyMock`, and `StrictMock` might misbehave.
</Step>
<Step title="Run Tests with `--gmock_verbose=info` for Debugging">
Use increased verbosity to trace mock calls and verify expectations during migration.
</Step>
<Step title="Use `Mock::VerifyAndClearExpectations` Where Needed">
In complex tests, explicitly verify and clear expectations to avoid false positives in leak detection or order-sensitive tests.
</Step>
</Steps>


## Practical Code Examples

### Switching to NiceMock

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;

TEST(MyTest, UsesNiceMock) {
  NiceMock<MockFoo> mock_foo;
  EXPECT_CALL(mock_foo, DoSomething());
  ...
}
```

### Migrating from Old `MOCK_METHODn`

```cpp
// Old style
class MockFoo : public Foo {
 public:
  MOCK_METHOD1(Bar, bool(int));
};

// New style
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Bar, (int), (override));
};
```

### Correct Clause Ordering in EXPECT_CALL

```cpp
EXPECT_CALL(mock, SomeMethod(_))
    .With(SomeMatcher())
    .Times(2)
    .InSequence(seq)
    .After(other_expectation)
    .WillOnce(Return(true))
    .WillRepeatedly(Return(false))
    .RetiresOnSaturation();
```


## Troubleshooting and Common Pitfalls

- **Uninteresting Call Warnings Still Appear?**
  Make sure you are constructing mock objects using `NiceMock<T>` instead of raw `Mock<T>` or `NaggyMock<T>`.

- **Compiling Errors on MOCK_METHOD with Comma in Type?**
  Parenthesize return or argument types containing commas, or use `using` type aliases.

- **Unexpected Behavior with Destructor-less Mocks?**
  Add a virtual destructor to all mock classes where possible.

- **Multiple `WillRepeatedly` or Missing `WillByDefault` Errors?**
  Follow clause ordering strictly and ensure each `ON_CALL` has exactly one `.WillByDefault()`.


## Additional References

- [gMock Cookbook: The Nice, the Strict, and the Naggy](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy)
- [Mocking Reference: EXPECT_CALL](../api_reference/mocking_api/expectations_and_behaviors.md#EXPECT_CALL)
- [Migrating to `MOCK_METHOD`](https://google.github.io/googletest/gmock_cheat_sheet.html#mock-method)
- [Core Concepts & Key Terminology](../overview/architecture-core-concepts/core-concepts-terminology.md)


## Summary

This page helps you identify breaking changes in GoogleMock and smoothly migrate your tests. It chiefly addresses changes to default mock object behaviors (switching from naggy to nice), deprecated mocking macros, and clause ordering rules in expectations. Armed with practical examples and actionable guidance, you can keep your test suites stable and warning-free during upgrades.

---

For full context, see related pages on [API Deprecations & Removal Notices](/changelog/maintenance-deprecation/deprecations-notices), [Feature Highlights](/changelog/releases-upgrades/feature-highlights), and the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

---

*End of Breaking Changes & Migration Steps*