---
title: "How to Upgrade"
description: "Step-by-step instructions for updating GoogleTest and GoogleMock within your project, applicable to various build systems. Covers compatibility requirements (e.g., C++ standard), preparation best practices, and troubleshooting common upgrade pitfalls."
---

# How to Upgrade GoogleTest and GoogleMock

This guide provides clear, step-by-step instructions to help you successfully update GoogleTest and GoogleMock within your C++ projects. It is relevant for projects using various build systems such as CMake and Bazel and covers compatibility requirements, preparation best practices, and troubleshooting common pitfalls.

---

## 1. Overview of the Upgrade Process

Upgrading GoogleTest and GoogleMock ensures you have access to the latest features, improvements, and bug fixes. This guide will help you navigate the typical workflow:

- Preparing your environment and verifying compatibility.
- Integrating the updated framework into your chosen build system.
- Addressing common issues encountered during upgrades.
- Best practices to ensure smooth migration.


## 2. Verify Compatibility Requirements

Before upgrading, confirm your environment meets GoogleTest and GoogleMock's platform and compiler requirements:

- **C++ Standard:** Requires at least C++11 support, with many new features depending on C++17 or newer.
- **Compiler Versions:** Ensure your compiler version supports necessary standards. Consult the [System Requirements & Supported Platforms](https://github.com/google/googletest/blob/main/docs/prerequisites.md) documentation for detailed compiler and platform information.
- **Build Tooling:** Compatible with CMake 3.0+ and Bazel.


## 3. Preparation and Backup

A smooth upgrade starts with preparation:

- **Review your current integration:** Understand how GoogleTest and GoogleMock are included in your project (source tree, git submodules, FetchContent, etc.). 
- **Backup existing configuration and test code:** To avoid regressions and loss during upgrade trials.
- **Check test coverage:** Verify existing tests pass on your current version to establish a baseline.


## 4. Upgrade Instructions for Common Build Systems

### 4.1 CMake-Based Projects

GoogleTest and GoogleMock can be incorporated in multiple ways via CMake. For upgrading:

- **Using FetchContent or ExternalProject:**
  - Update the repository URL or version tag to point to the desired release/version.
  - Example snippet to include latest main branch:

  ```cmake
  include(FetchContent)

  FetchContent_Declare(
    googletest
    GIT_REPOSITORY https://github.com/google/googletest.git
    GIT_TAG main  # or specify a release tag
  )

  FetchContent_MakeAvailable(googletest)
  ```

- **Updating Submodules:**
  - `git submodule update --remote googletest`
  - Rebuild your project to link the updated library.

- **Building and Linking:**
  - Confirm you link against `gtest` and `gmock` libraries properly.
  - Re-generate your build files and rebuild.


### 4.2 Bazel Workspaces

- Update the version of googletest in your Bazel workspace's `MODULE.bazel` or external dependencies to the desired release.
- For example, adjust the version reference to the updated tag from the https://github.com/google/googletest Bazel central registry.
- Rebuild your tests and verify.


## 5. Post-Upgrade Validation

- **Run all tests:** Ensure your entire unit test and mock test suite passes.
- **Check for deprecation or breaking changes:** Review the [Breaking Changes & Migration Steps](https://google.github.io/googletest/changelog/releases-upgrades/breaking-changes-migration.html) if upgrading across major versions.


## 6. Troubleshooting Common Upgrade Pitfalls

Some typical issues users encounter after upgrading and their solutions include:

- **Compilation errors due to API changes:**
  - Review updated mock method macro usage, e.g., transition from old-style `MOCK_METHODn` macros to the newer, more flexible `MOCK_METHOD` macro.
  - Check for changed expectations clause order or new required qualifiers.

- **Unhandled move-only types in mocks:**
  - Ensure the project is using a recent enough GoogleMock that supports move-only types natively.

- **Build system linking problems:**
  - Verify libraries `gtest`, `gtest_main`, `gmock`, and `gmock_main` are properly linked.
  - Ensure any caching or build artifacts are fully cleaned.

- **Unexpected warnings or test failures due to changed default behaviors:**
  - Consider using `NiceMock` or `StrictMock` wrappers to explicitly control uninteresting call warning behaviors.
  - Adjust `ON_CALL` and `EXPECT_CALL` as per updated semantics.


## 7. Best Practices During Upgrade

- **Use `ON_CALL` for default behaviors and `EXPECT_CALL` sparingly:** Minimize test brittleness.
- **Control mock strictness explicitly:** Use `NiceMock`, `NaggyMock`, or `StrictMock` according to your test needs.
- **Put mock class definitions in a stable location:** To simplify maintenance and reduce upgrade impact.
- **Separate mock creation and expectation setup:** Keep test code readable and maintainable.


## 8. Additional Resources and References

For a comprehensive understanding and smooth upgrade experience, consult the following documentation:

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Full details on macros, classes, and mocking best practices.
- [Breaking Changes & Migration Steps](https://google.github.io/googletest/changelog/releases-upgrades/breaking-changes-migration.html): Details about backward-incompatible changes and advice to migrate.
- [Getting Started with GoogleMock](https://google.github.io/googletest/gmock_for_dummies.html): A friendly introduction to mocking.
- [GoogleTest and GoogleMock Build System Integration](https://google.github.io/googletest/guides/real-world-integration/build-system-integration.html): Build configuration and integration tips.


<Tip>
Always ensure that your mock classes declare virtual destructors, as required by GoogleMock to avoid subtle runtime errors during upgrades.
</Tip>

<Tip>
When facing unexpected test failures post-upgrade, run your tests with verbosity flag `--gmock_verbose=info` to get detailed logs of mock calls and expectations for better diagnosis.
</Tip>


## 9. Upgrade Summary Checklist

<Steps>
<Step title="Verify Environment Compatibility">
Confirm compiler version and C++ standard compliance.
</Step>
<Step title="Prepare Backup and Baseline">
Backup configuration and run existing tests.
</Step>
<Step title="Update Framework in Build System">
Adjust CMake, Bazel, or other build integration to use updated GoogleTest/GoogleMock.
</Step>
<Step title="Rebuild and Run Tests">
Clean build and verify test suite passes fully.
</Step>
<Step title="Address New Warnings or Errors">
Check code and mocks for API or semantic changes; adapt expectations and actions.
</Step>
<Step title="Read Official Migration Guides">
Follow detailed migration steps if upgrading across major versions.
</Step>
</Steps>


## 10. Common FAQs About Upgrading

- **Q: Why do I get warnings about uninteresting calls after upgrading?**
  - A: GoogleMockâ€™s default behavior includes warnings for uninteresting calls. Use `NiceMock` to suppress or add explicit `EXPECT_CALL(...).Times(AnyNumber())` to handle those methods.

- **Q: I see failures due to method call count strictness after upgrade. What to do?**
  - A: Review your expectation cardinalities and possibly use `.RetiresOnSaturation()` or sequences to handle call order and limits.

- **Q: Some mock methods don't compile with newer versions?**
  - A: Confirm you transitioned from `MOCK_METHODn` to the standardized `MOCK_METHOD` macro. Use parentheses for complex types to avoid macro parsing issues.


# Additional Example: Mock Method with Updated Syntax

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int Bar(int x) = 0;
};

class MockFoo : public Foo {
 public:
  // Using the newer MOCK_METHOD macro with override specifier
  MOCK_METHOD(int, Bar, (int x), (override));
};
```


---

For more detailed information on the internals and practical examples of GoogleMock's spec builder syntax and its usage, see the [GoogleMock Spec Builders Test Source](https://github.com/google/googletest/blob/main/googlemock/src/gmock-spec-builders.cc) and [gMock FAQ](https://google.github.io/googletest/gmock_faq.html).


---

## Summary

This page has covered how to successfully upgrade your GoogleTest and GoogleMock dependencies within your project:

- Confirm compatibility and environment readiness.
- Prepare your project for upgrade safely.
- Update your build system integration.
- Validate post-upgrade behavior thoroughly.
- Address common pitfalls with practical solutions.
- Follow modern mocking best practices.

---