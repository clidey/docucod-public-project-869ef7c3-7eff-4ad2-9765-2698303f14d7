---
title: "New Features and Improvements"
description: "Lists new capabilities, additions to the API surface, better defaults, and usability enhancements included in each release. Highlights how these features streamline or extend practical usage of GoogleTest and GoogleMock."
---

# New Features and Improvements

This page details the incremental capabilities, API surface extensions, improved defaults, and enhanced usability included in each release of GoogleTest and GoogleMock. It serves as a living record of how these features help streamline test writing, mocking, and expectation management to elevate your unit testing experience.

---

## Overview of Feature Progression

GoogleMock empowers C++ developers to create flexible and expressive mock classes. Over recent releases, the framework has refined its core mock specification syntax, improved the safety and clarity of expectation handling, and optimized the default behavior mechanisms to support common real-world testing scenarios.

This page focuses exclusively on the features and improvements in the context of:
- Defining default behaviors and expectations via `ON_CALL` and `EXPECT_CALL`.
- Use of matchers, actions, and cardinalities to finely control mock method invocations.
- Managing invocation ordering and expectation lifetimes with sequences and partial orders.
- Handling uninteresting, unexpected, and excessive calls with configurable warning and failure modes.

Read on to understand how these changes translate to enhanced user workflows and better test reliability.

---

## 1. Enhanced Spec Builder Syntax: `ON_CALL()` and `EXPECT_CALL()`

GoogleMockâ€™s spec builders have been enhanced to ensure clarity, usability, and correctness when declaring mock method behavior and expectations.

- **Strict Clause Order Enforcement:**
  Clauses such as `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` must now appear in a proper, verified sequence within an `EXPECT_CALL()` or `ON_CALL()` statement. Misplaced or duplicated clauses generate clear diagnostic messages to guide author corrections.

- **Single-Variable Clause Constraints:**
  Certain specifications like `.With()` and `.Times()` are limited to a single occurrence per call to prevent ambiguous or conflicting expectations.

- **Flexible Overload Handling:**
  Support for methods whose names may be macros (e.g., Windows API redefinitions) has been improved, ensuring that mock declarations and call specifications compile and operate correctly even under these conditions.

- **Evaluation Guarantees:**
  Both `ON_CALL` and `EXPECT_CALL` guarantee that their argument expressions are evaluated exactly once, supporting safe side effects or expensive computations.

- **Parameterless Variants:**
  Methods without explicit parameter matchers can be specified in `EXPECT_CALL` or `ON_CALL` when the method is not overloaded, simplifying tests that only care about call count or ordering.

---

## 2. Default Behavior and Expectation Semantics

GoogleMock's handling of mock method calls without explicit expectations or default behaviors has been refined:

- **Built-In Default Actions:**
  When no matching `ON_CALL` default action is specified for a call, GoogleMock returns type-appropriate default values (e.g., zero-initialized, false, or void return) seamlessly.

- **Precedence of Matching Expectations:**
  Multiple matching `EXPECT_CALL`s now resolve predictably by always invoking the most recently declared matching expectation, allowing default-like expectations to be overridden by more specific ones later in the test.

- **Cardinality Inference:**
  When no `Times()` clause is specified, the expectation cardinality is intelligently inferred based on the presence of `.WillOnce()` and `.WillRepeatedly()` clauses:
  - No `WillOnce` or `WillRepeatedly`: cardinality 1.
  - N `WillOnce` clauses, no `WillRepeatedly`: cardinality exactly N.
  - N `WillOnce` clauses and one `WillRepeatedly`: cardinality at least N.

- **Expectations Stickiness and Retirement:**
  Expectations remain active after saturation by default, requiring explicit use of `.RetiresOnSaturation()` to automatically deactivate an expectation after its cardinality is met. This reduces brittle tests while still supporting precise call control.

---

## 3. Improved Call Ordering and Partial Sequencing

GoogleMock provides powerful tools to express relative ordering of expected calls:

- **Sequences and `InSequence` Objects:**
  Expectations declared inside an `InSequence` scope are automatically chained in order, enforcing strict call sequence matching.

- **Partial Order with `InSequence` Clause:**
  Expectations can be assigned simultaneously to multiple sequences (via `.InSequence()` clauses with multiple `Sequence` objects), defining a directed acyclic graph (DAG) of call ordering. This enables flexible constraints, e.g., "call A before B and C, but B and C in any order."

- **Explicit Partial Ordering with `.After()`:**
  The `.After()` clause allows expectations to declare prerequisite expectations or sets of expectations, ensuring they only match after the specified expectations have been satisfied.

- **Robust Unsatisfied Pre-requisite Detection:**
  When calls occur out of order, failure messages identify and explain which prerequisite expectations remain unsatisfied, aiding rapid diagnosis.

---

## 4. Handling Uninteresting, Unexpected, and Excessive Calls

GoogleMock's runtime enforcement and user feedback have been enhanced:

- **Configurable Uninteresting Call Behavior:**
  Using internal flags and wrapper classes (`NiceMock`, `NaggyMock`, `StrictMock`), users can control the handling of uninteresting calls (calls to mock methods with no matching expectations):
  - **NiceMock:** suppresses warnings.
  - **NaggyMock:** (default) emits warnings.
  - **StrictMock:** treats as test failures.

- **Detailed Diagnostic Messages:**
  - Calls that match no expectations produce rich descriptions of the call, the expectations tried, and their match failures.
  - Excessive calls beyond expectation cardinalities elicit explicit errors with call and expectation details.

- **Exact Printout of Invocation Details:**
  Shows function arguments, return values (if any), and stack traces (configurable via `--gmock_verbose` flag), assisting in pinpointing unexpected invocation sources.

- **Warnings and Errors with Verbosity Control:**
  Users can select verbosity levels (`info`, `warning`, `error`) to regulate the output of mock call diagnostics, balancing noise reduction with useful insights during development.

- **Safe Handling of Void and Non-void Methods:**
  Failure messages and default action fallbacks correctly handle void and non-void mock methods, supplying expected and default return values as appropriate.

---

## 5. Extended Support for Complex Mock Scenarios

- **Support for Incomplete and Non-default Constructible Types:**
  Mock methods can accept parameters of incomplete types (with an associated printer), and support return of non-default-constructible types requiring explicit action semantics.

- **Mock Method Name Macro Expansion:**
  Mocking works correctly even when method names are macros (common with Windows API), avoiding compilation and runtime errors.

- **Safe Deletion Inside Actions:**
  Supports actions that delete their owning mock object during invocation without deadlocking or crashing.

- **Thread-Safe Expectation Verification and Clearing:**
  Allows verifying and clearing expectations of mock objects multiple times, including const mocks, without affecting unrelated mock instances.

- **Support for Move-Only Types:**
  You can mock methods accepting or returning move-only types (like `std::unique_ptr`), setting expectations, default actions, and custom actions safely.

---

## 6. Practical Tips and Best Practices

- Use `ON_CALL()` to specify default behavior without enforcing call expectations. Reserve `EXPECT_CALL()` for when you want verification of call counts and order.
- Remember that the last matching `EXPECT_CALL` overrides earlier ones, enabling incremental refinement of mock behavior.
- For ordered sequences, wrap multiple expectations in an `InSequence` scope or explicitly specify `.InSequence(...)` clauses.
- Use `.RetiresOnSaturation()` to avoid unexpected call errors when an expectation's invocation quota is exhausted.
- Leverage the verbosity flag `--gmock_verbose` to gain detailed traces when diagnosing mock call mismatches.
- Use `Mock::VerifyAndClearExpectations()` or `Mock::VerifyAndClear()` to explicitly check mock expectation satisfaction and clean mocks early if needed.
- Apply `Mock::AllowLeak(mock_obj)` judiciously to avoid false-positive leaked mock object errors.

---

## References and Further Reading

- [Mocking API: Expectations, Actions, and Cardinalities](/api-reference/mocking-api/setting-expectations-actions) - Detailed API for setting and verifying expectations.
- [Mock Object and Method Creation](/api-reference/mocking-api/mock-creation) - Guidance on defining mocks.
- [Mock Object Behavior Modes](/api-reference/mocking-api/mock-behavior-modes) - Controlling uninteresting call behaviors.
- [gMock for Dummies](docs/gmock_for_dummies.md) - Beginner-friendly guide to mocking.
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) - Quick reference to mocking constructs.
- [gMock Cookbook](docs/gmock_cook_book.md) - Practical recipes for using gMock.
- [Legacy gMock FAQ](docs/gmock_faq.md) - Answers to common historical issues.

---

This page complements the [Full Version History](/changelog/release-highlights/full-version-history) and [Recent Releases](/changelog/release-highlights/recent-releases) pages for tracking feature evolution and upgrade guidance.

---

_For complete experience, consult the adjacent API reference and core testing workflow guides to master test writing and mock usage._