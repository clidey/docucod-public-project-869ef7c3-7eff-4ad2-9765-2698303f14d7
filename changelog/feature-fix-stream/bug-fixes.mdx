---
title: "Bug Fixes & Patches"
description: "Documents important bug fixes, stability improvements, and minor patches. Users can assess which fixes are relevant to their use cases and determine if an immediate upgrade is warranted."
---

# Bug Fixes & Patches

This page details the recent bug fixes, stability improvements, and minor patches introduced to GoogleMock and GoogleTest. It serves as a resource for users to quickly assess whether any update impacts their testing environment, understand the nature of the changes, and decide if an immediate upgrade or patch is necessary.

---

## Overview of Bug Fixes and Stability Improvements

Over the latest releases, several important fixes have been made to ensure that GoogleMock behaves reliably, reports failures clearly, and handles edge cases gracefully. These patches address issues in mock object behavior, warning/report handling, constructor support, and usage with move-only types.

The improvements prioritize maintaining backward compatibility while enhancing user experience by reducing false warnings, clarifying failure messages, and supporting realistic usage patterns more robustly.

## Key Fixes and Enhancements

### 1. Improved Handling of Uninteresting Calls

#### Background
By default, GoogleMock prints a warning when a mock method without an explicit `EXPECT_CALL` is invoked (an "uninteresting call"). This behavior, while helpful for catching forgotten expectations, sometimes creates noise.

#### Recent Fixes
- **NiceMock Usage**: The `NiceMock<T>` wrapper now reliably suppresses these warnings for user-defined mock classes, including mocks with constructors accepting multiple arguments. This reduces spurious output in test logs.

- **Verbose Modes**: The behavior of warnings with different `--gmock_verbose` settings (`info`, `warning`, `error`) has been stabilized and documented, ensuring predictable user feedback.

### 2. Strict and Naggy Mock Behavior Consistency

- `StrictMock<T>` now consistently fails tests when uninteresting calls are detected, including scenarios where the mock object is deleted during the call.

- `NaggyMock<T>`, the default mock behavior, produces warnings without failing and supports users in identifying potential approach errors without disrupting test flow.

### 3. Support for Non-Default Constructible and Move-Only Types

- Fixed issues where `NiceMock`, `NaggyMock`, and `StrictMock` would fail or wouldn't compile when the underlying mock class lacks a default constructor or contains move-only method arguments or return types.

- Added support for mocking classes with complex constructors, including those with 10 or more parameters.

### 4. Robustness in Destructor Behavior

- Added patterns and documented best practices for mocking destructors by introducing explicit mock methods called within the destructor (e.g., `Die()`). This allows users to verify object lifetime and destruction timing using standard EXPECT_CALL mechanisms.

- Verified that destructors of mocks correctly honor the mock strictness modes (Nice, Naggy, Strict) during destruction, even when mock methods are called inside destructors.

### 5. Fixes to Warning and Failure Message Clarity

- Enhanced output messages for unexpected and excessive calls, including the call site, argument mismatch details, and matchers tried.

- Improved diagnostic messages when expectations are violated due to unexpected call order or argument mismatch.

- Clarified warning messages for default actions executed when explicit actions run out.

### 6. Verification and Clearing Enhancements

- Improved `Mock::VerifyAndClearExpectations()` and `Mock::VerifyAndClear()` to work correctly even if some mock methods have no expectations or default actions.

- Enabled safer usage of these functions multiple times in tests, preserving clean verification cycles.

### 7. Multi-Threading and Synchronization Stability

- Ensured mock actions are executed in the calling thread to prevent deadlocks.

- Documented best practices to avoid undefined behavior when setting expectations and running mocks in multithreaded tests.

---

## Practical Tips for Users Based on These Fixes

- Prefer wrapping your mocks with `NiceMock` if you want to suppress warnings about uninteresting calls but still get notified about unexpected calls.

- Use `StrictMock` only when you require all uninteresting calls to be treated as errors.

- If your mocks have non-default constructors, including complex ones, `NiceMock`, `NaggyMock`, and `StrictMock` support them out of the box.

- Mock destructors by adding a dedicated mock method invoked in the destructor and set expectations on that method for better lifecycle verification.

- When testing move-only types or classes returning non-default-constructible objects, use explicit `WillOnce` or lambdas to define the behavior to avoid exceptions or test crashes.

- Control verbosity of GoogleMock messages with the `--gmock_verbose` flag, setting it to `info` during debugging to see detailed call logs, and `warning` or `error` for quieter runs.

- Use `Mock::AllowLeak()` if a mock object is deliberately leaked to prevent spurious failure reports.

- For multi-threaded test scenarios, ensure expectations and default actions are set up before the threads start executing and avoid modifying mocks concurrently.

---

## Illustrative Code Snippets

### Suppressing Warnings Using NiceMock

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo("init_arg");
EXPECT_CALL(mock_foo, ExpectedMethod());
mock_foo.ExpectedMethod();  // No warnings for uninteresting calls
```

### Mock Destructor Test Pattern

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};

// Test
EXPECT_CALL(mock_foo, Die());
// ...
```

### Using Mock with Non-Default Constructor

```cpp
NiceMock<MockBar> mock_bar('a', 'b', "c", "d", 1, 2, "e", "f", true, false);
EXPECT_CALL(mock_bar, SomeMethod());
mock_bar.SomeMethod();
```

---

## Troubleshooting

<AccordionGroup title="Troubleshooting Bug Fixes and Patches">
<Accordion title="Uninteresting call warnings still appear despite using NiceMock">
Verify that mock methods are defined directly in the mock class using `MOCK_METHOD`. Methods inherited from base classes may not be affected by `NiceMock` or `StrictMock` wrappers.
</Accordion>
<Accordion title="Mock methods with move-only return types cause exceptions or crashes">
Always specify explicit actions (e.g., `WillOnce`, `WillRepeatedly`) that return appropriate move-only objects, such as with lambdas returning `std::unique_ptr`s, to avoid default return value issues.
</Accordion>
<Accordion title="Destructor mock method not called or failing unexpectedly">
Ensure your mock class destructor calls the mock method (e.g., `Die()`), and set expectations properly. Avoid nesting `NiceMock` or `StrictMock` within such destructors.
</Accordion>
<Accordion title="Tests fail due to unexpected calls after mock object deletion">
Avoid invoking mock methods after the mock object is deleted. If deletion happens inside an action, ensure `ON_CALL` and expectations account for this to prevent spurious errors.
</Accordion>
</AccordionGroup>

---

## Additional References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): an introductory guide for GoogleMock usage.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): detailed API reference for mocks.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html): quick syntax and recipe guide.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): advanced usage scenarios and recipes.
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html): FAQ including troubleshooting common warnings and errors.
- [Mocking Best Practices and Common Pitfalls](https://google.github.io/googletest/guides/advanced-patterns/mocking-pitfalls-best-practices.html): recommendations to avoid issues when using GoogleMock.

---

For detailed migration and upgrade instructions related to breaking changes, consult the [Breaking Changes](../breaking-migrations/breaking-changes) and [Migration & Upgrade Guides](../breaking-migrations/migration-upgrade) documents.

---

_Last updated: latest stable release_

---