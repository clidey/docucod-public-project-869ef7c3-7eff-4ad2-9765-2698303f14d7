---
title: "New Features & Improvements"
description: "Summarize major new capabilities, enhancements, and extended platform support. Enable users to quickly discover and adopt the latest productivity and reliability improvements in their test suites."
---

# New Features & Improvements

Welcome to the overview of the latest capabilities, enhancements, and expanded platform support in GoogleTest and GoogleMock. This page helps you quickly discover and adopt new productivity and reliability improvements that enhance your testing workflows. Whether you are integrating mocking in C++ tests or improving test suite maintainability, these updates are designed to empower your development process.

---

## Highlights of Recent Additions

### Enhanced Mocking Capabilities in GoogleMock

- **Improved Mock Definitions:** The `MOCK_METHOD` macro continues to provide a clear and concise syntax for defining mock methods, now more robust with support for move-only types like `std::unique_ptr`. This ensures you can mock modern C++ interfaces seamlessly.

- **Flexible Default and Expected Actions:** You can now finely tune mock behaviors with `ON_CALL` (for default actions without expectations) and `EXPECT_CALL` (for setting expectations). The system infers call cardinalities intelligently based on the combination of `WillOnce` and `WillRepeatedly` clauses, reducing boilerplate and enhancing readability.

- **Ordering and Partial Ordering of Calls:** New sequences via `InSequence` and detailed ordering through `After` clauses allow users to impose strict or partial orders on expected calls, perfectly matching complex real-world asynchronous or phased workflows.

- **Improved Uninteresting Calls Control:** Uninteresting calls (calls on methods without explicit expectations) warn you by default but can be suppressed or escalated by wrapping mocks with `NiceMock` and `StrictMock` respectively. This tiered approach gives you control over warning noise and test strictness.

- **Better Diagnostic and Verbosity Controls:** The `--gmock_verbose` flag supports three verbosity levels (`info`, `warning`, `error`) allowing you to control the detail level of mock call reporting, including optional stack traces for deeper debugging.


### Support for Modern C++ Features

- **Move-Only Type Mocking:** GoogleMock now fully supports mocking functions that accept or return move-only types like `std::unique_ptr`. This eliminates old workarounds and lets you write idiomatic mocks for modern C++ APIs.

- **Advanced Matcher and Action Definitions:** The framework has enriched the macro-based and template-based infrastructure for defining custom matchers (`MATCHER`, `MATCHER_P*`) and actions (`ACTION`, `ACTION_P*`, `ACTION_TEMPLATE`), providing expressive tools to capture complex test conditions and behavior.


### Improved Verification and Lifecycle Management

- **Explicit Expectations Verification:** You can verify and clear expectations on a mock object at any time using `Mock::VerifyAndClearExpectations()`. This is useful for long-lived mocks or when lifecycle management is delegated.

- **Expectation Retirement:** The `.RetiresOnSaturation()` clause allows expectations to become inactive as soon as their call count upper bound is reached. This enables flexible handling of multiple calls and fallback behaviors.

- **Mock Leak Detection and Handling:** The flag `--gmock_catch_leaked_mocks` remains an important tool in catching mock-related leaks, and you can specifically allow a mock to leak without warnings using `Mock::AllowLeak()`.


## User Workflows for New Features

### Defining and Using Mocks

1. Define a mock class by inheriting the target interface and declare mock methods with `MOCK_METHOD`. Use qualifier clauses like `(const, override)` as needed.
2. Instantiate mock objects as usual, or wrap them in `NiceMock` or `StrictMock` to control warning behaviors for uninteresting calls.
3. Set default Call behaviors with `ON_CALL`, specifying default replies without requiring call count constraints.
4. Use `EXPECT_CALL` to specify expectations on method calls, defining argument matchers, call frequency (`Times`), call order (`InSequence` or `After`), and actions (`WillOnce`, `WillRepeatedly`).
5. Exercise your code under test. GoogleMock automatically verifies expectations upon mock destruction.
6. Optionally call `Mock::VerifyAndClearExpectations(mock_obj)` to verify and reset expectations early.

### Working with Matchers and Actions

- Use built-in matchers for common needs (`_` for wildcard, `Eq()`, `Gt()`, `NotNull()`, etc.), or write custom matchers using `MATCHER`, `MATCHER_P`, or fully custom matcher classes for complex validation.
- Compose matchers with logical combinators like `AllOf`, `AnyOf`, and use tuple matchers in `.With` clauses to validate multiple arguments as a whole.
- Define custom actions with `ACTION`, `ACTION_P`, or leverage lambdas and functors to specify what happens when mocks are invoked.
- Use utility actions like `Return`, `ReturnRef`, `DoAll`, `SetArgPointee`, or advanced callback invocation with `Invoke` and `InvokeArgument`.

### Managing Call Expectations and Ordering

- Group ordered calls with `InSequence` scoped objects for strict sequences.
- Impose partial ordering using `EXPECT_CALL(...).After(...)` accepting multiple expectations or expectation sets.
- Retire saturated expectations automatically to allow fallback behaviors.

### Handling Move-Only Types

- Mock methods can now natively accept and return move-only types.
- Use lambdas or functors in `WillOnce` and `WillRepeatedly` to generate fresh move-only objects as needed.
- Avoid legacy workarounds requiring wrapper mock methods for move-only arguments.


## Best Practices and Tips

- Prefer `ON_CALL` for default behaviors and `EXPECT_CALL` only when you want to enforce call expectations.
- Use `NiceMock` during early test development to minimize warnings, and consider switching to `StrictMock` when you want stricter validation.
- Utilize sequences and `After` constraints to accurately model call order requirements.
- Employ `Mock::VerifyAndClearExpectations()` when you can't rely on destructor verification, such as in long-running tests or when mocks are owned by external code.
- Write custom matchers and actions to simplify complex argument verification and method behaviors.


## Troubleshooting Common Scenarios

- **Uninteresting Calls Warning:** Use `NiceMock` or explicit `EXPECT_CALL(...).Times(AnyNumber())` on methods to suppress warnings.
- **Unexpected Call Failures:** Ensure all expected calls are declared; use `--gmock_verbose=info` to trace mock call matching.
- **Move-Only Type Return Errors:** Use lambdas to return fresh objects on each call rather than `Return(std::move(...))` which is only valid once.
- **Overly Strict Expectations:** Use `.RetiresOnSaturation()` and sequences to prevent saturated expectations from causing spurious failures.


## Flags and Runtime Controls

| Flag                         | Purpose                                               |
|------------------------------|-------------------------------------------------------|
| `--gmock_verbose=info`       | Prints all mock call details with stack traces.       |
| `--gmock_verbose=warning`    | Prints warnings and errors (default).                  |
| `--gmock_verbose=error`      | Prints only errors, suppresses warnings.               |
| `--gmock_catch_leaked_mocks` | Controls detection of leaked mocks as failures.       |

Use these flags to adjust logging verbosity and catch leaks effectively.


## Example: Mocking an Interface with Move-Only Return

```cpp
#include <gmock/gmock.h>

class Buzz {
 public:
  explicit Buzz(int level);
};

class Buzzer {
 public:
  virtual ~Buzzer() {}
  virtual std::unique_ptr<Buzz> MakeBuzz(const std::string& text) = 0;
};

class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (const std::string& text), (override));
};

TEST(BuzzerTest, ReturnsValidBuzz) {
  MockBuzzer mock_buzzer;

  EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
      .WillOnce([](const std::string&) {
        return std::make_unique<Buzz>(1);
      });

  auto buzz = mock_buzzer.MakeBuzz("hello");
  ASSERT_NE(buzz, nullptr);
}
```


## Related Resources and Links

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): A friendly introduction to GoogleMock concepts and usage.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html): Quick reference for macros, matchers, and more.
- [Mocking Reference](../api-reference/mocking-and-stubbing/defining-mocks.md): Detailed API spec of mock-related macros and functions.
- [Using Mocks Correctly Guide](../guides/core-workflows/using-mocks-correctly.md): Best practices and common pitfalls.
- [Matchers Reference](../api-reference/core-testing-apis/assertions.md): Deep dive into matchers and assertions.
- [Changelog â€” Breaking Changes & Upgrade Paths](../changelog/migration-guides/upgrade-paths.md): For smooth adoption of new versions.

Explore the [Release History & Highlights](../changelog/release-history/version-overview.md) for granular details on feature additions and fixes.

---

By integrating these new features and improvements into your test suites, you will enhance maintainability, readability, and expressiveness, enabling you to write more robust and precise tests faster.

We encourage you to review the linked resources and experiment with these new tools in your projects to fully harness the power of GoogleTest and GoogleMock.
