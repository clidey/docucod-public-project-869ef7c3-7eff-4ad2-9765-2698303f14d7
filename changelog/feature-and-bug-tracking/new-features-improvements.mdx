---
title: "New Features & Improvements"
description: "Showcases newly introduced assertions, matchers, testing patterns, or infrastructure improvements that expand testing capabilities or simplify user workflows."
---

# New Features & Improvements

The **New Features & Improvements** page highlights the latest advancements in GoogleMock's testing capabilities, including newly introduced assertions, matchers, testing patterns, and infrastructure upgrades. These enhancements are designed to empower you with greater flexibility, expressiveness, and efficiency when creating mock-based tests, as well as simplifying your overall workflow.

---

## 1. Expanded Assertions and Matchers

### Polymorphic and Parameterized Matchers
GoogleMock continues to enrich its matcher library, enabling you to construct more expressive and reusable matchers that can adapt to different argument types and complex conditions.

- **Polymorphic Matchers:** New polymorphic matchers allow matching diverse argument types with a single matcher definition. This flexibility reduces boilerplate and improves code clarity.

- **Parameterized Matchers:** Enhanced support for multi-parameter matchers (`MATCHER_Pk`) lets you bind multiple parameters to custom matchers, offering detailed control over argument validation.

### Combining and Composing Matchers
Improved utilities to combine matchers using `AllOf()`, `AnyOf()`, and negation facilitate crafting sophisticated expectations that closely model your domain constraints.

### Examples

```cpp
// Checks that an integer argument is between 1 and 10 inclusive.
EXPECT_CALL(mock, Foo)
    .With(AllOf(Ge(1), Le(10)));

// Custom multi-parameter matcher example
MATCHER_P2(InClosedRange, low, hi, "") {
  return low <= arg && arg <= hi;
}
EXPECT_CALL(mock, Bar(InClosedRange(5, 15)));
```

---

## 2. New and Enhanced Testing Patterns

### Flexible Expectation Specification
You can now define expectations with more precise control over argument matching and call ordering using enhanced clauses:

- `.With()` clause supports multi-argument tuple matching for complex argument relationships.
- `.After()` and `.InSequence()` have been improved for more intuitive partial and total ordering of expected calls.

#### Improved User Flow
This means you can specify that a method call should only occur after a set of other calls completed, or that multiple expectations form sequences with shared partial orderings, matching real-world usage scenarios better.

### Side-Effect Actions
Actions like `SaveArg`, `SetArgPointee`, and `DeleteArg` have been extended to support move-only types more effectively, ensuring you can manipulate arguments and side effects within mock behaviors reliably.

### Examples

```cpp
EXPECT_CALL(mock, Func(_, _))
    .WillOnce(DoAll(SaveArg<0>(&output_var), Return(true)));

EXPECT_CALL(mock, Update(_)).WillOnce(SetArgPointee<0>(42));

Sequence s1;
EXPECT_CALL(mock, Step1()).InSequence(s1);
EXPECT_CALL(mock, Step2()).InSequence(s1).After(step1_expectation);
```

---

## 3. Infrastructure Improvements Simplify Workflows

### Enhanced Default Value Management
The `DefaultValue<T>` template now supports factory functions that create fresh values on demand, helping you ensure returned mock values are up-to-date and not stale copies.

```cpp
DefaultValue<std::unique_ptr<Buzz>>::SetFactory([]{
  return std::make_unique<Buzz>(AccessLevel::kInternal);
});
```

### Improved Action Compositions
More flexible use of `DoAll()`, along with the ability to ignore action results (`IgnoreResult()`), allows combining multiple side effects and return value specifications within single expectations, streamlining complex mocks.

### Support for Move-Only Types
Mocking methods with move-only parameters (`std::unique_ptr`, etc.) is better supported, including:

- Direct support in `MOCK_METHOD` declarations.
- Use of lambdas or functors as actions to manage ownership and state transfer.

### Action Macros with Template Parameters
Using `ACTION_TEMPLATE()` macros, you can now define custom, parameterized actions with explicit template arguments, facilitating highly reusable and type-safe custom actions tailored to nuanced behaviors.

---

## 4. Practical Tips and Best Practices

- **Use `ON_CALL()` for Default Behavior:** Set default actions using `ON_CALL` to avoid overly strict tests, reserving `EXPECT_CALL` for verifying actual call occurrences.

- **Combine Actions Wisely:** Use `DoAll()` to combine side effects with return values for concise, readable mocks.

- **Manage Expectations Order:** Leverage sequences (`InSequence`) and dependencies (`After`) to ensure calls happen as expected without fragility.

- **Handle Move-Only Arguments Carefully:** Prefer lambdas or functors to return or manipulate move-only types in mocks.

- **Prefer Parameterized Matchers:** They promote reuse and clearer intent in argument expectations.

---

## 5. Troubleshooting Common Issues

### Uninteresting Calls Warning
If you encounter warnings about uninteresting calls, remember:

- Use `NiceMock<T>` to suppress warnings when uninterested in calls.
- Use explicit `EXPECT_CALL(...).Times(AnyNumber())` for calls you expect but do not want to verify arguments.

### Overlapping Expectations
GoogleMock matches expectations from newest to oldest. To avoid surprises:

- Place more specific expectations after more general "catch-all" expectations.
- Use `.RetiresOnSaturation()` to deactivate expectations once met.

### Handling Move-Only Types
Not all built-in actions support move-only types fully; if you face issues, consider writing explicit lambdas or functors.

---

## 6. Summary

The **New Features & Improvements** page showcases GoogleMock's latest enhancements designed to empower your unit testing strategy with more expressive matchers, flexible testing patterns, and stronger support for modern C++ features like move-only types.

Mastering these new constructs guarantees more maintainable, precise, and robust tests.


---

### Additional Resources and Further Reading

- [Mocking Reference](../api-reference/mocking-and-matchers/mock-object-apis.md) — Comprehensive guide on defining and using mocks.
- [Actions Reference](../reference/actions.md) — Detailed list of built-in actions.
- [Matchers Reference](../reference/matchers.md) — Full catalogue of matchers.
- [gMock Cookbook](../gmock_cook_book.md) — Practical recipes and examples.
- [Legacy gMock FAQ](../googlemock/gmock_faq.md) — Troubleshooting common mocking questions.

---

<Note>
This page fits into the Interactions and Expectations part of the GoogleMock documentation, providing users the latest tools to write flexible and expressive mock specifications.
</Note>