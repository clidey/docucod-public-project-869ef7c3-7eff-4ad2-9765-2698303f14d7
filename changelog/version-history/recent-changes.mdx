---
title: "Recent Changes"
description: "Details the latest updates, focusing on new features, enhancements, bug fixes, and performance improvements in the most current release. Helps users evaluate the necessity and impact of upgrading."
---

# Recent Changes in GoogleMock

This page provides users with detailed insights into the latest updates, focusing on new features, enhancements, bug fixes, and performance improvements in the most current release of GoogleMock. Understanding these changes empowers you to assess the necessity and benefits of upgrading to the latest version of this robust C++ mocking framework.

---

## Overview

GoogleMock is a comprehensive framework for creating mock classes in C++. It facilitates the definition of mocks, configuration of expectations on method calls, and verification of interactions—all crucial for effective unit testing. The following updates reflect enhancements in user experience, API behavior, and internal robustness, aligned with user workflows for mocking.

---

## Key Updates & Highlights

### Enhanced Handling of Mock Methods with Complex Argument Types

- GoogleMock now fully supports mock methods that accept arguments of incomplete types by requiring a custom printer for such types. This allows users to mock methods that reference incomplete classes, a common scenario when dealing with forward declarations or incomplete headers.

- The framework correctly handles non-default-constructible return types, enforcing the necessity to specify explicit return values or actions to avoid runtime errors.

### Robust Macro Expansion Compatibility

- Improved compatibility with macro-redifinition scenarios (such as when Windows API macros might redefine method names). Both `EXPECT_CALL` and `ON_CALL` macros now seamlessly integrate, ensuring that mocked methods whose names clash with preprocessor macros compile and run correctly without issues.

### Strict Enforcement of Expectation Syntax Rules

- GoogleMock enforces strict rules around expectation clauses such as `.With()`, `.WillByDefault()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`. Misuse or multiple appearances of these clauses in an expectation chain are caught with clear, immediate errors during test execution, helping to prevent subtle test failures.

- This rigorous syntactic verification aids users in preventing common mistakes that could otherwise lead to unclear or faulty expectations.

### Call Evaluation Precision

- The framework guarantees that both `ON_CALL` and `EXPECT_CALL` evaluate their arguments exactly once, preserving expected side effects and avoiding surprises in tests.

- The default action on uninteresting calls behaves consistently, with clear unambiguous semantics backed by configurable verbosity settings.

### Extensive Support for Call Cardinality and Sequencing

- GoogleMock supports complex call ordering including fully ordered sequences (`InSequence`), partially ordered dependencies (`After` clauses), and expectation retirement (`RetiresOnSaturation`) to effectively model intricate interactions.

- Expectations remain "sticky" by default to avoid brittle tests, but can be made to retire upon specific conditions to align with precise testing requirements.

### Improved Warning and Error Diagnostics

- The system emits detailed warning and failure messages for 
   - Unexpected calls,
   - Excessive calls beyond expected cardinality,
   - Uninteresting calls without expectations,
   - Calls violating sequence or prerequisite conditions,
   - Mismatched argument expectations vs actual invocations.

- Messages include argument values and, optionally, stack traces based on verbosity flag `--gmock_verbose`, aiding efficient debugging.

### Thread Safety and Robustness Enhancements

- Internal synchronization ensures mock object state and expectations are safe under concurrent calls.

- The framework protects against deadlocks when mocks are destroyed during mock method executions or from chained mocks holding references to another.

### Lifecycle and Verification Controls

- New support for explicit verification of mock expectations mid-test via `Mock::VerifyAndClearExpectations()` and combined with clearing default actions using `Mock::VerifyAndClear()`.

- Facilities to mark mocks as leakable (`Mock::AllowLeak()`) to suppress leak-checking failures, useful in tests managing mocks with complex ownership.

### Extensible Strictness Options for Uninteresting Calls

- The behavior for uninteresting calls (calls without explicit expectations) remains configurable on a per-mock basis with options: Allow (NiceMock), Warn (NaggyMock, default), or Fail (StrictMock).

- Integration ensures proper strictness inheritance and prevents conflicting strictness wrappers on mock hierarchies.

---

## Upgrade Impact and Best Practices

- **Backward Compatibility:** These enhancements do not break existing tests that conform to documented usage patterns. However, tests relying on lax expectation definitions or implicit behaviors may need minor revisions.

- **Expectation Clause Usage:** Always specify modifiers (`Times`, `WillOnce`, `WillRepeatedly`, etc.) according to the prescribed order and only once per expectation to avoid runtime errors.

- **Use of Strictness Wrappers:** Consider using `NiceMock` to suppress warnings on uninteresting calls during test development and switch to `StrictMock` to enforce strict verification as tests mature.

- **Macro Name Collisions:** When mocking code with platform-specific or legacy macros, verify that method names are correctly expanded and tested using `EXPECT_CALL` and `ON_CALL` to avoid unexpected compilation or runtime issues.

- **Sequence and Ordering:** Leverage `InSequence` and `After` clauses to model complex call order dependencies within your tests, especially in asynchronous or event-driven code.

- **Verbose Diagnostics:** Use `--gmock_verbose=info` during test debugging phases to capture comprehensive call traces and diagnostics.

---

## Practical Examples from Recent Changes

### Mocking Methods with Incomplete Types

```cpp
class Incomplete;  // Forward declaration

class MockIncomplete {
 public:
  MOCK_METHOD(void, ByRefFunc, (const Incomplete& x));
};

// Required for printing incomplete types (define elsewhere)
void PrintTo(const Incomplete& x, std::ostream* os) {
  *os << "incomplete";
}
```

### Macro Expansion Resilience

```cpp
#define Method MethodW

class CC {
 public:
  virtual ~CC() = default;
  virtual int Method() = 0;
};

class MockCC : public CC {
 public:
  MOCK_METHOD(int, Method, ());
};

MockCC cc;
ON_CALL(cc, Method());
EXPECT_CALL(cc, Method()).WillOnce(Return(42));
EXPECT_EQ(42, cc.Method());

#undef Method
```

### Example of Expectation Syntax Enforcement

```cpp
EXPECT_CALL(mock, DoA(5))
    // .With() can only appear once
    .With(_)
    .With(_);
// This triggers a runtime error stating ".With() cannot appear more than once".
```

---

## Troubleshooting

- If unexpected or excessive calls occur, verify your `EXPECT_CALL` declarations include proper cardinalities and that you have specified expected call counts.

- Use the `EXPECT_CALL(...).RetiresOnSaturation()` clause to prevent sticky expectations causing upper-bound violations when calls exceed expected counts.

- When facing warnings about uninteresting calls, review if default behaviors are suitably set with `ON_CALL` and ensure you are using `NiceMock` or manually suppress warnings with `.Times(AnyNumber())`.

- Run tests with `--gmock_verbose=info` for detailed diagnostics on expectation matching and mock call traces.

- If macro expansions interfere with method naming, confirm your test includes the `#undef` directive and test the expanded name's behavior explicitly.

- When mocking non-default constructible return types, always specify an explicit return value in `WillOnce()` or `WillRepeatedly()` to avoid exceptions or crashes.

---

## Reference Links

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — step-by-step mocking strategies and recipes.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) — API details for mocks, expectations, and clauses.
- [Nice, Naggy, Strict Mocks](https://google.github.io/googletest/reference/mocking-apis/nice-strict-mocks.md) — controlling mock call policies.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — quick programming tips.
- [GoogleTest System Architecture](../overview/architecture-concepts/system-architecture-diagram) — how GoogleTest and GoogleMock components interact.

---

For a full understanding of these recent changes, users are encouraged to explore examples and detailed guides linked above.Starting with the `gMock Cookbook` offers actionable recipes to unlock new functionality effectively.


