---
title: "Notable Additions & Improvements"
description: "Details newly introduced features and significant improvements for each release, emphasizing benefits for testing workflows and integration scenarios. Enables users to leverage enhancements efficiently after upgrading."
---

# Notable Additions & Improvements

GoogleTest and GoogleMock continue evolving to empower C++ developers with robust, flexible testing tools. This page highlights key new features and meaningful improvements from recent releases, focusing on enhanced mocking capabilities, refined test workflows, and richer integration options. You’ll find concrete examples and user-centered explanations to help you adopt these enhancements smoothly and elevate your testing practices.

---

## 1. Enhanced Mocking Strictness Control

### Introducing `NiceMock`, `NaggyMock`, and `StrictMock`
To better tailor mock object behavior regarding uninteresting calls (i.e., mock method calls without explicit expectations), GoogleMock now offers three specialized wrappers:

- **NiceMock**: Suppresses warnings for uninteresting calls, enabling quieter test output where such calls are expected and harmless.
- **NaggyMock** (default behavior): Emits warnings on uninteresting calls to alert you to potentially unexpected behavior.
- **StrictMock**: Treats uninteresting calls as failures, enforcing strict adherence to expectations.

These wrappers are subclasses of your mock class and inherit constructors, making it straightforward to swap your mock objects with the desired strictness behavior. This feature helps you control test brittleness and maintain clarity.

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // Suppresses uninteresting call warnings
NaggyMock<MockFoo> naggy_foo;    // (Default) Warns on uninteresting calls
StrictMock<MockFoo> strict_foo;  // Fails tests on uninteresting calls
```

**Tip:** Use `NiceMock` for stable test suites, `NaggyMock` for development and debugging phases, and `StrictMock` to eliminate unexpected call issues prior to release.

---

## 2. Richer Expectation Specification and Ordering

### Flexible Expectation Ordering with Sequences and After Clauses
To express precise call ordering in tests, you can now use:

- **Sequences**: Define one or more sequences to group expectations, ensuring calls occur in the specified partial order within those sequences.
- **After Clause**: Specify that certain expectations must be called only after others have completed, supporting complex dependency graphs.

Example of defining and using sequences for partially ordered calls:

```cpp
using ::testing::Sequence;
Sequence s1, s2;

EXPECT_CALL(mock, A())
    .InSequence(s1, s2);
EXPECT_CALL(mock, B())
    .InSequence(s1);
EXPECT_CALL(mock, C())
    .InSequence(s2);
EXPECT_CALL(mock, D())
    .InSequence(s2);
```

This setup ensures `A()` happens before `B()` and `C()`, `B()` happens before `D()`, but does not constrain the relative order of `B()` and `C()`.

### Retiring Expectations on Saturation
Expectations now support `.RetiresOnSaturation()` to automatically deactivate once the call count meets the upper bound, preventing errors from exceeding the expected number of calls. Ideal for flexible call allowances:

```cpp
EXPECT_CALL(mock, Foo(7))
    .Times(2)
    .RetiresOnSaturation();
```

This means after two calls to `Foo(7)`, further calls will not match this expectation, preventing over-saturation failures.

---

## 3. Streamlined Mock Class Definitions and Templates

### Consistent Use of `MOCK_METHOD` Macro
Defining mock methods is now more standardized with the generic `MOCK_METHOD` macro syntax:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

Supports virtual, const, noexcept, calling conventions, and reference qualifiers. For example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

### Handling Types with Commas
To avoid compilation issues with return or argument types containing commas (e.g., `std::pair`, `std::map`), wrap the type in extra parentheses or use type aliases:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
using MapType = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapType, bool));
```

### Mocking Class Templates
Mocking templates works naturally by templating your mock class and mocking the interface similarly:

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

This keeps your mock definitions type-safe and expressive.

---

## 4. Default Actions and Behavior Control

### Using `ON_CALL` for Default Behavior
`ON_CALL` lets you specify what should happen when mock methods are called but without setting hard expectations. This is ideal for defaults:

```cpp
ON_CALL(mock, GetSize())
    .WillByDefault(Return(1));
```

Explicit expectations (`EXPECT_CALL`) override these default actions.

### Setting Default Return Values
Use `::testing::DefaultValue<T>::Set(value)` to change the global default return for type `T` across mock methods:

```cpp
DefaultValue<int>::Set(42);
ON_CALL(mock, GetNumber()).WillByDefault(Return(0)); // local override
```

Don't forget to clear defaults after tests to avoid unwanted side effects.

---

## 5. Rich Matchers and Actions for Precise Verification

### Argument Matchers
Use gMock’s expressive set of argument matchers to specify flexible parameter validations, from simple wildcards (`_`) to compound predicates:

```cpp
EXPECT_CALL(mock, Foo(Ge(5), NotNull()));
```

### Chaining Call Behaviors
Define sequences of behaviors for calls with `.WillOnce()` and fallback with `.WillRepeatedly()`:

```cpp
EXPECT_CALL(mock, GetNumber())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### Custom Actions & Lambdas
Define your own callable actions inline or separately for complex behaviors:

```cpp
EXPECT_CALL(mock, DoThis(_))
    .WillOnce([](int x) { return x * 2; });
```

---

## 6. Verifying and Managing Expectations

### Automatic Verification on Destruction
Mocks automatically verify that all expectations were met when destroyed, simplifying test maintenance.

### Manual Verification
You can explicitly verify and clear expectations before destruction:

```cpp
Mock::VerifyAndClearExpectations(&mock_obj);
```

Avoid setting new expectations after verification to prevent undefined behavior.

### Managing Mock Leaks
Use `Mock::AllowLeak(&mock_obj);` to tell gMock to ignore leaks for specific mocks when they are deliberately left alive beyond test scope.

---

## 7. Controlling Output Verbosity

### Using `--gmock_verbose` Flag
Control the level of mock interaction details printed during tests:

- `info` shows all informational and warning messages with stack traces.
- `warning` shows warnings and errors (default), no stack traces.
- `error` shows errors only.

You can also programmatically set verbosity:

```cpp
::testing::FLAGS_gmock_verbose = "error";
```

### Helpful for Debugging
Use higher verbosity levels to get detailed traces of expectations and method calls to quickly identify mismatches and unexpected invocations.

---

## 8. Improved Documentation and Examples

The documentation has been enhanced with detailed usage examples for common workflows:

- Defining mocks and methods step-by-step.
- Expected call setup with multiple actions.
- Using matchers for argument validation.
- Sequencing and ordering expectations.
- Mock strictness classifications and use-cases.

These help users progress from beginner to expert in implementing effective mocks and expectations.

---

## Troubleshooting & Best Practices

- Always declare mock method overrides in the `public:` section for accessibility by `EXPECT_CALL` and `ON_CALL`.
- Use `NiceMock` to suppress uninteresting warnings in stable tests.
- Use `.RetiresOnSaturation()` to avoid “sticky” expectation issues.
- Prefer `ON_CALL` for default behaviors to reduce test brittleness.
- Use `EXPECT_CALL` only when you explicitly want to verify a particular call.
- Ensure virtual destructors for your interfaces to avoid memory leaks.
- For move-only types, use lambdas or custom actions rather than `Return()` with moved objects.

---

_Read the following core references for in-depth knowledge and practical examples:_

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)
- [Nice/Strict/Naggy Mocks](https://google.github.io/googletest/api/release-notes.html#gmock-nice-strict-naggy)

---

_Source code and test examples can be found in the official repository:_

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/include/gmock/gmock-nice-strict.h"},{"path": "docs/gmock_cheat_sheet.md"},{"path": "docs/gmock_cook_book.md"},{"path": "docs/gmock_faq.md"}]} />
