---
title: "Bug Fixes & Stability Improvements"
description: "Documents significant bug fixes, regressions addressed, test runner stability updates, and improvements to core components (such as test discovery, matcher behavior, or test assertion reporting)."
---

# Bug Fixes & Stability Improvements

This page details the significant bug fixes, regressions addressed, improvements in test runner stability, and updates to core components of GoogleTest, with focus on test discovery, matcher behavior, and test assertion reporting. These updates ensure a more robust, predictable, and user-friendly experience when writing and running tests.

---

## Recent Bug Fixes and Stability Enhancements

### Enhanced Test Runner Reliability

- **Improved Fatal Failure Propagation**: Previously, fatal assertion macros such as `ASSERT_*` could abort only the current function, not the entire test, which occasionally led to undefined behavior or crashes when subroutines failed fatally but execution continued. Now, GoogleTest provides better mechanisms through macros like `ASSERT_NO_FATAL_FAILURE` and the function `HasFatalFailure()` to properly handle fatal failures within subroutines, ensuring tests abort as expected and avoid common pitfalls like segmentation faults.

- **Stable Test Execution Order**: Updates ensure that tests in the same suite consistently use the same fixture class and prevent accidental mixing of `TEST` and `TEST_F` macros within the same test suite. This eliminates obscure errors and test registry conflicts that previously caused test failures and confusing diagnostics.

- **Improved Multithreading Support with SCOPED_TRACE**: The stability of trace information in multi-threaded test scenarios has been enhanced. Trace points created with `SCOPED_TRACE` now correctly associate failure messages with appropriate invocation contexts even across concurrent threads, allowing for precise diagnosis of failures within complex thread interactions.


### Core Assertion and Matcher Fixes

- **Better String Assertion Handling**: Fixes address comparison and output of C strings and wide strings (`wchar_t*`), including safety around `nullptr` inputs and embedded null characters, providing clear, informative failure messages without crashes.

- **Floating-Point Comparison Accuracy**: Updates to floating-point assertions (`EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, `EXPECT_NEAR`) fix rare failures related to rounding and special floating-point values like NaN and infinity, improving correctness and reliability in numeric validations.

- **Predicate Assertion Improvements**: Predicate and predicate-format assertions receive stability fixes, such as ensuring argument expressions are evaluated exactly once per assertion, enhancing user experience by preventing side effects during checks.

- **Enhanced HRESULT Assertions on Windows**: Fixes ensure that `EXPECT_HRESULT_SUCCEEDED` and related macros correctly identify success and failure HRESULT codes, including the printing of human-readable error messages.


### Test Registration and Parameterized Tests

- **Dynamic Test Registration**: Bug fixes in `RegisterTest` ensure that dynamic, programmatic test registration works consistently, supporting complex scenarios where tests are generated at runtime with varying parameters.

- **Handling of Uninstantiated Parameterized Tests**: GoogleTest now accurately reports tests and parameterized test suites that have been defined but not instantiated, preventing silent failures where test code is present but not executed.

- **Disabled Tests Management**: Improvements to disabled test detection prevent unexpected execution or missing skipped test notifications, maintaining user control over temporarily disabled tests.


### Test Output and Logging

- **Escaping in Failure Messages**: Special characters in messages logged via assertions are now escaped properly, avoiding garbled output and improving readability in test logs.

- **Improved Logging Interleaving**: Fixes prevent race conditions and message interleaving anomalies when interspersing user logs (`printf`) with GoogleTest assertions, ensuring clarity in output sequences.

- **Consistent Recording of Test Properties**: Bug fixes ensure that calls to `RecordProperty()` correctly add and override test properties for tests, test suites, and global contexts, without silent failures or restrictions caused by reserved keys.


## Example of Stability Fix: Correct Fatal Failure Propagation

```cpp
void Subroutine() {
  ASSERT_EQ(1, 2);  // Generates a fatal failure.
  // Previously, this aborted only Subroutine(), but test continued.
  // Now test aborts immediately after this assertion.
}

TEST(MyTest, StopsOnFatalFailure) {
  Subroutine();
  if (HasFatalFailure()) return;  // Aborts test early.
  // This code no longer executes after a fatal failure in Subroutine().
}
```


## Best Practices and Tips

- **Use `ASSERT_NO_FATAL_FAILURE` or `EXPECT_NO_FATAL_FAILURE`** to wrap calls to subroutines where fatal assertions may occur to ensure correct propagation.

- **Use `SCOPED_TRACE`** to add context and aid debugging when assertions fail in complex call stacks or loops.

- **When defining predicate assertions, prefer functions returning `AssertionResult`** to produce more informative failure messages.

- **Avoid mixing `TEST` and `TEST_F` within the same test suite** to prevent registration errors and maintain fixture consistency.

- **Leverage GoogleTest flags** such as `--gtest_repeat` and `--gtest_shuffle` carefully to identify flakiness and ordering dependencies.


## Troubleshooting Common Issues Addressed

- Tests aborting incorrectly due to unhandled fatal failures in subroutines.
- Unexpected mixing of fixture classes in test suites causing test registration errors.
- Failures in assertions on string pointers with null or embedded null strings.
- Silent failures or omissions in parameterized tests due to missing instantiations.
- Multithreaded tests showing incomplete or confusing failure traces.


## Related Documentation

- [GoogleTest Primer](https://google.github.io/googletest/primer.html): Understand key concepts and begin writing tests.
- [Assertions Reference](reference/assertions.md): Detailed list of assertion macros.
- [Advanced GoogleTest Topics](docs/advanced.md): Deep dive into advanced features and behaviors.
- [Death Tests and Error Handling](api-reference/core-testing-apis/death-tests.mdx): For specialized tests validating program terminations.


For complete release details, please visit the [GoogleTest Releases Page](https://github.com/google/googletest/releases).

---

_Last updated: main branch_

