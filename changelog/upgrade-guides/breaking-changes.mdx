---
title: "Breaking Changes & Migration Paths"
description: "Explicit callouts of incompatible changes, removal of legacy features, or platform requirement shifts. Includes step-by-step migration strategies and code samples for adapting to new APIs or behaviors."
---

# Breaking Changes & Migration Paths

This page provides explicit callouts of incompatibilities introduced in GoogleMock, including legacy feature removals and shifts in platform requirements. It guides users through step-by-step migration strategies and includes actionable code samples to adapt to new APIs or behaviors effectively.

---

## Understanding Breaking Changes

In evolving software libraries like GoogleMock, certain changes break backward compatibility. This means existing code that depends on older interfaces or behaviors may fail to compile or run correctly with newer versions. This page focuses solely on such changes, helping you identify incompatible modifications and adapt your tests accordingly.

## Key Incompatible Changes

### 1. Transition from `MOCK_METHODn` to Generic `MOCK_METHOD`

GoogleMock has deprecated the older `MOCK_METHODn` family of macros in favor of the generic `MOCK_METHOD` macro around 2018. While the old macros still exist, transitioning to the generic form is strongly recommended, as it provides a unified and more flexible syntax.

- **Old Style:**
  ```cpp
  MOCK_METHOD1(Foo, bool(int));
  MOCK_CONST_METHOD1(Foo, bool(int));
  MOCK_METHOD1_T(Foo, bool(int));
  // etc.
  ```

- **New Style:**
  ```cpp
  MOCK_METHOD(bool, Foo, (int), ());
  MOCK_METHOD(bool, Foo, (int), (const));
  MOCK_METHOD(bool, Foo, (int), (override));
  ```

#### Migration Tips:
- Replace all `MOCK_METHODn` macros with `MOCK_METHOD`, restructuring the arguments accordingly.
- For const qualifiers, specify `(const)` in the macro's qualifiers.
- When mocking methods in class templates or with call types, use the full `(specs...)` parameter.

### 2. Mandatory Public Accessibility of Mock Methods

Any mock method created using `MOCK_METHOD` must now reside in the `public:` section of the mock class, even if the corresponding base method is protected or private.

- This adjustment enables external frameworks like `EXPECT_CALL` and `ON_CALL` to access these methods properly.

#### Migration Tips:
- Move all `MOCK_METHOD` declarations into the public section of your mock class.

### 3. Suppression and Behavior of Uninteresting Calls

GoogleMock defaults to issuing warnings on uninteresting mock calls—calls to mock methods without `EXPECT_CALL` expectations.

- Use `NiceMock<T>` to suppress such warnings.
- Use `StrictMock<T>` to treat those calls as errors.

#### Migration Tips:
- Wrap existing mocks with `NiceMock<>` to retain warning suppression behavior or `StrictMock<>` to enforce strict checking.
- Be aware that mocks inheriting methods with `MOCK_METHOD` in base classes may not fully respect strictness modifiers.

### 4. Refined Argument Matching and Overload Resolution

Newer GoogleMock versions provide better support for matching overloaded functions and resolve ambiguities more strictly.

- Use explicit casting helpers like `SafeMatcherCast<Type>(matcher)` and `Const(mock_object)` when calling `EXPECT_CALL` on overloaded methods.

#### Migration Tips:
- Adjust your expectations on overloaded methods with explicit disambiguation.

### 5. Enhanced Default Value Behavior

GoogleMock's default return value handling for mock methods is now more predictable:

- For return types with default constructors, the default value is returned.
- Use `::testing::DefaultValue<T>::Set()` to provide your own default return values when needed.

#### Migration Tips:
- Review your mock methods' default return values and utilize `DefaultValue` where custom behavior is required.

## Step-by-Step Migration Strategy

### Step 1: Update `MOCK_METHODn` Macros

Search your codebase for `MOCK_METHODn` macros and replace them with the new generic `MOCK_METHOD` syntax.

- Example transformation:
  ```cpp
  // Old
  MOCK_CONST_METHOD1(Foo, bool(int));

  // New
  MOCK_METHOD(bool, Foo, (int), (const));
  ```

### Step 2: Ensure Public Access for Mocks

Audit your mock classes to confirm that all `MOCK_METHOD` macros are within the `public:` section.

### Step 3: Address Strictness of Mocks

Decide your desired behavior for uninteresting calls:

- For quiet tests: use `NiceMock<MyMock> mock;`.
- For strict verification: use `StrictMock<MyMock> mock;`.

### Step 4: Disambiguate Overloads Explicitly

For methods with the same name but different signatures, clarify which overload you expect using explicit casting or helper functions.

### Step 5: Review Default Return Values

Set any necessary custom default return values for your mocks to avoid unexpected semantics during test execution.

## Example: Migrating a Mock Class

```cpp
// Old-style mock
class MockFoo : public Foo {
  MOCK_CONST_METHOD1(Foo, bool(int));
  MOCK_METHOD2_WITH_CALLTYPE(STDMETHODCALLTYPE, Bar, int(double, float));
  MOCK_METHOD1(Add, void(int));

  protected:
  MOCK_METHOD0(Resume, void());

  private:
  MOCK_METHOD0(GetTimeout, int());
};

// New-style mock
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Foo, (int), (const, override));
  MOCK_METHOD(int, Bar, (double, float), (Calltype(STDMETHODCALLTYPE), override));
  MOCK_METHOD(void, Add, (int), (override));

  // Move protected and private mocks to public for accessibility
  MOCK_METHOD(void, Resume, (), (override));
  MOCK_METHOD(int, GetTimeout, (), (override));
};
```

## Code Samples for Migration

### Wrapping with NiceMock or StrictMock

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;
using ::testing::StrictMock;

// Quiet mock
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, Foo(_))
    .WillOnce(Return(true));

// Strict mock
StrictMock<MockFoo> strict_mock;
EXPECT_CALL(strict_mock, Foo(42))
    .Times(1);

// Any other uninteresting calls trigger errors.
```

### Explicit Overload Disambiguation

```cpp
using ::testing::Return;
using ::testing::Const;

EXPECT_CALL(mock, Foo(42));             // Non-const Foo()
EXPECT_CALL(Const(mock), Foo(42));      // Const Foo()

// SafeMatcherCast example for argument conversion
EXPECT_CALL(mock, Bar(SafeMatcherCast<double>(Gt(3.14))));
```

## Common Pitfalls & Troubleshooting

- **Compilation Failures on MOCK_METHOD:** Check for missing parentheses around complex argument types or return types containing commas.

- **Access Issues to Mock Methods:** Verify all mock methods are defined in the `public:` section of your mock class.

- **Unexpected Uninteresting Call Warnings:** Wrap mocks with `NiceMock` to suppress these warnings or add explicit `EXPECT_CALL` with `.Times(AnyNumber())` if intentional.

- **Ambiguous Overloads in EXPECT_CALL:** Use `Const(mock_object)` or explicit `SafeMatcherCast` in `EXPECT_CALL` to clarify expected function signatures.

- **Default Return Value Mismatches:** Use `::testing::DefaultValue<T>::Set()` to define default returns for custom types.

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical examples & recipes.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Full API descriptions.
- [Matchers Reference](https://google.github.io/googletest/gmock_matchers.html) — For custom matchers and advanced matching.
- [Configuring Expectations and Actions Guide](https://google.github.io/googletest/guides/configuring_expectations_actions.html) — Detailed workflow of EXPECT_CALL and ON_CALL.

---

For a seamless and successful migration, carefully prioritize updating mock definitions, controlling mock strictness, and clarifying method overloads. This will ensure your tests remain robust, maintainable, and compatible with the latest GoogleMock releases.
