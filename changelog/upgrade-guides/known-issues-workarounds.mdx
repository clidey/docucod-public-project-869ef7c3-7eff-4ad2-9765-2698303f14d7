---
title: "Known Issues and Workarounds"
description: "Documents any known problems in recent releases and their recommended solutions, helping users avoid common pitfalls when adopting the latest versions."
---

# Known Issues and Workarounds

This page documents known problems encountered in recent GoogleMock releases and provides recommended workarounds to help users avoid common pitfalls when adopting the latest versions. Keeping this page in mind during upgrades ensures smoother integration and testing experiences.

---

## 1. Unexpected Behavior with Virtual Methods

### Problem:
When invoking mock methods, the call sometimes unexpectedly invokes the real base class method instead of the mock.

### Cause:
This happens when the method being mocked is not declared as `virtual` in the base class.

### Workaround:
Ensure all methods intended to be mocked are declared `virtual`. If non-virtual methods need mocking, consider the high-performance dependency injection technique described in the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#MockingNonVirtualMethods).

---

## 2. Compiler Warnings on `const` Parameters

### Problem:
Microsoft Visual C++ (especially versions 2005 SP1 and 2008 SP1) issues warnings like `C4301` or `C4373` when mock methods have parameters declared as `const int`.

### Cause:
In C++, top-level `const` on parameters is ignored in function declarations, but MSVC treats these as distinct for overriding.

### Workaround:
Remove top-level `const` qualifiers on value parameters in both the base and mock classes. For pointer or reference parameters, keep `const` qualifiers as appropriate.

---

## 3. Troubleshooting Unsatisfied Expectations

### Problem:
Tests fail because gMock reports expectations as unsatisfied despite apparent correct test code.

### Diagnostic Tip:
Run your tests with the flag `--gmock_verbose=info` to gain detailed tracing of all mock function calls. This reveals which expectations match which calls and helps isolate mismatches.

---

## 4. Excessive and Retired Expectations

### Problem:
Calls to mock methods exceeding the expected number cause errors, or calls match retired expectations causing unexpected failures.

### Explanation:
- **Excessive calls:** Occur when the function is called more times than specified by `Times()` and any `WillOnce()` clauses.
- **Retired expectations:** Expectations may retire after being saturated or due to sequences ordering.

### Workarounds:
- Use `.RetiresOnSaturation()` with expectations that should not remain active after reaching their upper call count.
- Review call order constraints using `InSequence` or `After` to ensure proper sequencing that activates expectations when needed.

---

## 5. Handling Uninteresting Calls

### Problem:
Warnings stating "Uninteresting mock function call" appear when mock methods are called without any `EXPECT_CALL` set.

### Explanation:
An uninteresting call indicates the test has not explicitly expressed interest in verifying calls to a mock method.

### Best Practices:
- Use `ON_CALL` to define default behavior without requiring an expectation.
- If you want to allow any calls without warnings, either add `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` or wrap your mock with `NiceMock`.
- Avoid blindly adding `EXPECT_CALL` for all calls just to silence warnings.

---

## 6. Mock Object Leaks Detected at Test Exit

### Problem:
The test output may report leaked mock objects that were never deleted, leading to verification not happening.

### Impact:
Leaked mocks mean expectations are never verified, causing potentially silent test failures.

### Workarounds:
- Ensure proper lifetime management and deletion of mock instances.
- Use `testing::Mock::AllowLeak(&mock)` if intentional leaks are required.

---

## 7. Using NiceMock, NaggyMock, and StrictMock Wrappers

GoogleMock provides wrappers to control behavior on unexpected or uninteresting calls.

- **NiceMock:** Suppresses warnings on uninteresting calls. Recommended during routine testing.
- **NaggyMock:** Prints warnings on uninteresting calls. Current default for mocks.
- **StrictMock:** Treats all uninteresting calls as errors, enforcing stricter test discipline.

Consider wrapping your mocks with these when your test intent requires different strictness levels. See [Mock Call Policies](https://google.github.io/googletest/reference/mocking-apis/nice-strict-mocks.html) for detailed guidance.

---

## 8. Compatibility and Migration Notes

- When upgrading between major versions, review breaking changes related to mock method syntax and cardinality clauses.
- Adjust your mock classes to comply with the new `MOCK_METHOD` macro usages, modifiers, and expectation chaining order.
- For details, consult the [Breaking Changes & Migration Notes](https://google.github.io/googletest/changelog/breaking-deprecations/breaking-changes.html).

---

## 9. Controlling Verbosity of Mock Output

To manage the volume and detail of diagnostic messages, use the `--gmock_verbose=LEVEL` flag with values:

- `info`: Prints all informational messages, warnings, and errors, including full stack traces.
- `warning`: Prints warnings and errors, less verbose (default).
- `error`: Prints errors only, minimal output.

Adjust this flag as needed to aid debugging or to reduce noise in test logs.

---

## 10. Example Troubleshooting Scenarios

### Unexpected Call Returned Default Value
If an unexpected call happens and a default action is specified via `ON_CALL`, gMock will take the default action but print a warning and fail the test.

### Excessive Calls Handling
If the number of calls exceeds the expectation, gMock reports a failure and returns the default action (or for void returns, returns immediately).

### Sequencing Misses
If calls occur in an order violating sequences (`InSequence`) or prerequisite expectations (`After`), gMock reports unsatisfied prerequisite failures.

Use test instrumentation and verbose logging (`--gmock_verbose=info`) to identify the offending call order.

---

## 11. Helpful Tips for Avoiding Known Issues

- Always set expectations before exercising the mock to avoid undefined behaviors.
- Use `RetiresOnSaturation` to disable expectations after they are matched.
- Leverage `ON_CALL` for default behaviors, and `EXPECT_CALL` for expectations to verify calls.
- When mocking overloaded or const overload methods, use `Const()` wrapper and explicitly specify qualifying modifiers as per the [Mocking Reference](https://google.github.io/googletest/reference/mocking-apis/mock-expectations-actions.html).
- Regularly verify and clear mock expectations during test tear-down when mock lifetime is uncertain using `Mock::VerifyAndClearExpectations(&mock)`.

---

For more detailed workarounds and explanations, see the corresponding documentation pages:

- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking-apis/mock-expectations-actions.html)
- [Nice/Strict/Naggy Mocks](https://google.github.io/googletest/reference/mocking-apis/nice-strict-mocks.html)

---

## References

- GoogleMock project: https://github.com/google/googletest
- gMock Cookbook: https://google.github.io/googletest/gmock_cook_book.html
- Mocking Reference: https://google.github.io/googletest/reference/mocking-apis/mock-expectations-actions.html
- Nice/Strict Mocks Guide: https://google.github.io/googletest/reference/mocking-apis/nice-strict-mocks.html
- gMock for Dummies: https://google.github.io/googletest/gmock_for_dummies.html

---