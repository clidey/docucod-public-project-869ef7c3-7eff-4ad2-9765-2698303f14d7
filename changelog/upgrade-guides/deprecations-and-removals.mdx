---
title: "Deprecations and Removals"
description: "Lists APIs, features, and flags that have been deprecated or removed, along with their recommended replacements. This helps users future-proof their code and plan migration work ahead of deadlines."
---

# Deprecations and Removals

This page details APIs, features, and flags in GoogleTest and GoogleMock that have been deprecated or removed. It provides guidance on their replacements and recommendations for migration, enabling users to maintain compatibility and adapt smoothly to future versions.

---

## Overview

Over time, GoogleTest and GoogleMock evolve to improve usability, correctness, and maintainability. To support this, outdated or problematic APIs, behaviors, and flags are deprecated or removed. This document helps you:

- Identify deprecated or removed features on the GoogleTest/GoogleMock side.
- Understand recommended replacements or migration paths.
- Future-proof your code to avoid breakage on upgrading.


---

## Deprecated Macros and APIs

### Old-style MOCK_METHODn macros

The legacy suite of `MOCK_METHODn`, `MOCK_CONST_METHODn`, and related macros, which explicitly specify the number of arguments, are deprecated in favor of the generic `MOCK_METHOD` macro introduced in 2018. 

**Migration recommendation:**

Replace usage like:

```cpp
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD2(Bar, void(int, int));
```

with:

```cpp
MOCK_METHOD(bool, Foo, (int), (override));
MOCK_METHOD(void, Bar, (int, int), (const, override));
```

The newer macro simplifies syntax, supports qualifiers directly, and respects function attributes such as `noexcept` and reference qualifiers.


### Framework Flags

- The flag `--gmock_catch_leaked_mocks` is deprecated and replaced by management via the `Mock::AllowLeak()` API.
- The verbosity flag `--gmock_verbose` now supports normalized values: `info`, `warning`, and `error`. Any other values are treated as `warning`.


---

## Behavior Changes and Removals

### Clause Order Enforcement

To improve clarity and prevent subtle bugs in tests, GoogleMock now enforces the order of clauses in `EXPECT_CALL` and `ON_CALL` statements strictly. 

For example, the `.With()` clause must be the first clause when used.

Incorrect:

```cpp
EXPECT_CALL(mock, Func()).Times(1).With(_); // Deprecated and disallowed
```

Correct:

```cpp
EXPECT_CALL(mock, Func()).With(_).Times(1);
```


### Default Action Requirement for ON_CALL

It is now mandatory to specify `.WillByDefault()` when using `ON_CALL`. Omitting it leads to a runtime error.

Example causing runtime failure:

```cpp
ON_CALL(mock, Func()); // Missing WillByDefault - deprecated
```

Correct usage:

```cpp
ON_CALL(mock, Func()).WillByDefault(Return(42));
```


### Argument Expression Evaluation

Argument expressions in `ON_CALL` and `EXPECT_CALL` are evaluated exactly once at the point of the call. Previously, some internal inconsistencies or double evaluations could occur. Make sure side effects are safe or avoided in argument expressions.


---

## Removed Features

### Legacy Mocking Macros without Generic MOCK_METHOD

The `MOCK_METHODn` macros without the new generic style and their Windows-calltype variants (such as `MOCK_METHOD1_WITH_CALLTYPE`) have been phased out. Transition to the generic `MOCK_METHOD` macro as described under Deprecated Macros.


### Legacy `EXPECT_CALL` Predicates with Deprecated Clause Orders

Expectations that do not conform to the enforced clause order or leave out mandatory clauses are rejected.


---

## Migration Tips

- Survey existing tests and mocks for old-style mocking macros and replace them.
- Add explicit `.WillByDefault()` clauses for all `ON_CALL` statements.
- Check your `EXPECT_CALL` and `ON_CALL` clauses to ensure `.With()` is only used as the first clause if at all.
- Avoid side effects in argument expressions and flag evaluations.
- Use the `Mock::AllowLeak()` API to handle deliberately leaked mocks instead of legacy flags.
- Consult the documentation on Nice, Naggy, and Strict mocks for best practices on managing uninteresting calls.


---

## Common Pitfalls

- **Missing WillByDefault in ON_CALL:** Causes test failures because the default action is not set.
- **Incorrect clause order:** `.With()` clause used after `.Times()` or `.WillOnce()` leads to runtime errors.
- **Mixing old and new macro styles:** May lead to compilation or subtle unexpected behavior.


---

## References

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical recipes including clause ordering and mocking best practices.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Details on macros and modifiers.
- [Breaking Changes](https://google.github.io/googletest/changelog/upgrade-guides/breaking-changes.html) — Related upgrade guide with examples.

---

## Summary

Deprecations and removals focus on replacing legacy macros, enforcing consistent clause ordering, making the default action in `ON_CALL` mandatory, and normalizing verbose flags. Migrating your test code along these lines improves test clarity, robustness, and forwards compatibility with GoogleTest/GoogleMock.


---

## Additional Notes

The changes described here are to enhance code safety and reduce the maintenance burden of tests. Proper adherence to the updated API and conventions will yield clearer failure diagnostics and more predictable mock behavior.


---

<Check>
Ensure your test code is updated before upgrading to avoid runtime failures due to stricter clause order enforcement and mandatory default actions in mocks.
</Check>

<Info>
For detailed migration examples and common pitfalls, please consult the [Breaking Changes documentation](https://google.github.io/googletest/changelog/upgrade-guides/breaking-changes.html).
</Info>