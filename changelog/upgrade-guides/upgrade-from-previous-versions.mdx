---
title: "Upgrade Guides"
description: "Step-by-step instructions for safely upgrading from previous GoogleTest or GoogleMock releases. Includes checkpoints, verification steps, and integration notes for minimizing friction during upgrades."
---

# Upgrade Guides

This guide provides detailed, step-by-step instructions to help you upgrade safely from previous GoogleTest or GoogleMock releases. It focuses on best practices, verification steps, checkpoints, and integration notes to minimize friction and ensure a smooth transition.

---

## 1. Preparing for an Upgrade

Before starting your upgrade, assess your current test environment and identify any deprecated APIs or breaking changes in the target version.

- Review the release notes for the version you want to upgrade to.
- Identify any impacted tests, mocks, or custom expectations.
- Back up your existing test code.

## 2. Upgrade Workflow

Upgrades are structured to keep your tests working consistently while you adopt new language features or fix deprecated behaviors. The typical workflow is:

### Step 1: Update Dependencies

- Pull or install the target version of GoogleTest and GoogleMock.
- Update your project build files (CMake, Bazel, etc.) to link against the new version.
- Verify build system compatibility, paying attention to platform-specific notes in the portability options documentation.

### Step 2: Adjust Include Statements

- Confirm all your test files and mock headers include `#include <gmock/gmock.h>` to use the latest API.

### Step 3: Review Mock Classes

- Ensure that all mocked methods use the modern `MOCK_METHOD` macro syntax for consistency and better diagnostics.
- If using legacy `MOCK_METHODn` macros, plan to migrate to `MOCK_METHOD` as per the Mock Classes guide.
- Verify that mock destructors are virtual to avoid leaks or unexpected behaviors.

### Step 4: Update Mocks Using Strictness Wrappers

- Identify whether you use naggy or default mocks.
- Consider wrapping your mocks with `NiceMock` or `StrictMock` templates to control uninteresting call behavior as described in the Nice, Strict, and Naggy wrappers guide.
- This change can reduce noisy warnings or enforce stricter test correctness.

### Step 5: Refactor Expectation Declarations

- Place all `EXPECT_CALL` statements before exercising mocks in your test code to comply with mocking expectations.
- Remove any expectations that alternate or appear after calls to mocks.
- Incorporate recommendations on ordering expectations and sequences to improve test reliability.

### Step 6: Validate Default Actions

- Review usage of `ON_CALL` to specify default mock behaviors where needed.
- Confirm that default return values are set appropriately and that you don't suppress legitimate warnings unintentionally.

### Step 7: Verify Behavioral Changes

- Run your existing test suite.
- Use `--gmock_verbose=info` for detailed insight into mock calls, expectations, and warnings during test runs.
- Investigate and fix any failing or flaky tests.

## 3. Verification Steps

- Use `Mock::VerifyAndClearExpectations(&mock_obj);` where you want to explicitly verify mock expectations before destruction.
- Employ `Mock::AllowLeak(&mock_obj);` if temporarily needed to suppress leaks for heap-allocated mocks.
- Confirm successful compilation and test runs under the new version.

## 4. Integration Considerations

- When upgrading in a large codebase:
  - Update shared mock classes in one location to reduce duplication.
  - Utilize adaptor interfaces when mocking third-party code to avoid brittle tests.
- Integrate upgrade tests incrementally if possible, using feature toggles.

## 5. Breaking Changes and Migration Notes

- Review breaking changes documented in the Breaking Changes & Migration Notes section.
- Pay attention to:
  - Legacy macro migrations to `MOCK_METHOD`.
  - Modifiers ordering in `EXPECT_CALL` (e.g., `Times()` before `InSequence()`).
  - Changes in cardinality and action clauses handling.
  - Updated behavior of call policy wrappers like `NiceMock` and `StrictMock`.
  - Support for ref-qualified mock methods.

Consult detailed migration instructions to update your existing tests accordingly.

## 6. Troubleshooting Common Issues

- Unexpected calls to mocks often indicate missing or misordered expectations.
- Uninteresting call warnings can be managed by using the appropriate mock wrappers.
- Use `--gmock_verbose=info` or `--gmock_verbose=warning` to monitor mock interactions.
- If encountering linker or compiler errors, refer to the Typical Build Errors FAQ.
- For flaky tests after upgrade, consult the Flaky and Slow Tests troubleshooting guide.

## 7. Additional Tips and Best Practices

- Write expectations conservatively: use `ON_CALL` by default, `EXPECT_CALL` only when verifying behavior.
- Use sequences and `.After()` clauses to enforce call order only when necessary.
- Prefer `NiceMock` to reduce noise during development and `StrictMock` when enforcing strict API usage.
- Delegate to fakes or real objects where beneficial to combine stateful behavior and interaction checks.
- Use `MockFunction` for mocking `std::function` callbacks when needed.

---

For more examples, upgrade scripts, and community advice, see:

- [Breaking Changes & Migration Notes](../breaking-deprecations/breaking-changes)
- [Deprecation Notices](../breaking-deprecations/deprecation-notices)
- [Handling Mock Call Policies (Nice, Strict, Naggy)](../api-reference/mocking-apis/nice-strict-mocks)
- [Setting Expectations and Actions](../api-reference/mocking-apis/mock-expectations-actions)

---

<Callout title="Pro Tip">
Always run your entire test suite with the upgraded version and the flag `--gmock_verbose=info` to gain insight into mock behaviors and unexpected calls. This empowers you to spot subtle incompatibilities early.
</Callout>

---

### Related Documentation

- [Defining and Using Mock Classes](../api-reference/mocking-apis/mock-classes-methods)
- [Using the Nice, Strict, and Naggy Wrappers](../api-reference/mocking-apis/nice-strict-mocks)
- [Controlling Test Execution flow](../api-reference/core-testing-apis/test-execution-control)
- [Setting Expectations and Actions](../api-reference/mocking-apis/mock-expectations-actions)

---

### Source Reference

You can view relevant tests that validate mock behavior and syntax compliance in the source test files:
- [gmock_spec_builders_test.cc](https://github.com/google/googletest/blob/main/googlemock/test/gmock-spec-builders_test.cc)
- [gmock_output_test_.cc](https://github.com/google/googletest/blob/main/googlemock/test/gmock_output_test_.cc)

---

This upgrade guide aims at making your transition smoother by anticipating typical pain points and providing actionable advice to maintain and enhance your test robustness.
