---
title: "New Features & Improvements"
description: "Highlights newly added capabilities and enhancements in each release, helping users quickly discover productivity-boosting updates and relevant changes to the framework's behavior."
---

# New Features & Improvements

Welcome to the detailed highlights of newly added capabilities and framework improvements introduced in each release of GoogleTest and GoogleMock. This changelog emphasizes the practical impact on your testing workflow, helping you quickly grasp enhancements that can boost your productivity, improve test expressiveness, and refine your mock behaviors.

---

## Recent Feature Additions

### Enhanced Mock Method Definitions
- **Flexible MOCK_METHOD macro**: Mock methods can now be declared with qualifiers such as `const`, `override`, `noexcept`, calling conventions (`Calltype`), and reference qualifiers (`ref(&)`, `ref(&&)`). This adaptation makes the mocking of modern C++ codebases seamless and precise.

- **Support for Class Templates**: Mocking template classes has been streamlined with the generic `MOCK_METHOD` macro supporting templates, enabling easy mocking of templated interfaces without awkward workarounds.

- **Overloaded Methods Handling**: Overloads are fully supported by disambiguation utilities like the `Const()` wrapper and explicit matcher typing to ensure proper expectation matching, preventing common compilation or runtime ambiguities.

### Improved Expectation and Action Specifications
- **Comprehensive EXPECT_CALL clauses**: From `.With()`, `.Times()`, `.InSequence()`, `.After()`, to `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`, the chaining syntax allows detailed control over mock call behaviors, ordering, and lifespan.
  - `.With()` supports multi-argument matching for fine-grained argument validation.
  - Sequence and ordering constructs (via `Sequence` and `InSequence`) allow expressing complex call orders without rigid, brittle tests.

- **Default Actions via ON_CALL**: The introduction of the `ON_CALL` macro lets you specify fallback behaviors on mock methods without imposing call expectations. This is vital for reducing test fragility and avoiding over-specification.

- **Support for Move-Only Types**: Mock methods now gracefully handle move-only types such as `std::unique_ptr`, providing direct syntax with `MOCK_METHOD` and lambda-based actions, boosting test coverage for modern C++ code.

### Stringent and Flexible Mock Behavior Modes
- The framework supports `NiceMock`, `NaggyMock`, and `StrictMock` wrappers that control uninteresting mock calls:
  - `NiceMock` suppresses warnings.
  - `NaggyMock` prints warnings (the default now, though planned to shift to nice in future).
  - `StrictMock` turns uninteresting calls into test failures.

These classes inherit from the original mock, preserving constructor arguments and interface compatibility, allowing seamless upgrades of test strictness levels.

### Advanced Matchers and Actions
- **Custom Matchers**: Use `MATCHER` and `MATCHER_P` macros to write expressive, domain-specific matchers that combine descriptive failure messages with concise syntax.
- **Composite and Polymorphic Matchers**: Easily compose matchers and define flexible matchers usable across types, allowing elegant argument validations.
- **Custom Actions and Action Templates**: Define new actions via lambdas, functors, or legacy `ACTION` macros with or without parameters, enabling complex mocking behaviors.
- **WithArgs & Invoke Variants**: These allow selective forwarding of mock arguments into custom actions or calls, improving clarity and code reuse.

### Verification and Diagnostics Enhancements
- **Automatic Expectation Verification** on mock object destruction continues to be reliable.
- Explicit API calls like `Mock::VerifyAndClearExpectations()` and `Mock::VerifyAndClear()` let you force verification and reset state early, useful for complex testing scenarios.
- Diagnostic verbosity controlled via the `--gmock_verbose=LEVEL` flag (`info`, `warning`, and `error`) with stack traces and detailed call reporting improves debuggability.

### Thread Safety and Concurrency
- gMock supports thread-safe invocation of mock methods.
- Limitations are documented for expectation setting and destruction in multithreaded contexts; users are encouraged to run *test code* in a single thread and access mocks in a coordinated manner.

### Miscellaneous Improvements
- **MockFunction for std::function**: Create mockable versions of `std::function` callbacks, simplifying testing code that uses modern callback styles.
- **Simplified Mock Interfaces**: Techniques enable mock classes to delegate to real or fake objects to combine mock verification with real behavior.
- **Mocking Non-virtual Methods** using template-based dependency injection unlocks new testing patterns.
- **Mocking Private and Protected Methods** enhanced by public `MOCK_METHOD` declarations in mocks.

---

## Practical Examples

### Defining a Mock Method with Qualifiers
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(std::string, Describe, (int type), (const, override, noexcept));
};
```

### Using EXPECT_CALL with Ordering and Actions
```cpp
Sequence s;
EXPECT_CALL(mock, DoThis(1))
    .InSequence(s)
    .WillOnce(Return(true));
EXPECT_CALL(mock, DoThis(2))
    .InSequence(s)
    .Times(AnyNumber());

mock.DoThis(1);  // Called first
mock.DoThis(2);  // Called after
```

### Delegating Calls to a Fake Object
```cpp
class FakeFoo : public Foo {
 public:
  char DoThis(int n) override { return n > 0 ? '+' : '-'; }
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(char, DoThis, (int n), (override));

  void DelegateToFake() {
    ON_CALL(*this, DoThis).WillByDefault([this](int n) {
      return fake_.DoThis(n);
    });
  }

 private:
  FakeFoo fake_;
};
```

---

## Troubleshooting Tips

- If you encounter unexpected or uninteresting call warnings, consider whether you need `EXPECT_CALL` statements or a `NiceMock` wrapper.
- Use `--gmock_verbose=info` to get detailed trace output of mock calls and expectation matching.
- Remember to set `EXPECT_CALL` *before* the mock methods are actually called to avoid undefined behavior.
- Use `Mock::VerifyAndClearExpectations()` to force verification if mocks are not destroyed at test end.
- When mocking move-only types, ensure you provide lambda actions or use `WillOnce(Return())` carefully, as `Return(std::move(...))` can be run only once.

---

## Additional Resources and Navigation

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for mocking syntax and APIs
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Authoritative API documentation
- [Guides on Using Mocks](https://google.github.io/googletest/guides/core-workflows/using-mocks.html) — Practical workflows and best practices
- [Custom Actions & Matchers](https://google.github.io/googletest/guides/advanced-usage-patterns/custom-matchers-actions.html) — Extending GoogleMock
- [Mock Behavior Modes](https://google.github.io/googletest/concepts/mocking-models/mock-behavior-modes.html) — Understanding Nice, Naggy, Strict mocks
- [System Setup & Installation](https://google.github.io/googletest/getting-started/prerequisites-installation/installation-instructions.html) — Ensuring your environment is ready

---

For a full history of changes, see the [Version History](https://google.github.io/googletest/changelog/releases-highlights/version-history.html).

---