---
title: "Feature Highlights"
description: "Showcases significant new features and improvements in major and minor releases, with practical examples and pointers to relevant parts of the documentation. This page helps teams stay abreast of what's possible with recent versions."
---

# Feature Highlights

This page highlights the most significant new features and improvements added to GoogleMock in recent major and minor releases. It focuses on practical value by outlining the capabilities that empower you to write better, more expressive, and maintainable tests. Each entry includes concrete examples and pointers to relevant detailed documentation.

---

## 1. Enhanced MOCK_METHOD Macro

The `MOCK_METHOD` macro remains the centerpiece for defining mock methods in mock classes. Recent improvements have expanded its flexibility and usability:

- **Support for Reference Qualifiers**: You can now specify method reference qualifiers such as `ref(&)` or `ref(&&)` when overriding methods with reference qualifiers.
- **Custom Calling Conventions**: The macro accepts `Calltype(...)` qualifier to specify calling conventions (e.g., `STDMETHODCALLTYPE`) useful for Windows platform compatibility.
- **Handling of Complex Return and Argument Types**: To address parsing problems with templates involving commas (e.g., `std::pair`, `std::map`), methods include the option to wrap types in parentheses or use type aliases, making your code more readable and less error-prone.

**Example:**

```cpp
class MyMock {
 public:
  // Mock a method with a complex return type wrapped in parentheses.
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  // Mock a method with custom calling convention.
  MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)));
};
```
[More about `MOCK_METHOD` macro](reference/mocking-apis/mock-object-creation.md#MOCK_METHOD)

## 2. Mocking Non-Virtual Methods with Template Argument Substitution

Previously, mocking non-virtual methods could be cumbersome. Now, gMock supports mocking non-virtual methods by defining mock classes unrelated to the original class but with matching method signatures. This enables high-performance dependency injection patterns and compile-time selection of mock or real classes.

**Practical use case:**

```cpp
class ConcreteStream { ... };  // Real class with non-virtual methods
class MockStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t), (const));
  MOCK_METHOD(size_t, NumberOfPackets, (), (const));
};

template <class StreamType>
void UseStream(StreamType* stream) { ... }

// Compile-time control: Use either ConcreteStream or MockStream.
UseStream<MockStream>(&mock_stream);
```

[Details on mocking non-virtual methods](gmock_cook_book.md#MockingNonVirtualMethods)

## 3. Strictness Wrappers: NiceMock, NaggyMock, and StrictMock

To better control test verbosity and failure sensitivity on uninteresting calls, gMock provides three wrappers for mock objects:

- **`NiceMock<T>`**: Suppresses warnings when mock methods are called without expectations.
- **`NaggyMock<T>`**: The default behavior, warns on uninteresting calls.
- **`StrictMock<T>`**: Treats uninteresting calls as failures, strictly enforcing expectations.

This lets you tune how much enforcement or noise you want from your mocks based on the test phase or debugging needs.

**Example:**

```cpp
using ::testing::StrictMock;
StrictMock<MockFoo> strict_mock;
EXPECT_CALL(strict_mock, DoSomething());
// Failure if any unexpected method is called.
```
[Understanding strictness wrappers](gmock_cook_book.md#NiceStrictNaggy)

## 4. Delegation Patterns

### Delegating Calls to a Fake or a Real Object

To combine comprehensive testing with realistic behavior:

- You can define mock classes that delegate their default actions to real or fake implementations.
- This preserves the behavior of the real object while capturing method calls for verification.
- Delegation enables incremental adoption of mocks or cases where full mocking is hard.

**Example: Delegate to a fake:**

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(char, DoThis, (int), (override));
  void DelegateToFake() {
    ON_CALL(*this, DoThis)
        .WillByDefault([this](int n) { return fake_.DoThis(n); });
  }
 private:
  FakeFoo fake_;
};
```

[Full guide to delegation](gmock_cook_book.md#DelegatingToFake)

### Delegating Calls to Parent Class

If needing to call the base class implementation of a concrete virtual method inside a mock's action (such as in `EXPECT_CALL`), you can explicitly use qualified calls:

```cpp
EXPECT_CALL(mock_foo, ConcreteMethod())
    .WillOnce([&mock_foo]() { return mock_foo.Foo::ConcreteMethod(); });
```

[More on delegating to parent](gmock_cook_book.md#DelegatingCallsToAParentClass)

## 5. Advanced Matcher Support

GoogleMock provides a comprehensive set of capabilities for matching method arguments which have been enhanced to maximize expressiveness, clarity, and correctness:

- **Combining Matchers**: Using standard logical combinators (`AllOf`, `AnyOf`, `Not`) to build complex argument expectation logic.
- **Safe Type Casting**: `SafeMatcherCast<T>(m)` lets you safely cast matchers for compatible but non-identical types.
- **Overload Resolution Helpers**: The `Const()` wrapper and explicit typed matchers assist with mocking overloaded methods.
- **Custom Matchers & Parameterized Matchers**: Easy macros like `MATCHER`, `MATCHER_P` and full custom matcher classes allow precise control over matching semantics and failure messages.

**Example: Matching a container with certain contents:**

```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _, 5)));
```

[Matchers overview](api-reference/mocking-apis/matchers.md)

## 6. Setting Expectations and Managing Call Ordering

You can control the expected calls to mocks meticulously, specifying:

- **Call Counts**: Using `Times()` with cardinalities such as `Exactly(n)`, `AtLeast(n)`, or `AnyNumber()` to limit call frequency.
- **Call Order**: Enforce ordering with:
  - `InSequence` blocks for strict order.
  - `After()` clauses for partial ordering dependencies.
  - `Sequence` objects to represent complex DAGs of call constraints.
- **Retiring Expectations**: Using `.RetiresOnSaturation()` to automatically retire expectations once called the required times, allowing other expectations to match subsequent calls.

**Example:**

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Step1());
  EXPECT_CALL(mock, Step2());
}
```

[See detailed rules for expectations](reference/mocking-apis/expectations-cardinalities.md#EXPECT_CALL)

## 7. Rich Action Support

Actions determine what happens during a mock method call. The action framework includes:

- **Built-in Actions**: Return values (`Return`, `ReturnRef`), side effects (`SetArgPointee`, `SetArrayArgument`), invoking callables (`Invoke`, `InvokeWithoutArgs`), and argument invocations (`InvokeArgument`).
- **Combining Actions**: `DoAll()` to sequence multiple actions, allowing side effects and return values within one call.
- **Lambdas and Callables**: Use lambdas and functions as flexible actions directly, supporting move-only types and complex logic.

**Example: Setting an output argument and returning a value:**

```cpp
EXPECT_CALL(mock, Compute(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(42), Return(true)));
```

[Explore the full action API](api-reference/mocking-apis/actions-and-return-values.md)

## 8. Simplifying Mock Interfaces

To make mocks easier to maintain, you can simplify interfaces without changing external behavior:

- **Redispatching Methods**: Introduce a mock method with a simpler signature that delegates from the complex real method.
- **Use Helper Methods**: Allows tests to focus on important parameters without tedious matching for unchanging arguments.

**Example:**

```cpp
class ScopedMockLog : public LogSink {
 public:
  void send(...complex args...) override {
    Log(severity, full_file_name, std::string(message, message_len));
  }
  MOCK_METHOD(void, Log, (LogSeverity, const string&, const string&));
};
```

[More about interface simplification](gmock_cook_book.md#SimplerInterfaces)

## 9. Efficient Compilation and Test Maintenance

- Moving mock class constructors and destructors out of header files into translation units speeds compilation.
- Using `Mock::VerifyAndClearExpectations()` explicitly enforces verification when mock lifetimes are not certain.
- `NiceMock` and `StrictMock` allow adjusting test robustness and warning verbosity to balance maintenance and enforcement.

**Tip:** Organize mock definitions considering ownership and maintenance to avoid test breakage due to interface changes.

## 10. Diagnostic Enhancements

When tests fail or unexpected calls occur, GoogleMock generates rich diagnostic output:

- Prints matched and unmatched expectations, argument mismatches, and call order violations.
- Displays stack traces with `--gmock_verbose=info` to pinpoint origin of calls.
- Offers mechanisms to selectively suppress warnings or treat them as errors.

This diagnostic transparency speeds debugging and clarifies test intent.

---

For comprehensive details, examples, and best practices on each topic, please consult the following primary documentation:

- [gMock Cookbook](gmock_cook_book.md) â€” recipes and patterns
- [Mocking Reference](reference/mocking-apis/mock-object-creation.md & expectations-cardinalities.md)
- [Matchers Reference](api-reference/mocking-apis/matchers.md)
- [Actions Reference](api-reference/mocking-apis/actions-and-return-values.md)
- [gMock for Dummies Tutorial](gmock_for_dummies.md)
- [Legacy gMock FAQ](docs/gmock_faq.md)

Understanding and mastering these features will empower you to create robust, maintainable, and expressive tests that effectively validate your C++ code's behavior and interactions.

---

Source code for Google Mock is available at [https://github.com/google/googletest](https://github.com/google/googletest).

<Callout>
For further learning, check out the guides on [Getting Started with GoogleMock](guides/getting-started-workflows/mocking-basics.md), the [gMock Cheat Sheet](docs/gmock_cheat_sheet.md), and integration best practices.
</Callout>
