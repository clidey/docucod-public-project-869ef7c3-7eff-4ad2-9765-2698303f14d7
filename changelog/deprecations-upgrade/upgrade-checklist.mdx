---
title: "Upgrade Checklist"
description: "A practical, actionable checklist for safely upgrading GoogleTest/GoogleMock versions, verifying environment compatibility, and preemptively addressing deprecated or changed features."
---

# Upgrade Checklist

This checklist guides you through the essential steps to safely upgrade GoogleTest and GoogleMock versions. It targets users who want to verify environment compatibility and prepare their codebase for deprecated or changed features, ensuring a smooth migration without surprises.

---

## 1. Verify Environment Compatibility

Before upgrading GoogleTest/GoogleMock, confirm your development environment supports the minimum requirements:

- **C++ Standard:** Minimum C++17 support is required starting from version 1.17.x.
- **Supported Platforms:** Linux, Windows, macOS with compatible compilers.
- **Threading Support:** Ensure pthreads or equivalent threading support is available.
- **Build Tools:** CMake 3.14 or later for easier integration.

Refer to the [System Requirements](https://github.com/google/googletest/blob/main/docs/getting-started/prerequisites-installation/system-requirements.md) before proceeding.

---

## 2. Review Deprecated Features and Update Code

**Important:** Some legacy macros and patterns are deprecated and must be replaced:

- Replace older `MOCK_METHODn` macros with the modern `MOCK_METHOD` macro, which provides a cleaner and more consistent interface for defining mock methods.
- Transition from legacy `ACTION` macros to lambda or callable-based actions that integrate better with modern C++ and provide improved type safety.

Check out the [Deprecation Notices](https://github.com/google/googletest/blob/main/changelog/deprecations-upgrade/deprecation-notices.md) for a detailed timeline and migration advice.

---

## 3. Validate Mock Method Definitions

- Ensure all mocked methods use the new `MOCK_METHOD` macro.
- Verify correct handling of **const**, **override**, and other specifiers consistent with the base class.
- Wrap return or argument types containing commas in parentheses or use type aliases to avoid parsing errors.

Example:

```cpp
class MockExample {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, (), (override));
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool), (override));
};
```

---

## 4. Check Use of `ON_CALL` vs. `EXPECT_CALL`

- `ON_CALL` defines default behavior without setting expectations.
- `EXPECT_CALL` sets expectations on calls and their arguments.
- Use `ON_CALL` primarily to reduce test brittleness by not over-constraining mocks.

Avoid excessive `EXPECT_CALL`s as they can cause fragile tests that break easily with internal code changes.

---

## 5. Review Expectation Clause Ordering

The ordering of expectation clauses in `EXPECT_CALL` is crucial and enforced by GoogleMock:

- `.With()` must appear first (if used) and at most once.
- `.Times()` can appear at most once and must appear before `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, or `.RetiresOnSaturation()`.
- Multiple `.WillOnce()` clauses can be chained, followed optionally by one `.WillRepeatedly()`.
- `.RetiresOnSaturation()` can appear only once and last.

Incorrect ordering results in runtime errors. Inspect your tests and adapt any expectations accordingly.

---

## 6. Sequence and Order Constraints

- Use `InSequence` or `.InSequence()` clause to enforce strict ordering on expected calls.

Example:

```cpp
{
  testing::InSequence s;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

- Use `.After()` to specify partial order dependencies among separate expectations.

---

## 7. Handling Uninteresting Calls

- By default, uninteresting calls (methods without expectations) generate warnings.
- Use `NiceMock<T>` to suppress warnings for uninteresting calls.
- Use `StrictMock<T>` to turn such warnings into test failures.

Be cautious with `StrictMock` as overly strict mocks increase test brittleness.

---

## 8. Testing Mock Behavior and Verification

- GoogleMock automatically verifies mock expectations on destruction.
- To force early verification, call `Mock::VerifyAndClearExpectations(&mock_obj)`.
- Avoid setting expectations after verification, as this leads to undefined behavior.

---

## 9. Common Pitfalls & Tips

- Avoid mocking classes you donâ€™t own unless necessary; if unavoidable, place mocks near the authority.
- Use `RetiresOnSaturation()` to prevent expectations from matching calls beyond their saturation.
- When mocking methods returning references, use `ReturnRef()`.
- For move-only types (e.g., `std::unique_ptr`), use lambdas or callable objects instead of `Return()` with moved objects.
- Carefully manage matcher purity: matchers must be free of side effects.

---

## 10. Run Existing Tests and Debug

- Run the official GoogleMock test suite and your own tests with `--gmock_verbose=info` to get detailed mock call traces.
- Check for warnings and adjust your mock specifications accordingly.
- Use IDEs and tools like Emacs with integration for easy navigation to failing expectations.

Refer to the [Verifying Your Installation](https://github.com/google/googletest/blob/main/docs/getting-started/first-test-workflow/verifying-installation.md) guide.

---

## 11. Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): A beginner-friendly guide to mocking concepts.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Detailed API and usage of mocking macros.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes and patterns for effective mocking.
- [Changelog and Migration Guides](https://github.com/google/googletest/tree/main/changelog): Keep updated with release notes and breaking change info.

---

## 12. Troubleshooting Common Issues

- Failed compilations due to macro parsing need parentheses around complex types or type aliases.
- Unexpected call failures often indicate argument matcher mismatches or missing expectations.
- Use verbose mode (`--gmock_verbose=info`) to diagnose which expectations triggered or failed.
- Be aware of thread-safety rules when setting expectations or calling mocks in multithreaded tests.

---

By following this checklist carefully, you will ensure a smooth GoogleTest/GoogleMock upgrade experience and maintain reliable, maintainable test suites.

<Check>
Always backup your existing test code before performing an upgrade.
</Check>

<Note>
Review the deprecation path and replace all legacy constructs to future-proof your tests.
</Note>