---
title: "What's New: Major Features & Improvements"
description: "Detail the most impactful additions and enhancements introduced in recent releases, such as new test paradigms, advanced assertions, or enhanced platform support. Empowers users to adopt the latest features with confidence."
---

# What's New: Major Features & Improvements

Stay up to date with the most impactful additions and enhancements introduced in recent releases of GoogleTest and GoogleMock. This page empowers you to confidently adopt and leverage the latest features designed to simplify your C++ testing and mocking workflows.

---

## Advanced Mocking Capabilities

### 1. Enhanced Mock Method Declarations with `MOCK_METHOD`
The `MOCK_METHOD` macro now supports a wider range of method qualifiers and calling conventions to precisely match your code's signature:
- **Const-qualified methods**: Mock methods overriding `const` methods can use `(const)` in the specification.
- **Override specifier**: Use `(override)` to denote overridden virtual methods.
- **Noexcept support**: Methods declared `noexcept` are supported via `(noexcept)` in the specifiers.
- **Calling conventions**: Windows-specific calling conventions can be specified with `Calltype(...)`.
- **Reference qualifiers**: Such as `ref(&)` or `ref(&&)` to mock methods with reference qualifiers.

This comprehensive support preserves semantics and ensures mocks behave identically to their real counterparts.


### 2. Support for Move-only Types in Mock Methods
Mocking methods with move-only arguments (`std::unique_ptr` and similar) or return types is now fully supported. This means you can define mock classes for interfaces using modern C++ move semantics without workarounds:

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz, int64_t timestamp), (override));
};
```

Further, you can specify actions that produce new move-only instances dynamically using lambdas for every invocation:

```cpp
EXPECT_CALL(mock_buzzer_, MakeBuzz("x"))
    .WillRepeatedly([](StringPiece text) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```


### 3. More Expressive Expectation Specification with `EXPECT_CALL`
The `EXPECT_CALL` macro includes a refined, expressive suite of clauses to precisely frame your mock expectations:

- `.With(...)` allows matching of arguments as a tuple-based multi-argument matcher for sophisticated validations.
- `.Times(...)` lets you specify exact, bounded, or fuzzy call cardinalities (`Exactly`, `AtLeast`, `Between`, or `AnyNumber`).
- `.InSequence(...)` and `InSequence` scoping enforce strict or partial ordering among multiple calls.
- `.After(...)` lets you specify dependencies that a call must happen after one or more other expectations.
- `.WillOnce(...)` and `.WillRepeatedly(...)` designate sequences of actions the mock should perform on calls.
- `.RetiresOnSaturation()` controls when an expectation stops matching calls after fulfilling its occurrence limit.

These capabilities let you craft mock behavior fitting production realities and test intent.


### 4. Distinguishing Between Uninteresting and Unexpected Calls
GoogleMock now clearly differentiates calls that are:

- **Uninteresting** — methods with no expectation specified.
- **Unexpected** — methods with expectations set, but called outside the expected arguments or frequency.

By default, uninteresting calls generate warnings but do not fail tests. You can tailor this behavior with:

- `NiceMock<T>` to suppress warnings for uninteresting calls.
- `NaggyMock<T>` (default) to warn on uninteresting calls.
- `StrictMock<T>` to treat uninteresting calls as errors.

This lets you calibrate the strictness of your tests to balance robustness with maintenance.


### 5. Default Actions Setup with `ON_CALL`
The `ON_CALL` macro lets you define default behavior for mock methods without asserting call expectations. It's invaluable for setting general mock responses while keeping your tests focused and robust.

Example:

```cpp
ON_CALL(mock, Foo(_, _))
    .With(Lt())
    .WillByDefault(Return(true));
```

This expresses that when `Foo` is called with ordered arguments, it returns `true` by default but does not impose call count requirements.


### 6. Delegation Patterns for Fakes and Real Objects
You can now cleanly integrate existing fake implementations or real objects with mock classes by delegating default actions, combining the benefits of verified behavior with real-world correctness.

**Example: Delegating to a fake**

```cpp
void DelegateToFake() {
  ON_CALL(*this, DoThis).WillByDefault([this](int n) { return fake_.DoThis(n); });
}
```

**Example: Delegating to a real object**

```cpp
ON_CALL(foo, Concrete).WillByDefault([&foo](const char* str) {
  return foo.Foo::Concrete(str);
});
```


### 7. Advanced Actions Using Callables and Lambdas
New ways to define mock actions simplify specifying behavior:

- Use lambdas or function objects directly in `.WillOnce()` and `.WillRepeatedly()`.
- Use `Invoke()`, `InvokeWithoutArgs()`, and `InvokeArgument<N>()` to call external functions or arguments provided to the mock.
- Chain actions with `DoAll()` to combine side effects and return values succinctly.
- Use `IgnoreResult()` when you want to disregard the return value of a callable.

These patterns empower concise, readable, and flexible mock behaviors aligned with your test logic.


### 8. Polymorphic Matchers and Actions
Custom matchers and actions can now be polymorphic, letting you specify behavior that adapts to multiple argument types without boilerplate:

- Define polymorphic matchers with template-based `MatchAndExplain()` methods.
- Use `MakePolymorphicMatcher()` and `MakePolymorphicAction()` to turn implementations into versatile matchers/actions.

This increases reuse and expressiveness of your custom verification logic.


### 9. Better Reporting and Verbosity Control
The `--gmock_verbose` flag controls the detail level of mock call reporting:

| Level   | Description                           |
|---------|-------------------------------------|
| `info`  | Shows all mock call matches, including stack traces. Ideal for deep debugging.
| `warning` | Default: shows warnings and errors without stack trace for uninteresting calls.
| `error` | Only shows errors, suppressing info and warnings.

This allows you to troubleshoot your expectations with precision and avoids noisy output during normal test runs.


### 10. Verification and Leak Detection Improvements
- Automatic verification of all expectations when mock objects are destroyed ensures your tests validate interaction contracts.
- You can explicitly invoke verification earlier using `Mock::VerifyAndClearExpectations()` or `Mock::VerifyAndClear()`.
- GoogleMock detects leaked mock objects that were never deleted and reports errors to prevent silent test coverage failures.
- You may opt to allow leaks explicitly with `Mock::AllowLeak()`, in exceptional cases where the mock must remain alive.


## Practical Examples

```cpp
// Defining a mock method with advanced specifiers
class MockTurtle : public Turtle {
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Setting expectations with Times and WillOnce
MockTurtle mock;
EXPECT_CALL(mock, GetX())
    .Times(3)
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));

// Defining default behavior with ON_CALL
ON_CALL(mock, Forward(Ge(50)))
    .WillByDefault(Return());

// Using sequences for ordered calls
{
  InSequence seq;
  EXPECT_CALL(mock, PenDown());
  EXPECT_CALL(mock, Forward(100));
  EXPECT_CALL(mock, PenUp());
}

// Delegating calls to a fake
class FakeTurtle : public Turtle {
  ...
};
class MockTurtle : public Turtle {
 public:
  MockTurtle() { 
    ON_CALL(*this, Forward).WillByDefault([this](int d) { return fake_.Forward(d); });
  }
  MOCK_METHOD(void, Forward, (int distance), (override));
 private:
  FakeTurtle fake_;
};

// Using strict and nice mocks
StrictMock<MockTurtle> strict_mock;  // Errors on uninteresting calls
NiceMock<MockTurtle> nice_mock;      // Silences uninteresting call warnings

// Complex actions with lambdas
EXPECT_CALL(mock, GetX())
    .WillOnce([] { return 42; })
    .WillRepeatedly([] { return 0; });

// Custom matcher usage
EXPECT_CALL(mock, GoTo(_, _))
    .With(Lt());  // Ensures first arg less than second
```


## Tips & Best Practices

- Always specify `EXPECT_CALL` *before* the code under test interacts with mocks to ensure reliable verification.
- Use `ON_CALL` to set default behavior when you don't need to verify the call count.
- Prefer `NiceMock<T>` to silence noise from uninteresting calls unless you want stricter test verification.
- Use `RetiresOnSaturation()` to make expectations retire immediately after matching their call limit to avoid upper-bound violations.
- Control verbosity with `--gmock_verbose` during test development for better transparency.
- Delegate to real or fake objects to reduce duplication and improve test maintainability.


## Troubleshooting

### Unexpected Call Errors
If you see errors about unexpected calls:
- Verify your `EXPECT_CALL` matchers are correctly specified.
- Use `--gmock_verbose=info` to trace how calls match expectations.

### Excessive Calls Errors
If a method is called more times than expected:
- Add `RetiresOnSaturation()` if calls after the limit should match a more general expectation.
- Increase the expected call count using `.Times()` or `.WillRepeatedly()`.

### Uninteresting Call Warnings
If you get warnings about uninteresting calls:
- Add an `EXPECT_CALL` with `.Times(AnyNumber())` to indicate calls are expected but not verified.
- Alternatively, use `NiceMock` to suppress these warnings.

### Leaked Mock Objects
If tests detect leaked mocks:
- Ensure mocks are deleted properly.
- Use `Mock::AllowLeak()` if intentional.

---

## Related Documentation

- [Creating and Using Mocks](../guides/gmock-mocking-patterns/creating-mocks.md): Step-by-step mock class creation.
- [Matchers and Custom Matchers](../api_reference/mocking_and_matchers/matchers_and_custom_matchers.md): Detailed matcher usage.
- [Actions and Side Effects](../api_reference/mocking_and_matchers/actions_and_side_effects.md): Built-in and custom actions.
- [Call Expectations and Cardinalities](../api_reference/mocking_and_matchers/call_expectations_and_cardinalities.md): Precise call count controls.
- [The Nice, the Strict, and the Naggy](../guides/gmock-mocking-patterns/controlling-mock-behavior.md): How to select mock strictness.

Use these resources to deepen your mastery and exploit GoogleMock's powerful capabilities for robust, maintainable C++ testing.

---

# Changelog Navigation
- For a chronological overview of releases see [Release Overview & Timeline](/changelog/version-highlights/all-releases).
- For breaking changes and migration guidance see [Breaking Changes & Deprecations](/changelog/compatibility-migration/breaking-changes).
- For maintenance and bug fixes see [Bug Fixes & Minor Updates](/changelog/bugfixes-patches/bug-fixes).


---

# Summary
This page highlights key new features and improvements in recent GoogleTest/GoogleMock releases, focusing specifically on major mocking capabilities such as enhanced mock method macros, support for move-only types, expressive expectation syntax, default action controls, and better user experience through verbosity controls and leak detection. It empowers developers to write clearer, more robust C++ tests with increased confidence and flexibility.

---