---
title: "Breaking Changes"
description: "Lists all incompatible changes introduced in each release, with context on affected APIs, features, and typical scenarios impacted. Ensures development teams are aware of risks and can proactively adjust their codebases."
---

# Breaking Changes

This page details all incompatible changes introduced in each GoogleTest and GoogleMock release. Understanding these breaking changes is crucial for development teams to proactively adapt their test codebases and avoid integration pitfalls.

---

## Understanding Breaking Changes

Breaking changes involve modifications to GoogleTest APIs, features, or behaviors that may cause existing test code to fail to compile or produce different outcomes without code modifications. This includes changes in method signatures, removed or renamed components, altered behavior in matchers, actions, macros, or changes in expectation semantics.

Development teams should monitor this page closely during upgrades and follow the migration guidance provided for each breaking change to ensure smooth transitions.

---

## Notable Breaking Changes in Recent Releases

### Changes in Mocking Macros and Methods

- **Transition from Old-Style `MOCK_METHODn` macros to the new `MOCK_METHOD`**
  - The new macro syntax is more consistent and supports additional qualifiers such as `noexcept`, `Calltype(...)`, and reference qualifiers `ref(&)` and `ref(&&)`.
  - Users must update all old-style mocks to the new syntax to leverage new features and avoid incompatibilities.

- **Wrapping argument or return types with parentheses**
  - Types containing commas must be wrapped in parentheses in `MOCK_METHOD` to parse correctly. Example:

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```

  - Failure to do so results in compilation errors.

- **Support for `noexcept` specifier**
  - Mock methods overriding `noexcept` functions must explicitly declare the `noexcept` qualifier in their mock method definitions.

- **Handling of Reference-Qualified Methods**
  - For mocking methods qualified with `&` or `&&`, use the `ref(&)` or `ref(&&)` specifiers in the `MOCK_METHOD` macro:

  ```cpp
  MOCK_METHOD(int, RefQualifiedMethod, (), (const, ref(&), override));
  MOCK_METHOD(int, RefQualifiedMethod, (), (ref(&&), override));
  ```

### Expectation Ordering and Sequence Modifications

- **Reverse order precedence leftover note**
  - Expectations are matched in reverse declaration order to allow overriding behavior. This behavior remains unchanged but requires careful ordering of expectations to avoid shadowing.

- **`RetiresOnSaturation()` semantics enforcement**
  - When used, expectation retirement occurs immediately upon saturation to avoid unexpected excess calls.

- **`After()` and `InSequence()` clauses**
  - Must be used following precise idioms. For example, `After()` cannot be placed after `WillOnce()` or `InSequence()` clauses.

- **`With()` clause constraints**
  - Must be the first clause following `EXPECT_CALL` or `ON_CALL`, and may appear only once.

### Matchers and Actions Enhancements Impacting Compatibility

- **Matchers now require purity**
  - Matchers must be purely functional without side effects as gMock may invoke them multiple times or out of expected order.

- **Matchers using `SafeMatcherCast<T>()`**
  - Enforced at compile time to ensure type safety and prevent unsafe conversions.

- **Introduction of polymorphic matchers and actions**
  - Users must ensure custom matchers and actions implement or adapt to the polymorphic interface correctly.

### Default Behavior Changes for Uninteresting and Unexpected Calls

- **Uninteresting calls warning levels and behavior became pluggable**
  - By default, uninteresting calls generate warnings. Using `NiceMock` suppresses them, while `StrictMock` converts them to errors.

- **Default actions for methods with no explicit ON_CALL or EXPECT_CALL**
  - Default return values for non-void returns follow `DefaultValue<T>::Set()` if specified, else default construction or zero return for primitives.

- **Additional diagnostics and stack traces on failures**
  - When verbosity is set to `info`, gMock provides detailed call traces aiding failure analysis.

---

## Migration Guidance

To safely upgrade to newer versions of GoogleTest and GoogleMock with breaking changes, follow these steps:

1. **Audit all mock classes:**
   - Refactor all mock method declarations to use the new `MOCK_METHOD` macro syntax.
   - Wrap complex argument or return types with parentheses as needed.
   - Specify method qualifiers explicitly (`const`, `noexcept`, `Calltype`, `ref`).

2. **Review mock expectations:**
   - Ensure that clauses like `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, and `.WillRepeatedly()` are used in the right order.
   - Add `.RetiresOnSaturation()` where expected call saturation should deactivate expectations.
   - For overloaded methods, help disambiguate by using `Const()` or `TypedEq<>()` as appropriate.

3. **Update custom matchers and actions:**
   - Verify all custom matchers are pure functions with no side effects.
   - Adapt custom actions to new polymorphic interfaces if applicable.

4. **Handle uninteresting and unexpected calls:**
   - Use `NiceMock` to suppress warning noise if needed during transition.
   - Use catch-all expectations (`EXPECT_CALL(...).Times(AnyNumber())`) for methods where all calls are expected.
   - Check default values for return types and adjust default actions using `ON_CALL` or `DefaultValue<T>::Set()` to avoid surprising results.

5. **Test thoroughly:** Run the full test suite with increased verbosity (`--gmock_verbose=info`) to catch any unanticipated issues.

6. **Consult related documentation sections:**
   - [Mocking Reference](../reference/mocking.md) for detailed usage of mock macros and expectations.
   - [gMock Cookbook](../gmock_cook_book.md) for advanced mocking patterns and migration examples.

---

## Troubleshooting Common Breaking Changes

### Common Issue: Compilation errors due to comma-containing argument or return types

**Solution:** Always surround such types with parentheses in `MOCK_METHOD` declarations.

### Common Issue: Ambiguous method overloads in EXPECT_CALL

**Solution:** Use `Const()` wrapper for const overloads, or `TypedEq<>()` and `Matcher<type>()` to specify the exact overload.

### Common Issue: Unexpected failures on call count or order violations

**Solution:** Review call ordering clauses (`InSequence()`, `After()`) and cardinality clauses (`Times()`). Use `.RetiresOnSaturation()` if repeated calls should deactivate an expectation.

### Common Issue: Uninteresting call warnings are noisy

**Solution:** Use `NiceMock` wrappers around mock objects to suppress warnings, or specify expectations to cover all calls.

### Common Issue: Default return values not as expected

**Solution:** Customize default return values with `::testing::DefaultValue<T>::Set()` or specify default actions with `ON_CALL()`.

---

## Summary

This page consolidates incompatible changes that affect the usage of GoogleTest and GoogleMock, focusing on mock method declarations, expectation syntax, matcher purity, action definitions, and behavior of unexpected or uninteresting calls. The migration guidance provides actionable steps to adapt codebases smoothly.

---

## Additional Resources

- [GoogleTest Changelog - Previous Releases](./previous-releases)
- [Breaking Changes and Migration Guidance Overview](./breaking-changes)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](../reference/mocking.md)
- [Writing Your First Test](../guides/getting-started/writing-your-first-test.mdx)

---

For detailed explanations with practical examples, always refer to the official guides to stay aligned with best practices and future-proof your use of GoogleTest and GoogleMock.