---
title: "Breaking Changes"
description: "A curated summary of incompatible or disruptive changes made in recent versions. The page details deprecated APIs, removed functions, mandatory C++ standard bumps, and changes that could disrupt build or test behavior."
---

# Breaking Changes

This page provides a curated summary of incompatible or disruptive changes introduced in recent versions of GoogleMock. These changes include deprecated APIs, removed functions, required updates to the C++ standard compliance, and any modifications that could impact your build or test behavior. Understanding these changes helps you plan upgrades and maintain your test suites with confidence.

---

## 1. Deprecated APIs and Removed Functions

- **Old Mocking Macros Deprecated**: The legacy `MOCK_METHODn` family (e.g., `MOCK_METHOD1`, `MOCK_CONST_METHOD2_T`) has been superseded by the generic `MOCK_METHOD` macro supporting full C++11 and beyond syntax. You should migrate to `MOCK_METHOD` as the older macros may be removed in future releases.

- **Disallowed Nested Strictness Modifiers**: Wrapping a mock class in multiple strictness modifiers like nested `NiceMock<StrictMock<...>>` is no longer supported. Such usage will result in compilation errors. Only one level of `NiceMock`, `NaggyMock`, or `StrictMock` is allowed.

- **Removal of Macro Conflicts**: GoogleMock now safely handles macro redefinitions of method names, such as in Windows API headers (e.g., `#define Method MethodW`), but you should avoid redefining mock method names manually to prevent conflicts.

## 2. C++ Standard Compatibility Requirements

- **Minimum C++17 Standard**: GoogleMock now requires C++17 or later. Compilers and build systems must be updated accordingly to avoid compilation or linkage errors.

- **Support for Non-Moveable Return Types in Mocks**: For methods returning non-moveable types (e.g., those deleted move constructors), GoogleMock now supports mocking using `MOCK_METHOD` with proper handling. This requires your build environment to fully support C++17 features.

## 3. Changes in Expectation and Default Behavior Handling

- **Evaluation of Arguments in `EXPECT_CALL` and `ON_CALL`**: The macro arguments to `EXPECT_CALL` and `ON_CALL` are strictly evaluated exactly once to prevent unexpected side effects. Avoid writing expressions with side effects as arguments.

- **Modifiers Order Restrictions**: The order of clauses in `EXPECT_CALL` has become strictly enforced. For instance, `.With()` must appear before `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`. Violating this order will result in runtime errors or warnings.

- **Default Action Requirements**: Every `ON_CALL` statement must specify `.WillByDefault()`. Omitting this will cause test failures. This ensures mock methods have defined default behaviors to avoid undefined return values.

## 4. Mock Object Wrappers Behavior

- **NiceMock, NaggyMock, and StrictMock**: These wrappers now guarantee strict compile-time checking against multiple applications. Applying more than one to the same mock class is an error.

- **Virtual Destructors Requirement**: Mock classes must have virtual destructors for correct behavior with `NiceMock` and `StrictMock`. Non-virtual destructors may result in incorrect cleanup and test failures.

## 5. Test Flow and Failure Messaging Enhancements

- **Extended Verbosity Control**: The `--gmock_verbose` flag now supports granular control over mock call diagnostics, including options to suppress or include stack traces and match details.

- **Detecting Exhausted Actions**: GoogleMock emits warnings when all `.WillOnce()` actions for an expectation are exhausted but additional calls occur, falling back to default actions. This helps detect mismatches between expected and actual call counts.

- **Improved Failure Messages for Unexpected Calls**: Failure diagnostics now include detailed argument mismatches, expectation states (retired, unsatisfied), and partial order violations for `.After()` and `.InSequence()` clauses.

## 6. Migration Tips

- When upgrading, replace all `MOCK_METHODn` macros with the unified `MOCK_METHOD` macro.

- Review and fix any violation of method qualifier and modifiers order in `EXPECT_CALL` and `ON_CALL`.

- Update your build environment to use C++17 or later standards.

- Audit your use of `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to prevent nesting.

- Check all `ON_CALL` usages to ensure `.WillByDefault()` is present.

- Verify all mock classes have virtual destructors.

- Utilize the `--gmock_verbose` flag during test debugging to identify issues with expectations and calls.

## 7. Helpful References

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Full API details on mocking methods, expectations, and actions.

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipe-style guidance on common and advanced mocking scenarios.

- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html): Troubleshooting common legacy issues and understanding mock behaviors.

- [Best Practices for GoogleMock](https://google.github.io/googletest/gmock_best_practices.html): Recommendations for writing maintainable and scalable mock-based tests.

---

### Example: Migrating a Legacy MOCK_METHOD Macro

```cpp
// Before (may be deprecated):
class MockFoo : public Foo {
 public:
  MOCK_METHOD1(DoSomething, bool(int x));
  MOCK_CONST_METHOD0(GetValue, int());
};

// After (recommended):
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, DoSomething, (int x), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
};
```

### Example: Correct Order of Expectation Clauses

```cpp
EXPECT_CALL(mock, Method(_))
    .With(AnyArgsMatcher())  // Must be first if used
    .Times(2)
    .InSequence(seq)
    .After(other_expectation)
    .WillOnce(Return(1))
    .WillRepeatedly(Return(2))
    .RetiresOnSaturation();  // Must be last
```

### Example: Using StrictMock

```cpp
using ::testing::StrictMock;
StrictMock<MockFoo> mock;
EXPECT_CALL(mock, Method()).Times(1);
// Any call to mock.Method() without expectation causes test failure
```

---

This page ensures that you are prepared for changes that could affect your test suites and build pipelines due to updates in GoogleMock. Careful attention to these breaking changes will help maintain stable and robust tests.
