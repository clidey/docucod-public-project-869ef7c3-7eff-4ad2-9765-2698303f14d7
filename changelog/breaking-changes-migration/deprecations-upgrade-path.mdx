---
title: "Deprecation Notices & Upgrade Path"
description: "Details deprecations, removed APIs, and the recommended approach to upgrading your test code. This page provides forward-looking guidance to help users align with the current and future state of GoogleTest and GoogleMock."
---

# Deprecation Notices & Upgrade Path

This page details the deprecations, removed APIs, and recommended upgrade strategies specifically for GoogleTest and GoogleMock. Keeping your test code aligned with the evolving framework ensures smooth maintenance, compatibility with new versions, and access to the latest features.

---

## Understanding Deprecations

GoogleTest and GoogleMock evolve continuously to improve performance, usability, and correctness. As part of this evolution, some APIs or behaviors become deprecated before being removed entirely. Deprecation indicates that an API or feature:

- Is no longer recommended for use
- May be removed in a future release
- Has a better or safer alternative available

When a deprecation is announced, you should plan to update your code accordingly.

### Typical Deprecations in GoogleTest and GoogleMock

- **Legacy Mock Declaration Macros:** The older `MOCK_METHODn` and `MOCK_CONST_METHODn` macros are deprecated in favor of the generic `MOCK_METHOD` macro, which provides better syntax, flexibility, and support for modern C++ language features.

- **Old Matchers and Actions:** Certain legacy matchers or actions have been superseded by newer, more expressive forms. Prefer built-in and custom matchers defined via `MATCHER`, `MATCHER_P`, or polymorphic matchers.

- **Strictness Wrappers and Behavior Changes:** Some strictness wrapper behaviors (e.g., `NiceMock`, `NaggyMock`, `StrictMock`) have undergone changes to improve clarity and reduce unexpected warnings or failures.

- **Deprecation of Legacy Flag Interfaces:** Some legacy flags or internal macros have been replaced by more robust flag handling, especially when integrated with Abseil.

- **Mocking Destructors Pattern:** The recommended approach to testing destructor calls is to add a mock method (e.g., `Die()`) and call it from the destructor, rather than attempting to mock the destructor directly.

## Removed or Changed APIs

GoogleTest and GoogleMock remove deprecated APIs once they become obsolete or replaced. Users upgrading from older versions should review the following:

- Transition from `MOCK_METHODn` to `MOCK_METHOD` macro including how to handle qualifiers and call types

- Replacement of deprecated flag macros to the current recommended flag declarations

- Updates in matcher and action syntax and concepts such as `ON_CALL` vs `EXPECT_CALL`

- Adjustments in strictness wrappers usage and expectations handling

## Recommended Upgrade Path

To maintain code compatibility and take advantage of improvements, follow these upgrade guidelines:

### 1. Move to the New `MOCK_METHOD` Syntax

Replace all uses of the old `MOCK_METHODn` and related macros with the new `MOCK_METHOD` macro:

```cpp
// Old usage:
MOCK_METHOD1(MethodName, ReturnType(ArgType));

// New usage:
MOCK_METHOD(ReturnType, MethodName, (ArgType), (override));
```

This also supports:`const`, `noexcept`, `Calltype(_)`, and `ref(_)` qualifiers.

### 2. Replace Deprecated Matchers with Built-in or Custom Matchers

Review your use of matchers and prefer the built-in comprehensive matchers or define custom matchers using `MATCHER` macros or polymorphic matcher classes.

### 3. Review Strictness Wrapper Usage

Be aware of behavioral changes in `NiceMock`, `NaggyMock`, and `StrictMock`. Use these wrappers thoughtfully to control uninteresting and unexpected call handling.

### 4. Avoid Mocking Destructors Directly

Instead of mocking destructors, add a dedicated mock method (e.g., `Die()`) called from the destructor. Write expectations on this method to verify destruction order and timing.

### 5. Adjust Flags Handling as Needed

If your build or runtime depends on deprecated flag Internals, migrate to the current flag handling mechanisms.

### 6. Test and Validate Incrementally

Run your test suite after incremental changes to verify behavior and catch issues early.

## Practical Tips

- **Use deprecation warnings actively:** Compiler warnings and runtime notices often provide helpful guidance on deprecated features.
- **Consult changelog pages:** The [Breaking Changes Summary](changelog/breaking-changes-migration/breaking-changes-summary) page complements this one with detailed migration advice.
- **Reference updated guides:** Review modern usage patterns in the [gMock Cookbook](docs/gmock_cook_book.md) and [Core Testing Workflows](guides/core-workflows/getting-started.mdx).
- **Check for compiler errors related to strictness:** Some wrappers require virtual destructors or direct macro usage as documented.

---

## Troubleshooting Common Migration Issues

### Issue: Unexpected Calls Warning Remains After Switching to NiceMock

- Verify that all mock methods are defined directly in the mock class, as `NiceMock` only affects methods directly declared there.

### Issue: Compilation Errors from Old-Style Mock Macros

- Transition your mocks to use `MOCK_METHOD` to leverage the type-safe, consistent API.

### Issue: Mock Destructor Expectations Not Triggered

- Apply the pattern of adding a mock `Die()` method and calling it in the destructor explicitly.

### Issue: Test Failures Due to Missing Default Actions

- Use `ON_CALL` to set default behaviors or specify expectations to avoid uninteresting call warnings.

## Additional Resources

- [Breaking Changes & Migration Guidance](changelog/breaking-changes-migration/breaking-changes-summary)
- [Notable Features & Improvements](changelog/release-history/notable-features-improvements)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Core Testing Workflows: Using Assertions](guides/core-workflows/using-assertions.mdx)

---

## Summary

Maintaining up-to-date GoogleTest and GoogleMock usage by following deprecation notices and upgrade paths is essential for reliable and efficient testing. This page offers clear guidance on deprecated APIs, their replacements, and the recommended strategies to migrate with minimal disruption and maximal benefit.

---

### Example: Migrating a Mock Method from Legacy to Modern Syntax

```cpp
// Legacy mock method
MOCK_METHOD1_T(DoWork, bool(int));

// Modern recommended version
MOCK_METHOD(bool, DoWork, (int), (override));
```

### Example: Mocking a Destructor via a Mock Method

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};

// Test
EXPECT_CALL(mock_foo, Die());
```

---

This page focuses exclusively on deprecated and removed APIs and upgrade advice. For comprehensive coverage of all GoogleTest features and workflows, consult the relevant guides and API references.
