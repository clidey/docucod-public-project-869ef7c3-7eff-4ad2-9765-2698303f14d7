---
title: "Migration Guides"
description: "Step-by-step instructions for upgrading from previous major versions, including recommended workflows, common pitfalls, and testing strategies to ensure a seamless transition."
---

# Migration Guides

Ensure your transition to newer major versions of GoogleTest and GoogleMock is smooth and reliable by following comprehensive migration workflows presented here. This guide walks you through essential upgrade steps, highlights common pitfalls, and offers testing strategies critical for maintaining test stability and correctness.

---

## 1. Preparing for Migration

Before starting your migration, it's imperative to thoroughly understand the scope and impact of changes introduced in new major versions. Follow these preparation steps:

- **Review Breaking Changes:** Familiarize yourself with all breaking changes detailed in the [Breaking Changes](./breaking-changes.md) documentation.
- **Assess Dependency Updates:** Ensure your build environment and dependent libraries align with new version requirements.
- **Backup Existing Tests:** Preserve current test suites and mocks to facilitate comparisons and rollback if necessary.

<Tip>
Always clone or branch your repository before migration to isolate changes and preserve your existing working state.
</Tip>

## 2. Recommended Migration Workflow

Streamline your migration process through these methodical steps:

### Step 1: Upgrade the GoogleTest and GoogleMock Libraries

- Update your project dependencies to the target major version.
- Confirm that headers and libraries are correctly referenced in your build system (e.g., CMake, Bazel).

### Step 2: Build and Verify Compilation

- Attempt to compile your tests with the updated libraries.
- Resolve all compilation errors related to API or macro changes.
- Pay particular attention to changes in mocking macros and method signatures.

### Step 3: Update Mock Definitions and Usage

- Adjust mocking syntax to align with the new version conventions, such as changes to `MOCK_METHOD` macros.
- Review handling of const qualifiers, noexcept specifications, and call type specifiers.

### Step 4: Review Expectation Ordering and Sticky Behavior

- Validate that expectation ordering (e.g., use of `InSequence`, sequences, and call cardinalities) matches the new semantics.
- For sticky expectations, ensure explicit `.RetiresOnSaturation()` usage where needed to prevent unexpected upper bound violations.

### Step 5: Align with Updated Matcher and Action Interfaces

- Check for changed matcher purity requirements.
- Update custom matchers or actions to adhere to functional purity and interface constraints.

### Step 6: Run Tests with Increased Verbosity

- Execute tests with flags such as `--gmock_verbose=info` to surface detailed call traces and expectation matches.
- Investigate unexpected or uninteresting call warnings thoroughly.

### Step 7: Address Deprecations and Remove Legacy Macros

- Replace deprecated macros like `MOCK_METHODn` family with modern `MOCK_METHOD`.
- Eliminate usage of older action macros in favor of lambdas or new action interfaces.

### Step 8: Run Full Test Suite and Analyze Failures

- Confirm all tests pass as expected.
- Review test failures for changes in strictness mode behaviors (`NiceMock`, `StrictMock`).

### Step 9: Iterate and Refine

- Iterate on failing tests by refining expectations, matchers, and mocks.
- Refactor legacy test patterns to leverage new mock features for robustness and clarity.

<Tip>
Use your version control system effectively to track modifications related specifically to migration, facilitating troubleshooting and incremental update tracking.
</Tip>

## 3. Common Pitfalls and Solutions

Navigating migration obstacles is easier with awareness of frequent issues:

| Problem                                                                    | Solution                                                                                                  |
|---------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Compilation fails due to missing method qualifiers or specifiers           | Add or align `override`, `const`, `noexcept`, and `Calltype` specifiers according to updated API contracts |
| Tests fail due to unexpected call counts or ordering violations             | Review `.Times()`, `.RetiresOnSaturation()`, and `InSequence` usage; adjust to new semantics                 |
| Legacy `MOCK_METHODn` macros cause compilation or behavior incompatibilities| Replace with the generic `MOCK_METHOD` that supports all cases                                             |
| Uninteresting call warnings flood test output                             | Explicitly allow calls via `EXPECT_CALL(...).Times(AnyNumber())`, or opt for `NiceMock` usage              |
| Unexpected test failures from strict mock mode                            | Use `NiceMock` mode or adjust expectations to accommodate changes in uninteresting call handling           |
| Failure to resolve overloaded method mocks                                | Use explicit overload disambiguation techniques like `Const()` wrapper or matcher type specifications     |

<Warning>
Ignoring warnings and errors during migration may lead to brittle tests or false positives. Address each systematically during your update cycle.
</Warning>

## 4. Testing Strategies to Ensure Seamless Transition

Achieve confidence in your migration with these targeted testing strategies:

- **Incremental Upgrade:** Migrate and test in stages rather than all at once, focusing on critical or frequently used mocks first.
- **Use Verbose Logging:** Enable detailed diagnostics (`--gmock_verbose=info`) to understand expectation matches and mismatches.
- **Add Checkpoints:** Utilize sequences or checkpoints in tests to verify call order explicitly through the migration period.
- **Implement Migration Tests:** Create tests specifically verifying mocking behaviors and expectations relative to the old version.
- **Leverage Heap and Thread Sanitizers:** Detect subtle bugs such as memory leaks or race conditions introduced by migration.
- **Repository-Wide Static Analysis:** Run static analyzers to catch outdated usage or deprecated patterns.

## 5. Rollback Procedures

In cases where migration introduces regressions that cannot be promptly fixed, employ these rollback steps:

- Restore your pre-migration branch or tag from version control.
- Validate the reversion works by running the test suite in the previous environment.
- Incrementally reapply required migration steps, isolating the cause of the failure.
- Document encountered issues and coordinate fixes before retrying the migration.

## 6. Resources and Support

For detailed help during migration, consult the following:

- **Breaking Changes Documentation:** [Breaking Changes](./breaking-changes.md) for precise incompatibilities.
- **Migration Checklist and Examples:** Refer to sample migration cases in community-contributed documentation.
- **gMock Cookbook:** Advanced mocking recipes to adapt to evolving APIs.
- **User Forums and Issue Trackers:** Seek community advice or report migration blockers.

---

Maintaining test reliability and clarity during major version upgrades is an investment that pays off by giving your codebase a robust foundation on the latest tooling. Follow these migration guides diligently and reach out to the GoogleTest community for assistance as needed.

---