---
title: "Upgrade Guide"
description: "Provides step-by-step instructions for migrating from older releases to the latest version. Covers required code modifications, dependency updates, and configuration adjustments—helping users minimize friction and avoid common pitfalls."
---

# Upgrade Guide

This guide provides clear, step-by-step instructions to help you migrate your codebase when upgrading from older versions of GoogleTest and GoogleMock to the latest release. It focuses on the changes that affect your test code, build configuration, and dependencies, ensuring a smooth transition with minimal disruption.

---

## 1. Overview of Upgrade Requirements

Upgrading to recent GoogleTest versions **requires a minimum of C++17 support** in your build environment. This change enables modern language features that improve test expressiveness and framework robustness.

Additionally, upcoming releases will require depending on Abseil, a collection of C++ library extensions, which you should plan to integrate into your projects.

---

## 2. Code Modifications

### 2.1 Migrating Deprecated Macros and APIs

Some older test suite and test case macros are deprecated and replaced for better clarity and modern standards:

- Replace `INSTANTIATE_TEST_CASE_P` with `INSTANTIATE_TEST_SUITE_P`.
- Use `TYPED_TEST_SUITE` instead of `TYPED_TEST_CASE`.
- Switch from `REGISTER_TYPED_TEST_CASE_P` to `REGISTER_TYPED_TEST_SUITE_P`.

These are primarily name changes to align with terminology updates (favoring "TestSuite" over "TestCase") and ensure consistency across the API.

### 2.2 Test Fixture Set-Up and Tear-Down

In recent updates, if your _parameterized_ test fixtures define `SetUpTestSuite()` or `TearDownTestSuite()`, **they must be declared `public`** to work correctly with `TEST_P` and related macros.

Check your test fixture classes to confirm these methods have the appropriate access.

### 2.3 Registering Tests Programmatically

For dynamic test registration, the `::testing::RegisterTest` function now correctly infers the fixture type from the factory callable. Ensure your factory lambdas return the concrete fixture pointer type explicitly to avoid ambiguous behavior.

Example:

```cpp
// Correct way to register tests programmatically with explicit return type.
::testing::RegisterTest(
    "MyFixture", "TestName", nullptr, nullptr,
    __FILE__, __LINE__, []() -> MyFixture* { return new MyTest(data); });
```

### 2.4 Exception Handling in Tests

GoogleTest can catch exceptions thrown by test code by default. You can customize this behavior via flags (e.g., `--gtest_catch_exceptions=0` to disable catching). If you want to propagate fatal failures like exceptions, consider adding a listener that throws `testing::AssertionException` on fatal failures.

Refer to the [Advanced GoogleTest Topics](../advanced.md#catching-failures) for detailed guidance.

---

## 3. Dependency and Build Configuration Adjustments

### 3.1 C++17 Language Standard

Ensure your build system compiles test sources with at least **C++17** enabled. This is mandatory for the latest GoogleTest versions.

Example for CMake:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### 3.2 Abseil Dependency

Future GoogleTest releases will depend on [Abseil](https://github.com/abseil/abseil-cpp). Begin integrating Abseil into your environment to prepare:

- Add Abseil as a submodule or package dependency.
- Link GoogleTest and your tests against Abseil’s libraries.

Check the upstream release notes regularly for precise Abseil version requirements.

### 3.3 Flag Access and Initialization

Continue to initialize GoogleTest flags properly by calling `testing::InitGoogleTest(&argc, argv);` in your `main` function before `RUN_ALL_TESTS()`.

Flags that modify test execution (like `--gtest_repeat`, `--gtest_fail_fast`, `--gtest_shuffle`) remain supported but verify compatibility with your updated test runner.

---

## 4. Adjusting Test Output and Behavior

### 4.1 Test Filtering and Sharding

Upgrade-aware runners should continue supporting test filtering with `--gtest_filter` and test sharding via environment variables (`GTEST_TOTAL_SHARDS`, `GTEST_SHARD_INDEX`).

### 4.2 Disabled and Skipped Tests

Be aware of the changed behavior around disabled tests. Use the `--gtest_also_run_disabled_tests` flag if you want to include previously disabled tests in your runs during migration.

### 4.3 Test Naming Restrictions

Continue to avoid underscores (`_`) in test suite and test names to ensure proper test discovery and reporting.

---

## 5. Troubleshooting and Common Pitfalls

### 5.1 Fatal Assertions in Non-void Functions

Remember that fatal assertions like `ASSERT_*` and `FAIL()` must only be used in `void`-returning functions or test bodies. Using them in constructors, destructors, or non-void functions can cause compiler errors.

If needed, move fatal checks to `SetUp()`/`TearDown()` or use non-fatal expectations inside non-void functions.

### 5.2 Runtime ABI and Linking Errors

Upgrading compiler versions may trigger ABI incompatibilities. Rebuild all GoogleTest and dependent objects fully after language standard upgrades.

If you encounter missing symbols or linking errors, check for:

- Consistent compiler flags across your build.
- Complete rebuild of GoogleTest artifacts.
- Appropriate namespace and macro use per updated API.

### 5.3 Test Discovery Issues

If tests fail to be discovered after upgrading, verify that:

- Test names comply with naming rules (no underscores).
- All test files are correctly linked.
- `InitGoogleTest` is called before `RUN_ALL_TESTS`.

See the [Troubleshooting Test Discovery and Execution](../faq/troubleshooting-faq/test-not-discovered-or-executed.mdx) for more details.

---

## 6. Additional Resources

- [GoogleTest Primer](../docs/primer.md) — Foundational concepts and basic usage.
- [Advanced GoogleTest Topics](../docs/advanced.md) — In-depth details on assertions, parameterized tests, and event listeners.
- [Breaking Changes & Deprecations](../changelog/breaking-changes-migration/breaking-changes.md) — Details on incompatible changes and removal timelines.
- [Registering Tests Programmatically](../docs/advanced.md#registering-tests-programmatically) — Advanced test registration.
- [GoogleTest GitHub Releases](https://github.com/google/googletest/releases) — Latest release notes and upgrade history.

---

## 7. Summary

Upgrading GoogleTest/GoogleMock requires adopting C++17, updating deprecated macros to new TestSuite-style names, ensuring correct access modifiers for parameterized test fixtures, and preparing for future Abseil dependency integration. Adhere to naming conventions and upgrade your build system accordingly. For smooth migration, review breaking changes documentation and test your suite thoroughly.


---

### Example Updated Test Registration Code

```cpp
class MyFixture : public testing::Test {
 public:
  static void SetUpTestSuite() { ... }
  static void TearDownTestSuite() { ... }
  void SetUp() override { ... }
  void TearDown() override { ... }
};

class MyTest : public MyFixture {
 public:
  explicit MyTest(int data) : data_(data) {}
  void TestBody() override { /* test code */ }
 private:
  int data_;
};

void RegisterMyTests(const std::vector<int>& values) {
  for (int v : values) {
    testing::RegisterTest(
        "MyFixture", ("Test" + std::to_string(v)).c_str(), nullptr,
        std::to_string(v).c_str(),
        __FILE__, __LINE__,
        [=]() -> MyFixture* { return new MyTest(v); });
  }
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  std::vector<int> values_to_test = LoadValuesFromConfig();
  RegisterMyTests(values_to_test);
  return RUN_ALL_TESTS();
}
```

---

<Tip>
Ensure to perform a full clean rebuild of your test binaries after upgrading to C++17 to prevent ABI conflicts.
</Tip>

<Note>
Before fully migrating, test your existing test suites with the `--gtest_also_run_disabled_tests` flag to catch any disabled tests that might be impacted.
</Note>

<Warning>
Do not call `RUN_ALL_TESTS()` more than once; it can break thread-safe death tests and other advanced test features.
</Warning>
