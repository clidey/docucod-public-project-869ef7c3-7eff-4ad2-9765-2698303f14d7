---
title: "Feature Highlights"
description: "Summarizes significant new features and enhancements released in recent versions, with practical context on their usage and value. Enables users to fully exploit GoogleTest’s evolving capabilities."
---

# Feature Highlights

The Feature Highlights page distills the newest and most impactful capabilities introduced to GoogleTest, particularly focusing on GoogleMock's evolving features. It guides users to leverage these enhancements effectively in their test suites, helping them write more expressive, maintainable, and robust mock-based tests.

---

## Unlocking Powerful Mocking Patterns

GoogleMock continues to enhance the expressiveness of mock specifications, enabling developers to flexibly customize behavior, control invocation order, and verify interactions in nuanced ways. These features empower users to model complex interactions faithfully and to validate subtleties in code under test.

Key capabilities include:

- **Advanced Expectation Configuration**: Clauses such as `.With()`, `.InSequence()`, `.After()` allow specifying multi-argument matchers, imposing call order sequences, and defining call dependencies, giving precise control over when and how mock methods are invoked.

- **Flexible Action Specification**: Use `.WillOnce()`, `.WillRepeatedly()`, and `ON_CALL` clauses along with intrinsic or custom actions to define how mocks behave when invoked. This gives fine-grained control over return values, side effects, and call delegation.

- **Strictness Wrappers for Better Test Hygiene**: The `NiceMock`, `NaggyMock`, and `StrictMock` templates modify the reporting on uninteresting calls — from suppressing warnings (`NiceMock`), to printing warnings (`NaggyMock`), or treating such calls as test failures (`StrictMock`). This aids in maintaining clean and meaningful test output, according to the developer’s intent.

## Practical Use Cases and User Flows

### Setting Mock Expectations

Users typically want to ensure their code calls certain methods with expected arguments and frequencies. The documentation explains how to: 

1. Use `EXPECT_CALL` to declare method call expectations.
2. Apply argument matchers (including wildcards and multi-argument matchers with `.With()`) to specify constraints on call parameters.
3. Define call cardinalities via `.Times()` or allow the framework to infer them based on specified actions.
4. Arrange calls in order using `.InSequence()` or enforce partial order with `.After()`.
5. Specify expected behavior for each invocation with `.WillOnce()` and `.WillRepeatedly()`.


### Default Behaviors Using ON_CALL

In cases when tests are not concerned with verifying some calls but want to specify how mocks behave when those calls occur, `ON_CALL` sets default actions without establishing expectations. This separation encourages writing less brittle tests by verifying only what matters while defining default mock responses globally or per test.

### Managing Mock Strictness

To manage the verbosity and strictness of untested mock invocations:

- Wrap mocks with `NiceMock` to silence warnings about unexpected calls.
- Use `NaggyMock` (default) to get warnings but not errors on uninteresting calls.
- Use `StrictMock` to make uninteresting calls test failures, enforcing stricter correctness.

### Verifying and Resetting Mocks

Users can verify that all expectations are met before an object's destruction or clear expectations and default actions mid-test using:

- `Mock::VerifyAndClearExpectations()` to verify and clear expectations (but retain default actions).
- `Mock::VerifyAndClear()` to also clear default actions.

This is especially useful for complex tests or asynchronous workflows.

## Best Practices and Common Pitfalls

- **Specify expectations before exercising mocks** to ensure correct behavior and early failure reporting.
- Avoid over-specification: use _ for arguments unless you care about particular values.
- Use sequences carefully to express call order requirements, without making tests unnecessarily fragile.
- Be mindful when mixing `EXPECT_CALL` and `ON_CALL` comments as they operate independently.
- Remember that expectations are "sticky" by default—adding `.RetiresOnSaturation()` helps retire saturated expectations when required.
- Wrap mocks in appropriate strictness wrappers for the test scope to control warning and error messages about uninteresting calls.
- Leaked mocks are detected by default, but you can suppress warnings with `Mock::AllowLeak()` when intended.

## Code Examples

### Defining a Basic Mock

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (int n), ());
};
```

### Setting an Expectation

```cpp
using ::testing::Return;
using ::testing::_;

MockFoo mock;
EXPECT_CALL(mock, Bar(_))
    .Times(2)
    .WillOnce(Return(10))
    .WillOnce(Return(20));

int val1 = mock.Bar(5);  // returns 10
int val2 = mock.Bar(6);  // returns 20
```

### Setting an ON_CALL Default

```cpp
ON_CALL(mock, Bar(_))
    .WillByDefault(Return(0));

int val3 = mock.Bar(7);  // returns 0 by default
```

### Using a Sequence for Call Ordering

```cpp
Sequence s;
EXPECT_CALL(mock, Bar(1)).InSequence(s);
EXPECT_CALL(mock, Bar(2)).InSequence(s);

mock.Bar(1);  // OK
mock.Bar(2);  // OK
// mock.Bar(1);  // Would cause error: out of order
```

### Handling Strictness

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, Bar(5));

nice_mock.Bar(5);  // Matches
nice_mock.Bar(3);  // No warning generated due to NiceMock
```

---

## Additional Resources and References

- [Mocking Reference](reference/mocking.md) - Detailed API for mocking features.
- [gMock Cookbook](gmock_cook_book.md) - Practical recipes for mocking, matchers, and actions.
- [gMock Cheat Sheet](gmock_cheat_sheet.md) - Quick syntax guide.
- [Nice, Naggy, and Strict Mocks](reference/gmock-mocking-api/nice-strict-mocks.md) - Understanding mock strictness.
- [Setting Expectations and ON_CALL](reference/gmock-mocking-api/expectations-specification.md) - Detailed behavior configuration.
- [Matchers Library](reference/gmock-mocking-api/matchers-library.md) - Expressive argument matchers.

---

This page fits within the Changelog's new features & improvements section, enabling users to track the latest mocking enhancements and apply them practically.

---