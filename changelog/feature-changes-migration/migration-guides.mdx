---
title: "Upgrade & Migration Guides"
description: "Step-by-step instructions for upgrading between major GoogleTest and GoogleMock versions. Focuses on migrating from deprecated or removed features, updating C++ standards (e.g., C++17 requirements), and adopting new workflows. Essential reading for users maintaining or updating larger codebases."
---

# Upgrade & Migration Guides

This guide provides a clear, step-by-step framework for upgrading between major versions of GoogleTest and GoogleMock. It focuses on ensuring a smooth transition for your projects by addressing deprecated or removed features, C++ standard updates (notably C++17 requirements), and recommended best practices for adopting newer workflows.

Whether you maintain a small codebase or a large complex system, this guide is essential for avoiding common pitfalls during migration and preserving test reliability.

---

## 1. Understanding the Scope of Migration

Major version updates often introduce significant changes that may affect your existing test suite. These include:

- Removal or deprecation of legacy APIs and macros such as `MOCK_METHODn` family.
- Change in minimum required C++ standard to C++17, impacting compiler compatibility and code syntax.
- Introduction of newer idiomatic usage patterns or interfaces, such as preferring `MOCK_METHOD` with qualifiers over older macros.
- Updates to default behaviors and warning levels, for example, uninteresting call handling.

Being aware of these changes will help you prepare for a planned upgrade without unexpected test failures.

---

## 2. Migrating from Old-Style `MOCK_METHODn` Macros to `MOCK_METHOD`

GoogleTest and GoogleMock encourage moving from legacy macros (`MOCK_METHOD0`...`MOCK_METHODn`) to the unified and more flexible `MOCK_METHOD` macro. This change improves readability, consistency, and enables better support for qualifiers and templates.

### Why migrate?
- The new `MOCK_METHOD` supports method qualifiers such as `const`, `override`, `noexcept`, and calling conventions.
- Handles complex argument types more reliably, with syntax that clarifies template and tuple types.
- Enables better support for move-only arguments and return types.

### Migration Steps

1. Replace all `MOCK_METHODn` macros with the corresponding `MOCK_METHOD` syntax.

2. Specify method qualifiers explicitly in the optional fourth macro parameter list.

3. Wrap argument types containing commas (e.g., `std::pair<int, int>`) in an extra set of parentheses or use type aliases to avoid parsing issues.

4. For mocking const methods, add `(const, override)` as part of the fourth parameter, rather than using separate `MOCK_CONST_METHODn` macros.

5. Verify that the mock methods are declared in the `public` section regardless of original access control in the base class.

### Example Transformation:

```cpp
// Old Style
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD0(Bar, int());

// New Style
MOCK_METHOD(bool, Foo, (int), (override));
MOCK_METHOD(int, Bar, (), (const, override));
```

### Tips
- Use `using` declarations if only mocking some overloaded methods to avoid hiding other overloads.
- Update your build environment to C++17 or later to fully support all features.

---

## 3. Updating to C++17 Compatibility

Starting with recent releases, GoogleTest and GoogleMock require C++17 or later.

### Impact

- Your build environment must support the C++17 standard.
- Source files must be compiled with appropriate compiler flags (e.g., `-std=c++17`).
- Some deprecated C++ features or workarounds may be removed.

### Best Practices

- Verify all dependencies and test binaries are compatible with C++17.
- Leverage C++17 features such as structured bindings in test helpers where beneficial.
- Consider refactoring legacy code that does not comply with modern C++ requirements.

---

## 4. Adjusting to Changes in Default Behavior and API

### Handling Uninteresting Calls

- By default, GoogleMock produces warnings when a mock method without explicit expectations is invoked.
- You can suppress warnings by using `NiceMock<YourMockType>` or add catch-all `EXPECT_CALL` clauses with `Times(AnyNumber())`.
- Alternatively, use `StrictMock` if you want such calls to be treated as test failures.

### Delegating Calls

- For more complex mocks, delegate default behaviors to real or fake implementations using `ON_CALL` with lambdas or callable wrappers.

### Specifying Default Actions Using `ON_CALL`

- Migrate any behavior definitions using legacy patterns to explicit `ON_CALL` macros.

### Expectation Ordering and Sequencing

- For ordering expectations, prefer using `InSequence` or `After` clauses for precise control.

---

## 5. Recommendations for Large Codebases

- Incrementally migrate mock classes.
- Introduce type aliases to manage complex template types and reduce macro parsing issues.
- Use sequences to impose call order without brittle test failures.
- Always set clear and minimal expectations to avoid overly strict tests.
- Validate changes by running the entire test suite with verbose logging enabled (`--gmock_verbose=info`) to confirm behavior.

---

## 6. Additional Migration Tips

- When mocking methods with move-only types (e.g., `std::unique_ptr`), use lambdas or compatible action expressions rather than direct `Return(...)` of a move-only object.
- Avoid mocking non-virtual free functions directly; instead, introduce interfaces or use `MockFunction` when appropriate.
- Use `RetiresOnSaturation()` judiciously to prevent sticky expectations from causing upper-bound errors.

---

## 7. Troubleshooting

### Common Issues

- **Compilation errors related to macro parsing**: Check argument parentheses or use type aliases.
- **Linking or runtime failures** after upgrade: Verify the environment is fully updated to C++17 and all dependencies are consistent.
- **Test failures due to stricter verification**: Confirm that all expected calls are correctly specified, especially after switching from naggy to strict mocks.
- **Warnings about uninteresting calls**: Use `NiceMock` or explicit catch-all expectations.

### Helpful Tips

- Run tests with `--gmock_verbose=info` to gain visibility of all mock call matching and expectations.
- Use `Mock::VerifyAndClearExpectations(&mock_obj)` to proactively verify and clear expectations within test lifecycles.

---

## 8. Related Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — practical recipes and best practices
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) — FAQ for common legacy issues and migration
- [Mock Method Macros Reference](reference/mocking.md#MOCK_METHOD) — detailed syntax for mocking methods
- [EXPECT_CALL and ON_CALL Reference](reference/mocking.md#EXPECT_CALL) — setting expectations and default actions
- [NiceMock, StrictMock, NaggyMock](reference/mocking.md#NiceMock) — controlling mock strictness
- [Using GoogleMock with move-only types](docs/gmock_cook_book.md#MockingMoveOnlyTypes) — guidance for modern C++ usage

---

## Summary
This guide empowers you to upgrade your GoogleTest and GoogleMock based test suite efficiently and reliably. By adopting modern macros, complying with C++17 standards, and adjusting to changes in default behaviors, you ensure your tests remain robust and maintainable.

For large projects, incremental migration, combined with judicious strictness and sequences, will minimize disruption. Leverage verbose logging and community resources to ease the transition.

Happy testing with the latest GoogleTest and GoogleMock!

---

## Example Migration Snippet

```cpp
// Old style
class MockFoo : public Foo {
 public:
  MOCK_METHOD1(FooBar, bool(int));
  MOCK_CONST_METHOD0(GetValue, int());
};

// New style
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, FooBar, (int), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
};
```

---

## Additional Notes
- Always define mock methods in the public section.
- Utilize `ON_CALL` for default behaviors where no call count verification is needed.
- Use `EXPECT_CALL` to specify expected call counts and verify interactions.
- Use sequences or `After` to control execution order when necessary.

---