---
title: "Migration Guides"
description: "Step-by-step instructions to help users transition from previous versions to the latest GoogleTest and GoogleMock releases. Includes best practices, common pitfalls, and links to detailed upgrade examples."
---

# Migration Guides

This page provides clear, practical guidance to help users transition from earlier versions to the latest releases of GoogleTest and GoogleMock. Moving to newer versions can unlock improved features, stronger C++ standard support, and refined mocking capabilities but may also require adjustments to existing tests and mocking strategies. Here we walk you through the key considerations, common pitfalls, and best practices for a smooth migration.

---

## 1. Preparing for Migration

### Understand the New Requirements

- **C++17 Minimum Standard:** The latest GoogleTest and GoogleMock versions require your codebase to be compiled with at least C++17. Ensure your build configuration specifies this standard to avoid compatibility issues.

- **Compiler Updates:** Use a compiler that supports C++17 fully, such as:
  - GCC 7 or later
  - Clang 7 or later
  - MSVC 2017 or later

Check your compiler documentation if unsure.

### Audit Your Existing Tests and Mocks

- Take inventory of mock classes, especially those relying on old mocking macros or deprecated interfaces.
- Identify any mocks using the legacy `MOCK_METHODn` macros, non-virtual method mocks, or complex actions that may require updates.

### Backup and Version Control

Before starting, ensure your test code is committed and backed up. Migration may require iterative fixes and testing.

---

## 2. Key Migration Steps

### Replace Legacy Mocking Macros

The recommended mocking macro is now `MOCK_METHOD`, which supports advanced qualifiers and cleaner syntax. Replace any instances of legacy `MOCK_METHODn` or `MOCK_CONST_METHODn` macros with the new generic `MOCK_METHOD` format.

**Example:**

Old syntax:
```cpp
MOCK_METHOD1(Foo, bool(int));
```
New syntax:
```cpp
MOCK_METHOD(bool, Foo, (int));
```

### Review and Update Mock Method Qualifiers

Ensure your mock methods specify qualifiers such as `(const)`, `(override)`, `(noexcept)`, or call type as needed on the new macro.

### Manage Non-Virtual and Free Function Mocks

Update your design if you mock non-virtual methods or free functions:
- Use interface abstractions where possible.
- For non-virtual methods, prefer template-based dependency injection.
- For free functions, wrap them behind interfaces or use `MockFunction` for `std::function` objects.

### Handle Changes in Default Mock Behavior

By default, uninteresting calls to mocks now print warnings. Decide on using `NiceMock`, `NaggyMock`, or `StrictMock` wrappers to control warnings and failure behavior based on your test strategy.

### Adopt C++17 Features and Fix Compiler Warnings

Your test code can now use C++17 idioms. Review and remove workarounds for older standards, including redundant casts or macros.

---

## 3. Best Practices During Migration

### Use `ON_CALL` vs `EXPECT_CALL`

Favor `ON_CALL` to set default mock behavior without imposing strict call expectations. Use `EXPECT_CALL` only when you want to assert a method call happens with specific arguments and count. This minimizes brittle tests.

### Check for Overloaded Mock Methods

For overloaded methods, ensure all variants are mocked with unique signatures. Use `using` declarations to prevent hiding overloaded methods unintentionally.

### Verify and Update Custom Actions and Matchers

Update your custom matchers and actions to conform to new interfaces if necessary. Leverage polymorphic matchers and actions to simplify reusable test utilities.

### Delegate to Real or Fake Objects Where Appropriate

Consider the delegation patterns (`DelegateToFake()`, real object delegation) to reduce duplication and maintain consistent behavior.

---

## 4. Common Pitfalls and Troubleshooting

- **Compilation Errors:** Usually stem from missing C++17 flags or legacy macros still present.
- **Linker Issues:** Arise if linking against an older GoogleTest static library after source upgrade.
- **Unhandled Overloads:** Partial mocking of overloaded methods causes warnings or hidden methods.
- **Unexpected Mock Warnings:** Transition to `NiceMock` or explicitly handle uninteresting calls to suppress noisy output.

If you encounter such issues, revisit the preparation steps and ensure all code changes have been applied consistently.

---

## 5. Additional Resources & Examples

- [Detailed Release Notes](https://github.com/google/googletest/releases) — Review release-by-release changes for additional context.
- [Mocking Cookbook](../gmock_cook_book.md) — Recipes to handle advanced mocking scenarios.
- [Breaking Changes and Migrations](../breaking-changes-and-migrations/breaking-changes.md) — In-depth information on user-impacting changes.
- [GoogleTest Primer](../primer.md) — Refresh your foundation after migration.

---

## 6. Step-by-Step Upgrade Example

Here’s an example flow to upgrade your mock classes:

<Steps>
<Step title="Check Compiler and Build Configuration">
Ensure your build system uses C++17; verify compiler version.
</Step>
<Step title="Replace All Legacy `MOCK_METHODn` Macros">
Convert all legacy mock macros to the new `MOCK_METHOD` syntax carefully.
</Step>
<Step title="Add Necessary Qualifiers to Mock Methods">
Add `(const)`, `(override)` as required for correctness and readability.
</Step>
<Step title="Build and Fix Compilation Issues">
Fix errors from missing includes, incorrect types, or method signatures.
</Step>
<Step title="Suppress Uninteresting Call Warnings Based on Strategy">
Wrap mocks with `NiceMock` or `StrictMock` or add explicit expectations.
</Step>
<Step title="Run Tests and Verify Behavior">
Run your test suite; fix any failing tests due to changed mock behavior.
</Step>
</Steps>

---

For a practical migration, start small with a single test suite or set of mock classes and iteratively broaden the migration once the initial steps succeed.


---

<Check>
Always validate your upgraded tests through continuous integration to catch any subtle regressions early.
</Check>