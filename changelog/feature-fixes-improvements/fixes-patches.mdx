---
title: "Bug Fixes & Stability Patches"
description: "Summarize resolved issues, platform compatibility updates, and reliability enhancements affecting test execution, performance, or integration scenarios."
---

# Bug Fixes & Stability Patches

This page provides a comprehensive summary of all resolved issues, platform compatibility updates, and reliability enhancements within GoogleMock that directly impact test execution, performance, and integration scenarios. It is essential reading for users seeking to understand improvements that ensure stable, predictable, and robust mocking behavior in their test suites.

---

## 1. Resolved Issues

### 1.1 Mock Method Evaluation and Syntax Handling
- Fixed multiple bugs related to the evaluation of `ON_CALL` and `EXPECT_CALL` macros ensuring arguments are evaluated exactly once. This resolves subtle issues where side-effects could occur multiple times when setting up expectations or default behaviors.
- Corrected parsing errors with method names expanded from macros (e.g., Windows API macro expansions), enhancing compatibility in environments with macro-heavy headers.
- Addressed scenarios where consecutive `With()` or `WillByDefault()` clauses in `ON_CALL` or `EXPECT_CALL` macros were mistakenly accepted, enforcing correct syntax and preventing runtime errors.

### 1.2 Call Counting and Cardinality Clarification
- Fixed the inference and enforcement of call cardinalities when combining different `WillOnce()` and `WillRepeatedly()` clauses, ensuring the expected call counts align with the documented cardinality inference rules.
- Resolved issues with too many or too few actions specified in `EXPECT_CALL` relative to their cardinalities, including clear warnings when `WillOnce()` counts exceed `Times()` bounds.

### 1.3 Handling of Over-Saturation and Unexpected Calls
- Improvements to the handling of excessive calls beyond the specified expectations; the framework now reliably falls back to default actions instead of undefined behavior.
- Added more informative error messages and clear diagnostics when unexpected calls occur, including whether the failure was due to retired expectations or unmatched arguments.

### 1.4 Enhanced Sequence and Partial Order Management
- Corrected bugs in the enforcement of call order in sequences, including nested sequences and partial orderings using `InSequence()` and `.After()` clauses.
- Improved retirement behavior of expectations in sequences, making sure expectations retire as soon as successors are saturated, reducing test brittleness.

### 1.5 Thread Safety Enhancements
- Refined internal locking and synchronization in the mock framework for safe usage in multi-threaded tests.
- Verified that mock methods are safe to call from multiple threads without introducing race conditions or inconsistent state.

### 1.6 Support and Fixes for Move-only Types
- Addressed multiple issues related to mocking methods with move-only arguments and return types, ensuring reliable support for `unique_ptr` and similar C++11 move semantics.
- Eliminated improper behavior when unleashing actions based on move-only objects, preventing runtime exceptions and compilation errors.

### 1.7 Memory and Lifecycle Management
- Fixed memory leaks and use-after-free bugs by improving mock object destructors and expectation clearing logic.
- Implemented `Mock::AllowLeak()` functionality enhancements allowing safe intentional leaks during shutdown or atypical test scenarios.

---

## 2. Platform Compatibility Updates

### 2.1 Compiler and Flag Support
- Verified compatibility with MS Visual C++ 2015 and above, resolving legacy warnings associated with const parameters in virtual methods.
- Strengthened platform portability macros to enable consistent behavior across Linux, Windows, and macOS environments.

### 2.2 Build and Integration Stability
- Addressed build issues in Bazel and CMake setups related to symbol resolution for mocks defined across multiple translation units.
- Improved header inclusion consistency (`gmock.h` and related headers) to reduce user errors in test compilation.

---

## 3. Reliability Enhancements

### 3.1 Diagnostic Message Clarity
- Enhanced the verbosity and formatting of error and warning messages emitted during expectation failures, making debugging simpler.
- Added more contextual information including file locations, call stack traces (when verbosity is enabled), and detailed argument mismatch explanations.

### 3.2 Uninteresting and Unexpected Calls Handling
- Improved how uninteresting calls behave, allowing better control through `NiceMock`, `NaggyMock`, and `StrictMock` wrappers.
- Ensured that the verbosity flag `--gmock_verbose` properly suppresses or shows warnings as configured.

### 3.3 Expectation Cleanup and Verification
- Established a solid implementation for `Mock::VerifyAndClearExpectations()` and `Mock::VerifyAndClear()` to enable explicit verification phases in tests.
- Ensured expectations and default actions can be reset and redefined cleanly within test lifecycles.

---

## 4. Practical Tips and Best Practices

- **Setting Expectations Before Execution**: Always define your `EXPECT_CALL` expectations ahead of code execution to ensure predictable behavior and failure reporting.

- **Using `RetiresOnSaturation()`**: For ordered sequences or multiple calls with different behaviors, attach `.RetiresOnSaturation()` to avoid sticky expectations blocking further matching.

- **Choosing Mock Strictness**: Utilize `NiceMock` to reduce noise from uninteresting calls, `NaggyMock` to get warnings, and `StrictMock` to treat stray calls as failures, depending on your test goals.

- **Default vs. Explicit Actions**: When default behavior is insufficient, set `ON_CALL` with `.WillByDefault()` to define common fallback behaviors without enforcing call counts.

- **Thread Safety**: Ensure all mock setup and teardown steps are done single-threaded; calling mock methods can safely occur concurrently.

- **Handling Move-only Types**: Use lambdas or callable objects for actions involving `unique_ptr` or similarly move-only data to avoid lifecycle and compilation issues.

- **Diagnosing Failures**: Use the `--gmock_verbose=info` flag to receive detailed call and expectation information during test runs.

---

## 5. Troubleshooting Section

### Common Issues
- **Unexpected Calls**: If you see errors stating an unexpected mock function call, verify the expectations are correctly set and match the arguments used.

- **Uninteresting Calls Warning**: If warnings appear about uninteresting calls, consider adding explicit expectations with `.Times(AnyNumber())` or switch to `NiceMock` to suppress noise.

- **Saturated Expectations Errors**: When calls exceed the expected number, review the `Times()` clause and whether `.RetiresOnSaturation()` may be needed.

- **Compilation Failures**: Often arise from missing includes or improper use of `MOCK_METHOD` syntax; consult the Mocking Reference and gMock Cookbook for examples.

### Helpful Commands
- Run tests with `--gmock_verbose=info` for detailed diagnostics.
- Use `Mock::VerifyAndClearExpectations()` to enforce expectation checks earlier in your test flow.

### Getting Support
- Consult the FAQs on [Mocking and Expectations](../faq/general-usage/mocking-faq.mdx) and [Build & Integration Troubleshooting](../faq/troubleshooting/build-integration-issues.mdx).
- Review the [Breaking Changes](../changelog/breaking-changes-migrations/breaking-changes.mdx) for migration considerations.

---

## 6. Additional Resources

- [Mocking Reference](../api-reference/core-apis/mocking.md): Comprehensive description of mocking APIs.
- [gMock Cookbook](../docs/gmock_cook_book.md): Practical recipes and samples.
- [Matchers Reference](../api-reference/core-apis/matchers.md): Built-in matchers and custom matcher creation.
- [Actions Reference](../api-reference/core-apis/actions.mdx): How to specify mock behaviors and side effects.
- [Troubleshooting Common Issues](../guides/integration-and-troubleshooting/troubleshooting-common-issues.mdx): Resolving typical errors.

---

For a holistic grasp on stable test execution and integration of GoogleMock in your environment, this page anchors your understanding of the robustness improvements and guides you toward best practices and troubleshooting insights.

---

{/* Source Links */}
<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googlemock/test/gmock-spec-builders_test.cc", "range": "1-525"},{"path": "googlemock/test/gmock_output_test_.cc", "range": "1-215"},{"path": "googlemock/test/gmock_stress_test.cc", "range": "1-290"}]} />

---