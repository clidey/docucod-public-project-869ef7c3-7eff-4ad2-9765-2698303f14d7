---
title: "Feature Additions & Enhancements"
description: "Detail newly introduced capabilities, improved APIs, and added workflows in GoogleTest and GoogleMock, tying changes directly to product value and user tasks."
---

# Feature Additions & Enhancements

This changelog page highlights the newly introduced capabilities, improved APIs, and enhanced workflows in GoogleTest and GoogleMock. Focusing specifically on features impacting mocking and test authoring, it ties changes directly to user activities and value realization.

---

## 1. Enhanced Mock Method Declaration with `MOCK_METHOD`

- **Improved Macro Flexibility**: The `MOCK_METHOD` macro now elegantly supports all common and advanced method signatures, including:
  - Const and non-const overrides.
  - Methods with reference qualifiers.
  - Specifying calling conventions (e.g. `Calltype(STDMETHODCALLTYPE)`) for platform compatibility.

- **Better Handling of Complex Types**:
  - Commas within return or argument types are managed either via enclosing parentheses or type aliases, reducing compilation pitfalls.

**User Value**: Writing mock classes is more intuitive and less error-prone, allowing seamless mocking of complex or platform-specific code, boosting developer productivity.

## 2. Powerful Expectation Setting via `EXPECT_CALL`

- **Flexible Matchers**: Users can specify exact or flexible argument expectations using a rich matcher set, including the wildcard `_`, combined matchers, and tuple matchers.

- **Cardinalities Control**:
  - Enables precise control over expected call counts with built-in modifiers such as `Exactly()`, `AtLeast()`, `AnyNumber()`, and user-defined cardinalities.
  - Cardinalities can be inferred automatically based on chained actions.

- **Order Control Enhancements**:
  - Partial and full ordering via `.InSequence()`, `.After()`, and anonymous sequences with `InSequence` RAII object.
  - Supports multiple sequences to express complex call order DAGs.

- **Compound and Selective Actions**:
  - Support for chaining multiple `WillOnce()` actions, followed by optional `WillRepeatedly()`.
  - Ability to specify side effects, return values, throws, and invoke user-defined callables.

- **Enhanced Clause Ordering and Restrictions**:
  - `.With()` clause usage for multi-argument matching.
  - Validation to prevent invalid clause sequences, ensuring expectation clarity.

**User Value**: Test scenarios are expressed precisely and with flexibility, reducing brittle or over-specified tests and enabling readable expectation declarations.

## 3. Default Behavior Specification using `ON_CALL`

- **Default Action Declaration**:
  - Allows users to set default mock method behavior without enforcing invocation expectations.

- **Multi-argument Matching with `.With()`**:
  - Conditional defaults based on argument tuples.

- **Last-Match-Wins Semantics**:
  - Newer `ON_CALL` overrides older ones, letting users set general default actions early and more specific defaults later, improving maintainability.

**User Value**: Enables flexible and expressive setup of fallback/mock behaviors, simplifying test fixture setup and reducing noise from uninteresting calls.

## 4. Mock Object Strictness Control (NiceMock, NaggyMock, StrictMock)

- **Fine-Grained Diagnostics**:
  - `NiceMock<T>`: suppresses warnings on uninteresting calls.
  - `NaggyMock<T>`: default behavior, warns on uninteresting calls.
  - `StrictMock<T>`: treats uninteresting calls as test failures.

- **Inheritance of Constructors**: These wrappers inherit the constructors of the base mock, allowing convenient instantiation.

- **Limitations and Best Practices**:
  - Works only for mocks defined directly with `MOCK_METHOD`.
  - Not recommended to nest these wrappers.
  - Virtual destructors are required for full functionality.

**User Value**: Users can tailor test verbosity and failure sensitivity to their development phase and robustness goals, improving test output relevance.

## 5. Support for Move-only Types in Mock Methods

- **Seamless Mocking of `unique_ptr` and Other Movable Types**:
  - Direct support to mock methods accepting/returning move-only types, enhancing modern C++ compatibility.

- **Custom Behavior via Lambdas**:
  - Easy use of lambdas for complex behaviors returning move-only objects, avoiding pitfalls with standard actions.

- **Legacy Workaround Handling**:
  - Documented delegation technique for older versions or complex scenarios.

**User Value**: Modern C++ features are fully supported, eliminating typical blocking issues in mocking async, resource-managing code.

## 6. Richer Action API for Mock Method Behavior

- **Built-in Actions Expanded**:
  - Value returning (`Return()`, `ReturnRef()`, `ReturnPointee()`), throwing (`Throw()`), and side effects (`SetArgPointee()`, `DeleteArg<N>()`, etc.).

- **Using Callables as Actions**:
  - Invoking arbitrary functions, lambdas, or object methods as mock behaviors.

- **Action Composition**:
  - `DoAll()` to combine multiple actions per invocation.
  - Argument selection with `WithArg<N>()`, `WithArgs<>`, and `WithoutArgs()`.

- **Callback Invocation Support**:
  - `InvokeArgument<N>(...)` calls a callable passed to the mock method as an argument.

- **Silent Ignoring of Results**:
  - `IgnoreResult()` to adapt return values for void-returning mocks.

- **Custom User-Defined Actions**:
  - Macros and templates to quickly define parameterized actions.

**User Value**: Developers can prescribe complex, context-dependent mock behaviors concisely, enhancing test realism and expressiveness.

## 7. Improved Testing Workflows and Best Practices

- **Sticky vs Non-Sticky Expectations**:
  - Introduction of `.RetiresOnSaturation()` to automatically retire expectations after call limits are hit.

- **Better Support for Overloaded and Const Methods**:
  - Clarified syntax and usage patterns for mocking overloaded, const, and non-virtual methods.

- **Concurrency Notes**:
  - Guidelines for using mocks safely with multi-threaded test code.

- **Diagnostic Enhancements**:
  - Enhanced verbose logging triggered by `--gmock_verbose=info` for tracing mock behavior in tests.

**User Value**: Enables writing more maintainable, understandable, and robust test scenarios with clear lifecycle and concurrency semantics.

---

## Practical Example

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::Sequence;
using ::testing::NiceMock;

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetValue(int x) const = 0;
  virtual void DoSomething(const std::string& str) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (int x), (const, override));
  MOCK_METHOD(void, DoSomething, (const std::string& str), (override));
};

TEST(FooTest, ExampleWithSequences) {
  NiceMock<MockFoo> mock;
  Sequence seq;

  ON_CALL(mock, GetValue).WillByDefault(Return(42));

  EXPECT_CALL(mock, DoSomething("start")).InSequence(seq);
  EXPECT_CALL(mock, GetValue(5)).WillOnce(Return(5)).InSequence(seq);
  EXPECT_CALL(mock, DoSomething("end")).InSequence(seq);

  mock.DoSomething("start");
  EXPECT_EQ(5, mock.GetValue(5));
  mock.DoSomething("end");
}
```

This example highlights default actions, expectations with ordering, and usage of `NiceMock`.

---

## Troubleshooting Tips

- **Uninteresting Call Warnings**: Suppress these using `NiceMock` or explicit `EXPECT_CALL(...).Times(AnyNumber())`.
- **Unexpected Calls**: Ensure all expected call patterns are specified to avoid test failures.
- **Move-only Type Mocking Failures**: Use lambdas or delegate to helper methods to handle move semantics correctly.
- **Order Violations**: Use `Sequence` and `.InSequence()` to enforce call ordering.
- **Verbose Output**: Toggle logging verbosity with `--gmock_verbose` to diagnose complex test interactions.

---

## References and Next Steps

For comprehensive understanding and advanced use cases, consult:

- [Mocking API Reference](../api-reference/core-apis/mocking.md)
- [gMock Cookbook](../guides/writing-and-running-tests/gmock_cook_book.md)
- [Actions Reference](../api-reference/core-apis/actions.md)
- [Matchers Reference](../api-reference/core-apis/matchers.md)
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md)
- [Mock Strictness Guide](../guides/test-design-and-best-practices/mock-strictness-and-behavior.mdx)

---

### Source
For full source and examples, visit [GoogleTest GitHub Repository](https://github.com/google/googletest).

---

*This page is part of the GoogleTest and GoogleMock changelog series documenting new features, API improvements, and enhanced user workflows focusing on mocking capabilities.*
