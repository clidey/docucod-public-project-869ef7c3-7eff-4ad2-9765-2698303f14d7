---
title: "New Features"
description: "Summaries of newly introduced capabilities, options, and behaviors that expand the testing and mocking power of GoogleTest. Empower users to leverage the latest toolkit advancements with highlighted examples."
---

# New Features

Discover the latest capabilities, options, and behaviors introduced to GoogleTest that expand your testing and mocking toolkit. This page highlights key enhancements and concrete examples to empower you to leverage the newest features effectively and integrate them seamlessly into your workflows.

---

## 1. Enhanced Mocking Syntax & Capabilities

### Simplified MOCK_METHOD macro
- The updated `MOCK_METHOD` macro offers a uniform and flexible syntax to mock virtual methods, including support for method qualifiers like `const`, `override`, `noexcept`, and custom calling conventions.
- It allows mocking overloaded methods cleanly without obscure fall-through problems.

### Mocking Non-Virtual Methods
- Support for mocking non-virtual methods by defining unrelated mock classes with matching signatures.
- Enables compile-time injection of mock implementations in templated code.

### Delegation Enhancements
- **Delegating to Fakes:** Mock objects can delegate default method implementations to existing fake objects, reducing duplication of logic.
- **Delegating to Real Objects:** Mocks may forward calls to real implementations while retaining verification capabilities.
- **Delegating to Parent Classes:** Mock methods that override concrete methods can explicitly call the parent's version inside actions without causing recursion.

### Strictness Modes
- `NiceMock` suppresses warnings for uninteresting calls, making tests less noisy.
- `StrictMock` converts such calls into failures for stricter verification.
- These wrappers inherit the mock class's constructors, ensuring ease of use.

---

## 2. Improved Matchers & Expectations

### Flexible Matchers
- Expanded support for polymorphic and monomorphic matchers, allowing matching on a wide range of argument types with precise control.
- Custom matchers can be written using easy macros and classes, supporting detailed failure explanations.

### Advanced Expectation Controls
- Ability to specify call cardinalities with clarity, including exact counts, ranges, and at-least/at-most semantics.
- Expectations can be ordered strictly, partially, or left unordered, enabling sophisticated interaction validation.
- Use of `.RetiresOnSaturation()` allows expectations to retire automatically once satisfied, improving test stability.

### Argument Matching and Composition
- Composite matchers (`AllOf`, `AnyOf`, `Not`) and tuple-based argument validation with `With()` enable complex argument conditions.
- `SafeMatcherCast` lets you safely coerce matcher types when necessary.

---

## 3. Action Enhancements and Control

### Built-in and Custom Actions
- Actions like `Return`, `ReturnRef`, `ReturnPointee`, `SetArgPointee`, `SetArrayArgument` simplify common mock response patterns.
- Compose multiple actions with `DoAll()` to perform sequences of side effects and returns.
- Define custom actions via lambdas, functors, or macro-based `ACTION` constructs, with full type safety and clarity.

### Action Argument Selection
- Use `WithArg`, `WithArgs`, and `WithoutArgs` to map mock method arguments flexibly onto action call signatures.
- `IgnoreResult` adapts actions returning values for use in void contexts.

### Callback Invocation
- `Invoke`, `InvokeWithoutArgs`, and `InvokeArgument` facilitate calling real functions, methods, or callable arguments passed into mocked methods.

---

## 4. Move-Only Types Support

- GoogleMock now supports mocking methods with move-only types (`std::unique_ptr<T>`, etc.) in arguments and return values.
- Enables modern C++ to be tested without cumbersome workarounds or manual shims.

---

## 5. Compilation Performance Improvements

- Moving mock class constructor and destructor definitions to `.cc` files reduces compilation time by avoiding repeated code generation across translation units.

---

## 6. Enhanced Verification & Utilities

### Forced Verification
- Use `Mock::VerifyAndClearExpectations(&mock)` to explicitly verify and clear expectations before mock object destruction, useful for heap-allocated mocks.

### Scoped Checkpoints
- Use custom checkpoint sequences to structure and verify call phases and ordering across multiple mock objects.

### Destructor Mocking
- Technique to verify destruction order by adding a mock method called in the destructor to track object lifetimes.

---

## 7. Thread-Safety Considerations

- GoogleMock supports multi-threaded test scenarios.
- Actions execute in the thread that called the mock.
- Test code setting expectations and destroying mocks must remain single-threaded to avoid undefined behavior.
- Synchronization in user code may be required when testing concurrent interactions.

---

## 8. Diagnostic and Verbosity Controls

- The `--gmock_verbose=LEVEL` flag controls runtime output verbosity:
  - `info`: Full informational messages including stack traces.
  - `warning` (default): Warnings and errors without stack traces.
  - `error`: Errors only.

- Adjust reporting detail to suit debugging or quiet operation needs.

---

## 9. Custom Matcher and Action Definitions

- Simplified facilities such as `MATCHER`, `MATCHER_P` macros, and action templates aid in defining reusable, expressive matchers and actions.
- Support for composite and parameterized matchers enables highly customized conditions.

---

## 10. MockFunction Utility

- Easily mock `std::function<R(Args...)>` with `MockFunction<R(Args...)>`, allowing expectations on the callable object's invocation.
- Facilitates testing callback-based code with standard function types.

---

## Example Snippet: Delegating to a Fake

```cpp
class FakeFoo : public Foo {
 public:
  char DoThis(int n) {
    return (n > 0) ? '+' : (n < 0) ? '-' : '0';
  }
  void DoThat(const char* s, int* p) { *p = strlen(s); }
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(char, DoThis, (int n), (override));
  MOCK_METHOD(void, DoThat, (const char* s, int* p), (override));

  void DelegateToFake() {
    ON_CALL(*this, DoThis).WillByDefault([this](int n) {
      return fake_.DoThis(n);
    });
    ON_CALL(*this, DoThat).WillByDefault([this](const char* s, int* p) {
      fake_.DoThat(s, p);
    });
  }

 private:
  FakeFoo fake_;
};

// Usage in test:
TEST(FooTest, DelegateToFake) {
  MockFoo foo;
  foo.DelegateToFake();
  EXPECT_CALL(foo, DoThis(5));
  EXPECT_CALL(foo, DoThat(_, _));

  int n = 0;
  EXPECT_EQ(foo.DoThis(5), '+');
  foo.DoThat("Hi", &n);
  EXPECT_EQ(n, 2);
}
```

---

## Summary

Recent releases of GoogleTest have introduced numerous enhancements focused on expanding the power and flexibility of mocking and expectations. These include improved mock declaration macros, richer matchers and actions, support for move-only types, enhanced control over expectation sequencing, thread safety improvements, and better diagnostics.

Empower your test suites by integrating these capabilities to write more precise, maintainable, and reliable tests.

---

## Where to Learn More

- [Declaring and Using Mocks](../api-reference/googlemock-mocking-apis/declaring-and-using-mocks)
- [Specifying Expectations & Actions](../api-reference/googlemock-mocking-apis/specifying-expectations-actions)
- [Advanced Mocking Techniques](../api-reference/googlemock-mocking-apis/advanced-mocking-techniques)
- [gMock Cookbook](../docs/gmock_cook_book.md)
- [gMock for Dummies](../docs/gmock_for_dummies.md)

Visit the [GoogleTest Changelog](../changelog/release-notes/version-history) for detailed version histories and [Breaking Changes](../changelog/upgrade-guides-and-migration/breaking-changes) before upgrading.

---

<Tip>
Use `ON_CALL` to define default behaviors and `EXPECT_CALL` to assert call expectations precisely. Leverage strictness wrappers judiciously to manage test noise and failures.
</Tip>

<Info>
To keep your tests robust and maintainable, start with broad expectations and tighten only when necessary. Employ sequences and cardinalities to express call orders and frequencies efficiently.
</Info>

<Warning>
Avoid over-specifying expectations, which can introduce brittleness and increase maintenance overhead.
</Warning>

<Check>
Move-only type support enables modern C++ idioms within your tests, removing previous limitations.
</Check>

<Steps>
<Step title="Declare your mock classes">
Use `MOCK_METHOD` with appropriate qualifiers for all virtual or mock methods.
</Step>
<Step title="Configure expectations">
Apply `EXPECT_CALL` and `ON_CALL` to define call expectations and behaviors.
</Step>
<Step title="Leverage advanced matchers and actions">
Compose detailed argument matchers and complex actions for realistic simulation.
</Step>
</Steps>
