---
title: "Breaking Changes"
description: "Document major breaking changes and backward-incompatible updates found in recent GoogleTest releases. For each change, detail the impact and suggest tested mitigation strategies to ensure your tests remain functional."
---

# Breaking Changes

This page documents the major breaking changes and backward-incompatible updates introduced in recent GoogleTest releases. For each change, you will find details on the impact and suggestions for mitigation strategies that have been tested to ensure your existing tests continue to function correctly.

---

## 1. Transition to the New MOCK_METHOD Macro

### What Changed

GoogleTest and GoogleMock have migrated from the legacy family of `MOCK_METHODn` macros to a unified and more powerful `MOCK_METHOD` macro syntax. This change improves mock method declarations by accepting the return type, method name, argument list, and optional qualifiers as distinct parameters.

### How This Affects You

- Existing mocks defined with `MOCK_METHODn`, `MOCK_CONST_METHODn`, and their variants still work but are deprecated.
- New mocks should use the `MOCK_METHOD` syntax for improved clarity, better compiler diagnostics, and support for advanced qualifiers.

### Migration Strategy

- Convert legacy mock definitions like:
  ```cpp
  MOCK_METHOD1(Foo, bool(int));
  MOCK_CONST_METHOD1(Bar, int(int));
  ```
  to the new syntax:
  ```cpp
  MOCK_METHOD(bool, Foo, (int), ());
  MOCK_METHOD(int, Bar, (int), (const));
  ```

- Wrap argument or return types containing commas in parentheses to avoid macro parsing errors. For example:
  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, (), ());
  ```
  Alternatively, define type aliases to simplify.

- Ensure mock methods remain declared in the `public:` section.

<Note>
Legacy macros will continue working for the foreseeable future but will be removed eventually. Forward planning your mock code with the new `MOCK_METHOD` macro is critical.
</Note>

---

## 2. Explicit Qualification of Method Qualifiers

### Change

The new `MOCK_METHOD` macro requires explicit specification of qualifiers such as `const`, `override`, `noexcept`, and reference qualifiers `ref(&)`, `ref(&&)`.

### Impact

- Your mock method declarations must include these qualifiers to correctly override virtual methods.

- For example:
  ```cpp
  MOCK_METHOD(void, Foo, (int x), (const, override, noexcept));
  ```

### Mitigation

- Audit all mock definitions to verify that necessary qualifiers are included.
- Use the `override` qualifier to help catch mismatches at compile time.

---

## 3. Modifiers on Mock Objects: NiceMock, StrictMock, and NaggyMock

### Background

GoogleMock distinguishes mock behavior based on how it treats uninteresting calls through the use of wrapper classes:

- `NiceMock<T>` suppresses warnings on uninteresting calls.
- `NaggyMock<T>` (default behavior) warns on uninteresting calls but does not fail.
- `StrictMock<T>` treats uninteresting calls as test failures.

### Changes

- These wrappers only affect mock methods declared directly in the mock class with `MOCK_METHOD`.
- They might not work correctly with mock methods inherited from base classes.

### Recommendations

- Prefer using `NiceMock` or `StrictMock` with mocks directly using the new `MOCK_METHOD` macro.
- Avoid nesting wrappers (e.g., `NiceMock<StrictMock<MockFoo>>`) as it is not supported.

---

## 4. Expectation Clause Ordering Enforcement

### What's New

GoogleMock now strictly enforces the order in which clauses are chained in `EXPECT_CALL` and `ON_CALL` statements at runtime, which was previously informal.

### Clause Order for `EXPECT_CALL`

```cpp
EXPECT_CALL(mock_obj, Method(args))
    .With(matcher)          // Optional, must be first if present
    .Times(cardinality)     // Optional, at most once
    .InSequence(seq...)     // Optional, can appear multiple times
    .After(expectations...) // Optional, multiple times
    .WillOnce(action)       // Optional, multiple times
    .WillRepeatedly(action) // Optional, at most once
    .RetiresOnSaturation(); // Optional, at most once, must be last if present
```

### Impact

- Calling these methods out of order triggers runtime errors.
- It helps prevent subtle bugs in test setup.

### Mitigation

- Review your test code to ensure that clause chaining follows the correct order.
- Move `.With()` immediately after `EXPECT_CALL` or `ON_CALL` if used.
- Call `.RetiresOnSaturation()` last if used.

---

## 5. Ensuring One-Time Evaluation of Arguments in `EXPECT_CALL` and `ON_CALL`

### Change Details

The framework guarantees that the arguments passed to `EXPECT_CALL` and `ON_CALL` are evaluated exactly once, preventing unexpected side effects from multiple evaluations.

### User Impact

- Expressions with side effects should continue behaving correctly.
- If you had workarounds to prevent multiple evaluations, these can be simplified.

---

## 6. Default Action Semantics for Uninteresting and Unexpected Calls

### Summary

- An **uninteresting call** is a call to a mock method without any matching `EXPECT_CALL`. It triggers:
  - A warning in default and `NaggyMock` mode.
  - No warning in `NiceMock`.
  - A failure in `StrictMock`.

- An **unexpected call** is a call matching a method but not matching any active expectations.
  - Always an error regardless of mock wrapper.

### Recent Changes

- More informative diagnostic messages for uninteresting and unexpected calls.
- Stack traces in warnings available when `--gmock_verbose=info`.

### Recommendations

- Use `ON_CALL` to specify default actions for methods you don't expect to verify.
- Use `NiceMock` for tests that shouldn't be cluttered with warnings.
- Avoid suppressing messages by overusing `EXPECT_CALL` without intent to verify calls.

---

## 7. Retiring Expectations (`RetiresOnSaturation()`)

### What Changed

Expectations are “sticky” by default and remain active even after reaching their call limit. You can opt-in to make expectations *retire* and become inactive once saturated by using `.RetiresOnSaturation()`.

### Why It Matters

- Prevents further calls from matching the saturated expectation.
- Useful for sequences of expectations where each is expected a certain number of times.

### Mitigation

- Add `.RetiresOnSaturation()` to expectations that should deactivate upon saturation.
- Particularly useful when arranging expectations in a sequence.

---

## 8. Enhanced Support for Overloaded Methods

### Change

- Proper overload resolution in mocks, including const and non-const versions.
- Helper utilities like `Const()` make it easier to disambiguate expectations.

### Impact

- Write expectations targeting the correct overload explicitly.

### Example

```cpp
using ::testing::Const;

EXPECT_CALL(Const(mock), OverloadedMethod(5))
    .WillOnce(Return(11));
```

---

## 9. Move-Only Types Support

### Change

Full support for mocking methods with move-only parameters and return types (e.g., `std::unique_ptr`), including proper handling in `EXPECT_CALL` and `ON_CALL`.

### User Advice

- Use lambdas or `WillOnce` with returning new instances for returning unique pointers.
- Avoid returning a moved-from object multiple times.

---

## 10. Mock Verification and Clearing APIs

### New or Enhanced APIs

- `Mock::VerifyAndClearExpectations()` lets you explicitly verify and clear expectations at any time.
- `Mock::VerifyAndClear()` clears both expectations and default actions.

### Use Cases

- Long-living mocks owned by production code.
- Resetting mocks without destroying them.

---

## 11. Build and Running Tests Considerations

### Enforcement

- Always `return RUN_ALL_TESTS();` from `main()` to ensure proper test results.

### Compiler and Platform Notes

- Requires C++17 compliance.
- Expect detailed diagnostic messages with correct expectations and actions.

---

## Troubleshooting Tips

- **Failure: Uninteresting calls warning or error**
  - Use `NiceMock` if the calls are expected but not relevant to the test.
  - Define `ON_CALL` with a suitable default action.

- **Failure: Unexpected call**
  - Check that all expected calls have matching `EXPECT_CALL`.
  - Verify argument matchers and call orders.

- **Compilation errors in mocks**
  - Check that mock method declarations use `MOCK_METHOD` with correct parentheses and qualifiers.
  - Wrap complex argument or return types containing commas with parentheses or use type aliases.

- **Slow compilation of mocks**
  - Move mock class constructor and destructor definitions to `.cc` files to reduce redundant compilation.

---

## Further Reading & References

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes and best practices.
- [Mocking Reference](../docs/reference/mocking.md) — Detailed reference on mock macros and classes.
- [gMock for Dummies](../docs/gmock_for_dummies.md) — Beginner-friendly guide explaining mocking concepts.
- [Using Mocks Correctly](../guides/core-workflows/using-mocks-correctly.md) — Practical user guide on expectation and mock usage.
- [Detailed Release Notes](../changelog/release-history/detailed-release-notes.md) — For the complete history and upgrade notes.

---

<Check>
Ensure all `EXPECT_CALL()` and `ON_CALL()` statements in your test code:
- Use the new `MOCK_METHOD` syntax ideally.
- Specify qualifiers explicitly in mock methods.
- Follow clause ordering rules.
- Use `RetiresOnSaturation()` when appropriate.
- Use wrappers (`NiceMock`, `StrictMock`) consciously for uninteresting call behavior.
- Use type disambiguation with overloads.
- Cover move-only types properly.
</Check>

---

## Contribution and Support

To contribute bug reports or improvements:

- Follow [Contributing guidelines](../../faq/resources-community-faq/contributing-faq.md) for issue reporting and contributions.
- Participate via the public GitHub repository: https://github.com/google/googletest
- Reach community and maintainers through mailing lists and issue trackers.

---

This concludes the documentation on breaking changes for GoogleTest and GoogleMock. Stay informed to maintain compatibility and take advantage of new features and improved mock support.
