---
title: "Improvements & Bug Fixes"
description: "Summary of bug fixes, performance improvements, and under-the-hood changes that make your testing faster and more reliable. This page also notes regressions fixed in recent releases."
---

# Improvements & Bug Fixes

This page details key bug fixes, performance enhancements, and reliability improvements made to GoogleTest and GoogleMock. These ongoing refinements ensure your testing environment is faster, more stable, and less error-prone.

---

## Recent Fixes and Enhancements

### Improved Mock Method Handling
- Corrected issues where mock methods with `const` parameters caused unexpected MSVC warnings (C4301, C4373). The fix involves clarifying how const qualifiers on parameters are treated, preventing spurious compiler diagnostics while maintaining correct mock overriding behavior.

### Enhanced Warning and Error Reporting
- Resolved duplicate failure messages reported on unsatisfied mock expectations, clarifying output to precisely reflect distinct failure points.
- Enhanced verbosity control flags, allowing users to finely tune the amount of diagnostic information during test execution, improving troubleshooting without overwhelming output.

### Variadic Function Mocking Guidance
- Clarified that variadic functions (`...` arguments) cannot be directly mocked due to type and argument count ambiguities, and recommended best practices such as providing overloaded function versions to simulate behavior.

### Heap and Memory Safety Improvements
- Fixed scenarios where mock objects lacking virtual destructors caused heap-check failures, emphasizing the importance of virtual destructors in mocked interfaces.

### Behavior and Ordering of Expectations
- Refined mock expectation matching rules to search expectations in reverse order, enabling more natural default and specialized behavior patterns, enhancing code clarity and reducing brittleness.
- Improved interaction with `RetiresOnSaturation()` for managing expectation lifetimes, helping prevent mismatches in call counts.

### Mock Actions Flexibility
- Added enhanced support for defining custom actions on mocked methods, including easier delegation to fakes, real objects, or parent classes, allowing more flexible test scenarios.

### Thread Safety and Concurrency
- Improved support for testing asynchronous and multi-threaded code, ensuring actions execute on the calling thread and handling concurrent expectations correctly.

### Build and Performance Optimizations
- Addressed excessive memory consumption in MSVC when compiling large mock classes, recommending avoiding the `/clr` flag for native mocking code.
- Provided guidance on moving mock class constructor and destructor definitions to separate source files to reduce compilation time.

## Best Practice Highlights

### Diagnosing Unsatisfied Expectations
- Use the `--gmock_verbose=info` flag to obtain detailed call traces of mock function invocations, helping identify mismatches quickly.

### Handling Uninteresting vs Unexpected Calls
- Clarified the distinction to avoid confusion: uninteresting calls cause warnings (can be suppressed via `NiceMock`), while unexpected calls are errors.

### Mocking Non-Virtual and Overloaded Methods
- Recommendations and examples show how to mock non-virtual functions and overloaded methods properly, including disambiguation techniques.

### Writing Robust Tests with Sequences
- Demonstrations show structuring expectations with `InSequence` and `After` clauses to enforce call ordering and partial ordering, reducing brittle tests.

### Avoiding Common Pitfalls
- Cautions on never setting expectations on mocks after they are passed to code under test to avoid undefined behavior.
- Advice on handling move-only types in mocks gracefully with updated `MOCK_METHOD` syntax and lambda-based actions.

## Troubleshooting and Tips

- How to avoid and interpret warnings about uninteresting calls.
- Understanding MSVC-specific bugs related to const-ness in mocked methods.
- Techniques to verify mock object behavior early using `Mock::VerifyAndClearExpectations()`.
- Using call delegation to fakes or real objects to improve test maintenance and behavior fidelity.

---

For detailed examples and recipes on mocking, visit the [gMock Cookbook](gmock_cook_book.md).

For precise API details and modifier clauses, see the [Mocking Reference](reference/mocking.md).

To write effective assertions and leverage matchers alongside mocks, explore [Using Assertions Effectively](guides/core-workflows/using-assertions.mdx) and the [Matchers Reference](api_reference/core_assertions_matchers/matchers_reference.mdx).

For advanced test organization and execution control, consult the [Advanced GoogleTest Topics](docs/advanced.md).

---

Stay updated with the [Version Highlights](version-highlights) and consult [Breaking Changes](breaking-changes) if upgrading your GoogleTest and GoogleMock versions.

---