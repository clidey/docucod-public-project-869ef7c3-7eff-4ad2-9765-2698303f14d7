---
title: "Breaking Changes & Migration Notes"
description: "Documentation of significant changes that require user attention, including removed APIs, incompatible behaviors, or required code updates. Paired with migration tips and references to affected source files or headers for direct remediation."
---

# Breaking Changes & Migration Notes

This document highlights significant changes in GoogleMock that demand your immediate attention. It explains removals, incompatible behaviors, and mandatory code updates that can impact your existing tests. To assist in smooth transitions, practical migration tips and direct references to affected source files and headers are provided.

---

## 1. Overview of Breaking Changes

GoogleMock evolves continuously to improve usability, maintenance, and compatibility. Occasionally, these enhancements require modifications to your mock code or test patterns. This page summarizes such critical changes that may break backward compatibility or require explicit updates.

### 1.1 Why These Changes Matter

- **Prevent Test Failures:** Understanding these changes enables you to update your code proactively, avoiding unexpected compilation or runtime errors.
- **Improve Test Reliability:** Some behavioral changes aim to make mock expectations and calls more consistent and less error-prone.
- **Leverage New API Patterns:** Migration tips guide adoption of improved idioms that enhance test clarity and maintainability.

---

## 2. Removed or Deprecated APIs

These APIs have been removed or deprecated due to obsolescence or better alternatives.

### 2.1 The Old `MOCK_METHODn` Macros

- **Change:** The family of macros like `MOCK_METHOD1`, `MOCK_CONST_METHOD1`, and their `_T` or `_WITH_CALLTYPE` variants are deprecated.
- **Impact:** They have been replaced by the more versatile `MOCK_METHOD` macro.
- **Migration:** Update mock definitions as follows:

```cpp
// Old macro:
MOCK_METHOD1(Foo, bool(int));

// New recommended macro:
MOCK_METHOD(bool, Foo, (int));
```

- **Benefits:** The new form handles const, noexcept, ref qualifiers, and call types more cleanly.

### 2.2 Deprecated Ways to Mock Non-Virtual Methods

- Though mocking non-virtual methods is possible, the recommended pattern is to refactor your design to use interfaces or compile-time templates for dependency injection.

---

## 3. Changes in Mock Method Definitions

### 3.1 Placement of `MOCK_METHOD`

- **Requirement:** `MOCK_METHOD` definitions must always reside in the `public:` section of mock classes, regardless of base class method access levels.
- **Reason:** This allows external test code to properly reference mock methods with `EXPECT_CALL` and `ON_CALL`.

### 3.2 Commas in Template Types

- **Issue:** Template parameters with commas break `MOCK_METHOD` argument parsing unless properly parenthesized or aliased.

```cpp
// Incorrect - will not compile
MOCK_METHOD(std::pair<int, int>, GetPair, ());

// Correct - wrap type in parentheses
MOCK_METHOD((std::pair<int, int>), GetPair, ());

// Or create an alias
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetPair, ());
```

---

## 4. Matchers and Expectation Behavior Updates

### 4.1 Strictness Wrappers

GoogleMock provides wrappers to control how uninteresting calls (calls with no matching expectation) are handled:

- `NiceMock<T>` suppresses warnings on uninteresting calls.
- `NaggyMock<T>` (the current default) prints warnings on uninteresting calls.
- `StrictMock<T>` treats uninteresting calls as test failures.

**Migration Tip:** Consider replacing raw mocks with `NiceMock` or `StrictMock` to better communicate intent and reduce noise.

### 4.2 `ON_CALL` vs `EXPECT_CALL`

- `ON_CALL` sets default behavior but does *not* set call expectations.
- `EXPECT_CALL` both sets behavior and expectations about call frequency and ordering.

**Best Practice:** Use `ON_CALL` to establish default mock behaviors in test fixtures, and `EXPECT_CALL` to verify specific calls within test cases.

### 4.3 Multi-Argument Matching

- Use compound matchers (like `With` clause and tuple matchers) to assert properties about all parameters collectively, e.g., argument relationships.

```cpp
EXPECT_CALL(mock, Func(_, _))
    .With(Lt());  // Expects first argument < second argument
```

---

## 5. Migration Guidelines

### Step-by-Step Migration Flow

1. **Identify Deprecated Macros:** Replace all instances of `MOCK_METHODn` macros with the generic `MOCK_METHOD` macro, ensuring correct parameter tuples.

2. **Update Mock Class Access:** Ensure all `MOCK_METHOD` declarations are moved to the public section, even for protected or private base methods.

3. **Resolve Parsing Issues:** For argument or return types containing commas, use wrapper parentheses or type aliases to avoid macro parsing errors.

4. **Adopt Strictness Wrappers:** Evaluate and apply `NiceMock`, `NaggyMock`, or `StrictMock` as appropriate for your test scenarios to gain better control over uninteresting call handling.

5. **Review Default Actions:** Audit your usage of `ON_CALL` and `EXPECT_CALL` to align with their intended usage and control mock behaviors accordingly.

6. **Refactor Free Function Mocks:** For mocking free functions, refactor code to use interfaces or function wrappers compatible with mocks.

### Example Adaptation for Mock Methods

```cpp
// Old:
class MockFoo : public Foo {
 public:
  MOCK_METHOD1(FooMethod, bool(int arg));
  MOCK_CONST_METHOD2(BarMethod, void(int, const std::string&));
};

// New:
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, FooMethod, (int arg), (override));
  MOCK_METHOD(void, BarMethod, (int, const std::string&), (const, override));
};
```

---

## 6. Critical Source References for Fixes

Direct remediation often involves the following source files and headers:

- `docs/gmock_cook_book.md`: Updated recipes illustrating `MOCK_METHOD` usage, strictness wrappers, and common migration scenarios.
- `docs/gmock_faq.md`: Legacy compatibility issues and explanation of common warnings.
- `docs/reference/mocking.md`: Authoritative reference on `MOCK_METHOD`, `EXPECT_CALL`, and strictness policies.
- `googlemock/include/gmock/gmock-nice-strict.h`: Implementation details and usage notes for `NiceMock`, `NaggyMock`, and `StrictMock`.

Developers should review these for concrete code patterns and rationale.

---

## 7. Troubleshooting Common Breakage

- **Compilation Errors for Mock Methods:** Verify parameter wrapping if commas are in any argument or return types.
- **Warning C4301 / C4373 on `const` Parameters with MSVC:** Remove redundant top-level `const` qualifiers in argument declarations to satisfy MSVC.
- **Unexpected Calls Despite `ON_CALL`:** Remember that `ON_CALL` sets default behavior but doesn't suppress warnings; use `EXPECT_CALL` or wrap mocks with `NiceMock` to suppress warnings if calls are allowed but not interested.
- **StrictMock Failures:** Check if any calls are made that are not expected; either specify additional `EXPECT_CALL`s or switch to `NiceMock` if appropriate.

---

## 8. Summary

These breaking changes and migration notes ensure that your GoogleMock tests remain robust and easier to maintain in the long term. Adoption of the new `MOCK_METHOD` macro, strictness wrappers, and best practices for expectation setup will streamline your testing workflows and reduce false positives or maintenance overhead.

For detailed examples, visit the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html).

---

<Callout>
**Pro Tip:** Use `MOCK_METHOD` exclusively for new tests and gradually migrate old mocks for cleaner, more maintainable code. Leverage `NiceMock` for suppressing uninteresting call warnings during incremental migration.
</Callout>

---