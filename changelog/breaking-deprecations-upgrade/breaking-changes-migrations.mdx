---
title: "Breaking Changes & Migrations"
description: "Explicit notices and explanations for any backward-incompatible changes introduced in each release, along with migration strategies, example refactors, and tips for updating codebases. This page helps users minimize upgrade friction and avoid common pitfalls."
---

# Breaking Changes & Migrations

Welcome to the definitive reference for understanding backward-incompatible changes introduced in GoogleTest releases. This page guides you through explicit notices of breaking changes, explains their impact, and offers practical migration strategies complete with example refactors and tips to update your code base smoothly.

Whether you're upgrading from an earlier version or maintaining long-term compatibility, this documentation ensures you can identify, adapt to, and overcome challenges that arise from API and behavior changes.

---

## Understanding Breaking Changes

GoogleTest and GoogleMock evolve continually to improve usability, correctness, and performance. Occasionally, this involves introducing changes that may break backward compatibility, especially in the mocking APIs and behaviors.

Breaking changes typically manifest as:

- Syntax or macro redefinitions that require adjustments in your mock declarations.
- Modifications in default mock behaviors, such as how uninteresting calls are handled.
- Changes in semantics around expectation matching or action invocation.
- Updates to the ordering or lifetime management of expectations.

This page clarifies these aspects explicitly so you can upgrade with confidence.

---

## Migration Strategies and Example Refactors

Upgrading your existing test suites becomes straightforward when following these proven steps and examples.

### 1. Audit Your Mock Declarations

If you are migrating from older API styles (e.g., `MOCK_METHODn`) to newer `MOCK_METHOD` syntax, make sure to:

- Replace old-style macros like `MOCK_METHOD1(Foo, bool(int))` with `MOCK_METHOD(bool, Foo, (int))`.
- Use the appropriate qualifier list (e.g., `(const, override)`) if mocking const or override methods.
- Wrap return or argument types containing commas in parentheses or use type aliases to avoid parsing errors.

Example change:

```cpp
// Old style
MOCK_CONST_METHOD1(Foo, bool(int));

// New style
MOCK_METHOD(bool, Foo, (int), (const, override));
```

### 2. Adapt to Expectation and Action Clause Ordering

The order and usage of chaining clauses such as `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` are strictly enforced.

- `.With()` clauses must appear at most once and be the first clause.
- `.Times()` can only appear once and must come before `.InSequence()`, `.WillOnce()`, `.WillRepeatedly()`, or `.RetiresOnSaturation()`.
- `.RetiresOnSaturation()` must be the last clause.

Example:

```cpp
EXPECT_CALL(mock, Method(_))
    .With(SomeMatcher())  // Must be first
    .Times(2)            // Before InSequence
    .InSequence(seq)
    .WillOnce(Return(1))
    .RetiresOnSaturation();  // Must be last
```

### 3. Handle Uninteresting and Unexpected Calls According to Your Mock Strictness

By default, mocks are *naggy* — they warn about uninteresting calls but allow them. To tailor your upgrade:

- Use `NiceMock<YourMock>` to suppress warnings on uninteresting calls.
- Use `StrictMock<YourMock>` to treat uninteresting calls as test failures.
- If you observe excessive warnings or failures after upgrade, assess whether your mock usage aligns with current strictness defaults.

Example:

```cpp
NiceMock<MockFoo> mock;  // Silences warnings about uninteresting calls
StrictMock<MockFoo> strict_mock;  // Fails test on uninteresting calls
```

### 4. Verify and Clear Expectations Proactively

Previously, some tests relied only on mock object destruction to verify expectations. To improve determinism:

- Use `Mock::VerifyAndClearExpectations(&mock_object);` after test phases.
- Use `Mock::AllowLeak(&mock_object);` if a mock object’s destruction is outside test control.

Example:

```cpp
MockFoo* mock = new MockFoo;
EXPECT_CALL(*mock, Foo());
// ... exercise ...
ASSERT_TRUE(::testing::Mock::VerifyAndClearExpectations(mock));
```

### 5. Review Usage of Default Actions and ON_CALL

Default behaviors set with `ON_CALL` can be overridden or superseded by `EXPECT_CALL` clauses. Ensure to:

- Set `ON_CALL` behaviors in test fixture setup or mock constructors.
- Use `EXPECT_CALL` to specify calls that must occur.
- Understand the precedence: later declarations override earlier ones.

---

## Common Pitfalls and Troubleshooting Tips

- **Parsing Errors Due to Unprotected Commas**: Wrap types like `std::pair<int, int>` in extra parentheses or use type aliases.

- **Multiple `.With()` or `.Times()` Clauses**: Enforce rule compliance to avoid silent failures or unexpected behavior.

- **Mismatch in Expected Call Counts**: Use `.RetiresOnSaturation()` for expectations that should retire after being saturated.

- **Unintended Uninteresting Call Warnings**: Switch to `NiceMock` or explicitly add `EXPECT_CALL(...).Times(AnyNumber())` for methods called outside of explicit expectations.

- **Memory Leaks of Mock Objects**: Use `Mock::AllowLeak()` if mocks live beyond test destruction or manage mock lifetimes carefully.

- **Overlapping Expectations**: Remember newer expectations take precedence in matching.

- **Compiler Compatibility**: Ensure your compiler fully supports at least C++17, as GoogleTest requires it.

---

## Example Migration Snippet

Here is a simplified example of migrating from the old to new mock method syntax and expectation style:

```cpp
// Old style
class OldMockFoo : public Foo {
 public:
  MOCK_CONST_METHOD1(Bar, bool(int x));
};

// New style
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Bar, (int x), (const, override));
};

// In tests
MockFoo mock;
ON_CALL(mock, Bar(_)).WillByDefault(Return(true));  // Default behavior
EXPECT_CALL(mock, Bar(42)).Times(2).WillOnce(Return(false));  // Expected calls
```

After upgrade, observe the proper clause ordering and consider wrapping expectations in sequences if call order matters.

---

## Additional Resources and References

To further ease your migration and deepen your mastery, please consult the following sections of the documentation:

- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md) — Detailed API specs and examples for mocks.
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) — Practical recipes including advanced mocking techniques.
- [Using Multiple Expectations and Sequences](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md#expect-call)
- [Understanding Uninteresting vs Unexpected Calls](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#uninteresting-vs-unexpected)
- [Default Actions and `ON_CALL`](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#ON_CALL)

---

## Summary of Key Upgrades

| Area                          | Description & Action Required                     |
|-------------------------------|--------------------------------------------------|
| Mock Method Declaration        | Use new `MOCK_METHOD` macro syntax with qualifiers|
| Expectation Clause Ordering    | Enforce `.With()`, `.Times()`, `.RetiresOnSaturation()` rules
| Mock Object Strictness         | Choose among `NiceMock`, `NaggyMock` (default), `StrictMock` appropriately
| Default Actions                | Place `ON_CALL` in fixture setup; don't `EXPECT_CALL` unless verifying
| Retiring Expectations          | Use `.RetiresOnSaturation()` to avoid oversaturation errors
| Verification Timing            | Use `Mock::VerifyAndClearExpectations()` proactively

---

## For Troubleshooting and Support

Should you encounter issues not covered here, consider:

- Enabling verbose logging with `--gmock_verbose=info` to get detailed matching and call traces.
- Reviewing the [Common Setup Issues](https://github.com/google/googletest/blob/main/docs/getting-started/troubleshooting-and-resources/common-setup-issues.mdx) guide.
- Engaging community and support channels as described in the [Community and Support Resources](https://github.com/google/googletest/blob/main/docs/getting-started/troubleshooting-and-resources/community-and-support.mdx) documentation.

---

Upgrade confidently with these insights to ensure your GoogleTest and GoogleMock usage stays robust, maintainable, and modern.