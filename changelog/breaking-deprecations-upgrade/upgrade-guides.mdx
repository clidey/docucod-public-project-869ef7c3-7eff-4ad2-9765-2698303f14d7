---
title: "Upgrade Guides"
description: "Step-by-step instructions and decision frameworks for upgrading between major versions, with tailored advice for both small and large projects. These guides minimize disruption and help teams adopt the latest GoogleTest features safely."
---

# Upgrade Guides

Step-by-step instructions and decision frameworks for upgrading between major versions, with tailored advice for both small and large projects. These guides minimize disruption and help teams adopt the latest GoogleTest features safely.

---

## 1. Introduction
Upgrading your test suite to a new major version of GoogleTest and GoogleMock involves careful planning to mitigate risks and leverage new capabilities. These upgrade guides provide clear, user-centric guidance to help you assess changes, update your code safely, and maximize the benefits of the latest GoogleTest features.

Whether you maintain a small codebase or a large-scale project, these guides help you make informed decisions, understand breaking changes, and smoothly transition to newer versions without disrupting your testing workflows.

---

## 2. Preparing for an Upgrade

### Understand Semantic Versioning
GoogleTest follows semantic versioning. Major versions may introduce breaking changes. Before upgrading, carefully review release notes for incompatibilities and modified behaviors.

### Review Your Test Suite Complexity
- For small projects, upgrades can often be straightforward.
- Large projects with extensive mocks and customizations may require comprehensive refactoring or staged rollouts.

### Backup and Branch
Create a dedicated branch for the upgrade. Preserve current working versions to enable rollback if necessary.

### Read Breaking Changes & Migration Notes
Prioritize reviewing the [Breaking Changes & Migration](https://github.com/google/googletest/tree/main/docs/changelog/breaking-deprecations-upgrade/breaking-changes-migrations.md) documentation for the targeted version. This will include:
- Changes in mocking APIs and syntax
- Adjustments in default mock strictness behavior
- Updated expectations syntax
- Modifications in flag usage

---

## 3. Key Migration Topics

### 3.1 Mock Method Declarations
- Adopt the generic `MOCK_METHOD` macro for declaring mocks instead of legacy `MOCK_METHODn` macros.
- Always specify qualifiers like `const` or `override` as required. This reduces compiler warnings and improves correctness.

### 3.2 Expectation Clause Ordering
- Expectation clauses (`With()`, `Times()`, `InSequence()`, `WillOnce()`, etc.) must follow the documented order strictly.
- Misordered clauses can cause compilation errors or unexpected runtime behavior.

### 3.3 Mock Strictness Wrappers
- Understand new semantics for `NiceMock`, `NaggyMock`, and `StrictMock`:
  - The default mock strictness may have shifted (currently naggy by default but moving toward nice).
  - Apply `NiceMock<>` to suppress warnings on uninteresting calls.
  - `StrictMock<>` turns uninteresting call warnings into test failures.
- For legacy tests, update mocks accordingly to avoid false positives or unwanted warnings.

### 3.4 Default Actions and `ON_CALL`
- Use `ON_CALL` for setting default behaviors for mock methods. Overusing `EXPECT_CALL` for default actions can make tests brittle.
- Review places where `ON_CALL` would be more appropriate.

### 3.5 Deprecations and Removals
- Remove or replace deprecated APIs such as older macros, methods, or flags no longer supported.
- Migrate away from deprecated mocking techniques and interfaces as per the [Deprecations & Removals](https://github.com/google/googletest/tree/main/docs/changelog/breaking-deprecations-upgrade/deprecations-removals.md) documentation.

---

## 4. Migration Workflow

### Step 1: Audit Current Tests
Identify areas in your test suite that:
- Use deprecated macros or APIs.
- Have mock methods without explicit qualifiers.
- Use legacy mocking styles.

### Step 2: Incremental Refactoring
- Gradually update mock declarations to `MOCK_METHOD` with appropriate specifiers.
- Replace deprecated expectations syntax.
- Introduce `ON_CALL` clauses where default behaviors are needed without setting expectations.

### Step 3: Apply Strictness Wrappers Judiciously
Decide where to use `NiceMock`, `NaggyMock`, or `StrictMock` based on your tolerance for uninteresting call warnings. This improves test maintainability and clarity.

### Step 4: Update Build and CI Configurations
- Update test runners and build scripts to link against the upgraded GoogleTest libraries.
- Adjust flags such as `--gmock_verbose` as per new default verbosity and behavior.

### Step 5: Run and Debug
- Run your test suite with verbose logging enabled (`--gmock_verbose=info`) to trace unexpected behaviors.
- Fix any new warnings, failures, or mismatches in call expectations.

### Step 6: Validate and Merge
- After all tests pass and warnings are appropriately handled, merge your upgrade branch.
- Monitor test runs for potential regressions.

---

## 5. Best Practices and Recommendations

- **Use `MOCK_METHOD` Exclusively**: Avoid legacy macros for new code.
- **Specify Method Qualifiers**: Always use `const`, `override`, and other specifiers explicitly for correctness.
- **Prefer `ON_CALL` for Defaults, `EXPECT_CALL` for Verifications**: Avoid over-constraining tests with unnecessary expectations.
- **Manage Mock Strictness Based on Test Needs**: Use `NiceMock` by default, shift to `StrictMock` only when necessary to detect undesired calls.
- **Modularize Tests**: Break large tests into smaller ones to isolate expectations and minimize upgrade impact.
- **Read Release Notes Thoroughly**: Each major version release accompanies a detailed changelog which is a critical resource.
- **Consider Staged Rollout**: For large code bases, upgrade incrementally to avoid widespread failures.

---

## 6. Troubleshooting

<Tip>
If you encounter compilation errors related to mock methods, verify that your `MOCK_METHOD` declarations have the correct number of arguments and qualifiers.
</Tip>

<Tip>
Unexpected test failures may result from changes in default mock strictness. Using `NiceMock` to temporarily suppress warnings can help isolate issues.
</Tip>

<Tip>
Use `--gmock_verbose=info` flag to get detailed diagnostics on mock method calls and expectations during test execution.
</Tip>

---

## 7. Additional Resources
- [Breaking Changes & Migrations](https://github.com/google/googletest/tree/main/docs/changelog/breaking-deprecations-upgrade/breaking-changes-migrations.md)
- [Deprecations & Removals](https://github.com/google/googletest/tree/main/docs/changelog/breaking-deprecations-upgrade/deprecations-removals.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Writing Mock Expectations](https://google.github.io/googletest/guides/mocking-with-googlemock/writing-mock-expectations.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)

---

## 8. Summary
Upgrading to a new major version of GoogleTest involves understanding and applying new mocking APIs, adjusting to changed default behaviors, and carefully refactoring your mock declarations and expectations. Following the recommended workflow and leveraging rich documentation minimizes disruption and helps maintain reliable, maintainable test suites.

Continue exploring the related documentation pages for detailed reference and examples throughout your upgrade journey.
