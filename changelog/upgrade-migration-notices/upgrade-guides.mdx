---
title: "Upgrade Guides"
description: "Step-by-step instructions for upgrading to the latest version, addressing common migration issues and offering best practices. This page streamlines the process for teams looking to take advantage of new features and maintain compatibility."
---

# Upgrade Guides

Upgrade Guides provide clear, step-by-step instructions for moving your GoogleTest and GoogleMock projects to the latest version. This page focuses specifically on facilitating smooth migrations, addressing common compatibility challenges, and highlighting best practices to harness new features effectively while maintaining your test suite's integrity.

---

## 1. Why Upgrade?

Staying current with the latest GoogleTest versions delivers enhanced API capabilities, improved mock behaviors, stricter syntax compliance, and broader platform support. However, upgrades must be planned carefully to avoid regressions or breaking changes in your existing test suites.

This guide streamlines your upgrade journey by:

- Guiding through version-specific migration steps
- Providing practical solutions to common issues
- Suggesting best practices to maximize new functionality

## 2. Preparing for the Upgrade

### 2.1 Understanding Version Requirements

Before upgrading, verify that your environment meets the minimum requirements:

- GCC, Clang, or MSVC with C++17 support*
- Modern build system compatible with CMake â‰¥ 3.14 if you use CMake integration

*See [System Requirements](/getting-started/prerequisites-installation/system-requirements) for more details.

### 2.2 Reviewing Breaking Changes and Deprecations

Familiarize yourself with the [Breaking Changes and Migration Guide](/changelog/upgrade-migration-notices/breaking-changes) and [Deprecation Notices](/changelog/upgrade-migration-notices/deprecation-notices) to anticipate necessary code adjustments.

### 2.3 Backing Up and Testing

Always back up your existing repositories and create a separate branch for your upgrade work. Ensure automated tests pass prior to upgrade to isolate issues caused by changes.

## 3. Step-by-Step Upgrade Process

### 3.1 Updating Your Source

- Clone or fetch the latest releases from the official repository:

```bash
  git clone https://github.com/google/googletest.git -b v1.17.0
``` 

- Adjust your build scripts to point to the upgraded version.

### 3.2 Adapting to API Changes

- Replace legacy mock macros such as `MOCK_METHODn` with the modern `MOCK_METHOD` macro that supports qualifiers and call types. Example:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(bool, DoSomething, (int x), (override, const));
};
```

- Prefer `NiceMock`, `StrictMock` wrappers over `NaggyMock` to control warnings for uninteresting calls.

- Modify existing `EXPECT_CALL` statements to respect updated cardinality and call order rules. For complex ordering, consider using `Sequence` objects.

### 3.3 Handling Mock Classes

- Ensure mock classes have virtual destructors to avoid undefined behavior with `NiceMock` and `StrictMock`.

- Move constructors and destructors definitions out of header files if compilation times increase.

### 3.4 Using New Features

- Take advantage of improved call ordering, sticky expectations, and multithreading support.

- Use new matchers and actions by consulting the [Matchers](/api-reference/matchers-and-actions/argument-matchers) and [Mock Actions](/api-reference/matchers-and-actions/mock-actions) references.

### 3.5 Rebuilding and Running Tests

- Build your test target linked with updated GoogleTest and GoogleMock libraries.
- Use verbosity flags `--gmock_verbose` to diagnose uninteresting or unexpected calls.
- Investigate test failures with stack traces and mock call traces enabled.

## 4. Troubleshooting Common Migration Issues

### 4.1 Build and Link Errors

- Verify that all source files include the correct headers (e.g., `<gmock/gmock.h>`).
- Check CMake or build scripts for consistent linkage against the new version.
- For Windows, ensure runtimes are consistently linked (static versus dynamic).

### 4.2 Unexpected Uninteresting Mock Calls

- Use `NiceMock` to suppress unwanted warnings.
- Add catch-all `EXPECT_CALL(mock, Method(_)).Times(::testing::AnyNumber())` as needed.

### 4.3 Failing Test Expectations

- Ensure your `EXPECT_CALL`s conform to the new call order and cardinality rules.
- Use `RetiresOnSaturation()` for expectations that should deactivate once saturated.
- For complicated call order, use `Sequence` objects or `InSequence` scoped blocks.

### 4.4 Move-Only Type Support

- Confirm usage of the new `MOCK_METHOD` macro which supports move-only arguments naturally.
- For older legacy workarounds, migrate to direct mocking with `MOCK_METHOD`.

## 5. Best Practices to Follow Post-Upgrade

- Always prefer `ON_CALL` for setting default mock behaviors and reserve `EXPECT_CALL` for verifications.
- Keep tests resilient with minimal constraints, avoiding excessive `EXPECT_CALL` decorations.
- Use scoped sequences for strictly ordered interaction tests.
- Regularly update dependencies and monitor release notes for incremental upgrades.

## 6. Additional Resources

- [Getting Started Setup & Installation](/guides/getting-started/setup-installation)
- [Using Mocks: Patterns and Best Practices](/guides/mocking-and-advanced-techniques/using-mocks)
- [Mock Method Definition Reference](/api-reference/mocking-apis/mock-methods)
- [Expect Call and ON_CALL API](/api-reference/mocking-apis/expect-call-and-on-call)
- [Mock Class Behavior Guide](/api-reference/mocking-apis/mock-class-behaviors)
- [Troubleshooting Setup Issues](/getting-started/first-steps-usage/troubleshooting-setup)

---

> Upgrade Guides ensure your testing infrastructure stays robust and takes full advantage of GoogleTest's evolving capabilities. By carefully following the guidance here, your team will maintain compatibility, reduce upgrade friction, and write clearer, more maintainable tests.
