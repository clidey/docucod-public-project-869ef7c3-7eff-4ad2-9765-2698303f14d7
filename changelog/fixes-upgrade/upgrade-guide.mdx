---
title: "Upgrade Guide"
description: "Comprehensive instructions for upgrading from previous versions, highlighting pre-upgrade steps, configuration changes, and compatibility notes. Designed to equip users to upgrade with confidence and minimal disruption."
---

# Upgrade Guide

This Upgrade Guide is designed to help you transition smoothly from previous versions of GoogleTest and GoogleMock to the latest release. It lays out essential pre-upgrade considerations, configuration updates, and compatibility notes so your test environment stays stable while taking advantage of new features and improvements.

---

## 1. Preparing for the Upgrade

Before upgrading, itâ€™s critical to review your current test code and build configuration to identify any changes you need to make. This preparation ensures a seamless transition with minimal disruption to your testing workflow.

### 1.1 Validate Compiler and Platform Support

- Ensure your compiler supports at least **C++17**, as the GoogleTest 1.17.0 and later releases require this standard.
- Confirm platform compatibility against the [Supported Platforms & Compatibility](https://google.github.io/googletest/overview/integration-platforms/supported-platforms) documentation.

<Tip>
If your build environment does not meet the minimum C++ standard or platform requirements, update your compiler or platform accordingly before proceeding.
</Tip>

### 1.2 Backup Existing Test Suites

- Backup your current test sources and configurations.
- Track any custom configurations, macros, or test fixtures that may require changes.

### 1.3 Review Deprecated APIs and Practices

- Review the [Deprecations & Migration Guides](https://google.github.io/googletest/changelog/breaks-deprecations/deprecations-migrations) page to identify APIs or patterns slated for removal.
- Pay attention to migration examples to update your tests accordingly.

<Note>
Proactively refactoring deprecated constructs avoids future breakage and leverages the improvements in modern GoogleTest releases.
</Note>

---

## 2. Upgrade Steps

Follow these steps to upgrade your GoogleTest and GoogleMock code bases, focusing on areas most likely to be impacted by changes.

### 2.1 Update Mock Method Declarations

GoogleMock introduced an enhanced and unified `MOCK_METHOD` macro to supersede the older `MOCK_METHODn` macros. Ensure your mock classes reflect this usage:

```cpp
class MockClass {
 public:
  // Preferred new syntax:
  MOCK_METHOD(ReturnType, FunctionName, (ArgTypes...), (const, override));

  // Avoid old style:
  // MOCK_METHOD1(FunctionName, ReturnType(ArgType));
};
```

<Tip>
Wrap argument or return types containing commas in parentheses or use type aliases to avoid macro parsing issues.
</Tip>

### 2.2 Adjust `EXPECT_CALL` and `ON_CALL` Usage

- Maintain the consistent order of chained clauses in `EXPECT_CALL` and `ON_CALL` as specified in the macro documentation.
- The order of multiple `EXPECT_CALL`s matters: newer expectations override older ones for matching function calls.
- Use `.With()` clauses carefully; only one `.With()` is allowed and it must be the first chain.

### 2.3 Use of NiceMock, StrictMock, NaggyMock

- Default mock objects currently behave like `NaggyMock`s.
- Consider switching to `NiceMock<T>` to suppress warnings on uninteresting calls.
- Use `StrictMock<T>` to convert uninteresting calls into failures for stricter test enforcement.

<Tip>
Remember that these wrappers only affect uninteresting calls, not unexpected calls, which always cause errors.
</Tip>

### 2.4 Handling Move-Only Types

- GoogleMock now fully supports mocking methods that accept or return move-only types like `std::unique_ptr`.
- Use lambdas or `WillOnce` with callable objects to return new instances, as `Return(std::move(...))` actions can only be called once.

Example:

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
    .WillOnce([](StringPiece) {
      return std::make_unique<Buzz>();
    });
```

### 2.5 Verify and Clear Expectations Proactively

- In cases where mock objects may not be destroyed predictably, explicitly call `Mock::VerifyAndClearExpectations(&mock_object)` to force verification of expectations.

---

## 3. Configuration File and Build Changes

### 3.1 Include Path Adjustments

- Update include directives to reflect the current header locations if you perform manual installation:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>
```

### 3.2 Initialization Calls

- Ensure your `main()` calls `testing::InitGoogleTest(&argc, argv)` before `RUN_ALL_TESTS()`.
- For GoogleMock, call `testing::InitGoogleMock(&argc, argv)`.

Example:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### 3.3 Linker and Build System Updates

- Adjust your build system to link with the latest GoogleTest and GoogleMock libraries, reflecting any split or merged library changes.
- If using CMake, consult the [Installing with CMake](https://google.github.io/googletest/getting-started/installation-initialization/installation-cmake) guide for updated targets.

---

## 4. Compatibility Notes

### 4.1 Breaking Changes

- Review [Breaking Changes](https://google.github.io/googletest/changelog/breaks-deprecations/breaking-changes) for details impacting test code, including macro naming restrictions and behavior.
- Update test names and macros to comply with new constraints, such as no underscores in test suite or test case names.

### 4.2 Deprecated and Removed APIs

- Migrate away from deprecated APIs as outlined in [Deprecations & Migration Guides](https://google.github.io/googletest/changelog/breaks-deprecations/deprecations-migrations).
- Use modern test suite syntax and macros.

### 4.3 Mock Method Syntax Changes

- Convert old-style `MOCK_METHODn` macros to the new generic `MOCK_METHOD` macro with qualifier lists.
- Pay attention to `const`, `override`, and reference qualifiers.

### 4.4 Runtime Flag Changes

- Familiarize yourself with `--gmock_verbose` flag settings (`info`, `warning`, `error`) to control mock call output verbosity.
- Configure flags at runtime or inside test code to reduce noise during test development versus strict validation in CI.

---

## 5. Troubleshooting Tips

### 5.1 Common Failures After Upgrade

- Unexpected mock function call errors often indicate mismatch of expectation order or argument matchers.
- Use `--gmock_verbose=info` to trace mock call matching and diagnose issues.

### 5.2 Handling Uninteresting Calls

- If you encounter many warnings about uninteresting calls, consider integrating `NiceMock` or explicitly add `EXPECT_CALL(...).Times(AnyNumber())` to suppress them for expected unverified calls.

### 5.3 Slow Compilation Due to Mocks

- To mitigate slow compilation, move mock class constructor and destructor definitions to `.cc` files instead of inline in headers.

### 5.4 Deadlocks in Multithreaded Tests

- GoogleMock supports thread safety for method calls and actions.
- Ensure your expectations and default actions are set up before worker threads start calling mocks.
- Synchronize state changes within actions carefully.

---

## 6. Additional Resources and Next Steps

- [Mocking Reference](https://google.github.io/googletest/api/gmock_reference.html) for detailed mock classes, macros, and expectations.
- [Expectations, Actions, and Call Sequences Guide](https://google.github.io/googletest/guides/mocking-patterns/expectations-actions-sequences) for mastering mock behavior specifications.
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) for guidance on common issues during migration.
- [Test Macros and Suites](https://google.github.io/googletest/api/gtest_ref.html#test-macros-and-test-suites) for updated test declaration syntax.
- Explore [New Features & Improvements](https://google.github.io/googletest/changelog/release-highlights/new-features-improvements) to utilize latest capabilities.

<Tip>
Keep your test code resilient by refactoring to use modern GoogleTest constructs as you upgrade.
</Tip>

---

This guide ensures that as you upgrade GoogleTest and GoogleMock, your testing workflow remains stable, your mocks continue to perform as expected, and you benefit from the latest tooling improvements and modernized interfaces.

For detailed migration examples and step-by-step upgrade instructions, please refer to the linked migration guides accompanying each release note.