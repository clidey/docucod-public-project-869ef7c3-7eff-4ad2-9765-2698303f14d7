---
title: "Migration & Upgrade Guide"
description: "Step-by-step guidance to ensure a smooth transition from previous major versions of GoogleTest or GoogleMock. This page outlines pre-upgrade checks, configuration and build updates, API changes, and best practices for adopting new features or replacing deprecated ones."
---

# Migration & Upgrade Guide

GoogleTest and GoogleMock evolve continuously to deliver new capabilities, improved compatibility, and enhanced user experience. This Migration & Upgrade Guide is crafted to help you transition smoothly from previous major versions to the latest releases with confidence.

Here, you will find detailed, practical steps and best practices focusing on what you need to update in your projects, handle deprecated features, and adopt new APIs â€” all framed around user-centric outcomes.

---

## 1. Pre-Upgrade Checklist

Before you upgrade your codebase or build system, confirm the following prerequisites to avoid common pitfalls:

- **Compiler Compatibility**: Ensure your compiler supports at least C++17, as this is now a minimum requirement from version 1.17.x onward.
- **Toolchain Updates**: Update your build tools, especially CMake version, to support changes in GoogleTest's build process.
- **Third-Party Dependencies**: Verify dependencies like the Abseil library. GoogleTest plans to adopt Abseil in future releases, so pre-emptive compatibility checking is recommended.
- **Code Backup**: Always back up your current test code and configuration files.

<Tip>
Run your test suite and verify it's stable before upgrading. This safeguards against attributing existing failures to the upgrade.
</Tip>

---

## 2. Build System Changes

The building and linking steps may require updates due to evolving configuration options and dependencies.

### CMake Configuration

- GoogleTest and GoogleMock now require enabling C++17 explicitly. Update your `CMakeLists.txt` to request this standard:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- When integrating GoogleMock, consider whether to use the bundled main function or to provide a custom one. The libraries `gmock_main` and `gmock` are version-aligned, and you can choose accordingly.

- Ensure threading support flags (e.g., `GTEST_HAS_PTHREAD`) are consistent with your platform. GoogleTest's CMake scripts auto-detect but double-check for cross-platform or cross-compilation builds.

### pkg-config

- If you use pkg-config, confirm that pkg-config files (`gmock_main.pc`, `gmock.pc`) specify the correct dependencies and installation directories as per your environment.

---

## 3. API and Macro Changes

GoogleTest and GoogleMock evolve their APIs to enhance flexibility and correctness. Some macros and patterns may be deprecated or have new recommended usage.

### MOCK_METHOD Macro

- The `MOCK_METHOD` macro now expects C++17 compatible syntax. You must place mock method declarations inside the `public` section of the mock class, regardless of the original method's access level.
- If your mock method signature includes types with commas (e.g., `std::pair<bool, int>`), wrap argument types with parentheses or use type aliases to prevent parsing errors.

Example:

```cpp
class MyMock {
 public:
  using BoolInt = std::pair<bool, int>;
  MOCK_METHOD(BoolInt, GetPair, ());
};
```

### Flag Macros

GoogleMock macros for defining and using custom command-line flags have an updated interface that may require your custom flags' declarations to use the macros with suffix underscores, e.g., `GMOCK_DECLARE_bool_` and `GMOCK_DEFINE_bool_`.

### Deprecations

- The older `MOCK_METHODn` family of macros is deprecated. Transition to the modern `MOCK_METHOD` syntax to benefit from more robust parsing and feature support.

### Customization Points

Refer to the `gmock/internal/custom/README.md` for instructions on defining custom behavior through macros in `gmock-port.h`.

---

## 4. Best Practices for Upgrading

### Use ON_CALL vs EXPECT_CALL

- Use `ON_CALL` for specifying default behaviors without setting call count expectations.
- Reserve `EXPECT_CALL` for cases where you intend to verify that calls happen with specific arguments or counts.

### Handling Move-Only Types

- Starting around 2017, GoogleMock supports mocking methods with move-only parameters like `std::unique_ptr`. Ensure your mock classes and actions (e.g., lambdas) handle these correctly.

### Suppress Uninteresting Call Warnings

- Use `NiceMock` to suppress warnings on uninteresting calls, or `StrictMock` to enforce strict expectations. These help reduce test flakiness and noise.

### Compilation Performance

- For faster compilations, define your mock class constructors and destructors in `.cc` files rather than inline in headers.

### Verification Before Destruction

- In complex ownership scenarios, explicitly call `Mock::VerifyAndClearExpectations(&mock_object)` before destruction to ensure all expectations are validated.

---

## 5. Troubleshooting Common Upgrade Issues

<AccordionGroup title="Upgrade Troubleshooting">
<Accordion title="Build Errors Related to Compiler or Flags">
Ensure your compiler supports C++17. Update your compiler toolchain if necessary. Check for flags in your build scripts that may disable required features like RTTI or exceptions.
</Accordion>
<Accordion title="Mock Method Parsing Errors">
Wrap argument or return types that include commas in parentheses or use type aliases to prevent `MOCK_METHOD` parsing failures.
</Accordion>
<Accordion title="Flag-Related Compilation Issues">
Make sure flag macros are defined using the correct, updated macros (`GMOCK_DEFINE_bool_`, etc.) and that Abseil flag support is configured if used.
</Accordion>
<Accordion title="Uninteresting Call Warnings or Failures">
Evaluate your use of `EXPECT_CALL`. If you don't want strict verification, wrap mocks in `NiceMock`. For strict verification, use `StrictMock` but be prepared to handle all call expectations.
</Accordion>
</AccordionGroup>

---

## 6. Additional Resources and Next Steps

- Cross-reference the [Mocking Reference](../reference/mocking.md) and [gMock Cookbook](../gmock_cook_book.md) for detailed mock creation and usage patterns.
- Consult the [Breaking Changes & Deprecations](./breaking-changes.md) page for a curated list of incompatible or removed features.
- Review the [Detailed Release Notes](./detailed-release-notes.md) to align your upgrade with specific version changes.
- Explore build system integration guides and troubleshooting from the Getting Started section.

---

## 7. Summary

This guide equips you to upgrade your GoogleTest and GoogleMock usage safely and confidently. By focusing on key configuration updates, API migrations, build system alignment, and best practices, you will unlock the latest framework features while maintaining test stability.

Remember to progress iteratively: test your code with prior versions, implement changes gradually, and leverage the rich tooling and documentation that GoogleTest provides.

---

<Info>
For code repository and contribution guidelines, visit the official GoogleTest GitHub repository at [https://github.com/google/googletest](https://github.com/google/googletest).
</Info>

<Check>
Ensure your build environment meets the C++17 requirement and your mock classes have updated `MOCK_METHOD` declarations before upgrading.
</Check>

---