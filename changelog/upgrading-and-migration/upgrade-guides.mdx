---
title: "Upgrade Guides & Best Practices"
description: "Step-by-step guides and checklists for upgrading your project from earlier versions, including environment requirements (such as minimum C++ standard), build integration changes, and dependency updates. Ensures smooth adoption for users integrating GoogleTest and GoogleMock into ongoing projects."
---

# Upgrade Guides & Best Practices

GoogleTest and GoogleMock are continually evolving, introducing improvements, new language requirements, and integration enhancements. This page equips you with carefully crafted, step-by-step upgrade guides and comprehensive checklists focused specifically on upgrading your projects that depend on GoogleTest and GoogleMock. It covers environment requirements, build system updates, and dependency management to ensure your upgrading journey is smooth and successful.

---

## 1. Understanding the Upgrade Landscape

When upgrading GoogleTest and GoogleMock in an ongoing project, you want to be confident that test execution remains stable and all new features, optimizations, and bug fixes integrate seamlessly. This guide targets the common pain points:

- **Compiler and language standard upgrades:** Transitioning to at least the required C++17 standard.
- **Build system and dependency changes:** Adjusting your integration to reflect updated build flags, libraries, or directory structures.
- **API and mocking syntax shifts:** Adapting to deprecated macros and improved mocking conventions.

By focusing on these, you minimize disruptions and exploitation of new capabilities.

---

## 2. Step-by-Step Upgrade Workflow

Follow this structured approach to update your project smoothly.

<Steps>
<Step title="Check Compiler and Environment Requirements">
Ensure your build environment meets the minimum C++ language standard requirement of C++17, as mandated from GoogleTest version 1.17.0 onward. Verify your compiler version and flags align with this.

**Success criteria:** Compiler supports and enforces C++17 or newer.

**Example:** If you are using GCC, confirm version 7 or later, or MSVC 2017 or later, are in use.

Reference: [System Requirements](https://github.com/google/googletest/blob/main/docs/setup-prerequisites-installation/system-requirements.md)
</Step>

<Step title="Update Build Integration">
Review your project’s build scripts (e.g., CMakeLists.txt or Bazel BUILD files) to incorporate changes in GoogleTest and GoogleMock’s build integration.

- Update include directories if changed.
- Link against new or repositioned libraries.
- Adapt custom linker or compiler flags as required.

**Success criteria:** Code builds cleanly, linking correctly to GoogleTest and GoogleMock.

Reference: [Integrating with Build Systems](https://github.com/google/googletest/blob/main/guides/scenarios-and-best-practices/integrating-with-build-systems.md)
</Step>

<Step title="Migrate Deprecated Mocking Macros">
Replace any legacy `MOCK_METHODn` macros with the current generic `MOCK_METHOD` macro, adopting the modern signature.

**Before:**
```cpp
MOCK_CONST_METHOD1(Foo, bool(int));
```

**After:**
```cpp
MOCK_METHOD(bool, Foo, (int), (const));
```

**Note:** The new syntax clarifies method qualifiers and enhances compiler checks.

Reference: [Migrating to MOCK_METHOD](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#mock_method)
</Step>

<Step title="Adapt to Updated Death Test Styles">
GoogleTest now recommends specific death test styles for consistency and stability. Update your tests accordingly:

- Use `ASSERT_DEATH` and `EXPECT_EXIT` with the recommended styles.
- Validate test naming conventions for death tests.

**Success criteria:** Death tests run reliably without flaky behavior.

Reference: [Death Tests Outcomes](https://github.com/google/googletest/blob/main/guides/scenarios-and-best-practices/death-tests-outcomes.md)
</Step>

<Step title="Refresh Mock Expectations and Default Actions">
Review and harmonize `EXPECT_CALL` and `ON_CALL` usage.

- Prefer `ON_CALL` for default behaviors without enforcing call counts to reduce brittle tests.
- Use `EXPECT_CALL` only to verify necessary interactions.
- Apply strictness wrappers like `NiceMock` or `StrictMock` wisely to balance test noise and enforcement.

**Success criteria:** Tests avoid excessive failures or warnings due to mock misuse.

Reference: [Mocking Your First Functions](https://github.com/google/googletest/blob/main/guides/getting-started/mocking-your-first-functions.md) and [Controlling Mock Strictness](https://github.com/google/googletest/blob/main/guides/advanced-testing-patterns/controlling-strictness-of-mocks.md)
</Step>

<Step title="Update Custom Assertions and Matchers">
If your project uses custom assertions or matchers, verify compatibility with recent GoogleTest and GoogleMock APIs.

- Adapt macros or classes to reflect any changes in matcher interface.
- Test custom assertion messages to ensure clarity.

**Success criteria:** Custom extensions continue to compile and give meaningful diagnostics.

Reference: [Custom Assertions and Matchers](https://github.com/google/googletest/blob/main/guides/advanced-testing-patterns/custom-assertions-and-matchers.md)
</Step>

<Step title="Run Comprehensive Test Validation">
Perform full test suite execution.

- Use `--gmock_verbose=info` flag during test runs to gain detailed mock call insights if debugging failures.
- Address uninteresting or unexpected call warnings by refining expectations.
- Iterate based on output until all tests pass cleanly.

**Success criteria:** Test suite passes without warnings or errors.

Reference: [Quick Validation & Troubleshooting](https://github.com/google/googletest/blob/main/getting-started/first-test-validation/quick-validation-checks.md)
</Step>
</Steps>

---

## 3. Upgrade Checklists

Use these targeted checklists during upgrade cycles.

### Environment Checklist
- Confirm C++17 minimum compliance.
- Check compiler version and platform support.
- Update build tools (CMake/Bazel) as necessary.

### Build and Integration Checklist
- Adjust include paths and linker commands.
- Replace deprecated mocking macros.
- Update dependencies to newer GoogleTest/GoogleMock versions.

### Code and Tests Checklist
- Convert old-style mocks to `MOCK_METHOD`.
- Review mock strictness and default actions.
- Revise death test usage and naming.
- Leverage new mocking and testing features judiciously.

---

## 4. Best Practices to Avoid Pitfalls

- **Use `ON_CALL` and `EXPECT_CALL` appropriately:** Avoid over-constraining tests with unnecessary EXPECT_CALL expectations. Use ON_CALL for defaults.

- **Leverage `NiceMock` to suppress harmless warnings:** When uninteresting mock method calls are expected but not explicitly verified, preferring `NiceMock<T>` avoids noisy output.

- **Maintain virtual destructors on interfaces:** Ensure all base classes mocked have virtual destructors to prevent undefined behavior.

- **Sequence and Retire Expectations wisely:** Use `InSequence` and `.RetiresOnSaturation()` clauses to express call ordering and expectation lifetimes to reduce fragile ordering bugs.

- **Run your tests with verbosity when diagnosing issues:** The `--gmock_verbose=info` flag exposes mock call matching and expectation details to clarify problems.

---

## 5. Troubleshooting Common Upgrade Issues

<AccordionGroup title="Common Upgrade Challenges and Solutions">
<Accordion title="Compiler Errors Related to MOCK_METHOD Macros">
If you encounter template or parsing errors when migrating to `MOCK_METHOD`, watch out for unprotected commas in argument lists. Wrap types containing commas in extra parentheses or define type aliases.

Example:
```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```
</Accordion>

<Accordion title="Uninteresting Call Warnings">
Uninteresting mock call warnings occur when mock methods are called without corresponding expectations. Suppress these with `NiceMock` or by adding catch-all `EXPECT_CALL(...).Times(AnyNumber())`. Avoid blindly adding `EXPECT_CALL`s otherwise.
</Accordion>

<Accordion title="Test Failures Due to Death Test Style Changes">
Ensure your death tests conform to recommended styles and naming. Verify flags such as death test style are set appropriately, and tests execute in environments supporting these conventions.
</Accordion>
</AccordionGroup>

---

## 6. Additional Resources and Links

- [System Requirements](https://github.com/google/googletest/blob/main/docs/setup-prerequisites-installation/system-requirements.md) — minimum platform and compiler details
- [Installing GoogleTest (CMake & Bazel)](https://github.com/google/googletest/blob/main/getting-started/setup-prerequisites-installation/installation-cmake-bazel.md) — installation guidance
- [Integrating with Build Systems](https://github.com/google/googletest/blob/main/guides/scenarios-and-best-practices/integrating-with-build-systems.md) — build system best practices
- [Mocking Your First Functions](https://github.com/google/googletest/blob/main/guides/getting-started/mocking-your-first-functions.md) — mocking basics and patterns
- [Controlling Mock Strictness](https://github.com/google/googletest/blob/main/guides/advanced-testing-patterns/controlling-strictness-of-mocks.md) — mock behavior control
- [Breaking Changes & Migration](https://github.com/google/googletest/blob/main/changelog/upgrading-and-migration/breaking-changes.md) — comprehensive migration rules

---

Upgrade your GoogleTest and GoogleMock integration with confidence by following this focused guidance. Embrace modern C++ standards, improved mocking syntax, and enhanced test robustness to maximize test effectiveness and maintainability.
