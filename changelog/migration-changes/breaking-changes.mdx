---
title: "Breaking Changes"
description: "Documents any release that alters core APIs, changes test output or framework behaviors, or drops legacy support, including C++ standard upgrades. This page ensures developers don’t encounter surprises when upgrading."
---

# Breaking Changes

This page documents critical release changes in GoogleTest and GoogleMock that impact core APIs, test output, framework behaviors, and legacy support, including updates to the C++ standard requirements. Its purpose is to prepare developers for upgrade impacts, helping avoid surprises and ensuring smooth migration.

---

## 1. Overview of Breaking Changes

Upgrading your GoogleTest and GoogleMock version may introduce some behavioral or API compatibility issues. This documentation highlights changes that could affect how your tests and mocks operate.

These changes include but are not limited to:

- Modifications to core mocking APIs.
- Alterations in test output formatting.
- Changes in default mock object behaviors (such as how uninteresting calls are handled).
- Removal of deprecated features or legacy support.
- Upgrades to compiler and C++ standard requirements.

Understanding these changes helps maintain and upgrade your test suites confidently.

---

## 2. Core Mocking API Changes

GoogleMock's `MOCK_METHOD`, `EXPECT_CALL`, and `ON_CALL` APIs form the backbone of mocking in GoogleTest. Certain updates affect how these macros and their qualifiers behave:

### MOCK_METHOD Syntax and Qualifiers

- The signature and usage of `MOCK_METHOD` remain largely stable, but users must ensure correct use of qualifiers such as `(const)`, `(override)`, `(noexcept)`, and calling conventions via `Calltype(...)`. Incorrect or missing qualifiers may cause compilation errors or unexpected behavior.

- Types with embedded commas (e.g., `std::pair<bool, int>`) must be wrapped in parentheses or aliased to avoid parsing errors. This requirement persists and should be verified during migration.

- Always define mock methods in the `public:` section even if the base class methods are protected or private. This guarantees accessibility for mock specification macros.

### Expectation Declaration (`EXPECT_CALL` and `ON_CALL`)

- The order of chaining clauses in `EXPECT_CALL` calls is enforced strictly. For instance, `.With()` must be the first clause; `.Times()` must precede `.InSequence()`, `.After()`, `.WillOnce()`, and `.WillRepeatedly()`.

- The behavior when specifying multiple `.WillOnce()` or `.WillRepeatedly()` actions is explicitly defined: exhaustion of `.WillOnce()` actions leads to the use of `.WillRepeatedly()`, if present; otherwise, the default action is used.

- Overusing `.WillOnce()` clauses beyond the declared `.Times()` cardinality will produce warnings or errors.

- The newly clarified order of expectation resolution is last declaration takes precedence, which affects shadowing of expectations.

### Default Actions and Uninteresting Calls

- `ON_CALL` defines default behaviors for matching mock function calls without enforcing call expectations.

- The built-in handling of uninteresting calls remains, but mock object behaviors related to uninteresting calls (`NiceMock`, `NaggyMock`, `StrictMock`) have undergone refinement (see Mock Object Behaviors below).

- Unexpected calls (calls not matching any expectation) continue to be treated as test failures.

---

## 3. Changes in Mock Object Behavior

GoogleMock offers three standardized behaviors for mocks regarding calls without explicit expectations—`NiceMock`, `NaggyMock` (default), and `StrictMock`. Changes in these affect how uninteresting calls are reported and treated.

### NaggyMock (Default Behavior)

- Continues to warn about uninteresting calls (calls to mocked methods lacking expectations) with detailed messages highlighting call arguments and stack traces where enabled.

- The verbosity of warnings is controllable via the `--gmock_verbose=` flag.

### NiceMock

- Suppresses warnings about uninteresting calls, making test output cleaner.

- Now more robust in supporting mock classes with non-default constructors and move-only types.

- Provides constructors that inherit from the base mock class, including forwarding of constructor arguments.

- Known limitation: will only modify uninteresting calls for mock methods declared directly in the mock class, not inherited from base classes.

### StrictMock

- Treats uninteresting calls as errors rather than warnings.

- Shares similar constructor inheritance and move-only type support as NiceMock.

- Enforces strict call checking, causing test failures if any unexpected calls occur without expectations.

### Migration Impact

- The default mock behavior remains `NaggyMock` for now but the transition to `NiceMock` as default is anticipated, which may reduce noise in test logs but also obscure some warnings.

- Users should consciously select the mock object behavior suited to their test strictness requirements.

- Nesting of strictness modifiers (e.g., `NiceMock<StrictMock<T>>`) is unsupported and must be avoided.

---

## 4. Test Output and Diagnostic Message Updates

Test output formatting has been improved for clarity and debugging efficiency:

- More informative messages for unexpected, excessive, uninteresting calls, and unsatisfied expectations.

- Failure messages now include detailed mismatch information on arguments (`Expected arg #n` vs actual), pre-requisite calls, and expectations state (active, retired, saturated).

- Stack traces are included with call diagnostics at verbosity levels controlled by `--gmock_verbose=info`.

- Call traces when enabled show which expectations were tried and the reasons for mismatch.

- Warning messages are clearer about the source of warnings and default actions taken.

---

## 5. Compiler and C++ Standard Upgrades

- GoogleTest and GoogleMock now require a minimum C++14 standard for full functionality.

- All clients should ensure their projects are built with at least C++14 compatible compilers.

- Certain internal API changes, such as move-only type support in mock methods and actions, rely on C++14 features.

- This change may impact build systems and environments with older compilers or restrictive flags.

---

## 6. Dropped Legacy Support

- Deprecated macros and older style mocking constructs, such as the `MOCK_METHODn` family, have been deprecated in favor of the newer `MOCK_METHOD` macro. Migration is recommended.

- Support for mocking non-virtual methods is unchanged but legacy workarounds for move-only types may no longer be necessary.

- Legacy behavior related to mock destruction verification and leaked mock tracking has been improved or removed to align with modern testing practices.

---

## 7. Best Practices for Migration

- Verify your mock class definitions comply with the new `MOCK_METHOD` syntax and qualifiers.

- Review all `EXPECT_CALL` usages to confirm clause ordering and cardinality specifications are conformant.

- Choose mock object behaviors deliberately:
  - Use `NiceMock` to suppress benign uninteresting call warnings.
  - Use `StrictMock` when uninteresting call failures are desired.

- Adjust test build configurations to target C++14 or higher.

- Use the `--gmock_verbose=info` flag to trace mock call matches and better understand any failing expectations during upgrade.

- Test suites should be reviewed for deprecated features or removed behaviors.

---

## 8. Troubleshooting

- Unexpected compilation errors often stem from improper use of `MOCK_METHOD` qualifiers or missing parentheses around complex types.

- Warnings or failures about uninteresting calls frequently indicate that you need to switch mocks to `NiceMock` or explicitly specify catch-all expectations with `Times(AnyNumber())`.

- If tests fail due to order mismatches or unsatisfied prerequisites, review usage of `InSequence` and `After` clauses in your expectations.

- For issues related to move-only types or constructors with arguments, ensure usage of `NiceMock` or `StrictMock` and correct forwarding of constructor arguments.

- Use verbose logging flags to obtain detailed traces of mock call resolutions.

---

## 9. Additional Resources

- [Mocking Reference](../reference/mocking.md) — comprehensive reference for mocking APIs such as `MOCK_METHOD`, `EXPECT_CALL`, and `ON_CALL`.
- [gMock Cookbook](../gmock_cook_book.md) — recipes and best practices for creating and using mocks effectively.
- [Mock Object Behaviors](../core-mocking-apis/mock-object-behaviors.md) — detailed explanation of `NiceMock`, `NaggyMock`, and `StrictMock`.
- [Core Mocking APIs](../core-mocking-apis/mock-method-macros.md) — detailed macro syntax and qualifiers.
- [Matchers and Actions References](../matchers-and-actions/argument-matching.md) — for understanding argument matchers and actions.

For quick migration, review the upgrade guide and breaking changes page carefully and adapt your mocks/tests before upgrading.

---

Last updated: June 2024

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/mocking.md", "range": "1-430"},{"path": "googlemock/include/gmock/gmock-nice-strict.h", "range": "1-151"},{"path": "googlemock/test/gmock-nice-strict_test.cc", "range": "1-259"},{"path": "googlemock/test/gmock_output_test_.cc", "range": "1-188"},{"path": "googlemock/test/gmock-spec-builders_test.cc", "range": "1-961"}]} />