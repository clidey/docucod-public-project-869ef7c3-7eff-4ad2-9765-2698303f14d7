---
title: "Upgrade Guide"
description: "Step-by-step instruction for upgrading between major or breaking versions, covering code migration strategies, flag migrations, and known compatibility caveats. Supported by direct mapping to primary header and entry point files to help users adapt quickly."
---

# Upgrade Guide

This guide provides step-by-step instructions for upgrading between major or breaking versions of GoogleMock. It focuses on adapting your mock classes, expectations, and flags to new behaviors and interfaces, ensuring a smooth migration path with minimal friction. Key topics include code migration strategies, updating mock object behaviors, flag migrations, and awareness of known compatibility caveats.

---

## 1. Introduction to Breaking Changes

Major or breaking version upgrades may introduce changes that affect your existing mock code and test behavior. This guide helps you understand what changes to expect, why they were made, and how to adapt your code effectively.

Key motivations for breaking changes include:
- Aligning the default mock behavior with maintainability best practices.
- Modernizing the mock API and improving usability.
- Removing legacy macros and patterns.
- Improving diagnostic output and reducing noisy warnings.


## 2. Mock Object Behavior Changes

### The Nice, Naggy, and Strict Mocks

- **NaggyMock** (current default) warns on uninteresting calls â€” any method calls that have no `EXPECT_CALL` but are invoked nonetheless.
- The plan moving forward is to switch the default mock behavior to **NiceMock**, which **suppresses warnings on uninteresting calls**, delivering cleaner output and less brittle tests.
- **StrictMock** treats uninteresting calls as errors, ensuring tests fail early and strictly enforce expectations.

**Migration steps when upgrading:**

- Review your tests that currently rely on naggy mocks (default) and decide if switching to `NiceMock` is suitable.
- Change your mock object declarations as needed:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo; // suppresses warnings on uninteresting calls

using ::testing::NaggyMock;
NaggyMock<MockFoo> mock_foo; // warns on uninteresting calls (default)

using ::testing::StrictMock;
StrictMock<MockFoo> mock_foo; // errors on uninteresting calls
```

- Where you want to silence warnings in currently naggy mocks, replace `MockFoo` with `NiceMock<MockFoo>`.
- For strict enforcement, use `StrictMock<MockFoo>`.


### Constructor Inheritance Support

`NiceMock`, `NaggyMock`, and `StrictMock` now fully support forwarding all base class constructors, including those with multiple parameters or non-default constructors. This means you can initialize mocks with constructor arguments as before:

```cpp
NiceMock<MockFoo> mock(5, "hello");
```


### Known Limitations and Caveats

- These modifiers work **only for mock methods defined with the `MOCK_METHOD` macro directly in the mock class**, not inherited mock methods from base classes.
- Nesting modifiers (e.g., `NiceMock<StrictMock<MockFoo>>`) is unsupported and can cause unexpected behavior.
- Behavior of mock objects with non-virtual destructors may be unpredictable under these wrappers.


## 3. Flag Migrations and Default Behavior Adjustments

GoogleMock flags controlling mock behaviors have been updated or removed in some cases. Pay close attention to the following changes:

| Flag Name                        | Description                               | Migration Notes                                    |
|---------------------------------|-------------------------------------------|----------------------------------------------------|
| `--gmock_default_mock_behavior` | Controls default mock behavior (naggy/nice/strict) | Deprecated in favor of `NiceMock`, `NaggyMock`, or `StrictMock` types. Explicitly declare mock types instead of relying on this flag.
| `--gmock_catch_leaked_mocks`    | Detects leaked mocks during test runs.  | No change; recommended to keep enabled for robustness.
| `--gmock_verbose`                | Controls verbosity of GoogleMock output. Values: `info`, `warning`, `error` | Consider setting to `warning` or `error` to reduce noise after upgrading.

**Action:**

- Remove usage of deprecated flags in build or test scripts where possible.
- Prefer explicit use of `NiceMock`, `NaggyMock`, and `StrictMock` in code.
- Adjust verbosity flags during test execution to balance output detail and clarity.


## 4. Code Migration Strategy

### Replacing Legacy Mock Macros

If you are using any of the legacy `MOCK_METHODn` macros, migrate to the unified `MOCK_METHOD` macro as follows:

Old style:

```cpp
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD1(Foo, bool(int));
```

New style:

```cpp
MOCK_METHOD(bool, Foo, (int), (override));
MOCK_METHOD(bool, Foo, (int), (const, override));
```

This modern macro supports all qualifiers and offers better compiler diagnostics.


### Migrating Uninteresting Call Behavior

Previously, uninteresting calls (methods called without an expectation) would always produce warnings by default. With the default moving to `NiceMock`, these warnings will be suppressed.

If your tests depend on warnings appearing for uninteresting calls, you may need to use `NaggyMock` explicitly.


### Updating Mock Object Declarations

Switch your mock instance declarations based on the desired uninteresting call behavior:

| Behavior            | Declaration                                   |
|---------------------|-----------------------------------------------|
| Suppress Warnings   | `NiceMock<MockClass> mock;`                    |
| Warn on Uninteresting| `NaggyMock<MockClass> mock;` or `MockClass mock;` |
| Strict Fail on Uninteresting | `StrictMock<MockClass> mock;`             |


### Examples

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(void, DoSomething, (), (override));
};

// Old default behavior (naggy):
MockFoo mock;

// New recommended usage:
NiceMock<MockFoo> nice_mock;  // suppress uninteresting call warnings
StrictMock<MockFoo> strict_mock;  // treat uninteresting calls as errors

EXPECT_CALL(nice_mock, DoSomething());
nice_mock.DoSomething();
```


## 5. Practical Tips and Best Practices

- **Explicitly specify mock behavior wrappers** in your tests rather than relying on default behavior to avoid surprises after upgrading.
- Use `NiceMock` in everyday tests to reduce log noise and improve maintainability.
- Apply `StrictMock` to critical tests where you want hard enforcement of all expectations.
- When migrating, enable `--gmock_verbose=info` temporarily to see detailed mock function call traces to debug any unexpected behaviors.
- Avoid nesting mock behavior wrappers; keep your mocks simple and clear.
- Pay attention to base classes containing mock methods when wrapping mocks with `NiceMock` or `StrictMock`. They may not behave as expected.


## 6. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Upgrade Issues">
<Accordion title="Unintended Uninteresting Call Warnings After Upgrade">
If you still see warnings for uninteresting calls after switching to `NiceMock`, verify you are not wrapping mocks incorrectly or using base class mock methods. Also, check that the destructor of your mock class is virtual.
</Accordion>
<Accordion title="Using Old Mock Macros Causes Compile Errors">
Update your mock declarations to use the unified `MOCK_METHOD` macro and add the appropriate qualifiers like `(override)` and `(const)`.
</Accordion>
<Accordion title="Constructor Forwarding Fails for Mocks with Arguments">
Ensure you are using the latest GoogleMock version where `NiceMock` and others support forwarding all constructors properly.
</Accordion>
<Accordion title="Unexpected Test Failures with StrictMock">
Strict mocks treat uninteresting calls as errors. Add missing `EXPECT_CALL` declarations for calls you want to allow or switch to `NiceMock` if strictness is not desired.
</Accordion>
</AccordionGroup>


## 7. Summary

Migrating to newer major versions of GoogleMock requires careful adjustment of your mock object declarations and test expectations. Embrace `NiceMock` for cleaner tests, update legacy macro usage, and pay close attention to constructor forwarding and mock method inheritance limitations. Use verbosity flags for debugging and verify that flags and command-line parameters align with the new recommended settings.

---

## 8. Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy) - Detailed recipes on Nice/Naggy/Strict mocks
- [MOCK_METHOD Macro Reference](/api-reference/core-mocking-apis/mock-method-macros) - Usage and migration guidance
- [EXPECT_CALL & ON_CALL API Reference](/api-reference/core-mocking-apis/expectations-on-call) - Expectation declaration and behavior control
- [Mock Object Behaviors](/api-reference/core-mocking-apis/mock-object-behaviors) - Discussion on naggy, nice, and strict mock objects
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) - Troubleshooting and historical context

---

For smooth upgrade, carefully review your test mocks and expectations against these guidelines and leverage the extensive references to address edge cases and behavioral differences introduced in new versions.
