---
title: "Breaking Changes & Deprecations"
description: "Lists all changes that might require you to update or refactor your code. Includes API breaks, behavior modifications, and all deprecated functionality, with concrete examples and references to the affected modules."
---

# Breaking Changes & Deprecations

This page outlines all changes in GoogleTest and GoogleMock that can impact your existing codebases. It specifically covers API breaks, behavioral modifications, and deprecations that require you to update or refactor your tests to maintain compatibility and correctness. Each entry includes concrete examples and references to the affected modules, enabling you to understand what to change and how to migrate smoothly.

---

## Understanding Breaking Changes

Breaking changes are modifications in the APIs, behaviors, or internal conventions of GoogleTest or GoogleMock that may cause compilation, linking, or runtime failures in your existing tests. These include:

- Signature changes to public APIs
- Removed or renamed functions and macros
- Altered behavior of existing features that impact test results
- Changes in default behaviors that affect test semantics

It is critical to review this section when upgrading GoogleTest to avoid unexpected test failures and maintain test suite stability.

## Deprecations Overview

Deprecated features are those still available but planned for removal in future releases. Usage of deprecated functionality is discouraged as it risks breaking in upcoming versions. Deprecation notices help you:

- Identify deprecated APIs and macros
- Understand timelines and impacts of removal
- Get guidance on recommended replacements or new patterns

Regularly refactoring deprecated code sections ensures smoother upgrades.

---

## Notable Breaking Changes and Deprecations

### 1. Test and Test Suite Naming Restrictions

Due to internal naming conventions, **test suite names and test names must avoid underscores (`_`) at the start or end**, and the use of underscores is generally discouraged to prevent class name collisions. The following constraints apply:

- Test suite and test names cannot start or end with `_`
- Names containing consecutive underscores or starting with `_` followed by an uppercase letter are forbidden
- Avoid underscores in the middle to prevent name clashes when generating test class names

**Example of problematic naming:**

```cpp
TEST(Time_Flies, Like_An_Arrow) { ... }  // Generates conflicting class names
```

Instead, choose simple alphanumeric names:

```cpp
TEST(TimeFlies, LikeAnArrow) { ... }
```

> _Failure to comply may cause compilation errors or runtime problems as the internal class names clash or collide._

---

### 2. EXPECT_EQ and NULL Pointer Comparisons

GoogleTest historically supports `EXPECT_EQ(NULL, ptr)` and `ASSERT_EQ(NULL, ptr)` to simplify null pointer comparisons. However, support for `EXPECT_NE(NULL, ptr)` and `ASSERT_NE(NULL, ptr)` is **not provided** due to C++ template intricacies and maintainability concerns.

Users are encouraged to use `nullptr` in place of `NULL` as the preferred modern C++ idiom:

```cpp
EXPECT_EQ(ptr, nullptr);
EXPECT_NE(ptr, nullptr);
```

For negative pointer checks, use `EXPECT_TRUE(ptr != nullptr)`.

> _This change aligns with modern C++ best practices and encourages use of matcher syntax for more expressive checks._

---

### 3. Typed Tests vs. Value-Parameterized Tests

For tests targeting multiple implementations of the same interface, GoogleTest supports two approaches:

- **Typed Tests**: Use this when all implementations can be instantiated with the same code path, varying only by type.
- **Value-Parameterized Tests**: Use this when construction patterns or initialization vary significantly across implementations.

Both techniques remain supported, but careful choice affects test clarity and output:

- Typed tests report failure with type name, beneficial for identifying failing implementations directly.
- Value-parameterized tests require user-supplied names for test instances to get comparable output clarity.

You should evaluate your needs and experiment with both to determine the best fit.

---

### 4. Death Tests and Side Effects

Death tests are run in child processes to isolate crashes and ensure the main test process stays alive. Be aware:

- Any in-memory side effects or state changes caused inside death tests will **not** be observed in the parent process.
- If your dead test involves mocks, use `EXPECT_CALL` statements inside the `EXPECT_DEATH` macro body to properly capture expected mock calls.

```cpp
EXPECT_DEATH({
  EXPECT_CALL(mock, Method());
  ... code that triggers death ...
}, "death message");
```

This isolation ensures correctness but requires careful placement of expectations.

---

### 5. Default Constructor Requirement for Test Fixtures

Test fixture classes must have accessible default constructors. If you:

- Explicitly declare a non-default constructor, you must provide a default constructor.
- Have const non-static data members, you must provide a default constructor and initialize const members in constructor initialization lists.

Omitting these will cause compilation errors such as:

```
error: no matching function for call to 'FooTest::FooTest()'
```

Ensure your fixture classes meet these requirements to enable GoogleTest to instantiate them automatically.

---

### 6. Assertion Placement Constraints

GoogleTest disallows using `ASSERT_*` macros inside test fixture constructors or destructors because:

- Constructors/destructors cannot properly handle failures that abort the function.
- Virtual dispatch does not work correctly inside constructors/destructors.

Instead, prefer using `SetUp()` and `TearDown()` methods for any initialization or cleanup requiring assertions.

```cpp
void SetUp() override {
  ASSERT_TRUE(init_success);
}
```

Attempting `ASSERT_*` in ctor/dtor will result in compilation errors such as: "void value not ignored as it ought to be."

---

### 7. Disabling Tests with DISABLED_ Prefix

To temporarily disable a broken or incomplete test:

- Add the prefix `DISABLED_` to the test name.
- Disabled tests are compiled but not executed by default.
- Run tests including disabled ones with `--gtest_also_run_disabled_tests` flag.

Example:

```cpp
TEST(MySuite, DISABLED_MyTest) { ... }
```

Avoid commenting out tests or using preprocessor directives, which can lead to test decay.

---

### 8. Virtual Destructors for Mocked Interfaces

To avoid memory leaks and undefined behavior, interfaces intended for mocking **must have virtual destructors**.

Incorrect:

```cpp
class Foo {
public:
  ~Foo() { ... } // Non-virtual
  virtual void Bar() = 0;
};
```

Correct:

```cpp
class Foo {
public:
  virtual ~Foo() {}
  virtual void Bar() = 0;
};
```

Without a virtual destructor, deleting mocks or real objects through base class pointers can result in leaks and test instability.

---

### 9. Changed Mock Methods and Default Actions

Some changes to mock method declarations or behavior may affect how expectations and default actions are applied:

- If your mock methods change signatures, update calls to `EXPECT_CALL` and `ON_CALL` accordingly.
- When using `ON_CALL` for default behaviors, ensure `WillByDefault()` is specified; omission causes runtime failures.

Example:

```cpp
ON_CALL(mock_object, Method(arg_matchers))
    .WillByDefault(Return(value));
```

- Missing `WillByDefault()` causes a fatal test failure upon invocation.

---

### 10. Expectations and Action Clauses Ordering

When setting expectations on mocks, clauses must be specified in the correct order to avoid syntax errors:

- `.With()` clause (if used) must be the first clause.
- `.Times()` must precede `.InSequence()` and `.After()` clauses.
- `.WillOnce()` and `.WillRepeatedly()` must come after `.InSequence()` and `.After()`.
- `.RetiresOnSaturation()` must follow `.WillRepeatedly()`.

Violating these rules leads to runtime checks failing with descriptive messages.

---

## Migration Tips & Best Practices

- **Review all API usages** against the changelog when upgrading GoogleTest or GoogleMock versions.
- **Replace deprecated APIs** promptly following guidance and usage examples.
- Prefer **`nullptr` over `NULL`** for pointers in assertions.
- Ensure **test/fixture naming conventions** comply with updated restrictions.
- Write explicit **default behaviors** with `ON_CALL(...).WillByDefault(...)` to avoid unintentional warnings.
- Use **`INSTANTIATE_TEST_SUITE_P`** and typed/value-parameterized tests wisely for reusable coverage.
- Place `EXPECT_CALL` setups **before exercising** the mock to guarantee correct behavior.
- Use **`DISABLED_` prefix** for temporary test disabling instead of commenting or removing code.

---

## Troubleshooting Common Breakages

| Symptom                          | Likely Cause                      | Solution                    |
|---------------------------------|---------------------------------|-----------------------------|
| Compilation fails on test names  | Underscores start or end names   | Rename test suite/test names|
| Runtime fatal failure on mock calls| Missing `WillByDefault()` in `ON_CALL` | Add `.WillByDefault(...)`   |
| Unexpected mock calls and warnings| No matching `EXPECT_CALL`        | Add appropriate `EXPECT_CALL`|
| Tests not detected or run         | Fixture default constructor missing | Add public default ctor     |

---

## Additional Resources

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly guide to mocking
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes and best practices
- [Mocking APIs Reference](/api-reference/core-testing-apis/mocking-apis) — Detailed syntax and semantics
- [Assertions Reference](/docs/reference/assertions.md) — How to verify conditions
- [Test Discovery and Execution](/guides/essential-workflows/test-discovery-execution) — Guide on writing and running tests

---

This page is part of the [Changelog > Detailed Changelog](../../changelog/detailed-changelog) segment and complements other pages like [New Features & Improvements](new-features-improvements) and [Bug Fixes & Stability Updates](bug-fixes-patches).

Ensure to consult the [Version Timeline](../releases-overview/version-timeline) for a chronological release history.

---

For community support and further help, visit the [Community Support & Resources](../../faq/community-support-faq/finding-help) page.

---

_Last updated: GoogleTest main branch_

