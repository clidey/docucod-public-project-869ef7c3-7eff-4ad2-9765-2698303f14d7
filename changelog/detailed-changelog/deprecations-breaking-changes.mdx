---
title: "Deprecations & Breaking Changes"
description: "Lists methods, behaviors, or APIs that have been deprecated or altered incompatibly over time. Highlights removal timelines, migration notes, and warnings about features that might require code changes."
---

# Deprecations & Breaking Changes

This page details deprecated features, removed methods, and backward-incompatible changes in GoogleTest and GoogleMock. It informs you about deprecated APIs with their removal timelines, important migration notes, and warnings about modifications that may require you to refactor your test code.

---

## 1. Overview

GoogleTest and GoogleMock evolve to improve usability, performance, and maintainability. Along the way, certain APIs and behaviors have been deprecated or changed in ways that are incompatible with previous versions. This page guides you through those changes, so you are prepared to update your code and ensure successful migration.

## 2. Deprecated Features

### 2.1. Transition to C++17

GoogleTest now requires a **C++17 standard** compiler. Earlier versions supporting older standards are deprecated.

- **Action Required:** Update your project settings to use a C++17-compliant compiler.
- **Migration Tip:** Review your build system and ensure `-std=c++17` (or equivalent) is specified.

### 2.2. Removal of Old Mocking Macros

The older family of macros such as `MOCK_METHODn`, `MOCK_CONST_METHODn`, and their calltype variants have been deprecated in favor of the unified new `MOCK_METHOD` macro.

```cpp
// Deprecated:
MOCK_CONST_METHOD1(Foo, bool(int));
// Preferred:
MOCK_METHOD(bool, Foo, (int), (const, override));
```

- **Action Required:** Migrate all old mock declarations to the new `MOCK_METHOD` macro for better clarity and future compatibility.

### 2.3. Default Mock Behavior Change

Currently, mock objects behave in a "naggy" mode by default, issuing warnings for uninteresting calls. There is an ongoing plan to make mocks "nice" by default which will suppress such warnings.

- **Impact:** Prepare your tests for this behavioral change as it may affect diagnostics.

### 2.4. Deprecated Logging of Uninteresting Calls

The verbosity setting controlling warnings for uninteresting mock calls is settled on three levels: `info`, `warning`, and `error`. The default is `warning`. The older verbose settings are deprecated.

- **Recommendation:** Use `--gmock_verbose` with values `info`, `warning`, or `error` explicitly.

### 2.5. Disallowed Use of Underscores in Test Names

Test suite names and test names **should NOT contain underscores** due to reserved naming conventions by GoogleTest.

- **Reason:** Unintended name collisions and undefined behavior in fixture bindings.
- **Action Required:** Rename tests and suites that violate this rule.

## 3. Breaking Changes

### 3.1. Mandatory Use of Virtual Destructors in Mocked Interfaces

Mock classes **must** mock or inherit from base classes with virtual destructors to avoid undefined behavior or memory leaks.

```cpp
class Base {
 public:
  virtual ~Base() = default; // Required
  virtual void Foo() = 0;
};

class MockBase : public Base {
 public:
  MOCK_METHOD(void, Foo, (), (override));
};
```

- **Migration Note:** If your base classes do not have virtual destructors, add them before mocking.

### 3.2. Strict Ordering of Clauses in `EXPECT_CALL` and `ON_CALL`

The modifiers chained to `EXPECT_CALL` and `ON_CALL` must follow a specific order. For example, `.With()` must come before `.Times()`, and `.WillOnce()` must come before `.WillRepeatedly()`.

- **Impact:** Chaining clauses in incorrect order now triggers compile-time or run-time errors.

### 3.3. Search Order of Expectations is From Newest to Oldest

When multiple expectations match a mock call, GoogleMock selects the **last** declared active one. This behavior requires ordering of `EXPECT_CALL`s such that specific expectations come after more general ones.

- **Migration Tip:** Review your expectations' order to ensure the most specific expectations come last.

### 3.4. `WillOnce()` and `WillRepeatedly()` Restrictions

- Multiple `WillRepeatedly()` calls on the same expectation are forbidden.
- `WillOnce()` calls must precede `WillRepeatedly()`.

Failure to comply results in errors.

### 3.5. `RetiresOnSaturation()` Usage

This clause only applies to expectations with upper-bound call counts. Adding `.RetiresOnSaturation()` after `.WillRepeatedly()` or multiple times causes failures.

### 3.6. Move-Only Type Support

Mocking methods with move-only parameters or return types now works with the new `MOCK_METHOD`; however, some actions like `DoAll()` are not compatible with move-only types.

- **Migration:** Replace incompatible actions with lambdas or functors when dealing with move-only parameters.

### 3.7. Default Actions and Expectations Cleared After Verification

Using `Mock::VerifyAndClear()` or `Mock::VerifyAndClearExpectations()` clears all default actions and expectations. After this call, setting new expectations or actions is allowed but should be done with caution.

- **Best Practice:** Avoid setting new expectations on mocks after verification in the same test.

### 3.8. Disallow Nested Strictness Modifiers

Nested strictness wrappers like `NiceMock<StrictMock<MockFoo>>` are **not supported**.

- **Action Required:** Use either `NiceMock`, `NaggyMock`, or `StrictMock` singly.

### 3.9. Removal of Certain Legacy Macros

Macros like `MOCK_METHOD0`, `MOCK_CONST_METHOD1`, etc., although still supported now, will be removed in future versions.

- **Action Required:** Refactor to use `MOCK_METHOD` exclusively.

## 4. Migration and Upgrade Notes

### 4.1. Upgrading to GoogleTest/GoogleMock Requiring C++17

The upgrade guide highlights the need to switch to C++17 and update dependencies like Abseil (Absl) which GoogleTest uses internally.

Review your build environment, compiler, and dependency versions carefully before upgrading.

### 4.2. Adapting to New Mock Method Syntax

Replace any use of old-style mock macros with the new `MOCK_METHOD` syntax to benefit from improved clarity and future compatibility.

### 4.3. Adjusting for Verbosity Changes

If tests rely on warnings for uninteresting calls, consider explicitly switching to `NiceMock` to suppress these warnings, or keep the current verbosity flag.

### 4.4. Refactoring Tests to Avoid Underscores in Test Names

Rename tests containing underscores in test suite or test names, ensuring conformity with naming guidelines to prevent potential conflicts.

## 5. Deprecated and Removed APIs Table

| Deprecated Feature                       | Recommended Replacement                  | Removal Status/Info              |
|-----------------------------------------|-----------------------------------------|-------------------------------|
| Old `MOCK_METHODn` family                | New `MOCK_METHOD` macro                  | Deprecated; future removal     |
| Passing unqualified `NULL` in tests      | Use `nullptr`                           | Recommended                    |
| Nested strictness wrappers (e.g., `NiceMock<StrictMock<...>>`) | Only one level (single wrapper) | Unsupported                   |
| Global verbose flags beyond `info/warning/error` | Use standard verbosity levels        | Deprecated                    |
| Test or suite names with underscores     | Remove underscores                      | Enforced new naming policy     |

## 6. Common Pitfalls and Troubleshooting

### 6.1. Uninteresting Call Warnings

If you see warnings about uninteresting calls:

- Use `NiceMock` to suppress these if these calls are expected but not explicitly asserted.
- Or explicitly add `EXPECT_CALL(...).Times(AnyNumber())` for those methods.

### 6.2. Unexpected Call Failures

When a mock method is called but no expectations match, a failure occurs.

- Verify your expectations cover all valid call scenarios.
- Use `.InSequence()` or `.After()` for strict ordering when necessary.

### 6.3. Mock Method Call Order

Ensure that expectations with specific argument matchers are declared *after* more generic ones to avoid them being shadowed.

### 6.4. Issues with Move-Only Arguments

If your mock method uses move-only types:

- Avoid using certain built-in actions that copy arguments.
- Use lambdas or functors to handle move-only parameters safely.

### 6.5. Destructors and Virtual Destructor Requirement

Lack of a virtual destructor in base classes leads to memory leaks or undefined behavior when mocking.

- Always declare destructors virtual if you expect to mock the interface.

## 7. Reference Links

For further details, troubleshooting, and migration help, consult:

- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md)
- [Mocking Reference](../docs/reference/mocking.md)
- [Upgrade & Migration Guide](/changelog/release-highlights/upgrade-guide)
- [Using Assertions and Matchers Effectively](/guides/core-workflows/using-assertions-and-matchers)
- [New Features & Improvements](/changelog/detailed-changelog/new-features-improvements)
- [Troubleshooting Common Setup Issues](/getting-started/troubleshooting-faq-support/common-setup-errors)

---

## Summary

This document equips you to identify deprecated features, anticipate breaking changes, and smoothly migrate your GoogleTest and GoogleMock test suites to newer versions. By adhering to the updated syntax, naming conventions, and modern best practices, you will maintain test reliability and take advantage of improved capabilities.

<Tip>
Always read the official [Upgrade & Migration Guide](../changelog/release-highlights/upgrade-guide) before upgrading your versions to avoid surprises.
</Tip>

<Tip>
Use `NiceMock` or explicit `EXPECT_CALL(...).Times(AnyNumber())` to handle uninteresting call warnings without affecting test failures.
</Tip>

<Tip>
Avoid underscores in test suite and test names to comply with GoogleTest's naming requirements and prevent internal errors.
</Tip>

---