---
title: "New Features & Improvements"
description: "Documents all significant enhancements in each release: new matchers, expanded assertion support, portability improvements, and advanced configuration options. Enables users to discover and adopt new capabilities as they become available."
---

# New Features & Improvements

This document highlights the significant new capabilities, enhancements, and refinements introduced in recent releases of GoogleMock. It empowers users to discover new matchers, expanded assertions, portability improvements, and advanced configuration options, enabling smoother adoption and leveraging of GoogleMock's evolving power in their testing workflows.

---

## 1. Enhancements in Mock Class Definitions and Usage

### Improved Mock Class Flexibility
- Support for mocking normal classes, class templates, and even non-virtual methods, streamlining mock creation across diverse codebases.
- Expanded support for mocking methods with custom calling conventions, especially important on Windows platforms using `Calltype()` qualifiers.
- Ability to mock overloaded functions and use `using` declarations to disambiguate overloads, helping in cleaner mock interfaces.

### Convenience in Mock Object Behavior Modifiers
- Introduction of `NiceMock`, `NaggyMock`, and `StrictMock` wrappers that control how uninteresting (unexpected without expectation) calls are handled:
  - **NiceMock**: Suppresses warnings on such calls, reducing noise in test outputs.
  - **NaggyMock**: Generates warnings (default mock behavior), helpful during debug.
  - **StrictMock**: Treats uninteresting calls as test failures, enforcing strict testing.

### Advanced Construction Patterns
- These wrappers inherit constructors from the base mock classes, allowing seamless creation with various constructor arguments.
- Support for move-only types in mock methods (e.g., methods taking or returning `std::unique_ptr`), enabling modern C++ test scenarios.

<Tip>
Use `NiceMock` when you want cleaner test output without the clutter of warnings for uninteresting calls, but want to maintain test correctness checks. Reserve `StrictMock` for tests requiring maximal strictness on mock usage.
</Tip>

---

## 2. Extended and Expanded Expectation & Behavior Controls

### Expectation and Default Behavior Separation
- Clear distinction between `EXPECT_CALL` and `ON_CALL`:
  - `EXPECT_CALL` sets expectations and behaviors.
  - `ON_CALL` sets default behaviors without expectations.
- This separation encourages writing more resilient and maintainable tests, only constraining what is necessary.

### Rich Modifiers for Expectation Configuration
- Chainable clauses like `.Times()`, `.WillOnce()`, `.WillRepeatedly()`, `.InSequence()`, `.After()`, and `.RetiresOnSaturation()` offer fine-grained control.
- `.With()` clause enables matching complex conditions on all arguments together.
- Chronicled match precedence rule: newer expectations override older ones, supporting customization workflows.

### Flexible Matching and Argument Handling
- Extensive built-in matchers, the `_` wildcard matcher, and facilities for composite and custom matchers help specify intent concisely.
- Support for matching multiple arguments collectively, including tuple-based match conditions.
- Utility functions like `SafeMatcherCast` and tools for handling overloaded methods.

<Tip>
Omit `.Times()` and rely on gMockâ€™s inference rules when appropriate to keep tests concise, but specify it explicitly for clarity or complex cardinalities.
</Tip>

---

## 3. Enhanced Actions Framework

### Diverse Built-in Actions
- Ability to specify the behavior of mock methods using `WillOnce()`, `WillRepeatedly()`, or `WillByDefault()` with actions like `Return`, `ReturnRef`, `Invoke`, `DoAll`, `SetArgPointee`, and more.

### Custom Actions Made Simple
- Support for lambdas, function pointers, functors, or the legacy `ACTION` macros for quick custom behavior definition.
- Polymorphic actions can be created via `MakePolymorphicAction`, extending action reusability across functions with different signatures.

### Delegation Patterns
- Delegating calls to real objects, fakes, or parent classes empowers integration testing scenarios where partial mocking is desired.

### Support for Complex Interactions
- Facilities to invoke mock function arguments as callbacks.
- Adaptors like `WithArgs`, `WithoutArgs`, and `InvokeWithoutArgs` afford flexible action argument handling.

<Tip>
Combine `DoAll()` action sequences when multiple steps are needed on a mock call, placing the return action last.
</Tip>

---

## 4. Improved Portability & Configuration

### Flags for Run-Time Control
- `--gmock_verbose` controls the verbosity of output messages:
  - `info` provides detailed traces.
  - `warning` suppresses stack traces in warnings.
  - `error` shows only error-level messages.
- `--gmock_catch_leaked_mocks` enables detection of leaked mock objects to prevent silent test issues.

<Tip>
Adjust `--gmock_verbose` judiciously based on your current need: use `info` for debugging, `warning` for normal test runs.
</Tip>

---

## 5. Significant API Additions and Patterns

### MockFunction<T>
- Enables mocking `std::function` objects, allowing easier mocking of callbacks and other function-like entities.

### Cardinality Customization
- Users can define their own call count cardinalities by implementing the specified interface.

### Matcher and Action Composition
- Facilities and examples for writing parameterized and polymorphic matchers and actions provide extensibility to cover complex test needs.

### Testing Asynchronous Behavior
- Action-based synchronization examples demonstrate approaches for testing asynchronous calls deterministically, avoiding flaky tests.

---

## 6. Troubleshooting and Best Practices

### Common Pitfalls Explained
- Explanation of uninteresting vs unexpected calls helps users understand warnings and failures.
- Guidance on expectation ordering and stickiness clarifies real test intentions and behaviors.
- Advice on avoiding common issues like mocking non-virtual destructors or non-virtual methods.

### Best Practices
- Prefer coding to interfaces over mocking concrete classes directly.
- Use delegation to fakes or real objects for realistic test scenarios.
- Use `RetiresOnSaturation()` and sequences for controlling complex call orders and partial ordering.

### Diagnostics
- Using `--gmock_verbose=info` to gain detailed insight into mock calls and expectation matching.
- Encouragement to set expectations before exercising mocks to prevent undefined behavior.

---

## 7. Practical Examples and Recipes

Throughout the documentation, numerous clear examples illustrate:
- Defining mock classes with `MOCK_METHOD`, including const and override qualifiers.
- Writing expectations with matchers for argument-specific verification.
- Combining multiple expectations and handling overloads.
- Specifying sequences and strict orders.
- Writing simple custom matchers and actions.
- Using wrappers like `NiceMock` for cleaner tests.
- Delegating to real or fake objects.

Use cases cover real scenarios like mocking a Turtle graphics API, illustrating user-centric workflows for mocking, expectation setting, and test execution to validate interactive behaviors.

---

## 8. Additional Resources

For in-depth information and extended learning, refer to these related GoogleMock and GoogleTest documents:

- **Mocking Reference:** Detailed API reference for mock methods, expectations, and modifiers.
- **gMock for Dummies:** Beginner-friendly tutorial for understanding mocking concepts.
- **gMock Cookbook:** Recipes and practical usage patterns.
- **Matchers Reference:** Comprehensive guide to writing and using matchers.
- **Actions Reference:** Detailed descriptions of actions and how to create custom ones.
- **Nice, Naggy, and Strict Mocks:** Guidance on controlling mock strictness and test noise.
- **Upgrade & Migration Guide:** For transitioning across breaking releases.

Consult the [Navigation Map](https://google.github.io/googletest/changelog/detailed-changelog/new-features-improvements) for more context on where this document fits in the documentation hierarchy.

---

## 9. Summary
GoogleMock continues to evolve by enhancing usability, expanding mock capabilities, and improving test reliability. This document gathers all significant new features, empowering users to write expressive, maintainable, and correct tests more effectively.

<Tip>
Keep this document handy when upgrading GoogleMock or implementing new mocking patterns, to take full advantage of recent improvements.
</Tip>

---

## 10. Usage Overview Example

```cpp
#include <gmock/gmock.h>

using ::testing::NiceMock;
using ::testing::Return;
using ::testing::_;

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(int type) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
};

// Usage in test:
void TestFoo() {
  NiceMock<MockFoo> mock_foo;

  ON_CALL(mock_foo, GetSize()).WillByDefault(Return(42));
  EXPECT_CALL(mock_foo, Describe(5)).Times(3)
      .WillRepeatedly(Return("Category 5"));

  // Exercise code that uses mock_foo...
}
```

This example illustrates key aspects of new features: use of `NiceMock` for clean tests, setting default behavior with `ON_CALL`, and specifying expectations with `EXPECT_CALL`.

---

## 11. Troubleshooting Section Highlights

<AccordionGroup title="Common Issues & Troubleshooting">
<Accordion title="Uninteresting vs Unexpected Calls">
GoogleMock treats calls to mock methods without expectations as uninteresting, which by default triggers warnings but not errors. Unexpected calls occur when arguments do not match any expectation and are always errors.
</Accordion>
<Accordion title="Handling Overloaded Methods">
Specify argument types or use `Const()` to resolve overload ambiguities in expectations.
</Accordion>
<Accordion title="Mocking Destructors">
Mocking destructors directly is impossible; instead, mock a `Die()` method and call it from the destructor.
</Accordion>
<Accordion title="Default Actions and Side Effects">
Providing default actions via `ON_CALL` ensures unexpected calls have behaviors, reducing test failures.
</Accordion>
</AccordionGroup>

---

## 12. Practical Tips and Best Practices

- Use `EXPECT_CALL` only when you want to assert that a call must happen, and use `ON_CALL` for default behavior.
- Set expectations before exercising mocks to avoid undefined behavior.
- Use sequences and `.RetiresOnSaturation()` for ordered or phased expectations.
- Control verbosity during development and debugging with `--gmock_verbose`.
- Delegate to real or fake implementations to ease complex behaviors.
- Use `NiceMock` to reduce test noise, but be cautious as it suppresses warnings.

---