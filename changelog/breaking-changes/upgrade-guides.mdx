---
title: "Upgrade Guides"
description: "Provides step-by-step upgrade instructions focusing on the most impactful changes, migration best practices, and troubleshooting common upgrade issues."
---

# Upgrade Guides

This guide provides you with clear, step-by-step instructions to upgrade GoogleMock and GoogleTest components safely and efficiently. It focuses on the most impactful breaking changes and new best practices, offers migration advice, and addresses common upgrade challenges so you can maintain test reliability and harness new features effectively.

---

## 1. Introduction to Upgrading

Upgrading GoogleMock, as part of the GoogleTest framework, requires careful attention to changes in mock method declarations, expectation behaviors, and mock lifecycle management. This guide helps you navigate these with concrete workflows, minimizing disruptions during your transition.

**Why upgrade?**
- Gain improved type safety and mocking capabilities.
- Benefit from enhanced strictness modes for mocks.
- Access new matcher and action features.
- Resolve bugs and platform compatibility issues.

**When to upgrade?**
- When adopting new GoogleTest versions with breaking changes.
- When your tests need support for move-only types or enhanced features.
- When following best practices in mocking and test organization.

---

## 2. Key Breaking Changes and Migration Best Practices

### 2.1 Mock Method Declaration Updates

The transition from old `MOCK_METHODn` macros to the new unified `MOCK_METHOD` macro is a central upgrade step.

**Current recommended usage:**
```cpp
class MyMock {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
};
```

- Replace all legacy `MOCK_CONST_METHODn`, `MOCK_METHODn`, and `MOCK_METHODn_WITH_CALLTYPE` macros with the new `MOCK_METHOD`.
- Handle commas in template types by wrapping the entire return type or argument type list in parentheses or using type aliases.

**Example migration:**
```cpp
// Old style
MOCK_CONST_METHOD1(foo, bool(int));

// New style
MOCK_METHOD(bool, foo, (int), (const));
```

### 2.2 Controlling Mock Strictness

GoogleMock now supports three main strictness modes which affect warnings about uninteresting calls:

- `NiceMock<T>`: Suppresses warnings for uninteresting calls.
- `NaggyMock<T>`: (Default) Prints warnings on uninteresting calls.
- `StrictMock<T>`: Treats uninteresting calls as test failures.

**Migration tip:**
- Use `NiceMock` for legacy tests that may have many uninteresting calls.
- Use `StrictMock` to enforce call expectations precisely.
- Wrap your mock objects accordingly to suppress or enforce warnings:

```cpp
NiceMock<MockClass> mock;  // Ignores uninteresting call warnings
StrictMock<MockClass> mock;  // Converts them into failures
```

### 2.3 Expectations and Default Behaviors

- Use `ON_CALL()` for setting default behavior without placing expectations.
- Use `EXPECT_CALL()` to set expectations and optionally define expectations count and order.
- Avoid over-using `EXPECT_CALL()` for uninteresting calls to reduce fragility.

**Best Practice:**
- Define common mock behaviors in `ON_CALL()` statements.
- Use `EXPECT_CALL()` for the key interactions your tests verify.

### 2.4 Handling Move-only Types in Mocks

GoogleMock now fully supports mocking methods with move-only types (like `std::unique_ptr<T>`):

- Define mocks using `MOCK_METHOD` as usual.
- Use lambdas or callable objects to return or accept move-only types safely.

**Example:**
```cpp
MOCK_METHOD(std::unique_ptr<Foo>, MakeFoo, (Args...), (override));

EXPECT_CALL(mock, MakeFoo(_))
    .WillRepeatedly([](Args...) {
      return std::make_unique<Foo>();
    });
```

If legacy code uses workarounds (e.g., delegating to non-move mock methods), consider refactoring to the new style.

### 2.5 Migrating Overloads and Access Levels

- Mock all overloaded methods explicitly to avoid warnings about hidden base class methods.
- Use `using BaseClass::MethodName;` inside mock classes to bring in base overloads.
- Declare mock methods `public` even if the base method is protected or private to enable `EXPECT_CALL` and `ON_CALL`.

---

## 3. Step-by-Step Upgrade Workflow

### Step 1: Audit Your Mock Classes

- Identify all mock classes using deprecated macros.
- List overloaded methods that may require explicit mocking or scope `using` directives.

### Step 2: Replace Deprecated `MOCK_METHODn` Macros

- Rewrite all `MOCK_METHODn` and related macros into the new `MOCK_METHOD(ReturnType, Name, (Args...), (Specifiers))` format.
- Wrap complex types with commas inside parentheses or use type aliases for clarity.

### Step 3: Review Mock Strictness Usage

- Audit existing tests for uninteresting call warnings.
- Decide between `NiceMock`, `NaggyMock` (default), or `StrictMock` based on your test's strictness needs.
- Update mock object instantiations accordingly.

### Step 4: Leverage `ON_CALL` for Default Behavior

- Move common default behaviors to `ON_CALL` to avoid brittle `EXPECT_CALL` counts.
- Minimize redundant explicit expectations.

### Step 5: Handle Move-only Types

- Refactor mocks that accept or return `std::unique_ptr` and similar move-only types.
- Replace legacy delegation if present.
- Use lambda expressions for repeated actions returning move-only objects.

### Step 6: Validate and Refine

- Build and run tests.
- Enable verbose logging for mock calls with `--gmock_verbose=info` if issues arise.
- Adjust expectations or mocks until tests pass reliably.

---

## 4. Troubleshooting Common Upgrade Issues

### Problem: Compilation Errors on `MOCK_METHOD`

- Check for unprotected commas in argument or return types.
- Use parentheses around types with commas or define type aliases.
- Verify that all required qualifiers are specified (e.g., `const`, `override`).

### Problem: Unexpected Uninteresting Call Warnings

- Wrap mocks with `NiceMock` if warnings are intentional.
- Add catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());` when needed.
- Suppress warnings mindfully — avoid overusing expectations for ignoring calls.

### Problem: Tests Fail Due to Strict Mock Behavior

- Check if some calls have no corresponding `EXPECT_CALL`.
- Amend test to use `StrictMock` only when strict verification is needed.
- Use `NaggyMock` for debugging if needed.

### Problem: Issues With Move-only Types in Mock Methods

- Confirm mock method signatures use the new `MOCK_METHOD` syntax.
- Use lambdas for `WillOnce` or `WillRepeatedly` to properly produce move-only returns.

### Using Verbose Logging for Diagnostics

Run tests with increased verbosity:

```
--gmock_verbose=info
```

This shows which expectations match calls, argument values, and the internal matching logic, helping debug mismatches and failures.

---

## 5. Additional Recommendations

### Migration Tools and References

- Review [Breaking Changes Summary](https://github.com/google/googletest/blob/main/docs/changelog/breaking-changes/breaking-changes-list.md) for detailed insights.
- Consult [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes and best practices.

### Testing Practices

- Use `ON_CALL` chiefly to set default mock behaviors.
- Use `EXPECT_CALL` sparingly to verify key behaviors.
- Use `InSequence` and `After` clauses for call ordering requirements.

### Compilation Performance

- Move mock class constructors and destructors implementations to `.cc` files to speed up build times.

### Community and Support

- Engage with the GoogleTest GitHub community for help and updates.
- File issues at [GoogleTest GitHub](https://github.com/google/googletest/issues) if you encounter blockers.

---

## 6. References and Further Reading

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — for deep dive recipes.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — complete API guide.
- [Breaking Changes Summary](https://google.github.io/googletest/changelog/breaking-changes-list.html) — detailed change log.
- [Controlling Mock Strictness](https://google.github.io/googletest/gmock_for_dummies.html#mock-strictness) — learn about NiceMock, NaggyMock, and StrictMock.
- [Getting Started with GoogleTest](https://google.github.io/googletest/getting-started.html) — foundational concepts and setup.

---

Maintain your tests’ robustness and clarity by following these upgrade patterns, leveraging new GoogleMock features, and adhering to best practices outlined here. Your journey to a modern and maintainable C++ test suite starts with precise upgrades and thoughtful test evolution.
