---
title: "Feature Improvements"
description: "Showcases enhancements to assertions, parameterized test support, matcher updates, or new interfaces that increase the power or usability of GoogleTest/GoogleMock."
---

# Feature Improvements

This page highlights key enhancements to GoogleTest and GoogleMock that empower you to write more expressive, robust, and maintainable tests. These improvements span assertion macros, parameterized test constructs, matcher capabilities, and mock interfaces, all designed to enrich your testing experience and reduce friction.

---

## Enhanced Mocking Interfaces

### Modern `MOCK_METHOD` Macro

The transition to the versatile `MOCK_METHOD` macro has streamlined mock method declarations. It supports:

- Simplified syntax mirroring natural method declarations with separate return type, method name, and argument list.
- Qualifier support such as `const`, `override`, `noexcept`, calling conventions via `Calltype()`, and reference qualifiers via `ref()`.
- Robust handling of complex signatures including types with commas (e.g., `std::pair`, `std::map`) when wrapped with parentheses or using type aliases.
- Native support for mocking non-virtual methods (useful for compile-time polymorphism) without requiring inheritance.
- Legacy backward compatibility with old-style `MOCK_METHODn` macros, with a recommendation to migrate to the newer form for consistency and maintainability.

<Info>
To avoid parsing errors with types containing commas, wrap the return or argument types in parentheses or define type aliases.
</Info>

Example:

```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, (), (override));
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool), (override));
};
```

### Strictness Control on Mocks

GoogleMock provides three levels of strictness to regulate uninteresting calls:

- `NiceMock<T>` suppresses warnings for uninteresting calls, reducing noise.
- `NaggyMock<T>` (default) warns on uninteresting calls.
- `StrictMock<T>` treats uninteresting calls as errors, improving catch of unexpected behaviors.

These allow you to tailor mock behavior according to your test maintenance and debugging needs.

---

## Improved Matchers

### Compositional and Polymorphic Matchers

Matchers can be composed using logical combinators like `AllOf()`, `AnyOf()`, and `Not()`, enabling precise argument validation.

Polymorphic matchers adapt to argument types at compile-time, allowing seamless usage across various data types.

### Custom Matcher Creation

The introduction of the `MATCHER` family of macros and manual matcher classes empowers you to define custom matching logic with:

- Human-readable failure descriptions.
- Ability to stream detailed explanations for failed matches.
- Support for parameterized matchers using `MATCHER_P` and variants.

Example:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "") {
  return (arg % divisor) == 0;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy(7)));
```

### Advanced Containers and Pointer Matchers

Built-in support for matching STL containers such as vectors, maps, and pointers using matchers like `ElementsAre()`, `UnorderedElementsAre()`, `Pointee()`, and `Field()` provides granular control over data passed to mocks.

---

## Refined Expectations and Actions

### Smart Use of `EXPECT_CALL` and `ON_CALL`

- `EXPECT_CALL` sets up both behavior and explicit expectations on calls.
- `ON_CALL` configures default behavior without imposing call count expectations.
- Use of `EXPECT_CALL` sparingly avoids brittle tests. Prefer `ON_CALL` for common behaviors and constrain only what matters.

### Flexible Behavior Specification

- Actions like `Return()`, `ReturnRef()`, and `ReturnPointee()` enable mocking return values precisely.
- Compound actions via `DoAll()` allow multiple side effects, including setting output arguments and returning values.
- Custom actions can be lambdas, functors, or traditional ACTION macros, allowing you to elegantly express complex mocking behaviors.

### Managing Call Order

The framework offers mechanisms to:

- Enforce strict call order using `InSequence`.
- Specify partial orders via sequences and `.After()` clauses.
- Retire expectations automatically using `.RetiresOnSaturation()` to prevent over-saturation errors and keep tests maintainable.

---

## Handling Complex Scenarios

### Mocking Overloads, Templates, and Move-Only Types

GoogleMock now robustly supports mocking:

- Overloaded virtual and const/non-const methods with appropriate `MOCK_METHOD` declarations.
- Template class methods without special boilerplate.
- Methods accepting or returning move-only types (e.g., `std::unique_ptr`), making it compatible with modern C++ features.

### Delegation Patterns

- Delegate mock method behavior to real or fake implementations to leverage existing code while retaining verification ability.
- Techniques for delegating to base class implementations or alternative mock interfaces allow flexible test design.

---

## Performance and Maintenance Enhancements

### Compile-Time Optimizations

- Moving mock class constructor and destructor definitions into source files reduces compilation time significantly.

### Verification Control

- Automatic verification upon destruction.
- Programmatic early verification using `Mock::VerifyAndClearExpectations()`.
- `Mock::AllowLeak()` can suppress leaks warning for intentionally retained mocks.

---

## Using gMock Verbose and Diagnostics

- `--gmock_verbose=info|warning|error` controls granularity of mock call logs, aiding debugging.
- Allows tracing of matching expectations, actual arguments, return values, and stack traces.

---

## Practical Guidance and Best Practices

- Prefer NiceMock for general tests; StrictMock for tests where unwanted calls must fail immediately.
- Use `ON_CALL` for setting up default behavior; reserve `EXPECT_CALL` for verifying important interactions.
- Avoid over-specifying expectations to prevent brittle tests.
- Use sequences and `.After` to express ordering constraints meaningfully.

---

For detailed examples and usage scenarios, consult the related guides below.

---

# References and Further Reading

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mock Object Definition API](../api-reference/gmock-mocking-apis/mock-object-definition.md)
- [Matchers Reference](../api-reference/gmock-mocking-apis/matchers.md)
- [Actions Reference](../api-reference/gmock-mocking-apis/actions.md)
- [Expectation and Verification](../api-reference/gmock-mocking-apis/expectations-specification.md)
- [Strictness Policies](../api-reference/gmock-mocking-apis/strictness-policies.md)

---

Return to the [Changelog Improvements, Bug Fixes, and Deprecations](../changelog/improvements-fixes-deprecations/feature-improvements.md) index.

---