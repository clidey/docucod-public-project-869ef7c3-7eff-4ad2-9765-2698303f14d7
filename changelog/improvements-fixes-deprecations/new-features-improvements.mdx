---
title: "New Features & Improvements"
description: "Highlights of newly added capabilities, optimizations, and changes that enhance performance, usability, or compatibility. Aimed at users seeking to leverage recent advancements in their workflows."
---

# New Features & Improvements

This page highlights the latest capabilities, optimizations, and usability enhancements in GoogleTest and GoogleMock. It is intended to help users quickly adopt new functionality and improve their testing workflows, focusing on the value these updates deliver.

---

## 1. Enhanced Mocking Macros

- **Unified `MOCK_METHOD` Syntax**
  - Simplified macro for defining mocked methods in mock classes.
  - Supports overriding `const`, `noexcept`, call types, reference qualifiers, etc., through optional qualifiers.
  - Example:

  ```cpp
  class MyMock {
   public:
    MOCK_METHOD(int, Foo, (int x, double y), (const, override));
  };
  ```

- **Better Handling of Complex Types with Commas**
  - Wrap return types or argument lists containing commas with parentheses.
  - Alternatively, define type aliases to avoid parsing issues.

- **Public Access for Private/Protected Methods**
  - `MOCK_METHOD` must always be declared in the `public:` section to allow external setting of expectations.


## 2. Expressive Expectation API (`EXPECT_CALL`)

- **Comprehensive Modifiers and Clauses**
  - `.With()` restricts matcher to the full argument tuple for complex conditions.
  - `.Times()` defines exact or fuzzy call cardinalities (e.g., `AtLeast()`, `Exactly()`).
  - `.InSequence()` enforces call order within one or multiple sequences.
  - `.After()` specifies prerequisites that must be called before the expectation.
  - `.WillOnce()` defines a precise one-time action; multiple allowed.
  - `.WillRepeatedly()` sets the action for subsequent calls after `WillOnce` actions.
  - `.RetiresOnSaturation()` allows an expectation to become inactive once its call limit is reached.

- **Flexible Invocation Matching**
  - Supports matching arguments individually or through tuple matchers.
  - Allows overlapping and layered expectations evaluated in reverse declaration order to enable specificity overriding.

- **Example:**

  ```cpp
  EXPECT_CALL(mock_obj, DoTask(_, _))
      .With(AllOf(Args<0,1>(Gt()), Args<1>(Lt(100))))
      .Times(3)
      .WillOnce(Return(true))
      .WillRepeatedly(Return(false));
  ```


## 3. Sophisticated Default Behavior with `ON_CALL`

- **Separate Default Actions From Expectations**
  - Use `ON_CALL` to define mock method behavior without enforcing call expectations.

- **Supports the Same Modifiers as `EXPECT_CALL`**
  - Including `.With()` and `.WillByDefault()`.

- **Ideal for Common Behavior Setup**
  - Define common behaviors once (e.g., in mock constructor) and specialize only when needed.

- **Example:**

  ```cpp
  ON_CALL(mock_obj, GetValue(_))
      .WillByDefault(Return(42));
  ```


## 4. Improved Mock Variants

- **NiceMock**
  - Suppresses warnings on uninteresting calls.
  - Ideal for tests where warnings would be noise.

- **NaggyMock**
  - Default behavior; warns when uninteresting calls occur.
  - Useful during development to detect unintended calls.

- **StrictMock**
  - Fails tests on uninteresting calls.
  - Enforces stricter correctness and call discipline.

- **Best Practice:** Choose mock type based on required strictness of your tests to balance noise and detection.


## 5. Matchers and Actions Usability Enhancements

- **Rich built-in matchers** and ability to combine and cast matchers for complex argument validation.
- **Custom matcher creation** simplified via macros.
- **Flexible actions** including lambda, functor, and callable support for custom response handling.


## 6. Ordering and Sequencing Enhancements

- Use `InSequence` object or clause to group expectations into strict call orders.
- `After` clauses for partial ordering and prerequisite enforcement support complex interaction patterns.
- Support for DAG-like sequences allows expressing non-linear call dependencies elegantly.


## 7. Runtime and Compilation Optimizations

- Moving mock class constructors and destructors to implementation files improves build times.
- Support for move-only types in mocks, facilitating modern C++ practices.


## 8. Debugging and Verbosity Controls

- Introduced `--gmock_verbose` command-line flag with levels: `info`, `warning`, `error`.
- Enhanced logging for expected and uninteresting calls to improve troubleshooting.


## 9. Example: Setting up a Mock with Expectations

```cpp
#include <gmock/gmock.h>

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
};

using ::testing::Return;

TEST(CalculatorTest, AddReturnsSum) {
  MockCalculator mock_calc;

  ON_CALL(mock_calc, Add(_, _)).WillByDefault(Return(0));

  EXPECT_CALL(mock_calc, Add(3, 4))
      .Times(2)
      .WillOnce(Return(7))
      .WillRepeatedly(Return(10));

  EXPECT_EQ(mock_calc.Add(3, 4), 7);
  EXPECT_EQ(mock_calc.Add(3, 4), 10);
  EXPECT_EQ(mock_calc.Add(1, 1), 0);  // Uses ON_CALL default.
}
```


## 10. Practical Tips

- Wrap complex argument types in parentheses or define type aliases to avoid macro parsing issues.
- Use `RetiresOnSaturation()` on expectations that must deactivate after reaching call limits.
- Prefer `ON_CALL` for setting default behaviour, `EXPECT_CALL` only when verifying calls.
- Choose mock wrapper (`NiceMock`/`StrictMock`) appropriately to control warnings and errors.
- Use sequences and partial ordering clauses to specify interaction patterns precisely.


---

## See Also

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
- [Expectations and Call Ordering](https://google.github.io/googletest/reference/expectations.html)


---

This summary page is regularly updated with improvements from ongoing releases; users are encouraged to review the full release notes for detailed upgrade instructions and breaking changes.