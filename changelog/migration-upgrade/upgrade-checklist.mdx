---
title: "Upgrade Checklist & Best Practices"
description: "A practical checklist and comprehensive set of recommendations for teams planning to upgrade to the latest version. It includes compatibility pointers, common pitfalls, and guides for troubleshooting issues during the upgrade process."
---

# Upgrade Checklist & Best Practices

This page offers a practical checklist and thorough recommendations for teams preparing to upgrade to the latest version of GoogleTest and GoogleMock. It helps you anticipate compatibility concerns, avoid common pitfalls, and troubleshoot issues that may arise during the upgrade process.

---

## 1. Assess Compatibility and Prerequisites

Before upgrading, verify that your development environment and dependencies meet the minimum requirements:

- **C++ Standard**: The latest GoogleTest versions require at least C++17 support. Ensure your compiler and build system are configured accordingly.
- **Dependencies**: Confirm that your build tools (e.g., CMake, Bazel) and any external dependencies align with version requirements.
- **Platform Support**: Check your operating system and compiler versions against the [Supported Platforms](https://github.com/google/oss-policies-info/blob/main/foundational-cxx-support-matrix.md).

<Tip>
Running compatibility checks early prevents integration surprises later in the upgrade process.
</Tip>

## 2. Review Deprecated and Removed Features

Examine the [Deprecations and Removals](./deprecations-removals) documentation to identify any APIs, macros, or behaviors that have been deprecated or removed:

- Replace deprecated `MOCK_METHODn` macros with the newer, generic `MOCK_METHOD` macro.
- Avoid nesting mock strictness wrappers such as `NiceMock<StrictMock<...>>` as this is unsupported.
- Adjust tests and mocks to remove reliance on any removed features.

<Warning>
Failure to address deprecated APIs may cause compilation errors or unexpected runtime behavior.
</Warning>

## 3. Update Mock Classes and Methods

Follow best practices for mock class definitions:

- Use the new `MOCK_METHOD(return_type, method_name, (args...), (specifiers...))` macro format.
- Ensure mock methods are declared `public`, even if overriding `protected` or `private` methods in the base class.
- Handle move-only types natively in mocks, using lambdas or callable objects for actions when necessary.
- Validate that destructor behavior and virtual destructors conform to GoogleMock's requirements for strictness modifiers.

<Check>
Review your mock classes for correct syntax and visibility to guarantee smooth upgrade.
</Check>

## 4. Adjust Use of NiceMock, NaggyMock, and StrictMock Wrappers

- Understand that by default mocks behave like `NaggyMock` but the default will switch to `NiceMock` in future releases.
- Avoid layering strictness wrappers (e.g., `NiceMock<StrictMock<T>>`) as this is unsupported.
- Confirm all mock classes used with these wrappers have virtual destructors to avoid unexpected behavior.
- Use `StrictMock` when you want uninteresting calls to trigger test failures, `NiceMock` to suppress such warnings.

<Info>
Use the strictness mode that best aligns with your test objectives, balancing error detection with maintainability.
</Info>

## 5. Refactor Tests for Changes in Behavior

- Modify your `EXPECT_CALL` and `ON_CALL` statements to align with any new default behaviors.
- Review how uninteresting calls are handled in your tests, and add explicit expectations where needed.
- Use wildcard matching and `Times(AnyNumber())` cautiously to avoid brittle tests.
- Prefer `ON_CALL` to specify default mock method behavior, reserving `EXPECT_CALL` for calls your test explicitly verifies.

<Tip>
Aim for tests that verify behavior contracts rather than overly constraining internal call sequences.
</Tip>

## 6. Leverage New Features for Better Test Reliability

- Use `AllowLeak()` judiciously when managing lifetime of mocks that intentionally outlive the test scope.
- Employ improved support for move-only types to simplify mocks with `unique_ptr` or similar.
- Utilize `EXPECT_NONFATAL_FAILURE` macros in tests that verify failure scenarios without aborting all tests.

## 7. Verify and Run Your Tests

- Use `Mock::VerifyAndClearExpectations()` to force verification before mock destruction if needed.
- Run all tests with verbosity levels (`--gmock_verbose=info|warning|error`) adjusted to diagnose unexpected behavior or to suppress noise.
- Address warnings related to uninteresting calls by refining mock expectations or switching to `NiceMock`.

<Warning>
Ignoring warnings about uninteresting calls can hide real test issues. Prefer systematic resolution.
</Warning>

## 8. Troubleshooting Common Upgrade Issues

### Compilation Errors

- Check macro usage syntax, especially replacing old `MOCK_METHODn` macros.
- Ensure inclusion of the required headers such as `<gmock/gmock.h>`.

### Runtime Failures

- Unexpected call failures usually indicate missing or incorrect EXPECT_CALLs.
- Excessive call errors require setting appropriate `Times()` or `RetiresOnSaturation()` clauses.

### Test Fragility

- Overly strict mocks may require relaxation using `NiceMock` or adjusting call expectations to better reflect actual call patterns.

## 9. Next Steps and Additional Resources

For detailed guidance, consult the following documentation:

- [Defining and Using Mocks](../api-reference/mocking-framework/defining-and-using-mocks)
- [Strictness Modes for Mocks](../api-reference/mocking-framework/mock-strictness-modes)
- [Common Testing Workflows](../../guides/common-workflows/test-fixtures)
- [Migration and Upgrade Guidance](./breaking-changes-summary)

<Tip>
Regularly reviewing the Release Notes and Changelog Overview helps keep your tests robust across versions.
</Tip>

---

## Example: Updating Mock Method from Old to New Macro

```cpp
// Old way (deprecated):
MOCK_METHOD1(Foo, bool(int));

// New recommended way:
MOCK_METHOD(bool, Foo, (int));
```

## Example: Using NiceMock to Silence Uninteresting Call Warnings

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoThis());
// Calls to other mock methods won't produce warnings.
```

## Troubleshooting Example: Unexpected Call

If you see an error like:

```
Uninteresting mock function call
``` 

Consider:

- Adding an `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());` to allow the call.
- Switching mock to `NiceMock` to suppress warnings if the call is truly unimportant.

---

This checklist is designed to lead you step-by-step through a seamless transition to the latest GoogleTest and GoogleMock versionsâ€”empowering you to maintain effective, clear, and resilient test suites.


<AccordionGroup title="Detailed Troubleshooting and Tips">
<Accordion title="Resolving Compilation Errors">
- Verify all mock macros use the latest `MOCK_METHOD` syntax.
- Include `<gmock/gmock.h>` in test source files.
- Check for accidental nesting of strictness wrappers.
</Accordion>
<Accordion title="Controlling Mock Strictness">
- Use `NiceMock<T>` to suppress warnings about uninteresting calls.
- Use `NaggyMock<T>` to get warnings (default behavior).
- Use `StrictMock<T>` to fail tests on unexpected calls.
- Always ensure that destructors are virtual in mock classes.
</Accordion>
<Accordion title="Adjusting Expectations for Changed Behaviors">
- Avoid over-specifying expectations; use wildcards and `Times(AnyNumber())` when appropriate.
- Prefer `ON_CALL` for stubbing default behavior.
- Use `.RetiresOnSaturation()` to retire saturated expectations.
</Accordion>
<Accordion title="Common Pitfalls to Avoid">
- Do not apply multiple strictness modifiers simultaneously.
- Avoid mocking non-virtual methods unless following advanced patterns.
- Do not ignore warnings about uninteresting function calls.
</Accordion>
</AccordionGroup>


---

For advanced migration and detailed usage patterns, consider revisiting the following guides:

- [Getting Started Setup & Installation](../../getting-started/setup-prerequisites-installation/prerequisites-system-requirements)
- [Mocking Reference](../../docs/reference/mocking.md)
- [gMock Cookbook](../../docs/gmock_cook_book.md)
- [Breaking Changes & Migration Paths](./breaking-changes-summary)


<Note>
Regular consultation of the Upgrade Checklist alongside your CI runs will help catch failures early and reduce weathering time.
</Note>


---

_Last updated: June 2024_