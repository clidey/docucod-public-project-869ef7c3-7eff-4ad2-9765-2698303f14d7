---
title: "Upgrade Instructions & Best Practices"
description: "Step-by-step guidance on how to safely move from older versions to the latest release, with advice on testing, validation, and common pitfalls. Especially useful for teams maintaining large or legacy test suites."
---

# Upgrade Instructions & Best Practices

GoogleTest evolves to introduce valuable improvements, deprecations, and occasionally breaking changes to help maintain relevance, performance, and reliability. This guide offers a comprehensive, step-by-step approach for users to safely upgrade from older GoogleTest versions to the latest release, emphasizing best practices to protect large or legacy test suites.

---

## 1. Preparation for Upgrade

### 1.1 Review Release Notes
Before upgrading, thoroughly review the release notes and changelogs corresponding to versions between your current GoogleTest version and the target version. This will alert you to new features, behavioral changes, removal of deprecated elements, or compatibility adjustments that might affect your tests.

### 1.2 Understand Breaking Changes
Familiarize yourself with breaking changes documented in the [Breaking Changes & Deprecations](./breaking-changes) documentation. Pay attention to:
- **Minimum C++ Standard Requirement**: Starting from version 1.17.x, C++17 is mandatory.
- **Assertion Usage Restrictions**: Changes affecting allowed assertion contexts.
- **Naming Conventions**: Rules affecting test and suite names (e.g., prohibiting underscores in certain positions).
- **Fixture Consistency Requirements**: Ensuring all tests in a suite use the same fixture.
- **Death Test Handling**: Updates to death tests execution and naming expectations.

### 1.3 Take Inventory of Your Test Suite
Identify test cases that use deprecated or removed features. Locate any test suites mixing fixture types or those not adhering to naming conventions. Also, pinpoint death tests and their organization to aid smooth migration.

### 1.4 Backup and Branch
Maintain a safe backup and upgrade in a dedicated branch or environment separate from your production integration. This helps isolate changes and verifies stability before full adoption.

---

## 2. Upgrade Process

### 2.1 Upgrade Build Environment
- **Ensure C++17 Compliance**: Update your compiler and build system to support C++17. This is non-negotiable for recent GoogleTest versions.
- **Verify Compiler Compatibility**: Confirm support for features and flags required by GoogleTest, as per the [System Requirements](../getting-started/prerequisites-installation/system-requirements).

### 2.2 Build and Link GoogleTest
Use supported build methods:
- **CMake-Based Builds**: Adapt your CMake scripts to the updated GoogleTest source tree as outlined in the [Integration with Build Systems](../overview/use-cases-integration/integration-with-build-systems) guide.
- **Shared Library Considerations**: Update your flags if using GoogleTest builds as shared libraries, following macro requirements (`GTEST_LINKED_AS_SHARED_LIBRARY`, `GTEST_CREATE_SHARED_LIBRARY`).

### 2.3 Test Your Setup
Verify GoogleTest installation by building and running a simple test binary. Use the [Quick Validation Checklist](../getting-started/first-test-run/validate-install) to confirm a proper environment.

### 2.4 Update Test Naming and Fixture Usage
- Rename test suites containing death tests to end with `DeathTest` as recommended.
- Avoid underscores at the beginning or end of test suite and test names to prevent naming conflicts.
- Ensure each test suite uses a single fixture class; avoid mixing fixtures within the same test suite.

### 2.5 Review Death Tests
For death tests (`EXPECT_DEATH`, `ASSERT_DEATH`):
- Ensure they are isolated in suites named according to convention.
- Check for proper configuration of the death test style flag (`--gtest_death_test_style`), now defaulting to "fast" but recommending "threadsafe" for multi-threaded code.

### 2.6 Test Migration
- Run your entire test suite with the updated GoogleTest and carefully evaluate failures.
- Address any assertion or macro deprecations.
- If you encounter failures due to assertion placement (like fatal assertions in non-void functions), refactor those tests.
- Utilize `SCOPED_TRACE` to improve diagnostics when migrating complex tests.

---

## 3. Best Practices

### 3.1 Follow Semantic Test and Suite Naming
Avoid starting or ending test and suite names with underscores. Maintain uniqueness and clarity to avoid name collisions. The [FAQ on Naming](../docs/faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore) offers detailed rationale and guidelines.

### 3.2 Prefer Test Fixtures Over Global Variables
Organize reusable state and setup via test fixtures rather than globals for better isolation, reusability, and maintainability.

### 3.3 Use `SetUp()`/`TearDown()` Over Constructors/Destructors
Fatal assertions are disallowed in constructors and destructors. Use `SetUp()` and `TearDown()` for safe initialization and cleanup where assertions are necessary.

### 3.4 Embrace Parameterized and Typed Tests
To reduce code duplication and increase coverage, switch legacy tests that vary only by input data or type to use parameterized or typed tests as described in the [Parameterized and Typed Tests](../api-reference/core-testing-api/parameterized-and-typed-tests) and [Guides](../guides/core-workflows/parameterized-testing).

### 3.5 Use Matchers and Predicate Assertions
Improve expressiveness and error diagnostics by leveraging GoogleMock matchers and specialized assertions (`EXPECT_THAT`, `EXPECT_PRED_*`), which offer clearer failure messages and composability.

### 3.6 Leverage Global Environment SetUp and TearDown
For expensive shared resources, define global test environments to efficiently allocate and release them, as explained in the test environment section.

### 3.7 Avoid Reliance on Internal or Private APIs
Maintain a black-box testing approach where possible to minimize breakage during upgrades.

---

## 4. Troubleshooting

### 4.1 Common Issues After Upgrade
- **Test Not Discovering or Running**: Verify naming conventions, ensure fixtures are consistent within suites, and confirm registration of tests.
- **Build Failures**: Check for C++17 support, correct linking against GoogleTest libraries, and flag definitions.
- **Test Failures Due to Assertion Restrictions**: Avoid `ASSERT_*` macros in non-void functions or constructors.
- **Death Test Failures or Hangs**: Confirm death test suite naming, thread count, and death test style flag. Consider switching to "threadsafe" death tests for multi-threaded environments.

### 4.2 Use Diagnostic Aids
- Use `SCOPED_TRACE` to add trace messages for failing assertions.
- Generate XML or JSON output reports using `--gtest_output` flags to aid in automated test failure analysis.
- Check environment variables and command-line flags impacting GoogleTest behavior.

---

## 5. Additional Resources

- [Breaking Changes & Deprecations](./breaking-changes) — detailed list of incompatible changes
- [Parameterizing Tests](../guides/core-workflows/parameterized-testing) — guide to modernize test structures
- [Assertions Reference](../api-reference/core-testing-api/assertions) — comprehensive assertion types and usage
- [Mocking Best Practices](../guides/core-workflows/mocking-best-practices) — for integrating mocks safely post-upgrade
- [Integration with Build Systems](../overview/use-cases-integration/integration-with-build-systems) — handling build and linking changes
- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting/common-setup-issues) — practical tips and fixes

---

## 6. Summary Checklist

- [ ] Confirm your development environment supports C++17.
- [ ] Review breaking changes between your current and target versions.
- [ ] Rename test suites containing death tests with `DeathTest` suffix.
- [ ] Ensure test and suite names avoid leading/trailing underscores.
- [ ] Verify test fixtures are consistently used within suites.
- [ ] Upgrade build scripts for GoogleTest source and linkage.
- [ ] Validate your tests build and run successfully.
- [ ] Adopt new best practices to improve future maintainability.


<Tip>
Upgrading GoogleTest requires careful attention to test suite naming, fixture consistency, and environment setup. Follow this guide closely to ensure a smooth transition, avoiding common pitfalls that lead to build or runtime issues.
</Tip>

<Note>
Remember that test failures after upgrade often stem not from regressions in your code but from stricter test naming, fixture, or assertion usage rules. Review failing tests with the new guidelines in mind.
</Note>

<Warning>
Attempting to upgrade without verifying C++17 compliance or ignoring breaking changes will lead to compilation errors or undefined behavior.
</Warning>

---

For detailed migration help, consult the [Breaking Changes & Deprecations](./breaking-changes) page and the official [GoogleTest User's Guide](https://google.github.io/googletest/).

---

### Source
<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "googletest/include/gtest/internal/gtest-port.h", "range": "1-661"}]} />

---