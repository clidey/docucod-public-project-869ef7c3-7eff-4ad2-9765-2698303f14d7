---
title: "Feature Highlights"
description: "Summarizes the most significant new features introduced in recent versions, with clear explanations and usage links where relevant. Allows users to leverage powerful new functionality quickly."
---

# Feature Highlights

Welcome to the Feature Highlights page for GoogleTest. This resource is designed to swiftly bring you up to speed with the most significant and recent additions to GoogleTest and GoogleMock, enabling you to leverage the framework’s powerful new capabilities in your C++ testing workflows.

---

## 1. Defining Mock Classes with `MOCK_METHOD`

GoogleMock introduces a unified and flexible macro, `MOCK_METHOD`, that simplifies defining mock methods in your mock classes.

- **Syntax:**
  ```cpp
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
  ```
- **Qualifiers:** Include `const`, `override`, `noexcept`, and calling conventions such as `Calltype(STDMETHODCALLTYPE)`.
- **Use cases:** Mock virtual, const, noexcept, overloaded methods, and methods in class templates with ease.
- **Handling complex types:** Use parentheses or type aliases to wrap return or argument types containing commas to prevent parsing issues.

**Example:**
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

This promotes precise and maintainable mock class definitions, encouraging best practices with virtual destructors and overriding.

## 2. Controlling Mock Behavior and Expectations

GoogleMock’s declarative syntax lets you specify exactly how your mocks behave and verify interaction effortlessly.

### Setting Default Actions

- Use `ON_CALL` to define default behaviors without mandating method calls.
- Example:
  ```cpp
  ON_CALL(mock, GetSize()).WillByDefault(Return(1));
  ```
- This keeps tests robust by only requiring verification where it matters.

### Setting Expectations

- Use `EXPECT_CALL` to expect method invocations, optionally constrained by argument matchers and call cardinalities.
- Chainable modifiers include `.Times()`, `.WillOnce()`, `.WillRepeatedly()`, `.InSequence()`, `.After()`, and `.RetiresOnSaturation()`.
  ```cpp
  EXPECT_CALL(mock, Describe(5))
      .Times(3)
      .WillRepeatedly(Return("Category 5"));
  ```
- Supports ordered, partially ordered, and unordered expectations with explicit sequences.

### Uninteresting vs Unexpected Calls

- Uninteresting calls: methods without expectations are allowed and invoke default actions, possibly generating warnings.
- Unexpected calls: calls that don't match any expectations cause test failures, ensuring strict verification.

**Best Practice:** Use `NiceMock` to suppress warnings on uninteresting calls, and `StrictMock` to treat them as errors.

## 3. Rich Matcher and Action Support

GoogleMock features a comprehensive suite of argument matchers and actions to validate and control mock method calls precisely.

### Matchers

- Built-in matchers support equality, inequality, relational operations, container contents, pointers, properties, and composite conditions.
- Custom matchers can be defined easily with `MATCHER` and `MATCHER_P` macros for reuse.
- Matchers support disambiguating overloaded methods, matching pointer values, and validating fields or properties of argument objects.

### Actions

- Built-in actions cover returning values, setting output arguments (`SetArgPointee`), invoking callbacks (`Invoke`, `InvokeWithoutArgs`), combining actions (`DoAll`), and ignoring return values (`IgnoreResult`).
- Custom actions can be implemented using functors, lambdas, or macros (`ACTION` family) providing extensive flexibility.

**Example:**
```cpp
EXPECT_CALL(mock, Mutate(true, _))
    .WillOnce(DoAll(SetArgPointee<1>(5), Return(true)));
```

## 4. Managing Call Ordering and Cardinalities

GoogleMock allows complex specification and control of call order and frequency:

- Use `InSequence` or explicit `Sequence` objects to enforce ordered expectations.
- Use `After` and multiple sequences for partial ordering in DAG form.
- Cardinalities such as `Times(n)`, `AtLeast(n)`, `AtMost(n)`, and `AnyNumber()` precisely describe expected call counts.
- Use `.RetiresOnSaturation()` to mark expectations as inactive after reaching their call count.

These tools help create brittle-resistant yet precise tests that clearly express interaction protocols.

## 5. Controlling Mock Strictness

Decide how to handle uninteresting calls on a per-mock-object basis:

- **NiceMock**: Suppresses warnings on uninteresting calls. Use to keep test logs clean.
- **NaggyMock**: Default behavior. Warns on uninteresting calls but allows them.
- **StrictMock**: Treats uninteresting calls as test failures. Useful when strict adherence to expectations is necessary.

Choose the strictness level appropriate for your test's robustness and verbosity needs.

## 6. Advanced Mocking Capabilities

### Delegating Calls

- Delegate mock method behavior to a fake or real object inside your mock class via `ON_CALL` with lambdas.
- Delegate calls to a base class implementation to reuse logic where appropriate.

### Mocking Move-Only and Non-Virtual Methods

- Supports mocking methods with move-only types such as `std::unique_ptr` using normal `MOCK_METHOD` macros.
- Can mock non-virtual methods by defining unrelated mock classes with matching method signatures and using template-based dependency injection.

### Mocking Destructors

- Instead of mocking destructors directly, add a mock method (e.g., `Die()`), call it in the destructor, and verify the call order.

## 7. Performance and Usability Tips

- To speed up compilation, define mock class constructors/destructors out-of-line in source files.
- Combine `WillOnce` and `WillRepeatedly` properly to control return values and behaviors over multiple calls.
- Use verbose logging levels (`--gmock_verbose=info, warning, error`) to gain deeper insight into mock call matches and failures.
- Run tests interactively in IDEs such as Emacs with integrated error navigation.

## 8. Getting Help and Extending gMock

- Leverage the extensive official documentation, including the [gMock Cookbook](gmock_cook_book.md), [Matchers Reference](reference/matchers.md), and [Actions Reference](reference/actions.md).
- Contribute or file issues through the GitHub repository.

---

## Example Complete Mock Setup

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};

TEST(FooTest, Example) {
  MockFoo mock_foo;

  ON_CALL(mock_foo, GetSize()).WillByDefault(::testing::Return(10));
  EXPECT_CALL(mock_foo, Describe(::testing::StrEq("test")))
      .Times(1)
      .WillOnce(::testing::Return("mocked description"));

  EXPECT_EQ(mock_foo.GetSize(), 10);
  EXPECT_EQ(mock_foo.Describe("test"), "mocked description");
}
```

This example shows how to define mocks, default behavior, expectations, and validation in a concise, readable manner.

---

## Useful Links

- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) – Quick reference for mocking syntax and features.
- [Mocking Cookbook](../docs/gmock_cook_book.md) – Practical recipes and best practices for using mocking features effectively.
- [Matchers Reference](../api-reference/matchers-actions/matchers-reference.md) – For a detailed list of available matchers.
- [Actions Reference](../api-reference/matchers-actions/actions-reference.md) – For advanced customization of mock method actions.
- [Breaking Changes and Migration](../changelog/breaking-changes-and-migration/breaking-changes.md) – Guidance on changes affecting mocks across GoogleTest versions.

Refer to the adjacent Getting Started guides and tutorials to deepen your understanding and workflow mastery:
- [Mocking Basics](../guides/core-workflows/mocking-basics.md)
- [Setting Expectations & Cardinalities](../api-reference/mocking/expectations.md)
- [Controlling Mock Strictness](../api-reference/mocking/nice-strict-mocks.md)

By mastering these feature highlights, you unlock the full power of GoogleTest and GoogleMock to write robust, maintainable, and expressive C++ tests.

---

_Source code and further details available on the [GoogleTest GitHub repository](https://github.com/google/googletest)._

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_cheat_sheet.md", "range": "0-335"},{"path": "docs/gmock_cook_book.md", "range": "0-1300"},{"path": "docs/reference/mocking.md", "range": "0-360"}]} />
