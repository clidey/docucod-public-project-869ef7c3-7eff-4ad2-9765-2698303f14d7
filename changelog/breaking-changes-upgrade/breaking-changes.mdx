---
title: "Breaking Changes & Deprecations"
description: "Explicitly lists all major breaking changes, deprecated APIs, and removed features per release. Explains the impact of each change and how it may affect existing tests and build systems."
---

# Breaking Changes & Deprecations

This page provides a comprehensive record of major breaking changes, API deprecations, and removed features in GoogleMock across different releases. Each change is explicitly listed with practical explanations that clarify the impact on existing tests and build systems, enabling developers to identify necessary adjustments during upgrades.

---

## Understanding Breaking Changes

GoogleMock evolves continuously to improve usability, correctness, safety, and maintainability. Sometimes these improvements enforce stricter rules or alter behavior in ways that can invalidate existing tests or code depending on previous behavior. Breaking changes are changes that may require:

- Modifying your mock class definitions
- Updating `EXPECT_CALL` or `ON_CALL` usages
- Adjusting build configurations or compiler flags
- Revising usage patterns to comply with new restrictions

This document aims to help users recognize these changes, understand what they mean from a user perspective, and take appropriate action.

## Notable Breaking Changes by Release

### MOCK_METHOD Macro Enforcement

Since the introduction of the unified `MOCK_METHOD` macro (replacing old `MOCK_METHODn` variants), GoogleMock enforces:

- **Argument list parenthesization**: Return and argument types containing commas (e.g., templates) must be enclosed in parentheses to parse correctly.
- **Valid method signature checking**: The macro now asserts at compile-time that method signatures are correct function types.
- **Specifiers support**: New method qualifiers like `const`, `override`, `noexcept`, `Calltype(...)`, and reference qualifiers (`ref(&)`, `ref(&&)`) must be properly declared within the macro's fourth argument.

**Impact:** Improper macro usages that compiled previously will now cause compilation errors requiring code changes.

### Strict Syntax Enforcement on EXPECT_CALL / ON_CALL

The chaining clauses for `EXPECT_CALL` and `ON_CALL` have strict requirements for usage order and multiplicity:

- `.With()` clause:
  - Optional.
  - Must appear at most once.
  - Must be the **first** chaining clause after `EXPECT_CALL` or `ON_CALL`.

- `.Times()` clause:
  - Optional.
  - Must appear at most once.
  - Must precede `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`.

- `.InSequence()`:
  - Optional.
  - Can appear multiple times before `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`.

- `.After()`:
  - Optional.
  - Can appear multiple times, must appear before `.WillOnce()`, `.WillRepeatedly()`, `.RetiresOnSaturation()`.

- `.WillOnce()`:
  - Optional.
  - Can appear multiple times.
  - Must appear before `.WillRepeatedly()`.

- `.WillRepeatedly()`:
  - Optional.
  - Can appear at most once.
  - Must appear after all `.WillOnce()` calls and must precede `.RetiresOnSaturation()`.

- `.RetiresOnSaturation()`:
  - Optional.
  - Can appear at most once.
  - Must be the **last** chaining clause.

> **Example of invalid chaining now failing:**
>
> ```cpp
> EXPECT_CALL(mock, Foo(5))
>     .Times(1)
>     .Times(2);  // Double Times call triggers compile-time error now
> ```

### Default Cardinality Changes

When you write an `EXPECT_CALL` without an explicit `.Times()` or `.WillRepeatedly()`, GoogleMock infers the cardinality from the presence of `WillOnce()` and `WillRepeatedly()` clauses like this:

- No `WillOnce()` or `WillRepeatedly()` → cardinality = `Times(1)`
- `n` `WillOnce()` clauses, no `WillRepeatedly()` → cardinality = `Times(n)`
- `n` `WillOnce()` clauses and one `WillRepeatedly()` → cardinality = `Times(AtLeast(n))`

This inference is now strictly enforced. Violations or omissions that relied on older more lenient behavior may now result in verification failures.

### Strict Matching of Expectations

GoogleMock now strictly enforces that:

- **The last matching `EXPECT_CALL` overrides earlier ones**, preventing ambiguity.
- If a call matches more than one expectation, the most recently declared matching expectation is selected.
- Calls exceeding expected cardinalities produce immediate errors.

> **Tip:** To allow multiple calls with different argument specializations, add a general catch-all expectation using `_` and `Times(AnyNumber())` **after** the more specific expectations.

### Support for Move-Only Types

Newer releases of GoogleMock fully support mocking methods with move-only return types and parameters (e.g., `std::unique_ptr<T>`).

Legacy workarounds (delegating method calls to alternate mock methods without move-only parameters) are now optional and not required if using recent GoogleMock versions.

### Updated Warning and Verbosity Flags

The behavior and output of warnings on uninteresting calls can be controlled with the `--gmock_verbose` flag:

- `info` - Log expected and unexpected calls with stack traces.
- `warning` (default) - Log uninteresting calls without stack traces.
- `error` - Suppress all warnings except for actual errors.

Users can set this flag inside tests via `GMOCK_FLAG_SET(verbose, ...)`.

### Deprecated APIs and Removed Features

The following older APIs or macros have been deprecated or removed:

- The old `MOCK_METHODn`, `MOCK_CONST_METHODn`, and their templated variants
  - Users must migrate code to the generic `MOCK_METHOD` macro with new syntax.
- Legacy `ACTION` macros without explicit type specification may show increased errors; use templated or lambda-based actions.

---

## Migration Guidance

### Transitioning to `MOCK_METHOD`

Replace old-style mock method macros like this:

```cpp
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD2_T(Bar, int(int, double));
```

With:

```cpp
MOCK_METHOD(bool, Foo, (int), (override));
MOCK_METHOD(int, Bar, (int, double), (const, override));
```

Remember:

- Enclose argument lists and return types with commas inside parentheses if they use commas themselves.
- Add qualifiers (const, override, noexcept) as needed in the fourth argument.

### Updating Expectations and Call Syntax

Ensure method chaining clauses on `EXPECT_CALL` and `ON_CALL` respect the required order and multiplicity. For instance:

- Use `.With()` only once and first if used.
- Don't duplicate `.Times()`, `.WillRepeatedly()`, or `.RetiresOnSaturation()`.

### Controlling Verbosity of Mock Messages

Consider setting the verbosity level appropriate to your development phase:

```cpp
GMOCK_FLAG_SET(verbose, testing::internal::kWarningVerbosity);  // default
GMOCK_FLAG_SET(verbose, testing::internal::kInfoVerbosity);     // verbose for debug
GMOCK_FLAG_SET(verbose, testing::internal::kErrorVerbosity);    // quiet for CI
```

### Addressing Compilation Errors

- Check that all `MOCK_METHOD` usage obeys the new syntax.
- Wrap types containing commas with parentheses or use typedefs.
- Confirm that chained clauses on expectations follow the enforced order.
- Review test output and logs carefully in verbose mode for clues.

### Verifying and Clearing Mock Expectations

Use `Mock::VerifyAndClearExpectations(mock_ptr)` and `Mock::VerifyAndClear(mock_ptr)` when you want to:

- Verify all expectations explicitly before mock destruction.
- Clear expectations and default actions to avoid cross-test dependencies.

---

## Best Practices and Tips

- Set expectations clearly and as loosely as your test logic permits.
- Use catch-all expectations with `_` and `Times(AnyNumber())` to avoid spurious failures.
- Use sequences and `.After()` to specify call order precisely.
- Prefer lambdas or polymorphic actions over legacy `ACTION` macros.
- Use the `NiceMock` wrapper to suppress warnings on uninteresting calls when appropriate.

---

## Related Documentation

- [Mock Methods & Classes](../api-reference/gmock-mocking-framework/mock-methods-and-classes.md) — Detailed syntax and examples for `MOCK_METHOD`.
- [Expectations, Actions & Sequences](../api-reference/gmock-mocking-framework/expectations-actions-and-sequences.md) — Deep dive into `EXPECT_CALL` chaining and behavioral modeling.
- [Strictness Modes & Behaviors](../api-reference/gmock-mocking-framework/strictness-modes-and-behaviors.md) — Fine-grained control over warnings and failures.
- [gMock Cookbook](../guides/core-workflows/mocking-patterns.md) — Recipes outlining mocking patterns including upgrade advice.
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) — Quick reference to macros and common idioms.

---

For more information on upgrading between versions, please refer to the [Full Version History](../changelog/release-history/full-version-history.md) and the [Latest Release Notes](../changelog/release-history/latest-release-notes.md) pages.

If you encounter issues with the breaking changes, consult the [Common Installation Issues](../getting_started/troubleshooting/common_install_issues.md) and [Compilation & Runtime Errors FAQ](../faq/troubleshooting-optimization/compilation-runtime-errors.md).

---

**Remember:** This page focuses only on changes that affect the GoogleMock API and user-facing behavior. For a broader understanding of the changes in the entire GoogleTest product, see the general release notes and upgrade guides.

---

_Last Updated: main branch_

