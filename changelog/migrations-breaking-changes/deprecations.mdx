---
title: "Deprecations and Removals"
description: "A focused list of features or APIs that are deprecated or scheduled for removal. Provides alternatives, context behind removals, and recommendations to future-proof your test code. Links to updated usage where possible."
---

# Deprecations and Removals

This page presents a focused list of features or APIs within GoogleTest and GoogleMock that are deprecated or scheduled for removal. It provides clear alternatives, context behind these changes, and recommendations to future-proof your test code. By understanding these deprecations, you can maintain compatibility with upcoming versions and leverage improved or more robust APIs.

---

## Overview of Deprecations

GoogleTest and GoogleMock strive to maintain backward compatibility; however, some features are deprecated to promote better practices, improve usability, and keep pace with modern C++ standards (minimum C++17).

Key reasons for deprecation include:

- Modernizing mocking macros (transition from legacy `MOCK_METHODn` macros to generic `MOCK_METHOD`)
- Enforcing stricter ordering in expectation clauses for clarity and reliability
- Phasing out support for older language standards (pre-C++17)
- Improving test code maintainability and avoiding brittle tests

Deprecated features should be replaced as soon as practical to avoid migration headaches.


## Deprecated Mocking Macros

The older family of mocking macros (`MOCK_METHODn`, `MOCK_CONST_METHODn`, and their variants) are deprecated in favor of the modern, unified `MOCK_METHOD` macro. The new macro offers:

- More consistent syntax aligned with standard C++ method declarations
- Support for method qualifiers such as `const`, `noexcept`, and reference qualifiers via the optional fourth parameter
- Improved handling of complex method signatures, including templates and overloaded methods

### Recommended Migration

Replace instances like:

```cpp
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD1(Bar, void(const std::string&));
```

with:

```cpp
MOCK_METHOD(bool, Foo, (int));
MOCK_METHOD(void, Bar, (const std::string&), (const));
```

**Note:** Parenthesize argument or return types containing commas to avoid parsing errors. For example:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

Refer to the [Mocking API reference](../api-reference/gmock-apis/mocking-api) for detailed syntax and examples.


## Strict Clause Ordering in `EXPECT_CALL`

Previously, GoogleMock allowed flexible ordering of modifier clauses in `EXPECT_CALL` expressions. To improve readability and prevent subtle issues, strict ordering of clauses is enforced.

The required order is:

```cpp
EXPECT_CALL(mock, Method(matchers...))
  .With(...)       // optional, must be first if present
  .Times(...)      // optional, can appear only once
  .InSequence(...) // optional, can appear multiple times
  .After(...)      // optional, can appear multiple times
  .WillOnce(...)   // optional, can appear multiple times
  .WillRepeatedly(...) // optional, can appear only once
  .RetiresOnSaturation(); // optional, must be last
```

Attempting to use clauses out of order will produce compilation warnings or errors.

### Migration Tip

Review all `EXPECT_CALL` statements and rearrange clauses accordingly. For example:

```cpp
// Old (incorrect order)
EXPECT_CALL(mock, Foo())
  .WillRepeatedly(Return(true))
  .Times(AnyNumber());

// New (correct order)
EXPECT_CALL(mock, Foo())
  .Times(AnyNumber())
  .WillRepeatedly(Return(true));
```

Refer to the [Mock Expectations](../concepts/mocking-concepts/mock-methods-expectations) and [Mocking API](../api-reference/gmock-apis/mocking-api) pages for more on expectation modifiers.


## Minimum C++ Standard: C++17 Enforcement

GoogleTest and GoogleMock no longer support building with C++ standards earlier than C++17. This is to take advantage of modern language features that simplify interfaces and improve performance.

### Action Items

- Ensure your build system compiles tests using at least `-std=c++17` or equivalent.
- Consult the [System Requirements](../getting-started/prerequisites-installation/system-requirements) and [Integration Build Systems](../concepts/integration-advanced/integration-build-systems) pages for configuration guidance.


## Deprecated Behavior for Nice, Naggy, and Strict Mocks

The default mock behavior is NaggyMock, which emits warnings on uninteresting calls (calls to mock methods with no explicit `EXPECT_CALL`).

Changes and deprecations include:

- Encouragement to explicitly choose between `NiceMock`, `NaggyMock`, and `StrictMock` to control mock call reporting.
- Discouragement of using NaggyMock implicitly due to brittle tests caused by unchecked unexpected calls.

### Recommendations

- Use `NiceMock` to suppress warnings for uninteresting calls when such calls are expected and acceptable.
- Use `StrictMock` to treat uninteresting calls as errors, improving test rigor.
- Avoid nesting modifiers like `NiceMock<StrictMock<YourMock>>`, which is unsupported.


## Removal of Deprecated Matchers and API Elements

Older or less commonly used matchers, actions, or API features may be marked for removal, especially if there are better alternatives or modern replacements.

Before migrating, verify:

- Replace deprecated macros with their modern counterparts.
- Use new matcher idioms (`EXPECT_THAT` with expressive matchers) instead of older assert-style macros.
- Migrate from custom `MOCK_METHODn` macros to `MOCK_METHOD`.


## Common Migration Pitfalls and Solutions

### Commas in Type Arguments in `MOCK_METHOD`

If your method signature contains commas (e.g., templated types), wrap the type in parentheses:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```

### Overloaded Methods

When mocking methods that are overloaded, provide explicit `MOCK_METHOD` declarations for each variant and consider using `using` to bring in base class overloads to avoid hiding.

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;
  MOCK_METHOD(int, Add, (int), (override));
  MOCK_METHOD(int, Add, (int, int), (override));
};
```

### Virtual Destructor Requirement

Mocks must have classes with virtual destructors to avoid heap corruption and leaks. If your base class lacks a virtual destructor, add one before mocking.

### Refined Expectation Definitions

Use `ON_CALL` to set default mock behaviors without imposing call count constraints. Use `EXPECT_CALL` to express expectations and verify interactions explicitly.

Avoid mixing `EXPECT_CALL` for suppressing uninteresting call warnings; instead, use `NiceMock` where appropriate.


## Resources and References

- [Mocking API](../api-reference/gmock-apis/mocking-api): Modern best practices for mock method declarations and expectations.
- [Matchers Reference](../api-reference/gmock-apis/matchers-reference): Guidance on argument matching.
- [gMock Cookbook](../docs/gmock_cook_book.md): Practical recipes and examples.
- [Breaking Changes & Migration Notes](../changelog/migrations-breaking-changes/breaking-changes-and-migrations): Detailed information on all breaking changes.
- [System Requirements](../getting-started/prerequisites-installation/system-requirements): Compiler and platform requirements to support C++17.


<Tip>
Always consult the **Breaking Changes & Migration Notes** to understand deprecated features and detailed migration steps. Migrating early ensures smoother upgrades and better test reliability.
</Tip>

<Warning>
Do not continue using deprecated macros or APIs in new code. Deprecated features may be removed in forthcoming releases.
</Warning>

---

## Troubleshooting Deprecation-Related Issues

<AccordionGroup title="Common Deprecation Troubleshooting">
<Accordion title="Compiler Errors on Mock Method Macros">
If you encounter errors related to `MOCK_METHODn` macros, switch to the modern `MOCK_METHOD` macro and ensure correct parenthesization of argument types containing commas.

Example of a failing macro due to unprotected commas:

```cpp
MOCK_METHOD(std::pair<int, int>, GetPair, ());  // Error
```

Corrected:

```cpp
MOCK_METHOD((std::pair<int, int>), GetPair, ());
```
</Accordion>
<Accordion title="Ordering Errors in EXPECT_CALL">
Rearrange chained clauses in `EXPECT_CALL` to comply with the enforced order, placing `.With()` first (if used) and `.RetiresOnSaturation()` last.

Incorrect:

```cpp
EXPECT_CALL(mock, Func()).WillRepeatedly(Return(true)).Times(AnyNumber());
```

Correct:

```cpp
EXPECT_CALL(mock, Func()).Times(AnyNumber()).WillRepeatedly(Return(true));
```
</Accordion>
<Accordion title="Build Fails Due to C++17 Requirements">
Ensure your compilation commands and build tools are updated to use C++17 or higher. Refer to platform-specific compiler flags and build files.
</Accordion>
</AccordionGroup>

---

## Summary

This page highlights deprecated features and scheduled removals related to GoogleTest and GoogleMock. By transitioning to the modern `MOCK_METHOD` macro, adopting strict clause ordering, and complying with minimum C++17 standards, users improve test reliability and future compatibility.

---

## Example Migration Scenario

Suppose your existing mock class uses old macros:

```cpp
class OldMock {
 public:
  MOCK_METHOD1(Foo, bool(int));
};
```

You should update to:

```cpp
class NewMock {
 public:
  MOCK_METHOD(bool, Foo, (int));
};
```

And whenever using `EXPECT_CALL`, ensure correct ordering:

```cpp
EXPECT_CALL(mock, Foo(_))
    .Times(AnyNumber())
    .WillRepeatedly(Return(true));
```

If you encounter warnings about uninteresting calls, wrap your mock in `NiceMock`:

```cpp
NiceMock<NewMock> mock;
```

---

## Additional Tips

- Regularly review your mocks and update deprecated constructs.
- Use `ON_CALL` for default behavior to avoid overly strict tests.
- When mocking overloaded methods or templated types, use explicit type aliases and method qualifiers.
- Report any issues encountered during migration to the GoogleTest issue tracker for assistance.

<Tip>
Keeping your test suite up to date with the latest GoogleTest features enables more robust, expressive, and maintainable tests.
</Tip>

<Note>
For comprehensive migration and upgrade instructions, please refer to the Breaking Changes & Migration Notes document available in the Changelog section.
</Note>
