---
title: "Migration and Upgrade Guides"
description: "Step-by-step instructions and recommendations for upgrading between major versions and resolving breaking changes. Includes code migration tips, deprecation workarounds, and best practices for adopting new features."
---

# Migration and Upgrade Guides

This guide provides step-by-step instructions and actionable recommendations to help users upgrade between major versions of GoogleTest smoothly. It covers resolving breaking changes, adapting code to new interfaces, and best practices that minimize disruption during migration.

---

## 1. Understanding Breaking Changes

Upgrading to a new major version often comes with breaking changes that require modifications in your codebase or test suite. These changes can include:

- Removal or renaming of APIs
- Changes in behavior or semantics of existing APIs
- New minimum compiler or language standard requirements
- Dependency updates

> **Tip:** Always review the release notes and migration guides specific to your target version to identify breaking changes upfront.

## 2. Preparing for Upgrade

### Assess Compatibility

- Verify your compiler supports the minimum C++ standard required by the new major version (for example, C++17 or later). See the [Supported Platforms](https://github.com/google/googletest/blob/main/README.md#supported-platforms) documentation.

- Audit your test code for deprecated API usage.

- Back up your current testing environment and code before beginning upgrade.

### Update Build Settings

- Adjust your build system to use the required language standard.

- Ensure all dependencies are updated as indicated by the release you plan to upgrade to.

## 3. Step-by-Step Migration Workflow

### Step 1: Review Release Notes

- Examine the specific release notes for the target version at the official [GoogleTest Releases Page](https://github.com/google/googletest/releases).

- Identify any changes labeled as breaking.

### Step 2: Update Mock Definitions

- If you use GoogleMock, pay particular attention to changes in the mocking macros such as `MOCK_METHOD` syntax.

- Wrap complex return or argument types with parentheses as necessary to avoid macro parsing errors, for example:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
```

- For const, noexcept, or call-type qualifiers, ensure the mock methods use the correct fourth parameter specifiers, e.g.: 

```cpp
MOCK_METHOD(bool, Foo, (int n), (const, noexcept, override));
```

### Step 3: Adjust Test Expectations and Actions

- Verify expectations with `EXPECT_CALL` and default behaviors with `ON_CALL` adhere to the updated APIs.

- Use `NiceMock`, `NaggyMock`, or `StrictMock` wrappers appropriately to manage uninteresting call warnings according to your test policy.

- Make use of `.RetiresOnSaturation()` where needed to avoid unexpected cumulative call count errors.

### Step 4: Validate Matcher and Action Usage

- Revisit all custom matchers and actions to comply with new matcher interfaces.

- Prefer polymorphic matchers and avoid using raw pointer comparisons unless necessary.

### Step 5: Rebuild and Run Tests

- Clean your build directory to remove stale artifacts.

- Compile your tests with updated compiler settings.

- Run your full test suite and observe failures or warnings.

- Use the `--gmock_verbose=info` flag to get detailed mock method call traces, which assists in troubleshooting expectation mismatches.

### Step 6: Troubleshoot and Apply Workarounds

- Refer to the [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) for common issues and their resolutions.

- Check for mismatches caused by changed method signatures or unexpected calls.

- If default actions are missing for a mock method, define them with `ON_CALL(...).WillByDefault(...)`.

- For moved or removed features, apply replacement APIs as documented.

## 4. Best Practices for Upgrading

- **Incremental Upgrade:** Migrate one version step at a time if possible, to isolate the impact of changes.

- **Use Sequences Explicitly:** When call order matters, use `InSequence` to specify call order clearly.

- **Retire Expectations:** To prevent “sticky” expectations causing issues, use `.RetiresOnSaturation()` judiciously.

- **Leverage Default Values:** Employ `::testing::DefaultValue<T>::Set()` to define default return values that align with your tests.

- **Test in Isolation:** Ideally separate tests significantly affected by changes to allow easier debugging.

- **Employ Verbose Mock Output:** During troubleshooting, run tests with increased verbosity (`--gmock_verbose=info`) to get detailed diagnostic output.

## 5. Migration Tips for Common Breaking Changes

### Comma Issues in MOCK_METHOD

If you encounter compilation errors from commas inside argument types, wrap those types in an extra pair of parentheses or define an alias:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### Const, noexcept, and Ref Qualifiers

Match exactly the base class method qualifiers in your mock methods using the fourth parameter of `MOCK_METHOD`, e.g.: 

```cpp
MOCK_METHOD(bool, Foo, (int n), (const, override));
```

### Managing Strictness and Uninteresting Calls

Switching between `NiceMock`, `NaggyMock`, and `StrictMock` can help control warnings and failures from uninteresting calls. Use `NiceMock` to suppress warnings where behavior isn't critical.

### Migrating from Old-Style MOCK_METHODn Macros

The older `MOCK_METHODn` macros are deprecated but still supported. Transition to the modern `MOCK_METHOD` macro for better consistency and features.

### Mocking Move-Only Types

If you use move-only types like `std::unique_ptr`, mock methods should be declared normally. Set default actions or specify lambdas in `WillOnce` / `WillRepeatedly` to manage objects ownership during tests.

### Delegating to Fakes or Real Objects

For complex mocks, consider delegating default behavior to existing fakes or real objects using techniques described in the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#DelegatingToFake).

## 6. Troubleshooting

- **Uninteresting Calls Warning:** Check if you missed `EXPECT_CALL` statements or need to adjust mock strictness.

- **Linker or Compilation Errors:** Verify that you have updated all mock definitions and your compiler meets language standard requirements.

- **Mock Method Not Called Errors:** Ensure expectations are set before the code under test runs and that argument matchers align with actual calls.

- **Unexpected Behavior in Tests:** Run with `--gmock_verbose=info` to trace mock expectations and calls.

## 7. Additional Resources

- [GoogleTest Release Notes](https://github.com/google/googletest/releases)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [GoogleTest Supported Platforms](https://github.com/google/googletest/blob/main/README.md#supported-platforms)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)

---

### Summary

This documentation provides actionable guidance on migrating between major versions of GoogleTest, focusing on handling breaking changes, updating mocks, and adapting test code. Key sections include understanding breaking changes, a step-by-step migration workflow, best practices for upgrading, common issues, and detailed troubleshooting tips.

**Key Sections:**
- Understanding Breaking Changes
- Preparing for Upgrade
- Migration Workflow
- Best Practices and Tips
- Troubleshooting
- Additional Resources

**Important Links:**
- [GoogleTest Releases](https://github.com/google/googletest/releases)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)

**Next Steps:**
- Review release-specific notes before upgrading.
- Validate and update test mocks and expectations.
- Run tests with verbose output for effective debugging.
- Consult related guides on mocking and assertions for deeper mastery.
