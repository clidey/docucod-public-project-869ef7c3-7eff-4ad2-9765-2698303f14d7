---
title: "New Features & Enhancements"
description: "Describes fresh capabilities, improved APIs, and performance upgrades introduced in recent versions, enabling teams to maximize product value and streamline their workflows."
---

# New Features & Enhancements

GoogleMock continues to evolve, introducing new capabilities, refined APIs, and performance improvements that help you write more expressive, maintainable, and efficient mock-based tests. This page focuses on the fresh features and enhancements introduced in recent releases, enabling developers and teams to maximize the value of GoogleMock and streamline their testing workflows.

---

## 1. Enhanced Mock Method Definition

- **Simplified Mock Method Macros:** The `MOCK_METHOD` macro now supports a broader set of qualifiers including `const`, `noexcept`, `Calltype()`, and reference qualifiers, allowing precise mock overrides even in complex inheritance hierarchies and calling conventions.

- **Support for Move-Only Types:** GoogleMock fully supports mocking methods that accept or return move-only types such as `std::unique_ptr`. This unlocks modern C++ usage patterns in mocks without workarounds.

- **Overloaded Method Mocking:** Improved handling for overloaded methods with clear disambiguation techniques via helpers like `Const()` to distinguish const/non-const overloads and using `TypedEq` or `An<T>()` for argument type-specific matchers.


## 2. Flexible Expectation Specification

- **Chainable Modifiers with Precise Ordering:** Expectation clauses (`With()`, `Times()`, `InSequence()`, `After()`, `WillOnce()`, `WillRepeatedly()`, `RetiresOnSaturation()`) are strictly enforced in their ordering at compile-time and runtime, preventing ambiguous or incorrect usage.

- **Partial Ordering Support:** The addition of `After()` and `InSequence()` clauses enables detailed control over call ordering, supporting both linear sequences and DAG-based call dependencies for increased expressiveness.

- **Inference of Cardinality:** When `Times()` is omitted, GoogleMock automatically infers call cardinalities based on the presence of `WillOnce()` and `WillRepeatedly()`, reducing verbosity while keeping expectations precise.


## 3. Richer Actions API

- **Composite Actions:** New composite actions such as `DoAll()`, `IgnoreResult()`, and argument-selecting actions `WithArg<N>()`, `WithArgs<N1, ..., Nk>()`, and `WithoutArgs()` allow executing complex behavior sequences or adapting actions without verbose boilerplate.

- **Function and Lambda Integration:** Actions can now be directly backed by arbitrary callable objects, including lambdas, functors, and std::function, with full support for move-only and zero-argument callables.

- **Invoke Argument Actions:** `InvokeArgument<N>(...)` allows easy invocation of callable arguments passed in the mock method call, facilitating asynchronous or callback-based testing patterns.

- **Enhanced Default Action Control:** The `.WillByDefault()` clause grants fine-grained default action specification for mock methods outside of explicit expectations, empowering realistic and flexible default mock behavior.


## 4. Detailed Matchers Enhancements

- **Multi-Argument Matchers:** The `.With()` clause accepts tuple matchers, enabling validation of argument tuples as a whole, such as comparing pairs or triples of arguments collectively.

- **Safe and Typed Matcher Casts:** `SafeMatcherCast<T>(m)` and `MatcherCast<T>(m)` provide safe ways to cast matchers between compatible types, facilitating reuse and reducing verbose type declarations.

- **Custom Matcher Macros:** The `MATCHER`, `MATCHER_P`, and their variants make it straightforward to create informative, reusable custom matchers, complete with descriptive failure messages and support for complex parameterizations.


## 5. Mock Object Behavior Controls

- **Strictness Modes:** Introduced clean support for `NiceMock`, `NaggyMock`, and `StrictMock`, controlling warnings or errors on uninteresting calls, allowing you to tune test strictness and diagnostic verbosity at mock-object granularity.

- **Retirement of Expectations:** `RetiresOnSaturation()` allows expectations to retire automatically once their upper call limit is reached, preventing stale expectations from causing false failures.

- **Verification and Lifecycle:** Ability to verify and clear expectations dynamically with `Mock::VerifyAndClearExpectations()` and `Mock::VerifyAndClear()` give fine control over mock lifecycle and test phases.


## 6. Thread Safety and Performance

- GoogleMock maintains thread safety for mock calls and expectation verification, allowing multi-threaded tests while users exercise the testing code from a single thread within setup or teardown.

- Performance improvements in generated mocks reduce compilation overhead, and splitting mock class definitions into declarations and implementations can significantly speed up compilation of large test suites.


## 7. Diagnostic and Debugging Enhancements

- **Verbose Logging Levels:** The `--gmock_verbose` flag controls verbosity of mock call logging (`info`, `warning`, `error`), providing detailed call matching reports and stack traces during debugging.

- **Clear Failure Messages:** Messages for unmatched calls, saturated expectations, retired expectations, and unexpected argument matches have been substantially clarified and enriched with argument and call context.

- **Helpful Patterns and Recipes:** Included guidance on delegating calls to fakes, real objects, or parent classes via `ON_CALL` and lambda delegation to combine mock checking with real behavior.


---

## Practical Examples

### Defining a Mock Method with a Move-Only Return Type

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
};

EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
    .WillOnce(Return(std::make_unique<Buzz>(AccessLevel::kInternal)));

auto buzz = mock_buzzer.MakeBuzz("hello");
EXPECT_NE(nullptr, buzz);
```

### Sequenced Calls with Retiring Expectations

```cpp
using ::testing::InSequence;
using ::testing::Return;

{
  InSequence s;

  EXPECT_CALL(mock, GetValue())
      .WillOnce(Return(10))
      .RetiresOnSaturation();
  EXPECT_CALL(mock, GetValue())
      .WillOnce(Return(20))
      .RetiresOnSaturation();
  EXPECT_CALL(mock, GetValue())
      .WillRepeatedly(Return(30));
}
```

### Delegating to a Fake Implementation

```cpp
class FakeFoo : public Foo {
 public:
  char DoThis(int n) override { /* ... */ }
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(char, DoThis, (int n), (override));

  void DelegateToFake() {
    ON_CALL(*this, DoThis).WillByDefault([this](int n) {
      return fake_.DoThis(n);
    });
  }

 private:
  FakeFoo fake_;
};

MockFoo mock_foo;
mock_foo.DelegateToFake();
EXPECT_CALL(mock_foo, DoThis(5));
auto result = mock_foo.DoThis(5);  // Calls FakeFoo::DoThis
```

### Using Composite Actions

```cpp
EXPECT_CALL(mock, Process(_))
    .WillOnce(DoAll(SaveArg<0>(&saved_value), Return(true)));
```

---

## Troubleshooting Tips

- Use the `--gmock_verbose=info` flag to trace mock function calls and their matched expectations.
- Verify that all `EXPECT_CALL`s are set before exercising mock methods to avoid undefined behavior.
- Use `NiceMock` to suppress warnings on uninteresting calls in tests where those are expected.
- Always make mocked methods `virtual`; non-virtual methods cannot be mocked unless using advanced techniques.
- Ensure your mock classes have virtual destructors to avoid memory leaks or heapcheck errors.

---

For detailed recipes, best practices, and in-depth explanations of these features, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html), [Mocking Reference](https://google.github.io/googletest/reference/mocking.md), and [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html).

<Note>
This page focuses exclusively on new features and API improvements in GoogleMock. For foundational concepts, usage guides, and troubleshooting, please refer to the appropriate core workflows and reference documentation.
</Note>