---
title: "New Features & Enhancements"
description: "An overview of new assertions, test discovery options, integrations, and framework capabilities, mapped to the files where they are implemented. Ideal for users seeking to leverage the latest tools in their tests."
---

# New Features & Enhancements

Welcome to the overview of the latest additions and improvements in the GoogleMock (gMock) framework. This page guides you through new assertions, flexible test discovery and control options, enhanced integrations, and improvements to the core mocking capabilities. It serves as a practical resource for users eager to leverage the most recent tools and patterns in their testing workflows.

---

## 1. Expanded Mock Method Definitions with `MOCK_METHOD`

The `MOCK_METHOD` macro remains the cornerstone for defining mock methods in your test suites. Recent enhancements ensure it fully supports:

- **Method Qualifiers**: Including `const`, `override`, and `noexcept` to precisely match your base class interfaces.
- **Call Types**: Such as `Calltype(STDMETHODCALLTYPE)`, important for Windows interoperability.
- **Reference Qualifiers**: `ref(&)` or `ref(&&)` to mock methods with reference qualifiers.

Practical tips for usage:

```cpp
class MyMock {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());  // Wrap types with commas in parentheses
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
```

> Ensure mock methods reside in the `public:` section even if the original method is protected or private — this allows full access to mocking facilities.

---

## 2. Enhanced Expectation Specification via `EXPECT_CALL`

Setting expectations with `EXPECT_CALL` provides rich options to finely tune mock behavior.

### Key Modifiers and Their Usage

- `.With(matcher)`: Restrict the expectation to call arguments matching a tuple matcher for combined argument validation.
- `.Times(cardinality)`: Specifies how many times a call is expected, supporting `AnyNumber()`, `AtLeast(n)`, `AtMost(n)`, `Between(m,n)`, and exact (`Exactly(n)`).
- `.InSequence(sequences...)`: Enforces call ordering within one or multiple sequences for partial or total order constraints.
- `.After(expectations...)`: Express more intricate call order dependencies beyond sequences, supporting up to five prerequisite expectations or sets.
- `.WillOnce(action)`: Provide specific behaviour for each individual call.
- `.WillRepeatedly(action)`: Define fallback behavior after all `WillOnce` clauses are exhausted.
- `.RetiresOnSaturation()`: Automatically retire the expectation once it has been fulfilled, allowing others to match subsequently.

### Example: Sequenced and Partial Order Expectations

```cpp
using ::testing::Sequence;
Sequence s1, s2;
EXPECT_CALL(mock, Start())
    .InSequence(s1, s2);
EXPECT_CALL(mock, Step1())
    .InSequence(s1);
EXPECT_CALL(mock, Step2())
    .InSequence(s2);
```

Here, `Start()` must happen before both `Step1()` and `Step2()`, which can occur in any order related to each other.

---

## 3. Refined Default Behavior Settings with `ON_CALL`

`ON_CALL` allows defining mock behaviors without imposing call expectations. This encourages less brittle tests by separating behavior stubbing from verification.

```cpp
ON_CALL(mock, Compute(_))
    .WillByDefault(Return(42));
```

This behavior can be specialized with `.With(tuple_matcher)`. Note that the last matching `ON_CALL` for given arguments takes precedence, enabling flexible mock behavior layering.

For introducing new default return values for complex or non-built-in return types, `DefaultValue<T>` allows registering factories or explicit values globally:

```cpp
DefaultValue<std::unique_ptr<MyType>>::SetFactory(
    [] { return std::make_unique<MyType>(); });
```

Always `Clear()` these as needed to avoid test pollution.

---

## 4. Strictness Control: Nice, Naggy, and Strict Mocks

GoogleMock introduces convenient wrappers to control the treatment of uninteresting calls — calls to mock methods without explicit expectations.

| Wrapper                | Behavior                                                  |
|------------------------|-----------------------------------------------------------|
| `NiceMock<T>`          | Suppresses warnings for uninteresting calls.             |
| `NaggyMock<T>` (default) | Prints warnings for uninteresting calls.                    |
| `StrictMock<T>`        | Fails on any uninteresting call.                          |

Example:

```cpp
using ::testing::StrictMock;
StrictMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, ImportantMethod());
// Test fails if unexpected methods are called.
```

> Note: These wrappers only affect methods defined directly with `MOCK_METHOD` in the mock class — not inherited mock methods.

---

## 5. Supporting Move-Only Types in Mock Methods

Modern C++ encourages use of move-only types like `std::unique_ptr`. GoogleMock supports mocking methods returning or accepting move-only types:

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz, int64_t timestamp), (override));
};
```

When specifying return actions, you can use `WillOnce` with a lambda to generate new objects on each call:

```cpp
EXPECT_CALL(mock_buzzer_, MakeBuzz(_))
    .WillRepeatedly([](StringPiece) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

This ensures no runtime errors due to reusing moved-from objects.

---

## 6. Invoking Custom Actions and Lambdas

You can define mock method behaviors using any callable (functions, functors, lambdas) compatible with the mock method signature:

```cpp
EXPECT_CALL(mock, Compute(5))
    .WillOnce([](int x) { return x * 2; });
```

Advanced action adapters enable:

- Invoking only selected arguments with `WithArgs<N...>(action)`.
- Ignoring mock call arguments via `WithoutArgs(action)` or `InvokeWithoutArgs`.
- Invoking callable arguments passed into mock methods using `InvokeArgument<N>(args...)`.
- Ignoring return values with `IgnoreResult(action)` where needed.

These empower writing concise and expressive mock behaviors for complex scenarios.

---

## 7. Detailed Call Logging and Diagnostic Enhancements

The verbosity of GoogleMock's logging and diagnostic output is configurable via the `--gmock_verbose` flag.

- **info**: Logs all calls and expectations, with stack traces for uninteresting calls.
- **warning** (default): Logs warnings without stack traces.
- **error**: Outputs only errors.

This allows seamless transitions between development, debugging, and CI environments, tuning the level of feedback.

Example:

```
--gmock_verbose=info
```

will produce detailed traces showing which expectation matched each mock call, aiding rapid diagnosis of failures.

---

## 8. Managing Expectations Lifecycle

New clauses enhance the control over expectation lifecycle and call sequencing:

- `.RetiresOnSaturation()` helps deactivate expectations after they satisfy their call count limits, preventing upper-bound violations in tests with repeated calls.
- Combining `.InSequence()` and `.After()` clauses enables users to specify both total and partial ordering constraints precisely.

See the following example where a call is expected only after others have completed:

```cpp
Expectation init_x = EXPECT_CALL(mock, InitX());
Expectation init_y = EXPECT_CALL(mock, InitY());
EXPECT_CALL(mock, Describe()).After(init_x, init_y);
```

This allows fine-grained orchestration of call order in complex test scenarios.

---

## 9. Verification Utilities

GoogleMock provides functions to verify and clear expectations at any point (not only at destruction):

- `Mock::VerifyAndClearExpectations(mock_obj)`: Verifies that expectations are met and clears them.
- `Mock::VerifyAndClear(mock_obj)`: Verifies expectations and additionally clears default actions.

These functions return a boolean indicating success, allowing integration into test teardown logic.

Moreover, `Mock::AllowLeak(mock_obj)` can be called to suppress leaked mock object errors when objects are intentionally leaked.

---

## 10. Test Cases and Unit Tests Coverage

The framework's own unit tests cover:

- Syntax enforcement of `ON_CALL` and `EXPECT_CALL` modifiers.
- Warning and error output scenarios for excessive or insufficient actions.
- Handling of incomplete types and move-only types in mocks.
- Behavior of sequences, expectation lifecycles, and call order enforcement.
- Correct messaging for unexpected or uninteresting calls.

This robust test coverage ensures reliability of the framework's core features.

---

## References and Further Reading

- [Mocking Reference](reference/mocking.md) — The definitive guide on mock method macros and expectation APIs.
- [gMock for Dummies](gmock_for_dummies.md) — Beginner-friendly narrative on using GoogleMock.
- [gMock Cookbook](gmock_cook_book.md) — Recipes and techniques to master complex mocking.
- [Matchers Reference](reference/matchers.md) — Comprehensive list of argument matchers.
- [Actions Reference](reference/actions.md) — Guide to mock method actions.
- [Best Practices: Reliability & Scalability](guides/best-practices/reliability-scalability.mdx) — Advice on writing maintainable test suites.

---

This page forms a crucial part of GoogleMock's evolving documentation, designed to help you discover and adopt the latest features for robust, clear, and maintainable mock-based tests.