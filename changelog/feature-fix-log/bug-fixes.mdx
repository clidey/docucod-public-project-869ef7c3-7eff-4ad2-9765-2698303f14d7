---
title: "Bug Fixes & Patches"
description: "A transparent record of resolved defects, reliability patches, and minor corrections, helping users confirm whether known issues have been addressed in recent updates."
---

# Bug Fixes & Patches

This page serves as a comprehensive record of resolved bugs, reliability improvements, and minor corrections in GoogleTest and GoogleMock. It enables users to verify whether known issues impacting test reliability, build correctness, or mock behavior have been addressed in recent versions.

---

## Recent Fixes and Stability Improvements

### Key Resolved Defects
- **Compiler Compatibility Fixes:** Numerous patches enhance GoogleTest and GoogleMock's compatibility with various compilers such as MSVC, Clang, GCC, IntelLLVM, and others to prevent build issues. For example, fixes address incorrect default compiler flags, warning suppressions, and proper runtime library selection on Windows.

- **Threading and Concurrency Corrections:** Resolutions include improving death test stability in multithreaded scenarios, ensuring mock objects behave correctly under concurrent calls, and handling thread-local storage safely across platforms.

- **Mock Behavior and Expectation Handling:** Adjustments fix issues where expectations are not correctly matched, uninteresting calls produce misleading warnings, or mock destructors require explicit testing via `Die()` methods.

- **Build and Linking Errors:** Corrections in CMake build macros and install rules prevent linker errors related to static const members and ensure PDB files are properly named and installed for Windows.

- **Death Test Enhancements:** Improvements ensure death tests run as expected across platforms, handle subprocess side effects correctly, and better warn users about death test usage with multithreaded code.

### Minor Corrections and Tweaks
- **Option Dependency Clarifications:** The internal CMake utilities clarify order dependency on `option()` definitions to avoid side effects during multiple inclusion.

- **Default Actions in Mocks:** Refinements on default behaviors for uninteresting mock calls reduce spurious warnings and improve test resilience.

- **Regular Expression Support:** Updates handle discrepancies in regular expression support on various OS platforms to ensure death test matchers function properly.

- **Documentation and Usage Guidance:** FAQ entries and comments emphasize proper usage patterns to prevent common pitfalls in test naming, assertions, and fixture construction.

---

## Examples of Specific Fixes

### Compiler Flag Tweaks in `internal_utils.cmake`
- Overrides CMake's default `/MD` to `-MT` for MSVC and Clang when building static libraries, preventing runtime crashes caused by multiple CRT copies in different modules.
- Removes problematic flags such as `-D_DLL` erroneously added by Ninja with Clang on Windows.
- Enhances warning management by replacing `/W3` with `/W4` to catch more issues during build.
- Ensures UTF-8 source code encoding is respected for MSVC.

### Mock Method Fixes
- Allows mocking of const and non-const overloaded methods without ambiguity.
- Supports move-only types (e.g., `std::unique_ptr`) fully in mock methods.
- Resolves issues where destructors cannot be mocked directly by introducing a convention to add a mock method `Die()` called in the destructor.

### Death Test Behavior Adjustments
- Runs death tests in subprocess environments safely, warning when multi-threading conflicts occur.
- Supports the “threadsafe” style of death testing for safer but slower execution.
- Clarifies caveats around in-memory side effects being lost after death test subprocesses exit.

---

## Best Practices and Troubleshooting Notes

- **Avoid Naming Tests With Underscore Prefixes or Trailing Underscores:** To circumvent reserved C++ naming rules and prevent test name collisions.

- **Use `nullptr` Instead of `NULL` in Comparisons:** Enhances compatibility and reduces template meta-programming complexities.

- **Derive Test Fixtures Properly:** Prefer constructors for initialization, but use `SetUp()/TearDown()` for virtual dispatch or fatal assertion needs.

- **Set Proper Expectations Before Using Mock Objects:** Define `EXPECT_CALL` or `ON_CALL` expectations before passing mocks to tested code to avoid undefined behaviors.

- **Use `NiceMock` or `StrictMock` Appropriately:** Manage warnings and errors on uninteresting or unexpected mock calls, depending on your test strictness needs.

- **Wrap Complex Assertion Logic in Custom Matchers:** For more expressive tests and clearer failure reports.

- **Ensure `RUN_ALL_TESTS()` Return Value Is Used:** Prevents false positives in test results.

---

## Further Resources

For more information on the fixes and how they relate to testing workflow, refer to the following documentation:

- [GoogleTest FAQ](https://github.com/google/googletest/blob/main/docs/faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore)
- [GoogleMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Mock Classes & Methods](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-apis/mock-classes-methods.md)
- [Defining Expectations & Actions](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-apis/defining-expectations-actions.md)
- [Mock Strictness Modes](https://github.com/google/googletest/blob/main/docs/api-reference/mocking-apis/strictness-and-unexpected-calls.md)
- [GoogleTest Advanced Topics](https://github.com/google/googletest/blob/main/docs/advanced.md)
- [Integration Patterns and Build Workflows](https://github.com/google/googletest/blob/main/docs/concepts/platform-and-integration/integration-patterns.md)

---

Users encountering issues should verify their setup against prerequisites and configuration guides, check against known bugs fixed in recent versions, and consult the troubleshooting sections for comprehensive diagnostics and solutions.