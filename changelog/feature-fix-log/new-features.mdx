---
title: "New Features & Enhancements"
description: "Comprehensive listings and explanations of newly introduced features, expanded APIs, and enhancements that improve usability, performance, or flexibility in test development."
---

# New Features & Enhancements

This page provides detailed information about the new capabilities and improvements added to GoogleMock, designed to enhance usability, extend API flexibility, and boost performance efficiency during your test development process.

---

## 1. Enhanced Mock Method Declaration with `MOCK_METHOD`

- The modern `MOCK_METHOD` macro has been expanded to fully support:
  - Various method qualifiers, including `const`, `override`, and `noexcept`.
  - Windows-specific call types via `Calltype(...)`.
  - Reference qualifiers like `ref(&)` and `ref(&&)` for methods with reference qualification.

- Handling complex template or compound return or argument types with commas is improved by:
  - Wrapping types in parentheses.
  - Using type aliases to simplify declarations.

- Placement must always be in the `public:` section, regardless of original base class access modifiers, to allow mocking private/protected methods.

### Example
```cpp
class MockFoo {
 public:
  // Basic mock method for a const virtual method overridden
  MOCK_METHOD(int, GetCount, (), (const, override));

  // Mock with noexcept and ref qualifier
  MOCK_METHOD(void, Update, (int x), (noexcept, ref(&), override));

  // Handling complex return value by wrapping in parentheses
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());

  // Using type alias for complex type
  using MapType = std::map<int, std::string>;
  MOCK_METHOD(bool, CheckMap, (MapType), (override));
};
```

---

## 2. Flexible Expectation Setting via `EXPECT_CALL`

- Introducing an intuitive DSL to specify:
  - Argument matching with built-in and custom matchers.
  - Flexible call count expectations with `Times()` and related cardinalities like `AtLeast()`, `Exactly()`, `Between()`, `AnyNumber()`.
  - Call order constraints using `InSequence()` and `After()` clauses, including support for multiple sequences to express partial orderings.
  - Behavior declarations using `WillOnce()` and `WillRepeatedly()` with chaining capabilities.
  - Automatic cardinality inference based on provided actions.
  - The option to retire expectations as soon as saturated by adding `RetiresOnSaturation()`.

### Key Improvements
- Precise ordering control through sequences and multiple `ExpectationSet`s for complex DAGs.
- Cardinality inference simplifies common scenarios, reducing boilerplate.
- Clear chaining order for modifiers enforced for usability and correctness.

### Example
```cpp
using ::testing::_;  // wildcard
using ::testing::Return;
using ::testing::InSequence;
using ::testing::Exactly;

MockFoo mock;
{
  InSequence s;

  EXPECT_CALL(mock, Foo(1))
      .Times(Exactly(1))
      .WillOnce(Return(42));
  EXPECT_CALL(mock, Foo(2))
      .Times(Exactly(1))
      .WillOnce(Return(43));
}

// Calls must happen in the order of the expectations above.
```

---

## 3. Default Behavior Control Using `ON_CALL`

- Allows setting default behaviors on mock methods without imposing call expectations.
- Supports chaining `.With()` to match complex argument tuples.
- `.WillByDefault()` is mandatory to define the action for matching calls.
- Internally supports multiple layered `ON_CALL`s, with the last matching one taking precedence.

### Example
```cpp
ON_CALL(mock, Bar(_, _))
    .WillByDefault(Return(true));

ON_CALL(mock, Bar(42, _))
    .WillByDefault(Return(false));
```

- This setup means calls to `mock.Bar` will return `false` when the first argument is 42, else `true`.

---

## 4. Support for Mock Strictness Modes

- Introduced three strictness policies governing how unexpected and uninteresting calls are handled:
  - **NiceMock**: suppresses warnings on uninteresting calls.
  - **NaggyMock** (default): warns on uninteresting calls.
  - **StrictMock**: treats uninteresting calls as errors.

- These templates can wrap your mock classes to instantly adjust their behavior.

### Usage
```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;  // Suppresses noise from uninteresting calls.

using ::testing::StrictMock;
StrictMock<MockFoo> strict_mock;  // Errors on unexpected calls.
```

- Helps balance test strictness with maintainability, and avoid brittle tests.

---

## 5. Advances in Sequences and Partial Ordering

- `Sequence` and `InSequence` classes enable defining a total order or partial order over expectations.
- Multiple sequences can be associated with one expectation to express Directed Acyclic Graph (DAG) constraints.
- The `.After()` clause supports setting expectations that must occur after one or more other expectations or expectation sets.

### Example
```cpp
Sequence seq1, seq2;
EXPECT_CALL(mock, Foo(1)).InSequence(seq1, seq2);
EXPECT_CALL(mock, Bar(2)).InSequence(seq1);
EXPECT_CALL(mock, Baz(3)).InSequence(seq2);
```

- This builds a partial order where calls to `Foo(1)` must occur before `Bar(2)` and `Baz(3)`.

---

## 6. Enhanced Actions and Side Effect Support

- Built-in actions like `Return()`, `ReturnRef()`, `ReturnPointee()`, and `SetArgPointee()` allow precise control of mock method side effects.
- Actions can be chained with `DoAll()` to combine multiple effects.
- Support for using lambdas, function pointers, functors, or member function pointers as actions.
- Support for functions with no arguments through `InvokeWithoutArgs()`.
- Invocation of callable arguments using `InvokeArgument<N>(args...)` facilitates mocking asynchronous callbacks or event invocations.

### Example
```cpp
EXPECT_CALL(mock, Process(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(10), Return(true)));

EXPECT_CALL(mock, CallbackHandler(_))
    .WillOnce(InvokeArgument<0>(42));  // Calls callback argument with 42
```

---

## 7. Improved API for Inspecting and Resetting Mock Expectations

- `Mock::VerifyAndClearExpectations(mock_obj)` lets you programmatically verify that all expectations on a mock were met and clears them.
- `Mock::VerifyAndClear(mock_obj)` also clears default actions along with expectations.
- `Mock::AllowLeak(mock_obj)` lets you mark mocks that intentionally leak, suppressing warnings.

---

## 8. Better Diagnostic Messages and Verbosity Control

- Added `--gmock_verbose` flag supporting `info`, `warning` (default), and `error` levels.
- `info` level prints detailed logs including stack traces with mock calls, expectations, and argument values.
- Enhanced warning messages for uninteresting, unexpected, excessive, and unsatisfied calls with specific details to help debugging.

---

## 9. Support for Mocking Move-Only Types

- `MOCK_METHOD` and related actions now support move-only method arguments and return types (e.g., `std::unique_ptr`).
- Usage of lambdas or callables is recommended to handle move-only types effectively.

### Example
```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz, int64_t timestamp),
              (override));
};

EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
    .WillOnce([](StringPiece text) { return std::make_unique<Buzz>(); });
```

---

## 10. Expanded Support for Overloaded Methods

- Overloaded virtual methods can be mocked without ambiguity by specifying full signature in `MOCK_METHOD`.
- Disambiguation helpers like `Const()` allow setting expectations on const methods.

### Example
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetBar, (), (override));
  MOCK_METHOD(int, GetBar, (), (const, override));
};

EXPECT_CALL(mock, GetBar());        // Non-const
EXPECT_CALL(Const(mock), GetBar()); // Const
```

---

## 11. Utilities to Simplify Complex Interfaces

- Techniques to mock trimmed or reshaped interfaces by delegating complex methods to simpler mock methods.
- Allows convenient mocking of methods with lengthy argument lists or default arguments by forwarding behavior.

---

## 12. New Facilities for Writing Custom Matchers and Actions

- `MATCHER`, `MATCHER_P`, and related macros enable quick creation of expressive, parameterizable custom matchers.
- Support for polymorphic and composite custom matchers.
- Alternative to macros: defining matcher classes manually for advanced control.
- Polymorphic actions can be defined with ease using `MakePolymorphicAction`.

---

## 13. Thread Safety and Concurrency Support

- Mock expectations and calls are protected by global mutex to ensure atomicity for mock state.
- User code can safely perform mock calls from multiple threads.
- Setting expectations and mock setup should occur only in single-threaded context or with external synchronization.

---

## Additional Resources

- For practical examples and tutorials, refer to the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html).
- To understand common pitfalls and best practices, see the [Mocking Reference](../docs/reference/mocking.md) and [Legacy FAQ](https://google.github.io/googletest/gmock_faq.html).
- Explore matchers, actions, and cardinalities more deeply in their respective reference pages.

---

<Info>
This page focuses exclusively on features and enhancements of mocking capability within GoogleMock, complementing overall GoogleTest documentation. For installation, setup, and integration topics, please refer to the Getting Started and Integration documentation sections.
</Info>
