---
title: "Bug Fixes and Patches"
description: "Summarizes resolved defects and minor improvements made in each release. Ideal for users tracking stability, regressions, or fixes for specific issues that affect their workflow."
---

# Bug Fixes and Patches

GoogleMock continuously evolves to provide a stable, reliable mocking framework for C++ developers. This section summarizes key defect resolutions and minor enhancements introduced in each release, focusing on issues that impact user experience, test correctness, and build stability.

---

## Common Fixes and Improvements

### Compiler and Build Improvements

- **Reduced Memory Usage in MSVC**: Addressed excessive memory consumption issues during compilation of large mock classes, especially when using the `/clr` compiler flag. Users are advised to avoid `/clr` when compiling native mocks for improved efficiency.

- **Enhanced Compiler Warning Management**: Adjusted compiler flags and warning suppressions for MSVC, Clang, and GCC to streamline build output, reduce noise, and prevent known warning spams during mock class compilation.

- **Fixes to Mock Method Macro Parsing**: Resolved parsing issues in `MOCK_METHOD` macros, especially when argument or return types contain commas, by allowing parenthesized type parameters or recommending type aliases.

### Runtime Behavior and Expectation Verification

- **Strictness Wrappers Robustness**: Improved how `NiceMock`, `NaggyMock`, and `StrictMock` wrappers manage uninteresting calls, ensuring more accurate and consistent behavior while preventing redundant warnings or errors during test runs.

- **Expectation Ordering and Matching**: Fixed scenarios where expectations with `.After()`, `.InSequence()`, or overlapping cardinalities were incorrectly matched or verified, enhancing precise call sequence enforcement.

- **Better Diagnostics for Failing Expectations**: Enhanced failure messages for unexpected calls, unsatisfied arguments, excessive calls, and retired expectations to include argument values, caller stack traces, and clearer explanation of violations.

- **Handling of Overloaded and Const Methods**: Resolved issues related to mocking const-qualified and overloaded methods, including compiler warnings under MSVC and fixes to allow seamless specifying and verifying these expectations.

- **Support for Move-Only and Non-Copyable Types**: Improved usage guidance and implementation for mocks involving move-only return types and function arguments, reducing common pitfalls and clarifying best practices.

### Logging and Crash Recovery

- **ScopedMockLog Stability**: Fixed cases where `ScopedMockLog` produced excessive errors on test crashes or multi-threaded scenarios, and provided mechanisms to gracefully ignore or handle unexpected log outputs.

- **Verbose Mode Control Enhancements**: Improved the granularity and accuracy of `--gmock_verbose=LEVEL` output, ensuring users can control and tailor mock call trace and warning verbosity effectively.

### Edge Case and Legacy Support

- **Legacy Macro Compatibility**: Maintained backward compatibility for deprecated `MOCK_METHODn` macros with clear migration paths and guidance.

- **Handling of Variadic Functions and Static/Global Functions**: Reiterated limitations and recommended patterns to mock variadic functions or static/global functions through interface abstraction, ensuring users donâ€™t encounter unsupported behaviors.

---

## Troubleshooting Tips Associated With Fixes

- **If You Encounter Unexpected Calls**:
  - Confirm that all call expectations (`EXPECT_CALL`) are set before exercising mocks.
  - Use `--gmock_verbose=info` to visualize call matching and argument values.

- **Compilation Warnings About Const Parameters**:
  - Remove top-level `const` qualifier on parameters in mock method declarations to workaround MSVC warnings.

- **Memory Leak or Heapcheck Failures When Using Mocks**:
  - Ensure destructors of base classes being mocked are virtual.
  - Use `Mock::AllowLeak()` if intentional to suppress false positives.

- **Excessive or Missing Actions Warning**:
  - Verify that the number of `WillOnce()` and `WillRepeatedly()` clauses aligns with the `Times()` specifier.

- **Multiple Failure Messages for Same Expectation**:
  - Recognize these as distinct failure points in test execution, not redundant messages.

---

## Examples of Fix Impact

### Avoiding MSVC Warning C4301/C4373

When mocking methods with `const` parameters, remove the `const` to avoid spurious Visual C++ warnings:

```cpp
// Before
MOCK_METHOD(void, Bar, (const int i), (override));

// Recommended fix
MOCK_METHOD(void, Bar, (int i), (override));
```

### Managing Uninteresting Calls Without Failure

Switch to `NiceMock` to suppress warnings about uninteresting mock calls while still verifying expectations:

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, DoSomething());

// Uninteresting calls to other methods won't produce warnings.
```

### Specifying Expectation Order with Sequences

Use the `InSequence` object to enforce call order and avoid mis-matches:

```cpp
using ::testing::InSequence;
{
  InSequence seq;

  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

Calls out of this order now correctly trigger failures.

---

## Additional Resources and References

- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) - Known issues and their rationale
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Advanced recipes including strictness modes and mocking patterns
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) - Complete specification of mocking macros and clauses
- [Expectations and Calls](https://google.github.io/googletest/api/gmock_reference.html#expectations-and-calls) - Details on setting up mock expectations
- [Mock Behaviors](https://google.github.io/googletest/reference/mock_behaviors.md) - Guides on controlling mock strictness
- [GoogleMock GitHub Repository](https://github.com/google/googletest) - Source code and issue tracking

---

## Summary

This Bug Fixes and Patches documentation captures resolved issues aiming to improve compilation stability, runtime behavior, user diagnostics, and multi-threaded robustness for GoogleMock. It guides users through frequently encountered fixes across releases and promotes best practices around expectations, mocking styles, and flag usage.

<Tip>
Run your tests with `--gmock_verbose=info` for detailed insights into mock calls and match results, especially when debugging unexpected behavior.
</Tip>

<Note>
Stay current with GoogleMock changes and refer to the [Upgrade Guides](https://google.github.io/googletest/changelog/breaking-changes-and-upgrades/upgrade-guides) to smoothly transition between versions.
</Note>