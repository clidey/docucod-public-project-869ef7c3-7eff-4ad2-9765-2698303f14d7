---
title: "New Features and Enhancements"
description: "Focuses on significant additions and improvements, such as new assertion macros, enhanced matcher capabilities, or platform expansions. Describes functional changes with code examples and usage notes."
---

# New Features and Enhancements

This documentation focuses on the significant additions and improvements introduced to GoogleTest, particularly highlighting new assertion macros, enhanced matcher capabilities, and broader platform support. Through practical code examples and detailed usage notes, it guides users to understand and effectively leverage these new capabilities in their testing workflows.

---

## 1. Expanded Assertion Macros

GoogleTest has introduced several new assertion macros and enhancements to existing ones, enabling more expressive and precise test validations.

### 1.1 Explicit Success and Failure Assertions

- **`SUCCEED()`**: This macro allows users to explicitly mark a test as having succeeded at a certain point, useful for documenting control flow paths without impacting test results.

- **`FAIL()`**: Generates a fatal failure immediately, aborting the current function, useful for marking unexpected code paths.

- **`ADD_FAILURE()` and `ADD_FAILURE_AT()`**: Generate nonfatal failures at the current or specific file and line locations, allowing the test to continue but note issues.

### 1.2 Generalized Assertion with Matchers: `EXPECT_THAT`

The `EXPECT_THAT` and `ASSERT_THAT` macros bring matcher-based assertions into GoogleTest, unlocking a powerful and readable way to express complex expectations.

#### Usage Example:
```cpp
#include <gmock/gmock.h>

using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(value1, StartsWith("Hello"));
EXPECT_THAT(value2, MatchesRegex("Line \\d+"));
ASSERT_THAT(value3, AllOf(Gt(5), Lt(10)));
```

This style makes test code read like English and produces clear, informative failure messages.

### 1.3 Extended Boolean and Comparison Assertions

GoogleTest continues to support a rich set of boolean, binary comparison, string-specific, floating-point, and exception assertions with improved coverage:

- Boolean: `EXPECT_TRUE`, `EXPECT_FALSE`, and their `ASSERT_` variants for nonfatal and fatal assertion differences.
- Binary: Equality and inequality via `EXPECT_EQ`, `EXPECT_NE`, and relational macros like `EXPECT_LT`, `EXPECT_GE`, etc.
- String: Specialized macros such as `EXPECT_STREQ`, `EXPECT_STRNE` for C-style strings, supporting case-insensitive versions as well.
- Floating point: `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, and `EXPECT_NEAR` for tolerance-based comparisons avoiding pitfalls of direct equality.
- Exception assertions: `EXPECT_THROW`, `EXPECT_ANY_THROW`, `EXPECT_NO_THROW` support verifying exception behavior where enabled.

### 1.4 Predicate Assertions

These assertions enable tests to verify complex predicates while reporting clear diagnostics:

- `EXPECT_PRED{1-5}`: For predicates with 1 to 5 arguments.
- `EXPECT_PRED_FORMAT{1-5}`: For predicates which use a custom formatter function providing detailed failure messages.

Example:
```cpp
bool MutuallyPrime(int m, int n) { ... }
EXPECT_PRED2(MutuallyPrime, a, b);
```

If failed, the assertion prints the value of each argument to help trace the cause.

### 1.5 Windows HRESULT Assertions

Assertions specialized for Windows COM `HRESULT` values were introduced:

- `EXPECT_HRESULT_SUCCEEDED(expression)`
- `EXPECT_HRESULT_FAILED(expression)`

These verify success or failure of HRESULT expressions and report the human-readable error messages.

### 1.6 Death Assertions

New macros for verifying that code results in process termination with expected messages and exit status were enhanced:

- `EXPECT_DEATH`, `ASSERT_DEATH`
- `EXPECT_DEATH_IF_SUPPORTED`, `ASSERT_DEATH_IF_SUPPORTED`
- `EXPECT_DEBUG_DEATH`, `ASSERT_DEBUG_DEATH`
- `EXPECT_EXIT`, `ASSERT_EXIT`

These spawn subprocesses executing the tested code, verifying termination conditions, stderr output patterns (via matchers or regex), and exit status predicates.

Example:
```cpp
EXPECT_DEATH({ DoSomething(42); }, "My error");
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

---

## 2. Enhancements to Mocking and Matcher Capabilities

While the page primarily focuses on assertion enhancements, some significant improvements in matcher design and mocking macros were also introduced, facilitating more robust and maintainable tests.

### 2.1 Unified `MOCK_METHOD` Macro

GoogleMock standardized its mocking method declaration macros into a single unified `MOCK_METHOD` macro, replacing legacy `MOCK_METHODn` macros. This macro provides:

- Clear, readable syntax for declaring mock methods including the return type, method name, arguments, and method qualifiers (e.g., `const`, `override`, `noexcept`).
- Support for complex types involving commas via parentheses or typedefs.
- Enhanced compatibility with overloaded methods, templated methods, call type specifiers (like Windows calling conventions), and reference qualifier support.

Example:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, DoThis, (int n), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

### 2.2 Mock Strictness Wrappers

To aid in managing uninteresting mock method calls, three behavior wrappers help control mock strictness:

- `NiceMock<T>`: Suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: The default behavior, warns on uninteresting calls.
- `StrictMock<T>`: Treats uninteresting calls as errors.

These wrappers can be used as substitutes for mock types to tailor the verbosity and strictness of test feedback.

### 2.3 Matcher Refinements and Compositions

Matchers now support advanced compositions for intricate verification scenarios:

- Combining multiple argument matchers through `AllOf()`, `AnyOf()`, `Not()`.
- Matching containers precisely or with loose constraints (`ElementsAre`, `UnorderedElementsAre`).
- Field and Property matchers to assert on member variables or getter functions.
- Pointer dereference matchers (`Pointee`), including nested pointers.
- Safe matcher casts (`SafeMatcherCast`) to relax strict typing in controlled ways.
- Custom matcher classes and parameterized matcher factories for extensibility.

Example matcher usage:
```cpp
EXPECT_CALL(foo, Bar(AllOf(Gt(0), Lt(10))));
EXPECT_CALL(foo, Foo(ElementsAre(1, 2, 3)));
EXPECT_THAT(obj, Property(&MyClass::value, Eq(5)));
```

### 2.4 Action API Improvements

The Mocking framework offers fine-grained control over mock method behaviors:

- Actions to return values or references (`Return`, `ReturnRef`, `ReturnPointee`).
- Chaining multiple actions (`DoAll`).
- Setting output arguments (`SetArgPointee`, `SetArrayArgument`).
- Using lambdas, functors, or member functions in `Invoke` to implement arbitrary behaviors.
- `WithArgs` and `WithoutArgs` helpers to adapt argument signatures.
- Support for move-only types in mock method parameters and return values.

### 2.5 Best Practices and Tips for Mock Usage

The documentation includes practical advice to avoid common pitfalls:

- Use `ON_CALL` to specify default behavior without imposing expectations.
- Use `EXPECT_CALL` sparingly and only to verify important interactions.
- Use sequences (`InSequence`) or `.After()` clauses to control call ordering explicitly.
- Use `.RetiresOnSaturation()` to control expectation lifetimes.
- Avoid over-specifying expectations to prevent brittle tests.

---

## 3. Platform Expansions and Performance

GoogleTest and GoogleMock have increased support for modern C++17 standards and improved platform compatibility.

- C++17 is now a mandatory requirement, ensuring consistency and leveraging modern language features.
- Platform support is broadened to include a variety of compilers and operating systems with accompanying build system updates.

This enables users to take advantage of improved language features and ensures smoother integration in diverse development environments.

---

## 4. Practical Tips and Usage Notes

- When using new assertion macros like `EXPECT_THAT`, consider defining custom matchers for specific domain logic.
- Use `EXPECT_DEATH` and `EXPECT_EXIT` when testing process-level failure modes.
- To suppress warnings for uninteresting mock calls without failing the test, wrap mocks with `NiceMock`.
- For heavy use of mocks, consider optimizing compile times by defining mock constructors/destructors separately.

---

## 5. Troubleshooting and Common Pitfalls

- Avoid mixing old and new mocking macros; migrate legacy `MOCK_METHODn` macros to unified `MOCK_METHOD`.
- Ensure virtual destructors are declared in interfaces to avoid undefined behavior.
- When matching overloaded methods, use `Const()` wrapper or explicit casting to disambiguate overloads.
- Beware of sticky expectations that remain active even after saturation unless `.RetiresOnSaturation()` is specified.
- Use verbose flags (`--gmock_verbose=info`) to gain insight into mock expectations and call matchings when tests fail unexpectedly.

---

## 6. Code Examples

### Example: Using `EXPECT_THAT` With Matchers
```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::Lt;

TEST(MyTest, MatcherExample) {
  std::string greeting = "Hello, World!";
  int number = 7;

  EXPECT_THAT(greeting, StartsWith("Hello"));
  EXPECT_THAT(number, Lt(10));
}
```

### Example: Defining a Mock Method with `MOCK_METHOD`
```cpp
class Interface {
 public:
  virtual ~Interface() {}
  virtual int Compute(int x) = 0;
  virtual std::string Describe() const = 0;
};

class MockInterface : public Interface {
 public:
  MOCK_METHOD(int, Compute, (int x), (override));
  MOCK_METHOD(std::string, Describe, (), (const, override));
};
```

### Example: Controlling Mock Behavior
```cpp
using ::testing::Return;
using ::testing::_;

TEST(MockTest, Behavior) {
  MockInterface mock;
  ON_CALL(mock, Compute(_)).WillByDefault(Return(42));
  EXPECT_CALL(mock, Describe()).WillOnce(Return("Mocked description"));

  EXPECT_EQ(42, mock.Compute(5));
  EXPECT_EQ("Mocked description", mock.Describe());
}
```

## 7. References and Further Reading

- [GoogleTest Assertions Reference](https://google.github.io/googletest/reference/assertions.html)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Changelog - Latest Release Notes](https://google.github.io/googletest/changelog/release-history/latest-release-notes.html)

---

This page serves as a vital resource to understand and apply the new powerful features introduced in GoogleTest and GoogleMock for writing more expressive, flexible, and robust tests.
