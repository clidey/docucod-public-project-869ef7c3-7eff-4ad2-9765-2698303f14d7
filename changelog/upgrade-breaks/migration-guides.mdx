---
title: "Migration & Upgrade Guides"
description: "Step-by-step instructions for migrating between key framework versions, including code updates, configuration changes, and build tool adjustments. Eases transition for both small and large codebases."
---

# Migration & Upgrade Guides

GoogleTest and GoogleMock have evolved significantly across versions, introducing new features, deprecations, and behavioral changes. This Migration & Upgrade guide walks you through the essential steps to update your codebase, build configurations, and test suites when moving between major or minor framework versions. Whether managing a small project or a large-scale test codebase, these instructions help reduce friction, minimize breakage, and keep your testing infrastructure stable and modern.

---

## 1. Preparing for an Upgrade

Before starting the upgrade process, ensure you have a clear understanding of your current GoogleTest and GoogleMock version and your target version.

**Checklist:**

- Identify the current and target version numbers.
- Review the [Breaking Changes](./breaking-changes) document for incompatible API or test behavior changes.
- Consult the [Deprecations & Removals](./deprecations) page for APIs or features that may no longer be available.
- Back up your current test code and build configurations.
- Pinpoint any CI/CD pipeline dependencies that may need adjustment.

## 2. Code and Test Suite Migration

Upgrading the framework often requires updating test code to comply with new naming conventions, macro requirements, and behavior semantics.

### 2.1 Test Naming Consistency

GoogleTest enforces stricter rules on test suite and test case names to avoid collisions and reserved identifier misuse:

- Avoid underscores (`_`) in `TestSuiteName` and `TestName` to prevent name mangling issues and compiler conflicts.
- Do not start or end test or suite names with underscores.
- If your code currently uses disallowed names, rename your test suites and tests accordingly.

### 2.2 Default Constructors in Test Fixtures

Test fixtures must have accessible default constructors since GoogleTest creates a fresh fixture object for each test.

- If you provide any non-default constructors, explicitly define a default constructor as well.
- Initialize any const or reference members in the constructor initializer list.

### 2.3 Transition from Old Mock Macros

If your code uses legacy `MOCK_METHODn` macros, migrate to the unified `MOCK_METHOD` macro, which supports qualifiers:

```cpp
// Old style
MOCK_METHOD1(Foo, bool(int));

// New style
MOCK_METHOD(bool, Foo, (int));
```

Add qualifiers such as `(const)`, `(noexcept)`, or `(override)` as necessary to match the mocked interface.

### 2.4 Adjusting Death Tests

Death tests are isolated in subprocesses. Note that:

- Side effects from death tests do not propagate back to the parent test process.
- Mock expectations related to death tests should reside inside the death test macros.
- Confirm death test suites are named `*DeathTest` for proper execution flow.

## 3. Build Tool Adaptations

Upgrading may change requirements for compiler standards and build tools.

### 3.1 Enforcing C++17 or Later

From version 1.17.0 onwards, GoogleTest requires at least C++17. Ensure:

- Your compiler and toolchain support C++17.
- Build flags enable `-std=c++17` (or equivalent).
- CI pipelines and IDEs honor this configuration.

### 3.2 Integration with Bazel and CMake

Reference the latest [Quickstart: Bazel](../getting-started/prerequisites-installation/installation-bazel) and [Quickstart: CMake](../getting-started/prerequisites-installation/installation-cmake) guides to adapt build files appropriately.

### 3.3 Handle Deprecations and Removed APIs

Update build configurations and source code to remove references to deprecated macros, methods, and test execution flags.

## 4. Testing and Validation

Upgrade migration is incomplete without validating that your tests run and pass correctly under the new version.

### 4.1 Test Discovery and Execution

- Verify tests are discovered automatically without manual registration.
- Ensure that `RUN_ALL_TESTS()` return value is propagated correctly from your `main()` function.

### 4.2 Assertion and Mocking Behavior

- Test that assertions honor the fatal and non-fatal semantics properly.
- Validate mocking behavior including expectations, default actions (`ON_CALL`), and call strictness wrappers (`NiceMock`, `StrictMock`).

### 4.3 Death Tests

Confirm death tests behave as expected with the new framework:

- Correct regular expressions match failures.
- Thread safety settings for death tests reflect your use case and concurrency environment.

## 5. Troubleshooting Common Issues

### 5.1 Unexpected Test Failures

- Check for test name collisions caused by underscores.
- Ensure test fixtures have default constructors.
- Verify mock methods are defined using the correct modern macros.

### 5.2 Build Errors

- Confirm C++17 standard is enforced properly.
- Check for missing definitions of static const data members.
- Update or remove deprecated APIs referenced in code.

### 5.3 Mocking Warnings

- Use [`NiceMock`](../guides/real-world-mocking/strictness-modes) to suppress warnings about uninteresting calls.
- Use `EXPECT_CALL` appropriately to specify expected interactions.

## 6. Example Upgrade Workflow

<Steps>
<Step title="Backup">
Back up your current test sources and build files.
</Step>
<Step title="Update Build Configurations">
Set compiler to C++17 and adjust Bazel/CMake files.
</Step>
<Step title="Rename Tests">
Refactor test suite and test case names to remove underscores.
</Step>
<Step title="Adjust Mock Macros">
Replace old `MOCK_METHODn` macros with `MOCK_METHOD`.
</Step>
<Step title="Verify Death Test Suites">
Rename death test suites with the `*DeathTest` suffix.
</Step>
<Step title="Run Tests and Fix Failures">
Run your test suite, then fix compilation and run-time errors or assertion failures.
</Step>
</Steps>

## 7. Additional Resources

- [Breaking Changes](./breaking-changes): Detailed incompatible or changed APIs and behaviors.
- [Deprecations & Removals](./deprecations): Deprecated features and suggested alternatives.
- [Installation & Build Problems FAQ](../faq/common-issues/installation-build-problems): For troubleshooting environment and build tool issues.
- [Mock Class and Method Definition Reference](../api-reference/googlemock-apis/mock-class-and-method-definition): For correct mock class migration.
- [Test Discovery and Execution Guide](../getting-started/first-test-setup/test-discovery-execution): Understanding test lifecycle.

---

<Tip>
Keep your upgrade incremental: upgrade dependencies first, update build systems, then refactor test code and finally validate test runs. This reduces complexity and isolates issues effectively.
</Tip>

<Warning>
Avoid suppressing uninteresting mock call warnings by adding blanket `EXPECT_CALL` without understanding the test intent. Instead, use `NiceMock` or refine your expectations.
</Warning>