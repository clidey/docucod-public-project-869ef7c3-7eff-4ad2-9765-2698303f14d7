---
title: "Breaking Changes & Migration Guidance"
description: "Summarizes changes that could impact existing test suites, including removed or modified APIs and platform requirements (such as the C++17 baseline). Provides actionable advice for updating tests, configuration, or integrations with the new version."
---

# Breaking Changes & Migration Guidance

This page presents the essential breaking changes and migration guidance that can affect your existing test suites when updating to a newer version of GoogleTest and GoogleMock. It focuses on modifications to the public mock API, changes in platform requirements such as the enforced C++17 baseline, and configuration updates. Our goal is to help you proactively adjust your tests, mocks, and integrations to maintain smooth operation with the latest release.

---

## 1. Overview of Breaking Changes

With each major or minor release, GoogleTest may introduce changes that, while enhancing functionality or improving reliability, can impact existing tests:

- **Removed or Modified Mocking APIs:** Some macros, method signatures, or expectations semantics may have changed.
- **Platform Baseline Updates:** The library now requires at least C++17 or later, dropping support for older standards.
- **Default Behavior and Flag Changes:** Default mock behaviors and runtime flags might have new default settings affecting test warnings or failures.

Reading this guidance will help you understand these changes and prepare or migrate your test code accordingly.

## 2. Changes to Mocking APIs Impacting Test Suites

### 2.1 Mandatory C++17 Baseline

GoogleTest and GoogleMock have now increased the minimum required C++ standard to C++17. If your test projects or build configurations still target earlier standards (e.g., C++11 or C++14), you must update your build configuration to C++17 or later before proceeding.

**Impact:**
- Code using older standards may fail to compile.
- Some STL features used internally may require C++17.
- Enhances compatibility with modern compilers and enables improved internal implementations.

### 2.2 New `MOCK_METHOD` Macro Syntax and Deprecation of Legacy `MOCK_METHODn`

The older `MOCK_METHODn` macros are deprecated in favor of the generic `MOCK_METHOD` macro, which provides consistent syntax, advanced features, and better compiler error messaging.

Example transition:
```cpp
// Legacy old syntax (deprecated)
MOCK_METHOD1(Foo, bool(int));

// New syntax (recommended)
MOCK_METHOD(bool, Foo, (int), (override));
```

**Action:**
- Prefer migrating mock classes to use the new `MOCK_METHOD` macro.
- The new macro supports qualifiers like `const`, `override`, `noexcept`, and calltype attributes.

### 2.3 Refinements in Expectation Matching and Ordering

- The search order for matching expectations remains from **last defined to first**, allowing test fixtures to define common default expectations which specific tests can override.
- The rules for expectation *stickiness* are clarified: expectations remain active after saturation unless explicitly retired with `.RetiresOnSaturation()`.
- The `.RetiresOnSaturation()` clause is particularly useful to avoid upper-bound call violations in repeated or ordered expectations.

**Example:**
```cpp
// Allows default expectation for any call
EXPECT_CALL(mock, Foo).Times(AnyNumber());
// More specific expectation - retires when matched twice
EXPECT_CALL(mock, Foo(5)).Times(2).RetiresOnSaturation();
```

### 2.4 Updated `ON_CALL` and `EXPECT_CALL` Behaviors

- The `ON_CALL` macro behavior continues to define *default mock method actions* but does **not** set call count expectations. To avoid warnings about uninteresting calls, use `EXPECT_CALL` combined with cardinalities like `.Times(AnyNumber())`.
- Warnings for uninteresting calls can be suppressed by using `NiceMock`, but unexpected calls (calls not matching any `EXPECT_CALL`) remain errors unless using `NaggyMock` or other custom behaviors.

### 2.5 Enhanced Support for Overloaded and Const Methods

- Use the `Const()` helper when mocking overloaded methods differing only by const qualification.

Example:
```cpp
EXPECT_CALL(foo, GetBar());          // mocks non-const
EXPECT_CALL(Const(foo), GetBar());  // mocks const method
```

- To specify overloaded methods with identical arg counts but different parameter types, disambiguate by casting matcher types or using explicit matcher types.

### 2.6 Safe Matcher Casting

- `SafeMatcherCast<T>` is the recommended way to cast matchers to the expected type safely; this ensures implicit convertibility and lossless conversions where applicable.
- `MatcherCast<T>` remains available but is less safe and should be used with caution.

## 3. Configuration and Platform Requirements

### 3.1 Enforcement of C++17

Users must configure their build for **C++17 or later**. The internal GoogleTest ports and APIs depend on features introduced in C++17 (like `std::string_view`, `std::optional`, and fold expressions).

### 3.2 Runtime Flag Changes

The verbosity level of gMock output can be tuned via the `--gmock_verbose` flag with levels `info`, `warning` (default), and `error`:

- `info`: Prints detailed call traces and stack traces on mock calls.
- `warning`: Prints warnings for uninteresting calls without stack traces.
- `error`: Prints only error messages for unexpected calls.

**Tip:** Use `--gmock_verbose=info` to diagnose why expectations are not met more easily.

## 4. Migration Recommendations

### 4.1 Update Build Configuration

Before updating GoogleTest and GoogleMock, confirm your compiler and build settings support C++17.

### 4.2 Modernize Mock Definitions

- Migrate all mocks to use the new `MOCK_METHOD` macro.
- Add `override` qualifiers explicitly, as best practice.
- Wrap complex or nested argument types with parentheses or use type aliases to avoid parsing issues.

### 4.3 Adjust Expectation Logic

- Use `.RetiresOnSaturation()` on expectations that should stop being active after reaching call count.
- Use `NiceMock` or `StrictMock` wrappers to adjust uninteresting call behaviors.
- Use explicit cardinalities and ordering constraints (`InSequence`, `.After()`) to control call expectations.

### 4.4 Control Mock Verbosity

Set `--gmock_verbose=info` during migration to troubleshoot unmatched calls and unrecognized expectations.

### 4.5 Verify and Clear Expectations Explicitly When Needed

If your tests create mocks with lifecycle beyond their scope or ownership is ambiguous, use:

```cpp
Mock::VerifyAndClearExpectations(&mock_object);
```

to enforce early verification.

## 5. Common Pitfalls and Troubleshooting

### 5.1 Expectation Ordering and Stickiness

Beware that by default, expectations remain active (sticky) after saturation. This can cause unexpected upper-bound errors when repeat calls occur. Explicitly use `.RetiresOnSaturation()` if needed.

### 5.2 Uninteresting vs Unexpected Calls

Be clear about the difference:

- **Uninteresting Call:** No expectation set. Results in warnings by default but not failures.
- **Unexpected Call:** Call does not match any active expectation. Results in test failure.

Use `NiceMock` to suppress warnings, `StrictMock` to enforce errors on uninteresting calls.

### 5.3 Mocking Non-virtual or Static Methods

Direct mocking of non-virtual or static free functions remains unsupported. Use interface wrappers or dependency injection to mock effectively.

### 5.4 Mocking with Move-only Types

The newer GoogleMock versions fully support move-only arguments and return values. For legacy code, consider delegation to mock methods without move semantics.

### 5.5 Handling Compiler Warnings

In MSVC, warnings related to `const` parameters in mock methods can appear due to compiler quirks. Remove redundant top-level `const` in parameters to avoid these warnings.

### 5.6 Diagnosing Failed Expectations

Enable `--gmock_verbose=info` to see detailed traces for every mock call and matched expectation.

## 6. Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for advanced mocking techniques
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) — Detailed API reference
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner guide
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) — Answers to common mock-related issues

## 7. Summary

This page covered the latest breaking changes in GoogleTest's mocking framework, emphasizing necessary migration steps such as adopting C++17, updating mock method macros, adjusting expectations for new semantics, and configuring verbosity for diagnostics. Carefully following the guidance will ensure your tests remain robust and maintainable on the latest GoogleTest releases.

---

<Tip>
For seamless migration, start by updating your build to use C++17. Then incrementally modernize your mock classes to the new `MOCK_METHOD` syntax and refine expectations using `.RetiresOnSaturation()` and explicit cardinalities. Leverage `NiceMock` to reduce noise during transition.
</Tip>

<Note>
Removing the deprecated `MOCK_METHODn` macros and adopting the new standard will improve both compilation speed and ease debugging failed expectations.
</Note>

<Warning>
Do not ignore compiler warnings related to virtual destructors or unintentional parameter const-qualification, as they can cause runtime issues or unexpected mock behaviors.
</Warning>

<Steps>
<Step title="Upgrade your C++ Standard">
Modify your compiler flags (e.g., `-std=c++17` for GCC/Clang) to enforce C++17 as the baseline.
</Step>
<Step title="Replace old MOCK_METHODn macros">
Refactor your mock class definitions to use the new `MOCK_METHOD` macro with proper signature parentheses and qualifier lists.
</Step>
<Step title="Revise Expectation and Default Action Usage">
Review your use of `EXPECT_CALL`, `ON_CALL`, and mock strictness wrappers (`NiceMock`, `StrictMock`). Add `.RetiresOnSaturation()` where applicable.
</Step>
<Step title="Adjust for Overloads and Constness">
Use `Const()` and `SafeMatcherCast<T>()` to disambiguate overloaded and const-qualified method mocks.
</Step>
<Step title="Enable Verbosity for Troubleshooting">
Run tests with `--gmock_verbose=info` to monitor mock call matching and quickly diagnose expectation mismatches.
</Step>
</Steps>

---

For source and pull requests, see the main repository at [https://github.com/google/googletest](https://github.com/google/googletest).

---

**Note:** This page focuses solely on breaking changes and migration guidance pertinent to mocking APIs and platform requirements, as per the product update schedule.
