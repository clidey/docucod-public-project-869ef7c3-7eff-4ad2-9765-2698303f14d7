---
title: "Upgrade Best Practices"
description: "Step-by-step guidance for planning and executing upgrades, including environment preparation, dependency management (e.g., C++ standard requirements), and build adjustments. Addresses common pitfalls and offers project-agnostic checklists to streamline transitions between versions."
---

# Upgrade Best Practices

Upgrade Best Practices provides clear, actionable guidance to help you plan and execute smooth upgrades of GoogleMock (gMock) and GoogleTest versions. This guidance ensures compatibility, maintains test correctness, and streamlines migration with a focus on environment setup, dependency management, and common adjustment strategies.

---

## 1. Preparing Your Environment for Upgrades

Upgrading to a newer version of GoogleMock involves confirming that your build environment meets updated prerequisites. Since GoogleMock requires C++17 as a minimum language standard, it's critical to verify your compiler version and project settings:

- Ensure your compiler is one of the supported versions (GCC 7.1+, Clang 5.0+, MSVC 2017+).
- Confirm your build tools (CMake, Bazel, Makefile) are configured to enable C++17 or higher.
- Validate documented system requirements and platform support (Windows, Linux, macOS).

<Tip>
Review the [Prerequisites and System Requirements](/getting-started/setup-introduction/prerequisites-requirements) and [Supported Platforms & Build Integration](/overview/integration-and-ecosystem/platforms-integration) pages for detailed environment preparation.
</Tip>


## 2. Managing Dependencies and Build Configuration

Upgrading may require adjustments to how your project includes and links GoogleMock artifacts:

- Update your project dependencies to reference the new version.
- Verify header inclusion paths in your build system reflect any structural changes.
- Adjust linker settings if upgrading from manual builds to integrated CMake or Bazel methods.
- Use the revised CMake targets or Bazel rules recommended for the latest versions.

<Note>
Adjustments to your build scripts will prevent compilation or linking errors common in upgrades.
</Note>


## 3. Migrating Mock Definitions

Recent GoogleMock versions recommend migrating from older MOCK_METHODn macros to the unified `MOCK_METHOD` macro with explicit argument and qualifier specification. When upgrading:

- Replace deprecated old-style `MOCK_METHODn` macros with the new `MOCK_METHOD` syntax.
- Enclose complex argument types involving commas in extra parentheses or better use type aliases to avoid macro parsing errors.
- Add necessary qualifiers like `(const, override)`, `(noexcept)`, or `Calltype` as required.

<Steps>
<Step title="Identify and Replace Deprecated MOCK_METHODn">
Search your mock classes for uses of `MOCK_METHODn` macros and replace them with `MOCK_METHOD`. For example:

```cpp
// Old style
MOCK_METHOD1(Foo, bool(int));

// New style
MOCK_METHOD(bool, Foo, (int));
```
</Step>
<Step title="Handle Complex Argument Types">
For return or argument types containing commas, use parentheses or type aliases to avoid issues:

```cpp
// Example of parentheses wrapping
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// Alternatively use type alias
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```
</Step>
<Step title="Ensure Correct Qualifiers">
Add qualifiers as appropriate for the method signature:

```cpp
MOCK_METHOD(bool, Func, (int), (const, override));
```
</Step>
</Steps>


## 4. Adopting Mock Strictness Models

To avoid noisy test outputs or brittle tests after upgrading, reconsider your use of mock strictness wrappers:

- `NiceMock<T>`: suppresses warnings on uninteresting calls; recommended for stable test suites.
- `NaggyMock<T>`: warns on uninteresting calls; currently default but may change.
- `StrictMock<T>`: fails tests on uninteresting calls; use cautiously to catch unintended interactions.

<Note>
Using strictness wrappers properly can significantly reduce maintenance overhead and improve test clarity.
</Note>


## 5. Adjusting Expectations and Actions

Check your use of `EXPECT_CALL`, `ON_CALL`, and actions for compatibility with upgraded semantics:

- Confirm that chained actions like `.WillOnce()` / `.WillRepeatedly()` are used correctly.
- Adjust for inferred cardinalities and remember that expectations are sticky by default.
- Use `.RetiresOnSaturation()` when you want expectations to retire as calls complete.
- Follow the clause ordering restrictions (e.g., `.With()` must be first).

<Warning>
Setting expectations after exercising mock methods leads to undefined behavior and must be avoided.
</Warning>


## 6. Handling Deprecations

GoogleMock versions may deprecate:

- Old-style `MOCK_METHODn` macros (migrate to new `MOCK_METHOD`).
- Certain legacy matchers and actions.

Consult the deprecation notices carefully and refactor your mocks accordingly. Using modern APIs will yield better error messaging, support, and maintainability.


## 7. Verifying and Cleaning up Mocks

As part of the upgrade, integrate calls to `Mock::VerifyAndClearExpectations()` and `Mock::VerifyAndClear()` especially if you have mocks allocated on the heap or reused across tests. This guarantees expectations are checked even if mocks are leaked or destructed late, improving test reliability.


## 8. Common Pitfalls to Avoid

- Forgetting to update compiler options to enable C++17 leads to mysterious build errors.
- Mixing old and new mock APIs can cause confusing compilation failures.
- Setting expectations after mock method calls results in undefined test results.
- Neglecting to handle uninteresting calls with appropriate strictness leads to noisy or failing tests.


## 9. Step-by-Step Checklist Before Upgrading

- [ ] Confirm C++ standard and compiler versions.
- [ ] Update build system references and configurations.
- [ ] Migrate all mocks to new `MOCK_METHOD` macro.
- [ ] Review uses of strictness wrappers and adjust as desired.
- [ ] Audit `EXPECT_CALL` and `ON_CALL` usages for new requirements.
- [ ] Run your tests with `--gmock_verbose=info` to detect unexpected calls or deprecated API usage.
- [ ] Fix warnings and errors indicated by verbose output.
- [ ] Run complete test suites to validate migration.


## 10. Additional Resources

For further details and migration examples, refer to:
- [Mocking Reference](../api-reference/mocking-apis/mocking-methods)
- [Mocking Strictness Modes](../api-reference/mocking-apis/strictness-modes)
- [Migration & Upgrade Guides: Breaking Changes](../changelog/migration-upgrade-guides/breaking-changes)
- [Migration & Upgrade Guides: Deprecations](../changelog/migration-upgrade-guides/deprecations)
- [gMock Cookbook](../docs/gmock_cook_book.md)

---

### Example Code: Migrating an Old-Style Mock Method

Before:

```cpp
class MockExample {
public:
  MOCK_METHOD1(Foo, bool(int x));
};
```

After:

```cpp
class MockExample {
public:
  MOCK_METHOD(bool, Foo, (int x), (override));
};
```

Use type alias or parentheses if the argument type has commas.

### Example Code: Using a NiceMock Instead of Raw Mock

```cpp
using ::testing::NiceMock;

NiceMock<MockExample> mock_instance;
EXPECT_CALL(mock_instance, Foo(5)).WillOnce(Return(true));
```

This suppresses warnings from uninteresting calls, making test output cleaner.

### Troubleshooting Upgrade Issues

- Use `--gmock_verbose=info` to get detailed call and expectation matching logs.
- Check compiler and linker error messages carefully for missing include paths or symbol mismatches.
- Review failing tests for changed expectations or unexpected mock calls.

---

By adhering to these upgrade best practices, you ensure a smoother transition to newer GoogleMock versions, realize benefits from improved APIs and performance, and reduce test maintenance overhead.

<Info>
For comprehensive understanding, review the [GoogleMock Reference](../api-reference/mocking-apis/mocking-methods) and [Breaking Changes & Migration Guide](../changelog/migration-upgrade-guides/breaking-changes).
</Info>
