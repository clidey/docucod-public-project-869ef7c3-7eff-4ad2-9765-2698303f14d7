---
title: "Safe Upgrade Checklist"
description: "A practical, step-by-step checklist to help you upgrade your dependencies, validate compatibility, and catch common issues. Includes tips for preparing your code, adjusting to configuration changes, and leveraging new features with minimal disruption."
---

# Safe Upgrade Checklist

A reliable upgrade process is crucial to take advantage of GoogleTest's latest features, fixes, and improvements without disrupting your existing testing workflows. This checklist guides you through a practical, step-by-step approach to upgrading your dependencies, validating compatibility, and catching common pitfalls early.

---

## 1. Prepare Your Codebase

- **Review Current Version:** Confirm the GoogleTest and GoogleMock versions currently in use.
  - Record the exact semantic version number.
- **Backup and Version Control:** Ensure your code is committed and backed up to easily revert if needed.
- **Identify Direct Dependencies:** Note whether your build references `gtest`, `gtest_main`, `gmock`, and/or `gmock_main` libraries.
- **Check for Deprecated Features:** Review your tests for deprecated APIs, such as legacy `MOCK_METHODn` macros, and plan their replacement with `MOCK_METHOD`.

## 2. Update Dependencies

- **Fetch the Latest Release:** Download or update your repository or package to the desired newer version.
- **Adjust Build Configuration:** Modify your build files (CMake, Bazel, etc.) to point to the new version.
  - Validate that binaries for `gtest_main` or `gmock_main` (which provide default `main()` definitions) are used appropriately.
- **Refactor Mock Classes:**
  - Replace old mock macros with the current syntax:

```cpp
// Legacy macro
MOCK_CONST_METHOD1(Foo, bool(int));

// Modern replacement
MOCK_METHOD(bool, Foo, (int), (const, override));
```

- **Remove or Replace Deprecated Wrappers:** Avoid using deprecated NaggyMock; instead, prefer NiceMock or StrictMock where applicable.

## 3. Validate Compatibility

- **Run Sample Tests:** Use existing tests or quick smoke tests to verify basic functionality.
- **Watch for Build Warnings and Errors:**
  - Pay special attention to:
    - Overridden virtual methods signatures (const correctness, noexcept, reference qualifiers).
    - Comma handling in `MOCK_METHOD` arguments (wrap complex template types in parentheses or use type aliases).
- **Check Test Output for Mock Expectations:**
  - Verify no warning is produced for unexpected or uninteresting calls unless explicitly intended.
- **Review Changes in Behavior:**
  - If your mock classes start logging warnings or errors about uninteresting calls, consider switching to `NiceMock` or adjusting expectations.

## 4. Adjust to Configuration Changes

- **Main Function Initialization:** Confirm your test executable's `main()` is correctly set up:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);  // Initializes both GoogleMock and GoogleTest.
  return RUN_ALL_TESTS();
}
```

- If you're using the `gmock_main` library, link against it to avoid providing your own `main()`.

- **Command Line Flags:** Review any test runtime flags you use (`--gmock_verbose`, `--gtest_filter`, etc.) to ensure they behave as expected.

## 5. Leverage New Features

- **Use Expanded Mocking Macros:** Benefit from improved macro support for:
  - Overloaded methods
  - Method qualifiers like `const`, `noexcept`, and custom calling conventions
  - Mocking move-only types

- **Adopt Default Behaviors via `ON_CALL`:** Set up default mock behaviors separate from call expectations to reduce brittleness.

- **Use `RetiresOnSaturation()`:** Prevent sticky expectations from causing unexpected upper-bound failures in sequence-driven tests.

- **Incorporate Advanced Matchers and Actions:** Utilize polymorphic and composite matchers for cleaner, more expressive expectations.

## 6. Common Pitfalls & Troubleshooting

<AccordionGroup title="Common Upgrade Issues and Fixes">
<Accordion title="Build Errors Related to MOCK_METHOD">
Ensure that method arguments containing commas are properly enclosed in parentheses or replaced with type aliases.

Example:

```cpp
MOCK_METHOD((std::pair<int, int>), GetData, ());
```

Failure to do so often leads to cryptic compiler errors.
</Accordion>
<Accordion title="Uninteresting Call Warnings After Upgrade">
If your tests now output warnings about uninteresting calls, consider wrapping your mocks with `NiceMock` to suppress these warnings or explicitly set expectations for calls that are expected but not verified.

Example:

```cpp
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, ExpectedMethod());
```

Alternatively, use catch-all expectations with `Times(AnyNumber())` to silence expected uninteresting calls.
</Accordion>
<Accordion title="Failing Destructors in Mocks">
Verify all mocked classes have virtual destructors. If you need to expect destruction order, add a mock method like `Die()` called from the destructor and set expectations on that method.

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```
</Accordion>
<Accordion title="Test Failures Due to Changed Strictness Policies">
If your tests use `StrictMock`, note that uninteresting calls now cause failures. Modify mock policies or relax expectations if needed.
</Accordion>
</AccordionGroup>

---

### Quick Upgrade Example:

```bash
# Update repository
git pull origin main

# Update build files to new locations or versions
# For CMake:
cmake -S . -B build -DGTEST_ROOT=path/to/new/gtest
cmake --build build

# Run tests
./build/your_test_executable --gmock_verbose=info
```

Make sure test output shows all fundamental tests passing before integrating deeply.

---

## Additional Tips

- Always keep your GoogleTest and GoogleMock versions consistent.
- Read release notes for migration highlights and deprecated features.
- Use `Mock::VerifyAndClearExpectations()` for early verification if your mocks are long-lived or heap-allocated.
- Maintain clear test separation: `ON_CALL` for default behaviors, `EXPECT_CALL` for specific verifications.

---

For detailed reference on macros, expectations, and advanced features, consult the [Mocking Reference](../api-reference/mocking-framework/mock-class-definition) and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

---


### References
- [Mocking Reference](../api-reference/mocking-framework/mock-class-definition)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Release Timeline & Summary](./version-overview)  
- [Breaking Changes & Major Migrations](./breaking-changes)  
- [Deprecations & Sunset Policies](./deprecation-notices)

---

By following this checklist, you ensure a smooth transition to the latest GoogleTest and GoogleMock functionality, improve test reliability, and minimize upgrade disruption.

