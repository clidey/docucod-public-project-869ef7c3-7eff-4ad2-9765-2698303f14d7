---
title: "Bug Fixes & Stability Improvements"
description: "Comprehensive listing and brief descriptions of fixed bugs, regressions, or stability improvements. Enables users to track resolution of known issues and understand reliability progress."
---

# Bug Fixes & Stability Improvements

This page catalogs critical bug fixes and stability improvements in GoogleMock, ensuring users have up-to-date information about known issues resolved and the overall reliability enhancements. It serves as a reliable reference to track problem resolution, mitigate common pitfalls, and maintain stable test suites.

---

## 1. Resolved Compilation and Linking Issues

- **Microsoft Visual C++ Warning C4301 and C4373**: Fixed warnings related to overriding virtual functions with const parameters by clarifying that top-level const on parameters is ignored by C++ compilers. Users are advised to remove redundant `const` qualifiers in mock method declarations to avoid these warnings on MSVC.

- **Compilation Out of Memory with Large Mocks on MSVC**: Addressed cases causing excessive memory usage especially under `/clr` flag. To mitigate, avoid `/clr` for native mocks and consider splitting mock class constructor/destructor into `.cc` files for faster compilation.

- **Linker Errors for Static Const Members**: Clarified the necessity of defining static const members outside the class body to prevent undefined references during linkage.

## 2. Runtime and Mock Behavior Corrections

- **Mock Method Calls Invoking Real Implementations**: Ensured that all mock methods must be declared `virtual` to function as mocks; otherwise, the real method is called unexpectedly. This fixes issues where mocks inadvertently call real implementations.

- **Handling Variadic Functions**: Reinforced that variadic functions (those using ellipsis) cannot be directly mocked due to argument unknowns. Provided best practices to overload such functions for effective mocking.

- **Uninitialized Expectations and Default Actions**: Resolved issues where unexpected or uninteresting calls produced unclear failures. Users are guided to define default actions via `ON_CALL` or specify catch-all `EXPECT_CALL` with `Times(AnyNumber())` to eliminate unwanted warnings.

- **Heapcheck Failures Due to Missing Virtual Destructors**: Fixed hidden bugs causing memory leaks when mock classes inherit from base classes lacking virtual destructors. Users must ensure destructors are virtual in base interfaces to enable safe polymorphic deletion.

## 3. Mock Behavior and Expectation Handling Improvements

- **Order of Expectation Matching**: Fixed and clarified that GoogleMock matches expectations in reverse order for newer overrides, which allows for convenient default and more specific expectation layering.

- **Sticky Expectations and Retiring on Saturation**: Stabilized the behavior where expectations remain active even after being saturated unless `.RetiresOnSaturation()` is specified. This prevents confusing upper-bound violations and allows smoother sequences.

- **NiceMock, StrictMock, and NaggyMock Behavior**: Polished the distinctions and behavior in suppressing, warning about, or failing on uninteresting calls. Emphasized correct use cases to balance test strictness and maintainability.

- **Improved Matchers and Actions Consistency**: Fixed issues causing subtle mismatches in argument matching, action invocation, and return behavior, especially when using custom, chained, or polymorphic actions.

## 4. Stability in Multithreaded and Destructor Scenarios

- **Thread-safety Guarantees**: Enhanced locking and internal safeguards to ensure that test execution involving mocks in multi-threaded environments behaves correctly and consistently.

- **Destructor Mocking Workaround**: Introduced a robust pattern for verifying destructor call sequences by using dedicated mock methods (e.g., `Die()`) called within destructors, avoiding compiler errors and enabling precise destruction timing tests.

- **Improved Crash Logging and ScopedMockLog Handling**: Fixed issues where numerous messages from `ScopedMockLog` overwhelmed logs during crashes by providing better filtering strategies and user guidance on writing expectations to accommodate logging.

## 5. Miscellaneous Fixes and Usability Enhancements

- **Warning for Mocking Non-Virtual or Static Methods**: Reinforced documentation and validation to avoid misusing mocks on non-virtual functions or global/static functions; recommended interface-based designs for improved testability.

- **Clarified Usage for Function Argument Deletion and Side Effects**: Ensured that actions like `DeleteArg<N>()` and chaining side effects with `DoAll()` work reliably and produce expected behaviors.

- **Improved Diagnostic Output Control**: Fine-tuned the `--gmock_verbose` flag handling to produce cleaner logs based on verbosity level, aiding developers in diagnosing mock failures without noise.

- **Documentation Accuracy and Guidance Improvements**: Refined documentation around legacy macros, recommendation of modern `MOCK_METHOD` use, and configuration tips to ease the migration from older codebases.

---

## Troubleshooting Tips

- If mock methods are unexpectedly invoking real implementations, verify that they are declared `virtual` and correctly mocked with `MOCK_METHOD`.

- Use `--gmock_verbose=info` to obtain a detailed trace of mock calls and expectations to debug failures related to unmet or unexpected expectations.

- Suppress uninteresting call warnings by using `NiceMock<T>` or explicitly set broad `EXPECT_CALL` expectations with `Times(AnyNumber())` on those methods.

- When mocking methods with move-only arguments or return types, leverage lambda expressions or callable objects instead of raw `Return()` with move-only values.

- For multithreaded tests, ensure all test and mock setup/verification code runs in a single thread, and only mock method calls may happen in multiple threads.

- To test destructor timing and order, implement a mock method called from the destructor and set expectations for it.

---

## Example Snippet: Handling Destructor Mocks

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};

// Usage
{
  InSequence seq;
  EXPECT_CALL(bar, A());
  EXPECT_CALL(foo, Die());
  EXPECT_CALL(bar, B());
}
```

This approach replaces mocking the destructor with a mock method called from it, allowing verification of destruction sequence.

---

## Additional Resources

- [Defining Mock Methods and Classes](../api-reference/core-mocking-api/mock-methods-and-classes.md)
- [Setting Call Expectations and Cardinalities](../api-reference/core-mocking-api/call-expectations-and-cardinalities.md)
- [Mock Behavior with Actions](../api-reference/core-mocking-api/mock-behavior-actions.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Legacy gMock FAQ](../docs/gmock_faq.md)


<Tip>
Ensure that all expectations are set before exercising mock objects to avoid undefined behavior and hard-to-debug errors.
</Tip>

<Warning>
When transitioning from `MOCK_METHODn` to `MOCK_METHOD`, carefully review constness and qualifiers of methods to maintain compatibility.
</Warning>

<Note>
Uninteresting calls can be silenced with `NiceMock` but remain failures under `StrictMock`. Choose the appropriate mock wrapper to balance test strictness.
</Note>

---

By keeping abreast of these resolved issues and recommendations, users can construct more robust, clear, and maintainable tests, resulting in reliable software testing workflows.
