---
title: "New Features & Improvements"
description: "Catalogs all new functionality and enhancements added in each release, with concise summaries and pointers to the affected files or interfaces."
---

# New Features & Improvements in GoogleTest & GoogleMock

This documentation catalogs all significant new functionality and enhancements added to GoogleTest and GoogleMock in recent releases, with concise summaries and clear pointers to the relevant files or interfaces. It is focused on helping users understand what has been introduced, how the new features improve their testing workflows, and where to find detailed information.

---

## 1. Enhanced Mock Method Declaration and Qualifiers

GoogleMock introduces improvements to the **`MOCK_METHOD`** macro allowing precise mocking of C++ interfaces with complex signatures, including:

- Support for method qualifiers such as `const`, `override`, `noexcept`, and call types (e.g., `Calltype(STDMETHODCALLTYPE)`) allowing accurate override of virtual and non-virtual methods.
- Easier handling of types containing commas (like `std::pair` or `std::map`) by requiring parentheses or type aliases.
- Support to mock overloaded functions and const-overloaded methods with explicit qualifiers.
- Facilitates mocking of class templates seamlessly with consistent syntax.

This enhancement improves test expressiveness and safety by ensuring compatibility with modern C++ features and idioms.

## 2. Granular Control Over Expectations and Actions

Users can now leverage advanced chaining in `EXPECT_CALL` and `ON_CALL` macros to finely specify:

- **Argument matching:** through flexible matchers, including tuple-based multi-argument matching with `.With()` clauses.
- **Call cardinalities:** such as exact (`Exactly(n)`), at least, at most, and between, with support for inferring cardinalities based on `WillOnce()` and `WillRepeatedly()` clauses.
- **Ordering:** using `InSequence()` for strict order enforcement and `After()` clauses for partial order dependencies between expectations.
- **Automatic expectation retirement:** via `.RetiresOnSaturation()` to deactivate expectations immediately after their upper bound is reached, mitigating test flakiness.

These capabilities allow developers to write precise, maintainable, and robust tests aligned closely with their code's interaction contracts.

## 3. Improved Support for Default and Custom Actions

GoogleMock now better supports the definition and chaining of mock method behaviors:

- Default actions per method can be set using `ON_CALL` combined with `WillByDefault()`.
- Multiple actions in sequence for `EXPECT_CALL`, with separate handlers for `WillOnce()` and `WillRepeatedly()`, allow returning different values or simulating different behaviors over the invocation lifecycle.
- Users can implement complex action sequences using built-in interfaces or lambdas, supporting stateful behaviors, side effects, and invocation of external callbacks.
- Special support for return-by-reference with `ReturnRef()` and live-value returning using `ReturnPointee()`.

This flexibility enhances fidelity in simulation and validation of function calls in unit tests.

## 4. Advanced Matchers and Custom Matcher Construction

GoogleMock's matcher system sees key improvements:

- Polymorphic and monomorphic matcher support allowing reuse and adaptable matching for diverse argument types.
- Macros (`MATCHER`, `MATCHER_P`, `MATCHER_P2`, etc.) enable rapid definition of custom matchers with expressive failure messages.
- Support for composite matchers combining multiple sub-matchers with logical operators like `AllOf()`, `AnyOf()`, and negation.
- Facilities to safely cast and disambiguate matchers when dealing with type conversions or overloaded methods.
- Specialized matchers such as `Field()`, `Property()`, and `Pointee()` provide targeting of specific member variables or pointer targets.

These extensions enable users to validate complex parameter states with clarity and precision.

## 5. Better Handling of Move-Only Types and Modern C++ Features

Mocking methods involving move-only types (`std::unique_ptr`, etc.) is fully supported with the familiar `MOCK_METHOD` syntax.

- Users can return move-only values by specifying lambdas or callable types in `WillOnce()` or `WillRepeatedly()`.
- Input move-only arguments are accepted without complicated workarounds, improving test clarity.
- Legacy patterns for move-only arguments are discouraged in favor of direct syntax.

Support for C++17 and beyond ensures compatibility with modern compilers and language features.

## 6. Thread Safety and Concurrent Mock Usage

GoogleMock enhancements ensure safety and usability in multi-threaded environments:

- Internal locking and synchronization enable safe concurrent calls on mock objects.
- Tests can expect actions and behaviors to occur safely across multiple threads without manual locking.
- Examples and stress tests demonstrate correct concurrent usage.

These improvements empower users to write robust tests for parallel or asynchronous code.

## 7. Enhanced Logging, Verification, and Diagnostic Output

- The verbosity level of mock call logging can be controlled with `--gmock_verbose` flags (`info`, `warning`, `error`), allowing richer diagnostics or quieter output as needed.
- Detailed messages explain unmatched expectations, argument mismatches, excessive calls, and retired expectations with clear failure reports.
- Integration with GoogleTest enables clickable error output in editors like Emacs.
- Automatic verification of expectations occurs on mock destruction with options for manual verification and resetting.

Improved diagnostics accelerate test debugging and maintenance.

## 8. Utilities and Helper Classes to Boost Productivity

- `NiceMock`, `StrictMock`, and `NaggyMock` templates allow users to control the severity of uninteresting call warnings on a per-mock basis.
- `Sequence` and `InSequence` classes ease specification of call order constraints.
- `MockFunction` supports mocking of `std::function` callables with arbitrary signatures.
- Support for delegating calls to real or fake objects simplifies incremental test development.
- Facilities for saving and inspecting argument values (`SaveArg<>`) empower more nuanced validations.

These utilities help manage evolving test suites and complex test requirements.

---

## Selected References

- [Mock Method Declaration (`MOCK_METHOD`)](/api-reference/mocking-framework/mock-methods)
- [Setting Expectations (`EXPECT_CALL` and `ON_CALL`)](/api-reference/mocking-framework/setting-expectations)
- [Custom Matchers and Actions](/api-reference/matchers-actions-utilities/custom-matchers-actions)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)

---

### Practical Example: Defining a Const Mock Method with Expectations

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Usage in test
TEST(DrawingTest, PenMoves) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(1);
  EXPECT_CALL(turtle, GetX()).WillRepeatedly(testing::Return(42));

  // Code under test uses turtle...
}
```

### Typical Usage Flow

1. Create mock object and define default behaviors using `ON_CALL`.
2. Set expectations with `EXPECT_CALL` for methods under test.
3. Exercise the code that utilizes mocks.
4. On test exit, mocks automatically validate that expectations are met.

### Best Practice Tips

- Use `NiceMock` if you want to suppress warnings about uninteresting calls.
- Set expectations before exercising test code for consistent behavior.
- Use sequence constraints to verify call order when order matters.
- Define custom matchers to validate complex argument structures cleanly.

---

This changelog entry intends to keep users informed about new capabilities, providing practical insights and links to further documentation to master the evolution of GoogleTest and GoogleMock's mocking and testing facilities.