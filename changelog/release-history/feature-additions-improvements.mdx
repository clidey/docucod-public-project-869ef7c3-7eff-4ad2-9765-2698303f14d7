---
title: "Feature Additions & Improvements"
description: "Highlights major new features, usability enhancements, and broadened platform support in each release. Users will discover how these updates improve testing productivity and what new capabilities are available."
---

# Feature Additions & Improvements

This page highlights significant feature additions, usability enhancements, and expanded platform support introduced in each release of GoogleTest and GoogleMock. Users can explore how these updates enhance testing productivity and unlock new capabilities, focusing specifically on mock object creation and expectation management improvements.

---

## Recent Feature Highlights

### Enhanced Mocking Syntax and Flexibility
- **MOCK_METHOD macro enhancements** enable effortless mocking of virtual methods, including those with complex argument types such as templates, references, const and noexcept qualifiers, and Windows-specific calling conventions (`Calltype`). This streamlines mock class creation, letting users mock even complex or overloaded methods naturally.

- **Improved handling of argument types containing commas** now allows users to mock functions with arguments like `std::pair` or `std::map` without compilation errors by wrapping such types in parentheses or using type aliases.

- **Support for mocking of non-virtual methods and free functions** offers users alternatives to retrofit legacy code or to employ high-performance dependency injection techniques, making the framework usable in constrained scenarios.


### Better Expectation Management
- **`EXPECT_CALL` and `ON_CALL` macros provide clear semantics** for setting explicit call expectations and default mock behaviors, respectively. The addition of chainable clauses such as `With`, `Times`, `After`, `InSequence`, `WillOnce`, `WillRepeatedly`, and `RetiresOnSaturation` enables precise control over calls, sequences, and call ordering.

- **Cardinality inference** reduces boilerplate by automatically determining how many times a method is expected to be called based on the usage of `WillOnce` and `WillRepeatedly` without an explicit `Times()` clause.

- **Sequence and partial ordering support** allows users to impose strict or partial call sequences using `InSequence` objects and `After` clauses, enabling verification of complex interaction patterns involving multiple mock methods.

- **Enhanced error messages and verbosity control** improve developer experience with clear diagnostic output during test failures, uninteresting or unexpected call warnings, and optional stack trace access controlled via the `--gmock_verbose` flag.


### Mock Object Strictness and Usability Improvements
- **Availability of `NiceMock`, `NaggyMock`, and `StrictMock` wrappers** to manage uninteresting calls with differing strictness levels, assisting users in balancing between test resiliency and strictness.

- **Support for delegating calls** to *fake* or *real objects* within mocks allows combining interaction verification with real behavior, helping tests stay relevant and easier to maintain.

- **Support for move-only types**, like `std::unique_ptr`, enables mocking of APIs using modern C++ idioms without complicated workarounds.

- **New utilities like `MockFunction`** simplify mocking of `std::function` objects, facilitating testing code bases that use callbacks heavily.


### Usability and Performance Enhancements
- **Advanced matchers and actions**, including combinators, predicates, and conveniences to simplify argument matching and action specification.

- **Compilation performance tips**, such as moving mock class constructor and destructor out of headers, to mitigate slow builds in large mock classes.

- **Thread-safety improvements and guidelines** allow safe mock usage in multithreaded contexts, including using global locks internally for expectations and default actions while letting actions run in caller threads.

- **Test tooling integrations**, such as enhanced support for Emacs users with source navigation to failures, further ease test development and debugging.


## Practical Usage Tips

<AccordionGroup title="Setting Up and Using Mock Methods">
<Accordion title="Defining Mock Methods">
Mock methods must be declared in the `public:` section of the mock class even if the overridden methods are protected or private in the base class. This allows proper accessibility of mock expectations and behaviors.

Use the `MOCK_METHOD` macro with parameters representing return type, method name, argument list, and optional qualifiers `(const, override, noexcept, Calltype(...), ref(...))` to precisely declare mocked functions.

Wrap complex argument types containing commas using parentheses or type aliases to avoid parsing errors.
</Accordion>
<Accordion title="Setting Expectations with EXPECT_CALL">
Use `EXPECT_CALL` to assert how mock methods are called. Specify argument matchers to focus on relevant parameters; use `_` as a wildcard matcher when arguments don't matter.

Chain together clauses to:
- Control call counts with `.Times()` (or rely on inference from `.WillOnce()` and `.WillRepeatedly()`).
- Specify call order with `.InSequence()` or `.After()`.
- Define call behavior with `.WillOnce()`, `.WillRepeatedly()`.
- Retire expectations automatically using `.RetiresOnSaturation()` to avoid upper bound violations.

Avoid over-specifying to keep tests robust and maintainable.
</Accordion>
<Accordion title="Defining Default Behavior with ON_CALL">
`ON_CALL` sets the default behavior of mock methods without asserting that they must be called. Use it to provide sensible method behaviors for uninteresting calls in your test suite.

Similar to `EXPECT_CALL`, `ON_CALL` supports `.With()` and `.WillByDefault()` clauses.

Use `ON_CALL` primarily in test setups or fixtures to establish common mock behaviors.
</Accordion>
</AccordionGroup>

<AccordionGroup title="Managing Mock Strictness and Call Verification">
<Accordion title="Using NiceMock, NaggyMock, and StrictMock">
`NiceMock<T>` suppresses warnings for uninteresting calls.

`NaggyMock<T>` (the default) warns on uninteresting calls.

`StrictMock<T>` treats uninteresting calls as test failures.

Choose mock strictness based on your tolerance for false positives, test brittleness, and debugging needs.
</Accordion>
<Accordion title="Controlling Call Ordering">
Group related expectations in sequences using `InSequence` to ensure calls happen in the required order.

Use `After` clauses for expressing complex partial orderings and prerequisites between calls.

This ensures interaction correctness in complex test scenarios while avoiding overly rigid ordering constraints.
</Accordion>
<Accordion title="Timeouts, RetiresOnSaturation, and Sticky Expectations">
By default, expectations remain *sticky*, meaning they can continue to match and accept calls even after their upper bounds are reached.

Use `.RetiresOnSaturation()` to have expectations automatically retire once their call limits are reached, preventing unintended match conflicts.

This is especially useful when expectations follow a strict order or when multiple similar calls are expected sequentially.
</Accordion>
</AccordionGroup>

<AccordionGroup title="Advanced Mocking Patterns and Extensibility">
<Accordion title="Delegating to Real or Fake Objects">
Mocks can delegate calls to real or fake implementations, combining interaction verification with realistic behavior.

Use custom `ON_CALL` and `EXPECT_CALL` actions invoking real/fake object methods.

This approach reduces duplication and improves test fidelity.
</Accordion>
<Accordion title="Custom Matchers and Actions">
Use `MATCHER`, `MATCHER_P*`, `ACTION`, and related macros to create custom matchers and actions tailored to your domain logic.

Custom matchers allow expressive argument validation beyond built-ins.

Custom actions define complex behaviors on mock calls, including side effects.
</Accordion>
<Accordion title="Support for Move-Only Types">
Mock methods which accept or return move-only types, such as `std::unique_ptr`, are supported.

Define mock methods using usual `MOCK_METHOD` macros and set actions with lambdas to return new instances.

Legacy workarounds for move-only parameters are no longer necessary.
</Accordion>
</AccordionGroup>

## Troubleshooting and Best Practices

<Tip>
If an unexpected call or uninteresting call warning occurs, increase output verbosity with `--gmock_verbose=info` to see detailed call traces.
</Tip>

<Tip>
Always set expectations (`EXPECT_CALL`) before exercising code using the mocks to avoid undefined behavior.
</Tip>

<Tip>
To avoid slow compilation from complex mocks, define constructor and destructor of mock classes out of class body into `.cc` file implementation.
</Tip>

<Warning>
Avoid mocking classes you don't own; preferably mock interfaces you control to maintain stability and control over test impact.
</Warning>

<Check>
Verify all expectations at the end of tests. Optionally call `Mock::VerifyAndClearExpectations()` if mock object lifetime exceeds test scope.
</Check>

## Common Example

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int Bar(int x) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x), (override));
};

TEST(FooTest, BarReturnsExpectedValues) {
  MockFoo mock_foo;

  EXPECT_CALL(mock_foo, Bar(::testing::Gt(0)))
      .WillRepeatedly(::testing::Return(42));

  EXPECT_EQ(mock_foo.Bar(5), 42);
}
```

This simple test demonstrates creating a mock class, setting an expectation with argument matcher, and verifying the mock behavior.

---

## Further Resources

- [Mocking Reference](docs/reference/mocking.md): Detailed description of mocking macros, classes, and scenario coverage.
- [gMock Cookbook](docs/gmock_cook_book.md): Practical recipes for creating mocks, writing expectations, and using advanced features.
- [gMock for Dummies](docs/gmock_for_dummies.md): Introductory walkthrough on mocking concepts and workflows.
- [Mock Strictness API](api-reference/mock-behavior-config/nice-naggy-strict-mock.mdx): Managing mock behavior regarding uninteresting calls.
- [Matchers API](api-reference/matchers-actions-cardinalities/argument-matchers.mdx): In-depth coverage of argument matchers available for expectations.
- [Actions API](api-reference/matchers-actions-cardinalities/actions-api.mdx): Comprehensive guide on specifying mock method actions.

---

Explore the navigation map under 'Feature Summary & Primary Workflows' for complementary pages covering mocking overview and advanced parameterized tests to broaden your understanding of testing with GoogleTest and GoogleMock.

---

*This documentation delivers user-facing feature enhancements and improvement narratives focused on mocking capabilities within GoogleTest and GoogleMock. It emphasizes empowering users with clearer, more flexible, and robust tooling for interaction-based testing workflows.*