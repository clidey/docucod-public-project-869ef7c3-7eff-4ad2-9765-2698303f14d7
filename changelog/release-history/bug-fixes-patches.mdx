---
title: "Bug Fixes and Patches"
description: "A focused view of recent bug fixes, security patches, and maintenance updates, helping teams assess stability or resolve issues more efficiently after upgrading."
---

# Bug Fixes and Patches

This document provides a focused summary of recent bug fixes, maintenance patches, and security updates related to GoogleTest and GoogleMock. Understanding these updates helps teams assess the stability of their test environments and resolve potential issues efficiently after upgrading.

---

## 1. Mocking Macros and Syntax Fixes

- **MOCK_METHOD parsing of complex argument types**: Fixed compilation failures caused by commas inside argument types without proper parentheses. Users should wrap return types or arguments that contain commas in additional parentheses or use type aliases to avoid parsing errors. For example:

```cpp
// Problematic:
MOCK_METHOD(std::pair<bool, int>, GetPair, ()); // Error due to comma

// Correct:
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
// Or with using declarations:
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

- **Mocking Private or Protected Methods**: Ensured that mock methods must be declared in the `public:` section of the mock class, regardless of access level in the base class. This enables `ON_CALL` and `EXPECT_CALL` to reference the mock functions without compilation errors or access issues.

- **Mocking Overloaded Methods**: Added clarity for mocking overloaded methods, especially const and non-const variants. Use `Const()` wrapper to disambiguate const methods, and use `using` declarations to bring unmocked overloads into scope to avoid hiding warnings.


## 2. EXPECT_CALL and ON_CALL Behavior Enhancements

- **Chaining and Ordering of Clauses in `EXPECT_CALL` and `ON_CALL`**: Improved run-time enforcement on the order and repetition of modifier clauses. For instance:
  - `.With()` clause can only appear once and must be the first clause.
  - `.Times()` can only appear once and must be before `.InSequence()`.
  - `.WillOnce()` clauses can appear multiple times but must precede `.WillRepeatedly()`.
  - `.RetiresOnSaturation()` can only appear once and must be last.

- **Default Actions and Expectations**:
  - Resolved ambiguities when default actions (`ON_CALL`) and expectations (`EXPECT_CALL`) coexist.
  - The last matching `ON_CALL` or `EXPECT_CALL` takes precedence.
  - Improved handling when no `ON_CALL` matches an invocation: the built-in default action is taken.

- **More informative diagnostics** for unexpected calls, excessive calls, retired expectations, and unsatisfied prerequisites.


## 3. Mock Object Lifecycle and Verification

- **VerifyAndClearExpectations and VerifyAndClear**: Fixed scenarios where verification of mock objects works correctly even when some or all mock methods have expectations or default actions. The functions return correct success status.

- **Support for multiple calls to VerifyAndClear and VerifyAndClearExpectations:**
  - The methods can be called repeatedly without side effects or failures.

- **AllowLeak usage fix:**
  - Mock::AllowLeak can be called before or after setting `ON_CALL` or `EXPECT_CALL`, ensuring mock lifetime control is robust.

- **Deleting mock within expectations or actions:**
  - Verified safe deletion of mock objects inside mock method actions without causing deadlocks or crashes.


## 4. Strictness Modifiers (NiceMock, NaggyMock, StrictMock)

- **Uninteresting Call Diagnostics:**
  - Suppressed or promoted warnings and failures accordingly based on whether a mock is nice, naggy, or strict.

- **Corrected print statements and stack trace visibility** under different `--gmock_verbose` levels (info, warning, error).

- **Warnings are now errors** by default when `--gmock_verbose=error` flag is used, improving test strictness.

- **Explicit use of NiceMock and StrictMock for suppressing or enforcing uninteresting call policies.**


## 5. Thread Safety and Multi-threading Fixes

- Ensured that mock function executions and actions happen on the thread invoking the mock.
- Added tests to verify thread-safe operation of mock objects, including verification correctness and event listener behavior under concurrent conditions.


## 6. Action and Matcher Improvements

- **Support for move-only types in mocked methods:**
  - Introduced patterns for mocking methods with move-only argument or return types.
  - Provided guidance and tested usage with `std::unique_ptr` arguments and return values.

- **Improved `WillOnce` and `WillRepeatedly` semantics:**
  - Allowed multiple `WillOnce` clauses followed by one `WillRepeatedly` clause in expectations.

- **Improved support for chaining actions with `DoAll()` and correct side-effect order.**

- **Enhanced predicate formatters and matchers:**
  - Better error messages with contextual information.
  - Support for multi-argument tuple matchers using `.With()` clause.


## 7. Output and Warning Messages

- Resolved issues with verbose output management for expectations and uninteresting calls.
- Added more helpful messages when expectations run out of specified actions.
- Improved output formatting for calls to void and non-void functions.


## 8. Common Pitfalls and Workarounds

- Clarified that commas in parameters require extra care in macro usage.
- Warned about pitfalls in streaming custom typesâ€”mocked functions should not print values unnecessarily internally.
- Added workarounds and notes for Microsoft Visual C++ warnings related to const qualifiers in parameters.
- Guidance provided on how to disable or suppress warnings for uninteresting calls properly.


## 9. Tests and Validation Enhancements

- Added numerous test cases validating:
  - Proper evaluation order of arguments in `EXPECT_CALL` and `ON_CALL`.
  - Ordering constraints and sequence behaviors with `InSequence` and `After` clauses.
  - Correct behavior of expectations when mocks are deleted early.
  - Correct handling of duplicate `EXPECT_CALL`s and multiple default actions.
  - Interaction between NiceMock, NaggyMock, and StrictMock under verbose output.


## Practical Implications for Users

- **Use `ON_CALL` for default behaviors and `EXPECT_CALL` to specify expectations explicitly.**
- **Wrap complex argument types containing commas in parentheses or use type aliasing.**
- **Mock methods must be declared in `public:` sections despite base class access levels.**
- **Disambiguate overloaded methods using `Const()` or `using` declarations when needed to avoid compiler warnings or errors.**
- **For uninteresting calls warnings, consider using `NiceMock` or set `EXPECT_CALL(...).Times(AnyNumber())` deliberately.**
- **Prefer `WillOnce` and `WillRepeatedly` chaining for flexible repeated behavior definitions.**
- **Control mock strictness via `NiceMock`, `NaggyMock`, and `StrictMock` to manage test failures and warnings.**
- **Leverage sequences and expectation sets to enforce call orders or partial orders gracefully.**
- **Use `Mock::VerifyAndClearExpectations` to verify mocks early in tests, especially when lifetime is uncertain.**
- **Take caution to avoid premature deletions or unsynchronized access to mocks in multi-threaded tests.**


---

For detailed documentation on mocking APIs, usage guidelines, and extension points, refer to:

- [GoogleTest Mocking Reference](reference/mocking.md)
- [gMock Cookbook](guides/real-world-integration/mock_cook_book)
- [Expectations and Actions](api_reference/mocking_and_matchers/expectations_and_actions.md)
- [Mock Object Creation](api_reference/mocking_and_matchers/mock_object_creation.md)
- [Strictness and Nice Mocks](api_reference/mocking_and_matchers/strictness_and_nice_mocks.md)
- [Argument Matching](api_reference/mocking_and_matchers/argument_matching.md)

For test output and assertion details, see:

- [Assertions Reference](reference/assertions.md)
- [Advanced GoogleTest Topics](docs/advanced.md)

For practical advice on test organization, mocking best practices, and troubleshooting:

- [Mocking Best Practices Guide](guides/scenarios-patterns/mocking-best-practices.md)
- [Quick Validation & Troubleshooting](getting_started/configuration_initial_success/quick_validation_troubleshooting.md)


---

<Tip>
Keeping up with these bug fixes and patches ensures your test suite remains reliable, maintainable, and compatible with modern C++ standards and compiler behaviors. Regularly migrating to the latest GoogleTest and GoogleMock versions is recommended for improved diagnostics, performance, and feature enhancements.
</Tip>
