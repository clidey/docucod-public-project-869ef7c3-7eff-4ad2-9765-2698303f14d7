---
title: "Feature Additions & Improvements"
description: "Lists significant enhancements and new features introduced in each release. Focused on user-facing changes such as new assertion macros, expanded mock support, and improved test parameterization."
---

# Feature Additions & Improvements

GoogleTest continues to evolve with a strong focus on expanding user capabilities and improving ease of use. This page highlights major feature enhancements introduced across releases, emphasizing new assertion macros, expanded mocking capabilities, and advanced test parameterization patterns. Each enhancement is designed to help you write clearer, more expressive tests and mock objects that capture complex behaviors while maintaining simplicity and readability.

---

## 1. Enhanced Mocking Syntax and Semantics

GoogleMockâ€™s mocking support receives continuous refinements to improve both the developer experience and robustness of test code.

### a. Flexible Mock Method Definitions with `MOCK_METHOD`
- Now supports mocking methods with arguments of incomplete types, provided a printer function is supplied.
- Supports mocking methods returning non-default-constructible objects, triggered through mandatory explicit return values, reducing silent test errors.
- Enables mocking overloaded methods and const-qualified methods with clearer disambiguation using `Const()` wrapper.
- Supports specifying calling conventions and reference qualifiers for compatibility with platform-specific ABI requirements.

### b. Intuitive Expectation Setting with `EXPECT_CALL` and `ON_CALL`
- You can chain clauses such as `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` with strong enforcement of correct ordering.
- `.With()` allows matching of all arguments collectively as tuples to express complex argument relationships.
- The system detects and warns on misuse such as repeated `.With()` or `.Times()` invocations, helping avoid test logic errors.
- Cardinality inference occurs automatically based on action clauses when `.Times()` is omitted, simplifying your test statements.

### c. Advanced Ordering Controls
- You can specify sequential call expectations using `InSequence` blocks or the `.InSequence()` clause to ensure strict invocation order.
- Partial orders can be expressed via `.After()` clauses with expectations or expectation sets, allowing DAGs of call sequences for flexible ordering.
- Expectations can retire automatically upon saturation, easing management of upper call boundaries without error.

### d. Support for Default and Explicit Actions
- Enables setting default behaviors with `ON_CALL(...)` combined with a mandatory `.WillByDefault()` action, which are overridden by matching `EXPECT_CALL()`.
- `EXPECT_CALL()` supports multiple `WillOnce()` clauses followed by an optional `WillRepeatedly()` clause, enabling stepwise and fallback behaviors in mocks.
- `EXPECT_CALL` automatically detects and warns about too many or too few actions relative to the cardinality.

### e. Controlling Mock Strictness and Verbosity
- Use `NiceMock<T>` to silence warnings about uninteresting calls and suppress noise.
- Use `StrictMock<T>` to treat uninteresting calls as test failures, enforcing stricter verification.
- Control message verbosity using `--gmock_verbose` flag with levels: `info`, `warning` (default), and `error`.
- Verbosity settings influence the printing of argument values, return results, and stack traces for expected and uninteresting calls.

### f. Verification and Lifecycle Utilities
- `Mock::VerifyAndClearExpectations()` allows manual verification and clearing of expectations before destruction.
- `Mock::VerifyAndClear()` clears both expectations and default actions, giving test writers flexibility in managing mock states.
- `Mock::AllowLeak()` marks mock objects to prevent their leak from generating test failures.
- Verified compatibility of these utilities with mocks having some or all methods configured.

### g. Edge Case and Concurrency Handling
- Properly handle mock method calls after associated mocks in pre-requisite call sequences have been deleted.
- Supports deletion of mock objects inside mock method actions safely, avoiding deadlocks.
- Mock method actions can invoke other mock methods, including recursive invocations, ensuring concurrency safety.

---

## 2. New and Improved Assertion Macros

GoogleTest adds new assertion macros and refines existing ones to give richer failure information and improve usability.

- Support for assertions that check complex predicates with detailed match failure explanations.
- Distinguished fatal and non-fatal assertion macros to control test flow appropriately.
- Enhanced matcher integration allowing users to write precise and readable test expectations.
- Expanded support for polymorphic and parameterized matchers with concise declarations.

---

## 3. Advanced Parameterized and Typed Test Support

To facilitate scalable tests executed over multiple data sets and type variations, the framework adds:

- Simplified mechanisms to define value-parameterized tests with `TEST_P` and instantiate them with various parameter generators.
- Typed tests and type-parameterized test suites with `TYPED_TEST_SUITE` and `TYPED_TEST` macros.
- Enhanced support for custom naming schemes, instantiation patterns, and better integration with test reporting.

---

## 4. Expanded Actions and Customizations

Users can create sophisticated mock behavior flows using:

- Templates for defining custom actions with explicit template parameters supporting complex parameter passing.
- Built-in combinators like `DoAll()` to sequence multiple actions while correctly managing return values.
- Invocation of callable function arguments (`InvokeArgument<N>`) with passed parameters, supporting by-reference arguments via `std::ref()`.
- Ability to ignore return values via `IgnoreResult()` where necessary.
- Facilities for manipulating arguments on the fly; setting pointee values, saving arguments for verification, and deleting pointer arguments.

---

## 5. Examples and Best Practices

To maximize effectiveness:

- Use `ON_CALL` for specifying default mock behaviors without setting expectations.
- Use `EXPECT_CALL` sparingly and meaningfully to verify key interactions with precise call counts and argument constraints.
- For ordered calls, group `EXPECT_CALL`s inside `InSequence` blocks or use `.InSequence()` and `.After()` clauses.
- Use `RetiresOnSaturation()` to avoid over-saturation errors on reused expectations.
- Control verbosity for desired debugging output without noise using `--gmock_verbose` pragmatically.
- When dealing with move-only types, prefer lambda actions or move-only aware constructs.
- Handle complex argument lists by creating simpler mock interfaces or redispatch methods for easier mocking.

---

## 6. Troubleshooting Common Pitfalls

- Always declare mock methods in the `public:` section, even if the base class methods are `protected` or `private`.
- Provide explicit overload disambiguation using `Const()` or casting where mock method overloading causes ambiguity.
- Beware of sticky expectations; use `RetiresOnSaturation()` or explicit sequences to ensure expectations expire as intended.
- Avoid setting new expectations after the mock has been exercised or verified.
- If a default action is not set, unexpected calls may return zero or cause test assertions; use `ON_CALL` to define sensible defaults.
- Address any warnings or errors flagged by the mock framework to ensure stable and maintainable test suites.

---

## 7. Getting Help and Additional Resources

Complement this documentation with deeper dives into:
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for comprehensive API details.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for practical recipes.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick syntax references.
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) for troubleshooting.

---

# Examples

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(int, GetSize, (), (const));
  MOCK_METHOD(bool, Process, (int count), ());
};

TEST(FooTest, Example) {
  MockFoo foo;
  ON_CALL(foo, GetSize()).WillByDefault(::testing::Return(42));
  EXPECT_CALL(foo, Process(::testing::_)).Times(3).WillRepeatedly(::testing::Return(true));

  EXPECT_EQ(42, foo.GetSize());
  for (int i = 0; i < 3; i++) {
    EXPECT_TRUE(foo.Process(i));
  }
}
```

---

```cpp
using ::testing::InSequence;

TEST(FooTest, OrderedCalls) {
  MockFoo foo;
  {
    InSequence seq;
    EXPECT_CALL(foo, Process(1));
    EXPECT_CALL(foo, Process(2));
  }

  foo.Process(1);
  foo.Process(2);
}
```

---

```cpp
// Custom action that sets argument N to 5
EXPECT_CALL(foo, DoSomething(::testing::_))
    .WillOnce(::testing::DoAll(::testing::SetArgPointee<0>(5), ::testing::Return(true)));
```

---

For more details and the latest updates, always refer to the official GoogleTest and GoogleMock documentation.

<Source url="https://github.com/google/googletest" branch="main" paths={[{path: "googlemock/include/gmock/gmock.h", range: "1-84"}, {path: "googlemock/test/gmock-spec-builders_test.cc", range: "1-685"}, {path: "docs/gmock_cheat_sheet.md", range: "1-539"}, {path: "docs/gmock_cook_book.md", range: "1-657"}, {path: "docs/reference/actions.md", range: "1-116"}, {path: "docs/reference/mocking.md", range: "1-182"}]} />