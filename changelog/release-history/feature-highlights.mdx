---
title: "New Features & Enhancements"
description: "Showcases the most relevant new features and improvements in each release, allowing users to discover new capabilities and better utilize the framework in their tests. Each feature links back to its main documentation and contextual source file."
---

# New Features & Enhancements

This page highlights the most significant new features and improvements introduced in recent releases of GoogleTest and GoogleMock, focusing specifically on mocking functionality and expectation specifications. Each feature is framed in terms of how it benefits your test writing and maintenance, helping you write clearer, more robust, and flexible tests. For convenience, links to the main documentation and relevant source code are provided to deepen your understanding.

---

## 1. Enhanced Mock Method Specification (`MOCK_METHOD` Macro Extensions)

GoogleMock's core mocking macro, `MOCK_METHOD`, has been enhanced to better support modern C++ features and improve test expressiveness:

- **Full Support for Method Qualifiers:** You can now specify qualifiers such as `const`, `override`, `noexcept`, and calling conventions via `(const, override)`, `(Calltype(...))`, allowing mocks to precisely match virtual methods in your code.

- **Improved Handling of Complex Argument and Return Types:** To address parsing issues with types involving commas (e.g., `std::pair<bool, int>`), you can now wrap argument or return types in an extra set of parentheses or use type aliases, enabling seamless mocking of templated or compound types.

- **Mocking Overloaded and Template Methods:** The macro fully supports mocking overloaded functions and class templates without additional boilerplate, allowing you to mock any virtual method accurately.

Example:
```cpp
class MockFoo {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  MOCK_METHOD(void, Resume, (), (override));
  MOCK_METHOD(int, Add, (int x), (const, override));
};
```

For full syntax and details, see the [Mocking Reference: MOCK_METHOD](docs/reference/mocking.md#MOCK_METHOD).

---

## 2. Flexible Expectation Setting with `EXPECT_CALL`

GoogleMock continues to empower you with fine-grained control over mock behavior and expectations through the `EXPECT_CALL` macro enhancements:

- **Chainable Clauses for Expectation Customization:** You can specify call cardinality with `.Times()`, sequence with `.InSequence()`, dependencies with `.After()`, and detailed behavior using `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`.

- **Support for Multi-argument Matchers via `.With()` Clause:** This allows expectations to be defined over the entire argument tuple, enabling complex inter-argument relationships.

- **Expectation Sequences and Partial Orderings:** Use `Sequence` objects to express strict or partial ordering of calls, improving test expressiveness for workflows where call order matters.

- **Smart Action Inference:** Cardinalities can be inferred based on specified actions, saving developers from repetitive specification.

Example of ordered expectations with varying return values:
```cpp
Sequence s;
EXPECT_CALL(mock, Method(5))
    .WillOnce(Return(10))
    .WillRepeatedly(Return(20));
EXPECT_CALL(mock, AnotherMethod())
    .InSequence(s)
    .Times(AtLeast(1));
```

See [Mocking Reference: EXPECT_CALL](docs/reference/mocking.md#EXPECT_CALL) and the extensive tests and usage examples in `googlemock/test/gmock-spec-builders_test.cc`.

---

## 3. Improved Default Behavior Specification Using `ON_CALL`

- **Defining Default Actions:** `ON_CALL` now supports `.With()` and `.WillByDefault()` clauses in a structured and enforced order, enabling you to set default behavior for mock methods without setting strict expectations.

- **Support For Multi-argument Matchers:** Default actions can be conditioned on combined argument tuples.

- **Separation of Concerns:** `ON_CALL` specifies default behavior without asserting that the call must happen, letting you keep tests flexible and descriptive.

Example:
```cpp
ON_CALL(mock, SetValue(_, _))
    .WillByDefault(Return(true));
```

Refer to the [Mocking Reference: ON_CALL](docs/reference/mocking.md#ON_CALL).

---

## 4. Standardized Handling of Mock Strictness and Call Warning Levels

- **NiceMock, NaggyMock, and StrictMock Types:** Wrappers for mock objects that respectively suppress warnings on uninteresting calls, print warnings, or treat uninteresting calls as errors, allowing you to control test strictness per mock.

- **Verbosity Control:** Fine control over runtime verbosity using the `--gmock_verbose=` flag (`info`, `warning`, and `error`), enabling detailed call trace logging for debugging or silent operation in CI.

- **Comprehensive Messaging for Unexpected, Excessive, and Uninteresting Calls:** Informative messages guide users to diagnose call mismatches and misconfigurations effectively.

Example:
```cpp
// Suppress warnings on uninteresting calls.
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoSomething());
```

See the [gMock Cookbook: The Nice, the Strict, and the Naggy](docs/gmock_cook_book.md#NiceStrictNaggy) and the test coverage in `googlemock/test/gmock_output_test_.cc`.

---

## 5. Action and Matcher Richness and Composability

- **Built-in Actions and Utilities:** Extensive default actions like `Return()`, `SetArgPointee()`, `Invoke()`, `DoAll()`, and `InvokeArgument<N>()` provide flexibility for simulating diverse method behaviors and side-effects.

- **Custom Actions and Matchers:** Support for defining matchers (`MATCHER`, `MATCHER_P`) and actions (`ACTION`, `ACTION_P`) with detailed failure messages; composable matchers and actions allow precise argument checking and response specification.

- **Partial and Complete Ordering of Expectations:** Use `InSequence`, `After`, and explicit sequences to encode call order logic.

- **Support for Move-only Types:** Mocking of methods with move-only arguments and return types is supported; strategies for safe handling including advice on using lambdas.

Example custom matcher:
```cpp
MATCHER_P(IsDivisibleBy, divisor, "") {
  return (arg % divisor) == 0;
}
EXPECT_CALL(mock, Foo(IsDivisibleBy(7)));
```

See [gMock Cookbook: Custom Actions and Matchers](docs/gmock_cook_book.md#NewMatchers) and [Actions Reference](docs/reference/actions.md).

---

## 6. Facilities for Managing Mock Lifecycle and Verification

- **Automatic Verification:** Expectations on mocks are verified automatically upon mock object destruction, with detailed messages.

- **Explicit Verification and Clearing:** `Mock::VerifyAndClearExpectations()` and `Mock::VerifyAndClear()` functions allow test authors to verify expectations and reset mocks at explicit points in the test.

- **Leak Detection and Suppression:** GoogleMock tracks mock object usage and warns of leaked mocks. `Mock::AllowLeak()` lets you suppress these warnings when intentional.

Example:
```cpp
MockFoo foo;
EXPECT_CALL(foo, DoSomething());
foo.DoSomething();
Mock::VerifyAndClearExpectations(&foo);
```

Refer to [Mocking Reference: Mock](docs/reference/mocking.md#classes) and implementation in `googlemock/src/gmock-spec-builders.cc`.

---

## 7. Integration with Test Framework and Toolchains

- GoogleMock is seamlessly integrated with GoogleTest, providing consistent assertion and failure reports.

- The mocking framework ensures thread-safety of mock calls and internal synchronization.

- Advanced control over compilation performance by recommending construction and destruction implementation in `.cc` files.

- Handles challenges with platform-specific calling conventions and macros through adaptable macro expansions.

See the [GoogleTest Primer](overview/getting-started-with-googletest/what-is-googletest), and the integration portions of `docs/gmock_cook_book.md`.

---

## Recommended Next Steps

- Dive into detailed guides on [Creating and Using Mock Objects](guides/mocking-best-practices/creating-mocks) and [Defining and Verifying Expectations](guides/mocking-best-practices/defining-expectations) for deeper practical knowledge.

- Leverage the [gMock Cookbook](docs/gmock_cook_book.md) for practical recipes solving common mocking scenarios.

- Explore the source files `googlemock/test/gmock_output_test_.cc` and `googlemock/test/gmock-spec-builders_test.cc` for comprehensive test cases demonstrating the features.

- Use the `--gmock_verbose=info` flag to gain full visibility into mock call matching when debugging intricate test failures.

---

## Source Code Reference

- Spec Builder Syntax Implementation: [googlemock/include/gmock/gmock-spec-builders.h](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-spec-builders.h)
- Spec Builder Tests: [googlemock/test/gmock-spec-builders_test.cc](https://github.com/google/googletest/blob/main/googlemock/test/gmock-spec-builders_test.cc)
- Output Tests: [googlemock/test/gmock_output_test_.cc](https://github.com/google/googletest/blob/main/googlemock/test/gmock_output_test_.cc)
- Spec Builder Implementation: [googlemock/src/gmock-spec-builders.cc](https://github.com/google/googletest/blob/main/googlemock/src/gmock-spec-builders.cc)

---

For full documentation on related topics, please browse the [GoogleTest Documentation Site](https://github.com/google/googletest/tree/main/docs) or navigate through the [API Reference](api-reference/mocking-framework/mock-methods.md), [Mocking Reference](docs/reference/mocking.md), or the [gMock Cookbook](docs/gmock_cook_book.md).