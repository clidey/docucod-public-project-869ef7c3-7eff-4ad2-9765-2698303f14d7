---
title: "Notable New Features & Enhancements"
description: "Spotlight on major new features, performance improvements, and usability enhancements introduced in recent releases. Guides users to the most impactful changes and encourages the adoption of new capabilities."
---

# Notable New Features & Enhancements

Welcome to the spotlight page focusing exclusively on the most impactful new features, significant performance improvements, and usability enhancements introduced in recent GoogleTest and GoogleMock releases. This page is designed to keep you informed about innovations that elevate your testing experience and encourage swift adoption of new capabilities.

---

## 1. Enhanced Mocking Behavior Control

### Introducing NiceMock, NaggyMock, and StrictMock Wrappers

The introduction of `NiceMock<T>`, `NaggyMock<T>`, and `StrictMock<T>` classes allows fine-grained control over how uninteresting calls (mock method calls without explicit expectations) are treated:

- **`NiceMock<T>` suppresses warnings** on uninteresting calls, helping reduce test noise without compromising verification.
- **`NaggyMock<T>` (default behavior)** issues warnings to alert you about uninteresting calls, allowing you to catch unexpected interactions.
- **`StrictMock<T>` treats uninteresting calls as errors**, enforcing the strictest expectation discipline to catch unwanted behavior instantly.

These wrappers inherit from your mock classes and seamlessly forward constructors, letting you substitute them effortlessly in place of the original mocks.

### Why This Matters

The wrappers empower you to decide the test strictness precisely where you need itâ€”enabling more maintainable, less noisy tests with `NiceMock`, while retaining the ability to enforce stringent checks with `StrictMock`.

<Info>
Using these wrappers strategically throughout your test suite allows you to balance robustness and flexibility, greatly improving test clarity and reducing brittle failures.
</Info>

## 2. Improved Expectation Syntax and Semantics

### More Expressive `EXPECT_CALL` and `ON_CALL`

Recent updates enhance the expressive power of `EXPECT_CALL` and `ON_CALL`:

- Support for specifying detailed argument matchers, including multi-argument tuple matching with `.With()`.
- Ability to chain multiple actions using `.WillOnce()` repeatedly and `.WillRepeatedly()` for fallback behaviors.
- Explicit cardinality specification with `.Times()`, including `AnyNumber()`, `AtLeast()`, `AtMost()`, and the ability to infer call counts from the actions specified.

Here's a typical usage demonstrating varied behaviors based on call order:

```cpp
using ::testing::Return;

EXPECT_CALL(mock_object, SomeMethod(_))
    .WillOnce(Return(10))     // first call returns 10
    .WillOnce(Return(20))     // second call returns 20
    .WillRepeatedly(Return(30));  // subsequent calls return 30
```

### Sequence Control for Order-sensitive Testing

GoogleMock enables you to define sequences to enforce call ordering:

```cpp
using ::testing::InSequence;

{
  InSequence s;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

This ensures `FirstCall()` happens before `SecondCall()`, improving test precision in scenarios where interaction order matters.

<Note>
Take advantage of `Sequence` objects and the `.After()` clause to specify complex partial orderings beyond simple sequential chains.
</Note>

## 3. More Robust Support for Complex and Overloaded Methods

### Handling Methods with Comma-containing Types

To help mock methods with return types or arguments that include commas (e.g., `std::pair`, STL containers), GoogleMock now gracefully supports:

- Parenthesizing types in `MOCK_METHOD`, e.g.,
  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
  ```
- Using type aliases to clarify code and overcome parsing limitations.

### Mocking Overloaded and Const Methods

GoogleMock supports mocking overloaded functions and methods with `const` qualifiers by requiring explicit use of `MOCK_METHOD` with qualifiers:

```cpp
MOCK_METHOD(int, GetValue, (), (const, override));  // mocks const method
MOCK_METHOD(int, GetValue, (int), (override));     // mocks non-const overload
```

Use the helper `Const()` wrapper to resolve overload disambiguation in expectations.

<Info>
These improvements avoid common compilation issues and simplify mocking more complex C++ interfaces.
</Info>

## 4. Extended Default Action Capabilities with `ON_CALL`

`ON_CALL` lets you set default behaviors for mock methods when no specific expectation is set. This is particularly useful to:

- Provide sensible defaults in your test fixtures.
- Reduce boilerplate when you are not interested in verifying every call.

Example:

```cpp
ON_CALL(mock_obj, Compute(_))
    .WillByDefault(Return(42));
```

The latest enhancements ensure better interaction between multiple `ON_CALL` and `EXPECT_CALL` definitions, respecting the precedence of last matching clauses.

<Check>
Use `ON_CALL` to specify broad default behavior and `EXPECT_CALL` to override this in specific tests where you care about the interaction.
</Check>

## 5. Better Diagnostic Messages and Verbosity Control

GoogleMock now offers enhanced verbosity levels via the `--gmock_verbose` flag:

- `info`: Most detailed output including stack traces at the point of mock method definition and calls.
- `warning`: Default, shows warnings and errors without verbose stack traces.
- `error`: Only errors are printed, minimizing output noise.

This lets you tailor the test output depending on your debugging needs.

### Rich Error and Warning Outputs

When mocks receive calls inconsistent with expectations, the error messages now include:

- Detailed descriptions of argument mismatches.
- Exact file and line numbers where expectations were declared.
- Whether expectations are retired, unsatisfied, or oversaturated.

These enhancements improve troubleshooting accuracy and reduce the time diagnosing failing tests.

<Note>
For transient issues or flaky tests, lowering verbosity to "error" temporarily can help isolate critical test failures.
</Note>

## 6. Support for Mocking Move-Only Types

C++11 move-only types (such as `std::unique_ptr`) are now supported in mock methods:

- You can define mock methods that accept and/or return move-only types using the same `MOCK_METHOD` syntax.
- For methods returning move-only types, use lambdas in `WillOnce` or `WillRepeatedly` clauses to create fresh instances on every call.

```cpp
EXPECT_CALL(mock, CreateUniquePtr(_))
    .WillRepeatedly([](int id) {
      return std::make_unique<Object>(id);
    });
```

This ensures your mocks work with modern C++ idioms, enabling better test code expressiveness.

## 7. Faster Compilation for Large Mock Classes

To mitigate the heavy compilation overhead caused by large mock classes:

- Moved mock class constructors and destructors can now be declared in headers but defined in .cc files.
- This reduces compilation times by avoiding repetitive constructor/destructor generation across translation units.

Example:

```cpp
class MockFoo {
 public:
  MockFoo();
  virtual ~MockFoo();

  MOCK_METHOD(void, Bar, (), (override));
};

// In mock_foo.cc
MockFoo::MockFoo() {}
MockFoo::~MockFoo() {}
```

Adopting this pattern is highly recommended for mock classes with many methods.

---

## Troubleshooting and Best Practices

### Avoiding Common Pitfalls

- **Make sure all virtual destructors are marked `virtual`.** Without this, mock objects may result in undefined behavior or memory leaks.
- **Do not set expectations after exercising the mocks.** Always declare `EXPECT_CALL` before the mock is used.
- **Use `_` matcher when you do not care about argument values** to keep tests less brittle.
- **Balance mock strictness:** Prefer `NiceMock` for less brittle tests, and `StrictMock` only when behavior exactness is critical.

### Practical Tips

- Use sequences or `.After()` clauses to clearly express expected call order when sequential or partial order matters.
- Suppress warning messages for uninteresting calls with `NiceMock` to reduce test output noise.
- Use `ON_CALL` to set sensible default behaviors, leaving `EXPECT_CALL` only for interactions you want to verify.
- Use verbosity flags to tune diagnostic output depending on your current debugging effort.

---

## Additional Resources

For further in-depth usage, recipes, and extended API references, consult:

- [Mocking Reference](../reference/mocking.md): Comprehensive details of mocking APIs.
- [gMock Cookbook](../gmock_cook_book.md): Recipes and best practices for various mocking scenarios.
- [gMock for Dummies](../gmock_for_dummies.md): Beginner-friendly introduction to mocking with GoogleMock.
- [Mock Method API](../api-reference/mocking-api/mock-methods.md): Syntax and examples for mock method declarations.
- [gMock Cheat Sheet](../gmock_cheat_sheet.md): Quick reference for common mocking constructs.

Use these to deepen your mastery and address advanced mocking needs effectively.

---

<Info>
This page highlights the key feature and usability updates for GoogleTest and GoogleMock. Familiarity with the basics of mock creation, expectations, and actions as detailed in the referenced guides is assumed.
</Info>
