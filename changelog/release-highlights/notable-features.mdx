---
title: "Notable Features and Improvements"
description: "Highlights of the most impactful new features and improvements introduced in recent releases. Each item includes guidance on when and how to use the new functionality, mapped directly to relevant subsystems."
---

# Notable Features and Improvements

This page highlights the most impactful new features and improvements introduced in recent releases of GoogleTest and GoogleMock. Each feature description is framed with user intent, guiding you on when and how to incorporate these enhancements into your testing workflows. The changes are mapped directly to relevant subsystems within the frameworks.

---

## 1. Enhanced Mocking Capabilities

GoogleMock, the mocking extension within GoogleTest, has received significant improvements focused on making mock definitions, expectations, and behaviors more expressive and easier to manage.

### 1.1 More Flexible Mock Method Definitions

- **Expanded `MOCK_METHOD` qualifiers:** You can now specify method qualifiers such as `const`, `override`, `noexcept`, calling convention (`Calltype(...)`), and reference qualifiers (`ref(...)`) within the macro. This allows more accurate mocking of complex C++ method signatures, including overloaded and templated methods.

#### When to use:
Use the extended `MOCK_METHOD` qualifiers when mocking methods that enforce these qualifiers to ensure your mocks behave correctly and type-safely.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Transform, (Gadget* g), (override, noexcept));
  MOCK_METHOD(int, GetValue, (), (const, override));
};
```

### 1.2 Improved Handling of Methods with Comma-containing Parameters

Mocking functions with complex parameter types, such as template types involving commas, now requires mindful wrapping with extra parentheses or type aliases to avoid macro parsing errors.

#### Tips:
- Wrap comma-containing types in an extra pair of parentheses.
- Use type aliases to reduce verbosity and ensure compiler compatibility.

```cpp
using MapIntDouble = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

### 1.3 NiceMock, NaggyMock, and StrictMock Enhancements

These specialized mock wrappers control how mocks respond to uninteresting calls:

- **`NiceMock`** suppresses warnings for uninteresting calls.
- **`NaggyMock`** issues warnings (the default behavior).
- **`StrictMock`** treats uninteresting calls as test failures.

This triad lets you control test verbosity and strictness, helping balance between noise and catching unintended calls.

#### Recommendation:
Use `NiceMock<T>` to reduce warnings during test development, employ `NaggyMock<T>` to stay informed, and apply `StrictMock<T>` when strict call validation is required.

---

## 2. Granular Expectation Control

GoogleMock's expectation APIs have been refined to provide granular control over mock behaviors and call sequences.

### 2.1 Chainable Expectation Clauses

The `EXPECT_CALL` macro supports sequenced, chained clauses to finely specify how the mock should behave:

- `.With()` applies multi-argument matchers.
- `.Times()` controls the number of expected calls.
- `.InSequence()` and `.After()` impose call ordering constraints.
- `.WillOnce()` and `.WillRepeatedly()` define differing behaviors for consecutive calls.
- `.RetiresOnSaturation()` retires expectations automatically on reaching call limits.

#### How to use:
Compose your expectations thoughtfully to express when and how your mock should react.
This ensures your tests are precise yet maintainable.

```cpp
EXPECT_CALL(mock_obj, Foo(_, _))
    .With(Lt())
    .Times(Exactly(3))
    .WillOnce(Return(true))
    .WillRepeatedly(Return(false));
```

### 2.2 Fine-Grained Call Ordering

- Create `Sequence` objects to express partial order dependencies between mock calls.
- Use `InSequence` block or clause to group ordered expectations.
- Use `After()` clause for explicit dependencies on other expectations.

#### Example:
```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Init()).InSequence(s1, s2);
EXPECT_CALL(mock, Start()).InSequence(s1);
EXPECT_CALL(mock, Finish()).InSequence(s2);
```
This asserts `Init()` runs before `Start()` and `Finish()`, with `Start()` before `Finish()`.

---

## 3. More Robust Matchers and Actions

GoogleMock introduces new ways to author matchers and combine actions, increasing expressiveness and ease of verification.

### 3.1 Expanded Matcher API

- Use built-in matchers for common scenarios including containers (`ElementsAre`, `UnorderedElementsAre`), pointer validation (`NotNull`, `Pointee`), and complex predicates (`Truly`).
- Define custom matchers easily with `MATCHER`, `MATCHER_P`, or polymorphic matcher classes for domain-specific validations.
- Employ `SafeMatcherCast` to correctly handle type conversions in matcher arguments.

#### Practical tip:
Use matchers to focus your test on **what** should be called, not **how** to call it, reducing brittle tests.

### 3.2 Action Composition and Custom Actions

- Combine actions using `DoAll()` to perform sequences such as modifying output parameters and returning values.
- Create custom actions via lambdas, functors, or macros (`ACTION` family), which integrate smoothly with mock methods.
- Support for move-only types such as `std::unique_ptr` improves modern C++ compatibility.

Example combining side effects with returns:

```cpp
EXPECT_CALL(mock, Mutate(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

---

## 4. Improved Fixture and Test Support

GoogleTest continues to enhance productivity around test suites and fixtures.

- Support for creating `TEST_F` with complex fixtures to reuse setup code and share common data configurations.
- Improved registration and execution of tests with `RUN_ALL_TESTS()` integrating all defined tests automatically.
- Guidance to prefer linking with `gtest_main` to avoid writing boilerplate `main()` functions.

### Best Practices:
- Use `TEST_F` fixtures when several tests share setup/teardown logic.
- Always check the return value of `RUN_ALL_TESTS()` to ensure proper test result reporting.

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## 5. Usability and Performance Improvements

- Thread safety improvements for assertions on supported platforms.
- Enhanced diagnostic output on test failures to help debugging.
- Support for controlling output verbosity via `--gmock_verbose` flag.

### Practical Tips:
- Use `--gmock_verbose=info` to gain deeper insight into mock invocation and matching.
- Suppress unnecessary warnings with `NiceMock` to maintain clear, actionable test output.
- Optimize test suites by sharing expensive fixtures and enabling parallel executions.

---

## 6. Noteworthy Breaking Changes and Deprecations

- Transition from the older `TestCase` terminology toward `TestSuite` to align with industry standards.
- Gradual deprecation of older `MOCK_METHODn` macros in favor of the new, unified `MOCK_METHOD` macro.

**Migration Note:**
Review existing tests for usage of deprecated macros and update using the new API to gain improved compatibility and future-proofing.

---

## Summary

This page curated the key impactful enhancements on GoogleTest and GoogleMock in recent releases. By leveraging the improved mocking macros, refined expectation controls, enhanced matcher and action flexibility, and optimized fixture usage, you will write clearer, more maintainable, and expressive tests that better capture your code's intended behavior.

For integration into your testing workflow, pay special attention to the chainable clauses in expectations, mock strictness controls, and the best practices around fixture reuse and test invocation.

---

## Additional Resources

- [GoogleTest Primer](primer.md) - Get started with writing tests
- [Mocking Reference](reference/mocking.md) - Detailed API for mocks
- [gMock Cookbook](gmock_cook_book.md) - Recipes for mocking scenarios
- [gMock Cheat Sheet](gmock_cheat_sheet.md) - Quick reference
- [Advanced Testing Patterns](guides/advanced-testing-patterns/mocking-workflows.md) - Advanced mock usage
- [Writing and Organizing Tests](api-reference/core-testing-apis/writing-tests.md) - Test structuring

These references expand on the topics summarized here, helping you transition from grasping core features to mastering advanced techniques.

---

## Troubleshooting Common Pain Points

- **Mock method macro parsing errors**: Remember to wrap argument types containing commas in an extra pair of parentheses or create type aliases.
- **Uninteresting call warnings**: Use `NiceMock` to suppress or define catch-all `EXPECT_CALL` to handle unexpected invocations gracefully.
- **Function overloading ambiguities**: Use the `Const()` wrapper or explicit cast matchers to resolve overload resolution.
- **Complex expectation ordering**: Leverage `Sequence` objects and `InSequence` blocks to clarify partial or full call order dependencies.

---

## Step-by-Step Example: Using New Mock Features

<Steps>
<Step title="Define a Mock Class with Qualified Methods">
Define mock methods using `MOCK_METHOD` with appropriate qualifiers for const, override, and noexcept as necessary.
</Step>
<Step title="Set Default Behaviors with ON_CALL">
Use `ON_CALL` to specify default mock behavior when you don't need to verify exact call counts.
</Step>
<Step title="Set Thorough Expectations with EXPECT_CALL">
Chain clauses like `.Times()`, `.InSequence()`, and `.WillOnce()` to define expected mock interactions clearly.
</Step>
<Step title="Control Mock Strictness">
Wrap mocks inside `NiceMock` or `StrictMock` depending on whether you want uninteresting calls warned about or fail the test.
</Step>
<Step title="Run All Tests Safely">
Use `RUN_ALL_TESTS()` in your test binary's `main()` function and check its return value to conform with best practices.
</Step>
</Steps>

---