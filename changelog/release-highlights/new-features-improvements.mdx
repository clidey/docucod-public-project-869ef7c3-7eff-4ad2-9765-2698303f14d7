---
title: "New Features & Improvements"
description: "Detailed breakdowns of newly introduced capabilities, enhancements in matchers, actions, or test runners, and noteworthy improvements in test usability or integration. Illustrates how the framework's functionality has expanded and offers advice for immediate benefit."
---

# New Features & Improvements

Detailed breakdowns of newly introduced capabilities, enhancements in matchers, actions, or test runners, and noteworthy improvements in test usability or integration. Illustrates how the framework's functionality has expanded and offers advice for immediate benefit.

---

## Overview

This page highlights the latest enhancements introduced in GoogleTest and GoogleMock. It focuses on the value these improvements bring to users by expanding testing capabilities, simplifying mocking syntax, and improving test reliability and maintainability.

Users will find clear guidance on new features, practical examples demonstrating their usage, and recommendations on how to integrate these improvements into their code bases.

---

## Mocking Enhancements

### Expanded `MOCK_METHOD` Coverage

- **Support for Complex Argument Types**: Improved handling of argument types containing commas by enforcing parentheses or using type aliases, ensuring smooth mock method declarations without compilation issues.

- **Extended Qualifier Support**: New and more flexible support for method qualifiers such as `const`, `override`, `noexcept`, `Calltype(...)`, and reference qualifiers (`ref(&)`, `ref(&&)`) to more precisely mock the targeted methods.

#### Example:
```cpp
class MyMock {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
```

### Improved Mock Class Usage

- **Public Mock Methods**: All mock methods must be declared in the public section to allow `ON_CALL` and `EXPECT_CALL` to properly reference and manage mock behaviors, regardless of original method access level.

- **Overloaded Method Mocking**: Seamless support for overloaded functions, including const and non-const variants, allowing distinct mocking without ambiguity.

- **Template Class Mocking**: Template classes can now be mocked similarly to regular classes, extending mocking support for generic code.

### Mocking Non-Virtual Methods

- Enables mocking non-virtual methods by declaring mock methods with the same signatures without inheritance from the real class and using compile-time type selection to swap real/ mock implementations.

### `ON_CALL` and `EXPECT_CALL` Behavior Improvements

- **Behavior Specification Decoupled from Expectations**: `ON_CALL` defines default method behavior without setting call expectations, promoting cleaner and more maintainable tests.

- **Flexible and Chainable Clauses**: Method behaviors and expectations can be controlled through a well-defined chain of clauses like `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()`, allowing precise control over mock calls.

---

## Mock Object Strictness Modes

GoogleMock introduces and refines three strictness wrappers to control uninteresting call handling:

- **NiceMock<T>**: Suppresses warnings on uninteresting calls, suitable when tests do not require strict enforcement.

- **NaggyMock<T>**: (Default behavior) Prints warnings on uninteresting calls, helpful for debugging unexpected interactions.

- **StrictMock<T>**: Treats uninteresting calls as test failures, enforcing rigorous test correctness.

### Practical Usage

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockClass> nice_mock;   // No warning on uninteresting calls
NaggyMock<MockClass> naggy_mock; // Warnings on uninteresting calls
StrictMock<MockClass> strict_mock; // Errors on uninteresting calls
```

### Notes:

- These wrappers inherit constructors transparently.
- They only apply to mock methods directly defined by `MOCK_METHOD` in the mock class.
- Combining multiple wrappers (e.g., `NiceMock<StrictMock<T>>`) is unsupported and discouraged.

---

## Expectation and Behavior Specifications

### Call Cardinalities

- Expanded cardinality expressions allow specifying precise invocation counts:
  - `AnyNumber()`, `AtLeast(n)`, `AtMost(n)`, `Between(m, n)`, and `Exactly(n)`.

- Cardinalities can be inferred automatically based on `WillOnce()` and `WillRepeatedly()` usage, reducing boilerplate.

### Sequencing of Calls

- The `.InSequence()` clause and `InSequence` object enable specifying strict or partial ordering of expected calls, supporting scenarios like:

  - Sequential call order enforcement.
  - Partial orders expressed using multiple `Sequence` objects.

- `.After()` clause supports setting call dependencies for more flexible sequencing.

### Behavior Actions

- Supports built-in actions like `Return()`, `ReturnRef()`, `ReturnPointee()`, and side-effect actions such as `SetArgPointee()`, `SetArrayArgument()`, and `Invoke()` with functions, functors, or lambdas.

- Allows chaining actions with `DoAll()` for complex mocks.

- Enables defining custom actions using functors, lambdas, or macros (`ACTION`, `ACTION_P`, etc). 

---

## Matchers

### Comprehensive Matching

- Built-in matchers cover equality, inequality, logical composition, container matching, property and field checking, predicate matching, and pointer content matching through utilities like `Field()`, `Property()`, `Pointee()`, `Truly()`, and others.

### Custom Matcher Creation

- Facilities for defining quick matchers using `MATCHER`, `MATCHER_P`, and matcher classes.

- Supports monomorphic and polymorphic matchers to match specific or multiple types.

- Emphasizes matchers must be pure functions without side effects to maintain test capture consistency.

---

## Practical Tips and Best Practices

- Prefer `ON_CALL` for default behavior; use `EXPECT_CALL` only when verifying call expectations.

- Use `NiceMock` to suppress unimportant warnings, `StrictMock` when errors on uninteresting calls are desired.

- Use `.RetiresOnSaturation()` to prevent sticky expectations from causing false upper-bound violations.

- Organize call expectations into sequences for order-sensitive verification.

- Use default values and default actions judiciously to avoid over-specification and maintain test resilience.

- Avoid mocking functions that are not virtual unless employing the high-performance dependency injection pattern.

---

## Troubleshooting and Debugging Improvements

- Enhanced diagnostic messages include stack traces, argument values, and detailed failure reasonings.

- Verbosity levels (`--gmock_verbose=info|warning|error`) enable users to control the detail of logging for debugging.

- Support for `Mock::VerifyAndClearExpectations()` to force verification before destruction, useful for heap-allocated mocks or complex lifecycles.

---

## Guidance for Integration

- These improvements encourage better maintainability of large mock test suites, more precise and informative expectations, and smoother integration into continuous testing pipelines.

- Users should migrate legacy mocking patterns to use the modern `MOCK_METHOD` macro and strictness wrappers for clearer test behavior.

- Recommended to review usage of `EXPECT_CALL` ordering and cardinality alongside the sequencing features to avoid brittle or flaky tests.

- Use type safety techniques such as `SafeMatcherCast<T>` and disambiguate overloaded methods with wrappers like `Const()` or explicit matcher types.

---

## Additional Resources

For a deeper understanding and examples on new features and best practices, refer to:

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Strictness Modes Documentation](https://google.github.io/googletest/api/gmock__strictness__modes_8md.html)
- [Using Matchers Guide](https://google.github.io/googletest/api/gmock__using__matchers_8md.html)

---

<Note>
Ensure that mock classes define mock methods publicly and prefer `NiceMock` in tests to reduce noise unless strict call validation is essential.
</Note>

<Tip>
When defining sequences, order your `EXPECT_CALL` statements naturally without reversing them by leveraging `.RetiresOnSaturation()` for better readability and maintenance.
</Tip>

---

_Last updated with the most current GoogleTest and GoogleMock feature set._

