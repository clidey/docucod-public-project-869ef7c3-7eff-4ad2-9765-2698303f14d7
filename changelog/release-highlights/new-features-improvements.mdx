---
title: "New Features & Improvements"
description: "Explore the most recent advancements, newly introduced features, improved workflows, and enhancements brought to both core testing (GoogleTest) and mocking (GoogleMock). Clear highlights help you leverage the latest capabilities in your test suites."
---

# New Features & Improvements in GoogleTest & GoogleMock

Welcome to the latest overview of new features and workflow improvements in both GoogleTest (the core C++ testing framework) and GoogleMock (its powerful mocking extension). This document highlights the enhancements designed to make your testing experience more intuitive, efficient, and flexible. Whether you are writing your first test or managing large-scale mock-based test suites, these updates will help you leverage the best of GoogleTest and GoogleMock.

---

## 1. Enhanced Mocking Syntax and Usability

### 1.1. Modernized `MOCK_METHOD` Macro

- The `MOCK_METHOD` macro continues to be the cornerstone for defining mock methods with improved parsing of complex argument types. When your mock method involves types with commas (e.g., `std::pair` or `std::map`), utilize parentheses or type aliases to ensure correct macro expansion.

```cpp
class MyMock {
 public:
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));
};
```

- Qualifier support (`const`, `override`, `noexcept`, `Calltype`, `ref`) has been solidified for compatibility and readability, allowing mock methods to faithfully override virtual methods.

### 1.2. Mocking of Non-public and Overloaded Methods

- Regardless of whether a method is `public`, `protected`, or `private` in the base class, mock methods **must** be declared `public` in the mock class. This design ensures external access for `ON_CALL` and `EXPECT_CALL` to function correctly.

- Overloaded methods are supported naturally with clear code patterns to mock each overload explicitly. Use `using BaseClass::Method` to avoid hiding overloads unintentionally.

### 1.3. Mocking Class Templates

- GoogleMock now fully supports mocking of class templates, enabling test writers to mock generic interfaces or containers with ease.

```cpp
template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### 1.4. Delegation Patterns

- You can delegate mock calls to an existing fake or real implementation, combining the benefits of mocks (verification of interactions) with production behavior.

- Delegation empowers incrementally replacing legacy code with mocks without losing behavior fidelity.

---

## 2. Improved Expectation Control and Sequencing

### 2.1. Flexible Use of `EXPECT_CALL` clauses

- The clauses `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` continue to empower precise control over expectations.

- Clause ordering is now strictly enforced to improve error messages and developer guidance.

- The `.With()` clause lets you express complex predicates on the aggregated arguments in a natural and readable way.

### 2.2. Support for Partial Ordering of Calls

- You can now specify partial orders of expected calls using multiple `Sequence` objects and `.InSequence()` clauses, forming directed acyclic graphs (DAGs) of call order.

- This allows tests to express real-world interaction constraints without unnecessary brittleness caused by strict linear ordering.

### 2.3. Cardinality Enhancements

- Cardinality expressions such as `AnyNumber()`, `AtLeast()`, `AtMost()`, `Between()`, and `Exactly()` enable fine-grained control over call counts.

- Sticky expectations ensure an expectation remains active until explicitly retired or superseded, minimizing surprising failures.

- `.RetiresOnSaturation()` is a preferred method to disable expectations cleanly once their call count is met.

---

## 3. More Expressive Actions and Matchers

### 3.1. Expanded Built-in Actions

- Built-in actions such as `Return()`, `ReturnRef()`, `ReturnPointee()`, `SetArgPointee()`, `SetArrayArgument()`, `Invoke()`, and `DoAll()` provide powerful means to shape mock behavior.

- Actions accepting lambdas, functors, or callable objects greatly simplify expressing complex behavior and side effects inline.

### 3.2. Move-Only Type Support

- GoogleMock now supports mocking methods with move-only types (e.g., `std::unique_ptr<>`) directly in method signatures.

- Lambda-based actions enable returning and accepting move-only types seamlessly, expanding test coverage for modern C++ patterns.

### 3.3. Composite and Custom Matchers

- Writing custom matchers is simplified with the `MATCHER`, `MATCHER_P*`, and class-based matcher interfaces.

- Composite matchers allow combining multiple matchers logically with `AllOf()`, `AnyOf()`, and `Not()`.

- The framework ensures detailed failure explanations, aiding faster debug cycles.

---

## 4. Testing and Debugging Enhancements

### 4.1. Controlled Verbosity and Diagnostic Output

- The `--gmock_verbose` flag supports levels `info`, `warning`, and `error` to regulate runtime diagnostic verbosity.

- At `info` verbosity, each mock call logs matching expectations and call details including full argument and return value dumps plus stack traces.

- This provides developers with 'supervision' power to trace test mock calls effectively.

### 4.2. Support for Deleting Mock Objects Within Actions

- It is now safe and supported to delete the mock object inside an action (including within a mock method) without causing deadlocks or inconsistent verification.

- This allows advanced lifecycle control scenarios in tests.

### 4.3. Partial Mock Verification

- You can force verification of mock expectations at a specific point via `Mock::VerifyAndClearExpectations(&mock_obj)`, ensuring even leaked or long-lived mocks are verified without requiring destruction.

- This is helpful in complex ownership models.

---

## 5. Integration and Build Improvements

### 5.1. Initialization Functions

- `InitGoogleMock` provides overloads that support standard `argc/argv`, UNICODE, and embedded platforms without `argc/argv`.

- This ensures broad compatibility across diverse environments.

### 5.2. Comprehensive Header Inclusion

- Including `gmock/gmock.h` brings in a complete set of subcomponents such as actions, cardinalities, matchers, and mocking utilities.

- The modular design keeps compilation manageable while enabling rich features.

---

## 6. Practical Tips & Best Practices

- Use `ON_CALL` to define default mock behaviors without requiring exact call expectations.

- Reserve `EXPECT_CALL` for specifying calls you want to verify, minimizing brittle tests.

- Use `NiceMock` to suppress noisy warnings on uninteresting mock calls when their calls are irrelevant.

- Use `StrictMock` to enforce strict call constraints, beneficial for rigorous interaction tests.

- For better compile-time performance, place mock constructor and destructor definitions in `.cc` files when mocking many methods.

- Avoid mocking concrete classes directly; prefer defining interfaces and adaptors for better test stability and design.

- Use sequences and `InSequence` blocks to express order requirements clearly.

- Leverage detailed diagnostic modes during test development to quickly identify expectation failures or unexpected calls.

---

## 7. Example: Defining and Using a Mock Class

```cpp
#include <gmock/gmock.h>

// Interface
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

// Mock
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Usage in tests
using ::testing::Return;
using ::testing::_;
using ::testing::InSequence;

TEST(PaintTest, DrawsLine) {
  MockTurtle mock_turtle;

  {
    InSequence s;
    EXPECT_CALL(mock_turtle, PenDown());
    EXPECT_CALL(mock_turtle, Forward(100));
    EXPECT_CALL(mock_turtle, PenUp());
  }

  // Run function under test here
  // painter.DrawLine(&mock_turtle);

  // Mock verifies calls and order upon destruction
}
```

---

For more in-depth recipes, patterns, and API details see the [gMock Cookbook](../docs/gmock_cook_book.md), [Mocking Reference](../api-reference/matchers-mocking/defining-mocks-expectations.md), and [gMock for Dummies](../docs/gmock_for_dummies.md).

---

<Info>
Stay up to date with the latest releases and consider your projectâ€™s compatibility when adopting new features. Leverage improved diagnostic tools and matchers to write cleaner, faster tests.
</Info>

---

[GoogleTest Primer](../overview/introduction-core-value/what-is-googletest.md) | [Installation & Setup](../getting-started/installation-initialization/installation-cmake.md) | [Mocking Patterns Guide](../guides/mocking-patterns/introduction-to-mocking.md) | [Matchers Reference](../api-reference/matchers-mocking/argument-matchers.md)

---

<Source url="https://github.com/google/googletest" paths='[{"path":"googlemock/include/gmock/gmock.h","range":"1-72"},{"path":"docs/gmock_cook_book.md","range":"1-3704"},{"path":"docs/gmock_for_dummies.md","range":"1-547"},{"path":"docs/reference/mocking.md","range":"1-1736"},{"path":"googlemock/test/gmock-spec-builders_test.cc","range":"1-570"}]' />