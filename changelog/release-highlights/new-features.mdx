---
title: "New Features & Enhancements"
description: "Detailed highlights of new capabilities and significant upgrades introduced in each recent release. Learn about the productivity-boosting features, advanced mocking capabilities, and testing enhancements that further empower your test suite."
---

# New Features & Enhancements

Discover the detailed highlights of new capabilities and significant upgrades introduced in each recent release of GoogleMock. This page focuses on enhancements that improve productivity, expand mocking capabilities, and refine test suite functionality, empowering you to write expressive, flexible, and maintainable tests.

---

## Overview

The New Features & Enhancements page provides users with actionable insights into the latest improvements within GoogleMock. Whether it's new syntax conveniences, advanced mocking behavior controls, or performance boosts, this documentation guides you through what has changed and how these updates can streamline your test development workflow.

This documentation is designed to serve users who want to leverage the latest mock framework features to create more readable and robust C++ unit and integration tests.

---

## Key Improvements & What They Mean for You

### Enhanced Expectation Syntax

GoogleMock continues to refine the syntax for defining expectations (`EXPECT_CALL`) and default behaviors (`ON_CALL`). Recent advances include stricter enforcement of clause usage order and cardinality rules to help you write clearer and error-free mock expectations.

- Clauses like `.With()` must be the first modifier after method specification, preventing common misorders that can lead to test failures.
- Usage of `.Times()`, `.WillOnce()`, `.WillRepeatedly()`, `.RetiresOnSaturation()` is carefully validated at runtime, giving you immediate feedback if expectations are incorrectly formulated.

### Improved Handling of Overloaded and Const Methods

You can now mock overloaded methods and const-qualified methods more reliably, with explicit support for disambiguation:

- Use the `Const()` wrapper to specify expectations on const overloads.
- Use type-safe casting (e.g., `SafeMatcherCast`) to ensure matchers correctly bind to overloaded method parameters.

This makes your mocks precise and expressive, eliminating ambiguous call resolution issues.

### Default Actions and ON_CALL Enhancements

Default behaviors defined via `ON_CALL` have been extended with more flexible matching and composition:

- You can specify multi-argument matchers using `.With()` to control when default actions apply.
- Last-matching `ON_CALL` rules take precedence, enabling you to set general behaviors in setup and specialize in later configuration steps.

This enables separation of concerns in test setup and fine-tuning mock interactions with minimal code.

### Richer Built-In Matchers and Actions

GoogleMock offers an expanding library of matchers and actions to specify call argument constraints and mock behaviors.

- Support for matching tuples of arguments via `.With()`.
- Actions such as `ReturnPointee`, `Invoke`, `DoAll`, and `SetArgPointee` empower you to easily mimic complex behavior including side effects and state changes.

These features help model real-world code scenarios with concise, readable test code.

### New Utilities for Move-Only Types and Complex Argument Matching

Recent improvements facilitate mocking functions involving move-only types (like `std::unique_ptr`) and provide convenient tools to select or ignore certain arguments when specifying actions:

- You can define mock methods accepting or returning move-only types with `MOCK_METHOD` directly.
- Use adaptors like `WithArgs`, `WithoutArgs`, and `WithArg` to apply actions on selected arguments, making it easier to integrate complex functions with your mocks.

These upgrades reduce boilerplate and improve type safety for modern C++ codebases.

### Advanced Call Sequencing and Partial Order Control

GoogleMock supports detailed control over the order in which mocked calls are expected:

- Specify sequences with `InSequence` to enforce strict call order.
- Express partial orderings using `After` clauses combined with `Sequence` objects.

This enables you to capture intricate interaction protocols clearly and have your tests verify them robustly.

### Enhanced Diagnostic and Verbosity Controls

To better understand and debug mocks, GoogleMock has advanced its diagnostic capabilities:

- Verbosity levels (`--gmock_verbose=` flag) allow toggling between minimal error output, warnings, or full informational traces of mock invocations.
- Stack traces in mock call warnings have improved to help quickly locate call sites.

These tools provide you with better visibility into mock behavior and test failures.

---

## Practical Tips and Best Practices

- **Set Expectations Early:** Always define your `EXPECT_CALL` expressions before exercising mocks to ensure consistent behavior.
- **Use `ON_CALL` for Defaults:** Use `ON_CALL` to set common behaviors shared across tests, reserving `EXPECT_CALL` to verify specific interactions.
- **Consider Mock Strictness:** Use `NiceMock`, `NaggyMock`, or `StrictMock` wrappers to control warnings on uninteresting calls as per your testing needs.
- **Leverage Polymorphic Matchers:** Use built-in and custom polymorphic matchers for flexible and type-safe argument validation.
- **Utilize `RetiresOnSaturation`:** When specifying a finite number of calls, adding `.RetiresOnSaturation()` prevents unexpected call counts and improves test stability.

---

## Common Pitfalls and Troubleshooting

- **Misordered Clauses:** `.With()` clauses that appear after others will trigger errors. Place `.With()` immediately after method matcher.
- **Unmatched Expectation Errors:** If calls fail due to argument mismatch, run tests with `--gmock_verbose=info` to trace actual call matching.
- **Expectations Never Met:** Remember, expectations are verified when the mock is destroyed. If mocks persist beyond test lifetime, use explicit verification calls.
- **Ambiguous Overloads:** Use `Const()` wrapper or explicit matcher casting to disambiguate overloaded method expectations.

---

## Code Examples

### Defining Expectations with `With()` Clause

```cpp
using ::testing::_;  
using ::testing::Lt;
using ::testing::Return;

EXPECT_CALL(my_mock, SetPosition(_, _))
    .With(Lt())
    .WillOnce(Return(true));
```

Sets the expectation that `SetPosition()` is called with two arguments where the first is less than the second.

### Using Sequences for Ordered Calls

```cpp
using ::testing::InSequence;

{
  InSequence seq;
  EXPECT_CALL(my_mock, Initialize());
  EXPECT_CALL(my_mock, Process());
  EXPECT_CALL(my_mock, Finalize());
}
```

Enforces the order: `Initialize()` → `Process()` → `Finalize()`.

### Handling Move-Only Types

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz, int64_t timestamp), (override));
};

// Setting expectation with a move-only return value
EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
    .WillOnce(Return(std::make_unique<Buzz>(AccessLevel::kInternal)));
```

### Using Actions with Selected Arguments

```cpp
EXPECT_CALL(mock, Foo)
    .WillOnce(WithArgs<0, 2>(Invoke(IsValidRequest)));
```

Only arguments 0 and 2 are passed to the action `IsValidRequest`.

---

## Additional Resources

For full mastery of GoogleMock’s capabilities, consult:

- [Mocking Reference](https://google.github.io/googletest/docs/reference/mocking.html) for detailed macro and class descriptions.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) to learn foundational mocking concepts and usage.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes including custom actions, matchers, and mock lifecycle management.
- [Matchers Reference](reference/matchers.md) and [Actions Reference](reference/actions.md) for in-depth guides on available operations.
- [Debugging Common Failures](../guides/real-world-patterns/debugging-common-failures.md) to gain troubleshooting strategies for common mock and test failures.

Explore these linked documents to deepen your tests’ effectiveness and maintainability.

---

## Navigation Guidance

The "New Features & Enhancements" page fits within the broader [Changelog](../changelog/) section, complementing release overview, breaking changes, and upgrade guide pages. It targets experienced users looking to utilize the latest GoogleMock capabilities in their testing workflows.

Users new to mocking should start with [gMock for Dummies](../guides/gmock_for_dummies.md) and [Building & Using Mocks](../guides/mocking-advanced-usage/building-mocks.md) before leveraging recent feature enhancements documented here.

---

For questions or support beyond this page, see [Where to Get Help](../faq/support-and-community/where-to-get-help.md).


---

_Last updated: main branch_

---
