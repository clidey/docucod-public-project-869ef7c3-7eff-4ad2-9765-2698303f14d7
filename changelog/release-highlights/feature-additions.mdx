---
title: "New Features and Enhancements"
description: "Discover the major new capabilities and enhancements brought in recent versions, such as support for new assertion types, improved test runners, or integrations. Each feature includes a brief impact summary and pointers to when it was introduced."
---

# New Features and Enhancements

Explore the notable new capabilities and improvements introduced in recent versions of GoogleMock. These updates optimize test writing, enhance mock flexibility, and broaden the framework's applicability.

---

## 1. Enhanced MOCK_METHOD Macro Flexibility

GoogleMock has modernized the `MOCK_METHOD` macro, enabling an intuitive, uniform syntax for mocking methods across a broad range of scenarios:

- **Support for Method Qualifiers:** You can now specify `const`, `override`, `noexcept`, calling conventions (via `Calltype()`), and reference qualifiers (like `ref(&)` or `ref(&&)`) as a closed list of qualifiers in the macro's fourth parameter. This ensures your mock methods accurately mirror the base methods they override without cumbersome syntax.

- **Improved Parsing of Comma-Containing Types:** When mocking methods whose return or argument types include commas (such as `std::pair<bool, int>` or `std::map<int, double>`), the macro requires wrapping the type in parentheses or using type aliases. This explicit guidance prevents compile errors and clarifies intent.

- **Consistent Public Section Requirement:** Regardless of whether the mocked methods are originally `public`, `protected`, or `private`, `MOCK_METHOD` invocations must be in the `public:` section. This guarantees seamless referencing of mock methods in expectations.

```cpp
class MockFoo {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (const, override));
};

// Example of handling unprotected commas:
using BoolIntPair = std::pair<bool, int>;
class MockFoo {
 public:
  MOCK_METHOD(BoolIntPair, GetPair, ());
};
```

---

## 2. Robust Mocking of Overloaded and Template Methods

- **Overloaded Methods:** GoogleMock handles overloaded functions naturally, supporting explicit qualification via qualifiers like `(const, override)` to distinguish between overloads.

- **Class Templates:** Mocking template classes is now streamlined with consistent macro usage, enabling mock definitions for any template instantiations.

- **Automatic Handling of Const Overloads:** Using qualifiers to mark const and non-const overloads avoids ambiguity and helps the compiler select correct mocks without warnings.

```cpp
class Foo {
  virtual int Add(int x);
  virtual int Add(int times, int x);
  virtual Bar& GetBar();
  virtual const Bar& GetBar() const;
};

class MockFoo : public Foo {
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(Bar&, GetBar, (), (override));
  MOCK_METHOD(const Bar&, GetBar, (), (const, override));
};
```

---

## 3. Mocking Non-Virtual Methods via High-Performance Dependency Injection

GoogleMock now officially supports mocking non-virtual methods using templated dependency injection:

- **Unrelated Mock Classes:** Mock classes may be unrelated to the concrete classes they mimic.

- **Template Parameterization:** Code can be templated on the packet stream or other class types, allowing compile-time selection between real and mock types.

- **Seamless Syntax:** The mocking syntax mirrors virtual mocking, but without `override`.

```cpp
template <typename PacketStream>
void CreateConnection(PacketStream* stream) { ... }

class MockPacketStream {
 public:
  MOCK_METHOD(const Packet*, GetPacket, (size_t packet_number), (const));
};

// Usage
MockPacketStream mock_stream;
EXPECT_CALL(mock_stream, GetPacket(_));
CreateConnection<MockPacketStream>(&mock_stream);
```

---

## 4. Delegation Patterns: To Fakes, Real Objects, and Parent Classes

To better model complex behaviors and reduce test maintenance:

- **Delegating to Fakes:** Mocks can forward calls to real fake implementations for default behavior, allowing selective overrides.

- **Delegating to Real Objects:** Mocks can invoke real objects during runs to replicate production logic while verifying interactions.

- **Delegating to Parent Classes:** Mocks can call the base class's concrete implementation inside mocks using fully qualified calls to avoid recursion.

These patterns empower fine-grained control over mock behaviors while reusing existing logic.

---

## 5. Introducing Strictness Wrappers for Mock Objects: NiceMock, NaggyMock, StrictMock

GoogleMock provides templated wrappers to manage how uninteresting calls (those not explicitly expected) are treated:

- **NiceMock:** Suppresses warnings for uninteresting calls, helping reduce noise when these calls are considered benign.

- **NaggyMock:** (default) Prints warnings on uninteresting calls, alerting to possibly forgotten expectations.

- **StrictMock:** Treats uninteresting calls as failures, making tests more stringent.

These wrappers subclass the original mock class, inheriting constructors to maintain usability. Use these to balance test strictness and noise according to your needs.

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, DoThis());
...
```

---

## 6. Advanced Matchers and Actions

- **Comprehensive Matchers:** GoogleMock continues to expand matchers to check individual members (`Field()`), properties (`Property()`), containers (`ElementsAre()`), and custom predicates (`Truly()`).

- **Combining Matchers:** Functions like `AllOf()`, `AnyOf()`, and `Not()` allow composing complex argument matching conditions.

- **Custom Matchers:** Easily define custom monomorphic and polymorphic matchers using macros such as `MATCHER()` and `MATCHER_P()`, with detailed failure messages.

- **Flexible Actions:** Use built-in actions (`Return()`, `SetArgPointee()`, `Invoke()`) or define custom callable objects and lambdas to specify mock behaviors precisely, including side effects and asynchronous operations.

- **Parameter and Type Safety:** Statically checked matchers and actions ensure compatibility and prevent common errors.

---

## 7. Support for Move-Only Types in Mock Methods

Given modern C++ usage patterns:

- You can now mock methods accepting or returning move-only types (`std::unique_ptr<T>`) using the standard `MOCK_METHOD` macros and lambdas.

- Set expectations and specify actions that return or consume move-only values safely.

- Legacy workarounds are advised only for older codebases.

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
```

---

## 8. Improved Verification Controls and Utilities

- **Forced Verification:** `Mock::VerifyAndClearExpectations(&mock_object)` allows early and explicit verification of expectations even if the mock isn't destroyed yet.

- **Checkpoints:** Use `MockFunction` and sequence controls to insert checkpoints in tests, validating call ordering in phases.

- **Leak Detection:** Flag support helps detect leaked mocks, improving test hygiene.

---

## 9. Enhanced Testability in Multithreaded Environments

GoogleMock ensures thread safety when:

- Test code runs on a single thread.

- Mock method calls and default actions execute in the calling thread.

- Expectations and verifications are set in non-concurrent scenarios to avoid undefined behavior.

Users have explicit guidance for safe multithreaded mock usage.

---

## 10. Improved Verbosity Controls and Diagnostic Outputs

- **`--gmock_verbose` Flag:** You can control verbosity levels (`info`, `warning`, `error`) to tune the console output during test runs.

- **Stack Traces:** Enhanced stack trace inclusion on warnings to aid debugging.

- **X-Ray Visibility:** When enabled, detailed traces of expectation evaluations and matching calls provide deep insights into mock call matching.

---

## 11. Streamlined Compilation and Usage

- Moving mock class constructor and destructor definitions into `.cc` files to reduce compile times.

- Simplified macro usage and enhanced error messages for easier learning and debugging.

---

## References & Further Reading

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for onboarding and conceptual understanding.
- [Mocking Reference](reference/mocking.md) for detailed API and macros.
- [gMock Cookbook](gmock_cook_book.md) for recipes and advanced usage patterns.
- [gMock Cheat Sheet](gmock_cheat_sheet.md) for quick syntax reminders.
- [Strictness and Mock Call Controls](reference/mocking-apis/strictness.md) for leveraging NiceMock, NaggyMock, and StrictMock best.

---

This overview empowers users to apply GoogleMock's latest enhancements effectively for expressive, maintainable, and powerful mocking in C++ tests.
