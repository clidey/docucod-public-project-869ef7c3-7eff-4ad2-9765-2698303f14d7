---
title: "Breaking Changes"
description: "A focused list of all breaking changes introduced in recent versions, including changes in required C++ standards, altered behaviors, and compatibility notes. Use this to quickly identify upgrades that might require code or build system modifications."
---

# Breaking Changes

The Breaking Changes page consolidates all critical modifications introduced in recent versions of GoogleTest and GoogleMock that could impact your existing codebases or build systems. It serves as a focused and actionable resource to quickly identify adjustments that require your attention, such as updates in the required C++ standards, changes in library behaviors, and important compatibility notes.

---

## 1. C++ Standard Requirements

- **Minimum Standard: C++17**

  Recent GoogleTest and GoogleMock versions now **require C++17** or newer for compilation. Attempting to build with C++ standards earlier than C++17 will fail during the preprocessor checks.

  This change ensures compatibility with modern C++ features and streamlines the codebase.

  <Tip>
  Make sure to update your build system configuration to specify `-std=c++17` or higher as the compilation flag for all GoogleTest/GoogleMock source files and any tests depending on them.
  </Tip>

- **Compiler Compatibility**

  The requirement applies to compilers supporting C++17, such as:

  - GCC 7 or later
  - Clang 5 or later
  - MSVC 2017 Update 3 (version >= 19.11) or later

  <Note>
  If your compiler does not support C++17, update it or use an older GoogleTest release compatible with your environment.
  </Note>

## 2. Changes Affecting Mock Method Behavior and Syntax

- **Use of the New `MOCK_METHOD` Macro Syntax**

  The legacy `MOCK_METHODn` macros have been superseded by the more versatile `MOCK_METHOD` macro. While the old macros remain supported for backward compatibility, developers are encouraged to adopt the new syntax:

  ```cpp
  // Old style - discouraged for new code
  MOCK_METHOD1(Foo, int(int arg));

  // New style - preferred
  MOCK_METHOD(int, Foo, (int arg), (override));
  ```

  This syntax supports qualifiers like `const`, `override`, and reference qualifiers, improving mock method declarations for modern C++.

- **Support for Non-Moveable Return Types in Mocked Methods**

  Mocked methods that return non-moveable and non-copyable types are now fully supported, provided your compiler supports C++17 or newer. This resolves earlier limitations where such return types could not be mocked.

- **Ordering and Expectation Matching Rules**

  The matching of expectations on mock methods proceeds in reverse order, with newer expectations overriding older ones. This behavior has been stable but is highlighted to assist users updating their test expectations.

  <Tip>
  Define general expectations earlier, and more specific ones later, to take advantage of this precedence behavior.
  </Tip>

## 3. Build System and Platform Compatibility

- **Thread Safety and Synchronization**

  GoogleTest internal threading primitives rely on standardized threading support. Platforms without C++17 threading support or POSIX pthreads might experience partial functionality.

- **Death Test Behavior Updates**

  The default death test style remains "fast", but users are encouraged to use the "threadsafe" style in multi-threaded environments to avoid flaky tests. The "threadsafe" style re-executes tests with precise control and isolates thread-related behavior.

  <Tip>
  Enable thread-safe death tests via the flag:

  ```cpp
  GTEST_FLAG_SET(death_test_style, "threadsafe");
  ```
  </Tip>

## 4. API Behavior Notes Related to Breaking Changes

- **Expectations Are Sticky by Default**

  Expectations remain active after their invocation upper bounds are reached, unless explicitly marked with `.RetiresOnSaturation()`. This subtlety is crucial to prevent unexpected test failures due to calls exceeding expected limits.

- **Default Actions and ON_CALL Behavior**

  The separation and precedence of `EXPECT_CALL` and `ON_CALL` remain, but users should check for any subtle changes in default action dispatching especially in complex mocks.

- **Uninteresting Calls Warning Level**

  By default, uninteresting calls produce warnings. Users can fine-tune this behavior by using `NiceMock`, `NaggyMock`, or `StrictMock` templates to control warnings vs errors for uninteresting calls.

  ```cpp
  NiceMock<MockFoo> nice_mock;
  StrictMock<MockFoo> strict_mock;
  ```

## 5. Source and Header Files Impacted

The breaking changes primarily affect the following key header and source files:

- `googletest/include/gtest/internal/gtest-port.h`

  - Now enforces the minimum C++ standard version
  - Implements updated feature-detection macros
  - Provides consistent multithreading and environment support

- `googlemock/gmock-spec-builders_test.cc`

  - Reflects updated mock method declaration and expectation order semantics

- `googlemock/README.md`

  - Updated to clarify modern usage of gMock

## 6. Migration Recommendations

### Step-by-Step Migration Workflow

<Steps>
<Step title="Update C++ Standard">
Ensure all your test targets compile with **C++17** or newer. Update your build system accordingly.
</Step>
<Step title="Adopt New `MOCK_METHOD` Syntax">
Replace legacy `MOCK_METHODn` macros with the modern `MOCK_METHOD` macro to benefit from extended qualifiers and improved readability.
</Step>
<Step title="Review and Adjust Expectations">
Audit your `EXPECT_CALL` usage considering the "newer expectations override older" policy and possible sticky expectations behavior by default.
</Step>
<Step title="Manage Uninteresting Calls">
Decide the preferred behavior for uninteresting calls using `NiceMock`, `NaggyMock`, or `StrictMock` to control warnings and errors.
</Step>
<Step title="Test Multi-threaded Death Tests">
If your tests involve multiple threads, switch to the "threadsafe" style death tests to avoid flakiness.
</Step>
<Step title="Run and Validate Tests">
Perform thorough test execution to detect possible failures introduced by the breaking changes and adjust code or mock setups as needed.
</Step>
</Steps>

## 7. Troubleshooting Common Breakage Scenarios

- **Build Failures Reported Due to C++ Standard Version**

  Ensure your compiler flags explicitly specify C++17 or later.

- **Mock Method Signature Mismatch Errors**

  Check correct usage of qualifiers `(const, override)`, and argument parentheses in `MOCK_METHOD` declarations.

- **Unexpected Mock Call Failures Post-Migration**

  Adjust your mock expectations to account for newer matching and sequencing behavior.

- **Death Test Failures in Multi-threaded Environments**

  Switch death test style to "threadsafe".

## 8. References and Further Reading

- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Extensive examples and recipes
- [Mocking Reference](reference/mocking.md): Detailed API specifications
- [Assertions Reference](reference/assertions.md): Assertions usage
- [Common Setup Issues](getting-started/troubleshooting-support/common-setup-issues): Troubleshooting build and environment problems
- [System Requirements & Supported Platforms](getting-started/prerequisites-installation/system-requirements): Supported environments and compilers

---

For a comprehensive migration, refer to your specific version's upgrade guides and consult the community or official support channels for assistance.


---

*This documentation aligns tightly with the provided source content and focuses exclusively on the Breaking Changes page for GoogleTest and GoogleMock as requested.*