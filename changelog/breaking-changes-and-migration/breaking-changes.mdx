---
title: "Breaking Changes"
description: "Catalog of all breaking or backward-incompatible changes, from API removals to modified behaviors. Clear explanations ensure users can proactively refactor tests and supporting code before upgrading."
---

# Breaking Changes

The "Breaking Changes" page serves as a comprehensive catalog of all backward-incompatible changes introduced across GoogleMock and GoogleTest. These changes range from API removals to alterations in behavior that might affect your existing tests. By providing clear, actionable explanations and migration guidance, this page equips you to proactively adapt your test suites and mock setups before upgrading to newer versions.

---

## Understanding Breaking Changes

Breaking changes refer to modifications that may cause previously working code to fail or behave differently without updates. In the context of GoogleMock, this includes:

- Removal or renaming of macros or functions such as `MOCK_METHODn` family or `MOCK_METHOD`.
- Changes in syntax or semantics of existing mock-related macros.
- Revisions to the behavior of mock strictness (e.g., how `NiceMock`, `StrictMock` behave).
- Modifications in default actions or expectations processing.
- Alterations in supporting utilities or classes that mock users rely on.

Understanding these changes is crucial to maintaining test health and avoiding runtime failures due to unexpected API modifications.

---

## Impact on User Code

### Migration Readiness
Users should anticipate that breaking changes might require:

- Refactoring of existing mock declarations, especially when migrating from older `MOCK_METHODn` macros to the newer, unified `MOCK_METHOD` macro.
- Adjusting expectations and default mock behaviors in response to changes in mock strictness handling or default actions.
- Revisiting call expectations and matchers to align with updated semantics around argument matching and call sequences.
- Updating test fixtures or mock classes if method qualifiers or signatures change.

### Practical Tips for Smooth Upgrades
- **Review Deprecated APIs**: Identify usage of older macros like `MOCK_CONST_METHODn` or `MOCK_METHODn` and plan to transition to `MOCK_METHOD`.
- **Check Mock Method Qualifiers**: Ensure that overrides explicitly specify `const`, `override`, `noexcept`, or `Calltype` as required to maintain correctness.
- **Test Strictness Modifiers**: Verify usage of `NiceMock`, `NaggyMock`, or `StrictMock` that control uninteresting call handling, as changes in their behavior can affect test outcomes.
- **Validate Call Ordering**: If your tests rely on `InSequence` or `After` clauses, confirm that the partial and total call orders still hold.
- **Pay Attention to Warnings and Errors**: GoogleMock provides warnings for uninteresting calls and unexpected behavior; treat these as cues to reassess expectations.

---

## Notable Breaking Changes by Category

### 1. Transition from Old-Style `MOCK_METHODn` Macros to `MOCK_METHOD`

Legacy macros such as `MOCK_METHOD1`, `MOCK_CONST_METHOD0_T`, and variants with `_WITH_CALLTYPE` are superseded by the unified and more expressive `MOCK_METHOD` macro that accepts method qualifiers. Example transition:

```cpp
// Old style
MOCK_CONST_METHOD1(Foo, bool(int));

// New style
MOCK_METHOD(bool, Foo, (int), (const, override));
```

This change simplifies mocking declarations but requires explicit correct use of qualifiers. Wrapping parameter types with parentheses remains necessary when dealing with unprotected commas in types.

### 2. More Explicit Qualifiers Required for Mock Methods

When mocking methods that are `const`, `noexcept`, have reference qualifiers (`&`, `&&`), or special calling conventions (`STDMETHODCALLTYPE` on Windows), the new `MOCK_METHOD` macro mandates specifying these as a fourth argument, e.g., `(const, noexcept, override, Calltype(STDMETHODCALLTYPE))`.

### 3. Handling Uninteresting Calls and Mock Strictness

The default behavior in gMock is to warn about uninteresting calls (mock calls without expectations). With the introduction of `NiceMock`, `StrictMock`, and `NaggyMock`, users gained control over these warnings and failures. Changes in internal behavior of these modifiers may require:

- Reconsidering mock wrapper usage to avoid false positives or excessive failures.
- Adjusting tests to add explicit expectations or use `NiceMock` to suppress unwanted warnings.

### 4. Changes in Cardinality and Ordering of Expectations

- Expectations remain "sticky" by default, meaning they remain active even after saturation unless `.RetiresOnSaturation()` is specified.
- The precedence order of expectations is from last declared to first, to allow default catch-all expectations to be overridden by more specific ones.
- Sequencing constructs (`InSequence`, `After`) now have stricter rules on clause order and usage in expectations, requiring review.

### 5. Verifying and Clearing Expectations

The introduction and specification behavior of `Mock::VerifyAndClearExpectations()` and `Mock::VerifyAndClear()` requires that users:

- Call verification functions after exercise to avoid stale expectations causing test failures.
- Not set expectations after verification without re-initializing mocks.

### 6. Changes Affecting Action and Matcher Definitions

- The `ON_CALL` and `EXPECT_CALL` macros have stricter syntax requirements concerning `.With()` and `.WillByDefault()` clauses.
- Actions such as `Return()`, `ReturnRef()`, and complex custom actions require careful handling if return types have changed or parameters utilize move-only or template types.

---

## Common Pitfalls and How to Avoid Them

- **Missed Qualifiers**: Not specifying the correct qualifiers in `MOCK_METHOD` leads to compilation errors or unexpected behavior.
- **Inconsistent Expectation Ordering**: Defining expectations in the wrong sequence can shadow more specific expectations.
- **Using Deprecated Macros**: Continuing to use `MOCK_METHODn` or `MOCK_CONST_METHODn` macros without migrating will cause compatibility issues.
- **Ignoring Uninteresting Calls Warning**: Suppressing warnings by adding indiscriminate `EXPECT_CALL` statements may lead to brittle tests.
- **Failing to Use `RetiresOnSaturation()`**: Not marking expectations as retiring after use in sequential tests leads to saturation and unexpected failures.

---

## Step-by-Step Migration Guidance

### 1. Audit Your Mock Classes
- Search for any usage of old-style `MOCK_METHODn` macros.
- Identify missing or incorrect qualifiers in `MOCK_METHOD` declarations.

### 2. Refactor Mock Methods
- Convert all legacy macro uses to the unified `MOCK_METHOD` macro.
- Add explicit qualifiers such as `const`, `override`, `noexcept`.
- Wrap complex parameter types with parentheses or use `using` aliases to simplify.

### 3. Verify Expectations and Actions
- Add explicit expectations for uninteresting calls that are valid to suppress warnings.
- Review test cases that use `NiceMock`, `StrictMock`, and `NaggyMock` to ensure behavior matches your intent.
- Use `.RetiresOnSaturation()` on expectations used in sequences.

### 4. Test Ordering and Cardinalities
- Check `.InSequence()` and `.After()` clauses for appropriate order.
- Adjust test cases if unexpected call order causes failures.

### 5. Run Tests with Verbosity
- Use `--gmock_verbose=info` to inspect mock function calls.
- Investigate warnings related to uninteresting or unexpected calls.

### 6. Verify and Clear Mocks Properly
- Ensure mocks are cleared and verified at appropriate times to avoid stale states.

---

## Troubleshooting Common Issues Related to Breaking Changes

### Compilation Failures
- Check for deprecated macro usage.
- Verify qualifier syntax on `MOCK_METHOD`.

### Unexpected Test Failures
- Use verbose logging to trace mock calls.
- Confirm expectations are registered before mock use.
- Verify correct use of sequences and cardinalities.

### Warning Overhead
- Suppress unnecessary warnings by clarifying expectations or using `NiceMock`.

### Linker and Runtime Problems
- Ensure all mock definitions and constructors/destructors are correctly implemented and visible.

---

## Additional Resources

To better understand and manage breaking changes, consult:

- [Mocking Reference](reference/mocking.html): Comprehensive details on macros, expectations, and mock behavior.
- [gMock Cookbook](gmock_cook_book.md): In-depth recipes and explanations on mocking practices.
- [gMock for Dummies](gmock_for_dummies.md): Beginner-friendly introduction to mocking with gMock.
- [Mocking FAQ](docs/gmock_faq.md): Common user questions and advanced scenarios.
- [Setting Expectations & Cardinalities](reference/mocking.html#EXPECT_CALL) and [Controlling Mock Strictness](api-reference/mocking/nice-strict-mocks.mdx)

---

## Summary

The Breaking Changes page empowers users to navigate the evolution of GoogleMock APIs and behaviors, providing guidance for migrating code with minimal disruption. By understanding removal of old macros, enhanced qualifier requirements, changes in expectation management, and strictness controls, users can refactor their mocks and tests confidently. This ensures smooth upgrades and sustained test correctness across versions.

---

*For detailed troubleshooting and migration assistance, refer to the linked documentation and consider running tests with gMock verbose mode to gain actionable insights.*
