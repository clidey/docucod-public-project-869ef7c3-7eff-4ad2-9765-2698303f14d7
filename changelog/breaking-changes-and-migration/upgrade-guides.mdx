---
title: "Upgrade Guides"
description: "Practical, step-by-step instructions for upgrading your codebase between major GoogleTest and GoogleMock versions. Covering common pitfalls, best practices, and sample migration workflows, these guides ease the adoption of new releases."
---

# Upgrade Guides

Practical, step-by-step instructions for upgrading your codebase between major GoogleTest and GoogleMock versions. This document focuses exclusively on helping users navigate common pitfalls, adopt new idioms, and apply best practices to ensure smooth migration during major version upgrades.

---

## 1. Understanding the Upgrade Path

Upgrading between major releases of GoogleTest and GoogleMock can introduce significant changes that affect your test code, mocking constructs, and build configurations. This guide empowers you to confidently update your codebase by:

- Explaining what typically changes in major versions
- Highlighting common user pain points during upgrades
- Providing actionable workflows to transition your projects

Note: This guide targets user-facing changes, not internal implementation details. It complements the detailed breaking changes and deprecation notices documented elsewhere.


## 2. Key Considerations When Upgrading

### 2.1 C++ Standard Compatibility

The recent GoogleTest versions **require at least C++17**. Ensure your build system specifies this minimum to avoid build failures:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

If your project currently targets an earlier standard, upgrade your compiler settings before migrating GoogleTest/GoogleMock.


### 2.2 Mock Method Declaration Syntax Changes

GoogleMockâ€™s syntax for declaring mock methods has evolved to better support qualifiers like `noexcept` and ref-qualifiers. When upgrading:

- Verify all `MOCK_METHOD` declarations in your mocks meet the new syntax introduced in later major releases.
- Adjust older mock method macros to the updated form, ensuring explicit declaration of method qualifiers.

Example before:

```cpp
MOCK_METHOD(int, Foo, (int x));
```

Might require updating to:

```cpp
MOCK_METHOD(int, Foo, (int x), (const, noexcept));
```

Check the latest mocking framework reference and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for exact syntax details.


### 2.3 Behavioral Changes in Expectations and Uninteresting Calls

Expectations set via `EXPECT_CALL` and default actions defined by `ON_CALL` have subtle semantic adjustments. These changes may:

- Affect how frequently calls are verified and reported
- Modify the handling of unexpected or uninteresting calls

To avoid surprises:

- Audit your tests for suppressed warnings or ignored mock calls.
- Use the verbose mock mode flag (`--gmock_verbose=info`) during test runs to identify unexpected behavior.
- Adjust cardinalities and mock strictness as needed.


### 2.4 Death Test Handling in Multi-threaded Contexts

Upgraded releases enhance safety and correctness of death tests when run in multithreaded environments.

- Review your death tests to ensure they do not rely on unsafe global state or timing assumptions.
- Follow recommended practices for writing thread-safe death tests as detailed in the GoogleTest Primer and advanced guides.


## 3. Step-by-Step Upgrade Workflow

### Step 1: Update Build Environment

- Confirm your compiler supports at least C++17.
- Update build system files (`CMakeLists.txt`, Bazel build files) to require C++17.
- Clean and rebuild all test binaries to catch compiler or linker issues early.


### Step 2: Sync GoogleTest and GoogleMock Dependencies

- Use matching major/minor version tags for GoogleTest and GoogleMock to prevent incompatibilities.
- If integrated as submodules or fetched during build, update hashes and versions accordingly.


### Step 3: Modify Mock Classes

- Revisit all `MOCK_METHOD` macros in your mocks.
- Add missing qualifiers or update macro usage according to the new API.
- Replace any deprecated mock constructs.


### Step 4: Verify and Adjust Test Expectations

- Run all tests with verbose mocking output enabled.
- Diagnose unexpected or missing calls.
- Adjust call cardinalities (`Times()`, `AtLeast()`, `AnyNumber()`) as appropriate.
- Address any broken sequences or ordering dependencies.


### Step 5: Audit Death Tests

- Confirm death tests pass consistently under your environment.
- Refactor tests relying on unsafe timing assumptions or shared state.


### Step 6: Run Full Test Suite and Address Failures

- Run all tests and watch for new failures or unexpected warnings.
- Use failure messages to identify migration issues.
- Document any workarounds or temporary adjustments needed.


## 4. Common Pitfalls and How to Avoid Them

### Problem: Build Failures Due to Missing C++17

- **Solution**: Explicitly set C++17 standard in your build configuration.

### Problem: Mock Methods Not Recognized or Failing to Compile

- **Solution**: Update the `MOCK_METHOD` declarations with required qualifiers and syntax.

### Problem: Unexpected Calls Failing Tests

- **Solution**: Use verbose mock logging to detect mismatches; adjust `EXPECT_CALL` strictness or cardinalities.

### Problem: Death Tests Fail Intermittently

- **Solution**: Ensure thread-safety and isolate death tests from shared global state.


## 5. Best Practices for Smooth Upgrades

- Keep GoogleTest and GoogleMock versions in sync to avoid subtle incompatibilities.
- Regularly review the breaking changes document and upgrade guides with each release.
- Use feature flags or macros provided to toggle behavior if you cannot immediately migrate certain tests.
- Adopt continuous integration to catch upgrade issues early.
- Leverage community resources, FAQs, and cookbooks for patterns and troubleshooting.


## 6. Example Migration Snippet

```cpp
// Old style
MOCK_METHOD(int, Calculate, (int x));

// Updated style with qualifiers
MOCK_METHOD(int, Calculate, (int x), (const, noexcept));
```

Run with increased mock verbosity:

```
./test_binary --gmock_verbose=info
```

Watch logs for unexpected calls and adjust tests accordingly.


## 7. Troubleshooting Tips

- **Linking errors**: Confirm both GoogleTest and GoogleMock are linked correctly.
- **Unexpected mock calls**: Review call order, cardinalities, and default actions.
- **Compiler errors on mock macros**: Check macro arguments and compiler compatibility with the new standard.
- **Death test failures**: Isolate test cases, ensure no interference between threads.


## 8. Additional Resources

- [GoogleTest Breaking Changes](https://github.com/google/googletest/blob/main/changelog/breaking-changes-and-migration/breaking-changes.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://github.com/google/googletest/blob/main/reference/mocking.md)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [Common Setup Issues](https://github.com/google/googletest/blob/main/docs/common-setup-issues.md)


---

## Conclusion

Upgrading your GoogleTest and GoogleMock test suite between major versions is a manageable process with the right guidance. By following this stepwise approach, focusing on compiler compatibility, mock method syntax, expectation adjustments, and death test safety, you will ensure your tests remain robust and maintainable. Keep abreast of official changelogs and best practices to minimize downtime and improve test quality.


<Check>
Always back up your current working codebase before attempting any major upgrade.
</Check>

<Note>
This guide complements detailed breaking changes documentation; always consult both when migrating.
</Note>