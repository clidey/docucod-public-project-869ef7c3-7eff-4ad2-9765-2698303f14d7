---
title: "Upgrade Guides"
description: "Step-by-step instructions and best practices for upgrading between major and minor GoogleTest versions. Addresses common pain points, migration tooling, and ways to validate code stability post-upgrade."
---

# Upgrade Guides

Step-by-step instructions and best practices for upgrading between major and minor GoogleTest versions. Addresses common pain points, migration tooling, and ways to validate code stability post-upgrade.

---

## Introduction

Upgrading GoogleTest across major and minor versions can bring powerful new features, bug fixes, and performance improvements to your testing suite. However, transitions between versions may introduce breaking changes or subtle behavioral differences that require your attention.

This guide walks you through the process of upgrading GoogleTest with a focus on minimizing disruption and maximizing test stability. By following our structured approach, you'll gain confidence in your upgraded test environment and avoid common pitfalls.

---

## Upgrade Workflow

Upgrading GoogleTest involves several key steps to ensure your codebase remains functional and your tests continue to validate behavior as intended. This process is designed to incrementally guide users through from initial preparation to post-upgrade validation.

<Steps>
<Step title="Preparation and Version Review">
Before upgrading, identify the current and target GoogleTest versions and review the corresponding release notes and upgrade instructions. Pay special attention to breaking changes, deprecated features, and new default behaviors that may affect your tests.
</Step>
<Step title="Migration Planning">
Plan the upgrade strategy: decide whether to move incrementally through minor versions or upgrade directly to a major version. Assess your test coverage and note any test cases that may be affected by changes.
</Step>
<Step title="Codebase Update and Dependency Management">
Update your build dependencies to point to the target GoogleTest version. For example, when using CMake, update fetch scripts or package versions accordingly. Validate that your build system correctly links against the new libraries.
</Step>
<Step title="Update Mock Classes and Expectations">
If you use GoogleMock, review and update mock class definitions and set expectations. For example, migration may require converting legacy `MOCK_METHODn` macros to the new `MOCK_METHOD` macro syntax, ensuring proper usage of qualifiers like `(const, override)`, and handling changes in default mock behaviors.
</Step>
<Step title="Run Existing Tests and Observe Failures">
Execute your entire test suite against the new version. Identify any failures or warnings related to mocks, expectations, or test logic.
</Step>
<Step title="Adapt Tests and Fix Issues">
Modify failing tests to comply with the latest GoogleTest and GoogleMock syntax and semantics. This can include:
- Adding explicit `ON_CALL` for mock methods to set default actions
- Using `NiceMock` or `StrictMock` wrappers appropriately
- Adjusting ordering constraints and cardinalities for expectations
- Ensuring mock methods correctly override base methods with qualifiers
</Step>
<Step title="Perform Validation and Stability Checks">
Run tests repeatedly to ensure stability and consistent results. Leverage verbosity flags such as `--gmock_verbose=info` for additional diagnostic details.
</Step>
<Step title="Complete Upgrade and Document Changes">
Integrate the upgraded GoogleTest version into your main development branches. Document the upgrade steps, key changes, and any necessary ongoing maintenance.
</Step>
</Steps>

---

## Common Upgrade Pain Points and Remedies

### Migrating from Legacy Macros

Older projects may use the deprecated `MOCK_METHODn` macros. It is strongly recommended to transition to the unified `MOCK_METHOD` macro, which improves code clarity and compatibility.

**Example Migration**:

```cpp
// Legacy old syntax
MOCK_METHOD1(Foo, bool(int));
// New syntax
MOCK_METHOD(bool, Foo, (int), (override));
```

### Handling Method Qualifiers

Mock methods overriding `const`, `noexcept`, or methods with reference qualifiers must use corresponding specification in the `MOCK_METHOD` macro:

```cpp
MOCK_METHOD(bool, Bar, (int), (const, noexcept, override));
MOCK_METHOD(int, Baz, (), (ref(&), override));
```

### Managing Uninteresting Calls

Ensure mock expectations correctly reflect which methods can be called without explicit expectations. To suppress warnings for uninteresting calls, wrap mocks in `NiceMock`:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
```

To enforce strict behavior, use `StrictMock`:

```cpp
using ::testing::StrictMock;
StrictMock<MockFoo> mock_foo;
```

### Default Actions with `ON_CALL`

`ON_CALL` is essential for setting the default behavior of mock methods not covered by `EXPECT_CALL`. This is especially important after upgrading to avoid unexpected warnings or failures.

```cpp
ON_CALL(mock_foo, Foo(_)).WillByDefault(Return(true));
```

### Expectation Ordering and Cardinality

Transitions may cause changes in how expectations are matched or ordered. Review your `EXPECT_CALL` directives and sequences (`InSequence`) to make sure calls occur as expected.

Use `.RetiresOnSaturation()` if you want expectations to deactivate after being met:

```cpp
EXPECT_CALL(mock_foo, Bar())
    .Times(2)
    .RetiresOnSaturation();
```

---

## Migration Tooling

To ease the upgrade, Google provides tooling and scripts (if available) to automate common migration tasks such as converting deprecated mocks macros to new syntax, applying proper qualifiers, and adding default actions.

Refer to the GoogleTest GitHub repository and contribution documentation for up-to-date scripts.

---

## Validating Code Stability Post-Upgrade

- Use the `--gmock_verbose=info` flag to get detailed logs of expectations and mock calls.
- Run your full test suite multiple times to detect flaky failures.
- Employ continuous integration to verify the upgrade under different environments.

Check for:
- Unexpected uninteresting call warnings or errors.
- Changes in default return values caused by updates in `DefaultValue<T>` or `ON_CALL` defaults.
- Order-sensitive test failures due to stricter call sequences or cardinalities.

---

## Best Practices for Smooth Upgrading

- Keep GoogleTest and GoogleMock versions in sync.
- Always set explicit default actions using `ON_CALL` for complex mocks.
- Prefer `NiceMock` during normal development to reduce noise.
- Reserve `StrictMock` for areas where strict interaction verification is crucial.
- Avoid mocking classes you donâ€™t own; instead, use adaptors.
- Regularly review and refactor mocks and test code using the latest syntax.

---

## Troubleshooting

<AccordionGroup title="Common Upgrade Issues">
<Accordion title="Mock Methods Invoking Real Methods">
This usually happens if mocked methods are not virtual or the signatures do not exactly match. Verify that all mock methods override virtual methods correctly with proper qualifiers.
</Accordion>
<Accordion title="Uninteresting Calls Warning Messages">
Consider switching to `NiceMock` or setting default actions explicitly using ON_CALL to suppress warnings.
</Accordion>
<Accordion title="Compilation Failures on MOCK_METHOD Macros">
Check for proper use of parentheses around template arguments that contain commas or consider using type aliases.
</Accordion>
<Accordion title="Unexpected Test Failures After Upgrade">
Run tests with verbosity flags and carefully review expectation setup, especially call order and cardinalities.
</Accordion>
</AccordionGroup>

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Detailed recipes and examples.
- [Mocking Reference](../api-reference/mocking/mock-methods.md): Comprehensive API documentation for mocking.
- [Breaking Changes](../changelog/breaking-changes-and-migration/breaking-changes.md): Important migration and breaking change details.
- [Troubleshooting Common Issues](../getting-started/troubleshooting-validation/common-issues.md): Help for common upgrade and usage problems.

---

## Summary

By following these upgrade guides, you ensure a smooth transition to newer versions of GoogleTest, preserving the stability and reliability of your tests while embracing new features and fixes. Carefully plan, test, and validate upgrades, and leverage GoogleMock best practices for mocking and expectations to reduce technical debt.

---

##### Source
[Repository](https://github.com/google/googletest) branch: main
