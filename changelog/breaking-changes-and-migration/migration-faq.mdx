---
title: "Migration FAQ"
description: "Answers common questions about migrating between major releases, explains how to address deprecated interfaces, and provides actionable steps for a smooth transition."
---

# Migration FAQ

This page addresses common questions you may encounter while migrating between major GoogleTest and GoogleMock releases. It helps you understand deprecated interfaces and guides you through actionable steps to ensure a smooth transition and maintain robust test suites.

---

## Why Am I Seeing Compilation Errors with MOCK_METHOD After Migration?

The new `MOCK_METHOD` macro replaces the older `MOCK_METHODn` style macros previously used to define mock methods. It now takes parameters in the following format:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

### Migration Tips:

- Enclose argument lists and method qualifiers within parentheses.
- If your return type or argument types contain commas, wrap them in an additional pair of parentheses or use type aliases to avoid parsing issues.

Example transition:

```cpp
// Old style
MOCK_METHOD1(Foo, bool(int));

// New style
MOCK_METHOD(bool, Foo, (int));
```

For detailed syntax and scenarios, see the [Mock Object Definition](../api-reference/gmock-mocking-apis/mock-object-definition) page.

---

## How Should I Mock Methods with Commas or Complex Signatures?

When return types or argument types contain commas (such as `std::pair` or templated types), `MOCK_METHOD` parsing requires special care.

Two solutions exist:

1. **Wrap types in parentheses**:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
```

2. **Use type aliases**:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

This ensures that the macro parses the arguments correctly without errors.

---

## What About Old-Style `MOCK_METHODn` Macros?

The older `MOCK_METHODn` macros (like `MOCK_METHOD0`, `MOCK_CONST_METHOD1_T`) remain supported but are deprecated. Transitioning to the new `MOCK_METHOD` syntax is recommended for cleaner, more maintainable code.

| Old Macro                                   | New Macro Example                                         |
| ------------------------------------------- | --------------------------------------------------------- |
| `MOCK_METHOD1(Foo, bool(int))`               | `MOCK_METHOD(bool, Foo, (int))`                            |
| `MOCK_CONST_METHOD1(Foo, bool(int))`         | `MOCK_METHOD(bool, Foo, (int), (const))`                   |
| `MOCK_METHOD1_T(Foo, bool(int))`              | `MOCK_METHOD(bool, Foo, (int))`                            |
| `MOCK_CONST_METHOD1_T(Foo, bool(int))`        | `MOCK_METHOD(bool, Foo, (int), (const))`                   |
| `MOCK_METHOD1_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, bool(int))` | `MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)))` |

*Refer to the [Mock Object Definition](../api-reference/gmock-mocking-apis/mock-object-definition) for detailed mappings and migration examples.*

---

## How Do I Handle Unprotected Commas in Method Signatures?

If your arguments or return types have unprotected commas, it causes parsing failures.

- Wrap complex types with parentheses or use `using` type aliases.
- Avoid unparenthesized commas in macro arguments.

Example:

```cpp
using MapIntDouble = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

---

## How to Manage Mock Strictness with `NiceMock`, `NaggyMock`, and `StrictMock`?

- **NaggyMock** (default): Warns on calls to methods with no expectations.
- **NiceMock**: Suppresses warnings on such calls.
- **StrictMock**: Treats such calls as test failures.

Consider usage based on your testing needs:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
``` 

*Strictness wrappers only apply to methods mock-defined directly in the mock class.*

---

## How Do I Mock Overloaded Methods or Templates?

- Overloads are mocked by declaring all variants using `MOCK_METHOD`, each matching one signature.
- If some overloads are not mocked, bring others into scope with `using BaseClass::Method;` to prevent hiding.
- Templates are mocked the same way as regular methods, using the new macro syntax.

Example of overloaded method mocking:

```cpp
MOCK_METHOD(int, Add, (int x), (override));
MOCK_METHOD(int, Add, (int times, int x), (override));
```

See the [Mock Object Definition](../api-reference/gmock-mocking-apis/mock-object-definition) for detailed examples.

---

## How to Delegate Mock Methods to Fakes, Real Objects, or Parent Classes?

To reuse existing behavior in mocks, you can delegate calls:

- **To a fake:**

```cpp
ON_CALL(*this, DoThis).WillByDefault([this](int n) { return fake_.DoThis(n); });
```

- **To a real object:**

```cpp
ON_CALL(*this, DoThis).WillByDefault([this](int n) { return real_.DoThis(n); });
```

- **To a parent class method:**

```cpp
ON_CALL(mock, Concrete).WillByDefault([&mock](const char* s) { return mock.BaseClass::Concrete(s); });
```

This allows precise control and avoids excessive mock code.

---

## How Can I Force Verification of Mock Objects Before Destruction?

Sometimes a mock is owned by the code under test and might not be destroyed promptly. Use:

```cpp
::testing::Mock::VerifyAndClearExpectations(&mock_object);
```

to verify expectations explicitly before destruction.

---

## Are There Special Considerations When Mocking Move-Only Types?

gMock supports mocking methods with move-only types (e.g., `std::unique_ptr`) using the new `MOCK_METHOD` syntax. Actions that return or accept move-only types can often use lambdas for flexibility.

Legacy workarounds involved delegating methods to mock methods with raw pointers, but modern usage should prefer the straightforward approach.

---

## How to Improve Compilation Times for Large Mocks?

Since mock constructors and destructors can be heavy to compile, move their definitions out of headers into `.cc` files:

In header:

```cpp
class MockFoo : public Foo {
 public:
  MockFoo();
  ~MockFoo() override;
  MOCK_METHOD(int, DoThis, (), (override));
};
```

In source:

```cpp
MockFoo::MockFoo() {}
MockFoo::~MockFoo() {}
```

---

## How Can I Control gMock Output Verbosity?

gMock uses the flag `--gmock_verbose=LEVEL`:

- `info`: Most verbose, logs all expectations and calls with stack traces.
- `warning`: Default, warnings and errors without stack traces.
- `error`: Only errors.

You can also adjust verbosity programmatically:

```cpp
::testing::FLAGS_gmock_verbose = "error";
```

Trace output helps diagnose why expectations are not met.

---

## Additional Helpful Resources

- [Mock Object Definition](../api-reference/gmock-mocking-apis/mock-object-definition)
- [Expectations and Behavior Specification](../api-reference/gmock-mocking-apis/expectations-specification)
- [Actions Reference](../api-reference/gmock-mocking-apis/actions)
- [Matchers Reference](../api-reference/gmock-mocking-apis/matchers)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Legacy gMock FAQ](../docs/gmock_faq.md)

---

For more details, examples, and best practices, refer to the [Mocking Reference](../docs/reference/mocking.md) and the [gMock for Dummies](../docs/gmock_for_dummies.md) guide.

---

*This FAQ aims to ease transition pains by clarifying common migration questions and pointing you to relevant up-to-date patterns and examples.*