---
title: "Breaking Changes Summary"
description: "Summarizes all breaking changes across recent versions of GoogleTest and GoogleMock, including API removals, signature changes, and altered behaviors. Helps users quickly assess upgrade risk and identify required code modifications."
---

# Breaking Changes Summary

This page summarizes all significant breaking changes introduced across recent versions of GoogleTest and GoogleMock, focusing specifically on the mocking framework's API removals, signature changes, and altered behaviors. It is designed to help users quickly assess upgrade risks and identify necessary code modifications when transitioning between versions.

---

## Understanding Breaking Changes in GoogleMock

Breaking changes represent modifications to public APIs or behavior that require users to adjust their existing test code when upgrading to a new version. This page covers changes that affect mock object definitions, expectation syntax, mock method declarations (`MOCK_METHOD`), and mock behavior configurations (`EXPECT_CALL`, `ON_CALL`).

Before upgrading, it is critical to review this summary to ensure your test suites continue to compile and run correctly without unexpected failures.


## Common Categories of Breaking Changes

1. **API Removals and Renaming**
   - Deprecated macros such as `MOCK_CONST_METHODn` have been replaced by the more generic `MOCK_METHOD` with qualifiers.
   - Legacy `MOCK_METHODn` family macros have been superseded by the unified `MOCK_METHOD` macro.

2. **Method Signature Changes**
   - The syntax for mocking overloaded or templated methods now requires careful distinction, e.g., explicit use of qualifiers like `(const, override)`.
   - Mocking move-only types has been enhanced but requires awareness of construction and action limitations.

3. **Behavioral Changes in Expectations and Actions**
   - The order and rules for clauses in `EXPECT_CALL` and `ON_CALL` (such as `.With()` must come first, `.WillByDefault()` must appear exactly once) are strictly enforced.
   - Introduced stricter checks on the number and order of `WillOnce()` and `WillRepeatedly()` clauses.

4. **Removal or Modification of Deprecated Components**
   - Older mocking patterns for private/protected methods must now adhere to public placement of mock methods.
   - Macros for mocking destructors directly (`MOCK_METHOD(void, ~ClassName,)`) are not supported; users must adapt by providing a `Die()` method or alternative.


## Practical Impact and Migration Advice

- **Unified MOCK_METHOD**: Transition all mocks to use the `MOCK_METHOD` macro with optional qualifiers `(const, override, noexcept, Calltype(...), ref(...))`. Avoid legacy `MOCK_CONST_METHODn` and other variants.

- **Mocking Move-Only Types**: When mocking methods that accept or return move-only types (e.g., `std::unique_ptr`), ensure correct usage with `WillOnce` lambdas or callables rather than repeated `Return(std::move(...))`.

- **Clause Ordering in EXPECT_CALL and ON_CALL**:
  - Place `.With()` before `.Times()`, `.InSequence()`, `.After()`, and `.WillOnce()`.
  - Call `.WillByDefault()` exactly once in each `ON_CALL` statement.
  - Avoid multiple `.WillRepeatedly()` or `.RetiresOnSaturation()` calls per expectation.

- **Handling Uninteresting Calls**:
  - Mocks are Naggy by default; use `NiceMock<>` or `StrictMock<>` to suppress or elevate uninteresting call warnings respectively.


## Major Breaking Change Examples

### 1. Switching from Legacy MOCK_METHODn to New MOCK_METHOD

**Old Style:**
```cpp
MOCK_CONST_METHOD2(Foo, int(int, int));
```

**New Style:**

```cpp
MOCK_METHOD(int, Foo, (int, int), (const, override));
```


### 2. Enforcing .With() Clause Position

Incorrect usage results in runtime error or test failure:

```cpp
EXPECT_CALL(mock, Foo(5)).Times(1).With(_);  // Invalid - .With() must come first
```

Correct usage:

```cpp
EXPECT_CALL(mock, Foo(5)).With(_).Times(1);
```


### 3. Mocking Move-Only Types

Proper usage when returning move-only objects:

```cpp
EXPECT_CALL(mock, MakeBuzz(_))
    .WillRepeatedly([](StringPiece text) { 
        return std::make_unique<Buzz>(AccessLevel::kInternal); 
    });
```

Avoid specifying `Return(std::move(...))` for repeated calls to prevent runtime errors.


### 4. Mocking Destructors

Destructors cannot be mocked directly. Adapt your mock class as follows:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```
Then set expectations on `Die()`.


## Recommended Upgrade Steps

1. Review all mock classes for legacy `MOCK_METHODn` or `MOCK_CONST_METHODn` macros; replace with `MOCK_METHOD` syntax.
2. Audit `EXPECT_CALL` and `ON_CALL` usages for clause orderingâ€”reorder or fix violations.
3. Check for usage of move-only types and adapt actions accordingly.
4. Update test-wide mocks to use `NiceMock` or `StrictMock` as needed to manage warnings or errors from uninteresting calls.
5. Refactor destructor mocking as per the recommended pattern.
6. Run your tests with `--gmock_verbose=info` to identify any hidden breaking issues.


## Troubleshooting Common Breakage

- **Compilation Errors on Mock Method Declarations:** Ensure correct use of `MOCK_METHOD(..., (const, override))` for const methods.

- **Runtime Failures Saying `.With()` Call Misuse:** Check clause order and uniqueness.

- **Unexpected Behavior with Move-Only Types:** Use lambdas or callable objects instead of `Return()` to generate new objects dynamically.

- **Silent Test Passes or Failures on Mock Destruction:** Make sure destructors follow the `Die()` pattern and expectations are set accordingly.


## Additional Resources

- [Mocking Reference](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Best Practices](https://google.github.io/googletest/guides/mocking-best-practices.html)
- [Using Mocks in Tests (Dummies Guide)](https://google.github.io/googletest/gmock_for_dummies.html#using-mocks-in-tests)
- [Integration & Ecosystem](overview/feature-highlights-integration/integration-ecosystem.md)


---

For a detailed migration guide with step-by-step instructions on each breaking change and sample fixes, visit the **Migration Guides** section in the Changelog.


<Tip>
Always back up your existing tests before upgrading, and run full test suites with increased verbosity to detect potential breakages early.
</Tip>


---

_Last updated: June 2024_

