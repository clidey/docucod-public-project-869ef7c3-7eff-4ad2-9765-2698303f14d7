---
title: "Breaking Changes"
description: "Detailed explanations of changes that require code or configuration modification, including compiler requirements or behavior updates. Each entry summarizes the impact, rationale, and links to remediation instructions."
---

# Breaking Changes

This page details changes that require users to modify their code or configuration when upgrading to newer versions of GoogleMock. Each entry explains the reason for the change, the impact on user tests and mocks, and provides guidance on how to adapt your code. Being aware of these breaking changes will ensure smooth upgrades and maintain test stability.

---

## 1. Minimum Compiler Requirements Increased

- **Impact:** Users must compile GoogleMock with a C++17-capable compiler or newer.
- **Details:** Support for older C++ standards has been dropped. GoogleMock requires that your compiler supports C++17 features. For MSVC, at least Visual C++ 2015 (14.0) or newer is mandatory.
- **Rationale:** Leveraging C++17 enables more modern, efficient, and safer implementations within the framework.

### What You Need To Do

- Verify your compiler version fulfills the C++17 standard support requirement.
- Update your build system flags to enable C++17 mode if not already set. For example, pass `-std=c++17` to GCC/Clang or set appropriate project language levels in IDEs.

---

## 2. Updated Flag Handling and Initialization Behavior

- **Impact:** Command-line flag parsing has been refined; GoogleMock flags are removed from the argument list during initialization.
- **Details:** The function `InitGoogleMock` now parses known flags like `--gmock_verbose` and `--gmock_default_mock_behavior` explicitly and removes them from `argv`. Unrecognized flags remain in `argv`.
- **Rationale:** This change enhances clarity and prevents conflicts with other components parsing command-line flags.

### What You Need To Do

- When parsing command-line arguments yourself, be aware GoogleMock can modify `argv` by removing its flags.
- Specify mock-related flags using the documented names. For example, use `--gmock_verbose=warning` to control verbosity.
- You can selectively initialize GoogleMock with wide-character command lines where applicable.

---

## 3. Strictness Wrappers (`NiceMock`, `NaggyMock`, `StrictMock`) Behavior Changes

- **Impact:** The default base mock behavior is being transitioned from NaggyMock-like (warnings on uninteresting calls) to NiceMock-like (silently allowing uninteresting calls).
- **Details:**
  - **NiceMock:** Suppresses warnings for uninteresting calls, still allows matches and verifies expectations.
  - **NaggyMock:** Currently default; prints warnings on uninteresting calls.
  - **StrictMock:** Treats all uninteresting calls as test failures.

The transition affects how uninteresting mock method calls behave if no explicit expectation (`EXPECT_CALL`) is set.

### What You Need To Do

- For tests currently relying on NaggyMock behavior, explicitly wrap mocks in `NaggyMock` if you want to preserve warning messages.
- To avoid warnings for uninteresting calls, use `NiceMock`.
- For stricter enforcement, use `StrictMock`.
- Avoid nesting strictness wrappers.

### Example Usage

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;
using ::testing::NaggyMock;

// Silences uninteresting call warnings
NiceMock<MockFoo> nice_mock;

// Converts uninteresting calls into failures
StrictMock<MockFoo> strict_mock;

// Displays warnings for uninteresting calls (legacy default)
NaggyMock<MockFoo> naggy_mock;
```

---

## 4. Mock Method Definition Using `MOCK_METHOD` Macro

- **Impact:** The newer, more flexible `MOCK_METHOD` macro replaces the older fixed-arity `MOCK_METHODn` macros.
- **Details:**
  - `MOCK_METHOD` takes the return type, method name, argument list (parenthesized), and optional qualifiers (e.g., `const`, `override`).
  - It supports method qualifiers, calling conventions, complex types with commas, and template methods more reliably.

### What You Need To Do

- Migrate any existing mocks using `MOCK_METHODn` macros to the new `MOCK_METHOD` format.
- Wrap complex argument types containing commas in extra parentheses.
- Supply qualifiers where applicable to match the method you override.

### Example

```cpp
class MockFoo {
 public:
  MOCK_METHOD(bool, IsOpen, (), (const, override));
  MOCK_METHOD(int, Calculate, (int a, int b), (override));
};
```

---

## 5. Improved Support for Mocking Move-Only Types

- **Impact:** Mocking methods that take or return move-only types is now supported with the native `MOCK_METHOD` macro.
- **Details:**
  - You can mock methods taking or returning `std::unique_ptr` or other move-only types directly.
  - Some legacy workarounds (e.g., delegating move-only arguments to pointer-taking mock methods) are deprecated.

### What You Need To Do

- Define mock methods with move-only parameter or return types using `MOCK_METHOD`.
- Use lambdas or callable objects in `WillOnce()`, `WillRepeatedly()` to provide behavior for such methods.

### Example

```cpp
class Buzzer {
 public:
  virtual std::unique_ptr<Buzz> MakeBuzz(StringPiece text) = 0;
  virtual bool ShareBuzz(std::unique_ptr<Buzz> buzz, int64_t timestamp) = 0;
};

class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
  MOCK_METHOD(bool, ShareBuzz, (std::unique_ptr<Buzz> buzz, int64_t timestamp), (override));
};
```

---

## 6. Refined Behavior for Default Actions and Uninteresting Calls

- **Impact:** `ON_CALL` and `EXPECT_CALL` clause precedence clarified; the most recent matching clauses take precedence.
- **Details:**
  - When multiple `ON_CALL` specifications exist for the same method, the last one matching the call is used.
  - Similarly, among `EXPECT_CALL` statements, the last declared expectation matching is used.
  - Uninteresting calls (no matching `EXPECT_CALL`) take the default action defined by `ON_CALL` or the type's default value.
  - Unexpected calls (calls matching the method but no matching arguments) always cause errors.

### What You Need To Do

- Arrange `ON_CALL` and `EXPECT_CALL` expectations carefully to reflect desired precedence.
- Use `EXPECT_CALL(...).Times(AnyNumber())` to suppress warnings on uninteresting calls for specific methods if needed.
- Use `DefaultValue<T>::Set()` cautiously to change default return values.

---

## 7. Changes in Handling Destructors in Mocks

- **Impact:** Destructors cannot be directly mocked. Instead, use an explicit mock method called within the destructor to verify destructions.
- **Details:**
  - GoogleMock macros do not support mocking destructors directly.
  - A common pattern is to add a `Die()` mock method to your mock class and call it from the destructor.

### What You Need To Do

- Add a mock method (e.g., `MOCK_METHOD(void, Die, ());`) in your mock class.
- Call this method from the destructor.
- Set expectations on the mock method `Die()` in tests to verify destruction order.

### Example

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};

TEST(FooTest, DestructorCalledAtRightTime) {
  MockFoo* foo = new MockFoo;
  MockBar* bar = new MockBar;
  {
    InSequence s;
    EXPECT_CALL(*bar, A());
    EXPECT_CALL(*foo, Die());
    EXPECT_CALL(*bar, B());
  }
}
```

---

## 8. Thread Safety Guarantees and Restrictions

- **Impact:** GoogleMock is thread-safe in its internals, but improper use may cause undefined behavior.
- **Details:**
  - It is safe to call mock functions from multiple threads.
  - Setting expectations and verifying mocks must be done in a single thread.
  - Actions are performed in the thread that calls the mock function.

### What You Need To Do

- Do not set `EXPECT_CALL` or `ON_CALL` expectations while other threads may invoke mock methods.
- Synchronize state shared by mock actions to avoid race conditions.

---

## Additional Recommendations

- **Migration Guides:** Consult the [Upgrade & Migration Guide](https://github.com/google/googletest/blob/main/UPGRADE.md) for detailed instructions on handling breaking changes.
- **Testing Your Upgraded Code:** Use `--gmock_verbose=info` flag to get detailed logging on mock behavior during test execution.

---

# Related Documentation

- [Defining Mock Methods and Classes](https://google.github.io/googletest/reference/mocking.html#mock-methods)
- [Setting Call Expectations and Cardinalities](https://google.github.io/googletest/reference/mocking.html#expect-call)
- [Configuring Mock Behavior with Actions](https://google.github.io/googletest/reference/actions.html)
- [Nice, Strict, Naggy Mocks](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy)
- [Initialization and Flags Reference](https://google.github.io/googletest/reference/gmock.html#InitGoogleMock)

---

# Troubleshooting

If tests fail after upgrading due to stricter mock behavior or flag changes:

- Check if mocks now treat uninteresting calls as failures; change strictness wrappers accordingly.
- Verify compiler version and build flags meet new C++17 requirement.
- Review console output for unexpected calls or warnings; increase verbosity for debugging.

---

# Summary

Upgrading GoogleMock may require code changes primarily in your mocking classes and test configurations to comply with updated macro usage, strictness behavior, and compiler requirements. This is a positive evolution enabling more expressive testing, better error detection, and compatibility with modern C++ standards.

---

# Revision History

Not part of this page. See the [Historical Releases](./historical-releases) page for a timeline of changes and deprecations.

---

For further assistance, refer to the community and support resources listed in the [Support & Help](../../faq/community-resources/support-help) section.