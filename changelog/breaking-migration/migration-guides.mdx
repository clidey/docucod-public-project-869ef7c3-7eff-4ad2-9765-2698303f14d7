---
title: "Migration & Upgrade Guides"
description: "Step-by-step guidance on upgrading between key versions, with hands-on instructions, configuration file edits, and best practices to ensure safe transitions, especially when significant changes affect project integration."
---

# Migration & Upgrade Guides

This guide provides clear, hands-on guidance to help you smoothly upgrade your GoogleTest and GoogleMock integration between key versions. It covers step-by-step instructions, configuration updates, and best practices to ensure safe transitions, especially when significant changes affect your project's build and test setup.

---

## 1. Overview of Upgrade Process

Upgrading GoogleTest and GoogleMock requires careful attention to API changes, language standard requirements, and build configurations. This guide focuses solely on the migration steps and upgrade best practices to keep your test environment stable and maintainable.

---

## 2. Prerequisites Before Upgrading

Before starting your upgrade:

- Ensure your project is compiled with **C++17 or later**, as GoogleTest 1.17.x and beyond require this minimum standard.
- Verify your build environment supports necessary compiler features, such as thread-local storage, exceptions, and RTTI, which are now assumed.
- Back up your existing test code and build configurations.

**Tip:** Consult the [System Requirements & Supported Platforms](https://google.github.io/googletest/getting-started/prerequisites-installation/system-requirements) guide for detailed environment checks.

---

## 3. Step-by-Step Upgrade Instructions

### Step 1: Update Language Standard

Update your project build files (e.g., CMakeLists.txt, Bazel BUILD) to enforce at least C++17. Example for CMake:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Confirm your compiler version supports C++17 fully.

### Step 2: Use the New `MOCK_METHOD` Macro

- Replace any legacy `MOCK_METHODn` macros with the generic `MOCK_METHOD` macro.
- The new macro takes explicit method return type, name, parameter list, and optional qualifiers.

Example migration:

```cpp
// Legacy
MOCK_METHOD1(Foo, bool(int));

// Upgraded
MOCK_METHOD(bool, Foo, (int), (override));
```

**Important:** Wrap complex return or parameter types that contain commas in extra parentheses or use type aliases to avoid parsing errors.

Refer to the [Mock Object Definition](https://google.github.io/googletest/api/gmock_reference.html#mock-object-definition) page for full syntax details.

### Step 3: Specify Qualifiers Explicitly

- Specify qualifiers such as `(const)`, `(override)`, `(noexcept)`, `Calltype(...)`, or `ref(...)` explicitly in the `MOCK_METHOD` macro.
- For example, a const method override should be:

```cpp
MOCK_METHOD(int, GetValue, (), (const, override));
```

### Step 4: Address Move-Only Types Support

- The new mocking macros support move-only types like `std::unique_ptr` seamlessly.
- When returning move-only types in tests, use lambdas or callable objects to create fresh values each call.

Example:

```cpp
EXPECT_CALL(mock, MakeBuzz("hello"))
    .WillRepeatedly([](StringPiece){
        return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

Legacy workarounds using forwarding mock methods are no longer necessary.

### Step 5: Adjust Build Flags and Definitions

- Confirm your build system aligns with the latest recommended compiler flags.
- For CMake, use the internal utilities (`config_compiler_and_linker`) to set proper flags including those disabling shared CRT when building static libraries.
- Ensure threading support macros (`GTEST_HAS_PTHREAD`) are correctly defined or detected.

### Step 6: Update Mock Strictness Policies

- Replace uses of old strictness policies if any, adopting `NiceMock`, `NaggyMock`, or `StrictMock` appropriately.

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
```

This controls how uninteresting calls are handled (ignored, warned, or error).

### Step 7: Run Tests in Verbose Mode to Catch Migration Issues

- Use `--gmock_verbose=info` to trace mock calls and expectation matches.
- This will help you identify uninitialized expectations or unexpected calls that may surface from migration.

### Step 8: Verify and Refine

- Rebuild your project and run all tests.
- Fix any compiler errors regarding qualifiers, overloads, or move-only usage.
- Fix runtime test expectation failures discovered during verbose runs.

---

## 4. Best Practices for Smooth Migration

- Set expectations (`EXPECT_CALL`) before exercising mocks to prevent undefined behavior.
- Use `ON_CALL` to set default behaviors without imposing call expectations.
- Utilize sequences (`InSequence`, `Sequence`) and `RetiresOnSaturation()` to control call ordering and expectation lifetime.
- When matching arguments with complex conditions, use matchers and `SafeMatcherCast` to resolve type ambiguities.
- Use type aliases or extra parentheses to wrap complex template types in mock macros.

---

## 5. Troubleshooting Common Upgrade Issues

**Problem:** Compilation errors about method qualifiers or overloads.
- **Solution:** Specify explicit qualifiers in `MOCK_METHOD`, disambiguate overloaded methods with `Const()` or explicit matchers.

**Problem:** Unexpected warnings about uninteresting calls.
- **Solution:** Wrap mocks with `NiceMock` or add catch-all `EXPECT_CALL(...).Times(AnyNumber())` expectations.

**Problem:** Runtime errors when returning move-only types multiple times.
- **Solution:** Use lambdas or functors to dynamically create return values instead of `Return(std::move(...))`.

**Problem:** Build failures due to threading or platform flags.
- **Solution:** Verify `GTEST_HAS_PTHREAD` or platform macros are defined appropriately in your build. Check the [portability utilities](api-reference/internal-utils-and-portability/portability-utils) documentation.

---

## 6. Related Documentation and Resources

- [Mock Object Definition](https://google.github.io/googletest/api/gmock_reference.html#mock-object-definition)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock for Dummies](docs/gmock_for_dummies.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Breaking Changes](changelog/breaking-migration/breaking-changes.md)
- [Deprecations and Removals](changelog/breaking-migration/deprecations-and-removals.md)
- [System Requirements & Supported Platforms](getting-started/prerequisites-installation/system-requirements.md)
- [Compiler and Linker Build Utilities](googletest/cmake/internal_utils.cmake)

---

## 7. Summary

Upgrading to the latest versions of GoogleTest and GoogleMock requires updating your project's C++ standard to at least C++17, replacing legacy mock macros with the modern `MOCK_METHOD`, properly specifying method qualifiers, and adjusting your build flags and threading support. Embrace the improved support for move-only types and adopt best mocking practices using `EXPECT_CALL` and `ON_CALL` appropriately. Leverage verbose test runs and available tooling to detect and ease migration pain points.

This guide empowers you to migrate effectively while maintaining robust test coverage and clearer mock expectations.