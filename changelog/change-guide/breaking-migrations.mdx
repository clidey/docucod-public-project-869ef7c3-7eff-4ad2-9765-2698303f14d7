---
title: "Breaking Changes & Migration Steps"
description: "Pinpoints disruptive changes in APIs, build requirements, or core behaviors, with actionable guidance for adapting codebases. Helps teams minimize risk and plan for smooth migrations."
---

# Breaking Changes & Migration Steps

GoogleTest's **Breaking Changes & Migration Steps** page is your authoritative guide to navigating disruptive updates in APIs, build requirements, and core behaviors. It equips you to confidently update your test codebases and mocking implementations, minimizing risk and downtime.

---

## Understanding Breaking Changes

Breaking changes are modifications that may render existing code incompatible or behave differently without adjustment. These can impact:

- **APIs:** Changes to method signatures, removal or renaming of functions
- **Build Requirements:** Updates in compiler or language standard requirements
- **Core Behaviors:** Alterations in default mock behaviors, expectation handling, or test lifecycle

Recognizing these changes early ensures you plan upgrading your code with minimal disruption.

## Key Migration Principles

Migration is more than fixing errors—it's about smoothly transitioning your code to leverage improvements without regression. Follow these principles:

- **Validate Impact:** Identify where breaking changes touch your code, focusing on mock definitions and function calls.
- **Progressive Adaptation:** Apply recommended migration steps incrementally.
- **Leverage Documentation:** Use Google's official migration guides and changelogs.
- **Test Thoroughly:** Re-run all tests after migration to catch integration issues early.

## Common Breaking Changes and How to Migrate

### Changes in `MOCK_METHOD` Usage

If you encounter errors related to mock method declarations, verify:

- Usage of the modern `MOCK_METHOD` syntax with appropriate parameters:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
```

- Parentheses around argument types containing commas (e.g., std::pair, std::map).

- Inclusion of necessary qualifiers such as `(const)`, `(override)`, `(noexcept)`, or `Calltype(...)`.

**Migration tip:** Switch from older `MOCK_METHODn` macros to `MOCK_METHOD` for better consistency and support.

### Expectation Setting and Ordering

Breaking changes may affect how expectations (`EXPECT_CALL`) are specified, ordered, or combined:

- Ensure all `EXPECT_CALL` statements precede calls to mock methods.
- Use the correct chaining order for clauses: `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, `.RetiresOnSaturation()`.
- For calls requiring order, utilize `InSequence` blocks or `Sequence` objects appropriately.

**Migration tip:** Review your tests for violation of sticky expectations or ordering requirements and refactor using documented syntax.

### Default Actions and Uninteresting Calls

Changes in defaults may alter whether uninteresting calls produce warnings or silent passes.

- Use `ON_CALL` to specify defaults explicitly.
- Apply `NiceMock`, `NaggyMock`, or `StrictMock` wrappers as needed to control warnings and failures.

**Migration tip:** Audit unexpected warnings or failures post-upgrade and explicitly control behaviors using wrappers or default action specifications.

### Compiler and Language Standard Updates

GoogleTest now mandates C++17 or later. If your build fails due to language features or compiler support:

- Confirm you are using a supported compiler version.
- Update build configurations (CMakeLists, Bazel BUILD files) to enable C++17.

**Migration tip:** Align all dependencies, including GoogleMock, with C++17.

### Handling Move-Only Types

If your mock methods use move-only types (e.g., `std::unique_ptr`), ensure:

- Use of lambda expressions or `WillOnce()` with callables to generate fresh values.
- Avoid reusing `Return(std::move())` for repeated calls to prevent runtime errors.

**Migration tip:** Review mocks for move-only usage patterns and replace `Return()` with suitable lambdas.

### Mock Verification and Life Cycle

Behavior changes might have affected when verification occurs or how leaks are detected.

- Explicitly call `Mock::VerifyAndClearExpectations()` if your mock is heap-allocated.
- Use `Mock::AllowLeak()` to suppress leak failures if intentional.

**Migration tip:** Incorporate verification calls as needed based on your framework usage.

---

## Step-by-Step Migration Checklist

<Steps>
<Step title="Review Mock Definitions">
Audit all mock classes for proper `MOCK_METHOD` usage with updated syntax and qualifiers.
</Step>
<Step title="Update Build to C++17">
Ensure your build environment targets C++17 or higher, updating compiler flags accordingly.
</Step>
<Step title="Adjust Expectation Statements">
Refactor `EXPECT_CALL` and `ON_CALL` usages to conform to updated chaining and matching rules.
</Step>
<Step title="Control Mock Strictness">
Apply `NiceMock`, `NaggyMock`, or `StrictMock` to manage uninteresting calls and warnings as appropriate.
</Step>
<Step title="Handle Move-Only Types Properly">
Use lambdas or callable objects for move-only return types instead of `Return(std::move(...))`.
</Step>
<Step title="Verify Mocks Explicitly if Needed">
Add explicit verification calls or allow leaks for heap-allocated mocks to avoid silent failures.
</Step>
<Step title="Run Full Test Suite and Debug">
Run all tests and increase verbosity with `--gmock_verbose=info` to trace unexpected behaviors.
</Step>
</Steps>

---

## Practical Migration Examples

### MOOC_METHOD Syntax Update

**Before:**

```cpp
MOCK_CONST_METHOD1(MockMethod, int(const std::string& s));
```

**After:**

```cpp
MOCK_METHOD(int, MockMethod, (const std::string& s), (const, override));
```

Wrap complex argument types in parentheses, and always prefer `MOCK_METHOD`.

### Expectation Chaining Order

**Correct Order:**

```cpp
EXPECT_CALL(mock, Foo(_))
    .With(AllArgs(Lt()))
    .Times(2)
    .InSequence(seq)
    .WillOnce(Return(1))
    .WillRepeatedly(Return(0))
    .RetiresOnSaturation();
```

Incorrect chaining might lead to errors or unexpected behaviors.

### Using NiceMock to Suppress Warnings

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, Bar()).Times(AnyNumber());
```

Suppresses warnings from methods with uninteresting calls.

---

## Troubleshooting Common Migration Issues

<AccordionGroup title="Common Problems and Solutions">
<Accordion title="Unexpected 'Uninteresting Mock Function Call' Warnings">
This appears if mock methods are called without explicit expectations.

- **Fix:** Use `NiceMock` or add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.
- **Tip:** Avoid indiscriminately suppressing; ensure you understand the calls before opting out.
</Accordion>
<Accordion title="Build Failures Related to MOCK_METHOD Macros">
Frequently caused by incorrect syntax or macro usage.

- **Fix:** Verify parentheses around complex argument types.
- Check for deprecated old `MOCK_METHODn` macros and switch to `MOCK_METHOD`.
</Accordion>
<Accordion title="Linker Errors After Update">
Ensure you linked the correct GoogleTest and GoogleMock libraries consistent with your framework version.

- **Fix:** Rebuild dependencies with updated versions.
- Confirm build flags match C++17 and ABI expectations.
</Accordion>
<Accordion title="Tests Failing Due to Call Order">
You may need to use sequences or `.InSequence()` to enforce expected call order.

- **Fix:** Wrap expectations in `InSequence` blocks or use `Sequence` variables with `.InSequence` clause.
</Accordion>
</AccordionGroup>


## Additional Migration Resources

- [Official gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) – Practical recipes and best practices.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) – Full API and clause details.
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) – Common questions and known issues.
- [System Requirements & Supported Platforms](../getting-started/prerequisites-installation-setup/system-requirements-supported-platforms.md) – Build environment configuration.
- [GoogleMock Changelog](../changelog/release-history/feature-highlights.md) – Release notes highlighting major changes.

---

## Summary

This page distills the moving parts that may break your existing GoogleTest and GoogleMock tests, offering precise guidance on how to migrate. By focusing on the user-centric goal of maintaining test quality while adapting to improved frameworks, this guide encourages careful, methodical upgrades.

---

<Tip>
Always use reproducible test runs and increased verbosity (`--gmock_verbose=info`) during migration to catch subtle behavioral changes early.
</Tip>

<Check>
Ensure your mocks have virtual destructors, especially after interface updates, to avoid memory leaks and undefined behavior.
</Check>