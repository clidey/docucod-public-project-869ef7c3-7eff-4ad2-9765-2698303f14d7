---
title: "Breaking Changes & Major Upgrades"
description: "Lists critical changes that impact backward compatibility, with contextual explanations and technical guidance. Users will find what adjustments are required when upgrading across major versions and how to adapt existing test suites."
---

# Breaking Changes & Major Upgrades

This page outlines critical changes to GoogleTest and GoogleMock that impact backward compatibility. Here, you'll find clear explanations of what adjustments are required when upgrading across major versions, coupled with actionable guidance on adapting existing test suites seamlessly.

---

## Understanding Breaking Changes

Upgrading to a new major version of GoogleTest or GoogleMock can introduce changes that may affect your existing tests and mock implementations. These changes are intentional to improve reliability, fix design shortcomings, or enhance API clarity. This page helps you identify such breaking changes and provides technical guidance for migrating your code.

### User Intent Focus

- **What to look for:** Identify if your upgrade might cause your tests or mocks to fail unexpectedly.
- **Outcome:** Make minimal, targeted code adjustments to comply with new API contracts or behavioral expectations.

---

## Major Changes Impacting Mocking

### Improved Mock Method Specification

- The transition from the older `MOCK_METHODn` macros to the unified `MOCK_METHOD` syntax introduces more explicit and consistent mock method declarations.

- **What you must do:**
  - Refactor your mock classes to use `MOCK_METHOD(return_type, method_name, (args...), (specs...));`.
  - Surround argument types containing commas with parentheses or define type aliases to avoid parsing errors.

- **Example migration:**
```cpp
// Old style
MOCK_METHOD1(Foo, bool(int));

// New style
MOCK_METHOD(bool, Foo, (int));
```

### Qualifier Specification

- Qualifiers like `const`, `override`, and `noexcept` must now be explicitly specified in the fourth parameter of `MOCK_METHOD`.

- **Migration tip:** Review overridden methods in your mocks, ensure qualifying specifiers are included.

### Enhanced Support for Overloaded Methods

- When mocking overloaded functions, explicitly mock each overload to prevent hidden base class methods.

- Use `using BaseClass::MethodName;` to bring base overloads into scope if not all are mocked.

### Mocking Non-Virtual Methods

- Support for mocking non-virtual methods is explicitly clarified.

- You can mock unrelated classes with `MOCK_METHOD` in mock classes without inheritance for dependency injection.

### Delegating Calls

- Delegation to fakes, real objects, or parent implementations requires explicit setup via `ON_CALL` and careful action definition.

---

## Expectation and Behavior Changes

### ON_CALL vs EXPECT_CALL

- **ON_CALL** specifies default behavior without expectation.
- **EXPECT_CALL** sets expectations and behavior for verification.

- When migrating, replace ambiguous or overly-constraining `EXPECT_CALL`s with appropriate `ON_CALL`s to improve test maintainability.

### New Clause Ordering

- The order of modifiers on expectations is now strictly enforced. For example, the `.With()` clause must come before `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, and `.WillRepeatedly()`.

- Violating order results in run-time errors during test execution.

### RetiresOnSaturation Changes

- Expectations now support the `.RetiresOnSaturation()` clause for automatically retiring after reaching call limits.

- This helps modeling call replacements and avoids over-saturation failures.

---

## Call Ordering and Sequencing

### Explicit Ordering

- The ordering of calls with `Sequence` objects and `.InSequence()` is now strictly enforced.

- You can define complex call graphs using `.After()` and sequences to model partial orders.

### Changes in Default Behavior

- By default, calls can occur in any order unless explicitly constrained.

- Moving to this version requires ensuring that any implicit order requirements are explicitly specified.

---

## Key Migration Steps

1. **Mock Method Declarations:** Update all mock class methods to use the new `MOCK_METHOD` macro with the necessary qualifiers.
2. **Macro Parameter Parsing:** Wrap complex argument types with parentheses or use typedefs to handle commas.
3. **Action Clauses Ordering:** Correctly order `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, `.RetiresOnSaturation()` clauses.
4. **Sequence and Ordering:** Explicitly specify call sequences where ordering matters.
5. **Replace Deprecated Macros:** Remove old `MOCK_METHODn` macros and use the unified approach.
6. **Adjust Tests with Non-Virtual Methods:** When mocking non-virtual methods, ensure correct setup with dependency injection patterns.
7. **Validate Default Actions:** Review use of `ON_CALL` and `EXPECT_CALL` to avoid uninteresting call warnings, or convert mocks to `NiceMock` where appropriate.

---

## Troubleshooting Common Upgrade Scenarios

### Unexpected Warnings on Uninteresting Calls

- Check whether your mocks have default behaviors specified via `ON_CALL`.
- If needed, wrap mocks in `NiceMock` to suppress noise.

### Broken Overloads After Migration

- Ensure all relevant overloads are mocked explicitly.
- Bring base class overloads into scope using `using` declarations.

### Parsing Errors in `MOCK_METHOD`

- Use parentheses around argument types containing commas.
- Define type aliases to simplify complex arguments.

### Failures Due to Call Ordering

- Carefully examine test failures for ordering constraint violations.
- Add `.InSequence()` or `.After()` specifications as needed.

### Destructor Issues in Mock Classes

- Ensure that mocked base classes have virtual destructors.
- Follow the pattern of mocking destructors by adding a mock method such as `Die()` and calling it in the destructor.

---

## Practical Migration Example

```cpp
class MockLegacy {
 public:
   // Old style
   MOCK_METHOD1(OldFunc, void(int));
};

// New style migration
class MockNew {
 public:
   MOCK_METHOD(void, OldFunc, (int), (override));
};
```

Add qualifiers if needed:

```cpp
MOCK_METHOD(int, GetValue, () const, (const, override));
```

To resolve complex argument types:

```cpp
using MapIntString = std::map<int, std::string>;
MOCK_METHOD(bool, CheckMap, ((MapIntString)), (override));
```

---

## Adapting Existing Test Suites

- Review all `EXPECT_CALL` and `ON_CALL` chains for clause order.
- Add `.RetiresOnSaturation()` to limit the life of saturated expectations.
- Add explicit sequences and after clauses to maintain call order.
- Ensure default actions cover unexpected calls or switch to nice mocks.

---

## Additional Resources

- [Mocking Reference](/reference/mocking.md) for detailed syntax and macro semantics.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for practical recipes.
- [Setting Expectations](/api-reference/googlemock-api/setting-expectations.mdx) for comprehensive expectations use.
- [Nice, Naggy & Strict Mocks](/api-reference/googlemock-api/nice-strict-mocks.mdx) to handle uninteresting calls.

---

For an overview of all changes across versions, please consult the [Version Timeline & Key Highlights](https://github.com/google/googletest/blob/main/docs/changelog/release-history/version-timeline.mdx) page.

---

## Summary
This page is your definitive guide to handling breaking changes and major upgrades in GoogleTest and GoogleMock, focusing on adapting mock classes, expectations, and call sequencing to new API requirements, with robust migration tips and troubleshooting advice.

---

<Tip>
When upgrading major versions, iterate incrementally, validating your test suite after each change to catch incompatibilities early and avoid compounding migration issues.
</Tip>

<Note>
Thoroughly read the [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md) and the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for examples and to leverage new features that simplify your tests.
</Note>

<Warning>
Do not assume backward compatibility prior to verification. Your existing tests might fail silently or produce misleading warnings if you rely on deprecated or changed behaviors.
</Warning>

<AccordionGroup title="Additional Tips for Migration">
<Accordion title="Handling Non-Virtual Method Mocking Transition">
Leveraging template-based dependency injection allows mocking of non-virtual methods without changing production code inheritance, easing migration and improving test isolation.
</Accordion>
<Accordion title="Dealing with Overloaded Methods">
Explicitly mock each overload to avoid hiding warnings or errors. Use `using BaseClass::Method;` to maintain unmocked overloads.
</Accordion>
<Accordion title="Avoiding Over-Specification in Expectations">
Use `ON_CALL` to specify default behavior and reserve `EXPECT_CALL` for assertions on specific cases to reduce test fragility during refactoring.
</Accordion>
</AccordionGroup>
