---
title: "Migration Guides & Upgrade Tips"
description: "Step-by-step guides and practical advice for upgrading projects between major releases. Includes code examples, flags, and compatibility notes to streamline the migration process and reduce risk."
---

# Migration Guides & Upgrade Tips

Welcome to the comprehensive guide designed to assist you in upgrading your GoogleTest and GoogleMock based projects across major releases. This page walks you through the step-by-step process, presents practical advice, and includes code snippets and compatibility notes to help you migrate safely and efficiently while minimizing risks and disruptions.

---

## Why Upgrade? The Value of Staying Current

Upgrading between major GoogleTest versions is essential to leverage new features, fix bugs, improve test reliability, and maintain compatibility with modern C++ standards and compilers. Upgrading can also bring performance improvements and better integration with GoogleMock’s latest mocking capabilities.

This page helps you:

- Understand key breaking changes and how to resolve them
- Learn recommended migration patterns to avoid common pitfalls
- Access practical compatibility tips with real code examples
- Gain confidence to streamline your upgrade process


## Core Migration Workflow

Upgrading your testing setup involves several stages that should be followed carefully:

### 1. Review the Release Notes

Before you touch your code, study the release notes and changelog for the target GoogleTest version. Focus on:

- Breaking changes affecting your existing tests and mocks
- Deprecated features or APIs you may be using
- New recommended idioms and patterns

### 2. Update Your Build Environment

Ensure your build environment meets the new prerequisites: minimum C++ standard (usually C++17 or later), supported compilers, and platform requirements as specified in the release.

### 3. Adjust Mock Classes

Changes to GoogleMock’s `MOCK_METHOD` macros and expectation syntax may require updates:

- Replace legacy `MOCK_METHODn` macros with the modern `MOCK_METHOD` syntax
- Adapt argument types and qualifiers to comply with updated compiler checks
- Refactor mock class constructors and destructors if needed

### 4. Revise Expectations and Behaviors

Expectation specifications with `EXPECT_CALL` and default behaviors using `ON_CALL` may require reordering or syntax adjustments. Follow the correct clause order and apply newly recommended practices.

### 5. Test and Validate

Run your entire test suite frequently during migration:

- Fix compilation errors and warnings
- Identify and resolve test failures due to API or behavior changes
- Use GoogleMock’s diagnostic messages effectively

### 6. Iterate and Optimize

Once all tests pass:

- Adopt new mocking features to streamline tests
- Replace deprecated constructs
- Remove any workarounds


## Detailed Migration Topics

### Migrating Mock Method Definitions

GoogleMock has standardized mocking method macros to improve clarity and maintainability:

**Old style:**
```cpp
MOCK_METHOD1(MethodName, ReturnType(Args));
```

**New style:**
```cpp
MOCK_METHOD(ReturnType, MethodName, (Args), (const, override));
```

**Migration tips:**

- Wrap complex argument types containing commas in extra parentheses.
- Add qualifiers `(const, override)` as required for overriding base methods.
- Move your mock class constructors/destructors out of header files if compilation performance becomes an issue.


### Setting Expectations Correctly

The order of clauses in `EXPECT_CALL` matters for migration to newer versions:

```cpp
EXPECT_CALL(mock_object, Method(args))
    .With(multi_arg_matcher)        // Optional and must be first if used
    .Times(cardinality)             // Optional, defines call count expectations
    .InSequence(seq1, seq2, ...)    // Optional, for call ordering
    .After(other_expectation, ...)  // Optional, for partial ordering
    .WillOnce(action)               // Can be chained multiple times
    .WillRepeatedly(action)         // Optional, can appear once
    .RetiresOnSaturation();         // Optional, must be last if used
```

**Key tips:**

- `.With()` must appear before `.Times()` and only once.
- In new versions, `Times` is inferred when omitted, based on `WillOnce` and `WillRepeatedly` calls.
- Use `.RetiresOnSaturation()` to ensure expectations retire when saturated to avoid unintended sticky expected calls.


### Handling Call Order and Sequences

When you require strict or partial order of mock calls, use sequences:

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, Func1())
    .InSequence(s1, s2);
EXPECT_CALL(mock, Func2())
    .InSequence(s1);
EXPECT_CALL(mock, Func3())
    .InSequence(s2);
```

This specifies that calls must follow the defined partial order DAG. Also, `.After()` clauses can express dependencies across expectations.

Be sure to update any existing ordering specifications to conform to the enforced clause order in the newer versions.


### Managing Uninteresting Calls: Nice, Naggy, and Strict Mocks

Newer GoogleMock versions differentiate mock strictness modes:

- **NiceMock<T>**: suppresses warnings for uninteresting calls
- **NaggyMock<T>**: the default, warns on uninteresting calls
- **StrictMock<T>**: treats uninteresting calls as test failures

Migrating your tests, consider the implicit strictness and explicitly change mock wrappers to suit your testing needs. This will help reduce noisy warnings or hidden test failures.


### Move-Only Types and Overloading

If you use move-only types (e.g., std::unique_ptr) in your mock methods:

- Use updated `MOCK_METHOD` syntax that supports move-only arguments and returns.
- For overloaded methods, use disambiguation helpers such as `Const()` or explicit matchers.


### Delegating Calls and Using Fakes

For complex scenarios, you may delegate mock methods to:

- A fake implementation to leverage existing behavior
- A real object for integration testing
- A parent class method when mocking overrides

Remember the order to set default actions with `ON_CALL` before specifying expectations with `EXPECT_CALL`.


## Common Migration Pitfalls & Solutions

- **Compilation errors with `MOCK_METHOD`:** Observe parentheses properly around argument types with commas. Ensure all qualifiers are correctly specified.

- **Unsatisfied expectations:** Confirm that expectations are set before exercising code, and that method calls match argument matchers.

- **Unexpected call order failures:** When using `InSequence` or `After`, verify that calls occur in specified order; convert expectations to retire on saturation if needed.

- **Uninteresting call warnings:** Use `NiceMock` to suppress warnings or explicitly set expectations with `Times(AnyNumber())`.

- **Overloading ambiguity:** Use the new disambiguation techniques with `Const()` or explicit matcher casts.


## Real-World Migration Example

Upgrading a mock method declaration from legacy to modern:

**Before:**
```cpp
class MockFoo : public Foo {
 public:
  MOCK_CONST_METHOD1(FooMethod, int(int param));
};
```

**After:**
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, FooMethod, (int param), (const, override));
};
```

Setting a default action and expectation:
```cpp
ON_CALL(mock, FooMethod(_)).WillByDefault(Return(42));
EXPECT_CALL(mock, FooMethod(Ge(0))).Times(AtLeast(1));
```

Ordering calls:
```cpp
Sequence s;
EXPECT_CALL(mock, FooMethod(1)).InSequence(s);
EXPECT_CALL(mock, FooMethod(2)).InSequence(s);
```


## Troubleshooting Tips

- Run commands with increased verbosity flags (`--gmock_verbose=info`) to gain insights on mock expectations and calls.
- Use `Mock::VerifyAndClearExpectations()` to verify expectations mid-test if objects persist long.
- Check compiler diagnostics carefully for missing qualifiers or misused macros.
- Review GoogleMock Cookbook and Mocking Reference for advanced scenarios.


## Helpful Resources & Further Reading

- [Mocking Reference](../reference/mocking.md) for API details
- [gMock Cookbook](../gmock_cook_book.md) for practical recipes
- [Effective Mocking with GoogleMock](../guides/advanced-features-and-patterns/effective-mocking.mdx) for comprehensive insight
- [Expectations and Setting Behaviors](../api-reference/googlemock-api/setting-expectations.md)
- [Nice, Naggy & Strict Mocks](../api-reference/googlemock-api/nice-strict-mocks.md) for uninteresting call behavior
- [GoogleTest Primer](../docs/index.md) for foundational understanding


## Summary

Upgrading between major GoogleTest and GoogleMock releases requires mindful adjustments to your mock class definitions, expectation specifications, and test usage patterns. By following the migration workflow and addressing areas such as mock method declarations, expectation ordering, and mock strictness modes, you will ensure your test suites remain reliable, maintainable, and compatible with new versions. This guide empowers you with practical examples, troubleshooting insights, and links to comprehensive references, making upgrading an efficient and risk-mitigated process.

---

<Tip>
Always set your expectations _before_ exercising your mocks to avoid undefined behaviors and unexpected failures.
</Tip>

<Warning>
Do not mix old `MOCK_METHODn` macros with the new `MOCK_METHOD` syntax within the same mock class. Transition fully to the new style for best compatibility.
</Warning>

<Note>
Using `NiceMock` or `StrictMock` wrappers can help control verbosity and error sensitivity of your mocks concerning uninteresting calls during migration.
</Note>
