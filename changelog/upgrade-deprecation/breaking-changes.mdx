---
title: "Breaking Changes & Migration Notes"
description: "Detailed listing of breaking or backwards-incompatible changes in recent releases, with migration strategies and tips for adapting your code or build setups. This section is vital for users planning upgrades across major versions."
---

# Breaking Changes & Migration Notes

This page provides a detailed listing of breaking or backwards-incompatible changes introduced in recent releases of GoogleTest and GoogleMock. It includes guidance and strategies to migrate your existing code and test setups across major versions safely and efficiently.

Understanding and preparing for these changes is crucial to maintaining and upgrading your test environments without disruption.

---

## 1. Overview of Breaking Changes

Breaking changes refer to modifications in the GoogleTest or GoogleMock APIs or behavior that may cause existing tests or mock classes to fail to compile or run correctly without code adaptation. These changes typically happen in major releases or occasionally in minor releases when necessary.

Users planning to upgrade must carefully review these changes and apply the recommended migration steps to ensure smooth transitions.

---

## 2. Common Categories of Breaking Changes

### 2.1 Macro Signature Updates

- **`MOCK_METHOD` Macro:**
  - The signature of `MOCK_METHOD` macros has been standardized to use 3 or 4 parameters including qualifiers such as `const`, `override`, `noexcept`, and calling conventions.
  - Prior legacy macros like `MOCK_METHODn` or `MOCK_CONST_METHODn` are still supported but migrating to the new `MOCK_METHOD` simplifies code and is recommended.
  - If your mock classes use old macros, update them to the new signature.

### 2.2 Qualifier Specification Changes

- Methods overriding virtuals must specify qualifiers explicitly in `MOCK_METHOD`:
  - Use `(const, override)` for const methods.
  - Use `(override, noexcept)` for noexcept methods.
  - Use `Calltype(STDMETHODCALLTYPE)` to specify calling convention on Windows.
  - Add reference qualifiers using `ref(&)` or `ref(&&)` for ref-qualified methods.

### 2.3 Handling Return Types with Embedded Commas

- When mocking methods with return types that contain commas (e.g. `std::pair<...>`, `std::map<...>`), the return type must be wrapped with parentheses to avoid parsing errors.
- Alternatively, use type aliases for clarity and safety.

### 2.4 Mocking Overloaded Methods

- All overloaded versions of a method must be mocked explicitly.
- To avoid compiler warnings about hiding methods, use `using BaseClass::MethodName;` to bring in unmocked overloads.

### 2.5 Strictness Classes Behavior

- `NiceMock`, `NaggyMock`, `StrictMock` now only affect uninteresting calls defined by `MOCK_METHOD` macros directly in the mock class.
- Mock methods defined in base classes may not be influenced by these wrappers - refactor or reconsider design if strictness behavior is crucial.

### 2.6 Mocking Non-Virtual Methods

- Support for mocking non-virtual functions requires templated test code to select the mock class at compile time.
- This is a breaking shift from conventional virtual-inheritance based mocking, and existing tests may need refactoring.

### 2.7 Delegation Patterns

- Delegate-to-fake, delegate-to-real, and delegate-to-parent techniques have been formalized.
- Ensure delegate method calls and default actions are set correctly to maintain expected mock behavior.

### 2.8 Removal or Deprecation of Legacy Macros

- Some legacy macros and constructs (e.g. `MOCK_METHODn`, `MOCK_CONST_METHODn`, and `_WITH_CALLTYPE` variants) are deprecated.
- Migrate to the generic `MOCK_METHOD` macro with qualifiers for future compatibility.

---

## 3. Migration Strategies and Steps

### 3.1 Update Mock Class Definitions

1. Replace all `MOCK_METHODn` macros with `MOCK_METHOD` using the new signature.
2. Specify method qualifiers explicitly, including `const`, `override`, `noexcept`, `Calltype`, and reference qualifiers.
3. Wrap return types with embedded commas in parentheses or use type aliases.
4. Explicitly mock *all* overloads to prevent hiding and compiler warnings; use `using` declarations where suitable.

### 3.2 Adjust Usage of Strictness Wrappers

1. Use `NiceMock<T>`, `NaggyMock<T>`, and `StrictMock<T>` only on mock classes defining mock methods directly.
2. If mock methods come from base classes, consider migrating them to current mock classes or adjusting tests to avoid relying on strictness modifiers.

### 3.3 Transition from Non-Virtual to Template-based Mocks

1. For non-virtual methods currently mocked via separate unrelated classes, transition test code to use template arguments to select mock implementations.
2. Review test architecture to ensure compile-time selection patterns are compatible.

### 3.4 Delegate Support

1. When mixing mocks with fakes or real objects, ensure delegation calls are set using the provided patterns to maintain correct mock behavior.
2. Avoid mixing mocks and fakes unnecessarily; prefer interface segmentation.

### 3.5 Review Expectation Setup

1. Verify usage of `EXPECT_CALL` and `ON_CALL` constructs conform to the latest recommendations.
2. Adjust expectations to adopt preferred default actions and avoid unintentional warnings or failures.

---

## 4. Common Pitfalls and Troubleshooting

- **Mock Methods Not Overriding Correctly:** Ensure method qualifiers exactly match and use `(override)` to prevent silent overriding issues.
- **Parsing Failures with Comma-containing Types:** Always parenthesize return or argument types that contain commas.
- **Unexpected Behavior of Strictness Wrappers:** Confirm mock methods are defined directly in the mock class.
- **Tests Failing After Upgrading:** Check for missing mocks of overloads and incorrect qualifier usage.

---

## 5. Additional Best Practices

- Prefer using the generic `MOCK_METHOD` macro with clear qualifiers.
- Use `ON_CALL` for default behaviors and `EXPECT_CALL` only to set expectations you intend to verify.
- Use sequences (`InSequence`) and ordering (`After`) clauses to manage call order strictly.
- Regularly update mock classes to match interface changes upstream.
- Review gMockâ€™s verbose output by running tests with `--gmock_verbose=info` to diagnose expectation mismatches.

---

## 6. References & Further Reading

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Practical recipes including advanced patterns and migration tips.
- [gMock Reference - Mocking](../api-reference/core-apis/mocking-and-methods.html): Full API reference on mock class and method declarations.
- [gMock FAQ](https://google.github.io/googletest/gmock_faq.html): Answers to common upgrade and usage questions.
- [Mocking Workflows Guide](https://google.github.io/googletest/guides/effective-testing-techniques/mocking-workflows): Best practices on setting expectations and mock usage.

---

For smooth upgrades, ensure thorough testing and consider gradual refactoring aligned with breaking change notices.

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_cook_book.md", "range": "1-640" }, {"path": "docs/gmock_faq.md", "range": "1-246"}, {"path": "docs/reference/mocking.md", "range": "1-553"}, {"path": "docs/gmock_for_dummies.md", "range": "1-248"}, {"path": "docs/gmock_cheat_sheet.md", "range": "1-81"}]}/>