---
title: "Step-by-Step Upgrade Guide"
description: "A practical guide for upgrading to the latest version, addressing the required steps, preparation, common pitfalls, and validation tips. Ideal for maintainers and CI owners ensuring a smooth transition."
---

# Step-by-Step Upgrade Guide

A practical guide for upgrading your GoogleTest and GoogleMock projects to the latest versions. This guide covers essential preparation steps, detailed upgrade procedures, common pitfalls to avoid, and validation tips to ensure a smooth transition. It is tailored primarily for project maintainers and continuous integration (CI) owners responsible for keeping test suites up to date without disruption.

---

## 1. Preparing for the Upgrade

Before initiating the upgrade, ensure your environment and codebase are ready to adopt the latest GoogleTest version.

- **Review Version Requirements:**
  - Confirm compiler support, e.g., GoogleTest 1.17.x requires C++17.
  - Verify platform compatibility with the latest release.

- **Backup Current Project:**
  - Preserve a good known state of the project repository.
  - Tag or branch the current version to enable easy rollback if needed.

- **Read Breaking Changes & Deprecation Notices:**
  - Familiarize yourself with breaking changes and deprecated APIs that impact mock classes and test code.
  - Pay special attention to mock method declaration updates and deprecated mocking macros.

- **Analyze Your Existing Use of GoogleTest and GoogleMock:**
  - Identify places using legacy `MOCK_METHODn` macros and prepare to migrate to the unified `MOCK_METHOD` macro.
  - Review code that relies on strictness wrappers like `NiceMock`, `StrictMock`, as their behavior and usage might have evolved.

- **Check Custom Matchers and Actions:**
  - Review any custom matchers or actions for compatibility issues.


## 2. Step-by-Step Upgrade Procedure

Follow this progression for an effective upgrade:

### Step 1: Fetch and Build the Latest GoogleTest

- Clone or pull the latest GoogleTest repository or update your package to the new version.
- Build GoogleTest and GoogleMock according to your platform’s recommended methods (CMake, Bazel, manual build).
- Ensure your build system uses the updated include paths and links to the latest binary.

### Step 2: Update Your Build Configurations

- Adjust your build system to require C++17 or later (if not already set).
- Replace any deprecated compilation flags or macros according to release notes.
- Link your tests against the new `gtest` and `gmock` libraries or targets.

### Step 3: Migrate Legacy Mock Declarations

- Replace old `MOCK_METHODn` and related macros with the recommended unified `MOCK_METHOD` macro:

  ```cpp
  // Old style:
  MOCK_METHOD1(Foo, bool(int));

  // New style:
  MOCK_METHOD(bool, Foo, (int));
  ```

- For const-qualified, noexcept, override, or reference-qualified methods, use the correct specifiers in the 4th macro parameter, e.g.: 

  ```cpp
  MOCK_METHOD(bool, Bar, (int), (const, noexcept, override));
  ```

- Wrap complex types with parentheses or use type aliases to handle unprotected commas.

### Step 4: Review and Fix Expectation and Default Behavior Patterns

- Prefer using `ON_CALL` to define default mock behavior when you don't need strict call verification.
- Use `EXPECT_CALL` only when verifying expected calls.

- For controlling call order and cardinalities, verify your existing usage of `.Times()`, `.InSequence()`, `.After()` follows the current best practices.

### Step 5: Adjust Mock Strictness Usage

- Revisit how you use `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to control uninteresting/mismatched call warnings and errors.
- Be cautious not to nest strictness wrappers, as it is not supported.

### Step 6: Refactor Custom Matchers and Actions

- Validate usage of custom matchers against current matcher APIs.
- Migrate any legacy `ACTION` macros to modern lambdas or callable objects where feasible.

### Step 7: Run Comprehensive Tests

- Build and execute all tests to detect any compilation errors or test failures caused by upgraded APIs or changed behaviors.
- Leverage verbosity flags like `--gmock_verbose=info` to gain insights into mock calls and failures.

### Step 8: Validate Test Outputs and Behavior

- Confirm that test failure messages and stack traces provide meaningful guidance.
- Verify that your tests still properly catch incorrect code behaviors.

### Step 9: Commit and Document

- Commit changes to your repository with clear messages referencing the GoogleTest version upgrade.
- Update any project documentation or CI pipeline scripts accordingly.


## 3. Common Pitfalls and How to Avoid Them

- **Ignoring Breaking Changes:** Ensure the necessary migration of mock declarations and expectation syntax is done to prevent compilation errors.

- **Mismanaging Mock Strictness:** Misusing `NiceMock` or `StrictMock` can suppress important warnings or cause unwanted test failures.

- **Build Configuration Mismatches:** Forgetting to update C++ standard flags or linking old binaries will cause build or linkage failures.

- **Improper Parentheses in MOCK_METHOD:** Failing to wrap complex types can lead to macro parsing errors.

- **Omitting ON_CALL Defaults:** Not providing defaults on mocks can cause unexpected warnings about uninteresting calls.

- **Overusing EXPECT_CALL:** Excessive `EXPECT_CALL`s increase test brittleness and maintenance burden.

- **Neglecting Test Validation:** Passing tests do not guarantee complete upgrade; verify outputs and behaviors carefully.


## 4. Validation Tips

- Use the `--gmock_verbose=info` flag to observe detailed mock call matching and identify mismatches.
- Run tests with warnings enabled and address any "uninteresting mock function call" warnings.
- Make use of continuous integration to automate regression verification.
- Spot test execution timing or resource leaks introduced by upgrade changes.


## 5. Additional Resources

- [Breaking Changes & Migration Notes](/changelog/upgrade-deprecation/breaking-changes) — In-depth guidance on migrating breaking changes.
- [Deprecation Notices](/changelog/upgrade-deprecation/deprecations) — Overview of deprecated features.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical patterns for mocks.
- [Mocking Reference](/api-reference/core-apis/mocking-and-methods) — API reference for mock methods.
- [Matchers Reference](/api-reference/advanced-behaviors/argument-matchers) — Guide on argument matchers.
- [Actions Reference](/api-reference/advanced-behaviors/mock-actions) — Defining mock actions.


---

For maintainers and CI owners, this guide aims to streamline the upgrade process, ensuring minimal interruption while leveraging the latest capabilities and improvements in GoogleTest and GoogleMock.


---

<Check>
Following this guide assures a smooth and predictable upgrade with best practices to prevent common issues.
</Check>

<Note>
Always validate your project build and test outputs after upgrading.
</Note>