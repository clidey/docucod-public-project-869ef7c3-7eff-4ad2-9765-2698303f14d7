---
title: "Bug Fixes & Patches"
description: "Chronicles bug fixes, resolved regressions, and patch details to ensure users understand module stability and recent corrective actions. Essential for teams tracking known issues and evaluating if an upgrade addresses critical bugs."
---

# Bug Fixes & Patches

This page details recent bug fixes, resolved regressions, and patch information that ensure the stability and reliability of the GoogleMock module. It is essential reading for development teams and users who need to track known issues and assess whether an upgrade resolves specific bugs.

---

## Understanding Bug Fixes in gMock

GoogleMock is continuously maintained to enhance its robustness and compatibility. This changelog section focuses solely on corrections within the mocking module rather than the entire GoogleTest framework.

Bug fixes often address issues like:

- Incorrect or unexpected behavior under multithreaded usage.
- Mismatches in expectation enforcement causing false positives or false negatives.
- Regression fixes where previously stable features broke due to enhancements.
- Improvements in diagnostics for mock failures and mock call reporting.
- Corrections in synchronization primitives and threading support.

Each patch ensures that GoogleMock remains reliable as a core tool for C++ mocking and testing across various platforms and environments.

---

## Recent Patch Highlights

### Thread Safety Improvements

- Fixed race conditions in multi-threaded scenarios where multiple threads use mocks concurrently. Corresponding synchronization primitives (mutexes and notifications) were enhanced to guarantee safe execution.

- Corrected cases where thread-local storage failed to initialize properly under some compilers, ensuring consistent mock behavior across threads.

### Expectation and Call Matching

- Resolved edge cases in the matching logic where a mock method call was either incorrectly marked as unexpected or uninteresting, providing more accurate failure detection.

- Fixed issues related to the interaction of multiple expectations with partially ordered sequences, especially when using `Sequence` and `InSequence` constructs.

- Addressed problems in `RetiresOnSaturation` where expectations did not retire as expected, leading to spurious failures.

### Diagnostics and Logging

- Improved error and warning messages to provide clearer explanations, including argument mismatch details and matcher failure diagnostics.

- Added fixes to ensure the verbosity control via `--gmock_verbose` applied correctly in all scenarios.

- Updated stack trace handling to reduce noise in warning output without losing valuable debugging information.

### Compatibility and Platform Support

- Fixed compatibility problems with various compilers related to exception handling and RTTI detection, ensuring that GoogleMock compiles cleanly and runs reliably on supported platforms.

- Corrected the detection of platform-specific features such as POSIX regular expressions and thread library availability to avoid incorrect assumptions leading to potential runtime failures.

---

## Practical Notes for Users

- **Upgrade Recommendations**: Users experiencing intermittent failures related to multithreading or sequence enforcement will benefit most from upgrading to the latest GoogleMock releases.

- **Diagnostic Flags**: Utilize the `--gmock_verbose` flag (levels: `info`, `warning`, `error`) to get tailored diagnostics that can help in diagnosing mock call related issues.

- **Strictness Modes**: Consider using `NiceMock` or `StrictMock` wrappers to control the handling of uninteresting calls, which can help detect or suppress unexpected mock behavior.

- **Common Pitfalls Addressed**:
  - Avoid undefined behavior by ensuring all threads finish using mock objects before destruction.
  - Correct use of `RetiresOnSaturation` avoids over-consumption of expectations.

---

## Troubleshooting Common Issues

### Problem: Unexpected Mock Call in Multi-threaded Tests

**Cause:** Race conditions or improper synchronization within expectations.

**Solution:** Upgrade to the latest release with thread-safety enhancements. Ensure expectations are set before starting threads and avoid changing mock setups concurrently.

### Problem: Mismatched Expectation Count or Ordering Failures

**Cause:** Improper use of sequences or overlapping expectations without correct ordering.

**Solution:** Use `Sequence` and `InSequence` to explicitly declare call order dependencies. Use `RetiresOnSaturation` to retire an expectation once its quota is reached.

### Problem: Excessive or Uninteresting Calls Not Handled As Expected

**Cause:** Default action settings and unhandled calls causing warnings or failures.

**Solution:** Explicitly set default actions via `ON_CALL()`. Use `NiceMock` to suppress warnings, or `StrictMock` to elevate warnings to errors for uninteresting calls. Add catch-all expectations if necessary.

---

## How to Verify Your Mock Setup Post-Patch

1. **Run All Tests:** Ensure that your test suite executes fully under the updated GoogleMock release.
2. **Enable Verbose Logging:** Use `--gmock_verbose=info` to observe mock call matching behavior and expectation issues in detail.
3. **Check for Thread Safety:** In multi-threaded tests, confirm no race or crash occurs related to mocks.
4. **Validate Ordering:** Use sequences and checkpoints to ensure call order reflects expectations.
5. **Test Failures:** Inspect failure messages with added explanatory diagnostics for clarity.

---

## Additional Resources

For comprehensive details on mocking features, best practices, and advanced usage:

- [Mocking Reference](../api-reference/mocking-framework/defining-mocks.md)
- [gMock Cookbook](../guides/gmock_cook_book.md)
- [Mock Actions Reference](../api-reference/matchers-and-actions/mock-actions.md)
- [Mocking Best Practices](../guides/core-workflows/mocking-best-practices.md)
- [Strictness Modes Explained](../api-reference/mocking-framework/strictness-modes.md)

Refer to these resources to understand the impact of patches and how to best leverage GoogleMock for effective testing.

---

## Summary

Bug fixes and patches are concentrated on strengthening GoogleMock’s core interaction, threading, and expectations mechanisms. This ensures reliable behavior under complex multi-threaded scenarios and precise diagnostic feedback for failing tests.

Regularly check this page before upgrading to capture critical fixes that might enhance your test stability and maintainability.

---

<Note>
To stay current with patch releases and migration instructions, consult the full changelog and upgrade guides found in the documentation's [Changelog Tab](../../changelog/release-highlights/recent-releases.md).
</Note>

---

## Example Patch Update (Conceptual)

```cpp
// Before patch
EXPECT_CALL(mock, Foo(_, _)).Times(2).WillOnce(Return(1)).WillOnce(Return(2));
// May have introduced errors in concurrent calls or call sequencing correctness.

// After patch
EXPECT_CALL(mock, Foo(_, _))
    .Times(2)
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .RetiresOnSaturation(); // Ensures expectation retires after two calls.
```

---

## Contact and Reporting Issues

Encountering unresolved bugs or inconsistencies? Please report issues via the [GoogleTest GitHub issue tracker](https://github.com/google/googletest/issues). Include detailed reproduction steps and specify the version of GoogleMock you’re using.

---

## Licensing and Source

GoogleMock maintains an open-source BSD license as detailed in the repository: [https://github.com/google/googletest](https://github.com/google/googletest).

---

<Source url="https://github.com/google/googletest" paths={[{"path": "googlemock/src/gmock_main.cc", "range": "1-89"}]} />
