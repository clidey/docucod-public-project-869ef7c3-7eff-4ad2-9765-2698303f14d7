---
title: "New Features & Improvements"
description: "Catalogs enhancements delivered across releases, such as added assertions, expanded platform support, or test framework improvements. Perfect for users seeking to maximize new functionality or validate pending updates before deployment."
---

# New Features & Improvements

This page details the enhancements and improvements introduced to the GoogleMock (gMock) framework, focusing specifically on new capabilities, expanded support, and refinements that improve user experience while defining, managing, and using mock objects in C++ tests.

---

## Introduction

As GoogleMock evolves, new features and improvements are continuously integrated to empower users with richer mocking capabilities, clearer feedback, and enhanced control over mock behavior. This changelog captures this progressive refinement, enabling users to maximize the value from each release and effectively plan upgrades.

---

## Key Features and Enhancements

### 1. Enhanced Mock Method Definition

- **`MOCK_METHOD` Macro Improvements**: Allows precise specification of mock methods including handling of complex return types and argument types, such as pairs, maps, and template classes.

- **Expanded Qualifiers Support**: Support for additional qualifiers like `const`, `override`, `noexcept`, calling conventions (`Calltype`), and reference qualifiers (`ref(&)` or `ref(&&)`) enables accurate mocking of production code methods.

- **Improved Handling of Unprotected Commas**: Users can now wrap types with commas inside parentheses or use type aliases to prevent macro parsing errors.

### 2. Support for Mocking Various Method Types

- **Mocking Private and Protected Methods**: Mock methods should always be declared `public` to ensure expectation setting is possible externally, regardless of base class access level.

- **Overloaded Method Mocking**: Seamlessly mock overloaded methods by specifying all relevant versions. Use `using` to avoid compiler warnings for hidden overloads.

- **Mocking Class Templates**: Templates can be mocked directly, allowing flexible testing of generic components.

- **Non-Virtual Method Mocking**: Enables dependency injection in high-performance scenarios by mocking unrelated non-virtual methods with the same signature.

- **Limitations on Free Functions**: Cannot mock free functions directly; advised to wrap them in interfaces or use `MockFunction` for std::function mocking.

### 3. Strictness Modes to Control Uninteresting Calls

- **`NiceMock`**: Suppresses warnings on uninteresting calls, reducing noise in test output.

- **`NaggyMock` (Default Mode)**: Warns on uninteresting calls to alert the user.

- **`StrictMock`**: Treats uninteresting calls as errors, useful for enforcing tight test contracts.

These wrappers can be applied to mock classes to tailor strictness policies per test need.

### 4. Setting Expectations and Default Actions

- **Prioritizing `ON_CALL` vs `EXPECT_CALL`**: Encouraged use of `ON_CALL` for setting default behavior without imposing call count constraints, improving test resilience.

- **Explicit and Flexible Expectations**: `EXPECT_CALL` allows detailed control including call counts (`Times`), argument matchers, call order (`InSequence`, `After`), and custom actions (`WillOnce`, `WillRepeatedly`).

- **Partial and Strict Ordering Support**: Introduced support for specifying complex call order dependencies using sequences and `After` clauses, allowing flexible or strict verification scenarios.

### 5. Advanced Use Cases and Utilities

- **Delegating to Fakes, Real Objects, or Parent Classes**: Mechanisms to delegate mock calls to alternative implementations while retaining expectation checks.

- **Custom Actions and Actions Chaining**: Use lambdas, functors, or action combinators (`DoAll`, `Invoke`) to define complex behaviors including side effects and argument manipulation.

- **Move-Only Type Support**: Methods accepting or returning move-only types like `std::unique_ptr` can be mocked, enabling modern C++ usage.

- **Handling Uninteresting Calls Smartly**: Allows ignoring or disallowing unexpected calls explicitly, plus using nice or strict modes for better test output control.

### 6. Improved Diagnostics and Debugging

- **Verbose Logging**: Use `--gmock_verbose=info|warning|error` to control verbosity of mock call reporting.

- **Informative Failure Messages**: Detailed messages include function calls, argument mismatch specifics, call order violations, and retention of stack traces.

- **Integration with Tooling**: Support for Emacs integration and output formatting to assist developers in navigating test failures efficiently.

### 7. Compilation and Performance

- **Reducing Compile Time**: Best practice recommendation to separate mock constructors and destructors into .cc files to reduce compilation overhead.

- **Mock Class Construction Flexibility**: Supports non-default and multiple argument constructors, including up to 10-ary constructor forwarding.

---

## Usage Examples

### Defining a Mock Method

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(std::pair<bool, int>, GetPair, (), ());
  MOCK_METHOD(bool, CheckMap, (const std::map<int, double>&, bool), ());

  MOCK_METHOD(void, ProtectedMethod, (), (override));  // Declare public even if base is protected
  MOCK_METHOD(int, PrivateMethod, (), (override));    // Declare public even if base is private
};
```

### Setting Expectations

```cpp
using ::testing::_;  // Matcher for any value
using ::testing::Return;
using ::testing::InSequence;

MockFoo mock;

ON_CALL(mock, GetPair()).WillByDefault(Return(std::make_pair(true, 123)));

EXPECT_CALL(mock, CheckMap(_, true))
    .Times(2)
    .WillRepeatedly(Return(true));

{
  InSequence seq;
  EXPECT_CALL(mock, ProtectedMethod());
  EXPECT_CALL(mock, PrivateMethod())
      .WillOnce(Return(42));
}
```

### Applying Strictness Modes

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;   // Suppresses uninteresting call warnings
StrictMock<MockFoo> strict_mock;  // Makes uninteresting calls test failures
```

---

## Troubleshooting and Best Practices

- **Always declare mock methods `public`** to ensure expectations are applied correctly regardless of base class access level.

- **Handle overload ambiguity** by mocking all overloads or using `using` declarations to bring base class methods into scope.

- **Avoid over-specification** in expectations to maintain flexible tests; use `ON_CALL` to provide default behavior and `EXPECT_CALL` to verify key interactions.

- **Use `RetiresOnSaturation()`** to prevent sticky expectations from causing upper-bound failures in repeated call sequences.

- **Leverage strictness modes judiciously:** Use `NiceMock` to minimize noise in stable tests, `NaggyMock` during test development to reveal potential omissions, and `StrictMock` to enforce rigorous call contracts.

- **Investigate uninteresting call warnings** using `--gmock_verbose=info` to trace unexpected calls.

- **Separate mock constructor/destructor** implementations when experiencing slow compile times.

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes and patterns for advanced mocking
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Introductory guide for beginners
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html): Quick syntax and usage summary
- [Mocking Reference](reference/mocking.md): Comprehensive API details
- [Mock Actions Reference](api-reference/matchers-and-actions/mock-actions.mdx)
- [Strictness Modes and Policies](api-reference/mocking-framework/strictness-modes.mdx)

For troubleshooting, consider:
- Understanding uninteresting vs unexpected calls ([gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#uninteresting-vs-unexpected))
- Using verbosity flags to control output during test runs

---