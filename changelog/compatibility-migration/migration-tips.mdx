---
title: "Migration Guides & Upgrade Strategies"
description: "Step-by-step guides and practical strategies for upgrading between key versions, with tips to resolve common migration challenges. This safety net ensures upgrades are smooth and predictable."
---

# Migration Guides & Upgrade Strategies

Step-by-step guides and practical strategies for upgrading between key versions of GoogleTest and GoogleMock. This page focuses on helping users transition smoothly through major and minor releases by highlighting common migration challenges and offering clear resolutions. Whether you are upgrading across major versions or patch releases, you will find actionable advice and tips that ensure your existing tests remain stable and maintain best practices.

---

## 1. Understanding Version Changes

To plan your migration effectively, first be familiar with the type of changes that have occurred between your current version and the target version:

- **Major Versions:** Typically introduce potential breaking changes, new features that require adaptation, or removals of deprecated interfaces.
- **Minor Versions:** Usually add backward-compatible enhancements and bug fixes.
- **Patch Versions:** Primarily include bug fixes and minor stability improvements.

Refer to the [Breaking Changes & Deprecations](breaking-changes.md) for detailed information on non-backward-compatible changes you must address.

---

## 2. General Migration Workflow

Follow these steps to carry out an effective upgrade:

1. **Review Release Notes:** Examine release notes and changelogs for the target version to identify new features, fixes, and breaking changes.
2. **Check Breaking Changes:** Refer to compatibility notes regarding removed or modified APIs and behaviors.
3. **Update Your Mock Classes:** Ensure that mock classes using `MOCK_METHOD` or related macros comply with new requirements, particularly for qualifiers and call types.
4. **Revise Expectations and Actions:** Modify `EXPECT_CALL` and `ON_CALL` statements to conform with updated usage patterns, ensuring correct use of matchers and action macros.
5. **Run Tests Unchanged:** Run your existing tests against the new version to detect unexpected failures.
6. **Adjust for Deprecated Behavior:** Apply workarounds or refactor test code if any deprecated API usages remain.
7. **Enable New Features (Optional):** Gradually adopt new matchers, actions, or facilities introduced in the version.
8. **Validate Test Coverage:** Confirm that tests still accurately validate your code’s behavior and interaction.

---

## 3. Key Migration Considerations

### 3.1 MOCK_METHOD Macro Enhancements

- **Use the modern `MOCK_METHOD`** macro syntax for declaring mock methods; if migrating from old-style `MOCK_METHODn` macros, replace accordingly.
- **Wrap return types or argument types containing commas within parentheses** to avoid parsing errors. For example:

  ```cpp
  // Before (incorrect):
  MOCK_METHOD(std::pair<bool, int>, GetPair, ()); // Will not compile

  // After (correct):
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  ```

- **Declare mock methods in the public section**, even if the original virtual method was protected or private.
- **Add appropriate qualifiers** such as `(const)`, `(override)`, or `(noexcept)` in the fourth argument to match base declarations.

### 3.2 Expectations (EXPECT_CALL) and Default Behavior (ON_CALL)

- **Specify `EXPECT_CALL` before exercising mocks** to ensure well-defined matching and fail-fast behavior.
- **Use `ON_CALL` to set default behavior without expectation enforcement.** Prefer this for methods whose behavior is required but which you don't want to expect calls on explicitly.
- **Understanding cardinalities:** The default inferred cardinality is `Times(1)` unless overridden by `.WillOnce()` or `.WillRepeatedly()` clauses.
- **Be explicit about sequences and ordering** using `InSequence`, `After`, or `Sequence` objects when call order matters.
- **Handle multiple expectations respecting the "newer expectations override older ones" rule** to prevent shadowing and unintended behavior.

### 3.3 Strict, Nice, and Naggy Mock Behavior

- Choose between default (naggy), **`NiceMock`** (suppress uninteresting call warnings), or **`StrictMock`** (treat uninteresting calls as errors) based on your test requirements.
- Remember these wrappers only affect calls without expectations (`uninteresting`), not unexpected calls.
- Apply strictness wisely: strict mocks may cause tests to fail due to minor refactors that do not break contracts.

### 3.4 Move-Only Type Support

- GoogleMock supports mocking methods with **move-only types** like `std::unique_ptr`.
- Always provide **callables or lambdas** to `WillOnce`/`WillRepeatedly` instead of directly returning move-only values multiple times.
- Legacy workarounds of forwarding move-only arguments to non-move mock methods are no longer necessary.

---

## 4. Common Migration Scenarios

### 4.1 Migrating from pre-C++17 or older GoogleTest versions

- GoogleTest 1.17 and later requires **at least C++17**.
- Replace legacy macros like `MOCK_METHOD0`, `MOCK_CONST_METHOD1` with the generic `MOCK_METHOD` syntax.
- Ensure your build system compiles code with C++17 or later standards.

### 4.2 Addressing Breaking Changes in Mock Interface

- Review all mocks for necessary qualifier updates.
- For overloaded methods, disambiguate expectations using `Const()` or specifying exact argument types with `Matcher<Type>()` wrappers.
- If overriding mock method behaviors, prefer `ON_CALL` for default behavior over many broad `EXPECT_CALL` clauses to keep tests maintainable.

### 4.3 Handling Deprecated or Removed Features

- Check the breaking changes documentation for features flagged as deprecated and update test code accordingly.
- Use new matchers or facilities to replace deprecated patterns.

### 4.4 Refactoring to Use Strict or Nice Mocks

- Gradually migrate mock declarations to use `NiceMock<YourMock>` or `StrictMock<YourMock>` wrappers for fine-grained control over uninteresting call behavior.
- Update tests to remove warnings or failures about uninteresting calls by adding appropriate expectations or using `NiceMock`.

---

## 5. Practical Tips and Best Practices

- **Set Expectations Before Exercise:** Always specify `EXPECT_CALL` before running code that interacts with your mocks.
- **Use `RetiresOnSaturation()`** in sequences to prevent sticky expectations from causing false failures due to exceeding call limits.
- **Avoid Over-Specification:** Use matchers like `_` or `AnyNumber()` to relax argument matching where exactness is unnecessary.
- **Leverage Default Actions:** Use `ON_CALL` to set the default behavior shared across tests; reserve `EXPECT_CALL` for call count and order verification.
- **Suppress Uninteresting Call Warnings:** If benign, switch to `NiceMock` or add catch-all expectations (`EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`).
- **Testing Move-Only Arguments:** Use lambdas in `WillOnce` or `WillRepeatedly` to generate fresh move-only objects on each call.
- **Delegate to Fakes or Real Objects:** Use delegation to reuse existing implementations, while retaining the ability to verify calls.

---

## 6. Troubleshooting Migration Issues

- If tests start failing unexpectedly after upgrade, run tests with `--gmock_verbose=info` to trace call matching, revealing parameter mismatches or expectation ordering errors.
- If the compiler reports errors about mock method declarations, verify your macro syntax adheres to current standards and includes the correct qualifiers.
- Be sure to adjust for changes in default return values and action specifications, such as when mocking methods returning move-only types.
- For unexpected calls warnings, check if all expected calls are set and consider appropriate use of `NiceMock` or catch-all expectations.

---

## 7. Additional Resources

- [Breaking Changes & Deprecations](breaking-changes.md) — Understand API changes and deprecations.
- [Creating and Using Mocks](creating-and-using-mocks.md) — Detailed guide on defining mocks.
- [Matchers and Custom Matchers](matchers-and-custom-matchers.md) — Reference for specifying argument expectations.
- [Actions and Side Effects](actions-and-side-effects.md) — Guide to controlling mock method behaviors.
- [Mocking Best Practices and Common Patterns](best-practices-mocking.md) — Tips for writing maintainable tests.
- [gMock for Dummies](gmock_for_dummies.md) — Introductory tutorial for using GoogleMock.

---

For detailed upgrade notes, always consult the release-specific documentation and changelogs at:
- https://github.com/google/googletest/releases

---