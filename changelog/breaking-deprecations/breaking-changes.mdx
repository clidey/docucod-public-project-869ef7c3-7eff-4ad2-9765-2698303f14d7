---
title: "Breaking Changes & Migration Notes"
description: "A comprehensive list of changes that may affect current usage, including adjustments to APIs, defaults, and supported platforms. Includes clear migration instructions and before/after code examples to streamline the upgrade process."
---

# Breaking Changes & Migration Notes

This page provides a comprehensive list of breaking changes and migration instructions relevant to updating GoogleMock. These changes may include modifications to mocking macros, alterations in default behaviors, updates in API usage patterns, and refinements to supported platforms or compiler requirements. Understanding and applying these migration notes will help you smoothly upgrade your tests and maintain compatibility with the latest GoogleMock releases.

---

## 1. Mock Method Declaration Changes

### Transition from `MOCK_METHODn` to Generic `MOCK_METHOD`

GoogleMock has deprecated the old family of macros (`MOCK_METHODn`, `MOCK_CONST_METHODn`, etc.) in favor of the new unified `MOCK_METHOD` macro introduced in 2018. This new macro improves flexibility and handles qualifiers and overloads more cleanly.

#### Migration Example:

```cpp
// Old style (deprecated)
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD1(Bar, int(int));

// New preferred style
MOCK_METHOD(bool, Foo, (int));
MOCK_METHOD(int, Bar, (int), (const));
```

**Tip:** Wrap return or argument types with commas in parentheses or use type aliases to avoid parsing errors.

### Explicit Qualifiers and Override Annotations

The new `MOCK_METHOD` requires explicit specification of method qualifiers like `const`, `override`, and `noexcept` as the optional fourth parameter.

```cpp
MOCK_METHOD(void, Func, (int), (const, override));
```

Ensure your mock methods specify the correct qualifiers to avoid compilation errors in upgraded code.

---

## 2. Changes in Expectation and Behavior Macros

### ON_CALL and EXPECT_CALL Syntax Refinements

- The chainable clauses `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` remain key elements but must be used respecting their mandatory order.
- The `.With()` clause can be used only once and must be placed immediately after the macro invocation.

Incorrect chaining order may cause compilation or runtime errors after upgrading.

### Default Cardinality Inference

GoogleMock now infers the expected call count (`Times()`) automatically based on presence or absence of `.WillOnce()` and `.WillRepeatedly()` clauses.

- No `.Times()` and no `.WillOnce()` or `.WillRepeatedly()` means `Times(1)` is assumed.
- Multiple `.WillOnce()` uses imply a cardinality equal to the count of `.WillOnce()` calls.

Make sure your expectations rely on this inference and explicitly specify `.Times()` only if behavior differs.

---

## 3. Support for Move-Only Types in Mocked Methods

Starting with GoogleMock releases after April 2017, mocking methods that accept or return move-only types (like `std::unique_ptr`) is fully supported.

### Migration Guidance:

- Use `MOCK_METHOD` normally for methods with move-only arguments or return types.
- When returning move-only types repeatedly, provide callable actions (like lambdas) rather than repeated `Return(std::move(...))` to avoid runtime errors.

Example:

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
};

EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
    .WillRepeatedly([](StringPiece) {
        return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

Legacy workarounds using delegating mock methods are no longer necessary.

---

## 4. Changes in Mock Strictness Behavior

GoogleMock distinguishes between **NiceMock**, **NaggyMock**, and **StrictMock** to control the handling of uninteresting calls.

- **NiceMock** suppresses warnings on uninteresting calls.
- **NaggyMock** (default) prints warnings on uninteresting calls.
- **StrictMock** treats uninteresting calls as errors.

Migration to recent versions may change warning or error behavior around uninteresting calls due to improvements in mock strictness handling. Consider reviewing your use of these wrappers and expectations that catch "all" calls with `EXPECT_CALL(...).Times(AnyNumber())`.

---

## 5. Updated Compiler Compatibility and Build Requirements

- GoogleMock now requires a C++17-compatible compiler.
- When building with MSVC, Visual Studio 2015 (v14.0) or newer is mandatory.
- On platforms using Clang or GNU compilers, recent versions are recommended to avoid warning or flag issues.

Migration instructions:

- Update your build environment to meet the minimum compiler standards.
- Adjust your CMake or build scripts to enable C++17 or later.
- Review compiler and linker flags settings as GoogleMock now overrides some defaults for better compatibility.

Example (CMake):

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

---

## 6. Changes in Threading and Pthread Support

GoogleMock tries to detect pthread support automatically, using CMake's `Threads` package.

- On MinGW platforms, pthreads are disabled by default due to known issues.
- You can override pthread support detection via `-DGTEST_HAS_PTHREAD=1` or `-DGTEST_HAS_PTHREAD=0` defines.

Ensure your build configuration reflects your threading model to avoid linker errors during migration.

---

## 7. Migration Examples and Before/After Code Snippets

### Mock Method Declaration

**Before:**
```cpp
MOCK_CONST_METHOD1(GetSize, int());
```

**After:**
```cpp
MOCK_METHOD(int, GetSize, (), (const));
```

### Setting Expectations

**Before:**
```cpp
EXPECT_CALL(foo, Bar(5))
    .Times(Exactly(3))
    .WillRepeatedly(Return(42));
```

**After:**
```cpp
EXPECT_CALL(foo, Bar(5))
    .Times(3)
    .WillRepeatedly(Return(42));
```

### Handling Move-Only Return Types

**Before:**
```cpp
EXPECT_CALL(mock_buzzer, MakeBuzz(_))
    .WillRepeatedly(Return(std::move(unique_buzz)));
```

**This now causes runtime error (moved-from value).

**Correct After Migration:**
```cpp
EXPECT_CALL(mock_buzzer, MakeBuzz(_))
    .WillRepeatedly([](StringPiece) {
        return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

---

## 8. Troubleshooting Common Migration Issues

<Tip>
If you experience compilation errors related to `MOCK_METHOD` usage or qualifiers, check that your mock method declarations include the correct fourth parameter for qualifiers such as `(const, override)`.
</Tip>

<Warning>
Linker errors on Windows related to runtime library mismatches can occur if you mix static and dynamic CRTs. Use the CMake option `gtest_force_shared_crt` carefully to align runtime linking across your project.
</Warning>

<Check>
Run your tests with increased verbosity using `--gmock_verbose=info` to see detailed matching and expectation logs aiding migration debugging.
</Check>

---

## 9. References and Related Documentation

- [Mocking Reference](https://google.github.io/googletest/docs/reference/mocking.html) - Detailed API documentation for mocks, expectations, and behaviors.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Practical recipes and migration tips.
- [Nice, Naggy, and Strict Mocks](../../guides/mocking-advanced-usage/nice-strict-mocks.md) - Behavioral differences that may impact migration.
- [CMake Build Instructions](../../getting-started/installation-guides/linux-macos-install.md) - Configure your builds for compatibility.
- [Supported Platforms](../../docs/platforms.md) - Ensure your environment is supported.

Review these resources to understand the full scope of changes affecting mock usage and integration.

---

**Taking the time to carefully migrate your mocks and tests according to these notes will ensure smooth upgrades and reliable test behavior. Refer frequently to the Mocking Reference and upgrade guides for detailed instructions.**

<Info>
For assistance, check the FAQ Troubleshooting section and community support channels if you encounter complex migration roadblocks.
</Info>
