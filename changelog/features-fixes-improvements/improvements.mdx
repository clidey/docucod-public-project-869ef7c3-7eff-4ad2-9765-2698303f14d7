---
title: "Improvements"
description: "Covers enhancements to existing features, usability upgrades, performance optimizations, or documentation improvements that contribute to a smoother testing workflow."
---

# Improvements in GoogleTest & GoogleMock

This page details the enhancements made to existing features in GoogleTest and GoogleMock that improve usability, performance, and the overall testing workflow. These improvements provide smoother experience when writing, running, and maintaining tests by refining assertion mechanisms, mocking behavior, configuration handling, and internal optimizations.

---

## 1. Enhanced Assertion Macros
- **Rich Assertion Support**: The assertion macros continue to evolve providing more expressive, readable, and maintainable verification mechanisms. Users can write assertions with custom messages using the streaming operator `<<` which helps clarify failure details.
- **Explicit Success and Failure Assertions**: Assertions such as `SUCCEED()`, `FAIL()`, and `ADD_FAILURE()` allow precise control over test outcomes, enabling more descriptive and deliberate test flows.
- **Generalized Assertions with Matchers**: Improved integration with matchers via `EXPECT_THAT()` and `ASSERT_THAT()` makes assertions more flexible and human-readable by allowing complex condition composition and expressive failure messages.

### Practical Example:
```cpp
EXPECT_THAT(value, StartsWith("Hello")) << "Value did not start with 'Hello'";
```

## 2. Usability Upgrades in Mocking

- **Simplified Mock Class Definitions**: The modern `MOCK_METHOD()` macro supports detailed specification of method qualifiers (`const`, `override`, `noexcept`, `Calltype`, `ref`), allowing mocks of even the most complex method signatures.
- **Support for Move-only Types**: Mocking methods that accept or return move-only types like `std::unique_ptr` is now seamless, enabling more realistic test doubles without complex workarounds.
- **Delegating Calls Easily**: New patterns facilitate delegating calls to fakes, real objects, or parent classes, improving test modularity and behavior reusability.
- **Configurable Mock Behavior**: Using `ON_CALL()` to set default behaviors distinct from `EXPECT_CALL()` expectations enhances mock granularity, making tests more resilient and clear.
- **Strictness Modifiers**: Mocks can be wrapped with `NiceMock`, `NaggyMock`, and `StrictMock` to control uninteresting call warnings and errors, helping users choose the right level of strictness for their tests.

### Sample Mock Definition:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, Process, (std::unique_ptr<Data> d), (override));
};
```

## 3. Configuration and Portability Improvements

- **Platform-aware Portability Layers**: Porting utilities in internal headers balance consistency across compilers and platforms, ensuring smoother builds and reliable flag handling.
- **Flag Management**: Command-line flags for GoogleMock (`GMOCK_FLAG`) and GoogleTest (`GTEST_FLAG`) are handled uniformly, supporting Abseil flags where available for better integration.
- **Compilation Efficiency**: Users are encouraged to move mock class constructors and destructors to `.cc` files to improve compile times when mocks are heavily used.

## 4. Performance Optimizations

- **Faster Compilation for Mocks**: By separating constructor and destructor implementations, compilation speed improves without affecting functionality, crucial for large test suites.
- **Reduced Run-time Overhead**: Internal refinements ensure mock invocation and verification incur minimal overhead, thus maintaining the speed of the testing workflow.

## 5. Documentation and Usability

- **Comprehensive Error Messages**: Enhanced assertion and mock failure reporting provide complete visibility into call matching and mismatched expectations.
- **User Guidance on Best Practices**: Clear advice encourages using `ON_CALL` for default mock behaviors and restricting `EXPECT_CALL` to true expectations, improving test maintainability.
- **Improved Examples and Recipes**: The `gMock Cookbook` and Assertions Reference continue to grow with practical recipes, helping users master the framework.

## 6. Troubleshooting and Common Pitfalls Addressed

- **Clear Differentiation of Uninteresting vs Unexpected Calls**: Documentation clarifies these concepts and guides on controlling warnings and errors, avoiding false test failures.
- **Handling Overloaded Methods and Const-Qualifiers**: Provides techniques like `Const()` and `SafeMatcherCast` to resolve compiler ambiguities and improve test robustness.
- **Mocking Non-Virtual and Template Methods**: Updated guidance enables mocking challenging cases effectively without compromising code design.

---

## Recommended Practices and Tips
- **Use `ON_CALL` for Default Behavior**: Reserve `EXPECT_CALL` for calls that must be verified explicitly.
- **Wrap Mocks with `NiceMock` or `StrictMock` as Needed**: To control report verbosity and error strictness.
- **Delegate to Fakes to Reuse Implementations**: Reduce duplication and increase test accuracy.
- **Define Mock Constructors Outside Headers to Accelerate Build Times**

---

## Further Reading and Related Sections
- [Assertions Reference](../reference/assertions.md) – for detailed macros and usage.
- [Mocking Reference](../reference/mocking.md) – for mock macros, classes, and best practices.
- [gMock Cookbook](../gmock_cook_book.md) – practical mocking recipes.
- [Breaking Changes](../breaking-changes-upgrade/breaking-changes.md) – for important upgrade notes.
- [Upgrade Guide](../breaking-changes-upgrade/upgrade-guide.md) – smooth migration steps.
- [Supported Platforms & Requirements](/overview/adoption-and-integration/supported-platforms-and-requirements) – prerequisites for building and running GoogleTest.

---

<Check>
Leverage these improvements to write clearer, faster, and more maintainable C++ tests using GoogleTest and GoogleMock.
</Check>

---

## Example Code Snippet: Using `ON_CALL` and `EXPECT_CALL` Correctly
```cpp
using ::testing::Return;
using ::testing::NiceMock;

class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), (override));
  MOCK_METHOD(int, Query, (const std::string& query), (override));
};

TEST(DatabaseTest, QueryReturnsExpectedData) {
  NiceMock<MockDatabase> mock_db;

  ON_CALL(mock_db, Connect("db://localhost"))
      .WillByDefault(Return(true));

  EXPECT_CALL(mock_db, Query("SELECT * FROM users"))
      .WillOnce(Return(42));

  ASSERT_TRUE(mock_db.Connect("db://localhost"));
  int result = mock_db.Query("SELECT * FROM users");
  EXPECT_EQ(result, 42);
}
```

---

# Summary

This improvement overview documents key usability upgrades, refined assertions, enhanced mocking capabilities including move-only type support and stricter call control, improved portability and build configurations, and performance optimizations. It empowers users to write clearer, maintainable, and efficient tests while providing practical guidance to avoid common pitfalls and manage test behavior effectively.

# Key Sections
- Enhanced Assertion Macros
- Usability Upgrades in Mocking
- Configuration and Portability Improvements
- Performance Optimizations
- Documentation and Usability Enhancements
- Troubleshooting and Best Practices

# Important Links
- [Assertions Reference](../reference/assertions.md)
- [Mocking Reference](../reference/mocking.md)
- [gMock Cookbook](../gmock_cook_book.md)
- [Breaking Changes](../breaking-changes-upgrade/breaking-changes.md)
- [Upgrade Guide](../breaking-changes-upgrade/upgrade-guide.md)
- [Supported Platforms & Requirements](/overview/adoption-and-integration/supported-platforms-and-requirements)

# Cross-References
- Guides on [Using GoogleMock Effectively](../guides/mocking-and-advanced-testing/using-googlemock-effectively.md) and [Best Practices in Mock Testing](../guides/mocking-and-advanced-testing/best-practices-in-mock-testing.md)
- [Core Test Workflows and Patterns](../guides/writing-and-running-tests/core-test-workflows.md)

# Action Items
- Review and adopt new mocking patterns for move-only types.
- Utilize `ON_CALL` and `EXPECT_CALL` strategically for robust tests.
- Consider separating mock constructors for faster compilation.
- Consult the Upgrade Guide when migrating versions to incorporate improvements safely.
