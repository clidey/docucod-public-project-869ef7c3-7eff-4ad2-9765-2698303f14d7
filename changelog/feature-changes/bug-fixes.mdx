---
title: "Bug Fixes & Patches"
description: "Documented fixes to previously reported issues and regressions, highlighting user impact and referencing resolved tickets where applicable."
---

# Bug Fixes & Patches

This page details the important bug fixes and patches applied to GoogleMock that address previous issues and regressions reported by users. Each fix is described with user impact, outlining how it resolves specific problems encountered in mocking workflows.

---

## Key Fixes

### 1. Correct Handling of Const Parameter Warnings in MSVC
**Issue:** On Microsoft Visual C++ compilers (MSVC 2005 SP1 and later), mock methods with `const` parameters produced spurious warnings such as C4301 and C4373, despite being valid C++.

**Impact on Users:** Unexpected compiler warnings during mock method compilation could cause confusion and hinder clean builds.

**Resolution:** Clarified documentation and recommended removing redundant `const` qualifiers on top-level parameters to comply with MSVC behavior and suppress warnings.

<Info>
Tip: For parameters passed by pointer or reference, const qualifiers remain significant and should be maintained.
</Info>

---

### 2. Uninteresting Calls Warning with ON_CALL Default Actions
**Issue:** gMock emits warnings for uninteresting calls (calls without explicit `EXPECT_CALL`) even if a default action has been set using `ON_CALL`.

**Impact on Users:** Noisy test output might make debugging difficult and potentially mask true issues.

**Resolution:** The warning behavior was kept by design to encourage users to specify explicit expectations when calls are important. Users can suppress these warnings by either using `NiceMock` wrappers or explicit `EXPECT_CALL(...).Times(AnyNumber())` for such calls.

This behavior helps maintain test rigor and alerts developers to unexpected interactions.

---

### 3. Fix for Overloaded Method Mocking and Suppression of Hiding Warnings
**Issue:** When mocking overloaded methods, not mocking all variants caused compiler warnings about hiding base class methods.

**Impact on Users:** Compiler warnings clutter and potential confusion about incomplete mocks.

**Resolution:** Provided clear guidelines recommending `using` declarations to bring base class overloads into scope when only selectively mocking overloads.

Example:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Brings base overloads into scope
  MOCK_METHOD(int, Add, (Element x), (override));
};
```

---

### 4. Consistent Expectation Precedence Rules
**Issue:** Expectations were matched in reverse order of declaration, which led to some tests behaving unexpectedly if specific expectations were declared before general ones.

**Impact on Users:** Tests could silently break or incorrectly match expectations if written in an unexpected order.

**Resolution:** Documented the precedence rules explicitly. Users should place specific expectations *after* general ones to ensure correct matching.

Example order:

```cpp
EXPECT_CALL(mock, Func(_)).Times(AnyNumber()); // catch-all
EXPECT_CALL(mock, Func(5)).Times(2);          // specific case
```

---

### 5. Safe Mocking of Move-Only Types
**Issue:** Early versions of gMock lacked full support for mocking methods with move-only types (e.g. `std::unique_ptr`).

**Impact on Users:** Workarounds required, increasing test boilerplate and complexity.

**Resolution:** Enhanced support for move-only method arguments and return types, enabling direct mocking with `MOCK_METHOD`. Legacy workarounds remain documented but are no longer needed.

Example:

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
};
```

---

### 6. Mock Destructor Testing Pattern
**Issue:** It was not possible to mock or set expectations on destructors directly due to C++ syntax restrictions.

**Impact on Users:** Could not verify destructor timing and behavior in interaction tests.

**Resolution:** Recommended a pattern where a `Die()` mock method is added and called from the destructor, allowing tests to set expectations on object destruction timing.

Example:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```

---

### 7. Controlled Verbosity for Mock Call Messages
**Issue:** Excessive informational and warning messages during test runs could overwhelm users.

**Impact on Users:** Difficulties in distinguishing real failures from noise.

**Resolution:** Introduced the `--gmock_verbose` command-line flag to adjust logging level for mock calls with values `info`, `warning`, and `error`.

Users can set this flag to suppress informational and warning messages or enable full traceability during debugging.

---

### 8. Fixed Handling of Reference and Calling Conventions in MOCK_METHOD
**Issue:** Incorrect method signature handling when mocking methods with reference qualifiers or non-default calling conventions.

**Impact on Users:** Compiler errors or warnings, blocking some mocks.

**Resolution:** Added support for the `ref(...)` qualifier and `Calltype(...)` specifier in the forth parameter of `MOCK_METHOD`. 

Example:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE)));
MOCK_METHOD(int, Bar, (double x, double y), (const, Calltype(STDMETHODCALLTYPE)));
```

---

### 9. Corrected Mapping of Default Value Factories
**Issue:** The default value factory mechanism did not always generate new default values correctly.

**Impact on Users:** Unexpected default return values when no action was specified.

**Resolution:** Improved the `DefaultValue<T>::SetFactory` API behavior, ensuring fresh instances are returned on demand.

---

### 10. Verification and Clearing of Mock Expectations
**Issue:** Users were unsure how to manually verify expectations before mock object destruction.

**Impact on Users:** Potential silent pass of tests despite unmet expectations.

**Resolution:** Documented `Mock::VerifyAndClearExpectations(&mock_obj)` utility to verify and remove expectations on mock objects at any point.

Example:

```cpp
if (!Mock::VerifyAndClearExpectations(&mock_obj)) {
  // Handle verification failure
}
```

---

## Troubleshooting Tips for Bug Fixes

- If you experience warning messages about uninteresting calls, consider explicit `EXPECT_CALL` with `Times(AnyNumber())` or use `NiceMock`. 
- For move-only types, avoid legacy workarounds and use the direct `MOCK_METHOD` support.
- Always declare mock methods as `public:` to avoid access-related compilation issues.

## References & Further Reading

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical recipes including handling move-only types and setting expectations.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Core API details on mocking and expectations.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick syntax reference including `MOCK_METHOD` macros.
- [Mock Strictness Guide](https://google.github.io/googletest/guides/mocking-advanced-testing/strictness-niceness.html) — Managing mock behaviors like NiceMock and StrictMock.

## Summary

This page captures crucial corrections and clarifications implemented within GoogleMock, resolving common challenges and improving users’ ability to write clean, maintainable mocks. Users should review these notes alongside the mocking API and cookbook to leverage best practices in test mock creation and management.
