---
title: "New Features & Enhancements"
description: "Summaries and technical details of newly added APIs, options, and behaviors available in recent releases, mapped to their main entry points. Ideal for developers looking to leverage new capabilities immediately."
---

# New Features & Enhancements

This page provides comprehensive summaries and detailed technical insights into the new APIs, options, and behaviors introduced in recent GoogleMock releases. It is designed to guide developers who want to immediately leverage the latest mocking capabilities, ensuring that they understand what new features are available, how to use them effectively, and how they integrate with existing workflows.

---

## 1. Introduction to New Features

With each new release, GoogleMock evolves to offer improved syntax, more expressive mocking capabilities, and enhanced behavior control. This page focuses specifically on these additions—highlighting their practical value and guiding you through the updated interfaces and usage patterns.

Whether enhancing your tests with refined matchers, introducing new clauses for call expectations, or improving default behaviors, you’ll find the essential information to get started here.


## 2. New Expectation Specification Clauses

### Enhanced `EXPECT_CALL` and `ON_CALL` DSL

The core macros for defining mock behavior—`EXPECT_CALL` and `ON_CALL`—have been enriched to support additional modifiers and behaviors, aligning with evolving testing needs.

#### The `.With()` Clause

- **Purpose**: Restricts expectations or default behaviors to only match calls whose arguments as a *whole tuple* satisfy a specified matcher.
- **How It Works**: Instead of matching individual arguments separately, `.With()` applies a matcher over the entire argument tuple.

#### Use Case Example:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // Expects first argument less than second
```

This allows for intricate argument relationships to be verified beyond simple positional matching.


### `.RetiresOnSaturation()` Clause

- **Purpose**: Newly added control to retire expectations once they are saturated, making them inactive for any further matching calls.
- **User Benefit**: Helps manage sticky expectations by letting them automatically disable themselves when they should no longer match, avoiding upper-bound violations or unexpected call errors.

#### Example:

```cpp
EXPECT_CALL(mock, SetNumber(7))
    .Times(2)
    .RetiresOnSaturation();
// Matches first two calls, then is retired
```


## 3. Default Actions and Behavior Control

### Behavior of Uninteresting and Unexpected Calls

GoogleMock now provides finer-grained control over what happens when calls occur that don't match any expectation (`uninteresting`) or don't match any active expectation despite being expected (`unexpected`).

#### Verbosity Control

- The `--gmock_verbose` flag has been enhanced with clearer levels: `info`, `warning`, and `error`.
- At `info` level, full call and expectation traces are printed, aiding in debugging complex tests.
- Default behavior remains a warning for uninteresting calls, but a test failure for unexpected calls.

### Use of Mock Strictness Classes

- The types `NiceMock<T>`, `NaggyMock<T>`, and `StrictMock<T>` continue to provide control over warnings and errors on uninteresting calls.
- Their interactions with new clauses like `.RetiresOnSaturation()` are fully supported.


## 4. Support for Move-Only Types

Modernizing mocks for C++11 and beyond, GoogleMock supports mocking methods that accept and return move-only types like `std::unique_ptr`:

- Define mock methods as usual using `MOCK_METHOD`, no special syntax needed.
- Use lambdas or functors in `WillOnce()` or `WillRepeatedly()` to return freshly created move-only objects per call.

Example:

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
};
...
EXPECT_CALL(mock_buzzer_, MakeBuzz("hello"))
    .WillRepeatedly([](StringPiece) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

This ensures safe, predictable behavior when mocking APIs using modern C++ features.


## 5. New and Improved Matchers & Actions

GoogleMock’s matcher and action systems have been extended with new features:

- **Multi-argument matchers:** Use `.With()` to apply matchers on full argument tuples, for relational argument constraints.
- **SafeMatcherCast:** Safely cast matchers to different but compatible argument types, helping resolve type mismatches silently.
- **Actions:** Lambdas, functors, and functions can now be seamlessly used with `EXPECT_CALL` for more expressive behaviors, including side effects.


## 6. Sequences and Partial Ordering Enhancements

- Expanded support for expression of complex call order constraints using multiple `Sequence` objects.
- Usage patterns like `.InSequence(s1, s2)` allow creation of partial orders (DAGs) among expectations, improving test modeling of real asynchronous or interleaved call scenarios.

Example:

```cpp
Sequence s1, s2;
EXPECT_CALL(mock, A()).InSequence(s1, s2);
EXPECT_CALL(mock, B()).InSequence(s1);
EXPECT_CALL(mock, C()).InSequence(s2);
```

This captures call relations where `A` precedes both `B` and `C`, but `B` and `C` can occur in any order relative to each other.


## 7. Handling Leaked Mocks

New mechanisms detect and report deliberately or accidentally leaked mock objects at program exit:

- By default, failures occur if mocks are leaked, ensuring that all expectations are verified.
- The flag `--gmock_catch_leaked_mocks=true` forces detection and reports leaks.
- The user can suppress leak check for a mock using `Mock::AllowLeak(mock_object)`.


## 8. Migration and Compatibility

- Old-style `MOCK_METHODn` macros are still supported but migration to generic `MOCK_METHOD` is recommended for enhanced capabilities and consistency.
- The new clauses and features are backward-compatible.


---

## Troubleshooting and Best Practices

- **Specify `.RetiresOnSaturation()` when chaining multiple expectations on the same method with overlapping argument matchers** to prevent sticky, upper-bound-violation failures.
- Use **`--gmock_verbose=info`** during test development or debugging to visualize mock call matching and expectation activation.
- When mocking **move-only types**, prefer **lambdas** in action clauses to generate fresh instances per call.
- For complex call ordering, leverage **`Sequence`** and **`InSequence`** to minimize brittle tests.
- Use **`Mock::AllowLeak`** judiciously to suppress expected leaks, but prefer deleting mocks to ensure expectations are verified.


## Additional Resources

- [Mocking Reference](docs/reference/mocking.md) offers a full catalog of macros, classes, and usage notes.
- [gMock Cookbook](docs/gmock_cook_book.md) contains many recipes demonstrating practical patterns and workarounds.
- [Matchers Reference](api-reference/advanced-mocking-matchers-actions/matchers-reference.md) details built-in and custom matcher usage.
- [Actions Reference](api-reference/advanced-mocking-matchers-actions/actions-reference.md) explains defining and using mock actions.
- [Breaking Changes & Migration Paths](changelog/upgrade-guides/breaking-changes.md) for smooth upgrades.


---

For an in-depth understanding, consult the full [GoogleMock API Reference](api-reference/core-apis/mocking-core-api.md) and related guides on configuring expectations and managing strictness.

<Check>
Set the verbosity flag to `info` for maximum insight: run tests with `--gmock_verbose=info`.
</Check>

<Check>
Apply `.RetiresOnSaturation()` thoughtfully to avoid subtle failures in repeated call expectations.
</Check>

<Note>
New features enhance readability and control in your tests, but breaking changes (see migration guide) may require updates to your mocks.
</Note>


---