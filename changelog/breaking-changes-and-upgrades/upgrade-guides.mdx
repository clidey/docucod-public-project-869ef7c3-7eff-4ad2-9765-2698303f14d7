---
title: "Upgrade Guides"
description: "Step-by-step advice for upgrading between major GoogleTest/GoogleMock versions. Points out important gotchas, strategies for resolving deprecations, and code examples for migrating usage of removed or changed APIs."
---

# Upgrade Guides

This guide provides step-by-step advice for upgrading between major GoogleTest and GoogleMock versions. It highlights important considerations, known gotchas, and practical strategies to smoothly migrate your codebase, especially focusing on changes that might affect your mocking usage and test infrastructure.

---

## 1. Introduction

Upgrading GoogleTest and GoogleMock between major releases can impact existing test suites due to changes in APIs, behaviors, or deprecations. This guide is designed to help you anticipate those changes and apply best practices to update your tests efficiently and correctly.

---

## 2. Common Upgrade Scenarios and Strategies

### 2.1 Migration of Mock Method Macros

GoogleMock transitioned to a unified `MOCK_METHOD` macro replacing the older family of `MOCK_METHODn` macros. The new macro provides better support for qualifiers, call types, and complex signatures.

**What to do:**

- Replace all uses of `MOCK_METHODn` and related macros (e.g., `MOCK_CONST_METHODn`, `MOCK_METHODn_WITH_CALLTYPE`) with `MOCK_METHOD`.
- Use the latest syntax: 

  ```cpp
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
  ```

- Wrap argument or return types containing commas in parentheses or use type aliases to avoid parsing errors.

**Example:**

```cpp
// Old style
MOCK_CONST_METHOD1(foo, bool(int));

// New style
MOCK_METHOD(bool, foo, (int), (const, override));

// Handling comma in types
using PairType = std::pair<bool, int>;
MOCK_METHOD(PairType, GetPair, ());
```

**References:**
- [Mock Class and Method Macros](../api-reference/mocking-matching-actions/mock-class-macros.mdx)
- [gMock Cookbook](../guides/mocking-techniques/gmock_cook_book.mdx)

### 2.2 Managing Mock Strictness Wrappers

Mock strictness wrappers—`NiceMock`, `NaggyMock`, and `StrictMock`—control how uninteresting calls on mocks are handled. The default behavior is currently "naggy," but a shift towards "nice" by default is planned.

**What to do:**

- Review your tests that rely on warnings or errors for uninteresting calls.
- To suppress warnings on uninteresting calls, wrap your mock with `NiceMock<T>`. To enforce errors, use `StrictMock<T>`.
- Ensure your mock class:
  - Defines mock methods with `MOCK_METHOD` directly in the minimal class.
  - Has a virtual destructor to allow proper strictness behavior.

**Constructors:**

`NiceMock`, `NaggyMock`, and `StrictMock` inherit constructors, so you can pass arguments to underlying mock constructors as usual.

**Example:**

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock(5, "arg");
StrictMock<MockBar> strict_mock;
```

**Important:**

- Avoid nested wrappers like `NiceMock<StrictMock<T>>`.
- Check for virtual destructors; lacking them can cause warnings or failures.

**References:**
- [Mock Strictness and Behavior Modes](../api-reference/mocking-matching-actions/mock-behaviors.mdx)
- [GoogleMock Nice, Naggy, Strict](docs/gmock_cook_book.md#NiceStrictNaggy)

### 2.3 Updating Handling of Uninteresting and Unexpected Calls

GoogleMock distinguishes *uninteresting* calls (no expectation set) and *unexpected* calls (calls not matching any expectation). Defaults around warnings and errors might have changed.

**Recommended actions:**

- Use `ON_CALL` to define default behaviors without setting call expectations.
- Use `EXPECT_CALL` only when you want to enforce that a method is called.
- For methods expected to be called any number of times without specific verification, use:

```cpp
EXPECT_CALL(mock_obj, MethodName(_)).Times(AnyNumber());
```

- To silence warnings resulting from uninteresting calls when you don't want to verify specific behavior, wrap mocks with `NiceMock`.

**References:**
- [Expectations, Calls, and Cardinalities](../api-reference/mocking-matching-actions/expectations-calls.mdx)
- [Mocking Patterns and Best Practices](../guides/mocking-techniques/mocking-patterns-and-best-practices.mdx)

### 2.4 Transitioning from Older Macros or APIs

Some APIs or behaviors have been deprecated or changed.

**Examples:**

- Using the older `MOCK_METHODn` family macros should be replaced by `MOCK_METHOD`.
- Adjust code leveraging `ON_CALL` and `EXPECT_CALL` to respect the limits on usage order and method qualifiers.

---

## 3. Code Examples for Common Migration Tasks

### 3.1 Mocking a Const Method

**Old:**
```cpp
MOCK_CONST_METHOD1(GetValue, int(int));
```

**New:**
```cpp
MOCK_METHOD(int, GetValue, (int), (const, override));
```

### 3.2 Mocking Methods with Call Type Qualifiers (Windows)

```cpp
MOCK_METHOD(bool, Foo, (int), (Calltype(STDMETHODCALLTYPE)));
```

### 3.3 Wrapping Mocks with Strictness Wrappers

```cpp
NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, SomeMethod());
// Use mock_foo as usual.
```

### 3.4 Using `RetiresOnSaturation` to Manage Sticky Expectations

```cpp
EXPECT_CALL(mock, Method(42))
    .Times(2)
    .RetiresOnSaturation();
```

RetiresOnSaturation ensures that once the expectation is fully used, it retires so later calls don't cause errors.

---

## 4. Common Pitfalls and How to Avoid Them

- **Issue:** Nested strictness wrappers cause undefined behavior.
  - **Solution:** Only use one wrapper per mock class.

- **Issue:** Mock methods defined in base classes don't respect strictness wrappers.
  - **Solution:** Define `MOCK_METHOD` in the final mock class if strictness is required.

- **Issue:** Unprotected commas in mock method argument lists cause compilation failures.
  - **Solution:** Use parentheses or type aliases to wrap complex types.

- **Issue:** Tests fail unexpectedly after upgrading due to default uninteresting call warnings or errors.
  - **Solution:** Add explicit `EXPECT_CALL(...).Times(AnyNumber())` or wrap mocks with `NiceMock`/`StrictMock` accordingly.

---

## 5. Troubleshooting

If you encounter build errors or unexpected failures after upgrading:

- Verify you have replaced all old mock macros with the new `MOCK_METHOD` style.
- Ensure that constructors and destructors of your mocks are defined if compilation time or linking issues occur.
- Run your tests with `--gmock_verbose=info` to see detailed mock call traces, helping you identify mismatches in expectations.
- Confirm your mock classes have virtual destructors when using strictness wrappers.

---

## 6. Additional Resources

- [Mock Class and Method Macros](../api-reference/mocking-matching-actions/mock-class-macros.mdx)
- [EXPECT_CALL Reference](../api-reference/mocking-matching-actions/expectations-calls.mdx)
- [Mock Strictness and Behavior Modes](../api-reference/mocking-matching-actions/mock-behaviors.mdx)
- [gMock Cookbook](../guides/mocking-techniques/gmock_cook_book.mdx)
- [Using Assertions Effectively](../guides/core-workflows/using-assertions-effectively.mdx)
- [Latest Release Notes](../changelog/release-history/latest-release-notes.mdx)

---

This upgrade guide empowers you with practical knowledge and examples to transition your tests flawlessly to current GoogleTest and GoogleMock versions, reducing maintenance overhead and improving test reliability.