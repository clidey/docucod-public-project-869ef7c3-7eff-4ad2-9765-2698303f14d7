---
title: "Breaking Changes & Migration Notes"
description: "Flag all breaking or incompatible changes, such as increases to the minimum supported C++ standard, API removals, or altered core behaviors. Includes migration strategies with code examples or links out to fuller modernization documentation."
---

# Breaking Changes & Migration Notes

GoogleTest continuously evolves to provide a modern, robust C++ testing framework, but some updates introduce breaking or incompatible changes that require adjustments in your codebase. This page highlights all such breaking changes affecting GoogleTest and GoogleMock, focusing on those that impact your tests or mocks directly. It also provides practical migration strategies, including code snippets and pointers to detailed modernization guides.

---

## Overview

If you are upgrading GoogleTest to a newer major or minor version, especially starting from version 1.17.0 which requires a minimum of C++17 support, you must carefully review this page to identify any API removals, changes in core behaviors, or compiler requirements that may impact your existing tests or mocks.

This documentation is specifically focused on breaking changes and migration notes related to GoogleTest and GoogleMock’s API and usage patterns, not on other unrelated parts of the product.

---

## Key Breaking Changes

### 1. Minimum C++ Standard Raised to C++17

- Beginning with version 1.17.0, GoogleTest and GoogleMock require your project to be compiled with at least the C++17 standard.
- This change affects your build configuration. Ensure that your compiler flags reflect this requirement (e.g., `-std=c++17` or equivalent).

<Tip>
Failing to comply may lead to compilation errors or undefined behaviors.
</Tip>

### 2. New `MOCK_METHOD` Macro Syntax and Deprecation of Old Macros

- The recommended way to define mock methods is the unified `MOCK_METHOD` macro, which has this syntax:

  ```cpp
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
  ```

- Old-style `MOCK_METHODn` macros (such as `MOCK_METHOD1`, `MOCK_CONST_METHOD1`, `MOCK_METHOD1_WITH_CALLTYPE`) are deprecated and will be removed in future versions.

- Migration recommendation:
  - Replace all usages of old macros with the new `MOCK_METHOD` macro.
  - Example:

    ```cpp
    // Old style
    MOCK_METHOD1(Foo, bool(int));

    // New style
    MOCK_METHOD(bool, Foo, (int), ());

    // With qualifiers
    MOCK_METHOD(bool, Foo, (int), (const, override));
    ```

- This change improves clarity and adds support for qualifiers like `const`, `override`, `noexcept`, and `Calltype`.

<Check>
Refer to the [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#MOCK_METHOD) for detailed syntax.
</Check>

### 3. Handling Commas in Return and Argument Types

- When mocking methods with return or argument types containing commas (e.g., `std::pair`, `std::map`), the type must be enclosed with extra parentheses or aliased to avoid macro parsing errors.

- Migration example:

  ```cpp
  // Ambiguous - will not compile:
  MOCK_METHOD(std::pair<int, int>, GetPair, ());

  // Correct - wrap return type in parentheses:
  MOCK_METHOD((std::pair<int, int>), GetPair, ());

  // Or use type alias:
  using IntPair = std::pair<int, int>;
  MOCK_METHOD(IntPair, GetPair, ());
  ```

### 4. Mocking Overloaded and Reference-qualified Methods

- GoogleMock’s new `MOCK_METHOD` fully supports mocking overloaded methods and methods qualified with reference qualifiers (`&` or `&&`).

- You must explicitly specify qualifiers in the macro’s fourth argument.

- Example for mocking a const reference-qualified method:

  ```cpp
  MOCK_METHOD(int, GetValue, (), (const, ref(&), override));
  ```

- Use the `Const()` wrapper to disambiguate calls to const-overloaded mock methods in expectations.

### 5. Expectation Orderand Behavior Changes

- GoogleMock matches function calls against expectations in reverse order; newer expectations take precedence over older ones.

- Expectations are "sticky" by default, meaning they remain active even after saturation unless explicitly instructed otherwise with `.RetiresOnSaturation()`.

- Failure to retire saturated expectations can lead to unexpected test failures.

<Warning>
When upgrading, re-examine tests with multiple expectations on the same mock method to ensure their semantics remain valid.
</Warning>

### 6. Changes in Behavior of Death Tests

- Death Tests run code in a subprocess; any state changes inside the death test do not propagate to the parent process, affecting mocks and expectations.

- You should place all `EXPECT_CALL`s related to mock methods invoked by death test code *inside* the death test macro.

- Changing the death test style to `threadsafe` can improve stability in multi-threaded contexts but may rerun tests multiple times.

---

## Migration Strategies and Examples

### Upgrading to C++17

Update your build system’s compiler flags:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

Or, for manual command lines:

```bash
g++ -std=c++17 ...
```

<Tip>
This change unlocks safer standard features and improves GoogleTest compatibility.
</Tip>

### Replacing Deprecated Mock Method Macros

Before:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD1(FooMethod, bool(int));
  MOCK_CONST_METHOD1_CONST(BarMethod, int(float));
};
```

After:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(bool, FooMethod, (int), (override));
  MOCK_METHOD(int, BarMethod, (float), (const, override));
};
```

---

### Fixes for Sticking Expectations

If you have loops setting multiple `EXPECT_CALL`s on a mock method without `.RetiresOnSaturation()`, tests may fail after upgrading. Change like this:

```cpp
for (int i = 1; i <= n; ++i) {
  EXPECT_CALL(mock, Foo())
      .WillOnce(Return(i))
      .RetiresOnSaturation();
}
```

Better yet, include the expectations in a sequence:

```cpp
{
  ::testing::InSequence s;
  for (int i = 1; i <= n; ++i) {
    EXPECT_CALL(mock, Foo())
        .WillOnce(Return(i));
  }
}
```

---

### Handling Mock Methods With Complex Return or Argument Types

Add parentheses around types containing commas or use type aliases.

```cpp
using PairInt = std::pair<int, int>;
MOCK_METHOD(PairInt, GetCoords, ());
```

This prevents macro parsing errors after migrating to the new `MOCK_METHOD` macro.

---

### Dealing with Overloads and Qualifiers in EXPECT_CALL

Disambiguate expectations on overloaded methods with `Const()` or explicit casting:

```cpp
EXPECT_CALL(mock, GetValue());  // Non-const
EXPECT_CALL(Const(mock), GetValue());  // Const-qualified
```

For overloaded methods differing by argument type, use typed matchers:

```cpp
EXPECT_CALL(mock, Method(An<int>()));
EXPECT_CALL(mock, Method(TypedEq<char>('c')));
```

---

## Common Pitfalls and Troubleshooting

### Uninteresting Mock Warning after ON_CALL

If you set behavior with `ON_CALL()` but no matching `EXPECT_CALL()`, gMock will warn on calls.

If these calls are legitimately expected but without verification, use `EXPECT_CALL(...).Times(AnyNumber())` to suppress warnings.

### Failing to Return `RUN_ALL_TESTS()` Result

Make sure your test program’s `main()` returns the value of `RUN_ALL_TESTS()`. Ignoring this return value can cause tests to report success incorrectly.

### Naming Restrictions

Avoid underscores in `TestSuiteName` and `TestName` in `TEST()` to prevent name collisions and compiler/linker issues.

### Using Death Tests with Threads

Ensure the code inside death tests is thread-safe. Consider setting `--gtest_death_test_style=threadsafe` and restructure death tests to minimize threading issues.

---

## Resources & Further Reading

- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Breaking Changes & Upgrade Guides](./breaking-changes-upgrade-guides/)

---

## Summary

Upgrading GoogleTest involves adopting modern C++ standards (C++17+), updating mock method declarations to the new `MOCK_METHOD` macro with explicit qualifiers, adjusting test expectations for changed matching semantics, and revisiting death tests' usage patterns. Careful attention to these breaking changes ensures your tests remain robust, maintainable, and benefit from GoogleTest’s latest enhancements.

<Tip>
Keep your tests resilient by specifying `.RetiresOnSaturation()` where appropriate, carefully use `Const()` for overloaded methods, and suppress uninteresting mock warnings mindfully with suitable expectations.
</Tip>

---

## Contact & Contribution

Please report upgrade difficulties or suggest improvements via GoogleTest’s GitHub repository issues: https://github.com/google/googletest/issues

Contributions to upgrading guides and fixed migration examples are most welcome.
