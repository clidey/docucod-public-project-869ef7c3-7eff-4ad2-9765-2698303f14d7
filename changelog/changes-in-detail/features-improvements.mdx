---
title: "New Features & Improvements"
description: "Summarizes the most impactful additions and enhancements to GoogleTest and GoogleMock, mapped to their real-world benefits in testing workflows."
---

# New Features & Improvements

Welcome to the comprehensive update on the latest enhancements introduced to GoogleTest and GoogleMock. This page distills the most impactful additions and refinements specifically in the realm of mocking expectations and default behaviors, linking them directly to the everyday testing challenges you face and the workflows you aim to optimize.

---

## Elevating Mocking Workflows with ON_CALL and EXPECT_CALL Enhancements

### Default Behavior Specification with ON_CALL

The ON_CALL macro empowers you to finely tailor the default behavior of mock methods without imposing expectations on invocations. Using ON_CALL, you can specify how your mock responds to calls matching certain argument patterns, enabling resilient and maintainable test setups.

#### Key Benefits

- Define default return values or side effects independent of call count expectations.
- Compose layered behaviors by combining ON_CALL with EXPECT_CALL for precise test control.
- Utilize the `.With()` clause to restrict default behavior to argument tuples matching complex criteria.

#### Usage Example

```cpp
// Set default behavior for DoSomething() to return true when called
ON_CALL(mock_object, DoSomething(_))
    .WillByDefault(Return(true));
```

This allows calls to `DoSomething()` without setting explicit call expectations, thereby reducing test brittleness while ensuring meaningful default behavior.


### Fine-Grained Expectations with EXPECT_CALL

EXPECT_CALL remains your primary tool to assert that specific mock method calls happen with defined arguments, cardinality, and sequences. Recent improvements emphasize flexibility and clarity in specifying behavior and ordering.

#### Enhanced Clauses and Their User Value

- **`.With()` Clause**: Target expectations with argument tuple matchers, enabling validation of multi-argument conditions beyond individual parameter constraints.
- **`.Times()` Clause**: Specify exact, minimum, maximum, or range call counts. Omitting Times results in intuitive default inference incorporating `.WillOnce()` and `.WillRepeatedly()` counts.
- **Ordering Controls**: Use `.InSequence()` for strict ordered calls, and `.After()` for directed acyclic precedence relations, supporting both fully and partially ordered interaction verification.
- **Action Specification**: Chain `.WillOnce()` for series of different reacts per call and `.WillRepeatedly()` for continuous default reactions. The `.RetiresOnSaturation()` clause provides automatic expectation retirement for cleaner semantics and fewer false errors.

#### Illustrative Example

```cpp
Sequence s;
EXPECT_CALL(mock_object, Compute(_, _))
    .Times(3)
    .InSequence(s)
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));
```

This expectation ensures that `Compute` is called three times in order, returns 10, then 20, then 30 for all subsequent calls.

### New User Experiences and Best Practices

- **Order of Clause Usage**: Clauses in EXPECT_CALL must be declared in a logical sequence: `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, `.RetiresOnSaturation()`.
- **Sticky vs Retiring Expectations**: Expectations remain active by default after saturation, but you can specify `.RetiresOnSaturation()` to avoid errors from subsequent calls.
- **Combining ON_CALL and EXPECT_CALL**: Use ON_CALL for setting default mock method behavior globally and EXPECT_CALL for verifying specific interactions in your tests.
- **Resolving Overloads and Constness**: Employ explicit argument specifications or the `Const()` function to clarify which overloaded or const version of a method the expectation or default behavior refers to.

---

## Real-World Impact and User Value

These mocking enhancements transform your testing experience in several practical ways:

- **Improved Test Resilience**: By separating default stub behavior (`ON_CALL`) from explicit interaction verification (`EXPECT_CALL`), tests become less brittle to implementation changes.
- **Clearer Test Intent**: Sequencing and cardinality controls highlight the intended order and frequency of calls, making tests easier to read and debug.
- **Efficient Mock Setup**: Default behaviors reduce the need for repetitive expectations, facilitating cleaner test code and faster test writing.
- **Enhanced Debugging Support**: Detailed failure messages and warnings about unexpected or excessive calls guide users toward quicker diagnosis.

---

## Troubleshooting Highlights

- If you receive warnings about uninteresting function calls, consider whether the call needs an `EXPECT_CALL` or if a `NiceMock` wrapper would be more appropriate.
- When expectations do not match calls as expected, using the `--gmock_verbose=info` flag can provide detailed traces of mock function calls and expectation matches.
- Unintended matching failures may arise when argument types or overloads are ambiguous. Explicit matcher use and overload resolution strategies are essential.

---

## Practical Tips

- Structure your mocks with ON_CALL in your test setup to establish stable defaults.
- Use EXPECT_CALL sparingly to assert important interactions.
- When expecting call sequences, wrap EXPECT_CALLs in an `InSequence` scope.
- For partial or complex ordering, use `.After()` clauses with carefully managed `Expectation` or `ExpectationSet` objects.
- To avoid brittleness, avoid over-specifying argument matchers unless needed for your test goal.

---

## Further Resources

- [Mock Class Definition and Method Mocking](../api-reference/mocking-apis/mock-class-definition.md) — How to define and use mock classes with `MOCK_METHOD`.
- [Expectations and ON_CALL](../api-reference/mocking-apis/expectations-and-on-call.md) — The full syntactic and semantic guide to setting expectations and default behaviors.
- [gMock Cookbook](../docs/gmock_cook_book.md) — Recipes and best practices for mocking workflows.
- [Mocking Object Model Concepts](../concepts/mocking-and-extensibility/mock-object-model.md) — Core concepts underpinning mock expectations.
- [Strictness and Uninteresting Calls](../api-reference/mocking-apis/strictness-and-uninteresting-calls.md) — Understanding and controlling uninteresting call warnings and errors.

Explore these to deepen your mastery and leverage the full power of GoogleMock in your testing workflows.

---

## Summary
This page highlighted the latest enhancements and practical value of the ON_CALL and EXPECT_CALL macros, emphasizing their role in defining mock default behaviors and verifying call expectations with fine-grained control over call order, frequency, and argument matching.

By mastering these features, you will write more resilient, readable, and effective tests that capture your intent precisely, reduce maintenance overhead, and speed debugging.


