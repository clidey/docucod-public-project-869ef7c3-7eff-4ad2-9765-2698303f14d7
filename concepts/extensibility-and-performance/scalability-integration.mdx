---
title: "Scaling, Integration & Performance"
description: "Get an overview of how GoogleTest and GoogleMock handle large codebases, parallel execution, and integration with build tools. Learn best practices for performance, and approaches for integrating with various CI/CD pipelines."
---

# Scaling, Integration & Performance

Get an overview of how GoogleTest and GoogleMock handle large codebases, parallel execution, and integration with build tools. Learn best practices for performance, and approaches for integrating with various CI/CD pipelines.

---

## Introduction

As your C++ project grows, managing tests efficiently becomes critical. GoogleTest and GoogleMock provide robust support to scale testing to large codebases, run tests in parallel to speed feedback, and integrate seamlessly into modern build systems and continuous integration environments.

This guide helps you understand the core concepts and strategies to ensure your test suites stay fast, maintainable, and effective even as complexity increases.

---

## Scaling Testing to Large Codebases

### Organizing Tests for Speed and Maintainability

- **Group Related Tests into Test Suites and Fixtures**: Use test suites and fixtures to logically organize tests around components or features. This facilitates better maintainability and shared setup/teardown where appropriate.

- **Use Parameterized and Typed Tests**: These features allow you to write a single test definition that runs multiple times with different input values or types, reducing redundant code and enabling thorough coverage with less maintenance effort.

- **Isolate Expensive or Flaky Tests**: Mark long-running or unstable tests separately so they can be run less frequently or in isolation, preventing slowdowns or noise in your main test runs.

### Sharing Setup Across Tests

GoogleTest creates a new fixture instance for every test, ensuring isolation. However, initializing expensive resources repeatedly is costly.

- Use `SetUpTestSuite()` and `TearDownTestSuite()` to initialize expensive shared resources once per test suite.

- Ensure shared state is either immutable or properly synchronized across tests.

### Managing Test Dependencies and Ordering

Avoid relying on the order of test execution. GoogleTest runs tests in an undefined order by default.

If ordering is required, use constructs like `Sequence` or ordering constraints in GoogleMock.

---

## Parallel and Distributed Execution

### Running Tests in Parallel

- **Test Sharding**: GoogleTest supports running tests with multiple shards, spreading tests across parallel processes or machines. Set the environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` to configure sharding.

- **Flag-based Test Filtering**: Use `--gtest_filter` to select subsets of tests for parallel execution.

- **Recommandations for Thread Safety**:
  - GoogleTest is thread-safe on platforms supporting pthreads or Windows threads.
  - When using GoogleMock with threads, verify expectations carefully to avoid data races.

- **Performance Tips**:
  - Avoid global mutable state accessed by parallel tests.
  - Employ thread-safe constructs, and leverage GoogleTest's synchronization where applicable.

### Handling Flaky Tests and Test Stability

- Use the `--gtest_repeat` flag to execute flaky tests several times to catch intermittent failures.

- Mark tests as disabled with the `DISABLED_` prefix when fixing is pending, but fix them timely.

---

## Integration with Build Systems

### CMake

- Use `FetchContent` or external projects to download and build GoogleTest and GoogleMock.

- Link your test targets with the `gtest` and `gmock` libraries.

- Use CMake's `add_test()` to integrate tests with `ctest` and enable parallel execution via `ctest -j`.

- Example snippet:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.13.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest gmock_main)
add_test(NAME MyTests COMMAND my_tests)
```

### Bazel

- Define GoogleTest and GoogleMock as external dependencies.

- Use `cc_test` rules to declare tests.

- Leverage Bazel's parallel and incremental build systems to optimize test execution.

### Continuous Integration

- Run your tests as part of automated CI pipelines.

- Use build system support for test sharding and parallel execution to speed up pipelines.

- Use GoogleTest's XML or JSON output for test reporting and integration with dashboard tools.

- Monitor and track flaky tests, runtime, and failure rates.

---

## Performance Optimization Best Practices

### Efficient Test Design

- Prefer lightweight fixtures, and avoid expensive per-test setup when possible.

- Use parameterized tests to reduce code duplication.

- Write clear, focused tests that verify minimal functionality each.

### Minimize Test Interferences

- Tests should be independent and avoid shared mutable state.

- Use GoogleTest features to isolate tests and correctly manage setup and teardown.

### Logging and Reporting

- Use selective logging and test property recording (`RecordProperty`) to include valuable diagnostics without impacting performance.

- Use filtering to run only the necessary tests during development cycles.

---

## Troubleshooting Common Pitfalls

<AccordionGroup title="Common Issues & Solutions">
<Accordion title="Tests Running Too Slowly">
- Identify and isolate slow tests.
- Use `SetUpTestSuite()` / `TearDownTestSuite()` instead of per-test setup.
- Use test sharding and parallel execution.
- Avoid unnecessary heavy resource allocations in tests.
</Accordion>
<Accordion title="Flaky Tests and Race Conditions">
- Use thread-safe mocks and synchronization.
- Repeat tests to identify flaky behavior.
- Isolate flaky tests by disabling or running separately.
- Consider redesigning tests that rely on timing or side effects.
</Accordion>
<Accordion title="Build Integration Issues">
- Ensure GoogleTest and GoogleMock versions in build files are consistent.
- Verify C++17 language standard compliance.
- Check for missing dependencies in CMakeLists or Bazel BUILD files.
- Use official integration examples to guide setup.
</Accordion>
</AccordionGroup>

---

## Summary

Scaling GoogleTest and GoogleMock to large projects involves structuring tests with suites and fixtures, leveraging parameterization to reduce duplication, and isolating expensive resources. Running tests in parallel via sharding and thread-safe constructs drastically improves test execution times in complex codebases.

Integration with build systems like CMake and Bazel ensures seamless compilation and execution, while continuous integration pipelines benefit from automated reporting, parallel execution, and failure tracking.

Following best practices for test design and setup lifecycle, and leveraging GoogleTest features for skipping, filtering, and property recording, keeps your test suite both performant and maintainable.

---

## Additional Resources

- [GoogleTest Primer](primer.md): For foundational testing concepts and writing simple tests.
- [Parameterized and Typed Tests Guide](concepts/core-testing-model/parameterized-typed-tests.mdx)
- [Test Registration & Execution API Reference](api-reference/core-testing/test-registration-execution.md)
- [Build System Integration Guide](guides/integration_and_effectiveness/build_system_integration.md)
- [Test Sharding and Parallel Execution Guide](guides/integration_and_effectiveness/scaling_and_optimization.md)
- [GoogleMock Overview](googlemock/README.md)

---

## Diagram: Scalable Testing Workflow

```mermaid
flowchart TD
  A[Write Test Cases] --> B[Group Into Suites & Fixtures]
  B --> C{Reuse Setup?}
  C -->|Yes| D[Use SetUpTestSuite()]
  C -->|No| E[Use Per-Test SetUp()]
  D & E --> F[Write Parameterized or Typed Tests]
  F --> G[Build Test Targets via CMake/Bazel]
  G --> H{Run Tests Locally or CI?}
  H -->|Locally| I[Run Tests with --gtest_filter or --gtest_repeat]
  H -->|CI| J[Run Tests in Parallel With Sharding]
  J --> K[Generate XML/JSON Reports]
  K --> L[Analyze Results & Fix Failures]
  I --> L

  classDef decision fill:#f9f,stroke:#333,stroke-width:2px;
  class C,H decision;
```
