---
title: "Mock Objects: Principles and Use"
description: "Get to know how mock objects work in C++ using GoogleMock. Learn how to define mocks, replace real objects, and control interactions for isolated, behavior-driven testing. Discover how expectations and method signatures underpin effective mocking."
---

# Mock Objects: Principles and Use

Understanding mock objects is essential for effective behavior-driven testing in C++. This guide introduces the core principles behind mock objects in GoogleMock, focusing on how to define mocks, replace real object dependencies, and precisely control interactions to isolate code behavior. You'll learn how defining expectations and mocking method signatures enables robust, maintainable tests that verify not only outcomes but also interactions.

---

## What is a Mock Object?

Imagine you're developing a feature that depends on a complex subsystem, such as a database or graphics interface. Testing this feature directly against the real subsystem can be slow, unreliable, or cumbersome. Mock objects step in as stand-ins that mimic the real interfaces but are tailored for controlled, efficient testing.

A **mock object**:

- Implements the same interfaces as the real objects.
- Predefines *expectations* on which methods should be called, with what arguments, and how many times.
- Lets you specify customized behavior for these calls (e.g., returning specific values).
- Automatically verifies whether these expectations are met when the test concludes.

This contrasts with *fakes*, which are simple, possibly incomplete implementations used for testing but don't carry the expectation verification responsibilities of mocks.

## Why Use Mock Objects with GoogleMock?

Manually writing mocks in C++ is tedious and error-prone. GoogleMock automates this process with declarative macros and intuitive syntax, helping you:

- Create mocks quickly by declaring mock methods matching your interfaces.
- Control mock behavior flexibly through expectations (`EXPECT_CALL`) and default behaviors (`ON_CALL`).
- Validate that your code interacts with its collaborators as expected — no unexpected or missing calls.
- Specify call sequences, argument matchers, and return actions for fine-grained control.

This interaction-based testing approach complements state-based tests by focusing explicitly on how modules collaborate.

## Defining a Mock Class

To define mocks for a C++ interface:

1. Derive a mock class from the interface.
2. Use the `MOCK_METHOD` macro in the `public:` section to mock each virtual method.

Example: Mocking a `Turtle` interface

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Important:**
- Put `MOCK_METHOD` declarations in the `public:` section regardless of the original method's access specifier.
- For const methods, add `(const)` in the fourth parameter.
- If overriding virtual methods, include `(override)` qualifier.

## Creating and Using Mock Objects in Tests

1. Create the mock object.
2. Optionally, set default behaviors for certain methods using `ON_CALL` if you do not want mandatory expectations.
3. Set explicit call expectations using `EXPECT_CALL`, specifying when and how methods must be called.
4. Execute the code under test using the mock.
5. GoogleMock verifies all expectations upon mock destruction to ensure compliance.

Example:

```cpp
using ::testing::Return;
using ::testing::_;

TEST(DrawingTest, DrawsLine) {
  MockTurtle turtle;

  ON_CALL(turtle, GetX())
      .WillByDefault(Return(0));  // Default behavior if no EXPECT_CALL.

  EXPECT_CALL(turtle, PenDown())
      .Times(1);  // Must be called once.
  EXPECT_CALL(turtle, Forward(100))
      .Times(AtLeast(1));  // At least once.

  MyPainter painter(&turtle);
  painter.DrawLine(100);
}
```

If any expectations fail or unexpected calls occur, GoogleMock reports failures with detailed diagnostics.

## Controlling Method Call Expectations

### `EXPECT_CALL` Syntax

You specify expectations on mock methods using:

```cpp
EXPECT_CALL(mock_object, MethodName(arg_matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- **Matchers** determine which arguments are expected (e.g., exact values, or placeholders like `_` for anything).
- **Cardinalities** control how many times the call is expected (`Exactly(n)`, `AtLeast(n)`, `AnyNumber()`, etc.).
- **Actions** describe what the mock method should do when called (return value, side effects).

**If `Times` is omitted, GoogleMock infers it:**
- Defaults to `Times(1)` if no actions provided.
- Equals the number of `WillOnce` clauses if no `WillRepeatedly`.
- At least the number of `WillOnce` if `WillRepeatedly` is set.

### Order and Sequence Control

By default, expectations can be matched in any order. To enforce order:

- Use the `InSequence` helper object, which puts all `EXPECT_CALL`s in its scope into a strict chronological order.

Example:
```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, Foo());
  EXPECT_CALL(mock, Bar());
}
```

- Use the `InSequence()` clause with `Sequence` objects to form partial ordering.

- Use the `.After()` clause on `EXPECT_CALL` to specify a call must happen after prior expectations.

### Call Cardinalities

Control how many times a call is expected:

| Cardinality         | Meaning                                  |
|---------------------|------------------------------------------|
| `Exactly(n)` or `n` | Called exactly n times                    |
| `AtLeast(n)`        | Called at least n times                   |
| `AtMost(n)`         | Called at most n times                    |
| `Between(m,n)`      | Called between m and n times inclusive   |
| `AnyNumber()`       | Called any number of times                |

Use `.Times(0)` to explicitly disallow calls.

### Actions: Customizing Mock Behavior

GoogleMock lets you define what happens when a mocked method is called:

- `WillOnce(action)`: Defines behavior for the next call.
- `WillRepeatedly(action)`: Defines behavior for all subsequent calls after all `WillOnce`s are used.

Common built-in actions:
- `Return(value)`: Return a specific value.
- `ReturnRef(variable)`: Return a reference.
- `Invoke(function/lambda)`: Call a user-supplied function.
- `SetArgPointee<N>(value)`: Set output argument N to value.

If your mocked function returns or takes move-only types (e.g., `std::unique_ptr`), you can still use these action combinators; lambdas often help handle such cases gracefully.

### Default Actions with `ON_CALL`

Use `ON_CALL(mock, Method(args))` to specify default behavior for mock methods without enforcing the call. It is useful to establish baseline behaviors shared by many tests, without setting expectations.

Example:

```cpp
ON_CALL(mock, GetValue())
    .WillByDefault(Return(42));
```

Note: if a method is called but no expectations match and an `ON_CALL` provides default behavior, GoogleMock uses that behavior but will emit a warning unless the mock is configured accordingly.

## Mock Strictness Wrappers

GoogleMock provides special wrappers to control how uninteresting calls (calls without expectations) are treated.

| Wrapper             | Behavior                                         | Usage Example                    |
|---------------------|-------------------------------------------------|--------------------------------|
| `NiceMock<T>`       | Suppresses warnings on uninteresting calls      | `NiceMock<MockFoo> nice_foo;`   |
| `NaggyMock<T>`      | (Default) Prints warnings on uninteresting calls| `NaggyMock<MockFoo> naggy_foo;`|
| `StrictMock<T>`     | Treats uninteresting calls as test failures     | `StrictMock<MockFoo> strict_foo;`|

These wrappers are subclasses of the original mock class and inherit its constructors and behaviors.

**Example:**

```cpp
NiceMock<MockFoo> nice_foo;  // No warnings on uninteresting calls
StrictMock<MockFoo> strict_foo;  // Fails on uninteresting calls
```

Use `NiceMock` to keep tests clean from noise when uninteresting calls are expected but insignificant. Use `StrictMock` to enforce precisely defined call interactions and catch unexpected uses.

## Practical Tips and Best Practices

- Always set expectations before exercising code that uses the mocks. Setting expectations after calls leads to undefined behavior.
- Use the `_` matcher when arguments don't matter to avoid brittle tests.
- For overloaded methods, specify full signatures in `MOCK_METHOD` and help disambiguate in expectations with typed matchers.
- For methods returning references, use `ReturnRef()` to return references safely.
- To verify that a mock object's expectations have been met *before* destruction, use `Mock::VerifyAndClearExpectations()`.
- When working with complex call orders, use sequences (`Sequence`) or ordering clauses (`InSequence()`, `After()`) to declare expectations.
- Use `RetiresOnSaturation()` to have an expectation retire (stop matching) after it has been fully satisfied, especially in sequences.
- When you don’t care about method calls, omit `EXPECT_CALL` or use `NiceMock` to suppress warnings.

## Troubleshooting Common Issues

### Uninteresting Calls and Unexpected Calls

- *Uninteresting calls*: Methods called with no associated `EXPECT_CALL`.
  - Default behavior: Generates warnings (naggy mock) or fails tests (strict mock).
  - Solution: Use `NiceMock` to ignore or add catch-all `EXPECT_CALL` with `Times(AnyNumber())`.

- *Unexpected calls*: Calls that don't match any `EXPECT_CALL`.
  - Always results in test failures.

### Over-Specified Expectations

- Expectations that are too strict may cause brittle tests.
- Prefer `ON_CALL` for default behaviors and limit `EXPECT_CALL` to verifying important interactions.

### Compilation Errors with `MOCK_METHOD`

- Ensure that methods being mocked are `virtual`.
- Wrap argument types that include commas (like `std::pair<int, int>`) in parentheses or use type aliases.
- For overloaded methods, mock all overloads or bring unmocked ones into scope with `using`.

## Summary

GoogleMock's facility for mocking C++ objects empowers you to simulate complex behaviors, control interactions precisely, and verify that code behaves as intended in isolation. Defining mock classes with `MOCK_METHOD`, setting expectations via `EXPECT_CALL`, and customizing behaviors through actions lets you write clear, efficient, and maintainable tests. Using strictness control wrappers like `NiceMock`, `NaggyMock`, and `StrictMock` tailors the feedback level on uninteresting calls, balancing test strictness and maintainability.

---

## References and Next Steps

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — A beginner-friendly tutorial.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference on mocking macros and idioms.
- [Mocking Reference](../api-reference/mocking-apis/mocking-basics) — Complete API details on mocking.
- [Matchers Reference](../api-reference/matchers-and-customization/builtin-matchers) — Built-in matchers to specify argument expectations.
- [Actions Reference](../api-reference/mocking-apis/actions-advanced) — Built-in and custom actions to define mock behavior.
- [Strictness Wrappers](../api-reference/mocking-apis/strictness-wrappers) — Details on Nice, Naggy, and Strict mock wrappers.

For a smoother onboarding, ensure you have set up GoogleTest and GoogleMock properly as described in the [Initial Configuration](https://google.github.io/googletest/getting-started/setup-and-installation/initial-configuration) guide, and have run your first simple tests following [Writing Your First Test](https://google.github.io/googletest/getting-started/first-test-experience/writing-your-first-test).

To deepen your mastery, explore advanced mocking techniques in the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and consult troubleshooting tips in the [Debugging Test Failures](https://google.github.io/googletest/guides/troubleshooting-and-patterns/debugging-test-failures) guide.

---