---
title: "Matchers and Cardinalities"
description: "Learn to leverage matchers for argument validation and cardinalities for controlling call frequency in mocks. This page covers basic and advanced matcher composition, cardinality semantics, and their impact on test design clarity and intent."
---

# Matchers and Cardinalities

Learn how to wield the powerful tools of *matchers* and *cardinalities* in GoogleMock to precisely specify how your mock methods should be called. This guide shows you how to express argument validations using matchers and control the allowed or expected frequency of calls with cardinalities, enabling clear and expressive test specifications.

---

## Introduction

In mocking, it’s critical to define **what function calls you expect** and **how they are invoked**. GoogleMock uses *matchers* to describe expected argument values and *cardinalities* to specify how many times a call should happen. This page dives deeply into these two concepts, showing you how to combine simple and complex matchers and how cardinality semantics shape your test logic.

Using these features correctly enhances your tests' clarity, maintainability, and robustness, making bugs easier to catch and intentions unmistakable.

---

## Understanding Matchers: Validating Call Arguments

When you expect a mock function to be called, telling GoogleMock the *exact* or *approximate* arguments it should receive is often essential.

### What Are Matchers?

Matchers are predicates that verify whether a function argument meets a condition. They can be simple, like expecting a value to equal 42, or complex compositions expressing ranges, patterns, or custom logic.

For example:

```cpp
EXPECT_CALL(mock_obj, Foo(42));       // Expects argument == 42
EXPECT_CALL(mock_obj, Bar(Ge(10)));   // Argument >= 10
EXPECT_CALL(mock_obj, Baz(_));         // Any argument (wildcard)
```

#### Wildcard Matcher (`_`)

The underscore (`_`) matcher matches any value, letting you care only about relevant arguments:

```cpp
EXPECT_CALL(turtle, GoTo(50, _));  // X must be 50, Y can be anything
```

### Composing Matchers

You can combine matchers logically to form precise conditions:

- **AllOf(m1, m2, ...)** — all matchers must be satisfied.
- **AnyOf(m1, m2, ...)** — at least one matcher is satisfied.
- **Not(m)** — negates the matcher condition.

Example:

```cpp
EXPECT_CALL(foo, Process(AllOf(Ge(10), Le(20))));  // Argument in [10,20]
```

### Matching Multiple Arguments Together

Sometimes, you need to define constraints involving multiple arguments together:

```cpp
EXPECT_CALL(mock_obj, SetRange(_, _)).With(Lt());
```

Here, `.With(Lt())` ensures the first argument is less than the second.

### Using Matchers in Practice

- Use **explicit matchers** only when necessary to keep your tests resilient.
- `_` is your friend for ignoring unimportant arguments.
- Compose matchers to express complex argument constraints cleanly.

### Custom and Parameterized Matchers

GoogleMock lets you define *custom* matchers or parameterized matchers to represent domain-specific predicates, increasing your tests' expressiveness and reusability. For example:

```cpp
MATCHER(IsEven, "is an even number") { return (arg % 2) == 0; }
EXPECT_CALL(foo, Bar(IsEven()));
```

For more on building and combining matchers, see the [Matchers Reference](../api-reference/mocking-apis/matchers-actions.md) and [gMock Cookbook](../guides/mocking-advanced-usage/custom-actions-and-matchers.md).

---

## Cardinalities: Specifying Call Frequency

While matchers handle *what arguments* calls must satisfy, cardinalities govern *how many times* a mocked method is expected or allowed to be called.

### What Are Cardinalities?

A cardinality expresses a numerical expectation about call counts. GoogleMock provides flexible built-in cardinalities that let you be exact or fuzzy about call counts, balancing precision and tolerance.

### Common Built-in Cardinalities

| Cardinality       | Meaning                                         |
|-------------------|------------------------------------------------|
| `Exactly(n)`      | Called exactly *n* times.                        |
| `AtLeast(n)`      | Called *at least* *n* times (or more).          |
| `AtMost(n)`       | Called *at most* *n* times (or fewer).          |
| `Between(m, n)`   | Called *between* *m* and *n* times inclusive.  |
| `AnyNumber()`     | Can be called any number of times, including 0.|

These cardinalities are used with `.Times()` in your expectations:

```cpp
EXPECT_CALL(mock, Foo()).Times(Exactly(2));
EXPECT_CALL(mock, Bar(_)).Times(AtLeast(1));
EXPECT_CALL(mock, Baz(_)).Times(AnyNumber());
```

### Special Case: Zero Calls

Using `.Times(0)` forbids calls with matching arguments entirely:

```cpp
EXPECT_CALL(mock, DangerousOperation(_)).Times(0);  // Must not be called
```

If a call matching this expectation occurs, the test will fail immediately.

### Cardinality Inference

When `.Times()` is omitted, GoogleMock infers it based on the number of `WillOnce()` and `WillRepeatedly()` clauses:

- No `WillOnce()` or `WillRepeatedly()` => `Times(1)`
- *n* `WillOnce()` but no `WillRepeatedly()` => `Times(n)`
- *n* `WillOnce()` and one `WillRepeatedly()` => `Times(AtLeast(n))`

### Sticky vs Retiring Expectations

By default, expectations are **sticky** — they remain active even after the expected calls occur, enforcing strict adherence.

- Use `.RetiresOnSaturation()` to have an expectation become inactive once saturated, allowing subsequent expectations to match calls.

Example:

```cpp
EXPECT_CALL(turtle, GoTo(0, 0))
    .Times(2)
    .RetiresOnSaturation();
```

This expectation will only match the first two calls to `GoTo(0, 0)`; further calls will be handled by other expectations.

### Using Cardinalities in Sequences and Partial Orders

Cardinalities cooperate with call ordering constructs like `.InSequence()` and `.After()` to express complex call patterns, ensuring calls happen with expected frequency and in the desired order.

---

## Practical Examples

### Simple Matcher and Cardinality

```cpp
EXPECT_CALL(mock_turtle, Forward(100))
    .Times(AtLeast(1));  // Expect to move forward at least once
```

### Ignoring Some Arguments

```cpp
EXPECT_CALL(mock_turtle, GoTo(50, _))
    .Times(Exactly(3));  // Exactly 3 calls with X=50, Y anything
```

### Combining Matchers

```cpp
using ::testing::AllOf;
EXPECT_CALL(mock_foo, SetAge(AllOf(Ge(18), Le(55))));
```

### Multiple Call Cardinalities

```cpp
EXPECT_CALL(mock_car, SetSpeed(_))
    .Times(Between(1, 5));  // Called 1 to 5 times
```

### Using RetiresOnSaturation

```cpp
EXPECT_CALL(mock_logger, Log("Warning"))
    .Times(2)
    .RetiresOnSaturation();  // Only first 2 calls match this
EXPECT_CALL(mock_logger, Log(_))
    .Times(AnyNumber());      // Subsequent calls allowed
```

---

## Best Practices and Common Pitfalls

- **Specify only what’s necessary:** Overly rigid matchers or cardinalities make tests brittle.
- **Use `_` wildcards when argument values are irrelevant.**
- **Prefer cardinalities that balance correctness and flexibility** (e.g., `AtLeast(1)` over `Exactly(1)` if call counts may vary).
- **Retire saturated expectations when you have overlapping or fallback expectations** to avoid upper bound errors.
- **Remember to set expectations before exercising code**; otherwise, behavior is undefined.
- **Be careful with default actions and inferred cardinalities.** Explicitly specifying `.Times()` and `.WillRepeatedly()` when necessary improves clarity.

---

## Troubleshooting

If your tests fail due to unexpected argument values or call counts:

- **Use verbose logging** by running tests with `--gmock_verbose=info` to see all calls and matching expectations.
- **Check order of expectations**, especially when using sequences or `.After()`.
- **Inspect mismatched arguments** carefully; sometimes using `.With()` or composite matchers helps clarify.
- **Watch for 'too many actions' warnings**, which occur if you specify more `.WillOnce()` actions than allowed calls.

For in-depth debugging strategies, see the [Debugging Common Failures](../guides/real-world-patterns/debugging-common-failures.md) guide.

---

## Related Topics

- [Matchers Reference](../api-reference/mocking-apis/matchers-actions.md) — detailed list and usage of built-in and custom matchers.
- [Mock Class Definition & Method Mocking](../api-reference/mocking-apis/mock-class-definition.md) — learn how to define mocks for classes and interfaces.
- [Setting Expectations & Behaviors](../api-reference/mocking-apis/expectations-behaviors.md) — understand `EXPECT_CALL` and `ON_CALL` in detail.
- [Nice, Naggy, and Strict Mocks](../guides/mocking-advanced-usage/nice-strict-mocks.md) — control how mocks handle uninteresting calls.
- [Custom Actions & Matchers](../guides/mocking-advanced-usage/custom-actions-and-matchers.md) — extend GoogleMock with tailored behaviors and validations.

---

This page fits into the broader concept of defining clear, expressive tests using GoogleMock by providing the foundation for argument validation and call count management. It builds upon basics from class mock definitions and expectation setting, and supports higher-level test design patterns introduced in other concept guides.

---