---
title: "Strictness, Nice/Strict Mocks, and Extension Points"
description: "Understand the different levels of strictness in GoogleMock (NiceMock, NaggyMock, StrictMock), how they influence the treatment of unexpected calls, and when to use each for reliable and readable tests. This page also covers extension points enabling custom assertion behaviors and integrating with broader testing environments."
---

# Strictness, Nice/Strict Mocks, and Extension Points

Understanding the strictness levels provided by GoogleMock — including `NiceMock`, `NaggyMock`, and `StrictMock` — is essential to controlling how your mock objects behave when unexpected or uninteresting calls occur. This guide demystifies these mock strictness policies, explains their impact on test reliability and readability, and showcases how to extend GoogleMock for custom assertion behaviors.

---

## Introduction to Mock Strictness Levels

When writing tests with GoogleMock, you define *expectations* on mock methods to specify how they should be called. However, calls can also happen that the test does not explicitly expect. These are called **uninteresting calls** (mock methods called without matching expectations) or **unexpected calls** (calls with arguments that don't match any expectation).

GoogleMock offers three levels of strictness to govern the handling of such calls:

| Strictness Level | Behavior on Uninteresting Calls                       | Use Case Summary                                    |
| ---------------- | ---------------------------------------------------- | ------------------------------------------------- |
| **NiceMock**     | Suppresses warnings; uninteresting calls are silently accepted and return default values. | Use when you want to focus only on relevant calls and ignore noise from others to keep tests clean. |
| **NaggyMock**    | Prints warnings on uninteresting calls but allows them; this is the default behavior.     | Useful during test development or debugging to catch potentially unintended calls. |
| **StrictMock**   | Treats uninteresting calls as failures, causing test failures immediately.               | Employ when you want your tests to enforce that only expected calls occur, increasing test safety.


### What Are Uninteresting vs Unexpected Calls?

- **Uninteresting calls:** occur when no expectation (`EXPECT_CALL`) exists for a given mock method. They are either silently allowed (NiceMock), warned about (NaggyMock), or failed (StrictMock).
- **Unexpected calls:** occur when expectations exist on a mock method, but none match the actual call's arguments. These always fail the test, regardless of strictness.

---

## Using NiceMock, NaggyMock, and StrictMock

You can apply strictness policies at the mock object level by wrapping your mock class with one of the provided templates:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockClass> nice_mock;      // No warnings on uninteresting calls
NaggyMock<MockClass> naggy_mock;    // Warning on uninteresting calls (default)
StrictMock<MockClass> strict_mock;  // Failure on uninteresting calls
```

These wrappers behave like subclasses of your mock class, inheriting its constructors and functionality. For example, if your mock class defines a constructor `MockClass(int, string)`, you can write:

```cpp
NiceMock<MockClass> mock(5, "hello");
```

### When to Use Each

- **NiceMock:** Prefer this for maintaining clean tests that only focus on explicitly expected calls. It reduces noise and discourages over-specifying.
- **NaggyMock:** Useful in test debugging and when you want to catch unintended mock call invocations without causing test failures.
- **StrictMock:** Best when you need tight control to ensure *only* expected calls happen, avoiding silent failures.

<Note>
Currently, `NaggyMock` behavior is the default for raw mocks. There are plans to make `NiceMock` the default to promote maintainable tests.
</Note>

### Important Caveats

- `NiceMock`, `NaggyMock`, and `StrictMock` work **only** with mock methods defined directly using the `MOCK_METHOD` macro in the mock class. If the mock method is inherited from a base class, these wrappers may not affect its behavior.
- Nesting these wrappers (e.g., `NiceMock<StrictMock<MockClass>>`) is **not supported**.
- The wrapped mock class should have a **virtual destructor** for correct behavior, especially when used polymorphically.

---

## How Strictness Affects Test Output and Failures

The verbosity and handling of uninteresting calls are influenced by the `--gmock_verbose` flag, which can be set to `info`, `warning`, or `error`.

- `info`: Prints detailed logs for both expected and uninteresting calls, including stack traces.
- `warning` (default): Prints warnings for uninteresting calls but omits stack traces.
- `error`: Suppresses informational and warning messages, printing only errors.

For example, an uninteresting call on a `NaggyMock` under `warning` verbosity will produce messages like:

```
GMOCK WARNING:
Uninteresting mock function call - returning default value.
    Function call: MethodName(args...)
```

StrictMocks treat such calls as failures regardless.

---

## Controlling Mock Strictness in Your Tests

To customize the behavior of uninteresting calls on your mock objects:

1. Wrap your mock class with `NiceMock`, `NaggyMock`, or `StrictMock` as appropriate.
2. Use `EXPECT_CALL` for calls you want to explicitly verify.
3. Optionally, specify “catch-all” expectations to allow certain calls without warnings, e.g.,

```cpp
EXPECT_CALL(mock, Method(_)).Times(AnyNumber());  // Allows any calls to this method
```

4. Use `ON_CALL` to specify default actions without setting expectations.

<Info>
Setting expectations with `EXPECT_CALL` automatically disables uninteresting warnings on those matched calls; however, mismatched arguments on these calls are treated as errors.
</Info>

---

## Extension Points for Custom Behavior

GoogleMock allows you to extend and customize the assertion and mock handling mechanisms:

### Custom Actions

Define callable objects or lambdas that specify the behavior of mocked methods when invoked.

```cpp
EXPECT_CALL(mock, Method(5))
    .WillOnce([](int arg) { return arg * 2; });
```

For complex behaviors, implement the `ActionInterface` or use `MakePolymorphicAction` for reusable polymorphic actions.

### Custom Matchers

Create expressive validations on arguments by defining polymorphic or monomorphic matchers, either using the `MATCHER` macros or implementing matcher interfaces.

```cpp
MATCHER(IsEven, "is an even number") { return (arg % 2) == 0; }
EXPECT_CALL(mock, Method(IsEven()));
```

### Custom Cardinalities

You can define your own cardinality constraints beyond the built-in ones (`AnyNumber()`, `AtLeast()`, etc.) by implementing the `CardinalityInterface`.

```cpp
class EvenNumberCardinality : public CardinalityInterface {
 public:
  bool IsSatisfiedByCallCount(int call_count) const override {
    return call_count % 2 == 0;
  }
  ...
};
Cardinality EvenNumber() { return Cardinality(new EvenNumberCardinality); }
```

Use your custom cardinality in `Times` clause:

```cpp
EXPECT_CALL(mock, Method(_)).Times(EvenNumber());
```

### Integrating with Testing Environments

GoogleMock's extension APIs support integration with broader test reporting and failure handling mechanisms, enabling customized messages, action sequencing, and invocation tracing compatible with your environment and CI pipelines.

---

## Practical Tips and Best Practices

- **Use NiceMock by default** to keep tests clean and maintainable.
- Specify `StrictMock` **only where necessary** to ensure unwanted calls fail.
- Avoid overusing `EXPECT_CALL(...).Times(AnyNumber())` as it may mask unintended interactions.
- Use `ON_CALL` to define reasonable default mock method behaviors, avoiding redundant expectations.
- Combine sequences (`InSequence`, `After`) with strictness to enforce call order without over-constraining behavior.
- Use the `--gmock_verbose=info` flag to gain detailed diagnostics when debugging tests.

---

## Summary

This page has covered:

- The concepts of mock strictness in GoogleMock (`NiceMock`, `NaggyMock`, `StrictMock`).
- Differences in handling uninteresting and unexpected calls under each strictness level.
- How to wrap your mock classes to apply these policies.
- How to control verbosity of mock call reporting.
- Extension points for custom actions, matchers, and cardinalities.
- Practical guidance on using these features for reliable and readable tests.

---

## Related Documentation

- [Mocking Reference](../docs/reference/mocking.md) — Detailed macros and classes for defining mocks, expectations, and strictness.
- [gMock for Dummies](../docs/gmock_for_dummies.md) — Beginner-friendly introduction and workflow.
- [Nice, Naggy, and Strict Mocks](../guides/mocking-advanced-usage/nice-strict-mocks.md) — In-depth discussion of mock strictness with examples.
- [Setting Expectations & Behaviors](../api-reference/mocking-apis/expectations-behaviors.md) — Advanced expectation clauses and mock behaviors.
- [Custom Actions & Matchers](../guides/mocking-advanced-usage/custom-actions-and-matchers.md) — How to create reusable, custom behaviors for mocks.
- [Debugging Common Failures](../guides/real-world-patterns/debugging-common-failures.md) — Strategies for diagnosing test failures involving mocks.

---

## Example: Using StrictMock to Enforce Call Validity

```cpp
class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& uri), ());
  MOCK_METHOD(int, Query, (const std::string& sql), ());
};

TEST(DatabaseTest, OnlyConnectIsExpected) {
  StrictMock<MockDatabase> db;

  EXPECT_CALL(db, Connect("server1"));

  db.Connect("server1");  // OK

  // The following call to Query is uninteresting and will fail the test.
  EXPECT_NONFATAL_FAILURE(db.Query("SELECT * FROM users"), "Uninteresting mock function call");
}
```

By contrast, wrapping with `NiceMock` would suppress the warning and allow `Query` to return default `int` zero.

---

## Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Strictness and Mock Behavior">
  <Accordion title="Unexpected calls cause test failures even on NiceMock">
  Unexpected calls always fail tests regardless of mock strictness. Ensure `EXPECT_CALL` clauses cover expected calls adequately.
  </Accordion>
  <Accordion title="NaggyMock warnings are too noisy">
  Use `NiceMock` to suppress warnings on uninteresting calls, or add catch-all expectations with `Times(AnyNumber())`.
  </Accordion>
  <Accordion title="StrictMock uninterestings ignored when destructor isn't virtual">
  Ensure your mock classes have virtual destructors for StrictMock to work reliably.
  </Accordion>
  <Accordion title="Mock methods defined in base classes don't respect wrappers">
  Define mock methods directly in your mock class using `MOCK_METHOD` macros to enable `NiceMock` and `StrictMock` effects.
  </Accordion>
</AccordionGroup>

---

Happy mocking! Explore the provided links to deepen your mastery of GoogleMock strictness levels and extend your testing capabilities robustly.
