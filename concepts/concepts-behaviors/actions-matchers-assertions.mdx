---
title: "Actions, Matchers, and Assertions"
description: "Understand the foundational building blocks of GoogleMock and GoogleTest: actions that specify behavior, matchers that define argument expectations, and assertions that validate outcomes. Learn how these components create readable, maintainable, and thorough tests."
---

# Actions, Matchers, and Assertions

Understanding the foundational building blocks of GoogleMock and GoogleTest is crucial to writing clear, maintainable, and thorough tests. This guide dives into the three pillars of mock specification:

- **Actions**: Define what a mock function should do when called.
- **Matchers**: Specify expectations about the arguments passed to mock functions.
- **Assertions**: Validate outcomes within tests.

Together, these components empower you to write expressive tests that precisely capture intent and behavior.

---

## 1. Actions: Defining Mock Function Behavior

When you declare a mock method, you need to specify how it should behave when invoked during a test. Actions are objects or callables that define this behavior.

### What Are Actions?
Actions decide the runtime effect of calling a mock function: what value it returns, what side effects it has, or whether it throws an exception.

### Built-in Actions Overview
GoogleTest provides many built-in actions under the `::testing` namespace, which you can use out of the box.

#### Returning Values
| Action | Description |
|--------|-------------|
| `Return()` | For `void` mocks, simply returns when called.
| `Return(value)` | Returns a specified value, which is converted to the mock method's return type when the expectation is set.
| `ReturnArg<N>()` | Returns the N-th (0-based) argument passed to the mock function.
| `ReturnNew<T>(args...)` | Returns a newly allocated object of type T with given constructor arguments.
| `ReturnNull()` | Returns a null pointer.
| `ReturnPointee(ptr)` | Returns the value pointed by `ptr`, evaluated at the time of the call.
| `ReturnRef(variable)` | Returns a reference to the variable.
| `ReturnRefOfCopy(value)` | Returns a reference to a copy of the value — useful when the caller needs a reference but you want to return a fresh object.
| `ReturnRoundRobin({a1, ..., an})` | Cycles through a list of return values round-robin.

#### Side Effects
Side effect actions handle mutating output arguments or other indirect effects:

| Action | Description |
|-----------|-------------|
| `Assign(&variable, value)` | Assigns `value` to a variable.
| `DeleteArg<N>()` | Deletes the N-th argument (must be a pointer).
| `SaveArg<N>(pointer)` | Copies the N-th argument into `*pointer`.
| `SaveArgByMove<N>(pointer)` | Moves the N-th argument into `*pointer`.
| `SaveArgPointee<N>(pointer)` | Copies the pointee of the N-th argument into `*pointer`.
| `SetArgReferee<N>(value)` | Assigns `value` to the variable referenced by the N-th argument.
| `SetArgPointee<N>(value)` | Assigns `value` to the variable pointed to by the N-th argument.
| `SetArrayArgument<N>(first, last)` | Copies a range of elements to the array/iterator pointed to by the N-th argument.
| `SetErrnoAndReturn(error, value)` | Sets `errno` and returns `value`.
| `Throw(exception)` | Throws the given exception when the mock function is called.

#### Using Callables as Actions
You can also make mock methods invoke functions, functors, or lambdas:

| Action | Description |
|------------|-------------|
| `f` | Calls the callable `f` with the mock function's arguments.
| `Invoke(f)` | Invokes the function or functor `f` with the mock arguments.
| `Invoke(object_ptr, &Class::method)` | Calls a class method on an object.
| `InvokeWithoutArgs(f)` | Calls `f` without passing any arguments.
| `InvokeWithoutArgs(object_ptr, &Class::method)` | Calls an object's method with no arguments.
| `InvokeArgument<N>(arg1, arg2, ..., argk)` | Calls the N-th argument (which must be callable) with specified arguments.

This flexibility lets you easily connect your tests with real or helper functions, or implement side effects and computations dynamically.

#### Composite Actions
Sometimes, you want to perform multiple actions in sequence:

- `DoAll(a1, a2, ..., aN)`: Performs all actions sequentially, returns the result of the last action.
- `IgnoreResult(a)`: Executes action `a` and ignores its return value.
- `WithArg<N>(a)`: Passes only the N-th argument to action `a`.
- `WithArgs<N1, N2, ..., Nk>(a)`: Passes specified arguments.
- `WithoutArgs(a)`: Performs action `a` without any arguments.

### Defining Custom Actions
You can define your own actions using `ACTION`, `ACTION_P`, `ACTION_Pk` macros:

```cpp
ACTION(Sum) { return arg0 + arg1; }
ACTION_P(Plus, n) { return arg0 + n; }
// Parametrized actions take parameters for flexibility.
```

Inside the action body, `arg0`, `arg1`, etc., represent mock function arguments.

### Tips for Working with Actions
- Remember actions passed to `WillOnce()` can be move-only and are called at most once.
- Use `ReturnPointee()` to return live values from a pointer, useful when the value can change.
- Chain actions using `DoAll()` when you need side effects and returns.

---

## 2. Matchers: Validating Function Arguments

Matchers declare the expectations for the arguments passed to mock functions.

### What Are Matchers?
Matchers are predicates describing the constraints the argument must satisfy for the expectation to match.

### Basic Usage
In `EXPECT_CALL` or `ON_CALL`, you specify matchers for each argument position. Examples include:

```cpp
using ::testing::_;         // Matches anything
using ::testing::Eq;        // Matches equality
using ::testing::Lt;        // Matches less than
using ::testing::NotNull;   // For pointer arguments
```

### Multi-Argument Matchers with `.With()`
Sometimes, you want to validate the combined state of all arguments instead of each individually. The `.With()` clause allows this by matching the argument tuple as a whole.

Example:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // The first argument less than the second.
```

GoogleMock provides helpers like `AllArgs()` (equivalent to `.With()`) and `Args<N1, N2, ..., Nk>(m)` for matching subsets.

### Writing Custom Matchers
GoogleMock supports easy creation of custom matchers using macros like `MATCHER` and `MATCHER_P` for parameterized ones. Custom matchers allow expressing domain-specific properties cleanly.

### Best Practices
- Use built-in matchers when possible for clarity and better failure messages.
- Combine matchers with `AllOf()`, `AnyOf()`, and `Not()` for complex logic.
- Use `Truly()` for arbitrary predicates, but remember matchers must be pure functions without side effects.

---

## 3. Assertions: Validating Test Outcomes

While actions and matchers shape the behavior and expectations of mocks, **assertions** validate outcomes in your tests using GoogleTest's macros. Assertions report success or failure and control test flow.

### Assertions in GoogleTest
Assertions come as pairs:
- `EXPECT_*` variants generate **nonfatal** failures, allowing tests to continue.
- `ASSERT_*` variants generate **fatal** failures, aborting test execution.

### Common Assertions
GoogleTest provides assertions for:

- **Boolean conditions**: `EXPECT_TRUE()`, `EXPECT_FALSE()`
- **Equality and comparison**: `EXPECT_EQ()`, `EXPECT_NE()`, `EXPECT_LT()`, `EXPECT_LE()`, `EXPECT_GT()`, `EXPECT_GE()`
- **String comparisons**: `EXPECT_STREQ()`, `EXPECT_STRNE()`, including case-insensitive versions.
- **Floating-point comparisons**: `EXPECT_FLOAT_EQ()`, `EXPECT_DOUBLE_EQ()`, and `EXPECT_NEAR()` to handle approximate equality.
- **Exception assertions**: `EXPECT_THROW()`, `EXPECT_ANY_THROW()`, `EXPECT_NO_THROW()`
- **Predicate assertions**: `EXPECT_PRED*()` variants for complex predicates.

### Using Matchers in Assertions
You can combine matchers with assertions like `EXPECT_THAT(value, matcher)` for expressive validation of complex conditions.

Example:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
```

### Documenting Intent and Failure Messages
Assertions support streaming custom failure messages using `<<`. For example:

```cpp
EXPECT_TRUE(condition) << "Condition should be true but wasn't.";
```

This enhances the diagnosability of test failures.

---

## 4. Combining Components for Effective Tests

The power of GoogleMock and GoogleTest lies in using actions, matchers, and assertions cohesively:

- Use **actions** to define how mocks behave.
- Use **matchers** to specify which calls your tests care about.
- Use **assertions** to validate mock-driven or direct code outcomes.

### Practical Workflow
1. Define your mock classes using `MOCK_METHOD`.
2. Set **default behaviors** using `ON_CALL()` with actions.
3. Set **call expectations** using `EXPECT_CALL()` with matchers and actions, optionally specifying call counts and order.
4. Run your code under test.
5. Assert the expected side effects and verify mock interactions.

### Troubleshooting
- Missing or incorrect matchers cause unexpected or uninteresting call warnings/failures.
- Not specifying actions where needed leads mocks to return default values, possibly breaking tests.
- Over-specification of expectations leads to brittle tests; prefer `ON_CALL` for typical calls and `EXPECT_CALL` when verifying behavior.

### Tips
- Use `WillOnce()` for one-time specific behaviors, `WillRepeatedly()` for general cases.
- Remember action clauses are evaluated once when expectations are set, not on each invocation.
- Use sequences (`InSequence`, `After`) to enforce order constraints.

---

## 5. Additional Resources

To deepen your mastery, consult:

- [Actions Reference](../reference/actions.md) — Complete list and details on all built-in actions.
- [Matchers Reference](../reference/matchers-reference.md) — Comprehensive guide to argument matchers.
- [Assertions Reference](../reference/assertions.md) — Details on GoogleTest assertions.
- [Mocking Reference](../reference/mocking.md) — Concepts on defining mocks, expectations, and call order.
- [gMock Cookbook](../gmock_cook_book.md) — Recipes and best practices.
- [gMock for Dummies](../gmock_for_dummies.md) — Friendly introduction.

---

## Summary
This page lays out how to define mock behaviors (actions), specify argument expectations (matchers), and validate test results (assertions). By combining these concepts, you craft tests that are precise, expressive, and maintainable, providing clear feedback when tests fail. Mastery of these elements is critical to leveraging the full power of GoogleMock and GoogleTest.
