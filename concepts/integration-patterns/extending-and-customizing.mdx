---
title: "Extending and Customizing the Framework"
description: "Learn how to define custom matchers, actions, and test utilities to extend the framework for your project's needs. Explore supported customization points and practical examples."
---

# Extending and Customizing the Framework

Extending GoogleMock lets you tailor its powerful mocking features to fit your specific project's needs. This guide explains how to create custom matchers, actions, and utility tools that integrate seamlessly with GoogleMock’s core, enabling you to express test expectations with precision and creativity.

---

## Why Extend GoogleMock?

GoogleMock already provides a rich set of built-in matchers and actions, but your testing scenarios may require behavior or validations unique to your domain. Extending the framework empowers you to:

- Define expressive, reusable matchers for domain-specific types or rules.
- Implement complex or novel mock actions that go beyond the built-ins.
- Create utilities to simplify mocking of intricate interfaces.

## Supported Customization Points

GoogleMock offers stable extension points designed with user intent in mind, making it straightforward to add functionality without hacking internal mechanisms.

### Custom Matchers

Matchers decide if a mock method argument satisfies a specified condition. You can:

- Define *simple* matchers with the `MATCHER` (monomorphic) and `MATCHER_P` (parameterized) macros for quick, concise implementations.
- Create *monomorphic matcher classes* implementing the matcher interface explicitly for detailed control and better type safety, useful for widely reused or complex matchers.
- Build *polymorphic matchers* that adapt to multiple argument types, enabling maximum flexibility and clean syntax.
- Combine matchers to form composite predicates that express intricate conditions on values or object members.

#### Example: Quick Custom Matcher Using `MATCHER`

```cpp
MATCHER(IsDivisibleBy7, "Checks if a number is divisible by 7") {
  return (arg % 7) == 0;
}
```

Use it like:

```cpp
EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

#### Advanced: Monomorphic Matcher Class

```cpp
class DivisibleBy7Matcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    const int remainder = n % 7;
    if (remainder != 0 && os) {
      *os << "remainder: " << remainder;
    }
    return remainder == 0;
  }

  void DescribeTo(std::ostream* os) const { *os << "is divisible by 7"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is not divisible by 7"; }
};

Matcher<int> DivisibleBy7() {
  return MakeMatcher(new DivisibleBy7Matcher());
}
```

### Writing New Actions

If the built-in actions do not cover your needs, you can define new mock behaviors by:

- Writing functors or lambdas with signatures matching the mocked method and binding them to `WillOnce()` or `WillRepeatedly()`.
- Defining monomorphic action classes implementing `ActionInterface<F>`, where `F` is the mock function type, for fine control.
- Using `MakePolymorphicAction()` for actions applicable across multiple function signatures (e.g., general-purpose actions like `Return()`).

#### Simple Action with Lambda

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int n) { return n * 2; });
```

#### Polymorphic Action Example

```cpp
class ReturnSecondArgumentAction {
 public:
  template <typename R, typename ArgsTuple>
  R Perform(const ArgsTuple& args) const {
    return std::get<1>(args);
  }
};

PolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() {
  return MakePolymorphicAction(ReturnSecondArgumentAction());
}
```

Use like:

```cpp
EXPECT_CALL(mock, Foo).WillOnce(ReturnSecondArgument());
```

### Custom Cardinalities

Beyond built-in cardinalities (`AnyNumber()`, `AtLeast()`, `Exactly()`, etc.), you can define your own by implementing a `CardinalityInterface` with methods to check satisfaction and saturation. This allows validation like “called even number of times”, and can be combined with sequences and partial ordering.

### Custom Matchers and Actions from Macros

GoogleMock provides a set of macros like `MATCHER`, `MATCHER_P`, and `ACTION`, `ACTION_P` for quick definition of matchers and actions respectively. These are ideal for cases where full interface implementation would be cumbersome.

### Delegating Calls

You can extend or customize mock behaviors by delegating calls:

- To existing fakes for default handling.
- To real objects to retain production behavior alongside verification.
- To parent class methods for partial mocking of concrete classes.

This enables powerful patterns including partial mocks and stepwise refactoring.

## Practical Tips

- **Use ON_CALL to define default behaviors** and reserve EXPECT_CALL for actual behavioral expectations.
- **Sequence and Dependencies:** Use `InSequence`, `After`, and `ExpectationSet` to define precise call orders.
- **Combine custom matchers with built-in ones** for expressive and maintainable tests.
- **Use `RetiresOnSaturation`** to manage expectations that should no longer match after a certain number of calls.
- **Control uninteresting call behavior** with `NiceMock`, `NaggyMock`, and `StrictMock` wrappers.
- **Limit matcher side effects:** Matchers must be pure and must not call mock functions.
- For long or complex mock classes, define the constructor and destructor out-of-line to improve compile times.

## Common Pitfalls to Avoid

- Defining mocks with methods missing `virtual` qualifiers will cause unexpected behavior.
- Beware of the reverse order precedence for expectations in `EXPECT_CALL` — newer rules override older.
- Don't omit specifying expectations prematurely, or you risk test flakiness due to uninteresting calls.
- Avoid mocking variadic functions directly — consider interface redesign.

## Example: Defining a Custom Matcher with Parameters

```cpp
MATCHER_P(IsMultipleOf, base, "Checks if value is a multiple of the given base") {
  return arg % base == 0;
}

// Usage:
EXPECT_CALL(mock, Foo(IsMultipleOf(5)));
```

## Resources and Next Steps

- Refer to the [gMock Cookbook's Extending gMock section](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers) for many recipes and examples.
- Consult the [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) for all built-in matchers.
- Study the [Actions Reference](https://google.github.io/googletest/reference/actions.html) for available actions and ways to define new ones.
- Understand strictness modes in [Strictness Modes documentation](docs/api-reference/mocking-apis/strictness-modes.mdx).
- Explore the `MockFunction` utility for mocking callbacks and free functions.

---

## Summary

Extending GoogleMock empowers you to adapt the framework precisely to your testing domain. Writing custom matchers and actions helps you express test logic clearly while maintaining high test hygiene. Use delegation and familiar constructs like sequences and cardinalities to manage ordering and behavior control effectively.


---