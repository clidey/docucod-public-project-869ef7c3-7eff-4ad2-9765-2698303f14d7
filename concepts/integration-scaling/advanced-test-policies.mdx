---
title: "Strictness Policies & Special Test Types"
description: "Understand advanced concepts such as Nice, Naggy, and Strict mock policies, fatal vs non-fatal failures, and the theory behind death tests. These advanced features support enforcing rigor and capturing edge cases in complex code bases."
---

# Strictness Policies & Special Test Types

## Introduction

As your C++ code base grows more complex, enforcing robust testing practices becomes essential. GoogleTest and GoogleMock provide advanced strictness policies and specialized test types to help you rigorously verify behaviors and interactions. This page delves into **Nice**, **Naggy**, and **Strict** mock policies, the distinction between **fatal** and **non-fatal** test failures, and the theory behind **death tests** for capturing critical edge cases.

These mechanisms empower you to clearly specify the intent of your tests, control how strict they should be about unexpected calls, and ensure reliability even for tricky program states.

---

## Mock Strictness Policies: Nice, Naggy, and Strict Mocks

GoogleMock offers three primary strictness wrappers to adjust how uninteresting mock function calls are handled during tests. Understanding the distinctions will help you tailor test behavior to your needs:

### What are Uninteresting Calls?

An *uninteresting call* is a call to a mock method that has **no matching** `EXPECT_CALL` expectation set.

By default, GoogleMock treats such calls as warnings but allows the test to proceed.

### NaggyMock (Default Behavior)

- Prints a **warning** message when an uninteresting call occurs.
- Useful for detecting potentially accidental calls that your test does not explicitly allow.
- Retains flexibility since it doesn't fail the test just because an unexpeced call occurred.

### NiceMock

- Suppresses warnings for uninteresting calls.
- Treats unexpected calls silently, avoiding clutter in test logs.
- Recommended when you are confident that uninteresting calls are acceptable or when you want to reduce noise.

### StrictMock

- Treats uninteresting calls as **test failures**.
- Enforces the most rigorous verification by failing tests on any unexpected method invocations.
- Ideal for tests where you want **complete control** over what methods are allowed to be called.

### Usage Patterns

You apply these policies by wrapping your mock type:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

// Default (Naggy) mock
MockFoo naggy_mock;

// Nice mock that silences warnings on uninteresting calls
NiceMock<MockFoo> nice_mock;

// Strict mock that fails if uninteresting calls happen
StrictMock<MockFoo> strict_mock;
```

### Important Notes

- These wrappers only affect **uninteresting calls**, i.e., calls not covered by any `EXPECT_CALL`.
- They do **not** affect calls that violate specific expectations -- those always cause failures.
- `NiceMock` and `StrictMock` only work correctly if your mock methods are defined directly in the mock class using `MOCK_METHOD`.
- The mock class should have a **virtual destructor** to avoid undefined behavior.

---

## Fatal vs Non-Fatal Failures

GoogleTest differentiates between **fatal** and **non-fatal** failures in your tests:

- **Fatal Failures** cause the current test to abort immediately.
- **Non-Fatal Failures** are recorded and reported, but the test continues execution.

### How This Relates to Strictness

- Some strict policies treat uninteresting calls or expectation mismatches as **non-fatal failures** by default to allow test diagnostics to accumulate.
- Strict mocks escalate warnings to **non-fatal test failures**.
- You can control fatality levels in assertions to tailor test abort behavior.

### Best Practices

- Use fatal failures when subsequent test code depends on the success of certain conditions.
- Use non-fatal failures for logging unexpected but not critical test deviations.

---

## Death Tests: Verifying Fatal Program Behaviors

Testing code paths that terminate or crash your program safely (such as calls to `abort()`, `exit()`, or illegal memory access) is vital for robust behavior. GoogleTest provides two styles of death tests:

### 1. Fast Death Tests

- Run in the same process.
- Use `fork()` (on POSIX systems) to avoid the overhead of launching a new process.
- Faster but can have subtle interactions with global state.

### 2. Threadsafe (External) Death Tests

- Run the death test in a new process.
- Isolated and safer against side-effects.
- Portable across operating systems.


### Writing a Death Test

Use the `EXPECT_DEATH()` or `ASSERT_DEATH()` macros:

```cpp
EXPECT_DEATH({ TriggerFatalCondition(); }, "Expected error message regex");
```

The expression runs, and the test passes only if the program terminates in the expected way and outputs a message matching the regex.

### Key Concepts

- Death tests run the tested code in a separate process to isolate crashes.
- Use regex matchers to confirm specific error outputs.
- Avoid global state modification between tests that use death tests.

### Best Practices

- Keep death tests minimal and focused to avoid flakiness.
- Use `ASSERT_DEATH` when further execution after failure would cause undefined behavior.
- Be cautious when running on non-POSIX platforms.

---

## Practical Tips and Common Pitfalls

- **Use strict mocks** to enforce contract conformance but combine them with `NiceMock` when uninteresting calls are a natural part of test.
- **Order matters:** Set expectations before exercising mock methods; setting expectations afterward leads to undefined behavior.
- **Enable verbosity** (`--gmock_verbose=info`) when debugging complex mismatches or unexpected calls; it provides detailed traces.
- **Use sequences and `.After(...)`** clauses to specify call order and dependencies.

---

## Summary

This page covers advanced testing concepts in GoogleTest and GoogleMock designed to increase test rigor and coverage:

- Understanding **Strictness policies** (Nice, Naggy, Strict) for mock objects and their trade-offs.
- Distinguishing **fatal and non-fatal failures**, and when to use which.
- The theory and application of **death tests** for asserting on fatal failure scenarios safely.
- Best practices to avoid common mistakes and improve test diagnostics.

---

## See Also

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Best practices on mock strictness and actions.
- [Mock Strictness Controls API Reference](https://google.github.io/googletest/api/gmock_8h.html#Strictness_Controls) - Detailed technical API on NiceMock, NaggyMock, and StrictMock.
- [Death Tests Guide](https://google.github.io/googletest/primer.html#death-tests) - Writing safe death tests.
- [EXPECT_CALL](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL) - Setting expectations for mocks.
- [ON_CALL](https://google.github.io/googletest/reference/mocking.html#ON_CALL) - Setting default mock behavior.

---

<Callout title="Tip" type="info">
When diagnosing unexpected mock calls, running your tests with the flag `--gmock_verbose=info` provides detailed traces of all mock interactions to greatly ease debugging.
</Callout>