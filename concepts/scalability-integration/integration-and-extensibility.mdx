---
title: "Integration Strategies and Extensibility"
description: "Discover how to integrate GoogleTest and GoogleMock with larger projects, including supported build systems, ways to extend with custom actions and matchers, and approaches for using the frameworks in CI pipelines and multi-language environments."
---

# Integration Strategies and Extensibility

GoogleTest and GoogleMock are designed to scale gracefully in large and complex C++ projects. This guide explores practical strategies for integrating these frameworks with existing build systems, extending their capabilities with custom matchers and actions, and effectively using them in continuous integration (CI) pipelines and multi-language environments.

---

## Supported Build Systems

GoogleTest and GoogleMock support seamless integration with popular build systems, enabling flexible adoption in diverse development environments. Here's how to approach integration:

### CMake Integration

- GoogleTest and GoogleMock provide CMake targets that can be imported and linked easily.
- Use `FetchContent` or add GoogleTest as a subdirectory to your project.
- Define your test executable linking against `gtest` and `gmock` targets.

**Example:**

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.12.1.zip
)
FetchContent_MakeAvailable(googletest)

target_link_libraries(my_test PRIVATE gtest gmock)
```

### Bazel Integration

- The project includes Bazel BUILD files for building GoogleTest and GoogleMock.
- Incorporate GoogleTest and GoogleMock as dependencies in your workspace via `MODULE.bazel` or manual workspace setup.
- Use `cc_test` rules for your test binaries that depend on `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock`.

### Other Build Systems

- For other build systems like Make, Ninja, or custom scripts, you can compile and link GoogleTest and GoogleMock as static or shared libraries.
- Ensure that the include paths and compile options meet GoogleTest's requirements (e.g., C++17).

<Info>
Always refer to the [Installing with CMake](https://google.github.io/googletest/getting-started/requirements-installation/installation-cmake) and [Installing with Bazel](https://google.github.io/googletest/getting-started/requirements-installation/installation-bazel) documentation for the latest, step-by-step guidance.
</Info>

---

## Customizing GoogleMock: Extending with Custom Matchers and Actions

To tailor mocking to your domain, GoogleMock provides well-documented extension points allowing you to define:

### Custom Matchers

- Matchers allow flexible argument validation in expectations.
- Use the `MATCHER`, `MATCHER_P`, or derive from the matcher interface for advanced use.
- Custom matchers enhance test expressiveness and readability.

**Example: Basic Custom Matcher**

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

// Usage in EXPECT_CALL
EXPECT_CALL(mock, DoSomething(IsEven()));
```

### Custom Actions

- Define new behaviors for mocked methods beyond built-in returns.
- Use lambdas or function objects with `Invoke`, or implement `ActionInterface`.

**Example: Custom Action using Lambda**

```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce([](int x) {
        return x * 2;
    });
```

### Using the `custom` Directory

- The `googlemock/include/gmock/internal/custom/` directory serves as an injection point for user-defined macros and flags.
- Customize mocking behavior or enable experimentation with new features.
- Key header: `gmock-port.h` for defining flag-related macros.

---

## Using GoogleTest & GoogleMock in CI Pipelines

Automating testing in CI pipelines is essential for fast feedback and quality assurance. GoogleTest and GoogleMock are designed for robust CI integration:

### Preparing Tests for CI

- Tests should be fast, independent, and produce consistent results to suit CI environments.
- Use test filtering options (`--gtest_filter`) to run relevant subsets of tests.
- Output test results in XML format (`--gtest_output=xml:`) for seamless integration with CI servers.

### Common CI Workflows

- Execute tests in parallel to speed up feedback loops (e.g., with build tools like Bazel or CTest).
- Monitor test flakiness and isolate flaky tests using GoogleTest features.
- Aggregate and analyze failures with detailed assertion messages and gMock verbose logging (`--gmock_verbose=info`).

### Handling Cross-language Environments

- GoogleTest and GoogleMock are C++-centric; for projects using multiple languages, integrate test results from each ecosystem.
- Use adapters or wrapper tools to call C++ tests from other language environments if needed.

<Warning>
Ensure that your mocks do not rely on non-deterministic features or external dependencies that can cause flaky test results in CI.
</Warning>

---

## Practical Integration Tips and Best Practices

- **Define mocks in a centralized location:** Place mocks in dedicated header/source files to share across tests.
- **Avoid mocking classes you don't own:** Mitigate maintenance burden by mocking interfaces you control or by wrapping external classes.
- **Leverage default actions:** Use `ON_CALL` to define standard mock behaviors and `EXPECT_CALL` only when verifying interactions.
- **Use strictness wrappers judiciously:** Employ `NiceMock`, `NaggyMock`, or `StrictMock` to control warnings and failures on uninteresting calls.
- **Retire expectations properly:** Use `.RetiresOnSaturation()` to avoid sticky expectations blocking further matching.

---

## Integration Diagram

This flow illustrates the typical integration points and extensibility layers when embedding GoogleTest and GoogleMock in your project.

```mermaid
flowchart TD
  A[Your C++ Project] --> B[Build System Integration]
  B --> C[CMake / Bazel / Others]
  C --> D[Link GoogleTest & GoogleMock Libraries]
  D --> E[Test Executables]
  E --> F[Define Tests & Mocks]
  F --> G[Mocks with Custom Matchers & Actions]
  E --> H[Run Tests (Locally or in CI)]
  H --> I[Test Results & Verbose Logs]
  I --> J[CI Pipeline Collects & Reports Results]
  
  subgraph Extensibility
    G
    K[Custom Matchers]
    L[Custom Actions]
    F --> K
    F --> L
  end
  
  style Extensibility fill:#f9f,stroke:#333,stroke-width:1px,color:#333
```

---

## Troubleshooting Integration Issues

- **Build Failures:** Verify compiler compatibility, include paths, and linking order.
- **Mock Failures:** Ensure all virtual methods to be mocked are declared correctly and mocks include necessary overridden methods.
- **Test Discovery Problems:** Confirm tests are linked with the appropriate GoogleTest main() or custom entry point.
- **CI Test Failures:** Check for environment inconsistencies, missing dependencies, or flaky tests.

Refer to the [Validating Setup & Troubleshooting](https://google.github.io/googletest/getting-started/configuration-validation/validation-troubleshooting) guide for exhaustive troubleshooting advice.

---

## Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Beginner-friendly guide to mocking.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes for common mocking scenarios.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html): Quick reference for matchers, actions, and expectations.
- [Integration with Continuous Integration Systems](https://google.github.io/googletest/guides/integration-and-real-world-use/integration-ci.html): CI best practices.

---