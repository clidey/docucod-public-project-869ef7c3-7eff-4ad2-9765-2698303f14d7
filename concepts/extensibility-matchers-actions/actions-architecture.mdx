---
title: "Actions: Defining Mock Behavior"
description: "Unpack the abstraction of ‘actions’ in GoogleMock. See how actions specify what happens when mock methods are invoked and how you can leverage or define new actions for rich simulation of dependencies."
---

# Actions: Defining Mock Behavior

When using GoogleMock, **actions** specify what happens when a mock method is invoked. Unlike real methods with inherent implementations, mock methods have no working code behind them by default, so defining their behavior explicitly is essential to simulate realistic responses and side effects.

This guide unpacks the concept of actions in GoogleMock, explores built-in actions you can use out-of-the-box, and shows you how to create your own custom actions, empowering you to write rich, expressive tests that precisely control and verify the interaction between your code and its dependencies.

---

## What Are Actions?

An **action** in GoogleMock is a piece of code that executes when a mock method is called. It defines the behavior of the method during testing — what value it returns, what side effects it produces, or what functions it invokes — effectively simulating the method’s real implementation.

- If you don’t specify an action, GoogleMock applies a **default action** based on the return type.
- When you use `EXPECT_CALL` or `ON_CALL`, you can chain an action to define what the mock method should do.

For example, when a mock function returns an integer, you might specify that it returns 42 each time it is called.

---

## Built-in Actions

GoogleMock provides many built-in actions covering common scenarios, from returning fixed values to more complex operations like invoking callbacks or modifying arguments.

### Returning Values

| Action                             | Description                                                                                  |
|----------------------------------|----------------------------------------------------------------------------------------------|
| `Return()`                       | Return from a `void` mock function.                                                          |
| `Return(value)`                  | Return `value`. The return value is fixed at the time the expectation is set, not at call-time.| 
| `ReturnArg<N>()`                 | Return the N-th (zero-based) argument of the mock function.                                  |
| `ReturnNew<T>(a1, ..., ak)`      | Return a pointer to a new instance of `T` created with the given constructor arguments.      |
| `ReturnNull()`                   | Return a `nullptr`.                                                                          |
| `ReturnPointee(ptr)`             | Return the value pointed to by `ptr`.                                                       |
| `ReturnRef(variable)`            | Return a reference to the given variable.                                                   |
| `ReturnRefOfCopy(value)`         | Return a reference to a **copy** of `value`; the copy lives as long as the action.           |
| `ReturnRoundRobin({a1,...,ak})` | Cycles through the given list of values in order, returning each one in turn.                 |

### Actions Causing Side Effects

| Action                          | Description                                                                                     |
|--------------------------------|------------------------------------------------------------------------------------------------|
| `Assign(&var, value)`           | Assigns `value` to the variable pointed to by `var`.                                           |
| `DeleteArg<N>()`                | Deletes the N-th argument (must be a pointer).                                                  |
| `SaveArg<N>(pointer)`           | Saves the N-th argument to the location pointed to by `pointer` by copy-assignment.             |
| `SaveArgByMove<N>(pointer)`     | Saves the N-th argument to the location pointed to by `pointer` by move-assignment.             |
| `SaveArgPointee<N>(pointer)`    | Saves the value pointed to by the N-th argument to the location pointed to by `pointer`.        |
| `SetArgReferee<N>(value)`      | Sets the variable referenced by the N-th argument to `value`.                                  |
| `SetArgPointee<N>(value)`      | Sets the variable pointed to by the N-th argument to `value`.                                  |
| `SetArrayArgument<N>(first, last)` | Copies elements from `[first, last)` into the array pointed to by the N-th argument.         |
| `SetErrnoAndReturn(error, value)` | Sets `errno` to `error` then returns `value`.                                                |
| `Throw(exception)`              | Throws the given exception (copyable). Available if exceptions are enabled.                    |

### Using Callable Objects as Actions

Actions can also be defined by existing functions, functors, lambdas, or callbacks, allowing for flexible and complex behaviors:

| Action                                 | Description                                                               |
|---------------------------------------|---------------------------------------------------------------------------|
| `f`                                   | Invokes the callable `f` with the mock function’s arguments.              |
| `Invoke(f)`                           | Same as above; `Invoke` wraps `f` for clarity.                            |
| `Invoke(object_ptr, &Class::method)` | Invokes the specified method on the object with the mock function’s arguments. |
| `InvokeWithoutArgs(f)`                | Invokes `f` with **no arguments**.                                        |
| `InvokeWithoutArgs(object, &method)` | Invokes the specified method on the object, with no arguments.            |
| `InvokeArgument<N>(args...)`          | Invokes the N-th (0-based) argument (a callable) with provided arguments.  |

Example:

```cpp
using ::testing::Return;
using ::testing::Invoke;
using ::testing::InvokeArgument;

EXPECT_CALL(mock_obj, SomeMethod(_))
    .WillOnce(Return(42));

EXPECT_CALL(mock_obj, AnotherMethod(_))
    .WillOnce(Invoke([](int x) { return x * 2; }));

EXPECT_CALL(mock_obj, CallWithCallback(_))
    .WillOnce(InvokeArgument<0>(5));  // Invokes the 0-th arg passed as a callback, with argument 5
```

### Composite Actions

You can combine multiple actions to run in sequence, or selectively apply actions to particular arguments:

| Action                         | Description                                                            |
|-------------------------------|------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., an)`       | Performs all actions in order, returns the result of the last one.     |
| `IgnoreResult(a)`              | Performs action `a` but discards its return value (must be non-void).   |
| `WithArg<N>(a)`                | Invokes action `a` with only the N-th argument of the mock function.   |
| `WithArgs<N1, N2, ..., Nk>(a)` | Invokes action `a` with selected arguments of the mock function.       |
| `WithoutArgs(a)`               | Invokes action `a` without any arguments.                              |

Example:

```cpp
EXPECT_CALL(mock, Foo(_, _))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));

EXPECT_CALL(mock, Bar(_, _, _))
    .WillOnce(WithArgs<0, 2>(Invoke(myFunc)));
```

---

## Defining Custom Actions

While the built-in actions cover many scenarios, sometimes you need tailored behaviors not provided out-of-the-box. GoogleMock supports writing your own actions easily.

### Using Lambdas or Functors

The easiest way to define an action is to supply a callable object (function, lambda, or functor) with a compatible signature:

```cpp
EXPECT_CALL(mock, Method(_)).WillOnce([](int x) {
  // Custom behavior here
  return x * x;
});
```

This callable must be compatible with the mock method’s signature (arguments and return type).

### ACTION Macros for Namespace-Scope Custom Actions

If you want to define named custom actions reusable across tests, GoogleMock offers `ACTION` macros:

```cpp
// Define a custom action named IncrementArg1
ACTION(IncrementArg1) {
  return ++(*arg1);
}

// Usage in tests:
EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementArg1());
```

- Inside the action body, you can refer to `argK` (0-based) for arguments.
- You can define parameterized actions using `ACTION_P` and higher-arity macros like `ACTION_P2`.

Example:

```cpp
ACTION_P(Add, n) {
  return arg0 + n;
}

EXPECT_CALL(mock, Foo(_)).WillOnce(Add(5));
```

### Implementing Polymorphic Actions

To write a flexible custom action usable with mock methods of different types, implement a class with a templated `Perform()` method and use `MakePolymorphicAction()`:

```cpp
class ReturnSecondArgAction {
 public:
  template <typename Result, typename ArgumentTuple>
  Result Perform(const ArgumentTuple& args) const {
    return std::get<1>(args);  // Return second argument
  }
};

PolymorphicAction<ReturnSecondArgAction> ReturnSecondArg() {
  return MakePolymorphicAction(ReturnSecondArgAction());
}

// Usage:
EXPECT_CALL(mock, Foo(_, _)).WillOnce(ReturnSecondArg());
```

This approach provides type safety and clear error messages during compilation.

---

## Best Practices and Tips

- **Plan your actions:** Use `ON_CALL` to set default behaviors and `EXPECT_CALL` with actions only when you want to verify the call.
- **Combine actions with `DoAll` to simulate complex effects**, such as setting output arguments and returning a value.
- **Use `RetiresOnSaturation()` on expectations** that should be inactive after their call count is satisfied, enabling flexible call sequences.
- **Leverage existing callable objects and lambdas** for defining actions conveniently without complex boilerplate.
- **Use `InvokeArgument<N>` to call back function arguments** safely, especially callbacks.

---

## Troubleshooting Actions

- If your action always returns the same value, but you expect it to change, remember that actions in `EXPECT_CALL` are evaluated once at expectation setting, not at call time.
- When mocking methods with move-only types like `std::unique_ptr`, prefer lambdas or compatible functors for actions.
- Be cautious about side effects inside actions as these can affect test determinism and cause errors.

---

## Summary

Actions are essential to defining how mock methods behave, allowing thorough simulation of dependencies and test interactions. GoogleMock offers a rich set of built-in actions, flexible combinators, and straightforward mechanisms for defining custom actions suited to any testing scenario.

---

### Further Reading and References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html#actions-what-should-it-do)
- [Actions Reference (API)](../api-reference/mocking-apis/actions-and-custom-behaviors.md)
- [gMock Cookbook — Using Actions](https://google.github.io/googletest/gmock_cook_book.html#using-actions)
- [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html#actions)

---