---
title: "Mocking Model & Mock Object Behaviors"
description: "Delve into the structure and philosophy of mocking in GoogleMock. Understand how mock classes are constructed, how call expectations and behaviors are specified, and what 'Nice', 'Naggy', and 'Strict' mock types mean for your tests."
---

# Mocking Model & Mock Object Behaviors

Explore how GoogleMock structures mocks and controls their behavior in tests. This document focuses explicitly on how mock classes are constructed, how call expectations and mock behaviors are specified, and what the 'Nice', 'Naggy', and 'Strict' mock types signify.

---

## Defining Mock Classes

A mock class in GoogleMock is a subclass of a user-defined interface or class with virtual methods that you want to mock. Each virtual method to be mocked is declared using the `MOCK_METHOD` macro, specifying its return type, name, argument list, and optional qualifiers such as `const` and `override`.

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

### Key Points
- The destructor in the base class **must be virtual** for correct mock behavior.
- Mock methods must be declared in the `public` section of your mock class, even if the original methods are protected or private.
- Overloaded and templated virtual methods can also be mocked following the same pattern.

## Using Mock Classes

The typical user flow with mocks involves:

1. Creating mock instances.
2. Specifying expectations on mocked methods with `EXPECT_CALL`.
3. Optionally setting default behaviors using `ON_CALL`.
4. Exercising the code under test that uses the mock objects.
5. Allowing GoogleMock to verify expectations when the mock objects are destructed.

Here's a summarized example:

```cpp
using ::testing::Return;

MockFoo mock_foo;

ON_CALL(mock_foo, GetSize()).WillByDefault(Return(5));
EXPECT_CALL(mock_foo, Describe(5)).Times(3).WillRepeatedly(Return("Description for 5"));

// Call code under test which uses mock_foo
...
```

## Call Expectations and Behaviors

### `EXPECT_CALL`

Use `EXPECT_CALL` to specify *expectations* — what calls you expect the mock to receive, how many times, with what arguments, and what actions it should perform:

```cpp
EXPECT_CALL(mock, Method(args...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `Times` specifies how many times you expect the call.
- `WillOnce` and `WillRepeatedly` define the behavior in response to calls.

If you omit `Times()`, GoogleMock infers it based on how many `WillOnce` and `WillRepeatedly` clauses you specified.

### `ON_CALL`

Use `ON_CALL` to specify default behaviors without setting an expectation that the call must occur:

```cpp
ON_CALL(mock, Method(args...)).WillByDefault(action);
```

This sets the behavior of the mock method when it is called without an explicit expectation.

### Matchers and Cardinalities

GoogleMock lets you flexibly specify:
- Which arguments you expect, using **matchers** (`_` for any value, `Eq(value)`, `Ge(n)`, etc.).
- How many times a method should be called using **cardinalities** (`Times(Exactly(2))`, `Times(AnyNumber())`, `Times(AtLeast(1))`, etc.).

### Expectation Ordering

By default, calls can be received in any order. Use the `InSequence` object or `.After()` clause to enforce order if needed.

```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

## Strictness Modes: Nice, Naggy, and Strict Mocks

GoogleMock supports three mock object types that govern behavior on **uninteresting calls** (calls to mock methods without any `EXPECT_CALL` set):

| Mode    | Behavior on Uninteresting Calls                 | Typical Use Case                                               |
|---------|--------------------------------------------------|---------------------------------------------------------------|
| `NiceMock<T>`  | Silences warnings; allows all uninteresting calls  | Most tests, minimizing noise and brittle failures              |
| `NaggyMock<T>` | Warns on uninteresting calls (default for `Mock<T>`) | Default behavior; good for debugging calls you might have missed |
| `StrictMock<T>`| Treats uninteresting calls as test failures          | Rigorous tests requiring strict call verification              |

### Declaring Strictness

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;
NaggyMock<MockFoo> naggy_foo;
StrictMock<MockFoo> strict_foo;
```

- These wrappers publicly inherit from the base mock class but modify internal mock behavior to suppress, warn, or error on unexpected calls.
- Currently, `Mock<T>` defaults to naggy behavior, but this is planned to change to nice in the future.

### Important Considerations
- These strictness modes affect only **uninteresting calls**.
- They do *not* influence *unexpected calls*, i.e., calls that don't match any expectations.
- Only mock methods defined with `MOCK_METHOD` directly in the mock class are affected by these wrappers.
- Nested combinations of these wrappers (e.g., `NiceMock<StrictMock<T>>`) are not supported.

## Practical Example: Choosing Mock Types

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

// Use a nice mock to reduce noise from uninteresting calls
NiceMock<MockFoo> mock;
EXPECT_CALL(mock, DoSomething());

// Use a strict mock to enforce only expected calls
StrictMock<MockFoo> strict_mock;
EXPECT_CALL(strict_mock, DoSomething());

// The test fails if strict_mock receives unexpected method calls
```

## Best Practices and Tips

- Use **nice mocks** for most scenarios to keep your tests clean and avoid noisy warnings.
- Switch to **naggy mocks** when debugging tests that silently ignore unexpected calls.
- Reserve **strict mocks** for high-assurance tests where any unexpected call is a real problem.
- Define `EXPECT_CALL` expectations *before* exercising the mock; setting expectations afterward is undefined behavior and will cause unreliable tests.
- Use default actions with `ON_CALL` to specify what should happen on calls that are not explicitly expected.

## Troubleshooting Common Issues

- If you see warnings about *uninteresting mock function calls*, you may want to:
  - Add a catch-all expectation with `.Times(AnyNumber())`.
  - Use a `NiceMock` to suppress warnings after confirming correctness.
- If unexpected calls cause test failures, verify your `EXPECT_CALL` is correctly specified and matches the actual call.
- If your mock has unexpected behaviors with strictness modes, check if methods are declared directly via `MOCK_METHOD` in your mock class.

---

## Summary

This guide centers on the essential mocking constructs in GoogleMock: defining mock classes and methods, establishing fine-grained call expectations and behaviors, and controlling mock object strictness through `NiceMock`, `NaggyMock`, and `StrictMock`. It equips you to design mocks that best fit your testing needs, helping you balance noise and rigor effectively.

---

## Further Reading

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for mock class syntax and mocking constructs.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly introduction to mocking concepts.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) — Detailed reference for macros like `EXPECT_CALL`, `ON_CALL`, and strictness modes.
- [Mock Object Strictness Modes](https://google.github.io/googletest/guides/advanced-and-integrations/mock-object-strictness.html) — Deep dive on strictness mode usage.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes for advanced mocking techniques and patterns.

