---
title: "Assertions and Matchers"
description: "Discover the key abstractions for making expressive assertions in GoogleTest. Learn about matcher types, the role of assertion results, and how matchers enable modular, composable verification across both GoogleTest and GoogleMock."
---

# Assertions and Matchers

Discover the key abstractions for making expressive assertions in GoogleTest. Learn about matcher types, the role of assertion results, and how matchers enable modular, composable verification across both GoogleTest and GoogleMock.

---

## Introduction

Assertions and matchers form the heart of the verification capabilities in GoogleTest, enabling you to accurately specify expectations about your codeâ€™s behavior and to get informative feedback when those expectations are not met. This guide introduces you to these abstractions, helping you master how to write expressive, clear, and maintainable tests.

Matchers extend the power of assertions by allowing fine-grained, composable conditions on values, while assertion results communicate success or failure with useful messages. Combined, they empower you to write tests that are not only precise but also easy to understand and debug.


## Key Concepts

### Assertions: Verifying Conditions

At their core, assertions check whether a given condition holds true during a test. GoogleTest provides a rich set of assertion macros (`EXPECT_*`, `ASSERT_*`, and specialized forms) that report success or failure to the test framework.

- **Fatal Assertions (`ASSERT_*`)**: Immediately abort the current function upon failure, preventing further execution in that scope.
- **Nonfatal Assertions (`EXPECT_*`)**: Record a failure but allow the remainder of the test function to continue.

For example, using assertions for equality verification:

```cpp
EXPECT_EQ(x, y) << "Vectors differ";
ASSERT_TRUE(IsValid(value)) << "Value is invalid";
```

Assertions can be enriched with custom messages, improving diagnostic clarity.


### Matchers: Expressive and Reusable Conditions

Matchers provide a way to specify expectations on values beyond simple equality or boolean conditions. They can describe complex criteria, such as ranges, patterns, container contents, or custom predicates.

Matchers are particularly powerful because:

- They produce **human-readable failure messages** explaining what was expected and what was actual.
- They support **polymorphism**, adapting to types as needed.
- They enable **composability**, combining with logical operators to form complex conditions.

#### Using Matchers with Assertions

You can use matchers directly in assertions with the `EXPECT_THAT()` and `ASSERT_THAT()` macros:

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
ASSERT_THAT(collection, ElementsAre(1, Gt(5), _));
```

Here, `StartsWith`, `ElementsAre`, `Gt` (greater than), and `_` (wildcard) are built-in matchers.


## Matcher Types in GoogleTest and GoogleMock

### Wildcard Matchers

- `_`: Matches any value of any type. Useful when you don't want to specify a constraint on an argument.

### Comparison Matchers

- `Eq(value)`: Matches if the argument equals `value`.
- `Ne(value)`, `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`: Other relational comparators.

### Pointer Matchers

- `IsNull()`: Matches a null pointer.
- `NotNull()`: Matches any non-null pointer.
- `Pointee(matcher)`: Matches a pointer pointing to a value matching `matcher`.

### String Matchers

- `StrEq()`, `StrNe()`: String equality/inequality (case-sensitive).
- `StrCaseEq()`, `StrCaseNe()`: Case-insensitive string comparison.
- `HasSubstr(substring)`: Matches strings containing a substring.
- `StartsWith(prefix)`, `EndsWith(suffix)`: Matches strings with given prefixes or suffixes.
- `MatchesRegex(pattern)`: Matches strings matching a regex pattern.

### Container Matchers

- `ElementsAre(...)`: Matches if container elements exactly match the given list of matchers in order.
- `UnorderedElementsAre(...)`: Matches if container contains all the given elements regardless of order.
- `Contains(matcher)`: Matches if the container contains at least one element matching the matcher.
- `Each(matcher)`: Matches if every element in the container matches the matcher.
- `SizeIs(matcher)`: Matches container sizes.

### Exception Matchers

- Used to verify exceptions, e.g., `Throws()`, `ThrowsMessage()`, matching exception types and messages.


## Assertion Results: Conveying Success or Failure

GoogleTest provides the class `testing::AssertionResult` that wraps the outcome of a predicate or matcher check.

- You create a success result with `AssertionSuccess()`.
- You create a failure result with `AssertionFailure()`.

You can stream detailed messages to an `AssertionResult` to augment failure reports:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}
```

Using this predicate function in an assertion such as `EXPECT_TRUE(IsEven(3))` produces clear messages:

```
Value of: IsEven(3)
  Actual: false (3 is odd)
Expected: true
```

This approach enhances debugging by providing specific failure information.


## Writing Custom Matchers

GoogleTest provides macros `MATCHER`, `MATCHER_P`, and variants to define your own matchers succinctly.

### Basic Matcher Example

```cpp
MATCHER(IsDivisibleBy7, "Checks if a number is divisible by 7") {
  return (arg % 7) == 0;
}
```

Usage:

```cpp
EXPECT_THAT(value, IsDivisibleBy7());
```

### Parameterized Matcher Example

```cpp
MATCHER_P(HasAbsoluteValue, value, "") {
  return abs(arg) == value;
}
```

Usage:

```cpp
EXPECT_THAT(x, HasAbsoluteValue(10));
```

Matchers can also stream further explanations to `result_listener` to clarify failure causes.


## Practical Tips & Best Practices

- Prefer **`EXPECT_THAT` with matchers** over raw boolean assertions for clarity.
- Use **parameterized matchers** when the check involves variable values.
- Implement custom **predicate-formatter functions** returning `AssertionResult` for complex conditions with rich failure explanations.
- Combine **matchers using `AllOf()`, `AnyOf()`, and `Not()`** to build complex logical checks.
- In mock expectations, use **matchers to specify argument constraints** instead of exact values when applicable.
- Use **`SCOPED_TRACE`** to add context to assertions within helper functions or loops.


## Common Pitfalls

- Matchers must be **pure functions**: no side-effects and the same input must always yield the same output.
- When using `EXPECT_TRUE()` with complex expressions, consider predicate assertions or matchers to get better diagnostics.
- Avoid void-returning functions with fatal assertions, as such assertions must be called inside void functions.
- When writing custom matchers, do not ignore the `negation` argument in description strings; this controls how negated matchers describe themselves.


## Advanced Matcher Compositions

GoogleMock (part of GoogleTest ecosystem) extends matchers into mocks, allowing expectations with matchers on mock method calls.

Example:

```cpp
EXPECT_CALL(mock_object, Foo(AllOf(Gt(5), Lt(10))));
```

Multi-argument matchers via `With()` clause combine all arguments into a tuple for complex conditions.


## Code Sample: Using Matchers and Assertions

```cpp
#include <gmock/gmock.h>

using ::testing::Gt;
using ::testing::Lt;
using ::testing::StartsWith;
using ::testing::ElementsAre;

TEST(MyTestSuite, ExampleAssertions) {
  std::string greeting = "Hello, world!";
  EXPECT_THAT(greeting, StartsWith("Hello"));

  std::vector<int> numbers = {1, 10, 5};
  EXPECT_THAT(numbers, ElementsAre(Gt(0), Lt(15), 5));

  int x = 7;
  EXPECT_TRUE(x % 7 == 0) << "x should be divisible by 7";
}
```


## Troubleshooting Common Issues

- **Non-informative EXPECT_TRUE failures?** Switch to matchers or predicate assertions that provide value explanations.
- **Mistakes in matcher use cause confusing compiler errors:** Check types carefully or use explicit `SafeMatcherCast<T>()` to help.
- **Matcher descriptions unclear:** Provide custom description strings using the `negation` argument.
- **Unintentional side-effects in matcher:** Ensure matchers are pure, no state mutation or external calls inside matcher.
- **Fatal assertions in non-void functions:** Change function return type to void or use nonfatal assertions.


## See Also and Related Topics

- [GoogleTest Assertions Reference](reference/assertions.md) for macro descriptions.
- [Matchers Reference](api-reference/gtest-api-core/using-matchers.md) for built-in and custom matchers.
- [gMock Cookbook: Writing New Matchers](docs/gmock_cook_book.md#NewMatchers) for matcher creation patterns.
- [GoogleMock API: Matchers in Mocks](api-reference/gmock-api-core/matchers-in-mocks.md) for using matchers within mock expectations.
- [GoogleTest Primer](docs/primer.md) for starting with tests and assertions.


---

## Summary

This guide provides a focused introduction to the core abstractions around assertions and matchers in GoogleTest and GoogleMock. Users learn how to leverage expressive matchers in assertions, how to interpret assertion results for richer failure information, and how to create custom matchers to cover specialized test scenarios. The document emphasizes writing clear, maintainable, and debuggable tests through composable, polymorphic matchers.

### Key Sections

- Introduction to Assertions and Matchers
- Assertion Results and Predicate Assertions
- Built-in Matcher Types
- Writing Custom Matchers
- Practical Usage Tips and Common Pitfalls
- Advanced Matcher Composition
- Sample Code and Troubleshooting

### Important Links

- [GoogleTest Assertions Reference](reference/assertions.md)
- [GoogleMock Matchers Reference](googlemock/include/gmock/gmock-matchers.h)
- [gMock Cookbook - Writing New Matchers](docs/gmock_cook_book.md#NewMatchers)
- [Matchers in Mocks API Reference](api-reference/gmock-api-core/matchers-in-mocks.md)
- [GoogleTest Primer](docs/primer.md)

### Cross-References

- Concepts: [Assertions and Matchers](concepts/architecture-core-concepts/assertions-and-matchers)
- Guides: [Writing Effective Tests with Matchers](guides/writing-effective-tests/advanced-assertions-practices.mdx)
- API Reference: [Using Matchers in GoogleTest](api-reference/gtest-api-core/using-matchers.mdx)

### Next Steps

Explore custom matcher and action definitions to extend your testing capabilities. Use matchers in combination with mock expectations to precisely control and verify mock method calls. Consult the rich examples in the gMock Cookbook and related references to deepen your mastery.
