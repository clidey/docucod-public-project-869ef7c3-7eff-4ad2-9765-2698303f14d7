---
title: "Customization and Extension Points"
description: "Discover how advanced users can craft custom printers, matchers, and actions to extend the behavior of GoogleTest and GoogleMock. See which hooks and interfaces are designed for extension, and how to safely adapt the frameworks for complex or novel scenarios."
---

# Customization and Extension Points

GoogleTest and GoogleMock are designed with extensibility at their core. Advanced users can tailor the behavior of these frameworks by creating custom components such as printers, matchers, and actions. This guide explores the key extension points and hooks provided by GoogleTest and GoogleMock, explaining how to safely and effectively customize the frameworks for complex or novel testing scenarios.

---

## Why Extend GoogleTest and GoogleMock?

While GoogleTest and GoogleMock provide comprehensive built-in functionality, unique testing requirements or domain-specific validation often call for extensions:

- **Custom Printers** to control how objects appear in test output.
- **Custom Matchers** for expressive and reusable argument validations.
- **Custom Actions** to implement complex mock behaviors beyond the built-in actions.

Extension allows you to write clearer, more maintainable tests that closely reflect your domain logic.

---

## Overview of Customization Types

### 1. Crafting Custom Printers

GoogleTest uses printers to display object state in failure messages and logs. When your types have no built-in printer, or you want more readable output, you can define custom printers.

- **How to define**: Implement a free function with signature:

  ```cpp
  void PrintTo(const MyType& value, std::ostream* os);
  ```

- **What it does**: This tells GoogleTest how to format your object `MyType` when printing.

- **Example**:

  ```cpp
  struct Point { int x, y; };

  void PrintTo(const Point& p, std::ostream* os) {
    *os << "Point(" << p.x << ", " << p.y << ")";
  }
  ```

- **Best Practices**:
  - Make printers concise but informative.
  - Avoid side effects inside printers.
  - Ensure thread-safety if tests run concurrently.

> Custom printers enhance diagnostic clarity and speed debugging.

### 2. Defining Custom Matchers

Matchers describe the criteria that mock function arguments should meet. While GoogleMock provides numerous built-in matchers, your domain may require more specialized validations.

- **How to define**:
  - Use `MATCHER` or `MATCHER_P` macros for quick matcher definitions.
  - Implement the matcher interface (`MatchAndExplain`, `DescribeTo`, and `DescribeNegationTo`) for more control.

- **Examples**:

  ```cpp
  MATCHER(IsEven, "checks if a number is even") {
    return (arg % 2) == 0;
  }

  MATCHER_P(InRange, range, "checks if within a range") {
    return arg >= range.first && arg <= range.second;
  }
  ```

- **Usage**:

  ```cpp
  EXPECT_CALL(mock, SomeMethod(IsEven()));
  EXPECT_CALL(mock, AnotherMethod(InRange(std::make_pair(1, 10))));
  ```

- **Key Points**:
  - Matchers must be pure functions without side effects.
  - Provide detailed failure messages via the `DescribeTo` methods.
  - Polymorphic matchers can adapt to multiple argument types.

> Custom matchers bring explicitness and flexibility to argument checks.

### 3. Creating Custom Actions

Actions define what happens when a mock method is called and an expectation matches. Sometimes built-in actions are insufficient, so you can define custom actions.

- **How to define**:
  - Write a callable object (lambda, functor, or function) matching the mock method’s signature.
  - Use them directly in `WillOnce()` or `WillRepeatedly()` clauses.
  - For reusability or complex logic, implement `ActionInterface` or use `MakePolymorphicAction` for polymorphic actions.

- **Simple example**:

  ```cpp
  EXPECT_CALL(mock, Foo(_))
      .WillOnce([](int n) { return n * 2; });
  ```

- **Complex example** (polymorphic action):

  ```cpp
  class ReturnSecondArgAction {
   public:
    template <typename R, typename ArgsTuple>
    R Perform(const ArgsTuple& args) const {
      return std::get<1>(args);
    }
  };

  auto ReturnSecondArg() {
    return ::testing::MakePolymorphicAction(ReturnSecondArgAction());
  }
  ```

- **Tips**:
  - Ensure the return type matches the mocked method’s return type.
  - For side effects or output parameters, combine `DoAll()` with other actions like `SetArgPointee`.

> Custom actions adapt mocks to complex or stateful behavior patterns.

### 4. Controlling Mock Strictness: NiceMock, NaggyMock, StrictMock

GoogleMock supports three strictness modifiers to control the treatment of uninteresting calls (calls without explicit expectations):

- **`NiceMock<T>`**: suppresses warnings on uninteresting calls.
- **`NaggyMock<T>`**: prints warnings on uninteresting calls (default behavior).
- **`StrictMock<T>`**: treats uninteresting calls as test failures.

**Usage example:**

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;    // Quiet mock
StrictMock<MockFoo> strict_foo;  // Strict mock
```

**Important notes:**

- Only mock methods declared directly in the mock class are affected.
- Nested strictness modifiers (e.g., `NiceMock<StrictMock<MockFoo>>`) are not supported.
- Virtual destructors are required for reliable behavior.

---

## How These Customizations Fit into Your Workflow

### Creating and Using Custom Matchers and Actions

1. **Identify domain-specific validation needs** beyond the built-in support.
2. **Write concise and pure matcher classes or macros** leveraging `MATCHER` or polymorphic matcher interfaces.
3. **Define custom actions** as lambdas or classes implementing `ActionInterface` where mock method behavior requires advanced control.
4. **Use matchers and actions in `EXPECT_CALL` and `ON_CALL` macros** to enhance expressiveness and precision of your tests.

### Implementing Printers

Before mock use, define printers for types that lack natural stream output to improve readability of your test logs and failure diagnostics.

### Choosing Mock Strictness

Decide mock strictness based on your test objectives:
- Use `NiceMock` to reduce noise when uninteresting calls are irrelevant.
- Use `NaggyMock` during development to catch unexpected calls early.
- Use `StrictMock` when you want to catch **all** uninteresting calls as errors.

---

## Practical Tips and Best Practices

- **Set expectations before exercising mocks.** Modifying expectations afterward leads to undefined behavior.
- **Always override virtual destructors** on classes you mock to avoid memory leaks and undefined behavior.
- **Use `RetiresOnSaturation()`** on expectations to precisely control when they become inactive.
- **For complex methods with many parameters**, consider redirecting calls to a simpler mock method or use crafted custom matchers for clarity.
- **Leverage existing matchers and actions first** before implementing your own unless the use case requires domain specificity.
- **Verify and clear mock expectations early** in test code when you manage mock lifecycle manually.

---

## Troubleshooting Common Customization Scenarios

### Undefined or Ambiguous Matchers

Custom matchers must be type-safe and unambiguous. Use `SafeMatcherCast` when matching across related types.

### Uninteresting Call Warnings or Errors

If mock methods generate warnings or fail unexpectedly, check your mock strictness type or add catch-all expectations with `Times(AnyNumber())`.

### Slow Compilation Due to Large Mocks

Define mock class constructors and destructors separately (in `.cc` files) to speed up large projects' builds.

### Mocking Overloaded or Templated Methods

Use explicit overload disambiguation with `Const()` or explicit type wrapping in matchers.

---

## Related Documentation and Resources

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Introduction to mocks and usage patterns.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Complete API reference for mocks.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes including delegation and advanced mocking.
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html): Details about built-in and custom matchers.
- [Actions Reference](https://google.github.io/googletest/reference/actions.html): Info on built-in and custom actions.
- [Test Framework Architecture](https://google.github.io/googletest/concepts/test-framework-architecture/architecture-overview.html): How GoogleTest and GoogleMock fit together.

---

By exploring these extension points with precision and care, you can fully harness the power of GoogleTest and GoogleMock, tailoring your testing environment to fit your project's unique needs with confidence and elegance.
