---
title: "Assertions and Matchers"
description: "Explains the assertion model—the heart of GoogleTest's expressiveness. Covers built-in and user-defined assertions, the use of matchers to make flexible checks, and how matcher libraries extend core functionality."
---

# Assertions and Matchers

GoogleTest’s power and expressiveness come from its assertion model, which combines built-in and user-defined assertions with the flexibility of matchers. This page explores how GoogleTest verifies expected outcomes in tests by using various assertion macros and how matchers enhance these assertions by allowing fine-grained, readable checks against complex data.

---

## Understanding Assertions

Assertions are the backbone of GoogleTest that allow you to state what conditions your code is expected to meet. When an assertion fails, GoogleTest reports the failure, indicating what was expected versus what was actually received. Assertions come in two main types:

- **EXPECT_** macros: generate failures but let the current test function continue running.
- **ASSERT_** macros: generate fatal failures and abort the current function immediately.

Most assertion macros come in pairs with these two variants to give you control over test flow.

### Documenting Your Assertions

Every assertion macro can stream a custom failure message. For example:

```cpp
EXPECT_TRUE(my_condition) << "My condition is not true";
```

This enhances diagnostics by allowing you to add custom explanations.

### Explicit Success and Failure Assertions

Sometimes, you want to document a success or failure explicitly, unrelated to boolean conditions:

- `SUCCEED()` – generates a success (for documentation purposes only).
- `FAIL()` – generates a fatal failure, useful for catching unreachable code.
- `ADD_FAILURE()` – generates a nonfatal failure to mark unexpected code paths.
- `ADD_FAILURE_AT(file, line)` – reports a failure at a custom file and line.

Use these to document control flow clearly.

---

## Built-in Assertion Macros with Matchers: `EXPECT_THAT` and `ASSERT_THAT`

GoogleTest introduces the powerful `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` to allow complex, extensible checks using [matchers](#Matchers).

Example:

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(value1, StartsWith("Hello"));
EXPECT_THAT(value2, MatchesRegex("Line \\d+"));
ASSERT_THAT(value3, AllOf(Gt(5), Lt(10)));
```

If an assertion with a matcher fails, GoogleTest reports informative messages that explain exactly how the value did not satisfy the matcher.

### Why Use Matchers?

Matchers are like predicates that describe the condition(s) you expect values to meet. They allow writing assertions that read almost like English, making tests easier to understand and maintain.

---

## Basic Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` — expects the condition to be true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` — expects the condition to be false.

These are fundamental for verification of boolean expressions.

---

## Binary Comparison Assertions

These assertions compare two values with standard relational operators and produce detailed messages on failure:

| Macro       | Meaning                         |
|-------------|--------------------------------|
| `EXPECT_EQ` | Verifies `val1 == val2`         |
| `EXPECT_NE` | Verifies `val1 != val2`         |
| `EXPECT_LT` | Verifies `val1 < val2`          |
| `EXPECT_LE` | Verifies `val1 <= val2`         |
| `EXPECT_GT` | Verifies `val1 > val2`          |
| `EXPECT_GE` | Verifies `val1 >= val2`         |

Pointers are compared by address (except C strings, which should use string comparison assertions).

Example:

```cpp
EXPECT_EQ(expected_count, actual_count) << "Item count mismatched";
```

---

## String Comparison Assertions

To compare C strings (null-terminated chars), GoogleTest provides:

| Macro           | Purpose                               |
|-----------------|-------------------------------------|
| `EXPECT_STREQ`  | Verifies two C strings are equal     |
| `EXPECT_STRNE`  | Verifies two C strings are not equal |
| `EXPECT_STRCASEEQ` | Case-insensitive string equality     |
| `EXPECT_STRCASENE` | Case-insensitive string inequality   |

For C++ `std::string`, use `EXPECT_EQ` instead.

Example:

```cpp
EXPECT_STREQ("hello", result.c_str());
```

---

## Floating-Point Comparison Assertions

Direct equality comparisons are unreliable for floating-point numbers due to precision errors. GoogleTest offers specialized macros:

- `EXPECT_FLOAT_EQ(val1, val2)` — compares two floats within 4 ULPs
- `EXPECT_DOUBLE_EQ(val1, val2)` — compares two doubles within 4 ULPs
- `EXPECT_NEAR(val1, val2, abs_error)` — compares values are within `abs_error` of each other

Use these when testing calculations involving floating-point values.

---

## Exception Assertions

GoogleTest supports verifying exception throwing behavior with the following:

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW` — verifies statement throws an exception of the specified type.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW` — verifies statement throws any exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW` — verifies statement does not throw.

Example:

```cpp
EXPECT_THROW(DoSomething(), std::runtime_error);
```

This requires exceptions to be enabled in your build environment.

---

## Predicate Assertions

For more complex conditions, GoogleTest allows predicate functions or functors to be used with `EXPECT_PRED1`..`EXPECT_PRED5` and corresponding `ASSERT_` variants, which take n arguments:

Example:

```cpp
bool IsPrime(int n) { ... }
EXPECT_PRED1(IsPrime, number);
```

These print value details on failure, enhancing debuggability.

## Formatted Predicate Assertions

`EXPECT_PRED_FORMAT*` variants accept predicates that return detailed `AssertionResult`s, providing customized failure messages.

---

## Windows HRESULT Assertions

Specifically tailored for Windows API programming, these macros test for success or failure in HRESULT codes:

- `EXPECT_HRESULT_SUCCEEDED(expression)`
- `EXPECT_HRESULT_FAILED(expression)`

They enhance messages with readable error details.

---

## Death Assertions

For verifying code that is expected to terminate the process (e.g., in error conditions), GoogleTest provides death assertions:

- `EXPECT_DEATH(statement, matcher)` — asserts that `statement` causes termination with output matching `matcher`.
- `EXPECT_DEBUG_DEATH` — like `EXPECT_DEATH` but only in debug mode.
- `EXPECT_EXIT(statement, predicate, matcher)` — asserts process exits with status satisfying `predicate` and output matching `matcher`.

Example:

```cpp
EXPECT_DEATH(DoSomethingDangerous(), "Error occurred");
```

Use these to assert critical failures and exceptional termination paths.

---

## Matchers: Powering Flexible Checks

A **matcher** is an object that defines a condition to which a value is compared. Matchers make tests more expressive and maintainable by providing:

- **Built-in matchers:** For common checks like equality, inequality, string content, range, container contents, etc.
- **Composite matchers:** Combine multiple matchers logically (`AllOf()`, `AnyOf()`, `Not()`).
- **Custom matchers:** Easily create your own matcher classes or use macros for rapid matcher creation.

Matchers are extensively used with `EXPECT_THAT` and `EXPECT_CALL` (for mocks) to specify flexible argument validation.

### Using Matchers in Assertions

Match a value against a matcher using:

```cpp
EXPECT_THAT(actual, matcher);
ASSERT_THAT(actual, matcher);
```

If a matcher fails, GoogleTest provides messages like:

```
Value of: actual
  Actual: 9
Expected: is divisible by 7
```

### Built-in Matchers

GoogleMock provides a rich set of matchers, including:

- Value comparisons: `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- Wildcards: `_` (matches anything)
- String matchers: `StartsWith()`, `EndsWith()`, `HasSubstr()`, `StrEq()`, etc.
- Pointer matchers: `IsNull()`, `NotNull()`, `Pointee(matcher)`
- Container matchers: `ElementsAre()`, `UnorderedElementsAre()`, `Pair()`, etc.
- Logical combinators: `AllOf()`, `AnyOf()`, `Not()`

---

### Writing Custom Matchers

You can define new matchers with:

- `MATCHER(name, description) { /* return boolean */ }` — for simple monomorphic matchers.
- `MATCHER_P(name, param, description) { ... }` — for parameterized matchers.
- Full matcher classes implementing the matcher interface for advanced usage.

Custom matchers can provide detailed explanations on failure to improve diagnostics.

### Tips for Using Matchers

- Use matchers to avoid brittle tests by specifying only necessary constraints.
- Combine matchers logically for complex argument validation.
- Use `SafeMatcherCast<T>()` to cast matchers when dealing with types that require conversions.
- Use `.With()` clause in `EXPECT_CALL` to apply matchers on whole argument tuples.

---

## How Assertions and Matchers Fit into Your Testing Workflow

Imagine you want to verify that a method on a mock object receives specific arguments only when certain conditions occur. You can define expectations with `EXPECT_CALL`, use matchers to specify argument constraints, and assert outcomes with googletest assertions like `EXPECT_EQ` or `EXPECT_THAT`.

For example:

```cpp
using ::testing::Return;
using ::testing::_;

MockFoo mock;

ON_CALL(mock, Calculate(_))
    .WillByDefault(Return(42));

EXPECT_CALL(mock, Calculate(_))
    .Times(2);

EXPECT_EQ(mock.Calculate(5), 42);
EXPECT_EQ(mock.Calculate(10), 42);
```

This verifies interaction and return behaviors while flexible input validation is enabled by matchers.

---

## Practical Tips & Best Practices

- Use `EXPECT_THAT` with matchers for more readable and maintainable tests than raw assertions.
- Avoid over-specifying expectations; tests should verify contracts, not implementations.
- Use `ON_CALL` to specify default behaviors without imposing strict expectations.
- In mocks, define expectations before the code exercising them to avoid undefined behaviors.
- Use composite and custom matchers to reduce duplication and clarify intent.
- Leverage built-in container matchers to express complex data structure verifications easily.
- Control verbosity with `--gmock_verbose` to diagnose failing mock expectations effectively.

---

## Troubleshooting Common Assertion and Matcher Issues

- If an expectation fails unexpectedly, run tests with `--gmock_verbose=info` to observe detailed mock call traces.
- Ensure that your matcher definitions are pure functions with no side effects.
- When mocking overloaded methods, use `Const()` or explicit matcher casts to avoid ambiguity.
- Beware of the default actions in mocks, especially with move-only types; specify actions explicitly if needed.

---

## Related Documentation

- [Using GoogleMock’s EXPECT_CALL and ON_CALL](https://google.github.io/googletest/gmock_for_dummies.html#setting-expectations)
- [Matchers Reference](../api_reference/matchers_assertions/builtin_matchers)
- [Assertion Macros Reference](../api_reference/matchers_assertions/assertion_macros)
- [Writing New Matchers Quickly](../googletest-guides/advanced-testing-patterns/custom-assertions)
- [Mocking Reference](../api_reference/mocking_core/expect_call_on_call)


---

## Summary

Assertions provide a rich and expressive framework to verify that tests behave as expected. The use of matchers extends assertions beyond simple boolean checks, enabling precise and human-readable tests of complex data and interactions. Understanding how to apply these tools effectively lets you create maintainable, robust tests that communicate intent clearly and catch regressions early.

---

## Example Code Snippet

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;
using ::testing::_;

class MockCalculator {
public:
  MOCK_METHOD(int, Calculate, (int operand), ());
};

TEST(CalculatorTest, ReturnsExpectedValues) {
  MockCalculator mock_calc;

  // Default behavior
  ON_CALL(mock_calc, Calculate(_)).WillByDefault(Return(42));

  // Expect exactly two calls
  EXPECT_CALL(mock_calc, Calculate(_)).Times(2);

  EXPECT_EQ(mock_calc.Calculate(5), 42);
  EXPECT_EQ(mock_calc.Calculate(10), 42);
}
```

This test sets a default return value and expects two calls, regardless of argument, demonstrating assertion and matcher usage together.
