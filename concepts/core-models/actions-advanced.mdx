---
title: "Actions and Return Value Model"
description: "Covers the concept of actions in GoogleMock: how mocked functions are configured to return values, throw exceptions, or invoke custom code. Includes discussion of standard actions, composing actions, and advanced customization patterns."
---

# Actions and Return Value Model

Actions in GoogleMock define the behavior of mocked functions when they are called during tests. They specify how a mock method responds—whether to return a value, invoke custom code, throw exceptions, or perform other side effects. This page explores the concept of actions, covering the built-in standard actions, how to compose multiple actions, and advanced patterns for customizing mock behavior.

---

## 1. Understanding Actions

In GoogleMock, a mock method only *declares* its interface and records expectations. To specify *what happens* when this mock method is invoked, we use **actions**.

**Key Points:**

- Actions define the behavior that a mock function performs when called.
- If no user action is specified, GoogleMock provides a built-in default action based on the return type.
- Actions can be simple (like returning a fixed value) or complex (invoking custom code, changing arguments, throwing exceptions).

This separation supports clear test specifications: expectations describe *which* calls to expect, and actions describe *how* the mock should behave for those calls.

## 2. Built-In Standard Actions

GoogleMock ships with many common actions ready to use from the `testing` namespace. Here are categories of standard actions and their descriptions.

### Returning Values

| Action                             | Description                                                                                                 |
|----------------------------------|-------------------------------------------------------------------------------------------------------------|
| `Return()`                       | Return from a `void` mock function.                                                                         |
| `Return(value)`                  | Return a fixed `value`. The value’s conversion to the mock’s return type occurs when the expectation is set, not at runtime. |
| `ReturnArg<N>()`                 | Return the `N`th argument (zero-based) passed to the mock method.                                            |
| `ReturnNew<T>(a1, ..., a_k)`    | Return a new dynamically allocated object of type `T` constructed with given arguments. A different object is created each call. |
| `ReturnNull()`                  | Return a null pointer.                                                                                       |
| `ReturnPointee(ptr)`            | Return the value pointed to by the pointer `ptr` at call time (useful for returning live values).             |
| `ReturnRef(variable)`           | Return a reference to a variable. Useful for mock methods returning references.                              |
| `ReturnRefOfCopy(value)`        | Return a reference to a copy of `value`. The copy lives as long as the action.                              |
| `ReturnRoundRobin({a1, ..., a_k})` | Cyclically return values from the list, restarting after the last.                                         |

### Side Effects and Argument Manipulation

| Action                          | Description                                                        |
|--------------------------------|--------------------------------------------------------------------|
| `Assign(&variable, value)`      | Assign `value` to `variable` when the mock method is called.       |
| `DeleteArg<N>()`                | Delete the pointer passed as argument `N`.                         |
| `SaveArg<N>(pointer)`           | Copy the `N`-th argument to `*pointer`.                            |
| `SaveArgByMove<N>(pointer)`     | Move the `N`-th argument into `*pointer`.                          |
| `SaveArgPointee<N>(pointer)`    | Copy the value that the `N`th pointer argument points to, into `*pointer`. |
| `SetArgReferee<N>(value)`       | Assign `value` to the reference passed as the `N`th argument.     |
| `SetArgPointee<N>(value)`       | Assign `value` to the pointed-to object passed as argument `N`.    |
| `SetArrayArgument<N>(first, last)` | Copy a range of values into a pointer or iterator passed as argument `N`. |
| `SetErrnoAndReturn(error, value)` | Set `errno` to `error` and return `value`.                      |
| `Throw(exception)`              | Throw the given exception object (requires compiled with exception support). |

### Using Functions, Functors, or Lambdas as Actions

| Action                        | Description                                                                                     |
|------------------------------|-------------------------------------------------------------------------------------------------|
| `f`                          | Invoke callable `f` with the mock function’s arguments.                                        |
| `Invoke(f)`                  | Invoke global/static function or functor `f`.                                                  |
| `Invoke(object_pointer, &class::method)` | Invoke method on the given object with mock arguments.                                |
| `InvokeWithoutArgs(f)`       | Invoke callable that takes no arguments, ignoring mock method arguments.                       |
| `InvokeArgument<N>(args...)` | Invoke `N`th argument (which must be callable), with specified arguments.                     |

The invoked function’s return value is used as the mock function's return value, if applicable.

**Important:** To pass arguments by reference to invoked callables (e.g. in `InvokeArgument`), wrap them with `std::ref()`.

### Default Action

| Action        | Description                                          |
|---------------|------------------------------------------------------|
| `DoDefault()` | Perform the default action specified by `ON_CALL()` or the built-in default action. Can only be used in `EXPECT_CALL`. |

> **Note:** `DoDefault()` cannot be used inside composite actions like `DoAll()`.

### Composite Actions

| Action                     | Description                                                                                                            |
|----------------------------|------------------------------------------------------------------------------------------------------------------------|
| `DoAll(a1, a2, ..., a_n)`  | Execute all actions `a1` to `a_n` in sequence, returning the result of the last action. The first `n-1` must return void. |
| `IgnoreResult(a)`          | Perform action `a` but discard its return value (useful when return value is ignored).                                  |
| `WithArg<N>(a)`            | Pass the `N`-th argument of the mock function to action `a`.                                                          |
| `WithArgs<N1, N2, ..., Nk>(a)` | Pass the selected `k` arguments (by indices) of the mock function to action `a`.                                |
| `WithoutArgs(a)`           | Perform action `a` with no arguments, ignoring the mock's arguments.                                                   |

## 3. Practical Usage Examples

### Returning a Fixed Value

```cpp
using ::testing::Return;

EXPECT_CALL(mock_obj, GetInt())
    .WillOnce(Return(42));
```

Returns `42` the first time `GetInt()` is called.

### Returning Different Values on Calls

```cpp
EXPECT_CALL(mock_obj, GetInt())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

Returns 1 on first call, 2 on second, and 3 thereafter.

### Returning Reference or Live Value

```cpp
int value = 10;
EXPECT_CALL(mock_obj, GetValue())
    .WillRepeatedly(ReturnPointee(&value));
```

Returns current value pointed to by `&value` on each call.

### Performing Multiple Effects

```cpp
int save;
EXPECT_CALL(mock_obj, Process()).WillOnce(
    DoAll(SetArgPointee<0>(5), Return(true)));
```

Assigns 5 to first output argument and returns `true`.

### Invoking a Callable

```cpp
bool Helper(int x) { return x > 0; }
EXPECT_CALL(mock_obj, Check(_)).WillOnce(Invoke(Helper));
```

Calls `Helper` with the mock method arguments.

### Using `InvokeArgument` to Call Callback Argument

```cpp
EXPECT_CALL(mock_obj, RunCallback(_))
    .WillOnce(InvokeArgument<0>(5));  // Invokes 0th argument as callback with 5
```

### Ignoring an Action’s Return Value

```cpp
EXPECT_CALL(mock_obj, VoidMethod())
    .WillOnce(IgnoreResult(Return(42)));  // Ignores return value, treats as void
```

## 4. Advanced Customization

### Writing New Actions with Lambdas or Functors

Actions can be any callable object with a compatible signature:

```cpp
EXPECT_CALL(mock_obj, Func(_))
    .WillOnce([](int x) { return x * 2; });
```

Move-only callables or those with `&&`-qualified call operator are allowed with `WillOnce()`.

### Defining Parameterized Actions

You can define reusable parameterized actions with `ACTION_P` macros or implement `ActionInterface` directly.

### Composing Actions

`DoAll()` allows you to perform multiple sub-actions in one mock call, helpful for complex side-effects.

### Passing Subset or Reordered Arguments

`WithArgs` enables passing selected or reordered arguments to an inner action.

### Using `InvokeWithoutArgs` and `WithoutArgs` for Ignoring Mock Arguments

When the invoked action requires no arguments, use these helpers to adapt.

### Setting Return Values for Move-Only Types

Use lambdas or `Return(ByMove(...))` to safely return move-only types, like `std::unique_ptr`.

## 5. Best Practices and Tips

- Prefer `ON_CALL` for specifying default behavior without expectations, and `EXPECT_CALL` only when verifying calls.
- Be mindful of call order and cardinality when combining multiple `WillOnce` and `WillRepeatedly`.
- Use `RetiresOnSaturation()` to deactivate expectations after their replay count is reached.
- Be explicit with matchers to avoid ambiguity, especially for overloaded methods.
- Use nice mocks (`NiceMock<T>`) to suppress warnings on uninteresting calls.
- Set verbosity levels with `--gmock_verbose` for detailed mock call traces.
- Prefer clear, maintainable actions rather than overly complex ones to keep tests readable.

## 6. Troubleshooting

- If your mock method's return values behave unexpectedly, ensure you're not returning a move-only value repeatedly with `Return()` — use a lambda or `Return(ByMove())` instead.
- When an action does not work as expected, try running the test with `--gmock_verbose=info` to see actions invocation tracing.
- Beware of side effects in actions that are evaluated once at expectation setup time (e.g., `Return(n++)` will not increment on each call).
- If passing arguments by reference to `InvokeArgument` or `Invoke` fails, wrap references with `std::ref()`.

---

## Additional Resources

- [gMock Cookbook - Actions Chapter](https://google.github.io/googletest/gmock_cook_book.html#actions)
- [GoogleMock Actions Reference](../docs/reference/actions.md)
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md)
- [gMock for Dummies](../docs/gmock_for_dummies.md)
- [MOCK_METHOD Macro Reference](../api_reference/mocking_core/mock_method_macros.md)


---

This documentation equips you to harness GoogleMock actions effectively, enabling precise control over mock behaviors to design robust, maintainable tests.