---
title: "Matchers and Expressive Assertions"
description: "Unpack the concept of matchers, which enable descriptive assertions for complex data types and collections. See how GoogleTest elevates test expressiveness through built-in and custom matchers, enhancing readability and maintainability of tests."
---

# Matchers and Expressive Assertions

GoogleTest transforms unit testing by introducing expressive matchers that enhance the clarity and precision of assertions. This page unpacks how matchers enable descriptive checks on complex data types, collections, and custom criteria, making tests not only robust but also easy to read and maintain.

---

## What Are Matchers?

Matchers are predicates used in assertions to specify expected properties of values or function arguments. Unlike traditional equality checks, matchers can express complex conditions such as ranges, containment, or pattern matching.

In GoogleTest and GoogleMock, matchers are central to asserting on arguments in mocks (`EXPECT_CALL`) and in value-based assertions (`EXPECT_THAT`). They enable you to verify not just exact values, but relationships and characteristics, adding deep semantic meaning to your tests.

### Why Use Matchers?

- **Descriptive Expectations:** Matchers provide contextual descriptions of what is expected, helping diagnose failures with detailed messages.
- **Versatility:** They work with built-in data types, STL containers, pointers, and user-defined types.
- **Composability:** Matchers can be combined logically to create rich and precise conditions.
- **Extensibility:** You can define custom matchers tailored to your domain.

<Tip>
Starting with matchers increases test expressiveness, reducing brittle equality comparisons and promoting clearer intent in your test code.
</Tip>

---

## Core Matcher Concepts

Matchers are function objects that:

- Test whether a value matches a condition (`MatchAndExplain`).
- Describe the condition they match (`DescribeTo`) and the negation (`DescribeNegationTo`).

The value type they work with is inferred automatically, allowing polymorphic matchers that adapt based on context.

### Using Matchers in Expectations

Typical usage involves specifying matchers for mock method arguments:

```cpp
using ::testing::_;  // Matches anything
using ::testing::Gt; // Greater than
using ::testing::StrEq; // String equality

EXPECT_CALL(mock_obj, ProcessData(Ge(10), StrEq("ok"), _));
```

Each argument can be matched independently or combined into a tuple matcher via `.With()` for multi-argument constraints.

### Common Built-in Matchers

- `_` — Matches any value.
- `Eq(val)` — Equal to `val`.
- `Ne(val)` — Not equal to `val`.
- `Lt(val)`, `Le(val)`, `Gt(val)`, `Ge(val)` — Compare relative to `val`.
- `Not(m)` — Negates matcher `m`.
- `AllOf(m1, m2, …)` — Matches if all sub-matchers match.
- `AnyOf(m1, m2, …)` — Matches if any sub-matcher matches.
- `IsNull()`, `NotNull()` — Pointer nullness.
- `Contains(m)` — Container contains element matching `m`.
- `ElementsAre(m1, m2, ...)` — Container elements exactly match sequence.
- `UnorderedElementsAre(m1, m2, ...)` — Container elements match the values in any order.
- `Pointee(m)` — Pointer points to a value matching `m`.
- String matchers like `StartsWith()`, `EndsWith()`, `HasSubstr()`.

See the [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) for the full list.

---

## Writing Assertions with Matchers

GoogleTest provides macros `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` to use matchers for assertions:

```cpp
EXPECT_THAT(actual_vector, ElementsAre(1, Gt(5), _));
EXPECT_THAT(str, StartsWith("Hello"));
EXPECT_THAT(value, AllOf(Ge(10), Le(20)));
```

Matchers produce failure messages that clearly indicate which part failed and why, with explanations of values involved.

### Examples

```cpp
using ::testing::ElementsAre;
using ::testing::UnorderedElementsAre;
using ::testing::Not;

std::vector<int> actual_vec = {2, 4, 6};
EXPECT_THAT(actual_vec, ElementsAre(2, 4, 6));  // Matches exact order.
EXPECT_THAT(actual_vec, UnorderedElementsAre(4, 6, 2));  // Matches any order.

EXPECT_THAT(actual_vec, Not(ElementsAre(1, 3, 5)));  // Check different sequence.
```

---

## Advanced Matcher Usage

### Combining Multiple Matchers

Matchers can be combined with logical combinators for intricate conditions:

```cpp
EXPECT_THAT(value, AllOf(Ge(1), Le(10), Not(Eq(5))));
```

This asserts that `value` is between 1 and 10 inclusive but not equal to 5.

### Tuple/Multiple Argument Matchers

You can match multiple arguments as a tuple using `.With()` or `Args<>`:

```cpp
EXPECT_CALL(mock, Func(_,_))
    .With(::testing::Lt());  // First arg < second arg

EXPECT_CALL(mock, Func(_, _))
    .With(Args<0,1>(AllOf(Ge(0), Le(10))));
```

### Matching Containers

- `Contains(m)` checks if container has at least one element matching `m`.
- `ElementsAre(...)` checks exact sequence.
- `UnorderedElementsAre(...)` checks elements ignoring order.
- `SizeIs(m)` matches containers with size matching `m`.

### Matching Members and Properties

You can match fields or properties of objects:

```cpp
EXPECT_THAT(obj, Field(&MyClass::value, Gt(10)));
EXPECT_THAT(obj, Property(&MyClass::GetName, StartsWith("Test")));
```

### Pointer Matchers

`Pointee(m)` matches pointers to values matching `m` and fails for `nullptr`:

```cpp
EXPECT_CALL(mock, Func(Pointee(42)));
```

### Matcher Variables and Sharing

Matchers are cheap to copy; define complex matchers once and reuse:

```cpp
auto positive = Gt(0);
EXPECT_CALL(mock, Func(positive));
EXPECT_THAT(value, positive);
```

---

## Writing Custom Matchers

GoogleTest allows you to write custom matchers easily using macros or classes:

### Using the `MATCHER` Macro

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}
```

Usage:

```cpp
EXPECT_THAT(value, IsDivisibleBy7());
```

You can add descriptive failure messages:

```cpp
MATCHER(IsDivisibleBy7, "is divisible by 7") {
  if (arg % 7 != 0) {
    *result_listener << "the remainder is " << (arg % 7);
    return false;
  }
  return true;
}
```

---

### Parameterized Matchers

```cpp
MATCHER_P(IsWithinRange, range, "") {
  return arg >= -range && arg <= range;
}
```

Use with parameter:

```cpp
EXPECT_THAT(value, IsWithinRange(10));
```

---

### Writing Matcher Classes

You can define a class with methods:

- `bool MatchAndExplain(const T& value, std::ostream* os) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

and then factory functions returning a `Matcher<T>`.

---

## Best Practices and Tips

- Use matchers to specify only what’s necessary, avoiding brittle over-specification.
- Use `_` for arguments you do not care about.
- Use `EXPECT_THAT` to add readability and maintain clear intent.
- Use `InSequence` and `After` clauses with `EXPECT_CALL` to test call order.
- Use `With()` clause to aggregate argument constraints when needed.
- Define custom matchers to encapsulate reusable conditions.
- Use `SafeMatcherCast<T>()` to help resolve type mismatches safely in complex scenarios.
- Suppress uninteresting call warnings with `NiceMock` or explicit `EXPECT_CALL(...).Times(AnyNumber())` if necessary.

<Tip>
Avoid mixing strict expectations with too many argument matchers — tests should be precise but flexible to avoid fragility during refactoring.
</Tip>

---

## Troubleshooting Matchers

- If an expectation doesn’t seem to match, use `--gmock_verbose=info` to see detailed matching logs.
- For overloads, help the compiler by disambiguating with `Const()` or explicit matcher casts.
- Ensure custom matchers are pure functions without side effects.
- When matching containers, be careful whether order matters (`ElementsAre`) or not (`UnorderedElementsAre`).

---

## Related Documentation

- [Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Using Matchers for Argument Verification](https://google.github.io/googletest/guides/mocking-best-practices/using-matchers.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)

---

## Summary

Matchers provide a powerful, flexible, and expressive mechanism to verify values and mock function arguments in GoogleTest. They enhance test clarity and diagnostics by allowing complex conditions beyond simple equality. Through built-in matchers and well-designed custom matchers, you can write maintainable tests that communicate intent clearly and adapt gracefully to changes.

---

## Appendix: Simple Matchers Example

```cpp
#include <gmock/gmock.h>
using ::testing::_;  // Matches anything
using ::testing::Eq; // Equal
using ::testing::Gt; // Greater than
using ::testing::StartsWith;

class MockFoo {
 public:
  MOCK_METHOD(void, Bar, (int, const std::string&), ());
};

TEST(FooTest, MatcherExample) {
  MockFoo foo;

  // Expect first arg > 10, second arg starts with "test"
  EXPECT_CALL(foo, Bar(Gt(10), StartsWith("test")));

  foo.Bar(15, "test string");  // Matches
  // foo.Bar(5, "test string");  // Fails
  // foo.Bar(20, "other string");  // Fails
}
```

---