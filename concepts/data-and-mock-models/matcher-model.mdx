---
title: "Matchers: Flexible Argument and Value Matching"
description: "Discover the matcher model used to flexibly compare arguments and values in both GoogleTest assertions and GoogleMock expectations. This page explains matcher composition, built-in vs. custom matchers, and how matchers decouple logic from test implementation."
---

# Matchers: Flexible Argument and Value Matching

Discover how GoogleTest employs matchers to flexibly compare arguments and values in assertions and mock expectations. This page unpacks the matcher model, illustrating how built-in and custom matchers work, how matchers can be composed for complex conditions, and how their use decouples test verification from implementation details.

---

## Introduction to Matchers

Matchers provide a powerful mechanism in GoogleTest and GoogleMock to specify flexible and readable expectations on function and method arguments. Instead of checking for exact values, matchers allow expressing predicates on argument values to validate a broad range of input scenarios efficiently and maintainably.

### Why Use Matchers?
- **Flexibility:** Specify conditions such as ranges, subsets, properties, or container contents instead of strict equality.
- **Clear Intent:** Tests clearly express the intent via human-readable predicates rather than verbose comparison code.
- **Reusability:** Compose and share complex matchers, enhancing test readability.
- **Decoupling:** Reduce coupling between test implementation and the exact values or structures of arguments.

For example, instead of expecting an argument equals exactly 42, a matcher can verify it is greater than 40 — capturing the intent without being brittle.

```cpp
EXPECT_CALL(mock_object, Process(Ge(40)))  // Argument must be >= 40
    .WillOnce(Return(true));
```

---

## Core Concepts and Matcher Types

### What Are Matchers?
Matchers are predicates or condition objects that encapsulate logic to determine if a value meets a criterion. They integrate with GoogleTest’s `EXPECT_THAT` and GoogleMock’s `EXPECT_CALL` to allow expressive verification of test conditions and mock method arguments.

### Built-in vs. Custom Matchers
- **Built-in Matchers:** GoogleTest provides an extensive library of matchers for common scenarios, including equality, relational operators, string matching, container membership, pointer checks, and tuple or field inspection.
- **Custom Matchers:** Users can define custom matchers easily using macros (`MATCHER`, `MATCHER_P`, etc.) or full class implementations to capture complex or domain-specific logic.

### Categories of Built-in Matchers
- **Wildcard Matcher:** `_` matches any value.
- **Equality Matchers:** `Eq()`, `Ne()`, and their typed variants.
- **Relational Matchers:** `Lt()`, `Le()`, `Gt()`, `Ge()` to specify less-than, greater-than, and inclusive variants.
- **Boolean and Predicate Matchers:** `Truly()` wraps unary predicates.
- **Containers and Sequences:** `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, supporting element-wise and set membership testing.
- **Pointer Matchers:** `IsNull()`, `NotNull()`, `Pointee()` for pointer arguments.
- **Member and Property Matchers:** `Field()`, `Property()` to inspect particular fields or return values from objects.
- **String Matchers:** `StrEq()`, `HasSubstr()`, `StartsWith()`, `EndsWith()`, and regex-based matchers.

---

## Using Matchers in Practice

### Specifying Argument Expectations
In GoogleMock, matchers are supplied as arguments to `EXPECT_CALL` to precisely express which calls are expected and under what conditions.

Example:
```cpp
EXPECT_CALL(mock_turtle, GoTo(50, _));  // First arg must be 50; second can be anything.
```

Omitting the argument list matches calls with any arguments but only applies when the method is not overloaded.

```cpp
EXPECT_CALL(mock_turtle, Forward);  // Matches any argument.
```

### Matching Multiple Arguments as a Tuple
Matchers can also operate on multiple arguments as a tuple for complex relation checks.

```cpp
EXPECT_CALL(mock_obj, SetPosition(_, _))
    .With(Lt());  // The first arg < second arg.
```

### Combining Matchers
Matchers can be combined using `AllOf()`, `AnyOf()`, and `Not()` to create complex conditions:

```cpp
EXPECT_CALL(mock_obj, Process(AllOf(Ge(0), Ne(10))));
```

Indicates the argument must be greater or equal to 0 and not equal to 10.

### Wildcard (`_`) Usage
Use `_` when you don’t care about a specific argument’s value.

```cpp
EXPECT_CALL(mock_obj, DoSomething(_, NotNull()));  // We care only second arg.
```

### Partial Matching with Fields and Properties
Matchers like `Field()` and `Property()` allow validating parts of complex objects without needing full object equality.

```cpp
EXPECT_CALL(mock_obj, Process(Field(&MyObj::id, Eq(42))));
```

Validates that the argument's `id` field is 42, ignoring other fields.

### Pointer Argument Matching
Matchers like `Pointee()` allow verifying the value pointed to by a pointer argument.

```cpp
EXPECT_CALL(mock_obj, Process(Pointee(Gt(0))));  // Pointer pointing to value > 0.
```

---

## Writing and Using Custom Matchers

### Defining Custom Matchers
You can define new custom matchers using the `MATCHER` macro family which generates the necessary boilerplate.

Example:
```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}
// Usage:
EXPECT_CALL(mock_obj, Foo(IsDivisibleBy7()));
```

You can add detailed failure messages, parameterize matchers using `MATCHER_P` and higher arity `MATCHER_Pn`.

### Advanced Matcher Implementation
For fine control, define matcher classes implementing `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()`.

---

## Composing and Sharing Matchers

Matchers are lightweight, copyable objects internally referencing shared implementations. This allows you to build and share complex matchers efficiently:

```cpp
Matcher<int> positive_even = AllOf(Gt(0), Truly([](int x){ return x % 2 == 0; }));
EXPECT_CALL(mock, Number(positive_even));
```

Reusing named matchers promotes clarity and maintainability.

---

## Common Pitfalls and Best Practices

- Avoid over-specifying matchers; test only the expected behaviors relevant to the test’s intent.
- Use `_` wildcard where argument values are unimportant or unpredictable.
- For overloaded methods, help disambiguate overloads using typed matchers or explicit casting (`MatcherCast`).
- Use `.RetiresOnSaturation()` for expectations that should become inactive after use, especially important with sequences or multiple `WillOnce` clauses.
- Use `ON_CALL` to set default behaviors without imposing call count expectations.
- Always set expectations before exercising the code that triggers mock calls.

---

## Troubleshooting Matcher Issues

- **Unmatched Arguments:** Verify argument types and use appropriate matchers; mismatched types or reference/copy issues commonly cause failures.
- **Overloaded Methods:** Use `Const()` wrapper or `TypedEq<T>()` to pick the correct overload matcher.
- **Uninteresting Call Warnings:** Use `NiceMock` or add catch-all expectations with `Times(AnyNumber())` to suppress warnings for uninteresting calls.
- **Matchers with Non-Copyable Arguments:** Use `Truly()` with predicates or `std::ref()` to avoid copying.

---

## Summary

Matchers form the foundation of flexible and expressive test validations in GoogleTest and GoogleMock. They enable users to create robust assertions and mock expectations that capture complex argument conditions with clarity and precision. Understanding and leveraging built-in matchers, composing custom ones, and adhering to best practices will maximize the effectiveness of your testing.

---

## See Also

- [GoogleMock Cookbook: Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers)
- [Matchers Reference](../api-reference/matchers-actions-api/argument-matchers.md)
- [Using Matchers for Flexible Verification](../guides/core-testing-workflows/using-matchers.md)
- [GoogleMock for Dummies](../docs/gmock_for_dummies.md)
- [EXPECT_CALL](../docs/reference/mocking.md#EXPECT_CALL)
- [Matchers in Assertions (`EXPECT_THAT`)](../docs/reference/assertions.md#EXPECT_THAT)

