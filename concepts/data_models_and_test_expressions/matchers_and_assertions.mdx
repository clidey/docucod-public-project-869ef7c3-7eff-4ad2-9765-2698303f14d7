---
title: "Matchers and Assertions"
description: "Dive into matcher composition, value comparison, and custom assertions. Learn how the assertion system articulates expectations on data and how it is extensible for complex domain needs."
---

# Matchers and Assertions

GoogleTest provides a powerful and extensible system for articulating expectations on test data through *matchers* and *assertions*. This page details how to compose matchers to validate values, compare data, and create custom assertions tailored to your domain-specific testing needs.

---

## Understanding Matchers

Matchers act as predicates that evaluate whether a given value meets certain criteria. They are used primarily in `EXPECT_THAT`, `EXPECT_CALL`, and other assertion macros to specify conditions that function arguments or return values must satisfy.

### Basic Matcher Usage

You can use simple matchers like `_` for any value or `Eq(value)` for exact equality. For example:

```cpp
EXPECT_CALL(mock, Process(Eq(10)));
EXPECT_THAT(actual_value, Eq(expected_value));
```

### Composing Matchers

Matchers can be combined to express complex conditions:

- `AllOf(m1, m2, ...)` - matches if **all** sub-matchers match
- `AnyOf(m1, m2, ...)` - matches if **any** sub-matcher matches
- `Not(m)` - matches if the sub-matcher does **not** match

Example:

```cpp
EXPECT_THAT(value, AllOf(Gt(5), Lt(10)));  // Value between 5 and 10
EXPECT_THAT(value, Not(Eq(0)));           // Value not equal to zero
```


### Matching Arguments in Mocks

When setting expectations on mock methods, specify matchers to constrain the allowed argument values:

```cpp
EXPECT_CALL(mock, SetPosition(Ge(0), Lt(kMaxPosition)));
EXPECT_CALL(mock, Process(_));  // Accepts any argument
```


## Using Assertions with Matchers

GoogleTest extends its assertion macros to support matchers via:

- `EXPECT_THAT(value, matcher)`
- `ASSERT_THAT(value, matcher)`

These macros validate that `value` matches the provided matcher, printing detailed error messages including the matched value and the matcher description on failure.

### Example Assertions

```cpp
EXPECT_THAT(username, StartsWith("user_"));
ASSERT_THAT(result, AnyOf(Eq(0), Eq(1), Eq(2)));
```


## Built-in Matcher Types

GoogleTest supplies numerous built-in matchers:

### Wildcard Matcher

- `_` matches any value.

### Equality and Comparison Matchers

- `Eq(expected)` — equality
- `Ne(expected)` — inequality
- `Lt(expected)`, `Le(expected)`, `Gt(expected)`, `Ge(expected)` — comparisons

### String Matchers

- `StrEq(expected)` — string equality
- `StrCaseEq(expected)` — case-insensitive string equality
- `StartsWith(prefix)` — string starts with
- `EndsWith(suffix)` — string ends with
- `HasSubstr(substr)` — substring contained

### Pointer Matchers

- `IsNull()` — pointer is `nullptr`
- `NotNull()` — pointer is not `nullptr`
- `Pointee(matcher)` — the value pointed to matches `matcher`

### Container Matchers

- `ElementsAre(m1, m2, ...)` — container elements match expected matchers in order
- `UnorderedElementsAre(m1, m2, ...)` — container elements match expected matchers in any order
- `Contains(matcher)` — container contains at least one element matching matcher
- `Each(matcher)` — every element matches matcher

### Tuple and Pair Matchers

- `Pair(matcher_first, matcher_second)` — matches a `std::pair` whose fields match the respective matchers
- `Field(&Class::field, matcher)` — matches a class field
- `Property(&Class::getter, matcher)` — matches a class property accessor

### Predicate and Custom Matchers

- `Truly(predicate_function)` — wraps any unary predicate
- `ResultOf(callable, matcher)` — the callable applied to the value matches


## Matcher Composition

Matchers can be composed and nested to articulate detailed expectations:

```cpp
EXPECT_THAT(container,
            AllOf(
              Each(Gt(0)),
              Contains(Eq(42)),
              SizeIs(Ge(5))));
```

This example asserts that `container` meets all of these:

- Every element is greater than 0
- At least one element equals 42
- Container size is at least 5


## Defining Custom Matchers

Beyond built-in matchers, GoogleTest allows you to define your own:

### Using the `MATCHER` Macro

The simplest way is the `MATCHER` macro, which takes a matcher name and a body that returns a `bool`:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}
```

Use it naturally:

```cpp
EXPECT_THAT(value, IsDivisibleBy7());
```

Add a custom failure message by streaming to `*result_listener`:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "the remainder is " << (arg % 7);
  return false;
}
```


### Parameterized Matchers

Define matchers with parameters using `MATCHER_P`, `MATCHER_P2`, etc.:

```cpp
MATCHER_P(InRange, n, "") {
  return arg >= 0 && arg <= n;
}
```


### Advanced Matchers

For complex needs, implement a matcher class with the required interface and provide a factory function. This allows detailed control over matching behavior and messaging.


## Using Matchers in Expectations

Matchers are used extensively in the mock framework to specify argument constraints:

```cpp
EXPECT_CALL(mock, Process(Ge(0), Lt(100)));
```

The matcher system supports static typing, safe casting between matchers, and overload disambiguation tools such as `SafeMatcherCast<T>` to assist when argument types differ.


## Best Practices and Tips

- Use simple matchers like `_` when you don't care about specific argument values.
- Write custom matchers to encapsulate domain-specific logic, improving test readability.
- Use composition matchers (`AllOf`, `AnyOf`) to combine multiple conditions succinctly.
- Remember that matchers must be pure functions without side effects.
- Avoid over-specifying expectations to keep tests maintainable and robust to implementation changes.


## Troubleshooting Common Matcher Issues

- If your matchers behave unexpectedly, run tests with increased verbosity (`--gmock_verbose=info`) to inspect matching behavior.
- Pay attention to the order of `EXPECT_CALL` statements, as the last matching expectation takes precedence.
- Use `RetiresOnSaturation()` when expecting ordered calls to avoid sticky expectations causing upper-bound violations.


## Summary

Matchers and assertions form the expressive foundation of GoogleTest's verification capabilities. By mastering them, you can write precise, readable, and maintainable tests that clearly specify desired behaviors and invariants.


---

## Additional Resources

- [GoogleTest Assertions Reference](../api-reference/core-testing-apis/assertions-api)
- [gMock Cookbook - Defining Custom Matchers](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers)
- [Matchers Reference](../api-reference/matchers-and-advanced-apis/built-in-matchers-reference)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Understanding Test Structure and Discovery](../../guides/getting-started/test-structure-and-discovery.mdx)


<Accordion title="Example: Writing a Custom Parameterized Matcher">
```cpp
MATCHER_P(IsInOpenInterval, bounds, "") {
  return arg > bounds.first && arg < bounds.second;
}

// Usage
EXPECT_THAT(value, IsInOpenInterval(std::make_pair(0, 100)));
```
</Accordion>

<Accordion title="Example: Combining Multiple Matchers">
```cpp
EXPECT_THAT(value, AllOf(Ge(0), Le(42), Not(Eq(13))));
```
</Accordion>

<Accordion title="Tips for Using Matchers in EXPECT_CALL">
- Use `_` when argument value does not matter.
- Use specific matchers to avoid brittle tests.
- When mocking overloaded functions, help compiler by specifying argument types or use `SafeMatcherCast`.
- Prefer `ON_CALL` for default behaviors and reserve `EXPECT_CALL` for actual expectations.
</Accordion>

<Callout>
**Note:** Matchers must be pure functions with no side effects. Avoid calling mock methods inside matcher predicates.
</Callout>

<Callout>
**Best Practice:** Use `RetiresOnSaturation()` in expectations under sequences or when multiple calls with different return behaviors are expected to prevent unexpected failures.
</Callout>
