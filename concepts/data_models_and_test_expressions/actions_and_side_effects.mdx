---
title: "Actions and Side Effects"
description: "Explore how GoogleMock models function return values, exceptions, and argument manipulation through actions. Understand action templates for advanced side-effect modeling and behavioral verification."
---

# Actions and Side Effects

GoogleMock allows you to specify what a mock function does when it is invoked. Actions describe how to return values, manipulate arguments, throw exceptions, invoke callbacks, and more. This page guides you through the key concepts of actions and side effects in GoogleMock, including built-in actions, advanced action templates, and ways to model complex behavior.

---

## Understanding Actions in GoogleMock

An *action* defines the behavior of a mock function when it is called during a test. Instead of simply returning default values, actions let you specify precisely how the mocked function reacts, including:

- Returning fixed or computed values
- Throwing exceptions
- Modifying output arguments
- Calling back to supplied functions or functors
- Combining multiple effects

GoogleMock actions focus on what the mock should do from the user's perspective, enabling tailored test behaviors that closely mimic production logic or specific edge cases.

---

## Common Built-in Actions

GoogleMock ships with a comprehensive set of built-in actions that cover most common scenarios.

### Returning Values

| Action Name                  | Description |
|------------------------------|-------------|
| `Return()`                   | Returns from a `void` function.
| `Return(value)`              | Returns a copy of `value`. The conversion to the mock’s return type occurs once when the expectation is set, not when executed.
| `ReturnRef(variable)`         | Returns a reference to a variable, useful for functions returning references.
| `ReturnPointee(pointer)`      | Returns the value pointed to by `pointer` at action execution time.
| `ReturnRefOfCopy(value)`      | Returns a reference to a copy of `value` that lives as long as the action.
| `ReturnRoundRobin({list})`    | Cycles through provided values, returning the next on every call.
| `ReturnNull()`                | Returns a null pointer, compatible with raw and smart pointers.
| `ReturnNew<T>(args...)`       | Creates and returns a new object of type `T` on every call.
| `Return(ByMove(value))`       | Returns a move-only value; usable with `WillOnce()`.

### Example: Returning a Value

```cpp
EXPECT_CALL(mock, Foo())
    .WillOnce(Return(42));

int result = mock.Foo();  // Returns 42
```

### Side Effects on Arguments

| Action Name                  | Description |
|------------------------------|-------------|
| `SetArgPointee<N>(value)`    | Assigns `value` to the object pointed to by the N-th argument (0-based).
| `SetArgumentPointee<N>(value)` | Alias for `SetArgPointee<N>(value)`. Deprecated.
| `SetArrayArgument<N>(first, last)` | Copies elements from `[first, last)` to the array pointed to by the N-th argument.
| `Assign(&variable, value)`   | Assigns `value` to a variable.
| `SaveArg<N>(pointer)`        | Saves the N-th argument to the variable pointed to by `pointer` (copy).
| `SaveArgByMove<N>(pointer)`  | Saves the N-th argument to the variable pointed to by `pointer` (move).
| `SetErrnoAndReturn(error, value)` | Sets `errno` and returns `value`.
| `DeleteArg<N>()`             | Deletes the pointer that is the N-th argument.

### Example: Modifying an Output Argument

```cpp
EXPECT_CALL(mock, Compute(_, _))
    .WillOnce(SetArgPointee<1>(100));

int output = 0;
mock.Compute(50, &output);
EXPECT_EQ(output, 100);
```

### Combining Multiple Actions

You can combine multiple actions into a single sequence using `DoAll()`. Only the result of the final action is returned, while others typically perform side effects.

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoAll(SetArgPointee<0>(99),
                    Return(true)));
```

---

## Using Callables and Invoking Arguments

GoogleMock supports using user-defined functions, functors, lambdas, and even methods as actions, giving full control over mock behavior.

- `Invoke(function)` calls the given function/functor with the mock function's arguments.
- `InvokeWithoutArgs(f)` invokes a callable that takes no arguments, ignoring the mock function's arguments.
- `Invoke(object_ptr, &class::method)` calls a method on an object.
- `InvokeArgument<N>(args...)` calls the N-th (0-based) argument of the mock function (which must be callable), passing pre-specified arguments.

> **Passing arguments by reference**: When using `InvokeArgument`, wrap references in `std::ref()` to ensure the callable receives references correctly.

### Example: Invoking a Callback Argument

```cpp
using ::testing::InvokeArgument;
EXPECT_CALL(mock, RegisterCallback(_))
    .WillOnce(InvokeArgument<0>(true));  // Calls the callback with `true`
```

---

## Advanced: Parameterized and Template Actions

To go beyond simple action definitions, GoogleMock provides `ACTION_TEMPLATE` macros, enabling creation of template-based actions with explicit template parameters and value parameters. This enables customizing mock behavior depending on argument indices, types, or captured values.

### Example: Duplicating an Argument

```cpp
ACTION_TEMPLATE(DuplicateArg,
                HAS_2_TEMPLATE_PARAMS(int, k, typename, T),
                AND_1_VALUE_PARAMS(output)) {
  *output = T(::std::get<k>(args));
}

int n;
EXPECT_CALL(mock, Foo(_, _))
    .WillOnce(DuplicateArg<1, unsigned>(&n));
```

The above action copies the mock call's 1st argument as an `unsigned` into `n`.

---

## Ignoring Action Results

`IgnoreResult(action)` allows ignoring the return value of an action, useful when the mock function has a `void` return type but the action returns a value.

```cpp
EXPECT_CALL(mock, Bar())
    .WillOnce(IgnoreResult(Return(42)));
```

---

## Default Action

`DoDefault()` performs the mock's default action, which may be set using `ON_CALL()` or is the built-in default (e.g., default value for return type). Note that `DoDefault()` cannot be used within composite actions like `DoAll()`.

---

## Best Practices and Tips

- Use `SetArgPointee` and `SetArrayArgument` to simulate functions modifying output parameters.
- Combine side effects with return values using `DoAll()`, ensuring the last action returns the expected type.
- Use `Invoke` and `InvokeArgument` to delegate behavior to real functions, methods, or callbacks.
- For move-only return types (e.g., `std::unique_ptr`), use `Return(ByMove(std::move(value)))` with `WillOnce()`.
- Avoid sharing actions with internal state unless intentional, to prevent unexpected test behaviors.
- Employ `ACTION_TEMPLATE` to create reusable and flexible parameterized actions.

---

## Troubleshooting Common Issues

- **Wrong argument reference semantics in `InvokeArgument`**: Always wrap references with `std::ref()` to correctly pass them.
- **`DoDefault()` misusage**: Do not use `DoDefault()` inside `DoAll()` or composite actions; it will cause runtime errors.
- **SetArgPointee value lifetime**: Values passed to `SetArgPointee` must remain valid as the action makes copies; use copyable types.
- **Move-only types misuse**: Ensure `Return(ByMove(...))` is used with `WillOnce()`, as repeated usage will fail.

---

## Summary

GoogleMock's action framework offers comprehensive control to specify what a mock function does when invoked — from returning fixed or dynamic values, performing side effects on arguments, invoking callbacks, or combining multiple behaviors. Through flexible built-in actions, user-defined callables, and advanced templated actions, you can model complex interactions and side effects cleanly and effectively.

For practical use, combine actions thoughtfully, manage move-only types with care, and utilize GoogleMock's factories and templates to build expressive and maintainable tests.

---

## See Also

- [Using Actions](https://google.github.io/googletest/gmock_cook_book.html#using-actions): Cookbook recipes and examples
- [Matchers and Assertions](../concepts/data_models_and_test_expressions/matchers_and_assertions.md): Verify test inputs and outputs
- [Mocking with GoogleMock](../guides/core-testing-workflows/mocking-with-googlemock.md): Overall mocking workflow
- [EXPECT_CALL](../docs/reference/mocking.md#EXPECT_CALL): Setting method expectations
- [ON_CALL](../docs/reference/mocking.md#ON_CALL): Setting default behaviors
- [Writing and Running Your First Test](../getting-started/first-test-and-validation/writing-and-running-your-first-test.md): Getting started


---

#### Code Reference

The main internal mechanisms for actions are implemented in:
- `googlemock/include/gmock/gmock-actions.h`
- `googlemock/include/gmock/gmock-more-actions.h`

Unit tests for actions with example usages can be found in:
- `googlemock/test/gmock-actions_test.cc`


---

**Example Usage for Side Effects and Actions:**

```cpp
using ::testing::SetArgPointee;
using ::testing::Return;

class MockFoo {
 public:
  MOCK_METHOD(bool, Compute, (int input, int* output));
};

TEST(MyTest, ComputesCorrectly) {
  MockFoo mock;
  EXPECT_CALL(mock, Compute(_, _))
      .WillOnce(DoAll(SetArgPointee<1>(42), Return(true)));

  int out; 
  EXPECT_TRUE(mock.Compute(5, &out));
  EXPECT_EQ(out, 42);
}
```

This mocks a `Compute` method that writes `42` to the second argument and returns `true`.
