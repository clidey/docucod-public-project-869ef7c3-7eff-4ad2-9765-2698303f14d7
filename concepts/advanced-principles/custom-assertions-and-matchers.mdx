---
title: "Custom Assertions and Matchers: Extending the Model"
description: "Learn how the framework enables users to create their own assertions and matchers, outlining best practices, extension points, and the conceptual underpinnings for integrating custom logic into the testing flow."
---

# Custom Assertions and Matchers: Extending the Model

GoogleTest empowers you to extend the assertion and matcher capabilities beyond the built-in set by creating custom assertions and matchers tailored to your specific testing needs. This page guides you through designing, implementing, and integrating your own assertions and matchers, emphasizing best practices to ensure seamless interaction with GoogleTest's assertion and test flow.

---

## Why Extend Assertions and Matchers?

The default GoogleTest assertions and matchers cover a wide range of common testing scenarios. However, inevitably your project will involve domain-specific validations or complex conditions that require more expressive, readable, and reusable assertions. Custom assertions and matchers:

- Help express test intentions clearly through domain language.
- Produce rich, meaningful failure messages aiding faster debugging.
- Simplify tests by encapsulating complex logic.
- Seamlessly integrate with GoogleTest's reporting and control flow.

Imagine you want to verify that a complex object satisfies a particular property that cannot be directly expressed by existing macros or matchers. Writing a custom matcher lets you encode this rule once, produce precise diagnostics on failure, and reuse it effortlessly across tests.

---

## Understanding the Model of Custom Assertions

### User Intent

Focus on what the user wants to verify rather than internal implementation details. Custom assertions should make failing conditions crystal clear and help users pinpoint the cause without sifting through unrelated code.

### AssertionResult: Success and Failure

At the core of predicate assertion support is the `::testing::AssertionResult` class. It conveys both success and failure states and allows streaming of diagnostic messages:

```cpp
namespace testing {

// Indicates a successful assertion.
AssertionResult AssertionSuccess();

// Indicates a failed assertion; message can be appended.
AssertionResult AssertionFailure();

}
```

By returning an `AssertionResult` from a predicate function, you control the message on failure and optionally on success, yielding richer feedback than plain Boolean checks.

### Basic Example: Predicate Function Using AssertionResult

```cpp
testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0)
    return testing::AssertionSuccess() << n << " is even";
  else
    return testing::AssertionFailure() << n << " is odd";
}

// Usage:
EXPECT_TRUE(IsEven(value));
```

Failure output includes the actual evaluated value and the custom message, making pinpointing errors easier.

---

## Creating Custom Matchers

Matchers encapsulate a condition tested against values. GoogleMock supplies macros and interfaces to define custom matchers, leveraging its powerful and extensible matching framework.

### MATCHER and MATCHER_P family of macros

For quick matcher definition, use the following macros in a namespace scope:

- `MATCHER(name, description_string)` — defines a parameterless matcher.
- `MATCHER_P(name, param, description_string)` — defines a matcher with one parameter.
- Variants exist up to 10 parameters.

Inside the macro body, use the special identifier `arg` to refer to the value to match, and `arg_type` for its type. `description_string` can reference `negation` and parameters to provide tailored failure messages.

#### Example: Simple Matcher

```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }

// Usage:
EXPECT_THAT(value, IsDivisibleBy7());
```

#### Example: Parameterized Matcher with Custom Message

```cpp
MATCHER_P(InClosedRange, range, 
          absl::StrCat(negation ? "isn't" : "is", " in range ", range)) {
  return 0 <= arg && arg <= range;
}

EXPECT_THAT(5, InClosedRange(10));
```

### Writing Matcher Classes

For advanced control over types or behavior, define a matcher class exposing:

- A typedef `using is_gtest_matcher = void;`.
- A templated or overloaded `MatchAndExplain()` method that returns `bool` and optionally writes explanation.
- `DescribeTo()` and `DescribeNegationTo()` methods for readable messages.

The matcher can be polymorphic by templating `MatchAndExplain` on matches' argument type.

### Integrating Custom Matchers

- Use your matcher in `EXPECT_THAT()` or `ASSERT_THAT()`.
- Matchers can be used wherever ordinary predicates are accepted, including mock expectations.
- Provide concise, precise failure information for a better test experience.

---

## Extending Assertions with Predicate Assertions

GoogleTest allows assertions driven by predicate functions or predicate-formatters:

- **Predicate Assertions (e.g. `EXPECT_PRED2`)**: predicate is a function returning `bool`.
- **Predicate Format Assertions (e.g. `EXPECT_PRED_FORMAT2`)**: predicate returns `AssertionResult` with detailed message.

Use the latter to provide rich failure diagnostics.

### Example Predicate Formatter

```cpp
testing::AssertionResult AssertSumIsEven(const char* expr1, const char* expr2,
                                         int n1, int n2) {
  if (((n1 + n2) % 2) == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr1 << " + " << expr2 << " is odd.";
}

EXPECT_PRED_FORMAT2(AssertSumIsEven, val1, val2);
```

### Best Practice

Implement predicate-format functions in a way that they either succeed immediately or give a clear contextual message on failure.

---

## Best Practices for Writing Custom Assertions and Matchers

- **Keep predicates pure and side-effect free:** Matchers and predicate functions may be called multiple times or out-of-order.
- **Use expressive names that convey intent:** Names like `IsPrime` or `ContainsValidData` make tests readable.
- **Provide meaningful failure messages:** Include actual and expected values, and explain reasoning when necessary.
- **Leverage streaming (`<<`) in messages:** You can append detailed context.
- **Test your custom matchers themselves:** Verify they behave as expected across edge cases.
- **Use `SCOPED_TRACE` for tracing nested assertion failures:** This helps debugging complex assertion chains.

---

## Extension Points

- **Custom Value Printers:** Teach GoogleTest how to print values of user-defined types using `AbslStringify()` or `PrintTo()` to improve assertion output.

- **Custom Matchers in Mock Expectations:** Use custom matchers with `EXPECT_CALL()` in GoogleMock for precise mock argument validation.

- **Custom Test Event Listeners:** Implement listeners to receive callbacks for test events, enabling custom reporting or integration.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common pitfalls and resolutions">
<Accordion title="Assertion messages lack context or show raw pointers">
Ensure your predicate functions return `AssertionResult` with streamed explanations rather than a plain bool.
</Accordion>
<Accordion title="Custom matcher not invoked or matches unexpectedly">
Verify matcher purity and that match signatures align with the types used in tests and mocks.
</Accordion>
<Accordion title="Compilation errors from MOCK_METHOD with complex types">
Wrap types containing commas in parentheses or define type aliases for cleaner syntax.
</Accordion>
<Accordion title="Unexpected swallowing of failure messages">
Make sure predicate formatter functions do not throw exceptions and message streaming to `result_listener` is handled properly.
</Accordion>
</AccordionGroup>

---

## Summary

Creating custom assertions and matchers in GoogleTest extends the framework’s expressiveness and improves test clarity. By using predicate assertions, predicate-formatters, or defining custom matcher classes and macros, users can embed domain-specific logic and supply rich diagnostic messages that help quickly identify failures. Integrating these extensions into tests and mock expectations elevates maintainability and self-documentation.


---

## Related Documentation

- [Assertions Reference](../reference/assertions.md) — Includes predicate assertions and advanced macros.
- [Matchers Reference](../api-reference/assertions-and-matchers/using-matchers.mdx) — Details built-in and custom matchers.
- [gMock Cookbook](../gmock_cook_book.md#NewMatchers) — Recipes for defining and using custom matchers.
- [Advanced GoogleTest Topics](docs/advanced.md#adding-traces-to-assertions) — Covers predicate assertions, scoped traces, and advanced patterns.
- [Mocking Reference](../reference/mocking.md) — Using custom matchers with mocks and setting expectations.


---

If you want to learn how to define your own expectations and actions for mocks beyond matchers, see the [Action Framework](concepts/mocking-matchers-actions/actions-and-call-behaviors) guide.

For extending printing support, see [Teaching GoogleTest How to Print Your Values](docs/advanced.md#teaching-googletest-how-to-print-your-values).


---