---
title: "Cardinalities, Sequences, & Strictness"
description: "Delve into advanced control markers: how many times a mock method must be called (cardinalities), the ordering of calls (sequences), and the enforcement of call behavior (strict, nice, naggy mocks). Learn how these mechanisms help express intent and catch subtle errors."
---

# Cardinalities, Sequences, & Strictness

Understand how to precisely control your mock method calls using cardinalities, enforce call order with sequences, and manage uninteresting call behavior with strictness modifiers. These advanced control markers help you express test intent clearly and catch subtle interaction errors early.

---

## Call Cardinalities: Controlling How Many Times a Mock Method is Called

Every mock method call expectation in GoogleMock can specify how many times that method is expected to be invoked. This is done with cardinalities—flexible call count specifications that help you express *how many* times a method should be called, ranging from exact counts to fuzzy numeric constraints.

### Why Cardinalities Matter

Imagine you want to check that a method is called exactly 3 times during a test. Instead of writing multiple expectations or manually counting calls, cardinalities let you succinctly specify this intent. They enable:

- **Verification of exact or range-based call counts**
- **Avoidance of overly strict or loose tests**
- **Readability by expressing expectations in human-friendly terms**

### The `Times()` Clause and Built-in Cardinalities

You specify call cardinalities with the `.Times()` clause on an `EXPECT_CALL()`. Some commonly used cardinalities include:

| Cardinality      | Description                                     |
|------------------|-------------------------------------------------|
| `Exactly(n)`     | Function must be called exactly *n* times.
| `AtLeast(n)`     | Called *at least* n times.
| `AtMost(n)`      | Called *at most* n times.
| `Between(m, n)`  | Called between *m* and *n* times (inclusive).
| `AnyNumber()`    | Called any number of times (zero or more).

If you omit `.Times()`, GoogleMock infers it based on your usage of `.WillOnce()` and `.WillRepeatedly()`, with rules such as:

- No `WillOnce` or `WillRepeatedly` clauses: inferred as exactly one call
- *n* `WillOnce` clauses without `WillRepeatedly`: exactly *n* calls
- *n* `WillOnce` clauses with `WillRepeatedly`: at least *n* calls

### Example: Cardinality Usage

```cpp
using ::testing::Exactly;
using ::testing::AtLeast;
using ::testing::AnyNumber;
using ::testing::Return;

MockTurtle turtle;

// Expect PenDown() to be called exactly once
EXPECT_CALL(turtle, PenDown())
    .Times(Exactly(1));

// Expect Forward() to be called at least 3 times
EXPECT_CALL(turtle, Forward(_))
    .Times(AtLeast(3));

// Expect Turn() to be called any number of times
EXPECT_CALL(turtle, Turn(_))
    .Times(AnyNumber());

// Set Return for GetX()
EXPECT_CALL(turtle, GetX())
    .Times(5)
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));
```

### Practical Tips for Cardinalities

- Use `Exactly(0)` to verify a method is *not* called
- Use fuzzy cardinalities like `AtLeast()` or `Between()` when you expect variable but bounded calls
- Do not over-specify cardinalities unless necessary; aim for tests that catch relevant failures but remain maintainable

### Troubleshooting Cardinalities

- If your mock method is called *more* than expected, GoogleMock reports an "upper bound violated" error.
- If called *fewer* than expected, GoogleMock reports a verification failure on mock destruction or `Mock::VerifyAndClear*`.
- Remember, multiple `EXPECT_CALL`s for the same mock method are matched in reverse order, so more specific or restrictive expectations should be declared last.

---

## Sequences: Controlling Ordering of Calls

In many tests, the order in which calls happen is important. Sequences let you enforce call ordering, from simple linear sequences to complex partial orders.

### Using `Sequence` and `.InSequence()`

A `Sequence` represents a chronological order of expectations. Assigning expectations to sequences with `.InSequence(seq1, seq2, ...)` ensures calls occur in the order they are defined within those sequences.

Example:

```cpp
using ::testing::Sequence;

Sequence s1, s2;
EXPECT_CALL(mock, Reset())
    .InSequence(s1, s2);
EXPECT_CALL(mock, GetSize())
    .InSequence(s1);
EXPECT_CALL(mock, Describe())
    .InSequence(s2);
```

This specifies:

- `Reset()` must happen first.
- `GetSize()` happens after `Reset()`.
- `Describe()` happens after `Reset()`.
- The relative order between `GetSize()` and `Describe()` is not specified.

You can also use the RAII `InSequence` class for a simpler way to enforce ordering:

```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
  EXPECT_CALL(mock, ThirdCall());
}
```

Here expectations must be matched in the exact order.

### Partial Ordering with `.After()`

For more complex call orders where some calls depend on the completion of others, use the `.After()` clause with `Expectation` or `ExpectationSet` objects:

```cpp
Expectation e1 = EXPECT_CALL(mock, InitX());
Expectation e2 = EXPECT_CALL(mock, InitY());
EXPECT_CALL(mock, Describe())
    .After(e1, e2);  // Describe() happens after both InitX() and InitY()
```

### Retiring Expectations: `.RetiresOnSaturation()`

By default, expectations remain "sticky" after being satisfied, meaning further matching calls will still match them unless they saturate their cardinality and cause errors.

Use `.RetiresOnSaturation()` to automatically deactivate an expectation after it meets its call count. This allows you to write sequential actions that won't conflict with future expectations:

```cpp
EXPECT_CALL(mock, Foo(1))
    .Times(1)
    .RetiresOnSaturation();
EXPECT_CALL(mock, Foo(2))
    .Times(AnyNumber());
```

### Example: Using Sequences in a Test

```cpp
using ::testing::InSequence;
using ::testing::Return;

{
  InSequence s;
  EXPECT_CALL(mock, Connect()).WillOnce(Return(true));
  EXPECT_CALL(mock, Send());
  EXPECT_CALL(mock, Disconnect());
}

// Code that must call Connect(), Send(), Disconnect() in order
```

### Common Pitfalls

- Don't forget to include sequences for expectations that must happen in order, or calls may match expectations out-of-order
- Mixing `.InSequence()` and `.After()` requires respecting clause ordering — `.InSequence()` must precede `.After()`, `.WillOnce()`, and similar clauses

---

## Strictness Modifiers: Managing Uninteresting Calls

GoogleMock supports different levels of strictness to control the behavior when mock methods are called without an explicit `EXPECT_CALL`.

### What Are Uninteresting Calls?

- **Uninteresting calls**: calls to mock methods with *no* matching `EXPECT_CALL` expectations.
- They can indicate missing test coverage or irrelevant calls you chose not to specify.

### The Three Strictness Modes

| Mode        | Behavior on Uninteresting Calls                         | Use When...                                  |
|-------------|---------------------------------------------------------|---------------------------------------------|
| `NiceMock`  | Suppresses warnings; silently allows uninteresting calls | You don't want warnings about such calls    |
| `NaggyMock` | Prints warnings on uninteresting calls (default mode)    | You want notices of unanticipated calls     |
| `StrictMock`| Treats uninteresting calls as test failures             | You want verification that *all* calls are expected |

### How to Use Strictness Modifiers

Wrap your mock class in the template:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockClass> nice_mock_obj;
NaggyMock<MockClass> naggy_mock_obj;
StrictMock<MockClass> strict_mock_obj;
```

Each behaves exactly like `MockClass` but adjusts what happens when unexpected calls occur.

### Example: Turning a Mock Nice

```cpp
NiceMock<MockTurtle> turtle;
EXPECT_CALL(turtle, PenDown());
// Calls to other methods will be ignored silently
```

### Detailed Behavior

- **Default mock objects** behave like `NaggyMock` (warnings on uninteresting calls)
- **`NiceMock`** suppresses these warnings but allows calls
- **`StrictMock`** enforces that no call occurs without matching expectations; uninteresting calls cause failures

### Notes and Caveats

- Strictness modifiers only affect **uninteresting calls**, not **unexpected calls** (calls with expectations that don't match arguments)
- `NiceMock<T>` and `StrictMock<T>` only affect mock methods defined *directly* in `T` using `MOCK_METHOD`
- Nesting strictness modifiers is unsupported (e.g., `NiceMock<StrictMock<T>>` is invalid)
- If your mock class does not have a virtual destructor, strictness modifiers may not work correctly

---

## Summary

This page covers:

- **Cardinalities**: specify how many times a mock method should be called
- **Sequences**: enforce call order strictly or partially with `Sequence`, `.InSequence()`, and `.After()`
- **Strictness Modifiers**: control handling of uninteresting calls via `NiceMock`, `NaggyMock`, and `StrictMock`

These mechanisms let you express your mock interaction expectations vividly, helping you write robust, maintainable tests that catch subtle bugs.

---

## Additional Resources

- [Mocking Reference](reference/mocking.md) — full syntax and API details
- [gMock Cookbook](guides/gmock_cook_book.md) — recipes and patterns
- [Basics of Mocking](guides/mocking-best-practices/basics-of-mocking.md) — core mocking workflows
- [Strictness and Mock Behavior](api-reference/gmock-api/strictness-and-mock-behavior.md) — detailed strictness controls
- [Cardinalities API](api-reference/gmock-api/actions-and-cardinalities.md#CardinalityList) — built-in cardinalities

---

## Troubleshooting

- Ensure `.Times()` is not repeated on the same `EXPECT_CALL()`
- Use `.RetiresOnSaturation()` to avoid sticky expectation conflicts
- Define expectations before exercising mock calls; otherwise, behavior is undefined
- Remember that the order of multiple `EXPECT_CALL()`s matters; latest matching expectations take precedence
- Consider using `NiceMock` to reduce warnings if uninteresting call notifications clutter your test output

---

## Recommended Workflow

1. Define mock methods with `MOCK_METHOD`
2. Use `ON_CALL()` for default behavior without imposing call count constraints
3. Set `EXPECT_CALL()` with `.Times()` clauses to express call cardinality expectations
4. Use `Sequence` and `.InSequence()` or `.After()` to enforce ordering
5. Use strictness wrappers (`NiceMock`, `StrictMock`) as appropriate to project verbosity needs
6. Verify expectations using object destruction or explicitly verify with `Mock::VerifyAndClearExpectations()`

---

Happy mocking!
