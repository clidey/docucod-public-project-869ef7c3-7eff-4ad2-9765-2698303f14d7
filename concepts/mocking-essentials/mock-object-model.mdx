---
title: "The Mock Object Model"
description: "Unpack how mock objects are constructed and behave within GoogleTest using GoogleMock. Understand the role of the MOCK_METHOD macro, mock method declarations, and how mocked classes interact with test code to simulate real components cleanly."
---

# The Mock Object Model

Mock objects lie at the heart of GoogleTest's powerful mocking framework, GoogleMock. Understanding how mock objects are constructed and behave within GoogleTest is essential for effectively simulating real components and testing their interactions in isolation.

This guide unpacks the core concepts behind mock objects, including the syntax and semantics of the critical `MOCK_METHOD` macro, how mocked classes declare mock methods, and how these interact with test code.

---

## Overview of Mock Objects

A **mock object** is a special kind of object that mimics the behavior of a real interface or class, allowing tests to specify and verify expectations on method calls such as how often a method is called, with what arguments, and what it returns.

Mock objects in GoogleMock are created by subclassing an interface or class, and replacing selected virtual methods with mock methods declared via the `MOCK_METHOD` macro.

### What Makes a Mock Object?

- They implement the same interface as a real object, enabling substitution.
- They allow *setting expectations* on method invocations before exercising the code under test.
- They *automatically verify* that all specified expectations were met once they are destroyed.
- They provide rich capabilities for specifying argument matching, call counts, call order, and method behaviors.

---

## Defining and Declaring Mock Methods with `MOCK_METHOD`

The cornerstone of creating mock objects is the `MOCK_METHOD` macro, which declares mock methods inside mock classes. It automatically generates the necessary boilerplate for intercepting calls, applying expectations, and invoking user-defined behaviors.

### Basic Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Qualifiers));
```

- **ReturnType**: The method's return type.
- **MethodName**: The name of the method to mock.
- **(ArgTypes...)**: A parenthesized list of argument types.
- **(Qualifiers)** (optional): Method qualifiers such as `const`, `override`, `noexcept`, calling convention `Calltype(...)`, and reference qualifiers `ref(...)`.

### Example

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Important Notes

- `MOCK_METHOD` must appear in the **public** section of the mock class even if the mocked method is not public in the base class. This ensures smooth integration with testing macros and enables powerful mocking features.
- If argument or return types contain commas, wrap them in extra parentheses or use type aliases to avoid macro parsing issues:

  ```cpp
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
  ```

- For const methods, always include `const` in the qualifiers.

- The macro generates the mock *definition*, so no separate implementation is needed.

### Refer to [Mocking Reference](reference/mocking.md#MOCK_METHOD) for detailed rules and examples.

---

## Using Mock Objects in Tests

Once defined, mock objects integrate seamlessly into tests. The common workflow is:

1. Instantiate your mock object.
2. Use `ON_CALL` to specify default behaviors (optional).
3. Use `EXPECT_CALL` to set expectations: count, argument matchers, call order, and actions.
4. Exercise the code under test using the mock.
5. Upon mock destruction, GoogleMock automatically verifies expectations.

The mock object maintains a registry of all mocked methods and their expectations, optimizing call dispatch and verification.

---

## Interactions Between Mock Objects and GoogleTest

### Registration and Lifetime

- When a mock method is first involved in `ON_CALL` or `EXPECT_CALL`, the mock object and method get registered globally.
- This registration tracks all mocks currently alive, enabling verification of expectations and reporting leaked mocks.
- Mock methods unregister themselves when destroyed; if all methods of a mock object unregister, the object itself is removed from the registry.

### Verifying Expectations

- GoogleMock checks expected call counts, call order, and argument match correctness.
- Failures are reported as GoogleTest non-fatal failures, including source location and explanation.
- You can force verification early using `Mock::VerifyAndClearExpectations` or `Mock::VerifyAndClear`.

### Uninteresting and Unexpected Calls

- **Uninteresting calls:** Methods without explicit expectations being called.
  - Generate warnings in default “naggy” mock mode.
  - Can be suppressed using `NiceMock` or treated as errors using `StrictMock`.
- **Unexpected calls:** Calls that have expectations but don't match any.
  - Always generate errors.

### The Nice, Naggy, and Strict Mock Variants

- Wrap mock classes in `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>` to control handling of uninteresting calls.

---

## Call Order and Sequences

GoogleMock supports partial and total ordering of mock function calls:

- Use the `InSequence` object in a scope to form a strict sequence of expectations.
- Use the `.InSequence()` clause in `EXPECT_CALL` to specify membership in one or more sequences.
- Use `.After()` clauses to specify that some expectations occur after others, enabling DAG-like partial orderings.
- Expectations automatically retire when saturated or invoked depending on use of `.RetiresOnSaturation()`.

---

## Advanced Mock Object Features

### Retiring Expectations

- Expectations can be made to *retire* once they are saturated, no longer matching any calls.
- This prevents call overshoot errors for expectations with `.Times(n)`.

### Default Actions

- `ON_CALL()` allows setting default actions for mock methods when calls are uninteresting.
- Newer `ON_CALL` rules override earlier ones.

### Multiple Expectations on the Same Method

- Later `EXPECT_CALL`s take precedence over earlier ones.
- Be mindful of ordering to set up catch-all (generic) expectations first and specific ones later.

### Thread Safety

- GoogleMock internally serializes access to expectation state and registry.
- Users must synchronize when setting or clearing expectations.

---

## Example: Defining and Testing a Mock Object

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenDown() = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  // Expect PenDown() is called at least once
  EXPECT_CALL(turtle, PenDown()).Times(::testing::AtLeast(1));
  // Returns 100, 150, then 200 from GetX()
  EXPECT_CALL(turtle, GetX())
      .WillOnce(::testing::Return(100))
      .WillOnce(::testing::Return(150))
      .WillRepeatedly(::testing::Return(200));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

---

## Troubleshooting & Best Practices

- **Expectations Must Be Set Before Calls:** Avoid setting expectations after exercising mock methods. This leads to undefined behavior.
- **Avoid Over-Specifying Arguments:** Use wildcards `_` or match only what's necessary to prevent brittle tests.
- **Use `RetiresOnSaturation()` When Appropriate:** Helps avoid upper-bound call count violations.
- **Use `NiceMock` to Suppress Uninteresting Call Warnings:** Good for noisy mocks when tests don't care about all calls.

---

## Additional Resources

- For practical usage, see [gMock for Dummies](gmock_for_dummies.md).
- Detailed API in [Mocking Reference](reference/mocking.md).
- Best practices in [gMock Cookbook](gmock_cook_book.md).
- Overview and cheat sheets in [gMock Cheat Sheet](gmock_cheat_sheet.md).


---