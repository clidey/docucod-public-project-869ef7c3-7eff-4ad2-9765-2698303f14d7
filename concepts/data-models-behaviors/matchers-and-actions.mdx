---
title: "Matchers and Actions in Mocking"
description: "Get to know how matchers and actions define the behavior of mocks. See how argument matching, cardinality constraints, and custom actions enable expressive expectation setting in your mocks."
---

# Matchers and Actions in Mocking

GoogleMock offers powerful building blocks to specify how mock objects behave and verify how they interact with your code under test. This page explains the key concepts of *matchers* and *actions* â€” the core elements that define argument matching rules and mock method behaviors.

---

## What Are Matchers?

Matchers describe the conditions that arguments must satisfy when mock methods are called. When setting expectations on mock methods, you use matchers to specify what input arguments are expected.

- **Exact Matching:** You can specify exact values for arguments, such as expecting a call with the integer `5` or string `"hello"`.

- **Wildcard Matching:** Use the special matcher `_` to accept any value for an argument without restriction.

- **Predicate Matching:** Use expressive matchers like `Ge(5)` (greater or equal to 5), `NotNull()`, or combine matchers logically (e.g., `AllOf`, `AnyOf`).

- **Member and Field Matching:** Match on specific object fields or properties using `Field()` or `Property()`.

- **Pointer and Container Matching:** Validate values pointed to by pointers (`Pointee()`), or elements inside containers (`ElementsAre()`, `UnorderedElementsAre()`).

**Example:**
```cpp
using ::testing::_;
using ::testing::Ge;

EXPECT_CALL(mock, Process(Ge(10), _));
```
This expects that the first argument is greater or equal to 10, while the second argument can be anything.

### Combining Matchers

Match multiple argument conditions with logical composition:

```cpp
EXPECT_CALL(mock, Operation(AllOf(Ge(5), Ne(10)), NotNull()));
```
This expects the first argument to be >=5 and not 10, and the second argument to be non-null.

### Multi-argument Matching with `.With()` Clause

GoogleMock also allows matching *all* arguments as a tuple with the `.With(...)` clause in expectations, enabling constraints across multiple arguments at once.

```cpp
EXPECT_CALL(mock, RangeCheck(_, _))
    .With(Lt());  // The first argument must be less than the second
```

### Custom and Parameterized Matchers

Advanced users can write custom matchers, quick matchers using macros, or polymorphic matchers to verify complex argument properties beyond built-in matchers.


## What Are Actions?

Actions define what happens when a mock method is invoked and a matching expectation is found. By default, GoogleMock returns sensible default values for built-in types or void for methods returning `void`. Actions let you customize this behavior.

### Basic Actions

- **Return a Value:** `Return(value)` makes the mock method return `value`.
- **Return a Reference:** Use `ReturnRef(obj)` to return a reference.
- **Return Value at Call Time:** `ReturnPointee(&var)` returns the pointed-to value at the time of call, not when the action is created.

### Sequencing Actions

Multiple actions can be specified in sequence with multiple `WillOnce()` clauses followed by an optional `WillRepeatedly()`. When the `WillOnce()` actions are exhausted, the `WillRepeatedly()` action is used.

```cpp
EXPECT_CALL(mock, GetCount())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### Side Effects

Actions allow simulating side effects, such as:

- Modifying output parameters (`SetArgPointee<N>(value)`).
- Calling callback arguments (`InvokeArgument<N>(args...)`).
- Combining multiple effects (`DoAll()`).

For example:
```cpp
EXPECT_CALL(mock, UpdateValue(0));
EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(5), Return(true)));
```

### Invoking Callables and Lambdas

You can supply any callable (free function, lambda, functor) as an action with `Invoke()`. This enables flexible custom behavior.

```cpp
EXPECT_CALL(mock, Compute(_, _))
    .WillOnce(Invoke([](int x, int y) {
      return x + y;
    }));
```

### Ignore Return Values

`IgnoreResult()` can be used to ignore the return value of an action, useful when chaining actions in `DoAll()` for `void` functions.

### Selecting Arguments for Actions

If you have a callable that does not accept all arguments of the mocked methods, use `WithArgs<N, M>(action)` to select specific argument indices.

### Writing Custom Actions

You can write custom actions manually or use macros for more control and reusability.


## Using `EXPECT_CALL` and `ON_CALL` Together

- `EXPECT_CALL()` defines both an expectation *and* the behavior to perform when the call occurs, including cardinality constraints (how many times the call is expected).

- `ON_CALL()` only specifies default behavior without an expectation. It defines what happens when a mock method is called but does not enforce that the call must occur.

It is best practice to use `ON_CALL()` to set up common default behaviors and use `EXPECT_CALL()` to verify specific calls in your tests.

## Cardinality: Controlling Call Counts

Use `.Times()` to specify how many times a call should happen. The cardinality can be exact or fuzzy:

| Cardinality         | Meaning                         |
|---------------------|--------------------------------|
| `AnyNumber()`       | Call may happen any number of times |
| `AtLeast(n)`        | Call expected at least `n` times |
| `AtMost(n)`         | Call expected at most `n` times |
| `Between(m, n)`     | Call expected between `m` and `n` times (inclusive) |
| `Exactly(n)` or `n` | Call expected exactly `n` times |

If `.Times()` is omitted, GoogleMock infers the count from `WillOnce()` and `WillRepeatedly()` clauses.

## Expectation Ordering

GoogleMock attempts searches for matching expectations from newest to oldest, allowing more specific expectations written later to override general ones.

If order matters, use `.InSequence(...)`, `.After(...)`, or the `InSequence` helper class to enforce call order.

## Strictness Modes: Nice, Naggy, and Strict

Mock objects default to "naggy" behavior, warning on unexpected calls.

- **NiceMock:** Suppresses warnings on uninteresting calls.
- **NaggyMock:** Warnings on uninteresting calls (default behavior).
- **StrictMock:** Treats uninteresting calls as errors, causing test failures.

Use these decorators by wrapping your mock class:

```cpp
NiceMock<MockFoo> nice_mock;
NaggyMock<MockFoo> naggy_mock;
StrictMock<MockFoo> strict_mock;
```

Choose the mode based on how strict you want your tests to be with unexpected interactions.

## Best Practices

- Use matchers judiciously to avoid brittle tests.
- Favor `ON_CALL` for default behavior and set `EXPECT_CALL` for calls you want to verify.
- Use sequences and ordering constraints only when necessary to avoid over-constraining tests.
- Prefer `NiceMock` unless you want strict enforcement of no unexpected calls during development.

## Troubleshooting Matchers and Actions

- Ensure matchers used correspond to the expected argument types; use `SafeMatcherCast` for type adjustments.
- Matchers must be functional and side-effect free.
- Use `--gmock_verbose=info` flag to trace mock calls, helping debug unmatched expectations or unexpected calls.
- Beware that `EXPECT_CALL` statements must precede calls to the mock methods.


## Related Documentation

- [Mock Class Definition and MOCK_METHOD Macros](../../api-reference/mocking-framework/mock-class-definition)
- [Setting Expectations: EXPECT_CALL and ON_CALL](../../api-reference/mocking-framework/setting-expectations)
- [Strict, Naggy, and Nice Mocks](../../api-reference/mocking-framework/strict-naggy-nice-mocks)
- [Built-in Matchers](../../api-reference/matchers-actions/builtin-matchers)
- [Built-in Actions and Return Controls](../../api-reference/matchers-actions/builtin-actions)
- [Writing Custom Matchers and Actions](../../api-reference/matchers-actions/custom-matchers-and-actions)
- [Mocking Best Practices Guide](../../guides/real-world-workflows/mocking-best-practices)

---

For an interactive beginner-friendly tutorial on mocks, see the [Exploring Mock Objects Guide](/guides/getting-started/exploring-mock-objects).

You can also explore workflows starting with [Writing Your First Test](/guides/getting-started/writing-your-first-test) and move toward custom matchers and actions.

# Visual Summary

```mermaid
flowchart TD
  A[Define mock class with MOCK_METHOD] --> B[Set expectations with EXPECT_CALL]
  B --> C{Define argument matchers}
  C -->|Exact Value| D[Use literal or Eq() matcher]
  C -->|Flexible| E[Use built-in or custom matchers]
  B --> F{Specify call cardinality with Times()}
  B --> G{Define behavior with WillOnce()/WillRepeatedly()}
  G --> H[Return values, invoke lambdas, set side effects]
  B -.-> I[Optionally specify order with InSequence or After]
  J[Use ON_CALL to set default mock behavior without expectation]
  Test[Run tests calling mock methods]
  Test --> K{GoogleMock verifies expectations}
  K --> L[Pass if expectations met]
  K --> M[Fail with detailed diagnostics]
```

---

<Check>
**Quick Tip:** Always set your expectations before executing code that exercises mocks to avoid undefined behavior and tricky debugging.
</Check>

<Info>
Use `NiceMock` wrappers by default to minimize test maintenance overhead; reserve `StrictMock` for test stability verification.
</Info>

<Tip>
Use the `--gmock_verbose=info` test run flag to gain detailed insights into matchers and actions during test execution, helping you pinpoint failing expectations or mis-matched arguments.
</Tip>

---

## Source & Further Reading

See the gMock Cookbook for detailed recipes and examples: https://google.github.io/googletest/gmock_cook_book.html

See the Mocking Reference for API and usage: https://google.github.io/googletest/reference/mocking.html

Source: [GoogleTest Repository](https://github.com/google/googletest)
