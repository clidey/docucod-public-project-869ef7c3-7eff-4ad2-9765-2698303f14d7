---
title: "Error Handling and Failure Modes"
description: "An in-depth look at how GoogleTest and GoogleMock handle assertion failures, exception safety, and 'death' tests. Understand the handling of fatal versus non-fatal errors, and how the framework ensures test robustness through reporting and process management."
---

# Error Handling and Failure Modes

An in-depth look at how GoogleTest and GoogleMock handle assertion failures, exception safety, and 'death' tests. This guide explains the distinctions between fatal and non-fatal failures, how exceptions are managed, the role of death tests, and how the framework maintains robustness through detailed reporting and process control.

---

## Table of Contents

- [Understanding Failures](#understanding-failures)
  - [Fatal vs Non-Fatal Failures](#fatal-vs-non-fatal-failures)
  - [Explicit Success and Failure Assertions](#explicit-success-and-failure-assertions)
- [Assertion Macros and Failure Reporting](#assertion-macros-and-failure-reporting)
  - [Streaming Custom Messages](#streaming-custom-messages)
  - [Assertions Evaluating Arguments Exactly Once](#assertions-evaluating-arguments-exactly-once)
- [Exception Safety and Assertion Behavior](#exception-safety-and-assertion-behavior)
  - [Catching and Reporting Exceptions](#catching-and-reporting-exceptions)
  - [Throwing on Failures](#throwing-on-failures)
  - [Working with Fatal Assertions in Non-void Functions](#working-with-fatal-assertions-in-non-void-functions)
- [Advanced Assertion Techniques](#advanced-assertion-techniques)
  - [Predicate Assertions](#predicate-assertions)
  - [Predicate-Formatter Assertions](#predicate-formatter-assertions)
- [Test Suite and Fixture Setup Failures](#test-suite-and-fixture-setup-failures)
- [Death Tests and Process Termination](#death-tests-and-process-termination)
  - [Death Test Assertions](#death-test-assertions)
  - [Death Test Styles and Thread Safety](#death-test-styles-and-thread-safety)
  - [Common Pitfalls with Death Tests](#common-pitfalls-with-death-tests)
- [Test Event Listeners and Failure Propagation](#test-event-listeners-and-failure-propagation)
- [Best Practices and Troubleshooting](#best-practices-and-troubleshooting)

---

## Understanding Failures

GoogleTest distinguishes between different kinds of failures to offer precise control over test behaviors.

### Fatal vs Non-Fatal Failures

- **Fatal failures** (triggered by `ASSERT_*` and `FAIL()`) immediately abort the execution of the *current function*.
- **Non-fatal failures** (triggered by `EXPECT_*` and `ADD_FAILURE()`) record failures but allow the current function to continue execution.

This differentiation lets users decide whether an assertion failure should stop further checks within the function or allow checks to continue.

### Explicit Success and Failure Assertions

Beyond testing conditions, GoogleTest provides manual control over test success and failure:

- `SUCCEED()`: Marks an explicit success. Does not override overall test success if previous failures occurred. Useful for documentation or signaling intentional pass points.
- `FAIL()`: Generates a fatal failure, aborting the current function.
- `ADD_FAILURE()`: Generates a non-fatal failure.
- `ADD_FAILURE_AT(file, line)`: Generates a non-fatal failure reported at a specified file and line.

## Assertion Macros and Failure Reporting

GoogleTest provides a rich set of assertion macros that evaluate expressions and report failures with detailed messages.

### Streaming Custom Messages

All assertion macros support streaming additional information using the `<<` operator to enhance failure diagnostics. For example:

```cpp
EXPECT_TRUE(my_condition) << "Condition failed because of XYZ";
```

This extra information is appended to the failure message for clarity.

### Assertions Evaluating Arguments Exactly Once

To prevent side-effects from mis-evaluation, all assertion macros evaluate their arguments exactly once. This is critical when expressions have side effects or expensive computations.

## Exception Safety and Assertion Behavior

### Catching and Reporting Exceptions

- GoogleTest can catch exceptions thrown by tests (if exceptions are enabled) and treat them as test failures.
- The flag `--gtest_catch_exceptions` controls whether exceptions are caught and reported or allowed to propagate.
- Special exception types, like `testing::AssertionException`, are supported to integrate with external frameworks.
- Unhandled exceptions generate fatal failures with detailed messages including exception descriptions and locations.

### Throwing on Failures

- With the `--gtest_throw_on_failure` flag, assertion failures emit exceptions instead of just recording failures. This facilitates integration with external test runners that prefer exceptions.

### Working with Fatal Assertions in Non-void Functions

- Fatal assertions (`ASSERT_*` and `FAIL()`) can only be used in functions returning `void` due to no use of exceptions internally.
- Using fatal assertions in non-void functions results in compilation errors.
- For non-void functions, use non-fatal assertions (`EXPECT_*`) or redesign functions to return via output parameters.

## Advanced Assertion Techniques

### Predicate Assertions

For complex checks where a simple Boolean expression lacks descriptive failure messages, GoogleTest offers predicate assertions:

- `EXPECT_PRED*` and `ASSERT_PRED*` macros use predicate functions returning `bool` that print failure contexts.
- Variants support up to five parameters.

Example predicate:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, 4); // Passes
EXPECT_PRED1(IsEven, 5); // Fails with arguments values printed
```

### Predicate-Formatter Assertions

For full control over failure message formatting, define *predicate-formatter* functions returning `testing::AssertionResult` that produce rich success and failure messages.

- Use macros like `EXPECT_PRED_FORMAT*` and `ASSERT_PRED_FORMAT*` to use them.
- Signature example:

```cpp
testing::AssertionResult MyPredicateFormatter(const char* expr1, const char* expr2, T1 val1, T2 val2);
```

Example usage:

```cpp
EXPECT_PRED_FORMAT2(MyPredicateFormatter, val1, val2);
```

## Test Suite and Fixture Setup Failures

- Fatal and non-fatal failures in fixture constructors, `SetUp()`, and `TearDown()` methods are reported.
- Fatal failures in fixture setup prevent test body execution; non-fatal failures are logged but the test continues.
- Use `SetUpTestSuite()` and `TearDownTestSuite()` for expensive shared resource management across tests.

## Death Tests and Process Termination

### Death Test Assertions

- Designed to verify code that terminates the process intentionally (e.g., assertions, `abort()` calls).
- Supported macros: `EXPECT_DEATH`, `ASSERT_DEATH`, `EXPECT_EXIT`, `ASSERT_EXIT`, and variants.
- These macros spawn a child process to execute test code, capturing its exit code and output.
- Matchers or regex can be specified to verify error messages on `stderr`.

Example:

```cpp
ASSERT_DEATH({ Foo(); }, "Expected error message regex");
EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");
```

### Death Test Styles and Thread Safety

- Two styles: `fast` (default) uses `fork()` or equivalent; `threadsafe` re-executes the test binary in a subprocess for safer multithreaded scenarios.
- Tests whose names end with `DeathTest` are run before others, minimizing thread interference.
- Thread safety concerns arise because process termination and threading can interfere.

### Common Pitfalls with Death Tests

- Avoid placing multiple death assertions on the same line.
- Side-effects inside death tests don't propagate back to the parent process.
- Mocks in death tests expecting specific exit codes require objects to be allowed to leak to avoid false failure reports.

## Test Event Listeners and Failure Propagation

- GoogleTest offers an event listener API to hook into test lifecycle events.
- Listeners can augment test reporting, log failure information, or integrate with external tools.
- Failure raising in listeners is restricted in certain callbacks to avoid recursion.

Example custom listener:

```cpp
class MinimalListener : public testing::EmptyTestEventListener {
  void OnTestStart(const testing::TestInfo& info) override {
    std::cout << "Starting " << info.test_suite_name() << "." << info.name() << std::endl;
  }
  void OnTestPartResult(const testing::TestPartResult& result) override {
    if (result.failed()) {
      std::cerr << result.file_name() << ":" << result.line_number() << " failure: " << result.message() << std::endl;
    }
  }
};

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  testing::UnitTest::GetInstance()->listeners().Append(new MinimalListener);
  return RUN_ALL_TESTS();
}
```

## Best Practices and Troubleshooting

- Use non-fatal assertions when you want the test function to continue after failure.
- Use fatal assertions cautiously, remembering they only abort the current function.
- For complex checks, prefer predicate or predicate-formatter assertions to gain clearer failures.
- Follow death test naming conventions and avoid multi-threading pitfalls inside death tests.
- Use `SCOPED_TRACE` to add contextual failure information in deeply nested test code.
- Ensure that tests and test suites use consistent fixture classes to avoid failures.
- If exceptions are enabled, consider `--gtest_throw_on_failure` to integrate with exception-based runners.

---

## References

- [Assertions Reference](./reference/assertions.md)
- [Advanced GoogleTest Topics](./docs/advanced.md)
- [Death Tests](./guides/advanced-testing-patterns/death-tests.mdx)
- [Test Infrastructure](./api-reference/core-testing-apis/test-infrastructure.mdx)
- [Test Event Listeners](./api-reference/core-testing-apis/test-output-and-configuration.mdx#event-listeners)

---

This guide empowers you to write reliable, maintainable tests by understanding how GoogleTest reports failures and handles different failure modes with precision and clarity.