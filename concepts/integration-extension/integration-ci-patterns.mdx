---
title: "Integration and Continuous Integration Patterns"
description: "Explore patterns for integrating GoogleTest and GoogleMock into larger codebases and CI/CD pipelines. Highlight best practices for test discovery, parallel testing, and interoperation with build systems."
---

# Integration and Continuous Integration Patterns

Explore patterns for integrating GoogleTest and GoogleMock into larger codebases and CI/CD pipelines. Highlight best practices for test discovery, parallel testing, and interoperation with build systems.

---

## Overview

Integrating GoogleTest and GoogleMock into your projects and continuous integration (CI) pipelines ensures your tests run efficiently, reliably, and provide clear, actionable feedback. Leveraging GoogleTest's flexible configuration alongside GoogleMock’s power to mock dependencies allows you to build robust automated testing workflows.

This guide walks you through common patterns and recommended approaches to embed GoogleTest and GoogleMock into large codebases and CI/CD pipelines, emphasizing:

- Discovering and running tests consistently across platforms.
- Scaling test execution via parallelism and sharding.
- Producing rich test result reports compatible with popular CI systems.
- Managing test dependencies and mocking strategies in integrated environments.


## Test Discovery and Execution

A core step in integrating GoogleTest is ensuring your test binaries are discoverable and runnable by your build and CI systems.

### Compiling Test Binaries

- Link your test executables against `gtest` or `gtest_main` libraries to include the GoogleTest runtime and entry points.
- For tests using mocks, link against GoogleMock libraries as well, ensuring all mock classes and expectations are linked properly.

### Test Discovery Techniques

- **Using CTest:** When building with CMake, use [`enable_testing()`](https://cmake.org/cmake/help/latest/command/enable_testing.html) and [`add_test()`](https://cmake.org/cmake/help/latest/command/add_test.html). Test executables are registered for discovery, and `ctest` can run them individually or collectively.

- **Test Filters:** GoogleTest supports test filtering via the `--gtest_filter` flag. Use this to select specific test cases or suites.

- **Test List Files:** For custom build systems, maintain test lists or use discovery scripts that invoke executables with `--gtest_list_tests` to enumerate tests.

### Running Tests with GoogleMock

- GoogleMock integrates seamlessly with GoogleTest. Running your test binary executes all test cases, including those that use mock classes and expectations.

- Make sure `EXPECT_CALL()` and `ON_CALL()` are setup before exercising mocks.

- GoogleMock will automatically verify expectations when mock objects are destructed.


## Parallel Testing and Sharding

Running tests in parallel significantly reduces total test time but requires some planning.

### Parallel Test Execution

- Run tests in parallel across multiple processes or machines.

- Use CTest's `--parallel` or build system’s parallel execution features.

- Ensure test executables are self-contained without interdependent state.

### Test Sharding

- GoogleTest supports sharding tests into subsets that run independently.

- Use the `--gtest_shard_count=N` and `--gtest_test_shard_index=M` flags to split tests.

- This is useful in distributed CI environments where tests are split across agents.

### Best Practices

- Avoid shared global state or require setup to isolate it per test.

- Use test fixtures and mock objects scoped per test to ensure thread safety.

- Validate sharded test runs regularly to avoid skewed coverage.


## Generating Test Reports for CI

CI systems often require structured reports to present test results.

### XML Output

- GoogleTest supports generating XML reports with the `--gtest_output=xml:<file>` flag.

- Configure your CI system to consume these XML files to display tests and failures.

- GoogleMock's failures from unmet expectations will automatically appear in these reports.

### Verbosity and Logs

- Control the verbosity of GoogleMock and GoogleTest logs using flags like `--gmock_verbose` to `info`, `warning`, or `error`.

- Use these to adjust the noise level in CI logs for actionable insight.


## Interoperation with Build Systems

### CMake

- Use `FetchContent` or add GoogleTest as an external project.

- Link your tests with `gtest` or `gmock` targets.

- Use `enable_testing` and `add_test` commands to register tests.

- Use `ctest` to run and discover tests.

### Bazel

- Declare GoogleTest and GoogleMock as dependencies.

- Use `cc_test` rules to build and run tests.

- Bazel automatically discovers test targets.


## Mocking Strategies in CI Pipelines

### Setting Expectations Before Test Execution

- Always set `EXPECT_CALL` specifications on mocks *before* exercising the code under test.

- Avoid changing expectations during test execution as it causes undefined behavior.

### Utilizing `ON_CALL`

- Use `ON_CALL` to define default behaviors when calls are allowed but not strictly expected.

- Combine `ON_CALL` with `NiceMock` to suppress warnings on uninteresting calls.

### Strictness Levels

- Use `NiceMock` for mocks when you want to ignore uninteresting calls.

- Use `NaggyMock` if you want warnings on unexpected but allowed calls.

- Use `StrictMock` when you want failures on any uninteresting calls.

### Verifying and Clearing Mocks Explicitly

- Optionally call `Mock::VerifyAndClearExpectations()` after test sections to verify mocks early in longer tests.

- Use `Mock::AllowLeak()` if mocks are deliberately leaked (rare and discouraged).


## Common Pitfalls and Troubleshooting in CI Context

- Ensure mock methods are virtual, and mock classes have virtual destructors to avoid memory issues.

- Use `--gmock_verbose=info` flag in CI logs for detailed call traces when diagnosis is needed.

- Avoid mixing test discovery and execution in a way that consumes or changes mock expectations mistakenly.

- Manage flaky tests by leveraging GoogleTest’s repeat flags with deterministic seeds.


---

## Practical Example

```bash
# Run all tests with XML report and verbose output suited for CI
./my_test_binary --gtest_output=xml:test_results.xml --gmock_verbose=warning --gtest_color=no

# Run tests shard 0 of 4
./my_test_binary --gtest_shard_count=4 --gtest_test_shard_index=0

# Run a subset of tests matching a filter
./my_test_binary --gtest_filter=MyTestSuite.*
```

---

## Summary

This page outlines how to effectively integrate GoogleTest and GoogleMock into large, automated testing environments and continuous integration pipelines. It guides users through compiling and discovering tests, scaling test execution in parallel or distributed contexts, producing CI-compatible test reports, and managing mocks with appropriate strictness and default behaviors. By following these patterns, teams ensure reliable, maintainable, and actionable automated testing across their development lifecycle.


---

## Recommended Next Steps

To deepen your mastery of testing and mocking in GoogleTest ecosystems, consider consulting:

- [Testing and Mocking Basics](../guides/getting-started/writing-your-first-tests.md)
- [Writing Mock Expectations and Actions](../guides/mocking-with-googlemock/writing-mock-expectations.md)
- [Advanced Mocking Techniques](../guides/mocking-with-googlemock/advanced-mocking-techniques.md)
- [Continuous Integration Setup](../guides/integration-and-optimization/continuous-integration-setup.md)
- [Managing and Scaling Large Test Suites](../guides/integration-and-optimization/maintaining-large-test-suites.md)

For detailed API reference and troubleshooting:

- Mocking Reference: `docs/reference/mocking.md`
- gMock Cookbook: `docs/gmock_cook_book.md`
- Legacy gMock FAQ: `docs/gmock_faq.md`


> For implementation details on mocking APIs and mock object life cycle, see the [Mocking Framework Architecture](concepts/core-architecture/mocking-framework-architecture.md) and [Test and Mock Lifecycle](concepts/core-architecture/test-and-mock-lifecycle.md).
