---
title: "Assertion Models (Fatal, Non-Fatal, User-Defined)"
description: "Understand the assertion hierarchy in GoogleTest, including fatal and non-fatal assertion styles, and how to implement your own assertion semantics for stronger testing guarantees and custom diagnostics."
---

# Assertion Models (Fatal, Non-Fatal, User-Defined)

GoogleTest assertions form the backbone of verifying program correctness by reporting success or failure conditions during test execution. This page guides you through the hierarchy of assertions, outlining the differences between *fatal* and *non-fatal* assertion styles, and instructs on how to create custom assertion semantics to tailor test diagnostics for your needs.

---

## Understanding Assertion Types

In GoogleTest, assertions are broadly categorized into two types based on their level of severity and effect on test flow:

- **Fatal Assertions**: These cause the immediate termination of the current test function when they fail. Use them when continuing the test after a failure is meaningless or dangerous.

- **Non-Fatal Assertions**: These report failures but allow the test function to continue executing. Use them when partial results are valuable and you want to gather as many errors as possible in one run.

### Choosing Between Fatal and Non-Fatal

GoogleTest provides macros for both assertion styles. The naming convention differentiates them:

| Macro Prefix | Behavior                     |
|--------------|------------------------------|
| `EXPECT_`    | Non-fatal: records failure but continues  |
| `ASSERT_`    | Fatal: aborts current function on failure |

For example:

```cpp
EXPECT_TRUE(condition);  // Non-fatal, test continues if condition is false
ASSERT_TRUE(condition);  // Fatal, test aborts if condition is false
```

Use fatal assertions to prevent undefined behavior or invalid states in subsequent test code. Use non-fatal assertions to get more diagnostic information when running complex tests.

## Explicit Success and Failure Assertions

Apart from conditional assertions, GoogleTest offers assertions to explicitly mark test execution states.

### SUCCEED()

`SUCCEED()` reports an explicit success. It does not forcibly mark the whole test as passing — the test still depends on the absence of failures elsewhere.

```cpp
SUCCEED();  // Document intent: something passed explicitly
```

Use this for documenting a test path or as a placeholder.

### FAIL()

`FAIL()` generates an immediate fatal failure and aborts the current function. It’s useful for unreachable code or error handling paths.

```cpp
switch(value) {
  case 1: break;
  default: FAIL() << "Unexpected value.";  // Fatal failure here
}
```

### ADD_FAILURE()

`ADD_FAILURE()` reports a non-fatal failure without aborting the function.

```cpp
if (!precondition_met) {
  ADD_FAILURE() << "Precondition failed.";
}
```

### ADD_FAILURE_AT(file, line)

Use `ADD_FAILURE_AT()` when you want to report failure pointing to a specific source location different from the current line.

```cpp
ADD_FAILURE_AT("my_file.cc", 123) << "Something went wrong.";
```

Useful for reporting failures detected outside normal test code (e.g., callback functions).

## Using Generalized Assertions With Matchers

GoogleTest supports flexible assertions using matchers with the `EXPECT_THAT()` and `ASSERT_THAT()` macros. This enables expressive checks beyond simple boolean conditions.

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
ASSERT_THAT(my_vector, ElementsAre(1, 2, 3));
```

Matchers give detailed failure messages explaining what was expected and what was actually encountered.

## Writing Your Own Assertion-Based Checks

In addition to built-in assertions, GoogleTest allows you to implement custom assertion macros or functions that return `testing::AssertionResult`. This approach lets you create expressive, reusable conditions with helpful diagnostics.

### Example: Implementing a Custom Assertion Function

```cpp
#include <gtest/gtest.h>

// Custom assertion to verify two integers are mutually prime.

testing::AssertionResult AreMutuallyPrime(int m, int n) {
  auto gcd = [](int a, int b) {
    while (b != 0) {
      int t = b; b = a % b; a = t;
    }
    return a;
  };

  if (gcd(m, n) == 1) {
    return testing::AssertionSuccess();
  } else {
    return testing::AssertionFailure() << m << " and " << n << " are not mutually prime.";
  }
}

// Usage in a test:
TEST(NumberTest, CheckMutuallyPrime) {
  EXPECT_TRUE(AreMutuallyPrime(3, 4));  // Pass
  EXPECT_FALSE(AreMutuallyPrime(4, 10)); // Fail with message
}
```

### Creating Assertion Macros Using Predicate Format

For richer diagnostics, GoogleTest supports *predicate-format* assertions. These are functions or functors that take expressions as strings along with their values and return `AssertionResult`.

```cpp
// Predicate-formatter example.
testing::AssertionResult AssertMutuallyPrime(
    const char* m_expr, const char* n_expr, int m, int n) {
  // ...logic...
}

// Use with EXPECT_PRED_FORMAT2:
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

This lets GoogleTest print exactly which expressions failed and why.

## Best Practices for Assertions

- Use **fatal** assertions when proceeding beyond a check risks causing crashes or meaningless results.
- Use **non-fatal** assertions to collect multiple failures in one test pass.
- Provide informative messages for **custom assertions** to help diagnose failures.
- Use generalized matchers (`EXPECT_THAT`) for expressive and readable checks.
- Prefer built-in assertions and matchers before implementing custom ones.

## Common Troubleshooting Tips

- Remember that *fatal* failures abort only the current test function, not the entire test program.
- Custom assertions must return `testing::AssertionResult` for integration with GoogleTest.
- Use predicate-format assertions to provide detailed failure messages including the failed expressions.

---

## Additional Resources

For further guidance on assertions and more advanced usage, consult:

- [Assertions API Reference](../api_reference/test_framework_api/assertions.md) — Comprehensive list of all assertion macros.
- [Matchers Reference](../api_reference/mocking_api/matchers_reference.md) — For expressive argument matching.
- [Writing Custom Matchers and Actions Guide](../guides/advanced-usage-patterns/custom-matchers-actions.md) — Extending GoogleTest and GoogleMock.
- [GoogleTest Primer](../guides/core-workflows/authoring-unit-tests.md) — Basic unit testing concepts.

These resources provide progressively deeper insight into using assertions to write effective, maintainable tests.

---

_"Implementing robust assertions with clear semantics ensures your tests are both reliable and informative, enabling fast diagnosis and fixing of defects."_