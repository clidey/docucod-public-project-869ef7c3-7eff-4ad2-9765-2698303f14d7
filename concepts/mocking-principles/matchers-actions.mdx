---
title: "Matchers and Actions Explained"
description: "Learn the conceptual model of matchers and actions in GoogleMock. Discover how matchers allow fine-grained argument validation and how actions specify what a mock should do in response to a call, supporting flexible and readable test definitions."
---

# Matchers and Actions Explained

Discover the foundational concepts behind **matchers** and **actions** in GoogleMock, the powerful C++ mocking framework. This guide explains how matchers enable expressive and precise argument validation for mocked methods, while actions specify what should happen when those methods are invoked. Understanding these concepts is key to writing flexible, readable, and reliable mock-based tests.

---

## Introduction

At the heart of GoogleMock's expressive power lie *matchers* and *actions*. They together let you:

- **Matchers:** Specify conditions that mock method arguments must satisfy.
- **Actions:** Define how mock methods respond when called, including return values, side effects, or invocation of callbacks.

Mastering matchers and actions equips you to write tests that precisely specify expectations and behaviors, catching subtle bugs and ensuring correctness.

---

## Matchers: Fine-Grained Argument Validation

Matchers describe *what* values you expect your mock methods to receive as arguments. They act as predicates and expressive patterns for matching function parameters.

### How Matchers Work in `EXPECT_CALL`

When setting expectations on mock methods using `EXPECT_CALL`, matchers specify argument patterns:

```cpp
EXPECT_CALL(mock_object, Method(matcher1, matcher2, ..., matcherN));
```

- Each argument is paired with a matcher.
- Matchers can be exact values (e.g., `5`), wildcards (`_`), or more complex expressions.
- You may omit the matcher list to accept any arguments (only when mocking non-overloaded methods).

### Common Matchers

- **Underscore `_`** — matches any value (wildcard).

  ```cpp
  EXPECT_CALL(mock, Foo(_)); // Matches Foo called with any argument.
  ```

- **Equality Matchers:** Match exact values, e.g., `Eq(5)` or just `5`.

- **Comparison Matchers:** `Lt(x)`, `Le(x)`, `Gt(x)`, `Ge(x)`, `Ne(x)`.

- **Logical Combinators:** Combine multiple matchers, e.g., `AllOf()`, `AnyOf()`, `Not()`.

- **Pointer Matchers:** `IsNull()`, `NotNull()`, `Pointee(matcher)` validates pointee.

- **Container Matchers:** `ElementsAre(...)`, `UnorderedElementsAre(...)` for STL containers.

- **Field and Property Matchers:** Validate a member or property of an argument.

  ```cpp
  EXPECT_CALL(mock, Process(Field(&MyStruct::value, Eq(10))));
  ```

### Using Matchers Inside `.With()`

Matchers also power `.With()` clauses to provide combined argument constraints:

```cpp
EXPECT_CALL(mock, Method(_, _))
    .With(Lt())  // Args must satisfy matcher Lt()
    .Times(1);
```

### Custom Matchers

You can write custom matchers easily using the `MATCHER` and `MATCHER_P` macros or by implementing matcher classes, enabling reusable, domain-specific validation logic.

### Best Practices for Matchers

- Use specific matchers only for arguments that matter.
- Use `_` (wildcard) for uninteresting arguments to avoid brittle tests.
- Combine matchers with logical operators for compound conditions.
- Avoid over-specifying arguments; this keeps tests robust and maintainable.

---

## Actions: Specifying Mock Method Behavior

Actions define *how* mocked methods behave when called. They allow you to control return values, side effects, callback invocations, and more.

### Actions in `EXPECT_CALL` and `ON_CALL`

You specify actions with:

- `.WillOnce(action)`  — behavior for a single expected call.
- `.WillRepeatedly(action)` — behavior for all calls after `WillOnce`s.
- `.WillByDefault(action)` — sets default behavior in `ON_CALL`.

### Common Built-in Actions

- `Return(value)` — Return a value.
- `ReturnRef(variable)` — Return a reference.
- `ReturnPointee(pointer)` — Return the value pointed to.
- `SetArgPointee<N>(value)` — Set the N-th (0-based) argument’s pointee.
- `SetArrayArgument<N>(first, last)` — Set an array argument’s contents.
- `Invoke(callable)` — Call a function, method, functor, or lambda.
- `InvokeWithoutArgs(callable)` — Call a callable with no arguments.
- `InvokeArgument<N>(args...)` — Invoke the N-th argument if it’s a callable.
- `DoAll(action1, action2, ...)` — Combines multiple actions sequentially.
- `Throw(exception)` — Throws an exception (if enabled).
- `IgnoreResult(action)` — Ignores the result of an action (useful with void methods).

### Writing Custom Actions

You can define actions as lambdas, function objects, or with the `ACTION` macro for complex behaviors.

Example:

```cpp
EXPECT_CALL(mock, DoSomething())
    .WillOnce([]() { DoExtraWork(); return 42; });
```

### Combining Actions with `DoAll`

For behaviors needing multiple side effects, use `DoAll`:

```cpp
EXPECT_CALL(mock, Update(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

This will set the output argument and return true.

### Delegating to Real or Fake Objects

Actions let you delegate default behavior to a real object or a fake implementation, enabling more natural testing without duplicating logic.

### Actions with Move-only Types

GoogleMock supports mocking methods with move-only return types (like `std::unique_ptr`) using actions such as lambdas to return fresh objects.

### Best Practices for Actions

- Use `ON_CALL` for default behaviors, minimizing constraints.
- Use `EXPECT_CALL` to enforce call expectations and specify actions.
- Prefer lambdas for custom logic for clarity.
- Combine actions thoughtfully using `DoAll` for complex side effects.

---

## Expectation Workflow Involving Matchers and Actions

1. **Create mock object:** Instantiate your mock.
2. **Set default behaviors:** Use `ON_CALL` with actions for usual mock responses.
3. **Set expectations:** Use `EXPECT_CALL` with matchers for argument validation and actions for response behavior.
4. **Exercise code:** Run the code using mocks.
5. **Automatic verification:** When mock destructs, GoogleMock verifies all expectations.

---

## Troubleshooting Common Issues

- **Uninteresting calls:** Occur when mock methods without expectations are called. Use `NiceMock` or add expectations with `Times(AnyNumber())` to quiet these.
- **Unexpected calls:** When a call's arguments don't match any set expectation—GoogleMock reports a failure.
- **Overloaded methods:** Use `Const()` or specify exact types in matchers to resolve ambiguity.
- **Too many/few actions:** Warnings occur if `WillOnce` and `WillRepeatedly` do not match `Times` cardinality.
- **Call order violations:** Use `InSequence` or `After` clauses to enforce call order.

---

## Summary

Matchers and actions together form the expressive syntax of GoogleMock for:

- Validating mock method arguments precisely,
- Defining versatile method behaviors,
- Writing maintainable and reliable interaction-based tests.

Mastering these concepts empowers you to craft targeted, robust test cases that reflect your intention clearly and fail fast on deviations.

---

## References for Further Reading

- [Matchers Reference](../api-reference/mocking-framework/matchers.md) — Full list and details of built-in and custom matchers.
- [Actions Reference](../api-reference/mocking-framework/actions.md) — Built-in and custom actions for mock methods.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Comprehensive recipes using matchers and actions.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick syntax reference.
- [Mocking Reference](../api-reference/mocking-framework/mock-object-basics.md) — Basics of mocks, expectations, and usage.

---

## Related Concepts Pages

- [Using and Creating Mock Objects](../guides/mocking-and-advanced-testing/mock-objects.md)
- [Best Practices for Reliable Mock-Based Tests](../guides/mocking-and-advanced-testing/test-doubles-best-practices.md)
- [Matchers and Actions in Mocking](../guides/mocking-and-advanced-testing/using-matchers-and-actions.md)

---

<Info>
Understanding matchers and actions is crucial to leveraging GoogleMock’s full power. Begin by thinking of matchers as filters that let only expected argument values through, and actions as instructions for how the mock should behave when those values arrive.
</Info>
