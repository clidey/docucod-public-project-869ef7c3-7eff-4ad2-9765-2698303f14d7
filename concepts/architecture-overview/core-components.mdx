---
title: "Core Components"
description: "A tour of GoogleTest’s and GoogleMock’s most important building blocks: test cases, test runners, assertions, mocks, and matchers. Learn how these elements interact to power expressive and efficient testing workflows."
---

# Core Components

Explore the foundational building blocks of GoogleTest and GoogleMock—the test cases, test runners, assertions, mocks, and matchers—that power expressive and efficient testing workflows. Understanding these core components enables you to design robust tests that verify your code’s correctness and interaction effectively.

---

## Test Cases and Test Runner

### Test Case
A **test case** in GoogleTest represents a logical grouping of one or more individual tests (test functions). Each test case typically verifies a specific functionality or module in your codebase.

- Defined using the **`TEST`** or **`TEST_F`** macros.
- Encapsulate test logic and assertions.

### Test Runner
The **test runner** orchestrates the execution of all defined test cases in a session, handling initialization, test invocation, result aggregation, and reporting.

- Automatically discovers and runs all tests linked into the binary.
- Supports command-line flags to filter and control test execution.

### Workflow
1. You write one or more test cases.
2. Each test case contains one or more tests or fixtures.
3. The test runner executes them reporting pass/fail statuses.

This flow lets you organize and run tests in a controlled and automated manner.

---

## Assertions

Assertions are the verification checkpoints inside your tests that check if conditions hold, and report failures immediately when they don't. GoogleTest offers a rich set of assertions:

- **Basic Assertions:** `EXPECT_EQ`, `ASSERT_TRUE`, etc., that check values, expressions, and conditions.
- **Rich Assertions:** For more complex matching, like `EXPECT_THAT` with matchers.
- **Death Tests:** Assertions that check program termination under certain conditions.

### Usage Example
```cpp
TEST(SampleTest, SimpleAssertion) {
  int x = 5;
  int y = 5;
  EXPECT_EQ(x, y) << "x and y should be equal";
}
```

Tips:
- Use `ASSERT_` macros when subsequent test code must not run if the assertion fails.
- Use `EXPECT_` macros to continue test execution despite failures, enabling multiple assertions in one test.

---

## Mocks

A **mock** is an object that simulates the behavior of a real component in a controlled way to support interaction-based testing.

### Defining Mocks
- Mocks are defined by subclassing an interface or abstract class and using the `MOCK_METHOD` macro to declare mock methods.
- Each mock method corresponds to a virtual method in the interface.

Example:
```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

### Using Mocks
- Create mock objects in your tests.
- Use `EXPECT_CALL` to set expectations on mock method calls, specifying the expected arguments, call count, order, and behaviors.
- Optionally set default behaviors with `ON_CALL` to specify what happens when the mock method is called but not strictly expected.

Example usage:
```cpp
MockFoo foo;
ON_CALL(foo, GetSize()).WillByDefault(Return(10));
EXPECT_CALL(foo, Describe("test")).Times(1).WillOnce(Return("ok"));
```

### Uninteresting Calls and Mock Strictness
- **Uninteresting calls** are calls to mock methods without expectations.
- By default, GoogleMock warns on these calls (naggy behavior).
- Use `NiceMock<MockFoo>` to silence warnings.
- Use `StrictMock<MockFoo>` to treat uninteresting calls as test failures.

### Mock Life Cycle
- gMock automatically verifies expectations when a mock object is destroyed.
- You can also verify expectations early with `Mock::VerifyAndClearExpectations(&mock)`, but do not set new expectations afterward.
- Use `Mock::AllowLeak(&mock)` to suppress leak warnings if a mock's lifetime intentionally extends beyond the test.

---

## Matchers

Matchers describe the criteria against which mock method arguments are compared.

### Simple Matchers
- Wildcard: `_` matches any argument.
- Equality: `Eq(value)` matches if argument equals `value`.
- Comparison: `Ge(x)`, `Lt(x)`, etc.

### Combining Matchers
- Use `AllOf()`, `AnyOf()`, and `Not()` to compose matchers.

### Advanced Matching
- **Field/Property matchers:** Validate members or getters of complex objects.
- **Pointee:** Matches the value pointed to by a pointer argument.
- **Multi-argument matching:** Use `.With()` clause to match all arguments as a tuple.

Example:
```cpp
EXPECT_CALL(mock, Foo)
  .With(AllOf(Args<0, 1>(Lt()), Args<1, 2>(Gt())))
  .Times(1);
```

### Custom Matchers
- Define new matchers using `MATCHER` macros or by implementing matcher interfaces.
- Enable readable failure messages and custom matching logic.

---

## How These Components Work Together

At test runtime, the test runner executes test cases, which contain assertions to verify outcomes.

Mocks simulate complex dependencies by responding to expected method calls described using matchers and associated actions.

- The mock object records calls and verifies if they match expectations.
- Matchers evaluate arguments to determine which expectation applies.
- Actions define behaviors such as returning values or invoking callbacks when methods are called.

This interplay empowers precise, flexible, and maintainable tests that focus on the behavior of your code.

---

## Practical Tips and Best Practices

- Set expectations (`EXPECT_CALL`) before exercising the code under test.
- Avoid setting expectations after invoking mock methods — behavior is undefined.
- Use `ON_CALL` for default behaviors instead of `EXPECT_CALL` when you don't need to verify calls.
- Create `NiceMock` to reduce noise from uninteresting calls.
- Leverage sequences and `InSequence` to enforce call ordering when needed.
- Avoid over-specifying expectations to prevent brittle tests.
- Use `RetiresOnSaturation()` to control when expectations become inactive.

---

## Troubleshooting

### Unmet Expectations
If a test fails due to unmet expectations:
- Verify that `EXPECT_CALL` is set before the mock method invocation.
- Confirm the argument matchers match actual calls.
- Watch out for call order constraints if using sequences or `.After()`.

### Uninteresting Call Warnings
- Use `NiceMock` if you want to suppress warnings about uninteresting calls.
- Alternatively, explicitly expect and allow calls with `.Times(AnyNumber())` for permissive handling.

### Leaked Mocks
- Use `Mock::AllowLeak(&mock)` if you intentionally keep the mock alive beyond test scope.

---

## Additional Resources

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — concise reference for mocking syntax and usage.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — beginner-friendly tutorial.
- [Mocking Reference](../api-reference/mocking-and-behavior-specification/mocking-method-definitions.md) — detailed documentation on mock methods, expectations, and matchers.
- [Core API and Entry Points](../api-reference/core-testing-interfaces/main-header-entrypoints.md) — foundational API details.

---

By mastering these core components, you equip yourself to write tests that are both expressive and resilient, ensuring your C++ code behaves exactly as intended under all conditions.
