---
title: "Assertions and Matchers: Core Principles"
description: "Delve into the assertion and matcher system, which forms the backbone of GoogleTest’s evaluation engine. Understand the rationale behind assertion results, descriptive messages, fatal vs non-fatal checks, and the flexibility provided by custom matchers and predicates."
---

# Assertions and Matchers: Core Principles

Explore the foundational concepts that drive GoogleTest's assertion and matcher mechanisms. This guide clarifies how assertions evaluate conditions, the significance of descriptive failure messages, the distinction between fatal and non-fatal checks, and the customizable nature of matchers and predicates enhancing test expressiveness.

---

## Understanding Assertions: The Backbone of Evaluation

At the heart of every GoogleTest test lies an *assertion* — a statement verifying that a particular condition holds true. When an assertion succeeds, the test continues silently. When it fails, the framework produces informative feedback crucial for diagnosing issues.

### What Happens When An Assertion Runs?

1. **Evaluation**: The expression inside the assertion macro is evaluated *exactly once* to avoid side-effects.
2. **Result Determination**: The assertion evaluates as *success*, *non-fatal failure*, or *fatal failure*.
3. **Outcome Impact**:
    - *Success*: The test proceeds normally.
    - *Non-Fatal Failure (`EXPECT_`)*: Logs failure, but test continues to execute.
    - *Fatal Failure (`ASSERT_`)*: Aborts the current function immediately, halting further checks in it.

This model balances thoroughness (by logging multiple failures if desired) and safety (by stopping crucial assertions with `ASSERT_`).

<Tip>
Use `EXPECT_*` for checks where continuing the test is meaningful despite failure, and `ASSERT_*` where failure should stop the test to avoid cascading errors.
</Tip>

## Assertion Messages: Clarity Through Context

When an assertion fails, GoogleTest prints:

- The source location: file and line number of the failed assertion.
- The expected and actual values, including the expressions tested.
- A descriptive message, often explaining the reason for failure.

### Custom Failure Messages

Users can append detailed messages to assertions by streaming strings or objects supporting the `<<` operator. This enhances diagnostic utility:

```cpp
ASSERT_EQ(x.size(), y.size()) << "Vectors x and y differ in size";
EXPECT_TRUE(status) << "Status should be true but was false";
```

### Predicate Assertions for Enhanced Messages

Sometimes complex checks cannot be fully expressed with existing macros, causing obscure messages with simple `EXPECT_TRUE()`. GoogleTest empowers users with *predicate assertions* and *predicate-format* assertions to provide clearer failures.

- **Predicate Assertions (`EXPECT_PRED*`)** accept Boolean-returning functions or functors, printing the values of parameters on failure.

- **Predicate-Format Assertions (`EXPECT_PRED_FORMAT*`)** accept functions returning `AssertionResult` and allow customized, detailed failure messages including source expressions and values.

Example of a predicate function returning `AssertionResult` to get expressive messages:

```cpp
#include <gtest/gtest.h>

testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return testing::AssertionSuccess() << n << " is even";
  else
    return testing::AssertionFailure() << n << " is odd";
}

TEST(NumberTest, EvenCheck) {
  EXPECT_TRUE(IsEven(4));  // Success, prints nothing.
  EXPECT_TRUE(IsEven(5));  // Failure, prints: "Value of: IsEven(5)\n  Actual: false (5 is odd)\nExpected: true"
}
```

<Info>
Predicate assertions with `AssertionResult` offer readable insights into why a test failed, exposing values and logic.
</Info>

## Fatal vs Non-Fatal Assertions: Controlling Test Flow

Assertions come primarily in two forms:

| Type            | Macro Prefix | Behavior on Failure                                        |
|-----------------|--------------|-----------------------------------------------------------|
| Fatal           | `ASSERT_`    | Fails and immediately aborts the current function          |
| Non-Fatal       | `EXPECT_`    | Fails but continues execution of the current function      |

### Why Is This Important?

Fatal failures are critical when continuing the test is nonsensical or dangerous (e.g., null dereference). Non-fatal failures enable tests to report multiple errors in one run, speeding up debugging and test refinement.

<Tip>
Avoid placing `ASSERT_*` in non-void functions unless your function returns immediately on failure or uses an out-parameter to return data.
</Tip>

## Flexibility With Custom Matchers and Predicates

GoogleTest offers comprehensive matchers beyond basic equality or Boolean checks, particularly through its integration with GoogleMock. These matchers come with readable syntax and detailed failure messages, allowing for expressive assertions.

### Built-in Matchers and `EXPECT_THAT`

GoogleTest supports using matchers with the `EXPECT_THAT` macro for rich comparisons, e.g.:

```cpp
#include <gmock/gmock.h>

using ::testing::HasSubstr;
using ::testing::MatchesRegex;
...
EXPECT_THAT(foo_string, HasSubstr("needle"));
EXPECT_THAT(bar_string, MatchesRegex("\w*\d+"));
```

Matchers help break down expectations into meaningful, composable conditions.

### Custom Matchers

Users can create their own matchers or predicate functions for highly specific logic, improving reusability and test clarity. When working with predicates returning `AssertionResult`, you provide your own descriptive messages explaining both success and failure.

### Healthier Failure Messages

Custom matchers and `AssertionResult` predicates produce failure messages that expose why the condition failed, showing values and intermediate states rather than terse true/false outputs.

## AssertionResult: Enabling Rich Predicate Checks

GoogleTest represents assertion outcomes with `::testing::AssertionResult` objects. These objects encapsulate:

- A success or failure status.
- Optional detailed messages explaining the result.

### Benefits for Users

Writing predicates returning `AssertionResult` instead of simple bool allows GoogleTest to display detailed failures automatically:

- Values of parameters are shown clearly.
- Custom messages clarify test logic.
- Supports both positive and negative assertion messages for better `EXPECT_TRUE` and `EXPECT_FALSE` outputs.

```cpp
// Predicate returning AssertionResult
::testing::AssertionResult IsNonEmpty(const std::string& s) {
  if (!s.empty()) return ::testing::AssertionSuccess() << "has size " << s.size();
  else return ::testing::AssertionFailure() << "is empty";
}
```

### Connecting with Assertion Macros

You can use predicates with `ASSERT_TRUE()`, `EXPECT_TRUE()`, and with predicate macros:

- `EXPECT_PRED1(IsNonEmpty, sample_string);`
- `ASSERT_PRED_FORMAT1(IsNonEmptyFormatter, sample_string);`

where predicate-format functions take the original source code text as parameters too.

## Best Practices and Tips

- Prefer existing assertion macros (`EXPECT_EQ`, `ASSERT_TRUE`) for simple conditions when possible for clarity and conciseness.
- For complicated scenarios, define predicate functions returning `AssertionResult` or use `EXPECT_THAT` with matchers for expressiveness.
- When writing your own predicate functions, carefully include success and failure messages to help with diagnostics, especially for negative checks.
- Use `SCOPED_TRACE` to add trace messages to nested assertions for better pinpointing failures in subroutines.
- Avoid mixing `ASSERT_` and `EXPECT_` in the same test function without understanding the control flow impact.

## Troubleshooting Common Pitfalls

- **Fatal Assertions in Non-void Functions:** Using `ASSERT_*` in functions returning a value causes confusing compilation errors. Use `EXPECT_*` or redesign functions to return `void` or use out parameters.

- **Opaque Failure Messages:** Using `EXPECT_TRUE()` with complex expressions can hide information. Switch to predicates returning `AssertionResult` or use predicate-format assertions.

- **Single Evaluation of Predicate Arguments:** Assertion macros guarantee arguments are evaluated only once. Ensure your predicates do not have side-effects that cause surprises.

- **Misunderstanding Failure Propagation:** Fatal assertions abort only the current function, not the entire test. To propagate failure, use solutions like exceptions (provided via listeners), `ASSERT_NO_FATAL_FAILURE`, or check `HasFatalFailure()` after calls.

<Tip>
Use GoogleTest's predicate assertions to get clearer, maintainable, and more debuggable tests.
</Tip>

## Summary

GoogleTest's assertion system revolves around **clear evaluation results**, **helpful failure messaging**, and **flexibility for user-defined conditions**. Understanding the difference between fatal and non-fatal checks, leveraging `AssertionResult`-based predicates, and employing expressive matchers lead to powerful, maintainable test suites that reveal the root causes with precision.

---

## See Also

- [GoogleTest Primer - Assertions](../primer.md#assertions)
- [Assertions Reference](../reference/assertions.md)
- [Advanced GoogleTest Topics - Predicate Assertions](../advanced.md#predicate-assertions-for-better-error-messages)
- [Matchers Reference](../reference/matchers.md)
- [Mocking Reference](../reference/mocking.md) for matchers in mock expectations
- [Expressive Assertions and Custom Matchers](../../guides/advanced_testing_patterns/using_matchers_assertions.md)
- [Test Macros and Assertions (API Reference)](../api-reference/core-testing-interfaces/test-macros-assertions.md)

---