---
title: "Customization and Extension Points"
description: "Review the main extension points available for advanced use—custom matchers, custom actions, and hooks for user-defined assertion or reporting logic—empowering sophisticated usage and seamless integration."
---

# Customization and Extension Points

GoogleMock provides robust extension points that empower you to refine and tailor the mocking framework to your advanced testing needs. This page focuses on the primary avenues you can explore for customization: creating custom matchers to validate arguments with bespoke logic, defining custom actions to specify intricate mock behaviors, and hooking into the assertion or reporting mechanism for personalized test diagnostics.

---

## Custom Matchers

Custom matchers let you enrich your tests with semantic validations beyond the built-in matchers. By crafting your own matchers, you can express expectations in terms natural to your domain, leading to clearer, more maintainable tests.

### Why Create Custom Matchers?

- Validate complex object states or computed values.
- Simplify repetitive or complicated argument checks.
- Produce readable error messages tuned to your domain's terminology.

### Defining a Basic Custom Matcher

Use the `MATCHER` or `MATCHER_P` macros for concise matcher definitions:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

// Usage:
EXPECT_CALL(mock_object, Method(IsEven()));
```

For parameterized matchers:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "checks divisibility") {
  return (arg % divisor) == 0;
}

// Usage:
EXPECT_CALL(mock_object, Method(IsDivisibleBy(5)));
```

### Advanced Matcher Classes

For more control over explanation and matching, define a matcher class with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods. This approach lets you provide detailed diagnostics when matches fail.

```cpp
class CloseToZeroMatcher {
 public:
  explicit CloseToZeroMatcher(double threshold) : threshold_(threshold) {}

  bool MatchAndExplain(double value, std::ostream* os) const {
    bool match = std::abs(value) < threshold_;
    if (!match && os) {
      *os << "which differs by " << std::abs(value);
    }
    return match;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "is within " << threshold_ << " of zero";
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "is not within " << threshold_ << " of zero";
  }

 private:
  const double threshold_;
};

::testing::Matcher<double> CloseToZero(double threshold) {
  return ::testing::MakeMatcher(new CloseToZeroMatcher(threshold));
}

// Usage:
EXPECT_CALL(mock_object, Method(CloseToZero(0.01)));
```

### Best Practices for Custom Matchers

- Ensure matchers are *pure functions* free of side effects.
- Use readable descriptions to aid debugging.
- Prefer parametric matchers for reusable validations.
- Leverage existing matcher combinators like `AllOf` and `AnyOf` to build complex conditions.

For more examples and details, see the [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) and the [gMock Cookbook section on Custom Matchers](https://google.github.io/googletest/gmock_cook_book.html#CustomMatchers).


## Custom Actions

Actions define what a mock method does when invoked. While GoogleMock provides many built-in actions, custom actions enable you to model specialized behavior, side effects, or asynchronous operations.

### When to Use Custom Actions

- Simulating complex side effects such as modifying arguments or external state.
- Returning computed or context-sensitive values.
- Delegating calls to external functions or member objects.
- Triggering asynchronous callbacks or synchronization mechanisms.

### Creating a Simple Custom Action with a Lambda or Functor

GoogleMock allows any callable matching the mock method signature as an action:

```cpp
EXPECT_CALL(mock_obj, Method(_))
    .WillOnce([](int arg) {
       // Side effect or computation
       return arg * 2;
    });
```

### Using the `ACTION` Macro

For action definitions requiring access to mock call arguments by position:

```cpp
ACTION(SetToValue) {
  *arg0 = 42;  // Modify the first argument by pointer
}

EXPECT_CALL(mock, ModifyPtr(_))
    .WillOnce(SetToValue());
```

### Parameterized Actions

```cpp
ACTION_P(SetTo, value) {
  *arg0 = value;
}

EXPECT_CALL(mock, ModifyPtr(_))
    .WillOnce(SetTo(99));
```

### Advanced Action Classes

For maximal flexibility, implement a class derived from `ActionInterface<F>` (where `F` is the mocked function signature) that implements `Perform()` accepting the function arguments as a tuple.

```cpp
template <typename F>
class MyAction : public ::testing::ActionInterface<F> {
  Result Perform(const ArgumentTuple& args) override {
    // behavior here
  }
};
```

Use `MakeAction` to convert your implementation to an action usable in `EXPECT_CALL`.

### Composing Multiple Actions

`DoAll()` allows you to combine several actions sequentially. For example:

```cpp
EXPECT_CALL(mock, Method(_))
    .WillOnce(DoAll(SetArgPointee<0>(10), Return(true)));
```

Ensuring the side effect happens and a return value is provided.

### Tips and Considerations

- Custom actions can take ownership of allocated resources and control their lifetime.
- Use `Invoke()` to delegate calls to existing functions, methods, or lambdas.
- Prefer stateless actions when sharing or retesting multiple times.

Learn more from the [Actions Reference](https://google.github.io/googletest/reference/actions.html) and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#NewActions).


## Hooks for Assertion and Reporting

GoogleMock enables you to extend or customize how results of mock expectations and assertions are reported, letting you tailor the diagnostic output or integrate with other tools.

### Custom Assertion Results

You can directly implement custom failure or success logic inside your matchers or actions by printing detailed diagnostic information or calling GoogleTest assertion macros.

Inside a matcher, write to the provided `result_listener` for detailed match explanations.

### Controlling Message Verbosity

Use the flag `--gmock_verbose=` with levels `info`, `warning`, or `error` to tune how chatty GoogleMock is in reporting warnings and informational messages.

### Overriding Default Loggers

GoogleMock exposes macros and configuration hooks that allow you to replace or extend logging and message formatting behaviors.

For example, in `gmock-port.h` you can define macros to customize flags or logging:

```cpp
#define GMOCK_VERBOSE_LEVEL info
```

### Extending Reporting via Listeners (Advanced)

You can write custom event listeners within GoogleTest's framework to intercept test failures and successes, allowing you to hook into GoogleMock's verification process.

This is useful to attach custom sinks, broadcast test results, or integrate with specialized CI systems.

### Practical Tips

- Use `--gmock_verbose=info` during development to get in-depth diagnostics.
- Consider suppressing warnings or controlling reporting in production test runs.
- Explore GoogleTest's `TestEventListener` interface for deeper control over test reporting.

For more, see the [GoogleTest Advanced Guide on Customizing Test Output](https://github.com/google/googletest/blob/main/docs/advanced.md#customizing-test-output).


## Summary

GoogleMock's extension points for customization provide the power and flexibility necessary for advanced, maintainable, and effective test suites. By mastering custom matchers, actions, and reporting hooks, you give yourself the tools to express your test intent clearly, simulate complex behaviors, and gain insightful diagnostics.

---

## References & Further Reading

- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
- [gMock Cookbook: Custom Matchers](https://google.github.io/googletest/gmock_cook_book.html#CustomMatchers)
- [gMock Cookbook: New Actions](https://google.github.io/googletest/gmock_cook_book.html#NewActions)
- [GoogleTest Advanced Guide](https://github.com/google/googletest/blob/main/docs/advanced.md#customizing-test-output)
- See also: [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for basics of EXPECT_CALL, ON_CALL, and usage patterns

---