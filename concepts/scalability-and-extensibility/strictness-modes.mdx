---
title: "Mock Strictness and Behavior Control"
description: "Explore the design rationale behind NiceMock, NaggyMock, and StrictMock, and how these wrappers control the handling of uninteresting or unexpected mock calls. Choose the right mock strictness policy to balance safety and developer productivity."
---

# Mock Strictness and Behavior Control

Explore the design rationale behind NiceMock, NaggyMock, and StrictMock, and how these wrappers control the handling of uninteresting or unexpected mock calls. Choose the right mock strictness policy to balance safety and developer productivity.

---

## Introduction to Mock Strictness

In GoogleMock, mock objects can treat calls that are not explicitly expected in different ways. This behavior is controllable through special wrappers known as **NiceMock**, **NaggyMock**, and **StrictMock**. Understanding these strictness modes is crucial for writing robust tests that balance noise reduction with strict verification.

### What are Uninteresting and Unexpected Calls?

- **Uninteresting Calls:** Calls to mock methods for which no `EXPECT_CALL` expectation is set. These are methods your test does not explicitly care about.
- **Unexpected Calls:** Calls to methods where expectations exist, but the arguments do not match any `EXPECT_CALL` or the call violates cardinality constraints.

By default, mock methods with no expectations are "naggy," meaning they produce warnings when called but do not fail the test.

---

## The Three Strictness Modes Explained

### 1. NiceMock

`NiceMock<T>` is a subclass of the mock class `T` that **silences warnings** for uninteresting calls. It ensures your test output stays clean when irrelevant calls happen, but still enforces explicit expectations.

- **Behavior:**
  - Suppresses warnings for uninteresting calls.
  - Unexpected calls are still treated as errors.
  - Allows easy use with mock classes that have non-default constructors.

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, DoThis());
nice_mock.DoThis();  // No warnings for other unexpecteds.
```

**Use Case:** When you want your test to focus only on specific interactions and avoid noisy warnings about other method calls.

---

### 2. NaggyMock

`NaggyMock<T>` is the default mode of mocks in GoogleMock as of now. It produces warnings when uninteresting calls occur, allowing you to notice unintended interactions without outright failing.

- **Behavior:**
  - Prints warning messages on uninteresting calls.
  - Unexpected calls result in errors.

```cpp
using ::testing::NaggyMock;

NaggyMock<MockFoo> naggy_mock;
// Will print warnings for uninteresting calls.
```

**Use Case:** Useful during test development and debugging to highlight accidental calls.

---

### 3. StrictMock

`StrictMock<T>` is the strictest wrapper that **treats all uninteresting calls as test failures**. It enforces that any call to the mock must be explicitly expected via `EXPECT_CALL`. This leads to very tight control of interactions.

- **Behavior:**
  - Uninteresting and unexpected calls cause test failures.
  - Helps catch unintended API usages promptly.

```cpp
using ::testing::StrictMock;

StrictMock<MockFoo> strict_mock;
EXPECT_CALL(strict_mock, DoThis());
// Any other call will fail the test.
```

**Use Case:** When you want your test to *strictly* verify every interaction, useful in very safety-critical code or when you want to enforce exact usage.

---

## How to Use Strictness Wrappers

All three wrappers are class templates that derive from your mock class and propagate constructors:

- You can instantiate them with the same constructor arguments as your base mock class.
- For example, if your mock class has a constructor that takes parameters, you can pass them directly:

```cpp
NiceMock<MockBar> nice_bar("hello");
StrictMock<MockBar> strict_bar('a', 'b', "c", "d", 1, 2, "e", "f", true, false);
```

This ensures seamless integration with existing mock classes.

---

## Behavior of Uninteresting and Unexpected Calls per Mode

| Strictness Mode | Uninteresting Calls       | Unexpected Calls            |
|-----------------|--------------------------|-----------------------------|
| NiceMock        | No warning, ignored       | Test failure                |
| NaggyMock       | Warning printed           | Test failure                |
| StrictMock      | Test failure             | Test failure                |

- Uninteresting calls happen when no `EXPECT_CALL` matches the method.
- Unexpected calls happen when there are expectations but arguments or call order do not match.

---

## Common Patterns and Recommendations

### Avoiding Warning Noise with NiceMock

If tests produce many "Uninteresting mock function call" warnings that aren't problematic, using `NiceMock` helps keep output clean. This is especially useful during test maintenance and refactoring.

### Using StrictMock for Safety

`StrictMock` forces you to specify **all** expected calls explicitly. This prevents silent changes in code behavior from slipping through tests, providing high confidence.

### Writing Catch-All Expectations

To avoid warnings or errors for some methods while still expecting others, add catch-all expectations:

```cpp
EXPECT_CALL(mock, SomeMethod(_)).Times(AnyNumber());  // Allows any calls to SomeMethod
EXPECT_CALL(mock, SpecialMethod(42)).Times(1);      // Expects SpecialMethod(42) once
```

This prevents warnings from uninteresting calls while checking for important ones.

### Handling Mocks with Non-Default Constructors

The strictness wrappers inherit constructors from the mock class, so they work seamlessly even if your mock class has complex constructors.

---

## Examples

### NiceMock Example

```cpp
using ::testing::NiceMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
};

TEST(TestSuite, NiceMockExample) {
  NiceMock<MockFoo> foo;

  // No expectation for DoThat, so calls won't warn.
  foo.DoThis();
  foo.DoThis();
}
```

### StrictMock Example

```cpp
using ::testing::StrictMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
  MOCK_METHOD(void, DoThat, (), ());
};

TEST(TestSuite, StrictMockExample) {
  StrictMock<MockFoo> foo;

  EXPECT_CALL(foo, DoThis());
  foo.DoThis();

  // Calling DoThat() without expectation fails the test
  // foo.DoThat();  // Test failure!
}
```

---

## Underlying Mechanics (User-Focused)

When you instantiate `NiceMock<T>`, `NaggyMock<T>`, or `StrictMock<T>`, these classes register themselves with GoogleMock's verification engine to control how uninteresting calls are handled during test execution. This registration ensures that:

- **NiceMock** allows calls silently.
- **NaggyMock** prints warnings.
- **StrictMock** converts warnings into failures.

In all cases, explicit expectations (`EXPECT_CALL`) remain the authoritative control and must always be obeyed.

---

## Common Pitfalls and Troubleshooting

- **Nesting Strictness Wrappers Not Supported:** Do not nest wrappers, e.g., `NiceMock<StrictMock<MockFoo>>` is unsupported.
- **Virtual Destructors:** Ensure your mock classes have virtual destructors to avoid undefined behavior with these wrappers.
- **Base Class Mock Methods:** Strictness wrappers only apply to mock methods defined directly in the mock class, not in its base classes.
- **Memory Leaks and AllowLeak:** If mocks are deliberately leaked (e.g., for the lifetime of the test), use `Mock::AllowLeak(pointer)` to suppress leak warnings.

---

## Summary

Choosing the right strictness wrapper for your mocks helps maintain readable, reliable tests:

- Use **NiceMock** to silence noisy but harmless calls.
- Use **NaggyMock** (default) to get warnings about unexpected activity.
- Use **StrictMock** to enforce rigorous adherence to expectations.

Selecting these correctly manages developer productivity and test safety.

---

## See Also

- [GoogleMock Mock Strictness API Reference](https://google.github.io/googletest/reference/mocking.html#mock-strictness)
- [gMock Cookbook – The Nice, the Strict, and the Naggy](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy)
- [GoogleMock for Dummies – Setting Expectations and Default Actions](https://google.github.io/googletest/gmock_for_dummies.html#setting-expectations)
- [Mocking Basics](https://google.github.io/googletest/guides/mocking-and-advanced-scenarios/mocking-basics.html)

---

## References

This documentation is based on [GoogleMock's internal tests and header](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-nice-strict.h) and [unit tests of strictness behaviors](https://github.com/google/googletest/blob/main/googlemock/test/gmock-nice-strict_test.cc).

---

```mermaid
flowchart TD
  subgraph Strictness Wrappers
    N[NaggyMock<T> (default)]
    Ni[NiceMock<T>]
    S[StrictMock<T>]
  end

  subgraph MockObject
    M[MockClass<T>]
  end

  Ni -->|inherits| M
  N -->|inherits| M
  S -->|inherits| M

  M -->|Uninteresting Calls| Warn[Warning]
  M -->|Unexpected Calls| Fail[Test Failure]

  Ni -. suppresses warnings .-> ok1[Ignored]
  N -. warns .-> Warn
  S -. calls fail .-> Fail

  %% Legend
  classDef wrappers fill:#eef,stroke:#66f,stroke-width:2px;
  class N,Ni,S wrappers;

  classDef mock fill:#cfc,stroke:#393,stroke-width:2px;
  class M mock;

  classDef behavior fill:#fcc,stroke:#933,stroke-width:2px;
  class Warn,Fail behavior;

```
```

