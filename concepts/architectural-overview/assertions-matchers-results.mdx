---
title: "Assertions, Matchers, and Results"
description: "Dive into the powerful assertion and matcher mechanisms: how the framework evaluates success and failure, produces diagnostic messages, and allows custom matchers for expressive tests. This page covers the value model, fatal vs. non-fatal assertions, and the pathway from matcher evaluation to result collection."
---

# Assertions, Matchers, and Results

Dive into the powerful assertion and matcher mechanisms of GoogleTest: how the framework evaluates test success and failure, produces detailed diagnostic messages, and empowers you with custom matchers for expressive and maintainable tests. This guide explores the assertion result value model, the distinction between fatal and non-fatal assertions, matcher evaluation, and the lifecycle from verification to result collection.

---

## Understanding Assertions: Foundations of Test Validation

At the heart of GoogleTest are **assertions**—statements that verify the correctness of your code during a test run. Each assertion evaluates a condition and leads to one of three outcomes:

- **Success**: the condition holds true.
- **Non-fatal failure**: the condition fails, but the test continues to execute.
- **Fatal failure**: the condition fails and aborts the current test function immediately.

Choose the appropriate assertion variant (`EXPECT_*` for non-fatal, `ASSERT_*` for fatal) depending on whether it makes sense for the test to continue after a failure occurs.

```cpp
// Example: Checking vector sizes and element equality
ASSERT_EQ(vec1.size(), vec2.size()) << "Vectors lengths differ";
for (size_t i = 0; i < vec1.size(); ++i) {
  EXPECT_EQ(vec1[i], vec2[i]) << "Mismatch at index " << i;
}
```

In this snippet, if the sizes differ, the test aborts immediately (`ASSERT_EQ`). If element values don't match, the test flags the errors but continues (`EXPECT_EQ`) to reveal all discrepancies in one run.


## AssertionResult: The Backbone of Predicate Validation

GoogleTest uses the class `testing::AssertionResult` to represent the outcome of predicate-like checks. Beyond simple boolean values, `AssertionResult` can carry a detailed failure message.

This enables:

- Predicate functions to return rich failure descriptions that enhance test diagnostics.
- Custom predicate-format functions that integrate seamlessly with GoogleTest's macro expectations.

### Example: Custom Predicate with AssertionResult

```cpp
#include <gtest/gtest.h>

testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return testing::AssertionSuccess() << n << " is even";
  else
    return testing::AssertionFailure() << n << " is odd";
}

TEST(NumberTest, IsEvenPredicate) {
  EXPECT_TRUE(IsEven(4));  // Passes
  EXPECT_TRUE(IsEven(3));  // Fails with message '3 is odd'
}
```

This approach produces informative messages that show why predicates failed, improving debugging ease.


## Fatal vs Non-Fatal Assertions

- **Fatal assertions (`ASSERT_*`)** abort the current test function immediately on failure. Use these when continuing would cause invalid test states or crashes.

- **Non-fatal assertions (`EXPECT_*`)** record failures but allow the test to proceed, enabling detection of multiple issues in a single run.

Be mindful that fatal assertions can cause skipped cleanup code, so validate resource management carefully.

## Matchers: Expressive Verification of Values

GoogleTest integrates with GoogleMock’s matcher framework, enabling assertions like `EXPECT_THAT(value, matcher)` for intuitive, readable validation.

### Benefits of Matchers

- Clear, English-like expectations.
- Rich set of built-in matchers for strings, collections, and predicates.
- Compose multiple matchers for complex conditions.
- Custom matchers for domain-specific validations.

### Example Usage

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

TEST(StringTest, MatcherExample) {
  std::string s = "Hello, world!";
  EXPECT_THAT(s, StartsWith("Hello"));
  EXPECT_THAT(s, MatchesRegex("^Hello, [a-z]+!$"));
  int x = 7;
  EXPECT_THAT(x, AllOf(Gt(5), Lt(10)));
}
```

Failure messages generated by matchers include what was expected and the actual values, aiding quick investigation.


## Assertion Evaluation Flow

When an assertion macro like `EXPECT_EQ(a, b)` is invoked:

1. The expressions `a` and `b` are evaluated exactly once.
2. The framework compares values using internal helper functions.
3. If the condition fails, an `AssertionResult` captures failure details.
4. GoogleTest records the outcome, including source location and custom messages.
5. According to the assertion macro kind (`EXPECT_` or `ASSERT_`), the test either continues or aborts.


## Test Results and Reporting: Capturing the Test Outcome

GoogleTest aggregates assertion outcomes into objects representing the test state:

- `TestPartResult`: individual assertions or failures with details like type (fatal/non-fatal), message, source file, and line.
- `TestResult`: accumulates all `TestPartResult`s for a single test, indicates overall test pass/fail, skipped status, and elapsed time.
- `TestInfo`: metadata and `TestResult` for a single test.
- `TestSuite`: aggregates multiple tests and their results.
- `UnitTest`: the overall test program containing all `TestSuites`.

### Handling Skipped and Disabled Tests

- Skipped tests produce special results recorded with the `GTEST_SKIP()` macro.
- Disabled tests (prefixed with `DISABLED_`) are compiled but excluded from execution unless explicitly enabled.


## Logging Additional Information During Tests

You can log key/value pairs using `::testing::Test::RecordProperty(key, value);` to annotate tests with extra data. These entries appear in XML/JSON output useful for automated test reporting.


## Customizing Assertion Messages

Every assertion macro supports streaming custom messages via the `<<` operator, enabling dynamic, context-specific descriptions.

```cpp
EXPECT_EQ(vec.size(), 5) << "Vector size mismatch, actual size: " << vec.size();
```


## Practical Tips and Best Practices

- Prefer `EXPECT_*` over `ASSERT_*` to discover multiple failures in tests.
- Use `AssertionResult`-based predicates for complex condition checks with clear diagnostics.
- Leverage matchers with `EXPECT_THAT` for flexible value validations.
- Include file and line information in test messages for faster debugging.
- Log test properties to enrich automated reports.


## Troubleshooting Common Issues

- **Misplaced Fatal Assertions**: Using `ASSERT_*` inside constructors or destructors will cause compilation errors. Use `SetUp()`/`TearDown()` instead.
- **Skipped Cleanup After Fatal Failures**: Ensure resource release is guaranteed despite early returns from fatal assertions.
- **Opaque Boolean Failures**: Use `AssertionResult` predicates to provide meaningful failure messages.


## Additional Resources

- [GoogleTest Assertions Reference](reference/assertions.md): Comprehensive list of available assertions.
- [GoogleMock Matchers Reference](api-reference/assertions-matchers/expressive-matchers): Learn about expressive matchers.
- [Advanced GoogleTest Topics](docs/advanced.md#predicate-assertions-for-better-error-messages): Guide on writing custom predicates with meaningful messages.
- [Test Results and Reporting](api-reference/core-testing/test-results-and-reporting): Details on test results structure and output.

---