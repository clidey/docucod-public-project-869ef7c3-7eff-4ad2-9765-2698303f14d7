---
title: "Assertions and Failure Semantics"
description: "Learn about the diverse assertion types GoogleTest offers—including equality, inequality, exception and death test assertions—and the distinction between fatal and non-fatal failures. This page highlights how assertion results influence test progression and reporting."
---

# Assertions and Failure Semantics

GoogleTest provides a rich set of assertion types that allow you to verify conditions in your tests with detailed feedback. Understanding these assertion types and how GoogleTest treats assertion failures is essential to writing effective tests that behave as intended and report failures accurately.

This guide provides a clear and practical overview of the diverse assertion macros offered by GoogleTest, including equality, inequality, exception, and death test assertions. You will also learn the distinction between fatal and non-fatal failures, how assertion results impact test execution flow, and how they appear in test reports.

---

## Overview of Assertion Types

Assertions in GoogleTest come primarily in two flavors:

- **Fatal Assertions**: These immediately abort the current function upon failure. They are typically prefixed with `ASSERT_` or macros like `FAIL()`. Because fatal failures abort the function, they prevent further code (including additional assertions) from executing in that scope, thereby stopping flawed test logic early.

- **Non-fatal Assertions**: These signal a failure but allow the current function to continue executing. They are generally prefixed with `EXPECT_` or macros like `ADD_FAILURE()`. Non-fatal failures allow tests to capture multiple problems at once.

### Common Assertion Categories

### 1. Boolean Assertions
- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` - Verify a condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` - Verify a condition is false.

### 2. Equality and Comparison Assertions
- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` - Equality check.
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` - Inequality check.
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)` - Less than.
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)` - Less than or equal to.
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)` - Greater than.
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)` - Greater than or equal to.

### 3. String Assertions
- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` - C-string equality.
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)` - C-string inequality.
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)` - Case-insensitive equality.
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)` - Case-insensitive inequality.

### 4. Exception Assertions
- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(statement, exception_type)` - Expect code to throw a specific exception.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(statement)` - Expect any exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(statement)` - Expect no exceptions thrown.

### 5. Floating-Point Comparisons
- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)` - Approximate equality for floats.
- `EXPECT_DOUBLE_EQ(val1,val2)` / `ASSERT_DOUBLE_EQ(val1,val2)` - Approximate equality for doubles.
- `EXPECT_NEAR(val1,val2, abs_error)` / `ASSERT_NEAR(val1,val2, abs_error)` - Check if values are within specified numeric tolerance.

### 6. Death Test Assertions
- `EXPECT_DEATH(statement, regex)` / `ASSERT_DEATH(statement, regex)` - Verify that executing the statement causes program termination with output matching regex.
- `EXPECT_EXIT(statement, predicate, regex)` / `ASSERT_EXIT(statement, predicate, regex)` - Verify program terminates with exit status satisfying predicate and output matches regex.

---

## Fatal vs. Non-fatal Failures

Understanding how GoogleTest treats failures is critical to controlling test progression:

| Failure Type    | Description                         | Effect on Test Progression                     |
|-----------------|-----------------------------------|-----------------------------------------------|
| Fatal Failure   | Immediate failure stopping function | Current test function exits immediately, skipping remaining statements.
| Non-fatal Failure | Failure recorded but test continues | Subsequent statements and assertions continue executing.

Fatal failures are typically generated by `ASSERT_` macros or explicit `FAIL()` calls. Non-fatal failures are generated by `EXPECT_` macros or `ADD_FAILURE()`.

### Practical Impact

Fatal failures stop execution of the current test function, making them suited for verifying preconditions and critical invariants. Non-fatal failures help gather multiple failures in one test run, enhancing debugging.

### Common Pitfall: Failure Propagation in Subroutines

If an `ASSERT_` macro fails in a utility or subroutine called by a test, only that subroutine returns early. The calling test function continues executing, possibly leading to undefined behavior or crashes.

Example:

```cpp
void Helper() {
  ASSERT_EQ(1, 2); // Fatal failure, aborts Helper
  // This code will not be executed
}

TEST(MyTestSuite, Case) {
  Helper();  // Helper returns immediately on failure
  // Test continues here despite failure
  int* p = nullptr;
  *p = 5;  // Crash!
}
```

#### Solutions to Propagate Fatal Failure

- Use exception-based listeners (where fatal failures throw exceptions caught by GoogleTest).
- Use macros `ASSERT_NO_FATAL_FAILURE(statement)` / `EXPECT_NO_FATAL_FAILURE(statement)` to verify subroutine executions contain no fatal failures.
- Check `HasFatalFailure()` after subroutine calls and return early if true.

---

## Assertion Results and Test Flow

### What Happens When an Assertion Fails?

- **Non-fatal failure** is recorded in the test result but execution continues.
- **Fatal failure** immediately aborts the current test function, but **does not** abort the entire test program or suite.

This design allows:

- Tests to report multiple errors in a single run (using non-fatal failures).
- Avoiding cascading failures after critical errors (using fatal failures).
- Continues running other tests even if some tests fail.

### Skipping Test Execution

You can explicitly skip tests at runtime using:

```cpp
GTEST_SKIP() << "Reason for skipping";
```

This macro aborts the current test, marking it as skipped without failure.

---

## Customizing Failure Messages

All assertion macros accept a message streamed via `<<`, helping you provide context.

Example:

```cpp
EXPECT_EQ(x, y) << "Values differ at index " << i;
```

Failure reports show this message alongside standard diagnostic information.

---

## Predicate and Predicate-Formatter Assertions

Sometimes you want to test complex conditions with informative messages.

GoogleTest provides predicates that return `bool` or `AssertionResult` with custom failure messages, used via macros:

- `EXPECT_PRED*` family for predicates returning bool.
- `EXPECT_PRED_FORMAT*` family for predicates returning `AssertionResult` with customized messages.

Example predicate function returning `AssertionResult`:

```cpp
AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return AssertionSuccess() << n << " is even";
  else
    return AssertionFailure() << n << " is odd";
}
```

Usage:

```cpp
EXPECT_TRUE(IsEven(value));
```

When failing, this prints detailed messages about why.

---

## Exception Assertions

GoogleTest supports verifying if code throws or does not throw exceptions.

- `EXPECT_THROW(statement, ExceptionType)` verifies `statement` throws expected exception.
- `EXPECT_ANY_THROW(statement)` verifies `statement` throws any exception.
- `EXPECT_NO_THROW(statement)` verifies `statement` does not throw.

You can use compound statements inside assertions.

---

## Death Tests

Death assertions verify that code terminates the process, typically when performing critical precondition checks.

- Use `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)`.
- Use `EXPECT_EXIT` for custom exit status.

Death tests run in a subprocess isolated from the main test runner.

Important considerations:
- Death tests should be named in suites ending with `DeathTest` to avoid threading issues and ordering conflicts.
- Operations performed in death tests do not affect the parent process.
- Multiple death tests in one line are not supported.

---

## Additional Logging and Test Properties

You can record extra metadata about a test using:

```cpp
::testing::Test::RecordProperty("key", value);
```

These properties appear in XML test reports, aiding CI integration.

Keys must be valid XML attribute names and not conflict with reserved keys.

---

## Best Practices

- Use `EXPECT_` for checks where test can continue, `ASSERT_` where failure invalidates following test logic.
- Avoid fatal assertions in constructors or destructors; use `SetUp`/`TearDown` instead.
- When using assertions in subroutines, consider failure propagation techniques.
- Use predicate and predicate-format assertions for complex checks with clear messages.
- Use `GTEST_SKIP()` for runtime test skipping with explanations.

---

## Troubleshooting Common Assertion Issues

| Issue                              | Explanation                                             | Solution                                         |
|-----------------------------------|---------------------------------------------------------|------------------------------------------------|
| Confusing output with `EXPECT_TRUE` | No details on parts of complex expressions             | Use predicate assertions or custom messages    |
| Unexpected continuation after `ASSERT_*` | Fatal assertion aborts only the function, not the entire test | Use `HasFatalFailure()` to detect and abort early |
| Compiler error about `void` return | Fatal assertions only allowed in `void` functions      | Change function signature or use non-fatal assertions |
| Death test hangs or deadlocks      | Subprocess or threading issue around death tests       | Review threading; use "threadsafe" style death tests |

---

## Summary

GoogleTest assertions encompass a diverse set of macros for verifying test conditions—from simple booleans and equality to exceptions and process death. The key semantic distinction between fatal and non-fatal failures dictates test flow control. Adequate use of these assertions and their proper failure handling is critical for robust, maintainable, and clear tests.

For complex conditions, advanced predicate assertions enable expressive failure messages. Death tests verify crash and process termination behavior in isolated subprocesses, critical for testing preconditions. GoogleTest also supports recording test metadata and runtime test skipping.

With an understanding of assertion types, failure semantics, and their influence on test progression, you can write tests that are both powerful and reliable.

---

## See Also
- [Assertions Reference](reference/assertions.md)
- [Advanced GoogleTest Topics - Assertions](docs/advanced.md#more-assertions)
- [Running Death Tests](docs/advanced.md#death-tests)
- [Predicate Assertions](reference/assertions.md#predicates)
- [Test Structure & Lifecycle](api-reference/core-testing-apis/test-structure.md)

---

## Example: Propagating Fatal Failures in Subroutines

```cpp
void Helper() {
  ASSERT_NE(needed_value, nullptr) << "Precondition failed in Helper";
  ...  // safe to use needed_value here
}

TEST(FooTest, HandlesHelper) {
  Helper();
  if (::testing::Test::HasFatalFailure()) return;  // Abort if helper failed

  ... // continue testing
}
```

This pattern ensures fatal failures propagate meaningfully through helper functions.

---

## Example: Using Death Assertions

```cpp
TEST(MyDeathTest, CrashesOnNull) {
  EXPECT_DEATH(CallWithNull(nullptr), "Null pointer error");
}
```

This verifies that supplying null pointer causes the program to terminate with matching error output.

---

## Summary
GoogleTest assertion macros balance flexibility and control, providing fatal and non-fatal failures to tailor test flow. Their expressive output, including detailed failure messages and exception and death test support, empower users to detect and diagnose failures with confidence. Mastering assertions is foundational for effective test-driven development with GoogleTest.
