---
title: "Mock Objects & Method Specification"
description: "Delve into the abstraction of mock objects within GoogleMock: how mock methods are defined, how the MOCK_METHOD macros work internally, and the contract between test code and implementation. Gives users a conceptual understanding of what happens when a method is mocked."
---

# Mock Objects & Method Specification

Explore how GoogleMock abstracts mock objects, focusing on the definition of mock methods via the `MOCK_METHOD` macro, the internal contract between user code and the mocked implementation, and what it means to mock a method within your tests.

---

## Understanding Mock Objects in GoogleMock

GoogleMock enables the creation of **mock objects**—stand-ins for real objects—allowing you to specify expected interactions and behaviors in your tests. At the core of this abstraction is the **mocked method**, a method declaration that provides a controllable interface to simulate the behavior of the real method.

### What Is a Mock Method?

A mock method represents a virtual or non-virtual function of a class that you want to simulate or control during testing. Instead of implementing the method to perform its real task, GoogleMock replaces the implementation with generated code that:

- Tracks calls and argument values
- Allows you to specify expected call patterns and return values
- Facilitates verification that code under test interacts correctly

### Defining Mock Methods with `MOCK_METHOD`

The `MOCK_METHOD` macro is the central mechanism by which you declare mock methods inside your mock class. Its syntax closely mirrors a method declaration, split into three main parameters plus an optional fourth for qualifiers.

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Qualifiers));
```

- **ReturnType:** The return type of the mocked method.
- **MethodName:** The name of the mock method you're defining.
- **ArgTypes:** A parenthesized, comma-separated list of argument types.
- **Qualifiers (optional):** Qualifiers like `const`, `override`, `noexcept`, calling conventions (`Calltype(...)`), or reference qualifiers (`ref(...)`).

#### Example

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

#### Dealing with Commas in Types

If any argument or return type contains commas (e.g., templates), GoogleMock requires any type containing commas to be wrapped in extra parentheses, or alternatively, use type aliases to avoid ambiguity.

```cpp
MOCK_METHOD((std::pair<int, int>), GetCoordinates, ()); // Wrap in extra parentheses
// Or
using CoordPair = std::pair<int, int>;
MOCK_METHOD(CoordPair, GetCoordinates, ());
```

### Where to Place `MOCK_METHOD`

Always declare mock methods in the `public:` section of your mock class—even if the original base class method is `protected` or `private`. This accessibility ensures GoogleMock's macros and frameworks can properly access and control the mocked methods during tests.

### Mocking Overloaded Methods

GoogleMock supports mocking overloaded methods naturally. You can declare all overloads using `MOCK_METHOD` with the appropriate signatures. However, if you omit mocking any overload, the compiler will warn about hidden base class functions. Resolve this by using `using BaseClass::MethodName;` to bring hidden base overloads into scope.

Example:

```cpp
class MockFoo : public Foo {
 public:
   using Foo::Add;  // Bring in unmocked overloads explicitly
   MOCK_METHOD(int, Add, (Element x), (override));
   MOCK_METHOD(int, Add, (int times, Element x), (override));
};
```

### Mocking Const, Noexcept, and Reference Qualifiers

If the original function is declared `const`, `noexcept`, or has reference qualifiers (`&`, `&&`), you must list these as qualifiers in the 4th parameter of `MOCK_METHOD`. For instance:

```cpp
MOCK_METHOD(int, GetValue, (), (const, override, noexcept));
MOCK_METHOD(void, Update, (), (override, ref(&)));
```

---

## Contract Between Test Code and Mock Implementation

When you mock a method using `MOCK_METHOD`, GoogleMock generates code that:

- Records invocation counts and argument values
- Matches calls against expectations (`EXPECT_CALL`) and default behaviors (`ON_CALL`)
- Executes the specified action (e.g., return a preset value, invoke a callback)
- Validates call order and cardinality

Your test code interacts with this mock method exactly as though calling a real method but gains full control to assert expectations and define behaviors.

### Key Points of the Contract

- **Virtual Methods:** Typically, only virtual methods can be mocked unless using advanced techniques for non-virtual methods.
- **Call Order:** GoogleMock checks when and how often mocked methods are invoked based on your expectations.
- **Argument Matching:** Calls are matched with the arguments you specify in expectations, allowing fine-grained control.
- **Return Values and Actions:** You can assign return values or actions for each call or a sequence of calls.
- **Overriding Base Implementations:** Mock methods override the base method, so calling these on the mock uses your test behavior, not production code.

### Example Workflow

```cpp
class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
};

MockCalculator mock_calc;
EXPECT_CALL(mock_calc, Add(2, 3)).WillOnce(Return(5));
int result = mock_calc.Add(2, 3);  // Returns 5

// Verify expectations are met on destruction or explicitly
```

### Handling Methods with Complex Signatures

- **By-reference/incomplete types:** You can mock methods with arguments passed by reference to incomplete types, as long as GoogleMock can print those types.
- **Overloaded and const methods:** Use specifying the correct qualifiers and wrapping `const` overloads with `Const()` in expectations.

### Actions and Default Behavior

- If you define **no** actions (`ON_CALL` or `EXPECT_CALL`), GoogleMock uses built-in default actions (e.g., returning default-constructed values).
- Actions specified in `EXPECT_CALL` override default ones.
- You can specify different actions for sequences of calls using multiple `WillOnce()` calls followed by `WillRepeatedly()`.

---

## Common Pitfalls and Best Practices

### Common Pitfalls

- **Forgetting `virtual` on methods:** Only virtual methods are mocked by default.
- **Ignoring the public section:** Declaring mock methods in `private/protected` prohibits `EXPECT_CALL` from accessing them.
- **Incorrect qualifiers:** Ensure qualifiers like `const` and `override` appear correctly.
- **Commas in types:** Properly handle commas with surrounding parentheses or aliases.
- **Not setting action for non-default-constructible return types:** This causes runtime errors.

### Best Practices

- Always use `override` to ensure your mocks match the base class's signature.
- Keep `MOCK_METHOD` declarations simple and in the public section.
- Use type aliases to simplify complex argument or return types.
- Use `ON_CALL` to provide default behaviors shared by multiple tests.
- Use `EXPECT_CALL` to specify stricter call expectations.
- Consider using `NiceMock`, `NaggyMock`, or `StrictMock` for handling uninteresting calls appropriately.

---

## Summary

GoogleMock's mock objects rely on mock methods defined via the `MOCK_METHOD` macro to simulate real method behavior in your tests. By specifying the method signature and optional qualifiers, GoogleMock generates code that tracks method invocations, verifies expectations, and controls the return values or actions for maximum test flexibility. This abstraction is fundamental for writing robust, maintainable, and expressive unit tests in C++.

---

## Additional Resources and Links

- [GoogleMock MOCK_METHOD macro reference](reference/mocking.md#MOCK_METHOD)
- [Using Mocks to Isolate Dependencies Guide](/guides/mocking-and-advanced-patterns/using-mocks)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)
- [Mocking Reference](reference/mocking.md)
- [Mock Strictness Modes](reference/mocking.md#NiceStrictNaggy)

---

## Example Mock Class Definition

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x, const std::string& s), (override));
  MOCK_METHOD(void, Baz, (), (const, override));
};
```

## Example of Using a Mock Method in a Test

```cpp
MockFoo mock_foo;
EXPECT_CALL(mock_foo, Bar(5, "test"))
    .Times(1)
    .WillOnce(Return(42));

int result = mock_foo.Bar(5, "test");
EXPECT_EQ(result, 42);
```

---