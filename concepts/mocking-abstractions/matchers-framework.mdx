---
title: "Matchers and Flexible Argument Matching"
description: "Introduces the matcher system powering both GoogleTest and GoogleMock: how matchers enable expressive assertions and verifications, the matcher protocol, and extensibility for custom matchers. Shows how argument matching forms the backbone for both test assertions and mock verifications."
---

# Matchers and Flexible Argument Matching

GoogleTest and GoogleMock share a powerful matcher system that serves as the backbone for expressive assertions and mock verifications. This system empowers you to specify what arguments you expect or allow in tests in a highly flexible, readable, and reusable way. This page introduces key concepts about matchers, how they function, and how you can extend them to write clear and maintainable tests.

---

## Why Matchers Matter

Imagine you're testing a function that accepts multiple parameters. You often don't care about every argument value precisely but must verify certain conditions on some arguments — perhaps the first argument must be greater than zero or the second argument should be a non-null pointer. Matchers let you specify those conditions declaratively.

Matchers are specs that test whether a single argument meets your criteria. Beyond simply checking for equality, matchers support complex conditions including ranges, types, and even custom predicates.

In GoogleMock, matchers are used in `EXPECT_CALL` and `ON_CALL` to verify or specify the behavior of mock methods by matching their arguments. In GoogleTest, matchers enrich assertions like `EXPECT_THAT` and `ASSERT_THAT`, enabling highly descriptive and flexible tests.

By using matchers, you gain:

- **Expressive Tests:** Clearly describe argument expectations.
- **Reduced Test Brittleness:** Avoid hardcoding transient details.
- **Composability:** Build complex conditions from simple matchers.
- **Extensibility:** Create custom matchers tailored to your domain.

---

## Matcher Basics

### What is a Matcher?

A matcher binds to a single value and checks whether that value meets some condition. When using `EXPECT_CALL(mock, method(matchers...))`, each matcher corresponds to the function arguments.

Literal values (such as `100`) used in place of a matcher are automatically converted to equality matchers (`Eq(100)`). You can always prefer explicit matchers to avoid subtle bugs.

### Wildcard Matchers

- `_` — Matches any value of the expected type.
- `A<T>()` or `An<T>()` — Matches any value of type `T`.

### Matching by Comparison

Matchers like `Eq(value)`, `Ne(value)`, `Ge(value)`, `Gt(value)`, `Le(value)`, and `Lt(value)` allow matching based on comparisons.

Example:
```cpp
EXPECT_CALL(foo, DoThis(Ge(5)));
```
This expects the first argument to be greater than or equal to 5.

### Boolean and Null Matchers

- `IsTrue()`, `IsFalse()` — Matches if value evaluates to true/false.
- `IsNull()` — Matches null pointers.
- `NotNull()` — Matches non-null pointers.

### Floating Point Matchers

Use specialized floating-point matchers that handle precision and NaN cases correctly:
- `DoubleEq()`, `FloatEq()` for approximate floating-point equality.

---

## Container and Compound Matchers

For STL-style containers and tuples, matchers let you specify rich element-wise criteria.

### Common Container Matchers

- `Contains(e)` — Container contains element `e`.
- `Each(e)` — Every element matches `e`.
- `ElementsAre(e0, e1, ..., en)` — Matches exact sequence.
- `UnorderedElementsAre(e0, e1, ..., en)` — Matches elements ignoring order.
- `SizeIs(m)` — Container size matches matcher `m`.
- `IsEmpty()` — Container is empty.

Example:
```cpp
EXPECT_CALL(mock, Foo(ElementsAre(1, Gt(0), _, 5)));
```

### Tuples and Pairs

- `Pair(m1, m2)` — Matches `std::pair` where `first` matches `m1` and `second` matches `m2`.
- `FieldsAre(m1, m2, ...)` — Matches tuple or aggregate types field-wise.

Example:
```cpp
EXPECT_THAT(my_pair, Pair(Ge(5), StrEq("foo")));
EXPECT_THAT(my_tuple, FieldsAre(1, "hello", Lt(10)));
```

### Matching Elements with Functions

- `ResultOf(f, m)` — Matches if applying function `f` to an object matches matcher `m`. Useful to test computed values.

### Pointer and Smart Pointer Matchers

- `Pointee(m)` — Matches a pointer pointing to a value that satisfies matcher `m`. Null pointers never match.
- `Pointer(m)` — Matches the pointer value itself.
- `Address(m)` — Matches the address of an object.
- `Ref(var)` — Matches arguments referencing a specific variable.
- `WhenDynamicCastTo<T>(m)` — Matches an object after dynamic cast to `T`.

---

## Multi-Argument and Composite Matchers

### Multi-Argument Matchers

Matchers match a *single* argument but you can match multiple arguments combined as a tuple.

- `AllArgs(m)` — Applies matcher `m` to all arguments as one tuple.
- `Args<N1, N2, ..., Nk>(m)` — Applies matcher on selected argument indices.

Example:
```cpp
EXPECT_CALL(mock, Func(_, _, _))
    .With(AllArgs(Lt())); // All arguments are less than the next
EXPECT_CALL(mock, Func(_, _, _))
    .With(Args<0, 2>(Gt())); // Arguments 0 and 2 are greater than the next
```

### Composite Matchers

Build compound matchers from simpler ones:

- `AllOf(m1, m2, ..., mn)` — Matches if all sub-matchers match.
- `AnyOf(m1, m2, ..., mn)` — Matches if any sub-matcher matches.
- `Not(m)` — Matches if `m` does not match.
- `Conditional(cond, m1, m2)` — Matches `m1` if `cond` is true, else `m2`.

---

## Defining Custom Matchers

If the built-in matchers don't cover your needs, you can define custom matchers easily.

### Using the `MATCHER` Macros

- `MATCHER(Name, Description) { statements; }` — Define a simple matcher.
- `MATCHER_P(Name, param, Description) { statements; }` — Define parameterized matcher.

Example:
```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_THAT(value, IsDivisibleBy7());
```

Descriptions may reference `negation` boolean and matcher parameters for richer output.

### Implementing Matcher Interface Directly

For advanced cases, implement `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods directly to gain full control.

---

## Using Matchers in Tests

### In GoogleMock Expectations

Matchers go inside `EXPECT_CALL` and `ON_CALL` to specify what arguments are expected or allowed.

Example:
```cpp
EXPECT_CALL(mock, Foo(Ge(0), NotNull()));
```

### In GoogleTest Assertions

Matchers are used with macros like `EXPECT_THAT` and `ASSERT_THAT`:

```cpp
EXPECT_THAT(actual_value, HasSubstr("hello"));
```

### Tips and Best Practices

- Use explicit matchers rather than implicit equality where ambiguity might occur.
- Use `_` for wildcards when arguments don't matter.
- Combine matchers to express rich conditions without over-specifying.
- Share complex matchers as variables to improve maintainability.
- Use `Matches(matcher)` when a matcher needs to be used as a predicate function.

---

## Troubleshooting and Common Pitfalls

- Beware of implicit conversions causing unexpected matcher matches.
- Ensure matchers have no side effects since they may be invoked multiple times or out of expected order.
- When matching pointers, remember `Pointee(m)` fails for null pointers.
- When mocking overloaded functions, be explicit with matcher types to disambiguate.

---

## Summary

Matchers form the core expressive power behind GoogleTest and GoogleMock's assertion and mocking capabilities. By composing and writing matchers, you precisely control what arguments your tests expect and check, enabling robust, readable, and maintainable test code.

To master GoogleTest and GoogleMock:

- Start with built-in matchers listed in the [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md).
- Explore the [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for practical introductions.
- Use `EXPECT_THAT` in your tests for flexible value verification.
- Consider writing custom matchers using `MATCHER` macros for domain-specific needs.

---

## Additional Resources

- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md) — In-depth documentation of all built-in matchers.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Guide to using mocks and expectations.
- [Using Mocks to Isolate Dependencies](https://google.github.io/googletest/guides/mocking.html#using) — Best practices for mocks.
- [Custom Actions and Matchers Guide](https://google.github.io/googletest/guides/mocking-advanced.html#custom-matchers)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/reference/primer.md) — Foundational testing concepts.

---

For next steps, consider diving into how matchers integrate with `EXPECT_CALL` for mocks, and how to write and combine assertions in your GoogleTest test suites.