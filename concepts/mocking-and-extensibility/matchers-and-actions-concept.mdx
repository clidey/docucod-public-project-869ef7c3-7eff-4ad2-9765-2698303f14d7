---
title: "Matchers and Actions: Expressive Test APIs"
description: "Introduces the concept of matchers for argument verification and actions for specifying return behaviors. Explains how matchers make tests more expressive and how users can compose or extend matchers and actions for advanced testing patterns."
---

# Matchers and Actions: Expressive Test APIs

GoogleTest and GoogleMock provide powerful constructs—*matchers* and *actions*—that help you write expressive, precise, and maintainable tests involving mock objects. This page introduces these concepts and guides you on how to use them effectively to verify argument values and specify behaviors for mock methods.

---

## What Are Matchers?

Matchers specify *how* arguments passed to mock methods are validated. They are predicates that describe the expected properties of function arguments instead of requiring explicit constant comparisons.

### Why Use Matchers?

Imagine you want to verify that a mock method is called with a value greater than 5 — instead of writing verbose, rigid code that checks exact values, matchers let you express intent clearly:

```cpp
using ::testing::Gt;  // Greater Than
EXPECT_CALL(mock_obj, Foo(Gt(5)));  // Expect Foo called with argument > 5
```

Matchers give you:

- **Flexibility:** Match arguments based on properties, ranges, patterns, or custom logic.
- **Clarity:** Express the test’s intent naturally, enabling easier maintenance.
- **Composition:** Combine multiple matchers logically for complex criteria.

### Built-In Matchers Examples

| Matcher              | Description                                | Example Usage                           |
|----------------------|--------------------------------------------|----------------------------------------|
| `_` (wildcard)       | Matches any value                           | `EXPECT_CALL(mock, Bar(_));`            |
| `Eq(value)`          | Equals the specified value                  | `EXPECT_CALL(mock, SetCount(Eq(10)));`  |
| `Ge(value)`          | Greater than or equal to                     | `EXPECT_CALL(mock, SetLevel(Ge(3)));`   |
| `HasSubstr(str)`     | String contains a substring                  | `EXPECT_CALL(mock, Log(HasSubstr("error")));` |
| `NotNull()`          | Pointer is not null                          | `EXPECT_CALL(mock, SavePointer(NotNull()));` |


Check out the [Matcher Library](../api-reference/matchers-and-assertions/matcher-library) page for a complete list and advanced usage.

### Custom Matchers

When built-in matchers aren't enough, you can create custom matchers using:

- The [`MATCHER`](./gmock_cook_book.md#NewMatchers) family of macros for concise definitions.
- Implementing the matcher interface directly for more control.

Example:

```cpp
MATCHER(IsEven, "is an even number") {
  return (arg % 2) == 0;
}
...
EXPECT_CALL(mock, ProcessValue(IsEven()));
```

### Matching Multiple Arguments

With `.With()` on an expectation, you can apply a matcher using *all* arguments as a tuple for cross-argument correlation:

```cpp
using ::testing::Lt;
EXPECT_CALL(mock, Compare(_, _))
    .With(Lt());  // First argument less than second
```

---

## What Are Actions?

Actions define *what* a mock method does when it is called. By specifying actions, you can simulate behaviors, control return values, generate side-effects, and tailor mock behavior dynamically.

### Default Behavior

Mock methods with built-in or default-constructible return types will have built-in default actions (e.g., returning zero for integers, `false` for booleans, `nullptr` for pointers). If the default doesn’t suit, you declare custom actions.

### Typical Actions

| Action                      | Description                                                  | Example Usage                                 |
|-----------------------------|--------------------------------------------------------------|-----------------------------------------------|
| `Return(value)`              | Returns the specified value                                  | `EXPECT_CALL(mock, GetVal()).WillOnce(Return(42));` |
| `ReturnRef(variable)`        | Returns a reference to a variable                            | `EXPECT_CALL(mock, GetRef()).WillRepeatedly(ReturnRef(obj));` |
| `ReturnPointee(ptr)`         | Returns the value pointed to by a pointer                    | `EXPECT_CALL(mock, GetFlag()).WillOnce(ReturnPointee(&flag));` |
| `DoAll(a1, a2, ..., an)`     | Executes multiple actions in sequence, returns last action’s result | `EXPECT_CALL(mock, Save(_)).WillOnce(DoAll(SetArgPointee<0>(val), Return(true)));` |
| `SetArgPointee<N>(val)`      | Assigns a value to the `N`th pointer argument                 | `EXPECT_CALL(mock, ReadData(_)).WillOnce(SetArgPointee<0>(42));` |
| `Invoke(f)`                  | Calls a user function, functor, or lambda with the mock method’s arguments | `EXPECT_CALL(mock, Compute(_)).WillOnce(Invoke(MyComputeFunction));` |
| `InvokeWithoutArgs(f)`       | Calls a function or functor that takes no arguments          | `EXPECT_CALL(mock, Reset()).WillOnce(InvokeWithoutArgs(ResetCount));` |
| `InvokeArgument<N>(args...)` | Invokes the `N`th argument (must be callable) with provided arguments | `EXPECT_CALL(mock, AsyncCall(_)).WillOnce(InvokeArgument<0>(5));` |

### Setting Default Actions with `ON_CALL`

You can define the behavior of mock methods generally without setting expectations using:

```cpp
ON_CALL(mock, Foo(_))
    .WillByDefault(Return(0));
```

This sets what will happen when the mock method is called and no matching expectation exists.

### Combining Actions

Some scenarios require multiple effects when a method is called. Use `DoAll()` to chain actions:

```cpp
EXPECT_CALL(mock, Update(_))
    .WillOnce(DoAll(SetArgPointee<0>(new_val), Return(true)));
```

### Actions with Side Effects

Mock methods can modify output parameters, simulate throwing exceptions, or invoke callbacks, enabling fine-grained simulation of dependencies.

Example of setting an output parameter and returning a value:

```cpp
EXPECT_CALL(mock, GetData(_))
    .WillOnce(DoAll(SetArgPointee<0>(100), Return(true)));
```

### Using Lambdas and Functors

Any callable matching the mock method’s signature can be used as an action:

```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce([](int x) { return x * 2; });
```

---

## Best Practices

- Use matchers to make tests flexible but precise; avoid over-specification.
- Favor `ON_CALL` to set default behavior and use `EXPECT_CALL` only to specify essential expectations.
- Organize expectations for ordered or partially ordered calls using sequences.
- Use `RetiresOnSaturation()` to ensure expectations don't remain sticky if not desired.
- Utilize `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to control verbosity and strictness.

---

## Troubleshooting Common Pain Points

- **Uninteresting Calls Warnings:** Use `NiceMock` or add catch-all expectations with `.Times(AnyNumber())` to suppress if intentional.
- **Argument Matching Ambiguities:** For overloaded methods, provide precise argument matchers or use `Const()` to disambiguate.
- **Side Effect Ordering:** Use `InSequence` or `.After()` clauses for controlling call order when needed.

---

## Related Documentation

- [Matchers Reference](../api-reference/matchers-and-assertions/matcher-library) — Comprehensive list of built-in and custom matcher capabilities.
- [Actions Reference](../docs/reference/actions.md) — Complete descriptions and examples of built-in and custom actions.
- [GoogleMock Cookbook](../docs/gmock_cook_book.md) — Practical recipes including advanced mocking techniques and creating custom matchers and actions.
- [Expectations & Actions API Reference](../api-reference/mocking-api/expectations-and-actions) — In-depth API details.

---

Mastering matchers and actions lets you wield GoogleMock's full power, writing tests that are precise in verification and rich in behavioral simulation. They form the foundation to robust mocking, interaction-based testing, and expressive, maintainable test suites.