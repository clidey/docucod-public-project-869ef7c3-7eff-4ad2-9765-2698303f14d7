---
title: "Mock Object Model & Expectations"
description: "Learn the foundational concepts of GoogleMock’s mock object model: how you define, inject, and configure mock objects to isolate and verify unit behavior. This section details expectation setting, verification, call ordering, and how strictness controls (NiceMock, StrictMock) support different testing philosophies."
---

# Mock Object Model & Expectations

GoogleMock’s mock object model empowers you to create mock objects that isolate and verify the behavior of units under test. This guide presents a comprehensive exploration of how to define mock objects, configure them with expectations, and control their strictness and call ordering to shape test interactions precisely.

---

## Understanding Mock Objects

At its core, a **mock object** is a test double that mimics the interface of a real object. GoogleMock provides tools to define mock classes with mocked methods, set expectations on the methods’ calls, and specify the behavior of these mock methods during test execution.

### Defining a Mock Object

Mock classes are defined using the `MOCK_METHOD` macro. This macro declares methods in a mock class that correspond to virtual methods in a real interface or class. It automatically generates implementations that GoogleMock intercepts to control and verify behavior.

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, DoSomething, (int x), (override));
};
```

These mock methods must be declared `public` in the mock class—even if the real class declares them as `protected` or `private`—to enable external access for setting expectations and behaviors.

### Expectation Setting

Expectations specify which method calls are expected during test execution, including the arguments they receive, how many times they occur, their order relative to other calls, and the behavior upon invocation. The primary mechanism to set expectations is the `EXPECT_CALL` macro.

```cpp
EXPECT_CALL(mock_object, Method(matchers))
    .With(multi_argument_matcher)
    .Times(cardinality)
    .InSequence(sequences...)
    .After(expectations...)
    .WillOnce(action)
    .WillRepeatedly(action)
    .RetiresOnSaturation();
```

GoogleMock processes these clauses to precisely match method calls during the test run.

## Key Expectation Concepts

### Argument Matchers

When you specify `EXPECT_CALL(mock, Method(_))`, you use matchers to define what argument values are acceptable. Matchers can be specific values or complex predicates.

Example: Expect a call with the first argument less than the second:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());
```

Here, the `.With()` clause takes a matcher over the tuple of all arguments.

### Cardinality (`Times` Clause)

The `.Times()` clause controls how many times the expectation must be satisfied. GoogleMock supports:

| Cardinality      | Meaning                                              |
|------------------|------------------------------------------------------|
| `AnyNumber()`    | Any number of calls permitted                          |
| `AtLeast(n)`     | At least *n* calls expected                            |
| `AtMost(n)`      | At most *n* calls allowed                              |
| `Between(m,n)`   | Between *m* and *n* calls inclusive                    |
| `Exactly(n)` or `n` | Exactly *n* calls expected (0 means disallowed calls) |

If omitted, cardinality is inferred based on presence of `.WillOnce()` and `.WillRepeatedly()` clauses.

### Call Ordering Controls

#### Sequences via `InSequence`

Use `InSequence` objects to specify that calls occur strictly in the order the expectations are declared.

```cpp
Sequence seq;
EXPECT_CALL(mock, A()).InSequence(seq);
EXPECT_CALL(mock, B()).InSequence(seq);
```

Here, `A()` must be called before `B()`.

#### Partial Ordering via `After`

`After()` restricts an expectation such that it must occur after one or more other expectations (provided as `Expectation` or `ExpectationSet` objects).

```cpp
Expectation e1 = EXPECT_CALL(mock, InitX());
EXPECT_CALL(mock, DoSomething()).After(e1);
```

This controls flexible partial orders beyond strict linear sequences.

### Call Actions

Actions define what a mock method does when called. They are specified with `.WillOnce()` and `.WillRepeatedly()`.

```cpp
EXPECT_CALL(mock, GetNumber())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

The first two calls return 1 and 2 respectively; subsequent calls return 3.

### Retiring Expectations

By default, expectations remain active after being satisfied ("sticky"), which can cause upper bound violations if called more times. Use `.RetiresOnSaturation()` to retire an expectation upon reaching its upper call bound.

```cpp
EXPECT_CALL(mock, Method())
    .Times(2)
    .RetiresOnSaturation();
```

Once two calls are matched, the expectation retires and will no longer match calls.

## Strictness Controls: NiceMock, NaggyMock, StrictMock

GoogleMock provides wrappers to control how uninteresting calls (calls to mock methods without matching expectations) are handled.

| Wrapper            | Behavior on Uninteresting Calls                 |
|--------------------|--------------------------------------------------|
| `NiceMock<T>`      | Suppresses warnings                               |
| `NaggyMock<T>` (default) | Warns on uninteresting calls                    |
| `StrictMock<T>`    | Treats uninteresting calls as test failures      |

`NiceMock` and `StrictMock` inherit constructors from the underlying mock type `T`. Use them to tune the strictness of your mock objects to suit your testing philosophy.

## Verification and Resetting

GoogleMock verifies all expectations on a mock when it is destructed. You can also explicitly force verification at any point using:

```cpp
Mock::VerifyAndClearExpectations(&mock_object);
```

This clears the current expectations on the mock object. Use this carefully—setting new expectations after verifying and clearing is undefined behavior.

Similarly, `Mock::VerifyAndClear()` will verify and clear expectations **and** default actions.

## Handling Edge Cases and Common Patterns

- **Uninteresting Calls:** Calls to mock methods without `EXPECT_CALL` generate warnings by default unless wrapped in `NiceMock` or `StrictMock`.
- **Unexpected Calls:** Calls that do not match any expectation arguments cause test failures.
- **Multiple Expectations:** GoogleMock matches calls to the last matching expectation set, allowing layering of general and specific expectations.
- **Deleting Mocks During Actions:** It’s safe to delete a mock object within an action attached to its methods.

## Working with Sequences and Partial Orders

GoogleMock uses `Sequence` and `InSequence` to enforce call orderings. The implicit sequence created by an `InSequence` object enforces strict linear order across all expectations declared within its scope.

You can also construct partial orderings using multiple `Sequence` instances and the `InSequence()` clause with multiple sequences or by using `.After()` with `Expectation` and `ExpectationSet` objects.

## Summary of Expectation Clauses and Their Order

When chaining clauses on `EXPECT_CALL`, the order of clauses must be:

1. `.With()` (optional, and used at most once)
2. `.Times()` (optional, at most once)
3. `.InSequence()` (optional, multiple times allowed)
4. `.After()` (optional, multiple times allowed)
5. `.WillOnce()` (optional, multiple times allowed)
6. `.WillRepeatedly()` (optional, at most once)
7. `.RetiresOnSaturation()` (optional, at most once)

Violating this order will trigger compile-time or runtime errors.

## Troubleshooting and Common Pitfalls

- Forgetting to specify `WillByDefault()` in `ON_CALL` leads to undefined behavior or runtime errors, as default actions are mandatory.
- Misordering clauses like `.With()` or `.Times()` in `EXPECT_CALL` leads to failures.
- Too many or too few actions relative to cardinalities cause warnings.
- Uninteresting calls may produce warnings—use `NiceMock` or explicit expectations with `Times(AnyNumber())` to suppress.
- Over-saturating expectations (calling a method more times than specified) causes default actions to trigger and failures to be reported.

---

### Practical Example

```cpp
class MockDatabase {
 public:
  MOCK_METHOD(void, Connect, (const std::string&), ());
  MOCK_METHOD(bool, Query, (const std::string& sql), ());
};

TEST(DatabaseTest, QueryExecution) {
  MockDatabase db;

  EXPECT_CALL(db, Connect("localhost"));
  EXPECT_CALL(db, Query(_))
      .Times(2)
      .WillOnce(Return(true))
      .WillOnce(Return(false))
      .RetiresOnSaturation();

  db.Connect("localhost");
  EXPECT_TRUE(db.Query("SELECT * FROM users"));
  EXPECT_FALSE(db.Query("SELECT * FROM orders"));
}
```

This illustrates defining a mock, setting ordered expectations with return behaviors, and running tests that verify interaction.

---

## Summary

This guide details how to define mock objects in GoogleMock, specify expectations through `EXPECT_CALL`, default behaviors with `ON_CALL`, manage call order with sequences and partial orders (`InSequence`, `After`), and customize strictness with wrappers like `NiceMock` and `StrictMock`. It also highlights common usage patterns, restrictions on clause orders, and troubleshooting strategies.

---

## See Also

- [Mocking Reference](../reference/mocking.md) — in-depth syntax and APIs for mocks
- [gMock Cookbook](../gmock_cook_book.md) — practical recipes and advanced techniques
- [Actions Reference](../reference/actions.md) — detailed list of actions
- [gMock Cheat Sheet](../gmock_cheat_sheet.md) — quick usage summary
- [Understanding Uninteresting vs Unexpected Calls](../reference/mocking.md#uninteresting-vs-unexpected)

---

<AccordionGroup title="Key Concepts in Mock Object Model">
<Accordion title="Defining Mock Methods with MOCK_METHOD">
Use the `MOCK_METHOD` macro in your mock class's public section to declare mock methods that correspond to methods in the mocked interface. Proper use includes handling constness, overrides, and dealing with complex argument types.
</Accordion>
<Accordion title="Setting Expectations with EXPECT_CALL">
`EXPECT_CALL` creates an expectation that a mock method will be called with specified arguments, call counts, orderings, and defines call behaviors via chained clauses.
</Accordion>
<Accordion title="Default Behavior with ON_CALL">
`ON_CALL` specifies the default behavior for calls matching argument patterns without requiring the call to happen (no verification).
</Accordion>
<Accordion title="Call Cardinalities and Actions">
Control how many times a method should be called with `.Times()`. Use `.WillOnce()` and `.WillRepeatedly()` to define the actions performed on calls.
</Accordion>
<Accordion title="Controlling Call Order">
Use `Sequence` and `InSequence` to enforce a strict call order, and `After` to specify partial order constraints.
</Accordion>
<Accordion title="Managing Uninteresting Calls via Strictness Wrappers">
Wrap your mock object in `NiceMock`, `NaggyMock` (default), or `StrictMock` to control how uninteresting calls are treated—silenced, warned, or errors, respectively.
</Accordion>
</AccordionGroup>