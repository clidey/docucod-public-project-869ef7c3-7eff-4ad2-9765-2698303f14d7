---
title: "Mocking and Behavioral Testing Concepts"
description: "Understand the core principles behind GoogleMock's approach to mocking objects, defining expectations, and capturing behavioral interactions. Includes cardinalities, actions, and flexible expectation patterns."
---

# Mocking and Behavioral Testing Concepts

Understanding the core principles behind GoogleMock's approach to mocking objects, defining expectations, and capturing behavioral interactions is essential to effectively use the framework in your C++ tests. This guide walks you through the foundational concepts such as mock classes, expectations, cardinalities (call counts), actions, and flexible patterns for verifying interactions.

---

## What Is GoogleMock?

GoogleMock (gMock) is a framework that helps you create mock objects in C++. These mock objects simulate real objects by implementing the same interface, allowing you to specify at runtime:

- Which methods to expect to be called
- How many times they will be called
- What arguments they should receive
- What their return values or side effects should be

This facilitates *interaction-based testing*, where you verify how code interacts with its dependencies instead of just checking final state.

### Mock Objects vs. Fakes

- **Mocks** are objects pre-programmed with expectations about their interactions.
- **Fakes** have working, possibly simplified, implementations used for testing.

Mocks verify *behavioral contracts* while fakes serve as lighter real substitutes.

---

## Defining Mock Classes

At the core, you define mock classes by inheriting from an interface or base class and implementing mock methods using the `MOCK_METHOD` macro. This macro automatically generates the mocking plumbing.

### Mock Class Highlights

- Mock methods must be declared `virtual` in the base class.
- The mock methods are declared in the `public` section, regardless of base visibility.
- For overloaded methods, mock each overload explicitly.
- For template classes, mock them just like normal classes.
- Define mocks using `MOCK_METHOD(ReturnType, MethodName, (Args...), (qualifiers));` syntax.

#### Example

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

---

## Setting Expectations on Mock Methods

### EXPECT_CALL

To specify how a mock method is expected to be called, use `EXPECT_CALL`:

```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- You specify argument matchers to filter calls.
- Use `Times()` to define how many times the call is expected.
- Specify what the call does using actions like `Return()`, `Invoke()`, etc.

### Cardinalities (Times)

Control the number of expected calls:

| Cardinality     | Meaning                                   |
|-----------------|-------------------------------------------|
| `Exactly(n)` or `n` | Called exactly *n* times (0 means never called). |
| `AtLeast(n)`    | Called at least *n* times                 |
| `AtMost(n)`     | Called at most *n* times                  |
| `Between(m, n)` | Called between *m* and *n* times          |
| `AnyNumber()`   | Called any number of times                |

If omitted, gMock infers cardinality based on the presence of `.WillOnce` or `.WillRepeatedly`.

### Actions on Calls

Actions declare what happens when the mock method is invoked.

Common actions include:

- `Return(value)`: Return a given value.
- `ReturnRef(variable)`: Return a reference to a variable.
- `Invoke(function or lambda)`: Call a custom function or lambda.
- `SetArgPointee<N>(value)`: Set the pointed-to value of output argument `N`.
- `DoAll(action1, action2, ...)`: Perform a series of actions.

If no action is specified, default actions happen (return zero, default-constructed value, etc.).

### Ordering Expectations

By default, calls can occur in any order. To enforce order:

- Use `InSequence` to enforce strict ordering within a scope.

```cpp
{
  InSequence seq;
  EXPECT_CALL(foo, A());
  EXPECT_CALL(foo, B());
}
// Now A() must be called before B()
```

- Use `After` to declare partial ordering with more flexibility.

---

## Understanding Uninteresting and Unexpected Calls

- **Uninteresting calls** are calls to methods with no `EXPECT_CALL` set.
  - By default, these generate warnings.
  - You can suppress warnings by using `NiceMock`.
- **Unexpected calls** are calls that don't match any active `EXPECT_CALL`.
  - These always generate test failures.

## Controlling Mock Strictness

gMock provides wrappers to control how uninteresting calls are treated:

| Wrapper           | Behavior on uninteresting calls        |
|-------------------|---------------------------------------|
| `NiceMock<T>`     | Suppresses warnings for uninteresting calls (default becoming). |
| `NaggyMock<T>`    | Prints warnings for uninteresting calls (default for raw mocks).  |
| `StrictMock<T>`   | Treats uninteresting calls as test failures.                     |

**Usage example:**

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, Foo()).Times(1);
// No warnings for other uninteresting calls
```

---

## Flexible Expectation Patterns

### Partial Ordering

gMock lets you express complex call order requirements using:

- `Sequence` objects
- `.InSequence()` with one or more sequences
- `.After()` clause for specifying dependencies between expectations

This lets tests express DAGs of expected calls, not just linear sequences.

### Retiring Expectations

By default, expectations remain active after reaching their call limit. This can make tests brittle. Use `.RetiresOnSaturation()` to retire an expectation as soon as it saturates, preventing it from matching further calls.

### Default Actions with ON_CALL

Use `ON_CALL(mock, Method(matchers))` to specify default behavior when no expectation (`EXPECT_CALL`) is used. This sets the behavior but does not enforce calls.

```cpp
ON_CALL(foo, GetValue()).WillByDefault(Return(42));
```

Default actions are overridden by matching `EXPECT_CALL` actions, if any.

---

## Common User Workflows with Expectations

1. **Set Default Behavior** with `ON_CALL` for common responses.
2. **Specify Expectations** with `EXPECT_CALL` for calls you want to verify.
3. **Execute code under test**, which will invoke mock methods.
4. **gMock verifies** expectations on destruction or on explicit verification call.

---

## Practical Tips and Best Practices

- Mock only interfaces or classes with virtual methods.
- Use `NiceMock` for mocks you don't want to explicitly verify uninteresting calls on.
- Prefer `ON_CALL` for specifying default method behavior without enforcing call counts.
- Use `EXPECT_CALL` only for interactions you want to verify.
- Use `InSequence` or `Sequence` when order matters.
- Use `.RetiresOnSaturation()` for non-sticky calls when you want to prevent expectations from being reused.
- When mocking move-only types, use lambdas or `MOCK_METHOD` as usual, but be careful with `Return()`.
- Use `.WillOnce()` and `.WillRepeatedly()` to specify sequential or repeated behaviors.

---

## Troubleshooting

- **Unexpected call** failures mean your code called a mock with arguments you did not expect.
- **Uninteresting call** warnings mean you called a method without any expectation.
- Use the `--gmock_verbose=info` flag to enable detailed trace of mock calls.
- Use catch-all expectations (e.g., `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`) to ignore extra calls.
- Verify mock expectations early when needed using `Mock::VerifyAndClearExpectations(&mock_obj);`

---

## Summary

GoogleMock's approach centers on defining mock objects from interfaces, setting expectations on method calls—including argument constraints, return actions, and call counts—and validating interactions in tests. Cardinalities let you specify precise call frequency, while actions let you define behaviors, from returning values to invoking custom logic. Flexibility in order (via sequences and partial orderings), strictness control (nice, naggy, strict), and default actions (`ON_CALL`) enables robust and maintainable tests.

---

## References and Further Reading

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html): Quick reference for defining and using mocks.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes for advanced mocking scenarios.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html): Detailed API reference.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Beginner-friendly tutorial.
- [Core Testing Features overview](../overview/feature-summary/core-testing-features.md)

---

For a narrative of typical user workflows, see the related guides on defining mocks, setting expectations, and controlling mock strictness in the GoogleTest documentation.

---
