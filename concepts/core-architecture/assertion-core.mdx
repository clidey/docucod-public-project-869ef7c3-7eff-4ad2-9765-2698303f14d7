---
title: "Assertions and Result Handling"
description: "Break down the assertion system, covering built-in and user-defined assertions, assertion result models, and reporting mechanisms. See how assertion results drive both test clarity and robust feedback for development workflows."
---

# Assertions and Result Handling

GoogleTest provides a robust assertion system that enables clear, informative verification of code behavior during testing. This guide breaks down the assertion framework — covering built-in assertion macros, user-defined predicates, the assertion result model, and how results drive feedback and reporting — empowering you to write expressive and maintainable tests.

---

## Understanding Assertions

### What Are Assertions?

Assertions are statements embedded in test code that verify conditions — these conditions could be simple true/false checks, equality comparisons, string matches, or custom predicates. When an assertion fails, GoogleTest marks the test as failed and emits detailed diagnostic information.

The outcome of an assertion can be one of three:

- **Success:** The assertion condition was met.
- **Nonfatal Failure:** The assertion failed, but test execution continues.
- **Fatal Failure:** The assertion failed and aborts the current function.

### Macros: The Primary User Interface

GoogleTest exposes assertions primarily via macros. These come in two main flavors:

- `EXPECT_*`: Generate nonfatal failures allowing tests to proceed.
- `ASSERT_*`: Generate fatal failures that abort the current function.

Both types accept streaming of custom failure messages using `<<` to enhance clarity.

#### Example: Basic Assertion

```cpp
ASSERT_EQ(x.size(), y.size()) << "Vectors x and y must have the same length";
EXPECT_TRUE(CheckCondition(x)) << "Condition check failed";
```

> **Tip:** Use `EXPECT_*` when you want to gather multiple failures per test. Use `ASSERT_*` when continuing after a failure does not make sense.

### Assertion Macros Variety

GoogleTest offers a comprehensive family of assertion macros to cover various testing needs:

- **Boolean Conditions:** `EXPECT_TRUE`, `EXPECT_FALSE`
- **Binary Comparisons:** `EXPECT_EQ`, `EXPECT_NE`, `EXPECT_LT`, etc.
- **String Comparisons:** `EXPECT_STREQ`, `EXPECT_STRNE`, and case-insensitive variants
- **Floating Point Comparisons:** `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, and `EXPECT_NEAR`
- **Exception Assertions:** `EXPECT_THROW`, `EXPECT_NO_THROW`, `EXPECT_ANY_THROW`
- **Predicate Assertions:** For complex conditions with better diagnostics (see below)
- **Death Assertions:** For verifying process termination behavior

## AssertionResult: Capturing Success and Failure

At the heart of the assertion system is the `AssertionResult` class, representing the result of a predicate check with:

- A boolean success flag
- An optional detailed failure message

You can create an `AssertionResult` object using two factory functions:

```cpp
namespace testing {
  AssertionResult AssertionSuccess();  // Indicates assertion passed
  AssertionResult AssertionFailure();  // Indicates assertion failed
}
```

### Using AssertionResult in Custom Predicates

Instead of returning a bare `bool` from predicate functions, returning an `AssertionResult` enables GoogleTest to provide richer failure messages, improving diagnosability.

Example:

```cpp
// Simple Boolean predicate
bool IsEven(int n) {
  return (n % 2) == 0;
}

// Better predicate using AssertionResult
testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0)
    return testing::AssertionSuccess();
  else
    return testing::AssertionFailure() << n << " is odd";
}
```

Usage:

```cpp
EXPECT_TRUE(IsEven(3));
```

Output when it fails:

```
Value of: IsEven(3)
  Actual: false (3 is odd)
Expected: true
```

> **Practice:** Incorporate `AssertionResult` in custom predicates to significantly boost test diagnostics.

## Predicate and Predicate-Formatter Assertions

GoogleTest supports two classes of assertions that improve readability and diagnostics when working with complex conditions:

### Predicate Assertions (`EXPECT_PRED*`)

These use predicates/functions returning `bool`. The macros print argument values on failure.

Example:

```cpp
bool MutuallyPrime(int m, int n) { /*...*/ }
EXPECT_PRED2(MutuallyPrime, a, b);
```

### Predicate-Formatter Assertions (`EXPECT_PRED_FORMAT*`)

These take predicate-formatters — functions returning `AssertionResult` — allowing fully customized failure messages.

Example:

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* m_expr,
                                             const char* n_expr,
                                             int m, int n) {
  if (MutuallyPrime(m, n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << m_expr << " and " << n_expr
      << " (" << m << " and " << n << ") are not mutually prime.";
}

EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

## Assertion Message Streaming

All assertion macros support streaming detailed custom failure messages using the `<<` operator:

```cpp
EXPECT_EQ(foo, bar) << "foo and bar differ in unexpected ways";
```

You can stream any type supported by the C++ `ostream` API, including standard string types and user-defined types that implement `operator<<`.

GoogleTest converts wide string (e.g., `wchar_t*`) messages into UTF-8 in output.

## Common Practices and Tips

- **Evaluation Once:** Assertions evaluate their arguments exactly once, so it's safe to use expressions with side effects.
- **Disable Tests Temporarily:** Prefix test or test suite names with `DISABLED_` to exclude them from execution without removing code.
- **Assertion Placement:** Use fatal assertions only in void-returning functions and avoid them in constructors or destructors.
- **Add Traces:** Use `SCOPED_TRACE()` to attach trace messages adding context to assertion failures in nested or reused helper functions.

## Diagnosing Failures with Test Properties

You can log custom key/value information about test runs with `RecordProperty(key, value)`.

For example:

```cpp
TEST_F(WidgetUsageTest, MinAndMaxWidgets) {
  RecordProperty("MaximumWidgets", ComputeMaxUsage());
  RecordProperty("MinimumWidgets", ComputeMinUsage());
}
```

These properties are included in XML and JSON outputs when the respective reports are generated.

> **Note:** Avoid reserved key names like `name`, `status`, `time`, etc., to prevent property recording failure.

## How Assertion Results Tie into Test Reporting

GoogleTest tracks test parts (individual assertions or outcomes) through the `TestPartResult` class. Each test aggregates these into a `TestResult`, which provides methods such as:

- `Passed()`, `Failed()`, `Skipped()`,
- `HasFatalFailure()`, `HasNonfatalFailure()`,
- `total_part_count()`,
- Access to individual results for detailed inspection.

The overall test program state can then be summarized using the `UnitTest` singleton, which includes counts and lists of passed, failed, and skipped tests.

The event listener architecture receives test part results and uses them to generate console output, generate XML/JSON reports, or stream results to external systems.

## How to Handle Assertion Failures in Subroutines

Fatal assertions abort only the current function, not the entire test. To propagate fatal failures from subroutines:

- Use `ASSERT_NO_FATAL_FAILURE(statement)` to verify no fatal failures occur.
- Use `HasFatalFailure()` to check for failures after subroutine return and terminate early.
- Alternatively, add a custom event listener that throws exceptions on fatal failures to simulate propagation (advanced).

## Advanced: Exception Assertions

With exceptions enabled, GoogleTest provides assertions verifying exception throwing behavior:

- `EXPECT_THROW(statement, exception_type)`
- `EXPECT_ANY_THROW(statement)`
- `EXPECT_NO_THROW(statement)`

Including helpful failure diagnostics if expectations are not met.

## How to Write Custom Assertions

You can write custom assertion predicates returning `AssertionResult` to get rich messages and streamlined usage within the GoogleTest framework.

## Summary of Key Assertions

| Assertion Type                  | Macro Example                       | Behavior                             |
| ------------------------------|-----------------------------------|------------------------------------|
| Boolean Checks                | `EXPECT_TRUE(cond)`                 | Succeeds if `cond` evaluates true  |
| Equality Comparisons          | `EXPECT_EQ(val1, val2)`             | Checks `val1 == val2`                |
| String Equality              | `EXPECT_STREQ(str1, str2)`          | Checks C-string equality             |
| Floating Point               | `EXPECT_FLOAT_EQ(f1, f2)`           | Approximate float equality           |
| Predicate Assertions         | `EXPECT_PRED2(pred, v1, v2)`        | Boolean predicate with arg printing  |
| Predicate Formatter          | `EXPECT_PRED_FORMAT2(format, v1, v2)` | Custom predicate assertion          |
| Exception Assertions         | `EXPECT_THROW(stmt, ExceptionType)` | Checks exception thrown               |
| Death Assertions             | `EXPECT_DEATH(stmt, regex)`          | Checks process death and output      |
| Explicit Success/Failure     | `SUCCEED()`, `FAIL()`               | Directly signal success or failure   |

## Troubleshooting Common Assertion Issues

- **Failure messages not descriptive?** Use predicate-formatter assertions for clear custom messages.
- **Fatal assertions not stopping test?** Remember fatal assertions abort only current function.
- **Testing private members?** Use `FRIEND_TEST` to declare test access or test via public interfaces.
- **Disabled tests still run?** Confirm no `--gtest_also_run_disabled_tests` flag or environment variable is set.

## Examples

### Creating and Using a Custom Predicate

```cpp
// Custom predicate that makes failure messages more informative.
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}

TEST(NumberTest, EvenCheck) {
  EXPECT_TRUE(IsEven(4));  // Passes
  EXPECT_TRUE(IsEven(3));  // Fails with detailed message
}
```

### Using `SCOPED_TRACE` to Add Context

```cpp
void Helper(int n) {
  EXPECT_EQ(n, 42);
}

TEST(MyTest, WithTrace) {
  SCOPED_TRACE("Testing with n=3");
  Helper(3);
}
```

Failure message includes the trace location, helping identify which call failed.

---

## See Also

- [Assertions: Expect, Assert, and Predicates](/api-reference/assertions-and-matchers/basic-assertions)
- [Matchers and Custom Matchers](/api-reference/assertions-and-matchers/using-matchers)
- [Test Macros and Fixtures](/api-reference/core-test-api/test-macros-and-fixtures)
- [Writing Custom Assertions and Matchers](/concepts/advanced-principles/custom-assertions-and-matchers)
- [Test Lifecycle and Environment Control](/api-reference/core-test-api/test-lifecycle-and-environment)

---

## Practical Tips

- Use predicate-formatter assertions for complex logic to provide clear failure reasons.
- Avoid mixing `TEST` and `TEST_F` macros in the same test suite to prevent fixture conflicts.
- Use `RecordProperty` to add metadata useful for CI/CD systems and test aggregation.
- Call `InitGoogleTest()` before `RUN_ALL_TESTS()` for correct flag processing.
- Use the `SCOPED_TRACE` macro to add traceable context in helper functions or loops.

---

This guide equips you with the understanding and skills to leverage GoogleTest's assertion system for precise, informative, and maintainable tests, enhancing your C++ testing workflow.