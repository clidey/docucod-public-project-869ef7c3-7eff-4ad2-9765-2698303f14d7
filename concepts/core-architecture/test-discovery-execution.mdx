---
title: "Test Discovery and Execution Model"
description: "Explore how GoogleTest automatically discovers test cases and controls their execution. Understand the underlying mechanisms for organizing, registering, and managing tests, and learn how the xUnit-inspired process enables flexible test runs without test registration boilerplate."
---

# Test Discovery and Execution Model

GoogleTest adopts a powerful, automated approach to discovering, organizing, and executing tests. This model enables users to write tests naturally without manual registration or bookkeeping, streamlining the test development workflow.

---

## Overview of Test Discovery

Unlike some frameworks where tests must be explicitly listed or registered before running, GoogleTest automatically discovers tests via test macros such as `TEST()` and `TEST_F()`. These macros embed metadata and registration logic into the compilation units, enabling GoogleTest to aggregate all available tests at runtime.

### How Tests Are Found

- **Static Registration:** Each `TEST()` or `TEST_F()` macro call expands to code that registers the test in a global repository before `main()` runs.
- **Unique Identification:** Tests are identified by a composite name consisting of their *test suite* and *test name*.
- **Fixture Association:** Tests using fixtures (`TEST_F`) are linked to their fixture classes, enabling shared setup and teardown.

This approach means that writing a test automatically makes it discoverable by the framework without additional user effort.

## Organizing Tests for Execution

Tests in GoogleTest are grouped into *test suites* (formerly known as *test cases*). Each test suite contains one or more tests logically related by the suite name or the shared fixture class.

### Test Suites and Fixtures

- **Test Suites:** Named collections of tests that typically correspond to a component, a class, or a function being tested.
- **Fixtures:** Classes inheriting from `testing::Test` that encapsulate common data and setup logic for multiple tests within a suite.
- **Parameterized Suites:** Suites can be value- or type-parameterized to run tests with varying data inputs or types.

The suite grouping enables targeted running, filtering, and reporting of tests.

## Execution Flow of Tests

When invoking your test program, the execution typically follows these steps:

1. **Initialization:** Calling `testing::InitGoogleTest(&argc, argv)` initializes the framework, parsing any flags that control test filtering, output formatting, repeat counts, and more.
2. **Test Discovery:** Registered tests are collected from static registrations done during startup.
3. **Filtering:** Tests are filtered based on user input (e.g., `--gtest_filter`) to pick which tests to run.
4. **Setup Global Environments:** Any registered global test environments (`testing::Environment`) run their `SetUp()` routines before tests start.
5. **Test Iterations:** Tests are run across the specified number of iterations if repetition is requested (default is one).
6. **Individual Test Execution:** For each test:
   - The test fixture is instantiated anew.
   - `SetUpTestSuite()` runs once per suite before the first test.
   - `SetUp()` runs before each individual test.
   - The test body executes.
   - `TearDown()` runs after each test.
   - `TearDownTestSuite()` runs once after the last test.
7. **Global TearDown:** Registered global environments execute their `TearDown()` methods.
8. **Reporting:** Results are collected and output through configured listeners, including console output, XML reports, or user-defined listeners.

### Example: Main Entry Point

A standard `main()` function to run tests looks like this:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv); // Parses flags, initializes test framework
  return RUN_ALL_TESTS();               // Runs all discovered tests and returns the result
}
```

This pattern is so common that GoogleTest provides `gtest_main` library to supply this boilerplate automatically.

## Flexible Test Runs Without Boilerplate Registration

GoogleTest's automatic test registration removes the need for users to list tests manually. This xUnit-inspired architecture yields several advantages:

- **Add Tests Freely:** Just write tests using macros; they become part of the test binary.
- **Selective Execution:** Use filters and flags to run a subset by test or suite name.
- **Disable Tests Easily:** Prefix a test or suite name with `DISABLED_` to exclude it temporarily.
- **Repeat Tests:** Run tests multiple times for robustness verification.

These features empower users to scale their test suites without cumbersome manual steps.

## Test Execution on Various Platforms

GoogleTest adapts to platform specifics for starting test runs:

- On normal platforms (Linux, Windows, Mac), the entry point is `main(int argc, char** argv)`.
- On Arduino-like platforms (e.g., ESP8266, ESP32), test execution is integrated within `setup()` and `loop()` functions.
- On special platforms like QuRT, GoogleTest provides an entry point that accommodates platform-specific quirks.

Users typically do not need to worry about these differences when writing tests.

## Troubleshooting Common Issues

If tests are not discovered or run as expected, consider:

- **Check Macros:** Ensure tests are defined using GoogleTest macros (`TEST`, `TEST_F`, etc.) inside compiled translation units.
- **Link `gtest_main`:** If you observe missing `main()` linking errors, consider linking with the `gtest_main` library or provide your own `main()`.
- **Flags Usage:** Verify command line flags, such as `--gtest_filter`, for correct test selection.
- **Disabled Tests:** Remember that tests or suites prefixed with `DISABLED_` will not run unless specifically enabled.

## Practical Tips and Best Practices

- Write tests within `TEST()` or `TEST_F()` macros to enable automatic discovery.
- Use meaningful test suite names reflecting the tested components to organize tests clearly.
- Take advantage of test filtering to run only relevant tests during development.
- Link to `gtest_main` to avoid the need for writing your own `main()`.

## Diagram: Test Discovery and Execution Flow

```mermaid
flowchart TD

  Init["testing::InitGoogleTest(argc, argv)"] --> Discovery["Automatic Test Discovery via Registration"]
  Discovery --> Filtering["Apply Test Filters (--gtest_filter)"]
  Filtering --> GlobalSetup["Run Global Environment SetUp()"]
  GlobalSetup --> IterationStart["Start Test Iteration"]

  subgraph Test Loop
    IterationStart --> TestStart["For each test to run:"]
    TestStart --> FixtureSetup["Create fresh fixture instance"]
    FixtureSetup --> SuiteSetUp["Call SetUpTestSuite() before first test"]
    SuiteSetUp --> TestSetUp["Call SetUp() before test"]
    TestSetUp --> RunTest["Run Test Body"]
    RunTest --> TestTearDown["Call TearDown() after test"]
    TestTearDown --> ContinueTestLoop["Next Test"]
  end

  ContinueTestLoop -->|After last test| SuiteTearDown["Call TearDownTestSuite()"]
  SuiteTearDown --> IterationEnd["End Test Iteration"]
  IterationEnd --> GlobalTearDown["Run Global Environment TearDown()"]
  GlobalTearDown --> Reporting["Aggregate and Output Results"]
  Reporting --> End["Return Test Results"]

  classDef startend fill:#f9f,stroke:#333,stroke-width:2px,stroke-dasharray: 5 5;
  class Init,End startend;

  classDef loopNode fill:#bbf,stroke:#333,stroke-width:1px;
  class TestLoop loopNode;

  class TestLoop
```

---

## Additional Resources

For detailed guidance on writing tests, fixtures, and using GoogleTest features, see:

- [GoogleTest Primer (docs/primer.md)](/docs/primer.md) — Introductory tutorial.
- [Test Cases and Fixtures Reference (api-reference/testing-core/test-fixture-lifecycle.md)](/api-reference/testing-core/test-fixture-lifecycle.md) — In-depth API.
- [Writing and Discovering Tests Guide](/guides/getting-started/writing-and-discovering-tests) — Best practices around test writing.
- [Using gtest_main Library](/guides/getting-started/setup-quickstart) — Simplifies main() usage.

Explore advanced filtering and test iteration options in the [Advanced Guide](/docs/advanced.md).

---

This page strictly covers test discovery and execution. For mocking and test doubles, refer to the GoogleMock documentation.




