---
title: "Assertions and Failure Modes"
description: "Details the assertion types in GoogleTest—including fatal, non-fatal, user-defined, and predicate assertions. Explains how assertion results are reported and how failure handling enables precise diagnostics and test continuation."
---

# Assertions and Failure Modes

Understanding assertions in GoogleTest is essential to producing effective and reliable unit tests. This guide details the different types of assertions provided by GoogleTest, how their results are reported, and how failure handling capabilities allow precise diagnostics and control of test flow.

---

## Types of Assertions in GoogleTest

GoogleTest offers a rich set of assertion macros that can generate success, non-fatal failures, or fatal failures. This differentiated behavior empowers you to control how tests continue or stop upon assertion outcomes.

### 1. Fatal Assertions

- **Purpose:** Immediately halt the current function when the assertion fails.
- **Macros:** Begin with `ASSERT_`, e.g., `ASSERT_TRUE(condition)`, `ASSERT_EQ(val1, val2)`.
- **Behavior:** Upon failure, control returns from the current test function, preventing subsequent lines from executing within that function.

### 2. Non-fatal Assertions

- **Purpose:** Report failures, but allow the current function to continue executing.
- **Macros:** Begin with `EXPECT_`, e.g., `EXPECT_TRUE(condition)`, `EXPECT_EQ(val1, val2)`.
- **Behavior:** Failures are registered but testing proceeds within the current function, allowing multiple issues to be detected before the test ends.

### 3. Explicit Success and Failure

- Use `SUCCEED()` to explicitly generate a success (typically documentary).
- Use `FAIL()` or `ADD_FAILURE()` to generate fatal or non-fatal failures respectively without any condition.

### 4. Predicate Assertions

For complex checks not covered by built-in macros, GoogleTest provides predicate assertions that express conditions with clearer failure messages.

- **Boolean Predicate Assertions:** `EXPECT_PRED1`, `EXPECT_PRED2`, ..., `ASSERT_PRED1`, etc., which accept functions or functors returning `bool`.
- **Predicate Formatter Assertions:** `EXPECT_PRED_FORMATN`, which use functions returning `AssertionResult` allowing richer failure diagnostics including expression strings and custom messages.

### 5. String and C-String Assertions

GoogleTest distinguishes between pointers and actual C-string content in equality checks:

- Use `EXPECT_STREQ()` and `EXPECT_STRNE()` for comparing C string content.
- Wide strings (`wchar_t*`) are also supported, with failure messages converted to UTF-8.

### 6. Floating-Point Comparisons

Specialized macros like `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, and `EXPECT_NEAR` accommodate floating-point rounding imprecision and provide ULP-based comparisons.

### 7. Exception Assertions

These macros test if statements throw or don’t throw exceptions:

- `EXPECT_THROW`, `ASSERT_THROW` verify that a statement throws an expected exception.
- `EXPECT_NO_THROW`, `ASSERT_NO_THROW` verify that a statement does not throw.
- `EXPECT_ANY_THROW`, `ASSERT_ANY_THROW` verify that a statement throws an exception of any type.

### 8. Death Assertions

Death tests check that code causes the program to exit or terminate under specific conditions. See the Death Tests guide for details on macros like `EXPECT_DEATH`.

---

## How Assertion Results Are Reported

When tests run, assertions yield results encapsulated in **TestPartResult** objects categorized as:

- **Success:** The assertion passed.
- **Non-Fatal Failure:** The assertion failed but execution continues.
- **Fatal Failure:** The assertion failed and current function execution stops immediately.
- **Skip:** The test or assertion was skipped.

GoogleTest captures these results, attaches diagnostic messages, and may include stack traces unless the assertion is a success or a skip.

Failure messages printed to the console are clear and include:

- File and line number where the failure occurred.
- The actual and expected values or conditions.
- Additional user-supplied messages if provided with streaming (`<<`) syntax.

For example, a failing equality check will print the expressions and their evaluated values:

```none
Expected equality of these values:
  foo
    Which is: 5
  bar
    Which is: 6
```

When assertions fail, GoogleTest considers the test as failed but continues running other tests unless a **fatal failure** or the `fail_fast` flag is set.

---

## Failure Handling and Test Flow Control

GoogleTest provides flexible control over test execution in the presence of assertion failures:

### 1. Propagation of Fatal Failures

Fatal assertions only abort the current function, not the entire test case or program. To handle this:

- Use `HasFatalFailure()` to detect a fatal failure state and return early.
- Use `ASSERT_NO_FATAL_FAILURE()` macro to ensure a statement generates no fatal failures.
- Alternatively, enable exceptions by adding a listener that throws on fatal failures, transforming `ASSERT_*` failures into exceptions that can unwind the call stack.

### 2. Skipping Tests

- The macro `GTEST_SKIP()` can be used to skip tests at runtime with an optional streamed message.
- It aborts the current function but does not mark the test as failed.

### 3. Flags Influencing Failure Behavior

- **`--gtest_fail_fast`** (or `fail_fast` flag) causes the test runner to stop after the first failure across any test.
- **`--gtest_break_on_failure`** triggers a debugger breakpoint on assertion failures, useful for interactive debugging.
- **`--gtest_throw_on_failure`** throws exceptions on failures if exceptions are enabled, allowing better integration with external frameworks.

They can be set via environment variables or command-line flags.

---

## Practical Usage Examples

### Fatal versus Non-Fatal:

```cpp
TEST(MyTestSuite, Example) {
  EXPECT_EQ(1, Foo());  // Fails but continues
  ASSERT_EQ(2, Bar());  // Fails and returns from this test function
  // The code below runs only if ASSERT_EQ passes
  Baz();
}
```

### Using HasFatalFailure to Early-Exit:

```cpp
void Helper() {
  ASSERT_TRUE(CheckCondition());
  // ... more code ...
}

TEST(MyTestSuite, EarlyExitExample) {
  Helper();
  if (HasFatalFailure()) return;  // Early exit if Helper failed
  EXPECT_TRUE(AnotherCheck());
}
```

### Skipping a Test at Runtime:

```cpp
TEST(MyTest, NeedsNetwork) {
  if (!NetworkAvailable()) {
    GTEST_SKIP() << "Network not available, skipping.";
  }
  // test body
}
```

### Using Predicate Assertion for Better Messages:

```cpp
AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return AssertionSuccess() << n << " is even";
  else
    return AssertionFailure() << n << " is odd";
}

TEST(ExampleTest, PredicateAssertion) {
  EXPECT_PRED_FORMAT1(IsEven, 3);
}
```

On failure, the message will contain detailed diagnostics:

```none
Value of: IsEven(3)
  Actual: false (3 is odd)
Expected: true
```

---

## Common Pitfalls and Best Practices

- **Understand Fail Behavior:** Fatal failures abort only the current function. Use `HasFatalFailure()` or exceptions to propagate failures properly.
- **Stream Messages:** Always leverage `<<` streaming to add clear context to your assertions.
- **Avoid Assertions in Non-void Functions:** Fatal assertion macros (`ASSERT_`, `FAIL()`) should only be used in `void` functions.
- **Use Skipping Wisely:** Use `GTEST_SKIP()` to mark tests as skipped when preconditions are unmet without failing the test.
- **Separate Fatal and Non-Fatal Use Cases:** Use `EXPECT_` when you want tests to continue execution to detect multiple failures.
- **Use Predicate and Predicate-Formatter Macros:** For complex conditions, use predicate assertions to create clearer failure messages.

---

## How Assertions Integrate in GoogleTest Architecture

Assertions tie into GoogleTest in the following way:

1. When an assertion is invoked, it calls `UnitTest::AddTestPartResult()` with the result type and message.

2. Failure details (file, line, message, stack trace) are captured and stored in `TestPartResult` objects.

3. `TestResult` objects aggregate all `TestPartResult` instances for a given test.

4. Event listeners like the default result printer pick up failure events and print formatted diagnostics.

5. Flags like `fail_fast` and `break_on_failure` influence whether execution continues or breaks.

This design allows the GoogleTest framework to provide flexible and rich diagnostics that help developers quickly locate issues.

---

## Troubleshooting Assertion Failures

- If you encounter unexpected continuation after `ASSERT_*` failures, verify your test functions return `void`.
- Use `HasFatalFailure()` to detect and handle fatal failure states where needed.
- Check test filter settings; some failures may be skipped due to filtering or sharding.
- Use `SCOPED_TRACE` to add contextual information to help diagnose failures in nested calls.

---

## Additional Resources

- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Advanced Guide on Assertions](https://github.com/google/googletest/blob/main/docs/advanced.md#more-assertions)
- [Death Tests Guide](https://github.com/google/googletest/blob/main/guides/real-world-workflows/death-tests.md)
- [Event Listener API](https://github.com/google/googletest/blob/main/docs/advanced.md#extending-google-test-by-handling-test-events)
- [Test Discovery and Execution Lifecycle](https://github.com/google/googletest/blob/main/concepts/core-architecture/test-discovery-lifecycle.md)

---

Understanding how GoogleTest assertions work and how their failures influence test flow is crucial for writing robust tests and diagnosing issues efficiently. This guide equips you to use assertions effectively in your GoogleTest-based test suites.