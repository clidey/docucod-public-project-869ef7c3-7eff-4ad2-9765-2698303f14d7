---
title: "Assertions and Failure Handling"
description: "Understand GoogleTest's wide-ranging assertion mechanisms, from basic checks to user-defined conditions. Examine how failures are reported, classified as fatal or non-fatal, and integrated into the test flow. Grasp how these mechanisms promote clarity in test results and flexible error handling."
---

# Assertions and Failure Handling

Understanding the assertion mechanisms of GoogleTest is fundamental to writing effective unit tests that clearly express intent and diagnose failures efficiently. This guide unpacks the diverse set of assertion macros available, explains the difference between fatal and non-fatal failures, and illustrates how GoogleTest integrates these mechanisms into the overall test flow to provide transparent and actionable results.

---

## Table of Contents

- [Introduction to Assertions](#introduction-to-assertions)
- [Explicit Success and Failure Assertions](#explicit-success-and-failure-assertions)
- [Boolean Condition Assertions](#boolean-condition-assertions)
- [Binary Comparison Assertions](#binary-comparison-assertions)
- [String Comparison Assertions](#string-comparison-assertions)
- [Floating-Point Comparison Assertions](#floating-point-comparison-assertions)
- [Exception Assertions](#exception-assertions)
- [Predicate Assertions](#predicate-assertions)
- [Windows HRESULT Assertions](#windows-hresult-assertions)
- [Death Assertions](#death-assertions)
- [Assertion Streaming and Custom Messages](#assertion-streaming-and-custom-messages)
- [Best Practices and Troubleshooting](#best-practices-and-troubleshooting)

---

## Introduction to Assertions

At the heart of GoogleTest's verification capabilities are **assertion macros** which confirm that the tested code behaves as expected. Including `<gtest/gtest.h>` activates access to these macros. Assertions can be broadly categorized based on their effect on test execution:

- **Non-fatal failures** (indicated by `EXPECT_` macros) allow the test function to continue running,
- **Fatal failures** (indicated by `ASSERT_` macros) immediately abort the current function.

Users can also append custom failure messages to any assertion using the `<<` streaming operator to provide context-sensitive diagnostics.

---

## Explicit Success and Failure Assertions

Sometimes, test flow decisions cannot rely solely on boolean expressions but instead on control path outcomes. GoogleTest offers explicit macros to signal success or failure directly.

### `SUCCEED()`

- Records a successful check. Does **not** mean the entire test passes by itself, but documents a pass point.
- Currently, it produces no visible output but may in future versions.

### `FAIL()`

- Generates a **fatal failure**, immediately aborts the current `void`-returning function.
- Use this to mark unreachable code or explicit failure points.

### `ADD_FAILURE()` and `ADD_FAILURE_AT(file, line)`

- Issues a non-fatal failure allowing continued execution.
- `ADD_FAILURE_AT` specifies file and line number for precise failure location.

**Example:**

```cpp
switch(expression) {
  case 1:
    ... some checks ...
    break;
  case 2:
    ... some other checks ...
    break;
  default:
    FAIL() << "Reached impossible default case.";
}
```

---

## Boolean Condition Assertions

These assertions directly test boolean conditions.

### `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`

- Succeeds if `condition` evaluates to `true`.

### `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

- Succeeds if `condition` evaluates to `false`.

These are foundational checks for expressing expected state or predicate evaluations.

---

## Binary Comparison Assertions

Used for verifying relationships between two values, these macros require arguments to support the relevant comparison operators. They include but are not limited to:

- Equality: `EXPECT_EQ(val1, val2)`, `ASSERT_EQ(val1, val2)`
- Inequality: `EXPECT_NE(val1, val2)`, `ASSERT_NE(val1, val2)`
- Less than: `EXPECT_LT(val1, val2)`, `ASSERT_LT(val1, val2)`
- Less or equal: `EXPECT_LE(val1, val2)`, `ASSERT_LE(val1, val2)`
- Greater than: `EXPECT_GT(val1, val2)`, `ASSERT_GT(val1, val2)`
- Greater or equal: `EXPECT_GE(val1, val2)`, `ASSERT_GE(val1, val2)`

**Important nuances:**

- For pointers, `EXPECT_EQ` compares **pointer identity**, not pointed-to values.
- Use `EXPECT_STREQ` for C-string content comparison instead of `EXPECT_EQ`.
- Arguments are evaluated exactly once, though order is undefined - avoid side effects relying on order.

**Example:**

```cpp
EXPECT_EQ(my_result, expected_result) << "Calculation mismatch.";
```

---

## String Comparison Assertions

GoogleTest distinguishes between C-string pointer assertions and STL/string objects.

### For C strings (including wide strings):

- `EXPECT_STREQ(str1, str2)`, `ASSERT_STREQ(str1, str2)` — content equality.
- `EXPECT_STRNE(str1, str2)`, `ASSERT_STRNE(str1, str2)` — content inequality.
- `EXPECT_STRCASEEQ(str1, str2)`, `ASSERT_STRCASEEQ(str1, str2)` — case-insensitive equality.
- `EXPECT_STRCASENE(str1, str2)`, `ASSERT_STRCASENE(str1, str2)` — case-insensitive inequality.

Use these macros when testing null-terminated string content explicitly. For `std::string`, fall back to `EXPECT_EQ`.

---

## Floating-Point Comparison Assertions

Due to rounding and representation limits, exact floating-point equality is rarely meaningful. GoogleTest provides:

- `EXPECT_FLOAT_EQ(val1, val2)`, `ASSERT_FLOAT_EQ(val1, val2)` — compares `float` values within 4 ULPs.
- `EXPECT_DOUBLE_EQ(val1, val2)`, `ASSERT_DOUBLE_EQ(val1, val2)` — compares `double` values within 4 ULPs.
- `EXPECT_NEAR(val1, val2, abs_error)`, `ASSERT_NEAR(val1, val2, abs_error)` — asserts absolute difference within `abs_error`.

**Use case:**

```cpp
EXPECT_NEAR(computed_value, expected_value, 0.001);
```

For advanced floating-point checks, predicate-format assertions enable fine-grained message control.

---

## Exception Assertions

When exceptions are enabled, GoogleTest lets you verify whether a statement throws or doesn’t throw exceptions.

- `EXPECT_THROW(statement, exception_type)`, `ASSERT_THROW(statement, exception_type)` — statement should throw specified exception.
- `EXPECT_ANY_THROW(statement)`, `ASSERT_ANY_THROW(statement)` — statement should throw any exception.
- `EXPECT_NO_THROW(statement)`, `ASSERT_NO_THROW(statement)` — statement should not throw.

Supports compound statements with braces. Exception assertions help test error propagation and robustness.

---

## Predicate Assertions

For complex predicates or custom boolean checks, predicate assertions enhance failure diagnostics by printing argument values:

- `EXPECT_PRED1(pred, val1)` through `EXPECT_PRED5(pred, val1, ..., val5)`
- `ASSERT_PRED1(...)` through `ASSERT_PRED5(...)`

Their counterparts with formatters (`EXPECT_PRED_FORMAT*` and `ASSERT_PRED_FORMAT*`) offer full control over failure message formatting.

**Example:**

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, 4);  // Passes
EXPECT_PRED1(IsEven, 3);  // Fails with detailed message.
```

---

## Windows HRESULT Assertions

On Windows, APIs often return `HRESULT` codes. GoogleTest provides:

- `EXPECT_HRESULT_SUCCEEDED(expression)`, `ASSERT_HRESULT_SUCCEEDED(expression)`
  - Verifies success codes.
- `EXPECT_HRESULT_FAILED(expression)`, `ASSERT_HRESULT_FAILED(expression)`
  - Verifies failure codes.

Failures emit human-readable error messages to aid diagnosis.

---

## Death Assertions

Death tests verify the process terminates as expected. GoogleTest offers:

- `EXPECT_DEATH(statement, matcher)`, `ASSERT_DEATH(statement, matcher)` — statement must cause process death with stderr output matching `matcher`.
- `EXPECT_DEATH_IF_SUPPORTED(...)`, `ASSERT_DEATH_IF_SUPPORTED(...)` — conditionally run death tests.
- `EXPECT_DEBUG_DEATH(...)`, `ASSERT_DEBUG_DEATH(...)` — death test active only in debug builds.
- `EXPECT_EXIT(statement, predicate, matcher)`, `ASSERT_EXIT(...)` — verify specific exit status and output.

**Note:** Death tests create separate child processes to isolate fatal behavior safely.

**Example Death Test:**

```cpp
ASSERT_DEATH({ DoDangerousStuff(); }, "Error on line .* of DoDangerousStuff");
```

---

## Assertion Streaming and Custom Messages

All assertion macros support streaming custom error messages for clearer context.

**Example:**

```cpp
EXPECT_TRUE(success) << "Operation failed with error code " << error_code;
```

Wide strings and custom types streamed to assertions are converted to UTF-8 or printed according to custom printers.

---

## Best Practices and Troubleshooting

- Use `EXPECT_` macros when you want tests to continue after failure, and `ASSERT_` when further execution would be useless or dangerous.
- Supply clear, concise custom messages to clarify failures.
- Avoid over-specifying tests; test *contracts*, not every internal call or state.
- When debugging unexpected failures, enable verbose logging with `--gmock_verbose=info` to trace matcher evaluations and call matching.
- Use `ON_CALL` to set default mock behaviors without setting call expectations, preserving test flexibility.
- Apply `EXPECT_CALL` only when verifying that specific calls must happen.
- Handle floating-point comparisons with provided macros to avoid false negatives due to rounding.

---

Refer to the [Matchers Reference](matchers.md) and [gMock Cookbook](gmock_cook_book.md) for extending assertions via matchers and custom predicates.

---

## Related Topics

- [Writing and Using Assertions](../guides/core-testing-workflows/writing-assertions.md)
- [Using Matchers for Argument Verification](../guides/mocking-best-practices/using-matchers.md)
- [Setting Expectations and Default Actions](../api-reference/core-mocking-apis/call-expectations.md)

---

This document offers a thorough understanding of GoogleTest's assertion landscape, guiding users from fundamental checks to sophisticated control over test verification and failure reporting. Mastery of these concepts empowers developers to write clear, maintainable, and robust unit tests.