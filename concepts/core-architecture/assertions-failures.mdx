---
title: "Assertions and Failures"
description: "Dive into the concept of assertions in GoogleTest and GoogleMock—how expected and actual values are compared, different types of assertions, user-defined assertions, and the distinction between fatal and non-fatal failures for resilient test suites."
---

# Assertions and Failures

GoogleTest and GoogleMock provide a rich set of mechanisms for verifying program correctness by comparing expected and actual values during tests. This page covers key concepts related to **assertions**—the fundamental way tests check that code behaves as expected—and **failures**, which indicate test discrepancies.

Understanding how assertions work and how failures are categorized helps you write concise, readable, and resilient tests using GoogleTest and GoogleMock.

---

## Table of Contents
- [What Are Assertions?](#what-are-assertions)
- [Types of Assertions in GoogleTest and GoogleMock](#types-of-assertions-in-googletest-and-googlemock)
- [User-Defined Assertions](#user-defined-assertions)
- [Fatal vs Non-Fatal Failures](#fatal-vs-non-fatal-failures)
- [Best Practices for Writing Assertions](#best-practices-for-writing-assertions)
- [Troubleshooting Common Assertion Failures](#troubleshooting-common-assertion-failures)

---

## What Are Assertions?

Assertions are logical checks embedded in test code that compare actual program behavior against expected results. When an assertion fails, it indicates a discrepancy, causing the test to either continue with a logged failure or stop immediately, depending on the assertion type.

In GoogleTest and GoogleMock, assertions are implemented as macros like `EXPECT_EQ` and `ASSERT_TRUE` that evaluate expressions and report results in a readable format.

**User Intent Perspective:**
> When writing tests, you want clear confirmation that the code behaves as intended. Assertions allow you to specify these expectations declaratively, so that test failures signal exactly what and where the difference occurred.

---

## Types of Assertions in GoogleTest and GoogleMock

GoogleTest provides an expressive variety of assertion macros suitable for many scenarios. They come primarily in pairs:

- **`EXPECT_` assertions:** Generate non-fatal failures. Tests continue after failure.
- **`ASSERT_` assertions:** Generate fatal failures. The current function aborts immediately upon failure.

### Common Categories:

| Category                         | Description                                                  | Examples             |
|---------------------------------|--------------------------------------------------------------|----------------------|
| **Boolean Assertions**           | Verifies boolean conditions                                  | `EXPECT_TRUE(cond)`, `ASSERT_FALSE(cond)` |
| **Binary Comparison**            | Compares two values with relational operators                | `EXPECT_EQ(a, b)`, `ASSERT_LT(x, y)`         |
| **String Comparison**            | Compares C strings for equality or inequality                | `EXPECT_STREQ(str1, str2)`, `EXPECT_STRNE(str1, str2)` |
| **Floating-Point Comparison**    | Compares floating-point values with tolerance                | `EXPECT_FLOAT_EQ(val1, val2)`, `EXPECT_NEAR(val1, val2, abs_error)` |
| **Predicate Assertions**        | Uses custom predicates or matcher-based checks               | `EXPECT_PRED1(predicate, val)`, `EXPECT_THAT(value, matcher)` |
| **Exception Assertions**        | Checks for exceptions thrown or not thrown                   | `EXPECT_THROW(stmt, exception_type)`, `EXPECT_NO_THROW(stmt)` |
| **Death Assertions**             | Verifies code termination (process death)                    | `EXPECT_DEATH(stmt, regex)`, `EXPECT_EXIT(stmt, pred, regex)` |
| **Explicit Success/Failure**    | Manually signal success or failure                            | `SUCCEED()`, `FAIL()`                 |

### Key Differences Between `EXPECT_` and `ASSERT_`:

- `EXPECT_` allows the test to continue after failure — useful for verifying multiple independent conditions
- `ASSERT_` aborts the current function immediately — ideal when further code depends on the assertion passing

Use fatal assertions carefully to avoid hiding subsequent failures or crashes.

### GoogleMock Expectations and Assertions

- `EXPECT_CALL` sets expectations on mock methods: when, how often, and with what arguments they should be called
- `ON_CALL` specifies default behavior without setting expectations

Failures related to mock calls (unexpected calls, uninteresting calls) are reported during test execution based on these expectations.

---

## User-Defined Assertions

GoogleTest allows developers to write **custom assertion predicates** that return `testing::AssertionResult`. This enables creating expressive checks with informative failure messages tailored to complex conditions.

### Example: Custom Assertion Predicate

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return testing::AssertionSuccess();
  else
    return testing::AssertionFailure() << n << " is odd";
}

TEST(MyTestSuite, TestEvenCheck) {
  int value = 3;
  EXPECT_TRUE(IsEven(value));  // Fail with message "3 is odd"
}
```

You can enhance diagnostics by streaming messages that explain why a predicate failed or succeeded.

### Using Matchers for Assertions

Custom and built-in [gMock matchers](../api-reference/mocking-api/matchers-actions.md) enable complex argument validation directly within assertions:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_vector, ElementsAre(1, _, 3));
```

This combines well with GoogleTest assertions like `EXPECT_THAT` for readable and powerful verification.

---

## Fatal vs Non-Fatal Failures

Understanding how GoogleTest distinguishes **fatal** and **non-fatal** failures is essential to controlling test flow.

| Failure Type  | Behavior                                              | Typical Macros  |
|---------------|-------------------------------------------------------|-----------------|
| **Fatal Failure** | Stops execution of the current function immediately; test recorded as failed | `ASSERT_*`, `FAIL()` |
| **Non-Fatal Failure** | Logs failure but continues execution of current function | `EXPECT_*`, `ADD_FAILURE()` |

### Implications

- Use fatal failures (`ASSERT_*`) when continuing execution could cause crashes or undefined behavior.
- Use non-fatal failures (`EXPECT_*`) when it’s useful to accumulate multiple assertion results in a single test.

### Detecting Failures Internally

GoogleTest provides functions to query failure status programmatically:

```cpp
bool hasFatal = testing::Test::HasFatalFailure();
bool hasNonFatal = testing::Test::HasNonfatalFailure();
bool anyFailure = testing::Test::HasFailure();
```

### Skipping Tests

`GTEST_SKIP()` is a macro that terminates test execution early and marks the test as skipped without failure. It works well inside `SetUp()` or test bodies to gracefully bypass tests when preconditions aren't met.

---

## Best Practices for Writing Assertions

- **Specify clear, meaningful assertions:** Prefer expressive matchers and predicates over raw boolean expressions to enhance failure diagnostics.
- **Use `EXPECT_` by default:** Only opt for `ASSERT_` when the test cannot sensibly continue after a failed check.
- **Avoid over-specification:** Use `ON_CALL` for default mock method behaviors and limit `EXPECT_CALL` only to interactions you want to verify strictly.
- **Add helpful messages:** Use the streaming syntax to provide custom messages explaining failure causes.

Example:

```cpp
EXPECT_EQ(result, expected) << "Computation returned " << result << ", expected " << expected;
```

- **Structure tests for failure diagnosis:** Use `SCOPED_TRACE` or custom assertion messages to pinpoint failures within loops or helper function calls.

---

## Troubleshooting Common Assertion Failures

### Unexpected Mock Calls

When a mock method is called with arguments or at times not matching any `EXPECT_CALL`, GoogleMock raises an **unexpected call** failure. Solutions:

- Add an expectation `EXPECT_CALL(mock, method(...))` matching the call.
- Use `EXPECT_CALL(...).Times(AnyNumber())` to allow unverified calls.
- Use `ON_CALL` for default behavior without expectation.

### Excessive Calls

Calling a mock method more times than its upper bound leads to an **excessive call** failure. To handle:

- Allow more calls with `.Times(AnyNumber())`
- Use `.RetiresOnSaturation()` to retire expectations after saturation.

### Uninteresting Calls

A call to a mocked method without any expectation set is **uninteresting** and typically generates a warning. You can:

- Suppress warnings by wrapping the mock with `NiceMock`.
- Add expectations if you actually want to verify these calls.

### Assertion Message Clarity

- Employ custom matchers or predicates to generate richer failure messages.
- For complex compound expressions, consider custom assertion functions returning `AssertionResult`.

### Death Test Failures

- Confirm that the death test triggers an actual termination.
- Use regex patterns appropriately to match expected error messages.
- Remember that the code in a death test runs in a separate process, so side-effects won’t affect the parent.

---

## Summary

This guide has demystified how **assertions** and **failures** operate in GoogleTest and GoogleMock, providing you with the knowledge to write more effective and controlled tests. Understanding the distinctions between assertion types and failure severities empowers you to craft stable, dependable test suites.


---

## Additional Resources

- [GoogleTest Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [GoogleMock Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- [GoogleTest Advanced Guide](https://github.com/google/googletest/blob/main/docs/advanced.md)
- [gMock Cookbook for matchers and actions](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [Testing Architecture Overview](https://example.com/concepts/core-architecture/testing-architecture)
- [Writing Effective Assertions Guide](https://example.com/guides/core-workflows/writing-assertions)

---

If you are new to GoogleTest, start with [What Is GoogleTest?](https://example.com/overview/introduction-core-value/what-is-googletest) and [Writing Your First Test](https://example.com/guides/getting-started/first-test). For mocks, see [Defining and Using Mock Classes](https://example.com/guides/mocking-in-action/defining-mocks).

