---
title: "Assertions and Matchers: Concepts and Usage"
description: "Get to know the fundamental concepts behind assertions and matchers in GoogleTest and GoogleMock. This page explains how values are verified, how custom matchers extend expressiveness, and the difference between fatal and non-fatal assertions."
---

# Assertions and Matchers: Concepts and Usage

Welcome to the foundational concepts behind Assertions and Matchers in GoogleTest and GoogleMock. This documentation empowers you to understand how your code's behavior is verified, how expressive validations are crafted, and how assertion outcomes control test execution flows.

---

## Overview

Assertions in GoogleTest allow you to verify program state and behavior during test execution. Matchers complement this by enabling rich, readable, and extensible checking of values and arguments in both assertions and mock expectations.

This guide covers:

- How values and conditions are verified using assertions.
- The power of matchers and how they enable expressive verification.
- Differences between fatal and non-fatal assertions and their impact on test flow.
- Extending verification logic via custom matchers.

Understanding these concepts enhances your ability to write clear and robust tests that communicate intent precisely.

---

## Understanding Assertions in GoogleTest

Assertions are macros that verify conditions during test execution. They check whether an expression holds true and report failures if it does not.

### Basic Assertion Types

GoogleTest provides several categories of assertions that reflect common testing needs:

| Category            | Examples                     | Behavior                                                     |
| ------------------- | ----------------------------| ------------------------------------------------------------ |
| Boolean Conditions  | `EXPECT_TRUE(condition)`, `EXPECT_FALSE(condition)` | Check boolean expressions.
| Equality & Comparison| `EXPECT_EQ(val1, val2)`, `EXPECT_NE(val1, val2)`, `EXPECT_LT(val1, val2)`, etc.| Compare two values.
| String Comparisons  | `EXPECT_STREQ(str1, str2)`, `EXPECT_STRNE(str1, str2)` | Verify C-style strings by content.
| Floating-Point      | `EXPECT_FLOAT_EQ(val1, val2)`, `EXPECT_NEAR(val1, val2, abs_error)` | Approximate comparison accounting for floating-point rounding.
| Exception Checks    | `EXPECT_THROW(statement, ExceptionType)`, `EXPECT_NO_THROW(statement)` | Verify exception behavior.
| Predicate Checks    | `EXPECT_PRED2(pred, val1, val2)` | Use custom predicates for logic beyond simple comparison.

Each assertion exists in two major variants:

- **`EXPECT_`**: Generates a non-fatal failure on assertion failure, allowing the current test to continue.
- **`ASSERT_`**: Generates a fatal failure, aborting the current test function immediately.

This difference guides you to design tests that either continue after a failure or stop immediately.

### Explicit Success and Failure

You can directly generate success or failure conditions using assertions:

- `SUCCEED()`: Marks an explicit success (usually for documentation or future tooling). Does not override failure from other assertions.
- `FAIL()`: Produces a fatal failure and aborts the current function. Can only be used in functions returning `void`.
- `ADD_FAILURE()`: Generates a nonfatal failure but continues test execution.
- `ADD_FAILURE_AT(file, line)`: Like `ADD_FAILURE` but reports failure location manually.

### Writing Assertions with Custom Messages

All assertions in GoogleTest support streaming custom failure messages:

```cpp
EXPECT_TRUE(is_valid) << "Expected is_valid to be true, but it was false.";
```

Anything streamable to `ostream` can be appended to the assertion for richer diagnostics.

---

## Exploring Matchers: Expressive Verification

Matchers provide a powerful, extensible way to describe conditions that values or arguments must satisfy. They enrich assertions and mock method expectations.

### What Are Matchers?

- Matchers are predicates that check whether a value meets a certain criteria.
- They provide readable expressions that communicate intent clearly.
- On failure, they generate detailed explanation messages describing expected and actual values.

### Using Matchers in Assertions

`EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` enable matcher-driven assertions:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(number, AllOf(Gt(5), Lt(10)));
EXPECT_THAT(message, MatchesRegex("Line \\d+"));
```

Matchers can be combined logically (`AllOf`, `AnyOf`, `Not`) and can inspect tupled arguments or container elements.

### Built-in Matchers

GoogleMock provides a rich library of built-in matchers (found in [Matchers Reference](matchers.md)) including:

- Wildcards (_ matches anything)
- Numeric comparisons (Eq, Ne, Lt, Gt, Ge, Le)
- String comparisons and regex matching
- Container element matchers (`ElementsAre`, `UnorderedElementsAre`)
- Pointer checks (`IsNull`, `NotNull`, `Pointee`)
- Member and property checks (`Field()`, `Property()`)
- Composables (`AllOf()`, `AnyOf()`, `Not()`)

### Extending Matchers

You can create your own custom matchers for domain-specific conditions via:

- Simple macros (`MATCHER`, `MATCHER_P`)
- Implementing matcher classes with `MatchAndExplain()` and description methods

Custom matchers help keep tests readable and maintainable by encapsulating complex logic.

---

## Assertion Flow Control: Fatal vs Non-Fatal

Understanding how assertions influence the test execution path is essential.

### Fatal Assertions

- Failures from `ASSERT_` macros immediately abort the current test function.
- Useful when subsequent test steps depend on an assertion to hold true.
- Ensures no invalid state or undefined behavior occurs after a failed check.

### Non-Fatal Assertions

- Failures from `EXPECT_` macros report problems but continue test execution.
- Useful for gathering multiple failures in a single run.
- Allows testing of multiple conditions without interruption.

### Choosing Between Them

Use fatal assertions (`ASSERT_`) when a failure blocks meaningful continuation (e.g., required setup or fundamental validation).
Use non-fatal assertions (`EXPECT_`) to verify multiple independent conditions.

---

## Matchers in Mocking

Matchers also power the `EXPECT_CALL` and `ON_CALL` macros from GoogleMock to specify expectations on mock method calls.

### Specifying Expectations with Matchers

```cpp
EXPECT_CALL(mock_object, Method(Ge(5), StartsWith("abc")))
    .Times(3)
    .WillRepeatedly(Return(true));
```

- Each matcher corresponds to a function argument.
- `EXPECT_CALL()` sets the expected calls and associated actions.
- `ON_CALL()` sets default behaviors without setting expectations.

### Multi-Argument Matchers

Use `.With()` to specify constraints on the entire argument tuple in one matcher:

```cpp
EXPECT_CALL(mock_obj, SetPosition(_, _))
    .With(Lt());  // First arg < second arg
```

---

## Practical Tips and Best Practices

- Use `EXPECT_THAT` with matchers for clear and flexible verification.
- Prefer non-fatal assertions for validations allowing test continuation.
- Use fatal assertions when subsequent code depends on previous state.
- Define clear and specific matchers to reduce test brittleness.
- Employ custom matchers for domain-specific checks with readable intent.
- For mock expectations, set times and ordering constraints carefully.
- Avoid over-specifying expectations; prefer `ON_CALL` to set defaults.

---

## Troubleshooting

### Assertion Failure Messages

- Failure messages summarize the actual value, expected condition, and reason for failure.
- Use verbose mode (`--gmock_verbose=info`) to see extensive details and stack traces.

### Common Pitfalls

- Using `EXPECT_EQ` on C strings compares pointers, not contents. Use `EXPECT_STREQ` instead.
- `EXPECT_THAT` requires matchers; do not pass bare values where a matcher is expected.
- Mixing `EXPECT_` and `ASSERT_` inappropriately may cause harder to interpret test failures.

---

## Summary

GoogleTest's assertions paired with GoogleMock's matchers offer a powerful way to verify values and program behaviors with clarity and extensibility. Grasping when and how to use fatal vs non-fatal assertions ensures effective test flow control. Leveraging matchers unlocks readable, comprehensive verifications beyond simple equality, extending naturally into the rich domain of mocking.


---

## Additional Resources

- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Matchers Reference](matchers.md)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Writing Custom Matchers and Actions](guides/advanced-usage/custom-matchers-actions.mdx)

---

## Example: Using Assertions and Matchers Together

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::StartsWith;
using ::testing::Ge;
using ::testing::AllOf;

TEST(ExampleTest, MatcherAssertion) {
  std::string greeting = "Hello, world!";
  int number = 7;

  EXPECT_THAT(greeting, StartsWith("Hello"));
  ASSERT_THAT(number, AllOf(Ge(5), Ge(3)));

  // Failure with message
  EXPECT_TRUE(number % 2 == 0) << "Expected number to be even.";
}
```

Here, `EXPECT_THAT` uses matchers to assert that `greeting` starts with "Hello" and `number` is greater or equal to 5 and 3 (effectively >= 5). The last assertion checks evenness with a custom failure message.

---

## Key Takeaways

- Assertions verify conditions and control test flow.
- Matchers enable expressive and composable verification logic.
- Fatal assertions abort the test on failure; non-fatal allow continuation.
- `EXPECT_THAT` combines assertions with matchers.
- GoogleMock uses matchers to specify mock expectations.
- Customize matchers to capture domain specifics.

Embrace these concepts to write tests that are resilient, readable, and effective.
