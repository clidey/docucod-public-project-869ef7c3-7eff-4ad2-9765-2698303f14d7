---
title: "Matchers and Actions"
description: "Get an intuitive grasp of GoogleMock's matchers and actions—the core mechanisms for specifying expected behaviors and validating interactions. Learn how matchers enable expressive assertions and actions model the responses of mocks to method calls."
---

# Matchers and Actions

Understand the fundamental mechanisms in GoogleMock that empower you to precisely specify how mock methods behave and validate that they are used correctly. This guide unpacks the concepts of **matchers** and **actions**—the twin pillars of interaction verification and behavior modeling in your tests.

---

## Introduction to Matchers and Actions

When writing tests with GoogleMock, you often need to address two main concerns:

- **Matchers:** How do I specify what arguments my mock methods should expect?
- **Actions:** What should my mock methods do when invoked?

Matchers act as expressive guards on the inputs your mock methods receive, allowing you to assert that the right calls happen. Actions give your mocks the power to respond realistically, returning values, triggering side effects, or delegating to custom logic.

Together, matchers and actions give you granular control over your mock interactions, enabling both verification and simulation.

---

## Matchers: Expressive Argument Validation

### What Are Matchers?

Matchers are predicates applied to each argument of a mock method call. Instead of specifying exact values, you can write matchers to verify that arguments meet certain properties or patterns.

### Basic Usage

Consider a mock method `DoThis(int n)`:

```cpp
using ::testing::Expect;
using ::testing::_;  // Wildcard matcher

EXPECT_CALL(mock, DoThis(5));            // Expect argument exactly 5
EXPECT_CALL(mock, DoThis(Ge(5)));         // Argument >= 5
EXPECT_CALL(mock, DoThis(_));              // Argument can be anything
```

The special matcher `_` matches any argument—it’s the easiest way to say “I don’t care about this argument.”

### Combining Matchers for Complex Conditions

Matchers can be composed using combinators such as:

- `AllOf()` - All nested matchers must be satisfied.
- `AnyOf()` - Any one of the nested matchers must be satisfied.
- `Not()` - Negates a matcher.

You can also use `Field()` and `Property()` to check members or getters of argument objects:

```cpp
EXPECT_CALL(mock, Foo(Field(&MyClass::value, Ge(10))));
EXPECT_CALL(mock, Foo(Property(&MyClass::GetName, StartsWith("John"))));
```

### Matching Multiple Arguments Together

Sometimes you want to validate a relationship across multiple arguments. Use the `.With()` clause in your expectation to supply a matcher that operates on the entire tuple of arguments.

Example:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // Validates first argument < second argument
```

This facility lets you validate more sophisticated conditions not easily expressed via positional matchers alone.

### Using Matchers as Predicates and in Assertions

Matchers can be used anywhere predicates are accepted, such as STL algorithm predicates via `Matches()`, and as part of `EXPECT_THAT()` assertions.

### Best Practices for Matchers

- Only specify argument constraints needed by your test to reduce brittleness.
- Use `_` to ignore uninteresting arguments.
- Combine matchers to express precise conditions.
- Write custom matchers using the `MATCHER` family of macros for domain-specific logic.

---

## Actions: Defining Mock Method Behaviors

### What Are Actions?

Actions define the behavior of a mock method when invoked. They dictate what happens, e.g., what value is returned, what side-effects to perform, or which callback to trigger.

### Basic Actions

Some fundamental actions include:

| Action            | Description                                         |
|-------------------|-----------------------------------------------------|
| `Return(value)`   | Return the specified value.                          |
| `ReturnRef(var)`  | Return a reference to `var`.                         |
| `ReturnPointee(ptr)` | Return the value pointed to by `ptr`.             |
| `ReturnNull()`    | Return a null pointer (useful for pointer returns). |
| `DoDefault()`     | Perform the default action (as set with `ON_CALL`), or built-in default. |

Example:

```cpp
EXPECT_CALL(mock, GetCount())
    .WillOnce(Return(42));
```

### Side Effect Actions

Actions can also have side effects on input parameters or global state:

| Action                  | Description                                         |
|-------------------------|-----------------------------------------------------|
| `SetArgPointee<N>(val)` | Sets the value pointed to by the N-th argument to `val`. |
| `SaveArg<N>(pointer)`   | Copies the N-th argument to the location pointed by `pointer`. |
| `DeleteArg<N>()`        | Deletes the pointer passed as argument N.          |
| `Assign(&var, value)`   | Assigns `value` to `var`.                           |
| `Throw(exception)`      | Throws the given exception.                         |

Use side effect actions to simulate output parameters, mutate state, or trigger error conditions.

### Invoking Functions or Callables

You can specify any callable as an action, including functions, lambdas, functors, or method pointers:

```cpp
EXPECT_CALL(mock, Process(_))
    .WillOnce(Invoke(MyFunction));
```

- `Invoke(f)` will call `f` with the arguments passed to the mock method.
- `Invoke(object, &Class::Method)` invokes a member method.
- `InvokeWithoutArgs(f)` calls the callable with no arguments.
- `InvokeArgument<N>(args...)` calls the N-th argument (if callable) with `args...`.

The flexibility lets you hook in arbitrary logic.

### Composite Actions

You may want to do several actions in sequence when a mock method is called:

| Action         | Description                                              |
|----------------|----------------------------------------------------------|
| `DoAll(a1,...,an)` | Performs all actions `a1` through `an`, returning the result of the last. |
| `IgnoreResult(a)`   | Performs action `a` but ignores its result.           |
| `WithArg<N>(a)`     | Extracts N-th argument and passes it to action `a`.    |
| `WithoutArgs(a)`    | Performs action `a` with no arguments.                  |

Example combining setting output and returning a value:

```cpp
EXPECT_CALL(mock, GetData(_))
    .WillOnce(DoAll(SetArgPointee<0>(value), Return(true)));
```

### Defining Custom Actions

Beyond built-in actions, you can define your own using:

- Lambdas or functors with `operator()` matching the mock method signature.
- Legacy `ACTION()`, `ACTION_P()`, and `ACTION_TEMPLATE()` macros for quick definitions.
- Implementing `ActionInterface<F>` for fine-grained control.

Custom actions can capture state, perform complex operations, and return values dynamically.

### Sharing and Reusing Actions

Actions are copyable and inexpensive to copy. You can store and reuse complex action objects without performance concerns.

### Best Practices for Actions

- Use `Return()` for simple fixed returns.
- Use lambdas or `Invoke` for dynamic or complex behaviors.
- Chain actions with `DoAll` when you need multiple side-effects.
- Prefer `ReturnRef()` for returning references from mocks.
- Avoid `Return()` with move-only objects to prevent runtime errors; use lambdas instead.

---

## User Workflow: Setting Expectations Using Matchers and Actions

1. **Create a Mock Object:**

```cpp
MockFoo mock;
```

2. **Set Default Behaviors with `ON_CALL`:**

Use `ON_CALL` to set default actions that happen when a method is called but you don’t need to assert that it must be called.

```cpp
ON_CALL(mock, DoWork(_))
    .WillByDefault(Return(true));
```

3. **Set Expectations with `EXPECT_CALL`:**

Use `EXPECT_CALL` to specify which calls you expect, with argument matchers and actions.

```cpp
EXPECT_CALL(mock, DoWork(Ge(10)))
    .Times(3)
    .WillRepeatedly(Return(true));
```

4. **Use `.With()` to Match Arguments as a Whole:**

```cpp
EXPECT_CALL(mock, SetPosition(_, _)).With(Lt()).Times(AnyNumber());
```

5. **Chain `WillOnce` and `WillRepeatedly`:**

Specify different behavior for consecutive calls:

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

6. **Exercise Your Code:**

Invoke code that uses the mock. GoogleMock ensures expectations are met.

7. **Automatic Verification:**

GoogleMock verifies on mock object destruction that all expectations were satisfied.

---

## Troubleshooting Common Matcher and Action Issues

- **Uninteresting Calls:** Calls to mock methods with no matching expectations trigger warnings by default. Use `NiceMock` to suppress warnings or add catch-all `EXPECT_CALL(...).Times(AnyNumber())`.

- **Unexpected Calls:** Calls that do not match any active `EXPECT_CALL` generate errors.

- **Actions Exhausted:** If `WillOnce()` clauses run out and no `WillRepeatedly()`, a default action runs and a warning is generated.

- **Move-Only Types:** Use lambdas for actions returning move-only types instead of `Return()`.

- **Overloaded Methods:** Disambiguate using argument matchers or `Const()` wrapper.

- **Unmatched Arguments:** Review matcher specificity; use verbose output by running tests with `--gmock_verbose=info`.

---

## Summary

Matchers enable precise argument validation beyond equality, using built-in predicates, combinators, and custom matchers for flexible test specifications. Actions define dynamic mock method behaviors including returning values, setting output arguments, chaining behaviors, invoking callbacks, and custom logic. Together, they power GoogleMock's expressive, maintainable mocking capabilities.

<Info>
For deep mastery, refer to:
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for practical recipes.
- [Matchers Reference](reference/matchers.md) for full matcher descriptions.
- [Actions Reference](reference/actions.md) for built-in and custom actions.
- [Mocking Reference](docs/reference/mocking.md) for expectation setup and sequencing.
</Info>