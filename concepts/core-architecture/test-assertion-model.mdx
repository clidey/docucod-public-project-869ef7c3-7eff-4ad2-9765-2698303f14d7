---
title: "Assertion and Failure Model"
description: "Examine how assertions are used to express and report expectations. Grasp the difference between fatal and non-fatal failures, and their role in test outcomes and reporting."
---

# Assertion and Failure Model

Understanding how assertions work in GoogleTest and GoogleMock is fundamental to writing effective and reliable tests. This guide dives into the mechanisms of expressing expectations through assertions, differentiating between fatal and non-fatal failures, and how these influence test outcomes and output reporting.

---

## Understanding Assertions and Expectations

Assertions in GoogleTest serve as the tool to declare conditions your program should satisfy at runtime. In the context of mocks (gMock), expectations are a specialized kind of assertions that define how mock methods should be called.

- **Assertion Purpose:** Validate that code behaves as intended by confirming specific conditions.
- **Expectations Purpose:** Ensure that mocked methods are called with the correct parameters, the correct number of times, and in the right order when needed.

Assertions typically fall into two categories:

- **Fatal Failures:** Use macros like `ASSERT_*`. When a fatal failure occurs, the current test function aborts immediately.
- **Non-Fatal Failures:** Use macros like `EXPECT_*`. Even if failures arise, the test function continues, allowing multiple failures to be reported in one run.

### How Failures Affect Test Execution

- Fatal failures halt execution of the current test invocations but allow the test suite to continue.
- Non-fatal failures report an error but let the test continue, facilitating a broader understanding of multiple issues.

### Example

```cpp
TEST(DemoTest, BasicAssertions) {
  int a = 5, b = 6;
  EXPECT_EQ(a, b) << "a and b should be equal";  // Non-fatal
  ASSERT_EQ(a + 1, b) << "a + 1 should equal b"; // Fatal, test ends here if fails
  // This line runs only if assertion passes
  EXPECT_TRUE(a < b);
}
```

## Assertions in GoogleMock with Mocks

In mocking, assertions often manifest as expectations that define the required interaction between the code under test and its dependencies.

- **`EXPECT_CALL`:** Sets expectations on mock method calls such as how many times it must be called, what arguments it expects, and what action it will perform.
- **`ON_CALL`:** Specifies default behavior without setting expectations.

Failing expectations typically cause **non-fatal failures**, reported in detail, such as unexpected calls or calls exceeding the number of expected invocations.

<Tip>
Always set expectations *before* exercising your code under test to allow GoogleMock to detect violations as they occur.
</Tip>

## Types of Failures in GoogleMock Output

Examining test outputs, different failure types clarify the nature of the problem:

### 1. **Expected Call Matches:**
When a mock method call matches an expectation, GoogleMock can print info messages if verbosity level is set to `info`.

Example snippet from output:

```
FILE:#: EXPECT_CALL(foo_, Bar2(0, _)) invoked
Stack trace:

FILE:#: Mock function call matches EXPECT_CALL(foo_, Bar2(0, _))...
    Function call: Bar2(0, 0)
          Returns: false
Stack trace:
[       OK ] ...
```

### 2. **Explicit Actions Run Out Warning:**
If the number of `WillOnce()` actions specified in the expectation is fewer than the expected call count, GoogleMock warns that the actions ran out and that a default action is used thereafter.

```
GMOCK WARNING:
FILE:#: Too few actions specified in EXPECT_CALL(foo_, Bar2(_, _))...
Expected to be called twice, but has only 1 WillOnce().
```

### 3. **Unexpected Calls:**
When a call does not match any active expectation, GoogleMock reports an unexpected call.

Sample failure message:

```
unknown file: Failure

Unexpected mock function call - returning default value.
    Function call: Bar2(1, 0)
Google Mock tried the following 1 expectation, but it didn't match:

FILE:#: EXPECT_CALL(foo_, Bar2(0, _))...
  Expected arg #0: is equal to 0
           Actual: 1
         Expected: to be called once
           Actual: never called - unsatisfied and active

[  FAILED  ] ...
```

### 4. **Excessive Calls:**
If a mock method is called more times than expected, it is flagged as an excessive call.

```
FILE:#: Failure
Mock function called more times than expected - returning default value.
    Function call: Bar2(0, 1)
          Returns: false
         Expected: to be called once
           Actual: called twice - over-saturated and active
```

### 5. **Uninteresting Calls:**
Mock method calls without expectations but with a default action produce warnings unless suppressed by `NiceMock` or other mechanisms.

```
GMOCK WARNING:
Uninteresting mock function call - returning default value.
    Function call: Bar2(0, 1)
NOTE: You can safely ignore the above warning unless this call should not happen.
```

## Behavior of Retired and Unsatisfied Expectations

- **Retired Expectations:** Expectations that have been satisfied and no longer considered active matching candidates.
- **Unsatisfied Expectations:** Expectations that were never matched enough times before the mock object is destructed, resulting in failures.

GoogleMock will report failures if unsatisfied expectations remain at the end of tests.

## Failures Due to Argument Mismatches and Pre-requisite Violations

GoogleMock details argument mismatches between expected and actual calls, including which argument(s) diverged.

Additionally, when using call ordering via sequences or `.After()`, it notifies users if calls violate the specified pre-requisite ordering.

Example of unsatisfied pre-requisites:

```
Unexpected mock function call - returning default value.
    Function call: Bar2(1, 0)
      ...
    Expected: all pre-requisites are satisfied
      Actual: the following immediate pre-requisites are not satisfied:
    pre-requisite #0
    pre-requisite #1
                   (end of pre-requisites)
```

## Leak Detection

GoogleMock detects leaked mock objects that never get deleted, which can mask unsatisfied expectations.

```
ERROR: 3 leaked mock objects found at program exit. Expectations on a mock object are verified when the object is destructed.
Leaking a mock means that its expectations aren't verified, which is usually a test bug.
```

Leaked mocks can be suppressed using `testing::Mock::AllowLeak` if intentional.

## Practical Tips for Assertion and Failure Management

- Use **`EXPECT_*`** macros for failures that should not abort a test immediately, facilitating multiple check points.
- Use **`ASSERT_*`** macros for critical test failure points where continuing does not make sense.
- For mocks, set **expectations (`EXPECT_CALL`) explicitly before exercising code** to reliably catch failures.
- Be aware of the difference between **uninteresting calls** (methods called without expectations) and **unexpected calls** (methods called but which do not match any defined EXPECT_CALL).
- Suppress uninteresting warnings using `NiceMock` or explicit catch-all expectations if desired.
- Enable **`--gmock_verbose=info`** for detailed traces during debugging to see matching and non-matching calls closely.

<Tip>
When you see unexpected call failures, inspect the detailed output which includes mismatch breakdowns and stack traces to pinpoint the source of discrepancy.
</Tip>

## Summary of User Flow in Assertion and Failure Reporting

1. **Define expectations** using `EXPECT_CALL` with call counts, argument matchers, and actions.
2. **Run your code** that interacts with mocks.
3. On each mock invocation, GoogleMock:
   - Looks for matching expectations in reverse order.
   - If found and not saturated, uses specified or default action.
   - If no match, reports unexpected call failure.
   - If an action list runs out, warns and defaults.
4. After test completes or mock destructs:
   - Unsatisfied expectations are reported as failures.
   - Leaked mock objects cause error messages.

This flow ensures that tests fail exactly when the interaction does not conform to the specification.

## Troubleshooting Common Assertion Failures

- **Too few calls:** Verify that the code calls the mocked method as expected.
- **Too many calls:** Review if your calls exceed the expected count or if the expectation uses `Times(AtMost(n))` or similar.
- **Argument mismatches:** Check argument matchers and the test code providing inputs.
- **Call order violations:** Use `InSequence` or `After` to specify call order if order matters.
- **Uninteresting calls warning:** Use `NiceMock` or specify expectations to capture them explicitly if necessary.

<Tip>
Use verbose output and stack traces to understand why a particular call did not match expectations.
</Tip>

---

## References and Further Reading

- [gMock Cookbook â€” Setting Expectations and Handling Failures](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#knowing-when-to-expect-useoncall)
- [Mocking Reference - EXPECT_CALL and ON_CALL](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#EXPECT_CALL)
- [GoogleTest Assertion Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Core Concepts and Terminology in GoogleTest](https://docs.google.com/document/d/overview/core-architecture-and-concepts/core-concepts-and-terminology)

---

## Summary

This page provides a comprehensive overview of how GoogleTest and GoogleMock use assertions to express expectations and detect failures during testing. It clarifies the distinction between fatal and non-fatal failures and explains the detailed reporting mechanisms GoogleMock uses for common failure scenarios such as unexpected calls, excessive invocations, and argument mismatches. The documentation also offers practical advice for managing mock expectations, controlling warnings, and troubleshooting assertion failures through verbose output.

### Key Sections

- Understanding Assertions and Expectations
- Failures and Test Execution Impact
- Mock Expectations and Failure Types
- Reporting Unexpected and Excessive Calls
- Retired and Unsatisfied Expectations
- Leak Detection and Suppression
- Practical User Flow and Troubleshooting Tips

### Important Links

- [GoogleMock Cookbook - Knowing When to Expect (ON_CALL vs EXPECT_CALL)](/guides/mocking-best-practices/actions-matchers)
- [Mocking Reference - EXPECT_CALL & ON_CALL](/api-reference/mocking-framework/expectations-actions)
- [GoogleTest Assertions Reference](/api-reference/core-api/assertions)

### Cross-References

- Related concepts: Mock Behavior Controls (Nice, Naggy, Strict) - /guides/mocking-best-practices/mock-strictness-modes
- Test Discovery and Execution Flow - /concepts/core-architecture/test-discovery-execution
- Organizing and Grouping Your Tests - /guides/writing-tests/test-organization-suites

### Next Steps

Users are encouraged to deepen their understanding by exploring best practices on defining expectations and handling mock behavior controls. Leveraging verbose logging (`--gmock_verbose=info`) aids in debugging assertion failures effectively. For complex mock interactions, users should review sequencing and ordering expectations to control call order precisely.
