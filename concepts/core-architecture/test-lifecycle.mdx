---
title: "Test Discovery and Execution Lifecycle"
description: "Follow the journey of a test from definition to execution. Learn about test registration, automatic test discovery, structuring of test suites and test cases, and the lifecycle events (SetUp, TearDown) that surround each test run."
---

# Test Discovery and Execution Lifecycle

GoogleTest offers a streamlined yet powerful lifecycle for defining, discovering, and executing tests in C++. This page guides you through the journey of a testâ€”from its initial registration, automatic discovery by the framework, organization within test suites and fixtures, to the lifecycle events that prepare the environment before execution and cleanup afterward.

---

## 1. Test Registration and Automatic Discovery

At the core of GoogleTest's seamless user experience is automatic test registration. Whenever you define a test using macros like `TEST`, `TEST_F`, or other test-defining macros, GoogleTest immediately registers it with the global test registry. This enables the framework to discover all tests without the need for manual enumeration.

### Key Concepts

- **Static Registration:** Each `TEST` or `TEST_F` macro invocation defines a test function and registers metadata about the test fixture, test name, location, and the object factory responsible for creating the test instance.

- **Unique Identification:** Tests are uniquely identified by their *test suite* and *test name*. The combination serves as the test's full name.

- **Role of Test Fixture Classes:** For `TEST_F`, the test suite name matches the fixture class name. GoogleTest enforces a rule that all tests in the same test suite must use the same fixture class.

### User Perspective

You simply write:

```cpp
TEST(MyTestSuite, DoesSomething) {
  EXPECT_TRUE(DoSomething());
}

class MyFixture : public testing::Test {
 protected:
  void SetUp() override { /* prepare fixture */ }
};

TEST_F(MyFixture, WorksWithFixture) {
  EXPECT_EQ(42, Answer());
}
```

Behind the scenes, these are automatically known and ready to run when `RUN_ALL_TESTS()` is called.

---

## 2. Structuring Tests into Test Suites and Fixtures

GoogleTest groups related tests into **test suites**, which serve as logical containers. A test suite name can be arbitrary but typically maps to the feature or class being tested. Test suites can optionally share a **test fixture**: a class that lets you define common setup/teardown and shared objects.

### Test Suites

- Correspond with test collection named in the `TEST` or `TEST_F` macros.
- GoogleTest maintains metadata for each test suite including the list of constituent tests.
- Each test suite tracks aggregated results like the number of passed, failed, or skipped tests.

### Test Fixtures

- Fixture classes derive from `testing::Test` and may override `SetUp()` and `TearDown()` for per-test initialization and cleanup.
- Fixtures may also define **per-test-suite shared setup and teardown** methods:
  - `static void SetUpTestSuite()` that runs once before any test in the suite.
  - `static void TearDownTestSuite()` that runs once after all tests in the suite.

This design allows:

- Avoiding expensive setup on each test.
- Sharing read-only or resettable resources across tests.

### Example

```cpp
class DatabaseTest : public testing::Test {
 protected:
  static void SetUpTestSuite() {
    // Initialize shared DB connection
  }

  static void TearDownTestSuite() {
    // Close DB connection
  }

  void SetUp() override {
    // Start transaction
  }

  void TearDown() override {
    // Rollback transaction
  }
};

TEST_F(DatabaseTest, InsertRecord) {
  EXPECT_TRUE(db.Insert(...));
}

TEST_F(DatabaseTest, DeleteRecord) {
  EXPECT_TRUE(db.Delete(...));
}
```

This setup ensures a consistent environment while minimizing costly operations.

---

## 3. Test Lifecycle: From SetUp to TearDown

Every individual test goes through a well-defined lifecycle that guarantees isolation and proper resource management.

### Lifecycle Methods

1. **Fixture Object Creation**: For each test, a fresh test fixture object is created.
2. **SetUpTestSuite** (static): Called once per test suite before any test runs.
3. **SetUp**: Called before each test method to prepare the test fixture.
4. **Test Body Execution**: The actual test code runs here.
5. **TearDown**: Immediately after the test body, for cleanup.
6. **Fixture Object Destruction**: The test fixture instance is destroyed.
7. **TearDownTestSuite** (static): Called once after all tests in the suite complete.

### Important Notes

- The fixture object is **NOT** reused across multiple tests to ensure test independence.
- If an assertion fails fatally (`ASSERT_*` macros), the current test function aborts but following tests in the suite continue.
- Setup and teardown failures (e.g., in `SetUpTestSuite` or `SetUp`) can cause tests to be skipped.

### Example Scenario

For `TEST_F(MyFixture, SomeTest)`, the sequence is:

```none
Create MyFixture instance
Call SetUpTestSuite() if first test
Call SetUp()
Run SomeTest's test body
Call TearDown()
Destroy MyFixture instance
Call TearDownTestSuite() if last test
```

---

## 4. Execution Flow and Event Notifications

GoogleTest emits event notifications throughout test execution via an extensible event listener API to facilitate custom logging, reporting, or integration.

### Event Listener Callbacks

- **OnTestProgramStart**: Before any tests run.
- **OnTestIterationStart**: Before each iteration if test repetition is enabled.
- **OnEnvironmentsSetUpStart / End**: Before and after global environments setup.
- **OnTestSuiteStart / End**: Surrounds an entire test suite execution.
- **OnTestStart / End**: Wraps execution of each individual test.
- **OnTestPartResult**: Called after each assertion or explicit success/failure.
- **OnEnvironmentsTearDownStart / End**: Before and after global environments teardown per iteration.
- **OnTestIterationEnd**: After each iteration finishes.
- **OnTestProgramEnd**: After all tests and environments complete.

This event model enables fine-grained control over test monitoring and modifications.

---

## 5. Test Filtering and Execution Control

GoogleTest supports running a selective subset of tests using filtering based on test names, test suite names, or patterns.

### Filter Syntax

- Use the flag `--gtest_filter=PositivePatterns[-NegativePatterns]`.
- Patterns are colon-separated glob-wildcards, e.g., `FooTest.*:BarTest.Baz*`.
- Negative patterns exclude matching tests.
- Filtering applies consistently across all registered tests.

### Examples

```shell
./my_tests --gtest_filter=NetworkTest.*
./my_tests --gtest_filter=*Error* -LoggingTest.*
./my_tests --gtest_filter=*
```

### Fail Fast

- Set `--gtest_fail_fast` to stop test execution upon the first failure.

### Test Sharding

- Environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX` enable distributed execution across multiple machines or processes.

---

## 6. Summary and Practical Tips

- Always use well-named test suites and fixtures to organize your tests and simplify management.
- Avoid sharing state between tests except via proper fixture static setup/teardown.
- Use `SetUpTestSuite` and `TearDownTestSuite` to optimize expensive shared resource management.
- `RUN_ALL_TESTS()` will automatically discover and execute all registered tests.
- Use filtering and sharding features to speed up large test runs or focus debugging.

---

## 7. Diagram: Test Discovery and Execution Lifecycle

```mermaid
flowchart TD
  %% Test Registration and Discovery
  TEST_DEF[Test Definition (TEST, TEST_F, etc.)] --> REG[Static Registration at Startup]
  REG --> REGISTRY[(Global Test Registry)]

  %% Test Execution Start
  main_func["main() calls RUN_ALL_TESTS()"] --> INIT_INIT["Initialize GoogleTest flags"]
  INIT_INIT --> RUN_ALL["RUN_ALL_TESTS()"
   "Iterate over registered test suites and tests"]

  %% Per Test Suite Execution
  RUN_ALL -->|for each TestSuite| SUITE_START["OnTestSuiteStart"]
  SUITE_START --> SUITE_SETUP["Call SetUpTestSuite()"]

  %% Per Test Execution
  SUITE_SETUP -->|for each Test| TEST_START["OnTestStart"]
  TEST_START --> F_CREATE["Create Fixture Object"]
  F_CREATE --> F_SETUP["Call SetUp()"]
  F_SETUP --> T_BODY["Run TestBody()"]
  T_BODY --> F_TEARDOWN["Call TearDown()"]
  F_TEARDOWN --> F_DESTROY["Destroy Fixture Object"]
  F_DESTROY --> TEST_END["OnTestEnd"]
  TEST_END --> SUITE_END["OnTestSuiteEnd"]

  SUITE_END --> SUITE_TEARDOWN["Call TearDownTestSuite()"]
  SUITE_TEARDOWN --> RUN_ALL

  %% Test Program End
  RUN_ALL --> PROG_END["OnTestProgramEnd"]

  %% Styles
  classDef event fill:#f9f,stroke:#333,stroke-width:2px;
  class SUITE_START,SUITE_END,TEST_START,TEST_END,PROG_END event;
```

---

## 8. Troubleshooting Common Issues

### Test Not Running

- Ensure your source file is compiled and linked correctly.
- Verify test names and suite names are free of underscores to avoid name clashes.
- Check filters (`--gtest_filter`) are not excluding your test.

### `SetUp` or `SetUpTestSuite` Not Called

- Confirm correct casing (`SetUp`, not `Setup`).
- Make sure the methods are declared **static** for suite-level setup.

### Mixing Test Macros in the Same Suite

GoogleTest does not allow mixing `TEST` and `TEST_F` in the same test suite. If this occurs, rename one to separate suites.

### Fatal Assertions in Constructors or Destructors

Fatal assertions cannot be used in constructors or destructors; use `SetUp`/`TearDown` instead.

### Fixture Sharing Across Suites

Each test suite must have a unique fixture class. Avoid sharing fixture classes across suites to prevent conflicts.

---

## 9. Additional Resources

- [GoogleTest Primer](primer.md) for foundational concepts.
- [Test Definition & Execution API Reference](reference/testing.md#Test) for detailed API.
- [Advanced GoogleTest Topics](advanced.md) for sophisticated test lifecycle control.
- [Organizing Test Suites Guide](guides/core-workflows/organizing-test-suites) for best practices in large codebases.
- [FAQ: Test Execution Troubleshooting](docs/faq.md#test-execution-failures) for common pitfalls.
