---
title: "Matchers, Assertions & Result Evaluation"
description: "Delve into the matcher and assertion system, enabling expressive expectations for test and mock outcomes. This page clarifies how values are matched, results are checked, and diagnostics are produced to provide actionable feedback during testing."
---

# Matchers, Assertions & Result Evaluation

GoogleTest’s matcher and assertion system provides a powerful, expressive way to define expected outcomes and verify behavior in your tests and mocks. This guide dives deep into how values are matched against expectations, how assertion results are evaluated, and how informative diagnostics are generated to help you pinpoint issues during testing.

---

## Understanding Matchers

Matchers in GoogleTest and GoogleMock serve as predicates that specify criteria that values or arguments must satisfy. They enable writing expectations and assertions in clear, expressive, and flexible ways that read almost like natural language.

### What Is a Matcher?

A matcher is a function object that checks if a given value meets certain criteria, such as equality, inequality, range checks, or complex custom conditions. Instead of hard-coding values, you use matchers to specify what kind of arguments or results are acceptable.

### Common Matcher Usage

- Exact matching: `Eq(5)`, `IsNull()`, `StartsWith("Hello")`
- Wildcards: `_` matches any value
- Composite matchers: `AllOf()`, `AnyOf()`, `Not()` for combining criteria
- Custom matchers: Define your own logical predicates

### Example

```cpp
using ::testing::_;
using ::testing::Gt;
using ::testing::StartsWith;
using ::testing::Return;

EXPECT_CALL(mock, Process(_))
    .Times(AtLeast(1))
    .WillRepeatedly(Return(true));

EXPECT_THAT(value, AllOf(Gt(5), StartsWith("foo")));
```

This sets expectations that `Process` is called at least once with any argument, returning `true`, and asserts that `value` is greater than 5 and starts with "foo".


## Assertions: What They Are and How To Use Them

Assertions report success or failure of conditions in test code. GoogleTest defines a rich set of assertion macros to validate boolean conditions, equality, exceptions, and even matcher-based conditions.

### Types of Assertions

- **Basic Boolean assertions:** `EXPECT_TRUE(condition)`, `ASSERT_FALSE(condition)`
- **Equality assertions:** `EXPECT_EQ(val1, val2)`, `ASSERT_NE(val1, val2)`
- **String comparisons:** `EXPECT_STREQ(str1, str2)`, `EXPECT_STRNE(str1, str2)`
- **Floating-point comparisons:** `EXPECT_FLOAT_EQ(val1, val2)`, `EXPECT_NEAR(val1, val2, abs_error)`
- **Exception assertions:** `EXPECT_THROW(statement, ExceptionType)`, `EXPECT_NO_THROW(statement)`
- **Predicate assertions:** complex predicates with better failure messages
- **Matcher-based assertions:** `EXPECT_THAT(value, matcher)`, `ASSERT_THAT(value, matcher)`

### Example

```cpp
EXPECT_EQ(result, expected) << "Result did not match expected value";
EXPECT_THAT(name, StartsWith("Test"));
EXPECT_TRUE(IsValid(input));
EXPECT_THROW(PerformAction(), std::runtime_error);
```

### EXPECT_ vs ASSERT_

- `EXPECT_` macros report failures but continue test execution.
- `ASSERT_` macros generate fatal failures and abort the current test function.

Use ASSERT_ when subsequent test code depends on the assertion succeeding.


## Using Matchers Inside Assertions

Matchers enhance assertions by letting you express complex conditions that the tested values should satisfy.

### The `EXPECT_THAT` and `ASSERT_THAT` Macros

They allow matching using existing or custom matchers instead of simple boolean comparisons.

Example:

```cpp
EXPECT_THAT(container, Contains(5));
ASSERT_THAT(text, MatchesRegex("^Hello.*world!$"));
```

Matchers provide detailed failure messages by showing the expected condition and the actual value.


## Common Matchers

- **Wildcard matcher:** `_` matches any value
- **Comparison matchers:** `Eq()`, `Ne()`, `Lt()`, `Lt()`, `Ge()`, `Gt()`
- **Logical combinators:** `AllOf()`, `AnyOf()`, `Not()`
- **String matchers:** `StartsWith()`, `EndsWith()`, `ContainsRegex()`
- **Container matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `Pointee()` for pointers
- **Custom predicates:** `Truly()` for arbitrary unary predicate functions


## Advanced Matcher Combinations

GoogleMock supports matching tuples of arguments as a whole via `.With()` clauses or multi-argument matchers.

Example:

```cpp
EXPECT_CALL(mock, Func(_, _))
    .With(Lt());  // first arg < second arg
```

You can also compose matchers dynamically:

```cpp
auto complex_matcher = AllOf(Gt(5), Not(Eq(10)));
EXPECT_CALL(mock, Foo(complex_matcher));
```


## Assertion Failure Messages

A significant advantage of GoogleTest’s matcher system is the generation of informative failure messages that help debug issues quickly.

When an assertion fails, GoogleTest outputs:

- The actual value, with pretty-printing wherever possible
- The expected condition, using descriptive matcher text
- Optional additional explanation from custom matchers

Example:

```
Value of: value
  Actual: 3
Expected: is divisible by 5
```


## Predicate Assertions

For complex custom conditions, GoogleTest provides predicate assertions that let you define functions or functors returning `bool` or `AssertionResult`.

- `EXPECT_PRED1` ... `EXPECT_PRED5` accept predicates with 1-5 arguments.
- `EXPECT_PRED_FORMAT` versions allow returning detailed failure messages.

Example:

```cpp
bool IsPrime(int n);
EXPECT_PRED1(IsPrime, value);
```


## Assertion Macros Summary

| Assertion Macro            | Description                                           |
|----------------------------|------------------------------------------------------|
| `EXPECT_TRUE(cond)`         | Verifies condition is true; nonfatal failure on fail |
| `ASSERT_FALSE(cond)`        | Verifies condition false; fatal failure on fail       |
| `EXPECT_EQ(val1, val2)`     | Checks `val1 == val2`                                  |
| `EXPECT_STREQ(str1, str2)` | Checks C string equality by contents                  |
| `EXPECT_THROW(stmt, exc)`   | Checks `stmt` throws exception of type `exc`         |
| `EXPECT_THAT(val, matcher)` | Checks val matches matcher                            |


## Best Practices

- **Use matchers to keep tests readable and expressive.**
- **Use `EXPECT_THAT` for flexible and descriptive assertions.**
- **Prefer `EXPECT_` when you want tests to continue, `ASSERT_` when subsequent code depends on success.**
- **Write pure functional matchers without side effects.**
- **Use `ON_CALL` to specify default mock behavior; `EXPECT_CALL` for expectations.**
- **Leverage built-in matchers and combine them as needed.**
- **Write custom matchers for domain-specific logic to improve clarity and diagnostic messages.**


## Troubleshooting Common Issues

- **Ambiguous overloads:** Use `Const()` or cast matchers to resolve.
- **Uninteresting calls warnings:** Use `NiceMock` to suppress, or add appropriate `EXPECT_CALL` with `Times(AnyNumber())`.
- **Action and cardinality mismatches:** Ensure you provide enough `WillOnce` or use `WillRepeatedly` and set `Times` properly.
- **Matcher invocation side-effects:** Matchers must be pure functions without side effects.


## Summary

GoogleTest’s matcher and assertion framework is key to writing precise, maintainable, and expressive tests. By mastering matchers, you can specify fine-grained argument validations and compose expectations that reflect complex real-world conditions. The assertion macros evaluate those expectations and provide rich diagnostics to quickly identify failures and their causes.

---

## See Also

- [Matchers Reference](./matchers.md)
- [Assertions and Failure Reporting](../api-reference/core-testing-framework/assertions-and-failures.md)
- [Mocking Reference](../docs/reference/mocking.md)
- [gMock Cookbook](../docs/gmock_cook_book.md)
- [Creating Custom Assertions](../guides/advanced-usage/custom-assertions.md)
- [Parameterized and Typed Tests](../concepts/advanced-extensibility/parameterization.md)

---

## Recommended Next Steps

1. Explore built-in matchers and experiment with `EXPECT_THAT` in your tests.
2. Learn to create custom matchers for domain-specific validation.
3. Use `ON_CALL` to define default mock behaviors, and `EXPECT_CALL` to assert interactions.
4. Read the Mocking Reference to understand matcher usage in mock expectations.

<Tip>
Mastering the matcher and assertion system empowers you to write robust and readable tests that clearly express intent and provide actionable feedback.
</Tip>

<Warning>
Avoid over-specifying expectations - overly strict assertions can make tests brittle and hard to maintain.
</Warning>

<Note>
Matchers must be pure functions. Do not perform operations with side effects inside matchers.
</Note>
