---
title: "Assertion Mechanisms"
description: "Learn about the backbone of GoogleTestâ€”assertions. Explore the types of assertions (fatal, non-fatal), their syntax, and the underlying model for evaluating test results. Understand how assertion results are internally modeled and surfaced to the user."
---

# Assertion Mechanisms

Assertions are the backbone of GoogleTest, providing the means to verify that your code behaves as expected. This guide explores the types of assertions in GoogleTest, from fatal to non-fatal assertions, explains their syntax, and delves into the underlying model GoogleTest uses to evaluate and report test results.

## Understanding Assertions in GoogleTest

Assertions are conditions that you check within your test functions. Depending on the assertion type, they can cause the test to either continue running after a failure or abort immediately. GoogleTest provides a variety of assertion macros designed to fit many testing scenarios.

### Fatal vs Non-Fatal Assertions

GoogleTest categorizes assertions into two main types:

- **Fatal Assertions (`ASSERT_*`)**: These signal that a critical failure occurred. When a fatal assertion fails, GoogleTest aborts the current function immediately, preventing further statements from executing. They are typically used when subsequent code depends on the success of the assertion.

- **Non-Fatal Assertions (`EXPECT_*`)**: These generate failures but allow the test function to continue running. Use non-fatal assertions when you want to verify multiple conditions in a single test without stopping at the first failure.

The distinction lets you balance thoroughness with early exit when a critical condition is violated.

### Custom Failure Messages

All assertion macros in GoogleTest support streaming an optional user-defined failure message using the `<<` operator. This message enriches the failure report with context tailored to your test case.

```cpp
EXPECT_TRUE(my_condition) << "Condition failed because x is incorrect";
```

Anything that can be output to a standard C++ `ostream` can be used as part of the message, including strings and numeric values. Wide strings (`std::wstring` or platform-specific types) are converted to UTF-8 for readability.

## Assertion Macros Overview

GoogleTest offers a comprehensive set of macros for assertions, organized by their purpose and behavior.

### 1. Explicit Success and Failure

These macros directly indicate success or failure without evaluating an expression. They are useful for controlling test flow explicitly.

- **SUCCEED()**: Marks an explicit success.

  - _Note_: `SUCCEED()` does _not_ make the entire test succeed on its own; the test passes only if no other assertions fail.
  - Currently, it emits no output but may provide informational messages in future releases.

- **FAIL()**: Generates a fatal failure and aborts the current function.

  - Use only in `void` returning functions.

- **ADD_FAILURE()**: Generates a non-fatal failure and allows the test to proceed.

- **ADD_FAILURE_AT(file, line)**: Generates a non-fatal failure reported at a specific file location.

#### Use Case Example

```cpp
switch(expression) {
  case 1:
    // ... some checks ...
    break;
  case 2:
    // ... some other checks ...
    break;
  default:
    FAIL() << "Unexpected expression value.";
}
```

### 2. Boolean Condition Assertions

Assertions to check boolean expressions.

- `EXPECT_TRUE(condition)` and `ASSERT_TRUE(condition)`: Verify that `condition` is true.
- `EXPECT_FALSE(condition)` and `ASSERT_FALSE(condition)`: Verify that `condition` is false.

### 3. Comparison Assertions

Used to compare values. These macros test relational operators and equality, providing detailed messages on failures.

- Equality: `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`
- Inequality: `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`
- Less than / less or equal: `EXPECT_LT(val1, val2)`, etc.
- Greater than / greater or equal: `EXPECT_GT(val1, val2)`, etc.

> **Important**: Comparisons of pointers test the pointer addresses, _not_ the string content for C strings. Use specialized string comparison assertions instead.

### 4. String Comparisons

GoogleTest includes specialized macros for comparing C-style strings (`const char*` and wide strings):

- `EXPECT_STREQ` / `ASSERT_STREQ`: Verify strings have the same content.
- `EXPECT_STRNE` / `ASSERT_STRNE`: Verify strings have different content.
- Case-insensitive versions: `EXPECT_STRCASEEQ`, `ASSERT_STRCASEEQ`, etc.

### 5. Floating-Point Comparisons

Due to the intricacies of floating-point arithmetic, simple equality checks are not adequate. GoogleTest addresses this with dedicated macros:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`: Verify floats are approximately equal within 4 ULPs.
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`: Same for doubles.
- `EXPECT_NEAR` / `ASSERT_NEAR`: Verify values are within a user-defined absolute error.

### 6. Exception Assertions

When testing that code throws or does not throw exceptions (assuming exceptions are enabled), GoogleTest offers:

- `EXPECT_THROW` / `ASSERT_THROW`: Verify that a statement throws an exception of a specific type.
- `EXPECT_ANY_THROW` / `ASSERT_ANY_THROW`: Verify that a statement throws any exception.
- `EXPECT_NO_THROW` / `ASSERT_NO_THROW`: Verify that a statement does not throw any exception.

Example:

```cpp
EXPECT_THROW({ThrowError();}, std::runtime_error);
```

### 7. Predicate Assertions

These macros evaluate user-defined predicates, allowing more complex checks with detailed error messages:

- `EXPECT_PREDn`, `ASSERT_PREDn` (n = 1 to 5): Use boolean functions returning `true` or `false`.
- `EXPECT_PRED_FORMATn`, `ASSERT_PRED_FORMATn`: For predicates returning `testing::AssertionResult` for richer failure messages.

Example:

```cpp
bool IsPrime(int n);
EXPECT_PRED1(IsPrime, 7);  // Succeeds if 7 is prime.
```

### 8. HRESULT Assertions (Windows Only)

For Windows COM programming, GoogleTest offers assertions to verify HRESULT values:

- `EXPECT_HRESULT_SUCCEEDED(expression)`, `ASSERT_HRESULT_SUCCEEDED(expression)`: Verify operation succeeded.
- `EXPECT_HRESULT_FAILED(expression)`, `ASSERT_HRESULT_FAILED(expression)`: Verify operation failed.

These assertions print human-readable error messages associated with the HRESULT.

### 9. Death Assertions

Death assertions verify that a piece of code causes the test process to terminate (crash, exit, or abort).

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH`: Verify that `statement` causes termination and stderr output matches `matcher`.
- Variants: `EXPECT_DEATH_IF_SUPPORTED`, `EXPECT_DEBUG_DEATH`, `EXPECT_EXIT` with exit predicate.

#### Death Test Styles

- **Fast:** The child process is spawned via `fork()` or `clone()` and immediately executes the death test.
- **Threadsafe:** The child re-executes the test binary with flags to isolate the death test. More robust with multithreading but slower.

Default style is `fast`, but `threadsafe` is recommended for safety.

## How Assertion Results are Modeled Internally

GoogleTest models the outcome of each assertion as a **TestPartResult** with the following key attributes:

- **Type:** Indicates if the assertion was successful, non-fatal failure, fatal failure, or skipped.
- **Source Location:** File and line number where the assertion occurred.
- **Message:** Failure description, including custom messages and the failed condition.

### Passing and Failing Tests

- A **test case** (i.e., test function) consists of executing multiple assertions.
- The overall test result reflects the success/failure of individual assertions.
- A test **passes** if it produces no fatal or non-fatal failures.
- Failures are logged and reported with detailed messages supporting diagnosis.

### Data Flow of an Assertion

1. An assertion macro evaluates its condition.
2. On failure, it creates a **TestPartResult** describing the issue.
3. The result is reported immediately to the current test listener.
4. The test runner collects results and aggregates them.

## Practical Tips and Best Practices

- Use **`ASSERT_*`** macros when a failure should prevent further test execution.
- Use **`EXPECT_*`** macros to continue checking multiple conditions in the same test.
- Stream custom messages to assertions to improve error context.
- Use **predicate assertions** for complex conditions to improve clarity and failure information.
- Avoid comparing C strings with `EXPECT_EQ`; use specialized string macros.
- For floating-point comparisons, prefer `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` over exact equality.
- For death tests, name test suites with `*DeathTest` and choose the death test style carefully.
- Use `SCOPED_TRACE` to annotate failures in helper functions or loops, improving diagnostics.

## Troubleshooting Common Assertion Issues

### Fatal Assertion in Non-Void Function

Fatal assertions abort the current function, so they are only valid in functions that return `void`. Using them in a non-void function causes compiler errors.

### Evaluation Order

All assertion macro arguments are evaluated exactly once to prevent side effect issues. Avoid expressions with side effects that you do not expect to be repeated.

### String Comparisons

Beware the difference between pointer equality and string content comparison. Use STRING assertions for C strings.

### Floating-Point Precision

Failures in floating-point equality often stem from precision issues. Use near-equality checks and choose appropriate tolerances.

## Summary

Assertions in GoogleTest form the critical foundation for verifying code correctness, ranging from simple truth checks to complex matchers and death tests. Understanding their types, usage patterns, and the test result model ensures you can write robust, precise tests and get actionable feedback.

---

For detailed API usage, see the [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md).

---

## References

- [GoogleTest Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Advanced GoogleTest Topics: Assertions](https://github.com/google/googletest/blob/main/docs/advanced.md#more-assertions)
- [Death Tests and Exception Handling](https://github.com/google/googletest/blob/main/guides/advanced-testing-patterns/death-tests-and-exception-handling.md)
- [Core Architecture: Assertion Mechanisms](https://github.com/google/googletest/blob/main/concepts/core-architecture/assertion-mechanisms.md)

---

## Learn More

Explore these related documentation pages for broader context and deeper mastery:

- Core Testing API: [Test Definition and Execution](https://github.com/google/googletest/blob/main/api-reference/core-testing-api/test-definition-and-execution.md)
- Mocking: [Mocking Reference](https://github.com/google/googletest/blob/main/docs/reference/mocking.md)
- Matchers: [Built-in Matchers](https://github.com/google/googletest/blob/main/api-reference/matchers-and-advanced-actions/builtin-matchers.md)
- Advanced Testing Patterns: [Parameterized and Typed Tests](https://github.com/google/googletest/blob/main/guides/advanced-testing-patterns/parameterized-and-typed-tests.md)

---

This page is part of the core concepts explaining GoogleTest's assertion mechanisms, integral to effective C++ unit testing with comprehensive diagnostics and flexible failure handling.