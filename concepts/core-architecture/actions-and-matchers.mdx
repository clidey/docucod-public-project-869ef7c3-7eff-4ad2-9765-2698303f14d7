---
title: "Actions, Matchers, and Assertions: The Building Blocks"
description: "Learn how matchers define expectations on arguments and return values, and how actions specify dynamic mock behaviors. This page explains the concept of composable assertions, matchers, and actions—central elements for precise and expressive test logic."
---

# Actions, Matchers, and Assertions: The Building Blocks

GoogleMock (gMock) is a powerful C++ framework that enables writing precise and expressive tests through the use of three central elements: **matchers**, **actions**, and **assertions**. This guide delves into these fundamental concepts—explaining how matchers define expectations on function arguments and return values, how actions specify dynamic mock behaviors, and how assertions verify outcomes. Understanding these building blocks empowers you to write robust, maintainable tests that accurately capture your intent.

---

## 1. Understanding Matchers: Specifying Expectations on Arguments

Matchers are predicates that check whether the arguments passed to a mock function satisfy certain conditions. Instead of verbal explanations, matchers let you programmatically express the criteria your mock expects.

### What Matchers Do
- Define **which arguments** a mock function should accept.
- Enable flexible and readable expressions for argument verification.
- Help prevent brittle tests by letting you specify only what matters.

### Using Matchers in `EXPECT_CALL`
When you write an expectation on a mock method, you specify matchers for each argument to define what the test expects. For example:

```cpp
using ::testing::_;  // wildcard matcher
using ::testing::Ge; // greater or equal

EXPECT_CALL(mock_obj, Process(Ge(5), _));
```

This says: when `Process` is called, the first argument must be greater or equal to 5; the second argument can be anything.

### Common Matchers
- `_` — matches anything (wildcard).
- `Eq(value)` — matches if argument equals `value`.
- Relational matchers like `Lt()`, `Gt()`, `Le()`, `Ge()`, `Ne()`.
- Pointer matchers like `NotNull()` and `IsNull()`.
- Container matchers like `ElementsAre()`, `Contains()`, etc.

### Composite Matchers and Multi-Argument Matching
Matchers can be composed logically (e.g. `AllOf()`, `AnyOf()`, `Not()`) to form complex conditions. You can also match multiple arguments as a tuple using `.With()` clause with a multi-argument matcher, allowing conditions on argument relationships.

### Practical Tips and Best Practices
- Use `_` to avoid over-specification.
- Use `Truly()` to apply custom predicates.
- Use `Field()` and `Property()` to match object members or getter results.
- If you’re handling pointers, prefer `Pointee()` to match pointed-to values.

<Info>
Always remember matchers are pure predicates — they should have no side effects and must reliably reflect argument expectations.
</Info>

---

## 2. Actions: Specifying What Mock Methods Do

Actions define the behavior of mock methods when they are called. You tell your mock not just which calls to expect but also what to **do** when those calls happen.

### Default Actions
Mock functions have built-in default actions depending on their return type:
- `void` functions simply return.
- Functions returning pointers or numeric types return zero or `nullptr`.
- Functions returning default-constructible objects return a default-constructed instance.

You can override default behavior using `ON_CALL()` or within `EXPECT_CALL()` to customize how mocks respond.

### Common Built-in Actions
| Action                      | Description                                                  |
| --------------------------- | ------------------------------------------------------------ |
| `Return(value)`             | Returns a copy of `value`.                                   |
| `ReturnRef(variable)`       | Returns a reference to `variable` (live value).             |
| `ReturnPointee(ptr)`        | Returns the value pointed to by `ptr` at call time.          |
| `ReturnNew<T>(args...)`     | Returns a new instance constructed with `args`.             |
| `ReturnNull()`              | Returns `nullptr`.                                           |
| `Assign(&var, value)`       | Assigns `value` to `var`.                                    |
| `SetArgPointee<N>(value)`   | Sets the pointee of argument `N` to `value`.                 |
| `DoAll(a1, ..., an)`        | Performs actions `a1` to `an` in sequence; returns last's value. |
| `IgnoreResult(action)`      | Invokes action, ignores its return value.                    |
| `Invoke(callable)`          | Calls a function, functor, or lambda with the mock's arguments. |
| `InvokeWithoutArgs(callable)` | Calls a callable without passing mock’s arguments.        |
| `InvokeArgument<N>(args...)` | Invokes the callable argument at index `N`, passing supplied args. |
| `Throw(exception)`          | Throws a copy of the given exception.                        |

### Sequencing Actions
Use `DoAll()` to chain multiple actions in one expectation, useful to perform side effects and return a value in one call.

### Using Callables as Actions
Actions can wrap existing functions or lambdas, letting you flexibly define behaviors without writing custom action classes:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(Invoke(&Helper::DoFoo, &helper));
```

### Defining Custom Actions
You may define complex or parameterized custom actions using `ACTION`, `ACTION_P`, or by implementing `ActionInterface`. Use these to tailor behavior beyond built-in options.

### Notes on Side Effects and Move-Only Types
- Actions can have side effects like modifying arguments.
- For move-only types (e.g., `std::unique_ptr`), use lambdas or specially designed actions.

<Warning>
Avoid using `DoDefault()` inside composite actions. It triggers runtime errors.
</Warning>

---

## 3. Composable Assertions: Building Expressive, Precise Test Logic

Assertions in GoogleMock and GoogleTest verify that your mocks are called as expected. Matchers and actions provide the building blocks, while assertions connect your test’s intent to runtime verification.

### Setting Expectations with `EXPECT_CALL`
This macro creates an expectation on a mock function call:

```cpp
EXPECT_CALL(mock_obj, Method(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `matchers...`: Specify what arguments to expect using matchers.
- `Times()`: How many times the call is expected.
- `.WillOnce()/WillRepeatedly()`: What actions the mock will take when called.

### Modifiers to Control Call Order and Dependencies
- `.InSequence(sequence...)`: Require matched calls to occur in the order declared.
- `.After(expectations...)`: Expect calls only occur after certain other expectations.
- `.RetiresOnSaturation()`: Retire the expectation when it reaches its call limit.

### Important Ordering Rules
- Newer expectations override older ones when matching calls.
- Without ordering constraints, calls do not need to happen in expectation order.

### Uninteresting vs Unexpected Calls
- **Uninteresting calls**: Mock method calls without any expectation defined. By default, they cause warnings but not errors.
- **Unexpected calls**: Mock method calls that don't match any active expectation. These always cause test failures.

**Tip:** Use `NiceMock` to suppress uninteresting call warnings, and `StrictMock` to treat them as errors.

### Best Practices
- Set expectations **before** exercising your mocks.
- Use `ON_CALL` for default behaviors when you do not require verification.
- Avoid over-specifying expectations — keep tests flexible and maintainable.
- Sequence multiple calls only when their order is important.

<Check>
Remember that `EXPECT_CALL` evaluates its arguments once. Avoid side effects in matcher or action expressions that depend on runtime values.
</Check>

---

## 4. Summary & Next Steps

Mastering matchers, actions, and assertions is key to harnessing the full power of gMock. By combining flexible matchers with dynamic actions and organized expectations, you create tests that precisely capture your code’s behavior, detect regressions early, and remain maintainable over time.

For practical application and further learning, explore:
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Actions Reference](https://google.github.io/googletest/reference/mock-actions.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)

Remember: start with simple matchers and actions; only increase complexity as test scenarios demand. Use sequences and call orders sparingly for the most robust and clear tests.

---

# Diagram: How Matchers and Actions Fit into Mock Expectations

```mermaid
flowchart TD

  MockObject["Mock Object"] -->|Method Call| ExpectCall["EXPECT_CALL"]
  ExpectCall -->|Defines Argument Expectations| Matchers["Matchers"]
  ExpectCall -->|Defines Behavior| Actions["Actions"]
  Matchers -->|Validate Arguments| Args["Actual Arguments"]
  Actions -->|Produce Response| Response["Mock Method Response"]

  Args -->|Passed to| MockMethod["Mocked Method"]
  MockMethod -->|Arguments| Args
  MockMethod -->|Check Expectations| ExpectCall
  MockMethod -->|Invoke| Actions
  MockMethod -->|Match Call|

  subgraph Internal Mechanism
    ExpectCall -->|Track Calls| Cardinalities["Cardinalities & Ordering"]
  end

  Cardinalities -->|Verify Call Counts & Order| MockMethod

  classDef component fill:#f9f,stroke:#333,stroke-width:2px;
  class ExpectCall,Matchers,Actions,Cardinalities component;
```
