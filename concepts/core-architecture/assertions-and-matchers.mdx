---
title: "Assertions & Matchers"
description: "Discover how assertions and matchers underpin both test verification and mock expectations. This page explains the matcher framework, core assertion types, and their roles in expressing intent clearly and precisely."
---

# Assertions & Matchers

Discover how assertions and matchers underpin both test verification and mock expectations. This guide explains the matcher framework, core assertion types, and their roles in expressing intent clearly and precisely.

---

## Introduction

Assertions and matchers are foundational to writing expressive and precise tests with GoogleTest and GoogleMock. Assertions verify conditions or values, while matchers provide a powerful, flexible system to describe expected argument values and conditions that mock methods should meet.

This page focuses on how GoogleTest uses assertions to validate test outcomes and how GoogleMock employs matchers to specify expectations on mock method calls, helping you write clearer, maintainable tests.

---

## Core Concepts

### Assertions

Assertions check conditions within tests. GoogleTest provides macros that assert truth, equality, exception throwing, and conditions on values.

- **`EXPECT_*` vs. `ASSERT_*`**: `EXPECT_` macros generate nonfatal failures and allow tests to continue; `ASSERT_` macros generate fatal failures and abort the current test function immediately.
- Assertions can include custom messages streamed via `<<` for richer failure descriptions.

### Matchers

Matchers specify properties that input values or arguments should satisfy. They are used in the `EXPECT_THAT` assertion and within `EXPECT_CALL` and `ON_CALL` in GoogleMock.

Matchers can be:
- Simple values (e.g., `5` which implies `Eq(5)`).
- Wildcards like `_` that match anything.
- Compound, parameterized, or custom predicates.

Matchers enable readable, precise expectations; for example:

```cpp
EXPECT_CALL(mock, Foo(Ge(5), Lt(10)));  // Foo called with arg1 >= 5 and arg2 < 10
EXPECT_THAT(value, StartsWith("Hello"));  // String value starts with "Hello"
```

---

## Using Assertions Effectively

GoogleTest provides a wide range of assertions. Here are some important categories:

### Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

### Equality and Comparison

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` — asserts equality (`==`)
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` — asserts inequality (`!=`)
- `EXPECT_LT(val1, val2)`, `EXPECT_LE`, `EXPECT_GT`, `EXPECT_GE` — relational assertions

### String Comparisons

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` — compares C strings by contents
- `EXPECT_STRNE`, `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE` — more string comparators

### Exception Assertions

- `EXPECT_THROW(statement, exception_type)`
- `EXPECT_NO_THROW(statement)`

### Generalized Assertions with Matchers

- `EXPECT_THAT(value, matcher)` / `ASSERT_THAT(value, matcher)`

These allow you to apply GoogleMock-style matchers directly within GoogleTest assertions.

Example:

```cpp
EXPECT_THAT(my_string, StartsWith("Error"));
```

---

## Matchers Framework Overview

### Matchers Basics

Matchers are predicates describing expected properties of values:

- Built-in matchers include `Eq()`, `Ne()`, `Lt()`, `Gt()`, `Ge()`, `Le()`, `_` (anything), `Not()`, `AllOf()`, `AnyOf()`, and many more.
- Special matchers like `Pointee(matcher)` verify properties of the object a pointer points to.
- Matchers can be parameterized, combined, and composed.

Example:

```cpp
EXPECT_CALL(mock, SetPosition(AllOf(Ge(0), Le(100)), _));
```

### Polymorphic and Monomorphic Matchers

Matchers can be used generically for different types (polymorphic), or specifically to one type (monomorphic). The framework seamlessly adapts to the type context where the matcher is applied.

### Custom Matchers

You can define your own matchers using the `MATCHER`, `MATCHER_P`, and related macros. They allow including custom logic and failure messages that integrate tightly with GoogleTest's reporting.

Example:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_THAT(x, IsEven());
```

### Composite and Stateful Matchers

Matchers can be combined for complex criteria:

- `AllOf(m1, m2)` matches if all sub-matchers match.
- `AnyOf(m1, m2)` matches if any sub-matcher matches.

You can also write stateful matchers for advanced use cases.

---

## Assertions and Matchers in Mocking

Matchers enable expressive expectations for mock method calls.

### EXPECT_CALL and Argument Matching

The `EXPECT_CALL` macro sets expectations on how mocks are called, combined with matchers to specify argument constraints.

Example:

```cpp
EXPECT_CALL(mock, ProcessData(Ge(10), StartsWith("foo")));  
```

The framework verifies calls at runtime, comparing arguments to matchers and verifying call counts.

### Cardinalities

`Times()` controls how many times the expectation applies.

- `Times(Exactly(n))`, `Times(AtLeast(n))`, `Times(AnyNumber())`, etc.

The framework enforces that calls conform to these limits.

### Actions

Mapping calls to behaviors:

- Use `WillOnce(action)` and `WillRepeatedly(action)` to specify what happens when the mock is called.

If no action is set, default actions or default values apply.

---

## Best Practices and Tips

- Use `ON_CALL` to specify default behaviors without setting hard expectations.
- Use `EXPECT_CALL` to verify that specific calls happen.
- Use matchers sparingly and precisely to avoid brittle tests.
- When not interested in argument values, use `_` as wildcard.
- Use sequences (`InSequence`) to verify call order.
- Use `RetiresOnSaturation()` to make expectations non-sticky, especially when specifying ordered call sequences.
- Suppress warnings about uninteresting calls with `NiceMock`, or enforce strict checking with `StrictMock`.

---

## Troubleshooting and Debugging

- Unexpected or uninteresting calls generate warnings or errors based on mock strictness.
- Use the `--gmock_verbose` flag to control the verbosity of mock call reporting.
- When tests fail due to call count or argument mismatches, review the detailed messages which include call argument values and source locations.

---

## Summary

The assertions and matchers system in GoogleTest and GoogleMock provides a powerful mechanism to verify behavior and expectations in tests. By leveraging rich matcher expressions and assertion macros, tests are precise, expressive, and maintainable.

For effective testing, understand the role of each assertion and matcher, plan your mock expectations carefully, and exploit the composability of matchers for clarity and robustness.

---

## Additional Resources

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Introductory tutorial on mocking.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Advanced recipes and patterns for mock usage.
- [Matchers Reference](/api-reference/advanced-behaviors/argument-matchers) — Comprehensive list and details of matchers.
- [Assertions Reference](/api-reference/core-apis/assertions) — Detailed GoogleTest assertions.
- [Using Mocks and Expectations](/guides/effective-testing-techniques/mocking-workflows) — Best practices for mocks.

---

## Navigation

- Part of the "Core Testing Architecture" concepts grouping.
- Navigate to related topics such as Test Lifecycle, Mocking Mechanism, and Strictness Models for broader understanding.

---

<Callout title="Pro Tip">
The key to effective tests is balancing specificity with flexibility. Overconstraining causes brittle tests; underconstraining lets bugs slip through. Start by setting broad expectations with `ON_CALL`, refine with precise `EXPECT_CALL`s and use matchers to target relevant details only.
</Callout>

<Callout title="Remember">
Always set expectations *before* exercising the code under test. Altering `EXPECT_CALL`s after calls have been made leads to undefined behavior.
</Callout>
