---
title: "Assertions & Matchers"
description: "Dive into the rich assertion and matcher system at the heart of GoogleTest. Learn how built-in and custom assertions work, how matchers enhance expressiveness, and how results are handled as fatal or non-fatal failures."
---

# Assertions & Matchers in GoogleTest

GoogleTest offers a powerful and expressive system of assertions and matchers that serve as the backbone for verifying expected behaviors in your tests. Understanding how built-in and custom assertions operate, how matchers enhance expressiveness, and how results are classified into fatal and non-fatal failures will empower you to write more robust and clear test code.

---

## Understanding Assertions

Assertions are the fundamental way to verify conditions in your test cases. They evaluate boolean expressions and report outcomes as either passing or failing test results.

### Types of Assertions

GoogleTest distinguishes two main categories:

- **Fatal Assertions (`ASSERT_*`)**: If a fatal assertion fails, the current test function halts immediately. This is useful when continuing the test would cause misleading results or crash.

- **Non-fatal Assertions (`EXPECT_*`)**: Upon failure, non-fatal assertions record the failure but continue running the test. Use them when you want to see multiple failures in a single test run.

### Common Assertion Macros

Some frequently used assertions include:

- `ASSERT_TRUE(condition)` / `EXPECT_TRUE(condition)`: Verifies the condition is true.
- `ASSERT_FALSE(condition)` / `EXPECT_FALSE(condition)`: Verifies the condition is false.
- `ASSERT_EQ(val1, val2)` / `EXPECT_EQ(val1, val2)`: Checks that two values are equal.
- `ASSERT_NE(val1, val2)` / `EXPECT_NE(val1, val2)`: Checks that two values are not equal.
- Floating point assertions like `ASSERT_FLOAT_EQ` and `EXPECT_NEAR` for approximate comparisons.

### Crafting Custom Assertions

You can define your own assertion macros or functions to validate domain-specific conditions, offering tailored diagnostics and improving readability.

> **Tip:** Prefer non-fatal assertions for conditions where continuing is safe, and fatal assertions when a failure invalidates subsequent test logic.

---

## The Role of Matchers

Matchers complement assertions by providing a rich language to express expectations on values and function arguments, especially in `EXPECT_THAT()` and mocking contexts.

### What Are Matchers?

A matcher is essentially a predicate that can evaluate whether a given value meets certain criteria. They provide detailed failure messages describing not only that a value failed but why.

> **Real-world analogy:** Consider a matcher as an artistic filter on a photo — it not only accepts or rejects the photo but also explains the characteristics that don’t fit.

### Built-in Matchers Overview

GoogleTest ships with an extensive collection:

- **Wildcard:** `_` matches any value
- **Comparison Matchers:** `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- **Floating-point:** `FloatEq()`, `DoubleEq()`, `Nan()`
- **String:** `StartsWith()`, `EndsWith()`, `Contains()`, `MatchesRegex()`
- **Exception:** `Throws()`, `ThrowsMessage()`
- **Container:** `ElementsAre()`, `Contains()`, `UnorderedElementsAre()`
- **Member:** `Field()`, `Property()`
- **Composite:** `AllOf()`, `AnyOf()`, `Not()`, `WhenSorted()`

### Using Matchers in Expectations

Matchers are primarily used in the following ways:

- To specify expectations on function arguments in mocks: 
  ```cpp
  EXPECT_CALL(mock_obj, Func(Eq(5), Ge(10))); 
  ```

- To assert conditions in tests with `EXPECT_THAT`: 
  ```cpp
  EXPECT_THAT(container, ElementsAre(1, 2, 3));
  ```

- Matching multiple arguments as a grouped tuple with `.With()` in mocks:
  ```cpp
  EXPECT_CALL(mock_obj, Func(_, _)).With(Lt());  // first < second
  ```

### Custom Matchers

When built-in matchers are insufficient, define your own using:

- `MATCHER` macros for simple matchers
- Implementing matcher interfaces for complex polymorphic matchers

Custom matchers provide descriptive failure messages and support negation.

> **Best practice:** Keep matchers pure and free of side effects to ensure deterministic test behavior.

---

## Assertions & Matchers in Mocking

GoogleMock builds extensively on matchers and assertions to set fine-grained expectations on mock method calls.

### Setting Expectations with `EXPECT_CALL`

`EXPECT_CALL(mock_object, method(matchers...))` sets up expectations on when and how the mocked method should be called. The framework uses matchers to verify argument values and provides clauses to control call counts, ordering, actions, and retirement of expectations.

### Expectation Clauses and Their Meaning

- `.Times(cardinality)`: Specifies how many times the call is expected; supports precise and fuzzy cardinalities like `Exactly(n)` or `AtLeast(n)`.
- `.WillOnce(action)`, `.WillRepeatedly(action)`: Define behavior of the mock method when called.
- `.InSequence(sequences...)`: Enforces call order according to sequences.
- `.After(expectations...)`: Specifies that this call must occur after given expectations.
- `.RetiresOnSaturation()`: Retires an expectation once its expected number of calls happen.

### Default Behavior with `ON_CALL`

`ON_CALL(mock_object, method(matchers...))` defines default behaviors for mock methods without imposing requirements on calls.

> **Tip:** Use `ON_CALL` liberally to set default safe behaviors and reserve `EXPECT_CALL` for actually verifying interactions.

### Managing Uninteresting vs Unexpected Calls

- **Uninteresting calls:** Calls to mock methods with no expectations set. By default, these trigger warnings.
- **Unexpected calls:** Calls that do not match any active expectation; these always produce test failures.

Use `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to control treatment of uninteresting calls.

---

## Result Handling: Fatal vs Non-Fatal Failures

GoogleTest classifies assertion failures as:

- **Fatal failures:** Immediately stop the current test, preventing subsequent code that might rely on the expected state from running.
- **Non-fatal failures:** Issue warnings but continue test execution to detect multiple failures.

Match your assertion choice (`ASSERT_` vs `EXPECT_`) to test criticality.

---

## Practical Examples

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Test;
using ::testing::Return;
using ::testing::_;

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), ());
};

TEST(CalculatorTest, AddsNumbers) {
  MockCalculator mock_calc;

  // Expect Add will be called exactly once with any arguments
  EXPECT_CALL(mock_calc, Add(_, _))
      .Times(1)
      .WillOnce(Return(5));

  int result = mock_calc.Add(2, 3);
  EXPECT_EQ(result, 5);
}

TEST(CalculatorTest, AddReturnsDifferentValues) {
  MockCalculator mock_calc;

  EXPECT_CALL(mock_calc, Add(1, 2))
      .WillOnce(Return(3));
  EXPECT_CALL(mock_calc, Add(3, 4))
      .WillOnce(Return(7));

  EXPECT_EQ(mock_calc.Add(1, 2), 3);
  EXPECT_EQ(mock_calc.Add(3, 4), 7);
}
```

```cpp
// Using matchers in assertions
using ::testing::Each;
using ::testing::Gt;

TEST(VectorTest, ContainsPositiveNumbers) {
  std::vector<int> numbers = {1, 2, 3, 4, 5};
  EXPECT_THAT(numbers, Each(Gt(0)));
}
```

---

## Troubleshooting Tips

- Ensure you set `EXPECT_CALL` expectations *before* exercising mocks.
- Use `--gmock_verbose=info` to get detailed tracing of mock calls and expectations.
- Beware of sticky expectations — use `.RetiresOnSaturation()` or sequences to manage lifetime.
- If you encounter warnings about uninteresting calls, consider using `NiceMock` or explicitly setting catch-all expectations with `Times(AnyNumber())`.
- Verify that your mocks have virtual destructors to avoid leaks or undefined behavior.

---

## Best Practices

- Balance assertion use between fatal and non-fatal based on how critical the check is.
- Use matchers to avoid brittle equality checks — be as general as your test needs.
- Leverage `ON_CALL` for setting default mock behaviors and reserve `EXPECT_CALL` for interaction verification.
- Organize expectations with sequences and `.After()` clauses to clearly express call order.
- Use custom matchers for reusable and descriptive argument validations.

---

## Further Reading and Links

- [Using Assertions Effectively Guide](../guides/getting-started/using-assertions.md)
- [Matchers Reference](../api-reference/core-apis/matchers.md)
- [Mocking Reference](../docs/reference/mocking.md)
- [gMock for Dummies](../docs/gmock_for_dummies.md)

Explore the **Core Features and Value** page for a broad overview of the assertion system within GoogleTest and the **Writing Your First Test** guide for practical application of assertions and matchers.

---

## Summary

Assertions and matchers form the expressive foundation of GoogleTest’s verification system. They allow you to write clear, powerful tests by verifying precise conditions or flexible patterns, supporting both immediate fatal failures and continued checking with non-fatal failures. With rich built-in matchers, support for custom predicates, and advanced interaction verification in mock objects, GoogleTest provides the comprehensive tooling needed for robust and maintainable tests.