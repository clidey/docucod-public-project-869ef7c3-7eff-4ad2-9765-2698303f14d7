---
title: "Assertion and Matcher Model"
description: "Discover how assertions and matchers are designed—from basic equality checks to custom matchers for complex scenarios. Understand the extensibility of the matcher system and its role in expressive, readable tests."
---

# Assertion and Matcher Model

Explore the design and usage of assertions and matchers in GoogleTest, from the simplest equality checks to creating custom matchers for nuanced validation in your tests. Understand how this system supports expressive, readable assertions and can be extended for complex scenarios.

---

## Introduction to Assertions and Matchers

Assertions are the backbone of test validation in GoogleTest. They allow you to verify conditions and signal success or failure of tests based on the results. Matchers complement assertions by providing an expressive, composable way to describe expected values and conditions.

Together, assertions and matchers enable you to write tests that are both precise and maintainable, providing clear failure messages that accelerate debugging.

## Basic Assertion Model

### What Are Assertions?

An assertion is a statement that tests whether a condition holds true at a certain point in your tests. Failures in assertions indicate a problem in the code under test or the test itself.

GoogleTest assertions come in two flavors:

- **Non-fatal assertions (`EXPECT_*`)**: Report failure but allow the test to continue.
- **Fatal assertions (`ASSERT_*`)**: Report failure and immediately abort the current function.

### Core Assert Macros

- `EXPECT_EQ(val1, val2)`: Checks if two values are equal.
- `EXPECT_NE(val1, val2)`: Checks if two values are not equal.
- `EXPECT_TRUE(condition)`: Checks if a condition is true.
- `EXPECT_FALSE(condition)`: Checks if a condition is false.

Each of these has a corresponding `ASSERT_` variant which aborts on failure.

### Precise Failure Diagnostics

When assertions fail, GoogleTest generates detailed failure messages, including the expressions checked and their evaluated values. This helps you quickly identify causes of test failures without combing through vague messages.

Example:

```cpp
EXPECT_EQ(foo, bar);
```

On failure, this might output:

```
Expected equality of these values:
  foo
    Which is: 3
  bar
    Which is: 5
```

## Predicate Assertions and AssertionResult

### Enhancing Assertions with Predicate Functions

Sometimes simple Boolean assertions aren't enough, especially when your validation logic is complex or you want richer failure messages.

GoogleTest offers predicate assertions that invoke user-defined functions returning `bool` or `AssertionResult`.

### Using Predicate Assertions

- **Predicate (boolean) Functions:** Return `true` if condition holds.
- **Predicate-Formatter Functions:** Return `AssertionResult` with detailed success or failure messages.

Example predicate function returning `AssertionResult`:

```cpp
::testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0) return ::testing::AssertionSuccess();
  else return ::testing::AssertionFailure() << n << " is odd";
}
```

When used in a test:

```cpp
EXPECT_TRUE(IsEven(some_value));
```

On failure, provides rich context:

```
Value of: IsEven(some_value)
  Actual: false (3 is odd)
Expected: true
```

### Predicate Assertion Macros

- `EXPECT_PRED1(pred, val1)`
- `EXPECT_PRED2(pred, val1, val2)`
- `EXPECT_PRED_FORMAT1(pred_formatter, val1)`
- `EXPECT_PRED_FORMAT2(pred_formatter, val1, val2)`

These macros allow you to tailor the number of arguments and the verbosity of messages.

## Floating-Point Comparisons with Matchers

Due to rounding errors, direct equality comparisons of floating-point values are unreliable.

### Specialized Floating-point Assertions

- `EXPECT_FLOAT_EQ(val1, val2)` and `ASSERT_FLOAT_EQ` verify approximate equality for `float` values.
- `EXPECT_DOUBLE_EQ(val1, val2)` and `ASSERT_DOUBLE_EQ` do the same for `double` values.
- `EXPECT_NEAR(val1, val2, abs_error)` checks if values are within an absolute error bound.

These assertions internally consider Units in the Last Place (ULPs) or absolute tolerance, ensuring more robust tests.

### Using Floating-Point Predicate-Format Functions

For customized comparisons, GoogleTest also provides predicate-format functions like `FloatLE` and `DoubleLE` to be used with predicate assertion macros.

Example:

```cpp
EXPECT_PRED_FORMAT2(FloatLE, val1, val2);
``` 

This checks that `val1` is less than or approximately equal to `val2`.

## String and C-String Assertions

GoogleTest distinguishes between C strings and `std::string` objects.

### C-String Specific Assertions

- `EXPECT_STREQ(str1, str2)` verifies two C strings have identical content.
- `EXPECT_STRNE(str1, str2)` ensures two C strings differ.
- `EXPECT_STRCASEEQ` and `EXPECT_STRCASENE` perform case-insensitive string content comparisons.

For `std::string`, basic equality operators and `EXPECT_EQ` suffice.

### Wide String Support

GoogleTest supports `wchar_t*` and `std::wstring` with analogous assertions, converting wide strings to UTF-8 for readable output.

## Matchers: Extensibility and Expressiveness

### What Are Matchers?

Matchers are composable predicates that encapsulate logic to match expected data conditions against actual values, offering an expressive syntax and improved failure messages.

### Using Matchers in Assertions

Use `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)` to make assertions with matchers.

Example:

```cpp
EXPECT_THAT(foo_string, ::testing::StartsWith("Hello"));
EXPECT_THAT(bar_value, ::testing::AllOf(::testing::Gt(5), ::testing::Lt(10)));
```

### Writing Custom Matchers

GoogleTest's matcher framework is extensible. You can define matchers for your own types using the `MATCHER` macro or by implementing the matcher interface.

This enables validation of complex conditions with readable expressions.

## Assertion Failure Propagation and Usage Tips

- `ASSERT_*` macros cause the current function to abort on failure, but do not abort the whole test program.
- For subroutines, use `ASSERT_NO_FATAL_FAILURE(statement)` to check if `statement` generated any fatal failures.
- Use `SCOPED_TRACE` or `ScopedTrace` to add contextual information to assertion messages, especially for failures inside helper functions or loops.

## Logging Additional Properties

GoogleTest allows you to log key/value pairs during your tests using:

```cpp
::testing::Test::RecordProperty("key", "value");
```

These properties can be serialized in XML or JSON test reports, aiding in enhancing test result metadata.

## Troubleshooting Common Assertion Issues

- Ensure that types used in assertions support streaming with `operator<<` for meaningful output.
- For pointer comparisons involving `NULL`, prefer `nullptr`.
- Avoid fatal assertions in constructors or destructors; instead use `SetUp()` or `TearDown()` methods.

## Summary

The Assertion and Matcher Model in GoogleTest provides a rich framework that balances usability, flexibility, and expressiveness, enabling reliable and readable tests. By leveraging built-in assertions, predicate functions, matchers, and detailed diagnostics, users can write effective tests that communicate intent clearly and simplify debugging.

---

## References & Further Reading

- [GoogleTest Assertions Reference](../reference/assertions.md)
- [Advanced Guide: Using Assertions Effectively](../guides/core-workflows/using-assertions.mdx)
- [Matchers Reference](../api-reference/matcher-and-mocking-apis/core-matchers-reference.mdx)
- [Writing Custom Matchers](../concepts/extensibility-and-integration/custom-assertions-matchers)
- [Predicate Assertions in Advanced GoogleTest Topics](../docs/advanced.md#predicate-assertions-for-better-error-messages)

---

<AccordionGroup title="Key Assertion Macros and Classes">
<Accordion title="Assertion Macros">
- EXPECT_EQ / ASSERT_EQ — Equality
- EXPECT_NE / ASSERT_NE — Inequality
- EXPECT_TRUE / ASSERT_TRUE — Boolean true
- EXPECT_FALSE / ASSERT_FALSE — Boolean false
- EXPECT_PRED* / ASSERT_PRED* — Predicates with args
- EXPECT_PRED_FORMAT* / ASSERT_PRED_FORMAT* — Predicate-formatter for custom messages
- EXPECT_THAT / ASSERT_THAT — Matcher-based assertions
</Accordion>
<Accordion title="AssertionResult Class">
- Represents success or failure of an assertion
- Supports streaming custom messages (`<<`)
- Factory functions: `AssertionSuccess()`, `AssertionFailure()`
- Enables detailed custom failure messages
</Accordion>
<Accordion title="Matchers Overview">
- Describe complex test expectations
- Extensible and combinable
- Used with EXPECT_THAT / ASSERT_THAT
- Provides more readable test assertions and failure diagnostics
</Accordion>
</AccordionGroup>

<Check>
When writing assertions:
- Use `ASSERT_*` when failure should abort the current test function.
- Use `EXPECT_*` for non-fatal checks where test can continue.
- Use predicate assertions and matchers for complex validation.
- Attach contextual messages with streaming (`<<`).
- Use `nullptr` instead of `NULL` in pointer assertions.
</Check>

<Warning>
Avoid using fatal assertions like `ASSERT_*` in constructors or destructors as they cannot abort the entire test and may leave tests in inconsistent states. Use `SetUp()` and `TearDown()` instead.
</Warning>

<Note>
GoogleTest allows logging key/value properties during tests with `RecordProperty()` which appear in XML/JSON reports, enabling richer test result metadata.
</Note>

<Info>
For floating-point assertions, prefer `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` instead of direct equality checking with `EXPECT_EQ` to accommodate precision issues.
</Info>

---