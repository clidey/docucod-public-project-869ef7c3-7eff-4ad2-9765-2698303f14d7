---
title: "Assertion Model and Failure Handling"
description: "Explains the design of GoogleTest's rich assertion system, including standard, fatal (ASSERT_), and non-fatal (EXPECT_) assertion macros. Discusses assertion result types, failure messages, and how the framework gives detailed diagnostic feedback to developers. Covers extensibility via user-defined assertions and predicates."
---

# Assertion Model and Failure Handling

GoogleTest offers a comprehensive assertion system designed to verify conditions in test code with precision and clarity. This system includes paired macros for assertions: fatal (`ASSERT_`) assertions which abort the current function upon failure and non-fatal (`EXPECT_`) assertions which report the failure but allow the test to continue. Through detailed assertion result types, expressive failure messages, and extensibility mechanisms, GoogleTest provides developers with rich diagnostic feedback, aiding efficient debugging and robust test development.

---

## 1. Assertion Macros Overview

GoogleTest's assertions are highly diverse and thoughtfully designed to suit many scenarios. The primary two categories of assertion macros are:

- **Fatal Assertions (`ASSERT_`)**: These immediately abort the current test function when a failure occurs, halting further execution within the function. They are available only within `void` returning functions due to the inability to use exceptions.

- **Non-Fatal Assertions (`EXPECT_`)**: These log failures but allow the current test function to continue executing, enabling multiple assertions in one test case.

### Usage Example
```cpp
EXPECT_TRUE(my_condition) << "My condition is not true";
ASSERT_EQ(a, b) << "Values differ";
```

Each macro supports streaming a custom failure message via the `<<` operator for contextual debugging.

---

## 2. Assertion Result Types and Messages

### Explicit Success and Failure

GoogleTest supports explicit signaling of success or failure that is not tied to a Boolean expression. This is essential when control flow, rather than a direct boolean expression, governs test outcome.

- `SUCCEED()`: Generates a documented success, although it doesnâ€™t by itself mark the entire test as successful.
- `FAIL()`: Generates a fatal failure that aborts the current function, only usable in `void` functions.
- `ADD_FAILURE()`: Creates a non-fatal failure allowing continued execution.

These can be embedded in functions with complex logic or switch statements to indicate unexpected code paths or checkpoints.

```cpp
switch(expression) {
  case 1: /* ... */
  case 2: /* ... */
  default:
    FAIL() << "Unexpected case hit.";
}
```

### Rich Failure Messages

When an assertion fails, GoogleTest automatically prints:

- The expression evaluated.
- The actual and expected values.
- Custom user-provided messages.

This output is enriched by the extensible value printer that formats standard and user-defined types intelligibly.

---

## 3. Assertion Macro Categories

GoogleTest provides macros spanning common assertion needs:

### Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` verifies that a condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` verifies false.

### Value Comparison

GoogleTest offers comprehensive macros for binary comparisons that ensure the arguments are each evaluated once, preserving side effects safely.

- Equality/Inequality: `EXPECT_EQ`, `ASSERT_EQ`, `EXPECT_NE`, `ASSERT_NE`
- Order Comparisons: `EXPECT_LT`, `ASSERT_LT`, `EXPECT_LE`, `ASSERT_LE`, `EXPECT_GT`, `ASSERT_GT`, `EXPECT_GE`, `ASSERT_GE`

Special cases exist for string and floating-point comparisons to resolve semantic subtleties.

### String Comparisons

Macros such as `EXPECT_STREQ` compare C strings by content rather than pointer equality, with case-insensitive variants (`EXPECT_STRCASEEQ`).

### Floating-Point Comparisons

Because floating-point arithmetic is imprecise, GoogleTest provides:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`
- `EXPECT_NEAR` / `ASSERT_NEAR` (for absolute error tolerance)

### Exception Assertions

For builds with exceptions enabled, assertions verify if code throws expected exceptions:

- `EXPECT_THROW` / `ASSERT_THROW`
- `EXPECT_ANY_THROW` / `ASSERT_ANY_THROW`
- `EXPECT_NO_THROW` / `ASSERT_NO_THROW`

### Predicate Assertions

Enhance failure messages for complex boolean predicates using:

- `EXPECT_PRED*` and `ASSERT_PRED*`: Wrap unary or up to 5-ary predicate functions.
- `EXPECT_PRED_FORMAT*` and `ASSERT_PRED_FORMAT*`: Allow custom formatting of failure messages using predicate-formatters returning `AssertionResult`.

This allows better insights into failure states by printing argument values and detailed messages.

---

## 4. Failure Handling and Diagnostic Feedback

When assertions fail, GoogleTest not only reports failure but also provides detailed diagnostic context:

- **Source Location**: File and line number where the assertion was triggered.
- **Expression Readout**: The expression under test is printed with actual and expected values.
- **User Messages**: Custom messages streamed into the assertion enrich the output.
- **Stack Traces (Verbose Mode)**: Run tests with flag `--gmock_verbose=info` to include stack traces for mock calls, aiding call-site identification.

Example failure output:

```
path/to/foo_test.cc:11: Failure
Value of: Bar(n)
Expected: 1
  Actual: 2
```

### Propagation of Fatal Failures

Fatal assertions like `ASSERT_*` or `FAIL()` abort only the current function, not the entire test. GoogleTest provides mechanisms to manage this:

- `ASSERT_NO_FATAL_FAILURE(statement)`: Verifies that statement causes no fatal failure.
- `HasFatalFailure()`: Queries if a fatal failure occurred.

These tools enable subroutine assertion containment and early exits on failure detection.

### Assertion Placement Constraints

Because GoogleTest does not rely on exceptions, fatal assertions (`ASSERT_*` and `FAIL()`) only work in `void` returning functions to avoid compilation errors.

To test assertions in non-void functions, users should prefer `EXPECT_*` or redesign code accordingly.

---

## 5. Extending Assertions with User-Defined Predicates and Custom Assertions

GoogleTest supports extensibility for assertions through:

- **Custom predicate functions returning `testing::AssertionResult`**: Enable rich failure messages with success/failure and descriptive text.

- **Predicate-formatter assertions (`EXPECT_PRED_FORMAT*`)**: Allow users to implement fine-grained, multi-argument predicates that produce customized diagnostic output. The predicate-formatter receives expressions and values, and returns an `AssertionResult`.

Example implementation:

```cpp
testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}

EXPECT_PRED_FORMAT1(IsEven, value);
```

- **Matchers Integration with Assertions**: Use `EXPECT_THAT()` with matchers for expressive, readable assertions that generate fluent failure messages.

---

## 6. Summary and Best Practices

- Use `EXPECT_*` macros when you want tests to continue after failures.
- Use `ASSERT_*` macros when test correctness depends on a prior check to avoid cascading errors.
- To avoid subtle bugs in assertion messages, always supply readable failure messages.
- Use predicate and predicate-formatter macros for complex conditions to get informative diagnostics and avoid opaque failures.
- Customize printing of user-defined types with `AbslStringify()` or `PrintTo()` for clearer assertion output.
- Place fatal assertions in `void` returning functions only.
- Utilize verbose flags to gain insight on mock behavior when troubleshooting.

For more examples and a complete catalog of assertions, refer to the [Assertions Reference](reference/assertions.md).

---

## Appendix: Failure Flow in GoogleMock (Relevant to Assertion Model)

Though focusing on assertions proper, a brief overview of GoogleMock's interaction with the assertion model helps understand failure feedback from mock expectations.

- Mocks define *expectations* using the `EXPECT_CALL` macro.
- When a mock method is called, GoogleMock:
  - Searches for an active expectation matching the call arguments,
  - Checks sequences, orderings (`InSequence`, `After`), and call counts,
  - Reports *uninteresting* (no expectation) or *unexpected* (no matching expectation) calls via assertions,
  - Generates detailed failure messages, including which expectations were tried and what arguments caused mismatches.

This rich feedback assists developers in fine-tuning both tests and implementation.

---