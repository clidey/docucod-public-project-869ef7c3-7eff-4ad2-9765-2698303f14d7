---
title: "Assertions and Matcher Model"
description: "Explore how GoogleTest evaluates correctness using assertions and matchers, supporting expressive expectations for values and behaviors. Learn about built-in, parameterized, and user-defined assertions and the role of matchers in flexible test conditions."
---

# Assertions and Matcher Model

GoogleTest evaluates the correctness of your code using a rich set of assertions and matchers. These allow you to express expectations about values and behaviors clearly, making your tests both readable and informative when failures occur.

This guide explores how assertions and matchers work in GoogleTest, detailing built-in assertion types, parameterized and user-defined assertions, and the role of matchers in enabling flexible, expressive test conditions.

---

## Understanding Assertions in GoogleTest

Assertions are fundamental building blocks in GoogleTest used to verify conditions in your code. They come in two flavors:

- **Fatal assertions (`ASSERT_`)**: Abort the current function immediately if they fail, preventing any further test logic execution within that function.
- **Non-fatal assertions (`EXPECT_`)**: Report a failure but allow the test function to continue running.

You use assertions to check values, equality, inequalities, string matching, exception throwing, and many more conditions.

### How Assertions Work

Each assertion records a **test part result** internally, which represents the outcome of a specific check or expectation. This result includes:

- The type of result (success, non-fatal failure, fatal failure, or skipped).
- The location in the source code (file and line number).
- A detailed failure message.

The `TestPartResult` object captures this information, enabling GoogleTest to report failures with precise context and helpful messages.

### Basic Assertion Examples

```cpp
// Checks that the condition is true. Produces a non-fatal failure if false.
EXPECT_TRUE(condition);

// Checks that two values are equal. Produces a fatal failure if not.
ASSERT_EQ(expected, actual);

// Always generates a fatal failure and aborts the current function.
FAIL() << "Unreachable code reached";
```

For the complete list of built-in assertion macros and their behavior, see [Assertions Reference](../reference/assertions.md).

## The Matcher Model

Matchers provide a way to express complex verification logic in a readable, composable manner. They are objects or predicates that evaluate whether a value meets a particular condition.

The matcher model in GoogleTest allows you to write flexible assertions that read more like English sentences and provide detailed failure diagnostics.

### Using Matchers with Assertions

The key assertion macros supporting matchers are `EXPECT_THAT()` and `ASSERT_THAT()`. They combine the power of assertions with the expressiveness of matchers.

```cpp
#include <gmock/gmock.h>

using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

TEST(MyTest, MatcherExample) {
  EXPECT_THAT(value1, StartsWith("Hello"));
  EXPECT_THAT(value2, MatchesRegex("Line \\d+"));
  ASSERT_THAT(value3, AllOf(Gt(5), Lt(10)));
}
```

Here, matchers can be combined to express compound conditions (`AllOf`, `AnyOf`), enable pattern matching (`MatchesRegex`), or check simple predicates (`Gt` for greater than).

### What Are Matchers?

- Matchers encapsulate evaluation logic, returning whether a value satisfies the expected condition.
- They generate clear, human-readable failure messages that explain what was expected and what was actually received.
- GoogleTest provides a built-in library of matchers; you can also define your own.

See [Matchers Reference](matchers.md) for the comprehensive list and details.

## Categories of Built-In Assertions

GoogleTest offers a wide variety of assertion macros tailored for specific verification tasks. These include:

### Explicit Success and Failure

- `SUCCEED()` generates an explicit success (primarily for documentation).
- `FAIL()` and `ADD_FAILURE()` generate fatal and non-fatal failures, respectively.

### Boolean Assertions

- `EXPECT_TRUE(condition)` and `ASSERT_TRUE(condition)` check for truthiness.
- `EXPECT_FALSE(condition)` and `ASSERT_FALSE(condition)` check for falsity.

### Binary Comparisons

- Macros like `EXPECT_EQ(val1, val2)`, `EXPECT_NE(val1, val2)`, `EXPECT_LT(val1, val2)` check binary relations.
- They invoke custom value printers to show actual and expected values on failures.

### String Comparisons

- For C strings, use `EXPECT_STREQ(str1, str2)`, `EXPECT_STRNE(str1, str2)`, and their case-insensitive variants.

### Floating-Point Comparisons

- `EXPECT_FLOAT_EQ` and `EXPECT_DOUBLE_EQ` allow approximate comparisons considering floating-point imprecision.
- `EXPECT_NEAR` supports an explicit error bound.

### Exception Assertions

- Assert that a statement throws or doesn’t throw exceptions using `EXPECT_THROW`, `EXPECT_ANY_THROW`, and `EXPECT_NO_THROW`.

### Predicate Assertions

- Allow testing predicates beyond simple conditions with `EXPECT_PRED*` and `EXPECT_PRED_FORMAT*` macros.
- Predicate-formatter functions can provide customized failure messages.

### Death Assertions

- Used to test code that is expected to terminate the process (`EXPECT_DEATH`, `ASSERT_DEATH`, etc.).

## Predicate Assertions for Complex Conditions

When a test requires checking complex conditions that don’t fit simple equality or relational checks, predicate assertions can offer better failure diagnostics.

### Using a Function That Returns `bool`

```cpp
bool IsPositive(int n) { return n > 0; }
EXPECT_PRED1(IsPositive, value);
```

### Using a Function That Returns `AssertionResult`

Defining predicates that return `AssertionResult` allows more expressive failure messages.

Example:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  else return testing::AssertionFailure() << n << " is odd";
}

EXPECT_TRUE(IsEven(some_value));
```

Failed assertions will print the attached message.

### Using Predicate-Formatter Macros

To fully customize failure messages, implement a predicate-formatter with the signature:

```cpp
testing::AssertionResult PredicateFormatter(const char* expr1, ..., T val1, ...);
```

Example:

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* m_expr, const char* n_expr, int m, int n) {
  if (MutuallyPrime(m, n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << m_expr << " and " << n_expr << " are not mutually prime";
}
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

Detailed failure messages help locate the cause when tests fail.

## Custom Assertions

Beyond built-in assertions and predicates, GoogleTest encourages the creation of custom assertions via matchers or predicate formatters, affording flexibility in expressing domain-specific conditions.

Writing effective custom assertions involves:

- Providing meaningful failure messages.
- Avoiding side effects or expensive calculations in the predicate.
- Leveraging streaming operators to show values clearly on errors.

Refer to [Writing Custom Matchers Quickly](../gmock_cook_book.md#NewMatchers) for guidance.

## Using Assertions and Matchers Together: A User Flow

Imagine testing a function `GetUserName(int user_id)`:

1. **Check basic conditions:**

   ```cpp
   EXPECT_FALSE(user_id < 0) << "User ID cannot be negative";
   ```

2. **Verify returned string:**

   ```cpp
   std::string name = GetUserName(user_id);
   EXPECT_THAT(name, StartsWith("User_"));
   ```

3. **Verify complex patterns:**

   ```cpp
   EXPECT_THAT(name, MatchesRegex("User_\\d+"));
   ```

4. **Use predicates for custom logic:**

   ```cpp
   EXPECT_PRED1(IsValidUserName, name);
   ```

This gradual enhancement in assertions moves from simple truth checks to complex matchers, maintaining clear failure messages.

## Best Practices for Using Assertions and Matchers

- Favor `EXPECT_` assertions when possible to detect multiple failures per test.
- Use `ASSERT_` when subsequent code depends on the assertion (e.g., null checks).
- Use matchers with `EXPECT_THAT` for more readable and maintainable tests.
- Add meaningful custom failure messages using streaming (`<<`) in assertions.
- For complex conditions, prefer predicate assertions or custom matchers over `EXPECT_TRUE()` with complex expressions.
- Avoid side effects inside assertions and predicate functions since arguments may be evaluated once or multiple times.

## Common Pitfalls and Troubleshooting

- **Mixing TEST and TEST_F in the same test suite:** Fatal errors occur as GoogleTest requires a consistent fixture class per test suite.

- **Using `ASSERT_*` in constructors or destructors:** Not allowed; use `SetUp`/`TearDown` instead.

- **Losing failure context:** Use `SCOPED_TRACE` to add trace messages that help pinpoint which code path failed within helper functions.

- **Improper use of `ASSERT_*` causing early test termination:** Remember fatal failures only abort the current function, not entire tests, so use `ASSERT_NO_FATAL_FAILURE` or exception-based handling in subroutines.

- **Uninstantiated parameterized tests:** Always pair `TEST_P` with `INSTANTIATE_TEST_SUITE_P` to ensure test execution.

## Summary

GoogleTest’s assertions and matcher model provide powerful and flexible means to express test expectations, from simple Boolean checks to complex pattern matching. By blending precise failure diagnostics with expressive syntax, they enhance developer productivity and test reliability.

Use built-in assertions for common conditions, leverage matchers for readability and expressiveness, and employ predicate assertions or custom matchers for domain-specific verification needs.

---

## Additional Resources

- [Assertions Reference](../reference/assertions.md): Detailed list of provided assertions.
- [Matchers Reference](matchers.md): Comprehensive matcher library.
- [Advanced GoogleTest Topics](../advanced.md): Further techniques such as predicate assertions and failure propagation.
- [Writing Custom Matchers Quickly](../gmock_cook_book.md#NewMatchers): Guide to creating your own matchers.

---

For practical examples and usage patterns, see the [GoogleTest Primer](../primer.md) and [Advanced Testing Patterns](../advanced.md).

---