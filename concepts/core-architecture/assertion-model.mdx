---
title: "Assertion Model"
description: "Delve into the rich assertion system of GoogleTest. This page breaks down how assertions work, the differences between fatal and non-fatal failures, and the mechanisms for custom assertion results. Understand the implications for test reliability, debugging, and diagnostics."
---

# Assertion Model

## Introduction

GoogleTest's assertion system is the foundational mechanism that enables you to validate conditions in your C++ tests. Assertions check your code’s behavior and signal successes or failures, directly influencing test results. This page provides an in-depth look at how assertions operate, the distinction between fatal and non-fatal failures, and how to create custom assertion results to craft clearer, more informative test diagnostics.

Understanding the assertion model is pivotal to writing reliable, maintainable tests that provide immediate feedback and clear debugging insights.

---

## Types of Assertions: Fatal vs Non-Fatal

When you verify a condition in a test using GoogleTest, assertions can lead to three outcomes:

- **Success**: The condition holds; execution continues normally.
- **Non-Fatal Failure**: The condition fails, but the current test function continues executing, logging the failure.
- **Fatal Failure**: The condition fails critically, causing the current function to abort immediately.

### Fatal Assertions (`ASSERT_*`)
Fatal assertions (such as `ASSERT_EQ`, `ASSERT_TRUE`, etc.) generate fatal failures. When they fail, execution immediately exits the current function — commonly the test function — preventing subsequent test code from running.

This behavior is essential when further execution after a failure would lead to invalid operations, for example dereferencing a null pointer:

```cpp
ASSERT_NE(ptr, nullptr) << "Pointer must not be null";
*ptr = 42;  // Safe only if pointer is non-null
```

Here, if `ptr` is `nullptr`, the test aborts here and does not attempt to dereference.

**Important**: Fatal assertions can only be used in functions returning `void`. Using them in non-void functions triggers confusing compile errors.

### Non-Fatal Assertions (`EXPECT_*`)
Non-fatal assertions (such as `EXPECT_EQ`, `EXPECT_TRUE`, etc.) report failures but allow the current test function to continue running. This is invaluable for gathering multiple failure points within a single test execution, improving debugging efficiency.

For example:

```cpp
EXPECT_EQ(x, y) << "Comparing x and y";
EXPECT_EQ(a, b) << "Comparing a and b";
```

If both comparisons fail, both failures will be reported within one test run.

### Choosing Between `ASSERT_*` and `EXPECT_*`
The rule of thumb:

- Use `ASSERT_*` when subsequent steps rely on the assertion passing, or it would be unsafe to proceed otherwise.
- Use `EXPECT_*` when you want to detect multiple issues in a single test run.

---

## Writing and Using Assertions

Assertions in GoogleTest are macros that look like function calls but generate test part results if they fail. They can be simple Boolean checks, comparisons, string validations, exception checks, or complex predicates. Assertions print failure details including the source file, line number, and optionally your custom message.

### Basic Assertion Example

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1) << "Factorial of zero should be 1";
}
```

Here, if `Factorial(0)` is not 1, a non-fatal failure is logged with the custom message.

### Adding Custom Failure Messages

You can augment assertions with additional context using streaming syntax:

```cpp
EXPECT_EQ(vec.size(), expected_size) << "Vector size mismatch";
```

This message is appended to the assertion’s failure output, helping trace failures to their causes.

### Assertions on Complex Conditions

If a condition is complex and not covered by built-in assertions, you can use predicate assertions to get detailed feedback.

#### Predicate Assertions

These are macros `EXPECT_PRED*` and `ASSERT_PRED*` that take a predicate function and arguments, reporting detailed information on failure:

```cpp
bool IsMutuallyPrime(int a, int b);

EXPECT_PRED2(IsMutuallyPrime, 8, 15);
```

If the predicate returns `false`, the assertion outputs argument values for easier debugging.

#### Predicate-Formatter Assertions

For even richer messages, predicate-formatters return a `testing::AssertionResult` with success or failure plus a custom failure message:

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* a_expr, const char* b_expr, int a, int b) {
  if (IsMutuallyPrime(a, b)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << a_expr << " and " << b_expr
                                       << " are not mutually prime";
}

EXPECT_PRED_FORMAT2(AssertMutuallyPrime, x, y);
```

When the assertion fails, the message shows the expressions and values involved, making failures clear.

---

## The AssertionResult Class

At the core of predicate-format assertions lies the `testing::AssertionResult` class, representing the result (success or failure) of an assertion with an optional message.

- Use `AssertionSuccess()` to return a successful result.
- Use `AssertionFailure()` to return a failure, optionally streaming a failure message.

Example:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}
```

This class helps write expressive assertions that provide meaningful failure diagnostics beyond simple `EXPECT_TRUE`.

---

## Key Classes Associated with Assertions

Beyond macros, GoogleTest provides classes that represent assertion outcomes and test results:

- **TestPartResult**: Represents the outcome of a single assertion or test action, including type (success, fatal/non-fatal failure, skip), source location, and message.
- **TestResult**: Aggregates all assertion results for a test, tracks failures/skips, and records test properties.

These classes are usually handled internally but can be accessed for custom reporting and listeners.

---

## Best Practices and Common Pitfalls

- **Use `EXPECT_*` to accumulate multiple errors in one test**, allowing you to identify all related flaws at once.
- **Use `ASSERT_*` when continuing does not make sense**, such as verifying a pointer is non-null before dereferencing.
- **Avoid fatal assertions in constructors and destructors**, as they cannot abort the whole test safely. Use `SetUp()` and `TearDown()` instead.
- **Evaluate assertions only once**: GoogleTest guarantees that arguments to assertions are evaluated a single time, preventing side effects from running multiple times.
- **Be clear and descriptive in custom messages** to help future debugging.

---

## Troubleshooting Assertion Failures

- If a fatal assertion (`ASSERT_*`) aborts earlier than you expect, verify that you’re not in a non-`void` function.
- If no useful failure information appears, consider using predicate-formatters for richer diagnostics.
- For flakiness in tests due to partial state changes after aborting asserts, consider redesigning tests for clearer failure isolation.

---

## Summary

Understanding GoogleTest’s assertion model empowers you to write expressive, reliable tests that fail clearly and continue when appropriate. You control test flow precisely using non-fatal and fatal assertions, employ rich predicate assertions for complex checks, and streamline diagnostics with custom messages and assertion results. Mastery of this model directly improves test quality and debugging efficiency.


---

## Additional Resources

- [GoogleTest Primer: Assertions](https://github.com/google/googletest/blob/main/docs/primer.md#assertions)
- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Advanced Guide: More Assertions and Predicate Assertions](https://github.com/google/googletest/blob/main/docs/advanced.md#more-assertions)
- [Test Results and Reporting (TestPartResult and TestResult)](https://github.com/google/googletest/blob/main/docs/api-reference/core-apis/test-results.md)
- [Matchers and Flexible Assertions Concepts](https://github.com/google/googletest/blob/main/docs/concepts/mocking-and-extensibility/matchers-and-assertions.md)

---

## Example Code Snippet

```cpp
// Using ASSERT and EXPECT in practical test
TEST(MyClassTest, HandlesNullPointer) {
  MyClass obj;
  int* ptr = obj.GetPointer();

  // Abort function if ptr is null
  ASSERT_NE(ptr, nullptr) << "Pointer should not be null";

  // Verify state, but keep going if check fails
  EXPECT_EQ(*ptr, 42) << "Pointer does not point to expected value";
  EXPECT_TRUE(obj.IsReady()) << "Object should be ready after init";
}
```

This test demonstrates the difference: the test aborts if `ptr` is nullptr, but performs all other checks.

---