---
title: "Matchers and Actions: Flexible Verification and Control"
description: "Learn about matchers and actions, the building blocks for assertion and control flow in GoogleMock. Explore how matchers enable expressive, fine-grained validation, while actions define the behavior of mocked calls."
---

# Matchers and Actions: Flexible Verification and Control

Welcome to the core concepts of GoogleMock's verification and control mechanisms. On this page, you will learn about **matchers** and **actions**, the essential building blocks that let you verify function call arguments precisely and define mock behavior effectively.

---

## 1. Introduction to Matchers and Actions

In GoogleMock, **matchers** and **actions** empower you to write tests that are:

- **Expressive:** Specify exactly what argument values are acceptable for mock method calls.
- **Flexible:** Compose simple matchers into complex conditions and customize behaviors.
- **Precise:** Verify not only that a mock method is called, but that it’s called correctly.

Matchers enable fine-grained validation of method arguments, while actions determine what a mock method should do when invoked. Combining these lets you create tests that are both robust and tailored to your needs.

<Info>
Matchers and actions work together inside `EXPECT_CALL` and `ON_CALL` macros, helping you control and verify the flow of your test's mock interactions.
</Info>

---

## 2. Matchers: Expressive Argument Validation

Matchers are predicate-like objects that assess whether arguments passed to mocked methods meet your expectations.

### 2.1 Basic Usage

Consider the macro:

```cpp
EXPECT_CALL(mock_object, MethodName(matcher1, matcher2));
```

Each `matcher` corresponds to a method argument. GoogleMock will only consider this expectation satisfied if the actual call has matching arguments.

### 2.2 Wildcard Matcher `_`

If you do not care about a particular argument, use the wildcard matcher `_`:

```cpp
EXPECT_CALL(turtle, GoTo(50, _));  // First argument must be 50, second anything
```

Omitting argument lists for non-overloaded methods assumes wildcards on all arguments.

### 2.3 Matcher Composition

Use combinators such as `AllOf()`, `AnyOf()`, and `Not()` to combine simpler matchers:

```cpp
EXPECT_CALL(foo, DoThis(AllOf(Gt(5), Ne(10))));  // Argument must be > 5 and != 10
```

### 2.4 Matching Multiple Arguments as a Whole

Matchers can be used to evaluate multiple arguments jointly using `.With()` clause:

```cpp
EXPECT_CALL(foo, InRange(Ne(0), _)).With(Lt());
```

This example expects that the first argument is not zero and less than the second.

### 2.5 Custom Matchers

You can define your own matchers for domain-specific validations using `MATCHER` or `MATCHER_P` macros or by implementing matcher interfaces. This customization elevates test expressiveness.

### 2.6 Matching Object Members

Use `Field()` and `Property()` matchers to check specific members or properties of complex objects:

```cpp
EXPECT_CALL(foo, Bar(Field(&Foo::number, Ge(3))));  // member 'number' >= 3
```

### 2.7 Tips and Pitfalls

- Always specify matchers only to the level of detail required to reduce test brittleness.
- Remember that matchers are evaluated as pure functions without side effects.
- Use `SafeMatcherCast<T>(m)` if you need to cast matchers to a wider type safely.

---

## 3. Actions: Defining Mock Behavior

**Actions** determine what mocked methods do when invoked—return values, side effects, or delegate calls.

### 3.1 Default Actions

GoogleMock assigns default actions to mocked methods returning built-in or default-constructible types. Without specifying an action, these defaults take effect.

### 3.2 Controlling Behavior with `EXPECT_CALL`

Use `.WillOnce()` and `.WillRepeatedly()` to specify sequential or ongoing behaviors:

```cpp
EXPECT_CALL(mock, GetNumber())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

Calls return 1 then 2, and return 3 thereafter.

### 3.3 Built-in Actions

Some common actions include:

- `Return(value)` – Returns a fixed value.
- `ReturnRef(variable)` – Returns a reference.
- `ReturnPointee(ptr)` – Returns the value pointed to.
- `Assign(&var, value)` – Assigns to a variable.
- `SetArgPointee<N>(value)` – Sets the value pointed to by the N-th argument.
- `Invoke(function or functor)` – Calls a callable with the mock arguments.
- `Throw(exception)` – Throws an exception.

You can combine actions with `DoAll()` to run multiple actions sequentially.

### 3.4 Using Lambdas or Callables as Actions

You can specify custom behavior using lambdas or callable objects for advanced logic:

```cpp
EXPECT_CALL(mock, Compute(_))
    .WillOnce([](int x) { return x * 2; });
```

### 3.5 Invoking Mock Function Arguments

If a mocked method receives a callable as argument, invoke it using the `InvokeArgument<N>(args...)` action:

```cpp
EXPECT_CALL(mock, DoThat(_))
    .WillOnce(InvokeArgument<0>(5));
```

This calls the mock argument (at index 0) as a function with `5`.

### 3.6 Managing Action Lifetimes

- `WillOnce()` actions can be move-only and are called once.
- `WillRepeatedly()` actions must be copyable and persist long-term.

### 3.7 Writing Custom Actions

For complex behavior, define your own actions either by implementing `ActionInterface` or using the legacy `ACTION` macros.

---

## 4. Integrating Matchers and Actions in Expectations

Mock expectations are declared with `EXPECT_CALL()`:

```cpp
EXPECT_CALL(mock, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- The **times** clause controls how many times the call is expected.
- The **matchers** declare what argument values are acceptable.
- The **actions** specify what the call does.

Use `ON_CALL()` to specify default behavior without setting call expectations.

### 4.1 Controlling Call Ordering

Use objects like `Sequence` and `InSequence` to specify call order. For example:

```cpp
Sequence s;
EXPECT_CALL(mock, FirstCall()).InSequence(s);
EXPECT_CALL(mock, SecondCall()).InSequence(s);
```

### 4.2 Retiring Expectations

Use `.RetiresOnSaturation()` to deactivate an expectation once its maximum call count is reached.

---

## 5. Advanced Usage Tips

- Prefer setting default behavior with `ON_CALL()` and explicit expectations with `EXPECT_CALL()` only where calls must be verified.
- When multiple expectations match calls, later expectations shadow earlier ones.
- To avoid fragile tests, avoid over-specification and understand the difference between uninteresting calls (warnings) and unexpected calls (errors).
- Use `NiceMock`, `StrictMock`, or `NaggyMock` wrappers to control the verbosity and strictness of mocks with respect to uninteresting calls.

---

## 6. Troubleshooting Common Issues

### 6.1 Uninteresting Call Warnings

If you see warnings about uninteresting calls:

- Verify if you meant to specify an expectation with `EXPECT_CALL`.
- Otherwise, suppress warnings with `NiceMock` or a catch-all expectation.

### 6.2 Unexpected Calls

Unexpected calls mean a call occurs that does not match any specified expectation or expected argument matcher. Review your expectations and mocks for correctness.

### 6.3 Incorrect Return Values

Ensure you use appropriate actions (`Return()`, `ReturnRef()`, `ReturnPointee()`) to get the expected return behavior, especially with references and move-only types.

### 6.4 Over-saturated Expectations

If a method is called more times than specified by `Times()`, GoogleMock reports an error. Use `.RetiresOnSaturation()` to retire expectations early if needed.

---

## 7. Summary

This guide covered:

- The power of **matchers** to precisely verify mock method arguments.
- The flexibility of **actions** to control mock method behavior.
- How to compose matchers and chain actions for complex test scenarios.
- Best practices on expectations, default behaviors, call ordering, and strictness.
- Practical tips to troubleshoot common mismatches and warnings.

For detailed reference, tutorial guides, and advanced topics, please explore the related [Matchers Reference](../api_reference/core_testing_apis/matchers_reference.html), [Actions Reference](../api_reference/core_testing_apis/actions_reference.html), and [gMock Cookbook](../guides/advanced-patterns/mocking-advanced.html).

---

### Example: Writing an Expectation with Matcher and Action

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::_; // wildcard matcher
using ::testing::Lt;
using ::testing::InSequence;

class MockTurtle {
 public:
  MOCK_METHOD(void, Forward, (int distance), ());
  MOCK_METHOD(void, GoTo, (int x, int y), ());
  MOCK_METHOD(int, GetX, (), (const));
};

TEST(TurtleTest, MoveInSequence) {
  MockTurtle turtle;
  {
    InSequence seq; // Expect calls in this strict order
    EXPECT_CALL(turtle, Forward(Lt(100)))
        .WillOnce(Return());
    EXPECT_CALL(turtle, GoTo(50, _))
        .WillOnce(Return());
  }
  turtle.Forward(42);
  turtle.GoTo(50, 22);
}
```

---

### See Also

- [Matchers Reference](../api_reference/core_testing_apis/matchers_reference.md) — Comprehensive list of built-in and custom matchers.
- [Actions Reference](../api_reference/core_testing_apis/actions_reference.md) — Details on built-in actions and how to write new ones.
- [Mocking Reference](../docs/reference/mocking.md) — Overview of mocking constructs and macros.
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) — Quick syntax references and common patterns.

---

### Further Learning

To deepen your mastery:

- Explore [Writing and Using Mocks Effectively](../guides/core-workflows/mocking-techniques.md) for workflow integration.
- See [Advanced Mocking Patterns](../guides/advanced-patterns/mocking-advanced.md) for complex test scenarios.
- Review [Parameterization](../concepts/data-behavior-modeling/test-parameterization.md) to combine with matchers and actions for scalable tests.

# End of Guide
