---
title: "Mocking Fundamentals with GoogleMock"
description: "Explore the principles behind mocking in GoogleMock: what mocks are, why they're used, how expectations and behaviors are declared, and how they interleave with standard unit test definitions. Grasp the function and value of ON_CALL(), EXPECT_CALL(), and the MOCK_METHOD macro."
---

# Mocking Fundamentals with GoogleMock

GoogleMock (gMock) revolutionizes C++ unit testing by enabling developers to define *mock objects* that simulate real objects' behavior. This page guides you through the principles behind mocking with GoogleMock, helping you grasp what mocks are, why to use them, and how to specify their behavior and expectations effectively.

---

## What Is a Mock?

Imagine your code depends on some external component — say, a complex database or a slow network service. Testing your code with the actual component may be costly, brittle, or simply impractical. A **mock object** acts as a test double: it implements the same interface as the real component but allows you to specify, at runtime, *how* it behaves and *what* it returns.

Unlike a fake (which usually has a working implementation with simplified logic), a mock is pre-programmed with **expectations** about *which methods should be called*, *how many times*, *with what arguments*, and *in what order*. When your code interacts with the mock, GoogleMock verifies these expectations automatically, reporting mismatches immediately.


<Info>
Think of a mock as a vigilant assistant who not only performs tasks but also notes exactly how and when they are done, alerting you the moment something is off.
</Info>

---

## Key Building Blocks of GoogleMock

GoogleMock provides a declarative and highly readable way to specify mock behavior and expectations. Three core constructs shape your interaction with mocks:

### 1. MOCK_METHOD — Declare Mock Methods in Mock Classes

You declare mock methods inside mock classes using the `MOCK_METHOD` macro. It looks like this:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (specifiers));
};
```

- `ReturnType`: The return type of the method.
- `MethodName`: The method name.
- `(ArgTypes...)`: The method parameter types.
- `(specifiers)`: Optional qualifiers, e.g., `(const, override)` if overriding a virtual const method.


This macro generates methods that intercept calls and let GoogleMock verify expectations and provide stubbed responses.

### Practical Tip: Handling Commas in Types

If argument or return types contain commas (e.g., templates like `std::pair<bool, int>`), wrap the type in parentheses or use a `using` alias:

```cpp
using BoolIntPair = std::pair<bool, int>;
class MockFoo {
 public:
  MOCK_METHOD(BoolIntPair, GetPair, ());
};
```

---

### 2. ON_CALL — Set Default Behavior for Mock Methods

Use `ON_CALL(mock_object, method(matchers))` to define the **default action** when a mock method is invoked without explicit expectations. For example, you can specify what it returns or how it behaves when called with certain arguments.

Example:

```cpp
ON_CALL(mock_foo, GetValue(_))
    .WillByDefault(Return(42));
```

This doesn't assert that the method *must* be called; it only defines what happens if it is.

### Best Practice

Use `ON_CALL` to set common behaviors shared by multiple tests or for calls you don't actually assert on.

---

### 3. EXPECT_CALL — Define Concrete Expectations

The `EXPECT_CALL(mock_object, method(matchers))` macro establishes an **expectation** that the method *will be called* with specified arguments.

It allows you to:

- Specify *how many times* the method should be called (using `.Times()`).
- Define the *order* of calls (using `.InSequence()` or `.After()`).
- Set *actions* to perform (`.WillOnce()`, `.WillRepeatedly()`).

Example:

```cpp
EXPECT_CALL(mock_foo, Process(Ge(5)))
    .Times(3)
    .WillRepeatedly(Return(true));
```

This expects `Process()` to be called exactly 3 times with an argument greater or equal to 5, returning `true` each time.

### Practical Tips

- If you omit `.Times()`, GoogleMock infers the count based on `WillOnce` / `WillRepeatedly` clauses or defaults to 1.
- Use wildcard matcher `_` when argument values don’t matter.

---

## Understanding Uninteresting vs Unexpected Calls

- **Uninteresting calls**: Method calls to mock methods with no associated `EXPECT_CALL`. These calls trigger *warnings* by default.
- **Unexpected calls**: Method calls that don't match any established `EXPECT_CALL`. These raise *test failures*.

By default, GoogleMock mock objects are *naggy*: they warn on uninteresting calls but fail on unexpected calls.

### Strictness Wrappers

GoogleMock provides wrappers to control how strictly mock objects treat uninteresting calls:

- `NiceMock<T>`: Suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: Default behavior (warns on uninteresting).
- `StrictMock<T>`: Treats uninteresting calls as errors.

They can be constructed like regular mocks:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

Use **NiceMock** to reduce noise when uninteresting calls are acceptable.
Use **StrictMock** to enforce rigor, ensuring all behavior is explicitly expected.

<Note>
Strictness wrappers only affect mock methods defined with the `MOCK_METHOD` macro directly in the mock class, not inherited mock methods.
</Note>

---

## User Workflow: Creating and Using Mock Objects

Here's a typical progression to leverage GoogleMock in your tests:

1. **Define the mock class:** Derive from the interface or abstract class, declare mocked methods using `MOCK_METHOD`.
2. **Instantiate a mock object:** Use either the mock class directly or with a strictness wrapper.
3. **Set default behavior:** Use `ON_CALL` to specify behavior when the method is called without explicit expectation.
4. **Set expectations:** Use `EXPECT_CALL` to declare expectations about method calls.
5. **Exercise your code:** Run the code that depends on the mock.
6. **Verification:** GoogleMock automatically verifies all expectations when the mock object is destroyed.


### Example: Mocking a Turtle Interface

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};

// Using in tests
MockTurtle mock_turtle;
ON_CALL(mock_turtle, GetX())
    .WillByDefault(Return(0));
EXPECT_CALL(mock_turtle, PenDown()).Times(1);

// Run code that uses turtle...
```

---

## Tips, Pitfalls, and Best Practices

- Put `MOCK_METHOD` declarations in the **public** section regardless of original access; this makes them accessible for expectation specification.
- Use `using BaseClass::Method` if you're mocking only some overloaded methods to avoid hiding others.
- Prefer `ON_CALL` for common default behavior and `EXPECT_CALL` to verify exact interactions, not over-constraining your tests.
- Suppress uninteresting call warnings with `NiceMock` or explicit catch-all `EXPECT_CALL(...).Times(AnyNumber())`.
- Use sequences and ordering (`InSequence`, `After`) to ensure the correct order of calls.
- Be cautious with mock strictness; overly strict mocks make tests brittle and fragile to implementation changes.

<Warning>
Setting expectations after the mock method was called leads to undefined behavior. Always set expectations *before* exercising the code.
</Warning>

---

## Summary

GoogleMock transforms testing by enabling explicit declaration of expected interactions with your code’s dependencies. By mastering `MOCK_METHOD`, `ON_CALL`, `EXPECT_CALL`, and using strictness wrappers, you gain precise control over your tests and powerful diagnostics when expectations are violated.

For detailed recipes and advanced usage, explore the GoogleMock Cookbook and related reference guides.

---

## Additional Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Practical recipes for mocking.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): Beginner-friendly tutorial.
- [Mocking Reference](reference/mocking.md): Formal API reference for mocking.
- [Matchers Reference](reference/matchers.md): Guide on argument matchers.
- [Actions Reference](reference/actions.md): Details on actions to specify mock behavior.
- [Strictness Wrappers in GoogleMock](../googlemock/include/gmock/gmock-nice-strict.h): Implementation details on NiceMock, NaggyMock, and StrictMock.

---