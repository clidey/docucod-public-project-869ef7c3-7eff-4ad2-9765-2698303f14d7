---
title: "Framework Initialization & Entry Points"
description: "Understand how GoogleTest/GoogleMock boots up and discovers tests, including the standard entry points and main() integration. This page explains automatic test discovery and execution, as well as platform-specific considerations for embedded and desktop platforms."
---

# Framework Initialization & Entry Points

GoogleTest and GoogleMock utilize a well-defined initialization sequence and entry points that enable automatic test discovery and execution. Understanding how these components initialize, discover tests, and run them—including platform-specific behaviors—empowers you to control your test lifecycle and adapt to diverse environments ranging from desktop to embedded platforms.

---

## Understanding Initialization: How GoogleTest and GoogleMock Start

When your test executable launches, GoogleTest and GoogleMock perform several key steps before executing any tests:

1. **Framework Initialization:**
   - Both frameworks parse command-line flags specifically used to configure their behavior.
   - This parsing removes recognized flags from `argc`/`argv` to avoid conflicts.

2. **Automatic Test Discovery:**
   - All test cases registered via macros (`TEST`, `TEST_F`, etc.) are automatically registered with the testing framework.
   - No manual enumeration of tests is necessary—GoogleTest tracks these internally.

3. **Test Execution:**
   - After initialization completes, the framework runs all registered tests in sequence.
   - If any test fails or encounters a fatal failure, it is reported per configured verbosity.

This boot-up process is mostly invisible, providing a streamlined experience where you only need to define tests and then call a single macro to kick off execution.

### The Role of `InitGoogleTest` and `InitGoogleMock`

- `testing::InitGoogleTest(int* argc, char** argv)` initializes the GoogleTest environment by parsing standard testing flags.
- `testing::InitGoogleMock(int* argc, char** argv)` initializes GoogleMock and, as a side effect, GoogleTest as well.

These functions should be *called before* invoking `RUN_ALL_TESTS()`.

If you use GoogleMock, you *must* call `InitGoogleMock()` (not just `InitGoogleTest()`) to ensure mock-specific flags and behavior are correctly configured.


## Standard Entry Points: Using the Provided `main()` Implementations

Writing your own `main()` function manually is not necessary in most cases because GoogleTest and GoogleMock provide standard entry points through separate libraries:

- **GoogleTest `main`** is defined in the `gtest_main` library.
- **GoogleMock `main`** (which calls `InitGoogleMock()`) is defined in the `gmock_main` library.

### Example of a Typical Custom `main()`

When customization is required, you can write your own main function following this pattern:

```c++
#include <gtest/gtest.h>
#include <gmock/gmock.h>  // If using GoogleMock

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);  // or InitGoogleTest if not mocking
  return RUN_ALL_TESTS();
}
```

### What Does This `main()` Do?

- Initializes GoogleMock and GoogleTest, parsing all flags and removing them from `argv`.
- Runs the test suites discovered during compilation.
- Returns an exit code reflecting test success (`0`) or failures (`1`).

The `RUN_ALL_TESTS()` function will:
- Discover and execute every test registered in the program.
- Report results following configured verbosity levels.


## Automatic Test Discovery Mechanism

GoogleTest uses static registration via macros (`TEST`, `TEST_F`, `TEST_P`, etc.) that place pointers to test factory functions into internal data structures at compile time. This way, when `RUN_ALL_TESTS()` runs:

- It iterates all registered test suites and tests.
- Runs each test in isolation, creating fresh fixture instances.
- Handles setup and teardown automatically.


### Benefits of Automatic Discovery

- No need to list or reference tests manually.
- Tests compiled into binaries are immediately discoverable and runnable.
- Enables integration with CI systems and test runners seamlessly.


## Platform-Specific Considerations

GoogleTest/GoogleMock adapt to diverse environments, from desktop OSes to embedded platforms. Their initialization logic reflects this:

### Desktop Platforms (Linux, Windows, macOS)

- Use a conventional `main(int argc, char** argv)` entry point.
- Command-line argument parsing is supported.
- The main functions print a small banner (e.g., "Running main() from gmock_main.cc") to standard output.

### Embedded and Arduino-like Platforms (ESP8266, ESP32, NRF52)

- Do **not** have a conventional `main()` function.
- GoogleTest and GoogleMock define `setup()` and `loop()` functions replacing `main`.
- `setup()` calls `InitGoogleTest()` or `InitGoogleMock()`.
- `loop()` repeatedly calls `RUN_ALL_TESTS()` allowing continuous test execution.

This platform adaptation ensures tests can run smoothly without traditional operating system support.


## Typical User Flow to Initialize and Run Tests

<Steps>
<Step title="Define Your Tests">
Create your tests with `TEST()` and `TEST_F()` macros, registering them automatically.
</Step>
<Step title="Write or Use main() Entry Point">
Use the provided `gtest_main`/`gmock_main` libraries to avoid main() boilerplate, or write a custom `main()` that calls `InitGoogleMock()` then `RUN_ALL_TESTS()`.
</Step>
<Step title="Build Your Test Executable">
Compile and link your tests with GoogleTest/GoogleMock libraries using CMake or your build system.
</Step>
<Step title="Run Tests">
Execute the resulting binary; GoogleTest/GoogleMock discover and run all tests automatically.
</Step>
<Step title="Interpret Results and Iterate">
Check the test results and failure messages printed on the console, then fix issues and rerun.
</Step>
</Steps>


## Troubleshooting Initialization and Entry Issues

<AccordionGroup title="Common Issues and Recommendations">
<Accordion title="Tests Not Being Discovered">
Ensure your tests are defined with GoogleTest macros (`TEST`, `TEST_F`) in files properly linked into the executable. Missing object files can cause tests to be omitted.
</Accordion>
<Accordion title="Custom main() Function Not Calling Initialization">
Always call `InitGoogleTest()` or `InitGoogleMock()` *before* `RUN_ALL_TESTS()`. Forgetting this step results in no test discovery or incorrect behavior.
</Accordion>
<Accordion title="Command-line Flags Not Recognized">
Use the framework's initialization functions which parse and remove GoogleTest/GoogleMock-specific flags to avoid unknown flag errors.
</Accordion>
<Accordion title="Platform-Specific Entry Point Conflicts">
Avoid defining the wrong entry point for embedded platforms. Use `setup()`/`loop()` on Arduino-compatible devices instead of `main()`.
</Accordion>
<Accordion title="Linking with gtest_main or gmock_main Causes Errors">
Ensure your build system links to either `gtest_main` for GoogleTest or `gmock_main` for GoogleMock when you want the default `main()` function. Mixing or missing these can cause linker errors or missing symbols.
</Accordion>
</AccordionGroup>


## Practical Tips and Best Practices

- **Prefer linking with `gmock_main` or `gtest_main`** if you do not need a custom main function. This reduces boilerplate.
- **Call `InitGoogleMock` when using GoogleMock** to handle both GoogleMock and GoogleTest flags properly.
- **Do not call `RUN_ALL_TESTS()` more than once.** It is designed to run the whole test suite a single time.
- **Use command-line flags to customize behavior** such as verbosity (e.g., `--gmock_verbose=info`).
- **Ensure test source files are compiled and linked** so test registration happens as expected.


## Illustrative Code Examples

### Minimal Custom main() Example

```c++
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Linking with `gmock_main` Example (CMake snippet)

```cmake
add_executable(my_tests test_file.cpp)
target_link_libraries(my_tests gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```


## Summary Diagram: Test Life Cycle Initialization and Execution

```mermaid
flowchart TD
  Start([Executable Starts]) --> Init[InitGoogleMock()/InitGoogleTest]
  Init --> Discover[Automatic Test Discovery]
  Discover --> RunTests[RUN_ALL_TESTS()]
  RunTests -->|Test Passed| Success[Report Success]
  RunTests -->|Test Failed| Fail[Report Failures]
  Success --> End([Exit with 0])
  Fail --> End([Exit with 1])

  subgraph Platform_EntryPoint
    direction TB
    MainFunc["main(argc, argv) or setup()/loop() (embedded)"]
    MainFunc --> Start
  end
```


---

## Additional Resources
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) – for basics of writing tests and test fixtures.
- [API Reference: Test Runner Entrypoints and Main Functions](../api-reference/test-execution-and-integration/test-runner-entrypoint.md) – details about standard main() implementations.
- [Framework Initialization and Configuration](../api-reference/test-execution-and-integration/framework-initialization-config.md) – information on flags and initialization APIs.
- [Quickstart Setup Guide](../guides/getting-started-workflows/quickstart-setup.md) – how to integrate GoogleTest/GoogleMock into your build.
- Troubleshooting guides for common issues with setup and test running.


<Tip>
When starting with GoogleMock, always call `testing::InitGoogleMock()` in your `main()`. This ensures your mocks and tests initialize correctly and all command-line flags are handled smoothly.
</Tip>

<Note>
Consider linking with the provided `gmock_main` or `gtest_main` libraries for straightforward entry points unless your project requires a custom main function.
</Note>
