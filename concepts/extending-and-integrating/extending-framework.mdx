---
title: "Extending the Framework"
description: "Shows how users can define custom actions, matchers, and assertions to tailor the framework for unique test scenarios. Clarifies when and how to leverage extensibility without breaking compatibility."
---

# Extending the Framework

GoogleMock offers rich extensibility points that empower you to tailor the mocking behavior to unique test scenarios. This page explains how you can define custom actions, matchers, and assertions to fit your domain needs, while maintaining compatibility with the framework and its idiomatic usage.

---

## Why Extend GoogleMock?

While GoogleMock's built-in actions and matchers cover many common testing needs, some scenarios demand customized behaviors. Extending the framework enables you to:

- Define domain-specific criteria for argument matching.
- Simulate complex or rare behaviors using custom actions.
- Create readable and maintainable test code through expressive assertions.

Proper extensibility avoids duplications and brittle test code, making your tests more meaningful and less error-prone.


## Custom Actions

Actions in GoogleMock specify what a mock method should do when invoked (like returning a value or invoking a callback). Custom actions let you implement complex behaviors beyond the built-in set.

### Writing Custom Actions Quickly

You can define a callable (function, lambda, or functor) compatible with the mocked method's signature and use it directly with `WillOnce()` or `WillRepeatedly()`. For example:

```cpp
MockFunction<int(int)> mock;
EXPECT_CALL(mock, Call)          
    .WillOnce([](const int input) { return input * 7; });
EXPECT_EQ(mock.AsStdFunction()(2), 14);
```

This approach fits most cases where you need specific behavior without additional framework constructs.

### Implementing Polymorphic Actions

If you want your action to work with multiple mock function types, define a class with a template `Perform()` method that takes the mock's argument tuple and returns the result. Then wrap it via `MakePolymorphicAction()`. For example:

```cpp
class ReturnSecondArgumentAction {
public:
  template<typename Result, typename ArgumentTuple>
  Result Perform(const ArgumentTuple& args) const {
    return std::get<1>(args);
  }
};

PolymorphicAction<ReturnSecondArgumentAction> ReturnSecondArgument() {
  return MakePolymorphicAction(ReturnSecondArgumentAction());
}
```

Use it like any other action:

```cpp
EXPECT_CALL(foo, Method).WillOnce(ReturnSecondArgument());
```

### Legacy Macro-based Actions

Before C++11, GoogleMock supported `ACTION` macros to create custom actions. While still supported, modern usage prefers callables for clearer semantics:

```cpp
ACTION(IncrementArg1) { return ++(*arg1); }
EXPECT_CALL(mock, Foo()).WillOnce(IncrementArg1());
```

Avoid these unless maintaining legacy code.

---

## Custom Matchers

Matchers specify constraints on expected method arguments. Custom matchers enable expressive, reusable validation logic.

### Quick Matcher Creation Using Macros

Use the family of `MATCHER` macros for concise matcher definitions. For example:

```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
EXPECT_CALL(mock, Method(IsDivisibleBy7()));
```

This approach automatically integrates with error messages.

### Parameterized Matchers

For matchers that take parameters, use `MATCHER_P`, `MATCHER_P2`, etc.

```cpp
MATCHER_P(HasAbsoluteValue, value, "") { return abs(arg) == value; }
EXPECT_THAT(obj, HasAbsoluteValue(5));
```

### Writing Matcher Classes

When more control is needed, implement a matcher class with these methods:

- `bool MatchAndExplain(const T& value, std::ostream* os) const`
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

and then provide a factory function returning `Matcher<T>`.

This allows advanced behavior including detailed explanation of matching failures.

### Polymorphic Matchers

Matchers can be polymorphic by templating `MatchAndExplain` on the argument type, enabling usage across different types, e.g., pointers of any type.

### Composite Matchers

Matchers can be composed from others to form complex criteria, using built-in combinators like `AllOf()`, `AnyOf()`, and `Not()`.


---

## Custom Assertions

Besides matchers, custom assertions allow validating more sophisticated conditions in tests. Although not detailed here, GoogleTest supports writing custom assertions that integrate seamlessly with the framework’s reporting and matcher systems.


---

## Best Practices for Extension

- Always maintain matcher purity: custom matchers must be free of side effects and deterministic.
- Reuse existing actions/matchers when possible to reduce complexity.
- Provide clear descriptions for custom matchers and actions to improve diagnostic output.
- Use parameterized matchers and actions to maximize reusability.
- Test your custom matchers and actions independently.


---

## When Not to Extend

Avoid unnecessary complexity when:

- Built-in actions and matchers suffice.
- Simpler composition of existing features achieves the goal.
- Mocking concrete classes without clear interface boundaries.

Over-extension may lead to brittle and hard-to-maintain tests.

---

## Summary

Extending GoogleMock with custom actions and matchers allows you to tailor test doubles precisely to your domain and testing requirements. By levering callables, matcher macros, and the matcher interface, you retain compatibility with the framework’s expectations while unlocking powerful capabilities. Follow best practices to ensure your extensions remain maintainable and clear.


---

## Code Example: Custom Matcher and Action

```cpp
// Define a parameterized matcher that checks if the sum of two fields equals a value.
MATCHER_P(SumEquals, expected_sum, "") {
  return (arg.bar() + arg.baz()) == expected_sum;
}

class IncrementAction {
public:
  int operator()(int* p) {
    return ++(*p);
  }
};

// Use them in tests
TEST(MyTest, CustomMatchersAndActions) {
  MockFoo foo;
  EXPECT_CALL(foo, GetBar(SumEquals(10)));
  EXPECT_CALL(foo, Increment(_)).WillOnce(IncrementAction());
}
```


## Further Reading and References

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers) – Recipes on custom matchers and actions
- [Mock Method Macros](../api_reference/mocking_core/mock_method_macros) – Defining mock methods
- [EXPECT_CALL and ON_CALL](../api_reference/mocking_core/expect_call_on_call) – Setting expectations and behaviors
- [Standard and Custom Actions](../api_reference/actions_and_advanced/standard_actions) – Overview of built-in and custom actions
- [Built-in Matchers](../api_reference/matchers_assertions/builtin_matchers) – Fundamental and composite matchers
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) – Quick reference for common patterns

Check out the general concepts and architecture pages to understand how extension fits into the overall framework:

- [Mock Expectations and Verification](../concepts/core-models/mock-expectations)
- [Assertions and Matchers](../concepts/core-models/assertions-matchers)
- [Actions and Return Value Model](../concepts/core-models/actions-advanced)

---

Combining these capabilities, you can evolve your tests from basic mocking to sophisticated behavior-driven testing that closely mirrors your system's logic and constraints.