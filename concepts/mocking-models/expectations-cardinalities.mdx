---
title: "Expectations and Cardinalities"
description: "Uncover how GoogleMock enables precise behavioral verification through expectations, matchers, and cardinalities—allowing you to specify call frequency, argument patterns, and sequence requirements for test doubles."
---

# Expectations and Cardinalities

GoogleMock empowers you to precisely verify the behavior of mock objects through *expectations*—rules specifying how mock methods should be called during tests. A vital part of these expectations is *cardinalities*, which define *how many times* a mock method is expected to be invoked. This page focuses exclusively on understanding expectations related to call frequency, cardinalities, and how they shape behavioral verification.

---

## What Are Expectations in GoogleMock?

Expectations in GoogleMock define the contract that your mock objects must fulfill during test execution. When you write an expectation using `EXPECT_CALL()`, you specify *which* method should be called, *with what arguments*, and *how many times*. Cardinalities express the call frequency aspect of this contract.

All expectations must be set **before** the actual calls occur in your test code to ensure GoogleMock can monitor and validate behavior accurately.

## Understanding Cardinalities: Specifying Call Frequency

Cardinalities allow you to define an expectation on the **number of times** a particular mock method call must occur. They can be: 

- Exact: Expect the call **exactly** *n* times
- Bounded: Expect the call **between** *m* and *n* times
- Lower bound: Expect the call **at least** *n* times
- Upper bound: Expect the call **at most** *n* times
- Unlimited: Expect the call **any number** of times

### Defining Cardinalities in GoogleMock

You specify cardinalities using the `.Times()` clause in `EXPECT_CALL`. The argument to `.Times()` is a cardinality object, such as:

| Cardinality            | Usage Example                    | Meaning                                    |
|------------------------|---------------------------------|--------------------------------------------|
| `Exactly(n)` or `n`    | `.Times(Exactly(3))` or `.Times(3)` | Called **exactly** 3 times                  |
| `Between(m, n)`        | `.Times(Between(2, 5))`          | Called **between** 2 and 5 times            |
| `AtLeast(n)`           | `.Times(AtLeast(1))`             | Called **at least** once                     |
| `AtMost(n)`            | `.Times(AtMost(2))`              | Called **at most** 2 times                   |
| `AnyNumber()`          | `.Times(AnyNumber())`            | Called **any number** of times               |

If you omit `.Times()`, GoogleMock *infers* the cardinality automatically based on the presence and number of `WillOnce()` and `WillRepeatedly()` clauses.

### Example

```cpp
using ::testing::AtLeast;
...
EXPECT_CALL(turtle, PenDown())
    .Times(AtLeast(1));  // PenDown() must be called at least once
```

If `PenDown()` is never called, the test will fail immediately with a clear error message.

---

## How Cardinalities Work Behind the Scene

GoogleMock's cardinality implementation tracks the number of times a mock method is called and compares it against the specified cardinality:

- **IsSatisfiedByCallCount(call_count):** Returns true if the current number of calls satisfies the expectation.
- **IsSaturatedByCallCount(call_count):** Returns true if the maximum call count has been reached or exceeded.
- **IsOverSaturatedByCallCount(call_count):** Returns true if calls exceed the allowed maximum count (used to raise errors).

For example, `Exactly(3)` expects exactly 3 calls: call counts 0–2 are unsatisfied and unsaturated, 3 is satisfied and saturated, and 4+ are over-saturated.

---

## Commonly Used Built-in Cardinalities

GoogleMock provides the following built-in cardinalities for your convenience:

- `Exactly(int n)`: Method must be called exactly *n* times.
- `Between(int min, int max)`: Method must be called from *min* to *max* times.
- `AtLeast(int n)`: Method must be called at least *n* times (no upper bound).
- `AtMost(int n)`: Method must be called at most *n* times (no lower bound).
- `AnyNumber()`: Method can be called any number of times (equivalent to `AtLeast(0)`).

Attempting to create cardinalities with invalid bounds (negative numbers, or min > max) will produce run-time errors with detailed messages.

## Specifying Zero Calls: Ensuring a Method is **Never** Called

Use `.Times(0)` to specify that a given method should not be called at all. For example:

```cpp
EXPECT_CALL(foo, Bar(_))
    .Times(0); // Bar() must never be called
```

GoogleMock reports a failure immediately if that method is invoked.

---

## Making Expectations Precise but Flexible

Avoid over-specifying your expectations, especially call counts and argument matchers, as it can make your tests fragile and hard to maintain. Use cardinalities that express your intent clearly without constraining implementation details unnecessarily.

For instance, if a method should be called at least once but you don't care about the exact number beyond that, use `AtLeast(1)`. If the call count should be strictly exact for the feature correctness, use `Exactly(n)`.

---

## Integration with Other Expectation Clauses

Expectations often combine cardinalities with argument *matchers*, *actions*, and *call ordering*. The cardinality controls *how many times* a call with matching arguments is expected. Here is the typical workflow:

```cpp
EXPECT_CALL(mock_object, Method(Matcher1(), Matcher2()))
    .Times(AtLeast(1))
    .WillOnce(Return(123))
    .WillRepeatedly(Return(456));
```

This example expects calls with arguments matching specified matchers, with the call count bound by `AtLeast(1)`, and defines behavior for the first and all subsequent calls.

---

## Troubleshooting Common Cardinality Issues

- **Too few calls:** GoogleMock reports that an expectation is unsatisfied if the method is called less than the lower bound of the cardinality.
- **Too many calls:** GoogleMock reports over-saturation if the method call count exceeds the upper bound.
- **No calls when expected at least once:** Use `AtLeast(1)` or omit `.Times()` with `.WillOnce()` clauses for correct inference.

Check your `.Times()` clauses carefully if you encounter unexpected failures.

---

## Tips and Best Practices

- Set expectations **before** exercising your mocks to avoid undefined behavior.
- Use `.Times(AnyNumber())` to create fall-through or catch-all expectations when you want to allow any number of other calls.
- Combine `RetiresOnSaturation()` when you want an expectation to become inactive after reaching its call limits—this helps with overlapping expectations.
- Use sequences and `.InSequence()` or `.After()` to control call ordering, but not all tests require this.
- Always match the expectations granularity with the test’s purpose: too strict causes brittleness; too loose may miss defects.

---

## Related Concepts

- [Set Expectations with EXPECT_CALL](../api-reference/gmock-mocking-apis/expectations-specification.md) shows how to compose full expectations including cardinalities.
- [Matchers](../api-reference/gmock-mocking-apis/matchers.md) describe flexible argument specifications.
- [Actions](../api-reference/gmock-mocking-apis/actions.md) define method behaviors when called.
- [Sequences and Order](../api-reference/gmock-mocking-apis/expectations-specification.md#EXPECT_CALL.InSequence) help specify call ordering constraints.

## References

- Cardinality implementation details: `googlemock/include/gmock/gmock-cardinalities.h` and `googlemock/src/gmock-cardinalities.cc`
- Comprehensive tests of cardinalities in `googlemock/test/gmock-cardinalities_test.cc`
- Conceptual overview in [gMock for Dummies](docs/gmock_for_dummies.md#setting-expectations)
- API details in [Mocking Reference - EXPECT_CALL.Times](../api-reference/gmock-mocking-apis/expectations-specification.md)

---

By mastering expectations and cardinalities, you gain fine-grained control over how your mock objects validate interactions, enabling you to write robust, maintainable, and meaningful unit tests that precisely match intended behaviors.
