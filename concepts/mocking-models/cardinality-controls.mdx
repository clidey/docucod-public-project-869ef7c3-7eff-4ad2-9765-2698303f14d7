---
title: "Cardinalities and Call Counting"
description: "Learn how GoogleMock enables precise control over how many times a mock method is expected to be called, using cardinalities like AtLeast, AtMost, and Times. Understand how these concepts help ensure tests are both rigorous and flexible."
---

# Cardinalities and Call Counting in GoogleMock

GoogleMock provides powerful control over how many times a mock method is expected to be called using the concept of **cardinalities**. Cardinalities express the accepted call count for mock methods, helping you write tests that are both rigorous and flexible.

This guide explains the available cardinalities, how they influence test expectations, and practical examples showing their use to ensure comprehensive verification of interactions in your C++ tests.

---

## Understanding Cardinalities

A **cardinality** defines the number of calls a mock method is expected to receive within a test. Instead of specifying expectations repeatedly for each call, cardinalities allow you to express constraints such as:

- Exactly N calls
- At least N calls
- At most N calls
- Between M and N calls
- Any number of calls

These cardinalities are used in conjunction with the `.Times()` clause in an `EXPECT_CALL` statement.

## Built-in Cardinalities Provided by GoogleMock

GoogleMock includes several built-in cardinality functions in the `testing` namespace:

| Cardinality       | Description                                    |
|-------------------|------------------------------------------------|
| `Exactly(n)`      | Expect exactly *n* calls to the mock method. |
| `AtLeast(n)`      | Expect at least *n* calls. Calls beyond *n* are accepted. |
| `AtMost(n)`       | Expect at most *n* calls. Calls beyond *n* cause failure. |
| `Between(m, n)`   | Expect between *m* and *n* calls, inclusive. |
| `AnyNumber()`     | Expect any number of calls, including zero. |


### Important Notes

- Setting a cardinality of `Exactly(0)` means the function **must not be called**.
- If `Times()` is omitted, GoogleMock attempts to infer cardinality based on `.WillOnce()` and `.WillRepeatedly()` clauses.

## Cardinality Syntax and Usage Example

```cpp
using ::testing::AtLeast;
using ::testing::Exactly;
using ::testing::AtMost;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (), ());
};

TEST(FooTest, CardinalityExample) {
  MockFoo foo;

  // Expect Bar() to be called exactly twice.
  EXPECT_CALL(foo, Bar()).Times(Exactly(2));

  // Expect Bar() to be called at least once.
  EXPECT_CALL(foo, Bar()).Times(AtLeast(1));

  // Expect Bar() to be called at most 3 times.
  EXPECT_CALL(foo, Bar()).Times(AtMost(3));

  foo.Bar();
  foo.Bar();
}
```

## Behavior of Core Cardinalities

| Cardinality | Behavior Summary |
|-------------|------------------|
| `Exactly(n)` | Succeeds if the function is called exactly *n* times; fails if fewer or more calls are made. |
| `AtLeast(n)` | Succeeds if the function is called *n* or more times; calls above *n* are allowed. |
| `AtMost(n)`  | Succeeds if the function is called up to *n* times; fail if called more than *n* times. |
| `Between(m, n)` | Succeeds if the function is called between *m* and *n* inclusive; fails if outside range. |
| `AnyNumber()` | Function can be called any number of times, including zero. |

### Typical Cardinality Edge Cases

- Negative values for bounds cause immediate test failures during expectation setup.
- For `Between(m, n)`, `m` must be ≤ `n`, and both ≥ 0.
- `Exactly(n)` is just a special case of `Between(n, n)`.

## How GoogleMock Reports Calls in Relation to Cardinalities

GoogleMock provides descriptive failure messages that help you understand whether the actual calls satisfy the specified cardinalities. For example, it distinguishes between:

- **Never called**: the function was not invoked at all.
- **Called once/twice**: exactly 1 or 2 times.
- **Called N times**: 3 or more times.
- **Oversaturation**: calls exceeding the upper bound of the cardinality.

Such diagnostics are vital for quickly pinpointing deviations from expected behavior.

## Inferring Cardinalities When `.Times()` Is Omitted

If you don't explicitly specify `.Times()`, GoogleMock infers the cardinality based on actions:

| Scenario                                             | Inferred Cardinality           |
|------------------------------------------------------|-------------------------------|
| No `.WillOnce()` or `.WillRepeatedly()` clauses      | Exactly(1) (called once)       |
| *n* `.WillOnce()` clauses and no `.WillRepeatedly()` | Exactly(n)                    |
| *n* `.WillOnce()` clauses and one `.WillRepeatedly()`| AtLeast(n)                   |

## Custom Cardinalities

GoogleMock enables users to define custom cardinalities by implementing the `CardinalityInterface`. This allows for specialized call counting policies, such as calls occurring an even number of times.

Example of a custom cardinality that matches even number of calls:

```cpp
class EvenCardinality : public testing::CardinalityInterface {
 public:
  bool IsSatisfiedByCallCount(int call_count) const override {
    return (call_count % 2) == 0;
  }
  bool IsSaturatedByCallCount(int /* call_count */) const override {
    return false;  // This never saturates
  }
  void DescribeTo(std::ostream* os) const override {
    *os << "called even number of times";
  }
};

testing::Cardinality EvenNumber() {
  return testing::MakeCardinality(new EvenCardinality);
}

EXPECT_CALL(foo, Bar()).Times(EvenNumber());
```

## Best Practices and Tips

- Prefer `AtLeast(n)` or `AtMost(n)` for flexible but bounded expectations.
- Use `Exactly(n)` for strict expectations and zero (`Exactly(0)`) to disallow calls.
- When writing multiple expectations on the same method, order them carefully as GoogleMock matches the last matching expectation first.
- Combine cardinalities with `.RetiresOnSaturation()` to retire an expectation when saturated, avoiding unwanted failures on extra calls.
- Use custom cardinalities to express domain-specific call count requirements.

## Common Pitfalls

- Expectation cardinalities are checked against actual call count at the end of the test or when the mock is destroyed.
- Calling the mock method more times than allowed by the cardinality causes test failures.
- Omitting `.Times()` can cause unintended inferred cardinals; explicitly specify `.Times()` for clarity.
- Negative bounds in cardinalities will cause an immediate setup failure.

## Example: Combining Cardinalities with Actions

```cpp
using ::testing::Return;
using ::testing::AtLeast;

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (), ());
};

TEST(FooTest, Example) {
  MockFoo foo;

  EXPECT_CALL(foo, Bar())
      .Times(AtLeast(2))
      .WillOnce(Return(10))
      .WillRepeatedly(Return(20));

  EXPECT_EQ(foo.Bar(), 10);  // First call returns 10.
  EXPECT_EQ(foo.Bar(), 20);  // Second call returns 20.
  EXPECT_EQ(foo.Bar(), 20);  // Subsequent calls return 20.
}
```

In this example, `Bar()` must be called at least twice. The first call returns 10, the second and all subsequent calls return 20.

---

### See Also

- [EXPECT_CALL and `.Times()` Clause](../reference/mocking.md#EXPECT_CALL.Times)
- [gMock Cheat Sheet - Cardinalities](https://google.github.io/googletest/gmock_cheat_sheet.html#CardinalityList)
- [gMock for Dummies - Setting Expectations](https://google.github.io/googletest/gmock_for_dummies.html#setting-expectations)
- [Mocking Basics Guide](../../guides/mocking-and-advanced-scenarios/mocking-basics.md)

---