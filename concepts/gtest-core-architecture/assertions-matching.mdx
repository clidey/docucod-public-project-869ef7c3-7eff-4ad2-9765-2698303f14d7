---
title: "Assertions and Matchers Model"
description: "Examine how GoogleTest assertions and matchers work, including built-in and user-defined assertions. Understand how failure messages are generated, how predicate assertions improve expressiveness, and how matchers enable flexible value validation."
---

# Assertions and Matchers Model

Explore the foundational concepts that underpin GoogleTest's assertions and matchers. This page explains how built-in and user-defined assertions function, how failure messages are constructed for clarity, and how predicate assertions and matchers empower expressive and flexible value validation.

---

## Introduction to Assertions and Matchers

At the heart of GoogleTest lies a robust system for verifying expectations in your test code: **assertions** and **matchers**. Assertions check conditions and report success or failure, while matchers enable detailed validation of values with rich semantics and informative failure messages.

This model provides:

- Default assertions such as `EXPECT_EQ`, `ASSERT_TRUE`, and their variants
- Predicate assertions for checking complex conditions more expressively
- Support for user-defined predicates and predicate-formatters
- Leveraging matchers from GoogleMock for flexible and readable validation

Each mechanism plays a role in making your tests both powerful and user-friendly.

## Understanding Assertion Macros

GoogleTest provides various macros for assertions, mostly in pairs: `EXPECT_*` and `ASSERT_*`.

- **EXPECT_*** macros report **nonfatal failures**, allowing the test to continue.
- **ASSERT_*** macros report **fatal failures**, aborting the current function.

These macros evaluate the condition or expression exactly once, ensuring safe use even with expressions that have side effects.

### Built-in Assertions

Common examples include:

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`
- String comparisons like `EXPECT_STREQ(cstr1, cstr2)`
- Floating-point comparisons like `EXPECT_FLOAT_EQ(val1, val2)`

When such assertions fail, GoogleTest prints the values involved to help diagnose issues. For example, `EXPECT_EQ(2 + 2, 5)` failure message includes the expression and evaluated values.

<Tip>
Always provide readable custom messages by streaming text with `<<` to assertions for clarity.
</Tip>

### Failure Messages

Failure messages are generated to make debugging easy:

- They show the actual and expected values.
- For comparisons, they highlight which value didn’t match.
- For predicates, they print argument values with explanatory text.

For example, an equality failure might look like:

```
Expected equality of these values:
  foo
    Which is: 5
  bar
    Which is: 6
```

This precision helps you quickly locate the problem.

## Predicate Assertions for Enhanced Expressiveness

Sometimes, standard `EXPECT_TRUE()` hides the details of why a test failed, especially for complex conditions. GoogleTest offers **predicate assertions** which:

- Accept a predicate function or functor returning `bool` or `AssertionResult`.
- Display detailed messages showing argument expressions and values.

### Using Predicate Assertions

#### Basic Predicate Macros

- `EXPECT_PRED1(pred, val1)`, `EXPECT_PRED2(pred, val1, val2)`, … up to 5 arguments
- `ASSERT_PRED1(pred, val1)`, …

`pred` is a function or functor returning a `bool`. Upon failure, GoogleTest prints values of arguments.

**Example:**

```cpp
bool MutuallyPrime(int m, int n) { ... }
EXPECT_PRED2(MutuallyPrime, a, b);
```

If the assertion fails, you get a message like:

```
MutuallyPrime(b, c) is false, where
b evaluates to 4
c evaluates to 10
```

#### Predicate-Formatter Macros

These macros accept a **predicate-formatter** – a function or functor that returns a `testing::AssertionResult` and formats failure messages completely. They allow customized detailed failure messages beyond default predicates.

- `EXPECT_PRED_FORMAT1(pred_formatter, val1)`, … up to 5 arguments
- `ASSERT_PRED_FORMAT1(...)`, …

**Predicate-formatter signature example:**

```cpp
testing::AssertionResult MyPredicateFormatter(const char* expr1, const T1& val1);

testing::AssertionResult MyPredicateFormatter(const char* expr1, const char* expr2, const T1& val1, const T2& val2);
```

> Expression strings `expr1`, `expr2` are the argument expressions as strings, enabling your message to include source code context.

**Example:**

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* m_expr, const char* n_expr, int m, int n) {
  if (MutuallyPrime(m, n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << m_expr << " and " << n_expr
      << " (" << m << " and " << n
      << ") are not mutually prime.";
}
...
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

#### Why Use Predicate Assertions?

- They print argument values for failed assertions without clutter.
- You avoid manually writing error message strings.
- They allow richer, readable failure explanations.

<Tip>
Use predicate-formatter assertions when you want full control over failure messages.
</Tip>

### Argument Evaluation

All predicate assertion arguments are evaluated exactly **once**, avoiding side effect duplication or performance surprises.

### Supported Arity

GoogleTest supports predicate assertions with up to **5 arguments** for both basic predicates and predicate-formatters.

## Matchers: Flexible and Expressive Value Validation

Matchers come from GoogleMock but are available to GoogleTest for verifying that a value meets criteria beyond simple equality or boolean tests.

Matchers allow expressions like:

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(value2, MatchesRegex("Line \\d+"));
ASSERT_THAT(value3, AllOf(Gt(5), Lt(10)));
```

They read naturally and produce well-formed failure messages:

```
Value of: value1
  Actual: "Hi, world!"
Expected: starts with "Hello"
```

Matchers cover many domains such as:

- Wildcard and exact matches
- Containers and ranges
- String patterns
- Floating-point comparisons
- Exception assertions

You can combine, adapt, and define custom matchers for your needs.

<Tip>
Prefer `EXPECT_THAT` with matchers over `EXPECT_*` when you want expressive, reusable checks.
</Tip>

## Generating Failure Messages

Failure messages are carefully crafted to:

- Identify the assertion that failed
- Show actual and expected values and expressions
- Include helpful context such as expression source text
- For predicates and matchers, show why the assertion failed

This mechanism uses `testing::AssertionResult` to encapsulate success/failure and store messages.

## Working with User-Defined Assertions

GoogleTest supports user-defined assertions through predicate and predicate-formatter assertions.

- Write a function returning `bool` or `AssertionResult`.
- Use predicate macros to verify conditions with detailed failure information.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
```

Or with predicate-formatter:

```cpp
testing::AssertionResult AssertIsEven(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}
EXPECT_PRED_FORMAT1(AssertIsEven, value);
```

## Practical Examples

```cpp
// Basic predicate example.
bool IsPositive(int x) { return x > 0; }
EXPECT_PRED1(IsPositive, result);

// Predicate-formatter example.
testing::AssertionResult IsPositiveFormatter(const char* expr, int x) {
  if (x > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " is expected to be positive, but evaluates to " << x << ".";
}
EXPECT_PRED_FORMAT1(IsPositiveFormatter, val);

// Using matchers.
using ::testing::StartsWith;
EXPECT_THAT(my_str, StartsWith("Hello"));

// Combining multiple matchers.
using ::testing::AllOf;
EXPECT_THAT(number, AllOf(Gt(5), Lt(10)));
```

## Tips and Best Practices

- Use `EXPECT_*` for nonfatal checks, `ASSERT_*` for fatal checks needing immediate abortion.
- Prefer predicate-formatter assertions when default predicate messages are too weak.
- Use matchers with `EXPECT_THAT` for the most readable checks and rich diagnostics.
- Ensure all predicate arguments have no side effects or rely on single evaluation guarantees.
- Name predicate-formatter functions clearly to reflect their purpose and argument count.

<Note>
If you encounter ambiguous usage with overloaded or template predicates, specify function pointers explicitly.
</Note>

## Troubleshooting Common Issues

- **Multiple evaluations of predicate arguments:** Predicate assertions guarantee single evaluation; if you observe otherwise, check your predicate implementation.
- **Ambiguous function overloads:** Use explicit casts to disambiguate in predicate macros.
- **Failure messages lack context:** Use predicate-formatters to add detailed failure descriptions.
- **Matchers not matching as expected:** Confirm matcher usage and value types; use `PrintToString` to debug.

<Tip>
Enable `SCOPED_TRACE` to add trace context and help diagnose assertion failures in nested calls.
</Tip>

## Summary

GoogleTest's assertion and matcher model empowers developers to write expressive, clear, and robust tests. By combining built-in assertions, predicate-based checks with detailed message formatting, and matcher integration, you get a comprehensive toolkit to validate behavior precisely and receive actionable feedback when tests fail.

To deepen your understanding, explore usage guides on:

- [Assertions Reference](../api-reference/gtest-api/assertions-and-failures.md)
- [Advanced GoogleTest Topics](../docs/advanced.md#predicates)
- [Custom Assertions and Matchers](../guides/advanced-testing-patterns/custom-assertions-and-matchers.md)
- [Matchers Reference](../api-reference/gmock-api/matchers-reference.md)

---