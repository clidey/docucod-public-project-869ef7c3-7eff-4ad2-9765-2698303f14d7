---
title: "Extensibility and Customization"
description: "Discover extension points and strategies for adapting the framework—custom assertions, actions, and platform hooks—so you can tailor GoogleTest and GoogleMock to your project's unique requirements."
---

# Extensibility and Customization

Discover how to tailor GoogleTest and GoogleMock to fit your project-specific needs by using extension points such as custom assertions, actions, and platform-specific hooks. This guide helps you unlock the full potential of the framework by adapting its behavior, output, and integration to your test environment.

---

## Custom Assertions and Predicate Formatters

GoogleTest enables the creation of custom assertions to express complex conditions clearly and provide informative failure messages. Custom assertions can return an `AssertionResult` object, which carries success or failure status along with detailed messages.

### Writing a Custom Assertion

Instead of using `EXPECT_TRUE()` on a boolean function, define a function returning `::testing::AssertionResult` to produce meaningful diagnostics. For example:

```cpp
::testing::AssertionResult IsEven(int n) {
  if ((n % 2) == 0) {
    return ::testing::AssertionSuccess() << n << " is even";
  } else {
    return ::testing::AssertionFailure() << n << " is odd";
  }
}

TEST(NumberTest, IsEven) {
  EXPECT_TRUE(IsEven(4));  // Succeeds
  EXPECT_TRUE(IsEven(3));  // Fails with message "3 is odd"
}
```

This pattern improves test readability and failure transparency.

### Using Predicate-Formatters for Complex Assertions

For assertions requiring multiple inputs or formatted messages, predicate-formatters provide a signature that receives expressions and values, facilitating detailed failure reporting:

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* m_expr,
                                             const char* n_expr,
                                             int m, int n) {
  if (/* logic to check if m and n are mutually prime */) {
    return testing::AssertionSuccess();
  }
  return testing::AssertionFailure() << m_expr << " and " << n_expr
      << " (" << m << " and " << n << ") are not mutually prime.";
}

TEST(MathTest, AssertMutuallyPrime) {
  EXPECT_PRED_FORMAT2(AssertMutuallyPrime, 3, 4);  // Succeeds
  EXPECT_PRED_FORMAT2(AssertMutuallyPrime, 4, 10); // Fails with detailed message
}
```

Use these to deliver precise and actionable test diagnostics.

---

## Custom Actions in GoogleMock

GoogleMock's Actions API lets you specify custom behavior for mock functions beyond return values or argument changes. They are essential to simulate side effects, sequence operations, or perform callbacks.

### Defining and Using Actions

Custom actions can be defined by inheriting from `ActionInterface` or by using action macros like `Invoke` and composite actions like `DoAll`:

```cpp
using ::testing::Invoke;
class MyMock {
public:
  MOCK_METHOD(int, Compute, (int a, int b), ());
};

int Add(int a, int b) { return a + b; }

TEST(MyMockTest, CustomActionExample) {
  MyMock mock;
  EXPECT_CALL(mock, Compute).WillOnce(Invoke(Add));

  EXPECT_EQ(mock.Compute(3, 4), 7);
}
```

### Combining Actions

Use `DoAll()` to combine multiple actions executed in sequence:

```cpp
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Return;

EXPECT_CALL(mock, Process(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

This sets the first pointer argument to `5` and returns `true`.

### Best Practices

- Use actions to simulate realistic behavior or side effects.
- For asynchronous or delayed replies, write custom actions.
- Keep custom actions focused and reusable for clarity.

---

## Platform-Specific Hooks and Customizations

GoogleTest provides hooks and macros to adapt to various platforms and integrate with custom environment constraints.

### Custom Stack Trace Retrieval

By defining the macro `GTEST_OS_STACK_TRACE_GETTER_`, you can provide your own implementation of stack trace retrieval, which helps in environments where the default method does not work or needs enhancement.

### Custom Temporary Directory

Override `GTEST_CUSTOM_TEMPDIR_FUNCTION_` to specify a custom location for temporary files used during testing, such as output files or death test IPC resources.

### Custom Logging and Synchronization

GoogleTest can be configured to use your project's logging and threading primitives through:

- Defining `GTEST_LOG_(severity)` to integrate with your logging library.
- Providing `Mutex`, `ThreadLocal`, and `Notification` synchronized implementations by enabling `GTEST_HAS_MUTEX_AND_THREAD_LOCAL_` and `GTEST_HAS_NOTIFICATION_`.

This is beneficial when embedding GoogleTest in embedded or constrained environments.

---

## Dynamic Test Registration

Besides macros like `TEST()` and `TEST_F()`, GoogleTest lets you programmatically register tests at runtime with `testing::RegisterTest()`. This is powerful when you need to generate tests based on runtime data or configuration files.

Example:

```cpp
class MyFixture : public ::testing::Test {
  ...
};

class MyTest : public MyFixture {
 public:
  explicit MyTest(int v) : value_(v) {}
  void TestBody() override {
    EXPECT_GT(value_, 0);
  }
 private:
  int value_;
};

void RegisterMyTests(const std::vector<int>& values) {
  for (int v : values) {
    ::testing::RegisterTest(
      "MyFixture", ("Test" + std::to_string(v)).c_str(), nullptr,
      std::to_string(v).c_str(), __FILE__, __LINE__, [v]() -> MyFixture* {
        return new MyTest(v);
      });
  }
}

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  RegisterMyTests({1, 2, 3});
  return RUN_ALL_TESTS();
}
```

Make sure to register tests before calling `RUN_ALL_TESTS()`, or behavior is undefined.

---

## Extending Test Reporting via Event Listeners

GoogleTest's event listener API empowers you to customize test output and responses by receiving notifications about the test lifecycle.

### Creating an Event Listener

Subclass `testing::TestEventListener` or `testing::EmptyTestEventListener` and override the methods corresponding to events you want to handle:

- `OnTestProgramStart`
- `OnTestIterationStart`
- `OnEnvironmentsSetUpStart`
- `OnTestSuiteStart`
- `OnTestStart`
- `OnTestPartResult`
- `OnTestEnd`
- `OnTestSuiteEnd`
- `OnEnvironmentsTearDownEnd`
- `OnTestProgramEnd`

Example minimal listener:

```cpp
class MinimalistListener : public testing::EmptyTestEventListener {
 public:
  void OnTestStart(const testing::TestInfo& test_info) override {
    std::cout << "Starting test " << test_info.test_suite_name() << "." << test_info.name() << std::endl;
  }
  void OnTestEnd(const testing::TestInfo& test_info) override {
    std::cout << "Finished test " << test_info.test_suite_name() << "." << test_info.name() << std::endl;
  }
};
```

### Using Event Listeners

Add the listener to your test program before tests run:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  auto& listeners = testing::UnitTest::GetInstance()->listeners();
  delete listeners.Release(listeners.default_result_printer());
  listeners.Append(new MinimalistListener);
  return RUN_ALL_TESTS();
}
```

This example replaces the default console reporter with a custom one.

### Ordering and Ownership

- New listeners are appended and owned by GoogleTest.
- Event order for `On*Start` is forward; for `On*End` is reverse.
- Adding multiple listeners allows you to layer output or react concurrently to events.

### Limitations

- Don't generate failures inside `OnTestPartResult()` to avoid recursion.
- Place listeners that do not generate failures before those that can.

---

## Troubleshooting Extensions and Customizations

- Ensure your custom assertions or actions provide clear failure messages.
- Avoid runtime registration after the test run has started.
- If extending event listeners, detach default printers if necessary to avoid output clashes.
- When overriding platform hooks, confirm compatibility with your target environment and thread safety requirements.

---

For more detailed examples and guidance, please explore the following sections in this documentation:

- [Writing Clear and Effective Assertions](../guides/integration-and-best-practices/writing-effective-assertions.md)
- [Parameterized and Type-Parameterized Tests](../guides/advanced-testing-strategies/parameterized-and-typed-tests.md)
- [Mocking C++ Objects with GoogleMock](../guides/advanced-testing-strategies/mocking-with-googlemock.md)
- [Death Tests and Failure Handling](../guides/advanced-testing-strategies/death-and-failure-tests.md)

---

Taking full advantage of GoogleTest and GoogleMock extension points empowers you to create robust, maintainable, and expressive tests tailored precisely to your project's needs.