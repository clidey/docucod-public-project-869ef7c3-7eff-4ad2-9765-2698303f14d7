---
title: "Cardinality and Mock Strictness Controls"
description: "Explore how cardinality defines expected call counts on mocks, and how strictness wrappers provide precise control over test validation rigor. Master these features to write robust, trustworthy unit tests."
---

# Cardinality and Mock Strictness Controls

Explore how cardinality defines expected call counts on mocks, and how strictness wrappers provide precise control over test validation rigor. Master these features to write robust, trustworthy unit tests.

---

## Understanding Cardinality: Defining Expected Call Counts

When writing tests using GoogleMock, it's essential to control and specify **how many times** a mock method is expected to be called. This concept is called *cardinality*, and it ensures that your mocks align with the intended behavior of your code.

### What Is Cardinality?

Cardinality lets you express expectations about the number of times a mock method should be called during a test. It provides flexibility beyond just saying "expect exactly one call" — you can specify ranges, minimums, maximums, or even unconstrained behavior.

### Built-in Cardinalities

GoogleMock comes with several built-in cardinality definitions, available as functions in the `testing` namespace:

| Cardinality          | Meaning                                                |
|----------------------|---------------------------------------------------------|
| `AnyNumber()`        | The function can be called any number of times (0 or more). |
| `AtLeast(n)`         | The function must be called at least *n* times.          |
| `AtMost(n)`          | The function can be called at most *n* times.            |
| `Between(m, n)`      | The function must be called *between* *m* and *n* times inclusively. |
| `Exactly(n)`         | The function must be called *exactly* *n* times. If *n* is 0, the call should never happen. |

### Specifying Cardinality in Your Tests

Cardinality is most commonly used with the `Times()` clause in an `EXPECT_CALL` statement:

```cpp
using ::testing::AtLeast;
using ::testing::Exactly;

EXPECT_CALL(mock_object, SomeMethod())
    .Times(AtLeast(1));  // Expect at least one call

EXPECT_CALL(mock_object, OtherMethod())
    .Times(Exactly(3));  // Expect exactly three calls
```

If you omit the `Times()` clause, GoogleMock will infer the cardinality based on whether you've provided `WillOnce` or `WillRepeatedly` clauses:

- No `WillOnce` or `WillRepeatedly` &rarr; `Times(1)` is inferred.
- *n* `WillOnce` clauses and no `WillRepeatedly` &rarr; `Times(n)` inferred.
- *n* `WillOnce` clauses and one `WillRepeatedly` clause &rarr; `Times(AtLeast(n))` inferred.


### Example: Checking Call Counts with Cardinality

```cpp
#include <gmock/gmock.h>
using ::testing::Exactly;
using ::testing::AtLeast;

MockFoo foo;

EXPECT_CALL(foo, Bar())
    .Times(Exactly(2));  // Bar() must be called twice

foo.Bar();
foo.Bar();
```

If `foo.Bar()` is called fewer or more times than two, the test will fail, providing a clear message about the mismatch.

### Adding Custom Cardinalities

For advanced use cases, you can define your own cardinalities by implementing the `CardinalityInterface`. This allows you to create conditions such as "called an even number of times" or other domain-specific requirements.

Example:

```cpp
class EvenNumberCardinality : public testing::CardinalityInterface {
 public:
  bool IsSatisfiedByCallCount(int count) const override {
    return count % 2 == 0;
  }
  bool IsSaturatedByCallCount(int) const override { return false; }
  void DescribeTo(std::ostream* os) const override { *os << "called even number of times"; }
};

// Factory function
testing::Cardinality EvenNumber() {
  return testing::Cardinality(new EvenNumberCardinality);
}

// Usage:
EXPECT_CALL(mock, Method()).Times(EvenNumber());
```

---

## Mock Strictness Wrappers: Controlling Test Rigor

Aside from cardinality, GoogleMock provides specialized wrappers that adjust the strictness of your mock objects with respect to *uninteresting calls* — method calls that happen on mocks but were not explicitly expected.

### The Three Levels of Mock Strictness

1. **NaggyMock (Default Mock)**
   - This is GoogleMock's default mock behavior.
   - It warns (but does not fail) when an uninteresting call occurs.

2. **NiceMock**
   - Suppresses warnings about uninteresting calls.
   - Useful when you want to focus only on calls you care about without distraction.

3. **StrictMock**
   - Treats uninteresting calls as **test failures**.
   - Enforces the most rigorous validation.

### How to Use Strictness Wrappers

You can easily make a mock object nice or strict by wrapping the mock class in the corresponding template:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;   // Suppresses warnings on unexpected calls
StrictMock<MockFoo> strict_mock; // Fails tests on unexpected calls
```

These wrappers inherit from the original mock, so you use them as if they were normal mocks.

### When to Use Each Wrapping

- Use **StrictMock** when you want to ensure your code only calls the mock methods you have explicitly expected. This prevents sneaky bugs and enforces strict contracts around interactions.
- Use **NiceMock** when you want to ignore unrelated method calls on a mock to avoid noisy warnings.
- Use the default (NaggyMock) when you want to be warned about unexpected calls but not have them fail your tests.

### Important Considerations

- Strictness wrappers affect *uninteresting* calls only (calls to methods without expectations). They **do not** affect unexpected calls (calls to methods with expectations but with argument mismatches), which are always errors.
- Wrapping a mock in `NiceMock` or `StrictMock` only works correctly if the mock methods are defined with the `MOCK_METHOD` macro *directly* in the class. If the mock methods are inherited from base classes, these wrappers may not affect their behavior.
- Use **strict mocks sparingly**. Overusing strict mocks can make your tests brittle and require excessive updates when the implementation changes without changing the contract.

---

## Practical User Workflows

### Setting Expected Call Counts with Cardinality

1. Decide how many times your mock method should be called (exactly, at least, at most, or between a range).
2. Use the `Times()` clause with one of the cardinality helpers:

```cpp
EXPECT_CALL(mock_obj, Func())
    .Times(AtLeast(2));
```

3. If you omit `Times()`, understand the default inference rules from actions.

### Adjusting Strictness for Your Mock Objects

Wrap your mock object type in strictness wrappers as needed:

```cpp
// Suppress warnings
NiceMock<MockFoo> mock;

// Enforce strict call expectations
StrictMock<MockFoo> strict_mock;
```

### Combining Cardinality and Strictness

You can control both **how many times** and **how strictly** calls are validated:

```cpp
StrictMock<MockFoo> mock;
EXPECT_CALL(mock, Func()).Times(Exactly(3));
```

This combination enforces exactly three calls, and treats all other mock method calls as errors.

---

## Troubleshooting and Best Practices

- **Ignoring cardinality leads to silent errors.** Always specify `Times()` or understand GoogleMock's default cardinality inference.
- **Overly strict cardinality can break tests unnecessarily.** Use flexible cardinalities like `AtLeast()` or `Between()` where appropriate.
- **Remember to set expectations before exercising mocks.** GoogleMock expects `EXPECT_CALL()` to be called before the mock methods.
- **Beware of unintentional uninteresting calls.** Use `NiceMock` when these calls are acceptable.
- **Avoid mixing `NiceMock` and `StrictMock` nested wrappers.** This is unsupported.
- **If you receive warnings or failures about uninteresting calls, review your expectations and strictness settings.**

---

## Summary Diagram: How Cardinality and Strictness Interact

```mermaid
flowchart TD
  Start([Start Test]) --> SetupMocks[Setup Mock Objects]
  SetupMocks --> SetExpectations{Are Expectations Set?}
  SetExpectations -->|No| DefaultCardinality[Default Cardinality: Times(1)]
  SetExpectations -->|Yes| CustomCardinality[Custom Cardinality with Times()]

  CustomCardinality & DefaultCardinality --> ExerciseMocks[Exercise Code Under Test]

  ExerciseMocks --> ValidateCalls{Calls Match Cardinalities?}
  ValidateCalls -->|No| ReportFailure[Report Call Mismatch Failure]
  ValidateCalls -->|Yes| ValidateUninterestingCalls{Any Uninteresting Calls?}

  ValidateUninterestingCalls -->|No| Pass[Tests Pass]

  ValidateUninterestingCalls -->|Yes| StrictnessCheck[Mock Strictness?]
  StrictnessCheck -->|NiceMock| SuppressWarning[Suppress Warning]
  StrictnessCheck -->|NaggyMock(Default)| ShowWarning[Show Warning]
  StrictnessCheck -->|StrictMock| Fail[Fail Test]

  SuppressWarning --> Pass
  ShowWarning --> Pass
  Fail --> ReportFailure
```
```

---

## Additional Resources

- [EXPECT_CALL Times Clause](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL.Times) - Detailed cardinality usage.
- [NiceMock, StrictMock, and NaggyMock](https://google.github.io/googletest/reference/mocking.html#NiceStrictNaggy) - Understanding uninteresting call behaviors.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Beginner-friendly introduction.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) - Quick syntax reference.

---