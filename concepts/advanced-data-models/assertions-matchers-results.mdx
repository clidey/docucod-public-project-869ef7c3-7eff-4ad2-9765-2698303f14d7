---
title: "Assertions, Matchers, and Assertion Results"
description: "Examine the rich ecosystem of assertions and matchers, as well as how assertion results are represented, categorized, and reported. Appreciate the flexibility offered for both built-in and user-defined checks."
---

# Assertions, Matchers, and Assertion Results

Explore the comprehensive ecosystem of assertions and matchers in GoogleTest and GoogleMock, focusing on how assertion results are generated, categorized, and reported. Understand the flexibility of built-in and user-defined checks, empowering you to write clear and meaningful tests.

---

## Understanding Assertions

### What Are Assertions?
Assertions are statements that verify conditions in your code. They indicate test success or failure based on Boolean expressions or custom predicates. GoogleTest provides two types of assertion macros:

- `EXPECT_*`: Generate non-fatal failures and allow the test to continue.
- `ASSERT_*`: Generate fatal failures and abort the current function.

For example:

```cpp
EXPECT_EQ(value, expected) << "Value did not match expected";
ASSERT_TRUE(condition) << "Condition is false";
```

Note that you can stream custom failure messages using `<<` operators for richer diagnostics.

### Assertion Result Types
- **Success**: Condition holds true.
- **Non-fatal Failure**: Condition fails, but test continues.
- **Fatal Failure**: Condition fails and aborts current function.

Use `ASSERT_*` when further execution doesn't make sense on failure; otherwise, prefer `EXPECT_*` for more comprehensive reports.

### Special Assertions
- `SUCCEED()`: Explicit success indication, primarily documentary.
- `FAIL()`: Triggers a fatal failure; use only in `void` functions.
- `ADD_FAILURE()`: Triggers a non-fatal failure.
- `GTEST_SKIP()`: Skips the current test with an optional message.

---

## Matchers: Specifying What to Expect

Matchers are predicates used inside assertions or mock expectations to specify precise argument constraints.

### Built-in Matchers
GoogleMock provides a variety of matchers for common types:

- Wildcard: `_` (matches anything)
- Comparison: `Eq()`, `Ne()`, `Lt()`, `Gt()`, `Ge()`, `Le()`
- String: `StartsWith()`, `EndsWith()`, `HasSubstr()`, `MatchesRegex()`
- Container: `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`
- Pointer: `IsNull()`, `NotNull()`, `Pointee()`

### Examples
```cpp
EXPECT_CALL(mock, Foo(Eq(5)));             // Argument must equal 5
EXPECT_CALL(mock, Bar(_));                  // Argument can be anything
EXPECT_CALL(mock, Baz(Ge(100)));            // Argument must be >= 100
EXPECT_THAT(str, StartsWith("Hello"));   // Checks prefix
EXPECT_THAT(vec, ElementsAre(1, _, 3));    // Container match
```

### Using Custom Matchers
You can create custom matchers via:

- `MATCHER` macros for quick definitions.
- Defining classes with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` for more control.

Example:
```cpp
MATCHER(IsEven, "") { return arg % 2 == 0; }
EXPECT_CALL(mock, Foo(IsEven()));
```

### Combining and Composing Matchers
Matchers can be composed to express complex conditions:

- `AllOf(m1, m2)`: Matches if both predicates hold.
- `AnyOf(m1, m2)`: Matches if either predicate holds.
- `Not(m)`: Negation of matcher `m`.
- `With(multi_arg_matcher)`: Matches all arguments together.

Example:
```cpp
EXPECT_CALL(mock, Foo(_)).With(AllOf(Args<0,1>(Lt()), Args<1>(Gt(5))));
```

### Matcher Polymorphism and Casting
Matchers are statically typed. Use `SafeMatcherCast<T>(m)` to coerce to compatible types safely.

### Matchers and Assertions
Matchers integrate with GoogleTest's `EXPECT_THAT` and `ASSERT_THAT` for expressive assertions:

```cpp
EXPECT_THAT(value, Ge(10));
EXPECT_THAT(container, ElementsAre(1, 2, 3));
```

---

## Assertion Results and Reporting

### Result Categories
- **Explicit Success**: Generated by `SUCCEED()`, but does not mark test success alone.
- **Failure**: Either fatal or non-fatal failures, accompanied by detailed diagnostic messages.

### Verbose Failure Messages
GoogleTest prints:

- Location (file and line) of failure
- Expected vs actual values
- Matcher descriptions
- Custom user messages provided via `<<`

### Handling Complex Conditions
Use predicate assertions for expressive checks and clearer messages:

- `EXPECT_PRED*` for predicates returning `bool`.
- `EXPECT_PRED_FORMAT*` for predicates returning `AssertionResult` with custom messages.

Example:
```cpp
bool IsPrime(int n) { ... }
EXPECT_PRED1(IsPrime, value);
```

### Controlling Output Verbosity
Use command-line flags like `--gmock_verbose=info|warning|error` to adjust how much GoogleMock prints about calls and failures.

---

## Assertions and Matchers with Mock Objects

### Setting Expectations (EXPECT_CALL)
Use `EXPECT_CALL()` to set expectations on mock methods with optional clauses:

```cpp
EXPECT_CALL(mock_object, Method(matchers))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action)
    .InSequence(sequences)
    .After(expectations)
    .RetiresOnSaturation();
```

- **Matchers** specify expected argument properties.
- **Times()** defines call count constraints.
- **WillOnce() / WillRepeatedly()** specify mock behavior.
- **InSequence() / After()** define call ordering.
- **RetiresOnSaturation()** makes expectations inactive once saturated.

### Default Actions and ON_CALL
`ON_CALL()` specifies default mock method behavior **without** setting call expectations:

```cpp
ON_CALL(mock_object, Method(matchers))
    .WillByDefault(action);
```

`EXPECT_CALL` takes precedence over `ON_CALL` for matched calls.

### Understanding Call Types
- **Uninteresting Call:** No expectations set; allowed by default, may print warnings.
- **Unexpected Call:** Arguments don’t match any expectation; treated as failure.

Use `NiceMock` to suppress warnings on uninteresting calls, or `StrictMock` to make them errors.

### Common Usage Patterns
- Start with broad `EXPECT_CALL(...).Times(AnyNumber())` for catch-all.
- Specify more specific expectations last.
- Use sequences or `After` clauses for relative ordering.

### Troubleshooting Common Issues
- Verify expectations are set **before** exercising mocks.
- Avoid duplicate or conflicting expectations.
- Use `RetiresOnSaturation()` to avoid “sticky” expectation errors.

---

## Best Practices

- Use `EXPECT_CALL` only to assert intended interactions.
- Use `ON_CALL` to set behavior for unspecified calls.
- Prefer `EXPECT_*` assertions unless failure must abort.
- Use custom matchers for complex argument validation.
- Avoid over-specifying, which leads to brittle tests.
- Use sequences to control order only when needed.
- Employ verbose logging (`--gmock_verbose=info`) for debugging.

---

## Additional Resources

- [Assertions Reference](reference/assertions.md) – Comprehensive list of assertion macros.
- [Matchers Reference](reference/matchers.md) – Detailed descriptions of built-in matchers.
- [Mocking Reference](docs/reference/mocking.md) – APIs for mocking, expectations, and behaviors.
- [gMock for Dummies](docs/gmock_for_dummies.md) – Beginner guide to mocking in C++.
- [gMock Cookbook](docs/gmock_cook_book.md) – Recipes for advanced mocking techniques.

---

## Summary
This page explores the diverse set of assertions and matchers available in GoogleTest and GoogleMock, detailing how assertion results are generated, explained, and reported. It clarifies how to specify precise verification conditions using matchers and how to manage mock expectations and behaviors effectively.

---

<AccordionGroup title="Key Concepts Overview">
<Accordion title="Assertions and Failure Types">
Assertions validate code behavior. Use `EXPECT_*` (non-fatal) or `ASSERT_*` (fatal) variants appropriately to signal failure severity.
</Accordion>
<Accordion title="Matchers">
Matchers specify argument constraints for assertions and mock expectations, supporting composition and custom definitions.
</Accordion>
<Accordion title="Mock Expectations and Default Behavior">
Set expectations with `EXPECT_CALL()` to verify method calls, and specify default behavior with `ON_CALL()`. Use sequences and ordering to control call order.
</Accordion>
<Accordion title="Assertion Results Reporting">
GoogleTest provides clear messages with failures, including detailed diagnostics, expected/actual values, and custom messages.
</Accordion>
</AccordionGroup>

<Tip>
Remember to set `EXPECT_CALL()` expectations before exercising mocks. Use `RetiresOnSaturation()` to avoid sticky expectation errors where calls exceed expected counts.
</Tip>

<Tip>
Utilize `--gmock_verbose=info` during debugging to gain insight into mock call matching and detailed messages.
</Tip>

<Warning>
Do not over-specify expectations; write only those necessary to verify the contract, keeping tests robust and maintainable.
</Warning>

---

For more detailed exploration of related topics like mock methods, expectations, and advanced matchers, visit the [Mocking Reference](docs/reference/mocking.md), [Matchers Reference](reference/matchers.md), and [Assertions Reference](reference/assertions.md).

