---
title: "Actions and Extensibility for Mock Behaviors"
description: "Explore how actions define custom responses for mocked function calls, including variadic actions, templates, and user-defined behaviors. This page covers key extensibility points for controlling complex side effects or forwarding calls."
---

# Actions and Extensibility for Mock Behaviors

GoogleMock (gMock) empowers users to specify what a mocked function should do when called by defining **actions**. These actions form the behavior part of an expectation, controlling return values, side effects, or forwarding calls to custom logic. This page explores how actions work, how to leverage built-in actions, create variadic and template-based actions, and extend gMock with user-defined behaviors to control complex mock interactions.

---

## Understanding Actions: Defining Mock Function Responses

When you use gMock to define expectations on mock methods, the core question is:

> _What should this mocked method do when invoked?_ 

You answer this by specifying **actions**. Actions are behaviors attached to expectations — they determine the return value, modify arguments, invoke callbacks, or execute user-defined code.

### Default Actions and Overriding Behavior

- By default, for built-in types, mock methods return zero, `false`, `nullptr`, or default-constructed value.
- To override this, use:
  - `ON_CALL(mock, Method(...)).WillByDefault(action)` to set the default action if an expectation is not set.
  - `EXPECT_CALL(mock, Method(...)).WillOnce(action)` or `.WillRepeatedly(action)` to set explicit call-time behaviors and expectations.

### Built-in Action Categories

**Return Values:** Actions like `Return(value)`, `ReturnRef(variable)`, and `ReturnNew<T>(...)` let you specify what the mock method returns.

**Side Effects:** Actions such as `SetArgPointee<N>(value)`, `Assign(&var, val)`, or `Throw(exception)` let you change output arguments, set variables, or throw exceptions as side effects.

**Invoke Callables:** Use `Invoke(function)`, `Invoke(object_ptr, &Class::Method)`, or `InvokeWithoutArgs(function)` to forward calls to real functions, methods, or lambdas.

**Composite Actions:** `DoAll(a1, a2, ..., an)` allows executing multiple actions in sequence, returning the result of the last.

### Example: Changing an Output Argument and Return Value

```cpp
using ::testing::DoAll;
using ::testing::Return;
using ::testing::SetArgPointee;

EXPECT_CALL(mock, MutateInt(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

This sets the first argument to 5 and then returns `true`.

---

## Variadic and Template Actions: Handling Complex Scenarios

GoogleMock supports advanced extensibility by allowing actions defined as variadic and template-based constructs. These help you write reusable, parameterized actions for complex behaviors.

### ACTION, ACTION_P, and ACTION_TEMPLATE Macros

- `ACTION(name)` defines an action with no parameters.
- `ACTION_P(name, param)` defines an action with one parameter.
- `ACTION_Pk(name, p1, ..., pk)` supports multiple parameters.
- `ACTION_TEMPLATE(name, template_params, value_params)` allows defining actions with explicit template parameters and value parameters.

These macros enable you to access mock call arguments as `arg0`, `arg1`, ... and define behaviors using your own code. For example:

```cpp
ACTION_P(Plus, n) { return arg0 + n; }
...
EXPECT_CALL(mock, Foo(_)).WillOnce(Plus(5)); // Returns arg0 + 5
```

### Benefits of Template Actions

- Explicit template parameters allow defining highly generic actions.
- You can reuse these actions across various mock methods and argument types.
- Enables fine-grained control when built-in actions are insufficient.

---

## Writing Custom Actions: Extending Mock Behaviors

When built-in actions do not fit your needs, you can define custom actions to simulate complex side effects or sophisticated call forwarding.

### Using Callables as Actions

Any callable — function, functor, lambda — can be used as an action. The callable's signature must be compatible with the mocked method's signature, allowing you to write concise, expressive mock behaviors.

Example with a lambda:

```cpp
EXPECT_CALL(mock, DoWork(_))
    .WillOnce([](int x) { return x * 2; });
```

This doubles the input argument as the mock's response.

### Pre-Bound Argument Functions: Adapting Signatures

Your custom functions may have differing signatures from the mocked function. gMock provides helpers like `WithArgs<N1, N2>(action)`, `WithArg<N>(action)`, and `WithoutArgs(action)` to select or discard arguments before invoking your action.

Example:

```cpp
EXPECT_CALL(mock, Foo(_, _, _))
    .WillOnce(WithArgs<0, 2>(Invoke(&MyFunction)));
```

This calls `MyFunction` with the 1st and 3rd arguments of `Foo`.

### Using InvokeArgument for Callback Arguments

If your mocked function receives a callable as an argument (for example, a callback), `InvokeArgument<N>(args...)` invokes that callable, passing the specified `args`. Wrap arguments in `std::ref()` to pass by reference if needed.

Example:

```cpp
EXPECT_CALL(mock, DoThis(_, _))
    .WillOnce(InvokeArgument<1>(5));
```

This invokes the second argument (assumed callable) with 5.

### Combining Multiple Actions

Use `DoAll(a1, a2, ..., an)` to chain several actions executed sequentially when the mock method is called. The return value of the last action is used as the function's return.

Example:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(DoAll(SaveArg<0>(&saved_var), Return(true)));
```

Here, the first argument is saved, and `true` is returned.

---

## Best Practices and Tips for Using Actions

- Prefer `ON_CALL` for specifying default mock behavior shared among tests; use `EXPECT_CALL` only when you want to validate calls.
- When returning references, use `ReturnRef(variable)` instead of `Return(variable)`.
- Use `ReturnPointee(pointer)` to return live values referenced by pointers at call time.
- Avoid evaluating expressions with side effects inside `Return()`; they are evaluated only once when setting the expectation.
- When `SetArgPointee` is used to modify an output argument, if the method also returns a value, combine it with `Return()` using `DoAll`.
- Use `RetiresOnSaturation()` with expectations that must deactivate on reaching their call count.
- To mock complex behaviors, write custom callables or actions rather than overloading expectations.

---

## Troubleshooting Common Action Issues

### Actions Running Out

If you specify too few `WillOnce` actions for the expected calls, gMock issues warnings when calls exceed the action list. Use `WillRepeatedly` to define behavior after `WillOnce`s are exhausted.

### Conflicting Return Types Errors

Be sure your `SetArgPointee` actions are accompanied by a return value (often chained with `Return()`) because `SetArgPointee` only does side effects and does not return a value.

### Unexpected Calls and Default Actions

Calls that do not match any `EXPECT_CALL` will trigger failures unless handled by default actions via `ON_CALL`. Use `NiceMock` to suppress uninteresting call warnings, or `StrictMock` to fail on unexpected calls.

---

## Summary

Actions in gMock define how mocked methods respond when called, enabling precise control over return values, side effects, and call forwarding. Built-in actions cover the majority of common needs, but gMock supports defining custom actions with lambdas, functors, macros, and templates to handle complex scenarios including variadic templates and user-defined behaviors. Advanced users can combine multiple actions, adapt arguments, and invoke callable arguments for sophisticated mocking strategies.

---

## Recommended Next Steps

- Explore the [Actions Reference](reference/actions.md) for full details on available built-in actions.
- Review [gMock Cookbook - Using Actions](docs/gmock_cook_book.md#using-actions) for practical recipes.
- Study [Mock Object Construction](api-reference/gmock-api/mock-object-construction.md) and [Defining Expectations and Actions](api-reference/gmock-api/defining-expectations-actions.md) for deep integration.
- Learn about [Matchers and Argument Selection](reference/matchers.md) to combine with actions effectively.

---

## Helpful Links

- [gMock for Dummies](docs/gmock_for_dummies.md) - introductory guide to mocking
- [Mocking Reference](reference/mocking.md) - core macros and classes
- [gMock Cookbook](docs/gmock_cook_book.md) - in-depth usage recipes
- [Using Parameterized Testing](concepts/advanced-mechanisms/parameterized-testing.md) - for template and variadic tests

---