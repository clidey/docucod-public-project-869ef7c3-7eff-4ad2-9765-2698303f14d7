---
title: "Assertions and Matchers"
description: "Examine the matcher and assertion system, including built-in and user-defined matchers. Understand how flexible checks express correctness, and how these are extensible for custom types and logic."
---

# Assertions and Matchers

Explore the core concepts of GoogleTest's assertion and matcher system, which drive the expression of correctness in unit tests. This guide reveals how GoogleTest uses flexible checks—both built-in and custom—to validate program behavior with clarity and precision.

---

## Introduction

Assertions and matchers form the backbone of test verification in GoogleTest. Through assertions, you specify the expected correctness criteria for your code under test. Matchers act as flexible predicates that describe the properties your test values should satisfy, enabling expressive, readable, and robust tests.

This page walks you through these concepts, explaining how to define conditions, utilize built-in matchers, compose complex assertions, and extend the framework with custom matchers.


## 1. Assertions: Verifying Test Conditions

### What are Assertions?

Assertions are statements in your test code that check if a condition holds true. When an assertion fails, it reports a failure in the test, helping catch bugs early.

Example:
```cpp
EXPECT_EQ(actual_value, expected_value);
```
This asserts that `actual_value` equals `expected_value`.

### Types of Assertions

- **Nonfatal Assertions (`EXPECT_`)**: On failure, report the error but continue the test.
- **Fatal Assertions (`ASSERT_`)**: On failure, abort the current test function immediately.

### Explicit Assertion Controls

Sometimes you want to explicitly succeed or fail within a test. GoogleTest provides special assertions:

```cpp
SUCCEED();  // Marks a passed test point (rarely used).
FAIL();     // Immediately fails the test.
ADD_FAILURE(); // Records a failure but continues.
```


## 2. Matchers: Expressing Flexible Conditions

### What are Matchers?

Matchers let you write rich predicates about expected values in tests. They can validate simple equality, inequalities, substrings, custom logic, and even structural properties of containers.

Matchers can be used in assertions like:

```cpp
EXPECT_THAT(value, matcher);
```

For example:
```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(numbers, ElementsAre(1, 2, 3));
```

### Built-In Matchers

GoogleTest offers numerous built-in matchers:

| Matcher               | Description                                      |
|-----------------------|------------------------------------------------|
| `_`                   | Wildcard: matches any argument                   |
| `Eq(val)`             | Equals `val`                                    |
| `Ne(val)`             | Not equal to `val`                              |
| `Lt(val)`, `Le(val)`  | Less than or equal to                            |
| `Gt(val)`, `Ge(val)`  | Greater than or equal to                         |
| `HasSubstr(str)`      | String contains substring `str`                  |
| `StartsWith(str)`     | String starts with                                |
| `EndsWith(str)`       | String ends with                                  |
| `Not(matcher)`        | Negation of matcher                               |
| `AllOf(...)`          | Logical AND of multiple matchers                  |
| `AnyOf(...)`          | Logical OR of multiple matchers                   |
| `ElementsAre(...)`    | Matches container elements in order               |
| `UnorderedElementsAre(...)` | Matches container elements in any order     |
| `Pointee(matcher)`    | Matches pointer value pointed to                   |

### Composing Matchers

Matchers can be combined logically:

```cpp
EXPECT_THAT(value, AllOf(Gt(5), Ne(7)));
EXPECT_THAT(container, AnyOf(ElementsAre(1, 2, 3), ElementsAre(4)));
```

### Matchers must be Pure Functions

Matchers should never have side effects or depend on external state, ensuring predictable test results.


## 3. Assertion Macros with Matchers

- `EXPECT_THAT(value, matcher)` — Nonfatal assertion based on matcher evaluation.
- `ASSERT_THAT(value, matcher)` — Fatal assertion based on matcher evaluation.

These macros provide more expressive checks than traditional `EXPECT_EQ` or `EXPECT_TRUE`, able to verify complex structures and partial matches.


## 4. Writing Custom Matchers

When needed, you can craft custom matchers for domain-specific checks.

### Quick Custom Matchers with Macros

Use the `MATCHER` and `MATCHER_P` macros:

```cpp
MATCHER(IsEven, "Checks if a number is even") {
  return (arg % 2) == 0;
}

MATCHER_P(GreaterThan, value, "Checks if argument is greater than value") {
  return arg > value;
}
```

Usage:

```cpp
EXPECT_THAT(10, IsEven());
EXPECT_THAT(10, GreaterThan(5));
```

Error messages automatically incorporate descriptions.

### Advanced Custom Matchers

Define matcher classes implementing:
- `bool MatchAndExplain(arg, std::ostream*)`
- `void DescribeTo(std::ostream*)`
- `void DescribeNegationTo(std::ostream*)`

For polymorphic matchers (match multiple types), `MatchAndExplain` can be templated.


## 5. Matchers for Complex Types

### Containers

Matchers like `ElementsAre()`, `UnorderedElementsAre()`, and array versions allow fine validation of container contents.

Example:

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(map, UnorderedElementsAre(Pair("key", 42)));
```

### Matching Struct Members

Validate individual fields or properties with `Field()` and `Property()`:  

```cpp
EXPECT_THAT(obj, Field(&MyClass::member, Eq(5)));  
EXPECT_THAT(obj, Property(&MyClass::GetValue, Ge(10)));
```

### Matching Pointer Values

Matchers such as `Pointee()` check the value pointed to by a pointer, safely handling null pointers.


## 6. Common Usage Patterns and Best Practices

- Use `_` when argument values are unimportant to avoid brittle tests.
- Prefer `ON_CALL` for setting default behavior without enforcing call count.
- Use `EXPECT_CALL` to enforce expected calls, argument patterns, call counts, and call orders.
- Use `InSequence` and `Sequence` to enforce the order of expected calls.
- Combine matchers for complex argument validation, but avoid over-specifying.


## 7. Troubleshooting Matchers and Assertions

### Unmatched Calls
If a mock function call does not match any `EXPECT_CALL`, assertion failure explains which expectations were tested and why they didn’t match.

### Excessive Calls
Calling a method more times than the specified limit will produce clear failure messages with argument details.


## 8. Related Assertion Macros

GoogleTest provides traditional assertion macros alongside matcher-based ones. Some examples:

| Macro            | Description                  | When to use                          |
|------------------|------------------------------|------------------------------------|
| `EXPECT_EQ`      | Verifies equality             | Simple equality checks              |
| `EXPECT_NE`      | Verifies inequality           | Simple inequality checks            |
| `EXPECT_TRUE`    | Verifies boolean true         | Simple true condition checks       |
| `EXPECT_FALSE`   | Verifies boolean false        | Simple false condition checks      |

These macros are often simpler but less expressive than matcher-based assertions.


## 9. Summary

GoogleTest’s assertion and matcher system enables precise, readable, and maintainable verification in your tests. Matchers provide flexible conditions that range from simple value checks to complex user-defined logic, empowering expressive behavioral validation. Coupled with a rich set of assertions, they make test failures easy to understand and diagnose.


---

## References & Further Reading

- [GoogleTest Assertions Reference](../api-reference/core-apis/assertions-reference.md)
- [Using and Composing Matchers](../api-reference/mocking-apis/using-matchers.md)
- [Writing Custom Matchers Quickly](../gmock_cook_book.md#NewMatchers)
- [gMock Cookbook - Matchers Section](../gmock_cook_book.md#UsingMatchers)
- [Matchers Reference](../reference/matchers.md)


---

## Practical Tips

- When writing expectations with complex argument validation, start with broad matchers (`_`) and narrow down as needed.
- Use `EXPECT_THAT()` with matchers rather than multiple simple assertions for clear intent.
- Define custom matchers to encapsulate reusable validation logic, improving test maintainability.

---

## Glossary

- **Assertion**: A test statement requesting verification of a condition.
- **Matcher**: A predicate used to verify if a value satisfies certain criteria.
- **EXPECT_CALL**: Macro to specify and enforce an expected mock method call.
- **ON_CALL**: Macro to specify default behavior for mock methods without expectation.


---

## Example: Using Matchers in a Test

```cpp
#include <gmock/gmock.h>
using ::testing::_;
using ::testing::StartsWith;
using ::testing::ElementsAre;

// Mock class
class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), ());
  MOCK_METHOD(std::vector<int>, GetRecords, (), ());
};

TEST(DatabaseTest, ConnectAndRetrieve) {
  MockDatabase db;

  ON_CALL(db, Connect(_))
      .WillByDefault(testing::Return(true));

  EXPECT_CALL(db, Connect(StartsWith("http://")));
  EXPECT_CALL(db, GetRecords())
      .WillOnce(testing::Return(std::vector<int>{1, 2, 3}))
      .WillRepeatedly(testing::Return(std::vector<int>{}));

  EXPECT_TRUE(db.Connect("http://localhost"));
  EXPECT_THAT(db.GetRecords(), ElementsAre(1, 2, 3));
}
```


---