---
title: "Mock Object Model"
description: "Discover how GoogleMock represents mock objects, including the use of the MOCK_METHOD macro and method signature specification. Explore the lifecycle, responsibilities, and best practices for defining and using mock objects."
---

# Mock Object Model

GoogleMock represents a mock object as a C++ class with mock methods that simulate virtual functions of the code under test. This page explains the core concepts surrounding mock objectsâ€”how they are defined, tracked, behave during their lifecycle, and best practices to use them effectively.

---

## What is a Mock Object in GoogleMock?

A mock object in GoogleMock is a class instance that implements the interface of a real object, allowing tests to specify expected method calls, argument constraints, call counts, and define the behavior of those mocked methods. Instead of coding mocks manually, GoogleMock generates these mock methods using the `MOCK_METHOD` macro.

Mock objects are valuable in verifying interactions and isolating dependencies in unit tests.

---

## Defining Mock Methods with `MOCK_METHOD`

The `MOCK_METHOD` macro declares a mock method within a mock class. Its signature closely mirrors the actual method's signature but splits the declaration into three parameters plus optional qualifiers.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- `ReturnType`: The method's return type.
- `MethodName`: The method's name.
- `(Args...)`: The argument list in parentheses.
- `(Qualifiers)`: Optional method qualifiers like `const`, `override`, `noexcept`, calling conventions, and reference qualifiers.

### Example

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, Process, (const std::string& input), (override));
};
```

### Notes & Best Practices

- Always place `MOCK_METHOD` declarations in the `public:` section of your mock class, regardless of the original method's access level.
- Wrap return types or argument types containing commas (e.g., `std::pair<int, int>`) in parentheses or define type aliases.
- Use qualifiers to match the method you override precisely.

---

## Mock Object Lifecycle & Responsibilities

GoogleMock manages mock objects carefully to verify interactions and detect leaks.

### Registration and Tracking

- When an `EXPECT_CALL` or `ON_CALL` operates on a mock method, GoogleMock registers the mock object and its methods in a global registry.
- The registry tracks:
  - The first use location (file, line, and test suite name) to help identify leaks.
  - All mock methods (function mockers) owned by the mock object.

### Verification and Cleanup

- When a mock object is destructed, GoogleMock verifies all expectations were met.
- The framework reports failed or unsatisfied expectations immediately as test failures.
- Users can verify and clear expectations manually before destruction using:

  ```cpp
  Mock::VerifyAndClearExpectations(&mock_obj);
  Mock::VerifyAndClear(&mock_obj);  // Also clears default actions
  ```

- The mock object can be marked as "leakable" with:

  ```cpp
  Mock::AllowLeak(&mock_obj);
  ```

  to bypass leak detection when appropriate.

### Strictness Levels

GoogleMock classifies mock object strictness regarding uninteresting calls (calls to methods without explicit expectations):

- **NaggyMock**: Warns on uninteresting calls (default mock behavior).
- **NiceMock**: Suppresses warnings on uninteresting calls.
- **StrictMock**: Fails tests on uninteresting calls.

Use these wrappers by applying them to your mock class:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;
NaggyMock<MockFoo> naggy_foo;
StrictMock<MockFoo> strict_foo;
```

---

## Mock Method Expectations & Behaviors

While this topic is covered primarily in other guides, it is important to understand how mock methods define behavior to provide useful mock interactions.

- `EXPECT_CALL` sets expectations on mock methods including argument matching, call counts (cardinalities), order constraints, and actions.
- `ON_CALL` defines default behaviors without enforcing call expectations.
- Actions like `WillOnce` and `WillRepeatedly` specify what a mock does when called.
- Sequences and `After` clauses control call order.

---

## Practical Usage Scenario

### Defining a Mock Object

Suppose you have an interface:

```cpp
class Calculator {
 public:
  virtual ~Calculator() {}
  virtual int Add(int a, int b) = 0;
  virtual void Reset() = 0;
};
```

You define the mock class:

```cpp
#include <gmock/gmock.h>

class MockCalculator : public Calculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
  MOCK_METHOD(void, Reset, (), (override));
};
```

### Using in Tests

```cpp
TEST(CalculatorTest, AddTest) {
  MockCalculator mock_calc;

  EXPECT_CALL(mock_calc, Add(3, 4))
      .Times(1)
      .WillOnce(testing::Return(7));

  EXPECT_EQ(7, mock_calc.Add(3, 4));
}
```

### Notes

- The mock object (mock_calc) is verified automatically at destruction.
- Setting expectations before exercising the mock ensures clear failure points.

---

## Common Pitfalls & Tips

- **Not specifying expectations before use:** Always set expectations or default actions before exercising the mock; undefined behavior occurs otherwise.
- **Mock object leaks:** Leaking mocks suppress verification; use `Mock::AllowLeak()` if intentional.
- **Overlapping expectations:** Place more specific `EXPECT_CALL`s after general ones as GoogleMock matches expectations in reverse order to allow overriding.
- **Uninteresting calls:** Consider using `NiceMock` to suppress irrelevant warnings, or explicitly expect calls with `Times(AnyNumber())`.
- **Mock strictness:** Use `StrictMock` when you want to enforce no unexpected calls.

---

## Summary Diagram: Mock Object Lifecycle & Interaction

```mermaid
graph TD
  MO["Mock Object Instance"] -->|Defines| MM["Mock Methods (MOCK_METHOD)"]
  MM -->|Registers during EXPECT_CALL or ON_CALL| GR["Global Mock Registry"]
  GR -->|Tracks usage & info| LU["First Use Info & Function Mockers"]
  MO -->|Destructed| Verify["Verify Expectations"]
  Verify -->|Pass| End["Test Continues"]
  Verify -->|Fail| Report["Generate Test Failure"]
  MO -->|Explicit Verify| Verify
  MO -.->|AllowLeak() disables| LeakChk["Leak Detection"]
  MO -.->|Wrapped by| NMock[NiceMock / NaggyMock / StrictMock]
  NMock --> MO

  classDef mockobj fill:#cce5ff,stroke:#005cbf,stroke-width:2px;
  classDef registry fill:#e6f2ff,stroke:#3399ff;
  class MO,MM,NMock mockobj;
  class GR,LU,Verify,LeakChk registry;
```

---

## Additional Resources

- [MOCK_METHOD macro details](../docs/reference/mocking.md#MOCK_METHOD)
- [Using Mocks in Tests](../docs/gmock_for_dummies.md#UsingMocks)
- [Controlling Mock Strictness](../guides/advanced-testing-patterns/controlling-strictness-of-mocks.md)
- [Expectations and Actions](../concepts/mocking-behavior/expectations-actions.md)

---

## Troubleshooting

- If your mock method delegates to the real method unexpectedly, ensure the base method is virtual.
- For compiler warnings related to const parameters, know that top-level const on parameters is ignored by C++ and may trigger compiler quirks.
- Unexpected uninteresting call warnings? Consider using `NiceMock` or explicitly setting the default behavior with `ON_CALL` or a catch-all `EXPECT_CALL` with `Times(AnyNumber())`.

---

## Final Recommendations

- Always define mock methods with accurate signatures using `MOCK_METHOD`.
- Keep the mock lifecycle in mind; verify expectations before or at destruction.
- Use strictness wrappers (`NiceMock`, `NaggyMock`, `StrictMock`) to control the verbosity and enforcement level of unexpected calls.

For more examples and idiomatic usage, consult the [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md) and [gMock Cookbook](../docs/gmock_cook_book.md).
