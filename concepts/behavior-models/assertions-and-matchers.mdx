---
title: "Assertions and Matchers"
description: "Understand how assertions and matchers work to verify program behavior. Learn about the range of built-in assertions (equality, exceptions, etc.), the flexibility of matchers, and the extendable interface for custom verification logic."
---

# Assertions and Matchers

GoogleTest and GoogleMock empower you to verify program behavior through expressive assertions and flexible matchers. This page explains how to use built-in assertions to check various program states such as equality, exceptions, and failure conditions. It also details how matchers work to create precise and readable conditions for method arguments and values. Finally, we cover how you can extend this mechanism by writing custom matchers tailored to your test scenarios.

---

## Introduction to Assertions and Matchers

Assertions are the fundamental building blocks of verification in GoogleTest. They let you specify expected outcomes of your code under test. Matchers enhance assertions by providing expressive, reusable predicates that validate values and method call arguments with precision and clarity.

Together, assertions and matchers allow you to write tests that clearly communicate the expected behavior of your code and generate informative failure messages to ease debugging.

---

## Using Built-in Assertions

GoogleTest provides a comprehensive set of built-in assertion macros designed to satisfy the majority of verification needs. Assertions come in pairs:

- `ASSERT_*` macros: generate *fatal* errors and abort the current function upon failure.
- `EXPECT_*` macros: generate *nonfatal* failures and let the test continue.

You can stream custom failure messages with `<<` for additional context.

### Common Assertion Types

- **Boolean Checks:**

  ```cpp
  EXPECT_TRUE(condition);
  ASSERT_FALSE(flag);
  ```

- **Equality Comparisons:**

  ```cpp
  EXPECT_EQ(expected, actual);
  ASSERT_NE(unexpected, value);
  ```

- **String Comparisons:** For C strings, use: 

  ```cpp
  EXPECT_STREQ(str1, str2);       // Checks string content equality
  EXPECT_STRCASEEQ(str1, str2);   // Case-insensitive comparison
  ```

- **Floating-Point Comparisons:** Avoid exact comparisons due to rounding:

  ```cpp
  EXPECT_FLOAT_EQ(val1, val2);
  EXPECT_DOUBLE_EQ(val1, val2);
  EXPECT_NEAR(val1, val2, abs_error);
  ```

- **Exception Assertions:** Verify whether code throws exceptions:

  ```cpp
  EXPECT_THROW(statement, ExceptionType);
  ASSERT_NO_THROW(statement);
  ```

- **Death Assertions:** Confirm that code causes the process to terminate:

  ```cpp
  EXPECT_DEATH(statement, "regexp");
  EXPECT_EXIT(statement, testing::ExitedWithCode(0), "regexp");
  ```

---

## Writing Assertions Using Matchers

Matchers add expressive power to assertions by describing the desired properties of values or arguments.

### The `EXPECT_THAT` Macro

Use `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)` to assert that `value` satisfies the given matcher. For example:

```cpp
using ::testing::StartsWith;
using ::testing::HasSubstr;

EXPECT_THAT(greeting, StartsWith("Hello"));
EXPECT_THAT(log_message, HasSubstr("error"));
```

Matchers are polymorphic and extensible. They allow:

- Property-based checks
- Container element validations
- Composition with logical combinators (`AllOf()`, `AnyOf()`, `Not()`)

### Examples of Common Matchers

- **Wildcard matcher:** `_` matches any value.

  ```cpp
  EXPECT_CALL(mock_obj, Method(_, 42));  // Matches any first argument, second is 42
  ```

- **Relational matchers:** `Eq()`, `Ge()`, `Lt()`, etc.

- **String matchers:** `HasSubstr()`, `StartsWith()`, `EndsWith()`, `MatchesRegex()`

- **Container matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `Each()`, `Contains()`

- **Pointer matchers:** `IsNull()`, `NotNull()`, `Pointee(m)`

See the full [Matchers Reference](reference/matchers.md) for an exhaustive list.

### Composing Matchers

Matchers can be combined to express complex predicates:

```cpp
using ::testing::AllOf;
using ::testing::Ne;
using ::testing::Gt;

EXPECT_CALL(mock_obj, Foo(AllOf(Gt(5), Ne(10))));
```

This expects that the argument passed to `Foo` is greater than 5 and not equal to 10.

---

## Understanding Mock Expectations

When using mocks, you specify expectations using `EXPECT_CALL`:

- The **matchers** specify allowable argument values.
- The **cardinality settings** specify how many times the method is expected to be called.
- The **actions** specify what to do when the mock method is called.

### Setting Expectations

The general form of an expectation:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- If `Times()` is omitted, GoogleMock infers it based on the use of `WillOnce()` and `WillRepeatedly()`:
  - No actions: `Times(1)`
  - `n` `WillOnce()` clauses only: `Times(n)`
  - `n` `WillOnce()` clauses and one `WillRepeatedly()`: `Times(AtLeast(n))`

- Use `.RetiresOnSaturation()` to make an expectation inactive after it is saturated.

### Matchers in Expectations

In `EXPECT_CALL`, use matchers to specify argument constraints:

```cpp
EXPECT_CALL(mock, Compute(Ge(10), _));  // First arg >= 10; second arg anything
```

You can also use `.With(multi_argument_matcher)` to match multiple arguments as a tuple.

### Expectation Ordering

By default, calls can occur in any order. Use `InSequence` or `.InSequence()` clauses to enforce order.

Example:

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Init());
  EXPECT_CALL(mock, Run());
}
```

---

## Extending Assertions and Matchers

GoogleMock provides powerful extension mechanisms to enhance your verification logic.

### Writing Custom Matchers

Use the `MATCHER` and `MATCHER_P` macros to define custom matchers easily.

Example:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock_obj, Foo(IsEven()));
```

For more control, implement the matcher interface with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()` methods.

### Writing Custom Actions

Define custom behaviors for mock methods via lambdas, functors, or classes implementing `ActionInterface`.

Example:

```cpp
EXPECT_CALL(mock_obj, Compute(_))
    .WillOnce([](int x) { return x * 2; });
```

You can chain multiple actions with `DoAll()`.

### Predicate Assertions

When existing assertions don't suffice, write predicate assertions returning `AssertionResult` for detailed error messages and logical checks.

Example:

```cpp
testing::AssertionResult IsPositive(int n) {
  return n > 0 ? testing::AssertionSuccess() : testing::AssertionFailure() << n << " is not positive";
}
EXPECT_TRUE(IsPositive(value));
```

Use predicate-format macros (`EXPECT_PRED_FORMAT*`) for fully customized error messages.

---

## Practical Tips and Best Practices

- Prefer `ON_CALL()` to specify default behaviors without strict expectations. Use `EXPECT_CALL()` sparingly to verify critical interactions.
- Use `NiceMock` to suppress warnings for uninteresting calls, `StrictMock` to treat them as failures, and only choose naggy mocks for debugging.
- Chain `WillOnce()` actions to specify sequential returns or side effects; end with `WillRepeatedly()` as fallback.
- Avoid over-specifying matchers to keep tests maintainable and resilient to code refactorings.
- Use `SCOPED_TRACE()` to add contextual info to failures from helper functions.
- Always set expectations before exercising mocks to prevent undefined behavior.

---

## Troubleshooting

- **Uninteresting Call Warnings:** If you see warnings about uninteresting calls, consider:
  - Adding a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.
  - Wrapping your mock class in `NiceMock<>`.
  - Revisiting if your test needs to cover those calls.

- **Over-saturated Calls:** Called a mock method more times than expected? Adjust `.Times()` or add `.RetiresOnSaturation()`.

- **Order Violations:** If you require calls in order, use `InSequence` blocks or call sequences.

- **Return of move-only types:** Use lambdas returning a new value each time rather than `Return(std::move(...))`.

- **Mock Leak Detected:** Verify mocks are properly destroyed to enable expectation verification â€“ use `Mock::AllowLeak()` sparingly.

---

## Summary

This page covered how assertions verify your code's expected behavior, the role of matchers in crafting expressive checks, how to define expectations using GoogleMock, and how to extend these mechanisms with your own matchers and actions. Practical advice equips you to write maintainable, robust tests that precisely check your code's correctness.

---

## External Resources and Links

See also the following documentation pages for more detailed information:

- [Assertions Reference](../api-reference/core-apis/assertions.md)
- [Matchers Reference](../api-reference/core-apis/matchers.md)
- [Mocking Reference](../docs/reference/mocking.md)
- [gMock Cookbook](../docs/gmock_cook_book.md)
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md)
- [Advanced GoogleTest Topics](../docs/advanced.md)

Refer to the [Concepts Navigation Map](../../../concepts/behavior-models/assertions-and-matchers) for contextual understanding within the documentation.

