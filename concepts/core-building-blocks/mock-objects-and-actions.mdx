---
title: "Mock Objects and Actions"
description: "Explore how GoogleMock enables the creation, configuration, and use of mock objects. Learn about the MOCK_METHOD macro, default actions, and how actions encapsulate return values, side effects, and complex control strategies for mocked methods."
---

# Mock Objects and Actions

GoogleMock (gMock) empowers you to create mock objects in C++ that simulate behavior for testing purposes. This page guides you through defining mock classes using the `MOCK_METHOD` macro, configuring their behaviors with default actions, and harnessing mock **actions** to specify return values, side effects, and complex control logic.

---

## Defining and Using Mock Classes

### Writing Mock Methods with `MOCK_METHOD`

Mock classes mimic real interfaces by overriding virtual methods using the `MOCK_METHOD` macro. The macro takes three mandatory parameters—return type, method name, and argument list—and an optional fourth parameter for qualifiers like `const` or `override`.

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

**Tips:**
- Always place `MOCK_METHOD` declarations in the `public:` section.
- For overloaded methods or those with complex argument types involving commas, wrap the type in parentheses or use type aliases.
- If mocking a const method, add `(const)` to the specifiers.
- Qualifiers such as `noexcept` or `Calltype(...)` can be declared to match the original signature.

### Creating Nice, Naggy, and Strict Mocks

Mocks can be wrapped to control how uninteresting calls (calls with no matching expectation) are handled:

- `NiceMock<T>` suppresses warnings for uninteresting calls.
- `NaggyMock<T>` (default) produces warnings.
- `StrictMock<T>` treats uninteresting calls as failures.

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;
NaggyMock<MockFoo> naggy_mock;
StrictMock<MockFoo> strict_mock;
```

---

## Setting Expectations and Default Actions

### Typical Mock Workflow

1. Import necessary symbols from the `testing` namespace.
2. Create mock object instances.
3. Optionally set default behaviors for methods.
4. Set expectations defining how methods are expected to be called.
5. Execute code that uses the mocks.
6. Upon mock destruction, expectations are automatically verified.

### `EXPECT_CALL` - Setting Expectations

Defines requirements on which method calls are expected during test execution. You specify the mock object, the method name, and optional matchers for arguments.

```cpp
using ::testing::Return;

EXPECT_CALL(mock_foo, GetSize())
    .Times(3)
    .WillRepeatedly(Return(5));
```

- Use matchers like `_` (wildcard), `Eq(value)`, or custom matchers to specify argument constraints.
- Specify call cardinalities using `.Times()`, with common values like `AnyNumber()`, `AtLeast(n)`, or `Exactly(n)`.
- Use `.WillOnce()` and `.WillRepeatedly()` to define the behavior for each matched call.

### `ON_CALL` - Default Actions

Sets what a mock method should do when called with matching arguments, **without** setting an expectation that the call *must* happen.

```cpp
ON_CALL(mock_foo, GetSize())
    .WillByDefault(Return(10));
```

- `ON_CALL` is usually invoked in mock constructors or test fixture setups.
- The default action from `ON_CALL` is superseded by behavior defined in matching `EXPECT_CALL`s.

### Important Semantic Notes

- Expectations in `EXPECT_CALL` should be set **before** exercising code that calls mocks.
- Uninteresting calls with no `EXPECT_CALL` but with `ON_CALL` will perform the default action but may generate a warning unless using a `NiceMock`.
- The order of `EXPECT_CALL`s matters; the last matching expectation overrides earlier ones for a method.

---

## Crafting Actions — Controlling Mock Method Behavior

Mock **actions** define what happens when a mock method is invoked. Actions affect return values, modify output parameters, or invoke custom code.

### Common Built-in Actions

| Action                      | Description                                                  |
|-----------------------------|--------------------------------------------------------------|
| `Return(value)`             | Returns `value` from the mock method.                         |
| `ReturnRef(variable)`       | Returns a reference to `variable`.                           |
| `ReturnNull()`              | Returns a null pointer.                                       |
| `DoDefault()`               | Invokes the default behavior (set by `ON_CALL` or built-in). |
| `Invoke(f)`                 | Calls function/functor/lambda `f` with the original arguments. |
| `InvokeWithoutArgs(f)`      | Calls function/functor/lambda `f` with no arguments.          |
| `InvokeArgument<N>(args...)`| Calls the N-th argument (a callable) with supplied args.      |
| `SetArgPointee<N>(value)`  | Sets `*argN` to `value` (useful for output parameters).      |
| `DoAll(actions...)`         | Performs multiple actions sequentially, returning the last’s result. |

### Examples

#### Returning Different Values Each Call

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));
```

#### Calling a Custom Function as Action

```cpp
int ComputeSum(int x, int y) { return x + y; }

EXPECT_CALL(mock, Sum(_, _)).WillOnce(Invoke(ComputeSum));
```

#### Changing Output Parameters

```cpp
EXPECT_CALL(mock, Mutate(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(100), Return(true)));
```

### Defining Custom Actions

Define a callable object, function, or lambda with a signature compatible with the mock method. Use it directly with `.WillOnce()` or `.WillRepeatedly()`.

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce([](int x) { return x * 2; });
```

You can also create parameterized actions using the `ACTION` and `ACTION_P` macros for complex reusable behaviors.

---

## Ordering and Sequencing

### Enforcing Order with `InSequence`

Wrap expectations in an `InSequence` block to require that calls happen in the declared order:

```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

### Partial Order with `After` and `Sequence`

Use `After()` clauses or explicit `Sequence` objects for more flexible ordering constraints.

---

## Advanced Concepts and Best Practices

### Handling Overloaded Methods

Specify all overloads you want to mock. For const overloads, use `(const, override)` qualifier.

```cpp
MOCK_METHOD(int, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```
Use `Const(mock)` to disambiguate *calling* the const overload.

### Default Values for Return Types

Customize default return values for types using `DefaultValue<T>::Set(value)` if the built-in defaults don't suit your needs.

### Delegating to Fake or Real Objects

You can configure your mocks to delegate calls to existing implementations, enabling hybrid mocking techniques.

### Verifying and Resetting Mocks

- Destruction of the mock automatically verifies all expectations.
- To verify earlier, use:
  ```cpp
  Mock::VerifyAndClearExpectations(&mock_obj);
  ```
- To allow intentional leaking (disables verification), use:
  ```cpp
  Mock::AllowLeak(&mock_obj);
  ```

---

## Troubleshooting Common Issues

- If uninteresting calls are producing warnings, consider using `NiceMock` or add catch-all expectations with `EXPECT_CALL(...).Times(AnyNumber())`.
- Always set expectations *before* the mock methods are actually called.
- Check for virtual destructors on interfaces you mock to avoid leaks or undefined behavior.
- Use `--gmock_verbose=info` flag to get verbose mock call logs for debugging.

---

## References and Further Reading

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly introduction.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick syntax reference.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) — Detailed API documentation.
- [Actions Reference](https://google.github.io/googletest/reference/actions.md) — Built-in actions and how to use them.
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.md) — Argument matchers for expectations.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes and advanced usage patterns.
- Navigate related concepts in the Documentation’s [Core Building Blocks](https://google.github.io/googletest/concepts/core-building-blocks/mock-objects-and-actions.html).

---

## Summary Diagram: Mock Object Usage Flow

```mermaid
flowchart TD
  A[Define Mock Class with MOCK_METHOD] --> B[Create Mock Object Instance]
  B --> C{Set Default Behavior?
(Use ON_CALL)}
  B --> D{Set Expectations?
(Use EXPECT_CALL)}
  C --> E[Define with WillByDefault(action)]
  D --> F[Define Times(), WillOnce(), WillRepeatedly(), etc.]
  E --> G[Run Test Code Using Mock]
  F --> G
  G --> H[Mock Method Called]
  H --> I[Check Expectations and Actions]
  I --> J[Perform Action or Default]
  J --> K[Verify Expectations on Mock Destruction]

  style A fill:#f9f,stroke:#333,stroke-width:2px
  style B fill:#bbf,stroke:#333,stroke-width:2px
  style C fill:#fbf,stroke:#333,stroke-width:2px
  style D fill:#fbf,stroke:#333,stroke-width:2px
  style E fill:#dfd,stroke:#333,stroke-width:2px
  style F fill:#dfd,stroke:#333,stroke-width:2px
  style G fill:#ffd,stroke:#333,stroke-width:2px
  style H fill:#ffd,stroke:#333,stroke-width:2px
  style I fill:#fdd,stroke:#333,stroke-width:2px
  style J fill:#fdd,stroke:#333,stroke-width:2px
  style K fill:#f9f,stroke:#333,stroke-width:2px
```

---

<Check>
Remember to set expectations before invoking mock methods and use default actions appropriately to avoid unintentional warnings or failures.
</Check>

---

*For more detailed examples, usage tips, and deep dives into matchers, expectations, and actions, consult the related guides linked above.*
