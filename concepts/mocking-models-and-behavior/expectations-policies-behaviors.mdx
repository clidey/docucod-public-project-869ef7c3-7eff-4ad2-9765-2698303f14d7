---
title: "Expectations, Policies, and Behaviors"
description: "Discusses how GoogleMock expresses and enforces expectationsâ€”covering default and explicit expectations, as well as policies such as how uninteresting calls are treated using NiceMock, NaggyMock, and StrictMock. Provides insight into error reporting and developer intent."
---

# Expectations, Policies, and Behaviors in GoogleMock

GoogleMock allows you to precisely specify how mock methods behave and how their usage is expected during a test. This page explains the core concepts behind expressing and enforcing expectations using `EXPECT_CALL` statements, default behaviors via `ON_CALL`, and policies controlling uninteresting calls, such as `NiceMock`, `NaggyMock`, and `StrictMock`. Understanding these concepts will empower you to write robust, maintainable tests that clearly capture developer intent.

---

## Understanding Expectations with `EXPECT_CALL`

The heart of specifying how mocks should behave lies in the `EXPECT_CALL` macro. It allows you to declare an expectation that a given mock method will be called with specified arguments, a defined frequency, order, and custom behaviors.

### Anatomy of an Expectation

A single `EXPECT_CALL` declaration defines an expectation on a mock method, which includes:

- **Argument Matchers:** Define *which calls count* by matching method parameters.
- **Cardinality (`Times` clause):** Defines how many calls are expected.
- **Ordering (`InSequence` and `After` clauses):** Expresses ordering constraints among multiple expectations.
- **Actions (`WillOnce`, `WillRepeatedly`):** Specifies what the mock method should do on calls matching this expectation.
- **Retirement (`RetiresOnSaturation`):** Indicates that once saturated, the expectation no longer applies.

### Expressive Matching of Arguments

GoogleMock matches each function call against expectations in reverse order of declaration (newer supersedes older), evaluating both individual argument matchers and, optionally, multi-argument matchers specified via the `.With()` clause for more complex constraints over all parameters.

#### Example with `.With()` Clause

```cpp
EXPECT_CALL(mock_object, SetBounds(_, _))
    .With(Lt())  // Expects the first argument to be less than the second
    .Times(AtLeast(1));
```

### Cardinalities (`Times` Clause)

Cardinalities specify *how many times* an expectation should be met and can be:

- `Exactly(n)` (or `n`): Exactly n calls
- `AtLeast(n)`: Minimum n calls
- `AtMost(n)`: Maximum n calls
- `Between(m, n)`: Between m and n calls inclusive
- `AnyNumber()`: Any number of calls, including zero

If you omit `Times()`, GoogleMock infers it based on the number of `WillOnce` and `WillRepeatedly` clauses.

### Ordering Expectations

- **`InSequence` Clause:** Adds expectations to one or more `Sequence` objects, enforcing strict ordering of calls within each sequence.
- **`After` Clause:** Specifies that an expectation occurs after one or more others, allowing for expressing partial orders.

*Both can be chained multiple times to express complex orderings.*

#### Using `InSequence` for a Simple Sequence

```cpp
Sequence s;
EXPECT_CALL(mock, Init()).InSequence(s);
EXPECT_CALL(mock, Run()).InSequence(s);
EXPECT_CALL(mock, TearDown()).InSequence(s);
```

### Controlling the Behavior of Expected Calls

- **`WillOnce(action)`**: Defines the behavior for the next n calls (where n is the number of `WillOnce` clauses).
- **`WillRepeatedly(action)`**: Defines behavior for subsequent calls after `WillOnce` actions are exhausted.

Example:

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));
```

This means:
- First call returns 10
- Second call returns 20
- All following calls return 30

### Retiring Expectations

By default, expectations are "sticky": they stay active even after reaching their call count's upper bound and cause failures if called more times than expected (over-saturation).

You can make expectations retire automatically upon saturation by using:

```cpp
EXPECT_CALL(mock, Foo())
    .Times(2)
    .RetiresOnSaturation();
```

Retiring an expectation removes it from consideration for further calls, allowing other expectations to match.

---

## Setting Default Behaviors with `ON_CALL`

While `EXPECT_CALL` defines both behavior and an expectation that a call *will* happen, `ON_CALL` defines behavior without asserting that the call *must* happen.

### Typical Use Case

`ON_CALL` is ideal for mocking default/mock behavior shared across multiple tests, where you set what happens if the method is called but don't verify the calls explicitly.

Example:

```cpp
ON_CALL(mock_object, Compute(_))
    .WillByDefault(Return(42));
```

This defines a default action to return 42 for any `Compute` call.

### `ON_CALL` Syntax

Must be followed by exactly one `.WillByDefault(action)` clause, with an optional `.With(multi_argument_matcher)`.

The action specified by `ON_CALL` is used only when no `EXPECT_CALL` matches.

---

## Handling Uninteresting Calls: Nice, Naggy, and Strict Mocks

When mock methods are called without any matching `EXPECT_CALL`, these are considered **uninteresting calls**. GoogleMock distinguishes how these calls are treated by default and through mocking policies:

| Mock Type  | On Uninteresting Calls                         | Behavior Description                                    |
|------------|-----------------------------------------------|---------------------------------------------------------|
| NaggyMock  | Warning (default)                             | Prints a warning but lets the call pass                |
| NiceMock   | Ignored                                      | Suppresses warnings; silently allows the call          |
| StrictMock | Failure                                      | Fails the test immediately upon uninteresting call       |

*Default mock objects behave like NaggyMock.*

### Usage Examples

```cpp
// Suppress warnings on uninteresting calls
NiceMock<MockFoo> nice_mock;

// Make uninteresting calls failures
StrictMock<MockFoo> strict_mock;
```

### Best Practices

- Use **`NiceMock`** when you're not interested in certain calls and want less noise.
- Use **`StrictMock`** only when you want to *strictly enforce* that no unexpected calls occur.
- Avoid suppressing uninteresting call warnings by blanket `EXPECT_CALL` unless you mean to allow those calls and enforce counts explicitly.

---

## Error Reporting and Diagnostics

GoogleMock offers detailed diagnostics to help you understand why expectations may fail:

- **Unmatched Calls:** Prints all tried expectations with reasons they did not match.
- **Excessive Calls:** Reports when mock methods are called more times than allowed.
- **Unsatisfied Expectations:** Reports expectations that were never met by the end of a test.
- **Retired Expectations:** Explains if calls are rejected because expectations have retired.
- **Prerequisite Expectations:** For `.After()`, indicates if preconditions are unsatisfied.

Running tests with verbose logging (`--gmock_verbose=info`) gives comprehensive call traces and stack information.

---

## Key Takeaways

- Define *expected calls* with `EXPECT_CALL`, specifying argument matchers, call counts, ordering, and actions.
- Define *default behaviors* with `ON_CALL` without enforcing call expectations.
- Use `NiceMock`, `NaggyMock`, or `StrictMock` to control behavior on uninteresting calls, balancing warning verbosity vs test strictness.
- Use `.RetiresOnSaturation()` to control when expectations disengage after being met.
- GoogleMock provides actionable, readable diagnostic output to quickly identify what went wrong when expectations are violated.

---

## Practical Tips

- **Set expectations *before* exercising mocks.** Do not mix calls and expectations unpredictably.
- **Prefer `ON_CALL` for default mock behavior; use `EXPECT_CALL` only when you want to check invocation.**
- **Use `InSequence` or `.After()` to specify call orders only when necessary.** Over-ordering can lead to brittle tests.
- **Suppress uninteresting call warnings explicitly with `NiceMock` instead of blanket `EXPECT_CALL`.**
- **Use `.RetiresOnSaturation()` to avoid expectation sticky conflicts, especially when sequencing multiple calls.**

---

## Related Resources

- [Basic Mocking with GoogleMock](../getting-started/configuration-and-first-use/using-googlemock-basics)
- [Setting Expectations and Actions](../api-reference/mocking-api/expectations-actions)
- [Controlling Mock Behavior (NiceMock, StrictMock)](../api-reference/mocking-api/mock-behavior-control)
- [Matchers, Actions, and Cardinalities](../concepts/mocking-models-and-behavior/matchers-actions-and-cardinalities)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)

---

## Example Usage

```cpp
using ::testing::Return;
using ::testing::AtLeast;
using ::testing::InSequence;

class MockPrinter {
 public:
  MOCK_METHOD(void, Print, (const std::string& text), ());
};

TEST(PrintingTest, BasicUsage) {
  MockPrinter printer;

  // Set expectations with explicit call counts and return behavior.
  {
    InSequence s;
    EXPECT_CALL(printer, Print("Hello"))
        .Times(1);
    EXPECT_CALL(printer, Print("World!"))
        .Times(AtLeast(1));
  }

  // Set default behavior for other calls to Print.
  ON_CALL(printer, Print)
      .WillByDefault([](const std::string& text) {
        // No action, just accept call.
      });

  // Code under test calls:
  printer.Print("Hello");
  printer.Print("World!");
  printer.Print("World!");
}
```

---

## See Also

- [Mocking Reference](docs/reference/mocking.md)
- [Expectations and Actions API](../api-reference/mocking-api/expectations-actions)
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [Common Pitfalls in Using Mocks](../faq/best-practices/faq-assertions-mock-usage)
