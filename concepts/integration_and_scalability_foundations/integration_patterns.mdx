---
title: "Integration Patterns"
description: "Survey recommended practices for integrating GoogleTest and GoogleMock in diverse codebases. Review typical build and configuration scenarios and understand how test suites coexist with production code."
---

# Integration Patterns

GoogleTest and GoogleMock are designed for seamless integration into diverse C++ codebases and build environments. This guide helps you understand recommended practices for embedding GoogleTest into your projects, managing coexistence with production code, and navigating typical build and configuration scenarios.

---

## Overview

Integrating GoogleTest and GoogleMock effectively is crucial for maintaining clean, maintainable, and scalable test infrastructures. This guide focuses on strategies to incorporate the frameworks into existing projects with minimal friction while enabling rich testing capabilities.

You will learn how to consider test suite arrangements, build tool compatibility, and configuration management to optimize test execution and maintenance.

---

## Integration Use Cases

Integration goals differ by project size and structure. Common scenarios include:

- **Single-Module Projects:** Adding GoogleTest as a standalone test harness.
- **Multi-Module Repositories:** Coordinating tests across components, sharing fixtures, and managing dependencies.
- **Mixed Production and Test Codebases:** Keeping tests alongside production code while isolating runtime impact.

Understanding your use case informs which integration patterns and build strategies best suit your workflow.

---

## Typical Build and Configuration Scenarios

GoogleTest and GoogleMock are header-centric but require linking against compiled libraries provided by the framework. Here are common build scenarios:

### 1. Standalone Testing Executables

- Create a dedicated test executable linking against GoogleTest and GoogleMock libraries.
- Isolate test code from production code.
- Support easy test discovery via GoogleTest’s automatic registration.

### 2. Embedded Tests in Production Binaries

- Include tests as part of the same binary as production code (often in debug builds).
- Use conditional compilation to exclude tests in release builds.
- Ensure test dependencies do not bloat production outputs.

### 3. Shared Libraries and Static Linking

- Link GoogleTest and GoogleMock either statically or dynamically.
- On Windows, be mindful of runtime library mismatches (static VS dynamic CRT) which cause linking errors.
- On Unix, control symbol visibility to avoid conflicts.

### 4. Build System Integration

- Use CMake or Bazel to manage source, dependencies, and build targets.
- Leverage GoogleTest’s official CMake scripts for smooth integration.
- Manage test binaries and dependencies separately in CI pipelines.

{/* Whenever integrating with your build system, verify the test executable compiles and links cleanly without adding unnecessary baggage to your production artifacts. */}

---

## Organizing Test Suites Alongside Production Code

Balancing test code proximity and modularity is essential:

- **Co-located Source and Test Files:** Place tests near source files for ease of maintenance.
- **Separate Test Directories:** Centralize tests to keep production tree clean.
- **Fixture Sharing:** Use test fixtures to share setup and data across multiple tests efficiently.

### Best Practices

- Name test suites and test cases clearly to reflect functionality.
- Avoid underscores in test suite and test names to prevent naming issues (see GoogleTest FAQ).
- Use `TEST_F` with fixtures for reuse and clear intent.

{/* Test fixtures allow multiple tests to share common setup/teardown logic, facilitating maintainability in multi-test suites. */}

---

## Coexistence with Production Binaries

It is common for projects to run unit tests separately but also sometimes embed test logic in debug builds.

### Key Guidance

- Use preprocessor macros to exclude test code from production builds.
- Ensure test binaries do not depend on features unavailable or undesirable in production environments.
- Avoid including testing headers and libraries where not needed to reduce binary size.

{/* Linking GoogleTest or GoogleMock code into production binaries without excluding test-only components can lead to increased binary size and potential runtime behaviors unintended for production. */}

---

## Managing Test Execution via Build and Runtime Configurations

Controlling test selection, repetition, and reporting is critical for large-scale projects.

- Use GoogleTest flags like `--gtest_filter` to run subsets.
- Use `--gtest_repeat` to rerun tests for flakiness diagnosis.
- Customize output with `--gtest_output` for XML or JSON reports.
- Manage disabling tests with `DISABLED_` prefixes.

<Steps>
<Step title="Configure Build System">Integrate GoogleTest and GoogleMock targets within your CMakeLists.txt or Bazel BUILD files.</Step>
<Step title="Define Tests">Write tests using `TEST`, `TEST_F`, or parameterized tests targeting your fixtures.</Step>
<Step title="Run Tests">Execute tests with flags for filtering, repeating, and reporting as needed.</Step>
<Step title="Automate in CI">Configure your CI pipelines to build and execute tests, using generated reports for feedback.</Step>
</Steps>

---

## Customization and Extensibility

Advanced users may extend GoogleTest with custom flags and behaviors:

- Define macros in `gtest-port.h` and `gmock-port.h` to customize flag behavior and platform integrations.
- Inject custom configuration points into the `custom` directory as described in the GoogleMock customization documentation.

<Info>
Customizing flags allows tailoring test execution environments and behaviors suitable for specialized platforms or internal policies.
</Info>

---

## Troubleshooting Common Integration Issues

### Linking and Runtime

- Resolve conflicts between dynamic and static runtime libraries.
- Check for missing virtual destructors in your mock classes.
- Confirm that the correct GoogleTest and GoogleMock versions are linked.

### Test Discovery

- Confirm tests are registered by putting them in translation units linked into test binaries.
- Avoid mixing `TEST` and `TEST_F` in the same test suite with different fixtures.

### Environment Considerations

- Adjust environment variables and build flags related to sharding, filtering, and test outputs.
- Address flaky test timing and concurrency conditions with repeats and shuffles.

---

## Example: Integrating GoogleTest in a CMake Project

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

# Download and add GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

# Add your test executable
add_executable(my_tests test_main.cpp my_class_test.cpp)
target_link_libraries(my_tests gtest_main gmock)

# Enable testing
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

---

## Summary

- Understand your project structure and decide how to arrange test code.
- Integrate GoogleTest and GoogleMock libraries properly, respecting platform and runtime constraints.
- Organize test suites logically to share fixtures and setup.
- Leverage GoogleTest flags for fine-grained control of test runs.
- Customize framework behavior if required through provided customization points.
- Anticipate and troubleshoot common integration issues.

---

## Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) — Learn the basics of writing tests.
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Extending mocks and assertions.
- [Build Integration Guide](https://github.com/google/googletest/blob/main/docs/guides/advanced-and-integrations/integrating-with-build-systems.md) — Detailed build system instructions.
- [FAQ on Integration](https://github.com/google/googletest/blob/main/docs/faq.md#integration-support) — Common questions about integrating GoogleTest.

---

For full API references consult the GoogleTest API and GoogleMock API documentation accessible via the main navigation.

---

{/* Diagram not included as the page is concept documentation, focused on usage and patterns rather than internal architecture. */}