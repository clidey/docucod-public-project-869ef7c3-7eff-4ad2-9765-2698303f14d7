---
title: "Matchers and Actions"
description: "Discover the role of matchers and actions in controlling mock behavior and verifying interactions. Learn how expressive matchers facilitate detailed argument verification and how actions can define mock responses."
---

# Matchers and Actions

Control the behavior of mock methods and verify interactions precisely with GoogleMock's powerful matchers and actions. This guide introduces how matchers enable detailed argument validation and how actions define the responses of mocks, unlocking expressive and maintainable tests.

---

## Introduction

In GoogleMock, **matchers** and **actions** are the twin pillars that empower you to write precise and meaningful tests.

- **Matchers** specify conditions on mock method arguments, enabling you to confirm that your code calls mock methods with expected argument values.
- **Actions** define what a mock method does when called (e.g., returning a value, modifying arguments, throwing exceptions).

By combining these, you can shape mock interactions to simulate complex scenarios and verify behavioral contracts between components.

---

## Matchers: Verifying Function Arguments

Matchers allow you to specify expectations about the arguments with which mock methods are called. They act like predicates over function arguments.

### Basic Usage

Use the `_` matcher to accept any argument (the wildcard matcher):

```cpp
using ::testing::_;
EXPECT_CALL(mock_obj, Foo(_)); // Foo called with any argument
```

To match specific values, use built-in matchers or literal values (which are implicitly converted to equality matchers):

```cpp
using ::testing::Eq;
EXPECT_CALL(mock_obj, Foo(5));         // expects Foo called with 5
EXPECT_CALL(mock_obj, Bar(Eq("abc"))); // expects argument "abc"
```

### Common Matcher Types

- **Equality and relational**: `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- **Wildcard and negations**: `_` (any), `Not()`
- **String matchers**: `StrEq()`, `StartsWith()`, `HasSubstr()`, etc.
- **Container matchers**: `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`
- **Pointer matchers**: `IsNull()`, `NotNull()`, `Pointee()`
- **Member validation**: `Field()`, `Property()` to validate struct/class members

### Composing Matchers

You can build complex conditions by combining matchers:

```cpp
using ::testing::AllOf;
using ::testing::AnyOf;

EXPECT_CALL(mock_obj, Process(AllOf(Gt(0), Lt(10))));
```

This expects the argument to be > 0 *and* < 10.

### Matching multiple arguments as a whole

Sometimes you need to express conditions that involve multiple arguments at once. Use the `.With()` clause on expectations to specify a multi-argument matcher that receives the arguments as a tuple.

```cpp
EXPECT_CALL(mock_obj, SetPosition(_, _))
    .With(Lt());  // expects first arg < second arg
```

See the [Multi-argument Matchers](reference/matchers.md#MultiArgMatchers) for usage.

### Custom Matchers

To write matchers tailored for your domain-specific types or logic, you can use the `MATCHER()`, `MATCHER_P()`, or implement matcher classes directly. Custom matchers can provide rich failure messages and concise syntax.

---

## Actions: Defining Mock Behavior

Actions specify what happens when a mock method is called, controlling the mock's response and side effects.

### Common Built-in Actions

Here are key actions you will often use:

| Action                  | Description                                              |
|-------------------------|----------------------------------------------------------|
| `Return(value)`         | Returns `value` from the mock method.                     |
| `ReturnRef(variable)`   | Returns a reference to `variable`.                        |
| `ReturnPointee(ptr)`    | Returns the value pointed to by `ptr` at call time.      |
| `ReturnNull()`          | Returns a null pointer.                                   |
| `DoDefault()`           | Performs the default action specified by `ON_CALL()`.    |
| `Throw(exception)`      | Throws the given exception (requires exception support). |
| `SetArgPointee<N>(val)`| Sets the value pointed to by the N-th argument.          |
| `SetArrayArgument<N>(first, last)` | Copies elements into the N-th argument array.     |
| `Invoke(f)`             | Calls the callable `f` when invoked.                      |
| `InvokeWithoutArgs(f)`  | Calls a callable with no args.                            |
| `InvokeArgument<N>(args...)` | Invokes the function passed as N-th argument with args. |
| `DoAll(a1, a2, ..., an)`| Chains several actions; returns result of last.          |

### Combining Actions

You can compose multiple actions together to achieve complex behavior using `DoAll()`. For example:

```cpp
EXPECT_CALL(mock_obj, Foo(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

This sets the pointed-to value of argument 0 to 5 and returns true.

### Setting Default Behavior with ON_CALL

`ON_CALL()` defines the default behavior of a mock method when no expectation (`EXPECT_CALL`) matches. Use `.WillByDefault()` to specify the default action.

```cpp
ON_CALL(mock_obj, GetData(_))
    .WillByDefault(Return(42));
```

---

## Using Matchers and Actions Together

You set expectations with `EXPECT_CALL` that combine matchers to specify the expected arguments and actions to define the mock's dynamic behavior:

```cpp
EXPECT_CALL(mock_obj, DoWork(Ge(0), Lt(10)))
    .Times(3)
    .WillOnce(Return(true))
    .WillRepeatedly(Return(false));
```

This expects three calls to `DoWork`, with first arg >=0 and second arg < 10, returning true once and then false thereafter.

---

## Best Practices and Tips

- **Use matchers conservatively** â€” only constrain arguments you truly care about.
- **Prefer `ON_CALL` for default behavior** and reserve `EXPECT_CALL` for verifying important interactions.
- **Chain `WillOnce()` actions to specify ordered behaviors** for consecutive calls; use `WillRepeatedly()` to specify fallback behavior.
- **Use `RetiresOnSaturation()`** to make expectations deactivate when saturated, avoiding conflicts with other expectations.
- **Suppress uninteresting call warnings with `NiceMock`** if desired.

---

## Troubleshooting

- If your test fails because of unmatched arguments, run the test with `--gmock_verbose=info` to see detailed matching logs.
- If you see "Uninteresting mock function call" warnings, ensure you're using `ON_CALL` or `EXPECT_CALL` appropriately to cover expected calls.
- When mocking methods with overloaded signatures, help the compiler disambiguate by specifying the exact overload.

---

## Example Scenario

Suppose you have a mock turtle interface and want to check it moves to the origin exactly twice:

```cpp
using ::testing::_;
using ::testing::AnyNumber;

EXPECT_CALL(turtle, GoTo(_, _))
    .Times(AnyNumber());  // Accept any calls otherwise
EXPECT_CALL(turtle, GoTo(0, 0))
    .Times(2);            // Expect exactly 2 calls to origin
```

You can further specify behavior:

```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(0))
    .WillRepeatedly(Return(10));
```

---

## Additional Resources

- [Matchers Reference](reference/matchers.md) for an exhaustive list and details of matchers.
- [Actions Reference](reference/actions.md) for all built-in actions.
- [gMock Cookbook](gmock_cook_book.md) for practical recipes and advanced usage.
- [gMock for Dummies](gmock_for_dummies.md) for beginner-friendly guidance.

---

By mastering matchers and actions, you gain granular control over your mocks, enabling precise verification and flexible test simulations in C++ with GoogleMock.


