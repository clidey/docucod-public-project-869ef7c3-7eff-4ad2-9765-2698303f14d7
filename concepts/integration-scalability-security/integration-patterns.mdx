---
title: "Integration with Build Systems and CI Pipelines"
description: "Review proven patterns for integrating GoogleTest and GoogleMock into various build environments (e.g., CMake, Bazel) and continuous integration pipelines. Learn best practices for reliable discovery, execution, and reporting of tests across platforms."
---

# Integration with Build Systems and CI Pipelines

GoogleTest and GoogleMock are designed to integrate seamlessly into your C++ build environments and continuous integration (CI) pipelines. This page guides you through best practices and proven patterns for incorporating GoogleTest and GoogleMock into popular build systems such as CMake and Bazel, as well as embedding test discovery, execution, and reporting within CI environments.

---

## Why Integrate GoogleTest and GoogleMock into Build & CI Environments?

Integrating your tests into build systems and CI pipelines ensures automated, reliable, and continuous feedback on code quality. It enables:

- **Automatic test discovery and execution:** No manual intervention needed to run tests.
- **Consistent build and test environments:** Eliminates "works on my machine" issues.
- **Consolidated reporting:** Easy access to pass/fail results for automated monitoring.
- **Scalability & parallelism:** Builds and tests scale efficiently on CI infrastructure.

By embedding GoogleTest and GoogleMock effectively, you reduce developer friction and accelerate defect detection early in the development lifecycle.

---

## Integration Patterns for Common Build Systems

### Integrating with CMake

GoogleTest and GoogleMock ship with official support for CMake-based builds and allow flexible test target management.

**Key steps:**

1. **Add GoogleTest as a submodule or external project**
   - Include GoogleTest source in your project's `third_party` or fetch it dynamically.

2. **Add your test executable targets**
   - Use `add_executable()` for your test binaries.
   - Link with `gtest` and `gmock` libraries.

3. **Enable discovery and execution of tests**
   - Use `gtest_discover_tests()` to register all tests for CTest integration.

4. **Configure test properties and tags**
   - Mark tests to run in parallel or segregate integration versus unit tests.

5. **Sample `CMakeLists.txt` snippet:**

```cmake
add_subdirectory(third_party/googletest)  # Add GoogleTest to your build

add_executable(my_project_tests
    test_main.cc
    my_test_case.cc
)

target_link_libraries(my_project_tests gtest gmock pthread)  # pthread on Linux

enable_testing()
gtest_discover_tests(my_project_tests)
```

**Tips:**

- Use `gtest_main` for a pre-built test main() function to reduce boilerplate.
- Control test filtering and output verbosity using GoogleTest CLI flags.

---

### Integrating with Bazel

Bazel, a build and test tool from Google, natively supports GoogleTest and GoogleMock.

**Key steps:**

1. **Declare GoogleTest workspace dependency:**
   - Use `http_archive` in your `WORKSPACE` file to pull GoogleTest.

2. **Define `cc_test` targets:**
   - In your `BUILD` files, create `cc_test` targets with your test sources.
   - Add `@com_google_googletest//:gmock_main` as a dependency for main entry point.

3. **Sample `BUILD` target:**

```python
cc_test(
    name = "my_tests",
    srcs = ["test_main.cc", "my_test_case.cc"],
    deps = [
        "@com_google_googletest//:gmock_main",
        ... other dependencies ...
    ],
)
```

4. **Run tests:**

```bash
bazel test //path/to:my_tests
```

**Tips:**

- Bazel runs tests in hermetic sandboxed environments by default.
- Leverage Bazel's `--test_output` flag to control test output verbosity.

---

## Integrating into Continuous Integration Pipelines

Embedding GoogleTest and GoogleMock executions into your CI processes automates quality checks and delivers fast feedback.

### General CI Best Practices:

- **Automate build and tests:** Ensure your CI job compiles code and runs all tests on each commit or pull request automatically.

- **Capture test results in standard formats:** GoogleTest supports XML and JSON output formats (`--gtest_output=xml:<file>`), which are widely consumable by CI dashboards.

- **Run tests in parallel:** GoogleTest supports parallel execution (`--jobs=N`). Configure your CI to utilize available cores efficiently.

- **Control verbosity and failures:** Use GoogleTest and GoogleMock flags to fine-tune output (`--gtest_color=yes|no|auto`, `--gmock_verbose=warning|info|error`).

- **Fail fast on critical errors:** Configure your CI to stop or mark builds failed on test failures promptly.

- **Leverage caching:** Cache compiled GoogleTest and your build outputs to speed up CI runs.

### Example for test execution in a CI shell script:

```bash
mkdir -p reports
./my_project_tests --gtest_output=xml:reports/results.xml --gtest_color=yes --gmock_verbose=warning
```

Use the generated XML for CI test result parsing.

### CI pipeline integration highlights for popular platforms:

- **Jenkins:** Use the Google Test plugin to directly visualize XML reports.
- **GitHub Actions:** Use actions to build and run tests, publishing artifacts.
- **GitLab CI:** Use the built-in JUnit test report support for XML.
- **Azure DevOps:** Use the Publish Test Results task with GoogleTest XML.

---

## Common Pitfalls and Troubleshooting

- **Tests not discovered or run:**
  - Ensure your test binary links against `gtest_main` or provides an appropriate main entry.
  - In CMake, forget to call `enable_testing()` or `gtest_discover_tests()` prevents CTest integration.

- **Linker errors on GoogleMock symbols:**
  - Verify that you link against `gmock` and `gmock_main` where appropriate.

- **Inconsistent test output in CI:**
  - Set GoogleTest and GoogleMock output flags explicitly.

- **Flaky test executions or hangs in CI:**
  - Use timeouts and isolation.
  - Run tests in parallel carefully with thread-safe mocks and test setups.

- **Leaked mocks warning:**
  - Ensure all mock objects are destroyed before test completion.
  - Alternatively, use `Mock::AllowLeak()` if mock leaks are expected and benign.

---

## Summary

Effectively integrating GoogleTest and GoogleMock with CMake, Bazel, and CI pipelines accelerates reliable software delivery. By following well-established integration patterns, you ensure automated and continuous validation of your C++ code.

Consider further exploration of:

- [Quickstart Installation Guide](/guides/getting-started/quickstart-installation)
- [Using GoogleTest with CMake and Bazel in Real-World Scenarios](/guides/real-world-usage-patterns/integration-with-build-systems)
- [Troubleshooting Common Test Failures](/guides/real-world-usage-patterns/troubleshooting-test-failures)

<br/>
<Check>
Be sure to run your tests locally first with verbose output to confirm integration before pushing to CI.
</Check>

---

## See Also

- [What is GoogleTest?](/overview/intro-value-prop/what-is-googletest)
- [Core Concepts & Terminology](/overview/architecture-concepts/core-concepts-terminology)
- [Writing Your First Test](/getting_started/first_test_and_validation/create_first_test)
- [Feature Overview](/overview/integration-feature-overview/feature-glance)
- [Integration with Build Systems & Other Tools](/overview/integration-feature-overview/integration-build-systems)
- [Mocking Objects and Methods Reference](../api-reference/mocking-actions-matchers/mock-objects-and-methods)

