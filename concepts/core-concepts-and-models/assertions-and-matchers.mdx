---
title: "Assertions and Matchers"
description: "Discover how GoogleTest expresses test intent using a rich language of assertions and matchers. Explore how to check equality, inequality, error conditions, and complex object properties in a composable, readable manner."
---

# Assertions and Matchers

Discover how GoogleTest expresses test intent using a rich language of assertions and matchers. Explore how to check equality, inequality, error conditions, and complex object properties in a composable, readable manner.

---

## Introduction to Assertions

Assertions in GoogleTest are the cornerstone of verifying code correctness. They allow you to express expected conditions in your tests and produce clear, actionable feedback when those conditions are not met.

There are two key categories:

- **EXPECT_** assertions: Generate nonfatal failures and allow the test to continue executing.
- **ASSERT_** assertions: Generate fatal failures and abort the current function immediately.

You can attach custom messages to assertions using the stream operator `<<` to provide more context.

### Basic Boolean Assertions

Use `EXPECT_TRUE(condition)` or `ASSERT_TRUE(condition)` to verify that a condition holds, and similarly `EXPECT_FALSE` / `ASSERT_FALSE` for negation.

```cpp
EXPECT_TRUE(IsValid(x)) << "X failed validation";
ASSERT_FALSE(IsError(y));
```

### Binary Comparison Assertions

GoogleTest offers a comprehensive suite of comparison macros for common relations:

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ` : Equality
- `EXPECT_NE(val1, val2)` / `ASSERT_NE` : Inequality
- `EXPECT_LT(val1, val2)` / `ASSERT_LT` : Less than
- `EXPECT_LE(val1, val2)` / `ASSERT_LE` : Less or equal
- `EXPECT_GT(val1, val2)` / `ASSERT_GT` : Greater than
- `EXPECT_GE(val1, val2)` / `ASSERT_GE` : Greater or equal

Use the appropriate macro to precisely communicate your intent and get expressive failure messages that display the expected and actual values.

### String Assertions

For comparing **C strings** (`const char*`) by content, use:

- `EXPECT_STREQ` / `ASSERT_STREQ` : equal contents
- `EXPECT_STRNE` / `ASSERT_STRNE` : unequal contents
- `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ` : equal ignoring case
- `EXPECT_STRCASENE` / `ASSERT_STRCASENE` : unequal ignoring case

For `std::string`, use the binary comparison macros instead.

### Floating-Point Comparison

Due to rounding, comparing floating-point values requires approximate equality checks:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ` – compares two floats within 4 ULPs.
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ` – compares two doubles similarly.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR` – checks if the absolute difference does not exceed `abs_error`.

These macros prevent obscure failures caused by tiny floating-point inaccuracies.

### Exception Assertions

If exceptions are enabled, GoogleTest supports verifying exception behavior:

- `EXPECT_THROW(statement, ExceptionType)` / `ASSERT_THROW` ensures that the statement throws the specified exception.
- `EXPECT_ANY_THROW` / `ASSERT_ANY_THROW` ensures the statement throws any exception.
- `EXPECT_NO_THROW` / `ASSERT_NO_THROW` ensures the statement does not throw.

You can assert on complex exception handling scenarios with confidence.

### Explicit Success and Failure

Use `SUCCEED()` to indicate a successful assertion explicitly, which can serve as documentation.

Use `FAIL()` to generate a fatal failure immediately.

Use `ADD_FAILURE()` to generate a nonfatal failure without aborting the test.

### Predicate Assertions

When a simple boolean is insufficient, use predicate assertions to enhance diagnostic messages:

- `EXPECT_PREDn(pred, args...)` where `pred` returns `bool` and takes `n` arguments.
- `EXPECT_PRED_FORMATn(pred_formatter, args...)` where `pred_formatter` returns `testing::AssertionResult` and produces custom failure messages.

These enable clearly expressing conditions and getting meaningful output.

---

## Using Matchers for Rich Assertions

Matchers provide a composable, readable syntax to specify expected properties of values or mock function arguments.

### EXPECT_THAT and ASSERT_THAT

Use these macros to assert that a value satisfies a matcher:

```cpp
EXPECT_THAT(value, Eq(5));
ASSERT_THAT(pointer, NotNull());
```

They produce detailed messages highlighting failures.

### Built-in Matchers

Matchers classify into various categories:

- **Wildcard matchers:** `_` (matches anything), `A<T>()` / `An<T>()` (any value of type T)
- **Comparison matchers:** `Eq(value)`, `Ne(value)`, `Lt(value)`, `Gt(value)`, `Le(value)`, `Ge(value)`
- **Pointer matchers:** `IsNull()`, `NotNull()`, `Pointee(m)`, `Pointer(m)`, `Address(m)`
- **String matchers:** `StrEq()`, `StrNe()`, `StrCaseEq()`, `StrCaseNe()`, `HasSubstr()`, `StartsWith()`, `EndsWith()`, `MatchesRegex()`, `ContainsRegex()`
- **Container matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, `SizeIs()`, `Pointwise()`, `Field()` (member variable), `Property()` (getter method)
- **Exception matchers:** `Throws<E>()`, `Throws<E>(m)`, `ThrowsMessage<E>(m)`

For example:

```cpp
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
EXPECT_THAT(str, StartsWith("hello"));
EXPECT_THAT(ptr, NotNull());
```

### Combining Matchers

Combine simple matchers into complex ones with:

- `AllOf(m1, m2, ...)` – matches if all matchers match
- `AnyOf(m1, m2, ...)` – matches if any matcher matches
- `Not(m)` – matches if `m` does not match

Example:

```cpp
EXPECT_THAT(x, AllOf(Gt(0), Lt(10)));  // x in (0, 10)
EXPECT_THAT(y, Not(Eq(0)));            // y != 0
```

### Custom Matchers

Define concise and reusable custom matchers using the `MATCHER` macros:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_THAT(value, IsEven());
```

Parameterized custom matchers allow arguments:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "is divisible by") {
  return (arg % divisor) == 0;
}

EXPECT_THAT(value, IsDivisibleBy(4));
```

For detailed control, you can implement matcher classes directly.

### Using Matchers with Mocking

Matchers are heavily used in defining expectations on mock methods (`EXPECT_CALL` / `ON_CALL`) to specify argument constraints.

Example:

```cpp
EXPECT_CALL(mock, Foo(Ge(5), NotNull()));
```

Matchers make tests more robust, readable, and expressive.

### Practical Matcher Tips

- Use the wildcard matcher `_` when you do not care about an argument.
- Use `Pointee(m)` when validating what a pointer points to.
- Combine simple matchers to express complex requirements.
- Use container matchers (`ElementsAre`, `Contains`, `Each`, etc.) to validate collections.
- Leverage string matchers to verify text content.

---

## Best Practices and Common Pitfalls

### Assertions

- Attach meaningful messages to assertions.
- Prefer typed assertions (`EXPECT_EQ`, `EXPECT_NE`) over `EXPECT_TRUE` with boolean expressions.
- Use predicate-format assertions for more detailed and custom error messages.
- Avoid placing `ASSERT_` in functions returning non-void.

### Matchers

- All matchers must be pure functions with no side effects.
- Use matchers to validate argument properties, not just exact values.
- When mocking overloaded methods, aid the compiler with disambiguation via `Const()` or explicit matcher casts.

### Error Diagnosis

Running tests with `--gmock_verbose=info` enables verbose output showing which expectations were matched by each mock call and stack traces. This aids in debugging matcher misconfigurations.

### Handling Null and Pointers

For pointers, prefer `NotNull()` over `Ne(nullptr)` for clarity.

---

## Example Code

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Eq;
using ::testing::Not;
using ::testing::Ge;
using ::testing::_;
using ::testing::Return;

class MockFoo {
 public:
  MOCK_METHOD(int, Add, (int a, int b), ());
};

TEST(AdditionTest, SimpleAdditions) {
  MockFoo mock;
  EXPECT_CALL(mock, Add(Ge(0), Ge(0))).WillRepeatedly(Return(42));

  EXPECT_THAT(mock.Add(5, 7), Eq(42));
  EXPECT_THAT(mock.Add(10, 20), Not(Eq(0)));
}

MATCHER_P(IsMultipleOf, n, "is multiple of n") {
  return (arg % n) == 0;
}

TEST(CustomMatcherTest, CheckMultiples) {
  int x = 14;
  EXPECT_THAT(x, IsMultipleOf(7));
}
```

---

## Troubleshooting Common Issues

- **Type mismatch in assertions:** Use explicit casts or `SafeMatcherCast` for matchers.
- **Ambiguous calls on overloaded methods:** Disambiguate using `Const()` or specifying matcher types explicitly.
- **Failing to compare strings correctly:** Use `ASSERT_STREQ` / `EXPECT_STREQ` instead of `EXPECT_EQ` for C strings.
- **Matchers not matching as expected:** Run with `--gmock_verbose=info` to see detailed matching information.

---

## Summary

GoogleTest's assertions and matchers offer a comprehensive, expressive language for describing test conditions and verifying program correctness. Mastering these tools empowers you to write clear, maintainable, and robust tests.

---

## See Also

- [Assertions Reference](../reference/assertions.md)
- [Matchers Reference](../reference/matchers.md)
- [Mocking and GoogleMock](../../overview/core-concepts/mocking.mdx)
- [Using Matchers](../../api-reference/advanced-assertions-and-matching/using-matchers.mdx)
- [Advanced Assertions](../../guides/core-workflows/advanced-assertions.mdx)

---

## Additional Resources

- GoogleTest Primer: [Getting Started with Writing Tests](../guides/getting-started/writing-first-test.mdx)
- GoogleMock Cookbook for custom matchers and actions: [gMock Cookbook](../docs/gmock_cook_book.md)
- Troubleshooting Setup: [Troubleshooting Common Setup Issues](../getting-started/troubleshooting-resources/troubleshooting-common-issues.mdx)

---

## Tips for Mastery

- Prefer `EXPECT_THAT` with matchers over basic assertions for complex checks.
- Use predicate assertions (`EXPECT_PRED*`) when you want richer failure messages.
- Write custom matchers to encapsulate frequently repeated validation logic.
- Use `SCOPED_TRACE` for clearer context when assertions occur in helper functions.
- Disambiguate overloaded mock methods to avoid compiler errors.
- Use floating-point comparison macros (`EXPECT_FLOAT_EQ`, `EXPECT_NEAR`) instead of `EXPECT_EQ` to avoid flaky tests.
- Refer to verbose test output with `--gmock_verbose=info` to understand matcher behavior.

---

_This guide equips you with the language and techniques to express test expectations precisely and readably, enabling confident validation of C++ code behavior._
