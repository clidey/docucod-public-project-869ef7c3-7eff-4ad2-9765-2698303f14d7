---
title: "Assertions and Failure Handling"
description: "Understand the different assertion types, the distinction between fatal and non-fatal failures, and how GoogleTest and GoogleMock signal and report errors during test execution. Learn how this architecture supports robust tests and continuous integration."
---

# Assertions and Failure Handling

GoogleTest and GoogleMock provide a comprehensive mechanism for verifying code correctness during test execution through assertions and failure handling strategies. This page explains the types of assertions available, the distinction between fatal and non-fatal failures, and the way errors and failures are signaled and reported by the framework. Understanding this architecture empowers you to write robust tests, interpret test results effectively, and integrate seamlessly with continuous integration systems.

---

## 1. Types of Assertions in GoogleTest

Assertions are the primary means to check program correctness within your tests. GoogleTest categorizes assertions into pairs of macros with `EXPECT_` and `ASSERT_` variants:

- **`EXPECT_` Assertions (Non-Fatal Failures):** Failures cause the current assertion to fail but allow the test to continue executing. Use these when you want the test to report multiple failures in a single run.
- **`ASSERT_` Assertions (Fatal Failures):** Failures immediately abort the current function, preventing further execution. Use these to stop tests on critical failure conditions.

This distinction supports writing tests that are both informative and controllable regarding failure handling.

### 1.1 Built-in Assertion Categories

GoogleTest provides a rich set of built-in assertions categorized as follows:

- **Boolean Checks:** `EXPECT_TRUE(condition)`, `ASSERT_FALSE(condition)` to validate boolean expressions.
- **Binary Comparisons:** `EXPECT_EQ(val1, val2)`, `ASSERT_LT(val1, val2)` and variants to compare values.
- **String Comparisons:** `EXPECT_STREQ(str1, str2)` to compare C strings by content, plus case-insensitive variants.
- **Floating Point Comparisons:** `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ` along with `EXPECT_NEAR` for approximate equality with ULP or absolute error tolerance.
- **Exception Assertions:** `EXPECT_THROW`, `ASSERT_NO_THROW`, etc., for testing C++ exception behavior.
- **Predicate Assertions:** Allow passing custom predicate functions/functors returning a boolean or `AssertionResult` to provide clear success/failure diagnostics.
- **Death Assertions:** `EXPECT_DEATH`, `ASSERT_EXIT`, etc., to test that code terminates the process correctly, useful for validating error handling and abort conditions.
- **HRESULT Assertions (Windows):** Assertions designed for verifying Windows `HRESULT` success/failure results.

### Example: Non-fatal vs Fatal Failure

```cpp
EXPECT_TRUE(pointer != nullptr) << "Pointer should not be null";  // Test continues if fails
ASSERT_NE(value, 0) << "Value must not be zero";             // Test aborts current function if fails
```

### 1.2 Explicit Success and Failure

- `SUCCEED()` generates a success record but does not mark the overall test as passed.
- `FAIL()` generates a fatal failure and aborts the current function.
- `ADD_FAILURE()` and `ADD_FAILURE_AT(file, line)` generate nonfatal failures and continue execution.

---

## 2. Fault Handling: Fatal vs Non-Fatal Failures

Your choice between assertion macros should reflect the importance of a failure:

- **Fatal failures** abruptly stop execution of the current function (commonly your test body or a subroutine). They are essential when continuing is meaningless or unsafe.
- **Non-fatal failures** log failure details but allow the rest of your test to execute, enabling detection of multiple issues in a single run.

GoogleTest reports the aggregated results at the test and test suite level. This dichotomy enables finer control for test authors.

### Propagating Fatal Failures in Subroutines

Since fatal failures abort only the current function, a common pitfall is to write fatal assertions inside helper functions expecting to abort the entire test. GoogleTest provides the following facilities:

- Use `ASSERT_NO_FATAL_FAILURE(function_call());` to ensure that `function_call()` does not generate any fatal failures.
- Use `HasFatalFailure()` to check if any fatal failure has occurred so far in the test and decide whether to abort early.

### Tips

- Avoid placing fatal assertions inside constructors or destructors; they do not abort the test as you might expect.
- Use `SetUp` or `TearDown` methods of test fixtures for such checks.

---

## 3. GoogleMock Assertions and Failure Reporting

GoogleMock extends GoogleTest's assertion system with expectations and sophisticated failure handling for mock interactions.

### 3.1 Expectations and Calls

- `EXPECT_CALL(mock_obj, Method(matchers))` sets expectations on mock method calls with argument matchers.
- Calls to mock methods that do not match any `EXPECT_CALL` or that violate cardinality expectations generate failures.

An unexpected call occurs when a mock method with expectations is called with arguments not matching any active expectation â€” this always produces an error.

### 3.2 Uninteresting Calls and Mock Behavior Modes

- Calls to mock methods without matching expectations are called *uninteresting*.
- By default, gMock issues warnings on uninteresting calls (the *naggy* behavior).
- You can use `NiceMock<T>` to suppress these warnings or `StrictMock<T>` to treat them as failures.
- This behavior only affects uninteresting calls; unexpected calls remain errors in all modes.

### 3.3 Actions and Verbose Logging

- You define mock behavior using `ON_CALL()` for default actions and `EXPECT_CALL()` for expected calls with specified actions (e.g., `WillOnce()`, `WillRepeatedly()`).
- The verbosity level can be controlled by the `--gmock_verbose` flag (`info`, `warning`, `error`) to toggle how much mock call information and warnings appear.

---

## 4. Messaging and Diagnostic Outputs

When assertions fail, GoogleTest and GoogleMock generate detailed diagnostic messages to aid debugging:

- They print the expressions tested and their evaluated values.
- Failures include file and line information.
- Stack traces are included as appropriate to show error origins.
- For GoogleMock, call argument values, return values, expectation states, and matching info are displayed.

### Example Failure Message

```none
Value of: foo.GetValue()
  Actual: 3
Expected: 5
Stack trace: ...
```

---

## 5. Writing Tests to Use Assertions Effectively

- Use non-fatal assertions when you want to detect multiple independent failures in a test.
- Use fatal assertions to stop tests early when subsequent execution would be meaningless or cause crashes.
- Use `EXPECT_NO_FATAL_FAILURE()` to verify subroutine calls that may include fatal assertions do not fail fatally.
- Use custom predicate assertions and matchers for clearer error messages.

---

## 6. Catching Failures in Test Code

If you want to verify that a particular statement generates a failure, for example when testing testing utilities, GoogleTest provides special macros:

- `EXPECT_FATAL_FAILURE(statement, "substring")` asserts that `statement` generates a fatal failure with the substring in its message.
- `EXPECT_NONFATAL_FAILURE(statement, "substring")` asserts a non-fatal failure.

There are `_ON_ALL_THREADS` variants for checking failures occurring in any threads.

---

## 7. Continuous Integration & Robust Tests

Robust failure signaling and reporting aids automated test environments:

- Clear distinction between fatal and non-fatal failures allows CI systems to detect critical issues immediately.
- Detailed failure messages accelerate triaging and debugging.
- GoogleTest's XML and JSON output formats capture failure details for CI reporting tools.
- Test sharding, repeat, and filtering enable scalable testing workflows.

---

## References

- Detailed list of [Assertions](reference/assertions.md)
- GoogleMock [Mocking Reference](reference/mocking.md)
- Advanced [GoogleTest Topics](docs/advanced.md#catching-failures)
- GoogleMock [Cookbook](docs/gmock_cook_book.md#KnowingWhenToExpectUseOnCall) for best practices on expectations
- [Running and Validating Tests](getting-started/first-steps-with-tests/running-tests)

---

## Summary

This document demystifies how assertions and failure handling operate within GoogleTest and GoogleMock, emphasizing the critical distinction between fatal and non-fatal failures. It also details GoogleMock's extended failure reporting, mock behavior modes, and facilities to verify assertions in tests themselves. Through a clear understanding of this architecture, you gain the ability to author resilient, maintainable, and CI-friendly tests.

<Tip>
For further mastery, start with the [Assertions Reference](reference/assertions.md) to learn macro specifics, and consult the [Mocking Reference](reference/mocking.md) to understand mock behavior. For practical usage, review guides on [Writing Your First Test](guides/core_testing_workflows/writing_first_test) and [Using GoogleMock](guides/core_testing_workflows/using_googlemock).
</Tip>

---