---
title: "Test Case and Suite Structure"
description: "Learn how tests are organized using suites and fixtures in GoogleTest. Understand how the framework registers test cases, runs them, and manages shared setup and teardown logic through fixtures to create robust, maintainable code."
---

# Test Case and Suite Structure

Understanding how GoogleTest organizes tests into cases and suites is foundational for writing maintainable, scalable, and robust test code. This guide explains how tests, test suites, fixtures, and their relationships form the core architecture of GoogleTest’s testing model.

---

## Overview: Tests, Test Suites, and Fixtures

In GoogleTest:

- A **Test** is an individual function that verifies a specific aspect of your code's behavior.
- A **Test Suite** (formerly known as Test Case) groups related tests together. It shares a common name and optionally shares test fixtures.
- A **Test Fixture** is a C++ class allowing tests in the same test suite to reuse common setup and teardown code and maintain shared data.

Typically, the test suite name reflects the class or module you're testing, making test results easier to interpret.

---

## Writing Tests Using GoogleTest Macros

### Simple Tests with `TEST`

When you need quick, simple tests without shared state, use the `TEST` macro:

```cpp
TEST(TestSuiteName, TestName) {
  // Your test code here
  EXPECT_EQ(Foo(), 42);
}
```

- The first argument is the test suite name.
- The second is the individual test’s name.

*Important:* Both names must be valid C++ identifiers and should not contain underscores to avoid naming collisions or GoogleTest internal conflicts.

---

### Tests with Fixtures: Reusing Setup and Teardown with `TEST_F`

Often, tests need to share setup or common objects. Defining a test fixture class derived from `testing::Test` enables this:

```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    // Set up initial state
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  Queue<int> q0_;
  Queue<int> q1_;
  Queue<int> q2_;
};

TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  // Test dequeue behavior
}
```

When using `TEST_F`, GoogleTest creates a fresh instance of your fixture class for each test, invokes `SetUp()` (if overridden), runs the test, then calls `TearDown()` before destruction. This isolation ensures tests don’t interfere with each other by sharing state.

---

## How GoogleTest Registers and Runs Tests

Every use of `TEST` or `TEST_F` registers a new test with the framework automatically. The framework maintains these in collections of test suites and associated tests:

- Each test suite holds a vector of test information objects.
- Upon running tests with `RUN_ALL_TESTS()`, GoogleTest:
  1. Creates a new instance of the fixture class (or anonymous test object for `TEST`).
  2. Calls `SetUp()`.
  3. Executes the test body.
  4. Calls `TearDown()`.
  5. Deletes the instance.

This lifecycle repeats uniquely per test, ensuring clean, isolated test execution.

---

## Shared Setup and Teardown: Test Fixtures in Depth

### Per-test Setup/Teardown

- Override `SetUp()` to allocate or configure objects freshly before every test.
- Override `TearDown()` to clean up any resources after every test.

### Per-suite (Static) Setup/Teardown

For expensive or shared resources, GoogleTest supports running setup and teardown once for the entire test suite:

```cpp
class FooTest : public testing::Test {
 protected:
  static void SetUpTestSuite() {
    // Global set-up, called once before first test
    shared_resource_ = new ExpensiveObject();
  }

  static void TearDownTestSuite() {
    // Global tear-down, called once after last test
    delete shared_resource_;
    shared_resource_ = nullptr;
  }

  void SetUp() override { /* per-test setup */ }
  void TearDown() override { /* per-test teardown */ }

  static ExpensiveObject* shared_resource_;
};

ExpensiveObject* FooTest::shared_resource_ = nullptr;
```

Remember:
- Each test is still isolated.
- Shared resources must be handled carefully to avoid leaks or inconsistent states.

---

## Organizing Complex Test Suites

GoogleTest accommodates advanced structuring patterns:

- **Typed Tests** (`TYPED_TEST_SUITE`, `TYPED_TEST`): run the same tests across multiple types.
- **Value-Parameterized Tests** (`TEST_P`, `INSTANTIATE_TEST_SUITE_P`): run tests with multiple input values.

These features facilitate wide test coverage with minimal boilerplate, aligning with systematic testing approaches.

---

## Summary of Important Concepts

| Concept               | Description                                                                                         |
|-----------------------|-------------------------------------------------------------------------------------------------|
| Test                  | Individual test function verifying some behavior                                                |
| Test Suite            | Collection grouping related tests, bearing a common name and fixture                            |
| Test Fixture          | C++ class deriving from `testing::Test` providing shared setup/teardown and common data        |
| `TEST` macro          | Defines a simple test without fixture                                                            |
| `TEST_F` macro        | Defines a test using a test fixture                                                              |
| `SetUp` / `TearDown`  | Fixture hooks for per-test initialization and cleanup                                            |
| `SetUpTestSuite` / `TearDownTestSuite` | Static hooks for once-per-suite setup/teardown                                       |

---

## Practical Tips and Best Practices

- **Use fixtures (`TEST_F`) when tests share data or setup logic.** This avoids duplication and makes tests easier to maintain.
- **Keep test suites well-scoped and descriptive.** Match suite names to the components under test.
- **Avoid underscores in test and suite names** to prevent internal naming conflicts.
- **Use `SetUpTestSuite()` sparingly only for expensive shared resources.** Ensure correct deallocation in `TearDownTestSuite()`.
- **Remember each test has a fresh fixture instance.** Do not rely on state leakage between tests.
- **Name tests and suites following Google C++ style guides** for readability and consistency.

---

## Common Pitfalls and Troubleshooting

- **Missing default constructor in fixture:** Each fixture class must have a default constructor (defined or generated). Otherwise, `TEST_F` will fail to compile.
- **Overusing global variables:** Prefer fixtures for managing state; globals can cause test interdependencies and flakiness.
- **Misusing `ASSERT` in non-void functions or constructors:** `ASSERT_*` macros abort the current function, so they are only valid in `void` functions; constructors and destructors cannot use fatal assertions.
- **Shared resource leaks:** Not deleting or resetting shared resources in `TearDownTestSuite()` may cause memory leaks.
- **Tests not running:** Ensure test names conform to GoogleTest naming conventions.

---

## Example: Defining a Test Fixture with Multiple Tests

```cpp
class StackTest : public testing::Test {
 protected:
  void SetUp() override {
    stack_.push(42);
  }

  std::stack<int> stack_;
};

TEST_F(StackTest, IsNotEmptyAtStart) {
  EXPECT_FALSE(stack_.empty());
}

TEST_F(StackTest, PopRemovesElement) {
  stack_.pop();
  EXPECT_TRUE(stack_.empty());
}
```

*How this works:*

1. For each test, an independent `StackTest` object is created.
2. `SetUp()` initializes the stack with an element.
3. The test function runs using this fresh state.
4. The object is cleaned up.

---

## Further Reading & Cross References

- [GoogleTest Primer](primer.md): Introduction and basics of writing tests
- [Advanced GoogleTest Topics](advanced.md): Learn about fixtures, parameterized tests, death tests
- [Testing Reference](testing.md): Complete API reference, including test macros and classes
- [Parameterized and Typed Tests](testing.md#parameterized-and-typed-tests): How to systematically run tests with parameters or types
- [Common Setup and Build Errors](faq/getting-started-issues/faq-common-setup-errors): Troubleshooting build and naming problems

To fully master test architecture in GoogleTest, supplement this page with hands-on exploration of Test Fixtures, Parameterized and Typed Tests, and understanding the advanced lifecycle methods.

---

## Diagram: Simplified Test Execution Flow

```mermaid
flowchart TD
  Start([Test Execution Start]) --> Init[Initialize Test Framework]
  Init --> LoadSuites[Load Test Suites & Tests]
  LoadSuites --> SelectTests{Apply Filters & Select Tests}
  SelectTests -->|Test 1| CreateFixture1[Create Fixture Instance]
  CreateFixture1 --> SetUp1[Call SetUp()]
  SetUp1 --> RunTest1[TestBody()]
  RunTest1 --> TearDown1[Call TearDown()]
  TearDown1 --> DeleteFixture1[Delete Fixture Instance]
  DeleteFixture1 --> NextTest{More Tests?}
  NextTest -->|Yes| CreateFixtureN[Create Fixture Instance]
  NextTest -->|No| Finish[Finalize & Report Results]
  Finish --> End([Test Execution End])
```

---

## Summary

GoogleTest’s test case and suite structure centers on grouping related tests into test suites that optionally share setup and teardown logic via test fixtures. The framework manages the lifecycle of each test independently for clean, repeatable test runs. Understanding this architecture empowers users to build scalable test suites that clearly reflect their software’s modular structure.

---

## Code Location

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/advanced.md", "range": "1-665"},{"path": "docs/primer.md", "range": "1-203"},{"path": "docs/testing.md", "range": "1-900"}]} />
