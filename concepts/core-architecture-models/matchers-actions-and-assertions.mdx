---
title: "Matchers, Actions, and Assertions"
description: "Dive into the expressive assertion and matching system powering both test verification and mock expectations. Understand how matchers work, how actions define mock behaviors, and how assertions communicate pass/fail states, including custom matcher composition."
---

# Matchers, Actions, and Assertions

Explore the core expressive assertion and matching system that powers verification of test behavior and mock expectations in GoogleTest and GoogleMock. This guide helps you understand how matchers inspect argument values, how actions define mock method behaviors, and how assertions communicate test outcomes. You'll also learn about composing custom matchers to refine your verification strategies.

---

## 1. Introduction to Matchers, Actions, and Assertions

Testing behavior and interactions requires precise and readable verification. GoogleMock facilitates this via:

- **Matchers**: Define conditions that arguments must satisfy to count as a valid call.
- **Actions**: Specify what a mock method does when invoked — returning values, modifying arguments, invoking callbacks, etc.
- **Assertions**: Confirm whether the values or states meet expectations, providing clear pass/fail feedback.

These components form the foundation for expressive and maintainable tests.

---

## 2. Matchers: Specifying Expected Arguments

Matchers serve to validate function arguments by matching them against defined criteria.

### 2.1 Basics of Matchers

- A matcher is like a predicate that either accepts or rejects an argument value.
- For example, `_` matches any argument (wildcard matcher).
- Literals (e.g., `5`) are also valid matchers, interpreted as equality matchers.

```cpp
using ::testing::_;
EXPECT_CALL(mock_obj, Foo(42));       // Matches calls where Foo is called with 42
EXPECT_CALL(mock_obj, Bar(_));         // Matches calls with any argument
```

### 2.2 Built-in Matchers

GoogleMock offers a rich set of pre-defined matchers:

- **Universal Matchers:** `_`, `ByRef`, `Ref`.
- **Equality Matchers:** `Eq()`, `Ne()`, `StrEq()`, `StrCaseEq()`, etc.
- **Comparison Matchers:** `Lt()`, `Le()`, `Gt()`, `Ge()`.
- **String Matchers:** `HasSubstr()`, `StartsWith()`, `EndsWith()`, `MatchesRegex()`.
- **Pointer Matchers:** `IsNull()`, `NotNull()`, `Pointee()`.
- **Container Matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Pair()`.
- **Tuple and Argument Matchers:** `Args<>`, `AllOf()`, `AnyOf()`, `Not()`, `With()`.

For detailed lists, see the [Matchers Reference](reference/matchers.md).

### 2.3 Composing Matchers

Matchers can be combined to form logical unions or intersections:

```cpp
EXPECT_CALL(mock_obj, Foo(AllOf(Ge(0), Lt(10))));
EXPECT_CALL(mock_obj, Bar(AnyOf(Eq("a"), Eq("b"))));
```

This expresses constraints like "value greater or equal to 0 and less than 10" or "value is either 'a' or 'b'".

### 2.4 Custom and Parameterized Matchers

You can define your own matchers for reuse and clarity:

```cpp
MATCHER(IsDivisibleBy7, "is divisible by 7") { return (arg % 7) == 0; }

EXPECT_CALL(mock_obj, Foo(IsDivisibleBy7()));
```

For parameterized matchers with arguments, use `MATCHER_P`, `MATCHER_P2`, etc.

---

## 3. Actions: Defining Mock Behavior

An action tells a mock method what to do when called, including returning values, modifying arguments, invoking callbacks, etc.

### 3.1 Default Actions

- Mock methods with a return type have an implicit default action returning a default value.
- You can customize default behavior at method level with `ON_CALL()`.

### 3.2 Specifying Actions in `EXPECT_CALL`

You set what a mock method does with:

- `.WillOnce(action)`: Specifies behavior for a single call.
- `.WillRepeatedly(action)`: Specifies behavior for all subsequent calls after `WillOnce`s are exhausted.

Example:
```cpp
EXPECT_CALL(mock_obj, GetValue())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### 3.3 Built-in Action Types

- `Return(value)`: Returns a copy of `value`.
- `ReturnRef(variable)`: Returns a reference to a variable.
- `ReturnPointee(pointer)`: Returns the value pointed to by `pointer` at call time.
- `SetArgPointee<N>(value)`: Sets the N-th argument (pointer) to `value`.
- `Invoke(callable)`: Calls a function, method, lambda, or functor.
- `DoAll(action1, action2, ...)`: Performs multiple actions in sequence; return of the last action is used.
- `InvokeArgument<N>(args...)`: Invokes the N-th argument assuming it is a callable.

For comprehensive action list and examples, see [Actions Reference](actions.md).

### 3.4 Writing Custom Actions

You can easily create custom actions using lambdas or functors matching the mocked function signature.

```cpp
EXPECT_CALL(mock_obj, DoStuff())
    .WillOnce([] { DoComplexStuff(); return true; });
```

You can also use `ACTION` macros to define reusable actions.

---

## 4. Assertions: Verifying Outcomes Using Matchers

Assertions verify actual values against expected conditions, reporting success or failure.

### 4.1 Basic Assertions

Common assertions include:

- `EXPECT_TRUE(condition)`
- `EXPECT_EQ(val1, val2)`
- `EXPECT_NE(val1, val2)`

These macros can generate **fatal** (`ASSERT_`) or **non-fatal** (`EXPECT_`) failures.

### 4.2 Using Matchers in Assertions

For richer assertions, use `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)`.

Example:
```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(number, AllOf(Gt(5), Lt(10)));
```

### 4.3 Writing Custom Predicate Assertions

When you need complex logic with detailed messages, define predicates returning `::testing::AssertionResult`.

Example:
```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is not even";
}

EXPECT_TRUE(IsEven(value));
```

### 4.4 Assertion Results and Messages

Assertion macros print clear failure messages including values and the expectation, aiding quick diagnoses of failed tests.

For the full set of assertions and their semantics, see the [Assertions Reference](reference/assertions.md).

---

## 5. How These Pieces Work Together

### User Workflow Example

1. **Define Mock Classes:** Use `MOCK_METHOD` macros to create mock classes implementing interfaces.
2. **Set Expectations (`EXPECT_CALL`):** Specify how mocks are expected to be called and what actions they take.
3. **Set Default Behavior (`ON_CALL`):** Define default actions for mock methods that are called but not explicitly expected.
4. **Exercise Code Under Test:** Run code that interacts with mocks.
5. **Verify Assertions:** GoogleMock automatically verifies expectations when mocks are destructed.

### Example Test Code

```cpp
using ::testing::Return;

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
};

TEST(FooTest, GetValueReturnsExpectedSequence) {
  MockFoo mock;

  ON_CALL(mock, GetValue()).WillByDefault(Return(0));

  EXPECT_CALL(mock, GetValue())
      .WillOnce(Return(1))
      .WillOnce(Return(2))
      .WillRepeatedly(Return(3));

  EXPECT_EQ(1, mock.GetValue());
  EXPECT_EQ(2, mock.GetValue());
  EXPECT_EQ(3, mock.GetValue());
  EXPECT_EQ(3, mock.GetValue());
}
```

This test sets up default and explicit behaviors, then verifies calls return expected results.

---

## 6. Custom Matcher Composition

When existing matchers are not enough, you can build complex matchers by combining or defining new matchers:

- Use `AllOf()`, `AnyOf()`, `Not()` to combine other matchers logically.
- Define parameterized matchers with `MATCHER_Pk` macros.
- Implement matcher classes with `MatchAndExplain()` and description functions.

Example of composite matcher:

```cpp
MATCHER_P2(InClosedRange, low, high, "") {
  return arg >= low && arg <= high;
}

EXPECT_THAT(value, InClosedRange(5, 10));
```

This technique enables expressive domain-specific verification.

---

## 7. Troubleshooting & Best Practices

- **Set Expectations Before Code Exercise:** Always declare `EXPECT_CALL`s before exercising code using mocks.
- **Avoid Excessive Expectations:** Overly strict expectations cause fragile tests.
- **Use `_` Wildcard When Argument is Unimportant:** To reduce brittleness.
- **Leverage `NiceMock` and `StrictMock` Appropriately:** Balance between noisy warnings and strict failure reports.
- **Prefer `ON_CALL` for Default Behavior:** Use `EXPECT_CALL` only to verify interactions you care about.
- **Use `RetiresOnSaturation()` to Disable Expectations After Use:** Useful for sequential calls.
- **Compose Matchers and Actions for Clarity:** Encapsulate complex logic into named matchers and actions.

---

## See Also

- [Mocking Reference](reference/mocking.md) for detailed macros and classes.
- [Matchers Reference](reference/matchers.md) for all built-in matchers.
- [Actions Reference](actions.md) to explore built-in and custom actions.
- [Assertions Reference](reference/assertions.md) for comprehensive assertions overview.
- gMock Cookbook ([docs/gmock_cook_book.md](docs/gmock_cook_book.md)) for recipes and examples.

---

This conceptual understanding empowers you to craft maintainable, readable, and robust tests that accurately capture and verify your program’s behavior through expressive matchers, precise mock behaviors, and clear assertions.