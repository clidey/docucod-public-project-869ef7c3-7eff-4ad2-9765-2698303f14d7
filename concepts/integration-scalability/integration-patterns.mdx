---
title: "Integration Patterns and Toolchains"
description: "Discusses typical integration strategies with build systems (CMake, Bazel), CI/CD pipelines, and external dependencies. Outlines approaches for embedding GoogleTest and GoogleMock in diverse development environments."
---

# Integration Patterns and Toolchains

This guide covers common strategies for integrating GoogleTest and GoogleMock into your build systems, continuous integration/deployment (CI/CD) pipelines, and external dependencies. It focuses specifically on embedding the frameworks within popular build tools like CMake and Bazel and outlines approaches that enable seamless and maintainable test integration in diverse development environments.

---

## Understanding Integration Needs

Integrating GoogleTest and GoogleMock effectively requires adapting to your existing build system and automation infrastructure. Your goals are to:

- Compile and link GoogleTest/GoogleMock correctly alongside your production code.
- Maintain manageable source tree organization to ease project maintenance.
- Enable reliable automatic test discovery and execution.
- Support CI/CD pipelines by facilitating automated builds and test runs.
- Handle external dependencies to avoid brittle or complex setups.

This guide introduces proven integration patterns tailored for typical workflows.

---

## Integration with Build Systems

### CMake Integration

CMake is the most commonly used build system for C++ projects integrating GoogleTest. Here’s a typical approach:

1. **Add GoogleTest as an external dependency:**
   - Use `FetchContent` or add GoogleTest as a git submodule.
   - Prefer to build googletest along with your project to handle compiler and platform compatibility automatically.

2. **Link test targets with GoogleTest and GoogleMock libraries:**

   ```cmake
   enable_testing()
   
   add_subdirectory(googletest)

   add_executable(my_tests test_main.cc my_test.cc)
   target_link_libraries(my_tests gtest gmock pthread) # pthread for POSIX systems

   add_test(NAME MyTests COMMAND my_tests)
   ```

3. **Organize test code cleanly:**
   - Separate test sources from production sources.
   - Keep mocks and test helpers isolated in dedicated test directories.

4. **Common CMake pitfalls to avoid:**
   - Ensure consistent compiler and C++ standard flags between your code and GoogleTest.
   - Link with required threading libraries (`pthread` on Linux, Windows equivalent if needed).
   - Do not mix Debug and Release builds inadvertently.

### Bazel Integration

For projects using Bazel, GoogleTest and GoogleMock are well-supported:

- Declare googletest as an external repository.
- Use `cc_test` rules for your tests, specifying dependencies on `@com_google_googletest//:gtest_main` and `@com_google_googletest//:gmock`.

Example snippet in `BUILD`:

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"],
)
```

Advantages:

- Bazel handles dependency resolution, reproducibility, and parallel builds.
- Simplifies test execution in CI environments.

---

## CI/CD Pipeline Integration

GoogleTest binaries can be integrated into any CI/CD pipeline that supports executing shell commands or scripts.

### Typical workflow:

1. **Build your tests:**
   - Use your configured build system (e.g., CMake, Bazel) to compile test binaries.

2. **Run tests automatically:**
   - Execute the test runner (compiled test binary). GoogleTest supports output formats that CI systems can parse (e.g., XML via `--gtest_output=xml:report.xml`).

3. **Fail fast and generate reports:**
   - Configure the CI to fail the build if tests fail.
   - Publish test reports for visibility.

### Best Practices:

- Keep tests fast and reliable by mocking external dependencies.
- Run tests in parallel when supported.
- Integrate with sanitizer tools or code coverage for enhanced insight.

---

## Managing External Dependencies

GoogleTest and GoogleMock are often integrated as external dependencies.

### Approaches to manage dependencies:

- **Use Package Managers:**
  - For CMake, consider CPM.cmake or Hunter package manager to fetch GoogleTest.

- **Git Submodules:**
  - Include GoogleTest as a git submodule within your repo, making updates explicit.

- **Vendor the Code:**
  - Directly include GoogleTest source within your project’s directory structure.

Each approach has trade-offs about control, update complexity, and build isolation. Choose based on your project needs.

---

## Embedding GoogleTest and GoogleMock in Your Environment

### Key integration considerations:

- **Mock Organization:**
  - Define mocks close to the code under test when possible,
  - If mocking third-party interfaces, place mocks in appropriate dedicated test packages or directories to avoid duplication and ease maintenance.

- **Linkage:**
  - Link tests against both `gtest` and `gmock` libraries.
  - Include GoogleTest's main where you want test binaries to autolaunch.

- **Compiler and Platform Compatibility:**
  - Use compatible compiler versions and enable required C++17 support.

- **Test Discovery:**
  - GoogleTest automatically discovers tests by linking test binary with the framework; no manual enumeration is necessary.

---

## Common Troubleshooting Tips

- **Linker Errors:**
  - Verify correct linking order of libraries.
  - Ensure all source files with test or mock code are included in the target.

- **Missing Tests:**
  - Confirm tests are registered (via `TEST` macros).
  - Check build includes test targets and is executed.

- **Compiler Issues:**
  - Confirm C++ standard version matches requirements.
  - Check platform-specific flags.

- **Runtime Failures:**
  - Use `--gmock_verbose=info` to get detailed mock expectation traces.

---

## References and Next Steps

To deepen your understanding and implementation of GoogleTest and GoogleMock in your build and test environment, consult the following key documentation:

- [Using GoogleTest and GoogleMock in Your Build System](../guides/real-world-integration/using-google-test-in-your-build-system.md)
- [Configuring Projects with GoogleTest](../getting-started/setup-prerequisites-installation/configuring-projects-with-googletest.md)
- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting-faq-support/common-setup-errors.md)
- [gMock for Dummies](../docs/gmock_for_dummies.md) for mock usage patterns

These resources provide detailed code examples, explanations, and advanced patterns to ensure successful integration tailored to your environment.

---

If you encounter specific integration obstacles, the wider GoogleTest community and issue trackers offer active support and insights.

---

*This guide emphasizes practical integration approaches from a user’s perspective to help you embed GoogleTest and GoogleMock within your existing development workflows, accelerating reliable C++ test development and automation.*