---
title: "Build System Integration"
description: "Survey supported integration patterns with modern C++ build systems (CMake, Bazel). Understand key configuration, dependency management, and platform compatibility considerations for seamless adoption."
---

# Build System Integration

GoogleTest supports seamless integration with modern C++ build systems, focusing primarily on CMake and Bazel. This page provides a survey of common patterns for incorporating GoogleTest and GoogleMock into your build workflows, covering essential configuration details, dependency management strategies, and platform compatibility considerations to ensure smooth adoption.

---

## Why Integrate GoogleTest with Your Build System?

Integrating GoogleTest directly into your build environment allows you to:

- Automate the compilation and linking of test binaries alongside your application code.
- Manage dependencies on GoogleTest and GoogleMock libraries efficiently.
- Leverage familiar build tooling features like incremental builds, parallel execution, and platform-specific configuration.
- Enable easy test execution and integration with continuous integration (CI) pipelines.

Proper integration ensures your test suite naturally evolves with your project, promoting continuous testing and code quality.

---

## Integration Patterns by Build System

### CMake Integration

GoogleTest provides official support for CMake with versatile options to integrate it either as a standalone project or embedded as part of your existing project.

#### Standalone GoogleTest Build

This pattern is useful if you want to build and install GoogleTest separately and then link your tests against the installed libraries.

Typical steps include:

1. Clone the repository:
   ```bash
   git clone https://github.com/google/googletest.git -b v1.17.0
   cd googletest
   mkdir build && cd build
   cmake ..
   make
   sudo make install
   ```
   > By default, this also builds GoogleMock. To disable GoogleMock, run:
   > ```
   > cmake .. -DBUILD_GMOCK=OFF
   > ```

2. In your project’s `CMakeLists.txt`, find and link GoogleTest:
   ```cmake
   find_package(GTest CONFIG REQUIRED)
   target_link_libraries(your_test_target PRIVATE GTest::gtest GTest::gtest_main)
   ```

This approach lets you maintain a clear separation between your project and GoogleTest’s codebase.

#### Adding GoogleTest as a Subdirectory

For tighter integration ensuring consistent compiler and linker settings, especially useful on platforms like Windows, you can add GoogleTest's source code inside your project structure.

Basic approach:

1. Include GoogleTest source as a git submodule or download it into a known directory.
2. Add the following in your `CMakeLists.txt`:

   ```cmake
   add_subdirectory(path/to/googletest)
   add_executable(your_test example_test.cpp)
   target_link_libraries(your_test gtest_main)

   enable_testing()
   add_test(NAME your_test COMMAND your_test)
   ```

This method automatically builds GoogleTest along with your tests, mitigating issues related to mismatched compiler flags or runtimes.

#### FetchContent for Dynamic Download

You can automate fetching GoogleTest during your project's configuration step:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# For Windows compatibility with dynamic CRT
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example gtest_main)
add_test(NAME example_test COMMAND example)
```

This approach requires CMake 3.14 or later and helps keep dependencies up to date.

#### Key CMake Options and Tips

- **gtest_force_shared_crt**: On Windows, setting this option enables GoogleTest to link against the dynamic runtime libraries to match common project settings.
- **C++ Standard**: GoogleTest requires a C++17-compatible compiler. Make sure to set `CMAKE_CXX_STANDARD 17` and `CMAKE_CXX_STANDARD_REQUIRED ON` in your top-level `CMakeLists.txt`.
- **Using gtest_main**: Link with `gtest_main` to use the provided main() function from GoogleTest, simplifying your test code.
- **Custom main()**: If you write your own `main()`, ensure it calls `testing::InitGoogleTest(&argc, argv);` before `RUN_ALL_TESTS()`.

#### Example: Minimal CMakeLists.txt for Tests

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTests LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(test_runner test_example.cpp)
target_link_libraries(test_runner gtest_main)

enable_testing()
add_test(NAME test_runner COMMAND test_runner)
```

---

### Bazel Integration

Bazel users can leverage rules and workspace configurations to integrate GoogleTest.

- GoogleTest's build files are included in the official repository.
- You can add GoogleTest as an external dependency and define test targets using `cc_test`.

Example Bazel WORKSPACE snippet:

```bazel
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.11.0.tar.gz"],
    strip_prefix = "googletest-release-1.11.0",
)
```

Example BUILD file for tests:

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

This allows you to run your test suite with `bazel test //:my_test`, benefiting from Bazel’s build graph optimization.

---

## Dependency Management

Managing dependencies on GoogleTest and GoogleMock correctly avoids build errors and ensures consistent testing behavior.

- Always link test targets with `gtest` or `gtest_main` as appropriate.
- If using GoogleMock features, link with `gmock` and `gmock_main` or your custom main.
- Ensure compatibility between library versions and your compiler.
- Avoid mixing static and shared linkage unless necessary and fully understood.

---

## Platform Compatibility Considerations

- GoogleTest requires a compiler supporting C++17 or later.
- Supported platforms include Linux, Windows, macOS, and select embedded systems.
- Thread safety requires `pthreads` or equivalent; configure accordingly.
- On Windows, watch for runtime library conflicts; use `gtest_force_shared_crt` when linking dynamically.

---

## Practical Tips and Best Practices

- **Use Provided Main**: Link with `gtest_main` or `gmock_main` to avoid writing boilerplate `main()` functions.
- **Verify Build Environment**: Use the GoogleTest `gtest-` and `gmock-` libraries that match your project’s build configuration (debug/release).
- **Avoid Multiple Calls to RUN_ALL_TESTS()**: Call this function only once to prevent unexpected behavior.
- **Manage Dependencies via Submodules or Package Managers**: This facilitates repeatable builds and easier updates.
- **Use FetchContent for Simplicity When Using CMake**.
- **Check for Thread Support**: On some platforms, you must explicitly enable or link thread libraries.

---

## Troubleshooting Integration Issues

- **Linker errors on Windows**: Resolve by checking runtime library mismatch and enabling `gtest_force_shared_crt`.
- **Missing main() symbols**: Ensure you link with `gtest_main` or implement your own `main()`.
- **Tests not running or discovered**: Confirm test targets link to GoogleTest correctly and `RUN_ALL_TESTS()` is called.
- **Compilation errors with templates or mocks**: Inspect your C++ standard settings and use `MOCK_METHOD` syntax properly.

---

## Related Concepts and Next Steps

- Explore the [Guides: Real-World Workflows and Best Practices](https://github.com/google/googletest/tree/main/docs/guides/real-world-guidance/project-integration) for detailed examples.
- Review [GoogleTest Primer](overview/getting-to-know-googletest/introduction-to-googletest) and [Writing Your First Test](getting-started/first-test-run/create-first-test) to complement build integration knowledge.
- For mocking integration, refer to [Mocking Reference](docs/reference/mocking.md) and the [Mock Object Model](concepts/mocking-isolation/mock-object-model).

---

## Illustration: CMake Build Flow with GoogleTest

```mermaid
flowchart TD
    subgraph "User Project"
      A[Your Test Source Files] --> B[Compile Test Object Files]
      B --> C[Link with GoogleTest & GoogleMock Libraries]
      C --> D[Test Executable]
    end

    subgraph "GoogleTest Library Build"
      E[GoogleTest Source Code] --> F[Compile Libraries]
    end

    E -->|Dependency| C
    F -->|Link Libraries| C

    D -->|Run Tests| G[Test Runner Execution]

    G --> H[RUN_ALL_TESTS()]

    classDef userFill fill:#e0f7fa,stroke:#007c91,stroke-width:1px;
    class A,B,C,D userFill;
    classDef gtestFill fill:#e8f5e9,stroke:#388e3c,stroke-width:1px;
    class E,F gtestFill;
```

---

This page equips you with practical understanding to integrate GoogleTest effectively into your build system, maximizing productivity and test reliability.

---