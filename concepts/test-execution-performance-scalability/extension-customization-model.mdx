---
title: "Extension and Customization Model"
description: "Learn how the framework is architected for extensibility: from custom matchers and actions to listeners and output formatting. Discover the points of extension and the patterns used to maintain flexibility without sacrificing core simplicity."
---

# Extension and Customization Model

GoogleTest and GoogleMock are designed to be robust and powerful while maintaining flexibility through a carefully architected extension and customization model. This guide will take you through the key extension points of the framework—from creating custom matchers and actions to configuring listeners and customizing output formatting—empowering you to adapt and extend GoogleMock to fit your testing needs without compromising simplicity or core behaviors.

---

## Why Extend GoogleMock?

While GoogleMock provides a comprehensive set of matchers, actions, and features, real-world testing challenges often require behavior tailored specifically to your codebase or testing style. Extending GoogleMock helps you:

- Express domain-specific verification logic that built-in matchers cannot capture.
- Define custom side effects and behaviors for mock methods.
- Hook into the test lifecycle and capture detailed event information.
- Modify test output presentation for better integration with tools or workflows.

By making use of the extension points exposed, you gain a powerful toolset that enhances your testing effectiveness and maintainability.

---

## Custom Matchers

### Purpose

Matchers evaluate whether the arguments passed to mock functions meet test expectations. While GoogleMock includes a rich library of built-in matchers (e.g., `Eq()`, `Ge()`, `Contains()`), sometimes you need to create your own to validate specialized properties.

### Creating Matchers

There are several approaches to define custom matchers:

- **Simple Matchers using `MATCHER` macros**
  - Quickly define matchers with concise predicates and descriptions.
  - Example:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}
```

- **Parameterized Matchers with `MATCHER_P*`**
  - Parametrize your matcher logic for more flexible use.

```cpp
MATCHER_P(IsDivisibleBy, divisor, "checks divisibility") {
  return (arg % divisor) == 0;
}
```

- **Advanced Matchers by Implementing Matcher Interface**
  - For full control, implement the matcher interface with `MatchAndExplain()`, `DescribeTo()`, and `DescribeNegationTo()`.
  - Enables polymorphic matchers usable over various types.

### Best Practices

- Ensure matchers are **pure functions without side effects**. Avoid calling mock methods or modifying state during evaluation.
- Provide informative diagnostics by streaming details to the result listener.
- Reuse complex matchers by assigning them to variables.

---

## Custom Actions

### Purpose

Actions specify what happens when a mock method is invoked and matched. Built-in actions allow returning values, invoking callables, setting output parameters, and more. Custom actions enable you to:

- Implement domain-specific behavior or side effects.
- Delegate to real or fake objects conditionally.
- Coordinate stateful behaviors across repeated calls.

### Defining Actions

- **Lambda or Functor-based Actions**
  - Define callable objects matching the mock method signature.
  - Support stateful behaviors.

```cpp
struct Incrementer {
  int count = 0;
  int operator()() { return ++count; }
};
EXPECT_CALL(mock, GetNext()).WillRepeatedly(Incrementer());
```

- **`ACTION` Macros for Simplicity**
  - Handy for quick action definitions, accessing mock call arguments as `arg0`, `arg1`, etc.

```cpp
ACTION(SetFlag) { *arg0 = true; }
EXPECT_CALL(mock, DoSomething).WillOnce(SetFlag());
```

- **Polymorphic Actions**
  - Use `MakePolymorphicAction()` to create actions usable across different method signatures.

### Helpful Utilities

- `DoAll()` chains multiple actions (only last return value is used).
- `Invoke()` calls an existing function, method, lambda, or functor.
- `Return()`, `ReturnRef()`, and `ReturnPointee()` manage return values.
- `SetArgPointee<N>(value)` and `SetArrayArgument<N>(first, last)` modify output parameters.

---

## Using and Defining Strictness Modes

GoogleMock provides predefined wrappers to control how uninteresting calls are treated:

- `NiceMock<T>`: Suppresses warnings for uninteresting calls.
- `NaggyMock<T>`: (default) Emits warnings for uninteresting calls.
- `StrictMock<T>`: Treats uninteresting calls as test failures.

You can define your own behaviors by controlling expectations and default actions appropriately.

---

## Event Listeners and Reporting Customization

### Purpose

GoogleTest uses an event listener model to inform clients of testing events such as test start/end, assertion results, and environment setup/teardown. You can use listeners to:

- Customize test progress reporting.
- Integrate with external logging, dashboards, or CI systems.
- Generate alternate output formats (like JSON, custom XML).

### How to Extend

- Derive from `::testing::TestEventListener` or extend existing listeners.
- Override methods such as `OnTestStart()`, `OnTestPartResult()`, and `OnTestEnd()`.
- Register your listener via the GoogleTest listener API before running tests.

### Tips

- Chain custom listeners with existing ones to reuse standard behaviors.
- Carefully manage thread safety if your listener interacts with multithreaded tests.

---

## Customizing Output Formats

You can extend or replace GoogleTest’s default XML, JSON, or console reporters by:

- Implementing a custom `TestEventListener`.
- Overriding output methods to format results according to your needs.
- Using existing external tools or contrib libraries if available.

This enhances integration with reporting tools and continuous integration systems.

---

## Example: Writing a Custom Matcher

```cpp
// Checks that an integer is a prime number.
MATCHER(IsPrime, "checks if a number is prime") {
  if (arg < 2) return false;
  for (int i = 2; i * i <= arg; ++i) {
    if (arg % i == 0) {
      *result_listener << "which is divisible by " << i;
      return false;
    }
  }
  return true;
}

// Usage:
EXPECT_CALL(mock, ComputeFactor(_)).WillOnce(Return(7));
EXPECT_THAT(mock.ComputeFactor(5), IsPrime());
```

## Example: Defining a Custom Action

```cpp
// An action that increments an internal counter each time the mock method
// is called and returns the count.
struct CountingAction {
  int count = 0;
  int operator()() { return ++count; }
};

// Setting the mock behavior:
EXPECT_CALL(mock, GetInvocationCount())
    .WillRepeatedly(CountingAction());
```

## Practical Tips

- Use `ON_CALL()` to define default behavior without setting call expectations.
- Reserve `EXPECT_CALL()` for calls you want to verify explicitly.
- To avoid brittle tests, keep expectations as general as reasonable.
- Consider defining custom matchers and actions close to domain concepts for greater clarity.

---

## Troubleshooting Extension Points

- **Custom Matchers or Actions Not Invoked**: Ensure your matcher/action object is properly passed and lifetime is sufficient.
- **Verbose Logging**: Use `--gmock_verbose=info` to trace matcher and action evaluations.
- **Unexpected Calls**: Check that expectations and default behaviors do not conflict.
- **Listener Issues**: Verify listener registration order and avoid thread-safety issues.

When in doubt, consult the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes and examples.

---

## Further Resources

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — practical usage and recipes
- [Matchers Reference](../api-reference/assertions-matchers/expressive-matchers.mdx) — detailed explanation of matchers
- [Actions Reference](../api-reference/mocking-framework/mock-actions.mdx) — exhaustive list of built-in actions and how to write your own
- [Test Event Listener API](../api-reference/core-testing/test-results-and-reporting.mdx) — customizing test reporting and events
- [Mocking Models and Expectations](../concepts/architectural-overview/mocking-models.mdx) — core principles behind setting expectations and verification

This page builds on the architectural concepts of GoogleMock, complementing the [Core Concepts & Terminology](../overview/introduction-core/core-concepts-terminology.mdx) and is part of the broader [Concepts Documentation](../concepts/architectural-overview/index.mdx).

---

By mastering the extension and customization model, you harness the full potential of GoogleMock—not just as a black-box tool but as an adaptable, expressive framework tailored to your testing domain.
