---
title: "Custom Assertions and Matchers"
description: "Discover how to extend GoogleTest and GoogleMock with custom assertions and matchers tailored to your domain. This page outlines extension points and practical guidance for integrating advanced logic into tests."
---

# Custom Assertions and Matchers

Discover how to extend GoogleTest and GoogleMock with custom assertions and matchers tailored to your domain. This page outlines extension points and practical guidance for integrating advanced logic into tests.

---

## Why Extend with Custom Assertions and Matchers?

GoogleTest and GoogleMock provide a rich set of built-in assertions and matchers covering common types and scenarios. However, real-world testing often requires domain-specific logic or more expressive assertions beyond the standard set.

Custom assertions and matchers let you:

- Encode domain knowledge to make tests clearer and more maintainable.
- Improve failure diagnostics with precise error messages reflecting your semantics.
- Encapsulate complex validation logic for reuse across test suites.

By creating custom extensions, your tests become more readable and your intent explicit. This turns brittle or verbose tests into expressive, maintainable ones.

---

## Core Concepts of Custom Assertions and Matchers

### Assertions vs. Matchers

- **Assertions** are statements in tests that validate conditions and report pass/fail, for example, `ASSERT_EQ(a, b)`.
- **Matchers** are predicates that specify how an argument or value should look, used in assertions like `EXPECT_THAT(value, IsPositive())`.

While assertions are about test flow and control, matchers focus solely on describing conditions or constraints on data.

### Custom Assertions

Custom assertions extend GoogleTest's `ASSERT_*` or `EXPECT_*` macros, allowing complex, reusable checks with rich failure messages. They can be written as functions or macros and typically invoke internal helper functions that produce detailed diagnostics.

### Custom Matchers

Custom matchers are first-class objects compatible with the GoogleMock matcher API. They:

- Define how to check a value or argument against your condition.
- Provide descriptions for success, failure, and negated matches.
- Can be polymorphic (work with several types) or monomorphic (type-specific).

Matchers integrate seamlessly with GoogleMock's expectation framework, enabling expressive argument validation.

---

## Writing Custom Matchers

GoogleMock provides powerful macros and interfaces to create matchers quickly.

### Using the `MATCHER` Macro for Simple Matchers

This macro simplifies creating basic matchers:

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
```

Used in tests as:

```cpp
EXPECT_THAT(value, IsEven());
```

You can optionally provide a description string that depends on negation:

```cpp
MATCHER(IsDivisibleBy3,
        absl::StrCat(negation ? "is not divisible by 3" : "is divisible by 3")) {
  return arg % 3 == 0;
}
```

### Using `MATCHER_P` to Create Parameterized Matchers

Parameterized matchers accept arguments to customize matching logic:

```cpp
MATCHER_P(HasLength, length, "") {
  return arg.size() == length;
}

// Usage:
EXPECT_THAT("hello", HasLength(5));
```

This is handy for reusable conditions with variable parameters.

### Implementing a Matcher Class Manually

For advanced control, define a class with:

- A typedef `using is_gtest_matcher = void;`
- A `MatchAndExplain()` method performing value checks, optionally streaming diagnostic info.
- `DescribeTo()` and `DescribeNegationTo()` methods to explain expectations.

Example:

```cpp
class StartsWithA { 
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(const std::string& s, std::ostream* os) const {
    if (!s.empty() && s[0] == 'A') return true;
    if (os) *os << "starts with '" << (s.empty() ? "" : std::string(1, s[0])) << "'";
    return false;
  }

  void DescribeTo(std::ostream* os) const { *os << "starts with 'A'"; }

  void DescribeNegationTo(std::ostream* os) const { *os << "does not start with 'A'"; }
};

::testing::Matcher<std::string> StartsWithA() {
  return ::testing::MakeMatcher(new StartsWithA());
}
```

Use like:

```cpp
EXPECT_THAT("Apple", StartsWithA());
```

---

## Writing Custom Assertions

A custom assertion function typically takes expected and actual values, performs checks, and on failure, asserts with meaningful messages.

Example:

```cpp
::testing::AssertionResult IsValidFoo(const Foo& foo) {
  if (foo.IsValid()) {
    return ::testing::AssertionSuccess();
  } else {
    return ::testing::AssertionFailure() << "Foo is not valid";
  }
}

TEST(FooTest, Validation) {
  Foo foo;
  EXPECT_TRUE(IsValidFoo(foo));
}
```

This approach allows complex logic and customized messages inside reusable assertions.

---

## Best Practices

- **Focus on user intent:** Write matchers and assertions from the perspective of what the test needs to express.
- **Keep matchers pure:** Avoid side effects in matchers; they must only evaluate conditions.
- **Use clear descriptions:** Detailed messages help diagnose test failures faster.
- **Leverage parameterization:** Use parameterized matchers to maximize reusability.
- **Avoid over-complexity:** Prefer simple matchers where possible; use composed matchers for complex logic.
- **Test your custom extensions:** Write unit tests for your custom matchers and assertions to validate correctness.

---

## Troubleshooting Common Issues

- **Matcher not matching as expected:** Check your logic and ensure type correctness.
- **Matcher diagnostics unclear:** Enhance `MatchAndExplain` to provide more context.
- **Test fails with unexpected messages:** Confirm matchers are pure and correctly specified.
- **Compilation errors with complex types:** Use the provided `MATCHER` macros or implement matcher classes carefully.

---

## References and Further Reading

- [GoogleMock Cookbook - New Matchers](https://google.github.io/googletest/gmock_cook_book.html#writing-new-matchers)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.md)
- [Custom Assertions and Matchers Guide](/guides/advanced-testing-patterns/custom-assertions-and-matchers)
- [GoogleMock API Reference](https://google.github.io/googletest/api/gmock-api.html)

Leverage these resources to deepen your mastery and explore advanced scenarios.

---

For more within the GoogleTest ecosystem, see other concept pages about mocking behavior and expectations to understand how custom matchers integrate with expectation setting and verification.

