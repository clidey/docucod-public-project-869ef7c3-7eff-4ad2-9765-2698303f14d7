---
title: "Integration with Build Systems and External Tools"
description: "Review strategies for integrating GoogleTest/GoogleMock into your build and CI systems. This includes CMake, Bazel, and platform-specific setup, as well as connecting with test runners, adapters, and third-party reporting tools."
---

# Integration with Build Systems and External Tools

This guide walks you through effective strategies for integrating GoogleTest and GoogleMock with popular build systems such as **CMake** and **Bazel**, as well as setting them up on various platforms. It also covers connecting GoogleTest with external test runners, adapters, and third-party reporting tools to streamline your continuous integration (CI) workflows.

---

## Why Integration Matters

Integrating GoogleTest seamlessly with your build and CI systems is key to unlocking its full power:

- **Automated test discovery and execution** within build workflows reduce manual effort.
- **Consistent build settings** prevent subtle bugs and compatibility issues.
- **Platform-specific adjustments** ensure smooth operation across different OS environments.
- **Integration with test runners and reporting tools** boosts visibility into test results.

By mastering build system integration, you empower your team to run tests reliably, report precisely, and iterate fast.

---

## Integrating GoogleTest with CMake

### Getting Started with CMake

GoogleTest provides a community-supported CMake build script which can be included in your project either as a standalone or via adding it as a subdirectory in your existing build.

#### Standalone Build

To build GoogleTest as a standalone library:

```bash
# Clone the repo with a specific stable tag
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest

# Create a build output directory
mkdir build && cd build

# Generate build scripts
cmake ..

# Build GoogleTest
cmake --build .

# (Optional) Install system-wide
sudo cmake --install .
```

*Note:* By default, GoogleMock is included. You can exclude it by passing `-DBUILD_GMOCK=OFF` during the `cmake` step.

#### Integrating Into an Existing CMake Project

The recommended approach for projects already using CMake is to incorporate GoogleTest directly within your build process using one of these methods:

- **FetchContent Module:** Automatically download and build at configure time.
- **Subdirectory Addition:** Add GoogleTest source as a submodule or copy and use `add_subdirectory()`.
- **Finding Installed Package:** Use `find_package(GTest CONFIG REQUIRED)` if installed.

##### Typical FetchContent Example:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_test test/my_test.cc)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

This approach ensures consistent compiler and linker settings between your tests and GoogleTest, avoiding common pitfalls such as runtime library mismatches.

##### Visual Studio Runtime Mismatch Issue

By default, Visual Studio links the runtime dynamically (`MDd`), but GoogleTest's static builds link statically (`MTd`). To align these, enable `gtest_force_shared_crt`:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

This forces GoogleTest to link dynamically, matching your project.

### CMakeLists.txt Configuration Details

GoogleTest’s CMake build script defines options for building shared libraries, enabling pthread support, hiding internal symbols, and configuring compiler flags tuned for GoogleTest’s requirements.

Key options include:

- `BUILD_GMOCK`: Build GoogleMock when ON (default: ON)
- `INSTALL_GTEST`: Whether to install GoogleTest headers and libs (default: ON)
- `gtest_force_shared_crt`: Dynamic runtime linkage on Windows to match your project

The build system also automatically handles threading support detection (pthreads) and adjusts compiler/linker flags for common compilers (MSVC, GCC, Clang).

### Writing Your `CMakeLists.txt` for Tests

After including GoogleTest in your project, add test binaries like this:

```cmake
enable_testing()

add_executable(hello_test hello_test.cc)

target_link_libraries(hello_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

This enables CMake’s test runner (`ctest`) to automatically discover and run your tests.

### Using pkg-config with CMake

GoogleTest provides pkg-config files for easier flag management. To use pkg-config in your CMake project:

```cmake
find_package(PkgConfig REQUIRED)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(testapp samples/sample3_unittest.cc)
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})

enable_testing()
add_test(NAME sample_test COMMAND testapp)
```

If `pkg-config` cannot find GoogleTest, ensure your `PKG_CONFIG_PATH` contains the directory where the `.pc` files are installed, especially if you installed manually.

<Note>
If you are cross-compiling, set environment variables like `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` to ensure the sysroot is correctly referenced in include and library paths.
</Note>

---

## Integrating GoogleTest with Bazel

Bazel users can integrate GoogleTest by declaring it as a dependency via the `MODULE.bazel` file or directly within `WORKSPACE` using `http_archive`. Typically, you:

1. Set up the Bazel workspace with GoogleTest as an external repository.
2. Declare your test binary with a `cc_test` rule.
3. Define test source files and link with `@com_google_googletest//:gtest_main`.

This setup ensures GoogleTest’s headers and libraries are fetched and built automatically in the Bazel environment.

For full instructions, [see the Bazel Installation guide](/getting-started/prerequisites-installation/installation-bazel).

---

## Platform-Specific Configuration Considerations

GoogleTest supports a wide range of platforms, including Linux, macOS, Windows, and embedded systems. Integration details may vary:

- **Windows:** Manage Visual Studio runtime library conflicts with `gtest_force_shared_crt`.
- **Linux/macOS:** pthread is detected and linked automatically by GoogleTest’s CMake scripts.
- **Cross-compilation:** Use pkg-config environment variables carefully to handle sysroot paths.

Always verify compiler compatibility (requires C++17) and thread support in your target environment.

---

## Connecting with Test Runners and Reporting Tools

GoogleTest’s output can be integrated with various tools to enhance test execution and result tracking:

- **IDE Extensions:** Visual Studio Code extensions like GoogleTest Adapter and C++ TestMate enable test tree views, inline diagnostics, and debug capabilities.
- **Test Runners:** Tools such as `gtest-parallel` run tests concurrently for faster feedback.
- **Third-Party Listeners:** TAP listeners and JSON/XML reporters facilitate integration with CI dashboards and coverage tools.

### Enabling XML and JSON Reporting

Use GoogleTest flags to produce machine-readable test output compatible with CI systems:

```bash
--gtest_output=xml:report.xml
--gtest_output=json:report.json
```

Many CI platforms can parse these to provide rich test dashboards.

### Using Event Listeners and Adapters

GoogleTest’s listener API enables custom test event handling, which adapters leverage to map results to IDE or CI workflows.

---

## Best Practices for Smooth Integration

- **Consistent compiler and linker flags:** Avoid conflicts by aligning runtime libraries across GoogleTest and your project.
- **Use FetchContent or External Repositories:** These ensure version consistency and make CI scripts simpler.
- **Enable `enable_testing()` Early:** Register all test binaries with CMake’s test framework.
- **Leverage `gtest_discover_tests()` for auto-discovery:** Avoid manually listing tests.
- **Validate Pkg-config paths:** Set and check environment variables if pkg-config cannot locate GoogleTest.
- **Start with small test binaries:** Build confidence in your integration before scaling.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Build & Integration Issues">
<Accordion title="Linker Errors Related to pthread">
These usually occur if pthreads aren’t linked properly:

- Ensure GoogleTest’s CMake scripts detect pthread support.
- If using custom build scripts, add `-pthread` or platform-specific threading flags.
- With CMake, this is handled automatically.
</Accordion>
<Accordion title="Runtime Library Mismatch on Windows">
Build errors about mismatched runtimes often relate to static vs dynamic CRT link:

- Enable `gtest_force_shared_crt` in your CMake config.
- Rebuild GoogleTest and your project to use the same CRT linkage.
</Accordion>
<Accordion title="Tests Not Found by CTest">
- Confirm you called `enable_testing()` in your `CMakeLists.txt`.
- Use `gtest_discover_tests()` to export test cases to CTest.
- Ensure your test executables are built and linked correctly.
</Accordion>
<Accordion title="Pkg-config Can't Find GoogleTest">
- Verify `.pc` files exist in the proper directory.
- Set `PKG_CONFIG_PATH` environment variable to include the install path.
- For cross-compilation, set `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` accordingly.
</Accordion>
</AccordionGroup>

---

## Summary Diagram: GoogleTest and External Tool Integration Flow

```mermaid
flowchart TD
  subgraph Build and Test Setup
    CMake[CMake or Bazel Build System]
    FetchContent[GoogleTest FetchContent / External Repo]
    ProjectSource[Your Project Source]
  end

  subgraph Build Output
    TestBinary[GoogleTest Executable]
  end

  subgraph Test Execution
    LocalTestRunner[CTest or bazel test]
    IDEAdapter[IDE Test Adapter (VS Code, etc.)]
    ParallelRunner[gtest-parallel]
  end

  subgraph Reporting
    XMLJSONOutput[--gtest_output=xml/json]
    TAPListener[TAP Protocol Listener]
    CIPlatform[CI System & Dashboard]
  end

  CMake --> FetchContent
  CMake --> ProjectSource
  FetchContent --> TestBinary
  ProjectSource --> TestBinary

  TestBinary --> LocalTestRunner
  TestBinary --> IDEAdapter
  TestBinary --> ParallelRunner

  TestBinary --> XMLJSONOutput
  TestBinary --> TAPListener

  XMLJSONOutput --> CIPlatform
  TAPListener --> CIPlatform

  LocalTestRunner --> CIPlatform
  IDEAdapter --> CIPlatform
  ParallelRunner --> CIPlatform

  classDef build fill:#f0f9ff,stroke:#60a5fa,stroke-width:1px
  classDef testExec fill:#e6ffed,stroke:#10b981,stroke-width:1px
  classDef reporting fill:#fff7ed,stroke:#f97316,stroke-width:1px

  class CMake,FetchContent,ProjectSource build
  class TestBinary testExec
  class LocalTestRunner,IDEAdapter,ParallelRunner testExec
  class XMLJSONOutput,TAPListener,CIPlatform reporting
```

---

## Next Steps and Further Reading

To deepen your understanding and expand your build system capabilities:

- Explore the [CMake Quickstart tutorial](getting-started/prerequisites-installation/installation-cmake.md) for hands-on setup.
- Learn how to integrate GoogleTest with [Bazel](getting-started/prerequisites-installation/installation-bazel.md).
- Discover packaging details with pkg-config support in [Using pkg-config](docs/pkgconfig.md).
- Review platform-specific notes in [Platform Portability and Cross-Compilation](/concepts/extensibility-integration/platform-portability).
- For CI integration patterns and adapters, see [Integration & Platform Support](/overview/architecture-and-concepts/integration-points).


---

This integration guide ensures you have the foundational knowledge and practical steps to embed GoogleTest and GoogleMock reliably into your development and CI pipelines. Seamless integration accelerates feedback cycles and strengthens software quality through automated, repeatable testing practices.


---