---
title: "Custom Assertions and Matchers"
description: "Learn how to extend the framework with custom assertions and matchers, enabling expressive, domain-specific validations that make tests clearer and failures more actionable."
---

# Custom Assertions and Matchers

Learn how to extend the framework with custom assertions and matchers, enabling expressive, domain-specific validations that make tests clearer and failures more actionable.

---

## Introduction to Custom Assertions and Matchers

In GoogleTest and GoogleMock, assertions and matchers are the core tools that let you verify the behavior of your code with clarity and precision. While the framework provides a rich set of built-in assertions and matchers, you often encounter situations where a domain-specific or complex validation is needed — one that the existing assertions cannot express cleanly.

This page guides you through creating your own custom assertions and matchers, empowering you to write tests that communicate intent clearly, generate actionable failure messages, and improve maintainability.


## Why Extend with Custom Assertions and Matchers?

Imagine you have a type `Foo` with properties and invariants unique to your application. Using only built-in assertions, your tests might look cluttered:

```cpp
EXPECT_TRUE(foo.bar() > 0);
EXPECT_EQ(foo.status(), Status::kOK);
```

Failures here will report the boolean and integer comparisons but don't carry semantic meaning about what "bar() > 0" or "status == kOK" means in your domain.

By defining a custom matcher or assertion like `IsValidFoo()`, your test becomes more expressive:

```cpp
EXPECT_THAT(foo, IsValidFoo());
```

When this fails, the message can describe exactly why the `Foo` object is invalid, making debugging faster and your test suite more readable.


## Custom Assertions vs Custom Matchers: What's the Difference?

- **Custom Assertions** are straightforward macros or functions that check conditions and generate failures with messages. They are ideal for simple checks.
- **Custom Matchers** are more powerful, reusable objects that can be used with the expressive `EXPECT_THAT()` and `ASSERT_THAT()` macros. They support rich descriptions and can explain failure reasons.

Extending via custom matchers is generally the preferred approach for complex or reusable validations.


## Writing Custom Matchers

GoogleMock offers several ways to implement matchers. The easiest and most idiomatic way is using the `MATCHER` and `MATCHER_P` macros. For advanced control, you can implement the matcher interface directly.

### Using the MATCHER Macro

The simplest way to define a matcher is with the `MATCHER(name, description)` macro. Inside the matcher body, `arg` represents the value being matched:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}
```

This defines `IsDivisibleBy7()` matcher, which you can use like this:

```cpp
EXPECT_THAT(value, IsDivisibleBy7());
```

If the match fails, you'll get a message:

```
Value of: value
Expected: is divisible by 7
  Actual: 23
```


### Adding Meaningful Failure Messages

You can provide additional information explaining *why* a match failed by streaming messages to `*result_listener`:

```cpp
MATCHER(IsDivisibleBy7, "") {
  if ((arg % 7) == 0) return true;
  *result_listener << "the remainder is " << (arg % 7);
  return false;
}
```

Failure messages now look like:

```
Value of: value
Expected: is divisible by 7
  Actual: 23 (the remainder is 2)
```


### Parameterized Matchers with MATCHER_P

For matchers that require parameters, use `MATCHER_P`:

```cpp
MATCHER_P(InClosedRange, range, "") {
  return arg >= range.first && arg <= range.second;
}
```

Usage:

```cpp
EXPECT_THAT(value, InClosedRange(std::make_pair(4, 6)));
```

Failure messages automatically include parameter values.

### Multiple Parameters

Use `MATCHER_P2`, `MATCHER_P3`, etc. for multi-parameter matchers:

```cpp
MATCHER_P2(InRange, low, high, "") {
  return arg >= low && arg <= high;
}
```


## Writing Custom Assertions

Custom assertions are functions or macros that emit success or failure explicitly. Unlike matchers, they usually do not integrate with `EXPECT_THAT`, but can be more concise.

Here is an example of a custom assertion:

```cpp
void ASSERT_IS_VALID_FOO(const Foo& foo) {
  if (!(foo.bar() > 0)) {
    FAIL() << "Foo's bar() is not positive, actual: " << foo.bar();
  }
  if (foo.status() != Status::kOK) {
    FAIL() << "Foo's status is not OK, actual: " << foo.status();
  }
}
```

And use it in tests:

```cpp
TEST(FooTest, CustomAssertionExample) {
  Foo foo = ...;
  ASSERT_IS_VALID_FOO(foo);
}
```


## Using Custom Matchers in Practice

### Example: Checking Summation of Members

```cpp
class Point {
 public:
  int x, y;
};

MATCHER_P2(PointSumEquals, expected_x, expected_y, "") {
  int sum = arg.x + arg.y;
  int expected_sum = expected_x + expected_y;
  if (sum == expected_sum) return true;
  *result_listener << "sum(" << arg.x << ", " << arg.y << ") is " << sum;
  return false;
}

TEST(PointTest, SumMatcherExample) {
  Point p{3, 7};
  EXPECT_THAT(p, PointSumEquals(1, 9));  // Passes as 3+7 == 1+9
  EXPECT_THAT(p, PointSumEquals(2, 8));  // Fails with explanation
}
```


## Best Practices for Custom Matchers

- Always provide clear, human-readable descriptions.
- Provide explanations for both success and failure where helpful.
- Use polymorphic matchers when possible, allowing matching on various argument types.
- Avoid side effects in matchers; they should be pure and idempotent.
- Use `MATCHER` macros for simplicity; implement the matcher interface for advanced cases.


## Common Pitfalls and Troubleshooting

- **Not calling `return` in matcher bodies:** Always ensure the matcher returns a boolean indicating match result.
- **Undefined behavior in matchers with side effects:** Matchers may be evaluated multiple times; avoid mutating state inside.
- **Omitting explanations:** Without explanations, failures can be hard to diagnose.
- **Custom matcher not compiling:** Check that parameters and argument types match expectations.


## Resources and Next Steps

- Explore the [gMock Cookbook’s section on Writing New Matchers Quickly](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers) for detailed examples.
- Review [Matchers Reference](../reference/matchers.md) for built-in matchers and advanced patterns.
- See [Assertions and Matchers in Practice](../guides/core-workflows/assertions-matchers.md) to understand how to integrate custom matchers seamlessly.
- When mocking, integrate your custom matchers in `EXPECT_CALL` and `ON_CALL` clauses for rich argument matching.


---

For further assistance, refer to related documentation pages such as:

- [Assertions Reference](../reference/assertions.md)
- [Mocking Reference](../reference/mocking.md)
- [gMock Cookbook](../docs/gmock_cook_book.md)
- [Matchers, Actions, and Cardinalities](../concepts/mocking-fundamentals/matchers-actions-cardinalities.md)

This page fits within the **Extensibility & Integration Patterns** section of the Concepts tab and builds upon core understanding from Assertions and Mocking fundamentals.
