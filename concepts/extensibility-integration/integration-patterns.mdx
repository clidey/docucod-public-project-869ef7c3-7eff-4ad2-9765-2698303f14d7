---
title: "Integration Patterns and Build Tools"
description: "Understand best practices for integrating GoogleTest with build systems like CMake and Bazel, orchestrating test discovery, and connecting with CI environments. Discover common patterns for incorporating the framework into varying team workflows."
---

# Integration Patterns and Build Tools

Integrating GoogleTest into your build system and continuous integration (CI) workflows unlocks the full power of automated, reliable C++ testing. This guide will walk you through best practices and common integration patterns for build tools such as CMake and Bazel. You will also learn how to organize test discovery and execution effectively, enabling seamless collaboration and rapid feedback in your team environment.

---

## Why Integration Matters

A testing framework is only as effective as its integration within your development process. Proper integration ensures:

- **Automatic test discovery and execution**: Tests are built and run without manual intervention.
- **Consistent test environments**: Build and test behaviors replicate across developer machines and CI.
- **Efficient test execution within CI**: Tests run in parallel or in batches, delivering quick results.

By adopting suitable integration patterns, teams reduce build complexity and ensure scalable maintenance of their test suites.

---

## Supported Build Systems

GoogleTest is designed to work smoothly with modern build tools, but especially features robust support for:

### CMake

- Primary recommended build system for GoogleTest.
- Offers options for both standalone builds and embedding GoogleTest as a subdirectory.
- Supports elegant linkage and configuration, including options for adding GoogleMock.

### Bazel

- Native support for Bazel via provided `BUILD` files.
- Facilitates dependency management and caching with Bazel’s build graph.

### Other Build Systems (Manual / Custom)

- Manual compilation and linking are possible but discouraged.
- GoogleTest source may be embedded directly for custom or legacy setups.

---

## Typical Integration Patterns

### 1. Standalone Build and Link

The most straightforward pattern: build GoogleTest and GoogleMock as separate libraries, then link your test binaries against them.

**Benefits:**
- Clean separation of GoogleTest and test code.
- Enables reuse across multiple test targets.

**Example with CMake:**
```cmake
add_subdirectory(googletest)

add_executable(my_tests test_mycode.cpp)
target_link_libraries(my_tests gtest gtest_main gmock)
```

---

### 2. Embedded Copy of GoogleTest Sources

Some projects prefer embedding GoogleTest source files directly in their test targets.

**Usage:**
- Add GoogleTest sources as part of the test executable build.
- Avoids external dependency management complexity.

**Example with CMake:**
```cmake
file(GLOB gtest_sources "${PROJECT_SOURCE_DIR}/third_party/googletest/src/*.cc")
add_executable(my_tests test_mycode.cpp ${gtest_sources})
```

**Tip:** This is simple but may lead to longer build times and duplication.

---

### 3. Using Pre-built Packages

If your environment uses package managers (e.g., vcpkg, Conan), GoogleTest can be consumed as pre-built binaries.

**Example:**
- Use `find_package(GTest REQUIRED)` in CMake.
- Link against `${GTEST_LIBRARIES}`.

Be sure your package manager version supports C++17 and matches your compiler.

---

## Configuring Test Discovery and Execution

GoogleTest supports automatic test discovery through the test macros and registration mechanisms.

### Best Practices

- Ensure test executable includes GoogleTest’s main or provide your own main entry point (use `gtest_main` target).
- Invoke `RUN_ALL_TESTS()` from `main()` to run all discovered tests.
- Pass flags such as `--gtest_output=xml:<file>` to generate machine-readable test reports for CI.

### Integration with CTest

If using CMake, CTest offers native support:
```cmake
enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```
Then run tests with:
```bash
ctest --output-on-failure
```

This integrates smoothly with CI systems.

---

## Connecting With CI Environments

To maximize value, integrate GoogleTest into CI pipelines with these considerations:

- **Build GoogleTest and your tests as part of the CI job**
- **Run tests with output in XML or JUnit format for CI reporting**
- **Use parallelism by splitting tests or running multiple executables**
- **Capture and examine logs and stack traces on failures**

---

## Common Pitfalls and How to Avoid Them

| Problem                              | Solution                                        |
|------------------------------------|------------------------------------------------|
| Tests not discovered or run         | Verify build links gtest_main or provides main(). Use correct test registration macros. |
| Linking errors with GoogleTest      | Ensure export target visibility and proper linkage. Use `target_link_libraries` correctly. |
| Incompatible compiler or flags     | Confirm compatibility per [Supported Platforms & Compatibility](../integration-platforms/platform-support). Use C++17 or later. |
| Unstable or flaky tests in CI       | Use test filters, isolate flaky tests, fix environment issues. Refer to [CI Integration and Best Practices](../guides/advanced-and-integration-guides/ci-integration-and-best-practices). |

---

## Example Integration: CMake

Here is an example of integrating GoogleTest into a CMake project with GoogleMock included:

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.12.1.zip
)

# For Windows: Prevent overriding the parent project's compiler/linker settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(my_tests
  test_mycode.cpp
  # other test source files
)

target_link_libraries(my_tests
  gtest
  gtest_main
  gmock
)

add_test(NAME MyCodeTests COMMAND my_tests)
```

Then, run the tests with:
```bash
ctest --verbose
```

---

## Summary

Integration is key to leveraging GoogleTest's full power. Whether you choose standalone libraries, embed sources, or use package managers, configure test discovery correctly and connect your builds smoothly with CI environments. Following these patterns maximizes test quality, developer productivity, and CI pipeline efficiency.

---

## Additional Resources

- [Supported Platforms & Compatibility](/overview/integration-platforms/platform-support)
- [CI Integration and Best Practices](/guides/advanced-and-integration-guides/ci-integration-and-best-practices)
- [Installation & Build Options](/getting_started/intro_and_setup/installation_options)
- [Writing Your First Test](/guides/getting-started/writing-your-first-test)
- [GoogleTest API Reference](https://github.com/google/googletest/tree/main/googletest/include/gtest)

---

<Tip>
For robust CI pipelines, consistently generate XML test reports and use CTest integration to capture detailed test outcomes and quickly identify failures.
</Tip>