---
title: "Build System & Platform Integration Concepts"
description: "Conceptual overview of how GoogleTest can be integrated into different build and CI systems. Understand what pieces are involved in Bazel, CMake, or other build flows, and the key abstractions for integrating test runs."
---

# Build System & Platform Integration Concepts

Integrating GoogleTest into your project requires understanding how its components fit into different build systems and continuous integration (CI) environments. This page provides a conceptual overview of the key pieces involved when incorporating GoogleTest and GoogleMock into popular build workflows such as Bazel, CMake, and other systems. It unpacks the abstractions necessary for compiling, linking, and running tests effectively.

---

## Understanding the Integration Landscape

When adopting GoogleTest, users aim to compile their test code, link against the framework libraries, run the tests, and observe results â€” typically automated in build and CI systems. Achieving this seamless experience involves coordinating several artifacts and processes:

- **Source files and headers**: Your test source code and GoogleTest/mock headers
- **Test binaries**: Compiled executables that include your tests and GoogleTest libraries
- **Build targets and flags**: Configuration for how tests are compiled and linked
- **Test runners**: Execution units that run the test binaries, capture results, and report success or failure

Most developers want this integration to be straightforward, cross-platform, and easily automated.

---

## Key Integration Components

### 1. Build Systems: Bazel, CMake, and Others

GoogleTest supports integration with a variety of build systems. The most notable among them are:

- **Bazel**: A build system that uses declarative BUILD files and encourages hermetic builds. Its rules for GoogleTest provide straightforward test declaration and management.
- **CMake**: A cross-platform build system generator widely used in C++ projects. GoogleTest includes CMakeLists.txt files and helper macros to facilitate building and linking the framework.
- **Others**: Many users integrate GoogleTest with custom Makefiles, Ninja, Visual Studio projects, or other build systems by managing compilation and linkage manually or via scripts.

### 2. GoogleTest and GoogleMock Libraries

There are two primary libraries:

- **gtest**: Provides the core testing framework.
- **gmock**: Adds mocking capabilities and depends on gtest.

Users link their test binaries against either `gtest` or `gtest_main` (which includes a default main function), and similarly for GoogleMock, linking against `gmock` or `gmock_main`.

### 3. Test Targets and Executables

- Your test source files are compiled into binaries.
- The test binaries must link against GoogleTest and, optionally, GoogleMock libraries.
- Tests can be built as static or shared libraries, depending on platform and build configuration.

### 4. Platform Considerations

GoogleTest supports multiple platforms and compilers, including Linux, Windows (with Visual Studio, MinGW), and macOS. 

- Compiler flags and runtime libraries may have platform-specific adjustments, such as dynamic vs. static CRT linkage on Windows.
- Threading support (e.g., pthreads) is detected and factored into build and runtime behavior.

<br>

## Typical Integration Workflow Explained

### Step 1: Source and Header Setup

You include GoogleTest headers in your test source files:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h> // if mocking is needed
```

Your project's build system needs to locate these headers, which may reside in installed directories or fetched source trees.

### Step 2: Build System Configuration

- **For CMake**: Use `add_subdirectory(googletest)` or `find_package(GTest)` to locate GoogleTest.
- **For Bazel**: Use `cc_test` rules provided by GoogleTest's Bazel rules repository.

Within your build definitions, create targets for your test binaries that define source files, link with GoogleTest and optionally GoogleMock:

```cmake
add_executable(my_test test/my_test.cc)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

### Step 3: Compiling and Linking

- The build system compiles your test sources with appropriate compiler flags.
- Linking includes GoogleTest static or shared libraries.
- Flags may differ for debug/release configurations and platform specifics, managed typically by the build system macros.

### Step 4: Running Tests

- The built test binary runs your tests.
- You invoke `RUN_ALL_TESTS()` in a `main()` function or link with `gtest_main` / `gmock_main` which define `main()`.
- Test results are output to the console or captured by test runners.

### Step 5: CI Integration

- CI pipelines trigger build steps and test runs.
- Test reports can be parsed or output in standard formats for integration with dashboards.

---

## Integrating GoogleTest with CMake: Conceptual Highlights

GoogleTest includes official, community-maintained CMake scripts to simplify this workflow:

- The top-level `CMakeLists.txt` defines options like `BUILD_GMOCK` and `gmock_build_tests`.
- Functions like `cxx_library_with_type` and `cxx_test` abstract target creation.
- Compiler and linker flags are carefully tweaked for compatibility across platforms.
- Projects can build GoogleTest either as a standalone or incorporate it as a subdirectory for unified toolchain management.

Example snippet for linking GoogleMock in CMake:

```cmake
add_executable(my_mock_test test/my_mock_test.cc)
target_link_libraries(my_mock_test gmock_main)
add_test(NAME my_mock_test COMMAND my_mock_test)
```

GoogleTest also supports shared builds on platforms that allow them, toggled via `BUILD_SHARED_LIBS`.

> **Tip:** When using CMake, define `set(CMAKE_CXX_STANDARD 17)` at the project root to ensure proper C++17 support.

---

## Bazel Integration Concepts

Bazel users declare tests with `cc_test` rules, referencing GoogleTest and GoogleMock as dependencies.

- Bazel handles hermetic builds and sandboxed environments, improving reproducibility.
- GoogleTest's Bazel rules automate inclusion of correct headers, sources, and linking.
- Test binaries built with Bazel run seamlessly in CI systems.

While this page does not include exact Bazel BUILD file examples, users integrating with Bazel should consult [official GoogleTest Bazel rules](https://github.com/google/googletest/blob/main/googletest/README.md) and community resources.

---

## Practical Considerations & Best Practices

- **Use `gtest_main` / `gmock_main` when possible**: It provides a default `main()` implementation handling test initialization.
- **Keep test binaries small**: Only link necessary sources and libraries to reduce build time.
- **Set compiler standards explicitly**: Define C++17 support in your build configuration.
- **Manage threading support properly**: On platforms where pthread is available, ensure the build links against pthread libraries.
- **Isolate GoogleTest dependencies**: When integrating into larger projects, isolate GoogleTest and GoogleMock libraries, especially to avoid runtime discrepancies like CRT mismatches on Windows.

---

## Common Pitfalls

- Forgetting to link test binaries against GoogleTest / GoogleMock libraries.
- Missing required compiler flags especially for C++17 support, causing build failures.
- Linking mismatches on Windows due to inconsistent runtime library usage.
- Defining multiple `main()` functions if also linking with `gtest_main` and manually providing `main()`.

---

## Summary Diagram: Build and Test Data Flow

```mermaid
flowchart TD
  subgraph Source_Code
    UserTests[Test Source Files]
    GoogleTestHeaders["GoogleTest & Mock Headers"]
  end

  subgraph Build_System
    Compiler["Compiler & Flags"]
    Linker["Linker & Flags"]
    GoogleLibraries["gtest, gmock Libraries"]
    TestBinary["Test Executable"]
  end

  subgraph Test_Execution
    Runner["Test Runner / CI"]
    Result["Test Results & Reports"]
  end

  UserTests --> Compiler
  GoogleTestHeaders --> Compiler
  Compiler --> Linker
  GoogleLibraries --> Linker
  Linker --> TestBinary
  TestBinary --> Runner
  Runner --> Result

  click Compiler "getting-started/setup-requirements-installation/prerequisites-supported-platforms" "Prerequisites & Supported Platforms"
  click GoogleLibraries "/overview/integration-and-ecosystem/platforms-dependencies" "Supported Platforms & Dependencies"
  click Runner "/guides/integration-and-realworld/ci-cd-integration" "Integrating with CI/CD"

  classDef compfill fill:#bbdefb,stroke:#1976d2,color:#0d47a1;
  class Compiler,Linker compfill;
  class TestBinary,Runnable fill:#c8e6c9,stroke:#2e7d32,color:#1b5e20;
```

---

## Additional Resources

To deepen your understanding and successfully integrate GoogleTest into your environment, consider reviewing these linked guides:

- [Prerequisites & Supported Platforms](../getting-started/setup-requirements-installation/prerequisites-supported-platforms)
- [Installation Guide](../getting-started/setup-requirements-installation/installing-googletest)
- [Setting Up and Integrating GoogleTest](../../guides/getting-started/setup-integration)
- [Integrating with CI/CD and Build Systems](../../guides/integration-and-realworld/ci-cd-integration)
- [Platform & Ecosystem Dependencies](../overview/integration-and-ecosystem/platforms-dependencies)

These documents provide concrete instructions and examples to complement this conceptual overview.

---

## Troubleshooting Build Integration Issues

### Problem: Build Fails Due to Missing Headers or Libraries
- Verify that your build system is correctly locating GoogleTest's include directories.
- Ensure that the GoogleTest and GoogleMock libraries are built or properly installed.
- On CMake, confirm `find_package(GTest)` or `add_subdirectory` is invoked appropriately.

### Problem: Linker Errors About `main()` or Test Symbols
- Avoid defining your own `main()` if linking against `gtest_main` or `gmock_main` libraries.
- Ensure libraries and user test files are linked properly in your build target.

### Problem: Runtime Errors on Windows Related to CRT
- Ensure consistent use of dynamic vs static runtime libraries via CMake flags like `gtest_force_shared_crt`.
- Verify compiler flags for exception and RTTI handling match between GoogleTest and your project.

### Problem: Tests Not Running in CI or Test Runner
- Double-check that test binaries are invoked correctly within CI tooling.
- Confirm tests are properly registered via `RUN_ALL_TESTS()`.

---

By mastering these concepts, users can confidently embrace GoogleTest and GoogleMock for robust, maintainable testing integrated smoothly with modern build and CI systems.
