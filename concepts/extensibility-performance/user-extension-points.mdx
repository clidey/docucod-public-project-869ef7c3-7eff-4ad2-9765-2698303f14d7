---
title: "User Extension Points"
description: "Delve into the customizable aspects of the framework—extending matchers, actions, and assertions; integrating third-party tools; and implementing custom main functions or listeners to tailor test setup and results."
---

# User Extension Points

Explore the customizable aspects of the GoogleTest and GoogleMock framework. This guide covers how to extend matchers, actions, and assertions; integrate third-party tools; and implement custom main functions or event listeners to tailor test setup and reporting to your needs.

---

## 1. Extending Matchers

Matchers let you specify expected conditions for arguments in mock method calls. GoogleMock ships with a rich set of built-in matchers, but you can create your own to express precise, domain-specific requirements.

### 1.1 Writing Custom Matchers

- Use **`MATCHER`** macros for simple matchers:

  ```cpp
  MATCHER(IsEven, "Checks if a number is even") {
    return (arg % 2) == 0;
  }
  
  // Usage:
  EXPECT_CALL(mock_obj, Foo(IsEven()));
  ```

- For parameterized matchers (taking arguments), use **`MATCHER_P`**, **`MATCHER_P2`**, etc:

  ```cpp
  MATCHER_P(IsMultipleOf, n, "Checks if a number is a multiple of n") {
    return (arg % n) == 0;
  }

  // Usage:
  EXPECT_CALL(mock_obj, Foo(IsMultipleOf(5)));
  ```

- Implement full matcher classes when advanced control is needed:

  ```cpp
  class DivisibleByMatcher {
   public:
    explicit DivisibleByMatcher(int divisor) : divisor_(divisor) {}

    bool MatchAndExplain(int n, std::ostream*) const {
      return n % divisor_ == 0;
    }

    void DescribeTo(std::ostream* os) const {
      *os << "is divisible by " << divisor_;
    }

    void DescribeNegationTo(std::ostream* os) const {
      *os << "is not divisible by " << divisor_;
    }

   private:
    int divisor_;
  };

  ::testing::Matcher<int> DivisibleBy(int divisor) {
    return ::testing::MakeMatcher(new DivisibleByMatcher(divisor));
  }
  ```

### 1.2 Combining Matchers

You can compose matchers using logical combinators:

- `AllOf(m1, m2, ...)` to require all conditions
- `AnyOf(m1, m2, ...)` to require any
- `Not(m)` to negate

This allows flexible yet expressive verification of complex argument properties.

---

## 2. Defining Custom Actions

Actions govern what happens when a mock method is invoked. Extend or customize behaviors by writing your own actions.

### 2.1 Simple Action Using Lambdas or Functors

Actions can be any callable compatible with the mock method signature.

```cpp
EXPECT_CALL(mock_obj, DoWork(_))
    .WillOnce([](int n) { return n * 2; });
```

### 2.2 Using `ACTION` Macros

Define named actions for reuse:

```cpp
ACTION(IncrementArg0) {
  return ++(*arg0);
}

// Usage:
EXPECT_CALL(mock_obj, AddOne(_))
    .WillOnce(IncrementArg0());
```

For parameterized actions, use `ACTION_P`, `ACTION_P2`, etc.

### 2.3 Polymorphic Actions

If your action should work with multiple function signatures, implement `Perform()` as a template and wrap with `MakePolymorphicAction`.

```cpp
class ReturnSecondArg {
 public:
  template <typename Result, typename ArgsTuple>
  Result Perform(const ArgsTuple& args) {
    return std::get<1>(args);
  }
};

PolymorphicAction<ReturnSecondArg> ReturnSecondArgument() {
  return MakePolymorphicAction(ReturnSecondArg());
}

// Usage:
EXPECT_CALL(mock_obj, Func(_, _))
    .WillOnce(ReturnSecondArgument());
```

---

## 3. Extending Assertions

GoogleTest allows creating custom assertions to integrate seamlessly with your test code.

### 3.1 Writing Custom Assertions with `ASSERT_TRUE` or `EXPECT_TRUE`

Wrap your predicate in an assertion macro. Provide informative failure messages.

```cpp
#define ASSERT_IS_EVEN(val) \
  ASSERT_PRED_FORMAT1(IsEvenTestHelper, val)

::testing::AssertionResult IsEvenTestHelper(const char* expr, int val) {
  if (val % 2 == 0)
    return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << expr << " evaluates to an odd number: " << val;
}
```

Use in tests:

```cpp
ASSERT_IS_EVEN(x);
```

### 3.2 Customizing Failure Messages

For detailed diagnostics, output expected vs actual values, or counter-examples.

---

## 4. Integrating Third-Party Tools and Custom Listeners

GoogleTest allows you to hook into its execution lifecycle for logging, profiling, or other integrations.

### 4.1 Writing a Custom Test Event Listener

Implement `::testing::TestEventListener` interface or extend `::testing::EmptyTestEventListener`.

```cpp
class MyListener : public ::testing::EmptyTestEventListener {
 public:
  void OnTestStart(const ::testing::TestInfo& test_info) override {
    // Custom logic before each test
  }
  void OnTestEnd(const ::testing::TestInfo& test_info) override {
    // Custom logic after each test
  }
};

// Register the listener
::testing::TestEventListeners& listeners =
    ::testing::UnitTest::GetInstance()->listeners();

listeners.Append(new MyListener);
```

### 4.2 Combining with External Tools

Use custom listeners to integrate with CI dashboards, coverage tools, or logging frameworks.

---

## 5. Custom Main Functions

You can implement your own `main()` when default initialization does not suffice.

### 5.1 Custom `main()` Example

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  // Custom setup
  int result = RUN_ALL_TESTS();
  // Custom teardown or reporting
  return result;
}
```

### 5.2 Embedded or Special Platform Considerations

If you lack a standard `main()`, initialize and run tests per platform needs.

---

## 6. Tips and Best Practices

- Keep custom matchers and actions focused and pure to maintain predictable and side-effect-free tests.
- Use `MATCHER` macros for brevity unless more control is needed.
- For custom main or listeners, ensure they co-exist well with the GoogleTest lifecycle.
- Leverage built-in utility actions and matchers before building your own.

---

## 7. Additional References

- [gMock Cookbook](gmock_cook_book.md) — Recipes and advanced usage
- [Mocking Reference](reference/mocking.md) — Details on EXPECT_CALL, ON_CALL, and mocks
- [Matchers Reference](reference/matchers.md) — Built-in and custom matcher guidance
- [Actions Reference](reference/actions.md) — Built-in and custom actions
- [GoogleTest Primer](primer.md) — Basics and foundational knowledge

---

## Diagram: User Extension Points in GoogleTest & GoogleMock

```mermaid
flowchart TD

  subgraph Core Framework
    GoogleTest["GoogleTest Framework"]
    GoogleMock["GoogleMock Framework"]
  end

  subgraph Extension Points
    CustomMatchers["Custom Matchers"]
    CustomActions["Custom Actions"]
    CustomAssertions["Custom Assertions"]
    CustomListeners["Test Event Listeners"]
    CustomMain["Custom main() Entry Point"]
  end

  GoogleMock --> CustomMatchers
  GoogleMock --> CustomActions
  GoogleTest --> CustomAssertions
  GoogleTest --> CustomListeners
  GoogleTest --> CustomMain

  CustomMatchers -->|Used in| GoogleMock
  CustomActions -->|Used in| GoogleMock
  CustomAssertions -->|Used in| GoogleTest
  CustomListeners -->|Hook into execution| GoogleTest
  CustomMain -->|Initializes and controls| GoogleTest

  classDef extpoint fill:#f0f9ff,stroke:#007acc,stroke-width:2px,border-radius:4px;
  class Extension Points extpoint;
```

---

With this understanding, you are empowered to tailor GoogleTest and GoogleMock to match your testing and development workflows precisely.
