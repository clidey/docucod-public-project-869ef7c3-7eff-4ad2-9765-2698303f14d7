---
title: "Integration Patterns: Build, CI, and Tooling"
description: "Learn how to seamlessly integrate GoogleTest and GoogleMock with common build systems (CMake, Bazel) and CI pipelines. This page discusses key extension points, configuration files, and practical integration strategies."
---

# Integration Patterns: Build, CI, and Tooling

Learn how to seamlessly integrate GoogleTest and GoogleMock with common build systems and continuous integration pipelines. This guide focuses on practical integration strategies, key extension points, and configuration files essential for incorporating GoogleMock (gMock) into your build and test environments.

---

## Overview

GoogleMock is designed to be flexible and extensible, supporting integration with widely-used build systems such as CMake and Bazel. Its modular design enables straightforward inclusion into existing CI workflows, while providing customization hooks to suit diverse project requirements.

This page bridges the gap between the GoogleMock mocking framework and your project's build and deployment infrastructure, enabling reliable and automated test execution.

---

## Supported Build Systems

### 1. CMake Integration

GoogleMock is distributed with support for CMake, making it simple to build, link, and deploy your test binaries which utilize mocks.

#### Key Points:

- The package configuration file `gmock.pc.in` under `googlemock/cmake/` provides pkg-config definitions for `gmock`.
- It defines include directories, library paths, and thread dependencies.
- CMake scripts typically link against `gmock` and its dependencies.
- Users should configure target link libraries including `gmock` and `gtest` libraries.

#### Example CMake Usage:

```cmake
find_package(GTest REQUIRED)
find_package(GMock REQUIRED)

add_executable(my_tests test_main.cpp mock_class.cpp)
target_link_libraries(my_tests GMock::gmock GTest::gtest pthread)
```

Tips:

- Avoid compiling GoogleMock yourself if binary packages are available.
- Use the installed or externally provided gmock to speed up builds.

### 2. Bazel Integration

GoogleMock integrates with Bazel as part of the broader GoogleTest suite. 

#### Key Points:

- Tests are defined using Bazel `cc_test` rules referencing gmock libraries.
- GoogleMock's sources can be included in external repositories or through Bazel workspace rules.
- It supports setting up mock generation and linking within Bazel's module system.

Example Bazel rule snippet for tests with mocks:

```python
cc_test(
    name = "my_mock_test",
    srcs = ["my_mock_test.cc", "mock_class.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

Tips:

- Use `gmock_main` as the entry point if tests define their own `main()`.
- Leverage Bazel's caching to minimize rebuilds when mocks or tests change.

---

## Key Extension Points

GoogleMock provides several extensibility hooks that support integration with your tooling and build pipeline:

- **Mock Generation:** Automated mock generation tools can be integrated into build steps for interfaces without handcrafted mocks.
- **Strictness Controls:** You can adjust mock strictness modes (`NiceMock`, `StrictMock`, `NaggyMock`) programmatically or via build-time flags to suit debugging or release scenarios.
- **Verbosity Flags:** Runtime flags such as `--gmock_verbose` control logging detail, useful in CI diagnostics.

---

## Configuration Files and Flags

### The `gmock.pc` pkg-config File

The configuration file derived from `gmock.pc.in` specifies:

- `libdir` and `includedir` for locating installed headers and libraries.
- Dependencies on GoogleTest.
- Compiler and linker flags necessary to build and link with gmock.

This is essential for build scripts and package managers to properly consume GoogleMock.

### Runtime Flags

- `--gmock_verbose`: Controls the output verbosity of GoogleMock messages (`info`, `warning`, `error`).
- Flags for catching leaked mocks and controlling default mock behaviors.

Set these flags in your CI environment to increase test output detail during failures, or reduce noise during stable runs.

---

## Practical Integration Strategies

### Step-by-Step: Integrating GoogleMock with CMake for CI

<Steps>
<Step title="Add GoogleMock as a Dependency">
Clone or add GoogleMock as a submodule or install it as a system package.
</Step>
<Step title="Find and Link Libraries">
Use `find_package(GMock REQUIRED)` and link `GMock::gmock` and `GTest::gtest` in your `CMakeLists.txt`.
</Step>
<Step title="Write Tests and Mocks">
Implement your mock classes using `MOCK_METHOD`. Set expectations with `EXPECT_CALL`.
</Step>
<Step title="Configure Test Targets">
Define test targets using `add_executable()` and link against mocks.
</Step>
<Step title="Run Tests in CI">
Set up your CI pipeline to build the project and execute tests via `ctest` or directly invoking test executables.
</Step>
</Steps>

### Step-by-Step: Integrating with Bazel

<Steps>
<Step title="Add GoogleTest to Workspace">
Reference GoogleTest and GoogleMock repositories in your `WORKSPACE` file.
</Step>
<Step title="Define Test Targets">
Write `cc_test` targets including your mocks and test code in `BUILD` files.
</Step>
<Step title="Specify Dependencies">
Add `@com_google_googletest//:gmock_main` or `gmock` in deps.
</Step>
<Step title="Run Bazel Tests in CI">
Trigger Bazel builds and tests in your CI environment with caching for efficiency.
</Step>
</Steps>

---

## Common Pitfalls and Troubleshooting

- **Linker Errors:** Ensure that both `gmock` and `gtest` libraries are linked, and threading libraries (like pthread) are included.
- **Missing Mock Definitions:** Use the `MOCK_METHOD` macro correctly—remember to place mock methods in the public section and apply necessary qualifiers.
- **Compilation Time:** Large mock classes may slow compilation. Moving mock class constructors and destructors to `.cc` files can help.
- **Uninteresting Calls Warning:** Control mock strictness and use `NiceMock` or adjust verbosity to reduce noise.
- **CI Integration Failures:** Verify that build caches are warm and build rules reflect changes in mock classes.

---

## Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — beginner-friendly introduction.
- [Mocking Reference](../reference/mocking.md) — detailed API documentation.
- [gMock Cookbook](../gmock_cook_book.html) — recipes for common mocking scenarios.
- [gmock Cheat Sheet](../gmock_cheat_sheet.html) — quick reference for macros and usage.
- [Integration & Extensibility Overview](/overview/architecture-concepts/integration-overview) — architectural context.

---