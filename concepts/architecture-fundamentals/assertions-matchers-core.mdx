---
title: "Assertions, Matchers, and Failure Modes"
description: "Explore the core assertion and matcher models that underpin Google's testing frameworks. Learn the difference between fatal and non-fatal failures, how matchers enable expressive test conditions, and how custom assertions expand test coverage."
---

# Assertions, Matchers, and Failure Modes

GoogleTest's power in writing robust C++ tests lies in its expressive **assertion macros**, **matchers** for argument validation, and clear distinction between **fatal** and **non-fatal failure modes**. This guide dives into the foundational concepts of assertions, the role of matchers in formulating precise test expectations, and how failures are reported, enabling you to write effective and maintainable tests.

---

## Understanding Assertions: The Core of Test Validation

Assertions are the statements in your test code that verify if the tested code behaves as expected. GoogleTest provides two primary categories of assertions:

- **Fatal Assertions (`ASSERT_` macros):** Immediately abort the current test function on failure, preventing further execution. Use these when continuing makes no sense after failure.

- **Non-Fatal Assertions (`EXPECT_` macros):** Report a failure but allow the test function to continue. Useful when you want to gather additional failures in the same test.

### Common Assertion Macros

| Assertion        | Purpose                                   | Failure Mode |
|------------------|-------------------------------------------|--------------|
| `EXPECT_TRUE(cond)` / `ASSERT_TRUE(cond)` | Verifies a condition is true             | Non-fatal / Fatal |
| `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` | Checks equality                          | Non-fatal / Fatal |
| `EXPECT_THROW(statement, ExceptionType)`  | Ensures `statement` throws specified exception | Non-fatal / Fatal |
| `EXPECT_THAT(value, matcher)`             | Verifies `value` matches a matcher      | Non-fatal / Fatal |

```cpp
// Example: Use EXPECT_* for validation that can continue
EXPECT_EQ(result.size(), 3) << "Result size mismatch";
EXPECT_TRUE(result[0].is_valid());

// Use ASSERT_* if failure is critical
ASSERT_NE(ptr, nullptr);
ptr->DoSomething();
```

### Actionable Tips

- Favor `EXPECT_` assertions to maximize test coverage.
- Use `ASSERT_` when further code depends on the assertion's success.
- Append user messages with `<<` to provide additional failure context.

---

## Matchers: Making Assertions Expressive and Precise

Matchers let you describe the expected properties of your function arguments or test values in rich, readable ways. They act like predicates but also provide informative diagnostics on failure.

### What Matchers Do

Matchers check whether values satisfy certain conditions and generate clear failure explanations. They can be used inside `EXPECT_THAT` assertions or as part of mock expectations.

### Built-in Matchers Overview

- `_`: The wildcard matcher; matches any value.
- `Eq(val)`: Matches when the value is equal to `val`.
- `Ne(val)`: Not equal.
- `Lt(val)`, `Le(val)`, `Gt(val)`, `Ge(val)`: Relational comparisons.
- `Contains(substring)`, `StartsWith(prefix)`, `EndsWith(suffix)`: String content matchers.
- `Pointee(matcher)`: Matches a pointer whose pointee satisfies the matcher.
- `Field(&Class::member, matcher)`: Matches a member within a struct or class.
- `Property(&Class::method, matcher)`: Matches the return value of a getter method.

### Multi-Argument Matchers

Matchers can apply to tuples of arguments via the `.With()` clause in mock expectations. For example, you can require the first argument to be less than the second:

```cpp
EXPECT_CALL(mock, DoSomething(_, _))
    .With(Lt());  // Matches if arg0 < arg1
```

### Creating Custom Matchers

GoogleMock provides the `MATCHER` and `MATCHER_P` macros for quickly defining your own matchers, allowing you to customize both match logic and failure messages.

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}
...
EXPECT_THAT(value, IsDivisibleBy7());
```

Further reading: [Writing New Matchers Quickly](api-reference/mocking-api/specifying-expectations.md#newmatchers).

---

## Failure Modes: Fatal vs. Non-Fatal and Uninteresting vs. Unexpected

### Failure Modes in GoogleTest

- **Fatal Failures:** Generated by `ASSERT_` macros, stop further execution of the current test.
- **Non-Fatal Failures:** Generated by `EXPECT_` macros, log the failure but keep going.

Choosing the right mode helps isolate issues and gather comprehensive failure information.

### Understanding Uninteresting and Unexpected Calls (In Mocking)

An important distinction when using mocks:

- **Uninteresting Calls:** Invocations on mock methods without any matching `EXPECT_CALL` expectation. These calls succeed (using default actions) but issue warnings, signaling that the test did not explicitly expect or ignore the call.

- **Unexpected Calls:** Calls that match some mock method with `EXPECT_CALL` statements, but the input arguments don’t match any active expectation. These cause immediate test failures.

### Controlling Mock Behavior on Uninteresting Calls

- **Naggy Mocks (Default):** Warn on uninteresting calls.
- **Nice Mocks:** Suppress warnings on uninteresting calls.
- **Strict Mocks:** Treat uninteresting calls as errors.

Use the wrapper templates `NiceMock<T>`, `NaggyMock<T>`, and `StrictMock<T>` to adjust this behavior per mock object.

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, DoThis());  // Suppresses uninteresting call warnings
```

### Action on Saturation: Retiring Expectations

By default, expectations remain active even after saturation (max call count reached). This can cause failures on excessive calls.

Using `.RetiresOnSaturation()` on an expectation makes it retire as soon as saturated, allowing other expectations to match subsequent calls.

For example:

```cpp
EXPECT_CALL(mock, Method(7))
    .Times(2)
    .RetiresOnSaturation();
EXPECT_CALL(mock, Method(_))
    .Times(AnyNumber());
```

Here, the first two calls with `7` match the first expectation, subsequent calls fall back to the second.

---

## Using Assertions and Matchers with Mock Expectations

### `EXPECT_CALL` Syntax Summary

Set expectations on mock methods with fine-grained control:

```cpp
EXPECT_CALL(mock_obj, Method(matchers...))
    .With(multi_arg_matcher)    // Optional; must be first clause if used
    .Times(cardinality)          // Optional; defaults inferred from WillOnce/Repeatedly
    .InSequence(sequences...)    // Optional
    .After(expectations...)      // Optional
    .WillOnce(action)            // Optional; multiple times allowed
    .WillRepeatedly(action)      // Optional; once only
    .RetiresOnSaturation();      // Optional; once only, last clause
```

- Clauses must appear in the above order.
- Later matching expectations override earlier ones.

### `ON_CALL` for Default Actions

`ON_CALL` specifies behavior without imposing an expectation that the call will occur:

```cpp
ON_CALL(mock_obj, Method(matchers...))
    .With(multi_arg_matcher)    // Optional
    .WillByDefault(action);     // Mandatory
```

Used commonly in test fixture set-up to define default mock behavior.

---

## Examples

### Basic Assertion Example

```cpp
TEST(MyTest, ValueCheck) {
  int x = 5;
  EXPECT_TRUE(x < 10) << "x should be less than 10";
  ASSERT_EQ(x, 5);
}
```

### Using Matchers in `EXPECT_THAT`

```cpp
using ::testing::StartsWith;
EXPECT_THAT(std::string("hello world"), StartsWith("hello"));
```

### Mock Expectation With Matchers

```cpp
using ::testing::_;  // wildcard matcher
using ::testing::Return;

class MockFoo {
 public:
  MOCK_METHOD(int, GetValue, (), ());
};

TEST(MockTest, Example) {
  MockFoo foo;
  EXPECT_CALL(foo, GetValue())
      .Times(2)
      .WillOnce(Return(10))
      .WillRepeatedly(Return(20));

  EXPECT_EQ(foo.GetValue(), 10);
  EXPECT_EQ(foo.GetValue(), 20);
  EXPECT_EQ(foo.GetValue(), 20);
}
```

### Specifying Call Order with `InSequence`

```cpp
using ::testing::InSequence;

{
  InSequence s;

  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
  EXPECT_CALL(mock, ThirdCall());
}
```

Calls must be made to `mock.FirstCall()`, then `mock.SecondCall()`, then `mock.ThirdCall()`.

### Custom Matcher Example

```cpp
MATCHER(IsEven, "is an even number") {
  return (arg % 2) == 0;
}

EXPECT_THAT(value, IsEven());
```

---

## Troubleshooting Common Failure Scenarios

### Failure: Unexpected Mock Function Call

Occurs when a mock method is called with arguments that do not match any active `EXPECT_CALL`.

**Resolution:**

- Verify that expectations are properly set before exercising the mock.
- Add catch-all expectations like `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` if calls beyond specific expectations are acceptable.

### Failure: Too Many Calls

Happens if a mock function is called more times than specified.

**Resolution:**

- Use `.RetiresOnSaturation()` to retire an expectation after saturation.
- Ensure `Times()` clauses match expected usage.

### Failure: Too Few Calls

The test ends without an expected call having been made enough times.

**Resolution:**

- Confirm that test code exercises all expected interactions.
- Adjust `Times()` clauses accordingly.

### Warning: Uninteresting Call

Indicates a mock method was called without any matching `EXPECT_CALL`.

**Resolution:**

- Explicitly add `EXPECT_CALL` statements or use `ON_CALL` to define default behavior.
- Switch to `NiceMock` to suppress warnings if uninteresting calls are acceptable.

---

## Best Practices and Advanced Tips

- **Specify expectations before exercising the mocks.** It’s undefined behavior to set expectations afterward.

- **Use matchers instead of literal values** when you want more flexible argument validation.

- **Leverage multi-argument matchers (`With`)** for complex argument relationships.

- **Use sequences and partial ordering (`InSequence`, `After`)** to control call order.

- **Retire expectations on saturation** to prevent one expectation from blocking others.

- **Customize default actions with `ON_CALL`** for shared baseline behavior.

- **Avoid over-specifying expectations** to reduce brittle tests.

- **Create custom matchers** for domain-specific validations.

- **Control mock strictness with `NiceMock` and `StrictMock`.**

- **Use verbose flags (`--gmock_verbose`) to debug and trace calls.**

---

## Related Documentation

- [GoogleTest Assertions Reference](../api-reference/core-testing-api/assertions.md)
- [GoogleMock Matchers Reference](../api-reference/mocking-api/argument-matching.md)
- [GoogleMock Mocking Reference](../api-reference/mocking-api/specifying-expectations.md)
- [GoogleMock Actions Reference](../api-reference/mocking-api/actions-behaviors.md)
- [gMock Cookbook](guides/mocking-and-advanced-scenarios/advanced-mocking-patterns.md)

---

## Summary

This guide gave you a comprehensive grounding in GoogleTest's assertions, matchers, and failure modes, emphasizing actionable usage patterns to write clear, expressive tests and mocks. You now understand how to distinguish fatal/non-fatal failures, employ rich matchers for argument validation, and manage mock expectations with precise failure reporting.

---