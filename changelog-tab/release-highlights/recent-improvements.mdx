---
title: "Recent Improvements and Bug Fixes"
description: "Summarizes all notable enhancements, optimizations, and stability fixes from recent releases. Users seeking practical benefits from upgrades or trying to resolve issues can review this page for actionable updates."
---

# Recent Improvements and Bug Fixes

This page consolidates all the important enhancements, optimizations, and stability fixes introduced in recent releases of GoogleTest and GoogleMock. It serves as a practical resource for users aiming to understand the impact of upgrading and for those troubleshooting issues who seek effective solutions grounded in the latest updates.

---

## 1. Enhanced Mock Class Definitions and Usability

- **Improved MOCK_METHOD macro** usage:
  - Support for complex return types and argument lists with commas by using parentheses or type aliases.
  - Clear guidance on placing all mock methods in the `public:` section, enabling seamless usage with expectations and default actions regardless of base class access levels.

- **Mocking overloads and templates**:
  - Full support for mocking overloaded virtual and non-virtual methods with refined syntax.
  - Usage of `Const()` wrapper to disambiguate const overloads.

- **Calling conventions specification**:
  - Ability to specify call conventions on Windows via `Calltype(...)` qualifiers.

- **Move-only types support**:
  - Native support for methods returning or accepting move-only types like `std::unique_ptr`.

## 2. Robust Control over Mock Behavior and Expectations

- **Expectations (`EXPECT_CALL`) enhancements:**
  - Chainable clauses such as `.With()`, `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` enable precise control over call behavior, timing, order, and lifetime.
  - Well-defined rules for inferred cardinalities and the interaction between multiple expectations.

- **Default action configuration (`ON_CALL`)**:
  - Specify default behavior for mock methods without setting call count expectations.
  - Last matching `ON_CALL` takes precedence, facilitating layered behavior setups.

- **Uninteresting vs. Unexpected calls clarity:**
  - Explicit differentiation where uninteresting calls (no EXPECT_CALLs) trigger warnings or errors depending on mock wrapper.
  - Unexpected calls (calls that do not match any *set* expectation) always trigger errors.

- **Mock Wrappers for Call Strictness:**
  - `NiceMock<T>` suppresses warnings for uninteresting calls.
  - `NaggyMock<T>` outputs warnings for uninteresting calls (default behavior).
  - `StrictMock<T>` treats uninteresting calls as test failures.
  - These wrappers inherit constructors of the underlying mock class, supporting mocks with various constructors.

## 3. Advanced Matchers, Actions, and Delegation

- **Matchers**: Enhanced support for complex argument matching including multi-argument matching via `.With()`, custom matcher classes, parameterized matchers, composite matchers, container element matching, and pointer validations.

- **Actions**:
  - Combination with `DoAll()`, chaining side-effects and return values.
  - Support for using lambdas, function pointers, and functor objects to define behaviors.
  - Facilities like `Invoke()`, `InvokeWithoutArgs()`, `InvokeArgument<N>()` for dynamic behavioral delegation.
  - Support for modifying output arguments and managing side-effects (`SetArgPointee`, `SetArrayArgument`).

- **Delegating calls**:
  - To fakes or real objects to preserve behavior while verifying interactions.
  - To parent class implementations to reuse concrete method behavior.

## 4. Improved Test Reliability and Diagnostics

- **Sticky expectations management**:
  - Expectations remain active until explicitly saturated or retired.
  - `.RetiresOnSaturation()` provides precise lifecycle control.

- **Order specification via sequences and DAGs**:
  - `InSequence` class scoping to enforce call order.
  - `InSequence()` clause to assign expectations to multiple sequences for partial ordering.
  - `.After()` clause for specifying prerequisite expectations.

- **Improved diagnostics and verbosity control:**
  - `--gmock_verbose=info|warning|error` flags to control output granularity.
  - Stack trace inclusion in warnings (info level).
  - Detailed messages on expectation matching, unsatisfied expectations, unexpected calls, excessive calls, retired and unsatisfied prerequisites.

- **Verification and clearing:**
  - APIs to verify and clear expectations (`Mock::VerifyAndClearExpectations()`, `Mock::VerifyAndClear()`) allowing early or repeated verification in tests.

- **Support for complex scenarios:**
  - Managing mocks with non-default constructors, multiple constructors with many parameters (up to 10-ary), and move-only constructors.
  - Support for nested sequences and expectations with partial order constraints.

## 5. Bug Fixes and Stability Enhancements

- Fixed various misbehaviors related to expectation matching precedence, default action application, and lifecycle issues in the presence of mock object deletion inside actions.

- Resolved issues with warning spam on uninteresting calls in certain configurations.

- Improved compatibility with MSVC and other compilers, handling warnings and correctness for const qualifications and method decorations.

- Enhanced thread safety and synchronization in mock call handling.

- Ensured mock destruction and verification behave correctly when multiple mock objects are involved, even in chained or nested scenarios.

## 6. Practical Usage Notes and Best Practices

- When dealing with overloaded methods, explicitly disambiguate mocks using `Const()` and type-safe casts where necessary.

- Use `NiceMock` by default to avoid warning noise unless strict verification is required.

- Prefer `ON_CALL` for specifying default mock behavior and reserve `EXPECT_CALL` for actual interaction validation.

- Chain multiple actions with `DoAll()` where side effects and return values must be combined.

- Use `InSequence` and `.After()` to specify strict or partial ordering of expected calls to avoid brittle tests.

- Always place mock method declarations (`MOCK_METHOD`) in the `public:` section, regardless of the original method's access level.

- Use `RetiresOnSaturation()` to avoid tests failing due to sticky expectations when calls may occur beyond the intended count.

- Utilize the built-in and custom matchers extensively to keep test assertions readable and precise.

### Related Resources

- For a detailed introduction and examples, see the [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) guide.
- Refer to [Mocking Reference](../reference/mocking.md) for comprehensive macro and class documentation.
- Consult the [gMock Cookbook](docs/gmock_cook_book.md) for practical recipes on advanced mocking scenarios.
- Explore [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) for quick syntax and usage summaries.
- Use the `--gmock_verbose` flag to adjust diagnostic output during test runs.

---

This summary equips you with insights into recent refinements and best use cases to maximize your test suitesâ€™ robustness and maintainability using GoogleMock and GoogleTest frameworks.