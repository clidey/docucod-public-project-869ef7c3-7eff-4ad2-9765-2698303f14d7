---
title: "Deprecation and Removal Notices"
description: "Lists deprecated features or APIs and when they are scheduled for removal. This page empowers users to proactively refactor tests, minimizing long-term technical debt."
---

# Deprecation and Removal Notices

This page details deprecated features and APIs within GoogleTest and GoogleMock specifically related to mocking and test expectations. It empowers you to proactively adapt your test code to avoid future breakage and reduce technical debt. Understanding these notices allows you to plan smooth migrations, maintain forward compatibility, and write tests that adhere to the evolving framework standards.

---

## Overview of Deprecated Mocking Features

GoogleMock has evolved towards a more streamlined, expressive, and robust API. To achieve this, certain older features are deprecated with a plan for eventual removal. This page distinguishes these deprecated elements and clarifies timelines and migration pointers.

Deprecation signals that a feature remains functional but is no longer recommended and may be removed in future releases. Adapting your tests early avoids urgent rewrites later.

## Deprecated Mock Method Macros

### Old-Style `MOCK_METHODn` Macros

- These were replaced by the generic `MOCK_METHOD()` macro introduced in 2018.
- Deprecated macros like `MOCK_METHOD0`, `MOCK_CONST_METHOD1`, and their template variants, as well as corresponding `_WITH_CALLTYPE` versions, are still supported but discouraged.

**Migration Guidance:**
Transition your mocks to use the newer `MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));` syntax. This simplifies your mock class definitions and enhances consistency.

## Deprecated Expectation Clauses and Usage Patterns

### Deprecated Clause Ordering

- Some older tests may have `EXPECT_CALL` modifier clauses ordered incorrectly (e.g., `.With()` not as the first clause).
- Modern GoogleMock enforces that `.With()` — multi-argument matcher — must appear at most once and as the very first clause in an `EXPECT_CALL` chain.

**Migration Guidance:**
Refactor your `EXPECT_CALL` statements to place `.With()` before `.Times()`, `.InSequence()`, `.After()`, `.WillOnce()`, `.WillRepeatedly()`, and `.RetiresOnSaturation()` clauses.

### Use of `RetiresOnSaturation()` with `.WillRepeatedly()`

- `RetiresOnSaturation()` has to be the last clause and cannot appear after `.WillRepeatedly()`.
- Tests violating this clause ordering should be updated to follow the new rules.

## Deprecated Setter and Default Action Semantics

### Default Action Specification

- Older code may lack proper `.WillByDefault()` clauses with `ON_CALL()` statements. GoogleMock now requires `ON_CALL` to end with `.WillByDefault()`, otherwise it results in errors.
- Setting default actions outside this pattern is deprecated.

**Migration Guidance:**
Always use `ON_CALL(obj, Method(...)).WillByDefault(action);` to set default mock method behaviors.

## Deprecated Mock Wrapper Usages

### Warnings about `NiceMock`, `NaggyMock`, and `StrictMock`

- Nesting these wrappers (e.g., `NiceMock<StrictMock<MockClass>>`) is not supported.
- Mock classes without virtual destructors may cause unreliable behavior with these wrappers.

**Migration Guidance:**
Avoid nesting mock wrappers. Ensure your mock base classes have virtual destructors if using these wrappers.

## Removal Timelines

- Deprecated features continue to work in the current stable release.
- Removal is planned in an upcoming major release — monitor the release notes and upgrade guides.
- Users should prepare to migrate their tests during planned upgrade cycles.

## Common Pitfalls and Troubleshooting

- Mismatched clause ordering in `EXPECT_CALL` statements leads to runtime errors or failures. Correct clause placement is critical.
- Missing `.WillByDefault()` causes `ON_CALL` to fail.
- Using deprecated macros may cause compiler warnings.
- Unintended nested mock wrappers may produce unexpected warnings or test failures.

## Best Practices for Migration

- Always prefer the modern `MOCK_METHOD` macro for mock method declarations.
- Use `ON_CALL(...).WillByDefault(...)` to specify default mock behaviors.
- Use `EXPECT_CALL` with proper ordering of chained clauses for explicit expectations.
- Prefer `NiceMock` where you want to suppress spurious warnings; `StrictMock` to make uninteresting calls errors — but avoid nesting.
- Regularly consult the [Mocking Reference](../reference/mocking.md) and [Mocking with GoogleMock Guide](../guides/advanced-testing/mocking-with-googlemock.mdx) for up-to-date idioms.

## Additional Resources

- [Mock Declaration Changes and Migration](changelog-tab/upgrade-guidance/breaking-changes.mdx)
- [GoogleMock Cookbook](docs/gmock_cook_book.md) for practical recipes
- [Mocking API Overview](api-reference/mocking-apis/mock-classes.mdx)
- [Expectations and Sequences](api-reference/mocking-apis/expectations-sequences.mdx)

---

## Example Migration from Old to New Mock Methods

```cpp
// Old style - deprecated
class MockOld {
 public:
  MOCK_CONST_METHOD1(DoSomething, bool(int));
  MOCK_METHOD2_WITH_CALLTYPE(STDMETHODCALLTYPE, Foo, int(int, double));
};

// New style - recommended
class MockNew {
 public:
  MOCK_METHOD(bool, DoSomething, (int), (const, override));
  MOCK_METHOD(int, Foo, (int, double), (Calltype(STDMETHODCALLTYPE), override));
};
```

## Summary

GoogleTest and GoogleMock evolve to improve maintainability and user experience. This page helps you identify deprecated mocking and expectation features, their expected removal timelines, and directs you to practical migration steps. Aligning your tests with current APIs ensures robust test suites that resist breakage and benefit from ongoing enhancements.

---

<Tip>
Regularly review your existing mock implementations and update to use the modern `MOCK_METHOD` macro and proper chained expectations to avoid surprises during framework upgrades.
</Tip>

<Note>
Ensure your mock classes have virtual destructors, especially when used with `NiceMock` or `StrictMock`, to maintain intended behavior.
</Note>

<Warning>
Do not nest mock wrappers like `NiceMock<StrictMock<T>>`. This is unsupported and may cause subtle failures.
</Warning>