---
title: "Breaking Changes & Deprecations"
description: "Identify major updates or removals that require changes in your codebase. This page clearly spells out deprecated behavior and incompatible modifications, empowering you to react with confidence when maintaining or upgrading your tests."
---

# Breaking Changes & Deprecations

GoogleTest evolves continually to improve test reliability, maintainability, and compatibility. This page focuses exclusively on **breaking changes and deprecations** that affect how you write, maintain, or upgrade your tests using GoogleTest. By highlighting these incompatible modifications and obsolete behaviors, you will be empowered to adapt your codebase confidently and avoid pitfalls during upgrades.

---

## 1. Overview of Breaking Changes

Breaking changes refer to any modifications in behavior, APIs, or features that may invalidate existing tests or require code adjustments. These are changes that cannot be safely ignored when upgrading to a new GoogleTest version.

**Key impacts to watch for:**

- Tests fail to build due to removed or renamed macros/definitions
- Tests fail or behave differently due to changed semantics
- Deprecated behaviors produce warnings or errors
- Alterations in mocking or expectation rules

Keeping abreast of these changes minimizes upgrade headaches and optimizes your test reliability.

## 2. Deprecated Features and Their Replacements

### 2.1. Removal of Old-Style Mocking Macros

GoogleMock has migrated fully to the modern `MOCK_METHOD` macro, superseding the legacy `MOCK_METHODn` and `MOCK_CONST_METHODn` macros. The older forms have been deprecated and removed to streamline the interface and improve maintainability.

**What to do:**

- Replace legacy macros with `MOCK_METHOD()`.
- Wrap complex argument types containing commas in parentheses or use `using` declarations to define type aliases.

Example migration:

```cpp
// Old style (deprecated)
MOCK_METHOD1(Foo, bool(int));
MOCK_CONST_METHOD1(Bar, bool(int));

// Modern style (recommended)
MOCK_METHOD(bool, Foo, (int), (override));
MOCK_METHOD(bool, Bar, (int), (const, override));
```

### 2.2. Underscores in Test and Test Suite Names

GoogleTest reserves underscores (`_`) for internal use. Test suite and test names starting or ending with underscores, or containing consecutive underscores, may cause linking or runtime errors.

**Action:** Avoid underscores at the start or end of test suite and test names, and avoid consecutive underscores altogether.

> See the [FAQ on Test Naming](../faq/core-faq/getting-started-faq.md#why-should-test-suite-names-and-test-names-not-contain-underscore) for details.

### 2.3. Use of `NULL` vs `nullptr` in Assertions

While `EXPECT_EQ` supports `NULL`, usage of `nullptr` is preferred for clarity and correctness, especially with `EXPECT_NE`.

**Action:** Use `nullptr` instead of `NULL` in pointer comparisons to avoid ambiguity or warnings.

### 2.4. Strictness in Mock Expectations

Mock expectations are now “sticky” by default, meaning they remain active even after reaching their invocation limits, helping catch unexpected additional calls.

You can disable stickiness with `.RetiresOnSaturation()` to allow expectations to retire automatically.

**Action:** Review expectations using `.RetiresOnSaturation()` if your tests previously relied on non-sticky expectations.

### 2.5. Expectation Matching Order Changed

Expectations are matched in reverse order they are defined, so newer, more specific expectations override older ones. This can sometimes cause confusion when expectations shadow each other.

**Action:** When defining multiple expectations on the same mock method, order them so the most specific is defined last.

## 3. Breaking Changes in Mocking Behavior

### 3.1. Virtual Function Requirements for Mocking

Only virtual functions can be mocked directly. Attempting to mock non-virtual methods is unsupported and will lead to unexpected calls invoking the real method.

**Action:** Ensure all methods intended to be mocked are declared virtual. For non-virtual methods, consider [mocking via dependency injection or wrappers](docs/gmock_for_dummies.md#mocking-non-virtual-methods).

### 3.2. Mock Strictness Wrappers

`NiceMock`, `NaggyMock`, and `StrictMock` behavior modifications now apply only to mock methods declared directly in the mock class and may not affect inherited mock methods due to compiler constraints.

Nesting these wrappers (e.g., `NiceMock<StrictMock<YourMock>>`) is no longer supported.

**Action:** Avoid nesting mock strictness wrappers and be aware that inherited mock methods may not respect strictness modifications.

### 3.3. Actions and Move-Only Types

Support for mocking methods with move-only argument or return types (like `std::unique_ptr`) has been improved, but some older auxiliary actions like `DoAll` may still have limited support for move-only parameters.

**Action:** Prefer lambdas or custom functors for mocking methods involving move-only types.

### 3.4. Callbacks and Invocation Order

GoogleMock strictly enforces that expectations are set before the corresponding mock methods are called. Setting or modifying expectations after mock calls have been made will lead to undefined behavior.

**Action:** Always set `EXPECT_CALL` before exercising the mock.

## 4. Changes in Death Test Handling

### 4.1. Death Test Suite Naming Convention

GoogleTest requires test suites containing death tests to be suffixed with `DeathTest` to ensure controlled, safe execution order.

**Tip:** Use aliases like `using FooDeathTest = FooTest;` when splitting death and non-death tests sharing the same fixture.

### 4.2. Death Test Style Defaults

The default death test style remains "fast", but "threadsafe" is recommended for robust multi-threaded environments. The style affects how test processes are forked and managed.

**Action:** Consider setting `--gtest_death_test_style=threadsafe` for test binaries that might spawn threads.

### 4.3. Memory and Side Effects in Death Tests

In-memory changes within death tests are visible only to the forked process and do not affect the parent process.

**Action:** Avoid relying on side effects in death test statements or manage resources carefully.

## 5. Removed or Unsupported Features

- Old mocking macros (`MOCK_METHODn`, `MOCK_CONST_METHODn` etc.)
- Nested mock strictness wrappers
- Direct mocking of non-virtual methods without advanced workarounds
- Underscore-prefixed or irregular test naming that conflicts with identifier rules

## 6. Migration Strategies

To migrate your test code safely:

1. Audit use of `MOCK_METHODn` macros; replace with modern `MOCK_METHOD`.
2. Review test and suite names for invalid underscore use.
3. Change pointer assertions to use `nullptr`.
4. Adjust expectation ordering to match the reverse-matching rule.
5. Use `.RetiresOnSaturation()` as appropriate.
6. Split death tests into suites suffixed with `DeathTest` where mixed with normal tests.
7. Confirm all mocked methods are virtual.
8. Replace legacy side-effect actions with lambdas or custom actions.

## 7. Troubleshooting Common Upgrade Issues

### Compile Failures on Mock Definitions
- Ensure `MOCK_METHOD` syntax matches the modern form
- Wrap argument types containing commas in parentheses or use type aliases

### Tests Fail Due to Unexpected Mock Calls
- Double-check the order of `EXPECT_CALL`s
- Use catch-all expectations with `Times(AnyNumber())` at start to allow unexpected args

### Death Tests Failing or Hanging
- Verify test suite names end with `DeathTest`
- Try switching death test style to `threadsafe`
- Avoid multi-threaded statefulness violations in death tests

### Warning or Errors on Uninteresting Calls
- Use `NiceMock` to suppress warnings or add explicit `EXPECT_CALL(...).Times(AnyNumber())`

## 8. Additional References and Resources

- [Mocking Objects and Methods](../api-reference/mocking-framework/mock-objects-and-methods) 
- [Setting Expectations and Default Actions](../api-reference/mocking-framework/expectations-and-default-actions) 
- [Mock Behavior Controls: NiceMock, StrictMock](../api-reference/mocking-framework/mock-behavior-controls) 
- [Death Tests Documentation](../api-reference/testing-framework/death-tests) 
- [FAQ on Test Naming Restrictions](../faq/core-faq/getting-started-faq#why-should-test-suite-names-and-test-names-not-contain-underscore) 
- [Advanced GoogleTest Topics](../docs/advanced.md) 
- [Migration Guides and Upgrade Tips](../changelog-tab/upgrade-breaks/upgrade-guide)

---

By following the guidelines and paying attention to these breaking changes and deprecations, you ensure that your use of GoogleTest remains current, reliable, and efficient.

If you encounter issues during migration or want to verify deprecated usage, consult the linked sections or reach out via community support resources.
