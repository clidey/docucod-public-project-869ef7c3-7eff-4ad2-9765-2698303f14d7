---
title: "Setting Up and Integrating GoogleTest"
description: "A hands-on guide to installing and integrating GoogleTest/GoogleMock into your C++ project, covering supported platforms, dependency management, and configuration for both CMake and Bazel workflows. Learn how to add tests to your builds and run them reliably in your environment."
---

# Setting Up and Integrating GoogleTest

A hands-on guide to installing and integrating GoogleTest and GoogleMock into your C++ project, covering supported platforms, dependency management, and configuration for both CMake and Bazel workflows. Learn how to add tests to your builds and run them reliably in your environment.

---

## 1. Workflow Overview

### What This Guide Helps You Accomplish
This guide walks you through the complete process of adding GoogleTest and GoogleMock to your C++ project. It covers downloading the code, building it with CMake or Bazel, incorporating it into your build system, configuring compiler options, and successfully running your tests.

### Prerequisites
- A working C++ development environment (compiler supporting C++17 or later).
- A build system: either CMake 3.14+ or Bazel.
- Network access to clone or download GoogleTest and GoogleMock source code.

### Expected Outcome
By the end, you will have GoogleTest and GoogleMock integrated into your project’s build. You will be able to write, build, and run tests consistently across supported platforms (Linux, Windows, Mac).

### Time Estimate
Approximately 20-40 minutes, depending on your familiarity with C++ build systems.

### Difficulty Level
Intermediate — basic knowledge of C++ build environments and dependency management is helpful.

---

## 2. Step-by-Step Integration Instructions

### Step 1: Obtain GoogleTest and GoogleMock Source Code

For standalone use, clone the official repository specifying a stable tag:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
```

GoogleMock is bundled inside this repository.

---

### Step 2: Choose Your Build Workflow

GoogleTest supports different build workflows. This guide covers two main workflows:

- **CMake Integration:** Common in cross-platform projects.
- **Bazel Integration:** For projects using Bazel build system.

Choose the one matching your project.

---

### Step 3: Build and Install Using CMake

#### 3.a Standalone Build Using CMake

Create a build directory and generate build files:

```bash
mkdir build
cd build
cmake ..               # Builds both GoogleTest and GoogleMock
# Or disable GoogleMock if you only want GoogleTest:
cmake .. -DBUILD_GMOCK=OFF
```

On Unix-like systems (Linux/macOS):

```bash
make
sudo make install       # Installs libraries and headers to /usr/local/ by default
```

On Windows with Visual Studio:

- Open the generated `gtest.sln` file.
- Build the solution within Visual Studio.

On macOS with Xcode:

- Open the generated `.xcodeproj` file.
- Build from Xcode.

#### 3.b Incorporate GoogleTest Into Your Existing CMake Project

Best practice is either to use an installed GoogleTest or add the source into your project:

**Option 1: Use Installed GoogleTest**

Add to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)
# Link your targets
target_link_libraries(your_test_target PRIVATE GTest::gtest GTest::gmock GTest::gtest_main)
```

**Option 2: Embed GoogleTest Sources via FetchContent**

Enables consistent compiler/linker settings across your project and GoogleTest.

Add this snippet to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Visual Studio dynamic runtimes
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example PRIVATE gtest_main)
add_test(NAME example_test COMMAND example)
```

This requires CMake 3.14 or newer.

---

### Step 4: Handle Visual Studio Runtime Conflicts (Windows Only)

By default, Visual Studio compiles runtime libraries dynamically, but GoogleTest uses static linking. This can cause runtime mismatch errors like:

```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```

To fix this, enable `gtest_force_shared_crt` as shown above when embedding or building GoogleTest. This makes GoogleTest use dynamic runtimes compatible with your project.

---

### Step 5: Set C++ Standard Requirements

GoogleTest requires a compiler with C++17 support.

In your top-level CMakeLists, enforce C++17 with:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

If your project is primarily C and does not use CMake for C++, pass C++ flags manually.

---

### Step 6: Build and Link Using Bazel (Overview)

When using Bazel, add GoogleTest and GoogleMock dependencies in your BUILD files appropriately. Refer to the Bazel build documentation and repository for exact targets and versioning.

---

### Step 7: Initialize GoogleMock in Your Test Executable

Include GoogleMock’s main header:

```cpp
#include <gmock/gmock.h>
```

In your main test module, initialize GoogleMock before running tests:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

*Note:* `InitGoogleMock()` also calls `InitGoogleTest()` internally.

---

## 3. Practical Configuration Tips

### Building GoogleTest/GoogleMock as Shared Libraries

Add the following compile option if you prefer shared libraries:

```
-DGTEST_CREATE_SHARED_LIBRARY=1
```

And when building your tests:

```
-DGTEST_LINKED_AS_SHARED_LIBRARY=1
```

Adding these flags ensures compatibility especially on some platforms or compilers.

---

### Controlling Thread Safety

GoogleTest is thread-safe if your platform supports `pthread`. To override detection, add:

```
-DGTEST_HAS_PTHREAD=1  # Enable
-DGTEST_HAS_PTHREAD=0  # Disable
```

Link with pthread as required by your compiler/linker.

---

### Avoiding Macro Name Conflicts

If GoogleTest macros clash with other libraries’ macros, rename GoogleTest macros with:

```
-DGTEST_DONT_DEFINE_<MACRO>=1
```

For example, to rename `TEST`, use:

```
-DGTEST_DONT_DEFINE_TEST=1
```

Then use `GTEST_TEST()` instead of `TEST()` in your code.

---

## 4. Verification

After integration, verify your setup by:

- Building your test executable.
- Running it and checking that `RUN_ALL_TESTS()` executes your test cases.
- Observing output shows tests passing or failing as expected.

If you want to run GoogleMock’s own tests, enable it via CMake argument:

```
-Dgmock_build_tests=ON
```

and run `make test` or use `ctest` accordingly.

---

## 5. Troubleshooting

### Common Issues

- **Linker errors** due to missing pthread or mismatched runtimes: ensure pthread is linked and runtime options match (see Step 4 and Step 7).
- **Header not found**: confirm include directories are correctly set.
- **C++ version errors**: double-check your compiler supports and uses C++17 or later.

### Best Practices

- Prefer embedding GoogleTest source or using FetchContent in CMake for seamless integration and consistent compiler behavior.
- Avoid mixing static and dynamic runtime libraries on Windows.
- Keep GoogleTest and GoogleMock versions in sync.

### Optimizing Build

- Build GoogleTest/GoogleMock only once as a shared or static library for reuse.
- Use CMake options to configure only needed components (e.g., disabling GoogleMock if unused).

---

## 6. Next Steps & Related Documentation

- Explore [Writing and Running Your First Test](/googletest-guides/getting-started/writing-first-test) for writing effective tests.
- Dive into the [Mocking Reference](../docs/reference/mocking.md) to harness GoogleMock’s powerful mocking capabilities.
- Consult [Basic Configuration](/getting-started/initial-configuration-validation/basic-configuration) for more detailed setup scenarios.
- Review [Common Installation & Build Issues](/getting-started/troubleshooting-support/common-issues) for resolving problems.

---

## References and Resources

- GoogleTest GitHub Repository: https://github.com/google/googletest
- Official CMake Website: https://cmake.org/
- gMock for Dummies Guide: https://google.github.io/googletest/gmock_for_dummies.html
- GoogleMock Cheatsheet and Cookbook for detailed examples

---

This guide empowers you to seamlessly integrate GoogleTest and GoogleMock into your projects, enabling reliable, repeatable C++ testing with support for complex mocking scenarios and modern build systems.