---
title: "Building Maintainable Mocks: Nice, Strict, and Naggy Patterns"
description: "Tutorial on using NiceMock, StrictMock, and NaggyMock wrappers to control how mock objects handle unexpected calls. Provides patterns for writing maintainable mocks, clarifies implications for test reliability, and offers guidance on choosing the right strictness."
---

# Building Maintainable Mocks: Nice, Strict, and Naggy Patterns

## Overview

This guide walks you through using **NiceMock**, **StrictMock**, and **NaggyMock** wrappers in GoogleMock to control how mock objects handle unexpected (uninteresting) calls. Understanding these patterns is essential for writing maintainable mocks that balance test readability, reliability, and strictness.

Using the right strictness pattern helps avoid noisy tests, reduces false failures, and ensures tests catch genuinely problematic behavior changes.

---

## What You Will Learn

- The **difference** between NiceMock, StrictMock, and NaggyMock wrappers.
- How each mock type handles uninteresting calls (calls with no explicit expectation).
- Patterns to improve your test reliability and maintainability.
- When and how to choose an appropriate strictness level for your mock.

---

## Prerequisites

- Familiarity with basic GoogleMock mocking concepts and macros (`MOCK_METHOD`, `EXPECT_CALL`, `ON_CALL`).
- Understanding of what constitutes an *uninteresting* vs *unexpected* call.
- A working GoogleMock setup to try out the examples.

---

## Strictness Models Explained

GoogleMock defines three primary mock wrappers to control handling of uninteresting calls:

| Wrapper        | Behavior on Uninteresting Calls                                   | Default Mock Behavior      |
|----------------|------------------------------------------------------------------|---------------------------|
| **NiceMock**   | Suppresses warnings; allows uninteresting calls to pass silently | Not the default yet        |
| **NaggyMock**  | Prints warnings when uninteresting calls occur                   | Current default mock mode  |
| **StrictMock** | Treats uninteresting calls as test failures                      | Less common; stricter tests|

### Uninteresting Calls vs Unexpected Calls

- **Uninteresting Calls**: Calls to mock methods with *no* `EXPECT_CALL` specification.
- **Unexpected Calls**: Calls to mock methods for which *some* `EXPECT_CALL`s exist, but none match the call arguments or cardinality.

Only unexpected calls are always considered errors. Uninteresting calls trigger varying responses based on the strictness wrapper.

---

## Using the Wrappers

The wrappers are template classes that inherit from your mock class and modify the behavior regarding uninteresting calls:

- `NiceMock<T>`: Inherits from `T` and suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: Inherits from `T` and prints warnings on uninteresting calls (default behavior).
- `StrictMock<T>`: Inherits from `T` and treats uninteresting calls as errors.

They support all constructors your mock class supports, enabling seamless replacement.

### Syntax Example

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
};

// Nice mock: no warnings on calls to DoThat(), which is uninteresting.
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, DoThis());
nice_foo.DoThis();
nice_foo.DoThat(); // no warning

// Naggy mock: warnings printed for uninteresting calls.
NaggyMock<MockFoo> naggy_foo;
EXPECT_CALL(naggy_foo, DoThis());
naggy_foo.DoThis();
naggy_foo.DoThat(); // warning printed

// Strict mock: uninteresting calls cause test failures.
StrictMock<MockFoo> strict_foo;
EXPECT_CALL(strict_foo, DoThis());
nstrict_foo.DoThis();
strict_foo.DoThat(); // test failure
```

---

## Step-by-Step Guide to Using NiceMock, NaggyMock, and StrictMock

<Steps>

<Step title="1. Identify Uninteresting Calls in Your Tests">
Determine which mock methods are called by your code under test but are not subject to explicit expectations (`EXPECT_CALL`). These are uninteresting calls that will trigger different behaviors depending on the mocking strategy.
</Step>

<Step title="2. Choose the Appropriate Strictness Wrapper">
- Use **NiceMock** when you want a quieter test that ignores uninteresting calls.
- Use **NaggyMock** to get warnings on uninteresting calls (default legacy behavior).
- Use **StrictMock** when you want to ensure **all** calls are either expected or fail the test.

_Note_: Prefer `NiceMock` for most maintainable tests and `StrictMock` when strict verification is critical.
</Step>

<Step title="3. Replace Your Mock Declarations with the Wrapper">
Wrap your existing mock classes with the selected strictness wrapper:
```cpp
NiceMock<MockClass> mock; // or NaggyMock, StrictMock
```
Ensure you pass any constructor arguments your mock requires.
</Step>

<Step title="4. Use EXPECT_CALL to Define Required Expectations">
Define expectations explicitly for calls you *must* verify:
```cpp
EXPECT_CALL(mock, ExpectedMethod()).Times(1);
```
This works as usual regardless of the wrapper.
</Step>

<Step title="5. Analyze Test Behavior with Wrapper in Place">
Run your tests and observe:
- For **NiceMock**: no warnings for uninteresting calls.
- For **NaggyMock**: warnings for uninteresting calls.
- For **StrictMock**: test failures on uninteresting calls.

Adjust expectations or wrapper selection as needed to strike a balance.
</Step>

</Steps>

---

## Practical Patterns

### Common Patterns and Tips

- **Using NiceMock for Most Tests:** Helps keep tests clean and maintainable by suppressing noise from irrelevant calls.
- **Adding Catch-All EXPECT_CALL:** Use `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());` if you want to allow any calls without explicitly mocking each.
- **Reserve StrictMock for Critical Tests:** Use it when missing an unexpected call is crucial and must cause test failure.
- **Avoid Nesting Wrappers:** You cannot nest `NiceMock<StrictMock<MockFoo>>` and the like.
- **Support for Non-Default Constructors:** These wrappers forward constructor arguments transparently.
- **AllowLeak if Necessary:** For mocks that are intentionally leaked (not recommended), use `Mock::AllowLeak(&mock_obj);`.

### Example: Using NiceMock with Constructor Args

```cpp
NiceMock<MockBar> nice_bar("example");
EXPECT_CALL(nice_bar, This());
nice_bar.This();
```

### Example: StrictMock Usage Resulting in Failure

```cpp
StrictMock<MockFoo> strict_foo;
EXPECT_CALL(strict_foo, DoThis());
strict_foo.DoThis(); // Pass
strict_foo.DoThat(); // Test fails: unexpected uninteresting call
```

### Diagnosing Unexpected Behavior

With **NaggyMock** and verbose mode (`--gmock_verbose=info`), you can get detailed warnings and stack traces on uninteresting calls to help diagnose unintended interactions.

---

## Troubleshooting

### Common Issues

- **Wrapping Mock Methods From Base Classes:** Wrappers affect only mock methods defined directly in your mock class, not inherited ones. Ensure your mock methods are defined directly.

- **Non-Virtual Destructors May Lead to Incorrect Behavior:** Wrappers rely on virtual destructors for proper unregistering. Make sure your mock class has a virtual destructor.

- **Unexpected Call Failures:** Verify that you have appropriate `EXPECT_CALL`s or use `NiceMock` to avoid spurious failures on uninteresting calls.

- **Constructor Forwarding Issues:** Make sure to pass all required constructor arguments when instantiating wrappers.

### Tips

- When using `StrictMock` and encountering failures, carefully check if your code triggers any unintended calls.
- To silence verbose warnings for specific calls, add explicit expectations with `.Times(AnyNumber())` rather than suppressing warnings globally.
- Use `Mock::AllowLeak()` cautiously only if you understand the implications for expectation verification.

---

## Best Practices

- Default to using **NiceMock** for most test scenarios to keep tests simple and less noisy.
- Explicitly specify expectations for interactions that your test cares about.
- Use **StrictMock** selectively for critical interactions where strict verification is necessary.
- Avoid mixing different mock wrappers on the same mock class or object hierarchy.
- Monitor uninteresting call warnings during test development to identify missing expectations or design gaps.
- Use `EXPECT_CALL(...).Times(AnyNumber())` when methods may be called arbitrarily without needing full verification.

---

## Next Steps

- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) section **The Nice, the Strict, and the Naggy** for practical examples.
- Refer to the [Mocking Reference on NiceMock, NaggyMock, StrictMock](reference/mocking.md#NiceMock) for API details.
- Learn about [Expectation Specification](docs/gmock_for_dummies.md#setting-expectations), [Default Actions (ON_CALL)](docs/gmock_cook_book.md#SettingDefaultActions), and [Match Makers and Actions](docs/gmock_cook_book.md) to craft tests precisely.

---

## References

- [gMock Cookbook: The Nice, the Strict, and the Naggy](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy)
- [Mocking Reference - NiceMock, NaggyMock, StrictMock](reference/mocking.md#NiceMock)
- [gMock for Dummies](docs/gmock_for_dummies.md) - Beginner-friendly mocking guide
- [Installing and Integrating GoogleTest](googletest-guides/getting-started/setup-integration.mdx) for setup help

---

## Example Code Snippet

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
  MOCK_METHOD(void, DoThat, (), ());
};

TEST(ExampleTest, NiceMockSuppressesWarnings) {
  NiceMock<MockFoo> mock;
  EXPECT_CALL(mock, DoThis());
  mock.DoThis();  // OK
  mock.DoThat();  // No warning
}

TEST(ExampleTest, NaggyMockWarns) {
  NaggyMock<MockFoo> mock;
  EXPECT_CALL(mock, DoThis());
  mock.DoThis();
  mock.DoThat();  // Warning printed
}

TEST(ExampleTest, StrictMockFailsOnUnexpected) {
  StrictMock<MockFoo> mock;
  EXPECT_CALL(mock, DoThis());
  mock.DoThis();  // OK
  mock.DoThat();  // Test failure: unexpected call
}
```
