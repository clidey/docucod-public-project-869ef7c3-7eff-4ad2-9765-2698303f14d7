---
title: "Introduction to Mocking with GoogleMock"
description: "A practical walkthrough for creating and using mock objects in your tests. Learn to define mocks, set expectations for calls, and simulate complex behaviors. Ideal for users who need to isolate dependencies and test interfaces in depth."
---

# Introduction to Mocking with GoogleMock

## Workflow Overview

### Purpose of This Guide
This guide provides a practical walkthrough to help you create and use mock objects effectively in your tests using GoogleMock (gMock). You'll learn how to define mocks for interfaces, set up expectations on method calls, specify behaviors through actions, and handle call order and repetitions. The goal is to help you isolate dependencies, verify interactions, and simulate complex behaviors in your C++ unit tests.

### Prerequisites
- Familiarity with C++ basics and object-oriented programming.
- A functional GoogleTest and GoogleMock environment.
- Basic understanding of unit testing concepts.
- The interface or class you intend to mock should have virtual methods.

### Expected Outcome
After completing this guide, you will be able to:
- Define mock classes using `MOCK_METHOD` macro.
- Set expectations on mock methods using `EXPECT_CALL`.
- Provide default behaviors with `ON_CALL`.
- Control call counts using cardinalities (e.g., `Times`, `AtLeast`).
- Specify sequences or partial order of calls.
- Use actions to specify what mock methods should do when called.

### Estimated Time Commitment
Approximately 20 to 30 minutes to read and experiment with the examples.

### Difficulty Level
Intermediate

---

## Step-by-Step Instructions

### 1. Define a Mock Class
Begin by mocking your interface by subclassing it and defining mock methods with the `MOCK_METHOD` macro. This macro generates method implementations that allow you to specify expectations.

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

> **Tip:** Always define `MOCK_METHOD` in the `public` section regardless of the base class method's access level.

### 2. Create Mock Object and Set Default Actions with `ON_CALL`
Use `ON_CALL` to define the default behavior for mock methods. This step is optional but recommended to avoid warnings on uninteresting calls.

```cpp
using ::testing::Return;

MockTurtle turtle;
ON_CALL(turtle, GetX()).WillByDefault(Return(0));
ON_CALL(turtle, GetY()).WillByDefault(Return(0));
```

> **Best Practice:** Use `ON_CALL` in your test setup to provide sensible defaults.

### 3. Set Expectations Using `EXPECT_CALL`
Specify expectations on calls you intend to verify using `EXPECT_CALL`. This includes expected arguments, call counts, and actions to perform.

```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::AtLeast;
using ::testing::Return;

EXPECT_CALL(turtle, PenDown()).Times(1);
EXPECT_CALL(turtle, Forward(100)).Times(AtLeast(1));
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))
    .WillRepeatedly(Return(50));
```

- Use `_` to match any argument.
- Use cardinalities like `.Times(1)`, `.Times(AtLeast(n))`, or `.Times(AnyNumber())`.

### 4. Execute Test Logic
Run your code that uses the mock object. GoogleMock will verify that the expectations are met during execution.

```cpp
painter.PaintCircle(&turtle, 0, 0, 100);
```

### 5. Verification and Cleanup
GoogleMock automatically verifies expectations on mock destruction. To verify earlier, use:

```cpp
using ::testing::Mock;
Mock::VerifyAndClearExpectations(&turtle);
```

---

## Practical Examples

### Example 1: Basic Mock and Expectation

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
};

TEST(PaintTest, CallsPenDown) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(1);

  Painter painter(&turtle);
  painter.Draw();  // Painter is expected to call turtle.PenDown()
}
```

### Example 2: Using Sequences to Enforce Call Order

```cpp
using ::testing::Sequence;

Sequence s;
EXPECT_CALL(turtle, PenDown()).InSequence(s);
EXPECT_CALL(turtle, Forward(100)).InSequence(s);

// Then calls to the mock must follow PenDown() before Forward(100)
```

### Example 3: Setting Default Action for a Method Using `ON_CALL`

```cpp
ON_CALL(turtle, GetX()).WillByDefault(Return(10));
EXPECT_CALL(turtle, GetX()).Times(AnyNumber());

ASSERT_EQ(turtle.GetX(), 10);
```

### Example 4: Returning Different Values on Consecutive Calls

```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))
    .WillOnce(Return(200))
    .WillRepeatedly(Return(300));
```

---

## Troubleshooting & Tips

### Common Issues
- **Uninteresting calls generate warnings:**
  This occurs when a mock method is called without an `EXPECT_CALL`. Use `ON_CALL` to provide default behavior or suppress using `NiceMock`.

- **Unexpected calls detected:**
  Verify that your expectations match the method calls and arguments precisely. Use `--gmock_verbose=info` to get detailed traces.

- **Method not mocked happens:**
  Ensure the method you want to mock is virtual. Non-virtual methods cannot be mocked directly.

- **Multiple expectations conflict:**
  Use explicit sequences or the `.RetiresOnSaturation()` clause to manage expectation lifetimes.

### Best Practices
- Use `EXPECT_CALL` only to verify calls you care about. Default others with `ON_CALL`.
- Set call order explicitly when the sequence matters.
- Use cardinalities to control expected call counts.
- Avoid over-specifying argument matchers to keep tests maintainable.
- Use lambdas or `Invoke()` to define complex behaviors.

### Performance & Optimization
- For fast compilation, move mock class constructors and destructors to CPP files.
- Use `Mock::VerifyAndClearExpectations` to verify mocks early and reset state.

### Alternative Workflows
- Delegate calls to real or fake objects via `ON_CALL` to reuse existing code.
- Use `MockFunction` to mock `std::function` types directly.

---

## Next Steps & Related Content

- **Building Maintainable Mocks: Nice, Strict, and Naggy Patterns** - Learn how to control mock object strictness.
- **Working with Matchers, Actions, and Cardinalities** - Deep dive into argument matching and action specification.
- **gMock for Dummies** - For a beginner-friendly introduction to mocking with gMock.
- **Mocking Reference** - In-depth API details for mocking.
- **Actions Reference** - Detailed list of built-in actions and how to create custom ones.
- **gMock FAQ** - Answers to common questions and troubleshooting advice.

---

For comprehensive tutorials, visit the official documentation links provided in the summary below.
