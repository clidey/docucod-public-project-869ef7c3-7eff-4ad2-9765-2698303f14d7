---
title: "Writing and Using Assertions"
description: "An actionable guide to the different assertions available in GoogleTest, their usage patterns, and how to choose the right tool for the job. Includes real-world examples for equality, inequality, floating-point, string, and exception assertions."
---

# Writing and Using Assertions in GoogleTest

This guide empowers you to master GoogleTest's assertion macros, helping you write clear, precise tests in C++. You will learn how to verify code behavior effectively using different categories of assertions, understand appropriate usage scenarios, and see practical examples that cement best practices.

---

## 1. Overview of Assertions

Assertions are the core tool in GoogleTest for verifying that your code behaves as expected. They come in pairs:

- **EXPECT_*** variants generate nonfatal failures, allowing the test to continue.
- **ASSERT_*** variants generate fatal failures, aborting the current function immediately.

Use assertions wherever you want to check a condition and signal a test failure if it is not met.

### Key Points

- Flow control differs: `ASSERT_` aborts further execution in the current function.
- All assertions support streaming custom failure messages with `<<`.
- Assertions evaluate their arguments exactly once to prevent side effects.


## 2. Basic Assertions for Success and Failure

### SUCCEED()
Generates a documented success mark without affecting the test result.

```cpp
SUCCEED();
```

### FAIL()
Generates a fatal failure, immediately aborting the current function.

```cpp
FAIL() << "This failure is critical.";
```

### ADD_FAILURE()
Generates a nonfatal failure but lets the test continue.

```cpp
ADD_FAILURE() << "Non-critical issue encountered.";
```

### ADD_FAILURE_AT(file, line)
Generates a nonfatal failure at a specific source location.

```cpp
ADD_FAILURE_AT("file.cc", 42) << "Error at line 42.";
```

---

## 3. Boolean Value Assertions

Check simple conditions using:

| Assertion    | Meaning                          |
|--------------|--------------------------------|
| `EXPECT_TRUE`  | Condition must be true          |
| `ASSERT_TRUE`  | Condition must be true, aborts on failure |
| `EXPECT_FALSE` | Condition must be false         |
| `ASSERT_FALSE` | Condition must be false, aborts on failure |

```cpp
EXPECT_TRUE(is_valid) << "Validation failed";
ASSERT_FALSE(has_error);
```

---

## 4. Binary Comparison Assertions

Compare two values with the following assertions, which check relational conditions:

| Assertion             | Meaning                     |
|-----------------------|-----------------------------|
| `EXPECT_EQ(val1, val2)`  | `val1 == val2`              |
| `ASSERT_EQ(val1, val2)`  | `val1 == val2` (fatal)      |
| `EXPECT_NE(val1, val2)`  | `val1 != val2`              |
| `ASSERT_NE(val1, val2)`  | `val1 != val2` (fatal)      |
| `EXPECT_LT(val1, val2)`  | `val1 < val2`               |
| `ASSERT_LT(val1, val2)`  | `val1 < val2` (fatal)       |
| `EXPECT_LE(val1, val2)`  | `val1 <= val2`              |
| `ASSERT_LE(val1, val2)`  | `val1 <= val2` (fatal)      |
| `EXPECT_GT(val1, val2)`  | `val1 > val2`               |
| `ASSERT_GT(val1, val2)`  | `val1 > val2` (fatal)       |
| `EXPECT_GE(val1, val2)`  | `val1 >= val2`              |
| `ASSERT_GE(val1, val2)`  | `val1 >= val2` (fatal)      |

> **Pointer note:** For pointer comparisons, `EXPECT_EQ` and `EXPECT_NE` check pointer identity, not string contents. Use `EXPECT_STREQ`/`EXPECT_STRNE` for C strings.

```cpp
EXPECT_EQ(result, expected_value);
ASSERT_NE(pointer, nullptr);
```

---

## 5. C String Comparison Assertions

To compare C strings (`const char*`, `wchar_t*`), use:

| Assertion          | Meaning                                   |
|--------------------|-------------------------------------------|
| `EXPECT_STREQ(str1, str2)`  | Check strings have same contents          |
| `ASSERT_STREQ(str1, str2)`  | Same as above, fatal on failure            |
| `EXPECT_STRNE(str1, str2)`  | Check strings differ in contents           |
| `ASSERT_STRNE(str1, str2)`  | Same as above, fatal on failure            |
| `EXPECT_STRCASEEQ(str1, str2)` | Same as `STREQ` but case-insensitive       |
| `ASSERT_STRCASEEQ(str1, str2)` | Fatal case-insensitive string equality     |
| `EXPECT_STRCASENE(str1, str2)` | Case-insensitive inequality check         |
| `ASSERT_STRCASENE(str1, str2)` | Fatal case-insensitive inequality check   |

```cpp
EXPECT_STREQ("hello", returned_c_string);
ASSERT_STRNE(ptr1, ptr2);
```

---

## 6. Floating-Point Comparison Assertions

Due to rounding, exact floating-point equality is unreliable. Use these assertions:

| Assertion          | Description                                                       |
|--------------------|-------------------------------------------------------------------|
| `EXPECT_FLOAT_EQ(val1, val2)` | Check float values approximately equal within 4 ULPs             |
| `ASSERT_FLOAT_EQ(val1, val2)` | Same as above with fatal failure                                  |
| `EXPECT_DOUBLE_EQ(val1, val2)` | Check double values approximately equal within 4 ULPs            |
| `ASSERT_DOUBLE_EQ(val1, val2)` | Same as above with fatal failure                                  |
| `EXPECT_NEAR(val1, val2, abs_error)` | Check difference bounded by absolute error                       |
| `ASSERT_NEAR(val1, val2, abs_error)` | Same as above with fatal failure                                  |

These assertions treat infinities and NaNs appropriately. They provide reliable and informative failure messages.

```cpp
EXPECT_FLOAT_EQ(computed_pi, 3.14159f);
EXPECT_NEAR(measured, expected, 0.001);
```

---

## 7. Predicate Assertions

When built-in assertions don't suffice, predicate assertions allow custom predicates:

| Assertion                  | Purpose                                                                       |
|----------------------------|-------------------------------------------------------------------------------|
| `EXPECT_PRED1(pred, val1)`       | Verifies unary predicate returns true                                        |
| `EXPECT_PRED2(pred, val1, val2)` | Verifies binary predicate returns true (up to `EXPECT_PRED5`)               |
| `ASSERT_PRED*` variants           | Same as above but fatal failures                                             |
| `EXPECT_PRED_FORMAT*`             | Uses predicate-formatter functions providing detailed failure messages      |

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, x);

// Predicate formatter example
AssertionResult IsPositive(const char* expr, int n) {
  if (n > 0) return AssertionSuccess();
  return AssertionFailure() << expr << " evaluates to " << n << ", which is not positive.";
}
EXPECT_PRED_FORMAT1(IsPositive, val);
```

### Notes

- Predicate assertions always evaluate each argument once only.
- You can use explicit casting to disambiguate overloaded predicates or specify template arguments.

---

## 8. HRESULT Assertions (Windows Only)

For Windows code, these verify if HRESULTs indicate success or failure.

| Assertion                | Meaning                    |
|--------------------------|----------------------------|
| `EXPECT_HRESULT_SUCCEEDED(expr)` | Verifies expr is a success HRESULT |
| `ASSERT_HRESULT_SUCCEEDED(expr)` | Same as above, fatal failure on error |
| `EXPECT_HRESULT_FAILED(expr)`    | Verifies expr is failure HRESULT      |
| `ASSERT_HRESULT_FAILED(expr)`    | Same as above, fatal failure           |

Example usage:
```cpp
EXPECT_HRESULT_SUCCEEDED(ptr->DoSomething());
```

---

## 9. Death Assertions

Death assertions verify that code causes program termination under expected conditions.

| Assertion             | Description                                                               |
|-----------------------|---------------------------------------------------------------------------|
| `EXPECT_DEATH(stmt, matcher)`        | stmt causes process to terminate, output matches regex or matcher           |
| `ASSERT_DEATH(stmt, matcher)`        | Same as above, fatal                                                    |
| `EXPECT_DEATH_IF_SUPPORTED`          | Runs death test only if supported, otherwise no verification              |
| `EXPECT_DEBUG_DEATH`                  | Runs death test only in debug mode, otherwise executes normally          |
| `EXPECT_EXIT(stmt, predicate, matcher)` | Exit with status satisfying predicate and output matching matcher      |
| `ASSERT_EXIT`                        | Fatal variant of EXPECT_EXIT                                               |

Example:
```cpp
EXPECT_DEATH(DoSomething(-1), "Invalid argument");
EXPECT_EXIT(NormalExit(), ExitedWithCode(0), "Success");
```

---

## 10. Examples

### 10.1 Simple Equality Check
```cpp
TEST(MyTest, BasicEquality) {
  int actual = GetValue();
  EXPECT_EQ(actual, 42) << "Value was not as expected.";
}
```

### 10.2 Expecting Method Call with Argument Matchers
```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, Add, (int a, int b), ());
};

TEST(MyTest, ExpectAddCalled) {
  MockFoo mock;
  EXPECT_CALL(mock, Add(::testing::Gt(0), ::testing::_))
      .WillOnce(::testing::Return(100));

  int result = mock.Add(3, 4);
  EXPECT_EQ(result, 100);
}
```

### 10.3 Floating-point Approximate Comparison
```cpp
TEST(MyTest, FloatingPointComparison) {
  double computed = ComputePiApprox();
  EXPECT_NEAR(computed, 3.1415926535, 0.0001);
}
```

### 10.4 Predicate Assertion
```cpp
bool IsPositive(int n) { return n > 0; }

TEST(MyTest, PositiveValue) {
  int value = GetValue();
  EXPECT_PRED1(IsPositive, value) << "Value is not positive.";
}
```

### 10.5 Death Test
```cpp
TEST(MyTest, DeathTest) {
  EXPECT_DEATH(MyFunction(-1), "negative argument");
}
```

---

## 11. Best Practices & Tips

- Use `EXPECT_` for noncritical checks to allow test continuation; use `ASSERT_` when failure invalidates following code.
- Prefer `EXPECT_NEAR`, `EXPECT_FLOAT_EQ`, or `EXPECT_DOUBLE_EQ` over plain equality for floating types.
- Use `EXPECT_STREQ` / `EXPECT_STRNE` for C string comparisons, not `EXPECT_EQ`.
- Use predicate assertions when checking complex conditions.
- Write clear, concise error messages with streaming `<<` to facilitate quick diagnosis.
- For death tests, make sure that the expected message matches actual output.
- Avoid over-specification in tests, keep expectations focused on the contract.

---

## 12. Troubleshooting Common Issues

### Unexpected Failure Despite Correct Code
- Ensure that `EXPECT_CALL` expectations are set **before** the tested code calls the mock.
- Verify argument matchers align with the actual call arguments.

### Issues with Floating-Point Comparisons
- Use approximate assertions (`EXPECT_NEAR`, `EXPECT_FLOAT_EQ`) to handle rounding differences.

### Failure in Death Tests
- Check the matcher expression used for expected output.
- Confirm death tests are supported and enabled on your platform.

### Unintentional Uninteresting Call Warnings
- Add an `EXPECT_CALL(...).Times(AnyNumber())` or use `NiceMock` to suppress harmless warnings.

### Matcher or Action Not Working
- Confirm the matcher types match the argument types.
- Use `SafeMatcherCast` to convert mismatched types where safe.
- Define custom actions with lambdas or functors when built-in ones are insufficient.

---

## 13. Related Documentation and Resources

- [GoogleTest Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [gMock Cookbook - Writing Expectations and Actions](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md)
- [Understanding Uninteresting vs Unexpected Calls in gMock](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#uninteresting-vs-unexpected)
- [Using Parameterized and Typed Tests](../advanced-testing-patterns/parameterized-tests.md)

---

## 14. Next Steps

- Learn about matchers and how to write complex argument checks.
- Explore actions to specify mock method behaviors beyond simple returns.
- Understand sequencing and ordering of expectations for interaction-based testing.
- Advance to mocking techniques with GoogleMock for injecting and verifying collaborator behavior.

---

## 15. References

- GoogleTest documentation repository: https://github.com/google/googletest
- GoogleMock documentation for mocking APIs and writing expectations.

---

**Summary:** This guide provides an essential reference to GoogleTest assertions, guiding you through success/failure assertions, binary comparisons, floating-point handles, string comparisons, predicate assertions, death tests, and best practices, all illustrated with relatable code examples.