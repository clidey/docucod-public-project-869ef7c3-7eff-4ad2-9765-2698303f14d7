---
title: "FAQ and Common Issues"
description: "Curates the most frequently asked questions and typical pitfalls encountered when using GoogleTest and GoogleMock. Offers practical solutions and links to deeper resources, easing troubleshooting for developers at every level."
---

# FAQ and Common Issues

This page curates the most frequently asked questions and typical pitfalls encountered when using **GoogleTest** and **GoogleMock**. It offers practical solutions and links to deeper resources to ease troubleshooting for developers at every level.

---

## 1. Common Questions and Answers

### When I call a method on my mock object, the method from the real object is invoked instead. What's wrong?

- **Cause:** The method must be declared as `virtual` to be mockable by GoogleMock.
- **Solution:** Ensure the base class method is marked `virtual`. If you want to mock non-virtual methods, refer to the [Mocking Non-Virtual Methods](docs/reference/mocking.md#MockingNonVirtualMethods) section for alternative approaches.

### Can I mock variadic functions (functions with `...`) directly?

- **Answer:** No, GoogleMock cannot mock variadic functions directly due to argument count and type ambiguity.
- **Workaround:** Provide overloaded versions of the function or redesign your API to avoid variadic functions.

### Why do I get warnings about overriding functions differing by only `const` qualifiers on parameters when using MSVC?

- **Cause:** MSVC sometimes issues C4301 or C4373 warnings for such cases, although it's a compiler bug.
- **Advice:** Remove top-level `const` qualifiers on parameters in the base and mock classes where possible, as they are ignored in declarations.

### My expectations are not satisfied, but I am not sure why. How can I debug?

- Try running your tests with `--gmock_verbose=info` to get detailed traces of mock function calls and expectation matching.
- This will print call matching information and stack traces to help identify why expectations might fail.

### I’m seeing "Uninteresting function call" warnings even though I used `ON_CALL` to set behaviors. Why?

- By design, `ON_CALL` sets the default action but does not imply an expectation that the method will be called.
- If no `EXPECT_CALL` is present for a method, calls to it are uninteresting.
- To suppress warnings, either define appropriate `EXPECT_CALL` (possibly with `.Times(AnyNumber())`) or wrap your mock in `NiceMock`.

### How do I assert that a function is NEVER called?

```cpp
EXPECT_CALL(mock_object, Method(_))
    .Times(0);
```

- This explicitly forbids any calls to the method.

### Why does gMock check expectations on mock destruction, and what if my mock is never deleted?

- gMock verifies expectations automatically on destruction to ensure all expected calls were made.
- If a mock object is leaked, verification won't happen, possibly hiding bugs.
- Use `Mock::VerifyAndClearExpectations(&mock_obj)` to force verification earlier.
- Enabling a heap checker can warn you about leaked mock objects.

### How do I deal with unexpected calls or excessive calls to a mock method?

- Unexpected calls happen when a call’s arguments don’t match any `EXPECT_CALL`.
- Excessive calls occur when a method is called more than the expected number of times.
- Both result in test failures.
- To allow more calls, adjust `.Times()` or add a catch-all `EXPECT_CALL` with `.Times(AnyNumber())`.

### Can I control the order in which mocked method calls should happen?

- Use the `InSequence` helper to enforce strict ordering between calls.

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, MethodA());
  EXPECT_CALL(mock, MethodB());
}
```

- For partial orders, use `EXPECT_CALL(...).After(...)` or multiple `Sequence` objects with `.InSequence(...)`.

### What do the different mock policies mean: NiceMock, NaggyMock, StrictMock?

- **NaggyMock (default):** Warns about uninteresting calls.
- **NiceMock:** Suppresses warnings for uninteresting calls.
- **StrictMock:** Treats uninteresting calls as errors.
- Use `NiceMock` to suppress noise during test development, and `StrictMock` to enforce strict call expectations.

### How do I define default behavior on a mock method without requiring an expectation?

- Use `ON_CALL(mock_obj, method(args))` to set default actions with `.WillByDefault(action)`.
- These default actions are overridden by specific `EXPECT_CALL`s.

### How do I verify and clear expectations or default actions during testing?

```cpp
// Verifies expectations and removes them, returning true on success.
Mock::VerifyAndClearExpectations(&mock_obj);

// Verifies and removes expectations and default actions.
Mock::VerifyAndClear(&mock_obj);
```

- Do not set new expectations after verification.

---

## 2. Practical Troubleshooting Tips

### Problem: I get multiple failure messages related to the same expectation.

- GoogleMock prints expectation states at different points of failure.
- These are distinct error reports and help diagnose failures over time.

### Problem: My tests fail because of interactions with mocks I do not own.

- Avoid mocking classes you do not own.
- Instead, define adaptor interfaces that you own.
- Mock those adaptors, isolating dependencies safely.

### Problem: My mock returns default zeros and doesn’t behave as expected.

- Either set explicit `EXPECT_CALL` with `.WillOnce()`/`.WillRepeatedly()`.
- Or set default behaviors with `ON_CALL`.
- For custom default values, see `DefaultValue<T>::Set()`.

### Problem: I want my mock method to return a value that changes at runtime.

- Use `ReturnPointee(&variable)` to return a live-updated value.
- `Return()` stores a copy at expectation setup time.

### Problem: How to simplify working with overloaded methods?

- Use `MOCK_METHOD` with fully specified signature and qualifiers.
- Use `Const()` wrapper for const overloads.
- Use helper templates or simplified mock interfaces where possible.

### Problem: I get compilation errors when mocking methods with complex or template arguments.

- Wrap complex types like `std::pair<bool,int>` in extra parentheses.
- Use type aliases to simplify argument lists.

### Problem: I'm not sure when an expectation expires or stops matching calls.

- Expectations are "sticky" by default and remain active even when saturated.
- Use `.RetiresOnSaturation()` to retire an expectation after it reaches its upper bound.

---

## 3. Helpful Flags and Verbosity Settings

### `--gmock_verbose` Flag

Controls the amount of diagnostic information printed by GoogleMock.

| Level   | Description                                                              |
|---------|--------------------------------------------------------------------------|
| `info`  | Prints details on all calls, including matches, and stack traces.       |
| `warning` (default) | Prints warnings and errors only; less verbose.                        |
| `error` | Prints only errors (least verbose).                                     |

**Usage example:**

```bash
./my_test_binary --gmock_verbose=info
```

### `--gmock_catch_leaked_mocks=0|1`

Controls whether leaked mocks are reported as failures.

---

## 4. Troubleshooting Example: Unexpected Calls

When your test fails with a message like:

```text
Unexpected mock function call - returning default value.
    Function call: Foo(5, 10)
```

Follow these steps:

1. **Check your expectations:** Make sure you have an `EXPECT_CALL` that matches the call.
2. **Verify argument matchers:** Confirm that the arguments specified match what your code is passing.
3. **Use `--gmock_verbose=info`:** Get detailed logs showing how gMock tries to match calls.
4. **Add catch-all expectations if appropriate:** To allow unexpected calls, add

```cpp
EXPECT_CALL(mock, Foo(_)).Times(AnyNumber());
```

but use this cautiously to avoid hiding bugs.

---

## 5. Tips for Effective Use of GoogleMock

- Set expectations **before** executing code that uses the mocks.
- Use broad matchers like `_` only when you do not care about specific argument values.
- Use `InSequence` or ordering constraints only as needed to avoid brittle tests.
- Use `NiceMock` during test development to reduce noisy warnings.
- Use `.RetiresOnSaturation()` to manage overlapping expectations gracefully.
- Verify and clear expectations early if your mocks have complex lifetimes.
- Keep mock definitions simple and put mocks in relevant test directories to avoid dependency issues.

---

## 6. Additional Resources

- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — A beginner-friendly guide to mocking in C++.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Recipes and best practices for advanced usage.
- [Mocking Reference](docs/reference/mocking.md) — Detailed documentation of mocking macros and features.
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) — Quick reference for common mocking scenarios.
- [Mocking Policies and Behaviors](googletest-guides/advanced-mocking/mocking-policies-and-behaviors.html) — Explanation of Nice, Naggy, and Strict mocks.
- [Integration with Platforms and Build Systems](googletest-guides/integration-and-troubleshooting/platforms-and-build-systems.html) — For setup and troubleshooting in various environments.

---

## 7. Troubleshooting Links

If you encounter common integration or build issues, see:

- [Troubleshooting Common Issues](getting-started/first-test-execution/troubleshooting-common-issues.mdx)
- [Platforms and Build Systems](googletest-guides/integration-and-troubleshooting/platforms-and-build-systems.html)

---

This FAQ is your quick first stop when debugging troubles with GoogleTest and GoogleMock, helping you quickly identify root causes and next steps for resolution.