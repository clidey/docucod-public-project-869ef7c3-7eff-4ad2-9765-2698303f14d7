---
title: "Platforms and Build Systems"
description: "Provides solutions for using GoogleTest across supported platforms, including Linux, macOS, Windows, and embedded environments. Includes tips for integrating with various build systems and addressing compatibility pitfalls."
---

# Platforms and Build Systems

This page provides practical solutions for using GoogleTest across various supported platforms including Linux, macOS, Windows, and embedded environments. It offers actionable guidance on integrating GoogleTest with common build systems while addressing platform-specific considerations and compatibility pitfalls.

---

## 1. Overview

GoogleTest is designed to be portable and works seamlessly on major desktop platforms as well as certain embedded environments. This document guides you through platform-specific entry point requirements, integration tips with popular build systems like CMake and Bazel, and how to handle special cases when targeting embedded and constrained systems.

### Supported Platforms and Environments

- **Desktop Platforms:**
  - Linux
  - macOS
  - Windows
- **Embedded Platforms:**
  - Arduino-like boards (e.g., ESP8266, ESP32, NRF52)
  - QuRT Operating System

### Integration Paradigms

- Use the conventional `main()` function entry point on most platforms.
- Adapt to platform-specific lifecycle methods (`setup()`, `loop()`) on embedded.
- Initialize testing framework properly to handle platform constraints.

---

## 2. Platform Entry Points and Initialization

GoogleTest requires initialization before running tests. How you initialize it depends on your platform and build environment.

### Desktop and Normal Platforms

GoogleTest expects a standard C++ `main` function with argc/argv parameters.

<Steps>
<Step title="Use the provided main function or define your own"> 
GoogleTest ships with a default main function (`gtest_main`) that you can link your tests against. It initializes GoogleTest and runs all tests when executed.
- If you want to customize the main function, copy the logic from `googletest/src/gtest_main.cc`:

```cpp
int main(int argc, char **argv) {
  printf("Running main() from gtest_main.cc\n");
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Initialization parses GoogleTest flags and prepares the framework.
</Step>
<Step title="Command Line Arguments">
Pass command line arguments to your test binary as GoogleTest honors several flags for filtering tests, running ordering, and output formatting.
</Step>
</Steps>

### Embedded and Arduino-like Platforms

When targeting embedded environments such as ESP8266, ESP32, or NRF52 (Arduino), the program lifecycle is different:

- Entry points are `setup()` and `loop()` rather than `main()`.
- Initialization of GoogleTest is done inside `setup()`, with tests executed inside the `loop()`.

Example adapted from `googletest/src/gtest_main.cc`:

```cpp
void setup() {
  testing::InitGoogleTest();
}

void loop() {
  RUN_ALL_TESTS();
}
```

### QuRT Platform

QuRT OS uses `main()` but the argument values (`argc/argv`) may be unusable. Initialize GoogleTest without arguments:

```cpp
int main() {
  printf("Running main() from gtest_main.cc\n");
  testing::InitGoogleTest();
  return RUN_ALL_TESTS();
}
```

---

## 3. Integrating GoogleTest with Build Systems

This section gives practical tips for combining GoogleTest with common build systems.

### CMake Integration

GoogleTest includes CMake build scripts compatible with modern CMake versions.

#### Standalone Build

1. Clone the repository:

```bash
git clone https://github.com/google/googletest.git
cd googletest
mkdir build && cd build
cmake ..
make
```

2. Test executables can link directly to `gtest` and `gmock` libraries.

#### Integrating into Existing Project

- Use `FetchContent` or add GoogleTest as a subdirectory:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(your_test test.cpp)
target_link_libraries(your_test gtest_main)
add_test(NAME your_test COMMAND your_test)
```

- Use `gtest_main` or `gmock_main` to get the default `main()` function.

- Configure your C++ standard to at least C++17 (`set(CMAKE_CXX_STANDARD 17)`).

- Ensure proper threading support is enabled (`-DGTEST_HAS_PTHREAD=1` or equivalent).

#### Visual Studio Runtime Considerations

- Visual Studio defaults to dynamic runtime linking.
- GoogleTest links statically by default and may cause linkage conflicts.
- Use `-Dgtest_force_shared_crt=ON` to match runtimes.

### Bazel Integration

GoogleTest supports Bazel builds with provided BUILD configurations.

- Include GoogleTest rules in your WORKSPACE.
- Define `cc_test` targets in BUILD files which depend on `@com_google_googletest//...`.
- Tests automatically obtain the proper `main()` and flags via Bazel.

---

## 4. Special Considerations & Compatibility Tips

### Linking GoogleMock

- GoogleMock depends on GoogleTest; always link to both or to `gmock_main`.
- For embedded or custom environments, ensure `InitGoogleMock()` is called instead of `InitGoogleTest()` to initialize both frameworks.

Example main for GoogleMock:

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- For Arduino and embedded platforms, initialize GoogleMock in `setup()` and run tests in `loop()`.

### Threading Support

- GoogleTest and GoogleMock are thread-safe if pthread is available.
- On platforms where pthread is unavailable (e.g., some Windows versions), tests should ideally run single-threaded.
- Link and compile your project with pthread support if concurrent test execution or internal synchronization is required.

### Cross-Platform Macro Guards

Use macros in your code to adapt initialization and main function definitions for various platforms, based on the provided platform definitions:

```cpp
#if defined(GTEST_OS_ESP8266) || defined(GTEST_OS_ESP32) ||\
    (defined(GTEST_OS_NRF52) && defined(ARDUINO))
  // Arduino platform code
#elif defined(GTEST_OS_QURT)
  // QuRT platform code
#else
  // Normal main
#endif
```

This lets you maintain portable test code that works everywhere.

### Build Options and Flags

- Control GoogleTest behavior via command-line flags parsed by `InitGoogleTest()`.
- Use `--gtest_filter` to run specific tests.
- Use `--gmock_verbose` to adjust GoogleMock output verbosity.
- Ensure your build system passes all relevant command line options to the test binaries.

---

## 5. Practical Tips

- **Prefer linking with provided `gtest_main` or `gmock_main` libraries** to avoid writing your own `main()` unless customization is needed.

- **When using embedded platforms, adapt to the `setup()`/`loop()` entry points and avoid reliance on `argc` and `argv`.**

- **Configure your build system explicitly to use C++17 or later** to match GoogleTestâ€™s requirements.

- **Ensure thread libraries are linked correctly** to avoid runtime errors.

- **If you encounter linker errors related to runtime libraries on Windows, review the Visual Studio runtime linkage setting.**

- **For advanced uses, embed GoogleTest into your own build to maintain consistent compilation settings across your code base.**

- **Use conditional compilation in your tests to handle platform-specific initialization.**

- **Check GoogleTest documentation and your build tool's manuals for detailed flag usage.**

---

## 6. Troubleshooting

### Common Issues

- **Linker cannot find `main()` when linking your tests:**
  - Link against `gtest_main` or `gmock_main`.
  - Provide your own main exactly as documented.

- **Runtime errors on embedded platforms related to main:**
  - Use `setup()` and `loop()` functions as GoogleTest expects for these environments.

- **Compiler errors about missing C++17 features:**
  - Ensure your compiler and build system explicitly use C++17 or higher.

- **Runtime errors or crashes with threading:**
  - Confirm pthread libraries are linked.
  - Use single-threaded mode if on unsupported platforms.

- **Mismatch runtime library errors in Visual Studio:**
  - Adjust `gtest_force_shared_crt` option.

### Verifying Successful Setup

- Confirm that test binaries compile and link without errors.
- Run the tests and observe `Running main() from ...` output to verify the correct main is linked.
- On embedded platforms, check that tests execute in the `loop()` function properly.

---

## 7. Next Steps & Related Content

- Explore [Quickstart with CMake](./googletest-guides/getting-started/quickstart-cmake) to learn practical integration in CMake projects.

- Consult [Quickstart with Bazel](./googletest-guides/getting-started/quickstart-bazel) for Bazel setup.

- See [Installation Methods](./getting-started/setup-installation/installation-methods) for deep dive into installing GoogleTest.

- Review [Configuration & Integration](./getting-started/setup-installation/configuration-integration) for details on integration with build systems.

- Refer to [FAQ and Common Issues](./googletest-guides/integration-and-troubleshooting/faq-and-common-issues) for troubleshooting tips.

- Learn about [GoogleMock Initialization](./docs/reference/mocking.md) for tests requiring mocks.

---

_For comprehensive code examples, refer to the source files:_

- [`googletest/src/gtest_main.cc`](https://github.com/google/googletest/blob/main/googletest/src/gtest_main.cc)
- [`googlemock/src/gmock_main.cc`](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc)

These files illustrate the platform-specific main function implementations and embedded entry point methods.

---