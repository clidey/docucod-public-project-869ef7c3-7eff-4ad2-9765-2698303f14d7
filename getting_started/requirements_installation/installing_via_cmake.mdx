---
title: "Installation with CMake"
description: "Step-by-step instructions for installing GoogleTest and GoogleMock using CMake, from acquiring the repository to integrating with your project build files. Clarifies how to verify a successful installation."
---

# Installation with CMake

This guide provides detailed, step-by-step instructions to install and build **GoogleTest** and **GoogleMock** using CMake. Whether you are setting up GoogleTest for the first time or integrating it into your existing project, this documentation will walk you through acquiring the source, building the libraries, and verifying the installation.

---

## 1. Prerequisites & System Requirements

Before starting the installation, ensure your system meets the following requirements:

- **Operating System:** Linux, Windows, macOS, or BSD variants supported.
- **Compiler:** A C++ compiler supporting C++17 or newer standards.
- **Build Tools:**
  - [CMake](https://cmake.org/) version 3.14 or higher.
  - Native build tool such as GNU Make, Ninja, or Visual Studio build tools.
- **Network:** Internet access to download the repository or archive.

<Tip>
Make sure your environment's compiler supports C++17 as GoogleTest requires this standard explicitly. Also, installing CMake with appropriate generators (Make, Ninja, or Visual Studio) will streamline the build process.
</Tip>

---

## 2. Acquire GoogleTest and GoogleMock

GoogleTest includes GoogleMock by default in its main repository.

### Option A: Clone from GitHub

```bash
$ git clone https://github.com/google/googletest.git -b main
$ cd googletest
```

### Option B: Download a Release Archive

Download a stable release archive from the [GoogleTest GitHub releases](https://github.com/google/googletest/releases), then extract and `cd` to the directory.

---

## 3. Build Instructions

### 3.1. Create a Build Directory

Create a separate directory for building artifacts to keep sources clean:

```bash
$ mkdir build && cd build
```

### 3.2. Generate Build Files with CMake

By default, the build will include GoogleMock along with GoogleTest.

```bash
$ cmake ..
```

To build **only GoogleTest** without GoogleMock, run:

```bash
$ cmake .. -DBUILD_GMOCK=OFF
```

**Notes:**
- On Windows, Visual Studio project files will be generated.
- On macOS, an Xcode project may be generated if Xcode is installed.

<Tip>
If you want to customize compiler or linker options (e.g., linking against dynamic CRT on Windows), you can use options like `-Dgtest_force_shared_crt=ON`.
</Tip>

### 3.3. Build the Libraries

Run the build command appropriate for your environment:

- On Linux/macOS using Make:

```bash
$ make
```

- Using Ninja:

```bash
$ ninja
```

- On Windows using Visual Studio:

Open the generated `.sln` file and build using the IDE or build from command line.

### 3.4. (Optional) Install Libraries System-wide

If you have administrative privileges and want to install GoogleTest and GoogleMock headers and libraries globally:

```bash
$ sudo make install
```

This typically installs under `/usr/local/` by default. You can change this by setting `CMAKE_INSTALL_PREFIX` during the cmake configure step.

---

## 4. Integrating GoogleTest with Your Project

### 4.1. Using `FetchContent` in Your `CMakeLists.txt`

To integrate GoogleTest smoothly, use CMake's `FetchContent` module to pull the dependency at configure time.

Create or update your project’s `CMakeLists.txt`:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Ensure C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
# For Windows: Prevent resetting parent compiler/linker flags
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

# Define your test executable
add_executable(hello_test hello_test.cc)

# Link GoogleTest main library
target_link_libraries(hello_test GTest::gtest_main)

# Enable test discovery
include(GoogleTest)
gtest_discover_tests(hello_test)
```

> Replace the hash in the URL with the GoogleTest version commit you want to use.

### 4.2. Example Test Source File

Create a simple test file `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

---

## 5. Building and Running Your Tests

### 5.1. Configure Your Project Build

From your project root (containing `CMakeLists.txt`):

```bash
$ cmake -S . -B build
```

This generates the build system files in `build`.

### 5.2. Build Your Tests

```bash
$ cmake --build build
```

### 5.3. Run Tests Using CTest

```bash
$ cd build
$ ctest
```

Expected output:

```
Test project /path/to/my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

<Tip>
If the tests do not run or are not discovered, check that you've included `enable_testing()` and used `gtest_discover_tests()` in your `CMakeLists.txt`.
</Tip>

---

## 6. Verifying Your Installation

You have successfully:

- Cloned or downloaded GoogleTest and GoogleMock sources.
- Compiled the libraries using CMake and your native build tools.
- Optionally installed the libraries globally.
- Configured your own project to depend on GoogleTest using CMake `FetchContent`.
- Created and built a simple test executable.
- Run tests using `ctest` and verified successful test execution.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Installation Issues">
<Accordion title="CMake Version Too Low">
GoogleTest requires CMake 3.14 or newer for certain features like `FetchContent_MakeAvailable()`.

- **Fix:** Upgrade to CMake 3.14+.
</Accordion>
<Accordion title="Compiler Does Not Support C++17">
Compilation errors related to C++17 features indicate your compiler does not fully support C++17.

- **Fix:** Update your compiler or specify `set(CMAKE_CXX_STANDARD 17)` explicitly.
</Accordion>
<Accordion title="Linker Errors on Windows with Runtime Library Mismatch">
You might see errors like `mismatch detected for 'RuntimeLibrary'`.

- **Fix:** Use `-Dgtest_force_shared_crt=ON` when configuring CMake to match your project’s CRT linkage.
</Accordion>
<Accordion title="Tests Not Discovered by CTest">
Make sure `enable_testing()` and `include(GoogleTest)` with `gtest_discover_tests()` are included in your `CMakeLists.txt`.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps

- Explore the [GoogleTest Primer](../primer.md) to learn how to write detailed tests.
- Review the [Assertions Reference](../assertions_reference.md) for using GoogleTest assertion macros.
- Learn to use GoogleMock via the [Creating and Using Mocks](../basic-mocking.md) guide.
- For build system integration beyond CMake, see our [Integration Points](../integration-points.md).

---

## References and Useful Links

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Official Website](https://cmake.org/)
- [Quickstart: Building with CMake](../quickstart-cmake.md)
- [Platform & Toolchain Support](../platform-support.md)

---

### Summary Diagram: Typical Workflow for Installing GoogleTest with CMake

```mermaid
flowchart TD
  A[Start Installation] --> B[Clone or Download GoogleTest]
  B --> C[Create Build Directory]
  C --> D[Run cmake .. to configure]
  D --> E[Build Libraries (make / ninja / Visual Studio)]
  E --> F{Install System-wide?}
  F -->|Yes| G[Run sudo make install]
  F -->|No| H[Skip Installation]
  G --> I[Integrate in Your Project via CMake]
  H --> I
  I --> J[Write Tests Linking to GTest]
  J --> K[Build and Run Tests via CTest]
  K --> L{Tests Pass?}
  L -->|Yes| M[Success: GoogleTest Installed]
  L -->|No| N[Troubleshoot Build or Test Issues]
  N --> D
```

---

This comprehensive guide gets you started with GoogleTest and GoogleMock via CMake quickly, while providing practical tips and troubleshooting hints to ensure success.
