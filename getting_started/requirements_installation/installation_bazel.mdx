---
title: "Install with Bazel"
description: "Guides users through installation using Bazel, mapping out WORKSPACE and BUILD file edits and test integration steps. Enables Bazel-centric projects to quickly adopt GoogleTest with minimal manual configuration."
---

# Install with Bazel

This guide walks you through installing and integrating GoogleTest and GoogleMock into a Bazel-based C++ project. By following the steps below, you will configure your `WORKSPACE` and `BUILD` files properly to adopt GoogleTest with minimal manual setup, enabling you to compile and run tests efficiently within Bazel's ecosystem.

---

## 1. Prerequisites & System Requirements

Before integrating GoogleTest with Bazel, ensure the following:

- **Bazel Installed:** Bazel 5.0 or higher is recommended.
- **Compatible C++ Toolchain:** Your Bazel setup should support C++17 features.
- **GoogleTest Source:** The GoogleTest and GoogleMock source code is available in your project workspace or fetched externally.

<Check>
Verify Bazel is installed:

```bash
bazel version
```

Confirm your toolchain supports C++17.
</Check>

---

## 2. Configure the `WORKSPACE` File

To add GoogleTest as an external dependency in your Bazel environment, you need to either:

- Use a pre-existing GoogleTest repository rule (e.g., `http_archive`) to download a stable release.
- Vendor GoogleTest source code directly into your workspace.

### Step-by-Step: Adding GoogleTest via `http_archive`

Add the following snippet to your `WORKSPACE` file:

```python
load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip"],
    strip_prefix = "googletest-release-1.17.0",
    sha256 = "94c634d499558a2a3f4942302f4786f50d799a10c40f4f9e4fda9fe9f029f9e1",
)
```

This downloads and makes GoogleTest available for your builds and tests.

<Note>
Ensure the `sha256` matches the version downloaded to maintain integrity.
</Note>

---

## 3. Configure Your `BUILD` Files

GoogleTest requires you to link your test binaries against either `gtest` or `gmock` libraries provided by the external repository.

### Example `BUILD` File Configuration

Create or modify the `BUILD` file for your test target as follows:

```python
cc_test(
    name = "example_test",
    srcs = ["example_test.cc"],
    deps = [
        "@com_google_googletest//:gtest_main",
        "@com_google_googletest//:gmock",
    ],
)
```

**Explanation:**

- `@com_google_googletest//:gtest_main` provides the main function to run tests.
- `@com_google_googletest//:gmock` includes GoogleMock support.

If you only need GoogleTest without mock support, replace the dependency with `@com_google_googletest//:gtest_main` alone.

---

## 4. Writing and Running Your First Test with Bazel

### Writing a Simple Test

Create a test file named `example_test.cc` with the following content:

```cpp
#include "gtest/gtest.h"

TEST(SampleTest, Addition) {
  EXPECT_EQ(2 + 2, 4);
}
```

### Build and Run the Test

Execute the following in your terminal at the root of your Bazel workspace:

```bash
bazel test //:example_test
```

Expected output indicates test success and shows test execution details.

<Tip>
If the test fails to build or link, verify that your `WORKSPACE` and `BUILD` files include the proper dependencies and that the downloaded GoogleTest source version matches your `http_archive` configuration.
</Tip>

---

## 5. Using GoogleMock Support

To leverage mocking capabilities, link with `gmock` and `gmock_main` targets.

### Example Mock-Enabled Test Target

```python
cc_test(
    name = "mock_enabled_test",
    srcs = ["mock_enabled_test.cc"],
    deps = [
        "@com_google_googletest//:gmock_main",
    ],
)
```

Note that `gmock_main` includes the main function and GoogleMock libraries.

---

## 6. Verifying Installation Success

After you run your Bazel tests, check for:

- **Passing test results:** Bazel will report `PASSED` status.
- **No missing dependencies or build errors:** Successful compilation and linking.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Common Bazel Setup Issues">
<Accordion title="Build fails due to missing headers or libraries">
Ensure your `http_archive` in `WORKSPACE` is configured correctly and that dependencies in `BUILD` are specified exactly.
Double-check spelling and labels.
</Accordion>
<Accordion title="Test executable missing main function">
Use `gtest_main` or `gmock_main` targets as dependencies instead of just `gtest` or `gmock`.
</Accordion>
<Accordion title="Bazel cache issues causing stale builds">
Run `bazel clean --expunge` to clear cache and rebuild everything.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps & Additional Resources

- Explore [Writing Your First Test](/getting_started/first_test_and_validation/create_first_test) to deepen your understanding of test creation.
- Review [Integration with Build Systems & Other Tools](/overview/integration-feature-overview/integration-build-systems) for advanced Bazel and build environment setups.
- Consult the [System Requirements](/getting_started/requirements_installation/system_requirements) page to ensure environmental compatibility.

<Tip>
Using Bazel’s `bazel test` command automatically integrates GoogleTest results into Bazel’s test reporting system, including coverage and flaky test detection.
</Tip>

---

## Summary Diagram of Bazel Integration Flow

```mermaid
flowchart TD

  Workspace["WORKSPACE Configuration"] --> FetchGTest["http_archive: Fetch GoogleTest"]
  FetchGTest --> BuildFiles["Setup BUILD files with deps"]
  BuildFiles --> WriteTests["Write C++ Test Sources"]
  WriteTests --> BazelBuild["bazel build or bazel test"]
  BazelBuild --> RunTests["Run Tests with Bazel"]
  RunTests --> Verify["Verify Passing Test Results"]

  subgraph Setup
    Workspace
    FetchGTest
    BuildFiles
  end

  subgraph Test Development
    WriteTests
    BazelBuild
    RunTests
    Verify
  end

  classDef setup fill:#f0f8ff,stroke:#6699cc,stroke-width:2px;
  classDef run fill:#e0ffe0,stroke:#33aa33,stroke-width:2px;

  class Setup setup;
  class Test Development run;
```

---

## Summary
This page guides Bazel users to install and configure GoogleTest and GoogleMock with minimal manual configuration. It covers setting up the `WORKSPACE` file with the external GoogleTest repository, modifying `BUILD` files for test targets, writing and running your first Bazel test, and enabling GoogleMock support. Troubleshooting tips and next step resources help ensure smooth onboarding.

---

## Key Commands Recap

```bash
# Verify Bazel install
bazel version

# Run your test target
bazel test //:example_test

# Clean Bazel cache if needed
bazel clean --expunge
```

---

## Further Reading

- [GoogleTest Overview and Integration with Build Systems](/overview/integration-feature-overview/integration-build-systems)
- [Writing Your First Test](/getting_started/first_test_and_validation/create_first_test)
- [System Requirements](/getting_started/requirements_installation/system_requirements)

---

Feel confident integrating GoogleTest and GoogleMock into your Bazel projects with this foundation, enabling robust automated testing and mocking capabilities in your C++ projects.
