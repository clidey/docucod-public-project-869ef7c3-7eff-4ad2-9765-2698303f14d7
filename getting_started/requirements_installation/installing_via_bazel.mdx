---
title: "Installation with Bazel"
description: "Explains how to set up and build GoogleTest and GoogleMock using Bazel, covering common pitfalls and how to validate your build environment. Includes key workspace configuration steps."
---

# Installation with Bazel

This guide walks you through setting up and building GoogleTest and GoogleMock using Bazel, ensuring you have a working environment for writing and running C++ tests. You'll learn how to configure your workspace properly, avoid common pitfalls, and validate your setup with sample tests.

---

## 1. Prerequisites & System Requirements

- **Operating System**: Compatible with Linux, macOS, Windows, and other supported platforms.
- **C++ Compiler**: Must support at least C++17 standard.
- **Bazel Version**: Bazel 7.0 or later is required for full module support.

Ensure your system matches these requirements to avoid build or compatibility errors.

---

## 2. Setting Up Your Bazel Workspace

### Step 1: Create a Workspace Directory

Open your terminal and create a new folder to hold your Bazel workspace:

```bash
mkdir my_workspace && cd my_workspace
```

This directory will serve as the root of your Bazel workspace.

### Step 2: Add a `MODULE.bazel` File

Create a `MODULE.bazel` file in the root of your workspace to declare GoogleTest as a dependency. This file manages external dependencies with Bazel’s module system.

Use the following as the content:

```python
# MODULE.bazel

bazel_dep(name = "googletest", version = "1.17.0")
```

> Replace `1.17.0` with the latest available version from the [Bazel Central Registry](https://registry.bazel.build/modules/googletest) for the newest features and fixes.

This declaration tells Bazel to fetch GoogleTest and GoogleMock automatically during your build.

---

## 3. Writing Your First Test

### Step 1: Create a Test Source File

Inside the workspace, create a file named `hello_test.cc` with the following example test:

```cpp
#include <gtest/gtest.h>

// Demonstrates basic GoogleTest assertions.
TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");  // Assert strings are not equal
  EXPECT_EQ(7 * 6, 42);               // Assert arithmetic equality
}
```

This test checks simple string and integer assertions—perfect for verifying your environment.

### Step 2: Create a Bazel BUILD File

Next, define a `BUILD` file in the same directory to declare the test target:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

- `cc_test` creates a test binary.
- `deps` links the GoogleTest libraries fetched via your `MODULE.bazel`.

### Step 3: Configure Build Options

For compilers like Clang or GCC, ensure the C++17 standard is used by adding:

```bash
--cxxopt=-std=c++17
```

For MSVC, use:

```bash
--cxxopt=/std:c++17
```

Passing these flags ensures compatibility, as GoogleTest requires C++17 features.

---

## 4. Building and Running the Test

Run the following command to build and execute your test, displaying full output:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

### Expected Output Highlights:

- The test runs via `gmock_main.cc`, which provides the `main()` function.
- A summary line confirming one test suite and one test ran.
- The final status showing `[  PASSED  ] 1 test.`

Example snippet:

```
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[ RUN      ] HelloTest.BasicAssertions
[       OK ] HelloTest.BasicAssertions (0 ms)
[  PASSED  ] 1 test.
```

### Validation

A successful build and test run means your environment is correctly configured and GoogleTest is ready for use.

---

## 5. Common Pitfalls & Troubleshooting

<AccordionGroup title="Troubleshooting Common Issues">
<Accordion title="Build Failures Due to C++ Version">
Ensure your compiler supports C++17. Use `--cxxopt` flags to specify the version explicitly as shown above. Older compilers may require upgrade.
</Accordion>
<Accordion title="Dependency Fetching Errors">
If Bazel cannot fetch GoogleTest, check your internet connectivity and Bazel version. Clean the Bazel cache via `bazel clean --expunge` if corrupted.
</Accordion>
<Accordion title="Linker Errors Related to `pthread` or Threading">
Threading support varies by platform. Verify your build toolchain supports pthreads or the Windows equivalent. Bazel module configuration manages this for most supported platforms.
</Accordion>
<Accordion title="Issue With `MODULE.bazel` Configuration">
Confirm that your `MODULE.bazel` syntax exactly matches the required format. Use the latest registry version and avoid extraneous entries.
</Accordion>
</AccordionGroup>

<Tip>
Always ensure your Bazel version is 7.0 or higher when using the module system (`MODULE.bazel`). Earlier versions handle dependencies with the legacy `WORKSPACE` file.
</Tip>

---

## 6. Next Steps

- **Write More Tests:** Learn how to write tests that reflect your application logic by visiting the [GoogleTest Primer](primer.md).

- **Explore Mocking:** When you need to simulate complex dependencies, see [Creating and Using Mocks](/guides/getting-started-workflows/basic-mocking).

- **Use in CI/CD:** Integrate Bazel and GoogleTest into your continuous integration pipelines for automated testing.

- **Advanced Configuration:** Customize build flags and link options as needed for different platforms by studying the [Platform & Toolchain Support](overview/integration-and-ecosystem/platform-support).

---

## References

- Bazel Module Registry: https://registry.bazel.build/modules/googletest
- Bazel Official Site: https://bazel.build/
- GoogleTest Primer: /docs/primer.md
- Quickstart: Building with CMake (for alternative build system): /getting_started/requirements_installation/installing_via_cmake

---

With this guide, you have a solid foundation to build and run your first GoogleTest-based C++ test using Bazel.

---

_Source files reference: [MODULE.bazel](MODULE.bazel), [WORKSPACE](WORKSPACE), [BUILD.bazel](BUILD.bazel), [docs/quickstart-bazel.md](docs/quickstart-bazel.md)_
