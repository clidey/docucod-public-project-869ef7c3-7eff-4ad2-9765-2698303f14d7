---
title: "Install with CMake"
description: "Provides step-by-step instructions for installing and integrating GoogleTest using CMake. Users learn how to add GoogleTest as a dependency, configure builds, and link their test executables, following best practices for modern C++ projects."
---

# Install with CMake

This guide provides clear, step-by-step instructions to install and integrate **GoogleTest** using CMake. Whether incorporating GoogleTest as a standalone project or embedding it within your existing CMake-based C++ project, you'll learn the recommended approaches and best practices to set up your test environment quickly and reliably.

---

## 1. Prerequisites & System Requirements

Before installing GoogleTest with CMake, ensure your environment meets these conditions:

- **Operating System:** Linux, macOS, or Windows.
- **Compiler:** Supports C++17 standard or later (e.g., GCC 7+, Clang 5+, MSVC 2017+).
- **CMake Version:** 3.14 or later (required for `FetchContent` module).
- **Build Tools:** Compatible with CMake generators such as Make, Ninja, Visual Studio, or Xcode.

For full details on platform compatibility and compiler requirements, see the [System Requirements](https://github.com/google/googletest/blob/main/docs/requirements_installation/system_requirements.md).

<Tip>
Using a modern compiler with full C++17 support is essential for GoogleTest to build and run correctly.
</Tip>

---

## 2. Installing GoogleTest as a Standalone CMake Project

This approach builds GoogleTest independently from your main project. It's a good option to get started or to install GoogleTest system-wide.

### Step 1: Clone the GoogleTest Repository

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
```

*This downloads the specific stable version 1.17.0. Update the branch/tag for newer versions.*

### Step 2: Create a Build Directory and Generate Build Files

```bash
mkdir build
cd build
cmake ..
```

- By default, this builds both GoogleTest and GoogleMock.
- To build only GoogleTest (without GoogleMock), run:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 3: Build the Libraries

```bash
make
```

*On Windows, open the generated Visual Studio solution (`gtest.sln`) to build.*

### Step 4: (Optional) Install GoogleTest

If you have administrative permissions, you can install GoogleTest to the default system location `/usr/local`:

```bash
sudo make install
```

*This step makes GoogleTest headers and libraries globally available to other projects.*

<Warning>
Running `sudo make install` modifies system files. Ensure you want to globally install GoogleTest before proceeding.
</Warning>

---

## 3. Incorporating GoogleTest into an Existing CMake Project

The preferred integration method for existing projects is to include GoogleTest as part of your project’s build using CMake’s `FetchContent` module. This ensures consistent compiler and linker settings and avoids issues caused by incompatible builds.

### Step 1: Set Minimum CMake Version and Project Configuration

In your project root directory, create or edit the `CMakeLists.txt` and start with:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard for GoogleTest
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### Step 2: Add GoogleTest as a FetchContent Dependency

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  # Always update this URL/commit to track GoogleTest versions
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# On Windows, force shared CRT linkage to match parent project
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

### Step 3: Add Your Test Files and Link with GoogleTest

Create your test executable and link it with the GoogleTest libraries:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)

# Link the executable against gtest_main (includes main())
target_link_libraries(
  hello_test
  GTest::gtest_main
)

# Enable automatic test discovery
include(GoogleTest)
gtest_discover_tests(hello_test)
```

### Step 4: Create a Sample Test File

Create a `hello_test.cc` file in your project directory:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 5: Build and Run Your Tests

From your project root:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

Expected output:

```
Test project .../my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

Congratulations! Your test executable is built and your first test ran successfully.

<Tip>
If you need to link multiple test binaries, repeat the `add_executable` and `target_link_libraries` steps for each.
</Tip>

---

## 4. Additional Configuration Tips & Best Practices

### Windows Runtime Library Compatibility

If you see linker errors like `mismatch detected for 'RuntimeLibrary'` when building with Visual Studio, enable dynamic runtime linkage for GoogleTest to match your project:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### Specifying the C++ Standard Explicitly

If your project is mostly C code but uses GoogleTest, ensure the C++17 standard is set explicitly either in `CMakeLists.txt` or via compiler flags:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

or

```
cmake -DCMAKE_CXX_FLAGS='-std=c++17' ...
```

### Building GoogleTest as a Shared Library

By default, GoogleTest builds as a static library. To build it as a shared library (DLL on Windows), define:

```cmake
-DGTEST_CREATE_SHARED_LIBRARY=1
```

and link your tests with

```cmake
-DGTEST_LINKED_AS_SHARED_LIBRARY=1
```

---

## 5. Troubleshooting Common Issues

<AccordionGroup title="Common Build and Integration Issues">
<Accordion title="CMake Cannot Find GoogleTest After Installation">
If `find_package(GTest REQUIRED)` fails, ensure the pkg-config files are discoverable. For a non-standard install path, set `PKG_CONFIG_PATH` appropriately:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Set to the directory containing `gtest.pc` and `gtest_main.pc` files.
</Accordion>
<Accordion title="Linker Errors Related to Threading">
If you get linker issues concerning pthreads, make sure your compiler and linker flags add pthread support. CMake's GoogleTest integration typically handles this. When building manually, add `-pthread` flags to both compile and link commands.
</Accordion>
<Accordion title="Visual Studio Runtime Mismatch">
Encountering `RuntimeLibrary` mismatch errors when linking? Verify that `gtest_force_shared_crt` is set ON in your CMake configuration on Windows to align runtime usage between your project and GoogleTest.
</Accordion>
<Accordion title="C++ Standard Errors">
Getting errors about C++17 features not found? Confirm that your CMake project sets `CMAKE_CXX_STANDARD 17` and that your compiler supports C++17.
</Accordion>
</AccordionGroup>

---

## 6. Next Steps

- Explore the [GoogleTest Primer](primer.md) to start writing effective tests.
- Learn how to [write your first test](../first_test_and_validation/create_first_test.md) using GoogleTest.
- For alternative build systems, see [Install with Bazel](../requirements_installation/installation_bazel.md).
- Review [Integration with Build Systems & Other Tools](../../overview/integration-feature-overview/integration-build-systems.md) for advanced project setups.
- If you encounter issues, consult the [Troubleshooting Setup Issues](../first_test_and_validation/troubleshooting_setup.md) guide.

---