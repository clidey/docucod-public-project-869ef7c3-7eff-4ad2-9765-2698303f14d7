---
title: "Configuring Your Project"
description: "Walks through linking and including GoogleTest/GoogleMock in a C++ project. Clarifies include directory setup, linking options, and main entry point definitions for both frameworks."
---

# Configuring Your Project

When integrating GoogleTest and GoogleMock into your C++ project, proper configuration of include directories, linking options, and main entry point setup is essential for a smooth development experience. This guide will walk you through these steps, clarifying how to correctly include GoogleTest/GoogleMock headers, link against their libraries, and manage the main test executable entry point.

---

## 1. Setting Up Include Directories

To write tests using GoogleTest and GoogleMock, your project must have access to their header files.

- **Include Paths**: Ensure your compiler's include path includes the directories where the `gtest` and `gmock` headers reside. This typically means adding paths akin to:

  ```plaintext
  /path/to/googletest/include
  /path/to/googlemock/include
  ```

- When using the GoogleTest source tree as a submodule or downloaded code, the root `googletest/include` and `googlemock/include` directories contain all the necessary headers.

- **Example Include Directive** inside your test files:

  ```cpp
  #include <gtest/gtest.h>
  #include <gmock/gmock.h>
  ```

  GoogleTest's main API is in `gtest/gtest.h`, and GoogleMock’s features are in `gmock/gmock.h`.

### Best Practice

- Use your build system's include directory specification (e.g., `target_include_directories` in CMake) rather than relative includes to avoid fragile build setups.


## 2. Linking GoogleTest and GoogleMock Libraries

During linking, your test executable must link against the appropriate GoogleTest and GoogleMock libraries.

### Link Libraries

Depending on your project's needs, link against one or both of the following:

- `gtest` — The core testing framework
- `gmock` — The mocking framework (includes `gtest` functionality)
- `gtest_main` or `gmock_main` — Provides a default `main()` function (usually linked when you want to avoid writing your own main function)

### Common Link Targets

| Use Case                           | Link Against              |
|----------------------------------|--------------------------|
| Only GoogleTest (no mocks)        | `gtest` and optionally `gtest_main`     |
| Using GoogleMock with GoogleTest  | `gmock`, `gmock_main` (includes `gtest`) |

### Example in CMake

If you build GoogleTest and GoogleMock as separate targets:

```cmake
add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests PRIVATE gtest_main gmock)
```

Or, if you embed them as subdirectories:

```cmake
add_subdirectory(googletest)

target_link_libraries(my_tests PRIVATE gtest_main gmock_main)
```

### Static vs Shared Libraries

- GoogleTest can be built as static or shared libraries.
- Ensure your linking flags and runtime settings match to avoid linker errors, especially on Windows.

### Troubleshooting Linking

- Undefined references to GoogleTest symbols usually mean missing GoogleTest libraries in your link command.
- On MSVC, ensure the runtime libraries match (`static` vs. `dynamic`). See [Visual Studio Dynamic vs Static Runtimes](https://github.com/google/googletest/blob/main/googletest/README.md) for details.


## 3. Defining Your Test Program's `main()` Entry Point

GoogleTest requires a `main()` function to initialize and run tests.

### Option 1: Use Provided `gtest_main` or `gmock_main`

- Link `gtest_main` (or `gmock_main` if using GoogleMock). These provide a default `main()` that does the following:
  - Calls `::testing::InitGoogleTest()`
  - Calls `RUN_ALL_TESTS()` and returns the result.

- This is the simplest and recommended method.

### Option 2: Write Your Own `main()`

If you need custom initialization (e.g., for command line parsing, logging setup), write your own `main()`:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  // Custom setup can go here
  return RUN_ALL_TESTS();
}
```

- Important:
  - Call `InitGoogleTest()` before `RUN_ALL_TESTS()`.
  - `RUN_ALL_TESTS()` runs all registered tests and returns 0 on success.

### Note on `InitGoogleTest`

- It parses and removes GoogleTest-specific command-line flags.
- You can call it with either `char**` or `wchar_t**` arguments, supporting Windows Unicode builds.

### Using Global Test Environments

- You can create global environments that perform setup and teardown around the entire test run, by subclassing `::testing::Environment` and adding them via `AddGlobalTestEnvironment()`.


## 4. Putting It All Together: Example CMake Configuration

Assuming you have GoogleTest and GoogleMock checked out as a subdirectory:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

# Add GoogleTest and GoogleMock
add_subdirectory(googletest)

# Define your test executable
add_executable(my_tests tests.cpp)

# Include directories
target_include_directories(my_tests PRIVATE
  ${gtest_SOURCE_DIR}/include
  ${gmock_SOURCE_DIR}/include
)

# Link with gmock and gmock_main (includes gtest)
target_link_libraries(my_tests PRIVATE gmock_main)

# Enable C++17
set_target_properties(my_tests PROPERTIES CXX_STANDARD 17 CXX_STANDARD_REQUIRED ON)
```

In `tests.cpp`, you can write:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

TEST(SampleTest, Example) {
  EXPECT_EQ(1, 1);
}
```

Build and run your tests:

```bash
mkdir build && cd build
cmake ..
cmake --build .
./my_tests
```

You should see your tests run and their results printed.


## 5. Tips and Best Practices

- **Use `gmock_main` if you leverage mocks:** It implements the necessary `main()` for you.

- **Explicitly add include directories:** This avoids hard-to-debug header not found errors.

- **Match compiler and linker flags:** Avoid issues on platforms like Windows by ensuring runtimes are consistent.

- **Leverage `AddGlobalTestEnvironment` for setups:** If you have one-time global setup/cleanup logic, implement it with `Environment` subclasses.

- **Run tests via `RUN_ALL_TESTS()`:** Don't ignore the return code to correctly detect test failures.

- **Keep your `main()` clean:** Unless customization is needed, use the supplied `gtest_main`/`gmock_main` for simplicity.


## 6. Troubleshooting Common Configuration Issues

| Issue                             | Symptom/Solution                                                                |
|----------------------------------|---------------------------------------------------------------------------------|
| Compilation error: header not found | Verify that your include directories correctly specify the path to GoogleTest headers |
| Linker error: undefined references | Make sure to link against `gtest` or `gmock` libraries and their `main` counterparts |
| Multiple main functions           | Link against either `gtest_main` or your own `main()`, do not have both         |
| Runtime crashes on Windows        | Check that your runtime linkage settings are consistent (dynamic vs static CRT) |
| Tests not discovered/run           | Ensure tests are registered via `TEST()` or `TEST_F()`, and filtering flags do not exclude them |


## 7. Additional Resources

- [Primer on Writing Tests](primer.md) – Get started with writing tests.
- [Installation with CMake](getting_started/requirements_installation/installing_via_cmake) – How to build GoogleTest.
- [Integration with Build Systems](overview/integration-and-ecosystem/integration-points) – Guidance on build system support.
- [Global Set-Up and Tear-Down](advanced.md#global-set-up-and-tear-down) – For managing global environments.

---

Maintaining this configuration properly unlocks the full power of GoogleTest and GoogleMock by making your test builds reliable and easy to run.


---

### Callouts

<Tip>
Link against `gmock_main` when using GoogleMock; it automatically includes GoogleTest.
</Tip>

<Warning>
Do not define your own `main()` if linking with `gtest_main` or `gmock_main` to avoid linker conflicts.
</Warning>

<Note>
Remember to call `::testing::InitGoogleTest(&argc, argv);` at the start of your `main()` to enable GoogleTest flag parsing.
</Note>