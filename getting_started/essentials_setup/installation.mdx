---
title: "Installation & Build Integration"
description: "Follow step-by-step instructions to install GoogleTest and GoogleMock on your system. Learn about supported methods, including CMake and Bazel, and how to add the frameworks to your project's build process. Platform-specific guidance ensures a smooth setup whether you're on Linux, macOS, or Windows."
---

# Installation & Build Integration

Follow these step-by-step instructions to install GoogleTest and GoogleMock on your system and integrate them into your C++ projectâ€™s build process. This guide covers supported installation methods including CMake and Bazel, and provides platform-specific guidelines for Linux, macOS, and Windows to ensure a smooth setup experience.

---

## 1. Prerequisites & System Requirements

Before you begin the installation and build integration process, ensure the following prerequisites are met:

- **Supported Operating Systems:** Linux, macOS, Windows
- **C++ Standard Requirement:** Compiler supporting at least C++17
- **Build Tools:** CMake 3.14 or later (required for the FetchContent method)
- **Compiler Compatibility:** GCC, Clang, MSVC (Visual Studio), or compatible C++ compilers
- **Network Access:** Required for cloning from GitHub or downloading dependencies during CMake configuration

<Check>
Verify your environment meets these requirements before proceeding to avoid build errors.
</Check>

---

## 2. Installation Methods

### 2.1 Standalone Build with CMake

This is the most common method to get GoogleTest and GoogleMock installed on your system as standalone libraries.

1. **Clone the repository:**

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
```

2. **Create a build directory and navigate into it:**

```bash
mkdir build
cd build
```

3. **Generate build files with CMake:**

- To build both GoogleTest and GoogleMock (default):

```bash
cmake ..
```

- To build only GoogleTest (excluding GoogleMock):

```bash
cmake .. -DBUILD_GMOCK=OFF
```

4. **Build the libraries:**

- On Unix-like systems:

```bash
make
```

- On Windows with Visual Studio: open the generated `gtest.sln` solution and build

5. **Optional: Install to system prefix (requires admin privileges):**

```bash
sudo make install
```

This copies headers to `/usr/local/include` and libraries to `/usr/local/lib` by default.

### 2.2 Integration as Subdirectory in Existing CMake Project

For tighter integration ensuring compiler and linker flags match your project, incorporate GoogleTest into your existing CMake build:

1. Place GoogleTest source code at a known path within your project.

2. Add the following to your `CMakeLists.txt`:

```cmake
add_subdirectory(path/to/googletest)
```

3. Link your test targets against the installed libraries:

```cmake
target_link_libraries(your_test_target gtest gmock)
```

Alternatively, use CMake's `FetchContent` to download during configuration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Visual Studio runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example gtest_main)
add_test(NAME example_test COMMAND example)
```

### 2.3 Using Bazel Build System

GoogleTest and GoogleMock also support Bazel builds.

- Add the `googletest` external repository via your `WORKSPACE` file.
- Use Bazel targets like `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` to depend on the libraries.

Refer to the Bazel Integration Guide for detailed instructions.

---

## 3. Adding GoogleTest & GoogleMock to Your Build Process

### 3.1 Linking Against Libraries

- When building your tests, link against:
  - `gtest` if you only need GoogleTest
  - `gmock` if you need GoogleMock without `main()`
  - `gmock_main` if you want GoogleMock with a bundled `main()` function that automatically runs all tests

Example link flags in CMake:

```cmake
target_link_libraries(your_test_target PRIVATE gmock_main)
```

### 3.2 Using the `main()` Function Provided by GoogleMock/GoogleTest

Both GoogleTest and GoogleMock provide library targets that include their own `main()` implementation:

- `gtest_main` or `gmock_main` contain a predefined `main()` that calls `InitGoogleTest()`/`InitGoogleMock()` and `RUN_ALL_TESTS()`.
- Linking with these eliminates the need to write your own `main()` function.

If you require custom behavior before running tests, provide your own `main()` as described in the GoogleTest Primer [Writing the main() Function](https://github.com/google/googletest/blob/main/docs/primer.md#writing-the-main-function).

### 3.3 Platform-Specific Notes

- **Linux/macOS:** The standard build steps apply. Use `make` or your preferred CMake generator.
- **Windows:** Use Visual Studio solutions generated by CMake, ensure the C runtime linkage matches (see below).
- **Embedded platforms (ESP8266/ESP32/nRF52):** Entry points differ and use `setup()` and `loop()` functions instead of `main()`. GoogleMock and GoogleTest provide special support adapting to these platforms.

### 3.4 Visual Studio Runtime Library Matching

Visual Studio defaults to dynamic CRT linkage (`/MD`) but GoogleTest links statically by default (`/MT`), causing linker errors.

Fix this by enabling the `gtest_force_shared_crt` option during configuration:

```cmake
cmake .. -Dgtest_force_shared_crt=ON
```

This ensures consistent runtime linkage between your tests and GoogleTest/GoogleMock libraries.

---

## 4. Verifying Your Installation

1. After building, verify the presence of libraries (`libgtest.a`, `libgmock.a`, `libgmock_main.a` on Linux/macOS or corresponding `.lib` on Windows).
2. Compile a simple test program linking to `gmock_main` or `gtest_main`.
3. Run the test binary and confirm it reports test results (pass/fail). Example output:

```plaintext
Running main() from gmock_main.cc
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from FooTest
[ RUN      ] FooTest.DoesBar
[       OK ] FooTest.DoesBar (0 ms)
[----------] 1 test from FooTest (0 ms total)
[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

---

## 5. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Common Installation and Build Issues">
<Accordion title="Linker errors related to CRT mismatch on Windows">
Ensure you enabled `gtest_force_shared_crt=ON` during CMake configuration.

Run:

```bash
cmake .. -Dgtest_force_shared_crt=ON
```

Then rebuild.
</Accordion>
<Accordion title="Tests not running or discovered">
- Verify your test binaries link with `gtest_main` or `gmock_main` (or provide your own `main()`.)
- Check that `RUN_ALL_TESTS()` is called exactly once in `main()`.
- Ensure you are not accidentally disabling test discovery by incorrect test macros.
</Accordion>
<Accordion title="Missing pthread symbols on Linux/macOS">
If your environment does not detect pthread support:

- For non-CMake builds, add `-pthread` to compiler and linker flags.
- For CMake, confirm `find_package(Threads REQUIRED)` completes and links correctly.
</Accordion>
</AccordionGroup>

---

## 6. Next Steps

- Proceed to the [Configuration Basics](../configuration_basics) guide to set up custom test options.
- Explore [Your First Test Case](../first_steps_usage/your_first_test) to write and run your initial tests.
- Visit the [Integrating with Build Systems](../../guides/practical-integrations/build-system-integration) guide for advanced build setups.

---

## References

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleMock Integration (CMakeLists.txt)](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [Official GoogleTest GitHub Repository](https://github.com/google/googletest)

---

## Appendix: Sample Minimal CMakeLists.txt to Link GoogleMock

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject CXX)

set(CMAKE_CXX_STANDARD 17)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Windows dynamic CRT linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_test main.cpp)

# Link with gmock_main to get GoogleMock and a main() entry point
target_link_libraries(my_test PRIVATE gmock_main)

enable_testing()
add_test(NAME my_test COMMAND my_test)
```

Replace `main.cpp` with your test source code file.

---

## Appendix: Typical main() Function if not Linking with gmock_main

```c++
#include <gmock/gmock.h>

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This ensures GoogleMock initializes both GoogleMock and GoogleTest frameworks and runs all tests.
