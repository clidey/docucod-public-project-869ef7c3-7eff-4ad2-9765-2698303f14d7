---
title: "Configuration Basics"
description: "Review the essential project and environment configuration options for a successful initial setup. Understand default behaviors and customizable settings that shape how GoogleTest and GoogleMock work in your environment."
---

# Configuration Basics

Use this page to master the essential project and environment configuration options needed for a successful GoogleTest and GoogleMock setup. Understanding the default behaviors and customizable settings here will empower you to tailor the mocking framework to your development environment and testing goals.

---

## 1. Understanding Default Behaviors

GoogleMock operates with sensible defaults that balance ease of use and strictness. Knowing these will save you troubleshooting time.

- **Mock Object Behavior**: By default, mock objects are **naggy**, meaning any uninteresting calls (calls without expectations) will produce warnings without failing tests.

- **Expectations Life Cycle**: Expectations created by `EXPECT_CALL` persist until explicitly retired (e.g., by `.RetiresOnSaturation()`) or when their call count bounds are violated.

- **Default Actions**: For methods returning common types (`void`, `bool`, numeric types, pointers), GoogleMock provides built-in default return values unless you specify otherwise.

- **Reverse Matching Order**: GoogleMock matches expectations in the reverse order they are declared. More recent expectations override older ones.

<Tip>
Memorize these behaviors to minimize surprises: naggy mocks warn but don’t fail, sticky expectations stay active until saturated or retired, and default return values avoid test crashes for unconfigured return types.
</Tip>

---

## 2. Customizing Mock Object Verbosity

You can control how chatty GoogleMock is about uninteresting mock method calls on your mock objects.

### Available Mock Object Modes:
- **NaggyMock (Default)**: Prints warnings on uninteresting calls.
- **NiceMock**: Suppresses uninteresting call warnings. Use this mode when you want cleaner output and are sure uninteresting calls are acceptable.
- **StrictMock**: Treats uninteresting calls as test failures. Use for maximum strictness to catch unexpected calls.

### How to Select the Mode:
```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

// Example instantiation:
NiceMock<MockFoo> nice_foo;      // Ignores uninteresting calls
NaggyMock<MockFoo> naggy_foo;    // Warns on uninteresting calls
StrictMock<MockFoo> strict_foo;  // Fails on uninteresting calls
```

<Note>
Remember that these wrappers work only if the mock destructor is virtual and mock methods are declared with the `MOCK_METHOD` macro in the derived mock class.
</Note>

---

## 3. Controlling Default Mock Behavior with Flags

### Key Command-Line Flags:
| Flag                             | Description                                                |
|---------------------------------|------------------------------------------------------------|
| `--gmock_catch_leaked_mocks=0/1`| Controls reporting of leaked mock objects at program exit. Set to `1` to report leaks as failures. |
| `--gmock_verbose=LEVEL`          | Sets verbosity level for mock call reporting. `LEVEL` can be `info`, `warning` (default), or `error`.

### Effect of `--gmock_verbose` Levels:
- `info`: Logs all mock call activity including stack traces for uninteresting calls.
- `warning`: Logs warnings and errors; no stack traces for uninteresting calls.
- `error`: Only logs errors, suppressing warnings and info messages.

<Check>
Adjust `--gmock_verbose` to get detailed insight during debugging (`info`) or quieter output during regular runs (`warning` or `error`).
</Check>

---

## 4. Setting Default Actions and Expectations

GoogleMock separates **default actions** (`ON_CALL`) from **expectations** (`EXPECT_CALL`):

- `ON_CALL(mock_obj, Method(...))` defines what happens by default when `Method` is called with given arguments; does *not* set expectations about calls.
- `EXPECT_CALL(mock_obj, Method(...))` sets both the expected calls and their behavior.

### Usage Highlights:
- Default actions run if no expectation matches.
- Multiple `ON_CALL`s on the same method: the last matching `ON_CALL` is used.
- Multiple `EXPECT_CALL`s: the last matching expectation is applied.

Example:
```cpp
ON_CALL(foo, GetSize())
    .WillByDefault(Return(1));

EXPECT_CALL(foo, Describe(5))
    .Times(3)
    .WillRepeatedly(Return("Category 5"));

EXPECT_EQ(MyProductionFunction(&foo), "good");
```

---

## 5. Managing Expectation Stickiness and Ordering

By default, **expectations are sticky**: they remain active even after their call upper bound has been reached, causing later excessive calls to fail.

- To make expectations retire automatically after saturation, use `.RetiresOnSaturation()`.
- Use `InSequence` to enforce call ordering:
```cpp
{
  InSequence s;
  EXPECT_CALL(foo, DoA());
  EXPECT_CALL(foo, DoB());
}
```

- Combining partial ordering is possible by using multiple sequences or `.After()` clauses on expectations.

<Warning>
Overly strict ordering or sticky expectations without retiring can make tests brittle. Use retire or sequences thoughtfully.
</Warning>

---

## 6. Managing Mock Object Lifetime

### Deleting mocks and verifying expectations:
- Expectations are verified when the mock object is destructed.
- If a mock is heap-allocated and ownership is not clear, you can force early verification using:
```cpp
ASSERT_TRUE(::testing::Mock::VerifyAndClearExpectations(mock_ptr));
```
- To indicate that a mock can be leaked without failure (not recommended), call:
```cpp
::testing::Mock::AllowLeak(mock_ptr);
```

<Note>
Avoid setting new expectations after verification as it leads to undefined behavior.
</Note>

---

## 7. Summary of Customizing Behavior

| Feature                           | How to Customize / Control                   |
|---------------------------------|----------------------------------------------|
| Mock verbosity mode              | Use `NiceMock<T>`, `NaggyMock<T>`, `StrictMock<T>` wrappers
| Default action for method        | Use `ON_CALL(...).WillByDefault(...)`
| Expectations                    | Use `EXPECT_CALL(...).Times(...)` + `.WillOnce()/ .WillRepeatedly()`
| Ordering expectations            | Use `InSequence` or `.After(...)` clauses
| Retiring saturated expectations | `.RetiresOnSaturation()`
| Verifying expectations early     | `Mock::VerifyAndClearExpectations()`
| Leaking mocks without error      | `Mock::AllowLeak()`

---

## Troubleshooting Tips

- Uninteresting call warnings suggest a call to a mock method without an expectation. Use `NiceMock` if such calls are expected, or add an `EXPECT_CALL` with `.Times(AnyNumber())` to suppress warnings for particular methods.

- Unexpected call failures indicate a mismatch in expected calls. Run tests with `--gmock_verbose=info` to see detailed tracing of calls and expectations.

- Failing to delete mocks can lead to leaked mock errors; ensure the mock object is deleted or purposely allowed to leak.

- Compilation warnings regarding const parameters in mocks usually mean the base method is declared with a top-level const parameter, which is ignored by C++ and can be removed.

- If expectation ordering seems off, ensure expectations are declared before exercising the mock methods and verify sequence or `.After` constraints are used correctly.

---

## Links and Further Reading

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick reference for macros and usage.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — Practical recipes and advanced use cases.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) — Complete API details.
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) — Beginner-friendly guide.
- [FAQ on Mocking](https://google.github.io/googletest/gmock_faq.html) — Troubleshooting and detailed explanations.

---

Master these configuration basics to ensure your GoogleMock usage is efficient, robust, and tailored to your project needs.