---
title: "Installing with CMake"
description: "Comprehensive instructions for adding GoogleTest to your project using CMake. This page covers fetching the repository, linking it to your build, and integrating GoogleTest targets. Users learn best practices for CMake-based projects, including tips for dependency management."
---

### Installing with CMake

This guide provides comprehensive, actionable instructions to add GoogleTest and GoogleMock to your CMake-based project. You will learn how to fetch the repositories, link libraries correctly, and integrate GoogleTest and GoogleMock targets to build reliable and maintainable unit tests with best practices for dependency and build management.

---

#### 1. Prerequisites & Requirements

- **CMake Version**: Minimum required CMake version is 3.13; some features (like `FetchContent_MakeAvailable`) require 3.14 or higher.
- **C++ Standard**: Your project must support at least C++17 (`set(CMAKE_CXX_STANDARD 17)` is recommended).
- **Threading Support**: GoogleTest detects and uses pthreads if available. CMake’s `find_package(Threads)` is used internally to manage threading libraries.
- **Optional Dependencies**: For advanced usages, optionally enable Abseil and RE2 with extra setup.

---

#### 2. Fetching GoogleTest and GoogleMock

You can integrate GoogleTest and GoogleMock as standalone projects or embed them inside your project.

##### Option A: Use `FetchContent` to Download at Configure Time

Add this snippet to your `CMakeLists.txt` before you set up your test targets:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.16.0.zip
)
# For Windows to ensure shared CRT compatibility
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

This downloads and makes GoogleTest and GoogleMock targets available for your project.

##### Option B: Add as a Subdirectory

If you have GoogleTest sources checked out locally (or as a submodule), add:

```cmake
add_subdirectory(googletest)
```

The `Add_subdirectory` method uses the GoogleTest and GoogleMock CMake scripts, ensuring consistency in compiler flags and build settings.

---

#### 3. Linking GoogleTest and GoogleMock Targets

GoogleTest exposes convenient CMake targets you can directly link against:

- `gtest` — GoogleTest core (no main function)
- `gtest_main` — GoogleTest with main() function included
- `gmock` — GoogleMock core
- `gmock_main` — GoogleMock with main() function

Use these targets to link your test executables accordingly.

##### Example: Linking a Basic GoogleTest Executable

```cmake
add_executable(my_test test/my_test.cpp)
target_link_libraries(my_test PRIVATE gtest_main)
enable_testing()
add_test(NAME my_test COMMAND my_test)
```

##### Example: Linking with GoogleMock

```cmake
add_executable(my_mock_test test/my_mock_test.cpp)
target_link_libraries(my_mock_test PRIVATE gmock_main)
enable_testing()
add_test(NAME my_mock_test COMMAND my_mock_test)
```

---

#### 4. Integration Best Practices

- **Use Target-based Linking:** Always link your test executables with the provided targets (`gtest_main`, `gmock_main`, etc.) rather than manually specifying include directories or libraries. This ensures you also get the necessary compile flags, such as `-DGTEST_HAS_PTHREAD=1` if threading is enabled.
- **Avoid Mixing Runtime Models on Windows:** If you are building on Windows with Visual Studio, synchronize your runtime linkage with GoogleTest using `gtest_force_shared_crt=ON` to avoid linker conflicts.
- **Use `target_compile_options` with pkg-config Flags:** If integrating via pkg-config, prefer the compiler flags from `${GTEST_CFLAGS}` using `target_compile_options()` to get macros and pthread flags correctly.

---

#### 5. Using pkg-config with CMake (Optional)

GoogleTest installs `.pc` files (pkg-config files) that specify compiler and linker flags which can be queried in CMake:

```cmake
find_package(PkgConfig REQUIRED)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(testapp samples/sample3_unittest.cc)
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(NAME first_and_only_test COMMAND testapp)
```

---

#### 6. Building and Installing GoogleTest and GoogleMock

If building GoogleTest and GoogleMock as standalone projects:

1. Clone the repository:

   ```bash
git clone https://github.com/google/googletest.git -b v1.16.0
cd googletest
mkdir build
cd build
```

2. Run CMake (build with GoogleMock by default):

    ```bash
cmake ..
make -j
```

3. Optionally, install to system directories:

    ```bash
sudo make install
```

On Windows, you can open the generated Visual Studio solution and build there.

---

#### 7. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Common Installation Issues">
<Accordion title="CMake cannot find GoogleTest when using pkg-config">
If pkg-config cannot locate `gtest_main.pc`, ensure the `.pc` files are installed and that your `PKG_CONFIG_PATH` includes their directory:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Verify with:

```bash
pkg-config --cflags gtest
```

If the output is missing or incorrect, check your installation prefix and environment variables.
</Accordion>

<Accordion title="Runtime library mismatch error on Windows with MSVC">
If you encounter linker errors related to runtime libraries (e.g., `MTd_StaticDebug` vs `MDd_DynamicDebug`), enable dynamic CRT linking by adding to your CMake invocation or cache:

```cmake
-Dgtest_force_shared_crt=ON
```

This aligns GoogleTest’s runtime linkage with your project, resolving conflicts.
</Accordion>

<Accordion title="Threading-related link errors">
GoogleTest uses pthreads on Unix-like systems. If you face undefined symbols for pthreads:

- Confirm your system supports pthreads.
- Verify CMake is finding threads via `find_package(Threads)`.
- Manually add `Threads::Threads` target if necessary:

```cmake
target_link_libraries(your_target PRIVATE Threads::Threads)
```

</Accordion>
</AccordionGroup>

---

#### 8. Summary

By following these instructions, you integrate GoogleTest and GoogleMock into your CMake projects cleanly and robustly. You leverage the pre-defined CMake targets with correct compile and link flags and adjust settings to avoid platform-specific problems.

This approach streamlines the building and running of tests, paving the way for confident, automated testing coverage.

---

#### Additional Resources

- [GoogleTest CMakeLists.txt source](https://github.com/google/googletest/blob/main/googletest/CMakeLists.txt)
- [GoogleMock CMakeLists.txt source](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt)
- [GoogleTest pkg-config usage](https://github.com/google/googletest/blob/main/docs/pkgconfig.md)
- [Getting Started with GoogleTest](../../getting_started/first_test_run_validation/write_first_test)
- [Common Installation & Setup Problems](../../getting_started/troubleshooting/common_problems)

---

#### Example Minimal CMakeLists.txt Snippet to Use GoogleTest via FetchContent

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.16.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test/my_tests.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

This snippet is ready to be copied and adapted instantly for your project.
