---
title: "Getting Started with GoogleMock"
description: "Introduces the basics of mocking in C++ via GoogleMock. Walks through creating a simple mock class, setting expectations, and verifying mock interactions in a test."
---

# Getting Started with GoogleMock

Welcome to your first step in mastering mocking in C++ using GoogleMock (gMock). This guide introduces you to the foundational concepts and practical steps to create a simple mock class, set expectations on mocked methods, and verify mock interactions within your tests. By following this guide, you'll gain hands-on experience to confidently integrate GoogleMock into your C++ testing workflow.

---

## 1. Prerequisites & Setup

Before diving into mocking, ensure your environment meets these requirements:

- **C++ Compiler:** A C++17-compliant compiler (GCC 7+, Clang 5+, MSVC 2017+).
- **GoogleTest & GoogleMock:** Installed and correctly built. GoogleMock is bundled with GoogleTest — make sure you have access to `gmock/gmock.h`.
- **Familiarity with C++:** Basic knowledge of virtual functions and classes.

If you haven't installed GoogleTest and GoogleMock, refer to [Installing GoogleTest and GoogleMock](/getting_started/setup_requirements_install/installing_framework) for detailed instructions.


---

## 2. Defining Your First Mock Class

Mock classes simulate the behavior of real interfaces or classes. They allow you to specify how methods are expected to be called and what they return.

### Step 1: Define Your Interface (if you don't have one)

For mocking, the class must have virtual methods, preferably with virtual destructors to avoid pitfalls. For example, suppose you have an interface representing a simple `Turtle` graphics API:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}

  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};
```

### Step 2: Create a Mock Class

Use the `MOCK_METHOD` macro in your mock class to define mocked methods. It must be placed inside the `public` section regardless of the original access level.

```cpp
#include <gmock/gmock.h>  // Import gMock definitions

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

> **Tip:** If your method is `const`, add `(const, override)` as the 4th parameter; for non-const methods, just use `(override)`.

---

## 3. Setting Expectations

Expectations define how your mock methods should behave and verify that they are called as intended.

### Basic Expectation

Before your test exercises the code using the mock, set expectations via the `EXPECT_CALL` macro:

```cpp
using ::testing::AtLeast;  // Import a cardinality matcher

TEST(TurtleTest, MovesForward) {
  MockTurtle turtle;

  // Expect Forward(100) to be called at least once
  EXPECT_CALL(turtle, Forward(100))
      .Times(AtLeast(1));

  // Exercise code that uses turtle
  turtle.Forward(100);
}
```

This expectation ensures that the `Forward` method with argument 100 is called at least once.

### Matchers for Arguments

If you don't care about the exact argument value, use matchers like `_` (wildcard):

```cpp
EXPECT_CALL(turtle, Forward(_)).Times(AtLeast(1));
```

You can also use more specific matchers, e.g., `Gt(50)` for "greater than 50":

```cpp
using ::testing::Gt;
EXPECT_CALL(turtle, Forward(Gt(50))).Times(1);
```

### Multiple Expectations

GoogleMock searches your expectations from last to first and picks the first that matches the call.

```cpp
EXPECT_CALL(turtle, Forward(_)).Times(AnyNumber());
EXPECT_CALL(turtle, Forward(100)).Times(2);
```

Here, calls to `Forward(100)` match the second expectation, while other calls match the first.

### Ordering Calls

To enforce call order, use `InSequence`:

```cpp
{
  using ::testing::InSequence;
  InSequence s;

  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

This verifies `PenDown()` is called before `Forward(100)`, and `PenUp()` is after.

---

## 4. Providing Behavior for Mock Methods

By default, methods with return types return default values (e.g., 0, false).

- Use `WillOnce()` and `WillRepeatedly()` to specify behaviors.

### Example: Returning Values

```cpp
using ::testing::Return;

EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(10))
    .WillRepeatedly(Return(20));

EXPECT_EQ(turtle.GetX(), 10); // First call
EXPECT_EQ(turtle.GetX(), 20); // Subsequent calls
EXPECT_EQ(turtle.GetX(), 20);
```

### Example: Performing Side Effects

You can chain actions to perform multiple things:

```cpp
using ::testing::DoAll;
using ::testing::SetArgPointee;

class MockMutator {
 public:
  MOCK_METHOD(void, Mutate, (int* value), (override));
};

MockMutator mutator;
EXPECT_CALL(mutator, Mutate)
    .WillOnce(DoAll(SetArgPointee<0>(5)));

int x = 0;
mutator.Mutate(&x);
EXPECT_EQ(x, 5);
```

---

## 5. Running Your First Mock Test

Here’s a complete minimal example demonstrating mocking and verifying expectations:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;
using ::testing::_;
using ::testing::Return;

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(PaintTest, DrawsCircle) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  EXPECT_CALL(turtle, Forward(_)).Times(AtLeast(1));
  EXPECT_CALL(turtle, PenUp()).Times(AtLeast(1));
  EXPECT_CALL(turtle, GetX()).WillRepeatedly(Return(0));

  // Code under test: simulate drawing a circle which calls turtle’s methods
  turtle.PenDown();
  for(int i = 0; i < 4; i++) {
    turtle.Forward(100);
  }
  turtle.PenUp();

  EXPECT_EQ(turtle.GetX(), 0);
}

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Run this test; GoogleMock will ensure expected calls happen as specified. If calls are missing or arguments mismatch, the test will immediately fail with detailed diagnostics.

---

## 6. Best Practices & Common Pitfalls

- **Always mock virtual methods:** GoogleMock only mocks virtual functions by default.
- **Set expectations before calls:** `EXPECT_CALL` must precede the code exercising the mock.
- **Use `ON_CALL` for default behavior:** Use `ON_CALL` to specify default behavior without enforcing call counts.
- **Avoid over-specification:** Only mock and expect what matters; use wildcards `_` and `Times(AnyNumber())` wisely.
- **Use NiceMock and StrictMock:**
  - `NiceMock<T>` suppresses warnings on uninteresting calls.
  - `StrictMock<T>` treats unexpected/uninteresting calls as test failures.
- **Mock destructors indirectly:** You cannot mock destructors directly; instead, add a mock method and call it in the destructor to monitor destruction.

---

## 7. Troubleshooting

### Why is my mock method calling the real method?

- Ensure the method is declared `virtual`. Only virtual methods can be overridden by mocks.

### Uninteresting mock function call warning

- You have called a mock method with no `EXPECT_CALL`. Use `NiceMock` to suppress warnings or add `EXPECT_CALL(...).Times(AnyNumber())`.

### Confusing multiple failures about expectations

- Multiple failures may show the same state at different times, reflecting complex test flows. Investigate carefully.

### Unexpected calls failing the test

- Calls matching no expectations are failures. Add comprehensive `EXPECT_CALL` statements to cover expected calls.

### Handling move-only types

- Use lambdas or `WillOnce()` with returns for move-only return types or arguments.

### Dealing with method qualifiers

- Include correct qualifiers like `const` or `override` in your `MOCK_METHOD` macro to avoid compilation warnings or errors.

For further troubleshooting, see the [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html).

---

## 8. Next Steps

- Explore [Mocking Reference](reference/mocking.md) for deeper understanding.
- Learn advanced mocking techniques in [gMock Cookbook](gmock_cook_book.md).
- Try writing your own mocks and tests using the patterns demonstrated.
- Consult [Writing Your First Test](getting_started/first_test_and_validation/writing_first_test) for integrating with GoogleTest.

---

**GoogleMock empowers you to write robust unit tests with precise control over interactions between your code and its dependencies. Start simple, and grow your mastery by incrementally exploring gMock's rich features!**
