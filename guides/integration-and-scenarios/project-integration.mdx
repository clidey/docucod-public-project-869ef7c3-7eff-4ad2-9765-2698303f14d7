---
title: "Integrating GoogleTest in Your Build System"
description: "Step through integrating GoogleTest and GoogleMock into various build environments, with practical advice for CMake, Bazel, and other common setups. Learn tips for managing dependencies smoothly."
---

# Integrating GoogleTest in Your Build System

This guide walks you through integrating GoogleTest and GoogleMock into a variety of popular C++ build environments. You will find practical instructions for standalone usage and embedding GoogleTest into your own projects using CMake, Bazel, and other common setups. Additionally, learn best practices for managing dependencies and configuring your build system to smoothly compile and link tests using GoogleTest’s powerful testing framework.

---

## Why Integration Matters

GoogleTest is a robust C++ testing framework that supports cross-platform and multi-environment development. To harness its full power, especially when combined with GoogleMock for mocking dependencies, you need to integrate it correctly with your build system. A proper integration enables:

- Automatic test discovery and execution.
- Consistent compiler and linker settings between your code and GoogleTest.
- Reduced maintenance overhead managing dependency versions and updates.
- Seamless inclusion of GoogleMock, which depends on GoogleTest.

This guide emphasizes practical, actionable steps tailored to your build environment.

---

## Prerequisites

Before integrating GoogleTest, ensure:

- A C++17 compatible compiler and toolchain is installed.
- Your platform and build tools are supported (Linux, Windows, Mac OS X, etc).
- You have installed or can install CMake if using it for builds.
- Access to your project’s build configuration files (e.g., CMakeLists.txt, Bazel BUILD files).


---

## Integration with CMake

CMake is a widely used cross-platform build system that simplifies GoogleTest integration.

### Standalone Build of GoogleTest

Follow these steps to build GoogleTest as a standalone project:

1. **Clone the GoogleTest repository:**

   ```bash
   git clone https://github.com/google/googletest.git -b v1.17.0
   cd googletest
   ```

2. **Create a build directory and generate build files:**

   ```bash
   mkdir build && cd build
   cmake ..            # Generates build files including GoogleMock by default.
   # Or if you only need GoogleTest:
   # cmake .. -DBUILD_GMOCK=OFF
   ```

3. **Compile the libraries:**

   ```bash
   make               # Use your platform's equivalent if not on *nix
   sudo make install   # Installs libraries and headers system-wide
   ```

   - On Windows, Visual Studio solutions and project files (.sln, .vcxproj) are generated.
   - On macOS, Xcode project files are generated.

### Embedding GoogleTest into an Existing CMake Project

There are two main approaches:

#### 1. Use Installed GoogleTest Libraries

If GoogleTest is installed on your system, find and link it:

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(my_test test.cpp)
target_link_libraries(my_test GTest::gtest GTest::gmock_main)
add_test(NAME my_test COMMAND my_test)
```

- Linking with `gmock_main` provides a `main()` that initializes GoogleMock and GoogleTest.

#### 2. Add GoogleTest as a Subdirectory

Including GoogleTest source in your build avoids runtime incompatibilities and version mismatches.

Add this snippet to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows dynamic CRT compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main gmock_main)
add_test(NAME my_test COMMAND my_test)
```

- Requires CMake 3.14 or later.
- Uses the `FetchContent` module to download GoogleTest at configure time.

### Important Configuration Notes

- **C++ Standard:** Make sure your project sets `CMAKE_CXX_STANDARD` to at least 17 with:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

- **Windows Runtime Library Compatibility:** On Windows, mismatches between dynamic and static runtimes cause linker errors. Use the `gtest_force_shared_crt` option as shown above to align runtimes.

- **Threading Support:** GoogleTest detects if pthread is available and uses it. When you write your own build scripts, ensure pthreads are linked appropriately.

---

## Integration with Bazel

Bazel users can leverage built-in rules for GoogleTest and GoogleMock integration.

Steps:

1. Add GoogleTest dependency in your `WORKSPACE` and `BUILD` files.

2. Define test targets using `cc_test`, linking against `@com_google_googletest//:gtest_main` or `@com_google_googletest//:gmock_main`.

Example `BUILD` snippet:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

- Bazel automatically manages dependencies and includes GoogleTest sources.

- Consult Bazel documentation or GoogleTest Bazel examples for advanced configurations.

---

## Using Shared Libraries (DLL) with GoogleTest

Although static linking of GoogleTest is common and simple, shared library use is supported.

- To build GoogleTest as a shared library, add `-DGTEST_CREATE_SHARED_LIBRARY=1` to your compiler flags.

- When compiling your tests, define `-DGTEST_LINKED_AS_SHARED_LIBRARY=1`.

- Ensure your linker produces shared libraries accordingly.

- Shared building can optimize load times and reduce binary sizes.

---

## Handling Macro Conflicts

GoogleTest macros like `TEST()` and `EXPECT_EQ()` may clash with other libraries.

You can redefine conflicting macros by adding compiler flags such as:

```
-DGTEST_DONT_DEFINE_TEST=1
```

This forces GoogleTest to rename the macro `TEST` to `GTEST_TEST`.

Apply this approach similarly for other macros e.g. `ASSERT_EQ`, `EXPECT_TRUE`.

---

## Best Practices & Tips

- Always keep GoogleTest up to date with your project to benefit from bug fixes and improvements.
- Prefer embedding GoogleTest sources into your project’s build for consistent compiler settings.
- Use `gmock_main` when linking to get automatic `main()` function handling.
- Avoid mixing static and dynamic runtime library linking, especially on Windows.
- Use CMake's `FetchContent` for simpler dependency management without manual cloning.
- For continuous integration, include GoogleTest builds or use pre-built binaries compatible with your environment.
- For projects without CMake or Bazel, adapt the standalone build instructions to your environment.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Build Issues">
<Accordion title="Linker errors due to runtime mismatches on Windows">
Ensure that the `gtest_force_shared_crt` option is enabled in CMake. Also verify that your project and GoogleTest use the same runtime linkage setting (dynamic or static). Mismatches cause LNK2038 errors.
</Accordion>
<Accordion title="GoogleTest not found by find_package">
Verify that GoogleTest is installed and that CMake’s `CMAKE_PREFIX_PATH` includes its installation prefix. Alternatively, embed GoogleTest as a subdirectory to avoid this.
</Accordion>
<Accordion title="C++ standard version errors">
GoogleTest requires C++17 or higher. Make sure your compiler supports this and that your build configuration specifies `-std=c++17` or equivalent.
</Accordion>
<Accordion title="Macro redefinitions or conflicts">
Using third-party libraries that define similar macros can cause conflicts. Use compilation flags like `-DGTEST_DONT_DEFINE_TEST=1` to rename GoogleTest macros.
</Accordion>
</AccordionGroup>

---

## Next Steps & Related Documentation

- Read the [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) to learn how to write tests after integration.
- Explore [Mocking with GoogleMock](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md) for advanced mock usage.
- Review [GoogleTest FAQ](https://github.com/google/googletest/blob/main/docs/faq.md) for common questions.
- Check [Installation with CMake](https://github.com/google/googletest/blob/main/getting-started/setup-prerequisites-installation/installation-cmake.mdx) for detailed environment setup.
- Consider continuous integration practices using GoogleTest as in [CI/CD Practices](https://github.com/google/googletest/blob/main/guides/integration-and-scenarios/ci-cd-practices.mdx).

---

By following this guide, you will successfully integrate GoogleTest into your project’s build system, enabling reliable, portable, and maintainable C++ testing.

---

For source and updates, visit the [GoogleTest GitHub repository](https://github.com/google/googletest).

---

### Additional Resources

- [GoogleMock Main Function Implementation](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc) shows how the test `main()` function initializes GoogleMock and GoogleTest in various environments.
- CMakeLists.txt in the GoogleTest repo provides reference for advanced build system configuration.

---

_Last Updated: main branch_

