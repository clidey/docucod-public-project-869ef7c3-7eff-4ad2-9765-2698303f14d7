---
title: "Integrating with Build Systems"
description: "Follow detailed steps to integrate GoogleTest and GoogleMock into popular build tools like CMake and Bazel. This guide smooths the workflow from project setup through automated builds and continuous integration."
---

# Integrating with Build Systems

Follow detailed steps to integrate GoogleTest and GoogleMock into popular build tools like CMake and Bazel. This guide smooths the workflow from project setup through automated builds and continuous integration.

---

## Overview

This page guides you through integrating GoogleTest and GoogleMock with common build systems, focusing on how to configure your project with **CMake** and **Bazel**. These integrations enable automated building of tests, linking with required libraries, and smooth integration into your CI pipelines.

### Prerequisites

- A C++ project that uses either CMake or Bazel as its build system.
- GoogleTest and GoogleMock source code accessible (either included as a submodule, fetched externally, or installed system-wide).
- Basic familiarity with your build tool (CMake or Bazel).

### Expected Outcome

By following this guide, you will be able to:

- Properly link GoogleTest and GoogleMock libraries in your projects.
- Build tests with automatic inclusion of GoogleMock (which depends on GoogleTest).
- Use `gmock_main` or custom `main()` implementations for test executables.
- Integrate your tests into continuous integration with predictable results.

### Time Estimate

Setup typically takes 15-30 minutes depending on your project complexity and build system familiarity.

### Difficulty Level

Intermediate â€” requires understanding of build systems and C++ linking.

---

## 1. Integrating with CMake

GoogleTest and GoogleMock are distributed with CMake configuration files that you can use directly or integrate as part of your project.

### Step 1: Add GoogleTest/GoogleMock to Your Project

You can either add GoogleTest as a subdirectory or reference an installed copy.

**Option A: Add as a Subdirectory**

```cmake
# Add googletest and googlemock subdirectories
add_subdirectory(googletest)  # Path to googletest source
add_subdirectory(googlemock)  # Optional if separate
```

**Option B: Use Installed Package**

If GoogleTest and GoogleMock are installed in your system, use CMake's `find_package`:

```cmake
find_package(GTest REQUIRED)

include_directories(${GTEST_INCLUDE_DIRS})
```


### Step 2: Add Your Test Executable

Define your test executable and link against GoogleTest and GoogleMock libraries.

```cmake
add_executable(my_test test_main.cc my_tests.cc)

# Link with gmock_main to get main() provided by GoogleMock
target_link_libraries(my_test gmock_main)

# If you provide your own main, link with gmock instead:
# target_link_libraries(my_test gmock gtest)
```


### Step 3: Set Up Threading and C++ Standard

GoogleTest requires threading support; link with pthread on Unix systems if needed.

```cmake
set(THREADS_PREFER_PTHREAD_FLAG ON)
find_package(Threads REQUIRED)

target_link_libraries(my_test Threads::Threads)

# Set C++ standard to at least C++11
set_target_properties(my_test PROPERTIES
    CXX_STANDARD 11
    CXX_STANDARD_REQUIRED ON
)
```


### Step 4: Build and Run

Standard CMake workflow applies:

```bash
mkdir build && cd build
cmake ..
make
./my_test
```

You should see your tests running with GoogleMock support.

### Notes and Best Practices

- Use `gmock_main` library when you want to use the default main() provided by GoogleMock.
- If you want finer control over main(), link with `gmock` and `gtest` libraries and provide your own main.
- Ensure your test sources include `<gmock/gmock.h>` and/or `<gtest/gtest.h>` as needed.
- For Windows, check that runtime libraries for your executable and GoogleTest match to avoid linkage issues.

---

## 2. Integrating with Bazel

Bazel has first-class support for GoogleTest and provides built-in rules to integrate tests.

### Step 1: Include GoogleTest in WORKSPACE

You can add GoogleTest as an external repository or vendor it into your project.

```python
http_archive(
    name = "com_google_googletest",
    url = "https://github.com/google/googletest/archive/release-1.12.1.tar.gz",
    strip_prefix = "googletest-release-1.12.1",
    sha256 = "d4c17550f0a7d9c1b3ad08255411ea099319b4684f7aef93511310677cb4a980",
)
```

### Step 2: Load GoogleTest Rules

Add the following to your `BUILD` files referencing external GoogleTest.

```python
load("@com_google_googletest//bazel:gtest.bzl", "gtest")

cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = [
        "@com_google_googletest//:gmock_main",
        # other dependencies
    ],
)
```

### Step 3: Use `gmock_main` as Dependency

Linking against `@com_google_googletest//:gmock_main` gives you the default main function that runs all tests.

If you want to provide your own main(), link with `@com_google_googletest//:gmock`

### Step 4: Run Tests

Use Bazel to build and test:

```bash
bazel test //path/to:my_test
```

---

## Troubleshooting & Tips

### Common Issues

- **Linker errors relating to pthread or threading**: Ensure you link with `Threads::Threads` in CMake or add Bazel dependency on threading.
- **Undefined references to `main` when linking**: Confirm you link with `gmock_main` or provide your own `main()`.
- **Multiple definitions of `main` error**: Don't link with both `gmock_main` and provide your own `main()`.
- **Build failures on Windows due to runtime mismatch**: Confirm that both your project and the GoogleTest binaries are compiled against the same runtime library.

### Best Practices

- Prefer `gmock_main` to avoid having to write your own test `main()`.
- Use `add_subdirectory()` in CMake for tighter integration and easier debugging.
- In Bazel, rely on the official GoogleTest rules for stable support.
- Keep GoogleTest and GoogleMock versions in sync to avoid incompatibilities.
- Use verbose build outputs if linking or compiling errors are not clear.

### Performance Tips

- Enable parallel builds in your build tool.
- Cache external dependencies when possible.

---

## Next Steps & Related Content

- [Getting Started: Installation & Build Integration](/getting_started/essentials_setup/installation)
- [Writing Your First Test](/guides/getting-started/writing-your-first-test)
- [Mocking with GoogleMock](/guides/advanced-testing/mocking-with-googlemock)
- [Troubleshooting Common Issues](/getting_started/first_steps_usage/common_issues)
- [Integrating and Ecosystem Overview](/overview/architecture-core/integration-ecosystem)

---

## References

- GoogleTest GitHub: https://github.com/google/googletest
- GoogleMock Documentation: https://google.github.io/googletest/gmock_for_dummies.html
- CMake official documentation: https://cmake.org/cmake/help/latest/
- Bazel official documentation: https://bazel.build

---