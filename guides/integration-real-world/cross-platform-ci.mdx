---
title: "Integrating Tests in Cross-Platform Build and CI Systems"
description: "Step-by-step instructions for integrating your tests into common CI pipelines (such as GitHub Actions), build tools (CMake, Bazel), and leveraging platform portability features. Provides troubleshooting tips for multi-platform reliability."
---

# Integrating Tests in Cross-Platform Build and CI Systems

## Overview

This guide walks you through integrating your GoogleTest-based tests within popular build systems and continuous integration (CI) pipelines, focusing on cross-platform compatibility and reliability. Whether you use CMake or Bazel as your build system, or want to automate test execution on CI platforms like GitHub Actions, this documentation will help you set up, configure, and troubleshoot your tests effectively across diverse environments.

---

## Workflow Overview

- **Task Description:** Integrate GoogleTest unit tests into your build system and automation workflows while ensuring multi-platform compatibility.
- **Prerequisites:**
  - A C++17 compatible compiler and build system (CMake or Bazel).
  - GoogleTest source or libraries available in your development environment.
  - Access to your preferred CI platform and permissions to configure build pipelines.
- **Expected Outcome:** Automated build and test runs with GoogleTest across Linux, macOS, and Windows platforms, with robust test discovery and execution.
- **Time Estimate:** 30 to 60 minutes, depending on your build system complexity and CI setup experience.
- **Difficulty Level:** Intermediate

---

## Step-by-Step Instructions

### 1. Configure GoogleTest in Your Build System

#### Using CMake

1. **Set minimum CMake version and project settings:**

   Ensure your `CMakeLists.txt` declares at least CMake 3.14 and sets C++17 standard:

   ```cmake
   cmake_minimum_required(VERSION 3.14)
   project(my_project)

   set(CMAKE_CXX_STANDARD 17)
   set(CMAKE_CXX_STANDARD_REQUIRED ON)
   ```

2. **Declare GoogleTest dependency:**

   Use `FetchContent` module to download and make GoogleTest available during configuration:

   ```cmake
   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
   )
   # On Windows, ensure runtime linkage consistency
   set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
   FetchContent_MakeAvailable(googletest)
   ```

3. **Add your test executable and link GoogleTest:**

   ```cmake
   enable_testing()

   add_executable(
     hello_test
     hello_test.cc
   )
   target_link_libraries(
     hello_test
     GTest::gtest_main
   )

   include(GoogleTest)
   gtest_discover_tests(hello_test)
   ```

4. **Build and run the tests locally:**

   ```bash
   cmake -S . -B build
   cmake --build build
   cd build
   ctest
   ```

   Expect output indicating tests passed.

#### Using Bazel

1. **Add GoogleTest as a dependency:**

   Include GoogleTest in your `WORKSPACE` file or use Bazel’s native support.

2. **Define your test targets:**

   Write `cc_test` rules that depend on GoogleTest libraries.

3. **Run tests:**

   Use `bazel test //...` to run your tests.

> For detailed Bazel integration steps, see [GoogleTest Bazel Quickstart](https://github.com/google/googletest/blob/main/docs/quickstart-bazel.md).

---

### 2. Integrate Tests in Continuous Integration Pipelines

#### Sample GitHub Actions Workflow

Create a `.github/workflows/gtest.yml` file in your repo:

```yaml
name: Build and Test

on: [push, pull_request]

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]

    steps:
    - uses: actions/checkout@v3

    - name: Setup C++ environment
      if: matrix.os == 'ubuntu-latest'
      run: sudo apt-get update && sudo apt-get install -y cmake build-essential

    - name: Setup C++ environment
      if: matrix.os == 'windows-latest'
      uses: microsoft/setup-msbuild@v1.1

    - name: Configure
      run: |
        cmake -S . -B build

    - name: Build
      run: |
        cmake --build build --config Release

    - name: Run tests
      run: |
        cd build
        ctest --output-on-failure
```

- Adjust the setup step to match your platform's requirements.
- The matrix strategy ensures tests run on all supported OSs.

#### Common Platform Portability Tips

- Use CMake’s `gtest_discover_tests()` to automatically register tests with CTest, which integrates cleanly with most CI platforms.
- Always specify the C++ standard while configuring builds (`set(CMAKE_CXX_STANDARD 17)`).
- Use GoogleTest’s platform macros (e.g., `GTEST_OS_WINDOWS`) if needed to conditionally compile or skip tests on specific platforms.
- Consider environment-related differences such as path separators (`/` vs `\\`) when writing tests that handle files.

---

### 3. Troubleshooting Multi-Platform Reliability

- **Tests Not Discovered or Run:** 
  - Ensure your build system includes `gtest_discover_tests()` or equivalent test discovery.
  - Verify that test executables are built and located where the CI runner expects.
- **Linking Errors on Windows:**
  - Use `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` to match Visual Studio runtime linkage.
  - Confirm the compiler version supports C++17.
- **Threading or Timing Failures:**
  - GoogleTest requires pthreads or platform thread support; verify threading flags are set and libraries linked.
  - Avoid flaky tests by limiting dependence on timing or external resources.
- **Environment Differences:**
  - Make sure environment variables and working directories in CI are consistent and tests clean up temporary files.

---

## Practical Tips & Best Practices

- **Use `FetchContent` Module:** Automatically download and build GoogleTest as part of your build.
- **Leverage CTest and `gtest_discover_tests()`:** For unified cross-platform test execution and reporting.
- **Run on Multiple Platforms:** Always validate tests on Linux, Windows, and macOS if your product supports them.
- **Keep Tests Isolated:** Avoid platform-dependent side effects affecting test results.
- **Configure CI With Matrix Builds:** To catch environment-specific issues early.

---

## Example: Minimal CMakeLists.txt for GoogleTest with CI Support

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(my_test my_test.cpp)
target_link_libraries(my_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(my_test)
```

---

## Next Steps & Related Documentation

- **Setup Quickstart:** Start with [Setup Quickstart for CMake](https://google.github.io/googletest/quickstart-cmake.html) for basic building and running.
- **Troubleshooting:** Refer to [Common Installation Issues](../../getting-started/troubleshooting-support/common-issues-and-fixes) when facing environment or build problems.
- **CI & Advanced Integration:** Explore guides on [Cross-Platform CI](../integration-real-world/cross-platform-ci) and [Performance Optimization](../integration-real-world/performance-optimization).
- **Test Patterns:** Learn about [Writing Your First Test](../../guides/getting-started/writing-your-first-test) and effective mocking/parameterization patterns.

<Tip>
Automating your GoogleTest runs in CI maximizes feedback speed and catch platform-specific issues early. Always validate builds locally before applying changes to CI to streamline troubleshooting.
</Tip>

---

## Troubleshooting & Tips

<AccordionGroup title="Common Issues and How to Fix Them">
<Accordion title="Test Discovery Failures in CI">
Verify your build system integrates `gtest_discover_tests()`. Without this, CTest won't know about your GoogleTest tests. For Bazel, ensure `cc_test` targets are correctly configured.
</Accordion>
<Accordion title="Linking Errors on Windows">
Make sure `gtest_force_shared_crt` is set to ON in your CMake configuration to unify CRT linkage with your project. Also, confirm using a supported MSVC version (2017 Update 3 or later).
</Accordion>
<Accordion title="Threading Support Missing">
GoogleTest requires pthread availability on POSIX platforms. For Windows, threading is supported via Win32 APIs. On unsupported platforms, GoogleTest disables threading features. Check `GTEST_HAS_PTHREAD` macro and link appropriate libs.
</Accordion>
<Accordion title="CI Job Fails with Timeout">
Sometimes, tests may hang or run slowly in CI environments. Use `--gtest_break_on_failure` or timeout settings in your CI to identify problematic tests. Avoid long-running tests in CI.
</Accordion>
</AccordionGroup>

---