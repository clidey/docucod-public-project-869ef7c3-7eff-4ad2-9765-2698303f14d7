---
title: "Troubleshooting and Common Pitfalls"
description: "A guide to diagnosing and resolving frequent problems encountered with GoogleTest and GoogleMock, including build errors, environment setup issues, and tips for debugging test failures quickly and effectively."
---

# Troubleshooting and Common Pitfalls

GoogleTest and GoogleMock are powerful tools that enable robust C++ testing and mocking. However, users often encounter common issues ranging from build problems to confusing test failures. This guide provides practical troubleshooting advice and tips to resolve frequent problems efficiently, helping you navigate setbacks and maintain productive testing workflows.

---

## 1. Build and Installation Issues

### 1.1 Compiler Support and C++ Standard

* **Ensure C++17 or higher is enabled**: GoogleTest and GoogleMock require at least C++17. Verify your compiler flags include `-std=c++17` (GCC/Clang) or equivalent.

* **Supported compilers**: Confirm you use a supported compiler version. Most GCC, Clang, MSVC versions released in recent years are compatible.

* **Thread support**: GoogleTest requires threading support, so platform-specific pthread libraries must be linked (especially on POSIX).

### 1.2 Linking and Library Integration

* **Correct linking order**: When linking GoogleTest or GoogleMock, ensure test binaries link to the correct static/shared libraries in the prescribed order.

* **`gtest_main` library**: To avoid writing a `main()` function, link against `gtest_main`.

* **Avoid duplicate definitions**: Do not link both static and shared builds simultaneously.

### 1.3 Common Compiler Warnings and Errors

* **Warning C4301 or C4373 (MSVC)**: This may occur when mocking methods with `const` value parameters. The compiler ignores `const` on parameters by design, so removing the `const` qualifier from parameters in method declarations and mocks avoids this warning.

* **Memory exhaustion compiling mocks (MSVC)**: Large mock classes with many methods can exhaust compiler memory, especially with `/clr` enabled. Avoid `/clr` or move mock constructor/destructor definitions to separate `.cc` files to improve compilation.

---

## 2. Runtime and Test Failures

### 2.1 Unexpected or Uninteresting Calls

By default, gMock warns when a mock method call does not match any explicit expectation:

```cpp
EXPECT_CALL(mock_foo, SomeMethod(5));
...
mock_foo.SomeMethod(6);  // Warning: Uninteresting call
```

**How to resolve:**

* Use `ON_CALL()` to specify default behavior without expectation if you do not want to verify all calls.
* Suppress warnings for uninteresting calls with `NiceMock<MockFoo>` instead of `MockFoo`.
* Use `EXPECT_CALL(...).Times(AnyNumber())` if you want to allow these calls with no error or warning.

### 2.2 Matchers Not Matching as Expected

Mismatch between expected and actual arguments can lead to test failures.

**Tips:**

* Run tests with `--gmock_verbose=info` to see detailed matching logs including which expectations were tried.
* Confirm correct matchers are used, especially with overloaded functions (use techniques from [Selecting Between Overloaded Functions](gmock_cook_book.md#SelectOverload)).
* Use `SafeMatcherCast` carefully to resolve type mismatches.

### 2.3 Call Order and Sequence Errors

By default, expectations do not enforce call order. If order matters:

* Use `InSequence` to enforce strict order.
* For partial order, use `Sequence` objects and `.InSequence()` on expectations.

Misuse can cause failures with messages about unsatisfied prerequisites.

### 2.4 Expectation Count Violations

* **Too few calls:** Test fails if expected calls aren’t made.
* **Too many calls:** Excessive calls trigger failures.

**Resolution:**

* Use appropriate `Times()` cardinalities.
* Use `.RetiresOnSaturation()` if you want an expectation to be deactivated after it’s saturated.

### 2.5 Mock Object Not Verifying Expectations

Mock verification normally occurs on mock object destruction.

If a mock is on the heap and not deleted, verification might not happen.

**Fix:**

* Delete the mock explicitly.
* Use `Mock::VerifyAndClearExpectations(&mock_obj)` to force verification before destruction.
* Enable heap checker in tests to catch leaks.

---

## 3. Mocking Specific Constructs Challenges

### 3.1 Mocking Non-virtual or Static Methods

Direct mocking of non-virtual or static methods is unsupported.

**Workarounds:**

* Refactor code to use interfaces (abstract classes) and mock those interfaces.
* Use the high-performance dependency injection technique with templates (see gMock Cookbook section on mocking non-virtual methods).
* Wrap static functions with interfaces to mock.

### 3.2 Mocking Overloaded Methods

If you mock only some overloads, compiler warnings may appear.

**Tips:** Use `using Base::MethodName;` in your mock class to bring all overloads into scope.

### 3.3 Mocking Move-only Types

Methods that accept or return move-only types (e.g., `std::unique_ptr`) require careful handling.

**Solutions:**

* Use proper `MOCK_METHOD` syntax as usual.
* Use lambdas in `.WillOnce()` or `.WillRepeatedly()` to return new objects whenever needed.
* See gMock Cookbook for detailed examples.

---

## 4. Debugging and Diagnostic Tips

### 4.1 Increasing gMock Verbosity

Run tests with `--gmock_verbose=info` to see detailed logs of mock function calls, matched expectations, and diagnostic info including stack traces.

Example:

```shell
./my_test --gmock_verbose=info
```

### 4.2 Understanding Uninteresting vs Unexpected Calls

* **Uninteresting call:** No matching `EXPECT_CALL` for the method at all. Warning by default.
* **Unexpected call:** Some `EXPECT_CALL` exist, but arguments do not match any expectation. Test failure.

Adjust mock niceness using `NiceMock` or `StrictMock` accordingly.

### 4.3 Using Checkpoints for Complex Testing Scenarios

Insert dummy expectations or checkpoints to verify call order or phases.

### 4.4 Compiling with Debug Info

Enable debug info compilation flags (e.g. `-g`) to get more usable stack traces for failures.

### 4.5 Using IDE Integration

Use Emacs or other IDEs configured with GoogleTest integration to jump to failures quickly.

### 4.6 Inspecting Failure Messages

* Verify argument matchers in expectation failures.
* Use `EXPECT_THAT()` with matchers to make assertions more expressive.

---

## 5. Best Practices to Avoid Pitfalls

* **Set expectations before exercising mocks:** Never set new `EXPECT_CALL` after passing mocks to the code or after calls.
* **Don’t overspecify:** Use minimal necessary constraints to avoid fragile tests.
* **Prefer `ON_CALL` for default behavior:** Only use `EXPECT_CALL` when verifying call occurrence.
* **Use named sequences for partial ordering:** This allows you to express realistic ordering constraints.
* **Use `RetiresOnSaturation()` for chained expectations:** Avoid sticky expectations blocking later ones.
* **Avoid mocking concrete classes unnecessarily:** Favor interfaces and adaptors for maintainability.
* **Use `NiceMock` or `StrictMock` intentionally:** Understand consequences of suppressing or enforcing warnings on uninteresting calls.

---

## 6. References and Further Help

* [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) – Recipes for common mocking patterns and troubleshooting.
* [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) – Quick reference for defining mocks and expectations.
* [gMock For Dummies](https://google.github.io/googletest/gmock_for_dummies.html) – Beginner-friendly guide on mocks.
* [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) – Answers to common queries.
* Run tests with `--gmock_verbose=info` for diagnostic output.
* Use `Mock::VerifyAndClearExpectations()` to forcibly verify mocks.
* For installation problems, review [Common Installation Issues](../../getting-started/troubleshooting-support/common-issues-and-fixes).

---

For help and community support, visit the [GoogleTest GitHub repository](https://github.com/google/googletest) or the GoogleTest mailing lists and forums.
