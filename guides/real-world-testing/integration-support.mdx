---
title: "Integration & Platform Support"
description: "A guide to integrating GoogleTest/GoogleMock in a range of environments—including custom platforms, CI pipelines, or with third-party build systems. Covers platform portability, test registration, and reporting."
---

# Integration & Platform Support

## Overview

This guide helps you integrate GoogleTest and GoogleMock within diverse environments such as custom platforms, continuous integration (CI) pipelines, and third-party build systems. You will learn how to achieve platform portability, how to register asynchronous or complex tests, and how reporting works with GoogleTest/GoogleMock in these varying contexts.

### Prerequisites

- Basic familiarity with GoogleTest and GoogleMock usage and concepts.
- Your development environment should support C++17 or later.
- Access to the appropriate build system or CI pipeline to incorporate GoogleTest/GoogleMock.

### Expected Outcome

- Understand how to effectively integrate GoogleTest/GoogleMock into various build and CI setups.
- Know how platform differences affect test registration and execution.
- Gain practical knowledge on ensuring tests report results correctly in your infrastructure.

### Time Estimate

20-40 minutes depending on the complexity of your environment and build systems.

### Difficulty Level

Intermediate

---

## Integration Workflow

Follow these steps to integrate GoogleTest and GoogleMock into your target platform or environment:

### 1. Include Required Headers

Make sure to include the main GoogleMock header in your test source files:

```cpp
#include <gmock/gmock.h>  // Main entry point for GoogleMock functionality.
```

This header encapsulates all necessary components for mocking and testing.

### 2. Initialize GoogleMock Properly

Before running tests in any environment, GoogleMock must be initialized. This includes parsing command-line flags for test control.

Use one of the following calls early in your executable's `main()` function:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For embedded or custom platforms without `argc` or `argv` parameters, use:

```cpp
testing::InitGoogleMock();
```

### 3. Integrate with Your Build System

#### a. CMake

- Link your test executables against `gmock` and `gtest` libraries.
- Add your test sources and include `gmock` headers in your include path.

Example snippet in your `CMakeLists.txt`:

```cmake
find_package(GTest REQUIRED)

add_executable(my_test test.cc)
target_link_libraries(my_test PRIVATE gmock gtest pthread)
add_test(NAME my_test COMMAND my_test)
```

#### b. Bazel

- Use `cc_test` rules with dependency on `@com_google_googletest//:gmock`.

#### c. Other Build Systems

- Ensure your build links against gMock and gTest static or shared libraries.
- Include the proper directories for header files.

<Tip>
Always use the official gMock libraries bundled with GoogleTest to avoid incompatibilities.
</Tip>

### 4. Register Tests According to Your Environment

GoogleTest/GoogleMock automatically registers tests through the use of static constructs when test cases are defined using macros like `TEST()` and `TEST_F()`.

For custom or embedded platforms that may not support static registration automatically:

- Manually register tests if necessary using GoogleTest APIs.
- Use `::testing::AddGlobalTestEnvironment` for environment setup.

### 5. Reporting Test Results

- GoogleTest outputs results to standard output/error in an easily parsable format.
- For CI integration, enable XML output reporting with the flag:

```shell
--gtest_output=xml:
```

- This XML can be consumed by many CI tools for reporting and integration.

<Tip>
If you experience missing or incomplete reports, check your build system's test execution and output capture configuration.
</Tip>

### 6. Platform Portability Considerations

- GoogleMock is designed to support major platforms including Linux, macOS, and Windows.
- If you operate on a custom platform:
  - Ensure C++17 support and compatible compiler.
  - Verify threading and synchronization behavior as gMock requires mutexes.
  - Customize initialization if `argc/argv` are unavailable.

### 7. Continuous Integration (CI) Pipeline Integration

- Run test executables as part of your build pipeline.
- Collect and publish test result XML artifacts.
- Use GoogleMock's verbosity flags (e.g., `--gmock_verbose=info`) selectively for debugging.

<Tip>
Configure your CI system to fail builds on test failures to ensure quality and regression detection.
</Tip>

---

## Practical Tips & Best Practices

- **Default Initialization**: Always initialize GoogleMock once before executing any tests to avoid undefined behaviors.

- **Use `ON_CALL` for Default Behavior**: Set default mock behaviors that aren’t necessarily required to be called using `ON_CALL`. Use `EXPECT_CALL` only where call counts and arguments must be verified.

- **Order Expectations Carefully**: Remember that later `EXPECT_CALL` statements override earlier ones. For ordered expectations, use `InSequence` or `After` clauses.

- **Suppress Uninteresting Warnings**: Use `NiceMock` to reduce noise about uninteresting calls if you do not want warnings on those.

- **Manage Mock Lifetimes**: Avoid leaks of mock objects; else, use `Mock::AllowLeak()` intentionally, especially in persistent or global mocks.

- **Leverage Verbosity Flags**: Use `--gmock_verbose` to adjust logging detail during test runs to help diagnose issues.

- **Use XML reports in CI**: XML output enables detailed result gathering for dashboards.

- **Ensure Virtual Destructors**: If mocking interfaces, confirm their destructors are virtual to avoid memory errors.

---

## Troubleshooting Common Issues

### Unexpected Test Failures due to Call Ordering or Counts

- Verify you set your expectations **before** exercising the code.
- Use `--gmock_verbose=info` to trace mock calls and understand matching.
- Confirm that calls happen in the expected order or set `InSequence`/`After` where order matters.

### Warnings about Uninteresting Calls

- Use `NiceMock` if you want to suppress these warnings.
- If you want to fail on unexpected calls, use `StrictMock` or explicitly set `.Times(0)`.

### Build or Link Errors

- Ensure your build system links to `gmock` and `gtest` libraries correctly.
- Include the proper header directories.

### Platform Limitations

- Make sure your platform supports the required C++ standard and threading features.
- For embedded environments, use the `InitGoogleMock()` variant without parameters.

### Test Output is Missing or Incomplete in CI

- Make sure test execution and output are correctly captured.
- Use `--gtest_output=xml:` flag to generate XML reports.
- Inspect CI logs for any early termination or crashes.

---

## Next Steps & Related Documentation

- Read the **[gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)** for practical test writing recipes.
- Explore **[Mocking Reference](https://google.github.io/googletest/reference/mocking.html)** for detailed API usage.
- Refer to **[Basic Mocking: Using GoogleMock](https://google.github.io/googletest/guides/getting-started/mocking-basics.html)** for foundational mock usage.
- For debugging test failures, consult **[Troubleshooting Common Issues](https://google.github.io/googletest/getting-started/first-test-run-validation/troubleshooting-common-issues.html)**.
- If uncertain, start at **[What is GoogleTest & GoogleMock?](https://google.github.io/googletest/overview/product-intro-core-concepts/what-is-googletest.html)** for core concepts.


---

## References

- Official GoogleMock repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)
- [GoogleMock Core Header (gmock.h)](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock.h)

---

## Summary

This guide provides an authoritative, actionable walkthrough for integrating GoogleTest/GoogleMock into various development platforms, including CI pipelines and diverse build systems. It covers initialization, test registration, environment-specific concerns, reporting, and best practices that ensure smooth operation and reliable test results.


