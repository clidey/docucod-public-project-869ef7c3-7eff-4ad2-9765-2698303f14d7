---
title: "Integrating with Bazel and CMake"
description: "Step-by-step tutorials for building and running tests using Bazel and CMake, covering installation, configuration, and common troubleshooting steps for these popular build systems."
---

# Integrating with Bazel and CMake

This guide presents clear, step-by-step tutorials for building and running tests with GoogleTest using the Bazel and CMake build systems. Whether you are setting up a new project or integrating GoogleTest into an existing one, this guide walks you through installation, configuration, and troubleshooting within both popular build tools.

---

## Why Use Bazel or CMake for GoogleTest?

GoogleTest is designed for easy integration with major C++ build systems. Bazel and CMake are among the most widely used build systems, each offering strong support for dependency management, building, and test execution. Choosing either ensures your tests can be built reliably across platforms with minimal configuration.

*Bazel* provides an all-in-one workspace and build tool optimized for large-scale projects.

*CMake* offers flexible build generation targeting native build tools, making it suitable for a wide range of environments.

---

## Prerequisites

Before starting, ensure you have:

- A supported operating system: Linux, macOS, or Windows.
- A C++ compiler compatible with C++17 standard or later.
- Either Bazel (version 7.0 or higher) or CMake (version 3.14 or higher) installed, depending on your preferred build system.

For platform-specific details, see the [Supported Platforms and Toolchains](overview/feature-highlight/supported-platforms) documentation.

---

# Part 1: Building and Running Tests with Bazel

### Step 1: Create Bazel Workspace

Start by creating a workspace directory:

```sh
$ mkdir my_workspace && cd my_workspace
```

### Step 2: Add GoogleTest Dependency

Create a `MODULE.bazel` file in the root of your workspace to declare the GoogleTest dependency from the Bazel Central Registry:

```python
# MODULE.bazel

bazel_dep(name = "googletest", version = "1.17.0")
```

Update the version string regularly to use the latest GoogleTest release.

### Step 3: Write Your Test

Create a test file named `hello_test.cc` in the workspace directory:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

This simple test verifies basic assertions provided by GoogleTest.

### Step 4: Create BUILD File

Define the Bazel build for your test binary in a file named `BUILD` alongside your test source:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

This configures Bazel to build your test executable linked with GoogleTest libraries.

### Step 5: Build and Run the Test

Execute the following command to build and run tests, ensuring C++17 standard compliance:

```sh
$ bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

You should see output confirming the test passed successfully.

---

# Part 2: Building and Running Tests with CMake

### Step 1: Create Project Directory

Create and switch to a new directory for your project:

```sh
$ mkdir my_project && cd my_project
```

### Step 2: Configure CMakeLists.txt with GoogleTest Dependency

Create a file named `CMakeLists.txt` with the following contents:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
# On Windows: avoid overriding compiler settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

This setup uses CMake's `FetchContent` module to download and prepare GoogleTest automatically. Update the Git commit hash regularly for the latest version.

### Step 3: Add Test Source File

Create a test source file named `hello_test.cc` with the following code:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 4: Extend CMakeLists.txt to Build and Register Test

Append these lines to your `CMakeLists.txt`:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)

target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

This configuration builds the test executable, links it against GoogleTest's main library, enables CMake testing, and registers the tests automatically.

### Step 5: Build and Run the Test

Run the following commands to build and execute your test:

```sh
$ cmake -S . -B build
$ cmake --build build
$ cd build && ctest
```

Test results will be displayed, confirming success.

---

## Troubleshooting Tips

- **C++ Compiler Support:** Ensure your compiler fully supports C++17 features required by GoogleTest.
- **Build Tool Compatibility:** Verify that your build tool (Make, Ninja, Visual Studio, etc.) is compatible with your chosen build system.
- **Windows Runtime Library Mismatch:** When using CMake on Windows, if you see errors related to runtime library mismatch (e.g., `MTd` vs `MDd`), ensure to set `gtest_force_shared_crt` ON as shown in the CMakeLists example.
- **Pthreads Issues:** On some platforms (especially MinGW), pthreads support may be limited; GoogleTest's CMake scripts account for this. Avoid forcing pthread usage if it's unsupported.
- **Updating Versions:** Regularly update the GoogleTest commit hash in `FetchContent_Declare` or Bazel version in `MODULE.bazel` to keep up with the latest fixes and features.

---

## Best Practices

- Use **`FetchContent` in CMake** or the **Bazel Central Registry** for reliable, dependency-managed inclusion of GoogleTest.
- Structure your test source files logically and keep build configuration files close to your source.
- Use CMake's test discovery features (`gtest_discover_tests`) and Bazel's `cc_test` to keep tests integrated and automated.
- Regularly build and run your tests during development to catch regressions early.

---

## Next Steps

* Explore [Writing Your First Test Case](getting-started/first-test/writing-basic-test) to learn test authoring techniques.
* Dive into [Running and Configuring Test Suites](guides/writing-tests/running-and-configuring-tests) for advanced test execution control.
* Learn mocking with GoogleMock in [Mocking Interfaces with GoogleMock](guides/mocking-and-mocking-patterns/mocking-basics).
* Consult the [Supported Platforms and Toolchains](overview/feature-highlight/supported-platforms) page for detailed environment compatibility.

---