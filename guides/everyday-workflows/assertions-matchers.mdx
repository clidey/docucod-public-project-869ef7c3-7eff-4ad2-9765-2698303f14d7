---
title: "Using Assertions and Matchers Effectively"
description: "Dive into the rich set of built-in assertions and matchers GoogleTest provides, from equality checks to custom user-defined matchers. Includes usage patterns and real examples relevant to daily testing tasks."
---

# Using Assertions and Matchers Effectively

This guide provides a practical and comprehensive look at the built-in assertions and matchers provided by GoogleTest, empowering you to verify code behavior with clarity and precision. From simple equality checks to complex custom matchers, learn how to use these tools effectively in your daily testing workflow.

---

## 1. Understanding Assertions

GoogleTest offers macros to verify conditions in your tests, crucial for confirming correctness.

### 1.1 Assertion Variants

Assertions come in pairs:

- `EXPECT_` macros generate nonfatal failures, allowing the test to continue.
- `ASSERT_` macros generate fatal failures, aborting the current test function immediately.

Example:

```cpp
EXPECT_TRUE(condition) << "Condition must be true";
ASSERT_EQ(result, expected) << "Results do not match";
```

Use `EXPECT_` when tests can continue meaningfully after failure; use `ASSERT_` when further test steps depend on the assertion.

### 1.2 Explicit Success and Failure

Use `SUCCEED()` to document that a certain point is reached successfully. Use `FAIL()` or `ADD_FAILURE()` to signal failures explicitly when the test logic depends on control flow rather than Boolean expressions.

```cpp
if (!SetupEnvironment()) {
  FAIL() << "Failed to set up environment";
}

SUCCEED(); // Marks the test step as passed
```

### 1.3 Boolean Condition Assertions

Verify boolean expressions clearly:

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` verifies truth.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` verifies falsehood.

### 1.4 Binary Comparison Assertions

These check equality or ordering relations between two values and support streaming custom messages.

Examples include `EXPECT_EQ`, `EXPECT_NE`, `EXPECT_LT`, etc. Use `EXPECT_STREQ` and related macros specifically for comparing C-string contents.

```cpp
EXPECT_EQ(value1, value2);
EXPECT_STREQ(cstr1, cstr2);
```

### 1.5 Floating-Point Comparisons

Due to floating-point rounding, use specialized macros:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ` for `float`
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ` for `double`
- `EXPECT_NEAR(val1, val2, abs_error)` to specify an absolute tolerance

### 1.6 Exception Assertions

Confirm code throws expected exceptions:

```cpp
EXPECT_THROW({ code; }, ExceptionType);
EXPECT_NO_THROW({ code; });
```

Use these only when exceptions are enabled and enabled in your build.

### 1.7 Predicate Assertions

Test complex predicates with `EXPECT_PRED*` and their formatted variants `EXPECT_PRED_FORMAT*`, allowing clearer error messages than generic true/false assertions.


---

## 2. Deep Dive into Matchers

Matchers provide flexible, readable, and expressive ways to check values and arguments in tests and mocks.

### 2.1 Basic Usage

Matchers match a single argument and are usable in both `EXPECT_THAT(value, matcher)` and mock expectations `EXPECT_CALL(mock, Method(matcher))`.

Example:

```cpp
EXPECT_THAT(actual, Eq(expected));
EXPECT_THAT(string_val, StartsWith("Hello"));
```

### 2.2 Wildcard Matchers

- `_` matches any value.
- `A<T>()` or `An<T>()` matches any value of type `T`.

Use `_` when you don't care about specific argument values.

### 2.3 Generic Comparisons

Matchers like `Eq(value)`, `Lt(value)`, `Gt(value)`, `Ne(value)` enable expressive relational checks.

Example:

```cpp
EXPECT_CALL(mock, Foo(Ge(5))); // Argument >= 5
```

### 2.4 String Matchers

Use matchers to check string contents and patterns:

- `StrEq`, `StrNe`, `StrCaseEq`, `StrCaseNe` for equality (case-sensitive/insensitive)
- `HasSubstr`, `StartsWith`, `EndsWith` to check substrings
- `MatchesRegex`, `ContainsRegex` for regex matches

Example:

```cpp
EXPECT_THAT(message, HasSubstr("error"));
```

### 2.5 Container Matchers

Match STL-like containers with:

- `ElementsAre(...)` for exact ordered matches
- `UnorderedElementsAre(...)` for unordered matches
- `Contains(...)` to check for presence
- `Each(...)` to verify all elements meet criteria
- `SizeIs(matcher)` to check container size

Example:

```cpp
EXPECT_THAT(vec, ElementsAre(1, _, Gt(5)));
EXPECT_THAT(set, Contains(42));
```

### 2.6 Combined and Composite Matchers

Build complex conditions with:

- `AllOf(m1, m2, ...)` - all matchers must hold
- `AnyOf(m1, m2, ...)` - any one matcher must hold
- `Not(m)` - negation

Example:

```cpp
EXPECT_CALL(mock, Func(AllOf(Gt(0), Ne(10))));
```

### 2.7 Argument Member Matchers

Check specific members or properties using:

- `Field(&Class::member, matcher)` for member variables
- `Property(&Class::method, matcher)` for zero-argument const methods

Example:

```cpp
EXPECT_CALL(mock, Process(Field(&Foo::id, Eq(7))));
```

### 2.8 Pointer Matchers

- `Pointee(m)` matches the value a pointer points to
- `Pointer(m)` matches the pointer value itself
- `WhenDynamicCastTo<T>(m)` checks if a pointer/reference can be dynamically cast and matches inner matcher

Use these to check contents pointed by smart or raw pointers safely.

### 2.9 Custom Matchers

Define your own matchers with the `MATCHER` macros for reusable, readable tests.

Example:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}
EXPECT_THAT(value, IsEven());
```

### 2.10 Using Matchers as Predicates

Sometimes matchers can be used as predicates in standard algorithms by wrapping with `Matches()`.

```cpp
const int count = std::count_if(vec.begin(), vec.end(), Matches(Gt(10)));
```


---

## 3. Practical Examples

### 3.1 Using `EXPECT_THAT` With Matchers

```cpp
EXPECT_THAT(value, Ge(10));  // Asserts value >= 10
EXPECT_THAT(name, StartsWith("Test"));
EXPECT_THAT(ptr, NotNull());
```

### 3.2 Verifying Calls With Matchers in Mocks

```cpp
using ::testing::_;
using ::testing::Return;

EXPECT_CALL(mock_turtle, Forward(Ge(100)))
    .WillOnce(Return());
EXPECT_CALL(mock_turtle, GoTo(_, _))
    .Times(2)
    .WillRepeatedly(Return());
```

### 3.3 Matching Container Contents

```cpp
std::vector<int> v = {1, 2, 3};
EXPECT_THAT(v, ElementsAre(1, 2, 3));
EXPECT_THAT(v, UnorderedElementsAre(3, 1, 2));
```

### 3.4 Custom Matcher Example

```cpp
MATCHER_P(IsMultipleOf, n, "checks if number is multiple of n") {
  return (arg % n) == 0;
}

EXPECT_THAT(12, IsMultipleOf(3));
EXPECT_THAT(10, Not(IsMultipleOf(3)));
```


---

## 4. Troubleshooting & Best Practices

### 4.1 Common Issues

- **False negatives in floating point comparisons**: Use `EXPECT_FLOAT_EQ` or `EXPECT_NEAR` instead of `EXPECT_EQ`.
- **Strings comparing pointer address, not content**: Use `EXPECT_STREQ` or `EXPECT_THAT` with `StrEq` matcher.
- **Matchers not matching expected arguments**: Use `--gmock_verbose=info` for detailed call matching logs.
- **Uninteresting call warnings or errors with mocks**: Use `NiceMock` to suppress warnings or add catch-all expectations via `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`

### 4.2 Best Practices

- Prefer `EXPECT_` to allow tests to continue unless a failure blocks further meaningful progress.
- Use matchers only to express constraints you care about; avoid over-specification to reduce brittle tests.
- Use `ON_CALL` to set default mock behaviors and reserve `EXPECT_CALL` to specify verifiable expectations.
- Use sequences (`InSequence`, `Sequence`) to enforce call ordering when critical.
- Avoid mocking non-virtual or free functions; refactor code to use interfaces.
- Write custom matchers when reusable logic is needed for clarity and maintainability.

### 4.3 Performance Considerations

- Define mock class constructors and destructors in `.cc` files to improve compile times when mocks are heavily used.
- Share reusable matchers and actions by assigning them to variables instead of recreating them.

---

## 5. Next Steps & Related Content

- Explore [Mocking Basics: Using GoogleMock](../mocking-and-advanced-techniques/mocking-basics) to combine matchers and mocks effectively.
- Learn detailed assertion techniques in [Assertions and Expectations](../core-testing-apis/assertions-and-expectations).
- Learn to write your first test with assertions in [Writing Your First Test](../../getting-started/first-steps-usage/writing-your-first-test).
- Review [Matchers Reference](../reference/matchers) and [Mocking Reference](../reference/mocking) for deeper understanding.

---

## 6. Useful Links

- GoogleTest GitHub repository: https://github.com/google/googletest
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Beginner's guide to mocking.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Recipes and advanced usage.
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) - Getting started with assertions.

---

With this guidance, you are equipped to leverage assertions and matchers for clear, maintainable, and robust tests that pinpoint failures accurately and express intent clearly.