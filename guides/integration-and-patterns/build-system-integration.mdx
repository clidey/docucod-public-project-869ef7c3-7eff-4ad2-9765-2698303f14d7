---
title: "Integrating with Build Systems"
description: "Step-by-step instructions for setting up GoogleTest and GoogleMock with popular C++ build systems like CMake and Bazel. Ensures new and existing projects can easily adopt best-in-class testing with minimal friction."
---

# Integrating with Build Systems

GoogleTest and GoogleMock are designed to seamlessly integrate with popular C++ build systems such as CMake and Bazel. This guide takes you through practical, step-by-step instructions to set up these frameworks in new or existing projects, so you can automate your testing pipeline with minimal friction and maximum reliability.

---

## Workflow Overview

- **Task Description**: Configure GoogleTest and GoogleMock in your C++ project's build environment to enable easy compilation, linking, and test execution.
- **Prerequisites**:
  - Basic familiarity with your build system (CMake or Bazel).
  - GoogleTest and GoogleMock source code or installed packages.
  - A C++17 compatible compiler and toolchain.
  - Knowledge of your project's existing build configuration.
- **Expected Outcome**:
  - GoogleTest and GoogleMock correctly integrated.
  - Tests can be built and run through your build system.
  - Minimized manual setup and streamlined automation.
- **Time Estimate**: 15 to 45 minutes depending on existing setup and experience.
- **Difficulty Level**: Intermediate (some experience with build systems required).

---

## Step-by-Step Instructions

### 1. Integrating GoogleTest and GoogleMock with CMake

GoogleTest provides native CMake build scripts to facilitate smooth integration.

#### a. Standalone Build or Adding as a Subdirectory

- If you want to build GoogleTest and GoogleMock alongside your project, consider adding them as a subdirectory.

```cmake
add_subdirectory(path/to/googletest)
```

- This approach ensures you use the same compiler and linker settings across your project and test framework.

#### b. Using FetchContent to Automatically Download and Include

Add this snippet to your `CMakeLists.txt` to download GoogleTest at configure time:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Visual Studio runtime compatibility

FetchContent_MakeAvailable(googletest)

add_executable(your_test_executable test_main.cpp)
target_link_libraries(your_test_executable gtest_main gmock_main)
add_test(NAME your_test COMMAND your_test_executable)
```

- Replace `your_test_executable` and `test_main.cpp` with your actual target and test source.
- Note: CMake 3.14+ is required for `FetchContent_MakeAvailable()`.

#### c. Linking Against Installed GoogleTest

If you have installed GoogleTest on your system, use `find_package`:

```cmake
find_package(GTest REQUIRED)

add_executable(your_test_executable test_main.cpp)
target_link_libraries(your_test_executable GTest::gtest_main GTest::gmock_main)
add_test(NAME your_test COMMAND your_test_executable)
```

- Ensure your CMake environment is aware of GoogleTest’s installation path.

#### d. Compiler and Language Standards

- GoogleTest requires C++17 or later. Confirm your project sets this in `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- Adjust compiler flags or environment if needed.

#### e. Verifying the Build

- Generate build files with `cmake ..` in your build directory.
- Build with `make` or your IDE's build system.
- Run tests with `ctest` or directly execute test binaries.

---

### 2. Integrating GoogleTest and GoogleMock with Bazel

Bazel users can integrate GoogleTest and GoogleMock by referencing the repositories and configuring `BUILD` files.

#### a. Adding GoogleTest as an External Repository

In your `WORKSPACE` file, add:

```bazel
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.zip"],
    strip_prefix = "googletest-release-1.17.0",
    sha256 = "<sha256sum>",
)
```

- Replace `<sha256sum>` with the checksum of the archive.

#### b. Declaring Dependencies in BUILD files

In your test `BUILD` file:

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"],
)
```

- This sets up the test target, linking to GoogleTest and GoogleMock libraries.

#### c. Running Tests

- Use `bazel test //path/to:my_test` to build and execute your tests.

---

### 3. Writing Your Custom `main()` (Optional)

- When you need custom initialization or behavior, write your own `main()`:

```c++
#include "gtest/gtest.h"
#include "gmock/gmock.h"

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv); // Initializes both GoogleTest and GoogleMock
  return RUN_ALL_TESTS();
}
```

- Otherwise, link against `gtest_main` or `gmock_main` to use the default `main()`.

---

## Practical Tips & Best Practices

- Use the `gmock_main` library when possible; it provides a `main()` that auto-initializes GoogleMock and GoogleTest.
- Always use `testing::InitGoogleMock()` before calling `RUN_ALL_TESTS()`. This ensures command line flags for both testing frameworks are parsed correctly.
- For Visual Studio users, set `gtest_force_shared_crt` to ON to avoid runtime mismatches.
- Organize your test files into appropriate test suites and fixtures to maximize reuse and maintainability.
- Use CMake's `add_test()` to let CTest discover your tests for integration with CI.
- If you encounter linking issues, verify that the include directories and link libraries for GoogleTest and GoogleMock are correctly set up.

---

## Troubleshooting

<AccordionGroup title="Common Integration Issues and Solutions">
<Accordion title="Build Errors Related to Missing Headers or Libraries">
**Symptoms:** Compiler complains about missing `gtest/gtest.h` or `gmock/gmock.h`.

**Solution:**
- Check that your include directories include the GoogleTest and GoogleMock source or installed include folders.
- If using CMake’s FetchContent, ensure the `FetchContent_MakeAvailable()` call has successfully run.
- For installed packages, confirm `find_package(GTest)` succeeded.
- Verify that `target_link_libraries` properly references `gtest`, `gtest_main`, `gmock`, or `gmock_main`.
</Accordion>
<Accordion title="Linker Errors Involving GoogleTest Symbols">
**Symptoms:** Undefined references to GoogleTest or GoogleMock symbols during linking.

**Solution:**
- Confirm your test executable links against the appropriate libraries: `gtest`, `gtest_main`, `gmock`, or `gmock_main`.
- Check build order and dependencies.
- For static vs shared library conflicts in Visual Studio, enable `gtest_force_shared_crt` in CMake.
</Accordion>
<Accordion title="Tests Not Running or No Tests Found">
**Symptoms:** Running tests shows "0 tests" discovered.

**Solution:**
- Verify that your test files define tests using `TEST()` or `TEST_F()` macros.
- Ensure the test executable is correctly registered via `add_test()` in CMake or `cc_test` in Bazel.
- Confirm you call `RUN_ALL_TESTS()` in your `main()` or use `gtest_main`/`gmock_main`.
- Check if any compilation defines disable test discovery or exclude tests.
</Accordion>
<Accordion title="Visual Studio Runtime Library Mismatch">
**Symptoms:** Linker errors about mismatched runtime libraries.

**Solution:**
- Enable the CMake option `gtest_force_shared_crt`:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
- This aligns runtime libraries between your project and the GoogleTest binaries.
</Accordion>
</AccordionGroup>

---

## Next Steps & Related Content

- Explore [Writing Your First Test](/getting-started/first-steps/create-first-test) to learn how to create actual test cases after integration.
- Consult [Initial Configuration](/getting-started/setup-overview/configuration-setup) for advanced build configuration tasks.
- Visit [Common Setup Issues & Solutions](/getting-started/troubleshooting-and-validation/common-issues) for details on resolving typical integration problems.
- Review the [Integration & Ecosystem Overview](/overview/features-integration/integration-ecosystem) to understand CI and other build system integrations.

---

## Further Reading & Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- Official GoogleTest GitHub repository: [https://github.com/google/googletest](https://github.com/google/googletest)

---

This guide ensures you set up GoogleTest and GoogleMock with key C++ build systems confidently and reliably, paving the way for robust automated testing in your development workflow.
