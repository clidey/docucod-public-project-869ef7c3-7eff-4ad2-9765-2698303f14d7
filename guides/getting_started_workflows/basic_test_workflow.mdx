---
title: "Writing and Running Tests"
description: "A comprehensive guide to creating test cases, using essential assertions, and running your tests. Focuses on test structure, assertion macros, discovery, execution, and interpreting results with practical examples."
---

# Writing and Running Tests

A comprehensive guide to creating test cases, using essential assertions, and running your tests. This document focuses specifically on test structure, assertion macros, test discovery, execution, and interpreting results with practical examples.

---

## 1. Understanding the Testing Workflow

### What This Guide Helps You Accomplish

This guide walks you through the fundamental steps of writing GoogleTest tests, creating test fixtures, asserting expected behaviors, and running your test suite to validate your C++ code. It enables you to structure tests efficiently, handle different testing needs including parameterized and typed tests, and interpret the outcomes effectively.

### Prerequisites

- Basic knowledge of C++ programming
- GoogleTest installed and linked in your development environment
- Familiarity with your development environment's build and execution tools

### Expected Outcome

Following this guide, you will be able to:

- Write simple and fixture-based tests
- Use different assertion macros to verify behavior
- Structure tests logically in suites
- Utilize parameterized and typed tests for coverage
- Run tests and understand their results

### Time Estimate

Approximately 20-30 minutes to read and practice

### Difficulty Level

Beginner to Intermediate

---

## 2. Creating Tests in GoogleTest

### 2.1 Writing Simple Tests with `TEST()`

GoogleTest's simplest form of test is created using the `TEST()` macro. It defines an individual test function.

**How to write:**

```cpp
TEST(TestSuiteName, TestName) {
  // Your test code goes here
  EXPECT_EQ(FunctionUnderTest(), expected_value);
}
```

- `TestSuiteName` groups related tests.
- `TestName` identifies the specific test.

#### Example:

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(3), 6);
}
```

**What to expect:** Each test runs independently, and your assertions determine success or failure.


### 2.2 Using Test Fixtures with `TEST_F()`

If multiple tests share common data or setup logic, define a *test fixture* class by inheriting from `testing::Test`. Use `TEST_F()` to create tests using this fixture.

**Steps to create a fixture:**

1. Define a fixture class:

```cpp
class QueueTest : public testing::Test {
 protected:
  void SetUp() override {
    // Initialize objects
    q1_.Enqueue(1);
  }
  Queue<int> q0_;
  Queue<int> q1_;
};
```

2. Write tests using the fixture:

```cpp
TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, EnqueueWorks) {
  EXPECT_EQ(q1_.size(), 1);
}
```

**Benefits:**

- Shared setup and teardown for multiple tests
- Cleaner, maintainable test code
- Each test still runs independently with a fresh fixture instance

---

## 3. Using Assertions Effectively

GoogleTest provides two kinds of assertions:

- **`ASSERT_*`** macros, which generate *fatal failures* and abort the current function immediately.
- **`EXPECT_*`** macros, which generate *nonfatal failures* and let the function continue.

### Choosing Assertions

- Use `ASSERT_*` when subsequent test code cannot sensibly run after a failure.
- Use `EXPECT_*` to continue checking multiple conditions, revealing more failures.

### Basic Assert Examples

```cpp
ASSERT_EQ(x, y) << "x and y must be equal";
EXPECT_TRUE(CheckCondition()) << "Condition failed";
```

### Advanced Assertions

- Compare floating-point values with `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`.
- Check string equality with `EXPECT_STREQ` or `EXPECT_STRCASEEQ`.
- Use predicate assertions or custom failure messages for complex conditions (see Advanced Assertions Guide).

### Logging Additional Test Properties

You can record custom key-value information during tests for XML output by using:

```cpp
testing::Test::RecordProperty("KeyName", "Value");
```

This data integrates into reports for deeper inspection.

---

## 4. Running Your Tests

### Writing a `main()` Function

Typically, linking with `gtest_main` provides a ready-to-use main function.

If you need a custom `main()`, perform initialization as follows:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- Always call `InitGoogleTest()` before running tests.
- `RUN_ALL_TESTS()` will run all registered tests and return 0 on success.

### Command Line Flags

When running test executables, control behavior with flags:

- `--gtest_filter=TestSuite.TestName` to run subsets
- `--gtest_repeat=N` to run tests repeatedly
- `--gtest_shuffle` to randomize test order
- `--gtest_fail_fast` to stop at first failure
- `--gtest_list_tests` to list tests without running

### Environment Variables

GoogleTest flags can also be set via environment variables prefixed with `GTEST_`.

### Skipping and Disabling Tests

- Prefix test or suite names with `DISABLED_` to temporarily exclude tests.
- Use `GTEST_SKIP()` in test code to skip tests at runtime.

---

## 5. Expanding Your Testing: Parameterized and Typed Tests

### 5.1 Value-Parameterized Tests with `TEST_P` and `INSTANTIATE_TEST_SUITE_P`

Test the same logic with multiple input values without duplicating code.

**Steps:**

1. Create a fixture deriving from `testing::TestWithParam<T>`:

```cpp
class MyTest : public testing::TestWithParam<int> {};
```

2. Define tests with `TEST_P`:

```cpp
TEST_P(MyTest, HandlesInput) {
  EXPECT_GT(GetParam(), 0);
}
```

3. Instantiate with values:

```cpp
INSTANTIATE_TEST_SUITE_P(PositiveInts, MyTest, testing::Values(1, 2, 3));
```

**What you get:** Test names include parameter indices and values for easier identification.

### 5.2 Typed Tests with `TYPED_TEST_SUITE` and `TYPED_TEST`

Run the same test logic across multiple types.

**Steps:**

1. Define a fixture template:

```cpp
template <typename T>
class MyTypedTest : public testing::Test {
 public:
  T value_;
};
```

2. Associate types:

```cpp
using Types = testing::Types<int, double>;
TYPED_TEST_SUITE(MyTypedTest, Types);
```

3. Write tests:

```cpp
TYPED_TEST(MyTypedTest, TestIsDefaultConstructed) {
  EXPECT_EQ(this->value_, TypeParam());
}
```

This approach scales tests efficiently when verifying template classes or type variants.

### 5.3 Type-Parameterized Tests with `TYPED_TEST_SUITE_P` and `TYPED_TEST_P`

Define abstract test patterns decoupled from actual type lists. Then register and instantiate later.

Use this when test definitions are shared but type lists are defined separately.

---

## 6. Handling Special Testing Requirements

### Skipping Tests at Runtime

Insert `GTEST_SKIP() << "reason";` in test functions or `SetUp` methods to skip them dynamically.

### Testing Death Conditions

Use special death-test macros (`ASSERT_DEATH`, `EXPECT_DEATH`) to verify that code aborts appropriately.

### Adding Traces to Improve Failure Diagnosis

Use `SCOPED_TRACE(message);` to add context that will be included with any assertions failing within that scope.

### Catching Failures in Helpers

To halt test execution on fatal failures inside helper functions, use:

```cpp
ASSERT_NO_FATAL_FAILURE(helper_function());
if (HasFatalFailure()) return;
```

---

## 7. Troubleshooting Common Issues

- Ensure test names in `TEST()` do not contain underscores `_`.
- Use the correct macro (`TEST()` vs `TEST_F()`) based on whether you have a fixture.
- Verify that `InitGoogleTest()` is called before `RUN_ALL_TESTS()`.
- Watch for disabled tests and understand they don't run unless explicitly enabled.
- Check your test filter patterns carefully if some tests are not running.

---

## 8. Next Steps & Resources

- Explore [GoogleTest Primer](primer.md) for a detailed introduction.
- Visit [Advanced GoogleTest Topics](advanced.md) to deepen your skills.
- Learn about parameterized and typed tests in the [Parameterized & Typed Tests](reference/testing.md#TEST_P) documentation.
- Use [gMock for mocking dependencies](guides/getting_started_workflows/using_mocks_and_matchers) when your tests require mocks.
- Study [Test Event Listeners](reference/testing.md#TestEventListener) for custom test reporting.

---

## Appendix: Minimal Example

```cpp
#include <gtest/gtest.h>

int Factorial(int n) {
  return n <= 1 ? 1 : n * Factorial(n - 1);
}

// Simple Test
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

// Test Fixture
class QueueTest : public testing::Test {
 protected:
  std::queue<int> q_;
  void SetUp() override {
    q_.push(1);
  }
};

TEST_F(QueueTest, NotEmptyInitially) {
  EXPECT_FALSE(q_.empty());
  EXPECT_EQ(q_.front(), 1);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This example shows a basic test, a fixture-based test, and a minimal `main` function to run tests.

---

