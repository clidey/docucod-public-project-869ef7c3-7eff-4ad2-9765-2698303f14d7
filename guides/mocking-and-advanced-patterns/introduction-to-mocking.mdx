---
title: "Introduction to Mocking"
description: "Step-by-step instructions on creating mock classes, defining mocked methods, and using them to isolate units under test. Includes common terminology and rationale behind mocking in C++."
---

# Introduction to Mocking

This guide walks you through creating mock classes in C++, defining mocked methods, and using them to isolate units under test. You will learn the rationale behind mocking, common terminology, and step-by-step instructions for effective mock usage with GoogleTest's gMock framework.

---

## 1. Understanding Mocking

Mocking is a powerful technique used in unit testing to simulate dependencies of the unit being tested. A **mock object** behaves like the real object it replaces but allows you to:

- Specify expectations on how methods should be called.
- Control the behavior of these methods.
- Isolate the unit under test from complex or unavailable external components.

For example, in a graphics program, you might replace a real drawing turtle with a `MockTurtle` to verify that the program calls the right drawing methods with correct arguments without needing graphical output.

### Why Mock?

- Avoid dependence on slow, unreliable, or unavailable components (DBs, network, hardware).
- Detect unexpected interactions early by specifying expected calls.
- Test error handling by simulating failure scenarios.
- Enable agile design by experimenting with interfaces and dependencies.

---

## 2. Creating Mock Classes

The core of mocking in gMock is the ability to easily define mock classes that override interfaces or base classes.

### Step 1: Include gMock

Always start by including gMock headers:

```cpp
#include <gmock/gmock.h>
```

### Step 2: Define Your Mock Class

- Derive from the interface or base class you want to mock.
- Use the `MOCK_METHOD` macro in the public section to declare mocked methods.

### MOCK_METHOD Syntax

```cpp
MOCK_METHOD(return_type, method_name, (args...), (qualifiers));
```

- `return_type`: Return type of the method.
- `method_name`: Name of the method.
- `args...`: Parenthesized argument list.
- `qualifiers`: Optional parentheses including qualifiers like `const`, `override`, `noexcept`, etc.

### Handling Commas in Types

If the return type or argument types contain commas (e.g., templates like `std::pair<int,int>`), wrap the type in parentheses or use a `using` alias:

```cpp
using BoolAndInt = std::pair<bool, int>;

class MockFoo {
 public:
  MOCK_METHOD((BoolAndInt), GetPair, ());
};
```

### Example: Mocking an Interface

Suppose you have an interface:

```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};
```

You can define the mock class:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

---

## 3. Using Mocks in Tests

### Workflow

1. Import necessary gMock symbols (e.g., `using ::testing::_;`, `::testing::Return;`).
2. Create the mock object.
3. Optionally, set default behavior with `ON_CALL`.
4. Define expectations on calls using `EXPECT_CALL`.
5. Exercise the code under test.
6. gMock automatically verifies expectations on mock destruction.

### Example

```cpp
using ::testing::Return;
using ::testing::_;

TEST(MyTest, UsesMock) {
  MockFoo mock;

  // #3 Set default behavior (called if no EXPECT_CALL matches)
  ON_CALL(mock, GetSize()).WillByDefault(Return(42));

  // #4 Set expectations
  EXPECT_CALL(mock, Describe("test"))
      .Times(1)
      .WillOnce(Return("mocked"));

  // #5 Code under test
  std::string description = mock.Describe("test");
  EXPECT_EQ(description, "mocked");
}
```

---

## 4. Expectations in Detail

### EXPECT_CALL

- Sets expectations that a mocked method is called with certain arguments.
- Syntax:

```cpp
EXPECT_CALL(mock_object, Method(matchers...))
  .Times(cardinality)
  .WillOnce(action)
  .WillRepeatedly(action);
```

- If `Times()` is omitted, gMock infers it based on `WillOnce`/`WillRepeatedly` use.

### Matchers

- Use `_` to match any value in an argument.
- Use specific matchers like `Eq(value)`, `Ge(value)`, or custom matchers to specify argument constraints.

### Actions

- Define what the mock method does when called.
- Common actions:
  - `Return(value)` — returns a value.
  - `ReturnRef(variable)` — returns a reference.
  - `Invoke(func)` — invokes a function or lambda.
  - `DoAll(...)` — combines multiple side effects.

### Times (Cardinality)

| Cardinality      | Meaning                           |
|------------------|---------------------------------|
| `Exactly(n)` or `n` | Exactly n calls expected.       |
| `AtLeast(n)`     | At least n calls expected.       |
| `AtMost(n)`      | At most n calls allowed.          |
| `AnyNumber()`    | Any number of calls allowed.      |

---

## 5. Mock Object Strictness Modifiers

gMock provides three wrappers to control behavior on uninteresting calls (calls without expectations):

| Modifier       | Behavior                                                               |
|----------------|------------------------------------------------------------------------|
| `NiceMock<T>`  | Suppresses warnings on uninteresting calls. Ideal when you want cleaner test output.
| `NaggyMock<T>` | Default behavior: warns on uninteresting calls.
| `StrictMock<T>`| Treats uninteresting calls as failures. Strictest mode for tight control.

### Example

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> mock;
EXPECT_CALL(mock, DoThis());
mock.DoThis();  // No warning on other calls.
```

### Notes

- These wrap your mock class and "inherit" its constructors.
- Only affect uninteresting calls, not unexpected calls (calls that do not match any expectation but are to a method with expectations).
- Only affect mock methods defined directly with `MOCK_METHOD` in the base mock class (not in base classes).
- Require that the mock class destructor is virtual for correct behavior.

---

## 6. Delegating Behavior

Sometimes you want your mock methods to delegate to:

- A real object (to use production behavior with verification).
- A fake implementation (to reuse complex fake logic).
- The parent class’s implementation (for non-pure virtual methods).

This is done by setting default actions in `ON_CALL()` or expectations in `EXPECT_CALL()` that invoke the delegate method.

Example:

```cpp
ON_CALL(mock, DoWork).WillByDefault([&real](int x) {
  return real.DoWork(x);
});
```

---

## 7. Best Practices & Tips

- Always declare mock methods **public**, even if the base method is `protected` or `private`.
- Use `override` qualifier in `MOCK_METHOD` to catch mismatches.
- Wrap types with commas in parentheses or use type aliases.
- Use `NiceMock` during early test development to reduce noise.
- Use `StrictMock` when you want to enforce no calls outside expectations.
- Set expectations **before** exercising the code under test.
- Use sequences (`InSequence`) to enforce call order.
- Prefer `ON_CALL` for default behavior; only use `EXPECT_CALL` for calls you intend to verify.

---

## 8. Troubleshooting Common Mocking Issues

<AccordionGroup title="Common Mocking Issues">
<Accordion title="Compiler Errors with MOCK_METHOD Macro">
If your `MOCK_METHOD` fails to compile due to commas in types, wrap the type in parentheses or create a `using` alias. See the example in Section 2.
</Accordion>
<Accordion title="Uninteresting Call Warnings">
If you see warnings about uninteresting calls, either suppress with `NiceMock` or explicitly add an `EXPECT_CALL(...).Times(AnyNumber())` for the method.
</Accordion>
<Accordion title="Mismatch in Expectations">
Run tests with `--gmock_verbose=info` to trace mock calls and diagnostics.
</Accordion>
<Accordion title="Mock Destructors Cannot be Mocked Directly">
Mock destructor calls by adding a `MOCK_METHOD(void, Die, ());` and invoke it inside the destructor.
</Accordion>
</AccordionGroup>

---

## 9. Additional Resources

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Beginner-friendly tutorial.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) - Detailed API reference.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Practical recipes.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) - Quick syntax guide.
- [Using Assertions Effectively](https://google.github.io/googletest/guides/core-testing-workflows/using-assertions-effectively.html) - To combine assertions and mocks effectively.


---

# Summary

This guide presents step-by-step instructions for writing and using mock classes with GoogleTest's gMock, focusing on defining mock methods, setting expectations, and controlling mock object behavior for effective unit test isolation. It covers the use of `MOCK_METHOD`, common issues with types, setting up expectations with `EXPECT_CALL`, default behaviors using `ON_CALL`, and controlling mocking strictness with `NiceMock`, `NaggyMock`, and `StrictMock`.

Key sections include:
- Understanding and rationale for mocking
- Creating mock classes with `MOCK_METHOD`
- Using mocks in tests with `EXPECT_CALL` and `ON_CALL`
- Strictness modifiers for mocks
- Delegating behavior to fakes or real objects
- Best practices, tips, and troubleshooting

For deep dives and additional techniques, users should explore the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html), [Mocking Reference](https://google.github.io/googletest/reference/mocking.html), and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

Cross-reference this page with other onboarding guides like **Writing Your First Test**, **Using Assertions Effectively**, and **Troubleshooting Common Getting Started Issues** for a complete testing workflow.

Next steps: proceed to creating expectations with real test cases, learn advanced matchers, and explore partial mocks or delegations to real objects to build comprehensive and maintainable unit tests.