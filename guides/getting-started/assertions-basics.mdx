---
title: "Making Assertions: Core and Custom"
description: "Explore Google's rich set of test assertions (equality, inequality, fatal vs non-fatal) and learn how to create your own user-defined assertions for precise, expressive validation. Real-life examples illustrate best practices for utilizing and extending assertion matchers."
---

# Making Assertions: Core and Custom

## Overview

This guide helps you master the art of making assertions in GoogleTest to verify program behavior thoroughly and reliably. You will learn the essentials of built-in assertions, their differences, and how to craft your own custom assertions for more expressive and precise validations tailored to your needs.

### Prerequisites

- Basic knowledge of GoogleTest syntax and test structure
- Familiarity with C++
- `gtest/gtest.h` included in your test source files

### Expected Outcome

After completing this guide, you will confidently make assertions that catch errors accurately, understand when to use fatal vs non-fatal assertions, and create your own custom assertions to maximize test clarity.

### Time Estimate

Approximately 15-20 minutes

### Difficulty Level

Beginner to Intermediate

---

## 1. Core Assertions: What You Can Do Out of the Box

GoogleTest provides a comprehensive set of assertion macros that cover most common validation needs in unit tests.

### 1.1 Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Verifies a condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Verifies a condition is false.

Use `ASSERT_*` forms when failure should abort the current test function immediately.

### 1.2 Equality and Relational Comparisons

GoogleTest offers comparison assertions to check values for equality, inequality, and relational comparisons:

| Assertion     | Description                        |
| ------------- | ---------------------------------|
| `EXPECT_EQ(val1, val2)` | Checks `val1 == val2`            |
| `EXPECT_NE(val1, val2)` | Checks `val1 != val2`            |
| `EXPECT_LT(val1, val2)` | Checks `val1 < val2`             |
| `EXPECT_LE(val1, val2)` | Checks `val1 <= val2`            |
| `EXPECT_GT(val1, val2)` | Checks `val1 > val2`             |
| `EXPECT_GE(val1, val2)` | Checks `val1 >= val2`            |

Each also has an `ASSERT_` variant that aborts on failure.

### 1.3 String Comparisons

For comparing C strings (`const char*`), use:

- `EXPECT_STREQ(str1, str2)`: Checks if two C strings have the same content.
- `EXPECT_STRNE(str1, str2)`: Checks if two C strings differ.
- Case-insensitive variants:
  - `EXPECT_STRCASEEQ(str1, str2)`
  - `EXPECT_STRCASENE(str1, str2)`

**Tip:** For `std::string`, use `EXPECT_EQ` or `EXPECT_TRUE(str1 == str2)`.

### 1.4 Floating-Point Comparisons

Due to rounding, exact comparisons on floats/doubles are unreliable. GoogleTest provides:

- `EXPECT_FLOAT_EQ(val1, val2)`: Approximate equality for `float` values within 4 ULPs
- `EXPECT_DOUBLE_EQ(val1, val2)`: Same for `double`
- `EXPECT_NEAR(val1, val2, abs_error)`: Checks difference within a user-defined threshold

### 1.5 Explicit Success or Failure

- `SUCCEED()`: Records a successful assertion. Useful for documenting code paths.
- `FAIL()`: Records a fatal failure, aborting the current test. Use to mark unreachable code or test failure conditions.
- `ADD_FAILURE()`: Records a non-fatal failure, continues executing.


## 2. Writing and Using Custom User-Defined Assertions

When built-in assertions don’t quite fit your needs—for example, when complex logic or composite checks are involved—you can create custom assertions.

### 2.1 Defining a Custom Predicate Assertion

Define a function or functor returning `bool` to check your condition.

Example: Check that two integers are mutually prime (no shared divisors other than 1):

```cpp
bool MutuallyPrime(int m, int n) {
  // Implementation omitted; returns true if m and n are coprime.
}

// Test usage
EXPECT_PRED2(MutuallyPrime, 3, 4);  // Passes if 3 and 4 are mutually prime.
```

### 2.2 Using Assertion Macros for Predicates

GoogleTest offers predicate assertion macros:

- `EXPECT_PRED1(pred, val1)`
- `EXPECT_PRED2(pred, val1, val2)`
- `EXPECT_PRED_FORMATn`: Allows definition of detailed failure messages (see below).

Use these to run your predicate with provided values.

### 2.3 Providing Rich Failure Messages with Predicate-Formatters

To give customized failure messages, write a predicate-formatter function returning `testing::AssertionResult`:

```cpp
::testing::AssertionResult AssertMutuallyPrime(const char* expr1,
                                              const char* expr2,
                                              int m, int n) {
  if (MutuallyPrime(m, n))
    return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << expr1 << " and " << expr2
                                     << " (" << m << " and " << n
                                     << ") are not mutually prime";
}

// Then in tests:
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

This integration allows GoogleTest to display exactly why the assertion failed.

## 3. Best Practices and Tips for Assertions

- Use `EXPECT_*` when you want the test to continue after a failure, allowing multiple failures to be reported.
- Use `ASSERT_*` when a failed assertion should abort the test function immediately (e.g., when subsequent code relies on the assertion).
- Prefer `EXPECT_THAT` with matchers when you want expressive and flexible assertions (see [Matchers Reference](reference/matchers.md)).
- Stream custom failure messages using the `<<` operator to improve debugging.
- Avoid side effects inside assertion macros since arguments might be evaluated multiple times or not at all.

## 4. Examples

### 4.1 Basic Equality Check

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1) << "Factorial of zero should be 1";
}
```

### 4.2 Using a Custom Predicate

```cpp
bool IsDivisibleBy7(int n) { return n % 7 == 0; }

TEST(PrimeTest, DivisibleBy7) {
  EXPECT_PRED1(IsDivisibleBy7, 21);
  EXPECT_PRED1(IsDivisibleBy7, 20) << "20 is not divisible by 7";
}
```

### 4.3 Custom Predicate-Formatter for Clear Messages

```cpp
::testing::AssertionResult IsInRange(const char* expr, int val, int low, int high) {
  if (val >= low && val <= high)
    return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << expr << " is not in range ["
                                     << low << ", " << high << "]";
}

TEST(RangeTest, ValueCheck) {
  int x = 10;
  EXPECT_PRED_FORMAT3(IsInRange, x, 1, 5);
}
```

This prints a descriptive message pinpointing why the test failed.

## 5. Troubleshooting & Tips

- **Assertion macro usage errors:** Ensure you use `EXPECT_*` and `ASSERT_*` macros properly with streaming operators for custom messages.
- **Overly strict assertions:** Avoid specifying exact argument values unless necessary. Use matchers to allow flexibility and maintain test durability.
- **Custom assertion failures unclear:** Use `AssertionResult` and predicate-formatters for richer messages.
- **Remember Test Flow:** `EXPECT_*` failures allow the test to continue, while `ASSERT_*` abort immediately.

## 6. Next Steps & Related Resources

- [GoogleTest Primer](overview/introduction-getting-started/what-is-googletest) — understand the core testing framework
- [Matchers Reference](reference/matcher-actions/matcher-reference) — write expressive assertions
- [gMock Cookbook](docs/gmock_cook_book.md) — advanced mocking and assertion techniques
- [Writing and Running Your First Test](getting-started/gs-configuration-first-test/gs-first-test) — fast practical onboarding


---

## Summary

This guide has empowered you with practical knowledge on GoogleTest's assertion macros, covering core built-in assertions, the critical difference between `EXPECT_` and `ASSERT_`, floating-point and string comparisons, and the art of writing custom predicate assertions for enhanced expressiveness and debugging clarity. Through concrete examples and recommended best practices, you are equipped to write robust, maintainable tests.

### Key Documentation Sections Covered:
- Core Assertion Macros
- Custom Predicate Assertions
- Writing Predicate-Formatter Functions
- Best Practices and Common Pitfalls
- Real-World Examples

### Important Links and References:
- [GoogleTest Primer](overview/introduction-getting-started/what-is-googletest)
- [Matchers Reference](reference/matcher-actions/matcher-reference)
- [gMock Cookbook](docs/gmock_cook_book.md) (for mocking)
- [Writing and Running Your First Test](getting-started/gs-configuration-first-test/gs-first-test)

### Cross-References:
- For mock-related assertions and interaction verification, see the Mocking Reference and gMock documentation.
- For integrating assertions with mock expectations, consult the GoogleMock guides.

### Action Items:
- Begin using built-in assertions immediately in your tests
- Practice crafting simple custom predicate assertions
- Explore GoogleTest matchers to refine your assertions
- Review related mocking workflows to combine with assertions effectively
