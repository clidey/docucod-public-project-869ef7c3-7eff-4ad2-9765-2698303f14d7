---
title: "Quickstart with CMake"
description: "A complete walkthrough for integrating GoogleTest and GoogleMock into a CMake-based project, covering installation, configuration, and first test execution for modern C++ workflows."
---

# Quickstart with CMake

This guide will help you quickly integrate GoogleTest and GoogleMock into a modern C++ project built with CMake. You will learn how to configure your project, install necessary dependencies, write your first test, and run it using CMake's testing framework.

---

## What You'll Achieve

- Add GoogleTest and GoogleMock to your CMake project with minimal setup
- Write and run your first test executable using GoogleTest
- Understand how GoogleMock is included and linked with your tests


## Prerequisites

Before you start, ensure you have the following:

- A supported operating system: Linux, macOS, or Windows
- A C++ compiler supporting at least C++17 (e.g., GCC, Clang, MSVC)
- [CMake](https://cmake.org/) version 3.14 or above
- A compatible build tool such as Make or Ninja

> **Note:** The examples use Unix-like shell commands but are fully compatible with Windows command line or PowerShell.

---

## Step 1: Create Your Project Directory

Open your terminal and execute:

```bash
mkdir my_project && cd my_project
```

This creates your project folder and switches into it.

---

## Step 2: Write Your `CMakeLists.txt` to Fetch GoogleTest and GoogleMock

In your project directory, create a file named `CMakeLists.txt` with the following content:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Ensure at least C++17 is used
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows: match the compiler/runtime used in the parent project
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

# Enable testing functionality
enable_testing()

# Declare your test executable
add_executable(hello_test hello_test.cc)

# Link GoogleTest and GoogleMock main libraries
# gmock_main includes gtest, so only this is required for tests using mocks.
target_link_libraries(hello_test GTest::gtest_main GTest::gmock_main)

# Discover tests automatically
include(GoogleTest)
gtest_discover_tests(hello_test)
```

### Explanation

- **FetchContent** downloads GoogleTest and GoogleMock sources during CMake configuration.
- `gtest_force_shared_crt` ensures runtime matches on Windows to avoid linker errors.
- `enable_testing()` activates CMake's testing support.
- `hello_test` is your test executable, which you will create next.
- Links to `gtest_main` and `gmock_main` provided by GoogleTest CMake targets.
- Automatic test discovery enables CTest to run your tests.

---

## Step 3: Add a Sample Test Source File

Create a file named `hello_test.cc` in your project root with:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

// A simple test using GoogleTest
TEST(HelloTest, BasicAssertions) {
    // Verify two strings are not equal
    EXPECT_STRNE("hello", "world");
    // Verify an arithmetic computation
    EXPECT_EQ(7 * 6, 42);
}

// Example of using GoogleMock: define a mock class
class MockExample {
public:
    MOCK_METHOD(int, Compute, (int x), (const));
};

TEST(MockTest, SimpleMock) {
    MockExample mock;
    EXPECT_CALL(mock, Compute(5)).WillOnce(testing::Return(10));
    EXPECT_EQ(mock.Compute(5), 10);
}
```

This source demonstrates both basic GoogleTest assertions and a simple GoogleMock expectation.

---

## Step 4: Build Your Tests

Run the following commands from your project root:

```bash
cmake -S . -B build
cmake --build build
```

- The first command generates build files in the `build` directory.
- The second command builds your tests.

Expected output will show compilation steps and completion without errors.

---

## Step 5: Run Your Tests

Execute the tests with CTest by running:

```bash
cd build
ctest
```

You should see output similar to:

```
Test project /path/to/my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
```

This confirms your tests compiled and ran successfully.

---

## Tips and Best Practices

- **Update the Git commit hash** in `FetchContent_Declare` frequently to benefit from the latest fixes and features.
- **Use `gmock_main` target** when linking with GoogleMock to get the built-in test main function.
- **Set the C++ standard explicitly** to ensure modern language features and compatibility.
- On Windows, the `gtest_force_shared_crt` option avoids runtime conflicts—do not omit it.

---

## Troubleshooting

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Tests Not Found or Not Running">
- Ensure you called `enable_testing()` in your CMakeLists.txt.
- Verify `gtest_discover_tests()` is invoked after test binary target creation.
- Confirm that your test source files include `<gtest/gtest.h>` and define tests with `TEST()` or `TEST_F()`.
</Accordion>
<Accordion title="Linker Errors on Windows Related to CRT Runtimes">
- Make sure `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` is set before fetching GoogleTest.
- Align your project's runtime library setting with GoogleTest’s (dynamic vs static).
</Accordion>
<Accordion title="Compilation Fails Due to C++ Standard">
- Confirm compiler supports C++17.
- Explicitly set `set(CMAKE_CXX_STANDARD 17)` and `set(CMAKE_CXX_STANDARD_REQUIRED ON)`.
</Accordion>
</AccordionGroup>

---

## What Next?

- Explore the [GoogleTest Primer](primer.md) to learn how to write unit tests using the framework.
- Visit [Mocking Basics with GoogleMock](gmock_for_dummies.md) for deeper insight into mock object usage.
- Check out [Googletest Samples](samples.md) for additional example tests.
- Read the [Integrating with CI/CD Pipelines](integration-scenarios.md) guide for continuous integration practices.

---

Congratulations! You have successfully set up GoogleTest and GoogleMock in a CMake project and run your first test.


---

<Info>
This guide assumes a base familiarity with C++ and command-line interfaces. For detailed understanding of assertion macros, test fixtures, and advanced mocking features, refer to linked guides in the GoogleTest documentation.
</Info>