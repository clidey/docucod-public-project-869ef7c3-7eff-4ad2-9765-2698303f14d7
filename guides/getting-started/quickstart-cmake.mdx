---
title: "Quickstart with CMake"
description: "A step-by-step tutorial demonstrating how to set up GoogleTest and GoogleMock in a C++ project using CMake. Covers installation, project configuration, writing basic tests, and running them successfully."
---

# Quickstart with CMake

A practical step-by-step tutorial demonstrating how to set up GoogleTest and GoogleMock in a C++ project using CMake. This guide walks you through installation, project configuration, writing basic tests using GoogleTest and GoogleMock, and running them successfully.

---

## Workflow Overview

### Task Description
Learn how to integrate GoogleTest and GoogleMock into a C++ project that uses CMake for building. This guide covers downloading/building the libraries, configuring your project to link against them, writing simple unit tests and mocks, and running tests from the command line.

### Prerequisites
- You have CMake installed (version 3.14 or later recommended).
- Basic familiarity with C++ and the command line.
- A C++17 compatible compiler.
- A C++ project with a CMake build system.

### Expected Outcome
After completing this tutorial, you will have:
- GoogleTest and GoogleMock compiled and ready for use.
- Your project configured with CMake to compile and link tests using GoogleTest and GoogleMock.
- Written a basic test and mock class using GoogleTest and GoogleMock macros.
- Run tests successfully and verified the integration works end-to-end.

### Time Estimate
Approximately 20-40 minutes, depending on your environment setup and familiarity.

### Difficulty Level
Beginner to Intermediate

---

## Step-by-Step Instructions

### Step 1: Obtain GoogleTest/GoogleMock Source

1. Clone the GoogleTest repository (includes GoogleMock):

   ```bash
   git clone https://github.com/google/googletest.git -b main
   cd googletest
   ```

2. (Optional) To use a specific release version, replace `main` with a tag like `v1.17.0`.

### Step 2: Build GoogleTest and GoogleMock with CMake

1. Create a build directory:

   ```bash
   mkdir build
   cd build
   ```

2. Run CMake to generate build files for GoogleTest/GoogleMock:

   ```bash
   cmake ..
   ```

   > This generates platform-specific build scripts (Makefiles, Visual Studio projects, etc.) and includes GoogleMock by default.

3. Build the libraries:

   - On Unix/macOS:
     ```bash
     make
     ```

   - On Windows with Visual Studio:
     Open the generated solution, then build it.

### Step 3: (Optional) Install GoogleTest/GoogleMock

If you want the libraries and headers globally installed on your system for easy reuse:

```bash
sudo make install
```

The default install location is `/usr/local/` on Unix.

### Step 4: Integrate GoogleTest and GoogleMock into Your Own CMake Project

In your project's `CMakeLists.txt`, add the following lines:

```cmake
# Find installed GoogleTest package (if installed system-wide or via package manager)
find_package(GTest REQUIRED)

# Or add GoogleTest source directly (if you want to build it alongside your project)
# add_subdirectory(path/to/googletest)

enable_testing()

add_executable(my_tests
    test/my_test_file.cpp
)

# Link GoogleTest and GoogleMock to your test executable
target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock_main)

# Enable testing
add_test(NAME MyTests COMMAND my_tests)
```

> **Note:** If you included GoogleTest as a subdirectory rather than installed it, link against `gtest` and `gmock_main` accordingly.

### Step 5: Write a Basic Test Using GoogleTest

Create `test/my_test_file.cpp` with the following:

```cpp
#include <gtest/gtest.h>

// Simple test case
TEST(SampleTest, AdditionWorks) {
  EXPECT_EQ(2 + 2, 4);
}
```

### Step 6: Write a Mock Class and Test Using GoogleMock

Suppose you have the following interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

Define a mock class inheriting from it:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

Write a test using the mock:

```cpp
TEST(TurtleTest, MovingForwardCallsPen) {
  MockTurtle turtle;

  // Expect Forward to be called once with an argument of 100
  EXPECT_CALL(turtle, Forward(100)).Times(1);

  // Call the method
  turtle.Forward(100);
}
```

### Step 7: Build and Run Your Tests

From your project root or build directory:

```bash
cmake --build .
ctest
```

Or run the test binary directly:

```bash
./my_tests
```

You should see output indicating tests passed.

---

## Practical Tips & Best Practices

- **Order matters for EXPECT_CALL:** Set all your `EXPECT_CALL`s *before* invoking methods on mocks.
- **Use namespaces:** Import gMock symbols with `using ::testing::_;` for clean test code.
- **Suppress uninteresting call warnings:** Use `NiceMock<T>` if you want to ignore unexpected calls warnings.
- **Keep destructors virtual:** For interfaces to be mocked, make sure destructors are virtual.
- **Manage dependencies smartly:** Use aliases or parentheses to handle types with commas in `MOCK_METHOD`.

---

## Troubleshooting

- **Build errors due to missing gtest/gmock:** Verify that CMake `find_package` locates GoogleTest and mocks.
- **Linker errors:** Make sure you link your test executable against `gtest`, `gmock`, and `pthread` if needed.
- **Unmatched expectations:** Ensure all `EXPECT_CALL`s are written before exercising mocks.
- **Warnings about uninteresting calls:** Switch to using `NiceMock` or add catch-all `EXPECT_CALL` with `Times(AnyNumber())`.

For additional issues, consult the [Troubleshooting Common Issues](../../getting-started/troubleshooting-help/common-issues.md) guide.

---

## Next Steps & Related Content

- Explore the [GoogleTest Primer](../configuration-first-use/write-and-run-first-test.md) to deepen your understanding.
- Learn more about mocking in the [Mocking Primer](../getting-started/mocking-primer.md).
- Advanced mock usage is covered in [Setting Expectations and Default Actions](../../guides/mocking-best-practices/setting-expectations.md).
- Review integration with build systems in [Build System Integration](../../guides/integration-scenarios/build-system-integration.md).

---

## Summary Diagram

```mermaid
flowchart TD
  A[Start: Prepare C++ Project] --> B[Clone googletest Repo]
  B --> C[Create build directory and run cmake]
  C --> D[Build GoogleTest and GoogleMock libraries]
  D --> E[Install libraries (Optional)]
  E --> F[Configure your CMakeLists.txt for testing]
  F --> G[Write basic tests with GoogleTest]
  G --> H[Define mocks with GoogleMock macros]
  H --> I[Build your test executable]
  I --> J[Run tests and verify output]
  J --> K[Success!]

  classDef success fill:#cfc,stroke:#333,stroke-width:2px;
  class K success;
```

---

## References

- [GoogleTest on GitHub](https://github.com/google/googletest)
- [GoogleMock Guide](docs/gmock_for_dummies.md)
- [GoogleTest System Requirements](../../getting-started/prerequisites-installation/system-requirements.md)
- [Mocking Reference](../../docs/reference/mocking.md)
- [CMake Build and Integration](../../docs/googletest/README.md#build-with-cmake)

---

## Example Full CMakeLists.txt

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Download and build GoogleTest if not installed
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.13.0.tar.gz
)
FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(my_tests
  test/my_test_file.cpp
)

target_link_libraries(my_tests PRIVATE GTest::gtest GTest::gmock_main)

add_test(NAME MyTests COMMAND my_tests)
```

## Example Test File

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

using ::testing::AtLeast;
using ::testing::_;

TEST(TurtleTest, MoveForwardCallsForward) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, Forward(100)).Times(1);

  turtle.Forward(100);
}

TEST(TurtleTest, GetXReturnsValue) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, GetX()).WillOnce(testing::Return(42));

  EXPECT_EQ(turtle.GetX(), 42);
}
```
