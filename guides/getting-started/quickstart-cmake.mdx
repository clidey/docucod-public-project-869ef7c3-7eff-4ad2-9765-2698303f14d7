---
title: "Quickstart with CMake"
description: "Learn how to set up GoogleTest and GoogleMock in a CMake-based C++ project. This guide walks you through dependency setup, build configuration, and validating your installation with a basic test file."
---

# Quickstart with CMake

This guide walks you through setting up GoogleTest and GoogleMock in your C++ project using CMake. You’ll learn how to declare dependencies, configure your build environment, and validate the installation with a simple test program.

---

## 1. Getting Ready

**What This Guide Helps You Accomplish:**

- Integrate GoogleTest and GoogleMock using CMake.
- Download and link the libraries properly.
- Build and run a basic test to confirm your environment is correctly set up.

**Prerequisites:**

- A supported operating system (Linux, macOS, or Windows).
- C++ compiler with at least C++17 support.
- CMake version 3.14 or higher.
- Optional: A build tool like Make or Ninja compatible with your platform.

See [System Requirements & Supported Platforms](../../getting-started/setup-foundations/system-requirements) and [Prerequisite Tools & Dependencies](../../getting-started/setup-foundations/prerequisites) for detailed environment setup.

**Time Estimate:** Approximately 15–30 minutes.

---

## 2. Setting Up Your Project with CMake

Follow these clear steps to create a project that uses GoogleTest and GoogleMock.

<Steps>
<Step title="Create Your Project Directory">
Open a terminal and run:

```bash
mkdir my_project && cd my_project
```
This sets up a clean workspace for your code.
</Step>
<Step title="Create the `CMakeLists.txt` File">
Inside `my_project/`, create a file named `CMakeLists.txt` with this content:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Specify C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Fetch GoogleTest and GoogleMock
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows: prevent overriding compiler/linker settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

This configuration downloads a fixed GoogleTest version, including GoogleMock, on CMake run.
</Step>
<Step title="Add Your Test Code">
Create a file `hello_test.cc` in the project directory with this example GoogleTest + GoogleMock code:

```cpp
#include <gtest/gtest.h>

// Example test
TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```
</Step>
<Step title="Update `CMakeLists.txt` to Build the Test">
Append this to `CMakeLists.txt`:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)
target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

This tells CMake to build your test executable and integrate it with CTest for test discovery.
</Step>
<Step title="Build Your Project">
In your terminal, create and navigate to a build directory, then build the project:

```bash
cmake -S . -B build
cmake --build build
```

You should see the compilation of GoogleTest, GoogleMock, and your test code.
</Step>
<Step title="Run Your Tests">
Execute the tests using CTest:

```bash
cd build
ctest
```

You should see output showing tests passing:

```
Test project /path/to/my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```
Congratulations, your environment is correctly set up!
</Step>
</Steps>

---

## 3. How It Works: Understanding the From-Scratch Setup

- The `FetchContent` module handles downloading and making GoogleTest (and GoogleMock) available to your build automatically. This avoids manual cloning or submodules.
- The `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` line is critical for Windows users to ensure runtime library compatibility.
- The test target `hello_test` links with `GTest::gtest_main`, a pre-built target that includes a main() function, so you don’t need to write your own main.
- The call to `gtest_discover_tests()` enables CTest integration to find and run individual test cases.

---

## 4. Tips and Best Practices

- **Keep GoogleTest updated:** Regularly update the URL commit hash in `FetchContent_Declare` to get the latest fixes and features.
- **Control build options:** Use CMake options like `-Dgtest_build_samples=ON` or `-Dgtest_build_tests=ON` if you want to build GoogleTest’s own tests or samples.
- **Use stricter warnings:** GoogleTest and GoogleMock build with strict compiler flags by default to maximize code correctness.
- **Linking custom tests:** Link your tests with `GTest::gtest_main` or `gtest_main` to avoid writing a main function manually.
- **Cross-platform:** The setup uses CMake abstraction and works transparently on Linux, Windows, and macOS.

---

## 5. Common Pitfalls and Troubleshooting

- **C++ standard mismatch:** Ensure your compiler and project use at least C++17, or builds will fail.
- **Windows runtime errors:** If you get errors like runtime library mismatch, check `gtest_force_shared_crt` is set ON.
- **Build files not updating:** Clean your build directory when changing CMake options to avoid stale artifacts.
- **Missing includes or link errors:** Confirm `target_link_libraries` uses the correct GoogleTest targets (`GTest::gtest_main`).

<Tip>
If you face unexpected build problems, re-run CMake with `-Dgtest_build_tests=ON` to build and run GoogleTest’s internal tests. This can help verify your environment.
</Tip>

---

## 6. What’s Next?

- Write your own meaningful unit tests using the [Primer](../../guides/writing-and-running-tests/basic-unit-tests).
- Explore mocking capabilities through the [Mocking Reference](../../api-reference/core-apis/mocking).
- See more example projects at the [samples page](../../samples).
- Learn how to integrate these steps into other build systems or continuous integration by visiting [Integration with Build Systems and IDEs](../../guides/integration-and-troubleshooting/build-system-integration).

---

## 7. Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Quickstart Documentation](https://cmake.org/cmake/help/latest/manual/cmake-tutorial/index.html)
- [Supported Platforms & Requirements](../../getting-started/setup-foundations/system-requirements)
- [Prerequisite Tools & Dependencies](../../getting-started/setup-foundations/prerequisites)

---

By following this guide, you set a firm foundation for reliable and maintainable C++ testing using GoogleTest and GoogleMock, fully integrated with CMake’s build environment.


---