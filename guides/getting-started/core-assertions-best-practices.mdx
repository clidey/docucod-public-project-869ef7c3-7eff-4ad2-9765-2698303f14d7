---
title: "Core Assertions & Best Practices"
description: "Provides an in-depth guide to the main assertion macros, their appropriate use, and essential do's and don'ts for writing maintainable tests. Covers fatal/non-fatal failures and custom error messages."
---

# Core Assertions & Best Practices

This guide provides an in-depth exploration of the GoogleTest assertion macros, their intended uses, and essential guidelines for writing clear, maintainable, and effective tests. It covers the distinction between fatal and non-fatal failures, how to customize failure messages, and important do's and don'ts to maximize the value of your test assertions.

---

## 1. Understanding Assertion Macros

GoogleTest presents assertion macros as the fundamental building blocks for verifying test outcomes. These macros come in pairs:

- `ASSERT_*`: Generates **fatal failures** that immediately abort the current function.
- `EXPECT_*`: Generates **non-fatal failures** that allow the test to continue.

Choosing between these depends on whether continuing your test after failure is meaningful or might cause misleading results.

### Why Use ASSERT_* vs EXPECT_*?

- Use `ASSERT_*` when subsequent code depends on the assertion being true (e.g., dereferencing a pointer verified to be non-null).
- Use `EXPECT_*` to collect multiple failures within a single test run, thereby identifying more issues per execution.

### Example:

```cpp
ASSERT_NE(ptr, nullptr) << "Pointer must not be null";  // Abort if null
EXPECT_EQ(value, expected_value) << "Value mismatch, but test continues";  // Continue
```

---

## 2. Key GoogleTest Assertion Macros

GoogleTest offers a wide variety of assertion macros, each tailored for different kinds of checks and comparisons.

### 2.1. Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

Example:

```cpp
EXPECT_TRUE(IsValid(x)) << "x must be valid";
```

### 2.2. Equality and Inequality

- Relational assertions: `EXPECT_EQ(val1, val2)`, `EXPECT_NE(val1, val2)`, `EXPECT_LT`, `EXPECT_LE`, `EXPECT_GT`, `EXPECT_GE`

Example:

```cpp
ASSERT_EQ(calculated_count, expected_count) << "Count does not match";
```

> **Note:** Comparing C strings with these macros compares pointers, not contents. Use string-specific macros for C strings.

### 2.3. String Comparison Macros

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` – verify C string content equality.
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)` – verify C string content inequality.
- `EXPECT_STRCASEEQ` and `EXPECT_STRCASENE` – case-insensitive string comparisons.

Example:

```cpp
EXPECT_STREQ("hello", buffer) << "Buffer should contain 'hello'";
```

### 2.4. Floating-Point Assertions

Because of floating-point rounding errors, GoogleTest provides specialized macros:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)`
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)`
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`

Example:

```cpp
EXPECT_DOUBLE_EQ(computed_pi, 3.14159);
EXPECT_NEAR(calculated_value, expected_value, 0.001);
```

---

## 3. Fatal vs Non-Fatal Failures

GoogleTest clearly distinguishes between failures that abort the test and those that allow it to continue.

| Failure Type    | Description                                                                 | Use Cases                                                                                      |
|-----------------|-----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------|
| **Fatal Failure** (`ASSERT_*`, `FAIL()`) | Aborts the current function immediately. Typically used when further execution is unsafe or meaningless. | Verifying essential preconditions, pointer validity, critical equality checks.                   |
| **Non-fatal Failure** (`EXPECT_*`, `ADD_FAILURE()`) | Logs an error but continues running the test function.                                       | Checking multiple properties, collecting many failures before failing the test.                   |

### Best Practice

Prefer `EXPECT_*` for most assertions to get more failure feedback. Use `ASSERT_*` when continuing after failure could cause cascading errors or crashes.

---

## 4. Adding Custom Error Messages

All GoogleTest assertion macros support streaming a custom failure message using the `<<` operator.

### How to use:

```cpp
EXPECT_EQ(foo, bar) << "Values differ at index " << index << ": foo=" << foo << ", bar=" << bar;
```

This message will be appended to GoogleTest's default failure output, making it easier to debug complex conditions.

---

## 5. Using Scoped Trace for Contextual Information

When invoking subroutines with assertions, it can be hard to identify which call failed or why. Use `SCOPED_TRACE()` to add contextual messages and source code locations to failure messages.

### Example:

```cpp
void SubCheck(int n) {
  EXPECT_EQ(GetCount(n), 1);
}

TEST(MyTest, WithTrace) {
  SCOPED_TRACE("Checking n=5");
  SubCheck(5);
}
```

This will include the trace `Checking n=5` alongside any failures from `SubCheck`.

---

## 6. Important Do's and Don'ts When Writing Tests

### Do's

- ✅ Use `ASSERT_*` when failure should halt further execution.
- ✅ Use `EXPECT_*` for non-fatal checks that do not require aborting.
- ✅ Provide meaningful custom failure messages to aid debugging.
- ✅ Use `SCOPED_TRACE()` to improve subroutine failure diagnostics.
- ✅ Use the proper assertion macros for the data type (e.g., string macros for C string content comparison).
- ✅ Check for null pointers with specific assertions before dereferencing.
- ✅ Understand that `ASSERT_*` and `EXPECT_*` evaluate arguments exactly once, so safe to use expressions with side effects.

### Don'ts

- ❌ Do not mix `ASSERT_*` in constructors or destructors (they must return `void` functions).
- ❌ Avoid continuing tests after a `ASSERT_*` failure if it may cause undefined behavior or misleading results.
- ❌ Do not compare C strings using `EXPECT_EQ` or `ASSERT_NE`—use `EXPECT_STREQ`/`EXPECT_STRNE` instead.
- ❌ Don't place multiple death-test assertions on the same line as it leads to compilation errors.
- ❌ Do not rely on the order of test execution or on assertion evaluation order.

---

## 7. Advanced Assertion Usage

### Predicate Assertions With Rich Messages

Use predicate assertions (`EXPECT_PRED*`, `EXPECT_PRED_FORMAT*`) to get detailed failure output when testing complex predicates.

Example:

```cpp
AssertionResult IsEven(int n) {
  if (n % 2 == 0) return AssertionSuccess();
  return AssertionFailure() << n << " is odd";
}

EXPECT_TRUE(IsEven(x));
```

Failure messages will include why the assertion failed with values.

### Checking for Exceptions

- `EXPECT_THROW(statement, exception_type)` verifies that `statement` throws the specified exception.
- `EXPECT_NO_THROW(statement)` verifies no exception is thrown.
- `EXPECT_ANY_THROW(statement)` verifies that `statement` throws any exception.

### Skipping Tests at Runtime

Use `GTEST_SKIP()` to programmatically skip tests or suites if preconditions aren't met, streaming a message to clarify the skip reason.

```cpp
if (!DatabaseAvailable()) {
  GTEST_SKIP() << "Database not available";
}
```

---

## 8. Recording Additional Test Properties

Within tests or test suite setup/teardown, you can add key-value pairs for logging additional contextual information.

- Use `RecordProperty(key, value)` (a static method of `::testing::Test`).
- Keys must not conflict with reserved XML attribute names (`name`, `status`, `time`, `classname`, etc).
- Properties recorded during a test are output as attributes of the `<testcase>` element in XML reports.
- Properties recorded in `SetUpTestSuite` or `TearDownTestSuite` are output in the `<testsuite>` element.
- Global properties (outside tests and suites) appear in the `<testsuites>` root element.

Example:

```cpp
TEST_F(FooTest, TestProperties) {
  RecordProperty("MaxWidgets", ComputeMaxWidgets());
}
```

Will appear in the XML as:

```xml
<testcase name="TestProperties" classname="FooTest" MaxWidgets="12" ... />
```

---

## 9. Common Pitfalls and Troubleshooting

- **Skipping clean-up:** Using `ASSERT_*` in constructors or destructors may skip necessary cleanup.
- **Using wrong string comparison macro:** `EXPECT_EQ` on C strings compares pointers, not content.
- **Fatal assertion in helper functions:** Fatal assertions in void-returning helper functions only abort that function, not the entire test.
- **Multiple death tests per line:** You cannot have more than one death test macros on the same code line.

---

## 10. Success Criteria and Verification

By following this guide, you should be able to:

- Write assertions that clearly communicate test intent.
- Select the appropriate assertion macro for your test goal.
- Use custom failure messages effectively.
- Structure assertions to maximize debug information and minimize false passes or confusing failures.
- Add meaningful test properties for richer reporting.

Confirm success by observing that failed assertions generate helpful failure reports and that tests abort or continue as expected.

---

## Related Documentation

- [GoogleTest Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [GoogleTest Advanced](https://github.com/google/googletest/blob/main/docs/advanced.md)
- [GoogleTest Test Reference](https://github.com/google/googletest/blob/main/docs/reference/testing.md)
- [GoogleTest Troubleshooting & Common Issues](https://github.com/google/googletest/blob/main/docs/getting-started/troubleshooting-help/faq-common-issues.mdx)

---

For a complete overview of test writing workflows and example usages, see the [Getting Started Guides](https://github.com/google/googletest/tree/main/docs/guides).

---