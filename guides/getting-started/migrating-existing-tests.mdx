---
title: "Migrating Existing Tests"
description: "Best practices for migrating existing C++ unit tests to GoogleTest, including refactoring strategies and tips for incrementally adopting the framework in legacy projects."
---

# Migrating Existing Tests to GoogleTest

Migrating your legacy C++ unit tests to GoogleTest involves strategic refactoring and incremental adoption to gradually replace your existing test framework without disrupting development workflows. This guide provides practical steps, best practices, and tips to effectively transition existing test codebases to GoogleTest.

---

## 1. Migration Overview

### Purpose
Enable teams to transition existing C++ test suites to GoogleTest, leveraging its modern features and ecosystem, while minimizing disruption and preserving test coverage.

### Prerequisites
- A working legacy test suite with C++ unit tests.
- Basic familiarity with GoogleTest, recommended to read the [GoogleTest Primer](https://google.github.io/googletest/primer.html).
- Development environment configured for GoogleTest (see [Installing with CMake](getting-started/prerequisites-installation/install-via-cmake)).

### Expected Outcome
- Legacy tests refactored into GoogleTest-compatible tests.
- Incrementally increased usage of GoogleTest macros and fixtures.
- Established process for future tests to use GoogleTest exclusively.

### Difficulty Level
Intermediate — requires programming experience and understanding of both original and target frameworks.

---

## 2. Step-by-Step Migration Instructions

### Step 1: Assess Your Current Test Codebase

- Inventory: Identify all test files, test frameworks, and patterns used.
- Dependencies: Understand any framework-specific features in use.
- Coverage: Confirm how coverage and test execution is currently managed.

### Step 2: Set Up GoogleTest alongside the Existing Framework

- Add GoogleTest as a dependency without removing existing tests.
- Configure your build system (e.g., CMake) to compile GoogleTest and link it with your test binaries.
- Run GoogleTest’s sample or newly created simple tests to verify integration.

### Step 3: Begin Refactoring Individual Tests

- Start with simple, isolated tests that have minimal dependencies.
- Replace legacy assertions with GoogleTest’s `EXPECT_*` or `ASSERT_*` macros.
- Define test suites and fixtures to organize tests logically, replacing legacy grouping.

**Example: Migrating a simple test to GoogleTest**

Legacy Framework:
```cpp
void TestFactorial_HandlesZero() {
  VERIFY(Factorial(0) == 1);
}
```

GoogleTest:
```cpp
TEST(FactorialTest, HandlesZero) {
  EXPECT_EQ(Factorial(0), 1);
}
```

### Step 4: Use Test Fixtures for Reusable Setup / Teardown

- Convert common initialization code into GoogleTest fixtures by subclassing `testing::Test`.
- Use `TEST_F` macros to write tests with access to fixture data and setup.

### Step 5: Address Complex Legacy Features

- For parameterized tests, use GoogleTest’s `TEST_P` and `INSTANTIATE_TEST_SUITE_P` to port data-driven scenarios.
- For mocking, consider migrating to GoogleMock (gMock) for unified mocking capabilities.

### Step 6: Incrementally Disable Legacy Tests

- Disable legacy tests selectively to avoid duplicate test runs.
- Use preprocessor macros or build system flags to phase out old tests.

### Step 7: Continuous Integration Adaptation

- Update CI pipelines to run GoogleTest executables.
- Use GoogleTest’s rich options for test filtering, repeat, sharding, and XML or JSON output for reporting.

---

## 3. Best Practices and Tips

- **Start Small:** Begin with critical or simplest parts of your tests to gain confidence.
- **Use Fixtures:** Reuse shared setup with fixtures to reduce code duplication.
- **Leverage Matchers:** Use rich GoogleTest matchers for clearer, more expressive assertions (`EXPECT_THAT` with gMock matchers).
- **Preserve Test Semantics:** Ensure the meaning and intent of tests remain unchanged during migration.
- **Take Advantage of GoogleMock:** If your legacy tests use mocks, progressively migrate them to gMock for better integration.
- **Avoid Over-Migration:** Migrate tests incrementally rather than in a single large effort to minimize risks.
- **Maintain Coverage:** Use code coverage tools to verify that test coverage is not reduced.
- **Keep Legacy and New Tests Separate:** Run legacy and GoogleTest suites side by side during the transition.

---

## 4. Common Pitfalls and Troubleshooting

### Pitfall: Assertions Behave Differently
Legacy frameworks may differ in assertion fatality and continuation behavior.

**Solution:** Learn distinctions between GoogleTest’s `ASSERT_*` (fatal) and `EXPECT_*` (non-fatal) assertions and refactor accordingly.

### Pitfall: Test Registration Errors
Errors can occur if tests are incorrectly defined or macro usage is inconsistent.

**Solution:**
- Use `TEST` and `TEST_F` macros appropriately.
- Avoid test suite name conflicts.
- Refer to [Test Definition & Lifecycle](api-reference/core-test-api/test-definition-and-lifecycle) for guidance.

### Pitfall: Build and Link Failures
GoogleTest integration issues due to missing headers or libraries.

**Solution:**
- Follow [googletest/README.md](googletest/README.md) for proper CMake integration.
- Ensure your build system includes GoogleTest headers and links with `gtest` and `gtest_main`.

### Pitfall: Mocking Framework Differences
Existing mocks may not translate directly to gMock.

**Solution:**
- Gradually introduce gMock mocks.
- Refer to the [Googletest Mocking (gMock) Framework](googlemock/README.md) and [Mocking with GoogleMock](guides/core-workflows/mocking-with-gmock) for specific migration patterns.

### Pitfall: Test Order and Dependencies
Some legacy tests implicitly rely on execution order or shared state.

**Solution:** Re-design tests to be independent, using fixtures and proper setup/teardown to isolate tests.

<Tip>
Always run GoogleTest with `--gtest_repeat` and `--gtest_shuffle` to uncover flaky tests or hidden dependencies during migration.
</Tip>

---

## 5. Next Steps & Integration

- After migrating tests, explore [GoogleTest Advanced Topics](docs/advanced.md) to unlock value with parameterized, typed tests, and death tests.
- Integrate GoogleTest into your CI/CD pipelines, following guidance in [Integration with Development Pipelines](overview/integration-and-ecosystem/integration-overview).
- Enhance mocking with gMock by reviewing [Mocking Cookbook](gmock_cook_book.md) and [Mocking Cheat Sheet](gmock_cheat_sheet.md).
- Refer to [Assertions Reference](docs/reference/assertions.md) to write expressive and robust assertions.

---

## 6. Resources

- [GoogleTest Primer](docs/primer.md) — Start here if new to GoogleTest.
- [googletest/README.md](googletest/README.md) — Build and configuration.
- [GoogleMock README](googlemock/README.md) — Mocking framework overview.
- [Guides: Mocking with GoogleMock](guides/core-workflows/mocking-with-gmock) — Leverage mocks.
- [Assertion Macros Reference](docs/reference/assertions.md) — Complete list of assertions.
- [GoogleTest User's Guide Main Page](docs/index.md) — Gateway to all documentation.

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/primer.md", "range": "-"}, {"path": "docs/advanced.md", "range": "-"}, {"path": "googletest/README.md", "range": "-"}, {"path": "googlemock/README.md", "range": "-"}]} />

---