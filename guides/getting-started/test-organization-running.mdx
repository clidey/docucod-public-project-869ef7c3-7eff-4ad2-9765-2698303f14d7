---
title: "Organizing and Running Tests"
description: "Best practices for structuring tests across larger codebases, using test discovery, and leveraging command-line flags for targeted runs. Explains how to integrate with common build systems like CMake and Bazel."
---

# Organizing and Running Tests

## Overview

This guide helps you structure your tests effectively across larger projects, leverage automatic test discovery, and manage test execution with command-line flags. It focuses on practical strategies to maintain scalable test suites, run targeted tests efficiently, and integrate with common build systems like CMake and Bazel.

By following this guide, you will optimize your testing workflow to handle complex codebases while keeping tests organized, discoverable, and maintainable.

---

## 1. Structuring Tests for Scalability

As your project grows, organizing tests logically becomes crucial to maintain readability and ease of maintenance. Adopting consistent practices around test grouping and file organization will streamline test management.

### Key Practices

- **Group related tests into test suites:** Use consistent test suite naming to reflect your production code modules or class interfaces.

- **Use Test Fixtures:** For tests requiring shared setup, define test fixture classes with `TEST_F` macros to avoid duplicated initialization and tear-down code.

- **Source File Organization:**
  - Place tests near the code they cover (e.g., in `tests/` or alongside source files).
  - Follow naming conventions like `<component>_test.cc` for test files.

- **Modularize When Needed:**
  - Split large test suites into multiple files.
  - Group tests by functionality or feature set.

### Example

```cpp
// QueueTest.cc
class QueueTest : public testing::Test {
 protected:
  // Shared test data setup.
  Queue<int> q1_;
};

TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q1_.size(), 0);
}

TEST_F(QueueTest, EnqueueIncreasesSize) {
  q1_.Enqueue(5);
  EXPECT_EQ(q1_.size(), 1);
}
```

---

## 2. Leveraging Automatic Test Discovery

GoogleTest automatically detects and aggregates all tests defined via its macros within the linked binaries, removing the need for manual registration.

### How It Works

- Tests defined with `TEST` or `TEST_F` macros register themselves at static initialization.
- Running the test binary executes all registered tests.

### Running Tests

Run all tests simply by executing the test binary:

```bash
./my_test_binary
```

This runs all suites and tests discovered.

### Benefits

- No manual enumeration of tests is required.
- Tests scattered across multiple files are run together if linked.

### Available Options

GoogleTest provides command-line flags for controlling test discovery and execution:

- `--gtest_filter=`: Run only matching tests.
- `--gtest_list_tests`: List all tests without running.

See the [GoogleTest Primer](primer.md#invoking-the-tests) for complete usage.

---

## 3. Running Targeted Tests with Command-Line Flags

You can run specific tests for faster feedback and debugging by using test filters and other flags.

### Test Filtering

Use `--gtest_filter` to specify which tests to run:

- Syntax: `--gtest_filter=TestSuiteName.TestName`
- Wildcards `*` can be used for pattern matching.

**Examples:**

```bash
# Run only tests in QueueTest suite
./my_test_binary --gtest_filter=QueueTest.*

# Run only one test
./my_test_binary --gtest_filter=QueueTest.IsEmptyInitially

# Run all tests except one
./my_test_binary --gtest_filter=-QueueTest.IsEmptyInitially

# Run tests starting with 'Handles'
./my_test_binary --gtest_filter=*Handles*
```

### Other Useful Flags

- `--gtest_repeat=N`: Repeat tests N times.
- `--gtest_break_on_failure`: Stop at the first test failure.
- `--gtest_shuffle`: Run tests in random order to detect order dependencies.

### Tips for Using Filters

- Use filters during development to shorten feedback loops.
- Combine filtering with re-running failed tests for quick isolation.

---

## 4. Integrating with Build Systems

GoogleTest integrates smoothly with popular build systems such as CMake and Bazel. Proper integration enables seamless build and test execution workflows.

### 4.1 With CMake

#### Basic Setup

1. Add GoogleTest as a dependency (either via FetchContent, ExternalProject, or local install).

2. Define your test executable linking against `gtest` and `gmock` libraries.

3. Use CTest for test registration:

```cmake
enable_testing()
add_executable(my_test my_test.cc)
target_link_libraries(my_test gtest gmock pthread)
add_test(NAME MyTest COMMAND my_test)
```

#### Running Tests

Run all tests with:

```bash
ctest
```

With optional arguments for verbosity:

```bash
ctest --verbose
```

#### Best Practices

- Use `gtest_discover_tests()` (CMake 3.10+) for automatic test discovery.
- Group tests logically using CTest labels.

### 4.2 With Bazel

#### Workspace Setup

Declare GoogleTest and GoogleMock dependencies in your `MODULE.bazel` or `WORKSPACE`:

```bazel
bazel_dep(name = "com_google_googletest", version = "1.10.0")
```

#### BUILD File Example

```bazel
test_suite(
    name = "all_tests",
    tests = [":my_test"]
)

cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"]
)
```

#### Running Tests

Run all tests:

```bash
bazel test //path/to:all_tests
```

Run a specific test:

```bash
bazel test //path/to:my_test
```

---

## 5. Best Practices and Common Pitfalls

### Best Practices

- Set expectations before invoking mocks to prevent undefined behavior.
- Use test fixtures (`TEST_F`) to group related tests sharing common setup.
- Use descriptive test and test suite names to enhance readability.
- Suppress uninteresting call warnings with `NiceMock` when appropriate.
- Use `--gtest_filter` to speed up testing during development.

### Common Pitfalls

- Forgetting to call `InitGoogleTest()` before running tests causes test discovery to fail.
- Mixing expectations and actual mock calls disrupts verification.
- Running multiple `RUN_ALL_TESTS()` calls can break test flow.
- Overly specific expectations can lead to brittle tests.
- Not handling mock object lifetime may delay verification or cause false positives.

---

## 6. Troubleshooting & Tips

### Common Issues

- **Tests not discovered or running:**  Ensure `InitGoogleTest(&argc, argv)` is called before `RUN_ALL_TESTS()`.
- **Unexpected test failures:** Verify expectations are correctly set and mock lifetimes are managed.
- **Linker errors:** Check linking against `gtest` and `gmock` libraries.
- **Slow build times:** Consider moving mock class constructor/destructor definitions to `.cc` files.

### Tips

- Increase verbosity with `--gtest_verbose=info` for richer test output.
- Use `--gtest_list_tests` to see available tests.
- Use `NiceMock` or `StrictMock` to control warnings about uninteresting calls.

---

## 7. Next Steps & Related Documentation

- **Writing Your First Test:** Learn how to define and run tests.
- **Using Matchers and Custom Actions:** Deepen knowledge about controlling mock behavior.
- **Managing Call Counts and Mock Strictness:** Expert-level control over expectations.
- **Integrating with Build Systems:** Advanced tips for complex projects.

Refer to the following pages for detailed guidance:

- [GoogleTest Primer](primer.md)
- [Mocking for Dummies](gmock_for_dummies.md)
- [GoogleTest Cheat Sheet](gmock_cheat_sheet.md)
- [Integration & Ecosystem](overview/features-integration/integration-ecosystem.mdx)


<AccordionGroup title="Quick Reference">
<Accordion title="Running all tests">
To run all tests, simply execute your test binary:

```bash
./my_test_binary
```
</Accordion>
<Accordion title="Running specific tests">
Use `--gtest_filter`:

```bash
./my_test_binary --gtest_filter=QueueTest.IsEmptyInitially
```
</Accordion>
<Accordion title="Listing tests">
Print all test names without running:

```bash
./my_test_binary --gtest_list_tests
```
</Accordion>
</AccordionGroup>

---

### Troubleshooting Example

If tests do not run or your test binary reports "No tests found":

1. Verify your test functions are defined using `TEST` or `TEST_F` macros.
2. Confirm `testing::InitGoogleTest(&argc, argv);` is called before `RUN_ALL_TESTS();` in your `main`.
3. Ensure your test files are linked into the test executable.

---

### Developer Tips

- Use a consistent naming scheme for test suites and test cases to avoid duplication.
- Group related `EXPECT_CALL` configurations to improve test readability.
- Be wary of overusing strict mocks as they may make tests fragile.
- Use `NiceMock` for mocks in integration tests to reduce noise.

---

For full API reference, advanced mocking scenarios, and tutorials, visit the [GoogleTest GitHub repository](https://github.com/google/googletest) and related documentation pages listed above.


---

// End of Guide
