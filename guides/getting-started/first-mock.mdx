---
title: "Creating Your First Mock Object"
description: "A practical introduction to GoogleMock, showing how to define mock classes, set expectations, and verify interactions. Great for users eager to see mocking power in action through a realistic example."
---

# Creating Your First Mock Object

## Workflow Overview

**Task Description:**
This guide walks you through creating your first mock object using GoogleMock. You will learn how to define a mock class from an existing interface, instantiate mock objects, set up default behaviors and expectations, and verify mock interactions through a realistic, practical example.

**Prerequisites:**
- GoogleTest and GoogleMock must be installed and properly configured.
- Basic understanding of C++ interfaces and virtual functions.
- Familiarity with compiling and running GoogleTest/GoogleMock tests.

**Expected Outcome:**
By completing this guide, you will have a working mock class and tests that demonstrate setting default actions, defining expectations, and verifying expected interactions.

**Time Estimate:**
Approximately 15-20 minutes.

**Difficulty Level:**
Beginner to Intermediate

---

## Step-by-Step Instructions

### Step 1: Define a Mock Class

Start by creating a mock class that inherits from the interface you want to mock. For each virtual method (including destructors that must be virtual), use the `MOCK_METHOD` macro to define a mocked method. Place all mock method declarations in the `public:` section.

```cpp
#include <gmock/gmock.h>  // Include GoogleMock headers

// Example base interface
class Foo {
 public:
  virtual ~Foo() = default;  // Destructor must be virtual
  virtual int GetSize() const = 0;  // Pure virtual method
  virtual std::string Describe(const char* name) = 0;  // Overloaded method
  virtual std::string Describe(int type) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};

// Corresponding mock class
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

**Note:**
- Make sure the destructor in the base interface is virtual to avoid undefined behavior.
- Use `(const, override)` if mocking a `const` method.
- For overloaded methods, declare all variants you want to mock.

---

### Step 2: Instantiate Mock Objects

Create instances of your mock class in the test code. You can instantiate them on the stack or heap depending on your testing needs.

```cpp
TEST(FooTest, UsesMock) {
  MockFoo mock_foo;  // Stack allocation

  // Now you can set behaviors and expectations on mock_foo
}
```

---

### Step 3: Set Default Actions with `ON_CALL`

`ON_CALL` allows you to specify default behaviors for mock methods that will run when those methods are called without explicit expectations. This is useful for setting global behavior shared across calls.

```cpp
using ::testing::Return;
using ::testing::_;  // Wildcard matcher

ON_CALL(mock_foo, GetSize())
    .WillByDefault(Return(42));
```

After this, calling `mock_foo.GetSize()` will return `42` by default.

---

### Step 4: Set Expectations with `EXPECT_CALL`

Set expectations on how the mock methods should be used in your tests. Define argument matchers, expected call counts, and return values or actions.

```cpp
EXPECT_CALL(mock_foo, Describe("example"))
    .Times(1)
    .WillOnce(Return("Mocked description"));

EXPECT_CALL(mock_foo, Process(_, 5))
    .WillRepeatedly(Return(true));
```

**Tips:**
- Use `Times(0)` to verify that a method is *never* called.
- The order of `EXPECT_CALL` statements matters: later expectations override earlier ones if they match.

---

### Step 5: Exercise Your Code and Observe

Run the code that uses your mock object. GoogleMock will automatically verify whether the expectations are satisfied when the mock object is destroyed or tests complete.

```cpp
// Example usage
FooUser user(&mock_foo);
EXPECT_TRUE(user.DoWork());  // Your code under test
```

---

### Step 6: Verify and Clean Up (Optional)

You can explicitly verify expectations and clear them before mock destruction if needed.

```cpp
using ::testing::Mock;

// Verifies expectations and clears them.
bool verified = Mock::VerifyAndClearExpectations(&mock_foo);
EXPECT_TRUE(verified);
```

Avoid setting new expectations after calling this.

---

## Example: Complete Mock Usage

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Bar {};

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};

TEST(MockFooTest, BasicUsage) {
  MockFoo mock;

  // Set a default action
  ON_CALL(mock, GetSize()).WillByDefault(::testing::Return(10));

  // Set expectations
  EXPECT_CALL(mock, Describe("test"))
      .Times(2)
      .WillRepeatedly(::testing::Return(std::string("desc")));

  EXPECT_CALL(mock, Process(::testing::_, 5))
      .WillOnce(::testing::Return(true));

  // Exercising the mock
  EXPECT_EQ(10, mock.GetSize());  // Uses ON_CALL's default
  EXPECT_EQ("desc", mock.Describe("test"));
  EXPECT_EQ("desc", mock.Describe("test"));
  Bar bar;
  EXPECT_TRUE(mock.Process(bar, 5));
}
```

---

## Tips & Best Practices

- **Define all mock methods as `public`:** Even if the base class methods are protected or private, this is required to use `ON_CALL` and `EXPECT_CALL`.
- **Use `NiceMock`, `NaggyMock`, or `StrictMock` judiciously:** These templates modify how uninteresting calls are treated, helping suppress warnings or enforce strict checking.
- **Be mindful when mocking overloaded methods:** Always declare all variants you plan to use, or suppress warnings by using `using Base::MethodName;` for those not mocked.
- **Avoid over-specifying expectations:** Use `ON_CALL` for default behavior, `EXPECT_CALL` only when you want to verify specific interactions.
- **Call `Mock::VerifyAndClearExpectations` only once:** Do not set new expectations after verification; it leads to undefined behavior.

---

## Troubleshooting

- **Test fails because mock calls don't match expectations:**
  - Check argument matchers and call counts.
  - Use `--gmock_verbose=info` flag to trace calls and expectation matching.

- **Warning about uninteresting calls:**
  - Set default actions with `ON_CALL` or use `NiceMock` to suppress.
  - Add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());` if needed.

- **Mock methods call real functions:**
  - Ensure base class methods are `virtual`.
  - If mocking non-virtual functions, see [mocking non-virtuals](docs/gmock_cook_book.md#MockingNonVirtualMethods).

- **Compilation errors when using `MOCK_METHOD` with types containing commas:**
  - Wrap these types in extra parentheses or define type aliases.

---

## Next Steps & Related Content

- **Writing Your First Unit Test:** Learn how to write tests that use mocks [guide](../getting-started/first-unit-test).
- **Mocking Techniques & Best Practices:** Deepen your understanding of mocking patterns [guide](../guides/essential-testing-patterns/mocking-best-practices).
- **Feature Overview:** Review core GoogleMock features and capabilities [overview](../overview/concepts-features-usecases/feature-overview).

For more hands-on examples and advanced customization, check the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).

---