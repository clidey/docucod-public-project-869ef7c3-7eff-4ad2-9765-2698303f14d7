---
title: "Writing Your First Mock with GoogleMock"
description: "Introduces essential mocking concepts by guiding users through creating a simple mock class and verifying interactions using GoogleMock. Emphasizes basics of the MOCK_METHOD macro, simple expectations, and test execution."
---

# Writing Your First Mock with GoogleMock

## Introduction

This guide leads you through the fundamentals of using GoogleMock to create mocks for your C++ interfaces. You will learn how to define a mock class using the `MOCK_METHOD` macro, set simple expectations with `EXPECT_CALL`, and run tests that verify interactions with mocked objects. By the end, you'll understand how mocking helps isolate and test interactions in your code effectively.

---

## 1. Understanding GoogleMock Mocks

GoogleMock allows you to create **mock classes** that simulate the behavior of real classes or interfaces, enabling you to verify that your code interacts with those classes correctly during tests. Mocks specify:

- Which methods are expected to be called,
- How many times they should be called,
- What arguments they should be called with,
- What values they return or actions they perform.

Mocks are invaluable for testing code that depends on complex or external systems by replacing those dependencies with controllable and observable stand-ins.

---

## 2. Defining a Mock Class

To use GoogleMock, you define a mock class by inheriting from an interface or base class and using the `MOCK_METHOD` macro to mock virtual methods.

### Step-by-Step: Create a Mock Class

<Steps>
<Step title="Include GoogleMock Header">
Add the following include to your test or mock header file:

```cpp
#include <gmock/gmock.h>
```
</Step>
<Step title="Derive from Interface or Base Class">
Define a class that inherits from the interface or base class you want to mock.
</Step>
<Step title="Use MOCK_METHOD Macro">
For each virtual method you want to mock, write a macro:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- `ReturnType`: The method's return type.
- `MethodName`: The method's name.
- `(Args...)`: Parenthesized argument types.
- `(Qualifiers)`: Optional list such as `(const, override)`.

Example mocking a simple interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```
</Step>
</Steps>

**Important:** Always place `MOCK_METHOD` declarations in the **public** section, even if they mock protected or private virtual methods from the base class.

---

## 3. Setting Expectations on Mocks

After defining a mock object, you set expectations using the `EXPECT_CALL` macro to specify expected method calls, their arguments, and their behavior.

### Basic Syntax

```cpp
EXPECT_CALL(mock_object, MethodName(arg_matchers))
    .Times(n)
    .WillOnce(action)
    .WillRepeatedly(action);
```

### Example: Expecting Calls and Specifying Returns

```cpp
using ::testing::Return;

MockTurtle turtle;

// Expect PenUp() to be called exactly once.
EXPECT_CALL(turtle, PenUp()).Times(1);

// Expect Forward() to be called with any integer argument twice.
EXPECT_CALL(turtle, Forward(::testing::_)).Times(2);

// Expect GetX() to be called and return 10.
EXPECT_CALL(turtle, GetX()).WillOnce(Return(10));

// Use the mock
...
turtle.PenUp();
turtle.Forward(100);
turtle.Forward(50);
int x = turtle.GetX();  // x == 10
```

### Notes:

- Use `_` (underscore matcher) to indicate "match any argument".
- If `Times()` is omitted, GoogleMock assumes the method is called once.
- Multiple `WillOnce()` clauses specify the return or behaviors in call order.
- `WillRepeatedly()` defines the behavior for all calls beyond those covered by `WillOnce()`.

---

## 4. Running Tests With Mocks

Mocks are used just like normal objects. When a test runs, GoogleMock verifies that all specified expectations are met, and reports failures if:

- Expected calls do not happen,
- Calls happen with unexpected arguments,
- Calls happen more or fewer times than expected.

Hereâ€™s a simple test example:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;

TEST(PainterTest, DrawsWithTurtle) {
  MockTurtle mock_turtle;

  EXPECT_CALL(mock_turtle, PenUp()).Times(1);
  EXPECT_CALL(mock_turtle, Forward(::testing::_)).Times(2);
  EXPECT_CALL(mock_turtle, GetX()).WillOnce(Return(42));

  // Code under test uses mock_turtle...
  mock_turtle.PenUp();
  mock_turtle.Forward(10);
  mock_turtle.Forward(20);
  int pos = mock_turtle.GetX();
  EXPECT_EQ(pos, 42);
}
```

When running this, any deviation from expectations will generate descriptive errors.

---

## 5. Best Practices & Tips

- **Mock Only What You Own:** Restrict mocking to interfaces or classes you maintain.
- **Match Only What Matters:** Use general argument matchers (`_`) unless specific values matter.
- **Avoid Over-Specification:** Overly strict expectations lead to brittle tests.
- **Use `NiceMock` for Less Noise:** Wrap your mocks in `NiceMock<YourMock>` to suppress warnings about uninteresting calls.
- **Use `StrictMock` for Tight Verification:** Wrap mocks in `StrictMock<YourMock>` to turn uninteresting calls into errors.
- **Retire Expectations if Needed:** Use `.RetiresOnSaturation()` when correct to avoid sticky expectations causing false failures.

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Mock Method Not Called Error">
Check that your `EXPECT_CALL` is set **before** the method on the mock object is called. GoogleMock requires expectations to be established beforehand.
</Accordion>
<Accordion title="Uninteresting Function Call Warning">
Occurs when a mock method is called but has no matching `EXPECT_CALL`. To suppress, use `NiceMock` or add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.
</Accordion>
<Accordion title="Compilation Errors for MOCK_METHOD">
- Verify that return and argument types with commas are enclosed in parentheses.
- Ensure `MOCK_METHOD` is used within a public section.
</Accordion>
<Accordion title="Overloaded Methods Ambiguity">
If mocking overloaded methods, specify parameter types explicitly or use aliases to disambiguate.
</Accordion>
<Accordion title="Virtual Destructor Requirement">
The base class must have a virtual destructor for mocks to clean up properly.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps

- Explore [Using Assertions and Matchers Effectively](/guides/core-scenarios/assertions-matchers) to verify test conditions reliably.
- Learn about [Advanced Mocking Patterns and Expectations](/guides/core-scenarios/working-with-mocks) for deeper usage.
- Refer to the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes and advanced techniques.
- Combine with [Authoring Your First Test](/guides/getting-started/first-test) to write comprehensive test suites.

---

## Additional Resources

- [GoogleMock Reference](docs/reference/mocking.md)
- [gMock Primer: gMock for Dummies](docs/gmock_for_dummies.md)
- [Mocking FAQ](docs/gmock_faq.md)
- [GoogleTest Primer and GoogleTest Installation Guides](/getting-started/)

---

By mastering these basics, you equip yourself to write focused, effective unit tests that enhance code quality with clear, verifiable behavioral contracts through mocking.
