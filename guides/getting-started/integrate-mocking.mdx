---
title: "Introducing Mocking with GoogleMock"
description: "Learn to use GoogleMock to isolate dependencies and verify interactions in your tests. This guide demonstrates how to define and use mock classes, highlighting MOCK_METHOD macros and key best practices for maintainable C++ tests."
---

# Introducing Mocking with GoogleMock

## Overview

This guide introduces you to GoogleMock (gMock), the mocking framework built on top of GoogleTest, designed to help you isolate dependencies and verify interactions in your C++ tests. By creating mock classes that simulate the behavior of real objects, you can write clearer, faster, and more maintainable tests focused on specific units of your code.

GoogleMock empowers you to:

- Define mock classes quickly and safely
- Specify expectations on how functions should be called
- Control the behavior (return values, side effects) of mocks
- Verify that your code interacts as expected with its dependencies

This guide focuses on the core flow of defining mocks and setting expectations using the `MOCK_METHOD` macro and essential best practices.

---

## Prerequisites

- You have a working GoogleTest and GoogleMock environment.
- Familiarity with C++ virtual functions and inheritance.
- Basic understanding of unit testing and test fixtures.


## What You Will Achieve

After following this guide, you will be able to:

- Define mock classes that correspond to your interfaces
- Use `MOCK_METHOD` macros to quickly create mock methods
- Set up default behaviors and specific expectations using ON_CALL and EXPECT_CALL
- Use matchers to specify argument constraints
- Understand and control mock object strictness and default behaviors

---

## Defining a Mock Class

GoogleMock requires you to define mock classes that inherit from your interfaces (or abstract base classes). The core macro `MOCK_METHOD()` is used inside a mock class to declare mock methods.

### Step 1: Create Your Interface (If Not Already Existing)

Ensure your base class has virtual methods (and a virtual destructor!) that you want to mock.

Example:

```cpp
class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};
```

### Step 2: Define the Mock Class

Create a class inheriting from the interface. In the public section, use the `MOCK_METHOD` macro to declare mock methods.

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

Notes:

- `MOCK_METHOD` takes the return type, method name, argument list (inside parentheses), and an optional list of qualifiers (`const`, `override`, etc.)
- Always place `MOCK_METHOD` macros in the `public:` section even if the original method is protected or private.
- For methods with commas in argument types (e.g., templates), wrap the entire argument type in extra parentheses or use a type alias.

### Step 3: Optional - Define Nice, Naggy, or Strict Mocks

GoogleMock offers three modifiers to control the behavior of uninteresting calls (calls to mock methods without expectations):

- `NiceMock<T>`: Suppresses warnings for uninteresting calls.
- `NaggyMock<T>`: Prints warnings for uninteresting calls (default behavior).
- `StrictMock<T>`: Treats all uninteresting calls as failures.

Usage example:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // Ignores uninteresting calls.
NaggyMock<MockFoo> naggy_foo;    // Warns on uninteresting calls.
StrictMock<MockFoo> strict_foo;  // Fails on uninteresting calls.
```

They behave like subclasses of your mock class and inherit its constructors.

---

## Using Mocks in Tests

Once you have defined your mock class, follow these steps to use it effectively:

### Step 1: Import the Required Symbols

Bring necessary symbols from the `testing` namespace into scope.

```cpp
using ::testing::Return;
using ::testing::_;  // Wildcard matcher
```

### Step 2: Create Mock Objects

Instantiate your mock objects in your test.

```cpp
MockFoo foo;
```

Or use nice, naggy, or strict mocks:

```cpp
NiceMock<MockFoo> foo;
```

### Step 3: Set Default Actions (Optional)

Set the common behavior for mock methods that your tests do not specifically validate. Use `ON_CALL`:

```cpp
ON_CALL(foo, GetSize()).WillByDefault(Return(42));
```

This means calls to `GetSize()` will return 42 unless overridden.

### Step 4: Set Expectations

Specify exactly what calls you expect during the test using `EXPECT_CALL`. This not only defines behavior but also asserts the calls happen as expected.

Example:

```cpp
EXPECT_CALL(foo, Describe(5))
    .Times(3)
    .WillRepeatedly(Return("Category 5"));
```

This expects `Describe(5)` to be called exactly 3 times, and returns "Category 5" each time.

If you expect any arguments and don't care about them, use the wildcard matcher `_`:

```cpp
EXPECT_CALL(foo, Process(_, _)).WillRepeatedly(Return(true));
```

### Step 5: Exercise Your Code Under Test

Call your functions that interact with the mock. GoogleMock will verify interactions immediately and at mock destruction.

```cpp
EXPECT_EQ(myCodeUsingFoo(&foo), "expected_result");
```

### Step 6: Let GoogleMock Verify Expectations

When the mock object goes out of scope, GoogleMock automatically checks that all expectations were met. Failures will be reported if not.

---

## Tips and Best Practices

- **Set Expectations Before Exercising Code:** Always call `EXPECT_CALL` before the code that uses the mock.
- **Match Only What You Care About:** Use matchers like `_` to ignore uninteresting arguments.
- **Use NiceMock for Less Noisy Tests:** If you want to suppress warnings about uninteresting calls, wrap mocks in `NiceMock`.
- **Use StrictMock to Catch Unexpected Calls:** If your test must be very precise, use `StrictMock` to fail tests on unanticipated method calls.
- **Use `RetiresOnSaturation()` to Prevent Sticky Expectations:** When chaining multiple expectations on the same method, mark them to retire when saturated to avoid unexpected errors.
- **Match Overloaded Methods Explicitly:** Mock all overloads or use `using Base::Method;` to avoid compiler warnings.
- **Mock Non-Virtual Methods Only via Templates and High-Perf Dependency Injection:** Avoid mocking non-virtual methods unless necessary.

---

## Common Pitfalls

- **Missing Virtual Destructors:** Your interfaces must have virtual destructors for mocks to behave properly.
- **Setting New Expectations After Exercising Mocks:** This can cause undefined behavior. Always fully set expectations beforehand.
- **Expectations Overlapping and Shadowing:** Because expectations are matched in reverse order, put more specific expectations after more general ones.
- **Unintentional Uninteresting Calls:** If you see warnings about uninteresting calls, reconsider your test coverage or use `NiceMock`.

---

## Example: Complete Mock and Test

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Return;
using ::testing::_;

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};

TEST(FooTest, UsesMockCorrectly) {
  MockFoo mock;

  // Default action: GetSize() returns 10.
  ON_CALL(mock, GetSize()).WillByDefault(Return(10));

  // Expect Describe("test") to be called twice and return "stub".
  EXPECT_CALL(mock, Describe("test"))
      .Times(2)
      .WillRepeatedly(Return("stub"));

  // Expect Process() to be called at least once with any args.
  EXPECT_CALL(mock, Process(_, _)).WillRepeatedly(Return(true));

  EXPECT_EQ(mock.GetSize(), 10);
  EXPECT_EQ(mock.Describe("test"), "stub");
  EXPECT_TRUE(mock.Process(1, 2));
  EXPECT_EQ(mock.Describe("test"), "stub");
}
```

---

## Additional Resources

- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md): Quick reference for mocking macros and common patterns.
- [gMock Cookbook](docs/gmock_cook_book.md): Recipes and best practices for advanced mocking scenarios.
- [Mocking Reference](docs/reference/mocking.md): Detailed API documentation.
- [Legacy gMock FAQ](docs/gmock_faq.md): Answers to common questions and issues.

---

## Troubleshooting

<AccordionGroup title="Troubleshooting Common Issues with GoogleMock">
<Accordion title="Uninteresting Calls Warnings">
If your test prints warnings like ‘Uninteresting mock function call’, consider:
- Using `NiceMock` to suppress warnings if these calls are expected but not verified.
- Adding catch-all expectations with `.Times(AnyNumber())` if specific calls are expected but others can happen.
- Checking for missing or incorrect expectations.
</Accordion>
<Accordion title="Mock Methods Not Called or Unexpected Calls">
- Ensure that expectations are set before exercising the mock.
- Verify argument matchers are correct and not overly restrictive.
- Use `--gmock_verbose=info` to see detailed call traces.
</Accordion>
<Accordion title="Mocking Non-Virtual Methods">
- gMock cannot mock non-virtual methods unless using templates (high-perf dependency injection).
- Consider redesigning to use interfaces or wrappers.
</Accordion>
<Accordion title="Compiler Errors with MOCK_METHOD">
- Wrap complex return or argument types with parentheses.
- Use type aliases for complex types with commas.
- Make sure you use the correct syntax as per the [MOCK_METHOD reference](docs/reference/mocking.md#MOCK_METHOD).
</Accordion>
</AccordionGroup>

---

## Summary Diagram

```mermaid
flowchart TD
    A[Define Interface with virtual methods] --> B[Create Mock Class with MOCK_METHOD macros]
    B --> C[Instantiate Mock Objects in Tests]
    C --> D[Set Default Actions using ON_CALL]
    D --> E[Specify Expectations using EXPECT_CALL]
    E --> F[Run Code and Exercise Mocks]
    F --> G[Verification of Calls on Mock Destruction]

    classDef userAction fill:#e0f7fa,stroke:#00796b,stroke-width:2px;
    B,C,D,E,F class userAction;
```

---