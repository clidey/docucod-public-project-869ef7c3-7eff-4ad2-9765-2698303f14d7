---
title: "Basic Mocking with GoogleMock"
description: "Step-by-step guidance for creating and using mock objects with GoogleMock. Learn to declare mock classes, set expectations, and verify calls against real interfaces, accelerating the adoption of effective test doubles."
---

# Basic Mocking with GoogleMock

## Workflow Overview

- **Task Description:** This guide helps you create mock classes using GoogleMock, set expectations on mock method calls, and verify interactions in your C++ tests.
- **Prerequisites:**
  - Familiarity with C++ and virtual functions
  - GoogleTest and GoogleMock installed and configured in your project
  - Basic understanding of unit testing principles
- **Expected Outcome:**
  - You will learn to write mock classes with `MOCK_METHOD` macros
  - Set default behaviors using `ON_CALL`
  - Set and verify expectations using `EXPECT_CALL`
  - Manage mock object lifetimes and verify expectations explicitly if needed
- **Time Estimate:** Approximately 15-30 minutes to follow the examples and apply basic mocking
- **Difficulty Level:** Beginner to Intermediate

---

## Step-by-Step Instructions

### 1. Define a Mock Class

To test code depending on an interface, create a derived mock class inheriting from that interface. Use `MOCK_METHOD` macros to mock virtual methods.

```cpp
#include <gmock/gmock.h>  // Include GoogleMock header

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

> **Note:**
> - The mock methods must always be declared in `public:` section, regardless of the base method's access.
> - If the method is `const`, include `(const)` qualifier in the fourth parameter.
> - Use the `override` specifier to catch signature mismatches.
> 
> - For functions with argument types or return types containing commas (e.g., `std::pair` or `std::map`), wrap those types in additional parentheses or use type aliases to avoid macro parsing errors.


### 2. Set Default Behaviors with `ON_CALL`

Use the `ON_CALL` macro to define default behaviors for mock methods. This does not imply any expectation of how often or if the method will be called.

```cpp
using ::testing::Return;
...
MockTurtle turtle;

ON_CALL(turtle, GetX())
    .WillByDefault(Return(0));  // Default return value when GetX() is called
```

> **Tip:** Use `ON_CALL` for common default behaviors, usually inside test fixtures' setup.

### 3. Set Expectations with `EXPECT_CALL`

Use `EXPECT_CALL` to specify how many times and with what arguments a mock method should be called, and what it should do.

```cpp
using ::testing::AtLeast;
using ::testing::_;  // wildcard matcher for any argument
using ::testing::Return;

EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1));

EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(42))
    .WillRepeatedly(Return(50));
```

> **Details:**
> - `EXPECT_CALL` takes the mock object and method call with argument matchers.
> - You can use matchers like `_` to match any argument, or more specific ones like `Ge()`, `Eq()`, etc.
> - `.Times()` specifies expected call count (exact, at least, any number, etc.).
> - `.WillOnce()` and `.WillRepeatedly()` define what the method returns or does when called.

### 4. Use Sequences and Ordering (Optional)

To ensure calls occur in a specific order, use `InSequence` or `Sequence` objects.

```cpp
{
  InSequence s;
  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

### 5. Test Your Code Using Mocks

Inject mocks into your code under test and verify behavior.

```cpp
TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 50));
}
```

### 6. Verify and Clear Expectations Explicitly (If Needed)

If you want to verify expectations before mock destruction or control mock lifetime manually, call:

```cpp
bool success = testing::Mock::VerifyAndClearExpectations(&mock_object);
```

Or to verify and clear default actions as well:

```cpp
bool success = testing::Mock::VerifyAndClear(&mock_object);
```

> **Warning:** Do not set new expectations after verifying and clearing.

---

## Examples & Code Samples

### Mocking a Class with `MOCK_METHOD`

```cpp
class MockFoo {
 public:
  MOCK_METHOD(int, GetSize, (), (const));
  MOCK_METHOD(void, Reset, (int level));
};
```

### Using `EXPECT_CALL` with Matchers and Actions

```cpp
using ::testing::Return;
using ::testing::_;

MockFoo mock;

EXPECT_CALL(mock, GetSize())
    .WillOnce(Return(10));

EXPECT_CALL(mock, Reset(_))
    .Times(AtLeast(1));

// Exercise
int size = mock.GetSize();
mock.Reset(5);
```

### Handling Methods With Multiple Calls and Return Values

```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### Using `ON_CALL` for Default Behavior

```cpp
ON_CALL(mock, GetValue())
    .WillByDefault(Return(0));
```

---

## Troubleshooting & Tips

### Common Issues

- **Unprotected commas in types**: Wrap types containing commas with parentheses or use type aliases.
- **Expectations not met**: Run tests with `--gmock_verbose=info` to trace mock invocations.
- **Mock destructor warnings**: Ensure your base classes have virtual destructors.
- **Unexpected or uninteresting calls warnings**:
  - Use `NiceMock` to suppress warnings on uninteresting calls.
  - Use explicit `EXPECT_CALL(...).Times(AnyNumber())` if calls are allowed but do not need verification.
- **Over-specified expectations** causing test brittleness: Use `ON_CALL` for default behaviors and expect only necessary calls via `EXPECT_CALL`.

### Best Practices

- Always put `MOCK_METHOD` in the `public` section.
- Use `ON_CALL` to define default behavior, not to specify call expectations.
- Use `EXPECT_CALL` exclusively when you want to verify calls.
- Utilize `InSequence` or `.InSequence()` for ordered call expectations.
- Use `RetiresOnSaturation()` to make expectations non-sticky when appropriate.
- Prefer lambdas or callable objects for complex actions.

### Performance Considerations

- Mock classes with many methods can increase compilation time. Move mock class constructors and destructors to implementation files to reduce compile times.

### Alternative Approaches

- For non-virtual methods, mock by defining unrelated mock classes with matching signatures.
- For complex fakes that are partially used in mocking, delegate actions using `ON_CALL` to the fake implementation.

---

## Next Steps & Related Content

- Learn [Using Assertions Effectively](/guides/essential-workflows/using-assertions) to assert test results.
- Explore [Advanced Mocking Patterns](/guides/essential-workflows/advanced-mocking-patterns) for complex scenarios.
- Understand [Matchers Reference](reference/matchers.md) and [Actions Reference](reference/actions.md) to write expressive tests.
- Read [Understanding Uninteresting vs Unexpected Calls](docs/gmock_cook_book.md#uninteresting-vs-unexpected) for mock call classification.
- Visit [Mocking Reference](docs/reference/mocking.md) for detailed syntax and API specification.
- For quick syntax, refer to the [gMock Cheat Sheet](docs/gmock_cheat_sheet.md).

---

## Additional Resources

- [gMock for Dummies](docs/gmock_for_dummies.md) — foundational introduction
- [gMock Cookbook](docs/gmock_cook_book.md) — recipes and patterns
- [MockFunction](docs/gmock_cook_book.md#MockFunction) for mocking std::function
- [FAQ on Mocking](docs/gmock_faq.md) for common issues and questions

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_for_dummies.md", "range": "1-173"},{"path": "docs/gmock_cook_book.md", "range": "1-744"},{"path": "docs/reference/mocking.md", "range": "1-237"}]} />
