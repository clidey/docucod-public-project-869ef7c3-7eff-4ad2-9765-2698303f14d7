---
title: "Basic Mocking with GoogleMock"
description: "A practical introduction to using GoogleMock for creating mock objects and verifying interactions. This guide walks you through the process of mocking interfaces, setting up expectations, and using core matchers in your test cases."
---

# Basic Mocking with GoogleMock

A practical introduction to using GoogleMock for creating mock objects and verifying interactions. This guide walks you through the process of mocking interfaces, setting up expectations, and using core matchers in your test cases.

---

## 1. Introduction to Basic Mocking

Mocking is an essential technique for unit testing, allowing you to simulate the behavior of complex dependencies by creating mock objects that mimic interfaces in your code. GoogleMock lets you create mock classes easily and verify that your code interacts with them correctly.

In this guide, you will learn how to:

- Define mock classes and methods using the `MOCK_METHOD` macro.
- Set expectations on mock method calls with `EXPECT_CALL`.
- Use core matchers to specify argument constraints.
- Understand basic mock object behavior variants: nice, naggy, and strict.

**Prerequisites:**
- Basic knowledge of C++ and virtual functions.
- GoogleTest and GoogleMock headers included (`#include <gmock/gmock.h>`).

**Expected Outcome:**
By following this guide, you will be able to write mock classes, set expectations on method calls, and verify interactions effectively to write clean and reliable unit tests.

---

## 2. Defining a Mock Class

### 2.1 Mocking an Interface

Suppose you have an abstract interface with virtual methods:

```cpp
class Foo {
 public:
  virtual ~Foo() {}  // Must be virtual

  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};
```

To mock this interface, define a mock class inheriting from `Foo` and declare mocked methods with `MOCK_METHOD`:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

**Key points:**
- Place `MOCK_METHOD` declarations in the `public:` section regardless of base method visibility.
- Use the 4th parameter to indicate qualifiers such as `const` and `override`.

### 2.2 Handling Commas in Arguments

If your method has argument types containing commas (e.g., templates), wrap the argument type in parentheses or use type aliases to avoid macro parsing errors.

Example:

```cpp
// Using parentheses
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// OR using type aliases
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, ());
```

---

## 3. Setting Expectations on Mock Methods

GoogleMock uses `EXPECT_CALL` to specify how a mock method is expected to be called.

### 3.1 Basic `EXPECT_CALL` Syntax

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `mock_object`: your mock instance.
- `MethodName`: the mocked method.
- `matchers`: patterns describing expected argument values; `_` means any value.
- `Times`: number of expected calls (optional).
- `WillOnce`: defines what happens on a single call.
- `WillRepeatedly`: defines behavior for calls beyond those covered by `WillOnce`.

### 3.2 Example: Setting Expectations

```cpp
using ::testing::Return;
using ::testing::_;

TEST(FooTest, BasicMockUsage) {
  MockFoo mock;

  // Expect GetSize() to be called once, returning 3
  EXPECT_CALL(mock, GetSize())
      .Times(1)
      .WillOnce(Return(3));

  // Expect Describe() to be called with "abc" argument always returning "desc"
  EXPECT_CALL(mock, Describe("abc"))
      .WillRepeatedly(Return("desc"));

  // Exercise code using mock; here, for demonstration:
  EXPECT_EQ(3, mock.GetSize());
  EXPECT_EQ("desc", mock.Describe("abc"));
}
```

### 3.3 Matchers Fundamentals

GoogleMock includes a rich set of matchers:

- `_`: matches any argument.
- `Eq(value)`: matches exact equality.
- `Ge(n)`, `Lt(n)`: for numeric comparisons.

Example of using matchers:

```cpp
EXPECT_CALL(mock, Process(Ge(0), _));  // First argument >= 0, second any
```

### 3.4 Default Cardinality and Actions

- If you omit `Times()`, GoogleMock infers it (usually `Times(1)` or based on `WillOnce`).
- Mock methods with no `EXPECT_CALL` can still be called; they perform default actions (e.g., return 0 or false).

### 3.5 Using `ON_CALL` for Default Behavior

`ON_CALL` lets you specify default behaviors without setting an expectation that the method will be called.

```cpp
ON_CALL(mock, GetSize()).WillByDefault(Return(5));
```

Use `ON_CALL` for common behavior and `EXPECT_CALL` to impose stricter verification.

---

## 4. Nice, Naggy, and Strict Mocks

GoogleMock provides three behavioral modes for mocks regarding uninteresting calls (calls for which no `EXPECT_CALL` is set).

| Mode     | Behavior on Uninteresting Calls                 |
|----------|------------------------------------------------|
| NiceMock | Suppresses warnings, allows any calls.         |
| NaggyMock| Prints warnings on uninteresting call (default).|
| StrictMock | Treats uninteresting calls as test failures. |

### 4.1 How to Use

Wrap your mock class in one of these templates:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;
NaggyMock<MockFoo> naggy_mock;
StrictMock<MockFoo> strict_mock;
```

Each variant inherits the constructors of the underlying mock class.

### 4.2 When to Use

- Use **NiceMock** when you want to ignore calls you don't care about.
- Use **NaggyMock** (default) during development to catch unexpected calls with warnings.
- Use **StrictMock** when you want to enforce that only explicitly expected calls happen.

### 4.3 Limitations

- These wrappers affect only mock methods directly defined with `MOCK_METHOD`.
- Destructors should be virtual for proper behavior.

---

## 5. Example Walkthrough: Basic Mocking Scenario

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;
using ::testing::_;

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetValue() const = 0;
  virtual void SetValue(int val) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int val), (override));
};

TEST(FooTest, BasicMockInteraction) {
  MockFoo mock;

  // Expect GetValue() to be called exactly twice, returning 42 each time
  EXPECT_CALL(mock, GetValue())
      .Times(2)
      .WillRepeatedly(Return(42));

  // Expect SetValue to be called once with argument 7
  EXPECT_CALL(mock, SetValue(7)).Times(1);

  // Simulate calls
  EXPECT_EQ(42, mock.GetValue());
  mock.SetValue(7);
  EXPECT_EQ(42, mock.GetValue());
}
```

**Expected output:** Test passes, verifying expectations.

---

## 6. Best Practices and Tips

- Always mock virtual methods; virtual destructors are mandatory.
- Prefer using `ON_CALL` for default behavior and `EXPECT_CALL` where call verification is required.
- Order `EXPECT_CALL`s from general to specific so that more specific expectations override the general ones.
- Use `NiceMock` to reduce noise from uninteresting calls.
- Use `.RetiresOnSaturation()` on expectations that should deactivate after fulfilling expected calls to avoid sticky expectations.
- For overloaded functions, specify the exact overload using `Const()` wrapper or explicit signatures.

---

## 7. Troubleshooting Common Issues

### Unexpected Method Called

- Verify you have an `EXPECT_CALL` for the method with matching arguments.
- Use the `--gmock_verbose=info` flag to see mock call trace and why calls matched or did not.

### Warning: Uninteresting Call

- Use `NiceMock` if you want to suppress this warning.
- Add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` to signal calls are expected but unimportant.

### MOCK_METHOD Cannot Parse Arguments

- Wrap argument types containing commas in parentheses or use type aliases.

### Mock Method Not Called

- Confirm the test code actually exercises the mock.
- Ensure the mock object's lifetime covers the calls.
- Use verbose or debug options to trace the calls made.

### Mock Methods with Move-Only Types

- Use lambdas or functors in `WillOnce` and `WillRepeatedly` where necessary.

---

## 8. Next Steps and Related Documentation

- Explore [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for a beginner-friendly tutorial.
- Study the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes.
- Learn about matchers and actions in detail in the [Matchers Reference](reference/matchers.md) and [Actions Reference](reference/actions.md).
- Understand strictness levels with [Strict, Nice, and Naggy Mocks](reference/mocking-api/strict-nice-mocks).
- Review how to mock methods with move-only types and overloaded methods via the GoogleMock API Reference.

---

For the official GoogleMock repository and latest examples, visit [GoogleTest GitHub](https://github.com/google/googletest).


---

**Files Used and References:**
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [gMock for Dummies](docs/gmock_for_dummies.md)
- [Strict, Nice, and Naggy Mocks](googlemock/include/gmock/gmock-nice-strict.h)

