---
title: "Getting Started with Mocking"
description: "An introductory tutorial to GoogleMock, illustrating how to define and use mock objects in unit tests. Covers the core workflow of creating mock classes, specifying expectations, and verifying interactions, enabling users to isolate dependencies for robust test coverage."
---

# Getting Started with Mocking

An introductory tutorial to GoogleMock, illustrating how to define and use mock objects in unit tests. Covers the core workflow of creating mock classes, specifying expectations, and verifying interactions, enabling users to isolate dependencies for robust test coverage.

---

## 1. What You Will Learn

This guide will help you master the fundamentals of using GoogleMock by walking you through:

- Creating mock classes using `MOCK_METHOD` macros
- Setting up expectations on mock methods with `EXPECT_CALL`
- Specifying default behaviors via `ON_CALL`
- Verifying interactions and ensuring your tests isolate dependencies

### Prerequisites

- A working GoogleMock setup (see [Prerequisites & Requirements](https://google.github.io/googletest/getting-started/setup-installation/prerequisites-requirements) and [Installation Guide](https://google.github.io/googletest/getting-started/setup-installation/installing-standard-platforms))
- Basic familiarity with C++ and GoogleTest unit tests

### What You'll Achieve

By completing this guide, you will confidently:

- Define mock classes that simulate interfaces or dependencies
- Write tests that verify the order, arguments, and frequency of calls to mocks
- Use default behaviors to control mock responses when precise verification is unnecessary

### Estimated Time

About 15-30 minutes depending on your pace and familiarity.

Difficulty Level: **Beginner**

---

## 2. Step-by-Step Workflow

### Step 1: Define a Mock Class

To mock an interface or class, derive your mock from the original class and define mocked methods with the `MOCK_METHOD` macro in the `public:` section, regardless of the base class method's access level.

```cpp
#include <gmock/gmock.h> // Include GoogleMock headers

class SomeInterface {
 public:
  virtual ~SomeInterface() = default;
  virtual int Compute(int x) const = 0;
  virtual void Log(const std::string& msg) = 0;
};

class MockSomeInterface : public SomeInterface {
 public:
  MOCK_METHOD(int, Compute, (int x), (const, override));
  MOCK_METHOD(void, Log, (const std::string& msg), (override));
};
```

**Tips:**
- Wrap complex return or argument types with parentheses if commas cause parsing issues.
- Use type aliases to simplify template or compound types.

### Step 2: Set Expectations Using `EXPECT_CALL`

Specify how your mock methods should be called within your test cases.

```cpp
using ::testing::Return;
using ::testing::_; // Wildcard matcher

TEST(MyTestSuite, TestCompute) {
  MockSomeInterface mock;

  // Expect Compute to be called once with any int and return 42.
  EXPECT_CALL(mock, Compute(_))
      .WillOnce(Return(42));

  // Call the method (simulate usage)
  int result = mock.Compute(100);
  EXPECT_EQ(result, 42);
}
```

**Key notes:**
- `EXPECT_CALL` must be set before exercising the mock.
- Use matchers like `_` to accept any argument.
- You can chain multiple `.WillOnce()` to specify different behaviors per call.

### Step 3: Define Default Behaviors Using `ON_CALL`

Set default behavior when you do not need to verify a call but want to control the return value.

```cpp
using ::testing::Return;

TEST(MyTestFixture, TestDefaultBehavior) {
  MockSomeInterface mock;

  // By default, Compute returns -1 if no explicit expectation.
  ON_CALL(mock, Compute(_)).WillByDefault(Return(-1));

  // No expect call, but call returns -1.
  EXPECT_EQ(mock.Compute(5), -1);
}
```

Remember, `ON_CALL` **does not** verify that the call happens, unlike `EXPECT_CALL`.

### Step 4: Run Tests and Verify Interactions

GoogleMock automatically verifies that all `EXPECT_CALL` expectations are satisfied when the mock object is destroyed or at test end. If calls violate expectations, GoogleMock reports errors immediately.

**Best practice:**
- Use `NiceMock<T>` to suppress warnings from uninteresting calls when you don't care about every method.
- Use `StrictMock<T>` to fail tests on unexpected or uninteresting calls.


testing::NiceMock<MockSomeInterface> nice_mock;
EXPECT_CALL(nice_mock, Compute(42));
...

### Step 5 (Optional): Control Call Order with Sequences

To enforce order, use `InSequence` to group expectations that must be met sequentially.

```cpp
using ::testing::InSequence;

TEST(OrderedCalls, VerifySequence) {
  MockSomeInterface mock;

  {
    InSequence seq; // Expectations in this scope apply order constraints
    EXPECT_CALL(mock, Log("Start"));
    EXPECT_CALL(mock, Compute(1));
    EXPECT_CALL(mock, Log("End"));
  }

  // Tests need to call methods in order
  mock.Log("Start");
  mock.Compute(1);
  mock.Log("End");
}
```

**If called out-of-order, the test fails immediately.**

---

## 3. Illustrated Examples

### Example 1: Simple Mock and Single Expectation

```cpp
class MockPrinter {
 public:
  MOCK_METHOD(void, Print, (const std::string& text), (override));
};

TEST(PrinterTest, SimplePrint) {
  MockPrinter mock_printer;

  EXPECT_CALL(mock_printer, Print("Hello World"));

  // The following call will satisfy the expectation.
  mock_printer.Print("Hello World");
}
```

### Example 2: Multiple Repeated Returns

```cpp
class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
};

TEST(CalcTest, MultipleReturns) {
  MockCalculator mock_calc;

  EXPECT_CALL(mock_calc, Add(_, _))
      .WillOnce(Return(3))
      .WillOnce(Return(4))
      .WillRepeatedly(Return(5));

  EXPECT_EQ(mock_calc.Add(1, 1), 3);
  EXPECT_EQ(mock_calc.Add(2, 2), 4);
  EXPECT_EQ(mock_calc.Add(3, 3), 5);
  EXPECT_EQ(mock_calc.Add(4, 4), 5);
}
```

### Example 3: Suppressing Uninteresting Call Warnings with NiceMock

```cpp
using ::testing::NiceMock;

class MockLogger {
 public:
  MOCK_METHOD(void, Log, (const std::string& message), (override));
};

TEST(LoggerTest, NiceMockUsage) {
  NiceMock<MockLogger> mock_logger;

  EXPECT_CALL(mock_logger, Log("Start"));

  mock_logger.Log("Start");   // Expected
  mock_logger.Log("Debug");   // No warning, ignored
}
```

---

## 4. Troubleshooting & Tips

### Common Issues

- **Mock methods not called as expected:** Make sure `EXPECT_CALL` is set *before* code execution.
- **Uninteresting call warnings:** Use `NiceMock<T>` or add permissive expectations (`EXPECT_CALL(...).Times(AnyNumber())`).
- **Failed expectations due to call order:** Use sequences (`InSequence`) to specify expected call order.
- **Compile errors from complex types in `MOCK_METHOD`:** Wrap return or argument types with parentheses or use `using` alias.

### Best Practices

- Mock only what you own or control to avoid coupling your tests to external changes.
- Prefer `ON_CALL` for default behaviors and `EXPECT_CALL` only when you intend to verify method calls.
- Avoid over-specifying parameters to keep tests resilient to code refactoring.
- Use `RetiresOnSaturation()` and sequences to manage complex call expectations.

### Performance Considerations

- To reduce compile time with large mocks, define mock class constructors and destructors outside the class body, in `.cc` files.

---

## 5. Next Steps & Related Content

- Explore **Advanced Mocking Concepts**: [Complex Expectations and Actions](https://google.github.io/googletest/guides/mocking-masterclass/expectations-actions-flows)
- Learn about **Custom Matchers and Mock Methods**: [Custom Matchers](https://google.github.io/googletest/guides/mocking-masterclass/custom-matchers-mocks)
- Read about **Mock Strictness Levels**: [Naggy, Nice, and Strict Mocks](https://google.github.io/googletest/guides/mocking-masterclass/mock-class-strictness)
- Delve into **Test Discovery and Build Integration** for seamless use: [Test Discovery and Build Integration](https://google.github.io/googletest/guides/getting-started/test-discovery-setup)

For groundwork on testing and mocks, the following are invaluable:
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Mocking for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)

Check out installation and setup guides if you havenâ€™t configured yet:
- [Prerequisites & Requirements](https://google.github.io/googletest/getting-started/setup-installation/prerequisites-requirements)
- [Installing on Standard Platforms](https://google.github.io/googletest/getting-started/setup-installation/installing-standard-platforms)

---

Stay confident and enjoy the clarity and control that GoogleMock brings to your unit testing journey.