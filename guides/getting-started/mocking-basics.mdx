---
title: "Mocking Basics with GoogleMock"
description: "A hands-on walkthrough of creating mock classes, using EXPECT_CALL and ON_CALL, and writing effective mock-based tests. This page introduces the key concepts of mocking in C++ and common patterns for dependency isolation."
---

# Mocking Basics with GoogleMock

A hands-on walkthrough of creating mock classes, using `EXPECT_CALL` and `ON_CALL`, and writing effective mock-based tests. This page introduces the key concepts of mocking in C++ and common patterns for dependency isolation.

---

## 1. Introduction to Mocking with GoogleMock

GoogleMock (gMock) enables you to create mock classes easily and specify expectations on their methods to test interactions between components. This page guides you through the basics of defining mock classes using the `MOCK_METHOD` macro, setting up behavior using `ON_CALL`, and expressing expectations with `EXPECT_CALL`.

**Key Objective:** Learn how to isolate dependencies by mocking interfaces or classes to write robust, reliable unit tests in C++.

---

## 2. Prerequisites

- Familiarity with C++ class inheritance and virtual methods.
- Basic understanding of unit testing and test doubles.
- GoogleMock library installed and properly configured in your build environment.

Refer to the [Installing and Setting Up GoogleTest & GoogleMock](../getting-started/installing-and-setting-up) guide for installation details.

---

## 3. Creating Mock Classes

To create mocks, define a subclass of the interface or base class you want to mock. Use the `MOCK_METHOD` macro in the `public:` section to specify each virtual method you want to mock.

### Syntax
```cpp
class MockClass : public BaseClass {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
};
```

- `ReturnType`: The return type of the method.
- `MethodName`: The method name.
- `Args...`: Method argument list enclosed in parentheses.
- `Qualifiers`: Optional list like `(const, override)`.

### Examples
```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Important Notes
- Always define mock methods in the `public:` section regardless of the original method's access level.
- If method arguments or return types contain commas (e.g., templated types like `std::pair`), wrap the type in parentheses or create type aliases to avoid compile errors.

---

## 4. Setting Default Behavior with ON_CALL

`ON_CALL` defines default behavior for mock method calls but does *not* set any call-count expectations.

### Usage
```cpp
ON_CALL(mock_object, Method(matchers...))
    .WillByDefault(action);
```

Defaults allow your mock to behave sensibly when a method is called without an explicit expectation.

### Example
```cpp
MockTurtle turtle;
ON_CALL(turtle, GetX()).WillByDefault(Return(42));
```
Calling `turtle.GetX()` now returns 42 by default.

---

## 5. Setting Expectations with EXPECT_CALL

`EXPECT_CALL` both sets expectations on method calls (e.g., how often and with what arguments a mock method should be called) and can specify behavior.

### General Syntax
```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `Times(cardinality)`: How many times the method should be called.
- `WillOnce(action)`: Behavior for a single call.
- `WillRepeatedly(action)`: Behavior after all `WillOnce` actions are used.

### Example
```cpp
EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1))
    .WillOnce(Return())  // void return
    .WillRepeatedly(Return());
```

### Important Guidelines
- Set expectations *before* exercising the code.
- Use matchers (e.g., `_` for any argument) to be flexible.
- If you do not specify `Times()`, GoogleMock infers it based on `WillOnce` and `WillRepeatedly` clauses:
  - No Will clauses → Times(1)
  - N WillOnce, no WillRepeatedly → Times(N)
  - N WillOnce and WillRepeatedly → Times(AtLeast(N))
- Use `.RetiresOnSaturation()` if you want expectations to become inactive after they are met.

---

## 6. Using Matchers

Matchers specify argument conditions in `EXPECT_CALL` and `ON_CALL`.

- Use `_` to match any argument.
- Use built-in matchers like `Eq(value)`, `Ge(value)`, `NotNull()`, etc.

### Example
```cpp
EXPECT_CALL(turtle, GoTo(50, _));  // Matches calls where x=50, y any value
EXPECT_CALL(turtle, Forward(Ge(100)));  // Forward called with distance >= 100
```

---

## 7. Nice, Naggy, and Strict Mocks

Mock objects can be wrapped with modifiers to alter behavior on calls for which no `EXPECT_CALL` is set.

- **NiceMock<T>**: Suppresses warnings on unexpected calls (default recommended for stable tests).
- **NaggyMock<T>** (default behavior without wrapper): Warns about unexpected calls.
- **StrictMock<T>**: Fails the test if unexpected calls occur.

### Usage
```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> nice_turtle;
EXPECT_CALL(nice_turtle, PenDown());
```

---

## 8. Writing Tests Using Mocks

### Basic Test Flow
1. Create mock object.
2. Define default behaviors with `ON_CALL` (optional).
3. Define expectations with `EXPECT_CALL`.
4. Exercise code using the mock.
5. Automatic verification of call expectations on mock destruction.

### Example
```cpp
#include <gmock/gmock.h>

using ::testing::AtLeast;
using ::testing::Return;

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;
  ON_CALL(turtle, GetX()).WillByDefault(Return(0));
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  EXPECT_CALL(turtle, Forward(100));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 100));
}
```

---

## 9. Best Practices and Tips

- Prefer using interfaces (abstract base classes) to mock instead of concrete classes.
- Use `ON_CALL` to define generic or default mock behavior and limit `EXPECT_CALL` to calls you want to verify.
- Avoid over-specifying expectations to prevent brittle and hard-to-maintain tests.
- Use `RetiresOnSaturation()` or `InSequence` to handle ordered call expectations.
- Choose the appropriate strictness modifier (`NiceMock`, `NaggyMock`, or `StrictMock`) based on your testing scenario.
- Wrap complex argument matching logic in custom matchers.

---

## 10. Troubleshooting Common Mocking Issues

- **MOCK_METHOD compilation errors with commas in types:** Wrap the type in parentheses or typedef it.
- **Uninteresting call warnings:** Use `NiceMock` to suppress them if they are expected.
- **Unexpected calls causing failures:** Define explicit expectations or catch-all expectations.
- **Over-saturated calls:** Make sure call counts match expectations or use `.RetiresOnSaturation()`.
- **Ambiguous method overloads:** Help the compiler by specifying matchers precisely or using `Const()` to disambiguate.

---

## 11. Additional Resources

- [GoogleTest Primer](../overview/introduction-core-value/what-is-googletest)
- [gMock Cookbook](gmock_cook_book.md): Recipes and patterns for advanced mocking techniques.
- [gMock Cheat Sheet](gmock_cheat_sheet.md): Quick reference for common gMock macros and usage.
- [Mocking Reference](reference/mocking.md): Detailed API documentation.
- [Installing and Setting Up GoogleTest & GoogleMock](../guides/getting-started/installing-and-setting-up)

---

For complex mocking patterns, consider exploring the Advanced Mocking Patterns page.

<Check>
Always ensure your mock methods are defined `public:` no matter their base access level.
Use `EXPECT_CALL` judiciously — verify only what matters to keep tests maintainable.
Suppress uninteresting call warnings with `NiceMock` but avoid using `StrictMock` unless necessary.
</Check>
