---
title: "Introduction to Mocking"
description: "Covers how to define, use, and understand mock objects with GoogleMock, including the creation of mock classes and setting initial expectations on mocked behaviors."
---

# Introduction to Mocking

Master the essential techniques for defining and using mock objects with GoogleMock. This guide demonstrates how to create mock classes, set up initial expectations on mocked behaviors, and effectively control interactions in your C++ tests for robust and isolated unit testing.

---

## Workflow Overview

**What this guide helps you do:**
- Define mock classes by mocking virtual methods from interfaces or base classes.
- Set expectations on mock objects for method calls and argument verification.
- Specify behaviors and return values of mock methods using GoogleMock syntax.

**Prerequisites:**
- Familiarity with C++ interfaces and virtual methods.
- Basic understanding of GoogleTest framework and C++ testing.
- GoogleMock (`gmock`) included and configured in your project.

**Expected Outcome:**
- Confidently create mock classes using the `MOCK_METHOD` macro.
- Write tests that set expectations on mock methods with `EXPECT_CALL`.
- Distinguish between setting default behaviors and expectations.

**Time Estimate:**
- 15-30 minutes to read and apply initial examples.

**Difficulty Level:**
- Beginner to Intermediate (focus on practical usage).

---

## Defining Mock Classes

GoogleMock automates creation of mock methods using the `MOCK_METHOD` macro. Follow these steps:

### Step 1: Derive Your Mock Class
Create a subclass of the interface or abstract class you want to mock.

### Step 2: Use `MOCK_METHOD` Macro
In the mock class's `public:` section, declare each virtual method you need to mock with `MOCK_METHOD`.

- Syntax:
  ```cpp
  MOCK_METHOD(ReturnType, MethodName, (Arguments...), (Qualifiers));
  ```

- Key points:
  - Always define mock methods in `public:` regardless of base class access level.
  - Qualifiers specify method properties such as `const` or `override`.
  
### Step 3: Handle Functions with Commas in Types
If return type or argument types contain commas (e.g., `std::pair<int, int>`), surround the type with extra parentheses or use type aliases.

### Practical Example

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

You do not need to define these methods elsewhere; the macro generates implementations.

---

## Using Mocks in Tests

Once your mock class is defined, a typical test flow includes:

1. **Create mock objects.**
2. **Set expectations** using `EXPECT_CALL` to specify which methods should be called, with what arguments, how many times, and what they return.
3. **Optionally set default behaviors** using `ON_CALL` to specify default actions without setting call expectations.
4. **Execute test code that uses the mock.**
5. **GoogleMock automatically verifies expectations** upon mock destruction.

### Setting Expectations with `EXPECT_CALL`

- General syntax:

  ```cpp
  EXPECT_CALL(mock_object, MethodName(matchers...))
      .Times(cardinality)
      .WillOnce(action)
      .WillRepeatedly(action);
  ```

- Matchers specify expected arguments. Use `_` for wildcards.
- Cardinalities define how many times the method should be called (`Times(1)`, `AtLeast(2)`, etc).
- Specify actions to return values or perform side effects.

### Example: Verifying Method Calls

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;

TEST(PainterTest, DrawsWithPenDown) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(AtLeast(1));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

If `PenDown()` is not called as expected, the test fails with a detailed message.

### Setting Default Behavior with `ON_CALL`

Sometimes you want your mock methods to have default behaviors for calls, but don't want to enforce an expectation that they are called.

```cpp
ON_CALL(mock_object, MethodName(matchers...))
    .WillByDefault(action);
```

This sets a fallback behavior when there is no matching `EXPECT_CALL`.

---

## Best Practices and Tips

- **Set expectations before exercising the code under test.** Late expectation setting leads to undefined behavior.
- Use `EXPECT_CALL` to specify calls you want to verify; use `ON_CALL` for default behaviors without enforcing call counts.
- If you want to ignore uninteresting calls (methods without any expectation set), use `NiceMock<YourMock>` to suppress warnings.
- Use matchers judiciouslyâ€”do not over-specify arguments unless necessary to avoid brittle tests.
- Use sequences (`InSequence`) to enforce order when needed.
- For methods with many arguments or complex types, consider creating type aliases or wrapper methods to simplify mocking.
- Remember destructors in interfaces should always be virtual to avoid resource leaks.

---

## Troubleshooting Common Issues

- **Mocked method calls real method instead:** Ensure the base method is `virtual`.
- **MOCK_METHOD macro errors with commas in types:** Wrap return or argument types with extra parentheses or use type aliases.
- **Warnings about uninteresting calls:** Consider whether you need to add an expectation or use a `NiceMock`.
- **Unexpected calls failure:** Double-check matchers and call orders; enable verbose mode (`--gmock_verbose=info`) to trace calls.
- **Mock objects not verifying expectations:** Verify mocks are properly destroyed or use `Mock::VerifyAndClearExpectations(&mock_obj)` manually.

---

## Next Steps & Related Content

- Explore [Setting Expectations and Default Actions](https://google.github.io/googletest/gmock_cook_book.html#UseOnCall) for controlling mock method behaviors in depth.
- Read about [Matchers](reference/matchers.md) to learn flexible argument validation.
- Understand [The Nice, the Strict, and the Naggy](gmock_cook_book.md#NiceStrictNaggy) for controlling mock strictness.
- Combine mocking with [GoogleTest Primer](guides/getting-started/primer-basics) to write your first assertions.
- Review [Common Issues and Troubleshooting](getting-started/troubleshooting-help/common-issues) to solve frequent problems.

---