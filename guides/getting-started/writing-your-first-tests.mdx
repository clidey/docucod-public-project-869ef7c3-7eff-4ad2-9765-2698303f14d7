---
title: "Writing Your First Unit Test"
description: "Step through authoring your first tests using GoogleTest and GoogleMock. This guide introduces basic test structure, suite organization, and using assertions and simple mocks—ideal for users new to the framework or to automated C++ testing."
---

# Writing Your First Unit Test

Welcome to your first step in writing automated C++ tests using GoogleTest and GoogleMock. This guide will walk you through authoring your initial tests, introducing the basic test structure, organizing tests into suites, and using simple assertions and mocks. Whether you're new to unit testing or just new to this framework, these instructions will set a solid foundation.

---

## 1. Workflow Overview

- **Task Description:** Learn how to write your first basic test case using GoogleTest and GoogleMock.
- **Prerequisites:**
  - Have GoogleTest and GoogleMock installed and configured in your build environment.
  - Basic knowledge of C++ programming.
- **Expected Outcome:**
  - Ability to define a test case and test suite.
  - Understand how to write assertions.
  - Create and use a simple mock class.
- **Time Estimate:** Approximately 20-30 minutes.
- **Difficulty Level:** Beginner

## 2. Writing Your First Test

### Step 1: Include the Necessary Headers

Start by including the GoogleTest and GoogleMock headers in your test source file.

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>  // If you plan to use mocks.
```

### Step 2: Create Your First Test Case

GoogleTest uses the `TEST` macro to define a test case. It takes two parameters: a test suite name and a test name.

Example of a simple test check:

```cpp
TEST(ExampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
  EXPECT_NE(2 * 2, 5);
}
```

- `EXPECT_EQ` asserts that the two arguments are equal.
- `EXPECT_NE` asserts that the two arguments are not equal.
- If an expectation fails, GoogleTest logs a failure but proceeds with the rest of the test.

### Step 3: Define a Mock Class

If your tests depend on external objects or interfaces, use GoogleMock to create mock objects that let you define expected interactions.

Example: Suppose you have an interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
};
```

You can define a mock class as:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};
```

The `MOCK_METHOD` macro creates mock versions of virtual functions for you.

### Step 4: Use Mocks in a Test

Here is a simple test using the `MockTurtle`.

```cpp
using ::testing::AtLeast;

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
    .Times(AtLeast(1));

  // Your production code class, which uses Turtle.
  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 5));
}
```

- `EXPECT_CALL` defines that `PenDown()` should be called at least once.
- When `painter.DrawCircle()` runs, the mock verifies this expectation.

### Step 5: Build and Run Your Tests

Compile your test binary linking with GoogleTest and GoogleMock.

Run the test:

```bash
./your_test_executable
```

Expected output:

```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from ExampleTest
[ RUN      ] ExampleTest.BasicAssertions
[       OK ] ExampleTest.BasicAssertions (0 ms)
[----------] 1 test from ExampleTest (0 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

If expectations are not met, GoogleTest and GoogleMock will report explicit failures.

---

## 3. Working with Assertions

Learn the basic assertions to express expectations in your tests:

- `EXPECT_EQ(val1, val2)` - checks equality, reports failure but continues.
- `ASSERT_EQ(val1, val2)` - checks equality and aborts test on failure.
- `EXPECT_TRUE(condition)`, `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)`, `ASSERT_FALSE(condition)`

Choose `ASSERT_` variants to halt tests on critical failures.

---

## 4. Writing and Using Mocks

### a) Defining Mock Methods

- Use `MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));` inside your mock class's public section.
- Always mock virtual methods.
- Add appropriate qualifiers like `const` or `override` in the specs.

Example:

```cpp
class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (const, override));
};
```

### b) Setting Expectations

Before exercising the mocked object, define expectations:

```cpp
EXPECT_CALL(mock_calculator, Add(3, 4))
    .Times(1)
    .WillOnce(::testing::Return(7));
```

- This expects `Add(3, 4)` to be called once, returning 7.
- Use `Times(AnyNumber())` for less strict checks.

### c) Using ON_CALL for Default Behavior

Use `ON_CALL` to specify default behavior without setting required call expectations:

```cpp
ON_CALL(mock_calculator, Add(::testing::_, ::testing::_))
    .WillByDefault(::testing::Return(0));
```

---

## 5. Common Mistakes & Best Practices

- Always set expectations **before** calling the mock methods.
- Mock all pure virtual methods or override if necessary.
- Use matchers like `_` for arguments you don’t care about.
- Avoid over-specifying expectations to keep tests resilient.
- Use `NiceMock<T>` to suppress uninteresting call warnings when appropriate.

---

## 6. Troubleshooting

**Problem:** Test fails because an expected call wasn’t made. 
- Verify your `EXPECT_CALL` for correct arguments and that it’s declared before the call.
- Run your test with `--gmock_verbose=info` for detailed mock call tracing.

**Problem:** Unexpected calls to mock methods.
- Make sure you don’t have unexpected argument values.
- Consider adding a catch-all expectation with `_` matcher and `Times(AnyNumber())` if some calls are allowed but not important.

**Problem:** Mock methods don’t appear to be called due to missing virtual destructors.
- Ensure the base class has a virtual destructor to avoid silent errors.

---

## 7. Next Steps & Related Guides

- Dive deeper into [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for full mock usage.
- Explore [Writing and Using Mocks Effectively](https://google.github.io/googletest/guides/core-workflows/mocking-techniques) for advanced patterns.
- Refer to the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for detailed API.
- Learn about Matchers and Actions in the relevant references.

---

By stepping through this guide, you have learned to write your first unit tests with GoogleTest and GoogleMock. Testing is now within your reach, providing automated validation and enabling confident code changes.

Happy testing!