---
title: "Setting Up and Installing GoogleTest"
description: "A comprehensive, step-by-step guide to installing GoogleTest and GoogleMock in your C++ project, including building from source and integrating with CMake or Bazel. This page ensures a smooth onboarding experience regardless of your build system or platform."
---

# Setting Up and Installing GoogleTest

A comprehensive, step-by-step guide to installing GoogleTest and GoogleMock in your C++ project, including building from source and integrating with CMake or Bazel. This page ensures a smooth onboarding experience regardless of your build system or platform.

---

## 1. Overview

### What You'll Achieve
This guide walks you through obtaining, building, and integrating GoogleTest and GoogleMock into your C++ development environment. Whether you use CMake, Bazel, or manual build techniques, you’ll learn how to set up these frameworks so that you can write and run unit tests and mocks efficiently.

### Prerequisites
- A C++ development environment with a compiler supporting at least C++17.
- Basic understanding of your build system (CMake, Bazel, or manual builds).
- CMake version 3.14 or later if you plan to use CMake for building GoogleTest.
- Git installed or access to the GitHub repository releases.

### Expected Outcome
By completing this setup, you'll be able to:
- Build GoogleTest and GoogleMock from source.
- Integrate GoogleTest into your project builds.
- Run tests using the frameworks’ test runners.
- Customize initialization of GoogleTest and GoogleMock.

### Time Estimate
About 15-30 minutes depending on your build system familiarity.

### Difficulty Level
Beginner to Intermediate (depending on build system experience).

---

## 2. Step-by-Step Installation and Setup

### Step 1: Clone the GoogleTest Repository

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
```

This repository contains both GoogleTest and GoogleMock sources.

### Step 2: Build Using CMake (Standalone)

1. Create a build directory:

   ```bash
   mkdir build && cd build
   ```

2. Generate build files with CMake:

   ```bash
   cmake ..
   ```
   By default, this builds both GoogleTest and GoogleMock.

3. Compile the libraries:

   ```bash
   make
   ```

4. (Optional) Install globally (requires admin rights):

   ```bash
   sudo make install
   ```

#### To build GoogleTest only (no GoogleMock):

```bash
cmake .. -DBUILD_GMOCK=OFF
make
```

### Step 3: Integrate GoogleTest into Your CMake Project

The most straightforward way is to link against the installed `gtest` libraries or include GoogleTest as a subdirectory.

#### Using Installed Libraries

```cmake
find_package(GTest REQUIRED)
add_executable(my_test test.cpp)
target_link_libraries(my_test GTest::gtest_main)
add_test(NAME my_test COMMAND my_test)
```

#### Adding GoogleTest as Subdirectory

```cmake
add_subdirectory(path/to/googletest)
add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main)
add_test(NAME my_test COMMAND my_test)
```

### Step 4: Build Using Bazel

1. Add GoogleTest as a dependency in your WORKSPACE file.
2. Reference the `cc_test` rules in your BUILD files.

(Refer to [GoogleTest Bazel Integration Guide](https://github.com/google/googletest/blob/main/googletest/README.md) for details.)

### Step 5: (Optional) Write Your Own `main()` Function

While GoogleTest and GoogleMock provide default `main()` implementations (`gtest_main` or `gmock_main`), you can provide your own when you need custom initialization (e.g., command-line flag parsing). Here is an example:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

For GoogleMock:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Step 6: Verify the Installation

Create a simple test file `sample_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
}
```

Build it:

```bash
g++ -std=c++17 sample_test.cpp -lgtest -lgtest_main -pthread -o sample_test
```

Run the test:

```bash
./sample_test
```

You should see output indicating that the test passed.

---

## 3. Understanding GoogleMock Integration and Initialization

GoogleMock extends GoogleTest with mocking capabilities.

### Initialization Tips

- Use `testing::InitGoogleMock(&argc, argv);` to properly initialize both GoogleMock and GoogleTest.
- It parses and strips GoogleMock-specific command-line flags (like `--gmock_verbose`) out of `argv`.

Example `main` function with GoogleMock:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

On some embedded or Arduino-like platforms where `argc` and `argv` are not available, use `testing::InitGoogleMock();` without parameters.

### Key Flags

- `--gmock_verbose`: Controls the verbosity of mock framework outputs. E.g., `--gmock_verbose=info`.
- `--gmock_default_mock_behavior`: Sets mock object behavior - nice, strict, etc.

For detailed usage, visit the [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md).

---

## 4. Practical Tips and Best Practices

- Prefer linking to `gtest_main` or `gmock_main` to avoid writing your own boilerplate `main()`.
- Use CMake’s `add_subdirectory()` for easier integration and to keep GoogleTest in sync with your project.
- Always use compatible versions of GoogleTest and GoogleMock.
- Keep your test binaries separated from your production binaries.
- Regularly update GoogleTest for the latest improvements and fixes.

---

## 5. Troubleshooting Common Setup Issues

<AccordionGroup title="Troubleshooting Setup Issues">
<Accordion title="Build Errors with CMake">
- **Problem:** CMake configure fails or can’t find dependencies.
- **Solution:** Ensure CMake version is 3.14 or above.
  Check that compilers support C++17.
  Verify proper Git clone of the repository.
</Accordion>
<Accordion title="Linking Errors">
- **Problem:** Linker complains about unresolved symbols like `RUN_ALL_TESTS()`.
- **Solution:** Make sure to link against `gtest_main` or `gmock_main`.
  Ensure your include and library paths point to the correct GoogleTest installation.
</Accordion>
<Accordion title="GoogleMock Flags Not Recognized">
- **Problem:** Passing GoogleMock flags do not affect behavior.
- **Solution:** Use `testing::InitGoogleMock(&argc, argv);` instead of just `InitGoogleTest`.
  Remove unrecognized flags manually if needed.
</Accordion>
<Accordion title="Tests Not Running or Being Discovered">
- **Problem:** After compilation, tests do not run or are not found.
- **Solution:** Verify that tests are registered correctly with `TEST()` macros.
  Ensure you call `RUN_ALL_TESTS()` in your main function.
</Accordion>
</AccordionGroup>

---

## 6. Additional Resources and Next Steps

- **GoogleTest Primer:** [GoogleTest Primer (docs/primer.md)](/docs/primer.md) – Learn the basics of writing tests.
- **Writing Your First Test:** [Writing Your First Test Guide](/guides/getting-started/writing-first-test) – Practical next steps after setup.
- **Mocking with GoogleMock:** [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md) – Deep dive into the mocking framework.
- **Troubleshooting Setup Issues:** [Troubleshooting Guide](/getting-started/first-steps-usage/troubleshooting-setup) – In-depth help for common problems.
- **Integration with Build Systems:** [Integration FAQ](/faq/advanced-integration/integration-with-build-systems) – How to best integrate with CMake, Bazel, and others.

---

## 7. Summary Diagram

```mermaid
flowchart TD
  A[Clone googletest repo] --> B{Choose Build System}
  B -->|CMake| C[Create build dir]
  C --> D[Run cmake ..]
  D --> E[Run make]
  E --> F[Install or Link in Project]
  B -->|Bazel| G[Setup WORKSPACE and BUILD files]
  G --> F
  F --> H[Write Tests]
  H --> I[Run Tests with RUN_ALL_TESTS()]

  classDef buildSteps fill:#f9f,stroke:#333,stroke-width:1px
  class C,D,E,F,G buildSteps;
```

---