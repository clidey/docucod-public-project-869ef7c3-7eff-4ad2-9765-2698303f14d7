---
title: "Installation and Setup"
description: "Learn how to install and configure GoogleTest and GoogleMock within your C++ project using both CMake and Bazel, ensuring smooth integration into your build system."
---

# Installation and Setup of GoogleTest and GoogleMock

## Overview
This guide walks you through the installation and configuration of **GoogleTest** and **GoogleMock** libraries within your C++ project. It focuses on integrating these testing frameworks using two common build systems:

- **CMake**
- **Bazel**

Ensuring smooth integration into your build process allows you to write, build, and run tests efficiently with GoogleTest's powerful test and mock capabilities.

---

## Prerequisites
Before starting, ensure you have the following prepared:

- A C++17-compliant compiler (refer to [Prerequisites & System Requirements](/getting-started/requirements-installation/prerequisites-system-requirements) for detailed info).
- Installed build tools:
  - For CMake builds: CMake 3.14 or higher
  - For Bazel builds: Bazel installed and configured
- A basic knowledge of your project's existing build system.


## Working with CMake

### Step 1: Clone the Repository
Clone the latest stable GoogleTest repository which includes GoogleMock by default.

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
```

### Step 2: Create a Build Directory
Create and enter a separate directory to keep build files organized.

```bash
mkdir build
cd build
```

### Step 3: Generate Build Files with CMake
By default, GoogleMock is included. Run:

```bash
cmake ..
```

**Optional:** To build **only** GoogleTest without GoogleMock, use:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### Step 4: Build the Libraries
- On Linux/macOS, simply run:

  ```bash
  make
  ```

- On Windows with Visual Studio installed, open the generated solution file `.sln` and build.

### Step 5: Install (Optional)
If you want to install the compiled libraries to your system default path (usually `/usr/local/` on Unix-like systems):

```bash
sudo make install
```

### Step 6: Integrate GoogleTest & GoogleMock into Your Project
You have two main options:

#### Option A: Use Installed Libraries
Use `find_package` in your `CMakeLists.txt`:

```cmake
find_package(GTest REQUIRED)

add_executable(my_tests test1.cpp)
target_link_libraries(my_tests GTest::gtest GTest::gmock_main)
```

*Ensure that the installed libraries and headers are discoverable by CMake.*

#### Option B: Incorporate Source via `add_subdirectory`
Embed GoogleTest source in your project and add:

```cmake
add_subdirectory(path/to/googletest)

add_executable(my_tests test1.cpp)
target_link_libraries(my_tests gtest gmock_main)
```

This approach ensures consistent compiler and linker flags across your project and GoogleTest.

### Tips & Best Practices
- For Visual Studio users, consider the `gtest_force_shared_crt` option to align runtime linkage and avoid linker errors:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

- Always ensure your compiler supports C++17, which GoogleTest requires.
- Run `RUN_ALL_TESTS()` once in your `main()` function to avoid unexpected test behavior.

---

## Working with Bazel

### Step 1: Add GoogleTest and GoogleMock as Dependencies
In your Bazel `WORKSPACE` file, declare the external repository:

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/main.zip"],
    strip_prefix = "googletest-main",
)
```

### Step 2: Reference in BUILD files
In your Bazel `BUILD` file, depend on the `gmock` and `gtest` targets:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//googletest:gtest_main", "@com_google_googletest//googlemock:gmock_main"],
)
```

### Step 3: Run Tests
Use Bazel's test runner:

```bash
bazel test //path/to:my_test
```

This command builds and runs your tests using GoogleTest and GoogleMock seamlessly.

---

## Verifying Your Setup

After installation and integration, verify with a minimal test:

```c++
#include <gtest/gtest.h>
#include <gmock/gmock.h>

TEST(SanityTest, GoogleTestWorks) {
    EXPECT_EQ(1, 1);
}

int main(int argc, char** argv) {
    testing::InitGoogleMock(&argc, argv);
    return RUN_ALL_TESTS();
}
```

Build and run this test. Successful execution confirms your setup is operational.

---

## Common Pitfalls and Solutions

<AccordionGroup title="Troubleshooting Common Setup Issues">
<Accordion title="Linker Errors with Runtime Libraries on Windows">
When you encounter mismatches like `RuntimeLibrary MTd_StaticDebug vs MDd_DynamicDebug`, enable the dynamic CRT option:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

Rebuild GoogleTest and your project afterward.
</Accordion>
<Accordion title="Missing Headers or Libraries">
Ensure your include paths and library link paths are correctly set. If you built GoogleTest separately, install it or adjust your build scripts accordingly.
</Accordion>
<Accordion title="Compiler Compatibility Issues">
Confirm your compiler supports at least C++17. GoogleTest and GoogleMock require this for modern features.
</Accordion>
<Accordion title="Calling RUN_ALL_TESTS Multiple Times">
Only invoke `RUN_ALL_TESTS()` once in `main()`. Multiple invocations can cause unpredictable behavior and are unsupported.
</Accordion>
</AccordionGroup>

---

## Additional Resources and Next Steps

- Explore the [Writing Your First Test](/getting-started/first-test-validation/writing-your-first-test) guide to start writing tests.
- Refer to the [Running & Validating Tests](/getting-started/first-test-validation/running-and-validating-tests) for more on test execution.
- Consult [Troubleshooting Common Setup Issues](/getting-started/first-test-validation/troubleshooting-common-issues) for advanced help.
- Consider [Exploring Beyond the Basics](/getting-started/next-steps-and-resources/exploring-beyond-basics) to harness advanced mocking patterns and test suite designs.

---

## Summary
Integrate GoogleTest and GoogleMock into your C++ project by choosing your build systemâ€”CMake or Bazel. Follow step-by-step instructions for cloning, building, and linking libraries, ensuring support for C++17 and platform-specific adjustments. Confirm your setup with example tests, and lean on troubleshooting tips to resolve common issues swiftly.

---

## Example CMake Minimal Project Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Add GoogleTest as a subdirectory
add_subdirectory(path/to/googletest)

add_executable(my_tests my_tests.cpp)
target_link_libraries(my_tests gtest gmock_main)
```

## Example Bazel Minimal BUILD Snippet

```python
cc_test(
    name = "my_tests",
    srcs = ["my_tests.cpp"],
    deps = ["@com_google_googletest//googletest:gtest_main", "@com_google_googletest//googlemock:gmock_main"],
)
```

---

## References
- GitHub Repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- [Prerequisites & System Requirements](/getting-started/requirements-installation/prerequisites-system-requirements)
- [Installing on Linux, macOS, and Windows](/getting-started/requirements-installation/installing-on-linux-macos-windows)
- [Writing Your First Test Case](/getting-started/first-test-validation/writing-your-first-test)
- [Troubleshooting Common Setup Issues](/getting-started/first-test-validation/troubleshooting-common-issues)

---

## Callout
<Tip>
Remember, GoogleMock is included by default when you build GoogleTest from source unless explicitly disabled. Initializing GoogleMock using `testing::InitGoogleMock(&argc, argv);` also initializes GoogleTest, so you don't need to call both separately.
</Tip>
