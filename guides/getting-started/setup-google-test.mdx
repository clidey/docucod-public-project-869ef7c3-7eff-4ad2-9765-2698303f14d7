---
title: "Setting Up GoogleTest"
description: "A hands-on walkthrough for installing and configuring GoogleTest in your C++ project, including environment preparation and integrating with build systems like CMake and Bazel."
---

# Setting Up GoogleTest

A hands-on walkthrough for installing and configuring GoogleTest in your C++ project, including environment preparation and integrating with build systems like CMake and Bazel.

---

## Workflow Overview

### What You Will Accomplish
This guide leads you through the essential steps for getting GoogleTest up and running in your C++ project. You will learn how to prepare your environment, install GoogleTest effectively, and integrate it into your build system—particularly using CMake and Bazel.

### Prerequisites
- A C++ development environment with a compiler supporting at least C++17.
- Familiarity with basic command-line operations.
- Installed build system: CMake (version 3.14 or later) or Bazel.
- Access to clone repositories from GitHub.

### Expected Outcome
By the end of this guide, GoogleTest will be properly configured and integrated into your project. You will be ready to write and run tests using GoogleTest’s rich feature set.

### Time Estimate
About **20–30 minutes** depending on your setup and familiarity with build systems.

### Difficulty Level
Beginner to Intermediate.

---

## Step-by-Step Instructions

### 1. Verify Environment Compatibility

Ensure your environment meets the minimum requirements:

- **C++ Standard:** You must have support for C++17. If using CMake, specify this in your `CMakeLists.txt`:

  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

- **Build Tools:** Confirm you have CMake 3.14+ for CMake integration or Bazel for Bazel-based projects.

- **Compiler:** Use a compiler compatible with GoogleTest and supporting the required C++ version.

---

### 2. Obtain GoogleTest Source Code

Clone the repository at a stable release (e.g., v1.17.0) or a commit suited to your project:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
```

Alternatively, you can use this in your CMake build configuration to automate fetching sources.

---

### 3. Build GoogleTest as a Standalone Project (Optional)

This method is useful if you want to build and install GoogleTest separately.

```bash
mkdir build
cd build
cmake ..
make
sudo make install
```

**Note:** To build GoogleTest without GoogleMock (the mocking framework), disable it explicitly:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

On Windows with Visual Studio installed, run:

```powershell
cmake ..
msbuild gtest.sln
```

On macOS with Xcode:

```bash
cmake ..
open googletest.xcodeproj
```

---

### 4. Integrate GoogleTest into Your CMake Project

There are two main ways to integrate GoogleTest into your existing CMake project.

#### a. Using Installed GoogleTest Libraries

If you installed GoogleTest system-wide, you can import it with `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests GTest::gtest_main GTest::gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

This method relies on your system or CI environment having GoogleTest installed.

#### b. Building GoogleTest as a Subdirectory

For tighter coupling and avoiding version mismatch issues, add GoogleTest source to your project:

```cmake
add_subdirectory(path/to/googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

This approach ensures consistent compilation flags and usage.

#### c. Automating Download with CMake FetchContent

CMake 3.14+ lets you download GoogleTest during the configure phase:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # Required for Windows dynamic CRT compatibility

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

This method helps maintain GoogleTest dependencies seamlessly.

---

### 5. Integration with Bazel (Basic Overview)

For Bazel projects, include GoogleTest by adding it as a dependency in your `WORKSPACE` and `BUILD` files. The official repository provides instructions:

1. Add GoogleTest as an external dependency.
2. Reference GoogleTest targets in your Bazel test targets.

Refer to the [GoogleTest Bazel Integration](https://github.com/google/googletest/tree/main/bazel) for detailed examples.

---

### 6. Validate Your Setup

Compile and run example tests to confirm installation:

- Use the provided `gtest_main` target in linking to avoid writing `main()` manually.

- Run your test executable; you should see output indicating tests running and reports.

Example test executable using GoogleTest:

```c++
#include <gtest/gtest.h>

TEST(SampleTest, TrueIsTrue) {
  EXPECT_TRUE(true);
}

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Compile and execute this tests binary to verify.

---

## Practical Tips & Best Practices

- **Use `gtest_main` where possible**: This eliminates the need to define your own `main()`, simplifying test code.
- **Match CRT linkage on Windows:** Use `-Dgtest_force_shared_crt=ON` in your CMake to keep runtime linkage consistent.
- **C++ Standard:** Always enforce C++17 or later across your codebase when using GoogleTest.
- **Multi-threading:** GoogleTest is thread-safe on systems with pthread support. If multi-threading issues arise, check `GTEST_HAS_PTHREAD` macro settings.
- **Build Customization:** Define `GTEST_XYZ` macros at compile time to tweak GoogleTest behavior where needed.
- **Avoid Macro Conflicts:** If you encounter macro name clashes (such as with `TEST`), use `-DGTEST_DONT_DEFINE_TEST=1` and use the prefixed macros like `GTEST_TEST`.

---

## Troubleshooting Common Issues

### Build and Link Errors
- Check that your compiler supports C++17.
- Verify correct library linking: use `gtest_main` or define `main()` properly.
- On Windows, runtime library mismatches cause linker errors; enforce consistent runtime linkage.

### Runtime Errors
- If tests do not run or no output appears, ensure `InitGoogleTest()` is called before `RUN_ALL_TESTS()`.
- Confirm that your tests are not filtered out by flags.

### Multi-Threading Issues
- Use appropriate compiler flags to link pthreads on POSIX systems if errors occur.

Refer to [Troubleshooting Common Setup Issues](https://github.com/google/googletest/blob/main/README.md#troubleshooting) for details.

---

## Next Steps & References

- **Writing Your First Test:** Once setup is complete, learn how to write and run your first tests with the [GoogleTest Primer](../primer.md) and [Writing Your First Test](../guides/getting-started/writing-first-test).
- **Integrating GoogleMock:** To expand testing with mocks, explore [GoogleMock Introduction](../guides/getting-started/googlemock-intro).
- **Advanced Integration:** For custom build systems or advanced use, see [Build System Integration Guide](../guides/integration-advanced/build-system-integration).

---

## Summary
This guide delivered a practical, step-by-step process for installing GoogleTest, preparing your environment, integrating it with CMake or Bazel, and verifying success. Follow these instructions to ensure robust and maintainable test harnesses ready to leverage GoogleTest’s powerful testing tools.

---

## Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Official Website](https://cmake.org/)
- [GoogleTest Primer](../primer.md)
- [GoogleMock Primer](../googlemock/gmock_for_dummies.md)
- [Troubleshooting Common Setup Issues](../getting-started/troubleshooting-resources/troubleshooting-common-issues.md)

---

<Accordion title="Example CMakeLists.txt with GoogleTest Subdirectory"> 
```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Add GoogleTest source as a subdirectory
add_subdirectory(googletest)

# Define your test executable
add_executable(my_tests test.cpp)

# Link GoogleTest libraries
target_link_libraries(my_tests gtest_main gmock_main)

# Register tests with CTest
include(GoogleTest)
gtest_discover_tests(my_tests)
```
</Accordion>

<Accordion title="Visual Studio Notes"> 
On Windows, to avoid runtime mismatch errors:
- Add this line before fetching GoogleTest in your `CMakeLists.txt`:
  
  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```
- This ensures GoogleTest links to the dynamic runtime like your application.
- Alternative is to manually align all CRT linkage settings for your entire project.
</Accordion>
