---
title: "Mocking Your First Functions"
description: "Get started with GoogleMock by creating your first mock class, specifying expectations, and simulating function behaviors using real-world code patterns. This page demonstrates how to introduce mocks into your test suites and validate their interactions."
---

# Mocking Your First Functions

Get started with GoogleMock by creating your first mock class, specifying expectations, and simulating function behaviors using real-world code patterns. This page demonstrates how to introduce mocks into your test suites and validate their interactions.

---

## Overview

This guide helps you create your first mock class in GoogleMock, set expectations on its methods, simulate behaviors, and validate that interactions occur as intended during tests. It moves step-by-step from declaring mocks with `MOCK_METHOD` to setting up default behaviors with `ON_CALL` and verifying calls using `EXPECT_CALL`.

### Prerequisites

- Basic familiarity with C++ and virtual methods.
- GoogleMock installed and integrated in your project.
- A target interface or abstract base class with virtual functions.

### Expected Outcome

By following this guide, you will have:
- Defined a mock class with mocked methods.
- Set default behaviors on mock methods.
- Specified precise expectations on mock interactions.
- Written test cases that verify these expectations.

### Estimated Time

Around 15-30 minutes to write your first mock and associated test.

### Difficulty Level

Beginner to Intermediate

---

## Step-by-Step Instructions

### 1. Define a Mock Class

Begin by declaring a mock class that inherits from the interface or the base class you want to mock. Use the `MOCK_METHOD` macro to mock each virtual method you want to simulate.

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};
```

**Note:** Always declare your mock methods in the `public` section, regardless of the access level of the original methods.

### 2. Create Mock Objects in Your Test

Instantiate your mock class in the test function or test fixture.

```cpp
TEST(FooTest, BasicUsage) {
  MockFoo mock_foo;  // Creating the mock object
}
```

### 3. Set Default Behavior with `ON_CALL`

Use `ON_CALL` to specify the default action of a mock method when no explicit expectation is set. This lets your mock return defined values or perform actions during calls that you don't explicitly expect.

```cpp
using ::testing::Return;

ON_CALL(mock_foo, GetSize()).WillByDefault(Return(42));
```

Here, whenever `GetSize()` is called on `mock_foo` without an expectation, it will return 42.

### 4. Set Expectations with `EXPECT_CALL`

Define that a mock method is expected to be called, optionally specifying how many times, argument matchers, and return actions.

```cpp
EXPECT_CALL(mock_foo, Describe("test"))
    .Times(1)
    .WillOnce(Return("Description for test"));
```

This expects exactly one call to `Describe` with argument "test", returning the given string.

### 5. Exercise Code Using The Mock

Invoke your production or test code that uses the mock.

```cpp
EXPECT_EQ("Description for test", mock_foo.Describe("test"));
```

### 6. Automatic Verification

When the mock object is destructed at the end of the test, GoogleMock automatically verifies that all expectations have been satisfied. If any expectations are unmet or calls violate expectations, test failures are reported.

### 7. Suppressing Warnings on Uninteresting Calls

By default, calls to methods without `EXPECT_CALL` produce warnings. To suppress these warnings for your mock:

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;

NiceMock<MockFoo> nice_mock_foo;
```

This makes the mock "nice" and ignores uninteresting calls.

### 8. Using Sequences for Ordered Calls

To specify that mock calls must occur in a particular order, use the `Sequence` object:

```cpp
Sequence s;
EXPECT_CALL(mock_foo, GetSize()).InSequence(s);
EXPECT_CALL(mock_foo, Describe(_)).InSequence(s);
```

Calls will be checked to occur in this specified order.

---

## Examples

### Complete Simple Test Example

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
};

TEST(FooTest, GetSizeReturnsExpectedValue) {
  MockFoo mock_foo;

  ON_CALL(mock_foo, GetSize()).WillByDefault(::testing::Return(100));

  EXPECT_CALL(mock_foo, Describe("hello"))
      .Times(1)
      .WillOnce(::testing::Return("Hello world"));

  EXPECT_EQ(100, mock_foo.GetSize());
  EXPECT_EQ("Hello world", mock_foo.Describe("hello"));
}
```

### Using Sequences to Enforce Call Order

```cpp
Sequence my_sequence;
EXPECT_CALL(mock_foo, GetSize()).InSequence(my_sequence);
EXPECT_CALL(mock_foo, Describe(_)).InSequence(my_sequence);
```

The above forces `GetSize` to be called before `Describe`.

---

## Troubleshooting & Tips

### Common Issues

- **Missing virtual destructors**: Ensure your mocked interfaces have virtual destructors to avoid undefined behavior.
- **EXPECT_CALL after call execution**: Always set expectations before the code executing the mock method to avoid undefined behavior.
- **Too many or too few `WillOnce` actions**: GoogleMock warns if the number of `WillOnce` actions doesn't match the expected number of calls.

### Best Practices

- Use `ON_CALL` for default behaviors and `EXPECT_CALL` for specific expectations and verifications.
- Group related ordered expectations inside an `InSequence` scope for clearer intent.
- Use wildcard matcher `_` when you do not care about arguments.
- Use `NiceMock` when you want to suppress warnings for uninteresting calls.

### Performance Considerations

- Move mock class constructor and destructor implementations into `.cc` files to improve build times.

### Alternative Approaches

- For complex mocking behaviors, consider delegating to a fake or real implementation using `ON_CALL`.

---

## Next Steps & Related Content

- **Writing Your First Unit Tests**: Learn how to write basic GoogleTest unit tests.
- **Mocking Overloaded Methods and Templates**: Explore techniques for mocking overloaded functions and class templates.
- **Controlling Mock Strictness**: Understand how to manage warnings and failures on uninteresting calls.
- **Custom Matchers and Actions**: Extend GoogleMock beyond default capabilities.

---

## References

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) - quick access to mock syntax and usage.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.md) - detailed API reference for mocks.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - recipes for common mocking scenarios.

---

## Additional Tips

When mocking methods that return references, use `ReturnRef()`. For methods requiring multiple return behaviors, chain `.WillOnce()` multiple times followed optionally by `.WillRepeatedly()`. Control call expectations with cardinality clauses like `.Times()`. Always clean up mocks to ensure verification triggers; if you allocate mocks on the heap, consider calling `Mock::VerifyAndClearExpectations()` explicitly.

---

**Empower your tests by introducing mocking early. GoogleMockâ€™s intuitive syntax lets you specify what you expect and then catch deviations immediately, improving design and confidence. Happy mocking!**
