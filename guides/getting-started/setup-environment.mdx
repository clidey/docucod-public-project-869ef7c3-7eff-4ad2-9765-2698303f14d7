---
title: "Setting Up Your Testing Environment"
description: "Comprehensive steps for installing GoogleTest and GoogleMock, configuring your build system (CMake/Bazel), and integrating the libraries into your project. Includes troubleshooting for common build issues and recommendations for CI workflows."
---

# Setting Up Your Testing Environment

## Workflow Overview

This guide walks you through the essential steps to install GoogleTest and GoogleMock, configure your build environment using CMake or Bazel, and integrate these testing libraries into your C++ projects. It also addresses common build issues and offers best practices for integrating tests smoothly into Continuous Integration (CI) workflows.

### Prerequisites

- A development environment with C++17 support.
- Familiarity with your chosen build system, preferably CMake or Bazel.
- Command-line tools such as Git and make (for Unix-like systems) or Visual Studio (for Windows).
- Administrative privileges for installing system-wide libraries (optional but recommended).

### Expected Outcome

By following this guide, you will have GoogleTest and GoogleMock installed and integrated in your project with a properly configured build setup, enabling immediate test writing and execution.

### Estimated Time

Approximately 30 to 60 minutes, depending on your system configuration and familiarity with your build tools.

### Difficulty Level

Intermediate: Requires basic knowledge of C++ build systems and command-line usage.

---

## Step-by-Step Instructions

### 1. Clone and Prepare GoogleTest and GoogleMock Sources

GoogleTest includes GoogleMock by default. You can clone the repository and prepare for a standalone build:

```bash
# Clone GoogleTest repository (version 1.17.0)
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
mkdir build
cd build
```

### 2. Build GoogleTest and GoogleMock with CMake

If you want to build GoogleTest with GoogleMock support (recommended), run:

```bash
cmake ..
# On Unix-like systems, proceed with:
make
# Optional: install system-wide
sudo make install
```

If you want to build only GoogleTest, disable GoogleMock explicitly:

```bash
cmake .. -DBUILD_GMOCK=OFF
make
sudo make install
```

#### Notes:

- On Windows with Visual Studio, `cmake ..` will generate a `.sln` file you can open and build.
- On macOS, you will get an `.xcodeproj` project.

### 3. Integrate GoogleTest into Your Existing CMake Project

#### Option A: Use Installed Libraries

If you installed GoogleTest system-wide or have it available on your system, you can find it using `find_package`:

```cmake
find_package(GTest CONFIG REQUIRED)
add_executable(my_tests test1.cpp test2.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main GTest::gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

#### Option B: Build GoogleTest as Part of Your Project Using FetchContent

For flexible and guaranteed compatibility (especially useful for CI), you can download GoogleTest during your build:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# For Visual Studio: Use dynamic C runtime to match your project.
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test1.cpp test2.cpp)
target_link_libraries(my_tests PRIVATE gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

**Important:** This requires CMake 3.14 or later.

### 4. Configure C++17 Standard Support

Ensure your project and tests use C++17 or later. Add to your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

If specifying compiler flags manually, include them accordingly.

### 5. Setting Up Bazel (Alternative Build System)

GoogleTest and GoogleMock are officially supported with Bazel. Refer to the Bazel documentation to configure your `BUILD` files using the appropriate `cc_test` and `cc_library` rules with `@com_google_googletest`.

### 6. Running Tests

- The recommended test executable should be linked against `gtest_main` or `gmock_main` to get a default `main()` function.
- Initialize the framework in your `main()` (if writing your own) with `testing::InitGoogleTest(&argc, argv);` or `testing::InitGoogleMock(&argc, argv);`.
- Run the tests with `RUN_ALL_TESTS()`.

Example main function:

```c++
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Or, link with `gtest_main`/`gmock_main` to skip writing your own.

---

## Examples

### Sample CMakeLists.txt Incorporating GoogleTest via FetchContent

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test PRIVATE gtest_main gmock_main)
add_test(NAME my_test COMMAND my_test)
```

### Sample Test File (test.cpp)

```c++
#include <gtest/gtest.h>

TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1 + 1, 2);
  ASSERT_NE(nullptr, this);
}
```

---

## Troubleshooting and Tips

### Common Issues

- **CMake version too low:** FetchContent requires CMake 3.14+. Upgrade if you see 
  errors.

- **Runtime mismatch on Windows (Visual Studio):**
  If you get linker errors about runtime libraries mismatching (e.g., `MT` vs `MD`), 
  enable the `gtest_force_shared_crt` option in CMake as shown above.

- **Missing pthread library:**
  On some Linux environments, you may need to explicitly link pthread. When using CMake's 
  GoogleTest scripts, this is automatic. Otherwise, add `-pthread` to compiler and linker flags.

- **Compiler flag errors:**
  GoogleTest requires C++17. Make sure your compiler is modern enough and the standard is set.

- **Linker errors on shared library setups:**
  If building or linking GoogleTest/GoogleMock as shared libraries, use these flags:

  ```
  -DGTEST_CREATE_SHARED_LIBRARY=1
  -DGTEST_LINKED_AS_SHARED_LIBRARY=1
  ```

### Best Practices

- Use `gtest_main` or `gmock_main` libraries to avoid writing boilerplate `main()` functions.
- Prefer building GoogleTest as part of your project rather than copying sources manually.
- Keep GoogleTest and GoogleMock updated regularly to benefit from fixes and features.
- For Continuous Integration, script the dependency acquisition and build steps as shown in fetch-based integration.

### Performance Considerations

- Building GoogleTest separately and linking it statically is fast and simple.
- Shared libraries add startup overhead; use shared if you absolutely need to share binaries across multiple tests.

### CI Integration Recommendations

- Incorporate GoogleTest fetching and build steps into your CI pipeline for consistency.
- Cache cloned repositories or built binaries when possible.
- Use CTest or `ctest` commands for test discovery and reporting.

---

## Next Steps & Related Content

- **Writing Your First Test:** Learn test writing basics after setup.
- **Getting Started with GoogleMock:** Introduction to mocking after installing.
- **Common Installation Issues:** Troubleshoot any errors during setup.
- **Continuous Integration and Test Automation:** Improve automation in your pipelines.

For detailed guides, visit the [Getting Started](https://github.com/google/googletest) and [GoogleMock Documentation](https://google.github.io/googletest/gmock_for_dummies.html).

---