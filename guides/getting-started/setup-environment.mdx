---
title: "Setting Up Your Testing Environment"
description: "Walks users through installing GoogleTest and GoogleMock, integrating with common build systems (CMake/Bazel), and verifying the setup process. Includes troubleshooting typical setup issues."
---

# Setting Up Your Testing Environment

## Overview
This guide walks you through installing GoogleTest and GoogleMock, integrating them with the two most common build systems—CMake and Bazel—and verifying that your setup works as expected. It includes practical, step-by-step instructions for standalone and project-integrated builds, as well as troubleshooting tips for common issues encountered during installation.

## Prerequisites
Before beginning, ensure you have the following:
- A C++17-compatible compiler installed.
- Basic familiarity with your preferred build system: either CMake or Bazel.
- Development environment with command line access.
- Internet connectivity to clone or download GoogleTest sources.

## Expected Outcome
By following this guide, you will:
- Successfully download and build GoogleTest and GoogleMock.
- Integrate them properly into your project using CMake or Bazel.
- Verify your installation by running a minimal test suite.
- Understand common errors and how to fix them during setup.

## Time Estimate
Setting up can typically be completed within 15–30 minutes, depending on your environment and build familiarity.

## Difficulty Level
Beginner to Intermediate — suitable for new users familiar with basic build systems and C++ development environments.

---

## Step-by-Step Setup Instructions

### 1. Installing GoogleTest and GoogleMock with CMake
GoogleTest provides a robust CMake build script that supports a standalone build or integration into an existing CMake project.

#### 1.1 Standalone CMake Build

1. Clone the repository:
   ```bash
   git clone https://github.com/google/googletest.git -b v1.17.0
   cd googletest
   ```
2. Create and switch to the build directory:
   ```bash
   mkdir build
   cd build
   ```
3. Generate build files including GoogleMock:
   ```bash
   cmake ..
   ```
   - To build only GoogleTest (excluding GoogleMock):
     ```bash
     cmake .. -DBUILD_GMOCK=OFF
     ```
4. Build the project:
   - On Unix-like systems:
     ```bash
     make
     ```
   - On Windows with Visual Studio:
     Open the generated `gtest.sln` solution and build.
   - On macOS with Xcode:
     Open the `.xcodeproj` project and build.

5. Optionally install (requires admin privileges):
   ```bash
   sudo make install
   ```
   This installs libraries and headers, typically under `/usr/local/`.

#### 1.2 Integrating Into Your Existing CMake Project

**Preferred Approach:** Use CMake's `FetchContent` to add GoogleTest as part of your build, ensuring unified compiler and linker settings.

Add the following snippet to your `CMakeLists.txt`:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# On Windows, to align runtimes, force shared CRT linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example gtest_main)
add_test(NAME example_test COMMAND example)
```

> **Note:** Requires CMake 3.14 or higher.

This keeps GoogleTest’s compiler and linker flags consistent with your project, avoiding conflicts particularly on Windows environments.

#### 1.3 Compiler and C++ Standard Requirements

Make sure your CMake setup enforces C++17:
```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

If your project doesn’t use CMake, ensure your compiler supports C++17 accordingly.

### 2. Installing and Using GoogleTest with Bazel

GoogleTest can be integrated as a dependency into Bazel builds. See the Bazel INSTALL documentation (outside this page’s scope) for instructions to add GoogleTest and GoogleMock under `WORKSPACE` and `BUILD` files.

### 3. Verifying Your Setup

Once the build is complete and your project linked with GoogleTest (and optionally GoogleMock), verify the installation:

1. Write a minimal test file, e.g., `example_test.cpp`:
```c++
#include <gtest/gtest.h>

TEST(SimpleTest, AssertionTrue) {
  EXPECT_TRUE(true);
}

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

2. Compile and link with GoogleTest libraries.
3. Run the test binary.
4. Confirm you see output indicating tests passed:
```
[==========] Running 1 test from 1 test suite.
[----------] Global test environment set-up.
[----------] 1 test from SimpleTest
[ RUN      ] SimpleTest.AssertionTrue
[       OK ] SimpleTest.AssertionTrue (0 ms)
[----------] 1 test from SimpleTest (0 ms total)

[==========] 1 test from 1 test suite ran. (0 ms total)
[  PASSED  ] 1 test.
```

### 4. Optional: Using `gtest_main` or `gmock_main`

Avoid writing your own `main()` function by linking with the prebuilt `gtest_main` or `gmock_main` libraries. They provide a suitable entry point that initializes the framework and runs tests.

Usage example in CMake:
```cmake
target_link_libraries(example gtest_main)
```

### 5. Initializing GoogleMock

If you use GoogleMock, initialize it in your test binary instead of GoogleTest:
```c++
#include <gmock/gmock.h>

int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This handles both GoogleMock and GoogleTest initialization seamlessly.

## Troubleshooting Common Setup Issues

<AccordionGroup title="Common Issues and Resolutions">
<Accordion title="C++17 Compiler or Standard Not Enabled">
Check that your compiler supports C++17 and that the flag is enabled. For CMake:
```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```
Without this, build errors or runtime failures may occur.
</Accordion>
<Accordion title="Linker Errors on Windows Related to Runtime Libraries">
On Windows, mismatch between static and dynamic CRT linkage often causes linker errors like:
```
gtest.lib(gtest-all.obj) : error LNK2038: mismatch detected for 'RuntimeLibrary'
```
Fix this by forcing GoogleTest to use the shared CRT in your `CMakeLists.txt`:
```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
</Accordion>
<Accordion title="Missing `main()` during Linker Stage">
Ensure your test binary is linked with `gtest_main` or that you provide your own `main()` function initializing GoogleTest or GoogleMock with command-line arguments.
</Accordion>
<Accordion title="GoogleMock Flags Not Recognized or Parsing Failures">
Call `testing::InitGoogleMock()` at the start of your `main()` to correctly parse GoogleMock flags and initialize the framework.
</Accordion>
</AccordionGroup>

## Best Practices & Tips

- Prefer integrating GoogleTest into your build system to maintain consistent build flags and reduce version conflicts.
- Use `gtest_main` / `gmock_main` libraries to avoid boilerplate `main()` code.
- For advanced setups or continuous integration, use CMake’s `FetchContent` for flexible and up-to-date source integration.
- Confirm your environment, especially compiler and build tools, are compatible with GoogleTest requirements outlined in the [Prerequisites & Supported Platforms](../../getting_started/setup_requirements/prerequisites_platforms) guide.

## Next Steps

- Proceed to writing and running your first tests following this setup in the [Writing Your First Test](../first_test_run_validation/write_first_test) guide.
- Deepen your understanding of build system usage with GoogleTest by reviewing [Installing with CMake](../../getting_started/installation_integration/install_cmake) and [Installing with Bazel](../../getting_started/installation_integration/install_bazel).
- Explore [Validating Your Setup](../first_test_run_validation/validation_checks) to troubleshoot runtime test execution issues.


---

## References
- Official GoogleTest repository: [https://github.com/google/googletest](https://github.com/google/googletest)
- GoogleMock documentation: [https://google.github.io/googletest/gmock_for_dummies.html](https://google.github.io/googletest/gmock_for_dummies.html)
- CMake official website: [https://cmake.org/](https://cmake.org/)

---

## Diagram: Typical GoogleTest Integration Workflow with CMake

```mermaid
flowchart TD
  A[Clone googletest repo] --> B[Create build directory]
  B --> C[Run cmake ..]
  C --> D{Include GoogleMock?}
  D -->|Yes| E[Build libraries with GoogleMock]
  D -->|No| F[Build only GoogleTest libraries]
  E --> G[Link libraries to your test executable]
  F --> G
  G --> H[Write test code]
  H --> I[Run tests with RUN_ALL_TESTS()]
  I --> J[View test results]

  %% Styling for clarity
  classDef decision fill:#f9f,stroke:#333,stroke-width:2px;
  class D decision;
```
