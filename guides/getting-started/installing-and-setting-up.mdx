---
title: "Installing and Setting Up GoogleTest & GoogleMock"
description: "A guided walkthrough of installing GoogleTest and GoogleMock, configuring your project, and integrating with common build systems. This page explains the recommended setup flow and provides actionable steps tailored to CMake and Bazel users."
---

# Installing and Setting Up GoogleTest & GoogleMock

A step-by-step walkthrough to install, configure, and integrate GoogleTest and GoogleMock into your C++ project. This guide focuses on practical setup instructions tailored to the most common build systems: CMake and Bazel.

---

## Workflow Overview

### What You Will Achieve

By following this guide, you will successfully:

- Install GoogleTest and GoogleMock, including their source or prebuilt libraries.
- Configure and build them as standalone components or integrated parts of your project.
- Use common CMake and Bazel approaches to seamlessly link GoogleTest/GoogleMock into your build.
- Understand how to leverage the provided `main()` entry points and customize your test harness if needed.

### Prerequisites

Before starting, ensure you have:

- A working C++17 compatible compiler (e.g., GCC, Clang, MSVC).
- Installed CMake (version 3.14 or newer) and/or Bazel build tool configured.
- Network access if you need to clone the repositories or download sources.
- Familiarity with your project's build system (CMake or Bazel).

### Estimated Time

About 15–30 minutes, depending on your environment and build system familiarity.

### Difficulty Level

Beginner to Intermediate — assuming basic knowledge of C++ project builds.

---

## Step-by-Step Instructions

### 1. Clone the GoogleTest Repository

Start by cloning the official repository from GitHub:

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
```

This repository includes both GoogleTest and GoogleMock sources.

---

### 2. Building with CMake

#### Standalone Build

Create a dedicated build directory and configure the build:

```bash
mkdir build
cd build
// Default build includes GoogleMock
cmake ..
```

To build _only_ GoogleTest (excluding GoogleMock), run:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

Then compile the project:

```bash
make
```

On Windows, open the generated `gtest.sln` in Visual Studio, or on macOS open the `.xcodeproj`.

Install globally (optional, requires admin privileges):

```bash
sudo make install
```

#### Integrating GoogleTest into Your Existing CMake Project

##### Option A: Use Installed GoogleTest Libraries

Once installed, add this to your `CMakeLists.txt` to find GoogleTest:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test test.cpp)
target_link_libraries(your_test GTest::gtest_main)
add_test(NAME your_test COMMAND your_test)
```

This approach requires GoogleTest to be installed on your system.

##### Option B: Add GoogleTest as a Subdirectory

Include GoogleTest directly in your build to avoid dependency mismatch or version drift:

```cmake
add_subdirectory(path/to/googletest)

add_executable(your_test test.cpp)
target_link_libraries(your_test gtest_main)
add_test(NAME your_test COMMAND your_test)
```

This ensures consistent compiler flags and debug symbols.

##### Option C: FetchContent for Automatic Download

Use CMake's FetchContent to download at configure time:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Visual Studio runtime compatibility
FetchContent_MakeAvailable(googletest)

add_executable(your_test test.cpp)
target_link_libraries(your_test gtest_main)
add_test(NAME your_test COMMAND your_test)
```

---

### 3. Building with Bazel

GoogleTest and GoogleMock include Bazel build configurations enabling seamless integration.

- Add the GoogleTest repository as a workspace dependency.
- Declare `@com_google_googletest` in your `WORKSPACE` file.
- Reference targets like `@com_google_googletest//:gtest` or `@com_google_googletest//:gmock` in your Bazel `BUILD` files.

Example test target in Bazel:

```bazel
cc_test(
    name = "your_test",
    srcs = ["your_test.cpp"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

This will compile and link GoogleTest automatically.

---

### 4. Linking GoogleMock

GoogleMock builds on top of GoogleTest and requires similar setup steps.

For CMake, build GoogleMock alongside GoogleTest by default, or include the `gmock` and `gmock_main` libraries explicitly:

```cmake
target_link_libraries(your_test gmock_main)
```

For Bazel, link your tests with `@com_google_googletest//:gmock_main`.

---

### 5. Using the Provided Main Functions

Both GoogleTest and GoogleMock come with built-in `main()` implementations (`gtest_main` and `gmock_main` respectively) that handle initialization and running of tests.

- Link against `gtest_main` or `gmock_main` to avoid writing your own `main`.

- If you require custom test runner behavior (e.g., custom flags, setup), you can define your own `main()` as shown below:

```c++
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

OR for GoogleMock:

```c++
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Use these only if you need to customize before running tests.

---

## Examples

### Minimal CMakeLists.txt for Testing with GoogleTest and GoogleMock

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTests LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test my_test.cpp)
target_link_libraries(my_test gmock_main)
add_test(NAME my_test COMMAND my_test)
```

### Typical main() Function (If Not Using gtest_main/gmock_main)

```c++
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

or for GoogleMock:

```c++
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

---

## Troubleshooting & Tips

- **Build Fails Due to Runtime Library Mismatch (Visual Studio):**
  Enable `gtest_force_shared_crt` in CMake to link GoogleTest’s runtime dynamically if your project uses dynamic CRT.

- **C++ Standard Errors:**
  Ensure your project uses at least C++17 by setting `CMAKE_CXX_STANDARD 17`.

- **Thread Safety Warnings:**
  GoogleTest detects pthreads automatically; define `-DGTEST_HAS_PTHREAD=1` or `=0` explicitly if detection fails.

- **Macro Name Collisions:**
  Use compiler flags like `-DGTEST_DONT_DEFINE_TEST=1` to avoid macro conflicts and use `GTEST_TEST` instead.

- **GoogleMock Flags Not Recognized:**
  Call `testing::InitGoogleMock(&argc, argv)` instead of `testing::InitGoogleTest()` in your main function.

- **Tests Not Running / Not Found:**
  Confirm that tests are linked into the final executable and `RUN_ALL_TESTS()` is called exactly once.

- **Ensure GoogleMock Is Built:**
  If using CMake, verify `BUILD_GMOCK` is ON (default). Otherwise, GoogleMock libraries won't be built.

---

## Next Steps & Related Topics

- Proceed to [Writing Your First Unit Tests](/guides/getting-started/writing-your-first-tests) after successful setup.
- Explore [Integrating with Your Build System](/getting-started/setup-prerequisites-installation/integration-third-party-tools) to vendor or externally manage dependencies.
- Review [Mocking Your First Functions](/guides/getting-started/mocking-your-first-functions) to learn about using GoogleMock.
- For details on flags and advanced configurations, consult the official GoogleTest CMake README and Bazel integration files.


---