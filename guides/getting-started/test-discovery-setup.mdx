---
title: "Test Discovery and Build Integration"
description: "A practical guide to configuring your project to automatically discover and run tests, including integrating with common build systems like CMake and Bazel. Focuses on test registration, build steps, and basics for continuous integration compatibility."
---

# Test Discovery and Build Integration

## Overview

This guide helps you configure your C++ project to automatically discover and run GoogleTest-based tests during your build process. It focuses on test registration, integration with common build systems such as CMake and Bazel, and basic considerations for continuous integration (CI) compatibility.

By following this documentation, you will enable your build environment to seamlessly detect test cases and run them as part of the build workflow, accelerating test feedback and improving software quality.

---

## Prerequisites

- GoogleTest and GoogleMock libraries must be installed and available to your build environment. Refer to the [Prerequisites & Requirements](/getting-started/setup-installation/prerequisites-requirements) and [Installation on Standard Platforms](/getting-started/setup-installation/installing-standard-platforms) guides for setup details.
- You should have a working understanding of your project's build system, ideally using CMake or Bazel.
- Basic familiarity with writing test cases using GoogleTest macros (`TEST`, `TEST_F`, etc.) is expected.

---

## Expected Outcome

- Your build system automatically finds and links GoogleTest test cases.
- Executable test binaries are built with proper registration of all tests.
- Running test executables automatically discovers and runs all tests.
- Integration is optimized for use within CI pipelines, allowing easy automated test execution.

---

## Time Estimate

About 30-60 minutes depending on familiarity with your build system and test framework.

---

## Difficulty Level

Intermediate - requires understanding of C++ build tools and test frameworks.

---

# Step-by-Step Integration

### 1. Ensure Tests Are Properly Registered

GoogleTest automatically registers tests declared with macros such as `TEST`, `TEST_F`, `TEST_P`, and typed tests macros. No manual registration is typically required.

**Key action:** Verify that your test source files use these macros to declare tests, as only registered tests are discovered by GoogleTest's runtime.

### 2. Link GoogleTest Libraries Correctly in Your Build

Your build system must link the tests against the GoogleTest (and optionally GoogleMock) libraries.

For example, in CMake:

```cmake
find_package(GTest REQUIRED)

add_executable(my_tests test_main.cc my_tests.cc)
target_link_libraries(my_tests GTest::gtest GTest::gtest_main GTest::gmock)
```

For Bazel, use the `cc_test` rule and list `@com_google_googletest//:gtest_main` and `@com_google_googletest//:gmock` as dependencies.

### 3. Configure Test Discovery in Build Rules

- **CMake**: When using `enable_testing()` and `add_test()`, register your test executables so `ctest` can discover and run them.

```cmake
enable_testing()
add_test(NAME MyTestSuite COMMAND my_tests)
```

- **Bazel**: Tests declared with `cc_test` rules automatically discover and run their own tests.

### 4. Structure Build to Include All Test Sources

Ensure all your test source files are included in target specifications to be compiled and linked.

Example for CMake:

```cmake
add_executable(my_tests
    test_suite1.cc
    test_suite2.cc
    test_helpers.cc
)
```

This guarantees that GoogleTest’s automatic test registration collects all tests.

### 5. Running Tests

Once built, executing the test binaries will automatically discover and run all registered tests via GoogleTest’s built-in test runner.

Run your test executable manually:

```shell
./my_tests
```

Or use build system utilities:

```shell
ctest
```

or

```shell
bazel test //path/to:my_tests
```

### 6. Continuous Integration Basics

- Integrate test execution commands into CI scripts.
- Utilize GoogleTest’s output flags to generate XML or JSON reports suitable for CI systems.
- Example for XML output:

```shell
./my_tests --gtest_output=xml:report.xml
```

- Make sure your CI system captures and reports these test results for quality monitoring.

---

# Advanced Integration Tips

### Custom Test Registration

If macros are insufficient and you generate or register tests at runtime, use GoogleTest's `::testing::RegisterTest` API. This is an advanced scenario and should be handled with care. All registrations must happen before `RUN_ALL_TESTS()`.

### Handling Parameterized and Typed Tests

GoogleTest supports parameterized and typed tests that the build system will discover as usual when the tests are linked into the executable. Ensure all instantiation macros (`INSTANTIATE_TEST_SUITE_P` for parameterized tests and `TYPED_TEST_SUITE` for typed tests) are included in your test source files.

### Ordering and Naming Conventions

- Avoid underscores in test suite and test names to prevent underlying name conflicts.
- Name test suites clearly to reflect the component or functionality tested.

### Multiple Test Executables

For large projects, organize tests across multiple test executables by grouping related tests. Each executable integrates the steps above.

---

# Troubleshooting

<AccordionGroup title="Common Issues with Test Discovery and Build Integration">
<Accordion title="Tests Are Not Being Discovered or Run">
- Verify that your test source files use GoogleTest macros for declaration.
- Confirm all test source files are included in the build target.
- Check correct linkage to `gtest` and `gtest_main` libraries.
- Run the test executable with `--gtest_list_tests` to list discovered tests.
</Accordion>
<Accordion title="Build Errors Linking GoogleTest Libraries">
- Check that the installed GoogleTest version matches your build system.
- On CMake, ensure `find_package(GTest)` locates the right libraries.
- For Bazel, verify dependency declarations are correct.
- Confirm compiler flags like `-pthread` or equivalent are set.
</Accordion>
<Accordion title="Continuous Integration Test Failures or Missing Reports">
- Make sure test executables are run and their exit codes are checked.
- Use `--gtest_output=xml` or `--gtest_output=json` flags to generate reports.
- Check CI system parsing of test reports.
- Validate the environment variables and path setups in CI.
</Accordion>
</AccordionGroup>

---

# Summary

Automating test discovery and build integration with GoogleTest streamlines testing workflows in C++ projects. Proper use of test macros ensures tests are registered without extra configuration. Linking against GoogleTest libraries and structuring your build system for test sources enables smooth build and execution. Leveraging CI-ready output enables robust test monitoring and quality assurance.


---

# Related Links

- [Getting Started with GoogleTest](../getting-started/first-test-experience/writing-first-test.md)
- [Integration & Extensibility Overview](/overview/system-architecture/integration-overview)
- [Using GoogleTest with CMake](/getting-started/setup-installation/installing-standard-platforms#cmake)
- [Using GoogleTest with Bazel](/getting-started/setup-installation/installing-standard-platforms#bazel)
- [Running Tests and Filtering](/docs/advanced.md#running-test-programs-advanced-options)
- [Generating Test Reports for CI](/docs/advanced.md#controlling-test-output)


---

# Example CMake Snippet for Test Discovery

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyProjectTest)

find_package(GTest REQUIRED)

enable_testing()

add_executable(my_tests
  test_suite1.cc
  test_suite2.cc
)

target_link_libraries(my_tests GTest::gtest GTest::gtest_main GTest::gmock)

add_test(NAME RunMyTests COMMAND my_tests)
```

This defines a `my_tests` executable which when run discovers and executes all tests.


# Example Bazel BUILD File Snippet

```bazel
cc_test(
    name = "my_tests",
    srcs = ["test_suite1.cc", "test_suite2.cc"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"],
)
```

Bazel builds and runs the test executable automatically discovering all linked tests.
