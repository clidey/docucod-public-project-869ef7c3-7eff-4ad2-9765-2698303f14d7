---
title: "Setting Up and Building Tests"
description: "Learn how to add GoogleTest and GoogleMock to your project, configure your build system (including CMake and Bazel), and integrate automated test runs into your workflow. This page covers environment preparation, dependency management, and essential build steps for both frameworks."
---

# Setting Up and Building Tests

## Workflow Overview

This guide walks you through the practical steps for adding GoogleTest and GoogleMock to your C++ project, configuring your build system, and integrating automated test runs into your development workflow. The focus is on environment preparation, dependency management, and essential build steps using CMake and Bazel.

### Prerequisites

- A supported compiler with C++17 support.
- CMake (version 3.14 or later) or Bazel build system installed.
- Familiarity with your project’s build configuration files.
- A working internet connection for Git and package downloads if applicable.

### Expected Outcome

By following this guide, you will have:
- Installed and configured GoogleTest and GoogleMock in your project.
- Configured your build system (CMake or Bazel) to build and link tests.
- Completed the initial build and successfully run your test binaries.
- Integrated automated test execution into your development cycle.

### Time Estimate

Setup and initial build can take approximately 20-40 minutes depending on your environment.

### Difficulty Level

Intermediate: Requires understanding of build systems and C++ project configuration.

---

## Step-by-Step Instructions

### 1. Add GoogleTest and GoogleMock to Your Project

GoogleMock is bundled with GoogleTest, so installing GoogleTest will give you access to both.

#### For Standalone Usage:

Clone the repository and prepare the build directory:

```bash
git clone https://github.com/google/googletest.git -b main
cd googletest
mkdir build
cd build
```

#### Build with GoogleMock (default):

```bash
cmake ..
make
```

If you want only GoogleTest without GoogleMock, use:

```bash
cmake .. -DBUILD_GMOCK=OFF
make
```

#### Windows or macOS:

Use Visual Studio or Xcode respectively to open generated projects in `build`.


---

### 2. Incorporate GoogleTest into Your Existing CMake Project

It is recommended to add GoogleTest as either an installed library or as part of your project’s build via CMake's `FetchContent`.

#### Using `FetchContent` (recommended for newer CMake versions):

Add to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For consistent runtime libraries on Windows
FetchContent_MakeAvailable(googletest)

add_executable(your_tests test_source.cpp)
target_link_libraries(your_tests PRIVATE gtest_main gmock)
add_test(NAME your_test COMMAND your_tests)
```

This method ensures GoogleTest and GoogleMock are built and linked using the same compiler settings as your project.

---

### 3. Configuring Bazel to Include GoogleTest and GoogleMock

GoogleTest and GoogleMock are supported by Bazel and can be added as dependencies in your Bazel build files.

In your `BUILD` file:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

This pulls in both GoogleTest and GoogleMock with main entry point included.

---

### 4. Initialize GoogleTest and GoogleMock in Your Test Code

Every test executable requires initialization of the GoogleTest or GoogleMock framework before running tests.

#### Basic example using GoogleTest:

```cpp
#include <gtest/gtest.h>

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

#### Basic example using GoogleMock:

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Linking against `gtest_main` or `gmock_main` will provide this main function automatically if you prefer.

<Check>
If you provide your own `main()`, always call `testing::InitGoogleTest` or `testing::InitGoogleMock` before `RUN_ALL_TESTS()`. This ensures command line flags are parsed correctly.
</Check>

---

### 5. Build Your Test Executables

Ensure that your build system compiles test source files and links them properly with the GoogleTest and GoogleMock libraries.

#### Using CMake (command line):

```bash
cd build
make
./your_tests
```

#### Using Bazel:

```bash
bazel test //path/to:my_test
```

You should see test output with summary of all passed/failed tests.

---

### 6. Automate Test Runs Within Your Development Workflow

Integrate test execution into your CI/CD pipeline or local development cycle.

- Use CTest with CMake projects:

```bash
ctest --output-on-failure
```

- Use `bazel test` as part of build scripts or CI workflows.

- Generate XML reports for tools like Jenkins or GitHub Actions by using test runner flags:

```bash
./your_tests --gtest_output=xml:report.xml
```

---

## Practical Tips & Best Practices

- Always keep your GoogleTest and GoogleMock dependencies up to date to leverage fixes and improvements.
- Use `gtest_force_shared_crt` option on Windows to avoid runtime library mismatches.
- For larger projects, embedding GoogleTest with `FetchContent` promotes consistency and reduces dependency conflicts.
- Prefer `gmock_main` or `gtest_main` libraries to reduce boilerplate for main functions.
- Familiarize yourself with GoogleMock’s macros (e.g. `MOCK_METHOD`) to efficiently create mocks after setup.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Build and Setup Issues">
<Accordion title="GoogleTest Not Found by CMake">
Ensure CMake version is 3.14 or above for `FetchContent`. Verify paths and check `find_package(GTest)` configuration.
</Accordion>
<Accordion title="Runtime Library Mismatch on Windows">
Use the `gtest_force_shared_crt` option to align runtime libraries between your project and GoogleTest.
</Accordion>
<Accordion title="Test Executable Fails to Link">
Verify linking against `gtest`, `gtest_main`, `gmock`, or `gmock_main` as needed. Check for missing pthread flags on POSIX systems.
</Accordion>
<Accordion title="Tests Not Running or Not Discovered">
Make sure test cases are properly defined using `TEST()` or `TEST_F()`. Confirm main function calls appropriate initialization.
</Accordion>
</AccordionGroup>

---

## Next Steps & Related Content

- Proceed to the [Writing Your First Unit Test](/guides/getting-started/writing-your-first-tests) guide to see testing in action.
- Consult [Installing on Linux, macOS, and Windows](/getting-started/setup-requirements/install-platforms) if you need platform-specific installation help.
- Explore the [Mocking Reference](/docs/reference/mocking.md) to learn how to define mocks and set expectations.
- Review the [Integration and Ecosystem](/overview/feature-architecture-and-integration/integration-and-ecosystem) page for continuous integration and IDE support.


---

This end-to-end setup prepares your project for robust, automated C++ testing with GoogleTest and GoogleMock integrated smoothly into your build and development workflow.

---

## Diagram: Basic Build and Test Workflow

```mermaid
flowchart TD
  A[Start: Project Setup] --> B[Clone googletest Repository]
  B --> C[Build googletest with CMake]
  C --> D[Add googletest to Your CMake Project]
  D --> E{Using Bazel?}
  E -- Yes --> F[Add gmock_main dependency]
  E -- No --> G[Configure CMake FetchContent]
  F --> H[Write Test Sources Using TEST/TEST_F]
  G --> H
  H --> I[Initialize GoogleTest/GoogleMock in main()]
  I --> J[Build Test Executable]
  J --> K[Run Tests]
  K --> L[Get Test Results]
  L --> M[Integrate in CI/CD Pipeline]

  classDef decision fill:#f9f,stroke:#333,stroke-width:2px;
  class E decision;
```
