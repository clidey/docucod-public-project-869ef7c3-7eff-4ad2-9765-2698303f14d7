---
title: "Setting Up Your Test Project"
description: "A step-by-step guide to integrating GoogleTest/GoogleMock into your C++ project, selecting the right build tools (CMake/Bazel), and ensuring dependencies are configured across different environments. Includes guidance on linking, structure, and troubleshooting setup issues."
---

# Setting Up Your Test Project

A practical, step-by-step guide to integrating **GoogleTest** and **GoogleMock** into your C++ project. This document helps you select the appropriate build tools (CMake or Bazel), configure your environment for different platforms, and ensure that dependencies are properly linked and resolved. It also covers common pitfalls and troubleshooting tips to get your test project running efficiently.

---

## 1. Workflow Overview

### What This Guide Helps You Accomplish

You will set up a C++ test project that uses GoogleTest and GoogleMock frameworks. This includes downloading or referencing the libraries, configuring the build system to include headers and link against the libraries, choosing between standalone or integrated builds, and running your first test executable.

### Prerequisites

- A C++ development environment supporting C++17 or later.
- Installed CMake (version 3.14 or later) if using CMake.
- Familiarity with basic C++ build systems.
- (Optional) Access to Bazel if preferred.

### Expected Outcome

- GoogleTest and GoogleMock included in your project build setup.
- Ability to compile and run test executables using your preferred build system.
- Tests linked correctly with GoogleTest and GoogleMock libraries.
- Basic troubleshooting capability for common setup issues.

### Time Estimate

Approximately 20-40 minutes depending on your familiarity with build tools and environment setup.

### Difficulty Level

Intermediate — requires understanding of C++ build systems and tools.

---

## 2. Step-by-Step Setup Instructions

### Step 1: Obtain GoogleTest and GoogleMock Source

- You can either clone the repository manually or integrate it as part of your project build.
  - **Manual Clone (Standalone project):**

    ```bash
    git clone https://github.com/google/googletest.git -b main
    cd googletest
    mkdir build
    cd build
    cmake ..
    make
    sudo make install  # Optional, installs to /usr/local/
    ```

- Alternatively, embed the source as a git submodule or use CMake's `FetchContent` to download at configure time.

### Step 2: Choose Your Build Integration Method

Depending on your project, select one:

#### Option A: Build GoogleTest Standalone

- Build GoogleTest (and optionally GoogleMock) as separate static or shared libraries.
- Link test executables against these libraries.

#### Option B: Integrate GoogleTest into Your Existing CMake Project

- Use `FetchContent` or add GoogleTest source via `add_subdirectory()`.
- This ensures consistent compiler settings and avoids ABI mismatches.

Example snippet for your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # For Visual Studio dynamic runtimes
FetchContent_MakeAvailable(googletest)

add_executable(my_test test.cpp)
target_link_libraries(my_test gtest_main gmock_main)
add_test(NAME my_test COMMAND my_test)
```

>**Tip:** Set `gtest_force_shared_crt` to `ON` on Windows Visual Studio to avoid runtime linkage mismatches.

### Step 3: Configure Compiler and Linker Settings

- Ensure your compiler supports C++17 (`-std=c++17` or equivalent).
- When building manually:
  - Add include path to `googletest/include` and `googlemock/include`.
  - Link with `gtest`, `gmock`, and pthreads (on platforms requiring this).

- When using CMake, this is handled automatically via targets `gtest`, `gtest_main`, `gmock`, and `gmock_main`.


### Step 4: Write and Link Your Test Source

- Write tests using `TEST()`, `TEST_F()`, or mock classes if using GoogleMock.
- Link your test executable with `gtest_main` if you want a default `main()` function provided.
- Otherwise, provide a custom `main()` that initializes the frameworks with:

```c++
int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

- For GoogleMock, similarly initialize with:

```c++
int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Step 5: Build and Run Your Test Executable

- Run your build (e.g., `make` or `cmake --build .`).
- Execute the test binary. Tests will run, and results will print to console.

### Step 6: Verify Setup

- Ensure all tests are discovered and run.
- If tests do not run, verify linking and initialization.

---

## 3. Practical Examples

### Example: Minimal CMake `CMakeLists.txt` for a Test Project

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject CXX)
set(CMAKE_CXX_STANDARD 17)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_example.cpp)
target_link_libraries(my_tests gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

### Example: Simple Test File (`test_example.cpp`)

```c++
#include <gtest/gtest.h>

TEST(SampleTest, Addition) {
  EXPECT_EQ(2 + 2, 4);
}
```

Build and run the tests:

```bash
mkdir build && cd build
cmake ..
cmake --build .
ctest
```

Expected output:

```
Running tests...
Test project ...
Start 1: my_tests
1/1 Test #1: my_tests ....................   Passed    0.01 sec

100% tests passed, 0 tests failed out of 1
```

---

## 4. Troubleshooting & Best Practices

### Common Issues

- **Link errors related to runtimes on Windows Visual Studio:**
  Set `gtest_force_shared_crt` to `ON` in your CMake config.

- **Missing pthread linkage on Linux/macOS:**
  Add `Threads` via `find_package(Threads REQUIRED)` and link with `${CMAKE_THREAD_LIBS_INIT}` if not using CMake’s built-in GoogleTest targets.

- **Tests not discovered or run:**
  Ensure `testing::InitGoogleTest()` is called before `RUN_ALL_TESTS()`.
  Confirm tests are linked into your executable.

- **Build fails due to C++ version:**
  Verify your compiler supports C++17 or above and your build files request this standard explicitly (`set(CMAKE_CXX_STANDARD 17)`).

### Tips for Success

- Prefer integration with your existing CMake project using `FetchContent` or `add_subdirectory` for consistent builds.
- Use `gtest_main` and `gmock_main` libraries to avoid writing a custom `main()`.
- Keep GoogleTest and GoogleMock versions in sync.
- Regularly update your GoogleTest submodules or FetchContent references to stay current.

### Performance Considerations

- Build GoogleTest and GoogleMock as static libraries for faster test startup.
- Avoid mixing debug and release builds between your project and the GoogleTest libraries.

---

## 5. Next Steps & Related Documentation

- **Writing and Running Your First Test**: Learn how to create meaningful tests using `TEST()` and `TEST_F()`.
- **Configuration and Integration**: Deeper dive into build system setup and linker options.
- **Mocking Reference**: Explore creating mocks and setting expectations with GoogleMock.
- **Supported Platforms**: Verify platform compatibility and compiler support.
- **Troubleshooting & Common Issues**: For resolving build or run-time errors.

For comprehensive onboarding, start with [Writing and Running Your First Test](../getting-started/first-test-experience/create-run-first-test) and the [Installation & Setup](../getting-started/installation-setup/configuration-integration) guides.

---

## Additional Resources

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleTest Primer](../docs/primer.md)
- [GoogleMock CMake Integration](../googlemock/CMakeLists.txt)

---

This setup guide empowers you to quickly integrate GoogleTest and GoogleMock into your C++ projects, enabling reliable and maintainable testing workflows across diverse environments.