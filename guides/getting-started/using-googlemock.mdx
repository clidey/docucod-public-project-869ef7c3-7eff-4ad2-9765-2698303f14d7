---
title: "Getting Started with GoogleMock"
description: "Guided introduction to using GoogleMock for mocking dependencies in C++ tests. Learn how to define mock classes, use core macros, and set expectations for mock interactions."
---

# Getting Started with GoogleMock

Welcome to GoogleMock, the industry-leading C++ framework that empowers you to mock dependencies seamlessly in your unit tests. This guide walks you through the essentials of defining mock classes, leveraging core macros, and setting up expectations for mock interactions—accelerating your testing workflow and improving code quality.

---

## 1. Introduction to GoogleMock

GoogleMock enhances your test environment by enabling interaction-based testing, where you verify how your components communicate with their dependencies instead of just testing their outputs. Mock objects stand in place of real objects, allowing precise control and observation of method calls.

> **User Intent:** You want to validate that your code under test interacts correctly with its collaborators by setting expectations on method calls and responses.


## 2. Prerequisites

Before you start:

- Have a C++ development environment with GoogleTest installed.
- Include GoogleMock headers by adding `#include <gmock/gmock.h>` in your test files.
- Define or use an existing interface or class with virtual methods you want to mock.


## 3. Defining Mock Classes

The heart of GoogleMock lies in defining mock classes that replace real objects during tests.

### Step 1: Create Your Mock Class

Derive from the class or interface containing virtual functions. For each virtual function you want to mock, use the `MOCK_METHOD` macro.

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual std::string Describe(int type) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

> **Tip:** Always declare destructors as virtual in interfaces to avoid leaks and undefined behavior when mocking.

### Step 2: Understand Macro Parameters

- The first parameter is the return type.
- The second is the method name.
- The third is the parameter list (enclosed in parentheses).
- The optional fourth is qualifiers such as `const`, `override`, and others like calling conventions.

### Step 3: Handling Complex Types

If your function signatures include types with commas (like `std::pair` or template types), either wrap them in extra parentheses or use type aliases to avoid compilation errors.

```cpp
// Using parentheses
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
// Or using a type alias
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### Step 4: Mocking Overloaded and Template Methods

- Overloaded methods can all be mocked by declaring each overload with the correct signature and qualifiers.
- Template classes and methods can be mocked similarly, ensuring virtual destructors and virtual method declarations.


## 4. Using Mocks in Tests

Once mocks are defined, the standard lifecycle in tests is as follows:

### Workflow

<Steps>
<Step title="1. Import required gMock symbols">

Use `using ::testing::Foo;` where `Foo` is any mock construct (e.g., `Return`, `_`, `NiceMock`).

</Step>
<Step title="2. Create mock object">

Instantiate your mock class or use wrappers like `NiceMock<MockClass>` to manage default behaviors.

```cpp
NiceMock<MockFoo> mock_foo;  // Suppresses warnings on uninteresting calls.
```

</Step>
<Step title="3. Setup expectations and behaviors">

Use `EXPECT_CALL` to specify what calls you expect the mock to receive, how many times, with which arguments, and what actions to take.

```cpp
EXPECT_CALL(mock_foo, GetSize())
    .Times(AtLeast(1))
    .WillRepeatedly(Return(42));
```

Use `ON_CALL` to setup default actions without enforcing call expectations.

```cpp
ON_CALL(mock_foo, Process(_, _))
    .WillByDefault(Return(true));
```

</Step>
<Step title="4. Exercise the code under test">

Call your production code that uses the mock object.

```cpp
EXPECT_EQ(MyFunction(&mock_foo), expected_result);
```

</Step>
<Step title="5. Verification">

Automatic on mock destruction or explicitly by calling
`Mock::VerifyAndClearExpectations(&mock_foo);` if needed.

</Step>
</Steps>


### Examples

```cpp
using ::testing::Return;
using ::testing::_;

TEST(ExampleTest, SimpleMock) {
  MockFoo mock;

  // Default action when GetSize() called without expectation.
  ON_CALL(mock, GetSize()).WillByDefault(Return(1));

  // Expect Describe() called 3 times with 5 and return "Category 5".
  EXPECT_CALL(mock, Describe(5))
      .Times(3)
      .WillRepeatedly(Return("Category 5"));

  // Exercise
  EXPECT_EQ(mock.GetSize(), 1);
  EXPECT_EQ(mock.Describe(5), "Category 5");
}
```


## 5. Setting Expectations with EXPECT_CALL

Use `EXPECT_CALL(mock, Method(matchers))` to declare what method calls you expect.

- Matchers: Use argument matchers like `_` (wildcard), `Eq`, `Ge`, etc. to specify call parameters.
- Cardinalities: Control number of invocations using `.Times(Exactly(n))`, `.Times(AnyNumber())`, `.Times(AtLeast(n))`.
- Actions: Use `.WillOnce(action)`, `.WillRepeatedly(action)` to specify behavior.
- Ordering: Impose call order with `.InSequence` or `.After` for complex scenarios.

### Using .With () Clause

Refine expectations by matching *all* arguments as a tuple:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
  .With(Lt());  // First arg < Second arg
```

### Expectation Ordering

- **By default:** Calls may occur in any order.
- To enforce order, wrap expectations in `InSequence seq;` or use `.After()` to define dependencies.


## 6. Default Behavior and ON_CALL

`ON_CALL` lets you set default actions for mock methods:

- Applied when no expectation (`EXPECT_CALL`) is set.
- Often used in test setup to avoid warnings about uninteresting calls.

Example:

```cpp
ON_CALL(mock_foo, Foo(_)).WillByDefault(Return(10));
```


## 7. Mock Strictness: Nice, Naggy, and Strict Mocks

- **NaggyMock (Default):** Warns about unexpected uninteresting calls.
- **NiceMock:** Suppresses such warnings; useful to reduce noise.
- **StrictMock:** Treats unexpected calls as test failures.

Switch by wrapping your mock class:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
```

Use strict mocks sparingly; they make tests brittle.


## 8. Programming Tips and Best Practices

- Declare all virtual functions and virtual destructors for proper mocking.
- Use `RetiresOnSaturation()` when you want an expectation to deactivate after matching its calls.
- If you mock overloaded functions, ensure all overloads have mock declarations.
- Use explicit cardinalities to avoid unintended test failures.
- Avoid mocking non-virtual methods unless using advanced techniques.
- Use lambdas or `Invoke()` to customize mock method behavior dynamically.


## 9. Common Troubleshooting

<Tip>
If a mocked virtual method calls the real method instead:
- Ensure the base method is declared `virtual`.
</Tip>

<Tip>
If you see warnings about uninteresting calls:
- Use `NiceMock` to suppress if expected.
- Or add explicit `EXPECT_CALL(...).Times(AnyNumber())` for methods where all calls are allowed.
</Tip>

<Tip>
If your expectations aren’t being met:
- Check that `EXPECT_CALL`s are set **before** exercising the code.
- Use the `--gmock_verbose=info` flag to trace mock function calls and debug argument mismatches.
</Tip>


## 10. Next Steps & Further Reading

- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes covering advanced mocking scenarios.
- Review [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) to leverage powerful argument matching.
- Understand mock strictness controls with the [Nice, Naggy, Strict mocks documentation](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy).
- Integrate GoogleMock into your build environment, see [Integration with Build Systems](overview/use-cases-integration/integration-with-build-systems.mdx).
- Utilize the [Mocking Reference](docs/reference/mocking.md) for detailed API usage.

---

By mastering these concepts and techniques, you are now equipped to use GoogleMock effectively for precise, maintainable, and insightful C++ tests.
