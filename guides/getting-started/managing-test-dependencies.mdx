---
title: "Managing Test Dependencies and Configuration"
description: "Practical guidance for setting up GoogleTest and GoogleMock in various development environments, handling external dependencies, and configuring supported platforms and compilers."
---

# Managing Test Dependencies and Configuration

This guide provides practical instructions for setting up and configuring GoogleTest and GoogleMock in various development environments. It covers handling external dependencies, linking against the right libraries, and ensuring compatibility with supported platforms and compilers.

---

## Workflow Overview

### What This Guide Helps You Accomplish
You will learn how to efficiently configure GoogleTest and GoogleMock for use in your C++ projects, understand the relationship between these libraries, and manage their dependencies and platform-specific considerations.

### Prerequisites
- A working C++17 (or later) environment.
- Basic familiarity with CMake or your chosen build system.
- Access to GoogleTest and GoogleMock source or binaries.

### Expected Outcome
By the end of this guide, you will be able to:
- Configure your build system to find and link the appropriate GoogleTest and GoogleMock libraries.
- Understand the difference between main and non-main variants of the libraries.
- Handle platform-specific configurations like threading and compiler settings.

### Time Estimate
10-20 minutes to set up and validate the test dependencies in a typical CMake-based project.

### Difficulty Level
Intermediate (familiarity with C++ build systems and linking is recommended).

---

## Step-by-Step Instructions

### 1. Decide Which Libraries You Need

GoogleTest and GoogleMock provide different libraries depending on whether you want to use your own `main()` or rely on the built-in main function.

- **Without main() function:** Use `gtest` or `gmock` when you provide your own `main()`.
- **With main() function:** Use `gtest_main` or `gmock_main` when you want the library to supply a default test runner.

This affects the libraries you link against:

| Library Variant  | Provides main() | Description                      |
|------------------|----------------|--------------------------------|
| `gtest`          | No             | GoogleTest core library         |
| `gtest_main`     | Yes            | GoogleTest with built-in main()|
| `gmock`          | No             | GoogleMock core library         |
| `gmock_main`     | Yes            | GoogleMock with built-in main()|

### 2. Set Up CMake to Locate and Link Libraries

If you use CMake, the easiest way to link GoogleTest and GoogleMock is: 

- Include their headers in your include directories.
- Link against the appropriate targets:

Example linking GoogleMock with main:

```cmake
find_package(GTest REQUIRED)  # If installed and findable

add_executable(MyTest test.cpp)
target_link_libraries(MyTest gmock_main)
```

If you build GoogleTest and GoogleMock from source in your project with `add_subdirectory()`, ensure the dependencies are correctly set up, as GoogleMock depends on GoogleTest internally.

### 3. Understand pkg-config Files (Optional)

If you leverage `pkg-config` in your build system, GoogleTest and GoogleMock install `.pc` files describing library paths and compiler flags.

Example content from `gmock_main.pc.in`:

```text
Name: gmock_main
Description: GoogleMock (with main() function)
Version: @PROJECT_VERSION@
URL: https://github.com/google/googletest
Requires: gmock = @PROJECT_VERSION@
Libs: -L${libdir} -lgmock_main @CMAKE_THREAD_LIBS_INIT@
Cflags: -I${includedir} @GTEST_HAS_PTHREAD_MACRO@
```

Use these files with `pkg-config --cflags gmock_main` and `pkg-config --libs gmock_main` to get accurate compiler and linker flags.

### 4. Handle Platform and Compiler Configurations

GoogleTest and GoogleMock are designed for portability, supporting platforms like Linux, Windows, MacOS, and QNX. When configuring your build:

- Use the `GTEST_HAS_PTHREAD` macro on POSIX systems with pthread support.
- On Windows with MSVC, consider setting `gtest_force_shared_crt` in CMake to manage runtime linkage consistency.
- If building shared libraries, add `-DGTEST_CREATE_SHARED_LIBRARY=1` when compiling GoogleTest and `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when compiling your tests.

### 5. Build and Install GoogleTest/GoogleMock

When building from source using CMake, follow this standard sequence:

```bash
git clone https://github.com/google/googletest.git
cd googletest
mkdir build && cd build
cmake ..
make
sudo make install
```

Turn `BUILD_SHARED_LIBS` ON or OFF depending on whether you want shared or static libraries.

To build GoogleMock with tests, set `gmock_build_tests` to ON via `-Dgmock_build_tests=ON`.

### 6. Link Your Test Executables

After installing or building, link your test targets to the appropriate GoogleTest/GoogleMock libraries:

- Link with `gtest_main` or `gmock_main` if you want automatic `main()`.
- Link with `gtest` or `gmock` if you provide your own `main()`.

### 7. Validate Your Configuration

Compile and run the sample tests provided by GoogleTest and GoogleMock to verify your setup.

```bash
./sample1_unittest
./gmock_leak_test_
```

Successful tests confirm your dependencies and configuration are correctly set.

---

## Examples & Code Samples

### Example CMake Snippet for GoogleMock

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyProject)

find_package(gmock CONFIG REQUIRED)

add_executable(my_tests test.cpp)
target_link_libraries(my_tests gmock_main)
```

This snippet finds the installed GoogleMock package and links your test executable against `gmock_main`.

### Example pkg-config Usage with GoogleTest

```bash
cflags=$(pkg-config --cflags gtest)
libs=$(pkg-config --libs gtest)

g++ $cflags -o my_test test.cpp $libs
```

This compiles and links your test manually using flags from pkg-config.

---

## Troubleshooting & Tips

### Common Issues
- **Linker errors due to missing `main()`**: Make sure you link against `gtest_main` or `gmock_main` if you don’t provide your own `main()`.

- **Pthread missing on POSIX builds**: Define or confirm the `GTEST_HAS_PTHREAD` macro is set and pthreads are linked.

- **Runtime library mismatch on MSVC**: Use `gtest_force_shared_crt` option in CMake to align runtime libraries.

- **Shared library export/import issues**: Add the relevant compile definitions `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when building tests that link against shared GoogleTest/GoogleMock.

### Best Practices
- Prefer linking against `gmock_main` or `gtest_main` when possible to avoid boilerplate `main()` code.
- Keep library versions consistent to avoid compatibility issues.
- Use CMake’s targets (`gtest`, `gmock`, `gtest_main`, `gmock_main`) instead of hardcoding paths.

### Performance Considerations
- Static libraries (`BUILD_SHARED_LIBS=OFF`) typically build and link faster and yield simpler deployments.

- Using the main variants allows for faster test executable setup but limits your control over `main()`.

### Alternative Approaches
- If not using CMake, directly use `pkg-config` to integrate GoogleTest and GoogleMock with your preferred build system.

- When embedding GoogleTest into your source tree, use `add_subdirectory()` to ensure proper build order and dependencies.

---

## Next Steps & Related Content

- Learn [Writing Your First Test](/guides/getting-started/first-test) to write effective test cases after setting up dependencies.
- Explore [Getting Started with GoogleMock](/guides/mocking-advanced/getting-started-mocking) to leverage mocking capabilities.
- Read [Integrating with Build Systems](/guides/real-world-integration/build-system-integration) to deepen your build system integration skills.
- Visit the [System Requirements & Supported Platforms](/getting-started/prerequisites-installation/requirements-platforms) page to confirm environment compatibility.

---

<Check>
Always confirm that your test executable links against the correct variant (`_main` or not) based on whether you provide `main()`. Linking against the incorrect variant leads to linker errors or multiple definition errors.
</Check>

<Warning>
Improper mixing of shared and static libraries or runtime libraries in MSVC environments causes subtle bugs or linker failures. Use CMake options and definitions consistently.
</Warning>