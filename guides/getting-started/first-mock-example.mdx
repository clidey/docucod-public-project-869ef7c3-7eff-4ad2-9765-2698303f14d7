---
title: "Introducing Mocks: Your First Mocking Example"
description: "A beginner-friendly walkthrough of creating and using a mock object with GoogleMock. Explains mock class definition, setting expectations, and verifying interactions, using a practical code sample."
---

# Introducing Mocks: Your First Mocking Example

Welcome to your first deep dive into GoogleMock, the powerful mocking framework bundled with GoogleTest. This guide will walk you through the essential steps of creating and using mock objects in your C++ tests. You’ll learn how to define a mock class that simulates a real interface, set clear expectations on how your mocks should be called, and verify that the interactions happen exactly as planned — all backed by practical code examples.

---

## 1. What You Will Achieve

### Task Description
This guide introduces you to the core workflow of mocking with GoogleMock, showing how to create mock classes from interfaces, set expectations on mock method calls, and verify interactions in tests.

### Prerequisites
- Basic understanding of C++ interfaces and virtual methods.
- GoogleTest and GoogleMock installed and set up in your environment.

### Expected Outcome
By following this guide, you will:
- Define a mock class for an interface using `MOCK_METHOD`.
- Create mock objects in your tests.
- Set expectations on mock methods using `EXPECT_CALL`.
- Understand how GoogleMock verifies these expectations automatically.

### Time Estimate
Approximately 15-30 minutes, depending on prior familiarity.

### Difficulty Level
Beginner — aimed at developers new to mocking and GoogleMock.

---

## 2. Creating Your First Mock Class

Imagine you’re working on a graphics application that interfaces with a turtle graphics API. Your code interacts with a `Turtle` interface which has pure virtual methods such as `PenUp()`, `Forward(int)`, and `GetX()`.

Rather than testing against a real turtle that draws graphics, you want to ensure your code calls these methods correctly — that’s where mocking shines.

### Step-by-Step: Defining a Mock Class

1. **Identify the Interface to Mock**

    The `Turtle` interface looks like this:

    ```cpp
    class Turtle {
     public:
      virtual ~Turtle() {}
      virtual void PenUp() = 0;
      virtual void PenDown() = 0;
      virtual void Forward(int distance) = 0;
      virtual void Turn(int degrees) = 0;
      virtual void GoTo(int x, int y) = 0;
      virtual int GetX() const = 0;
      virtual int GetY() const = 0;
    };
    ```

    Note the `virtual` destructor is essential to allow proper cleanup.

2. **Derive a New Mock Class**

    Create a class `MockTurtle` inheriting from `Turtle`.

3. **Use the `MOCK_METHOD` Macro**

    For every virtual function in `Turtle` you want to mock, declare a public mock method using the macro:

    ```cpp
    #include <gmock/gmock.h>

    class MockTurtle : public Turtle {
     public:
      MOCK_METHOD(void, PenUp, (), (override));
      MOCK_METHOD(void, PenDown, (), (override));
      MOCK_METHOD(void, Forward, (int distance), (override));
      MOCK_METHOD(void, Turn, (int degrees), (override));
      MOCK_METHOD(void, GoTo, (int x, int y), (override));
      MOCK_METHOD(int, GetX, (), (const, override));
      MOCK_METHOD(int, GetY, (), (const, override));
    };
    ```

    - The macro syntax is `MOCK_METHOD(return_type, method_name, (args), (specifiers));`
    - Include `(override)` to explicitly state that this overrides a virtual method.
    - Mark const methods with `(const, override)`.

4. **No Implementation Needed**

    You don't have to define these methods; the macro generates them for you.

<Tip>
Always define mock methods in the `public:` section, even if the original methods were protected or private. This visibility allows test code to set expectations and behaviors.
</Tip>

---

## 3. Setting Expectations on Mocks

Once you have your mock class, you need to specify how you expect its methods to be used in your test. This is done with `EXPECT_CALL`.

### How Expectations Work

- `EXPECT_CALL(mock_object, Method(args))` creates an expectation that the method should be called with matching arguments.
- You can specify how many times the call should happen, using `.Times()`, or leave it inferred.
- You can specify return values or actions with `.WillOnce()` and `.WillRepeatedly()`.

### Practical Example

Suppose you’re testing a `Painter` class that draws circles using a `Turtle`. You want to check if the `PenDown()` method is called at least once during drawing.

```cpp
#include "path/to/mock_turtle.h"
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;

TEST(PainterTest, CanDrawSomething) {
  MockTurtle turtle;
  // Expect PenDown() to be called at least once
  EXPECT_CALL(turtle, PenDown())
      .Times(AtLeast(1));

  Painter painter(&turtle);

  // DrawCircle exercises turtle methods
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

### What Happens Here?

1. The mock object `turtle` is created.
2. `EXPECT_CALL` sets an expectation for `PenDown()`.
3. `painter.DrawCircle()` executes code that uses `turtle`.
4. If `PenDown()` is not called at least once, the test fails with a detailed error.

<Note>
Always set expectations _before_ calling the methods on the mock. `EXPECT_CALL` works by declaring expected future interactions.
</Note>

---

## 4. Understanding Matchers and Actions

### Matchers — Specifying Arguments

- You can restrict method calls by specifying arguments in `EXPECT_CALL`, e.g., `EXPECT_CALL(turtle, Forward(100))`.
- Use the wildcard matcher `_` to match any value when argument specifics are not critical.
- Use built-in matchers like `Gt()`, `Le()`, or provide custom ones for complex cases.

Example:
```cpp
EXPECT_CALL(turtle, GoTo(50, _)); // Expects x=50, y any value
```

### Actions — What the Mock Should Do

- You can specify what the mock method returns or does when called.
- `.WillOnce(Return(value))` sets the return value for one call.
- `.WillRepeatedly(Return(value))` sets the return value for subsequent calls.

Example:
```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))
    .WillRepeatedly(Return(200));
```

---

## 5. Best Practices and Tips

- **Use Mocks to Test Interactions:** Mocks verify how your code interacts with dependencies, not just outcomes.
- **Keep Expectations Reasonable:** Overly strict expectations make tests brittle; only verify what's necessary.
- **Order Matters:** Use `InSequence` or `.After()` to enforce call order if it matters.
- **Retiring Expectations:** Use `.RetiresOnSaturation()` when you expect a limited number of calls to a method.
- **Suppress Uninteresting Calls:** Use `NiceMock` wrapper to suppress warnings for unimportant mock methods.

---

## 6. Common Pitfalls and Troubleshooting

### Expectation Not Set Before Call

If you call a mock method without an `EXPECT_CALL` set, behavior is undefined. Always set expectations upfront.

### Too Strict or Too Loose

- Too strict expectations cause tests to fail on unrelated changes.
- Too loose expectations allow bugs to slip.

Find the balance by specifying only critical argument constraints and call counts.

### Uninteresting Call Warnings

GoogleMock warns when mock methods are called without expectations. If these calls are expected but uninteresting, wrap your mock in `NiceMock`.

### Return Type Mismatch

If your mock method returns a complex or move-only type, specify return values using lambdas or `Return()` carefully.

<Tip>
If your test unexpectedly passes or fails, try running with `--gmock_verbose=info` to see detailed mock call traces.
</Tip>

---

## 7. Next Steps

- Explore [Mastering Assertions](/guides/core-workflows/rich-assertions) to improve your test validations.
- Learn [Effective Mocking Patterns](/guides/core-workflows/mocking-patterns) to organize complex mock interactions.
- Advance to [Writing Your First Test](/guides/getting-started/writing-first-test) to integrate mocks with test logic.
- Consult the [Mocking Reference](../api-reference/gmock-mocking-framework/mock-methods-and-classes) for detailed API usage.

---

## Quick Reference Code Sample

```cpp
#include <gmock/gmock.h>

// Interface to mock
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

// Mock class using gMock
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};

// Example test
TEST(PainterTest, DrawCircleCallsPenDown) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(::testing::AtLeast(1));

  // Assuming Painter is your production class that uses Turtle.
  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

---