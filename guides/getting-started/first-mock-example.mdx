---
title: "Your First Mock: Testing with GoogleMock"
description: "An introductory walkthrough for creating and using mock objects in tests. This guide covers when and why to use mocking, demonstrates mock class definition, and steps through a simple mock-based unit test."
---

# Your First Mock: Testing with GoogleMock

## Introduction
This guide introduces you to creating and using mock objects in your tests using GoogleMock (gMock). You'll learn when and why to use mocking, how to define mock classes, and how to write a simple unit test that uses mocks. This essential skill lets you verify the interaction between your code and its dependencies, making tests more robust and maintainable.

---

## Workflow Overview

### What You Will Achieve
By following this guide, you will:
- Understand the purpose and benefits of mocking in unit tests.
- Define a mock class using `MOCK_METHOD` macros.
- Write a unit test that sets expectations on mock objects.
- Learn how GoogleMock verifies method calls and argument matching.

### Prerequisites
- Familiarity with basic C++ and GoogleTest.
- GoogleTest and GoogleMock installed and configured in your project.
- A simple interface (abstract base class) that you wish to mock.

### Time Estimate
About 15-20 minutes to complete the example and understand the concepts.

### Difficulty
Beginner to intermediate – no advanced C++ features required.

---

## Step-by-Step Instructions

### 1. Understand Why and When to Use Mocking
Sometimes in tests, it's impractical or undesirable to use real objects because they might be slow, unreliable, or difficult to control (e.g., file systems, networks, databases). Mock objects replace these collaborators, allowing you to:

- Specify expected interactions explicitly.
- Control behavior of dependencies during tests.
- Detect incorrect usage of dependencies early.

Example scenario: Testing a `Painter` class that draws shapes using a `Turtle` interface. Instead of relying on an actual drawing implementation, you mock the `Turtle` to verify the drawing calls.

### 2. Define a Mock Class
Given an interface such as `Turtle`, you create a derived mock class with `MOCK_METHOD` macros for each virtual method.

```cpp
#include <gmock/gmock.h>  // Include GoogleMock headers

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

### Key Points:
- Always put `MOCK_METHOD` declarations in the `public:` section of your mock class.
- Use `(override)` to indicate you are mocking virtual functions properly.
- For const methods, add `(const, override)`.

### 3. Write a Simple Mock-Based Unit Test
Now you can use the mock in a test to verify interactions. For example, a test ensuring `PenDown()` is called when drawing:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::AtLeast;

class Painter {
 public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}
  bool DrawCircle(int x, int y, int radius) {
    turtle_->PenDown();
    // ... Drawing logic omitted ...
    return true;
  }

 private:
  Turtle* turtle_;
};

TEST(PainterTest, CanDrawSomething) {
  MockTurtle turtle;                     // Step 2: create mock object

  EXPECT_CALL(turtle, PenDown())        // Step 3: set expectation
      .Times(AtLeast(1));                // Expect PenDown to be called at least once

  Painter painter(&turtle);             // Step 4: exercise code under test
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));  // Step 5: optionally verify outcome
}
```

### What Happens:
- `EXPECT_CALL(turtle, PenDown())` sets an expectation that `PenDown()` must be called at least once.
- If `PenDown()` is not called, the test fails with a clear message.
- If called more than expected or with wrong arguments, test will fail immediately.

### 4. Run and Interpret the Test
Compile and run your tests as usual. If the mock’s expectations are not met, the failure output will guide you to the problem with file, line number, and call details.

<Tip>
Run your test with `--gmock_verbose=info` to see detailed logs of mock interactions. This helps diagnose expectation failures.
</Tip>

### 5. Set Flexible Expectations Using Matchers
If you don't care about some arguments, replace them with `_` matcher:

```cpp
using ::testing::_;
EXPECT_CALL(turtle, GoTo(50, _)); // x must be 50; y can be anything
```

You can specify how many times a method should be called with `Times()`, use sequences (`InSequence`) to enforce call order, and define return values using `.WillOnce(Return(value))` or `.WillRepeatedly(Return(value))`.

### 6. Best Practices
- Always write `EXPECT_CALL` before exercising the code that calls the mock.
- Define mock classes near the tests that own the mocked interfaces, to avoid maintenance issues if the interface changes.
- Avoid over-constraining your mocks; prefer minimal expectations necessary to verify the test intent.
- Use `RetiresOnSaturation()` if a strict call count could cause brittle tests.

---

## Troubleshooting & Tips

### Common Issues
- **Mock methods not called as expected**: Check that `EXPECT_CALL` is set up before the tested code runs.
- **Uninteresting calls warning**: This means a mock method without an expected call was invoked. Use `NiceMock` to suppress or add catch-all expectations with `.Times(AnyNumber())` if these calls are acceptable.
- **Overly strict expectations cause test failures after refactoring**: Relax expectations or use sequences and partial ordering to avoid brittle tests.

### Pro Tips
- Use `ON_CALL` to specify default mock behaviors without setting call expectations.
- Use `NiceMock` to suppress unwanted warnings during development.
- Use `InSequence` for ordering calls if sequence matters.
- Matchers like `AnyNumber()`, `AtLeast()`, `_` (wildcard) keep tests flexible.
- When mocking overloaded methods, always specify argument types or use `Const()` for const overloads to disambiguate.

---

## Next Steps & Related Content
- **Writing Your First Test**: If you haven't yet, see [Writing Your First Test](../getting-started/writing-your-first-test.md) to get comfortable with basic GoogleTest concepts.
- **Mocking Reference**: For a comprehensive description of mocking facilities, visit the [Mocking Reference](../reference/mocking.md).
- **gMock Cookbook**: For advanced mocking patterns and tips, explore the [gMock Cookbook](../gmock_cook_book.md).
- **Setup and Installation**: Ensure your environment is correctly set up by reviewing [Setup and Installation](../getting-started/setup-installation.md).
- **Troubleshooting**: If you encounter issues, consult [Common Installation & Configuration Issues](../getting-started/setup-troubleshooting/common-issues.md).

---

## Additional Resources
- [GoogleMock Official Documentation](https://google.github.io/googletest/gmock_for_dummies.html)
- GoogleMock API Reference
- Matchers and Actions Reference

---

## Summary
This page guides you through your first use of GoogleMock for testing with mocks. Through practical steps and code examples, you learn how to define mock classes, set method call expectations, specify behaviors via matchers and actions, and write robust unit tests that verify interactions. Start here to gain confidence with mocking concepts before exploring advanced features and integration.

---