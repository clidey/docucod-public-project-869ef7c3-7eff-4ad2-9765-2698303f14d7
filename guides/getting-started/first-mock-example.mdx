---
title: "Your First Mock with GoogleMock"
description: "Introduces mocking concepts in C++, demonstrates how to create and use mock classes, set expectations, and simulate behavior with GoogleMock. Teaches the use of basic mock macros in real test scenarios."
---

# Your First Mock with GoogleMock

## Introduction

Welcome to your first step into mocking with GoogleMock (gMock). This guide introduces the core concepts of creating and using mock classes in C++. You'll learn how to define mock classes and mock methods, specify expectations about their usage, and verify interactions in your tests. This foundational knowledge will help you test complex components by replacing dependencies with mocks.

---

## What You Will Learn

- How to create a mock class using `MOCK_METHOD`
- How to set basic expectations with `EXPECT_CALL`
- How to control mock method behavior using actions
- How to write a simple test using a mock

---

## Prerequisites

Before you begin, make sure you have:

- GoogleMock and GoogleTest installed and configured in your project
- Basic understanding of C++ classes and virtual functions
- Familiarity with writing GoogleTest test cases

For setup instructions, refer to [Setup and Installation](https://google.github.io/googletest/guides/getting-started/setup-and-installation.html).

---

## Understanding Mock Classes

In gMock, a **mock class** is a special class that provides mocked implementations of the functions in your real class or interface. Instead of writing the mock functions yourself, gMock's `MOCK_METHOD` macro generates them for you, allowing you to specify what calls you expect and how they behave.

### Defining Mock Methods

Each method you want to mock requires a line like this inside your mock class:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- `ReturnType`: The return type of the method
- `MethodName`: The name of the method
- `Args...`: The argument types inside parentheses
- `Qualifiers` (optional): Method qualifiers such as `const` or `override`

**Example:**

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Important:** Put `MOCK_METHOD` declarations in the `public:` section, even if the original method is in another access section.

---

## Setting Expectations with `EXPECT_CALL`

GoogleMock allows you to specify your expectations about how mock methods will be called using `EXPECT_CALL`. This includes how many times a method should be called, with what parameters, and what it should return or do.

### Basic Syntax

```cpp
EXPECT_CALL(mock_object, MethodName(Matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `mock_object`: The instance of your mock class
- `MethodName`: The method to expect
- `Matchers`: Matchers that describe the method arguments (`_` for any value)
- `Times`: How many times you expect the method to be called (optional)
- `WillOnce` / `WillRepeatedly`: What to do when the expected call happens

### Example

Imagine testing a drawing program that uses the `MockTurtle`:

```cpp
using ::testing::_;
using ::testing::Return;

TEST(PainterTest, DrawsSquare) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(1);
  EXPECT_CALL(turtle, Forward(5))
      .Times(4);
  EXPECT_CALL(turtle, Turn(90))
      .Times(4);

  Painter painter(&turtle);
  painter.DrawSquare(5);
}
```

Here, you expect the turtle to put the pen down once, move forward 5 units four times, and turn 90 degrees four times.

---

## Controlling Behavior with Actions

By default, mock methods return zero or default-constructed values. You can customize this behavior using **actions**.

### Common Actions

- `Return(value)`: Returns a specific value.
- `ReturnRef(variable)`: Returns a reference to the variable.
- `Invoke(callable)`: Invokes the given function, lambda, or functor.
- `DoAll(...)`: Combines multiple actions.

### Example

```cpp
EXPECT_CALL(mock_turtle, GetX())
    .WillRepeatedly(Return(42));
```

This makes the mock method `GetX()` always return 42.

---

## Writing Your First Mock Test

Putting it all together, here's a complete minimal example to mock a `Turtle` interface and test its usage.

### Interface to Mock

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
};
```

### Mock Class

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};
```

### Test Using the Mock

```cpp
#include <gtest/gtest.h>

using ::testing::_;
using ::testing::AtLeast;

TEST(TurtleTest, DrawLine) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(1);
  EXPECT_CALL(turtle, Forward(10))
      .Times(1);
  EXPECT_CALL(turtle, PenUp())
      .Times(1);

  // Code under test using turtle here:
  turtle.PenDown();
  turtle.Forward(10);
  turtle.PenUp();
}
```

This test verifies that `PenDown()`, `Forward(10)`, and `PenUp()` are called exactly once.

---

## Practical Tips and Best Practices

- **Always add the `override` qualifier** when mocking a virtual method.
- **Put `MOCK_METHOD` macros in the public section** regardless of original access level.
- **Use matchers like `_`** when you don’t care about certain parameters.
- **Set default behavior with `ON_CALL`** if the method is called but you don't want to expect it explicitly.
- **Use `NiceMock<T>`** to suppress warnings for uninteresting calls.
- **Use sequences** to enforce call order when necessary by wrapping `EXPECT_CALL`s in an `InSequence` block.

---

## Common Pitfalls

- **Mismatch between arguments and mock method declaration:** Make sure the argument list and qualifiers match exactly.
- **Forgetting to mock all overloaded methods:** If a method is overloaded, you must mock each overload explicitly or bring others into scope with `using`.
- **Setting expectations after the mock method is called:** Always set expectations before exercising the code.
- **Leaking mock objects:** Always delete mocks or allow leaks explicitly, otherwise verification is skipped.
- **Ignoring uninteresting call warnings:** If a method is called but has no `EXPECT_CALL`, gMock will warn — decide if you want to ignore or expect the call.

---

## Troubleshooting

### Issue: Method of the real object called instead of mock

Make sure the method you mock is declared `virtual` in the base class.

### Issue: Unexpected or uninteresting mock function call warnings

Use `NiceMock` to suppress uninteresting call warnings, or add appropriate `EXPECT_CALL` or `ON_CALL` statements.

### Issue: Confusing overload resolution

Specify the exact method signature when mocking overloaded functions.

### Issue: Tests fail due to call order

Use `InSequence` or `.After()` clauses to control expected order of calls explicitly.

---

## Next Steps

- Practice writing mocks for interfaces in your codebase
- Learn advanced matching and action techniques (see [Matchers Reference](https://google.github.io/googletest/reference/matchers.html))
- Explore partial and strict mock behaviors using [NiceMock](https://google.github.io/googletest/reference/mocking.html#_CPPv4N7testing12NiceMockIT_EE) and [StrictMock](https://google.github.io/googletest/reference/mocking.html#_CPPv4N7testing13StrictMockIT_EE)
- Delve into advanced mocking patterns in the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)

---

## References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Setting Expectations and Actions](https://google.github.io/googletest/reference/mocking.html#expectations-and-actions)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)

---

## Example Code Snippet

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};

TEST(TurtleTest, MovesForward) {
  MockTurtle mock_turtle;

  EXPECT_CALL(mock_turtle, PenDown()).Times(1);
  EXPECT_CALL(mock_turtle, Forward(10)).Times(1);
  EXPECT_CALL(mock_turtle, PenUp()).Times(1);

  mock_turtle.PenDown();
  mock_turtle.Forward(10);
  mock_turtle.PenUp();
}
```

This minimal test confirms the mock behavior as expected.

---

<Callout type="tip">
Remember: Define your mocks and expectations based on the interface and what the code under test should do, not on internal implementation details.
</Callout>

