---
title: "Basic Mocking with GoogleMock"
description: "Define your first mock class, set up expectations, and use simple matchers to verify interactions. This guide provides a concise walkthrough for employing GoogleMock in everyday C++ unit testing."
---

# Basic Mocking with GoogleMock

This guide takes you from defining a mock class to setting expectations and verifying interactions using simple matchers with GoogleMock. It provides a clear, practical walkthrough for getting started with mock-based unit testing in C++.

---

## Workflow Overview

- **Task Description**: Define your first mock class, set up interaction expectations, and verify behavior with simple argument matching using GoogleMock.
- **Prerequisites**:
  - Familiarity with basic C++ and virtual functions.
  - Installed GoogleMock and a C++ test environment.
  - An interface or class with virtual methods to mock.
- **Expected Outcome**: You will be able to:
  - Create a mock subclass using `MOCK_METHOD` macros.
  - Define expectations with `EXPECT_CALL`.
  - Use simple and wildcard matchers for arguments.
  - Run tests where the mock verifies interaction correctness.
- **Time Estimate**: 15-30 minutes.
- **Difficulty Level**: Beginner to Intermediate.

## Step-by-Step Instructions

<Steps>
<Step title="Define a Mock Class">
To mock a class with virtual methods, create a subclass and use the `MOCK_METHOD` macro to declare mocked methods. Place your mock methods in the public section regardless of the original method's access specifier.

Example:

```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo() = default;
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

**Tip:** If your method signature contains types with commas (like `std::pair` or `std::map`), enclose them in parentheses or use a type alias to avoid macro parsing errors.

</Step>

<Step title="Create Mock Objects in Tests">
Instantiate your mock class in your test code. This mock will replace a real collaborator and enable control and verification of interactions.

Example:

```cpp
TEST(FooTest, SampleTest) {
  MockFoo foo;
  // You can now use foo in the code you test.
}
```

</Step>

<Step title="Set Expectations with EXPECT_CALL">
Use `EXPECT_CALL(mock_object, Method(matchers))` to specify that the mock method is expected to be called with arguments matching the specified matchers.

- If you don’t care about some arguments, use `_` as a wildcard matcher.
- Specify how many times the call is expected using `.Times()` or rely on inference.
- Define what action should be taken on call using `.WillOnce()` or `.WillRepeatedly()`, or rely on default behavior.

Example:

```cpp
using ::testing::_;
using ::testing::Return;

EXPECT_CALL(foo, GetSize())
    .Times(3)
    .WillRepeatedly(Return(5));

EXPECT_CALL(foo, Describe("test"))
    .WillOnce(Return("Test description"));

EXPECT_CALL(foo, Process(_, 10))  // Matches any first argument and second arg of 10
    .WillOnce(Return(true));
```

**Expected Results:** These expectations ensure your code calls the mock methods as specified.

</Step>

<Step title="Exercise Your Production Code">
Write or run your production/tested code that uses the mock object. During execution, GoogleMock will track calls and verify against your expectations.

Example:

```cpp
EXPECT_EQ(foo.GetSize(), 5);
std::string desc = foo.Describe("test");
EXPECT_EQ(desc, "Test description");
EXPECT_TRUE(foo.Process(42, 10));
```

</Step>

<Step title="Run and Verify Expectations">
When the mock object is destructed (usually at the end of the test), GoogleMock automatically verifies that all expectations were met.

- If any expectation wasn’t fulfilled, the test will fail with detailed messages.
- You can manually verify earlier by calling `Mock::VerifyAndClearExpectations(&mock_object);`.

</Step>
</Steps>

## Examples & Code Samples

### Complete Mock Class Example

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

// Interface
class Widget {
 public:
  virtual ~Widget() = default;
  virtual int Size() const = 0;
  virtual void Resize(int width, int height) = 0;
};

// Mock
class MockWidget : public Widget {
 public:
  MOCK_METHOD(int, Size, (), (const, override));
  MOCK_METHOD(void, Resize, (int width, int height), (override));
};

TEST(WidgetTest, UsesResizeCorrectly) {
  MockWidget mock;

  EXPECT_CALL(mock, Resize(100, 200))
      .Times(1);
  EXPECT_CALL(mock, Size())
      .WillOnce(::testing::Return(100));

  mock.Resize(100, 200);
  EXPECT_EQ(mock.Size(), 100);
}
```

### Using Wildcard Matcher (`_`)

```cpp
EXPECT_CALL(mock, Resize(_, _))
    .Times(AnyNumber());  // Any resize call allowed, any arguments
```

### Using Multiple Expectations

```cpp
EXPECT_CALL(mock, Resize(50, 50));
EXPECT_CALL(mock, Resize(100, 200));
```
The later expectation overrides the former when arguments match.

## Best Practices & Tips

- Always place `EXPECT_CALL` before calling the mock methods.
- Use `_` for arguments you don’t care to specify.
- Prefer using `WillOnce`/`WillRepeatedly` to specify return values or actions.
- For verbose debugging, use the `--gmock_verbose=info` flag to trace mock calls.
- To avoid warnings on uninteresting calls, consider wrapping your mock with `NiceMock`.
- Use `StrictMock` to fail tests on any unexpected/uninteresting call.

## Troubleshooting

<AccordionGroup title="Common Issues with Basic Mocking">
<Accordion title="Expectations Not Met">
- Verify `EXPECT_CALL`s are set before exercising the code.
- Check if argument matchers correctly match the calls.
- Use `--gmock_verbose=info` for detailed trace.
</Accordion>
<Accordion title="Uninteresting Call Warnings">
- This indicates a call to a method with no matching `EXPECT_CALL`.
- Suppress with `NiceMock`, or add `EXPECT_CALL(...).Times(AnyNumber())`.
- Do not silence warning with empty `EXPECT_CALL` as it makes tests brittle.
</Accordion>
<Accordion title="Compilation Errors with MOCK_METHOD">
- Ensure method signatures are correct.
- Wrap return/argument types with commas inside parentheses or use aliases.
- Add `(const, override)` qualifiers if overriding const methods.
</Accordion>
<Accordion title="Mock Method Not Called as Expected">
- Confirm the correct overload is mocked.
- Use `Const()` to disambiguate const overloads.
- Use explicit typed matchers if necessary.
</Accordion>
</AccordionGroup>

## Next Steps & Related Content

- Explore [Advanced Mocking Patterns](../core-testing-workflows/advanced-mocking-patterns) for sophisticated mocks.
- Learn about [Matchers and Actions](../gmock-mocking-apis/matchers-and-actions) for argument validation and custom behaviors.
- Understand mock strictness modes in [Mock Strictness and Behavioral Modes](../gmock-mocking-apis/mock-strictness-and-behavior).
- Integrate mocks with your build system by reading [Integration with Build Systems](../../guides/real-world-examples/integration-build).

---

For detailed specifications of `EXPECT_CALL` clauses and behavior, see the [Mocking Reference](../../docs/reference/mocking.md) and the [gMock Cheat Sheet](../../docs/gmock_cheat_sheet.md). This guide builds the foundation for mocking workflows in GoogleMock.
