---
title: "Setting Up Your Test Environment"
description: "Learn how to set up GoogleTest and GoogleMock in your C++ project, configure your build system (CMake, Bazel), and validate your installation. This guide includes troubleshooting common setup issues and recommended project structures for test code."
---

# Setting Up Your Test Environment

## Overview

This guide walks you through setting up GoogleTest and GoogleMock in your C++ project. You'll learn how to configure your build system (CMake or Bazel), integrate the frameworks, and verify that your installation is correctly set up. Additionally, you will find tips on troubleshooting common setup problems and recommended project structures for your test code.

Whether you're starting fresh or adding testing capabilities to an existing project, this step-by-step approach ensures your environment is ready for successful testing.

---

## 1. Prerequisites

Before setting up GoogleTest and GoogleMock, ensure you have the following:

- A compatible operating system: Linux, macOS, Windows.
- A C++ compiler supporting at least C++17.
- The latest version of CMake (3.14 or newer) if using CMake.
- A build system compatible with your project: CMake or Bazel.
- Internet access to download GoogleTest sources or pre-built binaries.

---

## 2. Building and Linking GoogleTest and GoogleMock with CMake

### 2.1. Setup Your Project with GoogleTest via CMake

If your project uses CMake, follow these steps to add GoogleTest and GoogleMock:

1. **Create your project directory and enter it:**

   ```sh
   mkdir my_project && cd my_project
   ```

2. **Add a `CMakeLists.txt` file with the following content:**

   ```cmake
   cmake_minimum_required(VERSION 3.14)
   project(my_project)

   # Require C++17 standard
   set(CMAKE_CXX_STANDARD 17)
   set(CMAKE_CXX_STANDARD_REQUIRED ON)

   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
   )

   # On Windows, ensure consistent runtime linkage
   set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
   FetchContent_MakeAvailable(googletest)

   enable_testing()

   add_executable(
     example_test
     example_test.cc
   )

   target_link_libraries(
     example_test
     GTest::gtest_main
   )

   include(GoogleTest)
   gtest_discover_tests(example_test)
   ```

3. **Create a simple test file `example_test.cc`:**

   ```cpp
   #include <gtest/gtest.h>

   TEST(ExampleTest, BasicAssertions) {
     EXPECT_EQ(1 + 1, 2);
     EXPECT_STRNE("hello", "world");
   }
   ```

4. **Build and run tests:**

   ```sh
   cmake -S . -B build
   cmake --build build
   cd build
   ctest
   ```

   You should see output indicating all tests passed.

### 2.2. Best Practices When Configuring CMake

- Use the `FetchContent` mechanism to keep GoogleTest up to date and integrated cleanly.
- Set `CMAKE_CXX_STANDARD` to at least 17 for compatibility.
- Use `target_link_libraries` to link `gtest_main` for the default test entry point.
- Enable testing and discovery to harness CTest and continuous integration.

### 2.3. Linking GoogleMock

By default, the `googletest` repository includes GoogleMock, so linking against `GTest::gtest_main` provides both GoogleTest and GoogleMock facilities. Include `<gmock/gmock.h>` in your test code to access mocking features.

---

## 3. Building and Linking GoogleTest and GoogleMock with Bazel

If your project uses Bazel, the recommended way to setup testing is:

1. **Add GoogleTest as a dependency in your `WORKSPACE` file:**

   ```starlark
   http_archive(
       name = "com_google_googletest",
       urls = ["https://github.com/google/googletest/archive/refs/tags/release-1.17.0.tar.gz"],
       strip_prefix = "googletest-release-1.17.0",
   )
   ```

2. **Declare GoogleTest targets in your `BUILD` files as dependencies:**

   ```starlark
   cc_test(
       name = "my_test",
       srcs = ["my_test.cc"],
       deps = ["@com_google_googletest//googletest:googletest_main"],
   )
   ```

3. **Write your test code as usual and include required headers:**

   ```cpp
   #include <gtest/gtest.h>
   #include <gmock/gmock.h>

   TEST(MyTestSuite, BasicTest) {
     EXPECT_TRUE(true);
   }
   ```

4. **Run the test using Bazel:**

   ```sh
   bazel test //:my_test
   ```

---

## 4. Validating Your Installation

Once you've built your test binary, run it to verify everything is wired correctly.

1. **Run your test executable:**

   ```sh
   ./example_test
   ```

2. **Expected Output:**

   You should see output similar to:

   ```
   Running main() from gmock_main.cc
   [==========] Running 1 test from 1 test suite.
   [----------] Global test environment set-up.
   [----------] 1 test from ExampleTest
   [ RUN      ] ExampleTest.BasicAssertions
   [       OK ] ExampleTest.BasicAssertions (0 ms)
   [----------] 1 test from ExampleTest (0 ms total)

   [----------] Global test environment tear-down
   [==========] 1 test from 1 test suite ran. (0 ms total)
   [  PASSED  ] 1 test.
   ```

If all tests pass and output matches, your test environment is correctly set up.

---

## 5. Recommended Project Structure for Tests

- Organize test code in a dedicated directory, e.g., `tests/` or `test/`.
- Separate production source code and test code clearly.
- Place GoogleTest/GoogleMock headers under `external/` or vendor directories if vendored.
- Follow naming conventions: test files ending with `_test.cc` or `_unittest.cc`.
- Link test binaries with `gtest_main` to avoid custom main() implementations unless special setup is required.

Example directory layout:

```
my_project/
  src/
    foo.cc
    foo.h
  test/
    foo_test.cc
  CMakeLists.txt
```

The test `foo_test.cc` includes GoogleTest headers, defines tests for `foo.cc`, and is added as a test executable in CMake.

---

## 6. Troubleshooting Common Setup Issues

### Issue: Tests Are Not Discovered or Run

- Verify `InitGoogleTest(&argc, argv)` is called before `RUN_ALL_TESTS()` in your `main()`.
- Ensure the test binary links against `gtest_main` or you provide a valid `main()`.
- Confirm tests are correctly defined using `TEST()` or `TEST_F()` macros.

### Issue: Compiler or Linker Errors

- Check that your compiler supports at least C++17.
- On Windows, enable consistent runtime linkage (e.g., set `gtest_force_shared_crt` ON in CMake).
- When using pthreads on POSIX, ensure appropriate compiler and linker flags are used.

### Issue: Runtime Library Mismatches

- Match the build modes (Debug/Release) and runtimes (static/dynamic) between your test code and GoogleTest library.

### Tips

- Clean your build directories before rebuilding after changes.
- Update GoogleTest sources often to pick up fixes.
- Use verbose build output to diagnose complex build issues.

---

## 7. Sample `main()` Function When Not Using `gtest_main`

If you need customization before test execution, create your own `main()`:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This initializes both GoogleTest and GoogleMock, removing the need to call `InitGoogleTest()` separately.

---

## 8. Additional Tips

- Use `gtest_discover_tests()` in CMake to automatically detect tests without manual enumeration.
- Prefer linking to `gtest_main` to avoid writing custom `main()` functions.
- Use namespaces carefully to avoid naming conflicts.
- Name your test suites and tests without underscores `_` to avoid unexpected macro conflicts.

---

## 9. Resources and Next Steps

- Explore the [GoogleTest Primer](primer.md) to write your first tests.
- Check out samples in the `samples` directory for real-world examples.
- Review [Mocking Reference](reference/mocking.md) to master GoogleMock.
- Consult [Common Installation Issues](getting-started/troubleshooting-support/common-issues-and-fixes.md) for further help.

---

Setting up your test environment correctly is the foundation for reliable, maintainable C++ testing using GoogleTest and GoogleMock. With your environment prepared, you're ready to write effective tests and use the full capabilities of these powerful frameworks.
