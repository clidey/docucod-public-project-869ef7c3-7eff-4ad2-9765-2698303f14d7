---
title: "Building and Running Tests"
description: "Discover best practices for integrating GoogleTest into build systems such as CMake and Bazel. This tutorial covers configuring your project, compiling test binaries, and common CLI options, ensuring reliable and repeatable test executions."
---

# Building and Running Tests

## Overview

This guide walks you through integrating GoogleTest into your build environment using popular build systems like CMake and Bazel. You'll learn how to configure your project to include GoogleTest, compile your test binaries, and efficiently run your tests using common command-line options to ensure reliable and repeatable executions.

---

## Prerequisites

Before you begin, ensure you have met the following prerequisites:

- Your development environment supports C++17 or later.
- CMake (version 3.14 or higher) or Bazel build system is installed and configured.
- GoogleTest source is available locally or is fetched via your build pipeline.
- Basic familiarity with your project's build system and test framework conventions.

Refer to [Prerequisites and System Requirements](../getting-started/setup-prerequisites-installation/prerequisites-and-system-requirements) for detailed environment setup.

---

## Expected Outcome

By the end of this guide, you will have:

- Integrated GoogleTest into your build system.
- Built your test executable(s) containing GoogleTest tests.
- Executed test runs with control over filtering, repetition, and output.
- Adopted best practices for reliable, maintainable test workflows.

---

## Time Estimate

Setup and build configuration typically take 10 to 30 minutes, depending on prior familiarity with the build tools.

Running tests usually takes seconds to minutes per iteration, based on test suite size.

---

# Step-by-Step Instructions

### 1. Incorporate GoogleTest into Your Build

#### Using CMake

**Option A: Standalone GoogleTest Build**

1. Clone the GoogleTest repository:

   ```bash
   git clone https://github.com/google/googletest.git -b main
   cd googletest
   mkdir build && cd build
   ```

2. Generate the build files with CMake:

   - To build both GoogleTest and GoogleMock (default):

     ```bash
     cmake ..
     ```

   - To build only GoogleTest:

     ```bash
     cmake .. -DBUILD_GMOCK=OFF
     ```

3. Build GoogleTest:

   ```bash
   make
   ```

4. Optionally, install GoogleTest system-wide (requires admin privileges):

   ```bash
   sudo make install
   ```

**Option B: Integrate GoogleTest into Your Existing Project**

1. Add the following snippet to your `CMakeLists.txt` to fetch GoogleTest during configuration (requires CMake 3.14+):

   ```cmake
   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
   )
   set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Visual Studio compatibility
   FetchContent_MakeAvailable(googletest)

   add_executable(your_test_bin test_file.cpp)
   target_link_libraries(your_test_bin gtest_main)
   add_test(NAME your_test COMMAND your_test_bin)
   ```

2. Replace `your_test_bin` and `test_file.cpp` with your executable and test source file names.

3. Your tests will now be built as part of your project with shared compiler and linker settings.

Refer to the [Installing GoogleTest](../getting-started/setup-prerequisites-installation/installing-googletest) page for comprehensive build options.

#### Using Bazel

1. Declare GoogleTest as a dependency in your `WORKSPACE` file.
2. Use Bazel's `cc_test` rule to define your test target, linking against GoogleTest.

Example:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

Refer to Bazel documentation or GoogleTest Bazel integration guides for details.

---

### 2. Writing the Main Test Driver

If you do not link with `gtest_main` (which provides a default `main()`), define your own in your test source, typically `main.cpp`:

```cpp
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

`InitGoogleTest()` parses GoogleTest-specific command-line flags and prepares the framework.

`RUN_ALL_TESTS()` discovers and executes all registered tests, and returns 0 on success, 1 on failure.

**Important:** Do not ignore the return value of `RUN_ALL_TESTS()` as it signals test suite success.

---

### 3. Compiling Your Tests

Use your build system's standard methodology to compile the test binary incorporating GoogleTest and your test code.

- **With CMake:** Invoke `cmake` and `make` (or your generator equivalent), ensuring your test executable is built.
- **With Bazel:** Run `bazel build //:my_test`.

---

### 4. Running Tests and Controlling Execution

Once compiled, run your test executable directly or from your preferred test harness.

Common runtime options useful for controlling execution:

| Flag                      | Description                                                | Example                                      |
|---------------------------|------------------------------------------------------------|----------------------------------------------|
| `--gtest_filter`            | Runs only tests matching the filter patterns.              | `--gtest_filter=MyTestSuite.TestName`         |
| `--gtest_repeat`            | Repeat the tests run N times for flakiness detection.      | `--gtest_repeat=10`                             |
| `--gtest_shuffle`           | Randomize order of tests to detect dependencies.           | `--gtest_shuffle`                               |
| `--gtest_break_on_failure`  | Stops execution on first failure for debugging.            | `--gtest_break_on_failure`                      |
| `--gtest_list_tests`        | Lists all available tests without running them.            | `--gtest_list_tests`                            |

Example of running selected tests with repetition:

```bash
./your_test_bin --gtest_filter=MySuite.* --gtest_repeat=5
```

See [Basic Configuration Options](../getting-started/first-run-configuration-troubleshooting/basic-configuration-options) for a full list of runtime flags.

---

### 5. Best Practices for Reliable Testing

- **Test Independence:** Each test runs as a fresh instance, so avoid relying on test order.
- **Isolate Test Data:** Use test fixtures (`TEST_F`) and `SetUp`/`TearDown` methods for clean initialization.
- **Use Test Filtering:** Run small subsets during development to reduce iteration time.
- **Leverage Output Control:** Use XML/JSON output (`--gtest_output=xml:path`) to integrate with CI systems.
- **Repeat Flaky Tests:** Use repeat and shuffle to surface intermittent failures.
- **Verify Return Codes:** Always check the return value of `RUN_ALL_TESTS()` to ensure correct results.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Problems During Build and Run">
<Accordion title="GoogleTest Not Found by CMake">
Ensure GoogleTest source is where CMake expects it, or use FetchContent to automatically download it.
Verify that your `find_package(GTest REQUIRED)` or `FetchContent` usage matches current CMake version capabilities.
</Accordion>
<Accordion title="Linker Errors on Test Binaries">
Confirm that you are linking against `gtest` and/or `gtest_main`. Missing these results in unresolved symbols.
Check for mismatched runtime libraries on Windows; consider `gtest_force_shared_crt` option.
</Accordion>
<Accordion title="Tests Not Running or Filtering Unexpectedly">
Confirm your test names and suites don't contain underscores (`_`), as this can cause test registration conflicts.
Check your `--gtest_filter` usage and test name correctness.
Use `--gtest_list_tests` to verify available tests.
</Accordion>
<Accordion title="Test Crashes or Unexpected Failures">
Ensure tests are independent and do not rely on shared global state incorrectly.
Use `SetUp` and `TearDown` methods for initialization and cleanup.
Check logs or printf statements for hints on failures.
</Accordion>
</AccordionGroup>

---

## Additional Tips

- To speed up compilation, consider moving mock class constructors and destructors out of header files.
- Use `NiceMock` or `StrictMock` wrappers to suppress or enforce uninteresting calls during mocking.
- Employ parameterized tests and typed tests for scalable testing of multiple data inputs and type variations.
- Utilize event listeners to customize test reporting and integrate with other tools.

---

## Next Steps & Related Documentation

- Explore [Installing GoogleTest](../getting-started/setup-prerequisites-installation/installing-googletest) for full build system integration.
- Read [Writing and Running Your First Test](../getting-started/first-run-configuration-troubleshooting/writing-and-running-your-first-test) to learn test writing fundamentals.
- Dive into [Basic Configuration Options](../getting-started/first-run-configuration-troubleshooting/basic-configuration-options) to customize test runs.
- Consider [Troubleshooting Common Setup Issues](../getting-started/first-run-configuration-troubleshooting/troubleshooting-common-setup-issues) for resolving typical problems.
- Learn advanced test organization and mocking strategies under the **Guides** tab.

---

For a comprehensive overview of GoogleTest and its components, see the [GoogleTest Overview](../../index.md).

---