---
title: "Mocking Your First Method with GoogleMock"
description: "Introduces the fundamentals of mocking in C++ using GoogleMock, walking through the creation of mocks, setting expectations with ON_CALL and EXPECT_CALL, and verifying mock interactions. Ideal for users collaborating with legacy code or external dependencies."
---

# Mocking Your First Method with GoogleMock

### 1. Introduction to Mocking

Mocking is an essential technique in C++ testing that lets you simulate complex or external dependencies by creating mock versions of your classes. GoogleMock offers a powerful yet intuitive way to define mocks, specify expected interactions, and verify them, enabling effective, maintainable unit tests.

In this guide, you'll learn how to create a mock class, define mocked methods, set up default and expected behaviors using `ON_CALL()` and `EXPECT_CALL()`, and verify interactions during test execution.

---

### 2. Prerequisites

Before proceeding, ensure:

- You have a C++ project with GoogleTest and GoogleMock installed and properly configured.
- Basic familiarity with C++ classes and virtual methods.
- Your class interfaces have virtual methods to be mocked.
- `#include <gmock/gmock.h>` is available in your test files.

---

### 3. Expected Outcome

By following this guide, you will be able to:

- Define a GoogleMock mock class for any interface.
- Use `MOCK_METHOD` to mock virtual methods.
- Set default mock behaviors with `ON_CALL()`.
- Specify expectations and verify method calls with `EXPECT_CALL()`.
- Understand common pitfalls and best practices.

---

### 4. Time Estimate

This workflow takes approximately 10-20 minutes for initial mock creation and explanation, followed by ongoing practice during test development.

---

### 5. Step-by-Step Instructions

<Steps>
<Step title="Create Your Mock Class">
Start by defining a mock class derived from the interface or abstract class you want to mock. Use the `MOCK_METHOD` macro to mock each virtual method.

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

**Outcome**: `MockTurtle` now mocks the `Turtle` interface with callable mocked methods.

**Tip**: Always place `MOCK_METHOD` declarations in the `public:` section, regardless of the original method's access level.
</Step>

<Step title="Set Default Behavior with ON_CALL()">
Use `ON_CALL()` to define the default mock actions without setting strict expectations. This configures default return values or behaviors when the mock methods are invoked without explicit expectations.

```cpp
using ::testing::Return;

MockTurtle mock_turtle;
ON_CALL(mock_turtle, GetX()).WillByDefault(Return(10));
ON_CALL(mock_turtle, GetY()).WillByDefault(Return(20));
```

**Outcome**: `GetX()` will return 10 and `GetY()` will return 20 unless overridden by `EXPECT_CALL()`.

**Best Practice**: Use `ON_CALL()` in test fixtures or mock constructors to establish common default behavior shared across multiple tests.
</Step>

<Step title="Set Expectations with EXPECT_CALL()">
Specify precise behaviors and expected calls using `EXPECT_CALL()`. This enables verification that certain methods are called with expected parameters and the right number of times.

```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::AtLeast;
using ::testing::Return;

EXPECT_CALL(mock_turtle, PenDown()).Times(AtLeast(1));
EXPECT_CALL(mock_turtle, Forward(100)).WillOnce(Return());
EXPECT_CALL(mock_turtle, GoTo(_, _));  // Expect called with any coordinates
```

**Outcome**: The test will fail if `PenDown()` is not called at least once, or if other expectations are violated.

**Decision Point**: Choose between flexible matchers (`_`) and specific matchers (`Eq(value)`, `Ge(value)`) based on test intent.
</Step>

<Step title="Use Your Mock in Tests">
Inject the mock object into your code under test and run the test. GoogleMock verifies all expectations at the end of the test or when the mock object is destroyed.

```cpp
TEST(PainterTest, DrawsCircle) {
  MockTurtle mock_turtle;

  ON_CALL(mock_turtle, GetX()).WillByDefault(Return(50));
  ON_CALL(mock_turtle, GetY()).WillByDefault(Return(50));

  EXPECT_CALL(mock_turtle, PenDown()).Times(AtLeast(1));
  EXPECT_CALL(mock_turtle, Forward(100)).Times(1);

  Painter painter(&mock_turtle);
  bool result = painter.DrawCircle(50, 50, 100);

  EXPECT_TRUE(result);
}
```

**Expected Result**: The test passes if all expected calls occur as specified, failing immediately on unexpected calls.
</Step>

<Step title="Verify and Troubleshoot">
- Verify automatically happens on mock destruction.
- You may force verification earlier with `Mock::VerifyAndClearExpectations(&mock_object);`.
- To debug failing mock calls, run with `--gmock_verbose=info` command-line flag.

<Tip>
Run tests with `--gmock_verbose=info` to see detailed traces of mock calls and identify mismatches in expectations or calls.
</Tip>

<Warning>
Expectations must be set before the code that uses the mock is executed. Setting expectations afterward leads to undefined behavior.
</Warning>
</Step>
</Steps>

---

### 6. Practical Examples

#### Basic Mock Class Example

```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int Bar(int x) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x), (override));
};
```

#### Setting an Expectation with Return Value

```cpp
using ::testing::Return;

MockFoo mock_foo;
EXPECT_CALL(mock_foo, Bar(42)).WillOnce(Return(100));
EXPECT_EQ(mock_foo.Bar(42), 100);
```

#### Suppressing Uninteresting Call Warnings

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> nice_mock;
ON_CALL(nice_mock, Bar(_)).WillByDefault(Return(0));
```

#### Using Sequences for Ordered Calls

```cpp
using ::testing::InSequence;

{
  InSequence seq;
  EXPECT_CALL(mock, Foo(1));
  EXPECT_CALL(mock, Foo(2));
}
// Ensures Foo(1) is called before Foo(2).
```

---

### 7. Common Pitfalls & Best Practices

- **Always mock virtual methods:** Non-virtual methods cannot be mocked by GoogleMock unless you use advanced DI techniques.
- **Expectations before use:** Set `EXPECT_CALL()` before exercising your mock to avoid undefined behavior.
- **Use `ON_CALL()` for default behaviors:** Reserve `EXPECT_CALL()` for cases where you want to verify calls.
- **Watch for argument matching:** Use matchers wisely to avoid brittle tests. Use `_` for “any argument” and specific matchers when precision is needed.
- **Handle method overloading carefully:** Provide full argument lists for overloaded methods to avoid ambiguity.
- **Retire expectations when saturated:** Use `.RetiresOnSaturation()` if you want non-sticky expectations.
- **Suppress uninteresting call warnings with `NiceMock`:** Convert mocks to `NiceMock<MockClass>` to suppress warnings on calls with no expectations.
- **Use `InSequence` or `.After()` to define call order:** Ensures that the calls happen in the desired sequence.

---

### 8. Troubleshooting

- **Uninteresting call warnings:** Means a mock method was called without an `EXPECT_CALL`. Add an expectation or use `NiceMock` to suppress warnings.
- **Unexpected call errors:** The call arguments did not match any existing `EXPECT_CALL`. Review matchers and call order.
- **Failing tests without obvious reason:** Run tests with `--gmock_verbose=info` to trace mock calls and verify expectations.
- **Compiler errors with `MOCK_METHOD`:** Check for commas in template types and wrap them in additional parentheses or use type aliases.

<AccordionGroup title="Common Troubleshooting Tips">
<Accordion title="Fixing MOCK_METHOD Compile Errors Due to Commas">
Wrap argument or return types containing commas in parentheses or alias them:

```cpp
// Fails:
MOCK_METHOD(std::pair<int, int>, GetPair, ());

// Works:
MOCK_METHOD((std::pair<int, int>), GetPair, ());

// Or use aliasing:
using PairIntInt = std::pair<int, int>;
MOCK_METHOD(PairIntInt, GetPair, ());
```
</Accordion>
<Accordion title="Handling Overloaded Methods">
Specify full method signatures in `MOCK_METHOD` and use `using BaseClass::Method;` to avoid hiding overloads.
</Accordion>
<Accordion title="Suppressing Uninteresting Call Warnings">
Use `NiceMock` wrapper:

```cpp
NiceMock<MockMyClass> mock;
```

or add a catch-all expectation.
</Accordion>
</AccordionGroup>

---

### 9. Next Steps & Related Content

- **Writing Your First Test**: Learn how to write and run your initial GoogleTest unit test.
- **Test Discovery and Execution Workflow**: Understand how tests are discovered and run.
- **Using Assertions and Matchers Effectively**: Deepen your knowledge of argument matchers.
- **Advanced Mocking Patterns and Best Practices**: Explore more complex mocking techniques.
- **Mocking APIs and Macros Reference**: Detailed API definitions of mocking macros.

---

### References and Further Reading

- [GoogleMock Official Introduction](https://google.github.io/googletest/gmock_for_dummies.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [GoogleTest Quick Start Guide](https://google.github.io/googletest/quickstart.html)

---

### Summary

This document guides you through mocking C++ methods using GoogleMock, from defining mock classes and methods with `MOCK_METHOD`, to setting up mock behaviors with `ON_CALL` and verifying interaction with `EXPECT_CALL`. It emphasizes best practices to write effective, maintainable tests and includes troubleshooting common issues with mocking.

---