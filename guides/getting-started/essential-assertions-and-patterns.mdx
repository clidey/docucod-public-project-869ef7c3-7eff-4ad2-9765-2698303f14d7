---
title: "Essential Assertions and Test Patterns"
description: "Learn to express correct program behavior using GoogleTest's assertion macros and reusable test patterns. Explore equality, inequality, floating-point, fatal/non-fatal, and custom assertions, positioning your tests for clarity and reliability."
---

# Essential Assertions and Test Patterns

## Introduction

This guide empowers you with the essential assertion macros and reusable test patterns of GoogleTest, equipping you to express correct program behavior with precision and clarity. Master equality, inequality, floating-point assertions, and understand when to use fatal vs. non-fatal assertions to write reliable, maintainable tests.

### Prerequisites

- Basic familiarity with C++ and unit testing concepts.
- GoogleTest installed and configured in your project.
- Understanding of simple `%TEST()` or `%TEST_F()` test definitions.

### Expected Outcome

By following this guide, you will confidently apply the most critical GoogleTest assertions, understand best practices for failure handling, and leverage reusable patterns that result in clear, effective tests.

### Time Estimate

Approximately 15-30 minutes

### Difficulty Level

Beginner to Intermediate

---

## 1. Comparing Values: Equality and Inequality Assertions

GoogleTest provides a collection of built-in macros to compare values concisely.

### 1.1 Basic Equality: `EXPECT_EQ` and `ASSERT_EQ`

- Use to verify two values are equal using `==`.
- `ASSERT_*` macros abort the current function on failure, while `EXPECT_*` continue.

#### Example:

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);  // Non-fatal failure, test continues
  ASSERT_EQ(Factorial(1), 1); // Fatal failure, test aborts if fails
}
```

> ✅ Prefer `EXPECT_EQ` in situations where further checks can still give meaningful test results.

### 1.2 Inequality: `EXPECT_NE` and `ASSERT_NE`

- Use to verify two values are not equal.

#### Example:

```cpp
EXPECT_NE(foo, bar) << "foo and bar should differ";
```

### 1.3 Ordering Comparisons

- Test relational conditions: `<`, `<=`, `>`, `>=` with `EXPECT_LT`, `ASSERT_LE`, etc.

#### Example:

```cpp
EXPECT_LT(value, limit) << "value must be less than limit";
```

### 1.4 String Comparisons

- For C strings (`const char*`), use specialized macros:
  - `EXPECT_STREQ` / `ASSERT_STREQ` to verify string equality.
  - `EXPECT_STRNE` / `ASSERT_STRNE` to verify inequality.
  - Case-insensitive versions: `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`.

#### Example:

```cpp
EXPECT_STREQ(expected_cstr, actual_cstr) << "Strings differ.";
```

> ❗ Note: `EXPECT_EQ` with C strings compares pointers, not content.

---

## 2. Floating-Point Assertions

Due to rounding errors, direct equality comparisons for floating-point values often fail. Use these macros instead:

### 2.1 Approximate Equality

- `EXPECT_FLOAT_EQ(a, b)`: Tests that `float` values `a` and `b` are approximately equal within 4 ULPs.
- `EXPECT_DOUBLE_EQ(a, b)`: Like above but for `double`.

#### Example:

```cpp
EXPECT_FLOAT_EQ(result, expected) << "Result differs significantly";
```

### 2.2 Range Comparison

- `EXPECT_NEAR(val1, val2, abs_error)`: Checks that the absolute difference between `val1` and `val2` is within `abs_error`.

#### Example:

```cpp
EXPECT_NEAR(computed_value, 1.0, 0.01) << "Computed value is too far off";
```

> ⚠️ Always choose error bounds carefully for meaningful floating-point tests.

---

## 3. Boolean Assertions

### 3.1 `EXPECT_TRUE` and `ASSERT_TRUE`

- Verify that a condition or expression is `true`.

```cpp
EXPECT_TRUE(pointer != nullptr) << "Pointer should not be null";
```

### 3.2 `EXPECT_FALSE` and `ASSERT_FALSE`

- Verify that a condition or expression is `false`.

```cpp
ASSERT_FALSE(error_occurred) << "Error should not happen";
```

---

## 4. Fatal vs. Non-Fatal Assertions: Choosing When to Abort

- Use `ASSERT_*` when a failure should stop the test immediately.
- Use `EXPECT_*` when you want to report the failure but continue testing.

Example scenario:

```cpp
TEST(MyTest, PointerChecks) {
  ASSERT_NE(ptr, nullptr) << "ptr must be initialized";
  // Safe to dereference ptr below thanks to crash if ASSERT_NE fails
  EXPECT_EQ(*ptr, expected_value);
}
```

If `ASSERT_NE` fails, the test function returns early, preventing further failures or undefined behavior.

---

## 5. Customizing Failure Messages

- Any assertion supports streaming a custom message for clarity.

```cpp
EXPECT_EQ(actual, expected) << "Values differ at index: " << i;
```

This contextualizes failures, aiding quick diagnosis.

---

## 6. Advanced Assertions with Predicates

GoogleTest allows writing complex assertion checks using predicate functions or predicate-formatters.

### 6.1 Using `EXPECT_PRED*` Macros

- For predicates returning bool where argument values are printed on failure.

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
```

### 6.2 Using `testing::AssertionResult` for Clear Messages

- Write predicates that return `AssertionResult` to provide informative failure messages.

Example:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}
EXPECT_TRUE(IsEven(value));
```

Failures show descriptive messages about *why* the assertion failed.

### 6.3 Predicate-Formatter Assertions

- Use `EXPECT_PRED_FORMAT*` macros to fully customize how messages are formatted when default messages don't suffice.

---

## 7. Control Flow: Skipping and Explicit Success/Failure

### 7.1 Skipping Tests with `GTEST_SKIP()`

- When a runtime condition invalidates the test, skip it cleanly:

```cpp
TEST(SomeTest, SkipsIfConditionNotMet) {
  if (!EnvironmentReady()) {
    GTEST_SKIP() << "Skipping test because environment is not ready.";
  }
  // Test code here.
}
```

### 7.2 Explicitly Marking Success or Failure

- Use `SUCCEED()` to indicate a checkpoint was reached without failure (primarily for documentation).
- Use `FAIL()` to produce a fatal failure immediately.
- Use `ADD_FAILURE()` to produce a non-fatal failure.

---

## 8. Logging Additional Information

- Use `RecordProperty()` to log key-value pairs that will appear in XML or JSON test reports.

```cpp
TEST(MyTest, LogsProperties) {
  ::testing::Test::RecordProperty("ExecutionTime", 123);
}
```

Keys must be valid XML attribute names and not collide with reserved names.

---

## 9. Test Patterns: Organizing Assertions for Clarity and Reuse

### 9.1 Use Test Fixtures for Common Setup

- Group related tests sharing common setup in a test fixture class derived from `testing::Test`.

### 9.2 Use `SCOPED_TRACE` for Context in Helper Functions

- If multiple calls to a helper function contain assertions, use `SCOPED_TRACE(message)` to add context to failures.

```cpp
void CheckValue(int n) {
  SCOPED_TRACE("Checking value " + std::to_string(n));
  EXPECT_TRUE(n > 0);
}
```

### 9.3 Propagate Fatal Failures Correctly

- Fatal failures in subfunctions abort only that function. To propagate, use `ASSERT_NO_FATAL_FAILURE()` or check `HasFatalFailure()` after the call.

### 9.4 Registering Dynamic Tests

- Use `testing::RegisterTest()` to add tests programmatically when macros are not sufficient.

---

## 10. Troubleshooting and Tips

### 10.1 Common Pitfalls

- Misusing `ASSERT_*` in constructors/destructors (not allowed).
- Ignoring failure return codes of `RUN_ALL_TESTS()`.
- Overusing `EXPECT_CALL` in GoogleMock causing brittle tests.

### 10.2 Best Practices

- Prefer `EXPECT_*` over `ASSERT_*` when possible.
- Stream custom failure messages for clarity.
- Use predicate functions for complex checks.
- Use `GTEST_SKIP()` to conditionally skip tests.

---

## Next Steps

- Explore advanced assertions in [Advanced GoogleTest Topics](advanced.md).
- Learn mocking basics and advanced features in GoogleMock guides.
- Deepen knowledge on parameterized and typed tests.

---

## References

- [GoogleTest Primer](primer.md)
- [Assertions Reference](reference/assertions.md)
- [Advanced GoogleTest Topics](advanced.md)
- [GoogleMock Cookbook](gmock_cook_book.md)
- [Testing Reference](reference/testing.md)

---