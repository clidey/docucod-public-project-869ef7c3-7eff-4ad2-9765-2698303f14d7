---
title: "Writing Your First Mock"
description: "Start using GoogleMock to isolate dependencies: create basic mock classes, set expectations, and verify interactions. Includes a real-world example and best practices for effective mocking."
---

# Writing Your First Mock

Begin your journey with GoogleMock by learning how to isolate dependencies through the creation of basic mock classes, setting expectations on method calls, and verifying the interactions between components. This guide provides a practical, real-world example and best practices to ensure your mocking is both effective and maintainable.

---

## Workflow Overview

### What This Guide Helps You Accomplish

This guide empowers you to create your first mock class using GoogleMock's `MOCK_METHOD` macro, set clear expectations with `EXPECT_CALL`, and verify that your code interacts correctly with its dependencies. By following these steps, you will isolate dependencies in your tests, improving test reliability and focus.

### Prerequisites

- A working GoogleMock setup in your C++ environment.
- Basic understanding of C++ class inheritance and virtual functions.
- Familiarity with compiling and running GoogleTest-based tests.

### Expected Outcome

- A mock class that correctly mocks an interface or virtual class.
- Controlled test behavior through expectations on mocked methods.
- Clear failure diagnostics when expectations aren't met.

### Time Estimate

Completing this guide should take approximately 15-30 minutes, depending on familiarity with C++ and GoogleTest.

### Difficulty Level

Beginner to Intermediate.

---

## Step-by-Step Instructions

### Step 1: Define Your Mock Class

1. **Identify the interface or base class** you want to mock. Ensure its methods are virtual, which is required for mocking.
2. **Create a subclass** that inherits publicly from this interface.
3. In the `public:` section of your mock class, **declare mock methods with `MOCK_METHOD`**:
   - Syntax: `MOCK_METHOD(return_type, method_name, (arguments), (qualifiers));`
   - Use `(override)` qualifier if overriding a virtual method.
   - If the method is `const`, include `(const, override)`.

**Example:**
```cpp
#include <gmock/gmock.h>

class Turtle {
public:
  virtual ~Turtle() = default;
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

> **Tip:** If your method arguments include types with commas (e.g., `std::pair<int, int>`), wrap them with extra parentheses or use type aliases to avoid parsing errors.

### Step 2: Instantiate Your Mock in Tests

1. Include the mock class header in your test file.
2. Create an instance of the mock class.

```cpp
MockTurtle turtle;
```

### Step 3: Set Expectations Using `EXPECT_CALL`

1. Use `EXPECT_CALL` to specify that certain methods are expected to be called.
2. You can specify argument matchers (`_` for any value, specific values, or complex matchers).
3. Define cardinality via `.Times()`, or let GoogleMock infer it.
4. Specify return behavior and side effects with `.WillOnce()` and/or `.WillRepeatedly()`.

**Example:**
```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::Return;

EXPECT_CALL(turtle, PenDown())
    .Times(1);  // Expect called exactly once
EXPECT_CALL(turtle, Forward(5))
    .Times(AtLeast(1));  // Called one or more times
EXPECT_CALL(turtle, GetX())
    .WillRepeatedly(Return(10));  // Always returns 10
```

> **Note:** Setting expectations before exercising the code is critical; otherwise, the behavior is undefined.

### Step 4: Use the Mock Object in Your Code Under Test

Pass the mock object or a pointer/reference to it into the component you want to test. When methods are called on the mock, GoogleMock will check if the calls match the expectations.

### Step 5: Verification

GoogleMock automatically verifies all expectations on mock destruction. If any expectation is unmet or violated, the test will fail, displaying the reason and location.

---

## Real-World Example

Suppose you are testing a `Painter` class that relies on the `Turtle` interface:

```cpp
class Painter {
public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}

  void DrawLine() {
    turtle_->PenDown();
    turtle_->Forward(100);
    turtle_->PenUp();
  }

private:
  Turtle* turtle_;
};
```

Here's how to mock the interface and test `Paint::DrawLine()`:

```cpp
#include "mock_turtle.h"  // Contains MockTurtle
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;
using ::testing::_;

TEST(PainterTest, DrawLineCallsTurtleMethodsInOrder) {
  MockTurtle mock_turtle;

  {
    ::testing::InSequence seq;  // Expect calls in declared order
    EXPECT_CALL(mock_turtle, PenDown()).Times(1);
    EXPECT_CALL(mock_turtle, Forward(100)).Times(1);
    EXPECT_CALL(mock_turtle, PenUp()).Times(1);
  }

  Painter painter(&mock_turtle);
  painter.DrawLine();
}
```

If `Painter::DrawLine()` misses a call or calls methods out of order, this test will fail with a detailed report.

---

## Best Practices for Effective Mocking

- **Mock only interfaces or classes with virtual methods.** Avoid mocking concrete classes unless necessary.
- **Use the `override` qualifier** in mock methods to catch mismatches during compilation.
- **Limit expectations to what the test cares about.** Avoid over-specifying arguments or call counts.
- **Prefer `ON_CALL` for default behaviors and `EXPECT_CALL` only for calls you want to verify.**
- **Use `NiceMock` or `StrictMock` carefully:**
  - `NiceMock` suppresses warnings for uninteresting calls.
  - `StrictMock` treats unexpected or uninteresting calls as failures.
- **Chain multiple return behaviors using `.WillOnce()` and `.WillRepeatedly()`** to simulate realistic sequences.
- **Avoid mocking non-virtual or static methods directly; consider interface or adapter creation.**
- **When mocking overloaded methods, carefully disambiguate the overloads.**
- **Use argument matchers judiciously to balance flexibility with test robustness.**

---

## Common Pitfalls and Troubleshooting

### Issue: Mock Methods Won't Compile Due to Commas in Types

**Cause**: Unprotected commas in return or argument types confuse the `MOCK_METHOD` macro's parser.

**Fixes**:
- Wrap the type containing commas in an extra layer of parentheses.
- Use a type alias to simplify the signature.

### Issue: Unexpected or Uninteresting Calls Generate Warnings or Failures

**Cause**: Calling mock methods without matching `EXPECT_CALL` expectations.

**Solutions**:
- If calls are expected but donâ€™t require verification, use `ON_CALL` to specify default behavior.
- Use `NiceMock` to suppress warnings about uninteresting calls.
- Use `StrictMock` to treat uninteresting calls as failures, ensuring strict test coverage.
- Add catch-all expectations with `.Times(AnyNumber())` for methods that can be called with arbitrary arguments.

### Issue: Mock Methods with Move-Only Types

- GoogleMock fully supports mocking methods that take or return move-only types like `std::unique_ptr`.
- Use lambdas with `WillOnce` or `WillRepeatedly` for flexible mocked behaviors.

### Issue: Mock Destructors Cannot Be Mocked Directly

- Use a mock method called from the destructor to verify object destruction order. For example, add `MOCK_METHOD(void, Die, ())` and call it in the destructor.

---

## Next Steps & Related Content

- **Writing Your First Test:** Learn to write tests using GoogleTest to assert correctness of your code.
- **Using Assertions and Matchers:** Deepen your knowledge of argument matchers for more expressive tests.
- **Mocking Techniques and Patterns:** Explore advanced mocking patterns and idiomatic usages.
- **GoogleMock Cookbook:** Comprehensive recipes and patterns for mocking diverse scenarios.
- **GoogleMock Cheat Sheet:** Quick reference for `MOCK_METHOD` syntax, matchers, and actions.

---

## Summary

This guide demystifies the process of writing your first mock with GoogleMock. Start by defining a mock class with `MOCK_METHOD` macros, then set expectations using `EXPECT_CALL` to specify anticipated method interactions in your tests. Employ best practices to write maintainable, focused mocks that improve test quality while avoiding common pitfalls.

---

## Useful Links

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock Cheatsheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Writing Your First Test](https://google.github.io/googletest/guides/getting-started/writing-your-first-test.html)
- [GoogleTest Primer](https://google.github.io/googletest/docs/primer.html)

---

> **Note:** Remember to set expectations *before* exercising the code under test to ensure consistent and predictable behavior with GoogleMock.