---
title: "Introduction to Mocking"
description: "Guide to creating and using mock objects with GoogleMock. Explains core concepts such as mock methods, expectations, and using mocks in test cases."
---

# Introduction to Mocking with GoogleMock

Welcome to the foundational guide on creating and using mock objects with GoogleMock. This guide will equip you with the essential understanding and practical steps to effectively define mock methods, set expectations, and integrate mocks into your C++ test cases, allowing you to verify interactions, simulate behaviors, and build robust unit tests.

---

## What You Will Learn

- **What is Mocking?** Understand the concept and value of mock objects in unit testing.
- **Defining Mock Methods**: How to declare mock classes and mock methods using the `MOCK_METHOD` macro.
- **Setting Expectations**: Using `EXPECT_CALL` to describe expected call patterns and behaviors.
- **Default Actions with `ON_CALL`**: Defining fallback behavior for mock methods when no specific expectation is set.
- **Behaviors, Matchers, and Actions**: Control what your mocks return and how they respond to calls.
- **Common Mocking Patterns**: Including strict, nice, and naggy mocks, method overloading, private method mocking, and more.

---

## Prerequisites

Before diving into mocking, ensure the following:

- You have **GoogleMock** installed and set up correctly within your project.
- Basic familiarity with GoogleTest's unit testing framework.
- Understanding of C++ virtual functions and interfaces.
- Your base classes/interfaces have virtual methods to mock (or use advanced techniques if not).

---

## Expected Outcome

By following this guide, you will be able to:

- Define mock classes with mocked methods seamlessly.
- Specify how the mock methods behave and what calls are expected.
- Write tests that validate interactions between your code and mocked dependencies.
- Avoid common pitfalls in mocking setup.
- Customize mock behaviors via matchers and actions.

---

## Estimated Time

Completing this introduction and implementing basic mocks should take approximately 20-30 minutes, depending on your experience.


# 1. Understanding Mocking with GoogleMock

GoogleMock is a powerful C++ mocking framework integrated with GoogleTest, designed to simplify mocking dependencies in tests.

**Mock Object:** A mock object is a simulated object that mimics the behavior of a real object in a controlled way. You define how its methods behave and spec what calls are expected.


# 2. Creating Mock Classes and Mock Methods

### Step 1: Derive from the Interface or Base Class

Your mock class inherits from the interface or class you want to mock. For example, consider the interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

You create a mock like this:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

- Use the `MOCK_METHOD(return_type, method_name, (args...), (specs...));` macro.
- If mocking a `const` method, include `(const)` in the specs.
- Always place `MOCK_METHOD` declarations in the `public:` section regardless of the original method's visibility.


### Step 2: Deal with Complex Types in Signatures

If your mock method has parameters or return types containing commas (e.g., `std::pair`, `std::map`), wrap the type in parentheses or use type aliases:

```cpp
using BoolAndInt = std::pair<bool, int>;
using MapIntDouble = std::map<int, double>;

MOCK_METHOD(BoolAndInt, GetPair, ());
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```


### Step 3: Mock Overloaded Methods

Mock all overloaded versions using separate `MOCK_METHOD` macros. To avoid hiding base class overloads, use `using Base::MethodName;` for the ones you don't mock.

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Bring base overloads into scope
  MOCK_METHOD(int, Add, (Element x), (override));
  MOCK_METHOD(int, Add, (int times, Element x), (override));
};
```


# 3. Setting Expectations and Default Behaviors

### `EXPECT_CALL` - Setting Expectations

Use `EXPECT_CALL` at the start of your test to specify which mock method calls you expect, with which arguments, how often, and how they behave.

Syntax:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `Times(...)` controls how many times the call is allowed or required (e.g., `Exactly(3)`, `AtLeast(1)`, `AnyNumber()`).
- `WillOnce` specifies what to do on the first matching call, `WillRepeatedly` for all subsequent calls.

**Example:** Expect `Forward` to be called twice, any integer distance, and no return value.

```cpp
EXPECT_CALL(turtle, Forward(::testing::_))
    .Times(2);
```

To specify return values or behaviors, use matchers and actions:

```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(::testing::Return(10))
    .WillRepeatedly(::testing::Return(20));
```


### `ON_CALL` - Default Behavior

`ON_CALL` sets the fallback behavior when no specific `EXPECT_CALL` matches.

Example:

```cpp
ON_CALL(turtle, GetX())
    .WillByDefault(::testing::Return(0));
```

Note: `ON_CALL` does **not** set an expectation; calls matching only `ON_CALL` are considered "uninteresting" and may produce warnings unless using `NiceMock`.


### Control Over Mock Strictness

- **NaggyMock (default)**: Issues warnings on uninteresting calls.
- **NiceMock**: Suppresses warnings on uninteresting calls.
- **StrictMock**: Treats uninteresting calls as test failures.

Use as:

```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> nice_turtle;
```


# 4. Using Matchers and Actions

### Matchers

Matchers specify argument constraints in `EXPECT_CALL`, e.g., `_` matches anything, `Eq(value)` matches exact value, and others like `Lt`, `Ge`.

Example:

```cpp
EXPECT_CALL(turtle, Forward(::testing::Ge(5)));  // distance >= 5
```

### Actions

Actions specify what the mock method does when called:

- `Return(value)`: returns a value.
- `ReturnRef(ref)`: returns a reference.
- `Invoke(function)`: calls a user function or lambda.
- `SetArgPointee<N>(value)`: sets the value pointed to by the Nth argument.

Example:

```cpp
EXPECT_CALL(mock, Foo(_))
    .WillOnce(::testing::SetArgPointee<0>(5))
    .WillOnce(::testing::Return(true));
```


# 5. Common Mocking Patterns & Tips

### Mocking Private or Protected Methods

Always place `MOCK_METHOD` declarations in `public:` even if the base method is private or protected.

### Mocking Non-Virtual Methods

For non-virtual methods, define mock classes unrelated to the real ones and use template dependency injection to switch between real and mock.

### Delegating Calls

Mocks can delegate calls to real or fake objects to reuse implementation and still verify calls.

### Ordering Calls

Use `InSequence` to enforce call order:

```cpp
{
  ::testing::InSequence s;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```


### Retiring Expectations

Use `.RetiresOnSaturation()` on expectations to make them non-sticky after being satisfied, useful for sequential calls.


# 6. Troubleshooting & Best Practices

- **Expectations before Use**: Always set expectations *before* exercising the mock.
- **Avoid Over-Specification**: Use `ON_CALL` for default behaviors unless you want to verify the call.
- **Use `NiceMock` to suppress warnings** on uninteresting calls when appropriate.
- **Be explicit about cardinalities** with `Times` to clarify intent.
- **Verify mocks are deleted**: mocks verify expectations upon destruction; leaking mocks may hide failures.
- Use `Mock::VerifyAndClearExpectations(&mock_obj)` to force verification early if needed.


# 7. Next Steps and Related Guides

- Explore the **[gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)** for practical recipes and advanced usage.
- Read more about **Matchers** and **Actions** in their respective reference pages.
- Deepen your understanding of **Core Concepts**: test fixtures, expectations, matchers.
- Try writing tests with mock objects in your codebase following this introduction.

---

# Additional Resources

- [GoogleTest Primer](https://google.github.io/googletest/gmock_primer.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Troubleshooting Mock Failures](https://google.github.io/googletest/gmock_faq.html#troubleshooting-failed-or-unexpected-mocks)
- Source Code: [GitHub GoogleTest Repository](https://github.com/google/googletest/tree/main/googlemock)

---

Start crafting your mocks today to write expressive, maintainable tests and gain tighter control over your codeâ€™s behaviors during testing.
