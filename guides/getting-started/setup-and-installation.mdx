---
title: "Setup and Installation"
description: "A step-by-step walkthrough covering how to install GoogleTest/GoogleMock, configure your build system with CMake or Bazel, and include the necessary headers. Best practices for integrating into new or existing C++ projects ensure a smooth initial experience."
---

# Setup and Installation Guide for GoogleTest and GoogleMock

---

## 1. Workflow Overview

**What this Guide Achieves**

This guide walks you through installing GoogleTest and GoogleMock, configuring your C++ build environment using either CMake or Bazel, and correctly including the necessary headers. It equips you with best practices to integrate these testing frameworks into new or existing projects for a seamless testing setup.

**Prerequisites**

- A C++17-compliant compiler and compatible build tools installed.
- Basic familiarity with CMake or Bazel build systems.
- Access to the GoogleTest repository (https://github.com/google/googletest).
- Optional: Installed CMake (3.13 or newer recommended) or Bazel.

**Expected Outcome**

You will have GoogleTest and GoogleMock built and integrated into your project, with properly included headers and linked libraries. This will enable writing, building, and running C++ tests with Google’s testing frameworks immediately.

**Estimated Time**

15 to 30 minutes depending on environment setup and build times.

**Difficulty Level**

Beginner to Intermediate (suitable for developers comfortable with C++ build tools).

---

## 2. Step-by-Step Installation and Setup

### Step 1: Obtain GoogleTest and GoogleMock Source Code

- Clone the repository with both GoogleTest and GoogleMock:

```bash
  git clone https://github.com/google/googletest.git
  cd googletest
```

- Optionally, checkout a stable tag or branch:

```bash
  git checkout main
```

### Step 2: Prepare Your Build Environment

- Confirm your compiler supports C++17 standard.
- Make sure CMake (version 3.13 or above) is installed if you plan to use it.
- Verify Bazel installation if using Bazel as your build system.

### Step 3: Building with CMake

#### 3.1: Standalone Build

- Create and navigate to your build directory:

```bash
  mkdir build
  cd build
```

- Run CMake to configure the build:

```bash
  cmake ..
```

  - This default setup includes both GoogleTest and GoogleMock.
  - To build GoogleTest only, add `-DBUILD_GMOCK=OFF` flag:

```bash
  cmake .. -DBUILD_GMOCK=OFF
```

#### 3.2: Build and Install

- Build the project:

```bash
  make
```

- Optionally, install system-wide (requires administrator privileges):

```bash
  sudo make install
```

##### Notes:
- On Windows, Visual Studio solution files (`.sln`) are generated.
- On macOS, an Xcode project file (`.xcodeproj`) is generated.

#### 3.3: Integrate GoogleTest into Your Existing CMake Project

- Use `find_package(GTest CONFIG REQUIRED)` if libraries are installed on your system.
- Alternatively, add GoogleTest as a subdirectory to your project:

```cmake
  add_subdirectory(path/to/googletest)
  target_link_libraries(your_test_target PRIVATE gtest gmock)
```

- Ensure your targets compile with C++17:

```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### Step 4: Building with Bazel

- Add googletest source as an external dependency or workspace repository.
- Load relevant Bazel targets for `gtest` and `gmock`.
- Link your test targets against `@com_google_googletest//:gtest_main` or `gmock_main`.

### Step 5: Include Headers in Your Test Code

- Add the following includes in your test source files:

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>  // only if you use GoogleMock features
```

- Ensure your compiler include path contains the GoogleTest and GoogleMock headers, typically from `googletest/include` and `googlemock/include`.

### Step 6: Link Correct Libraries

- When compiling your tests, link against the `gtest`, `gtest_main`, `gmock`, or `gmock_main` libraries as appropriate:

| Use Case                 | Libraries to Link               |
|--------------------------|--------------------------------|
| GoogleTest only           | `gtest` or `gtest_main`         |
| GoogleMock with main()    | `gmock_main`                   |
| GoogleMock without main() | `gmock` and your own main()     |

### Step 7: Initialize GoogleTest/GoogleMock in Your Main Function

- Normally, you do not need to write your own `main()`; linking with `gtest_main` or `gmock_main` provides it.
- If you write a custom `main()`, use the following initialization:

```cpp
int main(int argc, char **argv) {
  testing::InitGoogleMock(&argc, argv); // for GoogleMock
  // or
  testing::InitGoogleTest(&argc, argv); // for GoogleTest only
  return RUN_ALL_TESTS();
}
```

### Step 8: Build and Run Your Tests

- Build your test executable using your build system.
- Run the tests; the framework will discover and execute all registered tests.

---

## 3. Practical Tips and Best Practices

- **Always enforce C++17** to avoid compatibility issues.
- **Use `gmock_main` library** if you want automatic `main()` with GoogleMock test runs.
- Avoid mixing `gmock_main` and `gtest_main` libraries; pick the one suitable for your needs.
- Link your tests only once; multiple linkage with incompatible runtime libraries will cause errors.
- When including GoogleMock, always include `<gmock/gmock.h>` before your test code.
- For better portability and ease of use, integrate GoogleTest as a subdirectory in CMake projects rather than installing globally.
- CMake option `gtest_force_shared_crt` can help resolve runtime linkage issues on Windows Visual Studio.
- Use `make test` or `ctest` to run tests when building standalone GoogleTest.

---

## 4. Troubleshooting Common Issues

### C++ Standard Errors

> Errors like ‘no matching function’ or missing definitions

- Ensure your compiler is invoked with the flag to enable `-std=c++17` or equivalent.
- Confirm `CMAKE_CXX_STANDARD` is set properly in your build system.

### Linking Errors

> Undefined references related to `gtest` or `gmock`

- Verify you linked against the correct static or shared libraries (`-lgtest`, `-lgmock`, etc).
- For GoogleMock tests using automatic `main()`, link with `gmock_main`.
- Avoid mixing debug and release libraries.

### Missing Headers

- Confirm include directories point to `googletest/include` and `googlemock/include`.
- Ensure your editor or build system knows about the GoogleTest source location.

### Multiple Definitions of main()

- This occurs if you link both `gtest_main` and define your own `main()`.
- Use only one: either link `gtest_main`/`gmock_main` or provide your own `main()`.

### Platform-Specific Caveats

- For Windows, dynamic versus static runtime library mismatches cause link errors. Use `gtest_force_shared_crt` option.
- For embedded or special platforms (ESP32, Arduino), initialization is done in `setup()` function.

---

## 5. Related Documentation and Next Steps

- After installation, explore [Writing and Running Your First Test](../first-test-and-validation/writing-and-running-first-test) to create your initial tests.
- For detailed platform support and integration, see [Integration and Platforms](../../overview/features-integration/integration-and-platforms).
- Consult [Configuration and Initial Setup](./configuration-and-initial-setup) for detailed build system integration guidance.
- To troubleshoot issues, review [Troubleshooting Common Setup Issues](../first-test-and-validation/troubleshooting-common-issues).
- For mocking techniques, refer to [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) and related gMock guides.

---

## 6. Summary Diagram of the Setup Workflow

```mermaid
flowchart TD
  A[Start: Get googletest source code] --> B{Choose Build System}
  B -->|CMake| C[Create build directory]
  B -->|Bazel| D[Configure Bazel workspace]
  C --> E[Run cmake .. to generate build files]
  E --> F[Run make or build command]
  F --> G[Install libraries (optional)]
  G --> H[Include headers in your test files]
  D --> I[Write BUILD files and link dependencies]
  I --> H
  H --> J[Link correct gtest/gmock libraries]
  J --> K[Write or link main() function]
  K --> L[Build your test executable]
  L --> M[Run tests with RUN_ALL_TESTS()]
  M --> N[End: GoogleTest/GoogleMock ready]

  classDef decision fill:#f96,stroke:#333,stroke-width:2px;
  class B decision;
```

---

## 7. Example CMakeLists.txt Snippet for GoogleMock Integration

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

add_subdirectory(path/to/googletest)

add_executable(MyTests test_main.cpp my_test1.cpp my_test2.cpp)

target_link_libraries(MyTests PRIVATE gmock_main)

enable_testing()
add_test(NAME MyTests COMMAND MyTests)
```

Replace `path/to/googletest` with the relative or absolute path to the GoogleTest source.

---

## 8. Example Basic main.cc Using GoogleMock

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Use this if you are not linking with `gmock_main`.

---

## 9. Summary and Best Practices Checklist

- Confirm C++17 compiler support.
- Choose your build system: CMake or Bazel.
- Use `gmock_main` for automatic `main()` if using GoogleMock.
- Add GoogleTest and GoogleMock include directories to your compiler includes.
- Link test executables to appropriate libraries.
- Call `InitGoogleMock` or `InitGoogleTest` before `RUN_ALL_TESTS()` if you provide your own `main()`.
- Verify your test program compiles and runs sample tests to confirm setup.
- For platform-specific issues, consult platform support documentation.

---

For the full experience, continue with the [Writing and Running Your First Test](../first-test-and-validation/writing-and-running-first-test) guide.