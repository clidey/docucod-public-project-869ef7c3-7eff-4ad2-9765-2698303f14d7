---
title: "Best Practices for Test Assertions"
description: "Learn to use GoogleTest's extensive assertion library for expressive and informative tests. Covers core and custom assertions, handling fatal vs. non-fatal failures, and providing clear diagnostic messages for easier debugging."
---

# Best Practices for Test Assertions in GoogleTest

Harness the full power of GoogleTest's comprehensive assertion library to write expressive, readable, and informative tests. This guide walks you through choosing the right assertion types, understanding fatal versus non-fatal failures, crafting custom assertions, and leveraging assert diagnostics to make debugging straightforward and efficient.

---

## 1. Introduction

GoogleTest’s assertion macros are fundamental in verifying code correctness. They help you:

- Check conditions and compare values
- Provide clear, actionable feedback on test failures
- Control test flow based on pass/fail criteria

This page focuses exclusively on **test assertions**, guiding you to apply them effectively to achieve clear, maintainable, and robust tests.

---

## 2. Understanding Assertion Types

### 2.1 Fatal vs Non-Fatal Failures

GoogleTest assertions are provided in pairs:

- **`ASSERT_*` macros** generate **fatal failures**, immediately aborting the current function. Use these when subsequent operations would be unsafe or meaningless without the assertion passing.

- **`EXPECT_*` macros** generate **non-fatal failures**, allowing the test function to continue executing. Use these when it’s beneficial to collect multiple failures in one run.

<Info>
Choosing between `ASSERT_*` and `EXPECT_*` directly impacts test flow. For instance, checking that a pointer is not null with `ASSERT_NE(ptr, nullptr);` prevents dereferencing null pointers.
</Info>

### 2.2 Boolean Condition Assertions

Use these to verify truth values:

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

They are simple yet powerful for validating flags or predicate functions.

### 2.3 Binary Comparison Assertions

GoogleTest provides direct comparison macros for equality and order:

| Macro         | Meaning                        |
|---------------|--------------------------------|
| `EXPECT_EQ`   | Checks `==`                    |
| `EXPECT_NE`   | Checks `!=`                    |
| `EXPECT_LT`   | Checks `<`                     |
| `EXPECT_LE`   | Checks `<=`                    |
| `EXPECT_GT`   | Checks `>`                     |
| `EXPECT_GE`   | Checks `>=`                    |

Use `ASSERT_` counterparts for fatal failure behavior.

**Tip:** When comparing C strings (`const char*`), use the dedicated macros `EXPECT_STREQ` or `EXPECT_STRNE` to compare string contents rather than pointer equality.

### 2.4 String Assertions

To compare C strings by content:

- `EXPECT_STREQ` / `ASSERT_STREQ` — verifies strings are equal
- `EXPECT_STRNE` / `ASSERT_STRNE` — verifies strings differ
- `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ` — case-insensitive equality
- `EXPECT_STRCASENE` / `ASSERT_STRCASENE` — case-insensitive inequality

These also work with wide strings and correctly handle `nullptr`.

### 2.5 Floating-Point Assertions

Due to floating-point precision limitations, special macros help compare floats/doubles approximately:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ` — compares `float` within 4 ULPs
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ` — compares `double` within 4 ULPs
- `EXPECT_NEAR` / `ASSERT_NEAR` — compares with an explicit absolute tolerance

Use these to avoid common pitfalls caused by rounding or representation errors.

### 2.6 Exception Assertions

For verifying expected exceptions (requires exceptions enabled in build):

- `EXPECT_THROW(statement, ExceptionType)` / `ASSERT_THROW`
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW`
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW`

They ensure the tested code correctly throws or doesn’t throw exceptions.

### 2.7 Predicate Assertions

When built-in assertions are insufficient, predicates help verify complex conditions:

- `EXPECT_PRED*` / `ASSERT_PRED*` — use functions returning `bool` with 1 to 5 arguments
- `EXPECT_PRED_FORMAT*` / `ASSERT_PRED_FORMAT*` — use predicate-formatter functions returning `AssertionResult` for customized failure messages

This approach gives you readable error messages and protects against side effects or expensive re-evaluations.

---

## 3. Writing Effective Assertions

### 3.1 Provide Informative Messages

Custom messages appended with `<<` make failures easier to diagnose:

```cpp
ASSERT_EQ(x.size(), y.size()) << "Vectors differ in size";
EXPECT_EQ(x[i], y[i]) << "Vectors differ at index " << i;
```

Stream any variable or formatted message for clarity.

### 3.2 Use the Appropriate Assertion Level

- Use `ASSERT_*` when continuing with a failed assertion risks crashing or invalid behavior.
- Use `EXPECT_*` when you want to collect multiple failures in a test run.
- Avoid `ASSERT_*` in non-void return functions, as they abort the current function.

### 3.3 Prevent Multiple Evaluations of Arguments

GoogleTest assertion macros evaluate arguments exactly once, protecting you from unintended side effects.

### 3.4 Apply Scoped Tracing for Complex Test Helpers

If assertions are inside helper functions, `SCOPED_TRACE` adds contextual info to failure messages:

```cpp
void Helper(int n) {
  SCOPED_TRACE("Helper called with n = " + std::to_string(n));
  EXPECT_EQ(Foo(n), expected);
}
```

Failures inside helpers show where and with what context they occurred.

### 3.5 Use Existing or Custom Matchers for Expressiveness

Leverage GoogleMock's matchers with `EXPECT_THAT` for rich assertions:

```cpp
using ::testing::StartsWith;
EXPECT_THAT(my_string, StartsWith("Hello"));
```

You can also write your own matchers for domain-specific checks.

---

## 4. Custom Assertion Support

### 4.1 Returning AssertionResult

Write custom predicate functions that return `testing::AssertionResult` for detailed success or failure feedback:

```cpp
AssertionResult IsEven(int n) {
  if (n % 2 == 0) return AssertionSuccess();
  else return AssertionFailure() << n << " is odd";
}
```

Use these in assertions:

```cpp
EXPECT_TRUE(IsEven(value));
```

Failure messages will include explanatory text.

### 4.2 Predicate-Formatter Functions

For full control over failure messages, use predicate-formatters:

```cpp
AssertionResult MyPredicateFormatter(const char* expr1, const char* expr2, int val1, int val2) {
  if (val1 == val2) return AssertionSuccess();
  return AssertionFailure() << expr1 << " (" << val1 << ") != " << expr2 << " (" << val2 << ")";
}
...
EXPECT_PRED_FORMAT2(MyPredicateFormatter, a, b);
```

---

## 5. Common Pitfalls and How to Avoid Them

- **Fatal assertions in non-void functions:** Leads to compilation errors; use non-fatal assertions or restructure your code.
- **Comparing C strings with `EXPECT_EQ`:** Compare content with `EXPECT_STREQ` instead.
- **Dereferencing pointers after failed null checks:** Use `ASSERT_NE(ptr, nullptr)` to prevent crashes.
- **Multiple fatal assertions in helper functions without propagation:** Use `HasFatalFailure()` to detect and handle failures early.
- **Disabling tests temporarily:** Use the `DISABLED_` prefix to skip tests without deleting them.

---

## 6. Examples

### 6.1 Simple Equality Assertion with Message

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  ASSERT_EQ(Factorial(0), 1) << "Factorial of zero should be 1";
}
```

### 6.2 Pointer and Null Check

```cpp
TEST(PtrTest, NotNullBeforeUse) {
  int* ptr = GetPointer();
  ASSERT_NE(ptr, nullptr) << "Pointer should not be null";
  EXPECT_EQ(*ptr, expected_value);
}
```

### 6.3 Floating Point Approximate Compare

```cpp
TEST(FloatTest, CloseEnough) {
  EXPECT_NEAR(Calculate(), 3.1415, 0.001);
}
```

### 6.4 Using Custom Predicate with Explanation

```cpp
AssertionResult IsPositive(int n) {
  if (n > 0) return AssertionSuccess();
  return AssertionFailure() << n << " is not positive";
}

TEST(NumberTest, Positive) {
  EXPECT_TRUE(IsPositive(value));
}
```

### 6.5 Using SCOPED_TRACE to Add Context

```cpp
void TestElements(const std::vector<int>& elems) {
  for (int i = 0; i < elems.size(); ++i) {
    SCOPED_TRACE("Index: " + std::to_string(i));
    EXPECT_GT(elems[i], 0);
  }
}
```

---

## 7. Troubleshooting Assertions

### 7.1 Test Fails Immediately or Crashes

- Check if a fatal assertion (`ASSERT_*`) precedes risky code.
- Verify that you have not dereferenced null pointers or invalid references.

### 7.2 Unexpected Assertion Macro Behavior

- Verify you are not mixing `EXPECT_*` with required fatal preconditions where you should use `ASSERT_*`.
- Avoid macros that have side effects inside assertions.

### 7.3 Assertion Not Triggering

- Confirm the expression being asserted evaluates as expected.
- Check for proper inclusion of GoogleTest headers and that macro expansion is correct.

### 7.4 Confusing Failure Messages

- Use custom messages appended with `<<`.
- Use predicate assertions returning `AssertionResult` for richer diagnostics.
- Use `SCOPED_TRACE` to add contextual information.

---

## 8. Best Practices and Tips

- Prefer `EXPECT_*` to allow multiple checks per test when safe.
- Use `ASSERT_*` for critical conditions that guard subsequent steps.
- Always provide custom messages for complex assertions.
- Utilize predicate and predicate-format assertions for complex logic.
- Use string-specific macros for C strings rather than generic equality.
- Use floating-point specific assertions for approximate equality.
- Apply `SCOPED_TRACE` inside helper functions to ease debugging.

---

## 9. What’s Next?

- Explore [Best Practices for Test Fixtures](../writing-effective-tests/advanced-assertions-practices) to combine assertions with reusable setups.
- Review [GoogleTest Primer](../primer.md) for core concepts and basic test writing.
- Check out [Mocking Reference](../reference/mocking.md) to learn how assertions interact with mock object expectations.

---

## 10. Additional Resources

- [Assertions Reference](../reference/assertions.md) — detailed assertion list and usage.
- [Advanced GoogleTest Topics](../advanced.md#assertions) — deep dive into advanced assertion features.
- [GoogleTest Primer](../primer.md) — starting point for new users.
- [Matchers Reference](../reference/matchers.md) — powerful matching logic for assertions.

---