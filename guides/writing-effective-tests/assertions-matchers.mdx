---
title: "Using Assertions and Matchers"
description: "Master GoogleTest's and GoogleMock's powerful assertion macros and matcher library. This guide dives into equality, exception, and custom assertions, with practical advice on making test failures informative and actionable."
---

# Using Assertions and Matchers

Master GoogleTest's and GoogleMock's powerful assertion macros and matcher library. This guide dives into equality, exception, and custom assertions, with practical advice on making test failures informative and actionable.

---

## Understanding Assertions

Assertions are the core checks within your tests, verifying that your code behaves as expected. GoogleTest provides a rich set of assertions to test for success, failure, equality, exceptions, and more.

### Basics of Assertions

- **ASSERT_*** macros generate *fatal failures* and abort the current function when they fail.
- **EXPECT_*** macros generate *nonfatal failures*, allowing the test to continue executing after a failure.

Use `EXPECT_` when you want tests to run despite failures, and `ASSERT_` when continuing makes no sense after a failure.

### Constructing Assertions

You can stream custom failure messages to assertions for clearer diagnostics:

```cpp
ASSERT_EQ(x.size(), y.size()) << "Vectors are of unequal length.";
EXPECT_EQ(x[i], y[i]) << "Vectors differ at index " << i;
```

Anything streamable to an output stream (including strings and wide strings) can be added to enrich failure messages.

---

## Types of Assertions

GoogleTest’s assertions cover various use cases, each suited to different kinds of checks.

### Explicit Success and Failure

- `SUCCEED()` — generates a success result. Useful for documenting unexpected pass-throughs.
- `FAIL()` — generates a fatal failure immediately.
- `ADD_FAILURE()` — generates a nonfatal failure.
- `ADD_FAILURE_AT(file, line)` — generate nonfatal failure linked to a file and line number.

Example use:

```cpp
switch (state) {
  case 1:
    // some checks
    break;
  default:
    FAIL() << "Unexpected state";
}
```

### Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

Verify that conditions evaluate as expected.

### Binary Comparisons

- Equality: `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`
- Inequality: `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`
- Relational: `EXPECT_LT`, `EXPECT_LE`, `EXPECT_GT`, `EXPECT_GE` and their fatal counterparts

**Tip:** When comparing pointers, use `EXPECT_EQ(ptr, nullptr)` rather than `EXPECT_EQ(ptr, NULL)` to avoid type issues.

### String Comparisons

For C strings use:

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ`
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE`
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ`
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE`

These compare string contents, including support for wide strings. For `std::string` objects, use the binary comparison assertions instead.

### Floating-Point Comparison

Due to rounding, floats and doubles should be compared approximately:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ`
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ`
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR`

GoogleTest uses Units in the Last Place (ULPs) internally for default "equal" comparisons in FLOAT_EQ and DOUBLE_EQ.

### Exception Assertions

Requires exceptions to be enabled.

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW`
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW`
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW`

Verify that code throws (or doesn't) exceptions as expected.

### Predicate Assertions

To verify complex conditions and get informative failure messages, use:

- `EXPECT_PREDn(pred, val1, val2, ...)` / `ASSERT_PREDn`
- `EXPECT_PRED_FORMATn(pred_formatter, val1, ...)` / `ASSERT_PRED_FORMATn`

For example, given a predicate:

```cpp
bool MutuallyPrime(int m, int n) { ... }
EXPECT_PRED2(MutuallyPrime, a, b);
```

If the predicate fails, GoogleTest shows the values of a and b, aiding diagnosis.

Predicate-formatters let you customize how failure messages are constructed for predicates that do not support streaming.

### Windows HRESULT Assertions

Available only on Windows.

- `EXPECT_HRESULT_SUCCEEDED(expr)` / `ASSERT_HRESULT_SUCCEEDED`
- `EXPECT_HRESULT_FAILED(expr)` / `ASSERT_HRESULT_FAILED`

These verify whether expressions return success or failure codes and report human-readable messages.

### Death Assertions

Death tests verify that code aborts or exits unexpectedly.

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH`
- `EXPECT_DEATH_IF_SUPPORTED`
- `EXPECT_DEBUG_DEATH` (runs only in debug builds)
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT`

Death assertions run the statement in a child process and verify termination and output.

**Important:** You should name your death test suites ending with `DeathTest` to ensure they are run before regular tests, due to ordering and thread safety constraints.

Example:

```cpp
TEST(MyDeathTest, AbnormalExit) {
  ASSERT_DEATH({ DoSomething(); }, "Error message regex");
}
```

---

## Using Assertions Effectively

### Streaming Custom Failure Messages

Use streaming with `<<` to add context:

```cpp
EXPECT_EQ(result, expected) << "Failed on input: " << input;
```

### Ensuring Single Evaluation of Arguments

GoogleTest guarantees each argument to assertions is evaluated exactly once, so it's safe to include side-effect expressions.

### Handling Fatal Failures in Subroutines

Fatal failures abort the current function, not the entire test. To propagate fatal failures from subroutines, use:

- `ASSERT_NO_FATAL_FAILURE(statement);`
- Check `testing::Test::HasFatalFailure()` and return early.

Or, install a custom listener that throws an exception on fatal failure to abort tests entirely.

### Skipping Tests at Runtime

Use `GTEST_SKIP()` inside tests or fixtures to skip execution with a message.

Example:

```cpp
TEST(MyTest, MaySkip) {
  if (!canRun) {
    GTEST_SKIP() << "Skipping test because prerequisites not met.";
  }
  // ... test continues if not skipped
}
```

---

## Best Practices for Naming

- Avoid underscores in test suite and test names to prevent naming conflicts and compiler issues.
- Use meaningful test names reflecting what is being tested.

---

## Matchers for Flexible Assertions

GoogleMock provides the matcher library that integrates with GoogleTest via the `EXPECT_THAT(value, matcher)` and `ASSERT_THAT(value, matcher)` macros.

Matchers describe sophisticated expectations, such as string prefixes, regex matches, container contents, or custom predicates.

Example:

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(str, MatchesRegex("Line \d+"));
ASSERT_THAT(num, AllOf(Gt(5), Lt(10)));
```

Matchers give expressive, readable assertions and detailed failure messages.

See [Matchers Reference](matchers.md) for all built-in matchers and creating custom matchers.

---

## Examples

### Equality Assertion with a Custom Message

```cpp
TEST(VectorTest, SizeMatches) {
  std::vector<int> v = {1,2,3};
  ASSERT_EQ(v.size(), 3) << "Vector size should be 3";
}
```

### Predicate Assertion Example

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, 4);          // Passes
EXPECT_PRED1(IsEven, 5);          // Fails with value printed
```

### Predicate-Formatter Assertion Example

```cpp
testing::AssertionResult AssertIsEven(const char* expr, int value) {
  if (value % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " is " << value << ", not even";
}

EXPECT_PRED_FORMAT1(AssertIsEven, 5); // Prints detailed failure message
```

### Using Matchers

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;

EXPECT_THAT(my_string, StartsWith("prefix"));
```

---

## Troubleshooting Assertions

- **Assertion evaluated multiple times:** This does not happen, GoogleTest ensures one evaluation.
- **Custom failure messages missing:** Use the streaming `<<` operator immediately after assertion.
- **Subroutine fatal failures not aborting tests:** Use `ASSERT_NO_FATAL_FAILURE()` around subroutine calls or check `HasFatalFailure()`.
- **EXPECT_EQ on C strings compares pointers, not contents:** Use `EXPECT_STREQ` instead for string content comparisons.
- **Compiler errors with overloaded predicate functions:** Explicitly cast function pointers to clarify overload.

---

## Tips and Best Practices

- Prefer `EXPECT_*` to allow multiple failures to be reported in one test execution unless failure makes further testing meaningless.
- Use predicate or predicate-formatter assertions for complex conditions.
- Use `EXPECT_THAT` with matchers for expressive, readable, and extensible assertions.
- Use `GTEST_SKIP()` to skip tests based on runtime conditions cleanly.
- Use static type assertions (`StaticAssertTypeEq`) inside templates to verify expected type equivalences during compilation.

---

## Next Steps

- Explore the [Assertions Reference](reference/assertions.md) for a complete list and details of assertion macros.
- Learn about [Matchers and Custom Matchers](matchers.md) to maximize the power of `EXPECT_THAT`.
- See [Writing Effective Tests > Parameterized and Typed Tests](guides/writing-effective-tests/parameterized-typed-tests) to write scalable tests.
- Investigate [Death Tests](advanced.md#death-tests) for verifying program termination behavior.

---

## Related Documentation

- [GoogleTest Primer](primer.md) — Getting started with test writing
- [Mocking Reference](reference/mocking.md) — Using mocks and setting expectations
- [Advanced GoogleTest Topics](advanced.md) — Deep dive into assertions and test organization


---

## Code Snippet Recap: Simple ASSERT_EQ Usage

```cpp
TEST(MyTestSuite, CompareValues) {
  int expected = 5;
  int actual = CalculateValue();
  ASSERT_EQ(expected, actual) << "Calculation returned wrong value.";
}
```

## Code Snippet Recap: Using Predicate Formatter

```cpp
// Custom predicate formatter for checking positive integers
AssertionResult IsPositive(const char* expr, int val) {
  if (val > 0)
    return AssertionSuccess();
  else
    return AssertionFailure() << expr << " evaluates to " << val << ", which is not positive.";
}

EXPECT_PRED_FORMAT1(IsPositive, result);
```

---

For detailed examples and advanced usage, consult the official [Assertions Reference](reference/assertions.md) and [Matchers Reference](matchers.md).
