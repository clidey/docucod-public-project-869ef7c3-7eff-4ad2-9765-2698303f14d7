---
title: "Automating Tests with CI/CD Pipelines"
description: "Shows how to automate running GoogleTest and GoogleMock as part of CI pipelines, with sample scripts and configuration tips for Linux, macOS, and Windows. Addresses test reporting and integration with popular CI tools."
---

# Automating Tests with CI/CD Pipelines

## Workflow Overview

This guide empowers you to automate running your GoogleTest and GoogleMock unit tests within Continuous Integration (CI) pipelines. Designed for developers integrating C++ tests into automated workflows, it covers environment setup, CI configuration, scripting examples across Linux, macOS, and Windows, test reporting strategies, and integration with popular CI tools.

### Prerequisites

- A working GoogleTest and GoogleMock setup in your project (see [Building and Running Tests](../../getting_started/first_test_run_validation/build_run_test) and [Mocking Workflows with GoogleMock](../advanced-testing-patterns/mocking-workflows)).
- Familiarity with your CI/CD platform (e.g., Jenkins, GitHub Actions, GitLab CI).
- Access to a Linux, macOS, or Windows build environment compatible with your CI.
- Proper build scripts or CMake configurations that build and run tests.

### Expected Outcome

By following this guide, you will have fully automated test executions in your CI pipelines that:

- Build your test binaries using your preferred build system (CMake recommended).
- Run GoogleTest/GoogleMock tests in an automated fashion.
- Generate machine-readable test reports (e.g., XML/JUnit format).
- Provide clear pass/fail signals to your CI platform.
- Support multiple platforms (Linux, macOS, Windows).

### Time Estimate

Depending on familiarity and existing setup, expect to spend 1-3 hours implementing and verifying your CI test automation.

### Difficulty Level

Intermediate â€” this guide assumes you know your build and CI environment but need clear, actionable steps to automate tests effectively.

---

## Step-by-Step Instructions

### 1. Prepare Your Build and Test Execution Commands

Your CI pipeline needs to know how to build and run tests. For most GoogleTest/GoogleMock projects, this involves:

- **Building tests:** typically via CMake or your build system (e.g., invoking `cmake --build .`
  or `make`).
- **Running tests:** executing the compiled test binaries.

For example, with CMake:

```bash
mkdir build
cd build
cmake ..
cmake --build .
ctest --output-on-failure
```

- `ctest` runs tests discovered by CMake.
- `--output-on-failure` reports details on any failed tests.

#### Windows Note
If using Visual Studio, adapt build/run commands to use `msbuild` or execute the test `.exe` directly.

### 2. Add Test Reporting Outputs

Continuous Integration systems rely on standardized test reports.

GoogleTest supports generating JUnit-compatible XML reports with the `--gtest_output` flag.

Run your test binary like this:

```bash
./my_tests --gtest_output=xml:report.xml
```

This creates `report.xml` with detailed results.

### 3. Write Platform-Specific Automation Scripts

Create scripts optimized for each platform to build and run tests. Here are detailed examples:

#### Linux/macOS Shell Script (`run_tests.sh`)

```bash
#!/bin/bash
set -e

mkdir -p build
cd build

cmake ..
make -j$(nproc)

./my_tests --gtest_output=xml:report.xml

exit_code=$?

if [ $exit_code -ne 0 ]; then
  echo "Some tests failed."
  exit $exit_code
fi

echo "All tests passed."
```

Make executable with `chmod +x run_tests.sh`.

#### Windows Batch Script (`run_tests.bat`)

```bat
@echo off
mkdir build
cd build
cmake ..
cmake --build . --config Release

my_tests.exe --gtest_output=xml:report.xml

if %errorlevel% neq 0 (
    echo Some tests failed.
    exit /b %errorlevel%
)

echo All tests passed.
```

### 4. Integrate Scripts in Your CI Pipeline

Most CI platforms allow adding build steps or jobs that execute these scripts. Examples:

#### GitHub Actions (Linux/macOS example):

```yaml
name: CI

on: [push, pull_request]

jobs:
  build_and_test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Install dependencies
      run: sudo apt-get update && sudo apt-get install -y cmake build-essential
    - name: Build and run tests
      run: ./run_tests.sh
    - name: Upload Test Report
      uses: actions/upload-artifact@v2
      with:
        name: Test Report
        path: build/report.xml
```

#### Jenkins Pipeline snippet example:

```groovy
pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                sh "./run_tests.sh"
            }
            post {
                always {
                    junit 'build/report.xml'
                }
            }
        }
    }
}
```

### 5. Configure CI to Parse the Test Reports

Configure your CI tool to recognize the GoogleTest XML report file (`report.xml`). This enables:

- Displaying test results in CI UI.
- Marking builds as failed if tests fail.
- Tracking test trends over time.

Consult your CI tool's documentation on test reporting plugins or native support.

### 6. Customize and Expand as Needed

- For flaky or long-running tests, consider running tests in parallel (e.g., using `gtest-parallel`).
- Use environment variables or build flags to adjust behavior in CI (e.g., enabling verbose logging).
- Consider Dockerizing your build environment to ensure consistency.

---

## Examples & Sample Scripts

### Sample Minimal `CMakeLists.txt` Including Tests

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject)

# Enable testing
include(CTest)
enable_testing()

# Fetch GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.11.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_code.cpp)
target_link_libraries(my_tests gtest_main gmock_main)

add_test(NAME MyTests COMMAND my_tests --gtest_output=xml:report.xml)
```

This automatically integrates test execution and reporting via `ctest`.

### Example of Running Tests Manually with Output

```bash
$ ./my_tests --gtest_output=xml:report.xml
[==========] Running 2 tests from 1 test suite.
[----------] Global test environment set-up.
[----------] 2 tests from MyTestSuite
[ RUN      ] MyTestSuite.Test1
[       OK ] MyTestSuite.Test1 (0 ms)
[ RUN      ] MyTestSuite.Test2
[       OK ] MyTestSuite.Test2 (1 ms)
[----------] 2 tests from MyTestSuite (1 ms total)
[----------] Global test environment tear-down
[==========] 2 tests from 1 test suite ran. (2 ms total)
[  PASSED  ] 2 tests.
```

The generated `report.xml` can be reviewed or fed into CI tools.

---

## Troubleshooting & Tips

### Common Issues

- **Tests not discovered or run:** Ensure tests are linked properly to `gtest_main` or `gmock_main` libraries.
- **CI reports show no tests:** Verify the test runner command outputs JUnit-compatible XML reports and CI is pointed to the right path.
- **Build failures on CI but not locally:** Check environment setup, compiler versions, and C++17 support on CI agents.
- **Flaky tests causing intermittent failures:** Use GoogleTest features for test retries or isolate flaky tests.

### Best Practices

- Always use the `--gtest_output=xml:filename` flag in CI to auto-generate compatible test reports.
- Store test outputs and artifacts for troubleshooting (logs, reports).
- Use consistent build environments via containers or configured CI runners.
- Run tests in parallel if supported to reduce pipeline duration.

### Performance Considerations

- Cache built dependencies where possible to reduce build time.
- Avoid running extensive integration tests in every push; schedule them separately.

### Alternative Approaches

- Use `gtest-parallel` to parallelize test execution.
- Integrate with third-party test runners that support GoogleTest output.
- Use custom event listeners (see [TestEventListener](../api-reference/core-testing-apis/writing-tests)) for advanced reporting.

---

## Next Steps & Related Content

- After automating CI test runs, explore [Performance and Scaling Test Suites](../integration-best-practices/performance-optimization) to optimize runtime.
- Deepen your knowledge of GoogleMock by reading [Mocking Workflows with GoogleMock](../advanced-testing-patterns/mocking-workflows).
- Explore [Building and Running Tests](../../getting_started/first_test_run_validation/build_run_test) for in-depth build and test practices.
- Review [Understanding Test Reporting](../api-reference/configuration-runtime/portability-config) for advanced output configuration.


---

*For further guidance or troubleshooting, consult the [Common Installation & Setup Problems](../../getting_started/troubleshooting/common_problems) and [Community & Further Help](../../getting_started/troubleshooting/community_resources) pages.*
