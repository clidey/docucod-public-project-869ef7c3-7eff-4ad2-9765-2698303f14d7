---
title: "Integrating with Build Systems & CI"
description: "A practical guide to integrating GoogleTest with CMake, Bazel, and common CI pipelines. Covers writing test targets, automating test discovery, and interpreting test outputs in automation."
---

# Integrating with Build Systems & CI

This guide provides a practical walkthrough to integrating GoogleTest and GoogleMock into your build systems such as CMake and Bazel, as well as configuring continuous integration (CI) pipelines. It focuses on writing test targets, automating test discovery, running and interpreting tests in automated environments, and tips for effective integration.

---

## 1. Workflow Overview

- **Task Description:** Learn how to properly integrate GoogleTest and GoogleMock into common build systems and CI pipelines to automate compilation, test execution, and reporting.

- **Prerequisites:** Familiarity with C++ projects, basic understanding of build systems (especially CMake and Bazel), and access to a CI platform (e.g., Jenkins, GitHub Actions).

- **Expected Outcome:** You will have automated builds that compile your tests, execute them, and capture test results for review.

- **Time Estimate:** 30 minutes to 1 hour depending on current build system complexity.

- **Difficulty Level:** Intermediate

---

## 2. Step-by-Step Instructions

### 2.1 Integrating GoogleTest with CMake

GoogleTest provides CMake scripts that simplify integration and test discovery.

1. **Add GoogleTest as a dependency:**

   - If your project already uses CMake, import GoogleTest using either `FetchContent` or as an installed package.

   ```cmake
   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
   )
   FetchContent_MakeAvailable(googletest)
   ```

2. **Create a test executable:**

   - Define a target for your tests and link with `gtest` or `gtest_main`.

   ```cmake
   add_executable(my_tests test_suite1.cpp test_suite2.cpp)
   target_link_libraries(my_tests PRIVATE gtest_main)
   ```

3. **Enable testing and register tests:**

   - Use `enable_testing()` and `add_test()` CMake commands to register tests.

   ```cmake
   enable_testing()
   add_test(NAME MyTests COMMAND my_tests)
   ```

4. **Configure test properties and flags:**

   - You can pass extra arguments to your tests or customize environment variables.


### 2.2 Integrating GoogleTest with Bazel

1. **Declare GoogleTest dependencies:**

   - Use `@com_google_googletest` repository or your fork.

2. **Define Bazel test rules:**

   - Use `cc_test` rules to build and run your tests.

   ```python
   cc_test(
       name = "my_test",
       srcs = ["test_suite.cpp"],
       deps = ["@com_google_googletest//:gtest_main"],
   )
   ```

3. **Run tests:**

   - Bazel handles test discovery and execution via `bazel test //...`.


### 2.3 Automating Tests in CI Pipelines

1. **Invoke the test binary:**

   - Configure your CI to build the test executables.
   - Execute the tests via command line, e.g.:  `./my_tests`

2. **Use XML output for CI integration:**

   - GoogleTest supports generating XML reports useful for CI.

   ```bash
   ./my_tests --gtest_output=xml:report.xml
   ```

   - Configure your CI platform to consume `report.xml` reports.

3. **Manage test status:**

   - The return value of `RUN_ALL_TESTS()` indicates success (0) or failure (â‰¥1). Ensure your CI uses this to mark build status.


### 2.4 Handling Test Discovery and Filtering

- GoogleTest automatically detects tests registered with `TEST()` or `TEST_F()`.
- Use `--gtest_filter` to include/exclude tests in runs.

```bash
./my_tests --gtest_filter=MySuite.*
```

---

## 3. Examples

### 3.1 Minimal CMakeLists.txt Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_mycode.cpp)
target_link_libraries(my_tests PRIVATE gtest_main)

enable_testing()
add_test(NAME RunMyTests COMMAND my_tests)
```

### 3.2 Running tests with XML output

```bash
./my_tests --gtest_output=xml:build/test_results.xml
```

Configure your CI to parse `build/test_results.xml`.

---

## 4. Troubleshooting & Tips

### Common Issues

- **Tests not discovered or executed:**
  - Ensure you link with `gtest_main` or provide your own `main()` as in `src/gmock_main.cc`.

- **Linker errors with `main()`:**
  - Confirm you are linking against `gmock_main` or `gtest_main`.
  - See [gmock_main.cc](googlemock/src/gmock_main.cc) for the canonical main function.

- **Thread-safety problems:**
  - Define `-DGTEST_HAS_PTHREAD=1` on platforms with pthread.

- **Test output not visible in CI:**
  - Check your CI's handling of standard output and logs.
  - Set verbosity level with `--gtest_verbose=info` if needed.


### Best Practices

- Always check and handle the return value of `RUN_ALL_TESTS()` for accurate CI results.
- Use test filtering during CI cycles to minimize runtime.
- Integrate test result XML with CI dashboards for quick diagnostics.
- Use CMake FetchContent or submodules for consistent GoogleTest versioning.

---

## 5. Next Steps & Related Content

- Explore [Writing and Running Your First Tests](https://example.com/guides/getting-started/first-tests) for details on test definitions.
- Consult [Basic Mocking with GoogleMock](https://example.com/guides/getting-started/basic-mocking) to extend your testing with mocks.
- Visit [Integration with Build Tools and CI](https://example.com/overview/integration-ecosystem/integration-with-build-and-ci) for in-depth CI setup.
- Learn [Test Performance Optimization Tips](https://example.com/guides/integration-best-practices/performance-tips) to speed up your CI workflows.


---

<Info>
This guide assumes you have an existing knowledge of your build environment. For new users, consider starting with the [GoogleTest Primer](https://google.github.io/googletest/primer) or [Minimal Configuration](https://example.com/getting-started/first-test-usage/minimal-configuration) before progressing to integration.
</Info>

---