---
title: "Setting Up with CMake and Bazel"
description: "Hands-on integration guides for adding GoogleTest to your CMake or Bazel builds. Covers dependency setup, targets, and reusable configuration patterns."
---

# Setting Up with CMake and Bazel

This guide helps you integrate GoogleTest into your C++ projects using the two most common build systems: **CMake** and **Bazel**. It provides practical, step-by-step instructions for declaring dependencies, configuring builds, linking libraries, and running tests. Whether you are starting a new project or incorporating GoogleTest into an existing one, this guide walks you through the essential workflows to get your tests up and running efficiently.

---

## Integration Overview

GoogleTest supports multiple build systems to provide flexibility and compatibility across platforms. The two primary methods are:

- **CMake:** A cross-platform build system that generates native build files.
- **Bazel:** A fast, reusable build system, preferred internally by Google and popular in many open source projects.

This page focuses exclusively on practical setup and configuration for these environments, emphasizing user workflow and outcomes.

---

## CMake Integration

### 1. Prerequisites
- Installed [CMake](https://cmake.org/install) version 3.14 or later.
- A C++ compiler supporting C++17 standard.
- Familiarity with basic CMake concepts and commands.

### 2. Adding GoogleTest to Your CMake Project

#### Step 1: Setup Your Project Directory
Create and move into your project directory:

```bash
mkdir my_project && cd my_project
```

#### Step 2: Create `CMakeLists.txt`
Add the following to your `CMakeLists.txt` to declare GoogleTest as a dependency using CMake's `FetchContent` module:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows: prevent overrides of runtime
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

This fetches GoogleTest at configure time, ensuring a consistent version.

#### Step 3: Add Your Test Source Code
Create a test source file, e.g., `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

#### Step 4: Extend `CMakeLists.txt` to Build and Link Tests
Add these lines to your `CMakeLists.txt` to create a test executable linked to GoogleTest's main function:

```cmake
enable_testing()

add_executable(
  hello_test
  hello_test.cc
)
target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

#### Step 5: Build and Run Tests
Run the following commands:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

You should see output indicating that your test ran and passed.

---

### Best Practices & Tips for CMake
- Always specify C++17 support in your project for compatibility.
- Use the `FetchContent` module to avoid manual cloning or copying of GoogleTest sources.
- Set the `gtest_force_shared_crt` option to `ON` on Windows to align runtime linking and avoid linker conflicts.
- Use `gtest_discover_tests` to automatically register tests with CTest.

### Common Pitfalls
- Forgetting to enable testing with `enable_testing()` will cause test discovery to fail.
- Not setting the correct C++ standard leads to compilation errors.
- Linking only to `GTest::gtest` instead of `GTest::gtest_main` requires a separate `main()` function.

---

## Bazel Integration

### 1. Prerequisites
- Installed [Bazel](https://bazel.build/install) version 7.0 or higher.
- Supported C++ compiler with C++17 support.
- Basic knowledge of Bazel workspace and BUILD files.

### 2. Set Up Your Bazel Workspace

#### Step 1: Create Workspace Directory

```bash
mkdir my_workspace && cd my_workspace
```

#### Step 2: Declare GoogleTest Dependency
Create a file named `MODULE.bazel` with this content:

```python
# MODULE.bazel

bazel_dep(name = "googletest", version = "1.17.0")
```

This imports GoogleTest via the Bazel Central Registry.

#### Step 3: Create a Test Source File
Create `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

#### Step 4: Create `BUILD` File
Create a `BUILD` file that defines the test target:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

This sets up the build target to compile and link your test with GoogleTest.

#### Step 5: Build and Run Tests
Build and run with:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

You should see detailed output showing tests execution and results.

---

### Best Practices & Tips for Bazel
- Always specify the C++ standard flag (`--cxxopt=-std=c++17`) to ensure C++17.
- Use the Bazel Central Registry to manage GoogleTest dependencies for clean version control.
- Keep tests small and focused to optimize Bazel's caching and parallel execution.
- Use Bazel's `test_output=all` to see comprehensive output when debugging tests.

### Common Pitfalls
- Omitting `gtest_main` in dependencies will require your own main function.
- Failing to set C++ standard results in build errors.
- Incorrect workspace setup or version in `MODULE.bazel` can lead to dependency resolution failures.

---

## Summary

| Aspect              | CMake                                  | Bazel                                         |
|---------------------|---------------------------------------|-----------------------------------------------|
| Declaring dependency| `FetchContent_Declare` and `FetchContent_MakeAvailable` | `MODULE.bazel` with `bazel_dep` declaration  |
| Build file          | `CMakeLists.txt`                       | `BUILD` file                                  |
| Test executable     | `add_executable` and `target_link_libraries` | `cc_test` rule                              |
| Running tests       | `ctest`                               | `bazel test`                                  |
| C++ Standard        | Set via `set(CMAKE_CXX_STANDARD 17)`  | Flag `--cxxopt=-std=c++17`                    |

---

## Troubleshooting

<AccordionGroup title="Common Setup Issues and Solutions">
<Accordion title="CMake: Tests Not Discovered">
Ensure you call `enable_testing()` after declaring your executable and before `gtest_discover_tests()`.
</Accordion>
<Accordion title="CMake: Linker Errors on Windows">
Check you have set `gtest_force_shared_crt` to `ON` to avoid runtime library mismatches.
</Accordion>
<Accordion title="Bazel: Build Fails with Missing Dependencies">
Verify your `MODULE.bazel` has the correct `bazel_dep` for GoogleTest and that you have run `bazel fetch` or `bazel sync`.
</Accordion>
<Accordion title="Bazel: Tests Fail to Link Due to main()">
Include `@googletest//:gtest_main` in your `deps` to provide the main function.
</Accordion>
</AccordionGroup>

---

## Next Steps

- Explore [Writing Your First Test](/guides/core-workflows/writing-your-first-test) to begin authoring tests.
- Consult the [Building and Running Tests](/getting-started/first-test-validation/building-and-running-tests) guide for deeper command-line options.
- Look into [Common Setup Issues and Solutions](/getting-started/troubleshooting-support/common-issues-fixes) to address initial hurdles.
- Review [Supported Platforms and Integration Ecosystem](/overview/features-and-getting-started/supported-platforms-and-integrations) to understand your environment compatibility.

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- CMake Documentation: [FetchContent Module](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- Bazel Documentation: [Bazel Central Registry](https://registry.bazel.build/modules/googletest)
- CMake Module for GoogleTest: [GoogleTest CMake](https://cmake.org/cmake/help/latest/module/GoogleTest.html)

---  

<Info>For detailed instructions on advanced configuration, multi-threaded test setups, and shared library builds, please consult the official [GoogleTest README](https://github.com/google/googletest/blob/main/README.md) and the respective CMakeLists.txt and BUILD.bazel files in the repository.</Info>