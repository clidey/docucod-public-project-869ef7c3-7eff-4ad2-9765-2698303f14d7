---
title: "Getting Started with GoogleMock"
description: "Provides a step-by-step introduction to using GoogleMock for creating mock objects and specifying expectations. Shows how to integrate GoogleMock into a new or existing GoogleTest project, create simple mock classes, and verify interactions."
---

# Getting Started with GoogleMock

GoogleMock (gMock) is an integral part of the GoogleTest framework that allows you to create mock objects in C++ and specify detailed expectations on how these objects are used. This guide provides a practical step-by-step introduction to integrating GoogleMock into your test projects, defining simple mock classes, setting expectations, and verifying interactions.

---

## 1. What You Will Learn
- How to create and use mock classes in GoogleMock
- How to define expectations on mock methods using `EXPECT_CALL`
- How to control mock behavior with `ON_CALL`
- The difference between expectations and default behaviors
- How to verify that interactions with mocks meet defined expectations

## 2. Prerequisites
- Basic familiarity with writing GoogleTest tests
- A C++17-compatible compiler and build environment
- The GoogleTest framework installed with GoogleMock included

## 3. Expected Outcome
By completing this guide, you will have a working GoogleMock setup, know how to define a mock class, specify expectations and default actions on mock methods, and verify that your tested code interacts with mocks appropriately.

## 4. Time Estimate
Approximately 20â€“30 minutes.

## 5. Difficulty Level
Beginner to Intermediate.

---

# Step-by-Step Instructions

### Step 1: Include GoogleMock in Your Project
Make sure your test source files include the GoogleMock header:

```cpp
#include <gmock/gmock.h>  // Includes the GoogleMock framework
``` 

You also need to initialize GoogleMock in your `main` function:

```cpp
int main(int argc, char** argv) {
  ::testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This setup is necessary for running tests that use mocks.

### Step 2: Define a Mock Class
Derive a mock class from your interface or abstract class. Use the `MOCK_METHOD` macro to declare mock methods. 

Example: Mocking a simple `Turtle` interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Tips:**
- Always place `MOCK_METHOD` in the `public` section, regardless of base method access.
- For const method overrides, include `(const, override)` as the fourth argument.

### Step 3: Create Mock Object Instances in Your Tests
Create mock objects in your test functions or fixtures.

```cpp
TEST(PainterTest, CanDrawCircle) {
  MockTurtle turtle;  // Create mock
  // Set expectations and run tests below
}
```

### Step 4: Specify Expectations with `EXPECT_CALL`
Use `EXPECT_CALL(mock, method(matchers))` to specify how the mock's methods are expected to be called.

Basic usage:
```cpp
EXPECT_CALL(turtle, PenDown())
    .Times(1);  // Expect PenDown to be called exactly once

EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1));  // Forward should be called at least once with argument 100
```

Matchers such as `_` can be used to accept any argument:
```cpp
EXPECT_CALL(turtle, Forward(_))  // Any argument
    .Times(AnyNumber());
```

### Step 5: Set Default Behavior with `ON_CALL`
Default behavior specifies what a mock method should do when called, but not necessarily expected.

Example:
```cpp
ON_CALL(turtle, GetX())
    .WillByDefault(Return(10));  // Return 10 whenever GetX is called if no EXPECT_CALL overrides
```

Unlike `EXPECT_CALL`, `ON_CALL` does **not** set an expectation that the call will happen.

### Step 6: Run Your Code Under Test
Use the mock object in your test program. The specified expectations will automatically verify calls.

Example:
```cpp
Painter painter(&turtle);
painter.DrawCircle(0, 0, 10);
```

### Step 7: Verify Expectations are Met
Verification happens automatically when mock objects are destroyed. You can also call:
```cpp
::testing::Mock::VerifyAndClearExpectations(&turtle);
```
to explicitly verify and clear expectations.

### Step 8: Interpreting Failures
If a mock method is called too few or too many times, or with unexpected arguments, GoogleMock will generate immediate failures showing the mismatch.

Use the `--gmock_verbose=info` test flag to get detailed tracing of mock calls and expectation matching.

---

# Examples

## Example 1: Basic Mock with Expected Call

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};

TEST(PaintTest, DrawsLine) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown())
      .Times(1);
  EXPECT_CALL(turtle, Forward(100))
      .Times(1);

  // Code under test:
  turtle.PenDown();
  turtle.Forward(100);
}
```


## Example 2: Using ON_CALL for Default Actions

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(PaintTest, PositionTracking) {
  MockTurtle turtle;

  ON_CALL(turtle, GetX()).WillByDefault(Return(42));

  EXPECT_EQ(42, turtle.GetX());  // Uses default action
}
```

## Example 3: Combined EXPECT_CALL and ON_CALL

```cpp
EXPECT_CALL(turtle, Forward(50))
    .Times(2)
    .WillOnce(Return())
    .WillOnce(Return());

ON_CALL(turtle, Forward(_))
    .WillByDefault(Return());

// In this example, calls to Forward(50) are expected twice.
// Other Forward() calls are allowed but not expected.
```

# Best Practices

- Always set expectations *before* exercising the mock object.
- Use broad matchers `_` to simplify expectations where arguments don't matter.
- Prefer `ON_CALL` for setting default behaviors and `EXPECT_CALL` for setting mandatory calls that must happen.
- Use `InSequence` or `After` clauses for specifying call order when necessary.
- Use `WillOnce` and `WillRepeatedly` to define return values or side effects.
- Use `NiceMock` to suppress warnings about uninteresting calls and `StrictMock` to enforce stricter checking.

# Troubleshooting

<AccordionGroup title="Common Issues in GoogleMock Onboarding">
<Accordion title="Mock Methods Not Called as Expected">
If an expected call is missed or extra calls happen:
- Verify your `EXPECT_CALL` uses correct matchers.
- Check if calls happen before the expectations are set (expectations must be set *before* use).
- Use `--gmock_verbose=info` to trace calls.
</Accordion>
<Accordion title="Uninteresting Call Warnings">
GoogleMock prints warnings when a mock method is called without matching `EXPECT_CALL`s.
- To suppress, use `NiceMock`.
- Or, add an `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` for methods that can be called freely.
</Accordion>
<Accordion title="Mock Class Compilation Errors">
- Wrap argument or return types with unprotected commas in extra parentheses or use type aliases.
- Check that mocked methods are declared `virtual` in base classes.
</Accordion>
<Accordion title="Unexpected Call Failures">
- Check argument matchers carefully.
- When mocking overloaded methods, use `Const()` or explicit casts to disambiguate.
</Accordion>
</AccordionGroup>

# Next Steps & Related Content

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html): A beginner-friendly guide to get started.
- [Mocking Reference](docs/reference/mocking.md): Complete API reference for mocks.
- [gMock Cookbook](docs/gmock_cook_book.md): Recipes for advanced usage.
- [Nice, Naggy, and Strict Mocks](docs/reference/mocking.md#NiceStrictNaggy): Learn to control mock verbosity and strictness.
- [Using Matchers](guides/core-scenarios/using-matchers.md): How to specify argument constraints.
- [Integration with GoogleTest](overview/integration-adoption/integration-workflow.mdx): How to integrate mocks in your build and CI workflow.

---

This guide gives you a practical start on creating mocks, setting expectations, and writing solid tests using GoogleMock.

Happy mocking!