---
title: "Test Discovery and Running Strategies"
description: "Explains how GoogleTest automatically discovers test cases, and how users can control test execution: running specific tests, shuffling, or filtering by name. Showcases command-line test runner options and recommended project organization."
---

# Test Discovery and Running Strategies

GoogleTest is designed to make test discovery and execution seamless, allowing you to run all or subsets of your tests efficiently. This guide explains how GoogleTest finds tests automatically, how to selectively run specific tests, shuffle test execution order, and apply filters, empowering you to focus on debugging and development.

---

## 1. How GoogleTest Discovers Tests Automatically

### Overview
When you use GoogleTest macros like `TEST()`, `TEST_F()`, and others, the framework automatically registers these tests during static initialization before `main()` runs. The test runner then gathers this information to identify which tests are available for execution.

### What Happens Behind the Scenes
- Each test is represented by a `TestInfo` object that stores metadata such as test suite name, test name, source file, and line number.
- Tests are grouped into `TestSuite`s based on their suite names.
- GoogleTest ensures all tests within the same suite use the same fixture class.
- The registered test suites and their tests form the complete pool of discoverable tests.

### Outcome
You do not need to manually list or enumerate tests anywhere. Once you've defined your tests with macros, they become discoverable and executable via the test runner.

---

## 2. Selecting Which Tests to Run

### Running All Tests by Default
By default, executing your test binary runs all discovered tests.

### Running Specific Tests Using Filters
You can run a subset of tests using the `--gtest_filter` flag or the `GTEST_FILTER` environment variable. This lets you run only tests matching specific patterns.

#### Filter Syntax
```
--gtest_filter=PositivePatterns[-NegativePatterns]
```
- `PositivePatterns`: Colon-separated list of wildcard patterns to include
- `NegativePatterns`: Colon-separated list of wildcard patterns to exclude
- Wildcards:
  - `*` matches any sequence of characters
  - `?` matches any single character

#### Examples
- Run only tests in `FooTest` suite:
  ```
  ./my_test --gtest_filter=FooTest.*
  ```
- Run tests with names containing `Null` or `Constructor`:
  ```
  ./my_test --gtest_filter=*Null*:*Constructor*
  ```
- Run all except death tests:
  ```
  ./my_test --gtest_filter=-*DeathTest.*
  ```
- Run all in `FooTest` except `FooTest.Bar`:
  ```
  ./my_test --gtest_filter=FooTest.*-FooTest.Bar
  ```

### Temporarily Disabling and Enabling Tests
- Prefix test or test suite names with `DISABLED_` to disable them.
- Use `--gtest_also_run_disabled_tests` to run disabled tests.

### Listing Tests Without Running Them
Use `--gtest_list_tests` to list all discoverable tests in your binary without running them. This helps you verify which tests exist and are available for execution.

Example output format:
```
TestSuite1.
  TestName1
  TestName2
TestSuite2.
  TestName
```

---

## 3. Controlling Test Execution Order

### Shuffling Tests
You can randomize the execution order of tests by:
- Using the flag `--gtest_shuffle`
- Setting environment variable `GTEST_SHUFFLE=1`

By default, the shuffle seed is derived from the current time and printed in the console, enabling reproducibility.

To specify a fixed seed:
```
./my_test --gtest_random_seed=12345
```

If used alongside `--gtest_repeat`, the test order will be reshuffled every iteration.

### Repeating Tests
To repeat tests multiple times (helpful for diagnosing flaky tests), use:
```
--gtest_repeat=N
```
where *N* is the number of times to run all tests. Use `N=-1` to repeat indefinitely.

You can combine with filters to repeat only specific tests and with `--gtest_break_on_failure` to stop at the first failure.

### Fail Fast Mode
Stop execution on the first test failure with:
```
--gtest_fail_fast
```

---

## 4. Distributed Test Execution (Sharding)

GoogleTest supports *sharding* to split test execution across multiple machines or processes, running tests in parallel to speed up test cycles.

### How to Configure Sharding
Your test runner must set two environment variables:
- `GTEST_TOTAL_SHARDS`: The total number of shards/machines.
- `GTEST_SHARD_INDEX`: The zero-based index for the current shard.

Example with 3 shards:
```
Shard 0:
  export GTEST_TOTAL_SHARDS=3
  export GTEST_SHARD_INDEX=0
  ./my_test
Shard 1:
  export GTEST_TOTAL_SHARDS=3
  export GTEST_SHARD_INDEX=1
  ./my_test
Shard 2:
  export GTEST_TOTAL_SHARDS=3
  export GTEST_SHARD_INDEX=2
  ./my_test
```

GoogleTest internally selects and runs the portion of tests assigned to each shard.

### Notes
- Each test runs exactly once across all shards.
- Sharding respects the `--gtest_filter` flag.

---

## 5. Command-Line Flags and Environment Variables Summary

| Feature                      | Command Line Flag                         | Environment Variable          |
|------------------------------|------------------------------------------|------------------------------|
| Run all tests                | (default)                               |                              |
| Run specific tests           | `--gtest_filter=PATTERNS`                | `GTEST_FILTER`               |
| List all tests               | `--gtest_list_tests`                     |                              |
| Include disabled tests       | `--gtest_also_run_disabled_tests`       | `GTEST_ALSO_RUN_DISABLED_TESTS` |
| Disable color output         | `--gtest_color=no`                       | `GTEST_COLOR=no`             |
| Enable shuffle order         | `--gtest_shuffle`                        | `GTEST_SHUFFLE=1`            |
| Specify shuffle seed         | `--gtest_random_seed=SEED`               | `GTEST_RANDOM_SEED=SEED`     |
| Repeat tests                 | `--gtest_repeat=N`                       | `GTEST_REPEAT=N`             |
| Fail fast                   | `--gtest_fail_fast`                      | `GTEST_FAIL_FAST`            |
| Enable sharding             | (config via `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`) |                              |

Note: Command-line options take precedence over environment variables.

---

## 6. Recommended Project Organization

- Organize your tests into meaningful test suites using consistent suite names.
- Use fixtures (`TEST_F`) to share setup and teardown logic among related tests.
- Name disabled tests with the `DISABLED_` prefix and remove the prefix when tests are fixed.
- Combine value-parameterized (`TEST_P`) and typed tests (`TYPED_TEST`) for broad coverage when needed.

Example directory structure:
```
my_project/
  src/
    foo.cpp
    bar.cpp
  test/
    foo_test.cc  # Contains FooTest suite
    bar_test.cc  # Contains BarTest suite
  CMakeLists.txt
```

---

## 7. Practical Tips and Best Practices

- Use `--gtest_list_tests` when unsure what tests are compiled into your binary.
- Run small subsets of tests with `--gtest_filter` to quickly focus on affected areas.
- Combine filter patterns to exclude flaky or disabled tests.
- Use shuffling to catch hidden dependencies between tests.
- Leverage `--gtest_repeat` to identify flaky tests by running them multiple times.
- Avoid mixing `TEST` and `TEST_F` with the same suite name.

---

## Troubleshooting Common Issues

### Problem: Tests Not Running or Not Found
- Verify your test source files are linked correctly.
- Use `--gtest_list_tests` to confirm test presence.
- Check for spelling errors in suite or test names.
- Avoid underscores in test suite and test names to prevent linkage issues.

### Problem: Filter Does Not Match Any Tests
- Confirm filter syntax for wildcards and exclusions.
- Check that disabled tests need `--gtest_also_run_disabled_tests` to be included.
- Ensure your filter string doesn’t mistakenly exclude all tests.

### Problem: Flaky Tests or Dependent Order
- Use `--gtest_shuffle` to randomize execution order.
- Repeat with `--gtest_repeat` to reproduce.
- Review test isolation and dependencies.

---

## 8. Examples

### Running a Specific Test Suite
```shell
./my_test --gtest_filter=MySuite.*
```

### Running Specific Tests by Name
```shell
./my_test --gtest_filter=MySuite.TestOne:MySuite.TestTwo
```

### Excluding Specific Tests
```shell
./my_test --gtest_filter=MySuite.*-MySuite.TestFlaky
```

### Running All Disabled Tests (e.g., for temporary fixes)
```shell
./my_test --gtest_also_run_disabled_tests
```

### Shuffling Tests with a Fixed Seed
```shell
./my_test --gtest_shuffle --gtest_random_seed=42
```

### Running Tests Forever
```shell
./my_test --gtest_repeat=-1
```

### Configuring Shards (Run on multiple machines)
```shell
# Shard 0
export GTEST_TOTAL_SHARDS=3
export GTEST_SHARD_INDEX=0
./my_test
# Shard 1
export GTEST_TOTAL_SHARDS=3
export GTEST_SHARD_INDEX=1
./my_test
# Shard 2
export GTEST_TOTAL_SHARDS=3
export GTEST_SHARD_INDEX=2
./my_test
```

---

## 9. Additional Resources
- [GoogleTest Primer](primer.md) – Understanding GoogleTest basics
- [GoogleTest Advanced Topics](advanced.md) – Detailed command-line options and test suite lifecycle
- [Testing Reference](reference/testing.md) – API details
- [Common Setup Issues](getting-started/support/common-setup-issues.md) – Troubleshooting

---

By mastering test discovery and running strategies, you can efficiently explore your tests, target problematic flakes, optimize runs, and integrate GoogleTest into complex development workflows.

---