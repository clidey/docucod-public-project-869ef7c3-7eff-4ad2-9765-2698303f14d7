---
title: "Working with Matchers and Custom Parameters"
description: "Expand your test capabilities by specifying argument matchers for mock calls. This guide covers built-in matchers, creating custom matchers, using matchers with complex data types, and integrating matcher logic into your expectations."
---

# Working with Matchers and Custom Parameters

GoogleMock empowers you to write precise and expressive tests by specifying *matchers* for the arguments expected in calls to mock methods. This guide helps you leverage built-in matchers, craft your own, and combine them to control how mock calls behave and are verified.

---

## 1. Why Use Matchers?

Matchers describe the conditions under which a mock method invocation is accepted by an expectation. By using matchers:

- You can specify exact values or flexible constraints on arguments.
- You reduce brittle tests by focusing only on relevant argument properties.
- You enhance test readability by expressing argument expectations clearly.

For example, matching a literal value:

```cpp
EXPECT_CALL(mock_turtle, Forward(100));  // Expect Forward called with 100
```

vs. matching anything:

```cpp
using ::testing::_;
EXPECT_CALL(mock_turtle, GoTo(50, _));  // X must be 50, Y can be anything
```

---

## 2. Built-in Matchers: Expressiveness Out of the Box

GoogleMock offers a rich library of built-in matchers to express conditions on arguments comfortably:

### 2.1 Wildcard Matcher: `_`
Matches any value.

```cpp
EXPECT_CALL(foo, Bar(_));  // Accepts any argument
```

### 2.2 Equality Matchers
- `Eq(value)` — Exactly equal `value`.
- `Ne(value)` — Not equal to `value`.

Literal values act as `Eq` matchers implicitly:

```cpp
EXPECT_CALL(foo, Bar(5));          // Same as Eq(5)
EXPECT_CALL(foo, Bar(Eq(5)));      // Explicit
EXPECT_CALL(foo, Bar(Ne(10)));     // Not 10
```

### 2.3 Relational Matchers

Matchers such as `Lt(x)`, `Le(x)`, `Gt(x)`, `Ge(x)` restrict argument values by ordering:

```cpp
EXPECT_CALL(foo, Bar(Gt(10)));  // Argument must be greater than 10
```

### 2.4 Container Matchers
- `ElementsAre(...)` — Matches containers with elements satisfying matchers in the given sequence.
- `UnorderedElementsAre(...)` — Matches containers with elements matching but order ignored.
- `Contains(matcher)` — Container has at least one element matching.
- `Each(matcher)` — Every element satisfies matcher.

Example:

```cpp
EXPECT_CALL(foo, Process(std::vector<int>{1, 2, 3}));
EXPECT_CALL(foo, Process(ElementsAre(1, 2, 3)));
EXPECT_CALL(foo, Process(UnorderedElementsAre(3, 1, 2)));
```

### 2.5 String Matchers
- `StrEq(str)`, `StrNe(str)` — Equal or not equal strings.
- `StartsWith(prefix)`, `EndsWith(suffix)`, `HasSubstr(sub)` — String pattern matching.

Example:

```cpp
EXPECT_CALL(mock, Log(StrEq("Error")));
EXPECT_CALL(mock, Log(StartsWith("Warning:")));
```

### 2.6 Null and Pointer Matchers

- `IsNull()` matches a null pointer.
- `NotNull()` matches non-null pointers.
- `Pointee(m)` matches pointer arguments where the pointed-to value matches matcher `m`.

Example:

```cpp
EXPECT_CALL(foo, DoSomething(IsNull()));
EXPECT_CALL(foo, ProcessPointer(Pointee(Eq(42))));
```

### 2.7 Composite Matchers
- `AllOf(m1, m2, ...)` — Matches if all matchers succeed.
- `AnyOf(m1, m2, ...)` — Matches if any matcher succeeds.
- `Not(m)` — Negates matcher m.

Example:

```cpp
EXPECT_CALL(foo, Bar(AllOf(Gt(0), Lt(100))));
EXPECT_CALL(foo, Bar(Not(Eq(5))));
```

### 2.8 Matchers for Overloads and Const Methods
You can disambiguate overloaded or const methods using special helpers:

- Use `Const(mock)` to refer to const methods when needed.
- Use type-based matcher wrappers like `MatcherCast<T>()` to clarify.


---

## 3. Using Matchers with EXPECT_CALL and ON_CALL

Matchers appear in the argument list of `EXPECT_CALL` and `ON_CALL` to specify which arguments a particular expectation matches.

Example (`EXPECT_CALL`):

```cpp
EXPECT_CALL(mock_turtle, Forward(Ge(100)))  // Forward called with argument >= 100
    .Times(AtLeast(1));
```

Example (`ON_CALL`):

```cpp
ON_CALL(mock_turtle, GoTo(50, _))
    .WillByDefault(Return(true));
```

> **Important:**
> - `EXPECT_CALL` sets expectations and verifies calls.
> - `ON_CALL` sets default behavior but does not set expectations.

You can omit the parameter list only if the method is NOT overloaded and you want to accept any arguments.

---

## 4. Custom Matchers: Defining Your Own Argument Criteria

When built-in matchers don't meet your needs, create custom matchers:

### 4.1 Define a Basic Matcher Using `MATCHER`

The macro takes a name and a body returning a `bool`:

```cpp
MATCHER(IsEven, "Checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(foo, Bar(IsEven()));
```

Inside the body, `arg` is the argument to match.

### 4.2 Parameterized Matcher Using `MATCHER_P`

Match with parameters:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "Checks divisibility by parameter") {
  return (arg % divisor) == 0;
}

EXPECT_CALL(foo, Bar(IsDivisibleBy(7)));
```

### 4.3 Advanced Matcher Classes

For more control, implement the matcher interface with `MatchAndExplain`, describing success and failure. Create a factory to return your matcher.

---

## 5. Integrating Matchers into Expectations

### 5.1 Combining Matchers and Actions

Matchers define when an expectation matches; actions define what happens.

Example:

```cpp
EXPECT_CALL(mock, GetX())
    .Times(3)
    .WillOnce(Return(100))
    .WillOnce(Return(200))
    .WillRepeatedly(Return(300));
```

### 5.2 Using `.With()` for Multi-Argument Matching

`.With()` takes a matcher over a tuple of arguments for complex conditions across multiple parameters:

```cpp
EXPECT_CALL(mock, Method(_, _))
    .With(Lt())  // First argument less than second
    .WillOnce(Return(true));
```

### 5.3 Managing Expectations Order and Reusability

Matchers are sensitive to the order of `EXPECT_CALL`. More specific expectations should appear *after* more general ones to ensure correct matching priority.

### 5.4 Using `_` for Wildcard Arguments

Omit arguments or use `_` for unconcerned parameters:

```cpp
EXPECT_CALL(mock, Foo(_));  // any argument accepted
```

Avoid over-specifying to keep tests robust.

---

## 6. Practical Tips and Common Pitfalls

- **Specify expectations *before* mock method calls:** `EXPECT_CALL` must be defined prior to exercising the mock.

- **Beware of sticky expectations:** Expectations without `.RetiresOnSaturation()` persist after saturation and may cause failures on repeated calls.

- **Use `.RetiresOnSaturation()` to disable sticky behavior:**

```cpp
EXPECT_CALL(mock, GetX())
    .WillOnce(Return(10))
    .RetiresOnSaturation();
```

- **Suppress warnings for uninteresting calls with `NiceMock`:**

```cpp
NiceMock<MockTurtle> turtle;
```

- **Use `StrictMock` to treat uninteresting calls as failures.**

- **Use `SafeMatcherCast<T>(m)` to help resolve type mismatches in matchers.**

- **Avoid returning side-effecting expressions in `WillOnce(Return())` as they evaluate once at setup, not on each call.** Use lambdas for dynamic return values.

- **If mocking overloaded methods, disambiguate overloads using techniques found in [Selecting Between Overloaded Functions](docs/gmock_cook_book.md#SelectOverload).**

---

## 7. Example: Matcher Usage for a Simple Interface

Assume a mock class:

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

You want to expect `Forward` called with distance ≥ 100, `GoTo` called with x=50 and any y, and control `GetX` return values:

```cpp
using ::testing::AtLeast;
using ::testing::Ge;
using ::testing::_;
using ::testing::Return;

MockTurtle turtle;
EXPECT_CALL(turtle, Forward(Ge(100)))
    .Times(AtLeast(1));
EXPECT_CALL(turtle, GoTo(50, _));
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))
    .WillRepeatedly(Return(150));
```

With these, your test checks correct calls with expected arguments and controls return values.

---

## 8. Troubleshooting

<AccordionGroup title="Common Matcher and Expectation Issues">
<Accordion title="Test fails because mock method called with unexpected arguments">
Double-check the argument matchers and the order of `EXPECT_CALL`s. Use `--gmock_verbose=info` to get detailed logs of matching behavior.
</Accordion>
<Accordion title="Uninteresting mock function call warnings">
This occurs when methods without explicit `EXPECT_CALL`s are called. Use `NiceMock` to suppress or explicitly add `EXPECT_CALL(mock, method).Times(AnyNumber())`.
</Accordion>
<Accordion title="Over-saturated expectations">
Occurs when a mock method is called more times than expected. Use `.RetiresOnSaturation()` or `.Times(AnyNumber())` for flexible limits.
</Accordion>
<Accordion title="Ambiguous overloads causing compilation errors">
Disambiguate the mock methods using `Const()` or provide explicit matchers for the overload’s parameters as described in the [Cookbook](docs/gmock_cook_book.md#SelectOverload).
</Accordion>
</AccordionGroup>

---

## 9. Next Steps & Related Topics

- **Explore [`Matchers Reference`](api-reference/advanced-mocking-matchers-actions/matchers-reference) for a full list of built-in matchers.**
- **Learn how to create complex behaviors by combining matchers with actions in [`Configuring Expectations and Actions`](guides/mocking-advanced-testing/configuring-expectations-actions).**
- **Master writing custom matchers with the [`gMock Cookbook`](docs/gmock_cook_book.md#NewMatchers).**
- **Review common troubleshooting techniques in [`Troubleshooting & FAQ`](getting-started/first-steps/troubleshooting).**

---

## 10. Summary

Matchers in GoogleMock are the foundation for precise, readable, and robust mock function call verification. This guide has helped you:

- Understand the importance and role of argument matchers in mock expectations.
- Use built-in matchers to handle common cases effortlessly.
- Write and integrate custom matchers to capture bespoke argument conditions.
- Combine matcher logic with expectations and actions for sophisticated test scenarios.
- Avoid common pitfalls and troubleshoot matcher-related test failures.

Unlock the power of argument matchers to elevate the quality and maintainability of your C++ tests today!

---

## References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook (Matchers Section)](https://google.github.io/googletest/gmock_cook_book.html#WritingNewMatchers)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Configuring Expectations and Actions Guide](/guides/mocking-advanced-testing/configuring-expectations-actions)
- [Mocking Reference - Matchers and Expectations](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL)
