---
title: "Introduction to GoogleMock"
description: "Start with the basics of GoogleMock: why mocking matters, how to create mock classes, and essential macros for member function mocking. Get hands-on fast with real-world scenarios."
---

# Introduction to GoogleMock

Welcome to your practical guide on getting started with GoogleMock. This page will help you understand the core purpose of mocking in testing, teach you how to create mock classes in C++, and introduce the essential macros and concepts you need to quickly apply GoogleMock to your projects using real-world examples.

---

## 1. Why Use GoogleMock?

Mocking helps you isolate the unit of code you're testing by replacing dependencies with controlled, observable substitutesâ€”called mocks. GoogleMock enables you to:

- Verify that your code interacts correctly with its dependencies.
- Simulate different responses or behaviors from dependencies.
- Focus testing on logic rather than external factors.

Imagine you are testing a payment processor that relies on an external service to authorize payments. With a mock, you can simulate success, failure, or timeout scenarios easily to ensure your code handles all these cases gracefully.

---

## 2. Creating Mock Classes

GoogleMock relies on defining mock classes that provide mocked versions of the interfaces your code depends on.

### Basic Structure

- Define a mock class inheriting from the interface (or class) you want to mock.
- Use the `MOCK_METHOD` macro to mock its member functions.

### Syntax for `MOCK_METHOD`

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- **ReturnType:** The return type of the method.
- **MethodName:** The method name being mocked.
- **Args...:** The method arguments enclosed in parentheses.
- **Qualifiers:** Optional method qualifiers like `const`, `override`, `noexcept`.

### Practical Example

Let's say you have an interface `Database`:

```cpp
class Database {
 public:
  virtual ~Database() {}
  virtual bool Connect(const std::string& url) = 0;
  virtual int Query(const std::string& sql) = 0;
};
```

You can write a mock class as follows:

```cpp
#include <gmock/gmock.h>

class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), (override));
  MOCK_METHOD(int, Query, (const std::string& sql), (override));
};
```

### Handling Complex Types with Commas

Be careful with types that contain commas like `std::pair`. Wrap them in parentheses or create type aliases:

```cpp
// Wrapping with parentheses
MOCK_METHOD((std::pair<int, int>), GetPair, (), (override));

// Or using type aliases
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetPair, (), (override));
```

### Mocking Non-Virtual Methods

GoogleMock can mock non-virtual methods only if those methods exist in the mock class directly and share the signature with the real class. This is useful for high-performance dependency injection patterns.

### Mocking Overloaded Methods

For overloaded methods, mock each signature individually using the proper `MOCK_METHOD` macro with correct arguments and qualifiers.

### Special Notes

- Always declare `MOCK_METHOD` in the `public:` section regardless of the original access level.
- Destructors should be virtual in your interfaces to assure proper mock behavior.

---

## 3. Essential Mocking Macros

### `MOCK_METHOD`
Defines a mock method inside a mock class.

### `EXPECT_CALL`
Set expectations on your mock methods telling GoogleMock:

- Which calls it should expect.
- How many times these calls should occur.
- What actions these calls should perform.

Example:

```cpp
MockDatabase mock_db;
EXPECT_CALL(mock_db, Connect("db.example.com"))
    .WillOnce(testing::Return(true));
```

### `ON_CALL`
Defines default behaviors for mock methods that do not have explicit expectations.

Example:

```cpp
ON_CALL(mock_db, Query(testing::_))
    .WillByDefault(testing::Return(42));
```

This way, your mock methods have sane defaults and only enforce strict verification where necessary.

---

## 4. Controlling Mock Behavior: Nice, Naggy, and Strict Mocks

GoogleMock provides wrappers to control how mock objects respond to uninteresting calls (calls to mock methods that have no expectations).

| Mock Type  | Behavior on Uninteresting Calls | Usage Example              |
|------------|---------------------------------|----------------------------|
| `NaggyMock` | Prints warnings                 | Default mock behavior       |
| `NiceMock`  | Suppresses warnings            | Use when uninteresting calls are benign |
| `StrictMock`| Treats uninteresting calls as errors | Useful to catch unexpected calls rigorously |

**Usage:**

```cpp
using ::testing::NiceMock;
NiceMock<MockDatabase> nice_mock_db;
```

These wrappers inherit the constructors of the mock class, so you can pass arguments as usual.

### Important Caveats

- They affect only uninteresting calls, not calls that mismatch expectations.
- They work only if mock methods are defined directly by the `MOCK_METHOD` macro in the mock class.
- Nesting these wrappers is not supported.

---

## 5. Real-World Scenario: Mocking and Using a Fake

Sometimes you have a non-trivial fake that mimics behavior but want to verify interactions. GoogleMock allows you to delegate default actions to fakes.

Example:

```cpp
class FakeDatabase : public Database {
 public:
  bool Connect(const std::string& url) override { return true; }
  int Query(const std::string& sql) override { return 1; }
};

class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), (override));
  MOCK_METHOD(int, Query, (const std::string& sql), (override));

  void DelegateToFake() {
    ON_CALL(*this, Connect(testing::_))
        .WillByDefault([this](const std::string& url) {
          return fake_.Connect(url);
        });
    ON_CALL(*this, Query(testing::_))
        .WillByDefault([this](const std::string& sql) {
          return fake_.Query(sql);
        });
  }

 private:
  FakeDatabase fake_;
};
```

Then in your tests:

```cpp
MockDatabase mock_db;
mock_db.DelegateToFake();
EXPECT_CALL(mock_db, Query(testing::_)).Times(1);

int result = mock_db.Query("SELECT * FROM users");
EXPECT_EQ(result, 1);
```

---

## 6. Best Practices & Tips

- **Use `ON_CALL` for default behaviors:** Avoid overusing `EXPECT_CALL`, which sets strict expectations.
- **Use `NiceMock` to reduce noise:** When you do not want warnings from uninteresting calls.
- **Use `StrictMock` judiciously:** Only when strict enforcement of interactions reduces bugs.
- **Wrap complex arguments with parentheses or aliases:** To avoid macro parsing issues.
- **Always mock methods in `public:` sections:** Regardless of their original access levels.
- **Mock interfaces, not concrete classes:** Helps maintain test stability and reduces coupling.
- **Verify mock expectations:** GoogleMock automatically verifies on destruction, but consider calling `Mock::VerifyAndClearExpectations()` if lifetime is complex.

---

## 7. Troubleshooting

### Common Issues

- **Mock method not called:** Missing or incorrect `EXPECT_CALL` or argument mismatch.
- **Unrecognized arguments due to overloading:** Use disambiguation with `Const()` or specify argument types.
- **Compilation errors in `MOCK_METHOD`:** Check for commas in types, wrap in parentheses or use aliases.
- **Unexpected uninteresting call warnings:** Use `NiceMock` or add catch-all `EXPECT_CALL` with `Times(AnyNumber())` if appropriate.

### How to Confirm Correct Setup

- Run a simple test with logging enabled (`--gmock_verbose=info`).
- Verify that expectations trigger and calls produce expected outputs.
- Check that uninteresting calls produce expected warnings or silencing.

---

## 8. Next Steps & Further Learning

- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced usage and recipes.
- Learn about matchers and actions in detail in the [Matchers Reference](reference/matchers.md) and [Actions Reference](reference/actions.md).
- Understand best practices for writing maintainable tests in [Writing Scalable and Maintainable Tests](guides/advanced-testing-and-best-practices/maintainable-tests).
- See examples of integrating mocks in CI pipelines and build systems in [Integration Examples](guides/mocking-techniques-integration/integration-examples).

---

## References

- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](reference/mocking.md)
- Related Guides:
  - Writing Your First Test: `/guides/getting-started-with-googletest/writing-your-first-test`
  - Using Assertions and Matchers Effectively: `/guides/advanced-testing-and-best-practices/assertions-matchers`

---

## Summary
Step into effective testing by defining mock classes using the `MOCK_METHOD` macro, managing mock behavior with `EXPECT_CALL` and `ON_CALL`, and adjusting strictness through `NiceMock`, `NaggyMock`, and `StrictMock` wrappers. This guide equips you with the fundamentals necessary to craft precise, readable, and maintainable test doubles that ensure your code interacts with dependencies as intended.

<Tip>
To master GoogleMock, start by mocking interfaces cleanly, set reasonable expectations, and control default actions carefully. Harness delegation for complex cases and refine your mock behaviors using built-in strictness modes.
</Tip>

---