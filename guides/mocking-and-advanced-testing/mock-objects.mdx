---
title: "Using and Creating Mock Objects"
description: "Step-by-step instruction on defining and using mock classes to isolate and test components in C++. Explore the MOCK_METHOD macros and how to simulate dependencies effectively for reliable, fast unit tests."
---

# Using and Creating Mock Objects

This guide provides a practical, step-by-step introduction to defining and using mock classes in C++ with GoogleMock. You'll learn how to create mocks that simulate dependencies, control behavior, and verify interactions to write reliable and fast unit tests.

---

## 1. Introduction to Mock Objects

Mock objects stand in for real dependencies during unit testing. They replicate interfaces and let you specify expected behavior, call sequences, and return values without relying on actual implementations. This isolation helps you test components effectively and catch integration issues early.

## 2. Defining Mock Classes with `MOCK_METHOD`

### What is `MOCK_METHOD`?

The `MOCK_METHOD` macro defines mock methods within a mock class. It mimics the signature of real methods and enables gMock to intercept calls, verify arguments, and return preset results.

### Syntax

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- **ReturnType**: The method's return type.
- **MethodName**: The name of the method.
- **Args...**: The argument list (enclosed in parentheses).
- **Qualifiers**: Optional list such as `(const, override)`.

### Important Usage Notes

- Place `MOCK_METHOD` declarations in the `public:` section of your class, even if the original methods are protected or private.
- Wrap argument or return types containing commas in additional parentheses or use type aliases to avoid parsing errors.

### Examples

```cpp
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));

  // Using type aliases to handle commas in types
  using PairType = std::pair<int, int>;
  MOCK_METHOD(PairType, GetPosition, (), (const));
};
```

## 3. Creating Mock Objects

Once you've defined a mock class, instantiate it like a regular object:

```cpp
MockTurtle turtle;
```

If your mock class constructor accepts parameters, you can pass them as usual.

## 4. Setting Default Behaviors Using `ON_CALL`

Sometimes you want to specify the common behavior for mock methods without asserting calls.

### Syntax

```cpp
ON_CALL(mock_object, Method(matchers...))
    .With(multi_arg_matcher)  // Optional
    .WillByDefault(action);
```

- `.With()` restricts matching by a matcher on all arguments as a tuple.
- `.WillByDefault()` defines the default action to perform.

### Example

```cpp
ON_CALL(turtle, Forward(_))
    .WillByDefault(Return());  // Does nothing for uninteresting calls
```

*Note:* `ON_CALL` does not set expectations; calls matching the spec are allowed to happen any number of times.

## 5. Setting Expectations Using `EXPECT_CALL`

Use `EXPECT_CALL` to set expectations about which mock methods should be called, with what arguments, how many times, and what they should do.

### Syntax

```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .With(multi_arg_matcher)  // At most once, first clause
    .Times(cardinality)       // At most once
    .InSequence(sequences...) // Zero or more times
    .After(expectations...)   // Zero or more times
    .WillOnce(action)         // Zero or more times
    .WillRepeatedly(action)   // At most once
    .RetiresOnSaturation();   // At most once, last clause
```

### Clauses Explained

- `.With(matcher)`: Restricts the expectation to calls whose arguments as a whole match the given tuple matcher.
- `.Times(cardinality)`: Specifies the expected number of calls.
- `.InSequence(...)`: Specifies ordering within one or more sequences.
- `.After(...)`: Specifies that this expectation can only be matched after specified expectations.
- `.WillOnce(action)`: Specifies the action to perform on a matching call, for the next matching call.
- `.WillRepeatedly(action)`: Specifies the action for all matching calls after `WillOnce`s are exhausted.
- `.RetiresOnSaturation()`: Causes the expectation to retire (become inactive) once saturated.

### Example

```cpp
using ::testing::_;
using ::testing::Return;
using ::testing::Exactly;

EXPECT_CALL(turtle, Forward(100))
    .Times(Exactly(2))
    .WillOnce(Return())
    .WillOnce(Return());

EXPECT_CALL(turtle, PenUp())
    .Times(AnyNumber());
```

This expects `Forward(100)` to be called exactly twice and does nothing on those calls, while allowing any number of `PenUp()` calls.

## 6. Mock Object Types: NiceMock, NaggyMock, StrictMock

Uninteresting calls are calls to mock methods that have no `EXPECT_CALL` expectations.

- **NaggyMock** (default): prints warnings on uninteresting calls.
- **NiceMock**: suppresses warnings on uninteresting calls.
- **StrictMock**: treats uninteresting calls as errors.

### Usage

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;   // suppress warnings
NaggyMock<MockFoo> naggy_mock; // show warnings (default)
StrictMock<MockFoo> strict_mock; // fail on uninteresting calls
```

These templates inherit constructors of the mocked class, so you can construct them with any arguments that the base mock class accepts.

### Important

- Nesting these modifiers is not supported.
- They only affect mock methods defined with `MOCK_METHOD` directly in the mock class, not inherited methods.
- Use `NiceMock` for maintainable tests, `NaggyMock` during development/debugging, and `StrictMock` when you want to strictly verify interactions.

## 7. Best Practices for Using Mocks

- Use `ON_CALL` to define default behavior for uninteresting calls.
- Use `EXPECT_CALL` to specify calls you want to verify.
- Keep expectations minimal and precise; over-specifying leads to brittle tests.
- Prefer `NiceMock` to suppress noisy warnings, especially in large test suites.
- Use `InSequence` or `.InSequence()` clauses to enforce call order.
- Use `.After()` clause or sequences for more complex partial ordering.
- Use `.RetiresOnSaturation()` for expectations that should become inactive once satisfied.

## 8. Verifying and Resetting Mock States

When a mock object is destructed, gMock automatically verifies whether all expectations were satisfied.

You can also manually verify and clear expectations:

```cpp
using ::testing::Mock;

Mock::VerifyAndClearExpectations(&mock_object);
Mock::VerifyAndClear(&mock_object);  // also clears default actions
```

*Note:* Do not set new expectations after verification, as this leads to undefined behavior.

## 9. Troubleshooting Common Issues

- **Uninteresting call warnings:** These mean a mock method was called without an expectation. Use `NiceMock<T>` or add an `EXPECT_CALL(...).Times(AnyNumber())` if this is intentional.
- **Unexpected call errors:** Means a call was made that doesn't match any expectation; check arguments and expectation order.
- **Assertion errors about call counts:** Check `Times()` clauses and whether your mock methods are called as expected.
- **Problems with overloaded or const methods:** Use `Const()` wrapper or help the compiler disambiguate overloads.
- **Methods not mocked properly:** Ensure methods are virtual, and mocks are correctly declared with `MOCK_METHOD` in the `public:` section.

## 10. Next Steps

- Explore **Customizing Mock Behavior with Matchers and Actions** to enhance your control over arguments and return behaviors.
- Read **Best Practices for Reliable Mock-Based Tests** for tips on maintaining robust, maintainable tests.
- Learn about **Mock Classes Template Specializations** for advanced mocking scenarios.
- Combine with GoogleTest guides on writing assertions and running tests to build comprehensive unit testing capabilities.

---

## Reference Links

- [Mocking Reference](../reference/mocking.md) for detailed API and macros.
- [gMock Cookbook](../gmock_cook_book.md) for recipes and best practices.
- [gMock Cheat Sheet](../gmock_cheat_sheet.md) for quick syntax reminders.
- [Understanding NiceMock, NaggyMock, StrictMock](../gmock_cook_book.md#NiceStrictNaggy) detailed explanation.

---

## Code Example: Full Simple Mock

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() = default;
  virtual void PenUp() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

// Usage in test
using ::testing::Return;
using ::testing::NiceMock;

TEST(DrawTest, DrawsLine) {
  NiceMock<MockTurtle> turtle;

  ON_CALL(turtle, GetX()).WillByDefault(Return(10));
  EXPECT_CALL(turtle, PenUp());
  EXPECT_CALL(turtle, Forward(100));

  // Exercise code that uses turtle mock...
}
```
