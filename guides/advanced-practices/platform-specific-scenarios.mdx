---
title: "Platform-Specific Guidance"
description: "Addressing special considerations for different target environments, such as embedded systems or cross-platform support. Includes tips for porting, configuration, and handling platform variance."
---

# Platform-Specific Guidance

## Overview
This guide addresses special considerations when using GoogleTest across various target environments, including embedded systems and cross-platform scenarios. It offers practical tips for porting GoogleTest, configuring your build environment accordingly, and handling differences and limitations due to platform variance. Understanding these nuances helps ensure smooth integration and reliable test execution regardless of target platform.

---

## 1. Environment Variance and Platform Detection

GoogleTest automatically detects the platform it is compiled on via a set of internal macros defined in `gtest-port-arch.h`. These macros indicate the operating system or environment (e.g., `GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`, `GTEST_OS_MAC`, `GTEST_OS_ESP32`), enabling GoogleTest to adapt its behavior accordingly.

### Why Platform Detection Matters
- Enables conditional compilation for platform-specific implementations.
- Controls feature availability such as threading, stream redirection, and death tests.
- Ensures compatibility with different operating systems and embedded targets.

### Example Platforms Supported
- Desktop OS: Windows (including MinGW and Mobile variants), Linux, MacOS.
- Embedded: ESP32, ESP8266, Xtensa, NRF52.
- Others: FreeBSD, QNX, Solaris, AIX, etc.

### Important System Macros
- `GTEST_HAS_PTHREAD`: Indicates if POSIX threads are available.
- `GTEST_HAS_STREAM_REDIRECTION`: Indicates support for redirecting stdout/stderr, needed for some test features.
- `GTEST_HAS_DEATH_TEST`: Controls availability of death tests, which require OS file system support.

<Tip>
GoogleTest detects a wide range of platforms; in rare cases when auto-detection fails, you can manually override these macros in your build to ensure correct behavior.
</Tip>

---

## 2. Cross-Compilation and Embedded Platforms

When targeting embedded hardware or cross-compiling, special setup steps are required to handle sysroots, library paths, and compiler flags.

### Using pkg-config in Cross-Compilation
GoogleTest provides pkg-config files to simplify compiling and linking against it.

#### Setting up pkg-config for Cross-Compiling
1. **Install GoogleTest to a sysroot directory**  
   For example, set install prefix to `/usr` and install under `/home/user/sysroot`:
   ```bash
   mkdir build && cmake -DCMAKE_INSTALL_PREFIX=/usr ..
   make -j install DESTDIR=/home/user/sysroot
   ```

2. **Configure pkg-config environment variables**  
   ```bash
   export PKG_CONFIG_SYSROOT_DIR=/home/user/sysroot
   export PKG_CONFIG_LIBDIR=${PKG_CONFIG_SYSROOT_DIR}/usr/lib64/pkgconfig
   export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
   export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
   ```

3. **Use pkg-config to get proper flags**  
   ```bash
   pkg-config --cflags gtest
   pkg-config --libs gtest
   ```
   This will inject the correct sysroot path into include and library directories.

<Tip>
Always define `PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes` and `PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes` when cross-compiling to prevent pkg-config from stripping important flags.
</Tip>

### Embedded Platform Considerations
- Some embedded targets do not have a file system (`GTEST_HAS_FILE_SYSTEM=0`). This limits features like death tests and stream redirection.
- For embedded or limited environments (e.g., ESP8266, Xtensa), GoogleTest disables unsupported features automatically.
- Platform-specific threading support might be limited or custom; GoogleTest uses mutex and thread-local implementations depending on the environment.

<Warning>
Not all GoogleTest features are available on embedded or constrained platforms—expect limited support on platforms like ESP8266 or Windows Mobile.
</Warning>

---

## 3. Build and Compiler Configuration for Platforms

GoogleTest supports many compilers and platforms with tailored build configurations and compile flags.

### Key Pipelines and Recommendations
- **C++17 or later is required.** Ensure your build system configures the compiler standard accordingly.
- For **Windows** with Visual Studio, GoogleTest provides specific flags to handle Unicode, exception handling, and static/dynamic runtime linkage.
- For **POSIX systems**, typical `-pthread` flags and POSIX threading support prevail.

### Tweaking Compiler Flags
You can adjust GoogleTest’s compiler flags with the following options:
- `-DGTEST_HAS_PTHREAD=1` or `0` to force presence or absence of pthread support.
- `-DGTEST_CREATE_SHARED_LIBRARY=1` to build GoogleTest as a shared library.
- `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when linking tests against a shared GoogleTest library.

### Tips for CMake Users
- Use the recommended CMake integration by adding GoogleTest as a subdirectory or using the installed package.
- When linking, prefer using `target_compile_options` with flags from pkg-config rather than manually specifying -I or -D options.

---

## 4. Handling Platform Limitations

### Stream Redirection
- Stream capturing APIs (stdout/stderr) depend on platform capabilities.
- On platforms like Windows Mobile, embedded devices, and some real-time OSes, stream redirection is disabled.

### Death Tests
- Death tests require OS-level process spawning and file system functionality.
- On platforms without a file system or process control, death tests are disabled.

### Threading
- GoogleTest uses platform-appropriate synchronization primitives.
- For unsupported or minimal threading environments, synchronization APIs become no-ops.

<Tip>
Check the macro values provided by GoogleTest to verify supported features via preprocessor checks:
```cpp
#ifdef GTEST_HAS_DEATH_TEST
  // Death test code
#endif

#if GTEST_HAS_PTHREAD
  // pthread code
#endif
```
</Tip>

---

## 5. Practical Example: Enabling GoogleTest on a Cross-Compiled Embedded Platform

1. **Cross-compile GoogleTest into your sysroot:**
   ```bash
   mkdir build
   cd build
   cmake -DCMAKE_INSTALL_PREFIX=/usr ..
   make -j install DESTDIR=/path/to/sysroot
   ```

2. **Set appropriate pkg-config environment:**
   ```bash
   export PKG_CONFIG_SYSROOT_DIR=/path/to/sysroot
   export PKG_CONFIG_LIBDIR=${PKG_CONFIG_SYSROOT_DIR}/usr/lib64/pkgconfig
   export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
   export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
   ```

3. **Compile your project using pkg-config flags:**
   Example `CMakeLists.txt` snippet:
   ```cmake
   find_package(PkgConfig REQUIRED)
   pkg_search_module(GTEST REQUIRED gtest_main)

   add_executable(testapp test_main.cc)
   target_include_directories(testapp PRIVATE ${GTEST_INCLUDEDIR})
   target_link_libraries(testapp PRIVATE ${GTEST_LIBRARIES})
   target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})

   enable_testing()
   add_test(NAME testapp COMMAND testapp)
   ```

4. **Verify feature availability based on platform:**
   ```cpp
   #if !defined(GTEST_HAS_DEATH_TEST)
   std::cout << "Death tests are disabled on this platform." << std::endl;
   #endif
   ```

---

## 6. Troubleshooting Platform-Specific Issues

<AccordionGroup title="Platform-Specific Troubleshooting">
<Accordion title="Build Failures on Cross-Compilation">
**Symptoms:** Missing headers, linker errors, or wrong include paths when building GoogleTest in cross-compile.

**Solution:**
- Confirm that `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` are set correctly.
- Verify that your cross-compiler sysroot contains GoogleTest libraries and headers.
- Use `pkg-config --cflags gtest` and `pkg-config --libs gtest` to check flags.
- Make sure you have defined `PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes` and `PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes`.
</Accordion>
<Accordion title="Unsupported Features on Embedded Targets">
**Symptoms:** Tests fail because death tests or stream capture features are unavailable.

**Solution:**
- Review platform macros such as `GTEST_HAS_DEATH_TEST` and `GTEST_HAS_STREAM_REDIRECTION`.
- Avoid using features not supported on your target platform or provide alternative test logic.
- Consider mocking or emulation where hardware limitations prevent feature usage.
</Accordion>
<Accordion title="Threading Issues on Non-POSIX or Limited Platforms">
**Symptoms:** Compilation errors or runtime threading failures.

**Solution:**
- Confirm pthread support: look for `GTEST_HAS_PTHREAD` macro.
- Consider compiling with `-DGTEST_HAS_PTHREAD=0` if your platform does not support it.
- GoogleTest will provide no-op threading primitives in single-threaded or non-posix environments.
</Accordion>
</AccordionGroup>

---

## 7. Best Practices and Recommendations

- Always verify platform detection macros when porting GoogleTest to a new or unusual environment.
- Use pkg-config integration for managing compile and link flags, especially with cross-compilation.
- Be mindful of feature availability—conditionalize platform-specific tests accordingly.
- When possible, build GoogleTest as part of your project to align compiler settings and reduce integration issues.
- Document platform-specific constraints clearly for your team.

---

## 8. Additional Resources

- [GoogleTest Porting and Macros (internal/gtest-port.h)](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h) for macro definitions and platform detection.
- [Using GoogleTest with pkg-config](docs/pkgconfig.md) to streamline build configuration.
- [Supported Platforms Overview](docs/platforms.md) to understand officially supported environments.
- [Troubleshooting Common Setup Issues](getting-started/troubleshooting/common-errors.mdx) for diagnosing build and runtime issues.

---

For full integration instructions tailored to your platform, consult the [Installation and Setup guide](/guides/getting-started/installation-setup) and the [Platform-Specific Guidance](/guides/advanced-practices/platform-specific-scenarios) for detailed, environment-specific advice.
