---
title: "Integrating with Build Systems and CI"
description: "Step-by-step instructions for integrating GoogleTest with popular build tools and continuous integration pipelines. Includes configuring builds, managing dependencies, and capturing output for CI reporting."
---

# Integrating with Build Systems and CI

## Overview

This guide provides practical, step-by-step instructions for integrating GoogleTest into popular build tools and Continuous Integration (CI) pipelines. You'll learn how to configure your build environment to compile and link GoogleTest and GoogleMock, manage dependencies correctly, and capture test output for effective CI reporting.

Whether you are using CMake-based projects or other build systems, this guide will help you set up a seamless testing workflow that supports automation, reliable build verification, and CI-driven development.

---

## Prerequisites

Before you begin, ensure the following prerequisites are met:

- You have a C++17-compatible compiler installed.
- CMake (version 3.13 or later) is installed and properly configured if you use it as your build system.
- The GoogleTest source code is available (e.g., cloned from https://github.com/google/googletest).
- Familiarity with your chosen build system (CMake, Bazel, etc.) and basic CI concepts.

---

## Expected Outcome

By the end of this guide, you will have:

- Successfully configured GoogleTest and GoogleMock in your build.
- Built and linked test binaries that include GoogleTest and optionally GoogleMock.
- Automated execution of these tests within your CI pipeline.
- Properly captured and formatted test outputs for CI reporting.

## Time Estimate

Setup typically takes 30 to 60 minutes, depending on familiarity.

## Difficulty Level

Intermediate: requires knowledge of C++ build systems and CI concepts.

---

## 1. Building GoogleTest with CMake

GoogleTest includes support for CMake, the most common cross-platform build system in C++ development.

### 1.1 Standalone Build

Follow these steps to build GoogleTest independently:

1. Clone the repository:

   ```bash
   git clone https://github.com/google/googletest.git -b main
   cd googletest
   mkdir build
   cd build
   ```

2. Generate Makefiles with CMake:

   ```bash
   cmake ..
   ```

   - To build only GoogleTest (without GoogleMock), run:

     ```bash
     cmake .. -DBUILD_GMOCK=OFF
     ```

3. Build the libraries:

   ```bash
   make
   ```

4. Optionally, install GoogleTest system-wide:

   ```bash
   sudo make install
   ```

   This installs headers and libraries in default system locations.

### 1.2 Incorporating GoogleTest into Your CMake Project

You can embed GoogleTest directly in your project or use installed libraries.

#### Using `find_package` (if GoogleTest is installed):

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test your_test.cpp)
target_link_libraries(your_test PRIVATE GTest::gtest_main)
```

#### Embedding GoogleTest sources:

Add the following to your project's `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(your_test your_test.cpp)
target_link_libraries(your_test PRIVATE gtest_main)
```

This ensures GoogleTest is built alongside your project using the same compiler settings.

### 1.3 Linking GoogleMock

If your tests use mocking, link against `gmock` or `gmock_main` instead of just `gtest`:

```cmake
add_executable(your_mock_test your_mock_test.cpp)
target_link_libraries(your_mock_test PRIVATE gmock_main)
```

Note: `gmock_main` includes a main() function; do *not* define your own `main()` in this case.

---

## 2. Managing Build Dependencies

Ensure your build system correctly includes GoogleTest headers and links necessary libraries.

- Include GoogleTest headers in your source files:

  ```cpp
  #include <gtest/gtest.h>
  #include <gmock/gmock.h>  // if using GoogleMock
  ```

- CMake automatically adds include directories if targets like `gtest_main` or `gmock_main` are linked.

- For other build systems, set include paths to GoogleTest's `include/` directory and link against the built static/shared libraries.

---

## 3. Configuring Tests to Run in CI

Your CI should execute the compiled test binary and process its output.

### 3.1 Running Tests

Execute the test binaries in the CI environment as part of the build pipeline:

```bash
./your_test_binary --gtest_output=xml:report.xml
```

- The `--gtest_output=xml:<file>` flag generates an XML report usable by most CI servers.

- Other flags, such as `--gtest_filter`, allow selective test execution.

### 3.2 Capturing Test Output

Configure your CI to capture standard output and parse the XML test reports for pass/fail results and detailed reporting.

---

## 4. Best Practices for Build and CI Integration

- **Use Installed GoogleTest When Possible:** Installing GoogleTest avoids rebuilding dependencies and eases CI cache usage.
- **Embed GoogleTest for Reproducibility:** When tests require a specific GoogleTest version, embed sources with `FetchContent`.
- **Link Against `gmock_main` for Mock Tests:** Avoid writing your own `main()` for mock tests.
- **Enable Parallel Builds:** Use CMake and CI features to speed up builds.
- **Use XML Output for CI Reporting:** All major CI tools (Jenkins, GitHub Actions, GitLab) support JUnit XML.
- **Control Verbosity with Flags:** For debugging, use `--gtest_verbose=info` to see detailed logs.
- **Separate Test Targets:** Define individual test executables or suites to better control execution and report granularity.

---

## 5. Troubleshooting Common Issues

### Problem 1: Missing Headers or Linker Errors

- Verify include paths point to the correct GoogleTest headers.
- Check that your linker includes `-lgtest` and, if mocking, `-lgmock`.
- Confirm the correct order of linking dependencies.

### Problem 2: Tests Not Running in CI

- Ensure CI uses the right working directory.
- Verify the test binary has execute permission.
- Check that proper arguments are passed to the test binary.

### Problem 3: Duplicate `main()` Definitions

- If linking with `gtest_main` or `gmock_main`, do not define your own `main()`.
- If you need a custom `main()`, link only against `gtest` and write your own initialization.

### Problem 4: Slow Compilation or Build Times

- Move mock class constructors and destructors to `.cc` files to reduce compile workload.
- Use precompiled headers if supported.
- Cache build artifacts in CI between runs.

---

## 6. Example: Integrating GoogleTest with a CMake Project

Here’s a minimal `CMakeLists.txt` example:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests tests/my_test.cpp)
target_link_libraries(my_tests PRIVATE gtest_main gmock_main)

# Enable testing and add tests
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

With this setup:

- Running `cmake`, then `make` builds your test binary.
- Running `ctest` will execute tests automatically.
- Using `ctest --output-on-failure` helps debugging.

Add `--gtest_output=xml:report.xml` to capture XML reports.

---

## 7. Next Steps & Related Content

- [Installation and Setup](/guides/getting-started/installation-setup) — learn more about initial environment setup.
- [Writing Your First Test](/guides/getting-started/your-first-test) — create and run simple test cases.
- [Mocking with GoogleMock](/guides/core-workflows/mocking-with-gmock) — mock dependencies effectively.
- [Integration with CI Pipelines](/overview/integration-and-ecosystem/integration-overview) — detailed guidance on CI integration strategies.
- [Troubleshooting Common Setup Issues](/getting-started/troubleshooting/common-errors) — resolve build and runtime issues.

---

<AccordionGroup title="Quick Reference">
<Accordion title="Common CMake Flags for GoogleTest">
```cmake
-DBUILD_GMOCK=ON        # Build GoogleMock (default ON)
-DBUILD_GTEST=ON        # Build GoogleTest (default ON)
-DCMAKE_CXX_STANDARD=17 # Ensure C++17 standard
-DBUILD_SHARED_LIBS=OFF # Build static libraries by default
``` 
</Accordion>
<Accordion title="Typical Test Run Command in CI">
```bash
./my_tests --gtest_output=xml:report.xml --gtest_color=no
``` 
Use `--gtest_color=no` if CI does not support ANSI colors.
</Accordion>
<Accordion title="Link Libraries for Your Test Target">

- Use `gtest_main` or `gmock_main` to get main().
- Link with `gtest` and `gmock` directly if custom `main()` is required.

Example:
```cmake
target_link_libraries(my_tests PRIVATE gmock_main)
```
</Accordion>
</AccordionGroup>

<Tip>
Remember to call `testing::InitGoogleMock(&argc, argv);` in your `main()` if you provide one.
</Tip>

<Note>
GoogleTest requires an environment supporting the C++17 standard. Verify your compiler settings accordingly.
</Note>

<Warning>
Avoid using multiple `main()` definitions when linking tests with GoogleMock or GoogleTest libraries.
</Warning>