---
title: "Creating Custom Assertions"
description: "Uncover the power of user-defined assertions for more expressive and maintainable tests. This guide explains when and how to create custom assertion macros and how to integrate them into your test suites for clarity and reusability."
---

# Creating Custom Assertions

Uncover the power of user-defined assertions for more expressive and maintainable tests. This guide explains when and how to create custom assertion macros and how to integrate them into your test suites for clarity and reusability.

---

## Why Create Custom Assertions?

Built-in GoogleTest assertions cover many common verification needs, but sometimes your tests require more expressive or domain-specific checks. Custom assertions help:

- Encapsulate complex validation logic
- Produce clearer failure messages tailored to your scenario
- Reduce repetitive code across tests
- Improve readability and maintainability

By defining your own assertion macros or predicate functions, you gain full control over how test failures are detected and reported.

## Forms of Custom Assertions

There are three main ways to create custom assertions in GoogleTest:

1. **Boolean Predicate Assertions** (`EXPECT_PRED*` and `ASSERT_PRED*`)
2. **Predicate-Formatter Assertions** (`EXPECT_PRED_FORMAT*` and `ASSERT_PRED_FORMAT*`)
3. **Custom Assertion Macros** that wrap predicates or predicate-formatters

Each progressively adds more expressive power and flexibility.

---

## 1. Boolean Predicate Assertions

These are quick and simple custom assertions. You define a predicate function or functor that returns a `bool`, then use macros like `EXPECT_PRED1` or `ASSERT_PRED3`.

### How To Write:
- Implement a function or functor returning `bool` that takes 1 to 5 arguments.
- Each argument corresponds to a test value you want to validate.
- Use `EXPECT_PREDn` or `ASSERT_PREDn` macros to call your predicate in tests.

### Example:

```cpp
// Predicate function: returns true if number is even.
bool IsEven(int n) {
  return (n % 2) == 0;
}

TEST(MyTest, CheckEven) {
  EXPECT_PRED1(IsEven, 4);  // Passes
  EXPECT_PRED1(IsEven, 3);  // Fails
}
```

### Limitations:
- Failure messages are generic and may not show detailed context.
- Arguments must be streamable to `ostream` for failure message.

---

## 2. Predicate-Formatter Assertions

For better diagnostic messages and more control, predicate-formatter assertions leverage functions that return `testing::AssertionResult`. These functions can include detailed failure messages.

### Requirements for Predicate-Formatter Functions:
- Signature includes expression strings and values, for example:

```cpp
testing::AssertionResult MyPredicateFormatter(
    const char* expr1, const char* expr2,
    int val1, int val2);
```

- Returns `AssertionSuccess()` if test passes, otherwise returns `AssertionFailure()` with custom message.

### Using the macros:
- Use `EXPECT_PRED_FORMAT2` or `ASSERT_PRED_FORMAT2` for two-argument predicates.
- You can implement formatters for 1 to 5 arguments.

### Example:

```cpp
#include <gtest/gtest.h>

using ::testing::AssertionSuccess;
using ::testing::AssertionFailure;

// Predicate-formatter that checks if two ints sum to even number.
testing::AssertionResult CheckSumIsEven(const char* expr1, const char* expr2,
                                        int val1, int val2) {
  int sum = val1 + val2;
  if (sum % 2 == 0) return AssertionSuccess();

  return AssertionFailure() << expr1 << " + " << expr2
                            << " evaluates to " << sum
                            << ", which is not even.";
}

TEST(MyTest, SumEven) {
  EXPECT_PRED_FORMAT2(CheckSumIsEven, 2, 4);  // Passes
  EXPECT_PRED_FORMAT2(CheckSumIsEven, 1, 3);  // Fails with detailed message
}
```

This failure prints:

```
CheckSumIsEven(1, 3) evaluates to false, where
1 evaluates to 1
3 evaluates to 3
1 + 3 evaluates to 4, which is not even.
```

### Advantages:
- Failures provide detailed information about the inputs and why they failed.
- Can handle arguments that aren't streamable gracefully.

---

## 3. Writing Custom Assertion Macros

For convenience and clarity, you can define macros that wrap your predicate functions or predicate-formatters. This makes your tests cleaner and integrates naturally with GoogleTest conventions.

### Example:

```cpp
#define EXPECT_IS_EVEN(val) EXPECT_PRED1(IsEven, val)
#define ASSERT_SUM_IS_EVEN(val1, val2) ASSERT_PRED_FORMAT2(CheckSumIsEven, val1, val2)

TEST(MyTest, UsingMacros) {
  EXPECT_IS_EVEN(10);  // Nice, readable
  ASSERT_SUM_IS_EVEN(3, 7);  // Readable and expressive
}
```

### Best Practices:
- Name your macros with `EXPECT_` or `ASSERT_` prefixes for consistency.
- Make macros wrap existing GoogleTest predicates or formatters to leverage existing infrastructure.
- Avoid complex macros with side effects.

---

## Integrating Custom Assertions into Your Test Suites

- Place custom predicates and macros alongside related test code for ease of maintenance.
- Use `EXPECT_` variants for soft failures where the test should continue.
- Use `ASSERT_` variants when subsequent test code depends on the assertion succeeding.
- Document your custom assertions so other developers understand their semantics and usage.

---

## Troubleshooting Common Issues

### Assertion Never Fails
- Ensure your predicate correctly returns `AssertionFailure()` on failure.
- Make sure the assertion macro is called with correct arguments.
- Validate that the failure message streaming works correctly.

### Excessive Failure Noise
- Use predicate-formatters to provide concise, relevant failure messages.
- Avoid verbose or expensive calculations in predicates unless necessary.

### Predicate Arguments Not Printable
- Use predicate-formatter assertions (`_FORMAT*`) to handle non-streamable types.

### Assertion Macros Not Recognizing Your Macro
- Verify macro expansion does not break expression correctness.
- Wrap complex expression arguments correctly using extra parentheses if needed.

---

## Additional Tips

- Consider using [`SCOPED_TRACE`](reference/testing.md#SCOPED_TRACE) to add contextual messages around your custom assertions.
- Understand the difference between nonfatal (`EXPECT_*`) and fatal (`ASSERT_*`) assertions to organize your test flow properly.
- Look at existing GoogleTest and GoogleMock assertions for patterns and inspiration.

---

## Related Documentation

- [Boolean and Predicate Assertions](reference/assertions.md#predicates)
- [Predicate-Formatter Assertions](reference/assertions.md#EXPECT_PRED_FORMAT)
- [Adding Traces with `SCOPED_TRACE`](advanced.md#adding-traces-to-assertions)
- [Writing Mocks and Expectations](guides/core-workflow/writing-mocks)

---

Empower your C++ tests by leveraging GoogleTest's flexible custom assertions to make your testing code more readable, expressive, and maintainable.