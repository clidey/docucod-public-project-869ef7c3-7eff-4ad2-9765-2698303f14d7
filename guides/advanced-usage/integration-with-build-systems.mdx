---
title: "Integrating with Build and CI Systems"
description: "Stepwise guides for integrating GoogleTest/GoogleMock into common build systems, setting up test automation workflows, and ensuring reliable test runs in CI/CD pipelines."
---

# Integrating with Build and CI Systems

Integrating GoogleTest and GoogleMock into your build system and Continuous Integration (CI) pipeline is essential for achieving reliable automated testing. This guide provides practical, step-by-step instructions to help you set up GoogleTest/GoogleMock with popular build tools and establish test automation workflows that ensure consistent, fast, and trustworthy test runs.

---

## 1. Overview of Integration Workflow

### Purpose
This guide helps you seamlessly integrate GoogleTest and GoogleMock into your project's build process and CI/CD pipelines, enabling automated compilation, test execution, and reporting.

### Prerequisites
- GoogleTest/GoogleMock sources downloaded and accessible.
- Familiarity with your build system (e.g., CMake, Bazel).
- Access to your CI system configuration (e.g., Jenkins, GitHub Actions).

### Outcomes
By completing this guide, you will have:
- Configured your build system to compile tests linked with GoogleTest and GoogleMock.
- Set up automated test runs with clear pass/fail criteria.
- Established reporting mechanisms for test results in your CI environment.

### Time Estimate
Approximately 30-60 minutes depending on existing familiarity with build and CI tools.

### Difficulty Level
Intermediate: Requires comfort with build scripts and CI configuration.

---

## 2. Integrating with Common Build Systems

### 2.1 Using CMake

GoogleTest and GoogleMock provide built-in support for CMake, simplifying integration.

#### Step 1: Add GoogleTest as a Subdirectory or FetchContent

You have two primary ways:

- **Add as Subdirectory:** Clone GoogleTest and add it as a subdirectory in your project:
  ```cmake
  add_subdirectory(path/to/googletest)
  ```

- **FetchContent:** Use CMake's FetchContent module to download during configure:
  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
  )
  FetchContent_MakeAvailable(googletest)
  ```

#### Step 2: Link Your Tests Against GoogleTest and GoogleMock

In your `CMakeLists.txt` test target, link like so:

```cmake
add_executable(my_tests test_file1.cc test_file2.cc)
target_link_libraries(my_tests PRIVATE gtest_main gmock)
add_test(NAME my_tests COMMAND my_tests)
```

- `gtest_main` includes the main function.
- `gmock` provides mocking capabilities.

#### Step 3: Configure Build and Run Tests

- Generate your build files:
  ```bash
  mkdir build && cd build
  cmake ..
  ```
- Build the tests:
  ```bash
  cmake --build .
  ```
- Run tests manually:
  ```bash
  ctest
  ```

#### Tips:
- Use `-DBUILD_GMOCK=ON` during CMake configure to enable GoogleMock.
- Use `ctest --output-on-failure` for verbose test output.


### 2.2 Using Bazel

Bazel users can integrate GoogleTest and GoogleMock via repository rules and dependencies.

- Add GoogleTest/googleMock as external dependencies in your `WORKSPACE` file.
- Define your test targets in BUILD files linking to `@com_google_googletest//:gtest_main` and `@com_google_googletest//:gmock`.

Refer to [GoogleTest on Bazel](https://github.com/bazelbuild/rules_googletest) for specific instructions.


---

## 3. Setting up Automated Test Runs in CI/CD

### Step 1: Configure Build Step

- Ensure your CI pipeline runs the commands to build your tests, typically:
  - Checkout code
  - Run CMake/Bazel configure
  - Build the test binaries

Example for CMake/Make:
```bash
mkdir build && cd build
cmake ..
make
```

### Step 2: Run Tests Automatically

Configure your CI job to execute the tests and interpret the results:

- For CTest:
  ```bash
  ctest --output-on-failure
  ```
- Direct execution:
  ```bash
  ./my_tests --gtest_output=xml:report.xml
  ```

### Step 3: Collect and Publish Test Reports

- Enable your CI system to collect GoogleTest XML reports (JUnit format) by specifying the output flags.
- Configure reporting plugins (such as JUnit reporter in Jenkins, or actions in GitHub Actions) to parse and display test results.

### Tips:
- Use `--gtest_output=xml:<filename>` flag to produce detailed XML reports.
- Incorporate `--gmock_verbose=info` to debug test failures during CI runs.
- Configure your CI to fail the build when tests fail, ensuring test reliability.


---

## 4. Best Practices for Build and CI Integration

- **Centralize GoogleTest/GoogleMock source** to avoid version mismatches across teams.
- **Cache build artifacts** in CI to speed up builds.
- **Run tests in parallel** when possible to reduce total test time.
- **Isolate flaky tests** and fix them to avoid CI instability.
- **Keep GoogleMock expectations focused** to keep tests maintainable.
- Use `NiceMock` or `StrictMock` policy wrappers appropriately in tests to control uninteresting calls' verbosity and strictness.

---

## 5. Troubleshooting Common Integration Issues

### Problem: Tests don't discover GoogleTest or GoogleMock headers/libraries

- Verify your include paths and link dependencies.
- For CMake, ensure `add_subdirectory()` is correctly pointing to GoogleTest source.
- Use `find_package(GTest REQUIRED)` when linking against installed versions.

### Problem: Linker errors when building tests

- Confirm you're linking with `gtest`, `gtest_main`, and `gmock` libraries.
- Check for runtime library mismatches on Windows; use CMake option `gtest_force_shared_crt`.

### Problem: Tests pass locally but fail in CI

- Confirm consistent compiler versions and flags.
- Check for missing dependencies or environment differences.
- Enable verbose logging in tests (`--gtest_verbose=info`) to gain insight.

### Problem: Test results not visible in CI reports

- Ensure tests output XML reports (`--gtest_output=xml:report.xml`).
- Configure CI to parse the correct report location.

Refer to the [Troubleshooting & Common Issues](https://google.github.io/googletest/getting-started/first-test-experience/troubleshooting-and-common-issues.html) page for detailed resolutions.

---

## 6. Example: GitHub Actions Workflow for GoogleTest

```yaml
name: C++ Build and Test

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Setup CMake
      uses: lukka/get-cmake@v3

    - name: Configure
      run: |
        mkdir build
        cd build
        cmake ..

    - name: Build
      run: |
        cd build
        cmake --build .

    - name: Run Tests
      run: |
        cd build
        ctest --output-on-failure

    - name: Upload Test Results
      if: always()
      uses: actions/upload-artifact@v2
      with:
        name: test-results
        path: build/Testing/**/Test.xml
```

This workflow checks out code, builds with CMake, runs tests with detailed output, and uploads test results.

---

## 7. Next Steps & Related Documentation

- After integration, learn about [Writing Your First Test](https://google.github.io/googletest/guides/getting-started/writing-your-first-test) to develop tests.
- Explore [Mocking APIs](https://google.github.io/googletest/api-reference/mocking-apis/mock-classes-methods.html) for advanced mock usage.
- Review [Setting Expectations and Actions](https://google.github.io/googletest/api-reference/mocking-apis/mock-expectations-actions.html) to control mock behavior.
- For CI troubleshooting, reference [Troubleshooting & Common Issues](https://google.github.io/googletest/getting-started/first-test-experience/troubleshooting-and-common-issues.html).

---

<Info>
Ensure that your build and CI scripts call `testing::InitGoogleTest()` (or `InitGoogleMock()` if using mocks) before running tests to properly initialize the frameworks.
</Info>