---
title: "Extending and Customizing GoogleMock"
description: "Instructions for advanced users on creating custom matchers, actions, and integrating third-party extensions, leveraging GoogleMock's extensibility for specialized testing needs."
---

# Extending and Customizing GoogleMock

Harness the full power of GoogleMock by extending and customizing its behavior to meet specialized testing requirements. This guide walks you through creating custom matchers, defining your own actions, and integrating third-party extensions, enabling you to adapt GoogleMock beyond its built-in capabilities.

---

## 1. Understanding GoogleMock Extensibility

GoogleMock is designed not only for out-of-the-box mocking but also for advanced customization, allowing you to tailor mocks precisely to your unique use cases. This page focuses exclusively on these advanced extensibility capabilities, enabling you to:

- Write **custom matchers** that capture complex argument validation logic.
- Create **custom actions** to control mock behavior in novel ways.
- Integrate **third-party extensions** to augment functionality.

These extensions empower you to express expectations and behaviors that native GoogleMock constructs cannot easily capture.

---

## 2. Creating Custom Matchers

### Why Custom Matchers?
Built-in matchers handle common argument verification, but sometimes your tests require nuanced, domain-specific checks that those cannot handle. Custom matchers fill this gap by enabling:

- Complex object state validation.
- Cross-argument or relationship-based checks.
- Improved error reporting with meaningful messages tailored to your domain.

### Approaches to Define Custom Matchers

#### a. Using `MATCHER` and `MATCHER_P` Macros
GoogleMock provides macros for quick creation of custom matchers:

```cpp
MATCHER(IsPositive, "Checks if a value is positive") {
  return arg > 0;
}

MATCHER_P(IsBetween, low, high, "Checks if a value is between given bounds") {
  return arg >= low && arg <= high;
}
```

You can use these as regular matchers in your expectations:

```cpp
EXPECT_CALL(mock_obj, Method(IsPositive()));
EXPECT_CALL(mock_obj, Method(IsBetween(10, 20)));
```

For detailed control of match results and descriptive messages, provide an optional body in the macro to explain reasons for success or failure.

#### b. Implementing Matcher Classes
For reusable or highly complex matchers, write classes that provide:

- `bool MatchAndExplain(const T& value, std::ostream* os) const` method
- `void DescribeTo(std::ostream* os) const`
- `void DescribeNegationTo(std::ostream* os) const`

Example:

```cpp
class EvenMatcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    if ((n % 2) == 0) return true;
    if (os) *os << "which is odd";
    return false;
  }

  void DescribeTo(std::ostream* os) const { *os << "is even"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is odd"; }
};

::testing::Matcher<int> IsEven() {
  return ::testing::MakeMatcher(new EvenMatcher());
}
```

### Best Practices for Matchers
- Ensure **matcher purity**—no side effects.
- Write **clear descriptions** to improve failure diagnostics.
- Use matchers to **reduce test brittleness** by focusing on essential properties.

---

## 3. Defining Custom Actions

Custom actions modify mock method behavior beyond what built-in actions offer. Define actions when you want to:

- Implement side effects such as modifying arguments.
- Return dynamic values based on invocation context.
- Combine multiple behaviors in one mock call.

### Quick Custom Actions with Lambdas or Functors
Because GoogleMock accepts any callable compatible with the mock method signature, the easiest way is a lambda or function object:

```cpp
EXPECT_CALL(mock_obj, Method(_))
    .WillOnce([](int arg) {
      // Perform custom logic
      DoSomething(arg);
      return arg * 2;
    });
```

### Advanced Action Types
For complex cases, implement `ActionInterface<F>` where `F` is the mocked function signature:

```cpp
template <typename F>
class MyAction : public ::testing::ActionInterface<F> {
 public:
  virtual typename ::testing::Action<F>::Result Perform(const typename ::testing::Action<F>::ArgumentTuple& args) override {
    // Extract arguments and apply logic
    return ...; // must be compatible with function return type
  }
};

::testing::Action<F> MakeMyAction() {
  return ::testing::MakeAction(new MyAction<F>());
}
```

Then use it:

```cpp
EXPECT_CALL(mock_obj, Method(_))
    .WillOnce(MakeMyAction());
```

### Combining Actions
Use `DoAll()` to run multiple actions in sequence and return the last action's result:

```cpp
EXPECT_CALL(mock_obj, Method(_))
    .WillOnce(::testing::DoAll(SetArgPointee<1>(42), Return(true)));
```

### Common Patterns
- Use `SetArgPointee<N>(value)` to set an output argument.
- Use `DeleteArg<N>()` to delete pointer arguments.
- Combine with `Return()`, `Invoke()`, etc., for flexible control.

---

## 4. Using the Strictness Wrappers

GoogleMock provides wrappers to control how uninteresting calls (calls without matching `EXPECT_CALL`) are handled:

- `NiceMock<T>`: Suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: (Default behavior) Warns on uninteresting calls.
- `StrictMock<T>`: Fails the test on uninteresting calls.

These wrappers subclass your mock class and can be constructed transparently with the same arguments:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock("param");
```

Use these wrappers to tune test strictness and reduce noise from irrelevant calls or to enforce strict verification.

<Info>
If your mock class has base classes with mock methods, `NiceMock` and similar wrappers may not affect those inherited methods. Use with caution.
</Info>

---

## 5. Integrating Third-Party Extensions

GoogleMock's modular design allows incorporating external matchers, actions, and tools. Consider integration points:

- Custom matchers/actions registered or implemented by external libraries.
- Test infrastructure components that wrap or extend GoogleMock.
- Adopting widely used matcher libraries (e.g., for protobuf or complex data structures).

To include extensions:
- Add necessary headers.
- Use `MATCHER`, `ACTION`, or full class implementations as per extension docs.
- Combine seamlessly with your existing expectations and actions.

---

## 6. Practical Workflow: Extending GoogleMock in Your Tests

<Steps>
<Step title="Identify Extension Needs">
Analyze which behaviors in your tests require expressiveness beyond built-in matchers and actions.
</Step>
<Step title="Create Custom Matchers">
Define your custom matchers using `MATCHER` macros for simple cases or implement full matcher classes for complex logic.
</Step>
<Step title="Define Custom Actions">
Implement custom actions as lambdas/functors or use the `ActionInterface` for advanced behavior control.
</Step>
<Step title="Apply Strictness Wrappers">
Wrap your mocks in `NiceMock`, `NaggyMock`, or `StrictMock` to match your tolerance to uninteresting calls.
</Step>
<Step title="Use Extensions in Tests">
Incorporate your custom matchers and actions in `EXPECT_CALL` and `ON_CALL` statements.
</Step>
<Step title="Validate and Verify">
Run your tests with verbose logging (`--gmock_verbose=info`) to ensure expectations and behaviors are observed as designed.
</Step>
</Steps>

---

## 7. Troubleshooting & Tips

### Common Issues
- **Matcher Failures with Poor Messages:** Ensure your matcher’s `DescribeTo()` and `DescribeNegationTo()` provide meaningful messages.
- **Side Effects in Matchers:** Avoid side effects; matchers must be pure functions.
- **Actions Not Called as Expected:** Confirm that your actions' signatures match the mocked method’s signature.
- **StrictMock Failures:** Confirm that uninteresting calls are intended; otherwise add appropriate `EXPECT_CALL` or use `NiceMock`.

### Best Practices
- Prefer expressive matchers over complex action side effects.
- Use `RetiresOnSaturation()` in `EXPECT_CALL` when expectations should deactivate after saturation.
- Avoid mixing multiple strictness wrappers on the same mock object.
- Use `Mock::AllowLeak(mock_ptr)` when mocks will not be deleted to avoid false leak reports.

### Performance Considerations
- Move mock class constructor/destructor definitions to `.cc` files to reduce compilation times.

---

## 8. Next Steps & Further Reading

- Explore [Matchers Reference](../api-reference/matchers-actions/argument-matchers) for comprehensive matcher options.
- Consult [Actions Reference](../api-reference/matchers-actions/mock-actions) to master action creation.
- Review [gMock Cookbook](gmock_cook_book.md) for practical examples and advanced recipes.
- Use [Nice, Naggy, Strict Mocks](../api-reference/mocking-apis/nice-strict-mocks) to tune test behaviors.

For foundational knowledge on defining mocks and expectations, refer to:
- [Defining and Using Mock Classes](../api-reference/mocking-apis/mock-classes-methods)
- [Setting Expectations and Actions](../api-reference/mocking-apis/mock-expectations-actions)

---

## References

- GoogleMock Extensibility official docs:
  - [Matchers Reference](../api-reference/matchers-actions/argument-matchers)
  - [Actions Reference](../api-reference/matchers-actions/mock-actions)
  - [Nice, Strict, and Naggy Mocks](../api-reference/mocking-apis/nice-strict-mocks)
- gMock Cookbook: Custom matchers and actions
- [GoogleTest Repository](https://github.com/google/googletest): source and tests demonstrating usage

---