---
title: "Continuous Integration and Automation"
description: "How to integrate GoogleTest and GoogleMock into automated build and CI/CD systems, including platform-specific considerations and reporting options."
---

# Continuous Integration and Automation Guide

## Overview

This guide demonstrates how to integrate GoogleTest and GoogleMock into automated build pipelines and Continuous Integration/Continuous Deployment (CI/CD) systems. It walks you through configuring your build system (with a focus on CMake), platform-specific considerations, and configuring test reporting to facilitate automated workflows crucial for modern software development pipelines.

### Prerequisites
- A functional GoogleTest and GoogleMock source checkout
- CMake (version 3.16 or higher) installed
- Basic familiarity with CMake build system and CI/CD environments
- A compatible compiler supporting C++17 or later

### Expected Outcome
- You will know how to set up GoogleTest and GoogleMock builds within automated systems
- You will be able to configure your test binaries to run within CI, capturing results appropriately
- You will understand platform considerations to maintain CI compatibility and robustness

### Time Estimate
30 to 60 minutes depending on your familiarity with build systems and CI tools

### Difficulty Level
Intermediate

---

## 1. Setting Up GoogleTest and GoogleMock for Automation

GoogleTest and GoogleMock provide CMake build support that can be incorporated into your automated build pipelines. By leveraging CMake’s flexibility, you can ensure your tests build and run consistently across platforms.

### Step 1: Configure Your CMakeLists.txt

GoogleTest includes a community-supported [CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt) that can be integrated into your project.

Use this minimal example outlining key options:

```cmake
cmake_minimum_required(VERSION 3.16)

project(googletest-distribution)

option(BUILD_GMOCK "Builds the googlemock subproject" ON)
option(INSTALL_GTEST "Enable installation of googletest" ON)

enable_testing()

if(BUILD_GMOCK)
  add_subdirectory(googlemock)
else()
  add_subdirectory(googletest)
endif()
```

This configuration enables building GoogleMock and GoogleTest together, ideal for automated testing frameworks.

### Step 2: Use FetchContent for Easy Integration in Your Projects

To integrate GoogleTest within your existing CMake projects (especially in CI/CD pipelines), use the `FetchContent` module to download and build GoogleTest automatically during configuration:

```cmake
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # Required on Windows for runtime compatibility

FetchContent_MakeAvailable(googletest)

add_executable(my_tests my_tests.cpp)
target_link_libraries(my_tests gtest_main gmock_main)
add_test(NAME my_tests COMMAND my_tests)
```

This approach ensures CI builds are more portable, reproducible, and do not require manual management of GoogleTest source code.

### Step 3: Build and Verify Your Tests Locally

Run the following commands manually (mimicking CI steps) to verify your build:

```bash
mkdir build && cd build
cmake ..
cmake --build .
ctest -V
```

Use `ctest` to invoke the tests. It integrates seamlessly with CMake and can output results compatible with various CI systems.

---

## 2. Automating Test Execution in CI/CD Pipelines

To fully leverage GoogleTest and GoogleMock in automated environments, you need to execute tests and capture their results efficiently.

### Step 1: Prepare the Test Binary Entry Points

GoogleTest provides pre-built main entry functions `gtest_main` and `gmock_main` which you can link against for simple integration. This allows running tests by simply executing the test binary without custom main() implementations.

For more advanced cases, you can define your own main function:

```c++
#include <gtest/gtest.h>

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Step 2: Use Platform-Specific Main Implementations

GoogleTest supports multiple platforms with different entry point requirements.

- For platforms like Windows, Linux, Mac, the standard `main(int argc, char **argv)` is used.
- For some embedded or Arduino-like environments (`ESP8266, ESP32, NRF52`), use `setup()` and `loop()` functions as entry points.

Refer to [gtest_main.cc](https://github.com/google/googletest/blob/main/googletest/src/gtest_main.cc) and [gmock_main.cc](https://github.com/google/googletest/blob/main/googlemock/src/gmock_main.cc) for the exact implementations.

### Step 3: Running Tests in CI Environment

Configure your CI job to build the tests and run them automatically:

Example on a Unix-like CI system:

```bash
cmake --build . --target my_tests
./my_tests --gtest_output=xml:report.xml
```

- The flag `--gtest_output=xml:report.xml` generates test results in JUnit XML format.
- Many CI systems (e.g., Jenkins, GitHub Actions, GitLab CI) can ingest this format for status reporting.

### Step 4: Capture and Report Test Results

Configure your CI to capture the XML reports published by GoogleTest:

- Use appropriate CI plugins or commands to display test progress and failures
- Fail CI jobs if any test fails (GoogleTest returns non-zero exit code)

---

## 3. Platform-Specific Considerations

GoogleTest supports a wide range of platforms following the foundational C++ support policy. When integrating into CI, keep these in mind:

- Ensure your CI environment uses a compiler compatible with C++17 (mandatory)
- On Windows, consider the `gtest_force_shared_crt` option to align runtimes and avoid linker errors
- On embedded or specialized platforms, use the provided platform-specific main() implementations
- Multi-threaded tests require pthread support on POSIX systems; ensure your CI environment includes this

Consult the [Supported Platforms documentation](https://github.com/google/googletest/blob/main/docs/platforms.md) for full compatibility details.

---

## 4. Reporting Options to Enhance CI Integration

### Using XML and Other Output Formats

GoogleTest supports several test result formats:

- **XML output**: Standard JUnit-like XML via the `--gtest_output=xml:<file>` flag
- **TPROF, JSON, Other**: (via extensions or third-party tools, not directly in GoogleTest)

Configuring XML output allows automated parsing by popular CI dashboards.

### Integrating with Test Runners and Dashboards

- Use `ctest` with `-T Test` command for richer test output integration
- Integrate with GUI tools or command line wrappers like `gtest-parallel` for large test suites

### Custom Test Listeners

For advanced reporting scenarios, implement GoogleTest event listeners to output JSON, TAP, or other formats suitable to your CI platform.

---

## 5. Troubleshooting and Best Practices

### Common Issues in CI Environments

- **Test discovery fails**: Verify test binaries are linked against `gtest_main` or have appropriate main() implementations
- **Linker errors on Windows**: Use `-Dgtest_force_shared_crt=ON` in CMake to resolve runtime mismatches
- **Test output missing in CI**: Ensure `--gtest_output=xml` is used and test reports are collected properly
- **Tests hanging or timing out**: Review tests for platform-specific issues or resource constraints in CI

### Best Practices

- Always return the result of `RUN_ALL_TESTS()` to ensure proper exit codes
- Use CMake `enable_testing()` and define `add_test()` targets to leverage `ctest` in CI
- Cleanly separate test binaries from application code for easier CI management
- Keep your dependencies (GoogleTest version, CMake) up to date for latest CI compatibility

---

## Next Steps & Related Content

- Visit [Installing with CMake](/getting-started/prerequisites-installation/installation-cmake) for detailed build setup
- Review the [Writing Your First Test](/guides/getting-started/writing-first-test) for writing tests suited to automated builds
- Explore the [System Requirements & Supported Platforms](/getting-started/prerequisites-installation/system-requirements) to confirm compatibility with your CI environment
- See the [Test Runner Entry Points](/api_reference/configuration_and_main_api/runner_entry_points) for customizing test startup behavior


---

## Summary
This guide equips you to incorporate GoogleTest and GoogleMock into automated build and CI/CD systems using CMake. It covers configuration, execution, platform-specific nuances, and reporting options for effective integration into quality pipelines.

<Tip>
Leverage GoogleTest’s native CMake and `FetchContent` support for seamless, maintainable CI integration.
</Tip>

<Warning>
Always use `RUN_ALL_TESTS()` return codes to ensure your CI system accurately detects test failures.
</Warning>

<Info>
Use the `--gtest_output=xml` option to produce test reports consumable by popular CI tools.
</Info>
