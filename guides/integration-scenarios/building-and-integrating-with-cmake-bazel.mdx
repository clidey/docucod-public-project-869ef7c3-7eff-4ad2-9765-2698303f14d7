---
title: "Building and Integrating with CMake and Bazel"
description: "Step-by-step processes for adding GoogleTest to your project via CMake or Bazel. Details configuration, linking, and tips for keeping dependencies clean and up-to-date within modern C++ development environments."
---

# Building and Integrating with CMake and Bazel

This guide walks you through integrating GoogleTest into your C++ projects using the **CMake** and **Bazel** build systems. You will learn how to configure dependencies, link libraries, and build test binaries seamlessly while maintaining a clean and up-to-date dependency management strategy. The instructions apply to modern C++ environments targeting at least C++17.

---

## Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Building and Integrating with CMake](#building-and-integrating-with-cmake)
  - [1. Setting Up Your Project with GoogleTest](#1-setting-up-your-project-with-googletest)
  - [2. Creating Test Binaries and Linking](#2-creating-test-binaries-and-linking)
  - [3. Building and Running Tests](#3-building-and-running-tests)
  - [Best Practices and Tips for CMake](#best-practices-and-tips-for-cmake)
- [Building and Integrating with Bazel](#building-and-integrating-with-bazel)
  - [1. Setting Up Your Bazel Workspace](#1-setting-up-your-bazel-workspace)
  - [2. Creating Test Targets and Dependencies](#2-creating-test-targets-and-dependencies)
  - [3. Building and Running Tests with Bazel](#3-building-and-running-tests-with-bazel)
  - [Best Practices and Tips for Bazel](#best-practices-and-tips-for-bazel)
- [Troubleshooting Common Issues](#troubleshooting-common-issues)
- [Next Steps & Related Documentation](#next-steps--related-documentation)

---

## Overview

This page focuses specifically on how to add GoogleTest to your project using CMake or Bazel. Both systems are widely used in C++ development and offer robust ways to manage GoogleTest as a dependency, build test binaries, and integrate test execution smoothly into CI pipelines.

By following this guide, you will gain practical skills for incorporating GoogleTest directly from its source or via package management features like CMake's FetchContent or Bazel Central Registry.

---

## Prerequisites

Before integrating GoogleTest with your chosen build system, ensure:

- Your operating system and compiler support C++17 or newer.
- You have installed **CMake (3.14 or later)** or **Bazel (7.0 or later)** depending on your build environment.
- Basic familiarity with your build system’s configuration files (`CMakeLists.txt` for CMake or `BUILD`/`MODULE.bazel` for Bazel).
- Network access for fetching GoogleTest sources during build configuration or dependency resolution.

Refer to the [Supported Platforms and Requirements](../overview/feature-overview/supported-platforms.mdx) page for detailed environment compatibility.

---

## Building and Integrating with CMake

### 1. Setting Up Your Project with GoogleTest

The recommended way to incorporate GoogleTest into a CMake project is by using the [`FetchContent`](https://cmake.org/cmake/help/latest/module/FetchContent.html) module, which downloads and makes the GoogleTest source available during your configure step.

**Example `CMakeLists.txt` snippet:**

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Include FetchContent for dependency management
include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows: ensure consistent runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)
```

> Replace the URL commit hash with the latest stable GoogleTest commit frequently to stay updated.


### 2. Creating Test Binaries and Linking

Add your test executable and link it against GoogleTest's `gtest_main` library which provides the default main() entry point:

```cmake
# Enable CTest testing
enable_testing()

# Define your test executable
add_executable(
  hello_test
  hello_test.cc
)

# Link with GoogleTest's main library
target_link_libraries(
  hello_test
  GTest::gtest_main
)

# Automatically discover tests to integrate with ctest
include(GoogleTest)
gtest_discover_tests(hello_test)
```

`hello_test.cc` might look like:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### 3. Building and Running Tests

Run the following commands in your project directory:

```bash
cmake -S . -B build
cmake --build build
cd build && ctest
```

Successful test execution displays a summary like:

```
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1

Total Test time (real) =   0.01 sec
```

### Best Practices and Tips for CMake

- **Keep your dependencies explicit:** Always specify the exact GoogleTest version you depend on via the `URL` in `FetchContent_Declare`.

- **Dynamic vs Static CRT on Windows:** Use `gtest_force_shared_crt ON` to avoid runtime linkage mismatches with Visual Studio build configurations.

- **Enable testing early:** Place `enable_testing()` before declaring test targets to activate CTest support.

- **Link only required libraries:** For minimal dependencies, link against `GTest::gtest_main` instead of `GTest::gtest` unless you provide your own main.

- **Upgrade CMake if needed:** `FetchContent_MakeAvailable` requires CMake 3.14 or higher.

- **Isolation from GoogleMock:** If only GoogleTest is needed, avoid building GoogleMock by appropriate flags or custom configuration.

- **Troubleshoot link errors:** Check your C++ standard flags and runtime library settings; inconsistent settings cause common link issues.

---

## Building and Integrating with Bazel

### 1. Setting Up Your Bazel Workspace

Create a new Bazel workspace and declare GoogleTest as a dependency using the Bazel Central Registry:

Create a directory and add a `MODULE.bazel` file:

```starlark
# MODULE.bazel

bazel_dep(name = "googletest", version = "1.17.0")
```

> Update the version as new GoogleTest releases become available.

### 2. Creating Test Targets and Dependencies

Within your Bazel workspace, create a `BUILD` file alongside your test source:

```starlark
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

`hello_test.cc` can mirror the same basic test example:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### 3. Building and Running Tests with Bazel

To build and execute tests, run:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

You should see output similar to:

```
[==========] Running 1 test from 1 test suite.
[  PASSED  ] 1 test.

INFO: Build completed successfully
```

### Best Practices and Tips for Bazel

- **Use Bazel Central Registry:** Simplifies dependency handling and ensures you use official GoogleTest releases.

- **Set C++ standard explicitly:** Provide `--cxxopt=-std=c++17` (or equivalent) to enforce the correct language version.

- **Link test main properly:** Always include `@googletest//:gtest_main` if you want to use GoogleTest’s default main function.

- **Keep `MODULE.bazel` updated:** Regularly update dependencies to the latest stable versions.

- **Leverage Bazel test features:** Use `--test_output=all` to see comprehensive test logs.

---

## Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Common Issues">
<Accordion title="Linking Errors on Windows with MSVC">
If you encounter linker errors related to runtime libraries (`RuntimeLibrary` mismatch), ensure you have configured `gtest_force_shared_crt` to `ON` in CMake or match your project runtime flags with Bazel settings.

Example for CMake:
```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```
</Accordion>
<Accordion title="Cannot Find GoogleTest with find_package">
If using `find_package(GTest)` and it's not found, verify GoogleTest is installed correctly, or switch to FetchContent method for guaranteed availability.
</Accordion>
<Accordion title="Tests Not Discovered or Not Running">
- Confirm `enable_testing()` is called before test declarations in CMake.
- Use `gtest_discover_tests()` to automatically add tests.
- For Bazel, verify test targets are correctly declared as `cc_test` and dependencies include `gtest_main`.
</Accordion>
<Accordion title="Build Fails Due to Missing C++17 Support">
Ensure your compiler supports C++17 and that the build configuration enforces it via:
- CMake: `set(CMAKE_CXX_STANDARD 17)`
- Bazel: `--cxxopt=-std=c++17` or equivalent.
</Accordion>
<Accordion title="Dependency Version Conflicts">
Keep your GoogleTest commit hash or version up to date to avoid incompatibilities, especially when using FetchContent or Bazel Central Registry.
</Accordion>
</AccordionGroup>

---

## Next Steps & Related Documentation

- Explore the **[Writing Your First Test](../getting-started/first-test-execution-validation/writing-your-first-test.mdx)** guide to learn how to write effective assertions and tests.
- Review the **[Building and Running Tests](../getting-started/first-test-execution-validation/building-running-tests.mdx)** page for detailed build and execution workflows.
- Dive into the **[GoogleTest Primer](../overview/product-intro-and-value/what-is-googletest.mdx)** for foundational framework understanding.
- For advanced scenarios, consult **[Integration & Ecosystem Compatibility](../overview/architecture-and-concepts/integration-and-extension.mdx)**.

---