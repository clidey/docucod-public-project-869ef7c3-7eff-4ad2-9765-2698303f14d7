---
title: "Cross-Platform and Environment Considerations"
description: "Guides for running GoogleTest and GoogleMock on different compilers, platforms, and embedded environments. Includes supported platforms, common issues, and adapting configuration for various toolchains."
---

# Cross-Platform and Environment Considerations

GoogleTest and GoogleMock are designed to work seamlessly across a wide range of compilers, operating systems, and embedded environments. This guide helps you understand the critical cross-platform nuances, environment-specific settings, and common pitfalls for successful integration and build of GoogleTest in your projects.

---

## 1. Supported Platforms and Compiler Requirements

GoogleTest supports a variety of operating systems and compilers following [Google’s Foundational C++ Support Policy](https://opensource.google/documentation/policies/cplusplus-support). These include Linux, Windows (Desktop and variants), macOS, FreeBSD, OpenBSD, and special cases like Fuchsia and QNX.

### Key Platform Macros

GoogleTest auto-detects platform and environment details via predefined macros. You can expect these macros to reflect your build environment for conditional compilation and feature toggling:

- `GTEST_OS_LINUX`, `GTEST_OS_WINDOWS`, `GTEST_OS_MAC`, `GTEST_OS_FREEBSD`, etc.
- Embedded platforms like `GTEST_OS_ESP8266`, `GTEST_OS_ESP32`, `GTEST_OS_NRF52`.

You should not define these macros manually; they are set automatically during compilation.

### Compiler & C++ Standard

- **Minimum required C++ standard:** C++17. Builds will fail if earlier versions are used.
- **MSVC:** Minimum Visual Studio 2015 (MSVC 14.0).
- **Clang, GCC, IntelLLVM:** Supported versions with standard C++17 compliance.

Ensure your toolchain supports this standard or explicitly specify `-DCMAKE_CXX_STANDARD=17` in your CMake configuration.

---

## 2. Configuring Builds for Cross-Platform

### Using CMake

GoogleTest provides a cross-platform CMake build that generates native build files for your environment:

#### Standalone Build

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
echo "cd googletest"
mkdir build && cd build
cmake ..             # For full GoogleTest + GoogleMock build
# or
cmake .. -DBUILD_GMOCK=OFF  # To build only GoogleTest
make                 # On *nix systems
```

On Windows with Visual Studio, CMake generates `.sln` projects, and on macOS with Xcode, `.xcodeproj`.

#### Integrated Build

You can embed GoogleTest into your project’s CMake build by using `add_subdirectory()` or fetching GoogleTest during configure:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/<commit_hash>.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE) # On Windows to match runtime
FetchContent_MakeAvailable(googletest)

add_executable(example example.cpp)
target_link_libraries(example gtest_main)
add_test(NAME example_test COMMAND example)
```

This ensures compatibility of compiler/linker flags across GoogleTest and your project.

### Tweaking Compiler Settings

GoogleTest’s CMake scripts adjust compiler flags for various compilers to avoid common conflicts:

- MSVC: Adjusts runtime linkage (`/MT` vs `/MD`) for static/shared builds.
- Clang and GCC: Adds extra warning flags and disables problematic warnings.
- Pthread detection for Unix-like platforms to enable thread-safe support.

### Shared Library Considerations

If you want to build GoogleTest as a shared library:

- Add `-DGTEST_CREATE_SHARED_LIBRARY=1` to compiler flags.
- Link your tests with `-DGTEST_LINKED_AS_SHARED_LIBRARY=1`.

This is recommended if you prefer dynamic linkage or faster load times, especially on Windows.

---

## 3. Threading and Synchronization Support

GoogleTest is thread-safe when pthreads or equivalent threading primitives are available.

- The macro `GTEST_IS_THREADSAFE` indicates if the build supports thread safety.
- On POSIX platforms, pthread support is auto-detected and enabled by default.
- On Windows, native synchronization primitives are used.

If pthread detection is faulty in your environment, explicitly define:

```bash
-DGTEST_HAS_PTHREAD=1
#or
-DGTEST_HAS_PTHREAD=0
```

### Multi-threaded Tests

When GoogleTest detects pthread availability, all tests and assertions are thread-safe. This is critical when running tests in parallel or when tests themselves perform multithreading.

---

## 4. Embedded & Special Environment Support

GoogleTest supports embedded platforms such as ESP8266, ESP32, and NRF52 with adaptations.

- In these environments, the initialization function (`setup()`) calls `testing::InitGoogleMock()`.
- Tests run via the main loop (`loop()`).
- Some platform-specific headers or functionality (e.g., file system) may be missing or limited.

For such targets, adjustments to your build and test harness might be needed to handle missing features.

---

## 5. Common Cross-Platform Issues & Troubleshooting

### Linking Errors on Windows with Visual Studio

- Mismatched CRT runtimes often cause linker errors like:
  `mismatch detected for 'RuntimeLibrary': value 'MTd_StaticDebug' doesn't match value 'MDd_DynamicDebug'`

**Solution:** Enable the CMake option `gtest_force_shared_crt` to use shared runtime libraries consistently.

### C++ Standard Compatibility

- If you get errors about language features, verify that your compiler supports C++17.
- Specify the standard explicitly via CMake or compiler flags.

### Missing Pthread or Thread Safety

- If you encounter threading-related failures or warnings, define `-DGTEST_HAS_PTHREAD=1` or disable threads by setting it to 0.
- Review linking flags for pthread (`-pthread`) on Linux/BSD systems.

### Macro Name Conflicts

Macros like `TEST()` or `ASSERT_EQ` defined by GoogleTest can clash with other libraries.

**To avoid this:**

- Define `-DGTEST_DONT_DEFINE_TEST=1` or similar flags to rename GoogleTest macros (e.g., `TEST` becomes `GTEST_TEST`).

---

## 6. Best Practices for Cross-Platform Integration

- Always build GoogleTest with the same compiler and runtime settings as your main project.
- Use the recommended CMake integration methods (`FetchContent` or `add_subdirectory`) to ensure compatibility.
- Pin the GoogleTest version or commit hash to avoid surprises due to upstream changes.
- Regularly test your builds in all target environments to catch platform-specific issues early.
- For embedded platforms, adapt your initialization and main test execution loop per the examples.

---

## 7. Summary Diagram: GoogleTest Build and Environment Flow

```mermaid
flowchart TD
  A[Start Build Configuration] --> B{Choose Build System}
  B -->|CMake| C[Setup CMakeLists.txt]
  B -->|Bazel| D[Setup BUILD.bazel]
  B -->|Manual| E[Manual Compilation and Linking]

  C --> F{Desired Components}
  F -->|Full GTest + Mock| G[Include GoogleTest & GoogleMock source]
  F -->|GoogleTest only| H[Build GoogleTest Sources Only]

  G --> I[Invoke CMake configure with options]
  H --> I

  I --> J[Compiler Setup]
  J --> K{Compiler Detected}
  K -->|MSVC| L[Adjust Runtime Flags, Enable gtest_force_shared_crt]
  K -->|Clang/GCC| M[Set Warning Flags, Enable pthread if available]

  L & M --> N[Build Targets (Static or Shared)]

  N --> O[Run Tests or Link to Project]

  O --> P{Environment Platform}
  P -->|Linux/BSD/Unix| Q[Ensure pthreads enabled, POSIX compliance]
  P -->|Windows| R[Handle runtime libraries, Unicode support]
  P -->|Embedded| S[Adapt Init Loop and Build flags]

  Q & R & S --> T[Successful Cross-Platform Integration]
```

---

## 8. Additional Resources

- [Supported Platforms and Requirements](https://google.github.io/googletest/overview/feature-overview/supported-platforms)
- [Building and Integrating with CMake and Bazel](https://google.github.io/googletest/guides/integration-scenarios/building-and-integrating-with-cmake-bazel)
- [GoogleTest Primer](https://google.github.io/googletest/docs/primer.html)
- [GoogleMock Documentation](https://github.com/google/googletest/tree/main/googlemock)

For detailed build customization, consult the CMake files and `gtest-port.h` for internal platform macros.

---

## Appendix: Minimal Example to Configure GoogleTest with CMake

```bash
mkdir build
cd build
cmake .. -DCMAKE_CXX_STANDARD=17
make
./example_test
```

This will build and run GoogleTest example binaries checking cross-platform compatibility.

---

<Tip>
Always align your compiler and linker settings between GoogleTest and your project to avoid ABI and runtime issues, especially on Windows.
</Tip>

<Note>
If you encounter platform-specific build or runtime issues, check the platform macros by inspecting compilation logs or debugging the `gtest-port.h` definitions.
</Note>

<Warning>
Do not manually define platform macros like `GTEST_OS_WINDOWS` unless you are certain about environment detection failure.
</Warning>

---

This guide ensures your integration of GoogleTest and GoogleMock addresses all common cross-platform and environment considerations, maximizing reliability and performance.
