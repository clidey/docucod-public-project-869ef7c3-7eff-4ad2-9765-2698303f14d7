---
title: "Automating Tests in CI/CD"
description: "Best practices for running your tests in CI environments using native scripts and configuration guidance. Learn to interpret test outputs and maintain high code quality through automation."
---

# Automating Tests in CI/CD

## Workflow Overview

### Task Description
This guide helps you automate running your GoogleTest and GoogleMock tests in Continuous Integration/Continuous Deployment (CI/CD) environments. You will learn how to configure native test scripts, interpret test outputs clearly, and ensure your code quality remains high through automated execution.

### Prerequisites
- GoogleTest and GoogleMock built and linked in your project.
- Basic familiarity with CMake build system (version 3.14+ recommended).
- Access to your CI environment's build and execution logs.
- Ability to configure environment variables and scripts in your CI pipeline.

### Expected Outcome
By following this guide, you will set up your CI pipeline to:
- Run automated test suites upon code commits or merges.
- Generate clear, actionable test output reports.
- Detect test failures swiftly to maintain high code quality.

### Time Estimate
Approximately 30-60 minutes depending on your CI environment and existing configuration.

### Difficulty Level
Intermediate: Requires understanding of build systems and CI scripting.

---

## Step-by-Step Instructions

### 1. Prepare Your Test Executable

- If not done already, create an executable with GoogleTest and GoogleMock linked. Use either `gtest_main` or `gmock_main` libraries to provide a `main()` function to your tests.
  
- Using `gtest_main` or `gmock_main` automatically initializes GoogleTest or GoogleMock and runs all tests with a call to `RUN_ALL_TESTS()`, handling argument parsing for test flags.

**Example CMake snippet:**
```cmake
add_executable(my_tests test1.cpp test2.cpp)
target_link_libraries(my_tests gtest_main gmock_main pthread)
add_test(NAME MyTests COMMAND my_tests)
```

### 2. Configure Your Build for CI

- Ensure your build scripts run tests in the CI environment using native commands.
- For CMake-based projects, use `ctest` or your CI scripts to run the generated test executables.

**Common invocation:**
```bash
cmake --build build_dir --target my_tests
ctest --test-dir build_dir --output-on-failure
```

- Include flags for running only desired tests or test subsets using `--gtest_filter` if needed.

### 3. Interpret Test Outputs

- GoogleTest organizes output by test suite and test names indicating passed, failed, or disabled tests.
- Redirect test executable output to files if needed to separate logs from other output.

```bash
./my_tests --gtest_output=xml:report.xml > test_stdout.log 2>&1
```
- This command writes a machine-readable XML report for CI systems to parse and capture detailed test results.

- Use the `--gtest_color` flag in your CI environment to improve legibility if supported by your console logs.

### 4. Handle Test Failures

- Fail your CI build if `RUN_ALL_TESTS()` returns a nonzero exit code.
- Use the GoogleTest output and reports to identify which tests failed and why.
- Consider enabling `--gtest_fail_fast` flag to stop on first failure during development workflows.

### 5. Maintain and Scale Your CI Setup

- Keep your test suites modular to enable selective runs with filters.
- Use test sharding and repetition flags (`GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`) if your CI supports parallel test execution to reduce runtime.
- Generate both XML and JSON test reports as supported by your CI for integration with dashboards.

<Tip>
Always use the return value of `RUN_ALL_TESTS()` in your build scripts to ensure your CI detects failures properly.
</Tip>

<Warning>
Avoid ignoring the output of `RUN_ALL_TESTS()`; your tests may appear passing even when failures occur.
</Warning>

---

## Practical Examples

### Example: Simple CTest Integration

In your `CMakeLists.txt`:
```cmake
enable_testing()
add_executable(my_tests test_main.cpp other_tests.cpp)
target_link_libraries(my_tests gtest_main gmock_main pthread)
add_test(NAME MyTests COMMAND my_tests --gtest_output=xml:test_results.xml)
```

Run:
```bash
cmake --build build
ctest --output-on-failure
```

You will see a detailed breakdown of tests and an XML file `test_results.xml` generated for CI consumption.

### Example: Filtering Tests in CI

To run only a subset of tests during nightly runs:
```bash
./my_tests --gtest_filter=SmokeTest.*
```

### Example: Running Tests with Parallel Sharding

If your CI agents support parallel shards, set:
```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=2  # for this shard
./my_tests
```

Each shard runs a distinct subset of the tests, speeding up your test cycles.

---

## Troubleshooting & Tips

### Common Issues

- **Tests not detected:** Confirm tests are registered and the test executable links with `gtest_main` or `gmock_main`.

- **Tests failing silently:** Ensure your build scripts check the return code of the test executable.

- **Output cluttered by logging:** Redirect application logging output to a separate file or stream.

- **Race conditions:** For flaky tests, consider running with `--gtest_repeat` to debug intermittent failures.

### Best Practices

- Use `--gtest_output=xml:path` for structured reports consumable by CI tools.
- Avoid disabled tests piling up; regularly review and fix or remove them.
- Use filtering in CI for quick feedback loops on critical test subsets.
- Enable colored output if your CI console supports ANSI colors for readability.

---

## Next Steps & Related Content

- Explore [Integrating with CMake and Bazel](https://yourdocs/guides/integration-optimization/build-system-integration) for deeper build system integration.
- Learn about [Test Discovery & Execution](https://yourdocs/guides/getting-started/test-discovery-execution) to harness advanced test filtering and output options.
- Read [Performance Optimization & Scalability](https://yourdocs/guides/integration-optimization/performance-optimization) for efficient test execution in large codebases.
- Check the [GoogleTest Primer](https://yourdocs/docs/primer) to solidify foundational understanding.


---

## References

- GoogleTest GitHub: https://github.com/google/googletest
- CMake Guide: https://cmake.org/cmake/help/latest/
- GoogleTest Output Flags: https://github.com/google/googletest/blob/main/docs/advanced.md#running-test-programs-advanced-options

---

**Sample Command to run tests with output report in CI:**
```bash
./my_tests --gtest_output=xml:report.xml --gtest_color=yes
```

**Flag to fail fast during test runs:**
```bash
./my_tests --gtest_fail_fast
```

**Repeat flaky test 100 times for debugging:**
```bash
./my_tests --gtest_repeat=100
```

---