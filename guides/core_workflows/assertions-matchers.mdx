---
title: "Expressive Assertions and Matchers"
description: "Discover how to use GoogleTest’s rich assertion macros and matchers for effective verification of C++ code. Learn practical usage patterns for standard assertions, custom assertions, and a variety of matchers including numeric, container, and exception matchers."
---

## Expressive Assertions and Matchers

GoogleTest provides a rich set of assertion macros and powerful matchers to enable precise and readable verification of your C++ code behavior. This guide focuses specifically on how to effectively use these assertions and matchers to write clear, maintainable, and robust tests.

---

### 1. Overview of Assertions and Matchers

- **Purpose**: To validate that your code produces expected results or state, and to diagnose failures clearly when it does not.
- **Assertions Types**: GoogleTest offers both fatal assertions (`ASSERT_`) which abort the current test on failure, and nonfatal assertions (`EXPECT_`) which allow the test to continue.
- **Matchers**: Provide expressive, composable conditions to verify values and complex data structures.

### 2. Prerequisites

- Include GoogleTest headers: `#include <gtest/gtest.h>`
- For matchers (especially when combining with gMock): include `#include <gmock/gmock.h>`
- Your test project must be configured with GoogleTest and/or GoogleMock libraries properly linked.

### 3. Expected Outcome

After following this guide, you will be able to:

- Use standard assertion macros to verify Boolean conditions, equality, inequality, and exceptions.
- Apply matchers to assert complex conditions on values such as containers, strings, and numeric ranges.
- Differentiate when to use `EXPECT_` vs `ASSERT_` assertions.
- Write predicates and parameterized expectations for clear and reusable verification.

### 4. Difficulty Level

Intermediate — assumes familiarity with C++ unit testing basics and GoogleTest setup.

---

## Using Basic Assertions

GoogleTest provides a collection of assertion macros for fundamental validation needs.

### 4.1 Boolean Condition Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Verifies that the condition evaluates to true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Verifies that the condition evaluates to false.

```cpp
EXPECT_TRUE(is_valid) << "The value should be valid.";
ASSERT_FALSE(has_error) << "Error state unexpected.";
```

### 4.2 Binary Comparison Assertions

Common macros to compare values:

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`: Checks `val1 == val2`.
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`: Checks `val1 != val2`.
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)`: Checks `val1 < val2`.
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)`: Checks `val1 <= val2`.
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)`: Checks `val1 > val2`.
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)`: Checks `val1 >= val2`.

Use pointer-aware string comparisons such as `EXPECT_STREQ` or `EXPECT_STRNE` when comparing C strings.

```cpp
EXPECT_EQ(result, expected_value);
ASSERT_NE(ptr, nullptr);
```

### 4.3 Floating-Point Comparisons

Due to rounding errors, floating-point comparisons require specific macros:

- `EXPECT_FLOAT_EQ(val1, val2)`
- `EXPECT_DOUBLE_EQ(val1, val2)`
- `EXPECT_NEAR(val1, val2, abs_error)`

They allow approximate equality checks within tolerance.

### 4.4 Exception Assertions

Verify whether your code throws or does not throw exceptions:

- `EXPECT_THROW(statement, exception_type)`
- `EXPECT_ANY_THROW(statement)`
- `EXPECT_NO_THROW(statement)`

Example:
```cpp
EXPECT_THROW({ throw std::runtime_error("error"); }, std::runtime_error);
```

---

## Using Matchers for Expressive Conditions

Matchers allow you to write assertions that are closer to natural language while providing rich diagnostics on failure.

### 5.1 `EXPECT_THAT` and `ASSERT_THAT`

Use the `EXPECT_THAT(value, matcher)` macro to assert that *value* satisfies the matcher condition.

Example:
```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::ContainsRegex;
using ::testing::AllOf;

EXPECT_THAT(name, StartsWith("Hello"));
EXPECT_THAT(log, ContainsRegex("error.*critical"));
EXPECT_THAT(value, AllOf(Gt(5), Lt(10)));
```

### 5.2 Built-in Matchers

- **Numeric Matchers:** `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`, `FloatEq()`, `DoubleEq()`
- **String Matchers:** `StrEq()`, `StrNe()`, `StrCaseEq()`, `StrCaseNe()`, `StartsWith()`, `EndsWith()`, `HasSubstr()`, `MatchesRegex()`, `ContainsRegex()`
- **Container Matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `ElementsAreArray()`, `Contains()`, `IsEmpty()`, `SizeIs()`
- **Pointer Matchers:** `IsNull()`, `NotNull()`, `Pointee()`, `Ref()`
- **Logical Combinators:** `AllOf()`, `AnyOf()`, `Not()`

#### Example with containers:
```cpp
EXPECT_THAT(vec, ElementsAre(1, _, 3, Gt(4)));
EXPECT_THAT(map, Contains(Pair("key", 42)));
```

---

## Writing Custom Assertions and Matchers

### 6.1 Using Predicates with `EXPECT_PRED` Macros

GoogleTest lets you verify arbitrary predicates:

```cpp
bool IsPrime(int n) { /*...*/ }
EXPECT_PRED1(IsPrime, 7); // Passes if IsPrime(7) == true
```

For functions with more parameters, use `EXPECT_PRED2`, `EXPECT_PRED_FORMAT`, etc.

### 6.2 Custom Matchers

Define your own matchers using `MATCHER` macros or by implementing matcher interfaces.

```cpp
MATCHER(IsEven, "") { return (arg % 2) == 0; }
EXPECT_THAT(number, IsEven());
```

---

## Best Practices and Tips

- Prefer `EXPECT_` over `ASSERT_` unless the continuation of the test makes no sense after failure.
- Use matchers to make assertions expressive and failure messages clearer.
- Combine matchers logically to express complex conditions concisely.
- When verifying mock interactions, use `EXPECT_CALL` with matchers for arguments.
- Use container matchers to verify container contents precisely.

<Info>
If your test needs to verify multiple properties, split them into focused assertions to isolate failures clearly.
</Info>

---

## Troubleshooting Common Issues

- **Assertion failures** indicate that expected conditions were not met. Carefully examine the failure messages which include actual and expected values.
- **Incorrect matcher usage** may cause compile errors or unintended behavior. Check that your matcher types match function argument types.
- **Matching too strictly** can make tests brittle; prefer broad matchers when exact values are not critical.

<Tip>
Use `--gtest_break_on_failure` flag during test runs to debug failing assertions interactively.
</Tip>

---

## Examples

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::Eq;
using ::testing::Gt;
using ::testing::ElementsAre;

TEST(MyTestSuite, BasicAssertions) {
  EXPECT_TRUE(1 + 1 == 2);
  EXPECT_EQ(3, 1 + 2);
  EXPECT_THAT(std::vector<int>{1, 2, 3}, ElementsAre(1, 2, 3));
  EXPECT_THAT(7, Gt(3));
}

TEST(ExceptionTest, ThrowsTest) {
  EXPECT_THROW(throw std::runtime_error("fail"), std::runtime_error);
  EXPECT_NO_THROW(int x = 1 + 1;
                  (void)x;);
}
```

---

## Next Steps & Related Content

- For detailed assertion syntax and reference, see [Assertions Reference](/docs/reference/assertions.md).
- To learn about mocking and expectations with GoogleMock, visit [Mocking Reference](/docs/reference/mocking.md) and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).
- Explore advanced matcher creation techniques for custom validation.

---

## Additional Resources

| Resource                          | Description                                   |
|----------------------------------|-----------------------------------------------|
| [GoogleTest Primer](https://github.com/google/googletest) | Official getting started guide                  |
| [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) | Recipes for matchers and mock usage             |
| [Matchers Reference](https://github.com/google/googletest/blob/main/googlemock/include/gmock/gmock-matchers.h) | Code-level documentation of matchers             |

