---
title: "Integrating with Build Systems & Platforms"
description: "How to integrate GoogleTest and GoogleMock with various build systems and platforms. Includes configuration advice and troubleshooting for cross-platform environments."
---

# Integrating with Build Systems & Platforms

## Overview

This guide provides clear, actionable instructions for integrating GoogleTest and GoogleMock into various build systems and platforms. Whether you are working with CMake, Bazel, Visual Studio, or embedded systems, this document will help you configure your environment to build, link, and run your tests effectively.

You will also find troubleshooting advice to resolve common issues encountered in cross-platform development.

---

## 1. Integration with CMake

### 1.1 Standalone Build

To set up GoogleTest and GoogleMock as standalone projects using CMake:

1. **Clone the Repository:**

   ```bash
   git clone https://github.com/google/googletest.git -b v1.17.0
   cd googletest
   ```

2. **Create and enter a build directory:**

   ```bash
   mkdir build
   cd build
   ```

3. **Generate build files:**

   - To include GoogleMock (default):

     ```bash
     cmake ..
     ```

   - To build only GoogleTest (without GoogleMock):

     ```bash
     cmake .. -DBUILD_GMOCK=OFF
     ```

4. **Build the project:**

   On Linux/macOS:

   ```bash
   make
   ```

   On Windows with Visual Studio:

   Open the generated `.sln` file and build the solution.

5. **(Optional) Install to system paths:**

   ```bash
   sudo make install
   ```

### 1.2 Incorporating into Your Existing CMake Project

There are two primary approaches:

- **Using Installed Libraries:**

  If GoogleTest is installed on your system, import it with `find_package`:

  ```cmake
  find_package(GTest CONFIG REQUIRED)
  target_link_libraries(your_test_target GTest::gtest GTest::gmock)
  ```

- **Building as a Subdirectory:**

  Include GoogleTest and GoogleMock sources directly:

  ```cmake
  add_subdirectory(path/to/googletest)
  target_link_libraries(your_test_target gtest gmock)
  ```

> **Tip:** Using the subdirectory method ensures the same compiler/linker flags for all code components, avoiding compatibility issues.

### 1.3 Compiler and Runtime Settings

- Ensure your compiler supports **C++17** as GoogleTest requires it.
- To avoid runtime mismatch errors on Visual Studio, use the `gtest_force_shared_crt` flag:

  ```cmake
  set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
  ```

- GoogleTest defaults to static C runtime linking. Adjust as needed for your project.

### 1.4 Using `gtest_main` and `gmock_main`

- Unless you need custom test entry points, link your test executables against `gtest_main` or `gmock_main` libraries:

  ```cmake
  target_link_libraries(your_test_target gtest_main gmock_main)
  ```

  These libraries provide a suitable `main()` function, saving you from writing one.

### 1.5 Controlling GoogleTest Macros

- To avoid macro name conflicts, define macros to rename GoogleTest assertion macros (e.g., `-DGTEST_DONT_DEFINE_TEST=1`).

### 1.6 Sample CMakeLists.txt snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

# Add GoogleTest as a subdirectory
add_subdirectory(third_party/googletest)

# Add your test executable
add_executable(my_test test.cpp)

# Link with GoogleTest and GoogleMock
target_link_libraries(my_test gtest_main gmock_main)

# Set C++ standard
set_target_properties(my_test PROPERTIES
  CXX_STANDARD 17
  CXX_STANDARD_REQUIRED ON
)

# Enable testing
enable_testing()
add_test(NAME my_test COMMAND my_test)
```

---

## 2. Integration with Bazel

GoogleTest and GoogleMock are fully supported by Bazel. When you use Bazel,
use the following:

- Use `cc_test` rules with appropriate `deps` pointing to the GoogleTest/GoogleMock targets.
- Refer to Bazel's `googletest` package documentation for up-to-date build rules.

This guide focuses more on CMake; for the latest Bazel instructions, see the Bazel documentation.

---

## 3. Integration with Other Build Systems

- When using other build systems (e.g., Makefiles, Ninja, Visual Studio directly), ensure you:

  - Include the GoogleTest and GoogleMock header directories.
  - Link against the compiled `gtest`, `gtest_main`, `gmock`, or `gmock_main` libraries.

- Pay careful attention to compiler flags and runtime library settings to avoid conflicts.

- For Visual Studio, link the appropriate `.lib` files and use `gtest_main`/`gmock_main` libraries for the `main()` function.

---

## 4. Embedded Platforms and Special Environments

GoogleTest includes special adaptations for embedded platforms such as ESP8266, ESP32, and NRF52 with Arduino:

- Entry points are mapped to `setup()` and `loop()` instead of `main()`.
- Initialization is handled via `testing::InitGoogleTest()` or `testing::InitGoogleMock()` inside the `setup()`.

Example for embedded usage (ESP32):

```cpp
extern "C" {
void setup() {
  testing::InitGoogleMock(); // Initializes GoogleMock and GoogleTest
}

void loop() {
  RUN_ALL_TESTS();
}
}
```

> **Note:** This behavior is auto-enabled by preprocessor detection and requires no manual changes unless custom setup is needed.

---

## 5. Troubleshooting Common Integration Issues

### Issue 1: Tests Not Discovering or Running

**Symptom:** Your tests compile but don't run or are not discovered.

**Solutions:**

- Ensure `RUN_ALL_TESTS()` is called exactly once in your executable.
- Confirm `testing::InitGoogleTest()` or `testing::InitGoogleMock()` is called before `RUN_ALL_TESTS()`.
- Verify the libraries linked include the `gtest_main` or `gmock_main` if you don't provide your own `main()`.

### Issue 2: Linker Errors on Symbols from GoogleTest or GoogleMock

**Symptom:** Undefined references to GoogleTest/GoogleMock symbols.

**Solutions:**

- Confirm that `-lgtest`, `-lgtest_main`, `-lgmock`, or `-lgmock_main` libraries are linked.
- Check library search paths and that the libraries were built correctly.
- For CMake, confirm `find_package(GTest)` or `add_subdirectory()` is set up properly.

### Issue 3: Runtime Library Mismatch (Visual Studio)

**Symptom:** Link errors complaining about different runtime libraries.

**Solutions:**

- Use the CMake option `gtest_force_shared_crt ON` to align runtime linkage.
- Align your project's runtime library setting with GoogleTest's.

### Issue 4: Macro Name Collisions

**Symptom:** Macro redefinition errors involving GoogleTest macros.

**Solutions:**

- Apply preprocessor flags to rename GoogleTest macros, such as `-DGTEST_DONT_DEFINE_TEST=1` and update your test code to use `GTEST_TEST`.

### Additional Tips

- Always build GoogleTest/GoogleMock with the same compiler and settings as your test code.
- When testing on multiple platforms, verify that platform-specific preprocessor detection is working by inspecting the build logs.

---

## 6. Best Practices for Integration

- Use `gtest_main` and `gmock_main` libraries when possible to avoid custom main() functions.
- Keep GoogleTest and GoogleMock versions consistent to avoid incompatibilities.
- Prefer embedding GoogleTest as a subproject in your build tree for tight integration.
- Automate test runs with your CI/CD pipeline by running test binaries built with GoogleTest/GoogleMock.

---

## 7. Resources & Further Reading

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) - Learn how to write basic tests.
- [GoogleMock Documentation](https://github.com/google/googletest/blob/main/googlemock/README.md) - Detailed guide on mocking.
- [CMake Build Instructions](https://github.com/google/googletest/blob/main/googletest/README.md#generic-build-instructions) - Official build guide.
- [GoogleTest FAQ](https://github.com/google/googletest/blob/main/docs/faq.md) - Questions on setup and usage.
- [Mocking and Setting Expectations Guide](https://github.com/google/googletest/blob/main/guides/core-testing-workflows/mocking-and-expectations.md) - Mocking best practices.

---