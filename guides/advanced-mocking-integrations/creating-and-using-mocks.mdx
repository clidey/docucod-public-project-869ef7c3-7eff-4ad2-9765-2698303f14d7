---
title: "Creating and Using Mocks"
description: "Learn to create mock classes with GoogleMock, set up expectations, and validate interactions. This guide features practical patterns for replacing dependencies, controlling side effects, and simulating error cases."
---

# Creating and Using Mocks with GoogleMock

Learn how to create mock classes with GoogleMock, configure expectations, and validate interactions effectively. This guide covers practical patterns for replacing dependencies, controlling side effects, and simulating error conditions, helping you harness the power of mocks in your C++ testing workflow.

---

## 1. Introduction to Mocks in GoogleMock

GoogleMock facilitates creating mock classes that simulate and control the behavior of dependencies in your C++ tests. Mocks allow you to:

- Replace real objects with controllable stand-ins.
- Specify how the mocks should be called (which methods, how often, with what arguments).
- Define how mocks respond, including return values and side effects.
- Assert correct usage and interaction patterns.

This page focuses exclusively on creating mock classes, setting expectations using `EXPECT_CALL`, configuring default behaviors with `ON_CALL`, and controlling uninteresting calls with different mock strictness.

---

## 2. Workflow Overview

### Task Description
Create mock classes for your interfaces or classes, set expectations on method calls, specify behaviors, and verify interactions to write reliable, maintainable tests.

### Prerequisites
- GoogleTest and GoogleMock installed and configured in your project.
- Familiarity with basic C++ and virtual functions.
- Understanding of test fixtures and test runners.

### Expected Outcome
By completing this guide, you will:
- Define mock classes using `MOCK_METHOD` macros.
- Employ `EXPECT_CALL` and `ON_CALL` to configure mock behavior.
- Use `NiceMock`, `NaggyMock`, and `StrictMock` wrappers to control uninteresting call handling.
- Apply best practices for specifying expectations and handling complex scenarios.

### Time Estimate
15-30 minutes to read and apply the basic examples.

### Difficulty Level
Intermediate—prerequisite understanding of C++ unit testing and mocking concepts recommended.

---

## 3. Creating Mock Classes

### Defining Mock Methods Using `MOCK_METHOD`

To mock an interface or class, inherit from it and declare mock methods in the public section using the `MOCK_METHOD` macro:

```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};
```

- The macro parameters specify the return type, method name, argument types, and optional qualifiers (`const`, `override`, `noexcept`, etc.).
- Always declare mock methods in the `public:` section to allow the mocking framework to access them.
- If your method signature contains commas in types (e.g., templates), wrap the type in parentheses or define a type alias.

### Mocking Overloaded Methods

You can mock all overloads by specifying each fully. Use `using BaseClass::MethodName;` where needed to prevent hiding non-mocked overloads.

### Mocking Non-Virtual Methods

For non-virtual methods, mock classes can implement similarly but aren’t polymorphic replacements. Use template-based dependency injection to substitute between real and mock classes.

### Support for Move-Only Types

GoogleMock supports mocking methods that take or return move-only types like `std::unique_ptr<T>`. Use lambdas or `Return` with `std::move` in actions to handle them properly.

---

## 4. Setting Expectations and Behaviors

### `EXPECT_CALL`: Setting Call Expectations

Use `EXPECT_CALL(mock_object, Method(args))` to specify that the method should be called with specific arguments, possibly a number of times, and optionally specify what happens when called.

```cpp
EXPECT_CALL(mock_foo, DoThis())
    .Times(1)
    .WillOnce(Return());
```

### Expectations Syntax and Modifiers

You can chain clauses:

```cpp
EXPECT_CALL(mock, Method(matchers...))
    .With(multi_arg_matcher)    // optional, only once
    .Times(cardinality)         // optional, only once
    .InSequence(sequences...)   // can appear multiple times
    .After(expectations...)     // can appear multiple times
    .WillOnce(action)           // can appear multiple times
    .WillRepeatedly(action)     // at most once
    .RetiresOnSaturation();     // at most once, last clause
```

Key points:
- If `Times()` is omitted, GoogleMock infers it from the WillOnce/WillRepeatedly usage.
- Use matchers like `_` (any value) or more specific ones to match arguments.
- Specify sequences or order through `InSequence` or `After`.

### `ON_CALL`: Setting Default Behaviors

Configure default behavior for methods without asserting an expectation that the method must be called, e.g.: 

```cpp
ON_CALL(mock_foo, DoThis())
    .WillByDefault(Return(true));
```

This impacts calls that do not have a matching `EXPECT_CALL`.

### Controlling Uninteresting Calls

- By default, calls not covered by `EXPECT_CALL` emit warnings.
- Use `NiceMock<T>` to suppress these warnings.
- Use `StrictMock<T>` to treat uninteresting calls as test failures.
- Use `NaggyMock<T>` to emit warnings explicitly (default behavior).

Example:

```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
NaggyMock<MockFoo> naggy_mock;
```

This affects debugging verbosity and test strictness regarding unexpected calls.

---

## 5. Practical Examples

### Defining a Simple Mock Class

```cpp
class Foo {
 public:
  virtual ~Foo() = default;
  virtual void DoThis() = 0;
  virtual int DoThat(bool flag) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};
```

### Setting Basic Expectations

```cpp
MockFoo mock;
EXPECT_CALL(mock, DoThis())
    .Times(1);
EXPECT_CALL(mock, DoThat(true))
    .WillOnce(Return(42));

// Exercise code using mock ...
mock.DoThis();
int result = mock.DoThat(true);
EXPECT_EQ(result, 42);
```

### Using `NiceMock` to Suppress Warnings on Uninteresting Calls

```cpp
NiceMock<MockFoo> nice_mock;
// No EXPECT_CALL for DoThis()
nice_mock.DoThis();  // No warning
```

### Sequencing Calls

```cpp
using ::testing::InSequence;
{
  InSequence seq;
  EXPECT_CALL(mock, DoThis());
  EXPECT_CALL(mock, DoThat(true));
}
// Calls must happen in order
mock.DoThis();
mock.DoThat(true);
```

### Using `ON_CALL` for Default Action

```cpp
ON_CALL(mock, DoThat(_))  // All calls to DoThat default to returning -1
    .WillByDefault(Return(-1));
```

### Handling Methods that Return Non-default Constructible Types

You must specify an action or the call will throw or crash:

```cpp
EXPECT_CALL(mock, ReturnNonDefaultConstructible())
    .WillOnce(Return(NotDefaultConstructible(5)));
```

### Delegating to a Fake or Real Implementation

See the [gMock Cookbook section on Delegating](https://google.github.io/googletest/gmock_cook_book.html#DelegatingToFake) for patterns to delegate mock calls to real or fake implementations when appropriate.

---

## 6. Best Practices and Tips

- **Use `ON_CALL` for common default behavior**, and `EXPECT_CALL` only where you want to explicitly verify calls.
- **Prefer `NiceMock` for most tests** to reduce noise.
- Use `StrictMock` when you want to force strict verification of no unexpected calls.
- When mocking overloaded methods, specify argument types to disambiguate.
- Always define a virtual destructor in base classes to avoid deleting mocks incorrectly.
- Use `.RetiresOnSaturation()` with multiple expectations to avoid sticky expectations causing failures.
- For complex sequences or partial orders, use `Sequence` and `.After()` clauses.
- To mock methods with move-only types, use lambdas and custom actions instead of `Return` with moved values.
- Avoid mocking free functions directly; wrap them in interfaces instead.

---

## 7. Troubleshooting Common Issues

- **Warning about uninteresting calls:** This means a method was called without an expectation. Use `NiceMock` or add a catch-all `EXPECT_CALL` with `Times(AnyNumber())` to suppress.
- **Undefined behavior if `EXPECT_CALL` set after calls:** Always set expectations **before** invoking the mock method.
- **Crashes when deleting mocks:** Check that the base class has a virtual destructor.
- **Missing calls or wrong arguments:** Use `--gmock_verbose=info` to enable detailed call tracing output.
- **Confusing overload resolution:** Specify argument types explicitly or use `Const()` for const overloads.

---

## 8. Next Steps & Related Documentation

- [Defining and Using Mocks](reference/mocking.md) — detailed API reference on mocking macros and classes.
- [Matchers and Actions](guides/advanced-mocking-integrations/matching-and-actions-in-mocking.md) — How to write matchers and actions for fine-grained behavior control.
- [gMock Cookbook](docs/gmock_cook_book.md) — Recipes for advanced use cases, delegation patterns, and best practices.
- [Setting Up Your Project](guides/getting-started-core-workflows/setup-your-project.md) — Integrate GoogleMock with CMake or Bazel.
- [Writing Your First Test](getting-started/first-steps-validation/write-your-first-test.md) — Introduces basic test writing with GoogleTest and GoogleMock.

---

## 9. Summary

Creating and using mocks in GoogleMock involves defining mock classes using `MOCK_METHOD`, setting call expectations with `EXPECT_CALL`, optionally setting default behaviors with `ON_CALL`, and managing uninteresting call handling via `NiceMock`, `NaggyMock`, or `StrictMock`. Following best practices in expectation management and mock class setup ensures maintainable and effective tests that capture meaningful interactions.

---

## Code Examples Summary

```cpp
// Mock class definition.
class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};

// Using EXPECT_CALL and ON_CALL
MockFoo mock;
ON_CALL(mock, DoThat(_)).WillByDefault(Return(-1));
EXPECT_CALL(mock, DoThis()).Times(1);

mock.DoThis();
int val = mock.DoThat(true);
EXPECT_EQ(val, -1);

// Using NiceMock to suppress warnings
NiceMock<MockFoo> nice_mock;
nice_mock.DoThis();  // No warning even if no EXPECT_CALL

// Using InSequence for ordered calls
using ::testing::InSequence;
{
  InSequence s;
  EXPECT_CALL(mock, DoThis());
  EXPECT_CALL(mock, DoThat(true));
}
mock.DoThis();
mock.DoThat(true);
```

---

## References
- `MOCK_METHOD` macro details: https://google.github.io/googletest/reference/mocking#macros
- `EXPECT_CALL` syntax and usage: https://google.github.io/googletest/reference/mocking#EXPECT_CALL
- NiceMock, NaggyMock, StrictMock: https://google.github.io/googletest/reference/mocking#NiceMock
- gMock Cookbook: https://google.github.io/googletest/gmock_cook_book.html

---

## Closing Note
To master mocks with GoogleMock, begin by defining simple mock classes, add expectations to verify interactions, and progressively incorporate advanced patterns like sequences, delegated actions, and strictness control to create robust, readable test suites.

---