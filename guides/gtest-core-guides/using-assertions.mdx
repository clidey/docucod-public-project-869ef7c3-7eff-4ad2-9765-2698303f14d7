---
title: "Using Assertions for Effective Validation"
description: "Learn how to use GoogleTest's wide assortment of assertions to validate code behavior. This page covers core, custom, and advanced assertions, as well as guidance on selecting fatal versus non-fatal failures to maximize test clarity and effectiveness."
---

# Using Assertions for Effective Validation

Learn how to use GoogleTest's wide assortment of assertions to validate code behavior. This guide covers core, custom, and advanced assertions, and explains how to choose between fatal and non-fatal failures to write clear, effective tests.

---

## 1. Understanding Assertions in GoogleTest

Assertions are the foundation of writing tests with GoogleTest. They verify expected conditions in your code and report success or failure accordingly. Each assertion comes in pairs:

- **`EXPECT_*` macros** produce *non-fatal failures*, allowing the current test function to continue running after failure.
- **`ASSERT_*` macros** produce *fatal failures*, aborting the current test function immediately on failure.

This distinction lets you balance test robustness and thoroughness — use `EXPECT_*` to collect multiple failures in one test, and `ASSERT_*` when continuing past a failure is nonsensical.

### Key Characteristics:
- Assertions can be customized with additional failure messages using the `<<` streaming operator.
- They report test failures with file and line information for easy debugging.

<Tip>
Use `ASSERT_*` only when it's unsafe or meaningless to continue testing after failure (e.g., dereferencing a null pointer).
Use `EXPECT_*` when you want to see all failures in a test run without premature abort.
</Tip>

## 2. Core Assertion Types

### 2.1 Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Checks that `condition` is `true`.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Checks that `condition` is `false`.

```cpp
EXPECT_TRUE(is_valid) << "Input should be valid";
ASSERT_FALSE(has_error) << "Unexpected error occurred";
```

### 2.2 Equality and Comparison

GoogleTest provides macros for binary comparisons:

| Macro        | Description                  |
|--------------|------------------------------|
| `EXPECT_EQ`  | `val1 == val2`               |
| `EXPECT_NE`  | `val1 != val2`               |
| `EXPECT_LT`  | `val1 < val2`                |
| `EXPECT_LE`  | `val1 <= val2`               |
| `EXPECT_GT`  | `val1 > val2`                |
| `EXPECT_GE`  | `val1 >= val2`               |

and their `ASSERT_` counterparts.

Example:

```cpp
ASSERT_EQ(computed_value, expected_value) << "Values differ";
EXPECT_LT(actual_size, max_size);
```

> **Note:** `EXPECT_EQ` and friends properly compare pointers and objects. For C strings, use string-specific assertions instead.

### 2.3 String Comparison

GoogleTest supports C strings and wide strings with these macros:

- `EXPECT_STREQ` / `ASSERT_STREQ`: strings are equal
- `EXPECT_STRNE` / `ASSERT_STRNE`: strings are not equal
- `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ`: equal ignoring case
- `EXPECT_STRCASENE` / `ASSERT_STRCASENE`: not equal ignoring case

```cpp
EXPECT_STREQ("hello", detected_text);
ASSERT_STRCASEEQ(wide_str1, wide_str2);
```

### 2.4 Floating-Point Comparisons

Because floating-point values rarely match exactly, GoogleTest offers:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`: approx. equal for `float` with 4 ULP tolerance
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`: approx. equal for `double` with 4 ULP tolerance
- `EXPECT_NEAR` / `ASSERT_NEAR`: equal within an absolute error bound

Example:

```cpp
EXPECT_FLOAT_EQ(result, 3.1415f);
ASSERT_NEAR(calculated_pi, 3.14, 0.01);
```

### 2.5 Exception Assertions

Verify that code throws or does not throw exceptions:

- `EXPECT_THROW(stmt, ExceptionType)` / `ASSERT_THROW` - throws specific type
- `EXPECT_ANY_THROW(stmt)` / `ASSERT_ANY_THROW` - throws any exception
- `EXPECT_NO_THROW(stmt)` / `ASSERT_NO_THROW` - does not throw

```cpp
EXPECT_THROW(Parse(nullptr), std::invalid_argument);
EXPECT_NO_THROW(Parse(valid_input));
```

### 2.6 Explicit Success and Failure

For cases driven by control flow:

- `SUCCEED()` — records a success (rarely needed)
- `FAIL()` — records a fatal failure, aborting the function
- `ADD_FAILURE()` — records a nonfatal failure, continues

```cpp
if (unexpected_case) {
    FAIL() << "This code path should be unreachable";
}
```

### 2.7 Using Matchers: `EXPECT_THAT` and `ASSERT_THAT`

GoogleTest supports rich, expressive assertions using matchers for complex validations.

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
ASSERT_THAT(value, AllOf(Gt(0), Lt(10)));
```

Matchers allow natural language style assertions and generate informative failure messages.

## 3. Advanced Assertion Techniques

### 3.1 Predicate Assertions

When `EXPECT_TRUE()` is not descriptive enough, use predicate assertions.

- `EXPECT_PRED1(pred, val1)` to `EXPECT_PRED5(pred, val1, ..., val5)` where `pred` returns `bool`.
- `EXPECT_PRED_FORMATn` versions where the predicate returns an `AssertionResult` that controls the failure message.

Example:

```cpp
bool IsPrime(int n) { ... }
EXPECT_PRED1(IsPrime, number);
```

Or with a custom formatter:

```cpp
AssertionResult IsEven(const char* expr, int n) {
  if ((n % 2) == 0) return AssertionSuccess();
  return AssertionFailure() << expr << " is odd: " << n;
}
EXPECT_PRED_FORMAT1(IsEven, value);
```

### 3.2 Adding Custom Failure Messages

You can add additional context or detail by streaming messages:

```cpp
EXPECT_EQ(result, expected) << "Unexpected result for input: " << input;
```

This custom message appears appended to the assertion failure output.

### 3.3 Using `SCOPED_TRACE` for Contextual Information

If failures happen in deeply nested helper functions or loops, use `SCOPED_TRACE` to add contextual breadcrumbs:

```cpp
SCOPED_TRACE("While testing edge cases");
RunComplexValidation();
```

%%Annotation%% This trace message appears on failure to help identify invocation context.

### 3.4 Propagating Fatal Failures Across Helper Functions

Fatal failures abort only the current function — they do *not* throw exceptions by default.

Use:

- `ASSERT_NO_FATAL_FAILURE(statement);` to assert that `statement` does not generate any new fatal failures.
- Check `::testing::Test::HasFatalFailure()` to detect if a previous fatal failure occurred and conditionally abort.

## 4. Guidance on Usage

### 4.1 Choosing Fatal vs. Nonfatal Assertions

- Use `ASSERT_*` when failure makes continuing the test unsafe or meaningless, e.g., null pointer dereference.
- Use `EXPECT_*` to continue testing multiple aspects even after failure, improving feedback.

### 4.2 Streaming Failure Messages

Provide descriptive failure messages to clarify the context.

```cpp
EXPECT_EQ(size, expected_size) << "Size mismatch on vector XYZ";
```

### 4.3 Comparing String Values

When comparing strings, prefer string-specific macros (e.g., `EXPECT_STREQ` for C strings) rather than `EXPECT_EQ` to get value-based comparison instead of pointer equality.

### 4.4 Floating-Point Comparisons

Use specialized floating-point assertions to avoid problems with rounding errors.

### 4.5 Testing Exceptions

Verify thrown exceptions precisely with `EXPECT_THROW` or variants.

### 4.6 Skip Execution Early

You can skip tests when preconditions are not met with `GTEST_SKIP()`, optionally streaming a message.

```cpp
if (!IsDatabaseAvailable()) {
  GTEST_SKIP() << "Database not available, skipping test";
}
```

## 5. Examples

### 5.1 Basic Assertion

```cpp
TEST(MathTest, SquareRoot) {
  double result = sqrt(4.0);
  EXPECT_DOUBLE_EQ(result, 2.0) << "sqrt(4.0) should be 2.0";
}
```

### 5.2 Custom Predicate Using `AssertionResult`

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}

TEST(NumberTest, EvenCheck) {
  int x = 3;
  EXPECT_PRED_FORMAT1(IsEven, x);
}
```

Expected failure output:

```
Value of: IsEven(x)
  Actual: false (3 is odd)
Expected: true
```

### 5.3 Using `SCOPED_TRACE`

```cpp
void CheckValues(int x) {
  SCOPED_TRACE("CheckValues called with x=" + std::to_string(x));
  EXPECT_GT(x, 0);
  EXPECT_LT(x, 10);
}

TEST(MyTestSuite, ValuesTest) {
  for (int i = -1; i <= 11; ++i) {
    CheckValues(i);
  }
}
```

Failure messages will include trace indicating the failed iteration.

## 6. Troubleshooting & Pitfalls

### 6.1 Fatal Assertions in Non-Void Functions

Fatal assertions (`ASSERT_*`, `FAIL()`) can only be used in `void` functions. Using them in non-void functions causes cryptic compile errors.

<Tip>
Refactor your functions to return `void` or use `EXPECT_*` variants if you must use assertions in non-void functions.
</Tip>

### 6.2 Evaluation Order & Side Effects

All assertion macro arguments are evaluated exactly once, but order is unspecified.

<Tip>
Avoid side effects in assertion arguments to prevent confusing bugs.
</Tip>

### 6.3 Multiple Assertions on Same Line

Multiple death assertions on the same line cause compilation errors. Split them across lines.

### 6.4 Assertions in Constructors/Destructors

Fatal assertions cannot be used in constructors or destructors.

<Tip>
Use `SetUp()` and `TearDown()` methods of test fixtures instead.
</Tip>

## 7. Next Steps & Related Content

- Explore [Writing Your First Test](./write-first-test.md) to see assertions in action.
- Learn about [Matchers](../api-reference/core-testing-apis/matchers.md) for expressive validation.
- Check advanced assertion patterns in the [Advanced Guide](../advanced.md#more-assertions).
- Understand test execution and output in [Running and Interpreting Your Tests](./running-tests.md).
- Review [Common Assertion Macros](./reference/assertions.md) for complete syntax and options.

---

## References

- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [Using Predicates and Predicate Formatters](https://github.com/google/googletest/blob/main/docs/advanced.md#more-assertions)
- [Matchers API](../api-reference/core-testing-apis/matchers.md)
- [Writing and Organizing Tests](./writing-tests.md)

---

This documentation page teaches you how to use GoogleTest assertions effectively to validate your code, improve test diagnosis, and produce meaningful feedback during test runs.