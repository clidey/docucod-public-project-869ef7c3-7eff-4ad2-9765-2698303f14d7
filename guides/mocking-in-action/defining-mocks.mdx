---
title: "Defining and Using Mock Classes"
description: "Hands-on guide to creating mock classes with GoogleMock, covering the use of the MOCK_METHOD macros and how to declare mock methods for various C++ signatures. Explains best practices in mocking and method documentation."
---

# Defining and Using Mock Classes with GoogleMock

This hands-on guide walks you through creating mock classes in GoogleTest using GoogleMock. You'll learn how to declare mock methods with the `MOCK_METHOD` macros for various C++ signatures, best practices for defining and locating mock classes, and how to set behavior expectations in tests. Follow along with practical examples that demonstrate how to mock interfaces, overloads, const methods, and more.

---

## 1. Introduction to Mock Classes

### What Is a Mock Class?

Mock classes simulate the behavior of real interfaces or classes in your tests. They allow you to:

- Verify interactions (what methods were called, how often, with what arguments)
- Control method behavior to simulate various scenarios (return values, side effects)
- Remove dependencies on expensive or unreliable external components

GoogleMock automates building mock classes through macros, saving you from tedious manual mocking.

### Why Use GoogleMock Mock Classes?

- Saves time and prevents errors in writing mocks.
- Supports a rich range of method signatures, including overloaded and template methods.
- Automatically verifies expectations on mock usage.
- Provides expressive syntax for setting up call expectations and default behaviors.

---

## 2. Defining Mock Classes

### Basic Syntax using `MOCK_METHOD`

- Declare mock methods inside mock classes with `MOCK_METHOD` macros.
- Use this macro in the `public:` section regardless of base class access.


```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

**Key points:**

- The first argument is the return type.
- The second argument is the method name.
- The third is a tuple of argument types.
- The optional fourth parameter includes qualifiers like `const` or `override`.

### Handling Commas in Complex Signatures

When method arguments or return types contain commas (e.g., templated types), wrap the type in parentheses or define a type alias:

```cpp
// Using parentheses
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

// Using type aliases
using BoolInt = std::pair<bool, int>;
MOCK_METHOD(BoolInt, GetPair, ());

using MapIntDouble = std::map<int, double>;
MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
```

### Mocking Overloaded Methods

Simply mock each overload separately using the proper signatures:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int Add(int x);
  virtual int Add(int times, int x);
  virtual int& GetBar();
  virtual const int& GetBar() const;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(int&, GetBar, (), (override));
  MOCK_METHOD(const int&, GetBar, (), (const, override));
};
```

To avoid hiding base class overloads, use `using` declarations:

```cpp
class MockFoo : public Foo {
 public:
  using Foo::Add;  // Bring all base Add overloads into scope
  MOCK_METHOD(int, Add, (int x), (override));
};
```

### Mocking Const Methods

Add `const` as a qualifier:

```cpp
MOCK_METHOD(int, GetX, (), (const, override));
```

### Mocking Template Classes

Define mocks just like normal classes:

```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const T& x) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

### Mocking Non-Virtual Methods

GoogleMock supports mocking non-virtual methods with the same syntax but without `override`:

```cpp
class Concrete {
 public:
  void Foo();
};

class MockConcrete {
 public:
  MOCK_METHOD(void, Foo, ());  // no override
};
```

This is useful in high-performance dependency injection where the mock does not inherit from the real class.

### Where to Place Mock Classes

- Typically within `_test.cc` files if you own the interface.
- If mocking interfaces owned by others, place mocks in dedicated `.h`/`.cc` in testing subdirectories with `testonly=True`.
- Alternatively, define thin adaptor interfaces over third-party classes for easier mocking.

---

## 3. Using Mock Classes in Tests

### Typical Use Workflow

1. Import `testing` namespace symbols you intend to use.
2. Create mock object instances.
3. Define expectations on methods using `EXPECT_CALL`.
4. Exercise the system under test that interacts with mocks.
5. GoogleMock automatically verifies expectations at mock destruction.

Example:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;

class Painter {
 public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}
  bool DrawCircle(int x, int y, int radius) {
    turtle_->PenDown();
    // ... other drawing logic ...
    return true;
  }
 private:
  Turtle* turtle_;
};

TEST(PainterTest, CanDrawSomething) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

### Setting Expectations with `EXPECT_CALL`

Syntax:

```cpp
EXPECT_CALL(mock_obj, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- Define expected calls and constraints on arguments.
- Use matchers like `_` (wildcard), `Eq(value)`, `Ge(value)` to specify argument expectations.
- Control call count with `Times()` using predefined cardinalities like `AtLeast(n)`, `Exactly(n)`, or omit to infer cardinality.
- Define return or side effects with `WillOnce()` / `WillRepeatedly()`.

### Common Matchers

- `_`: matches anything
- `Eq(value)`: equals `value`
- `Ge(value)`: greater or equal
- `Pointee(matcher)`: dereferences pointer argument and applies matcher

### Order and Sequencing

- By default, calls can happen in any order.
- Use `InSequence` to enforce call order.


```cpp
using ::testing::InSequence;
{
  InSequence seq;
  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

### Common Pitfalls

- All expectations must be set _before_ exercising mock.
- Setting expectations after invoking mocks leads to undefined behavior.
- Mock destructors are verified automatically; leaks can suppress verification.

### Handling Uninteresting Calls

- Methods without expectations that are called emit warnings (naggy behavior).
- Use `NiceMock<MockTurtle>` to suppress warnings.
- Use `StrictMock<MockTurtle>` to treat unexpected calls as errors.

---

## 4. Best Practices and Tips

- Mock only interfaces or classes you own; respect ownership boundaries.
- Use adaptors to wrap external classes for easier mocking and encapsulation.
- Choose the right type of mock (`NiceMock`, `NaggyMock`, `StrictMock`) based on your test's tolerance for unexpected calls.
- Set broad `EXPECT_CALL` with wildcard `_` and `Times(AnyNumber())` as catch-alls to allow other calls.
- Prefer `ON_CALL` for setting default behaviors when call count isnâ€™t relevant.
- Use matchers sparingly to avoid brittle tests. Match only what matters.
- Use sequences to specify call order when required, but avoid over-constraining order.
- When mocking overloaded methods, specify the exact signature or use disambiguation helpers.
- For complex actions or side effects, consider using lambdas or custom actions.

---

## 5. Troubleshooting Common Issues

### Mock Method Invokes Real Method

Ensure methods being mocked are virtual. Non-virtual methods can't be overridden unless using advanced techniques.

### Warning: Uninteresting Mock Function Call

This means a mock method without expectations is called. Use `NiceMock` to suppress warnings or add catch-all `EXPECT_CALL`.

### Multiple Expectation Failures

GoogleMock prints errors for each failure point. Review failure stack traces carefully.

### Over-specifying Expectations

Set expectations only when necessary. Over-constraining can lead to brittle, hard-to-maintain tests.

### Virtual Destructor Missing

Mocks of interfaces must have their destructors declared `virtual` to avoid issues like memory leaks and partial destruction.

### Test Times Out or Hangs

Check for asynchronous behavior. Use synchronization mechanisms with mock actions if needed.

---

## 6. Additional Usage Examples

### Setting Multiple Return Values

Returns different values for consecutive calls:

```cpp
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));
```

### Expecting Calls a Specific Number of Times

Call exactly twice:

```cpp
EXPECT_CALL(turtle, GoTo(0, 0))
   .Times(2);
```

### Combining Matchers

Expect forward movement greater than or equal to 100:

```cpp
EXPECT_CALL(turtle, Forward(Ge(100)));
```

### Partial Ordering with Multiple Sequences

```cpp
Sequence s1, s2;
EXPECT_CALL(a, Run()).InSequence(s1);
EXPECT_CALL(b, Jump()).InSequence(s2);
EXPECT_CALL(c, Stop()).InSequence(s1, s2);
```

---

## 7. Next Steps & Related Documentation

- Explore **Sample Workflows & Use Cases** for practical step-by-step examples.
- Dive into **Setting Expectations and Verifying Interactions** for nuanced usage of `EXPECT_CALL`.
- Learn advanced features in **Advanced Mocking Techniques**.
- Understand the conceptual basis with **Mock Objects Concepts and Use Cases**.

---

## References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) â€” Beginner-friendly introduction to mocking.
- [Mocking Reference](../api-reference/mocking-api/mock-class-macros.md) â€” Detailed reference on macros and classes.
- [Actions Reference](../docs/reference/actions.md) â€” List and examples of built-in mock actions.
- [Matchers Reference](../docs/reference/matchers.md) â€” Available matchers for argument validation.
- [Using Test Fixtures for Reusable Setups](/guides/core-workflows/using-fixtures) â€” Learn how to prepare test environments.

---

For complete API details and source code examples, view the GoogleMock repository on [GitHub](https://github.com/google/googletest).

---

*This guide empowers you to confidently define and use mock classes in C++ tests using GoogleMock, streamlining complex testing scenarios with expressive, maintainable, and reliable test code.*