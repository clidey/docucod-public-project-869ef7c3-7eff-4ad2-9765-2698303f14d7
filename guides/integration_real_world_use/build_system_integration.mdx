---
title: "Integrating with Build Systems"
description: "Step-by-step guides for incorporating GoogleTest and GoogleMock into modern build systems such as CMake and Bazel, ensuring smooth test builds and executions in diverse environments."
---

# Integrating with Build Systems

GoogleTest and GoogleMock are designed to smoothly fit into modern C++ build environments, enabling efficient and reliable testing workflows. This guide walks you through incorporating GoogleTest and GoogleMock into popular build systems like CMake and Bazel, helping you set up, build, and run your test suites seamlessly.

---

## Workflow Overview

- **Task Description**: Learn how to integrate GoogleTest and GoogleMock into your project's build system to automate test compilation and execution.
- **Prerequisites**: 
  - Familiarity with your build system (CMake or Bazel).
  - GoogleTest source code available or installed.
  - A C++17 compatible compiler.
- **Expected Outcome**: Your project will automatically build and link GoogleTest/GoogleMock and your tests, enabling simplified test execution and continuous integration.
- **Time Estimate**: 20–40 minutes depending on familiarity with build tools.
- **Difficulty Level**: Intermediate

---

## Step-by-Step Integration Instructions

### 1. Integrating GoogleTest with CMake

GoogleTest provides a community-supported CMake build script that you can either build standalone or include directly in your project.

#### a) Standalone Build

1. Clone the repository:

   ```bash
   git clone https://github.com/google/googletest.git -b main
   cd googletest
   ```

2. Create and move to a build directory:

   ```bash
   mkdir build && cd build
   ```

3. Generate build files using CMake (includes GoogleMock by default):

   ```bash
   cmake ..
   ```

4. Compile:

   ```bash
   make
   ```

5. Optionally, install system-wide (requires admin privileges):

   ```bash
   sudo make install
   ```

   This makes libraries and headers available globally, enabling `find_package` in CMake for simpler linking.

#### b) Using GoogleTest within Your Existing CMake Project

You can integrate GoogleTest inside your project’s build for consistent compiler and linker settings.

##### Option 1: Add as Subdirectory

- Download GoogleTest source code or add as a git submodule within your project.
- In your `CMakeLists.txt`, add:

   ```cmake
   add_subdirectory(path/to/googletest)

   add_executable(your_tests test_main.cpp your_tests.cpp)
   target_link_libraries(your_tests PRIVATE gtest_main gmock)

   enable_testing()
   add_test(NAME your_test_command COMMAND your_tests)
   ```

##### Option 2: Use FetchContent to Download Automatically

- Add this to your `CMakeLists.txt`:

   ```cmake
   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/main.zip
   )
   FetchContent_MakeAvailable(googletest)

   add_executable(your_tests test_main.cpp your_tests.cpp)
   target_link_libraries(your_tests PRIVATE gtest_main gmock)

   enable_testing()
   add_test(NAME your_test_command COMMAND your_tests)
   ```

- Requires CMake 3.14 or newer.

##### Linking Notes

- `gtest_main` and `gmock_main` include a ready-made `main()` function. Link with them unless you provide your own `main()`.
- Link both GoogleTest (`gtest`) and GoogleMock (`gmock`) if using mocks.

#### c) Compiler and Runtime Compatibility

- GoogleTest requires C++17 support.
- To avoid runtime mismatches on Windows, consider setting `gtest_force_shared_crt` to ON in CMake.
- If using GoogleTest as a shared library, define `-DGTEST_CREATE_SHARED_LIBRARY=1` while building.

---

### 2. Integrating GoogleTest and GoogleMock with Bazel

Bazel users integrate GoogleTest/GoogleMock by importing rules and dependencies.

1. Add the official googletest repository in your `WORKSPACE`:

   ```python
   http_archive(
       name = "com_google_googletest",
       urls = ["https://github.com/google/googletest/archive/release-1.17.0.zip"],
       strip_prefix = "googletest-release-1.17.0",
   )
   ```

2. In your `BUILD` file, link to the `gtest` and `gmock` targets:

   ```python
   cc_test(
       name = "your_test",
       srcs = ["your_test.cpp"],
       deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"],
   )
   ```

3. Write tests and run with:

   ```bash
   bazel test //path/to:your_test
   ```

4. Bazel automatically handles dependencies and builds.

---

## Practical Tips and Best Practices

- **Use `gtest_main` or `gmock_main` when possible**: Avoid writing your own `main()` unless you need custom initialization.
- **Match compiler flags**: Ensure your tests and GoogleTest are built with the same compiler flags to avoid linkage issues.
- **Enable Testing and Test Targets**: Always use `enable_testing()` in CMake and define test targets for your tests.
- **Use test filters**: During development, use `--gtest_filter` with GoogleTest executables for focused test runs.
- **For continuous integration**: Automate GoogleTest builds in your CI pipeline by invoking your build system’s test commands (`make test`, `ctest`, `bazel test`).

---

## Common Pitfalls and Troubleshooting

<AccordionGroup title="Build Issues and Solutions">
<Accordion title="Linker Errors" >
Linker errors like undefined symbols often stem from missing GoogleTest or GoogleMock libraries in your link command. Verify your target links `gtest`, `gmock`, and, if used, `gtest_main` or `gmock_main`.
</Accordion>
<Accordion title="Runtime Crashes" >
Crashes in tests often indicate ABI or compiler flag mismatches. Rebuild all dependencies with matching compiler flags and consistent runtime libraries.
</Accordion>
<Accordion title="Multiple main() Conflicts" >
When linking both `gtest_main` and `gmock_main`, link only one library that provides `main()`. Use `gmock_main` if using mocks, otherwise `gtest_main`.
</Accordion>
</AccordionGroup>

---

## Example: Minimal CMake Project Using GoogleTest

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyTestProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_example.cpp)
# Link to gtest_main and gmock for full mocking/testing support
target_link_libraries(my_tests PRIVATE gtest_main gmock)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

In `test_example.cpp`, write your tests as usual using GoogleTest and GoogleMock APIs.

---

## Example: Using Bazel to Run GoogleTest

```python
# WORKSPACE snippet
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.zip"],
    strip_prefix = "googletest-release-1.17.0",
)

# BUILD file snippet
cc_test(
    name = "sample_test",
    srcs = ["sample_test.cpp"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"],
)
```

Run with:

```bash
bazel test //:sample_test
```

---

## Next Steps & Related Documentation

- Explore the [Writing Your First Test](https://docs.example.com/guides/core_testing_workflows/writing_first_test) guide to start authoring GoogleTest cases.
- Learn to extend with mocks in [Using GoogleMock](https://docs.example.com/guides/core_testing_workflows/using_googlemock).
- For troubleshooting build and linking errors, see [Troubleshooting Common Issues](https://docs.example.com/getting-started/troubleshooting-validation/common-issues).
- Understand best practices for test discovery and execution in [Test Discovery and Execution](https://docs.example.com/guides/core_testing_workflows/test_discovery_execution).

---

<Tip>
Integrating GoogleTest and GoogleMock into your build system early in your project development saves time and effort by automating test builds and execution, laying the foundation for continuous testing and integration.
</Tip>

<Note>
For advanced CMake configurations, refer to the official [CMake integration instructions](https://github.com/google/googletest/blob/main/googletest/README.md).
</Note>