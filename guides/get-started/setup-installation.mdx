---
title: "Installation & Project Setup"
description: "Learn how to install GoogleTest and GoogleMock in C++ projects using supported tools like CMake and Bazel. Covers directory structure, dependencies, and minimal configuration for new and legacy codebases."
---

# Installation & Project Setup

Learn how to install GoogleTest and GoogleMock in C++ projects using supported tools like CMake and Bazel. This guide covers directory structure, dependencies, and minimal configuration for new and legacy codebases.

---

## Workflow Overview

### Task Description
This guide helps you integrate GoogleTest and GoogleMock into your C++ project, using build tools (primarily CMake) to set up, build, and link the testing frameworks. It ensures your environment is ready for writing and running tests with minimal configuration effort.

### Prerequisites
- A C++17-compliant compiler and environment.
- CMake (version 3.14 or later recommended).
- Git (optional, for cloning sources).
- Visual Studio on Windows, or make tools on *nix/macOS for native builds.

### Expected Outcome
By following this walkthrough, you will:
- Build GoogleTest and GoogleMock either standalone or embedded in your project.
- Configure your build system to use these libraries seamlessly.
- Prepare your project structure to support test code.

### Time Estimate
15â€“30 minutes depending on your familiarity with your build system.

### Difficulty Level
Beginner to Intermediate (depends on build system familiarity).

---

## Step-by-Step Instructions

### 1. Decide Your Installation Approach
You have two main options to bring GoogleTest and GoogleMock into your project.

- **Standalone Installation**: Build GoogleTest/GoogleMock as separate libraries you install system-wide or locally.
- **Embedded Build**: Incorporate GoogleTest source into your existing project build, allowing consistent compiler flags and debug/release compatibility.

### 2. Building GoogleTest/GoogleMock Standalone with CMake

```bash
# Clone the official repository at the desired release branch.
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest
mkdir build
cd build

# Generate build files for both GoogleTest and GoogleMock (default build)
cmake ..

# To build GoogleTest only, disable GoogleMock explicitly
# cmake .. -DBUILD_GMOCK=OFF

# Build the libraries
make

# If you have admin rights and want to install it system-wide
sudo make install
```

- On Windows with Visual Studio installed, `cmake ..` in the build directory creates a `.sln` solution file for you to open and build.
- On macOS with Xcode installed, a `.xcodeproj` file is generated.

### 3. Incorporate GoogleTest/GoogleMock Into Your Existing CMake Project

If your project already uses CMake, you have flexible ways to include GoogleTest:

#### Method A: Find and Link Installed Libraries
Add the following to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(your_test_exe test.cpp)
target_link_libraries(your_test_exe GTest::gtest GTest::gmock GTest::gtest_main)
add_test(NAME your_test COMMAND your_test_exe)
```

This assumes GoogleTest is installed on the system.

#### Method B: Download and Build GoogleTest as Part of Your Build

Use CMake `FetchContent` to pull GoogleTest at configure time.

Add this to the top of your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # On Windows, to fix runtime issues
FetchContent_MakeAvailable(googletest)

add_executable(your_test_exe test.cpp)
target_link_libraries(your_test_exe gtest_main gmock_main)
add_test(NAME your_test COMMAND your_test_exe)
```

Advantages:
- Ensures compiler flags and linkage for your tests and GoogleTest are consistent.
- Automatically updates GoogleTest version if you change the URL or commit.

### 4. Understand Directory Structure

- `googletest/` contains GoogleTest source and include files.
- `googlemock/` contains GoogleMock source, include files, and test main.
- Your test source files usually reside outside these directories in your project's `tests/` or similar folder.

### 5. Handle C++ Standard and Platform Nuances

- GoogleTest requires at least C++17. Ensure you set this in your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- On Windows with Visual Studio, GoogleTest links runtimes statically (`MT`), but your project may link dynamically (`MD`), causing linker errors. Resolve by enabling the `gtest_force_shared_crt` option to make GoogleTest match your runtime linkage.

### 6. (Optional) Customizing Build Options

- To build GoogleTest as a shared library (DLL on Windows): add `-DGTEST_CREATE_SHARED_LIBRARY=1` to compiler flags.

- When using GoogleMock, initialize with `InitGoogleMock()` instead of just `InitGoogleTest()`.

### 7. Quick Verification

Ensure you can compile a simple test executable that links against GoogleTest and GoogleMock, run it and get successful test results.

Example minimal `test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, Example) {
  EXPECT_EQ(1, 1);
}

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Build and link using one of the methods above and run the test.

---

## Troubleshooting & Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Linker Errors on Windows (Runtime Mismatch)">
GoogleTest defaults to static CRT but your project may use dynamic CRT, causing linker errors like `mismatch detected for 'RuntimeLibrary'`.

**Solution:** Enable the CMake option `gtest_force_shared_crt` when configuring GoogleTest:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

This ensures GoogleTest uses the dynamic CRT.
</Accordion>

<Accordion title="C++ Standard Version Errors">
Ensure your compiler supports C++17 and that your CMake sets `CMAKE_CXX_STANDARD` to 17 or higher.

If you get errors related to missing C++17 features, double-check your build configuration.
</Accordion>

<Accordion title="Pthread Missing or Link Errors on *nix">
GoogleTest uses pthreads for thread safety. If link errors occur,

- Confirm pthread is installed on your system.
- When building manually, add `-pthread` or `-lpthread` flags.
- If using CMake, the GoogleTest CMake scripts handle this automatically.
</Accordion>

<Accordion title="GoogleTest Initialization Fails">
Make sure you call `testing::InitGoogleTest(&argc, argv);` before `RUN_ALL_TESTS()` in your `main()`.

If you use GoogleMock, call `testing::InitGoogleMock(&argc, argv);` instead.
</Accordion>
</AccordionGroup>

<Tip>
When embedding GoogleTest source directly into your project using `add_subdirectory()`, keep it updated regularly and verify compatibility with your compiler and platform. This avoids surprises caused by API or build changes.
</Tip>

<Tip>
If you want to build only GoogleTest without GoogleMock (for example, to reduce build time or dependencies), use the `-DBUILD_GMOCK=OFF` flag when configuring with CMake.
</Tip>

---

## Next Steps & Related Content

- Proceed to [Writing Your First Test](../get-started/writing-tests) to start authoring tests using GoogleTest.
- Explore [Introducing GoogleMock: Mocking in Practice](../get-started/mocking-basics) for using mocks in your tests.
- Consult [Supported Platforms & Requirements](../../getting-started/prerequisites-installation/supported-platforms-requirements) for environment details.
- Use [Running Tests](../../getting-started/first-test-validation/running-tests) to understand how to execute and interpret your test results.
- If issues arise, review [Troubleshooting Setup Issues](../../getting-started/first-test-validation/troubleshooting-setup) for diagnostics and fixes.

---

## References

- [GoogleTest README with CMake instructions](https://github.com/google/googletest/blob/main/googletest/README.md)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest Primer](../primer) (User guide)
- [GoogleMock for Dummies](../gmock_for_dummies) (Mocking beginners)

---

## Summary Diagram of Typical Setup with CMake

```mermaid
flowchart TD
  subgraph UserProject "Your Project"
    direction TB
    YourSource["src/ and test/ source files"]
    CMakeLists["CMakeLists.txt"]
    TestExe["Test Executable"]
  end

  subgraph GoogleTestRepo["GoogleTest + GoogleMock"]
    GoogletestSrc["googletest/src and include"]
    GooglemockSrc["googlemock/src and include"]
  end

  subgraph BuildSystem["Build Process"]
    CMakeConf["CMake Configuration"]
    Compiler["Compiler & Linker"]
  end

  YourSource -->|"add_executable"| TestExe
  CMakeLists -->|"includes and links"| TestExe

  CMakeConf --> GoogletestSrc
  CMakeConf --> GooglemockSrc
  CMakeConf --> TestExe
  Compiler --> TestExe

  TestExe -->|"links with"| GoogletestSrc
  TestExe -->|"links with"| GooglemockSrc

  click GoogletestSrc "googletest/README.md" "GoogleTest Build and Sources"
  click GooglemockSrc "googlemock/README.md" "GoogleMock Build and Sources"
```

---

# End of Guide
