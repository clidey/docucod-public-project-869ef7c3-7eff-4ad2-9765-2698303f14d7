---
title: "Integrating with Continuous Integration"
description: "Best practices for running GoogleTest suites in CI pipelines, handling flaky tests, result reporting, and test sharding. Includes strategies for maintaining reliable automation."
---

# Integrating with Continuous Integration

## Workflow Overview

GoogleTest is a powerful C++ testing framework widely used in automated environments. This guide focuses specifically on integrating GoogleTest suites into continuous integration (CI) pipelines. You will learn how to run test suites reliably, manage flaky tests, shard tests for faster execution, and report results effectively.


### Prerequisites
- Familiarity with GoogleTest basics, including writing and running tests.
- A working CI environment (e.g., Jenkins, GitHub Actions, GitLab CI) where you will run your GoogleTest suites.
- GoogleTest-based test binaries compiled and ready to execute in your CI environment.


### Expected Outcome
After completing this guide, you will be able to:
- Incorporate GoogleTest suites into your CI pipeline.
- Implement strategies to handle flaky or unreliable tests.
- Use test sharding to parallelize test execution for efficiency.
- Gather and report test results in common CI-friendly formats.


### Time Estimate
- Setup and integration: 1-2 hours (depending on your CI system)
- Optimization (flaky test handling, sharding, reporting): 2-4 hours


### Difficulty Level
Intermediate — assumes knowledge of automated testing and CI pipeline concepts.

---

## Running GoogleTest Suites in CI

1. **Build Your Test Binaries**
   - Ensure your build step produces GoogleTest executables.
   - It’s recommended to build with debug symbols and without optimization for more detailed test failure info.

2. **Invoke GoogleTest Executables in CI**
   - Run your test binary directly in CI using:
     ```bash
     ./your_test_binary
     ```
   - By default, this runs all registered tests.

3. **Control Test Execution via Flags**
   To customize which tests run and how results are output, leverage GoogleTest command-line flags:
   - `--gtest_filter` — Runs a subset of tests matching the pattern.
   - `--gtest_repeat` — Repeats the tests multiple times (helpful to detect flaky tests).
   - `--gtest_output=xml:<path>` — Outputs results in XML format for CI consumption.
   - `--gtest_color=no` — Disable colored output, useful for CI logs.

4. **Exit Codes for CI Automation**
   - GoogleTest returns 0 if all tests pass.
   - Returns 1 if any test fails.
   - Your CI should use this to mark job success or failure.


### Sample Invocation

```bash
./your_test_binary --gtest_output=xml:report.xml --gtest_color=no
```

This will run all tests, output an XML result file `report.xml`, and produce clean logs.

---

## Handling Flaky Tests

Flaky tests can cause intermittent CI failures and undermine confidence.

### Strategies:

- **Repeat Tests**
  Use the flag `--gtest_repeat=N` to run tests multiple times. If a test fails inconsistently, the pipeline can retry.

- **Isolate Flaky Tests**
  Identify flaky tests and isolate or disable them temporarily via `--gtest_filter` or by marking them disabled with the `DISABLED_` prefix in their test name.

- **Use Test Sharding (detailed below)** to reduce test interdependence.

- **Log More Information**
  Enhance flaky test debugging by adding verbose logging and detailed failure reports.


### Example: Retry flaky tests 3 times

```bash
./your_test_binary --gtest_repeat=3 --gtest_output=xml:report.xml
```

If failures occur on any repeat, the build fails.

---

## Test Sharding for Parallelization

Large test suites can be time-consuming. CI speed improves drastically by running tests in parallel shards.

### What Is Test Sharding?
It is dividing the test cases into N partitions (shards). Each shard runs independently.

GoogleTest offers built-in support with two flags:
- `--gtest_total_shards=N` — specifies the total number of shards.
- `--gtest_shard_index=I` — specifies the shard index to run (0-based).


### How to Use:
Consider you have 100 tests and want to split them into 5 shards.

Run 5 CI jobs, each with:

```bash
./your_test_binary --gtest_total_shards=5 --gtest_shard_index=<i>
```
where `<i>` goes from 0 to 4.

Each shard runs a disjoint subset of the tests.

### Benefits:
- Speeds up test runs by distributing load.
- Reduces global flakiness by isolating tests.

### Important Tips:
- Ensure shard count matches the number of CI executors.
- Export and aggregate test results from all shards for reporting.

---

## Reporting Test Results

Most CI tools consume JUnit-like XML reports.

### Generating XML Test Reports
Add the flag:

```bash
--gtest_output=xml:<path-to-xml>
```

Example:

```bash
./your_test_binary --gtest_output=xml:test_results.xml
```

The XML file can then be published in CI for test reporting and historical tracking.

### Additional Reporting Features
- Use GoogleTest listeners to generate custom reports if needed.
- Record custom test properties using `RecordProperty()` for enriched reporting.


---

## Putting It All Together: Example CI Snippet

```yaml
jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        shard: [0,1,2,3]
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: mkdir build && cd build && cmake .. && make
      - name: Run Tests Shard ${{ matrix.shard }}
        run: |
          ./build/your_test_binary \
            --gtest_total_shards=4 \
            --gtest_shard_index=${{ matrix.shard }} \
            --gtest_output=xml:shard_${{ matrix.shard }}_results.xml \
            --gtest_color=no
      - name: Upload Test Reports
        uses: actions/upload-artifact@v2
        with:
          name: test-report-shard-${{ matrix.shard }}
          path: shard_${{ matrix.shard }}_results.xml
```

This example parallelizes tests across 4 shards and collects separate XML reports.

---

## Troubleshooting & Best Practices

### Common Issues
- **Tests not running in shards:** Ensure `--gtest_total_shards` and `--gtest_shard_index` are set correctly and consistently.

- **XML files missing or incomplete:** Confirm output paths are writable and test binary exits normally.

- **Flaky tests undermining results:** Isolate flaky tests, analyze failure patterns, and consider manual stabilization.

- **Test names with problematic characters:** Be sure test names in parameterized tests use only alphanumeric characters and underscores for compatibility with filtering and reporting.

### Best Practices
- Always fail your CI when any test fails; avoid ignoring exit codes.
- Use `--gtest_repeat` during flaky test investigation.
- Run tests in shards that fit your CI parallelism capabilities.
- Use `RecordProperty()` within tests to add extra diagnostic info.
- Keep your test binaries and dependencies up-to-date.

---

## Summary
- Integrate GoogleTest by running test binaries in CI with relevant flags.
- Control test subsets and reporting via `--gtest_filter` and `--gtest_output`.
- Handle flaky tests by repeating and isolating problematic cases.
- Implement test sharding for parallel execution to reduce CI run times.
- Use XML reports for CI test result visibility.

---

## Resources & Related Documentation

- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — Basic concepts and test writing
- [GoogleTest Advanced Guide](advanced.md) — In-depth features and test configurations
- [Parameterized and Typed Tests](guides/writing-effective-tests/parameterized-typed-tests) — For sophisticated test design
- [C++ TestMate, GoogleTest Adapter](README.md) — Tools for running tests and viewing results
- [FAQ on CI Integration & Troubleshooting](faq/performance-integration-support/integration-ci-troubleshooting-faq) — Common issues and resolutions

---

Maintain reliable, efficient, and insightful automated testing within your CI pipelines by following these guidelines for GoogleTest integration. Your teams will gain confidence, speedy feedback, and clearer insights into test outcomes.

<Check>
Remember to always return the exit value of `RUN_ALL_TESTS()` in your main function so CI accurately reflects the test pass/fail status.
</Check>

<Info>
GoogleTest output XML files are compatible with many CI test report viewers, unlocking visual test dashboards.
</Info>

<Warning>
Do not disable test failures or ignore flaky tests indefinitely; this impacts software quality and trustworthiness.
</Warning>
