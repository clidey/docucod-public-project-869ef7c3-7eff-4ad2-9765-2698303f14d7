---
title: "Mocking Basics with GoogleMock"
description: "Demonstrates the workflow for mocking dependencies in unit tests, including how to define mock classes, set expectations, and verify interactions. Provides sample test cases reflecting real-world use."
---

# Mocking Basics with GoogleMock

This guide demonstrates the workflow for mocking dependencies in unit tests using GoogleMock. You will learn how to define mock classes that imitate real interfaces, set expectations on method calls, specify behaviors, and verify interactions with the mocks. Real-world test case examples illustrate typical usage patterns.

---

## 1. Introduction to Mocking Workflow

### What this Guide Helps You Achieve
- Learn how to create mock classes from interfaces that you want to mock in your unit tests.
- Understand setting expectations on method calls, including argument matching, call ordering, and call count.
- Gain confidence in verifying that your code interacts correctly with dependencies.
- See concrete sample tests that reflect practical scenarios.

### Prerequisites
- Familiarity with C++ and basic unit testing concepts.
- GoogleTest and GoogleMock installed and configured in your development environment.
- Understanding of virtual functions and interfaces in C++.

### Expected Outcome
By following this guide, you will be able to:
- Define mock classes with `MOCK_METHOD` macros.
- Use `EXPECT_CALL` and `ON_CALL` to specify expected calls and default behaviors.
- Use matchers to validate function call arguments.
- Control call sequences and invocation counts.
- Use GoogleMockâ€™s verification features effectively.

### Time Estimate
About 30 to 60 minutes to study and practice the basics, depending on your familiarity.

### Difficulty Level
Beginner to Intermediate.

---

## 2. Defining Mock Classes

### Creating a Mock Class

To mock an interface or abstract class:

1. Inherit your mock class from the interface.
2. Use `MOCK_METHOD` macros in the public section of your mock class to mock virtual methods.
3. If mocking const methods, specify `(const)` in the macro.
4. Add `override` specifier to ensure you correctly override base class methods.

Example:
```cpp
#include <gmock/gmock.h>  // Required for MOCK_METHOD

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Handling Complex Argument Types

If method arguments or return types contain commas (e.g., `std::pair<int, int>`), wrap those types in extra parentheses or create type aliases:
```cpp
using BoolIntPair = std::pair<bool, int>;
MOCK_METHOD(BoolIntPair, GetPair, (), (override));

// Or
MOCK_METHOD((std::pair<bool, int>), GetPair, (), (override));
```

### Mocking Overloaded Methods

Mock each overload separately, matching the signature exactly.

### Access for Protected or Private Methods

Always declare all mock methods in the public section of your mock class, even if the corresponding base class methods are protected or private.

---

## 3. Setting Expectations on Mocks

### `EXPECT_CALL` Syntax

Use `EXPECT_CALL` to specify what calls you expect the mock to receive:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- **`mock_object`**: Your mock instance.
- **`MethodName`**: The mocked method.
- **`matchers...`**: Patterns to match function arguments (e.g., `_` for anything, specific values, or complex matchers).
- **Modifiers**:
  - `.Times()` specifies number of expected calls.
  - `.WillOnce()` and `.WillRepeatedly()` specify behaviors/return values.

### Basic Example
```cpp
using ::testing::Return;

EXPECT_CALL(turtle, GetX())
    .Times(3)
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));
```
This expects 3 calls to `GetX()`, returning 10, then 20, then 30 for subsequent calls.

### Using Matchers

Matchers allow flexible argument specification. Common ones include:
- `_` matches anything.
- `Eq(val)` matches exactly `val`.
- `Ge(val)`, `Le(val)` for inequalities.
- `Not(matcher)`, `AllOf(...)`, `AnyOf(...)` for logical combinations.

Example:
```cpp
EXPECT_CALL(turtle, Forward(Ge(100)));  // Forward is called with argument >= 100
```

### Controlling Call Count

Use built-in cardinalities:
- `Times(AnyNumber())`
- `Times(Exactly(n))`
- `Times(AtLeast(n))`
- `Times(AtMost(n))`
- `Times(Between(m, n))`

Omitting `.Times()` defaults to expecting exactly one call, or the number of `WillOnce()`s defined.

### Controlling Call Order

Use:
- `InSequence` object to expect calls in strict sequence.
- `.InSequence(sequence1, sequence2, ...)` on expectations to specify partial ordering.
- `.After(expectation1, expectation_set)` to specify that this call happens after others.

Example:
```cpp
using ::testing::InSequence;
{
  InSequence s;
  EXPECT_CALL(mock, Reset());
  EXPECT_CALL(mock, Start());
}
```

### Specifying Call Behaviors

Use `WillOnce()` and `WillRepeatedly()` to define what your mock method should do.

Examples:
```cpp
EXPECT_CALL(mock, GetValue())
    .WillOnce(Return(42));

EXPECT_CALL(mock, IsReady())
    .WillRepeatedly(Return(true));
```
You can also use lambdas or callable objects:
```cpp
EXPECT_CALL(mock, Compute(_, _))
    .WillOnce([](int a, int b) { return a + b; });
```

### Suppressing Warnings for Uninteresting Calls

If you only want to specify some expectations but allow others without warnings:
- Use `ON_CALL` to define default behavior.
- Use `NiceMock<MockClass>` to suppress warnings on unexpected calls.

---

## 4. Sample Test Case Flow

### Define Your Mock

```cpp
class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (), (override));
  MOCK_METHOD(std::string, GetData, (int id), (override));
};
```

### Write Your Test

```cpp
TEST(MyComponentTest, ReturnsDataFromDb) {
  MockDatabase mock_db;

  // Setup default behavior
  ON_CALL(mock_db, Connect()).WillByDefault(Return(true));
  ON_CALL(mock_db, GetData(_)).WillByDefault(Return("default"));

  // Expect interaction
  EXPECT_CALL(mock_db, Connect()).Times(1);
  EXPECT_CALL(mock_db, GetData(42))
    .WillOnce(Return("Answer"));

  MyComponent component(&mock_db);

  EXPECT_TRUE(component.Initialize());
  EXPECT_EQ("Answer", component.FetchData(42));
}
```

### Run and Verify

- GoogleMock will automatically verify all expectations at test completion.
- If mismatches occur in call count, argument matching, or order, detailed errors are raised.

---

## 5. Best Practices & Tips

- **Declare all mocks in public:** Always place `MOCK_METHOD` declarations in the public section.
- **Use `override`:** Helps catch signature mismatches.
- **Use matchers judiciously:** Don't over-specify argument expectations to reduce test brittleness.
- **Use `ON_CALL` for default behaviors:** Use `EXPECT_CALL` sparingly to verify interactions explicitly.
- **Use `InSequence` or `.After()` for ordering:** Makes tests more precise on call order.
- **Suppress unnecessary warnings with `NiceMock`:** Helps reduce noise.
- **Retire expectations when appropriate:** Use `.RetiresOnSaturation()` to avoid sticky expectations causing failures after saturation.
- **Use meaningful test names:** to describe what you are verifying.

---

## 6. Troubleshooting

### Common Issues

- **Method not mocked (real method called):** Verify the method is virtual and properly mocked with `MOCK_METHOD`.
- **Overloaded method ambiguities:** Explicitly specify mock signatures for all overloads.
- **Uninteresting call warnings:** Use `ON_CALL`, add catch-all `EXPECT_CALL`, or use `NiceMock`.
- **Mismatch in call order:** Use `InSequence` to enforce strict order or `After` clauses.
- **Failure to verify expectations:** Make sure mock objects are destroyed or `Mock::VerifyAndClearExpectations()` is called.
- **Compilation slow:** Declare mock class constructors and destructors outside header files.

### Tips

- Run tests with `--gmock_verbose=info` to get detailed trace of mock calls.
- Use GoogleTest assertions to check mock method results.
- Avoid setting expectations after mock methods have been called.

---

## 7. Next Steps & Related Content

- Explore [Mocking Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced mocking techniques.
- Review [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) for argument matching.
- Dive into [Actions Reference](https://google.github.io/googletest/reference/actions.html) for custom mock behaviors.
- For overall integration, see [Getting Started with GoogleTest](../getting-started/).
- Learn about [Writing Your First Test](../getting-started/first-test-and-validation/writing-your-first-test) to put mocks in context.

---

<AccordionGroup title="Example: Complete Mocking Workflow">
<Accordion title="Mock Class Definition">
```cpp
#include <gmock/gmock.h>

class MockLogger {
 public:
  MOCK_METHOD(void, Log, (int severity, const std::string& message), (override));
};
```
</Accordion>
<Accordion title="Using the Mock in a Test">
```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::AtLeast;
using ::testing::Return;

TEST(LoggerTest, LogsWarnings) {
  MockLogger mock_logger;

  EXPECT_CALL(mock_logger, Log(2, _))  // Severity 2 (warning)
      .Times(AtLeast(1));

  MyModule module(&mock_logger);
  module.DoSomethingThatLogsWarnings();
}
```
</Accordion>
</AccordionGroup>

---