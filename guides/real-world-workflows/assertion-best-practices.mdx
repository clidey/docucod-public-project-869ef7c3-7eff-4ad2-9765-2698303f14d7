---
title: "Mastering Assertions and Matchers"
description: "Teaches users to leverage the rich set of built-in assertions and powerful custom matchers in GoogleTest and GoogleMock. Focuses on writing expressive, maintainable, and readable tests."
---

# Mastering Assertions and Matchers

GoogleTest provides a rich and expressive set of assertion macros and matcher utilities that empower you to write clear, maintainable, and robust test code. This guide walks you through techniques to harness the full power of assertions and custom matchers in GoogleTest (and GoogleMock), making your tests both expressive and informative.

---

## 1. Understanding GoogleTest Assertions

GoogleTest assertions verify conditions in your test code, offering feedback when actual outcomes differ from expected behaviors.

### 1.1 Assertion Variants

All assertions appear in pairs:

- **`EXPECT_` assertions** generate **non-fatal failures** and allow tests to continue.
- **`ASSERT_` assertions** generate **fatal failures** and abort the current function.

Choose between them depending on whether it makes sense to continue after a failure.

### 1.2 Common Assertion Categories

- **Boolean Conditions**: `EXPECT_TRUE(condition)`, `EXPECT_FALSE(condition)`
- **Binary Comparisons**: `EXPECT_EQ`, `EXPECT_NE`, `EXPECT_LT`, `EXPECT_LE`, `EXPECT_GT`, `EXPECT_GE`
- **String Comparisons**: `EXPECT_STREQ` (C strings), `EXPECT_STRNE`, `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`
- **Floating-Point Comparisons**: `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, `EXPECT_NEAR`
- **Exception Assertions**: `EXPECT_THROW`, `EXPECT_NO_THROW`, `EXPECT_ANY_THROW`
- **Explicit Success/Failure**: `SUCCEED()`, `FAIL()`, `ADD_FAILURE()`
- **Predicate Assertions**: `EXPECT_PRED*` and `EXPECT_PRED_FORMAT*` macros for custom predicates.

### 1.3 Streaming Custom Failure Messages

All assertion macros allow you to stream a custom message using the `<<` operator:

```cpp
EXPECT_TRUE(is_valid) << "Validation failed for input: " << input_value;
```

This enhances failure messages with domain-specific context.

### 1.4 Best Practices

- Use `EXPECT_*` for most assertions to detect multiple issues in one test run.
- Use `ASSERT_*` only when failure prevents further test execution.
- Add clear and specific custom messages to clarify failures.

---

## 2. Leveraging Predicate Assertions for Expressive Tests

Sometimes, complex conditions or reusable predicates require better failure messages than basic Boolean assertions provide.

### 2.1 Using Predicate Functions

Create functions returning `testing::AssertionResult` instead of a simple Boolean:

```cpp
#include <gtest/gtest.h>

testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) {
    return testing::AssertionSuccess() << n << " is even";
  } else {
    return testing::AssertionFailure() << n << " is odd";
  }
}

TEST(NumberTest, CheckEven) {
  EXPECT_TRUE(IsEven(4));      // Passes
  EXPECT_TRUE(IsEven(5));      // Fails with message: '5 is odd'
  EXPECT_FALSE(IsEven(6));     // Fails with message that '6 is even'
}
```

This provides informative messages for both success and failure cases.

### 2.2 Using `EXPECT_PRED*` Macros

For predicates of fixed arity returning `bool`, GoogleTest provides macros:

```cpp
bool MutuallyPrime(int m, int n) { ... }

EXPECT_PRED2(MutuallyPrime, 3, 4);  // Checks m and n are mutually prime
```

These print argument values on failure automatically.

### 2.3 Using Predicate-Formatter Assertions

To gain full control over failure message formatting, define predicate-formatter functions returning `AssertionResult` and use:

```cpp
EXPECT_PRED_FORMAT2(MyPredicateFormatter, val1, val2);
```

These predicate-formatters receive both expressions and their values for custom messages.

---

## 3. Writing Clear and Effective Matchers

Matchers describe expected argument patterns in mock and assertion statements.

### 3.1 Built-in Matchers

GoogleTest provides many built-in matchers:

- **Wildcard**: `_` (matches any value)
- **Comparison**: `Eq()`, `Ne()`, `Gt()`, `Lt()`, `Ge()`, `Le()`
- **Container**: `Contains()`, `Not()`, `IsEmpty()`, `SizeIs()`
- **String**: `StartsWith()`, `EndsWith()`, `HasSubstr()`, `MatchesRegex()`

Example:

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(numbers, Contains(5));
EXPECT_THAT(text, MatchesRegex(R"(^[A-Za-z]+\d+$)"));
```

### 3.2 Using `EXPECT_THAT`

The `EXPECT_THAT` and `ASSERT_THAT` macros combine values and matchers elegantly:

```cpp
EXPECT_THAT(container, ::testing::ContainsElement(::testing::Gt(10)));
```

This reads like English, improves test readability, and produces informative failure messages.

### 3.3 Creating Custom Matchers

For testing complex or domain-specific logic:

- Use gMock's matcher framework to define your own matchers.
- Custom matchers integrate seamlessly with `EXPECT_THAT`.

See the Mocking Reference for details on defining matchers.

---

## 4. Floating-Point Comparisons: Avoiding Pitfalls

Comparing floating-point numbers needs special handling due to rounding errors.

- Use `EXPECT_FLOAT_EQ` or `EXPECT_DOUBLE_EQ` for approximate equality within a small tolerance.
- Use `EXPECT_NEAR(val1, val2, abs_error)` to specify a custom absolute error tolerance.

Example:

```cpp
EXPECT_FLOAT_EQ(computed_value, expected_value);
EXPECT_NEAR(computed_value, expected_value, 0.001);
```

---

## 5. Exception Assertions

If your code throws exceptions, GoogleTest offers assertions to verify their expected behavior.

- `EXPECT_THROW(statement, ExceptionType)` confirms statement throws the specified exception.
- `EXPECT_ANY_THROW(statement)` confirms statement throws any exception.
- `EXPECT_NO_THROW(statement)` confirms statement does not throw.

Example:

```cpp
EXPECT_THROW(FunctionThatThrows(), std::runtime_error);
EXPECT_NO_THROW(FunctionThatDoesNotThrow());
```

---

## 6. Death Tests

GoogleTest supports *death tests* that verify your code terminates in expected ways under error conditions.

- Use `EXPECT_DEATH(statement, regex)` to check if the statement causes the process to exit and produces expected output matching the regex.
- Use `EXPECT_EXIT(statement, predicate, regex)` to test exit status and output.

See the [Death Tests](../advanced.md#death-tests) guide for detailed usage.

---

## 7. Using Test Properties for Additional Logging

Add contextual information to test results using:

```cpp
RecordProperty("key", "value");
RecordProperty("ErrorCount", 2);
```

Properties are logged in XML or JSON reports and can help diagnose failures.

Note:
- Reserved keys (e.g., `name`, `time`) are forbidden.
- Call from within tests or global environments.

---

## 8. Enhancing Test Diagnostics with Traces

Use `SCOPED_TRACE` or `testing::ScopedTrace` to add context for assertions in helper functions or loops:

```cpp
SCOPED_TRACE("Iteration " << i);
EXPECT_EQ(foo, bar);
```

This adds the trace message to failure output, clarifying which invocation caused the failure.

---

## 9. Assertion Macros Syntax Reference

| Assertion Category    | Macro Examples                         | Behavior                                    |
| --------------------- | ------------------------------------ | ------------------------------------------- |
| Boolean Conditions    | `EXPECT_TRUE(cond)`, `ASSERT_FALSE(cond)` | Verify truth or falsity of condition        |
| Equality/Inequality   | `EXPECT_EQ(a,b)`, `ASSERT_NE(a,b)`  | Check binary relations                       |
| String Comparison     | `EXPECT_STREQ(a,b)`, `EXPECT_STRCASEEQ(a,b)` | Compare C strings, case sensitive or insensitive |
| Floating-Point        | `EXPECT_FLOAT_EQ(a,b)`, `EXPECT_NEAR(a,b,err)` | Check approx. equality within tolerance     |
| Exception Assertions  | `EXPECT_THROW(...)`, `EXPECT_ANY_THROW(...)`, `EXPECT_NO_THROW(...)` | Verify exception behavior                     |
| Death Assertions      | `EXPECT_DEATH(...)`, `EXPECT_EXIT(...)` | Check program termination with output regex |
| Predicate Assertions  | `EXPECT_PRED1`, `EXPECT_PRED_FORMAT2`, `EXPECT_THAT` | Check complex conditions with informative messages |

---

## 10. Samples and Examples

### 10.1 Basic Assertion Use

```cpp
TEST(FactorialTest, HandlesZero) {
  EXPECT_EQ(Factorial(0), 1) << "Factorial of 0 should be 1";
  EXPECT_GT(Factorial(5), 0);
}
```

### 10.2 Floating-Point Comparison

```cpp
TEST(MathTest, ComputesPi) {
  const double pi_estimate = ComputePi();
  EXPECT_NEAR(pi_estimate, 3.14159, 0.0001);
}
```

### 10.3 Predicate Assertion for Even Numbers

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0)
    return testing::AssertionSuccess() << n << " is even";
  else
    return testing::AssertionFailure() << n << " is odd";
}

TEST(NumberTest, CheckEvenness) {
  EXPECT_TRUE(IsEven(4)); // Pass
  EXPECT_TRUE(IsEven(5)); // Fails with message "5 is odd"
}
```

### 10.4 Using Matchers

```cpp
using ::testing::_;
using ::testing::HasSubstr;
using ::testing::StartsWith;

TEST(StringTest, CheckContents) {
  std::string str = "Hello, world!";
  EXPECT_THAT(str, StartsWith("Hello"));
  EXPECT_THAT(str, HasSubstr("world"));
}
```

### 10.5 Exception Assertions

```cpp
TEST(ExceptionTest, ThrowsRuntimeError) {
  EXPECT_THROW(ThrowRuntimeError(), std::runtime_error);
  EXPECT_NO_THROW(DoNothing());
}
```

### 10.6 Death Test Example

```cpp
TEST(DeathTest, CrashOnInvalidState) {
  ASSERT_DEATH(AbortIfInvalid(-1), "Invalid state");
}
```

---

## 11. Troubleshooting & Common Pitfalls

- **Multiple evaluations:** All macro arguments are evaluated exactly once.
- **Unrecognized assertions:** Ensure proper header includes (`<gtest/gtest.h>`).
- **Fatal assertions in non-void functions:** Fatal assertions must be in void functions only.
- **Strings vs pointers:** Use string-specific assertions (`EXPECT_STREQ` vs `EXPECT_EQ`) for C-string content equality.
- **Floating-point comparisons:** Avoid `EXPECT_EQ` for floating points; use `EXPECT_FLOAT_EQ` or `EXPECT_NEAR`.
- **Disabled tests won't run:** Prefix test or test suite names with `DISABLED_` to skip.
- **Test name filters:** Verify names match filter patterns for runs.

---

## 12. Next Steps & Related Content

- **GoogleTest Primer:** [Primer Guide](../guides/getting-started/primer.md) for beginner-friendly basics.
- **Assertions Reference:** Complete list of assertions [Assertions Reference](reference/assertions.md).
- **Mocking Basics:** How to use expectations and actions [Mocking Basics](guides/real-world-workflows/mocking-basics.md).
- **Parameterized Tests:** Using `TEST_P` and `INSTANTIATE_TEST_SUITE_P` [Parameterized and Typed Tests](reference/testing.md#TEST_P).
- **Advanced Usage:** Deep dive on assertion techniques and test event listeners [Advanced GoogleTest Topics](docs/advanced.md).

Explore related [Matchers Reference](reference/matchers.md) to write rich assertions with `EXPECT_THAT` and custom matchers.

---

For comprehensive API details and examples, refer to the official GoogleTest repository and the related documentation included in this guide's references.
