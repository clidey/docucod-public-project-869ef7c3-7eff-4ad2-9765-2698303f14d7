---
title: "Advanced Assertions and Customization"
description: "Explores advanced assertion use, custom assertion creation, and assertion-result management. Offers practical techniques to provide clear diagnostics and actionable test failure messages."
---

# Advanced Assertions and Customization

Explore techniques for leveraging advanced assertion types, crafting custom assertions, and managing assertion results to obtain clear diagnostics and actionable failure messages in your tests.

---

## 1. Introduction

This guide dives into using GoogleTest's advanced assertion features and creating custom assertions to enhance test expressiveness and clarity. It equips you with practical methods to diagnose test failures effectively and tailor assertions for complex scenarios.

## 2. Understanding Advanced Assertions

### 2.1 Predicate Assertions for Better Error Messages

When complex Boolean conditions need verification, simply using `EXPECT_TRUE()` often yields unhelpful failure messages. GoogleTest offers three powerful techniques to improve this:

- **Using an existing Boolean function**: Pass functions that return `bool` via `EXPECT_PRED*` macros to get auto-printed argument values upon failures.

- **Defining a function returning `AssertionResult`**: Write predicate functions returning `testing::AssertionSuccess()` or `testing::AssertionFailure()` with informative messages. This lets assertions like `EXPECT_TRUE(IsEven(value))` print detailed diagnostics.

- **Using predicate-formatter assertions (`EXPECT_PRED_FORMAT*`)**: Customize failure message formatting fully, ideal when the default messages don't meet your needs or some arguments aren't streamable.

#### Example: Improving `EXPECT_TRUE` with `AssertionResult`

```cpp
#include <gtest/gtest.h>
using ::testing::AssertionSuccess;
using ::testing::AssertionFailure;
using ::testing::AssertionResult;

AssertionResult IsEven(int n) {
  if (n % 2 == 0) return AssertionSuccess() << n << " is even";
  else return AssertionFailure() << n << " is odd";
}

TEST(PredicateAssertionTest, Example) {
  EXPECT_TRUE(IsEven(4));  // Succeeds silently.
  EXPECT_TRUE(IsEven(3));  // Prints: Actual: false (3 is odd)
}
```

### 2.2 Floating-Point Predicate-Format Functions

For less common floating-point comparisons, use predicate-format functions combined with `EXPECT_PRED_FORMAT2` to assert approximate relations like less-or-equal with tolerance.

Example:

```cpp
EXPECT_PRED_FORMAT2(::testing::FloatLE, val1, val2);
EXPECT_PRED_FORMAT2(::testing::DoubleLE, val1, val2);
```

### 2.3 Using gMock Matchers in Assertions

Leverage gMock's expressive matchers with `EXPECT_THAT` to perform flexible assertions on values, including strings, containers, and custom objects.

Example:

```cpp
EXPECT_THAT(foo_string, HasSubstr("needle"));
EXPECT_THAT(bar_string, MatchesRegex("\\w*\\d+"));
```

## 3. Creating Custom Assertions

### 3.1 Writing Predicate Assertions Using `AssertionResult`

Define a function that returns `AssertionResult` to encapsulate more informative pass/fail checks with tailored messages.

Example:

```cpp
AssertionResult IsGreaterThanZero(int n) {
  if (n > 0) return AssertionSuccess();
  else return AssertionFailure() << n << " is not greater than zero";
}

TEST(CustomAssertionTest, ChecksValue) {
  int x = -1;
  EXPECT_TRUE(IsGreaterThanZero(x));  // Displays 'Actual: false (-1 is not greater than zero)'
}
```

### 3.2 Using `EXPECT_PRED_FORMAT*` for Formatted Messages

Write predicate-formatters with precise control over the format of failure messages by accepting expression strings along with values.

Example:

```cpp
AssertionResult AssertSumInRange(const char* expr1, const char* expr2, int a, int b) {
  int sum = a + b;
  if (sum >= 10 && sum <= 20) return AssertionSuccess();

  return AssertionFailure() << "Sum of " << expr1 << " and " << expr2
                            << " is " << sum << ", which is out of range [10, 20]";
}

TEST(CustomFormattedAssertionTest, SumRange) {
  EXPECT_PRED_FORMAT2(AssertSumInRange, 5, 6);  // Passes
  EXPECT_PRED_FORMAT2(AssertSumInRange, 15, 10); // Fails with detailed message
}
```

### 3.3 Tips for Custom Assertions

- Stream as much relevant debugging information as possible into the assertion failure message.
- Ensure predicate functions evaluate arguments exactly once and avoid side effects.
- Use existing GoogleTest primitives like `SCOPED_TRACE` to provide contextual trace information.

## 4. Managing Assertion Results

### 4.1 Explicit Success and Failure

- Use `SUCCEED()` to explicitly indicate a success point in tests without conditions.
- Use `FAIL()` to generate a fatal failure immediately, which aborts the current function.

### 4.2 Skipping Tests at Runtime

- Use `GTEST_SKIP()` to programmatically skip tests once runtime conditions indicate they shouldn't run.

Example:

```cpp
TEST(MyTest, SkipExample) {
  if (!IsEnvironmentReady()) {
    GTEST_SKIP() << "Skipping test: environment not ready";
  }
  ...
}
```

### 4.3 Propagating Fatal Failures from Helper Functions

When your test logic involves helper functions, fatal failures (`ASSERT_*`) inside those functions abort only the helper, not the entire test. Use `ASSERT_NO_FATAL_FAILURE(statement);` or check `HasFatalFailure()` after calling helpers to control test flow correctly.

Example:

```cpp
void Helper() {
  ASSERT_EQ(1, 2);  // Only aborts Helper, not the test.
}

TEST(MyTest, UsesHelper) {
  Helper();
  if (testing::Test::HasFatalFailure()) return;  // Avoid crashing after helper fails
  ...
}
```

## 5. Practical Usage Patterns

### 5.1 Using `SCOPED_TRACE` for Enhanced Diagnostics

Use `SCOPED_TRACE` when calling helper functions to add context to failure messages, clarifying which invocation caused the failure.

Example:

```cpp
void Process(int n) {
  EXPECT_GT(n, 0);
}

TEST(MyTest, ProcessesMultipleInputs) {
  for (int i = 0; i < 3; ++i) {
    SCOPED_TRACE(testing::Message() << "Iteration " << i);
    Process(i - 1);
  }
}
```

### 5.2 Writing Custom Matchers as an Alternative

For cases where custom assertions become cumbersome, consider writing custom matchers, which integrate naturally with GoogleTest/gMock's matcher framework for flexible checks and expressive failure messages.

## 6. Troubleshooting & Best Practices

- Avoid side effects in predicate and matcher implementations to prevent flaky tests.
- Stream meaningful diagnostic information to ease debugging and reduce repair time.
- Use `GTEST_SKIP()` to handle conditional execution without causing test failures.
- Remember that fatal assertions inside helper functions only terminate that function. Use `HasFatalFailure()` or exception mechanisms provided by GoogleTest for broader control.

## 7. Next Steps & Related Content

- Explore [Predicate Assertions and Custom Matchers](../concepts/extensibility-and-performance/custom-assertions-and-matchers) for in-depth descriptions.
- Learn about [Using Mocks and Matchers](../guides/getting_started_workflows/using_mocks_and_matchers) to complement assertion knowledge.
- Read the [Assertions Reference](../docs/reference/assertions.md) for a comprehensive list of macros and usage.

---

## See Also

- [GoogleMock Mocking Reference](../docs/reference/mocking.md)
- [GoogleMock Cookbook](../docs/gmock_cook_book.md)
- [GoogleTest Advanced Guide](../docs/advanced.md)

---

## Glossary

- **AssertionResult**: A GoogleTest type encapsulating success/failure status and associated messages.
- **Predicate-Formatter**: A mechanism to customize how predicate assertions format their failure messages.
- **Uninteresting Call**: A call to a mock method without expectations set - usually generates a warning.
- **Fatal Assertion**: An assertion type that aborts the current function on failure.

---