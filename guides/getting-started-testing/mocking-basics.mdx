---
title: "Mocking Basics"
description: "Follow a step-by-step workflow to introduce GoogleMock into your tests. Learn how to define a mock class, set up expectations, and verify interactions. This guide covers the core patterns and conventions for mocking in real-world C++ projects."
---

# Mocking Basics

## Overview
This guide walks you through a practical, step-by-step workflow to introduce GoogleMock (gMock) into your C++ tests. You will learn how to define a mock class, set up expectations on mock methods, and verify that your code interacts correctly with dependencies. These core mocking patterns are essential for writing maintainable and effective tests in real-world projects.

---

## 1. Workflow Overview

### What You Will Achieve
- Define mock classes that simulate interfaces or abstract classes.
- Set expectations on how mocks are called and specify their behavior.
- Understand how to handle uninteresting calls and verify interactions.

### Prerequisites
- Basic familiarity with C++ and virtual functions.
- GoogleTest and GoogleMock libraries installed and configured.
- An interface or abstract class you want to mock.

### Time Estimate
About 15-30 minutes to complete this guide and get comfortable with basic mocking.

### Difficulty Level
Beginner to Intermediate

---

## 2. Step-by-Step Instructions

### Step 1: Define Your Mock Class
To test components that depend on an interface or abstract class, create a mock class that inherits from it. Use the `MOCK_METHOD` macro to define mock methods.

**Guide:**
1. Derive a class from the interface or abstract class.
2. Add `MOCK_METHOD` declarations in the `public:` section. Use syntax:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs));
```

- `Specs` may include `(override)` and/or `(const)` where appropriate.
- If your return or argument types contain commas (e.g., templates), wrap the type in parentheses or use type aliases.

**Example:**
```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

This lets you generate mocks automatically without defining method bodies.


### Step 2: Create Mock Objects in Your Test
Make an instance of your mock class in your test program. You can use stack or heap allocation.

**Example:**
```cpp
MockTurtle mock_turtle;
```

### Step 3: Set Expectations With `EXPECT_CALL`
Define what your test expects to happen during execution using `EXPECT_CALL`.

**Basics:**
```cpp
EXPECT_CALL(mock_object, MethodName(Matchers...))
    .Times(cardinality)  // Optional
    .WillOnce(action)   // Optional
    .WillRepeatedly(action);  // Optional
```

- Matchers specify expected method arguments. Use `_` to allow any argument.
- `Times` defines how many calls are expected (default is once).
- Actions specify return values or side effects.

**Example:**
```cpp
using ::testing::Return;
EXPECT_CALL(mock_turtle, GetX())
    .Times(3)
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));
```

### Step 4: Exercise Your Code Using Mocks
Call the function or class under test, passing in your mock objects. gMock will check if the observed interactions conform to the expectations.

**Example:**
```cpp
Painter painter(&mock_turtle);
painter.DrawCircle(0, 0, 10);
```

### Step 5: Verification
gMock automatically verifies that all expectations are satisfied when the mock object is destroyed. Failed expectations result in test errors with detailed reports.

---

## 3. Understanding Mock Behavior

### Uninteresting Calls and Strictness Levels
- **Uninteresting calls** are calls to mock methods without any `EXPECT_CALL`.
- The default behavior (naggy) generates warnings for uninteresting calls but does not fail tests.
- Use **`NiceMock`** to suppress warnings on uninteresting calls.
- Use **`StrictMock`** to make uninteresting calls cause test failures.

**Constructing mocks with strictness:**
```cpp
NiceMock<MockTurtle> nice_turtle;
StrictMock<MockTurtle> strict_turtle;
NaggyMock<MockTurtle> naggy_turtle;  // Default behavior
```

### Handling Constructors
`NiceMock`, `NaggyMock`, and `StrictMock` inherit constructors from the base mock class. You can construct them as you would the mock class.

---

## 4. Practical Tips & Common Pitfalls

- Always declare mock methods `public` even if base methods are `protected` or `private`.
- Avoid nesting `NiceMock` or `StrictMock` (e.g., `NiceMock<StrictMock<Mock>>`) as it is not supported.
- Provide virtual destructors for interfaces to avoid undefined behavior when mocks are deleted.
- To avoid warnings about uninteresting calls, explicitly use `NiceMock` or add catch-all expectations with `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.
- Setting expectations must be done before exercising the mock methods.
- For move-only types (`std::unique_ptr`), mock as usual with `MOCK_METHOD`, but use lambdas or functors for return actions.

---

## 5. Examples

### Basic Mock and Expectation Example
```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
};

TEST(FooTest, DoesThisOnce) {
  MockFoo mock_foo;

  EXPECT_CALL(mock_foo, DoThis()).Times(1);

  // Code under test calls mock_foo.DoThis()
  DoSomethingWithFoo(&mock_foo);
}
```

### Using NiceMock to Suppress Warnings
```cpp
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, DoThis());
nice_foo.DoThis();
// Calls to other methods with no EXPECT_CALL won't emit warnings.
```

### Setting Return Values With Actions
```cpp
EXPECT_CALL(mock_turtle, GetX())
    .WillOnce(Return(100))
    .WillRepeatedly(Return(200));

int x = mock_turtle.GetX();  // returns 100
x = mock_turtle.GetX();      // returns 200
```

---

## 6. Troubleshooting

| Issue                                | Solution or Explanation                                 |
|------------------------------------|---------------------------------------------------------|
| Warning: "Uninteresting mock function call" | Use `NiceMock` to silence this, or add catch-all expectations. |
| Unexpected call failure             | Check that `EXPECT_CALL` is set correctly with matching arguments before the call. |
| Mock method not called as expected  | Ensure method is virtual and mock method matches the signature exactly. |
| Tests fail after refactoring mocks  | Consider using `NiceMock` instead of naggy defaults to avoid brittle tests. |
| Cannot mock methods with move-only args or returns | Use lambdas or functors with `WillOnce` or `WillRepeatedly` to return new instances. |

---

## 7. Next Steps & Related Content

- Explore [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) for detailed beginner tutorials.
- Learn about advanced mocking patterns in the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).
- Read the [Mock Classes section](https://google.github.io/googletest/reference/mocking.html#mock-classes) of the API Reference for full details.
- Study [Matchers](https://google.github.io/googletest/reference/matchers.html) to improve argument validations.
- Review [Setting Expectations](https://google.github.io/googletest/reference/mocking.html#expect-call) to master the nuances of `EXPECT_CALL`.

---

## Summary
This guide introduces you to the essentials for using GoogleMock in your tests. You learned how to declare mock classes with `MOCK_METHOD`, create mock objects, set expectations on mock functions, use different strictness levels (`NiceMock`, `NaggyMock`, `StrictMock`), and verify interactions. The guide includes practical examples and troubleshooting advice to help you confidently integrate mocks into your testing workflow.

---