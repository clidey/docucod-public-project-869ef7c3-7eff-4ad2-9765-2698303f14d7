---
title: "Mastering Assertions"
description: "Deep dive into GoogleTest's robust collection of assertion macros. Understand the difference between fatal and non-fatal assertions, build expressive checks for various types, and discover best practices for writing readable, maintainable test code with clear failure messages."
---

# Mastering Assertions

GoogleTest offers a comprehensive set of assertion macros that help you verify code behavior effectively and expressively. This guide dives deep into mastering these assertions, enabling you to write tests that are clear, reliable, and maintainable.

---

## 1. Understanding Assertions

### What Are Assertions?
Assertions are the core mechanism for verifying behavior in your tests. They check conditions or compare values, resulting in passes or failures.

### Fatal vs Nonfatal Assertions
- **Fatal Assertions (`ASSERT_` macros)**: On failure, abort the current test function immediately. Use when further execution makes no sense.
- **Nonfatal Assertions (`EXPECT_` macros)**: On failure, record the failure but continue running the test. Use when multiple assertions in a test are desirable.

> **Tip:** Prefer nonfatal assertions (`EXPECT_`) for most checks to reveal as many failures as possible per test run.

## 2. Assertion Syntax and Custom Messages

- Assertions are C++ macros.
- You can append a custom failure message using the `<<` operator for clearer diagnostics.

```cpp
EXPECT_TRUE(x > 0) << "Expected x to be positive, but it's " << x;
```

- This capability allows streaming any type supporting `ostream`.

## 3. Assertion Categories and Examples

### 3.1 Explicit Success and Failure

- `SUCCEED()` reports a success explicitly; useful in complex control flows.
- `FAIL()` generates a fatal failure unconditionally.
- `ADD_FAILURE()` produces a nonfatal failure.

```cpp
if (case_not_expected) {
  FAIL() << "Should never reach here.";
}
```

### 3.2 Boolean Condition Checks

- `EXPECT_TRUE(condition)`, `ASSERT_TRUE(condition)` — verify condition is true.
- `EXPECT_FALSE(condition)`, `ASSERT_FALSE(condition)` — verify condition is false.

```cpp
ASSERT_TRUE(IsValid(email)) << "Email invalid: " << email;
```

### 3.3 Binary Comparisons

Check equality and relational conditions:

| Macro           | Description                     | Example                          |
|-----------------|---------------------------------|---------------------------------|
| `EXPECT_EQ`     | Equal (`==`)                    | `EXPECT_EQ(result, expected);`  |
| `EXPECT_NE`     | Not equal (`!=`)                | `EXPECT_NE(value, 0);`           |
| `EXPECT_LT`     | Less than (`<`)                 | `EXPECT_LT(angle, 180);`         |
| `EXPECT_LE`     | Less or equal (`<=`)            | `EXPECT_LE(score, max_score);`  |
| `EXPECT_GT`     | Greater than (`>`)              | `EXPECT_GT(count, 0);`           |
| `EXPECT_GE`     | Greater or equal (`>=`)         | `EXPECT_GE(level, minimum);`     |

Failing equality assertions will print the compared values using your types’ `operator<<` or other printers.

### 3.4 String Comparisons

Special macros are provided for C strings (null-terminated char arrays), to avoid pointer address comparisons.

| Macro            | Description                       |
|------------------|----------------------------------|
| `EXPECT_STREQ`   | Equal C strings                  |
| `EXPECT_STRNE`   | Not equal C strings              |
| `EXPECT_STRCASEEQ`| Equal ignoring case             |
| `EXPECT_STRCASENE`| Not equal ignoring case         |

```cpp
EXPECT_STREQ("hello", received_cstr) << "Strings don't match";
```

### 3.5 Floating-Point Comparisons

Due to rounding errors, exact equality rarely works for floats/doubles. GoogleTest provides:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`: approximate equality for `float`.
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`: approximate equality for `double`.
- `EXPECT_NEAR` / `ASSERT_NEAR`: verify difference within an absolute error bound.

Example:

```cpp
EXPECT_NEAR(computed_value, expected_value, 0.001) << "Value not within tolerance.";
```

### 3.6 Exception Assertions

If exceptions are enabled, verify exception throwing behavior:

- `EXPECT_THROW(statement, exception_type)` - expects an exception of specific type.
- `EXPECT_ANY_THROW(statement)` - expects any exception thrown.
- `EXPECT_NO_THROW(statement)` - expects no exception.

Example:

```cpp
EXPECT_THROW(FunctionThatThrows(), std::runtime_error);
```

### 3.7 Predicate Assertions

- For complex Boolean predicates, use macros like `EXPECT_PRED1(pred, val1)`
- Also supports custom predicate-formatters via `EXPECT_PRED_FORMAT2(pred_fmt, val1, val2)`, which provide rich failure descriptions.

Example:

```cpp
bool IsPrime(int n); // your predicate
EXPECT_PRED1(IsPrime, number);
```

Failure prints detailed information showing argument values.

### 3.8 Using Matchers

For assertions that incorporate gMock matchers, use `EXPECT_THAT(value, matcher)` / `ASSERT_THAT(value, matcher)`. This enables expressive and flexible checks.

Example:

```cpp
EXPECT_THAT(name, StartsWith("John"));
EXPECT_THAT(numbers, ElementsAre(1, 2, 3));
```

## 4. Best Practices for Writing Assertions

- Use `ASSERT_` macros when subsequent steps depend on their success.
- Prefer `EXPECT_` macros in general to gather multiple failures.
- Provide explanatory failure messages using streaming for clarity.
- Avoid side effects in assertion expressions, as they are evaluated once.
- Use appropriate specialized macros (e.g., string macros for C strings).
- Use `EXPECT_THAT` with gMock matchers for flexible and expressive verifications.

## 5. Troubleshooting Common Assertion Issues

- **Undefined Behavior from Fatal Assertions in Non-void Functions**: Fatal assertions (like `ASSERT_*`) can only be used in `void`-returning functions. Use `EXPECT_*` if function returns value.

- **Side Effects in Assertion Arguments**: Since arguments are evaluated once, avoid side effects or increments directly inside assertion macros.

- **String Comparison Pitfalls**: Remember to use `EXPECT_STREQ` for C strings, not `EXPECT_EQ`, which compares pointers.

- **Floating-Point Comparisons**: Use floating-point macros (`EXPECT_FLOAT_EQ`, `EXPECT_NEAR`) to avoid flaky tests due to rounding errors.

- **Exception Assertions require exceptions enabled**: If exceptions are not enabled, exception assertion macros won't work.

## 6. Real-World Examples

### Checking Return Values and Conditions

```cpp
TEST(FactorialTest, Positive) {
  int result = Factorial(5);
  EXPECT_GT(result, 0) << "Factorial must be positive";
}
```

### Verifying String Equality

```cpp
TEST(StringUtilTest, Capitalizes) {
  const char* input = "hello";
  char* output = Capitalize(input);
  EXPECT_STREQ("Hello", output);
  free(output);
}
```

### Testing Approximate Floating-Point Results

```cpp
TEST(PhysicsTest, VelocityCalculation) {
  double computed = CalculateVelocity();
  EXPECT_NEAR(computed, 9.81, 0.001) << "Gravity mismatch";
}
```

### Expecting Exceptions

```cpp
TEST(FileTest, OpenFileThrows) {
  EXPECT_THROW(OpenFile("not_exist.txt"), FileNotFoundError);
}
```

### Using Predicate Assertions

```cpp
bool IsEven(int x) { return x % 2 == 0; }

TEST(NumberTest, IsEvenCheck) {
  int n = 4;
  EXPECT_PRED1(IsEven, n) << "Number must be even";
}
```

### Using Matchers

```cpp
using ::testing::StartsWith;

TEST(NameTest, HasPrefix) {
  std::string name = "John Doe";
  EXPECT_THAT(name, StartsWith("John"));
}
```

## 7. Next Steps & References

- Explore the [Assertions Reference](reference/assertions.md) for complete macros list.
- Learn about [Custom Assertions and Matchers](guides/advanced-testing-patterns/custom-assertions-and-matchers) for advanced verification.
- Use [GoogleMock Recipes](gmock_cook_book.md) for mocking and interaction testing.
- Consider [Advanced GoogleTest Topics](docs/advanced.md) for sophisticated testing patterns.

---

## Summary

This guide presents an authoritative, user-centric mastery of GoogleTest assertion macros. It clarifies the distinctions between fatal and nonfatal assertions, provides actionable usage patterns, and practical examples covering Boolean, binary, string, floating-point, exception, and predicate assertions. Enhanced tips and common pitfalls prevent typical user errors and maximize test clarity.

For a comprehensive picture, users should complement this with the Assertions Reference and explore related guides on mocking and advanced assertion techniques.

---

## Key Sections Covered

- Understanding Assertions
- Assertion Syntax and Custom Failure Messages
- Assertion Categories (Boolean, Binary, String, Floating-Point, Exception, Predicate)
- Best Practices
- Troubleshooting Common Issues
- Practical Examples
- Next Steps and Further References

---

## Important Links

- [GoogleTest Assertions Reference](reference/assertions.md)
- [GoogleMock for Dummies](docs/gmock_for_dummies.md)
- [GoogleMock Cookbook](docs/gmock_cook_book.md)
- [Advanced GoogleTest Topics](docs/advanced.md)
- [Getting Started Guide](getting-started/first-steps/create-first-test.mdx)
- [Mocking Reference](docs/reference/mocking.md)

[Back to Guides](../../guides/getting-started-testing/assertion-mastery)
