---
title: "Setup and Configuration"
description: "Learn how to add GoogleTest and GoogleMock to your project, install dependencies, and verify your test environment. This guide covers Bazel, CMake, and manual integration options, including configuration files and key commands for a smooth start."
---

# Setup and Configuration

Learn how to add GoogleTest and GoogleMock to your project, install necessary dependencies, and verify your testing environment. This guide will walk you through integrating GoogleTest and GoogleMock into your C++ projects using Bazel, CMake, or manual methods, ensuring a smooth and effective testing setup.

---

## 1. Overview of Integration Options

GoogleTest and GoogleMock support multiple ways to be added to your project. The main approaches include:

- **Bazel**: Google's native build system with native support for GoogleTest/GoogleMock.
- **CMake**: A popular cross-platform build system with provided CMake scripts.
- **Manual integration**: Manually adding source files and headers.

Choose the integration method suitable for your build environment and project requirements.

## 2. Adding GoogleTest and GoogleMock via Bazel

If you use Bazel, adding GoogleTest and GoogleMock is straightforward.

### Steps:

1. Add GoogleTest and GoogleMock as dependencies in your `WORKSPACE` file.

2. Reference GoogleTest and GoogleMock libraries by `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` in your BUILD targets.

3. Link your test executables with these libraries.

4. Write your tests using GoogleTest and GoogleMock APIs.

> Bazel automatically handles dependencies and compilation flags.

For more detailed Bazel integration instructions, please refer to the official Bazel documentation or GoogleTest Bazel examples.

## 3. Integrating GoogleTest and GoogleMock with CMake

GoogleTest provides a versatile CMake build script that can be incorporated into your project.

### 3.1. Standalone GoogleTest Build

To build GoogleTest (and GoogleMock) standalone:

```bash
# Clone the repo at a specific version tag for stability
git clone https://github.com/google/googletest.git -b v1.17.0
cd googletest

# Create an out-of-source build directory
mkdir build && cd build

# Run CMake configuration
cmake ..

# Or, to build GoogleTest only (exclude GoogleMock):
cmake .. -DBUILD_GMOCK=OFF

# Build using your native build system
make   # On Unix-like systems
# Or open and build gtest.sln in Visual Studio on Windows
```

After building, you can install GoogleTest to your system (requires permissions):

```bash
sudo make install
```

This installs headers and libraries to `/usr/local/` by default.

### 3.2. Use GoogleTest in Your CMake Project

#### Option 1: Find Installed GoogleTest Package

If GoogleTest is installed system-wide, add to your `CMakeLists.txt`:

```cmake
find_package(GTest CONFIG REQUIRED)
target_link_libraries(your_test_target PRIVATE GTest::gtest GTest::gmock)
```

#### Option 2: Add GoogleTest as Subdirectory

A more robust way is to include GoogleTest source directory inside your project and add it as a subdirectory. This ensures consistent compiler and linker settings.

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# Optionally force matching runtime linkage on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(your_test_exe tests/test_main.cpp)
target_link_libraries(your_test_exe PRIVATE gtest_main gmock)
add_test(NAME YourTests COMMAND your_test_exe)
```

##### Notes:
- This approach requires CMake 3.14 or above due to `FetchContent_MakeAvailable()`.
- Linking with `gtest_main` provides a ready-made `main()` function.
- The `gtest_force_shared_crt` option resolves Visual Studio runtime mismatches.

### 3.3. C++ Standard

Ensure your project compiles with at least C++17 standard. You can enforce this in your top level `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### 3.4. Building GoogleTest as Shared Library

By default, GoogleTest builds as a static library. To build it as a shared library (e.g., DLL on Windows):

- Add compiler flag:

  ```
  -DGTEST_CREATE_SHARED_LIBRARY=1
  ```

- Add linker flags as required by your platform.

- When compiling tests, add:

  ```
  -DGTEST_LINKED_AS_SHARED_LIBRARY=1
  ```

This ensures compatibility when loading the shared library.

## 4. Manual Integration

If you prefer, you can integrate GoogleTest and GoogleMock by adding their source files directly to your build system. This is less flexible and requires manual header and source management.

### Key Points:

- Download or clone the `googletest` repository.
- Include header directories for GoogleTest (`googletest/include`) and GoogleMock (`googlemock/include`).
- Compile and link with the source files under `googletest/src` and `googlemock/src`.
- Link your test targets against the compiled GoogleTest and GoogleMock objects.

Note: Avoid mixing this approach with packaged or system-installed versions to prevent conflicts.

## 5. Configuration Options and Tweaks

### 5.1. Control Macros

GoogleTest can be modified using compiler definitions (macros):

- Define `GTEST_HAS_PTHREAD` to `1` or `0` to force thread safety detection.
- Define `GTEST_CREATE_SHARED_LIBRARY` to `1` when building shared libraries.
- Define `GTEST_LINKED_AS_SHARED_LIBRARY` to `1` when linking against shared libraries.
- Define `GTEST_DONT_DEFINE_<MACRO>` (e.g. `GTEST_DONT_DEFINE_TEST`) to prefix GoogleTest macros and avoid conflicts.

### 5.2. Avoiding Macro Name Conflicts

If your project uses other libraries defining GoogleTest macro names, use the prefixing macros to rename GoogleTest's macros, for example:

```bash
-DGTEST_DONT_DEFINE_TEST=1
```

You then use `GTEST_TEST` instead of `TEST` in your test code.

## 6. Validating Your Test Environment

To verify your setup:

1. Write a simple test using GoogleTest's `TEST()` macro.

2. Compile and link your test program with GoogleTest and GoogleMock as configured.

3. Run the test executable. You should see output indicating the test run result.

4. Use flags like `--gtest_list_tests` to verify that GoogleTest detects your tests.

Example minimal test:

```c++
#include <gtest/gtest.h>

TEST(SimpleTest, TrueIsTrue) {
  EXPECT_TRUE(true);
}

int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

Executing this should report success.

## 7. Troubleshooting Common Issues

- If you encounter missing headers or unresolved symbols, verify your include paths and linking correctly reference GoogleTest and GoogleMock.
- On Windows, watch for RTTI and runtime library mismatches, especially when mixing static and dynamic runtimes.
- Ensure C++17 or higher is available and enabled.
- Use verbose build logs or debugging flags to get detailed error information.

## 8. Next Steps

Once setup and configuration are complete:

- Start writing your first tests using the [GoogleTest Primer](primer.md) guide.
- Explore test fixtures and parameterized tests for more advanced coverage.
- Consider using GoogleMock for mocking dependencies in your tests.
- Refer to the [Advanced Topics](advanced.md) for deeper control and optimization.

---

<Info>
This guide emphasizes configuring GoogleTest and GoogleMock for a seamless test development experience. For additional build system-specific guidance, please consult your build system's official documentation.
</Info>

---

<Source url="https://github.com/google/googletest" paths={[{"path": "googletest/README.md", "range": "1-120"}]} />
<Source url="https://github.com/google/googletest" paths={[{"path": "googletest/include/gtest/gtest.h", "range": "1-150"}]} />
