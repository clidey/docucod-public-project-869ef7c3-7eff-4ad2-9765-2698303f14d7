---
title: "Performance and Scalability"
description: "Strategies for speeding up test runs, managing large numbers of tests, and leveraging features like test sharding, parallel execution, and selective running to optimize developer workflows."
---

# Performance and Scalability

Optimizing test execution speed and scalability is crucial for maintaining developer productivity as your codebase and test suite grow. This guide will help you apply proven strategies using GoogleTest and GoogleMock to accelerate test runs, manage large test sets effectively, and leverage available features such as parallel execution and test sharding.

---

## 1. Workflow Overview

### Task Description
This guide helps you speed up your test execution workflow by showing how to run tests selectively, execute tests in parallel, and manage large test suites efficiently.

### Prerequisites
- GoogleTest and GoogleMock are installed and integrated into your build system.
- Your test binaries are built and ready to be executed.
- Familiarity with basic GoogleTest commands and test structure (see [Writing Your First Test](https://google.github.io/googletest/guides/getting-started/writing-your-first-test)) is assumed.

### Expected Outcome
After following this guide, you will be able to:
- Run a subset of tests selectively to shorten feedback cycles.
- Use parallel and sharded test execution to reduce overall test runtime.
- Apply best practices for organizing and scaling your tests.

### Time Estimate
Setting up the techniques in this guide can range from a few minutes for simple filtering to hours for integrating advanced parallelization into CI pipelines.

### Difficulty Level
Intermediate â€” requires command-line proficiency and some build/test environment configuration.

---

## 2. Step-by-Step Instructions

### Step 1: Selective Test Execution to Speed up Development

- **What to Do:** Use test filtering to run only relevant tests when developing or debugging.
- **How to Do:**
  - Use the `--gtest_filter` flag followed by a wildcard pattern to specify which tests to run.
  - Example: Run all tests with suite names starting with `Math` and test names containing `Add`:
    ```bash
    ./your_test_binary --gtest_filter=Math*.*Add*
    ```
- **Expected Result:** Only the matching tests execute, reducing runtime drastically.

> _Tip:_ Combine multiple test patterns with `:` as a separator, e.g., `--gtest_filter=FooTest.*:BarTest.BazTest`.


### Step 2: Organize Tests for Scalability

- **What to Do:** Group and organize your tests into suites that reflect code modules or features.
- **How to Do:**
  - Define logical test suites using consistent naming in `TEST()` or `TEST_F()`.
  - Split large test suites into smaller focused suites.
- **Expected Result:** Easier to select subsets and maintain tests as your codebase grows.


### Step 3: Use Test Sharding to Distribute Tests Across Machines or Jobs

- **What to Do:** Run your tests in shards (partitions) to distribute the workload.
- **How to Do:**
  - Use the `--gtest_total_shards` and `--gtest_shard_index` flags.
  - Example: To split tests into 4 shards and run the 2nd shard:
    ```bash
    ./your_test_binary --gtest_total_shards=4 --gtest_shard_index=1
    ```
  - Each shard runs a different subset of tests, enabling parallelism at the job level.
- **Expected Result:** Parallel test jobs that collectively run the entire suite, optimizing resource use.

> _Note:_ Sharding requires that tests are reasonably uniformly distributed for efficient balancing.


### Step 4: Enable Parallel Execution to Use Multiple CPU Cores

- **What to Do:** Run tests in parallel on a single machine to utilize multicore systems.
- **How to Do:**
  - While GoogleTest itself does not provide built-in parallel test execution within a single binary, use external tools or test runners that launch multiple test binaries concurrently.
  - For example, with CTest or Bazel, configure test jobs to run concurrently.
  - In custom scripts, spawn multiple instances of your test binary with filters or shards.
- **Expected Result:** Reduced wall-clock test execution time by maximizing CPU usage.

> _Tip:_ Ensure tests do not share global state or depend on each other's side effects, as this can cause flaky tests when run in parallel.


### Step 5: Minimize Test Runtime by Controlling Test Complexity

- **What to Do:** Avoid heavy setup in tests where possible.
- **How to Do:**
  - Use `SetUp()` and `TearDown()` judiciously in test fixtures.
  - Share expensive resources across tests when safe using static or global objects.
  - Consider using `TEST_P` for parameterized tests rather than many similar tests.
- **Expected Result:** Faster execution per test and reduced total test suite runtimes.


### Step 6: Capture and Analyze Test Failures Efficiently

- **What to Do:** Use failure output to speed up debugging without rerunning the full suite.
- **How to Do:**
  - Use `--gtest_repeat=N` to rerun failing tests multiple times for flakiness detection.
  - Use `--gtest_break_on_failure` to halt test execution immediately upon failure for easier debugging.
- **Expected Result:** Immediate feedback on problem tests, reducing debugging time.


### Step 7: Automate Test Execution in CI for Consistent Performance

- **What to Do:** Integrate parallel and sharded test execution into your CI pipeline.
- **How to Do:**
  - Configure your build system (e.g., Bazel or CMake's CTest) to run shards or parallel test jobs.
  - Aggregate results to reflect a full pass/fail status.
  - Monitor metrics for test runtime and failures.
- **Expected Result:** Faster and reliable automated test feedback in your development pipeline.


---

## 3. Examples & Code Samples

### Running a subset of tests using test filter:
```bash
./my_tests --gtest_filter=NetworkingTest.*
```
Only tests in the `NetworkingTest` suite run.

### Running a shard (shard 0 of 3):
```bash
./my_tests --gtest_total_shards=3 --gtest_shard_index=0
```

### Example shell script launching parallel test shards:
```bash
NUM_SHARDS=4
for i in $(seq 0 $((NUM_SHARDS - 1))); do
    ./my_tests --gtest_total_shards=$NUM_SHARDS --gtest_shard_index=$i &
done
wait
```

### Using Bazel to run tests in parallel (configured in `bazel test`):
```bash
bazel test --jobs=8 //myproject/...
```

---

## 4. Troubleshooting & Tips

### Common Issues
- **Tests failing when run in parallel**:
  - Ensure tests do not depend on shared mutable global state.
  - Use proper synchronization or redesign tests for isolation.

- **Uneven test shard runtimes**:
  - Try adjusting shard counts.
  - Group tests by estimated runtime if possible.

- **Test runner crashes with repeated runs**:
  - Check for resource leaks.
  - Isolate crashing tests and fix.

### Best Practices
- Regularly refactor and split large test suites.
- Use parameterized tests to reduce duplicate code.
- Integrate timing metrics to identify slow tests.
- Consider using `GTEST_FLAG` environment variables for fine control.

### Performance Considerations
- Avoid excessive logging in performance-critical situations.
- Use `EXPECT_*` versus `ASSERT_*` appropriately to avoid premature test stops.
- Cache expensive test fixture setups.

### Alternative Approaches
- Use third-party test runners or build tools to orchestrate parallel test execution if more advanced scheduling is needed.

---

## 5. Next Steps & Related Content

- **What's Next**: Explore these guides to solidify your test infrastructure:
  - [Integrating with Build Systems](https://google.github.io/googletest/guides/integration-and-best-practices/integrating-with-build-systems)
  - [Continuous Integration & Test Automation](https://google.github.io/googletest/guides/integration-and-best-practices/continuous-integration-automation)
  - [Mocking Techniques and Patterns](https://google.github.io/googletest/guides/core-workflows/mocking-techniques-and-patterns)

- **Related Guides**:
  - Writing Your First Test and Mock
  - Using Assertions and Matchers
  - Parameterized and Typed Tests

- **Resources**:
  - Official [GoogleTest Primer](https://google.github.io/googletest/primer.html)
  - [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
  - [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)

---

<Tip>
For large or complex test suites, invest time in organizing test suites and employing sharding and parallelization early on. This pays dividends with faster feedback and more stable testing workflows.
</Tip>

---