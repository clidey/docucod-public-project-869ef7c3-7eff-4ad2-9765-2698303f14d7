---
title: "Integrating with Build Systems (CMake & Bazel)"
description: "Takes users through the process of integrating GoogleTest and GoogleMock with popular build systems, including CMake and Bazel. Covers configuration, dependencies, and typical issues encountered during setup."
---

# Integrating with Build Systems (CMake & Bazel)

Effective integration of GoogleTest and GoogleMock into your build system is essential for seamless testing workflows in C++ projects. This guide walks you through the process of configuring, building, and troubleshooting GoogleTest and GoogleMock with the two most popular build systems: **CMake** and **Bazel**.

---

## Overview

GoogleTest provides a robust C++ testing framework, and GoogleMock extends it with mocking capabilities. Both projects are designed to be easy to integrate, but setup details vary depending on your build system.

This guide covers:
- Core integration concepts
- Step-by-step instructions for CMake
- Step-by-step instructions for Bazel
- Managing dependencies and configuration
- Typical issues and troubleshooting tips

---

## Prerequisites

Before proceeding, ensure you have:

- A C++17-compliant compiler
- Access to the GoogleTest source code (via git clone or as a submodule)
- Installed CMake (>= 3.14) for CMake-based projects
- Installed Bazel (latest stable release) for Bazel-based projects
- Basic familiarity with your build system's configuration syntax

---

## Integrating GoogleTest with CMake

### 1. Adding GoogleTest to Your Project

**Option A: External Installation**

If GoogleTest is installed system-wide (e.g., via your OS’s package manager), you can locate and link it using `find_package`.

```cmake
find_package(GTest REQUIRED)

add_executable(MyTests my_tests.cpp)
target_link_libraries(MyTests GTest::gtest GTest::gtest_main)
```

**Option B: Include GoogleTest Sources in Your Project**

For full control, clone GoogleTest as a subdirectory or submodule and add it to your build.

```bash
git clone https://github.com/google/googletest.git
```

```cmake
add_subdirectory(googletest)

add_executable(MyTests my_tests.cpp)
target_link_libraries(MyTests gtest gtest_main)
```

This builds GoogleTest and your tests together, ensuring consistent compiler flags.

### 2. Basic CMakeLists.txt Example

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

# Enable C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Add GoogleTest
add_subdirectory(googletest)

# Define your test executable
add_executable(MyTests my_tests.cpp)

# Link with GoogleTest libraries
# gtest for test definitions
# gtest_main for the default main

target_link_libraries(MyTests gtest gtest_main)

# Enable testing
enable_testing()

# Register test(s)
add_test(NAME MyTests COMMAND MyTests)
```

### 3. Building Your Tests

```bash
mkdir build
cd build
cmake ..
cmake --build . --target MyTests
ctest
```

### 4. Best Practices

- Use the same compiler flags for both GoogleTest and your code to avoid ABI issues.
- If you only want GoogleTest and not GoogleMock, disable GoogleMock in CMake with:

  ```cmake
  set(BUILD_GMOCK OFF CACHE BOOL "")
  ```

- For Windows users building with Visual Studio, consider setting `gtest_force_shared_crt` to match the runtime linkage.

### 5. Common Issues

- **Mismatch of runtime libraries on Windows:** Use `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` to fix.
- **Missing pthreads on Linux:** Ensure you link with pthread (`-pthread`) if needed; often handled by CMake.
- **Older CMake versions:** Use CMake >= 3.14 to ensure full compatibility with GoogleTest's modern features.

---

## Integrating GoogleTest with Bazel

Bazel is a powerful build system often used in large C++ projects. GoogleTest and GoogleMock have native Bazel support.

### 1. Using GoogleTest in Your Bazel Workspace

Add GoogleTest as an external repository or include it directly if your codebase already contains it.

Example `WORKSPACE` snippet:

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/refs/tags/release-1.17.0.tar.gz"],
    strip_prefix = "googletest-release-1.17.0",
)
```

### 2. Example Bazel `BUILD` File

Define your test target similarly as:

```python
cc_test(
    name = "my_tests",
    srcs = ["my_tests.cpp"],
    deps = [
        "@com_google_googletest//:gtest_main",
        "@com_google_googletest//:gmock",
    ],
)
```

### 3. Running Tests

Run tests using Bazel’s test command:

```bash
bazel test //:my_tests
```

### 4. Best Practices

- Make sure your Bazel version supports the syntax in your `WORKSPACE` and `BUILD` files.
- Pin GoogleTest versions to stable releases for reproducibility.
- Use `gtest_main` to avoid writing your own main for running tests.

### 5. Troubleshooting

- If tests fail to run due to missing symbols or conflicting runtimes, verify compiler flags and dependency chains.
- Bazel sandboxing may cause environment differences; adjust your environment or rules as necessary.

---

## Managing Dependencies and Configuration

### Compiler Standards

GoogleTest requires at least C++17. Set this explicitly in your build files to avoid subtle bugs.

### Controlling Debug/Release Builds

Build GoogleTest with the same debug settings as your project to avoid mismatched behavior.

### Handling GoogleMock

GoogleMock is built alongside GoogleTest by default. If you do not want GoogleMock, you can disable it:

- In CMake, set `BUILD_GMOCK=OFF`
- In Bazel, omit the `gmock` dependency

### Using `gtest_main`

Linking with `gtest_main` provides a main function that runs all tests. This simplifies test executables.

---

## Typical Integration Workflow

1. Clone or add GoogleTest to your project.
2. Configure your build system (CMakeLists.txt or BUILD file).
3. Specify compiler and linker flags.
4. Link test binaries with GoogleTest libraries.
5. Build and run tests.
6. Debug test failures.

---

## Troubleshooting & Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Build Failures due to Compiler or CMake Version">
Ensure you use a sufficiently modern compiler (supporting C++17) and at least CMake 3.14. Update your toolchain if necessary.
</Accordion>
<Accordion title="Runtime Mismatch on Windows">
Set `gtest_force_shared_crt` option in CMake to match your project’s runtime linkage.
</Accordion>
<Accordion title="Missing pthreads on Linux/Unix">
Link with `pthread` library if required; this is often handled automatically by CMake.
</Accordion>
<Accordion title="Linker Errors about Multiple Definitions">
Check that you do not link multiple copies of GoogleTest (e.g., both submodule and system install).
</Accordion>
</AccordionGroup>

<Tip>
For large projects, prefer adding GoogleTest as a submodule or external repo in Bazel instead of copying source code, to simplify maintenance.
</Tip>

<Note>
Customizing GoogleTest setup might be necessary for non-standard environments. See `googletest/include/gtest/internal/custom/README.md` for advanced options.
</Note>

---

## Next Steps & Related Content

- After integrating your build system, start writing tests using the [GoogleTest Primer](primer.md).
- Learn how to write parameterized and typed tests with [Parameterized & Typed Tests Guide](guides/advanced-and-real-world/parameterized-tests.md).
- Explore mocking patterns with [Mocking Basics & Patterns](guides/advanced-and-real-world/mocking-basics-patterns.md).
- Understand assertion macros and best practices in [Core Assertions Guide](guides/getting-started/core-assertions-best-practices.md).
- Troubleshoot common build and runtime issues with [FAQ & Common Issues](getting-started/troubleshooting-help/faq-common-issues.md).

---

**This concludes the integration guide for GoogleTest and GoogleMock with CMake and Bazel.**


