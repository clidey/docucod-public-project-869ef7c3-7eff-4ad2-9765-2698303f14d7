---
title: "Integrating GoogleTest with Your Build System"
description: "Learn the most reliable ways to include GoogleTest in CMake and Bazel projects, manage external dependencies, and keep test code isolated. This guide covers setup tips and troubleshooting for seamless developer onboarding."
---

# Integrating GoogleTest with Your Build System

## Overview

This guide is designed to help you integrate GoogleTest seamlessly into your CMake or Bazel project. It provides reliable methods to include GoogleTest as an external dependency, manage test code isolation, and troubleshoot common build and configuration issues. By following this guide, you ensure a smooth setup enabling you to write, build, and run tests efficiently.

---

## Prerequisites

Before starting integration, ensure you have the following:

- A C++17-compatible compiler installed (see [System Requirements](https://github.com/google/googletest/blob/main/docs/setup-prerequisites/system-requirements.mdx)).
- A working CMake (version 3.14 or higher) or Bazel build environment.
- Basic familiarity with CMake or Bazel build files.
- GoogleTest source available via git clone, submodule, or package manager.


## Expected Outcome

After integration, your project will be able to:

- Compile GoogleTest alongside your project or link to an installed GoogleTest library.
- Build and run unit tests using `RUN_ALL_TESTS()`.
- Maintain test code separate from production code to keep your builds clean.


## Integration with CMake

### Including GoogleTest in Your CMake Project

GoogleTest can be added as a subdirectory or linked to an installed library. The subdirectory method is more robust across platforms and compiler settings.

### Step-by-Step Instructions

1. **Clone GoogleTest repository** (if not already available):

```bash
$ git clone https://github.com/google/googletest.git
```

2. **Add GoogleTest to your CMakeLists.txt** using `add_subdirectory`:

```cmake
# Assuming googletest is at third_party/googletest
add_subdirectory(third_party/googletest)

# Add your test executable
add_executable(my_tests test/my_test.cc)

# Link against gtest and gtest_main
target_link_libraries(my_tests gtest gtest_main)

# Enable testing and add your tests
enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

3. **Set C++ standard to 17** if not set:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

4. **Run CMake and build your tests:**

```bash
mkdir build && cd build
cmake ..
make
ctest
```

### Tips for Robust Integration

- Use `FetchContent` module to download GoogleTest during configuration instead of manually cloning. Example:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)
```

- Set the option `gtest_force_shared_crt ON` on Windows to avoid runtime mismatches.

- Link test binaries against `gtest_main` to avoid writing your own `main()`.

### Isolating Test Code

- Keep your test code in a separate directory (e.g., `test/`) with its own CMake targets.
- Mark test targets with `set_target_properties(my_tests PROPERTIES FOLDER tests)` for IDE organization.


## Integration with Bazel

### Adding GoogleTest as a Dependency

1. Add GoogleTest as an external repository in your `WORKSPACE` file:

```bazel
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.zip"],
    strip_prefix = "googletest-release-1.17.0",
    sha256 = "abc123...",
)
```

2. In your BUILD file, declare tests linking to GoogleTest:

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

Note:
- Use `@com_google_googletest//:gtest_main` as a dependency to get a `main()` provided.
- Use `@com_google_googletest//:gtest` if you want to write your own main.


## Managing External Dependencies

- Prefer keeping GoogleTest source as a submodule or external dependency managed by your build system. This avoids issues with version drift.
- Pin the version to stable releases (e.g., v1.17.0).

## Test Code Isolation Best Practices

- Place test source files and test-only mock implementations in dedicated directories (e.g., `/test`).
- Do not mix test dependencies and production dependencies; link GoogleTest only to test targets.

---

## Troubleshooting

### Common Issues and Resolutions

| Issue                                       | Cause                                         | Resolution                                   |
|---------------------------------------------|-----------------------------------------------|----------------------------------------------|
| Can't find gtest headers or libraries       | Missing `add_subdirectory` or external repo   | Add correct GoogleTest source or install package |
| Runtime mismatch on Windows (CRT error)     | Conflicting CRT linkage settings              | Set `gtest_force_shared_crt ON` in CMake     |
| Compiler errors about C++ version or missing features | C++ standard less than C++17 or older compiler | Set required standard and update compiler    |
| Tests do not run or no tests found           | Tests not linked to GoogleTest or no `main()`| Link test to `gtest_main` or write main       |
| Multiple main definition error               | Linking both your own `main()` and `gtest_main`| Remove your main or don't link `gtest_main`   |

### Debugging Tips

- Verify GoogleTest is built with the same compiler and flags as your project to avoid ABI issues.
- Use `ctest` or `bazel test` commands to run tests and confirm integration.
- Check build output for missing dependency warnings.

---

## Example: CMakeLists.txt snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test/my_test.cc)
target_link_libraries(my_tests gtest_main)

enable_testing()
add_test(NAME my_tests COMMAND my_tests)
```

This example downloads, builds, and links GoogleTest automatically.

---

## Example: Bazel BUILD file snippet

```bazel
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

Ensure that your `WORKSPACE` includes the proper external repository definition for GoogleTest.

---

## Next Steps

- After integrating GoogleTest, proceed to:
  - [Writing and Organizing Tests](../guides/gtest-core-guides/writing-tests) for test creation best practices.
  - [Running and Interpreting Your Tests](../guides/gtest-core-guides/running-tests) to learn efficient test execution.
  - [Troubleshooting Setup Issues](../getting-started/first-run-validation/troubleshooting-setup) in case of errors.
  - For Bazel users, consult the official Bazel documentation on external repositories.

---

## Additional Resources

- GoogleTest Official GitHub: [https://github.com/google/googletest](https://github.com/google/googletest)
- [CMake FetchContent Module](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- GoogleTest Installation Guides:
  - Installing with CMake
  - Installing with Bazel
- Related Guides:
  - [Getting Started with GoogleTest](../guides/gtest-core-guides/getting-started)
  - [Mocking Basics](../guides/mocking-guide/mocking-basics)


---

## Frequently Asked Questions

### Can I link GoogleTest statically or dynamically?
You can build GoogleTest as a static or shared library. By default, it compiles statically. For dynamic linking on Windows, enable `gtest_force_shared_crt`.

### Do I have to write my own main()?
No, linking against `gtest_main` provides a default main() that runs all tests.

### How do I ensure all tests are found?
Make sure to register your test files as sources in your build system, and call `RUN_ALL_TESTS()` (provided by `gtest_main` or your own main).

### What C++ standard is required?
GoogleTest requires C++17 or higher features.


---

<Check>
For seamless integration, always build GoogleTest with matching compiler settings as your project, use fetch or external repositories to manage source, and isolate test code in separate targets.
</Check>
