---
title: "Integrating with CMake, Bazel, and Other Build Tools"
description: "Step-by-step approaches for adding GoogleTest and GoogleMock dependencies to your project using popular build systems. Covers common pitfalls and configuration examples."
---

# Integrating with CMake, Bazel, and Other Build Tools

This guide walks you through practical, step-by-step methods to add GoogleTest and GoogleMock dependencies into your C++ projects using some of the most popular build systems. It also highlights common configuration pitfalls and illustrates examples for smooth integration.

---

## Workflow Overview

### Task Description
Learn how to set up GoogleTest and GoogleMock correctly within existing or new projects by integrating them with build tools such as CMake and Bazel. This allows you to compile, link, and run your tests seamlessly.

### Prerequisites
- Basic familiarity with C++ project development
- Your project already using CMake or Bazel (or be prepared to start using them)
- GoogleTest source code repository cloned or accessible
- CMake version 3.14+ (for certain methods)
- Access to internet if using download-based integration

### Expected Outcome
After following this guide, your project will successfully build and link with GoogleTest and GoogleMock libraries, enabling you to write and run unit tests using their fully featured frameworks.

### Time Estimate
Approximately 15-30 minutes, depending on your build system familiarity and environment setup.

### Difficulty Level
Intermediate (some familiarity with build systems and project configuration is helpful)

---

## Step-by-Step Integration Instructions

### 1. Integrating GoogleTest with CMake

GoogleTest offers multiple ways to integrate with CMake depending on your project needs.

#### a) Using Installed GoogleTest Libraries

If GoogleTest is installed on your system (e.g., via package manager or manual install), use `find_package`:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

find_package(GTest REQUIRED)

add_executable(my_test_executable test.cpp)
target_link_libraries(my_test_executable GTest::gtest GTest::gtest_main)

add_test(NAME my_test COMMAND my_test_executable)
```

**Outcome:** Your test executable links with the installed GoogleTest libraries.

#### b) Building GoogleTest as Part of Your Project Using FetchContent

This approach downloads GoogleTest during the configure step and builds it alongside your project, ensuring compatible compiler and linker settings.

Add this snippet to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# Prevent overriding your compiler/linker settings on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_test_executable test.cpp)
target_link_libraries(my_test_executable gtest_main)

test(NAME my_test COMMAND my_test_executable)
```

**Note:** Requires CMake 3.14+.

#### c) Adding GoogleTest as a Subdirectory

If you manually add GoogleTest source inside your project tree or as a git submodule, include it with:

```cmake
add_subdirectory(external/googletest)

add_executable(my_test_executable test.cpp)
target_link_libraries(my_test_executable gtest_main)

add_test(NAME my_test COMMAND my_test_executable)
```

Modify the path (`external/googletest`) as per your project layout.

---

### 2. Linking Your Tests

You can link your test executables against these libraries depending on your needs:

| Library          | Description                                  |
|------------------|----------------------------------------------|
| `gtest`          | GoogleTest core testing framework             |
| `gtest_main`     | GoogleTest with a pre-defined `main()` function |
| `gmock`          | GoogleMock mocking framework                   |
| `gmock_main`     | GoogleMock (includes GoogleTest) with `main()`|

For example, to use GoogleMock with main:

```cmake
target_link_libraries(my_test_executable gmock_main)
```

**Tip:** If you want custom test initialization, link with `gtest` or `gmock` and provide your own `main()`.

---

### 3. Handling C++ Standards and Runtime Library Compatibility

- GoogleTest requires **C++17 or later**; specify it in your `CMakeLists.txt`:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- On Windows with Visual Studio, by default, GoogleTest links CRT statically but your project may use dynamic CRT. To fix linker errors, set the option:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

---

### 4. Integrating with Bazel

Bazel provides prebuilt support for GoogleTest and GoogleMock:

- Add dependencies in your `BUILD` or `BUILD.bazel` file:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cpp"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googlemock//:gmock_main"]
)
```

- Make sure your `WORKSPACE` file includes:

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.13.0.tar.gz"],
    strip_prefix = "googletest-release-1.13.0",
)

http_archive(
    name = "com_google_googlemock",
    urls = ["https://github.com/google/googletest/archive/release-1.13.0.tar.gz"],
    strip_prefix = "googletest-release-1.13.0",
)
```

Replace URLs and versions with the latest stable ones.

---

### 5. Example: Minimal CMake Project with GoogleTest

```text
/my_project
  /CMakeLists.txt
  /test
    /example_test.cpp
```

`CMakeLists.txt`:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(example_test test/example_test.cpp)
target_link_libraries(example_test gtest_main)

add_test(NAME example_test COMMAND example_test)
```

In your `example_test.cpp`:

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, Example) {
  EXPECT_EQ(1 + 1, 2);
}
```

Run in build directory:

```bash
cmake ..
cmake --build .
ctest
```

Outcome: Tests build and run, reporting results.

---

### 6. Common Pitfalls and How to Avoid Them

- **Linking errors due to mismatched CRT settings on Windows:**
  Use `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` or align your project settings.

- **Using older CMake versions:**
  The recommended FetchContent approach requires CMake 3.14+. Otherwise, use `add_subdirectory` or install GoogleTest separately.

- **Forgetting to add tests to CTest:**
  Ensure `add_test` commands are in place to register tests for `ctest` runs.

- **Multiple definitions of `main()`:**
  If linking with `gtest_main` or `gmock_main`, do not provide your own `main()` unless necessary.

- **Not specifying C++17:**
  GoogleTest requires C++17, so ensure your compiler flags include it.

---

## Troubleshooting & Tips

### Troubleshooting Common Issues

- **Test executable fails to link:**
  - Check if you linked against `gtest` / `gmock` or their `main` variants.
  - Confirm that compiler flags and C++ standard settings are correct.
  - On Windows, check CRT runtime linkage mismatch.

- **Tests compile but not found during `ctest`:**
  - Make sure you used `add_test()` in your CMake file.
  - Verify you are running tests from the correct build directory.

- **GoogleTest source not found by CMake:**
  - If using `add_subdirectory()`, verify the relative path is correct.
  - If using `FetchContent`, verify your internet connection and URL.

### Best Practices

- Use FetchContent or submodules for version consistency.
- Prefer linking with `gtest_main` or `gmock_main` for default `main()` implementations.
- Align runtime library settings in Visual Studio builds with GoogleTest.
- Group tests logically into suites, and use fixtures to share setup.

### Performance Considerations

- Keep GoogleTest sources separate from production sources.
- Use test executables dedicated to testing to avoid bloated binaries.

### Alternative Approaches

- Use system package managers to install GoogleTest if available for your OS.
- For embedded or limited environments, build only GoogleTest without GoogleMock by disabling `BUILD_GMOCK`.

---

## Next Steps & Related Content

- Explore the [Writing and Running Your First Test](https://github.com/google/googletest/tree/main/docs/writing-first-test.md) guide to get started writing tests after integration.
- Review [Mocking Your First Class or Function](https://github.com/google/googletest/tree/main/docs/gmock-for-dummies.md) to add mocks and expectations.
- Read [Test Performance and Parallel Runs](https://github.com/google/googletest/tree/main/docs/test-performance.md) for optimizing large suites.
- Consult [Troubleshooting Common Issues](https://github.com/google/googletest/tree/main/docs/troubleshooting.md) if you face build or setup problems.

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleMock Documentation](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [CMake FetchContent Documentation](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)

---

Take advantage of these integration steps to streamline your workflow and unlock the full power of automated testing with GoogleTest and GoogleMock in your C++ projects.
