---
title: "Integrating GoogleTest with Your Project"
description: "How to integrate GoogleTest and GoogleMock into existing projects, handle dependencies, structure test directories, and maintain portability across various compilers, platforms, and CI/CD environments."
---

# Integrating GoogleTest with Your Project

## Overview

This guide helps you integrate GoogleTest and GoogleMock into your existing C++ projects seamlessly. You will learn how to manage dependencies, organize your test directory structure, and maintain portability across various compilers, platforms, and CI/CD environments.

By following this document, you will establish a robust and maintainable testing environment that leverages GoogleTest's full potential within your development workflow.

---

## Prerequisites

- Familiarity with your project’s build system (CMake, Bazel, etc.)
- C++17 standard support enabled in your compiler
- Access to GoogleTest source or installed libraries

---

## Expected Outcome

- GoogleTest and GoogleMock are integrated into your project build
- Tests are organized logically in dedicated directories
- The setup supports cross-platform compilation and execution
- You understand how to configure GoogleTest for CI/CD pipelines

---

## Time Estimate

Approximately 30-60 minutes depending on your project complexity and build environment familiarity.

---

## Difficulty Level

Intermediate

---

# Step-by-Step Integration Instructions

### 1. Adding GoogleTest to Your Project

GoogleTest and GoogleMock are bundled together. You have the flexibility to build them as standalone libraries or integrate their source directly.

#### Using CMake (Recommended)

- Download GoogleTest (if not already):

  ```bash
  git clone https://github.com/google/googletest.git -b v1.17.0
  cd googletest
  ```

- Create a build directory and generate build files:

  ```bash
  mkdir build && cd build
  cmake ..
  # To build only GoogleTest without GoogleMock, add -DBUILD_GMOCK=OFF
  ```

- Build the project:

  ```bash
  make
  sudo make install  # Optional, for system-wide install
  ```

Alternatively, to incorporate GoogleTest into your existing CMake project, add these lines to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Windows dynamic runtimes
FetchContent_MakeAvailable(googletest)

add_executable(your_test target_sources.cpp)
target_link_libraries(your_test PRIVATE gtest_main)
add_test(NAME your_test COMMAND your_test)
```

This ensures GoogleTest and GoogleMock are downloaded and built as part of your project.

#### Using Bazel

GoogleTest is compatible with Bazel; users can add GoogleTest dependencies via WORKSPACE and BUILD files accordingly.

---

### 2. Structuring Your Test Directory

A well-organized test directory improves maintainability and scalability.

Recommended structure:

```
/project-root
  /src              # Production code
  /include          # Headers
  /tests            # Test directory
    /unit           # Unit tests
    /integration    # Integration tests
  CMakeLists.txt    # Build configuration
```

Place all GoogleTest-related test files under `/tests` or a suitable folder.

---

### 3. Writing Tests That Use GoogleMock

To use mocking in your tests, follow these steps:

1. Include GoogleMock headers:

   ```cpp
   #include <gmock/gmock.h>
   #include <gtest/gtest.h>
   ```

2. Define mock classes with `MOCK_METHOD` macros:

   ```cpp
   class MockInterface {
    public:
      MOCK_METHOD(void, DoSomething, (), (override));
      MOCK_METHOD(int, Calculate, (int a, int b), (const, override));
   };
   ```

3. Use `EXPECT_CALL` to set expectations and behaviors.

4. Exercise the code under test, passing mocks as dependencies.

Example:

```cpp
TEST(ExampleTest, UsesMock) {
  MockInterface mock;
  EXPECT_CALL(mock, DoSomething()).Times(1);

  // Run code that calls mock.DoSomething()
}
```

---

### 4. Managing Uninteresting Calls: Using NiceMock, NaggyMock, and StrictMock

By default, mock objects are *naggy*: calls without expectations produce warnings.

- **NiceMock** suppresses warnings for uninteresting calls.
- **NaggyMock** prints warnings for uninteresting calls.
- **StrictMock** treats uninteresting calls as errors.

Use these wrappers per your test needs:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockInterface> nice_mock;
StrictMock<MockInterface> strict_mock;
```

---

### 5. Portability Considerations

To maintain cross-platform compatibility:

- Ensure your C++ compiler supports C++17.
- Leverage GoogleTest’s platform detection facilities.
- Configure your build system to define necessary macros, e.g., `-DGTEST_HAS_PTHREAD=1` on platforms that require it.
- Use GoogleTest’s recommended compiler flags and link against appropriate runtime libraries. For example, on Windows, use `gtest_force_shared_crt` to avoid runtime mismatches.

---

### 6. Integrating with CI/CD Systems

- Run GoogleTest using `RUN_ALL_TESTS()` from your test executable.
- Use `--gtest_output=xml:report.xml` flag to generate test reports readable by CI tools.
- Configure your CI pipeline to execute tests, collect reports, and fail on test errors.
- Use verbosity flags (`--gmock_verbose=info`) during debugging in CI.

---

### 7. Best Practices

- Place `EXPECT_CALL` before exercising the code to avoid undefined behavior.
- Use `ON_CALL` to define default behaviors without expectations.
- Suppress uninteresting call warnings with `NiceMock` or by explicitly allowing calls with `Times(AnyNumber())`.
- Avoid mocking classes you do not own; prefer adapting interfaces.
- Regularly run tests with increased verbosity during test development.
- Keep tests isolated and independent from one another.

---

## Troubleshooting

- **Tests Not Discovered:** Ensure your test executable is linked properly against GoogleTest libraries, and use `--gtest_list_tests` to verify test discovery.
- **Linking Errors:** Verify compiler and linker flags include paths to GoogleTest headers and libraries.
- **Runtime Errors on Uninteresting Calls:** Consider switching to `NiceMock` to suppress warnings or define expectations.
- **Incorrect Behavior with Mock Methods:** Confirm `MOCK_METHOD` signatures match exactly the overridden virtual methods.
- **Compilation Slowdowns:** Move mock class constructor and destructor definitions to `.cc` files to reduce re-compilation overhead.

---

## Examples

### Minimal CMakeLists.txt With GoogleTest

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject)

set(CMAKE_CXX_STANDARD 17)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # Windows compatibility
FetchContent_MakeAvailable(googletest)

add_executable(my_test test_main.cpp my_code.cpp)

target_link_libraries(my_test PRIVATE gtest_main gmock)

enable_testing()
add_test(NAME my_test COMMAND my_test)
```

### Simple Mock and Test

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Interface {
 public:
  virtual ~Interface() = default;
  virtual int Compute(int x) = 0;
};

class MockInterface : public Interface {
 public:
  MOCK_METHOD(int, Compute, (int x), (override));
};

TEST(IntegrationTest, MockExample) {
  MockInterface mock;
  EXPECT_CALL(mock, Compute(::testing::Gt(0))).WillOnce(::testing::Return(42));

  int result = mock.Compute(10);
  EXPECT_EQ(result, 42);
}
```

---

## Additional Resources

- [GoogleTest Primer](docs/primer.md) — for learning the basics of GoogleTest
- [gMock for Dummies](docs/gmock_for_dummies.md) — beginner-friendly introduction to mocking
- [Mocking Reference](docs/reference/mocking.md) — detailed API for mocks
- [gMock Cookbook](docs/gmock_cook_book.md) — practical recipes for common mocking scenarios
- [CMakeLists.txt in the GoogleTest Repository](https://github.com/google/googletest/blob/main/CMakeLists.txt) for build insights

---

## Summary

Integrating GoogleTest and GoogleMock effectively transforms how your project handles C++ testing, supporting cleaner tests, better design, and reliable continuous integration. By following the above steps, you ensure tests are well structured, maintainable, and portable.

---