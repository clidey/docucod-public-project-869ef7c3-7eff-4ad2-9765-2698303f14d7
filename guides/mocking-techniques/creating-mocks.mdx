---
title: "Creating and Using Mock Objects"
description: "Step-by-step instructions to define mock classes using GoogleMock macros, implement interface mocking, and use mocks to replace dependencies in your tests."
---

# Creating and Using Mock Objects

Step-by-step instructions to define mock classes using GoogleMock macros, implement interface mocking, and use mocks to replace dependencies in your tests.

---

## 1. Overview

Mock objects simulate the behavior of real objects in your tests, allowing you to observe interactions, control behavior, and isolate your code under test. This page guides you through the essential workflow of creating mock classes with GoogleMock, setting up mock behaviors, and integrating mocks into test cases.

### Prerequisites
- Familiarity with C++ virtual functions and interfaces. 
- GoogleMock and GoogleTest installed and integrated into your build environment.
- Your interfaces/classes to be mocked must have virtual methods, with virtual destructors.

### Expected Outcome
By following this guide, you will be able to:
- Define mock classes with `MOCK_METHOD` macros
- Create mock objects to replace real dependencies
- Specify default behaviors and expectations on mocks
- Validate interactions through expectation verification

### Difficulty Level
Beginner to Intermediate, suitable for users familiar with basic C++ and unit testing concepts.

---

## 2. Defining Mock Classes

### Step 1: Include GoogleMock Header
```cpp
#include <gmock/gmock.h>
```
This header must be included to access all GoogleMock macros and utilities.

### Step 2: Create a Mock Class that Inherits from the Interface
Make sure the interface methods you want to mock are virtual, and destructors are virtual to avoid undefined behavior.

Example interface:
```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int count) = 0;
};
```

Mock class definition:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int count), (override));
};
```

### Guidelines
- Place all `MOCK_METHOD` declarations in the `public` section regardless of the original method's access level.
- Use `(const, override)` or other appropriate qualifiers matching the method signature.
- For overloaded methods, mock each overload, and use `using BaseClass::MethodName;` to bring in unmocked overloads if needed.
- For templates, define mock classes as templates and mock virtual methods with `MOCK_METHOD` like normal methods.

### Example: Mocking a Template Interface
```cpp
template <typename T>
class StackInterface {
 public:
  virtual ~StackInterface() {}
  virtual int GetSize() const = 0;
  virtual void Push(const T& x) = 0;
};

template <typename T>
class MockStack : public StackInterface<T> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const T& x), (override));
};
```

---

## 3. Using Mock Objects in Tests

Using mock objects generally follows this workflow:

### Step 1: Import Required Names
```cpp
using ::testing::Return;
using ::testing::_;  // wildcard matcher
```

### Step 2: Create Mock Instances
```cpp
MockFoo mock_foo;
```
You may also create "nice" or "strict" mocks:
```cpp
NiceMock<MockFoo> nice_mock;   // suppresses warnings on uninteresting calls
StrictMock<MockFoo> strict_mock;  // treats uninteresting calls as errors
```

### Step 3: Specify Default Behaviors with `ON_CALL`
Defaults describe how your mock should behave when no expectation is set.
```cpp
ON_CALL(mock_foo, GetSize())
    .WillByDefault(Return(10));
```
Use `ON_CALL` when you want to define the behavior but not require the call.

### Step 4: Set Expectations with `EXPECT_CALL`
This tells GoogleMock which calls you expect, with how many invocations and specific behavior.
```cpp
EXPECT_CALL(mock_foo, Describe(5))
    .Times(3)
    .WillRepeatedly(Return("Category 5"));
```

These expectations must be set before exercising the code that uses mocks.

### Step 5: Exercise Code Under Test
Pass mocks to the code that uses the real component.
```cpp
myFunctionTakingFoo(&mock_foo);
```

### Step 6: Automatic Verification
When mock objects go out of scope, GoogleMock automatically verifies that all expectations were met. You can also explicitly verify via:
```cpp
ASSERT_TRUE(::testing::Mock::VerifyAndClearExpectations(&mock_foo));
```

---

## 4. Best Practices and Tips

### Avoid Over-Specifying Tests
Only specify expectations that matter. Overly strict expectations make tests brittle to changes.

### Use Wildcard `_` for Arguments You Don’t Care About
```cpp
EXPECT_CALL(mock_foo, Describe(_));
```

### Order of Expectations
GoogleMock matches expectations in reverse order — newer overrides older.
For specific call orders, use `InSequence` or `After` clauses.

### Handle Overloaded Methods With Care
If your method is overloaded, always specify the full signature.
Use `Const()` wrapper for const-qualified method overloads.

### Specify “Nice” or “Strict” Mocks Judiciously
- **NiceMock** silences warnings on uninteresting calls (calls without expectations).
- **StrictMock** treats such calls as test failures.
Use these modes depending on how much strictness your test requires.

### Delegate to Fakes When Needed
Instead of duplicating behavior, you can delegate calls from mocks to real or fake implementations:
```cpp
ON_CALL(mock, Foo).WillByDefault([this](int n) { return real_.Foo(n); });
```

### Avoid Mocking Concrete Classes
Mock interfaces rather than concrete classes for better design and maintainability.

---

## 5. Common Pitfalls

### Virtual Destructors
Always make interface destructors virtual to avoid undefined behavior and memory leaks.

### Uninteresting Calls
If your test complains about uninteresting calls unexpectedly, ensure you set expectations, use `NiceMock`, or handle uninteresting calls properly.

### Duplicate Expectations
Avoid setting conflicting expectations for the same method and arguments.

### Using `EXPECT_CALL` After Calls
Set expectations *before* exercising your code. Setting after use leads to undefined behavior.

### Commas in Types
Commas in template types require extra parentheses or type aliases in `MOCK_METHOD`.

---

## 6. Example

End-to-end example showing mock class definition and usage:

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

// Interface
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(int type) = 0;
};

// Mock Class
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
};

// Test
using ::testing::Return;
using ::testing::_;

TEST(FooTest, TestDescribe) {
  MockFoo mock;

  ON_CALL(mock, GetSize()).WillByDefault(Return(42));
  EXPECT_CALL(mock, Describe(5)).WillOnce(Return("Type 5"));

  // Code under test uses mock:
  EXPECT_EQ(42, mock.GetSize());
  EXPECT_EQ("Type 5", mock.Describe(5));
}
```

---

## 7. Troubleshooting

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Mocking Non-Virtual Methods">
GoogleMock can only mock virtual functions directly. To mock non-virtual methods, use template-based mocking or redesign interface boundaries.
</Accordion>
<Accordion title="Compilation Issues with Commas in Types">
Wrap types with commas in parentheses or use type aliases to avoid macro parsing errors with `MOCK_METHOD`.
</Accordion>
<Accordion title="Unexpected Method Calls Failures">
Ensure you have set expectations for all expected method calls. Use `EXPECT_CALL` to specify calls and their count.
</Accordion>
<Accordion title="Uninteresting Call Warnings">
Use `NiceMock` to suppress warnings on methods without expectations, or explicitly add `EXPECT_CALL(...).Times(AnyNumber())` to whitelist calls.
</Accordion>
<Accordion title="Virtual Destructor Missing">
Always declare destructors of interfaces as virtual to let mock destructors work correctly and avoid memory leaks.
</Accordion>
</AccordionGroup>

---

## 8. Next Steps and Related Content

- Explore [Setting and Verifying Expectations](/guides/mocking-techniques/setting-expectations) to learn advanced expectation techniques.
- Review [Mocking Reference](/docs/reference/mocking.md) for detailed API usage.
- Understand [Matchers](/api-reference/assertions-matchers/expressive-matchers) to specify argument constraints.
- Learn about [Actions and Side Effects](/guides/mocking-techniques/advanced-mocking) to customize mock behavior.

---

For deeper learning, see the gMock Cookbook, gMock for Dummies, and GoogleTest core concepts pages.

---