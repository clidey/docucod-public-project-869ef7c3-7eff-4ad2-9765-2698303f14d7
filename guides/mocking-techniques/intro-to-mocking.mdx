---
title: "Introduction to Mocking with GoogleMock"
description: "Discover the fundamentals of mocking with GoogleMock—how and why to use mocks, the roles of ON_CALL and EXPECT_CALL, and how mocking enables you to isolate code for true unit testing."
---

# Introduction to Mocking with GoogleMock

## Workflow Overview

### Task Description
This guide helps you understand the fundamentals of mocking with GoogleMock. It explains what mocking is, why to use mock objects, the roles of key constructs like `ON_CALL` and `EXPECT_CALL`, and how mocking enables you to isolate code dependencies for true unit testing.

### Prerequisites
- A basic understanding of C++ programming.
- Familiarity with unit testing concepts.
- GoogleTest and GoogleMock installed and configured in your development environment.

### Expected Outcome
After completing this guide, you will be able to:
- Understand the role and purpose of mock objects in testing.
- Write basic mock classes using GoogleMock.
- Set default behaviors and expectations on mocks using `ON_CALL` and `EXPECT_CALL`.
- Apply mocking to isolate units of code effectively.

### Time Estimate
15-30 minutes for an initial conceptual grasp and practical introduction.

### Difficulty Level
Beginner to Intermediate

---

## Introduction to Mocking

### What Is Mocking?
Mocking is a testing technique where you replace a real object with a **mock object** that implements the same interface but allows you to specify at runtime:
- Which methods are expected to be called.
- Argument constraints for each call.
- The number of times methods will be called.
- Return values or side effects those methods should have.

Mock objects help you verify the *interactions* your code has with its dependencies rather than just their end-results.

### Why Use Mocking?
Mocking enables you to isolate the unit of code you want to test by simulating its dependencies. This leads to:
- Faster and more reliable unit tests.
- The ability to test scenarios that are difficult to reproduce with real objects.
- Cleaner, more maintainable code through better interface designs.

For example, in a graphics program, instead of verifying the output pixels, you can mock the drawing API to verify the draw calls and their parameters, making tests faster and less brittle.

---

## Defining Mock Classes

### Creating a Mock Class
To create a mock class in GoogleMock:
1. Derive a new class from the existing interface or abstract class you want to mock.
2. Use the `MOCK_METHOD` macro to mock each virtual method you want to override.

Example:
```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

Place the `MOCK_METHOD` macros inside the `public:` section regardless of the original method visibility.

### Notes:
- For **const** methods, add `(const, override)` as the fourth parameter.
- For **overloaded** methods, mock each overload separately.
- The mock class will generate the implementation for you.

---

## Setting Default Behaviors and Expectations

GoogleMock provides two principal macros to specify how mock objects should behave:

### ON_CALL

- Defines the **default behavior** of a mock method when it is called.
- Does **not** set any expectation on the number of calls.
- Can be used in your mock object’s constructor or `SetUp()` method for common default behaviors.

Example:
```cpp
ON_CALL(mock_turtle, GetX()).WillByDefault(Return(42));
```
This means: when `GetX()` is called and no specific expectation matches, return 42.

### EXPECT_CALL

- Defines **expectations** about calls to the mock method: how many times it is called, with which arguments, and what it should do.
- Sets obligations on the test, causing it to fail if the expectation is not met.

Example:
```cpp
EXPECT_CALL(mock_turtle, PenDown()).Times(AtLeast(1));
```
This means: `PenDown()` must be called at least once during the test.

### Relationship Between ON_CALL and EXPECT_CALL

- If both are specified for a method, the **EXPECT_CALL** overrides the default action set by **ON_CALL**.
- Use **ON_CALL** to specify common stubbed behaviors and **EXPECT_CALL** to verify specific interactions relevant to your test.

---

## Understanding Matchers and Cardinalities

When specifying expectations with `EXPECT_CALL`, you define:

### Matchers
Matchers specify which arguments to expect in method calls.

- `_` (underscore) matches any argument.
- `Eq(value)` matches arguments equal to `value`.
- Other built-in matchers exist, such as `Ge()`, `Le()`, `NotNull()`, and custom matchers.

Example:
```cpp
EXPECT_CALL(mock_turtle, Forward(Ge(100)));  // Expects Forward called with argument >= 100
```

### Cardinalities
Cardinalities specify how many times the method is expected to be called.

Common cardinalities include:
- `Times(1)` – exactly one call (default if not specified).
- `Times(AnyNumber())` – zero or more calls.
- `Times(AtLeast(n))` – at least n calls.
- `Times(AtMost(n))` – at most n calls.
- `Times(Between(m, n))` – between m and n calls (inclusive).

Example:
```cpp
EXPECT_CALL(mock_turtle, PenUp()).Times(Exactly(0));  // PenUp should never be called
```

---

## Ordering Expectations

By default, GoogleMock allows calls to matched expectations to occur in **any order**.

If you want to enforce strictly ordered calls, wrap your expectations in an `InSequence` block:

```cpp
{
  ::testing::InSequence seq;
  EXPECT_CALL(mock_turtle, PenDown());
  EXPECT_CALL(mock_turtle, Forward(100));
  EXPECT_CALL(mock_turtle, PenUp());
}
```
This requires the calls to happen exactly in this order.

You can also use `EXPECT_CALL(...).After(...)` clauses for partial ordering.

---

## Verifying Expectations

GoogleMock automatically verifies expectations when the mock object is destructed.

You can also:
- Force verification earlier with `::testing::Mock::VerifyAndClearExpectations(&mock_obj);`
- Use `Mock::AllowLeak(&mock_obj);` to suppress verifications for intentionally leaked mocks.

---

## Best Practices & Tips

- **Set expectations before exercising the code under test.**
- Use `ON_CALL` for common stub behavior and `EXPECT_CALL` only for calls you want to verify.
- Use `NiceMock` to suppress warnings for uninteresting calls.

Example:
```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> nice_mock_turtle;
EXPECT_CALL(nice_mock_turtle, Forward(100));
```
- Use `StrictMock` to treat unexpected calls as failures.
- Avoid over-specifying arguments unless necessary—use wildcards `_` to allow flexibility.
- Use sequences and `.RetiresOnSaturation()` to handle multiple calls cleanly.

---

## Sample User Flow

1. Define your interface (e.g., `Turtle`).
2. Implement a mock class (e.g., `MockTurtle`) using `MOCK_METHOD`.
3. In your test:
   - Create a mock object.
   - Define default behavior with `ON_CALL` if needed.
   - Specify the calls and arguments you expect with `EXPECT_CALL`.
   - Run your test logic that uses the mock.
4. After the test, GoogleMock verifies your expectations automatically.

---

## Troubleshooting

### Common Issues
- **Uninteresting function call warnings:** Means a mock method was called without an `EXPECT_CALL`.
  - Solution: Use `NiceMock` or add `EXPECT_CALL(...).Times(AnyNumber())` if the call is expected.

- **Compilation errors when mocking methods with commas in types:**
  - Wrap the return type or argument type in parentheses or use `using` aliases.

- **Mock methods not called as expected:** Run tests with `--gmock_verbose=info` to see detailed call matching trace.

- **Virtual destructor missing in base class:** Ensure interfaces have virtual destructors to avoid undefined behavior.

### Tips
- When defining mock classes with many methods, move constructor and destructor definitions out of the header to speed compilation.
- Use sequences and `.RetiresOnSaturation()` to avoid stale expectations.

---

## Next Steps & Related Content

- Explore the **Defining and Using Mock Classes** guide to learn detailed mock creation.
- Read the **Best Practices for Mocking and Expectations** guide to master robust tests.
- Dive into the **Matchers Reference** to flesh out argument matching.
- Learn about **Mock Actions and Defaults** to enhance mocked method behaviors.
- Visit the [GoogleMock official docs](https://google.github.io/googletest/gmock_for_dummies.html) for practical tutorials.

---

## Summary
This page introduces the core concepts of mocking using GoogleMock, focusing on how to define mock classes, set behavior and expectations, and use mocks to isolate code for true unit testing. Understanding these basics unlocks the power of interaction-based testing in C++.

---