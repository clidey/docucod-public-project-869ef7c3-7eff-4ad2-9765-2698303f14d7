---
title: "Introduction to Mocking"
description: "Shows how to create and use mock objects, explaining ON_CALL and EXPECT_CALL macros to define and verify expected behavior, empowering users to test code that depends on complex interfaces."
---

# Introduction to Mocking

This guide explains how to create and use mock objects in GoogleMock, focusing on the use of the `ON_CALL` and `EXPECT_CALL` macros to define behaviors and verify expected interactions with complex interfaces. By the end, you will be empowered to write tests that depend on mocking intricate or abstract components effectively.

---

## Workflow Overview

### Task Description
Learn to build mock classes and specify their expected behaviors and interactions using `MOCK_METHOD`, `ON_CALL`, and `EXPECT_CALL`. This page guides you through defining mocks, setting default behaviors, and verifying that code under test interacts with mocks correctly.

### Prerequisites
- Familiarity with C++ programming.
- GoogleTest and GoogleMock installed and configured.
- Basic understanding of unit testing concepts.

### Expected Outcome
You will be able to:
- Define mock classes using `MOCK_METHOD`.
- Use `ON_CALL` to set default actions on mocks.
- Use `EXPECT_CALL` to write expectations about mock interactions.
- Control mock strictness with `NiceMock`, `NaggyMock`, and `StrictMock`.

### Time Estimate
15 to 30 minutes, depending on familiarity with GoogleMock.

### Difficulty Level
Beginner to Intermediate

---

## Step-by-Step Instructions

### 1. Defining Mock Classes Using `MOCK_METHOD`

Start by deriving your mock class from the interface you want to mock. Declare mock methods using the `MOCK_METHOD` macro inside the public section of your mock class, even if the original methods are protected or private.

```cpp
#include <gmock/gmock.h>

class Foo {
public:
  virtual ~Foo() = default;
  virtual void DoThis() = 0;
  virtual int DoThat(bool flag) = 0;
};

class MockFoo : public Foo {
public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};
```

**Tip:** Enclose complex argument or return types containing commas in extra parentheses or use typedef aliases to avoid parsing errors by `MOCK_METHOD`.

### 2. Setting Default Behavior with `ON_CALL`

Use `ON_CALL` to specify the default action a mock method will perform when called with matching arguments, without setting an expectation that the method must be called.

```cpp
using ::testing::Return;

MockFoo mock_foo;
ON_CALL(mock_foo, DoThat(true))
    .WillByDefault(Return(42));
```

This sets up `DoThat(true)` to return 42 whenever called, but the test does not require the call to happen.

**Important:** Each `ON_CALL` statement must have exactly one `.WillByDefault()` call.

### 3. Writing Expectations with `EXPECT_CALL`

Use `EXPECT_CALL` to set expectations that a mock method will be called with specific arguments, how many times, and optionally how it behaves.

```cpp
EXPECT_CALL(mock_foo, DoThis())
    .Times(1);

EXPECT_CALL(mock_foo, DoThat(_))
    .WillOnce(Return(7));
```

This tells GoogleMock to expect exactly one call to `DoThis()` and that the first call to `DoThat` with any argument will return 7.


### 4. Using Mock Strictness: `NiceMock`, `NaggyMock`, and `StrictMock`

- **`NiceMock`**: Suppresses warnings on uninteresting callsâ€”calls for which there is no `EXPECT_CALL`.

- **`NaggyMock`** (default behavior): Prints warnings on uninteresting calls but allows them.

- **`StrictMock`**: Treats all uninteresting calls as errors, failing the test when such calls occur.

Usage:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
```

This enables you to tailor the mock's strictness depending on how precisely you want to constrain your tests.

### 5. Controlling Call Order and Cardinality

- Use `Times()` inside `EXPECT_CALL` to specify how many times a call is expected (e.g., `.Times(2)`, `.Times(AnyNumber())`).
- Use `InSequence` to force calls to occur in a strict order.

```cpp
{
  ::testing::InSequence s;
  EXPECT_CALL(mock_foo, DoThis()).Times(1);
  EXPECT_CALL(mock_foo, DoThat(true)).Times(1);
}
```

### 6. Verifying Expectations

GoogleMock automatically verifies expectations when mocks are destroyed. If you want to verify earlier, use:

```cpp
::testing::Mock::VerifyAndClearExpectations(&mock_foo);
```

---

## Examples & Practical Scenarios

### Example: Defining a Mock Class and Setting Default Actions

```cpp
class Interface {
public:
  virtual ~Interface() = default;
  virtual int GetValue() const = 0;
  virtual void SetValue(int x) = 0;
};

class MockInterface : public Interface {
public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int x), (override));
};

TEST(MockTest, DefaultBehavior) {
  MockInterface mock;

  ON_CALL(mock, GetValue()).WillByDefault(Return(10));

  // No expectation; GetValue returns 10 by default
  EXPECT_EQ(mock.GetValue(), 10);

  // Set expectation for SetValue
  EXPECT_CALL(mock, SetValue(5)).Times(1);
  mock.SetValue(5);
}
```

### Example: Using `NiceMock` to Suppress Uninteresting Call Warnings

```cpp
#include <gmock/gmock.h>
using ::testing::NiceMock;

class MockWorker {
public:
  MOCK_METHOD(void, DoWork, (), ());
};

TEST(NiceMockTest, SuppressesWarnings) {
  NiceMock<MockWorker> worker;

  // DoWork called without an EXPECT_CALL; no warning generated
  worker.DoWork();

  // Set expectation and verify
  EXPECT_CALL(worker, DoWork()).Times(1);
  worker.DoWork();
}
```

---

## Troubleshooting & Tips

### Common Issues

- **Warnings about Uninteresting Calls:** Means a mock method was called without any `EXPECT_CALL`. Use `NiceMock` or add `EXPECT_CALL(...).Times(AnyNumber())` for those methods you want to ignore.

- **Unexpected Call Errors:** A call was made that doesn't match any `EXPECT_CALL`. Verify the arguments and ensure all expected calls are specified.

- **Multiple `EXPECT_CALL`s on the Same Method:** Remember that gMock matches the last matching expectation first. Put more specific expectations after general ones.

- **Methods Not Marked `virtual`:** GoogleMock can only mock virtual methods (except using advanced templated mocking techniques).

---

### Best Practices

- Use `ON_CALL` to set default behaviors for mock methods you expect to be called, but don't need to verify.
- Use `EXPECT_CALL` sparingly to assert interactions that matter.
- Prefer `NiceMock` for less brittle tests, and use `StrictMock` only for very strict verification.
- Use sequences (`InSequence`) to validate call order only when essential.
- Keep mock classes concise and focused on the interface you're testing.

---

## Next Steps & Related Content

- **Setting Expectations and Verifications:** Learn about advanced expectation ordering and cardinalities in [Defining Expectations and Verifying Behavior](/guides/mocking-techniques/defining-expectations-and-verifying-behavior).
- **Matchers and Actions:** Explore detailed matchers in the [Argument Matchers](/api-reference/mocking-matching-actions/argument-matchers) and action techniques in [Actions and Return Value Control](/api-reference/mocking-matching-actions/actions-and-more).
- **Mocking Patterns & Best Practices:** Gain insight into design patterns and advanced mocking in [Mocking Patterns & Best Practices](/guides/mocking-techniques/mocking-patterns-and-best-practices).
- **GoogleMock Basics:** For newcomers, visit the [GoogleMock at a Glance](/overview/core-concepts-and-terminology/googlemock-intro) introductory page.

---

## Additional Resources

- Official gMock documentation and tutorials:
  - [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
  - [gMock CookBook](https://google.github.io/googletest/gmock_cook_book.html)
  - [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)

- Repository: [googletest on GitHub](https://github.com/google/googletest)

---

For further support and examples, consult the related guides in the documentation navigation map, focusing on mocking, testing structure, and assertion usage to maximize your testing effectiveness.