---
title: "Running Tests Across Platforms"
description: "Learn how GoogleTest and GoogleMock work across major operating systems and compilers. Includes platform-specific configuration tips, flag usage, and advice for embedded or constrained environments."
---

# Running Tests Across Platforms

## Overview
This page helps you understand how GoogleTest and GoogleMock operate seamlessly across a wide range of major operating systems and compilers. It covers essential platform-specific configuration tips, flag usage, and special considerations for embedded or resource-constrained environments, empowering you to write tests that are truly portable and reliable.

GoogleTest and GoogleMock are carefully architected to support diverse build environments, compiler toolchains, and operating systems. This ensures that your tests behave consistently whether you run them on Windows, Linux, macOS, or embedded devices like ESP8266 or NRF52.

---

## Platform Support and Portability

GoogleTest follows Google's [Foundational C++ Support Policy](https://opensource.google/documentation/policies/cplusplus-support), supporting a wide array of compilers and operating systems. Key supported platforms include:

- Linux (including Android)
- Windows (Desktop, Mobile, and variants)
- macOS and iOS
- Embedded platforms such as ESP8266, ESP32, NRF52, and more

For a detailed, current list, consult the [Supported Platforms](https://github.com/google/googletest/blob/main/docs/platforms.md) page.

### Platform-Specific Considerations

GoogleTest detects your platform at compile time via macros and adapts accordingly:

- **POSIX Support**: On Unix-like systems, POSIX features such as pthreads are used for thread safety.
- **Windows Variants**: Different Windows versions, including MinGW, Windows Mobile, and Windows Desktop, are supported with specialized handling.
- **Embedded Systems**: For platforms like ESP8266 and NRF52, GoogleTest offers integration hooks such as `setup()` and `loop()` functions to fit their runtime models.

### Compiler and Feature Detection

GoogleTest identifies available compiler features and adjusts its functionality:

- C++17 or newer is required.
- It detects exception support, RTTI presence, and threading capabilities.
- Based on support, it enables or disables features like death tests, stream redirection, and test parallelization.

This automated detection reduces the manual configuration you must do to maintain compatibility.

---

## Running GoogleTest on Different Platforms

### Desktop & Server Platforms (Linux, Windows, macOS)

By default, GoogleTest runs as a standalone C++ test executable:

1. Tests are registered automatically via macros such as `TEST()` and `TEST_F()`.
2. `RunAllTests()` invokes all tests, reports results with detailed diagnostics.
3. Threading and synchronization are enabled where possible to provide thread-safe test execution.

**Example:**

```cpp
#include <gtest/gtest.h>

TEST(SampleTest, BasicAssertions) {
  EXPECT_EQ(1, 1);
  ASSERT_TRUE(true);
}

int main(int argc, char **argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This main entry point works consistently across platforms. For Windows, quirks like Unicode command-line argument handling are internally managed.

### Embedded Devices (ESP8266, ESP32, NRF52)

Embedded devices often require specialized test invocation due to limited OS services:

- **Initialization:** GoogleMock replaces `InitGoogleTest()` with `InitGoogleMock()`, which initializes both mocking and testing frameworks.
- **Runtime Loop:** Tests are executed within device-specific entry points, typically the `loop()` function for Arduino-style environments.

**Example for ESP8266/ESP32:**

```cpp
extern "C" void setup() {
  testing::InitGoogleMock();  // Initializes both GoogleMock and GoogleTest
}

extern "C" void loop() {
  RUN_ALL_TESTS();  // Runs tests continuously or once depending on usage
}
```

### Special Compiler Flags and Macros

To ensure smooth compilation and linking across platforms, pay attention to the following:

- **Exception Support:** Enable or disable exceptions explicitly with compiler flags. GoogleTest adapts based on detected support.
- **RTTI (Run-Time Type Information):** Required for certain GoogleMock features; disable only if you understand the consequences.
- **Thread Safety:** Use `-DGTEST_HAS_PTHREAD=1` if pthreads detection fails, especially on Unix platforms.
- **Shared vs Static Libraries:** Use `-DGTEST_CREATE_SHARED_LIBRARY=1` to build shared libraries and `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when linking against them.

These flags can be passed to CMake or your build system to configure the tests accordingly.

---

## Platform-Specific Configuration Tips

### Linux
- Ensure pthread development libraries are installed.
- Use standard Linux compilers (GCC, Clang) supporting C++17.
- Death tests and stream redirection are fully supported.

### Windows
- Prefer MSVC 2015 or later for compatibility and bug fixes.
- Specify `gtest_force_shared_crt` when using dynamic runtimes with CMake.
- Use the `gtest_main` or `gmock_main` executable for default `main()` implementations.

### macOS and iOS
- Xcode toolchain supports GoogleTest fully.
- For iOS, embedded testing may require additional setup.

### Embedded Platforms
- Use the provided `setup()` and `loop()` conventions.
- Avoid features that require file system or stream redirection; GoogleTest disables these automatically.

---

## Troubleshooting Common Platform Issues

### Tests Not Running or Crashing
- Verify `main()` or entry functions (`setup()`/`loop()`) are correctly implemented.
- Check for proper initialization of Google Test/Mock via `testing::InitGoogleMock()`.

### Linker Errors
- Ensure you link against the correct GoogleTest or GoogleMock static/shared libraries.
- Confirm that compiler flags for thread support and exception handling are consistent.

### Threading Issues
- On platforms without pthreads, GoogleTest disables threading and synchronization features to avoid errors.
- Use `GTEST_IS_THREADSAFE` macro to determine runtime threading support.

### Platform Macros Not Detected Properly
- Override platform detection with compiler defines if needed (rare on stable toolchains).

---

## Best Practices for Cross-Platform Testing

- Always test your build and tests on all target platforms early in the development cycle.
- Use CMake or other build tools that abstract platform differences and manage compiler flags.
- When targeting embedded platforms, consider the resource limitations and disable features accordingly.
- Link with `gmock_main` for convenience to avoid writing custom `main()` functions except for special cases.

---

## Example: Minimal Test for Linux and Embedded

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

TEST(PlatformTest, AlwaysTrue) {
  EXPECT_TRUE(true);
}

#if defined(GTEST_OS_ESP8266) || defined(GTEST_OS_ESP32) || \
    (defined(GTEST_OS_NRF52) && defined(ARDUINO))
extern "C" void setup() {
  testing::InitGoogleMock();
}

extern "C" void loop() {
  RUN_ALL_TESTS();
}
#else

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
#endif
```

This example compiles and runs across major supported platforms, automatically adapting to embedded or desktop environments.

---

## Further Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [Supported Platforms](https://github.com/google/googletest/blob/main/docs/platforms.md)
- [Building and Integration](https://github.com/google/googletest/blob/main/README.md)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [FAQ: Integration and Troubleshooting](https://github.com/google/googletest/blob/main/faq/common-questions/integration-issues.md)

For embedded platform specifics, examine the `gmock_main.cc` source which implements platform-adaptive entry points.

---

## Diagram: GoogleTest Platform Adaptation Workflow

```mermaid
flowchart TD
    Start([Test Execution Start]) --> PlatformDetect{Detect Platform & Compiler}
    PlatformDetect -->|Desktop/Linux/macOS/Windows| InitDesktop[Initialize GoogleTest/Mock]
    PlatformDetect -->|Embedded (ESP8266, ESP32, NRF52)| InitEmbedded[Initialize GoogleTest/Mock with setup()]

    InitDesktop --> RunTestsDesktop[Run Tests via main() and RUN_ALL_TESTS()]
    InitEmbedded --> LoopEmbedded[Run Tests via loop() and RUN_ALL_TESTS()]

    RunTestsDesktop --> ExitDesktop[Report & Exit with Result Code]
    LoopEmbedded --> ContinueRunning[Repeat loop or Finish]

    ExitDesktop --> End([Test Execution Complete])
    ContinueRunning --> End

    classDef decision fill:#f9f,stroke:#333,stroke-width:2px;
    class PlatformDetect decision;
```

---

## Summary
This page detailed how GoogleTest and GoogleMock adapt and operate across various major platforms and compilers, including special handling for embedded devices. By understanding platform detection, required configurations, and entry points, users can confidently build and run test suites in any supported environment with minimal manual adjustments.

---

<Tip>
For best results, use the `gmock_main` library which provides default `main()` functions according to platform, simplifying cross-platform test binaries.
</Tip>

<Note>
Review your build system flags carefully to ensure compatibility with exception and RTTI settings across all target environments.
</Note>

<Warning>
Avoid assuming threading support on embedded platforms; verify `GTEST_IS_THREADSAFE` where applicable to prevent test failures.
</Warning>
