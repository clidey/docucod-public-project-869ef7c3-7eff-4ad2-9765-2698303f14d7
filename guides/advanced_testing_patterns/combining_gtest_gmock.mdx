---
title: "Integrating GoogleTest and GoogleMock in Real Projects"
description: "Follow best practices for leveraging both GoogleTest and GoogleMock together in production-like workflows. Covers project structure, including and linking libraries, choosing the right test runner, and integrating into continuous integration pipelines."
---

# Integrating GoogleTest and GoogleMock in Real Projects

## Workflow Overview

Integrating GoogleTest and GoogleMock into your C++ projects enables you to leverage the full power of modern testing and mocking frameworks seamlessly. This guide focuses on establishing effective project structures, linking the appropriate libraries, selecting the right test runner, and adopting CI-friendly workflows, ensuring your tests are robust, maintainable, and fully automated.

### Prerequisites

- Familiarity with C++ project development and build systems (CMake, Bazel, or other).
- GoogleTest and GoogleMock source or binary installed and available in your environment.
- Basic understanding of test writing with GoogleTest and mock usage with GoogleMock.
- Working knowledge of CI tools and pipelines where tests will be integrated.

### Expected Outcome

- A clear project layout that supports GoogleTest and GoogleMock for production-like testing workflows.
- Correct configuration and linking of GoogleTest and GoogleMock libraries.
- Understanding of test runner choices specific to GoogleMock.
- Guidance on integrating tests into continuous integration systems.

### Time Estimate

Expect to spend 30-60 minutes setting up a typical integration workflow, depending on your existing build system experience.

### Difficulty Level

Intermediate — assumes working knowledge of C++ build workflows and basic testing paradigms.

---

## Step-by-Step Integration Instructions

### 1. Organize Your Project Structure

Your tests should be organized separately from your production code to keep clear boundaries and ease maintenance. Consider the following structure:

```
/project-root
  /src               # Production sources
  /include           # Header files
  /tests             # Test sources
    /mocks           # Mock class headers and sources
    /unit            # Unit test cases
    /integration     # Integration test cases
  CMakeLists.txt     # Or your chosen build system config
```

**Best Practice:** Put mock class definitions close to their interfaces, possibly in a `mocks` directory with testonly visibility, to simplify updates when interfaces change.

---

### 2. Include GoogleTest and GoogleMock Libraries

If you are using CMake, you can leverage system-installed or locally built libraries of GoogleTest and GoogleMock.

Example `CMakeLists.txt` snippet to link GoogleMock with main() defined:

```cmake
find_package(gmock_main REQUIRED)  # Finds gmock_main.pc using pkg-config

target_link_libraries(your_test_target PRIVATE gmock_main)
```

- `gmock_main` provides the GoogleMock library **with** a test runner main() function.
- Linking `gmock_main` means you don't need to define your own `main()` in tests.
- For pure GoogleMock without main(), link `gmock` and provide your own `main()` as needed.

---

### 3. Choose Your Test Runner Approach

You can run tests via:

- **Linking with `gmock_main`** — Simplest option; use `RUN_ALL_TESTS()` directly in your test binary.
- **Custom `main()` function** — Allows initialization customization by calling `testing::InitGoogleMock()` before running tests.

**Example minimal main():**

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

**Tip:** Prefer linking with `gmock_main` unless you need special test setup.

---

### 4. Integrate with Your Continuous Integration Pipelines

To run your GoogleTest/GoogleMock tests in CI environments:

- Ensure the test executable is built as part of your CI pipeline.
- Run the test binary with any required command-line flags.
- Capture test results in a suitable format (e.g., XML) for reporting tools.

Example run command for XML output:

```
./your_test_executable --gtest_output=xml:report.xml
```

Configure your CI server (e.g., Jenkins, GitLab CI, GitHub Actions) to parse and display these reports.

**Best Practice:** Use `--gmock_verbose` flag to control test output verbosity during debugging.

---

### 5. Continuous Feedback and Maintenance

- Always assert test outcomes by checking return codes or report statuses.
- Use `ON_CALL()` to set default mock behaviors and `EXPECT_CALL()` only to set verifiable expectations.
- Regularly update mock classes when underlying interfaces evolve.

---

## Practical Examples

### Linking GoogleMock in CMake

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyProject)

find_package(gmock_main REQUIRED)

add_executable(my_tests
  tests/my_test.cc
  mocks/mock_foo.cc
)

target_include_directories(my_tests PRIVATE
  include
  ${gmock_main_INCLUDEDIR}
)

target_link_libraries(my_tests PRIVATE gmock_main)
```

### Simple GoogleMock main() example

```cpp
#include <gmock/gmock.h>

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Running tests in CI with XML output

```bash
./my_tests --gtest_output=xml:results/test_results.xml
```

Save and archive the XML file via your CI infrastructure for detailed test reporting.

---

## Troubleshooting & Tips

- **Linker errors when linking with GoogleMock:**
  - Verify you link against `gmock_main` for an automatic test main() or `gmock` plus your custom main().
  - Check that `CMAKE_INSTALL_FULL_LIBDIR` and include paths are correct in your build environment.

- **Tests not running or tests discovered is zero:**
  - Confirm tests are registered properly (using TEST or TEST_F macros).
  - Ensure your `main()` calls `InitGoogleMock()` (or link with `gmock_main`).

- **Uninteresting mock function call warnings:**
  - Switch to `NiceMock` wrapper to suppress unnecessary warning noise during development.
  - Avoid excessive `EXPECT_CALL`s on mock methods unless behavior verification is intended.

- **Performance considerations:**
  - Split mocks and test fixtures into smaller units.
  - Use `ON_CALL()` for default mock behavior to reduce test instability.

- **CI pipeline stability:**
  - Always check test exit codes; this prevents CI from marking tests successful on failures.
  - Use test filters (e.g., `--gtest_filter`) to run subsets of tests if needed.

---

## Next Steps & Related Content

- **Explore advanced testing patterns:**
  - [Parameterized Tests](../advanced_testing_patterns/parameterized_tests)
  - [Custom Matchers and Assertions](../advanced_testing_patterns/using_matchers_assertions)
- **Mocking mastery:**
  - Consult the [Mocking Cookbook](gmock_cook_book.md) and [Cheat Sheet](docs/gmock_cheat_sheet.md) for robust mocking strategies.
- **Continuous Integration Integration:**
  - See [Integration & Ecosystem](overview/architecture-overview/integration-ecosystem) for platform-specific tips and best practices.

For foundational knowledge, visit the [GoogleTest Primer](docs/primer.md) to brush up on key concepts applicable during integration.

---

## Visual Summary: Integration Workflow Diagram

```mermaid
flowchart TD
  A[Define Production Code] --> B[Write Test Code]
  B --> C[Define Mock Classes]
  C --> D[Configure Build & Link with gmock_main]
  D --> E[Compile Test Executable]
  E --> F[Run Tests via RUN_ALL_TESTS()]
  F --> G[Test Results & Reports]
  G --> H[Integrate Results into CI Pipeline]
  H --> F
```

This workflow depicts the cyclical nature of developing and maintaining well-tested code integrated with GoogleTest and GoogleMock, smoothly flowing into CI automation.
