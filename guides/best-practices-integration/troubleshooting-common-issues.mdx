---
title: "Troubleshooting and FAQs"
description: "Solutions to common problems, pitfalls, and frequently asked questions encountered when using GoogleTest/GoogleMock, including error diagnostics and integration challenges."
---

# Troubleshooting and FAQs

Solutions to common problems, pitfalls, and frequently asked questions encountered when using GoogleTest/GoogleMock, including error diagnostics and integration challenges.

---

## 1. Diagnosing Common Mocking Issues

### Symptom: The Real Method Is Invoked Instead of the Mock

**What happens:** You call a method on your mock object, but instead of the mock's behavior, the real object's method is being executed.

**Cause:** The method is not declared **virtual** in the interface or base class.

**How to fix:**

- Ensure that all methods you want to mock are declared as `virtual`.
- For non-virtual methods, see [mocking non-virtual methods](gmock_cook_book.md#MockingNonVirtualMethods) in the gMock Cookbook for alternative strategies.

### Symptom: Warnings from MSVC About Const Parameters in Mock Methods

**What happens:** You encounter warnings such as `C4301` or `C4373` when mocking methods with `const` parameters.

**Explanation:**

- In C++, the top-level `const` on a parameter passed by value is ignored during method declaration, but older MSVC compilers can emit warnings.

**How to fix:**

- Remove the top-level `const` qualifier from parameters in both base and mock class method declarations.
- Keep `const` for pointer or reference parameters where it matters.

### Symptom: Unexpected Call Failures

**What happens:** Your test reports an unexpected call to a mock method.

**Common causes:**

- No matching `EXPECT_CALL()` was set up for the method call with given arguments.
- Argument values do not match any specified matchers.
- The call order does not satisfy ordering constraints (`InSequence`, `After`).

**How to debug:**

- Run your test with `--gmock_verbose=info` to get detailed logs of mock calls and expectations.
- Review the messages to see which expectation each call matched or why it was unexpected.

### Symptom: "Uninteresting Function Call" Warning

**What happens:** When a mock method without any `EXPECT_CALL` is invoked, the test outputs warnings about uninteresting calls.

**Explanation:**

- gMock warns on calls to mocked methods that have no expectations set, as these may indicate undeclared calls.

**Options:**

- Change to a `NiceMock` wrapper around your mock class to suppress these warnings.
- Explicitly add a catch-all expectation to allow those calls:

```cpp
EXPECT_CALL(mock_object, Method(_)).Times(AnyNumber());
```

- Use `ON_CALL()` to set default behavior without setting strict expectations.

### Symptom: "Actual function call count doesn't match this expectation" or "Excessive Call" Failures

**What happens:** A mock method was called more times than specified in the `.Times()` clause.

**Common causes:**

- The cardinality specified is too tight.
- Multiple expectations conflict or overlap.

**How to fix:**

- Adjust cardinality using flexible cardinalities like `AtLeast(n)`, `AnyNumber()`, or ranges using `Between(m,n)`.
- Use `.RetiresOnSaturation()` on expectations to make them inactive once saturated.

### Symptom: "Actions ran out" Warning

**What happens:** Firing a mock method exceeding the number of specified `WillOnce()` clauses.

**Explanation:**

- The number of `WillOnce()` clauses in `EXPECT_CALL()` is less than the expected call count without `WillRepeatedly()`.

**How to fix:**

- Add a `WillRepeatedly()` clause to specify behavior beyond the initial ones.
- Or specify the exact number of calls with `Times()` matching the number of `WillOnce()` clauses.

### Symptom: Test Fails Because Mock Object Was Never Deleted

**Cause:**

- Mock verification happens in the mock's destructor. If a mock object is never deleted, verification is skipped.

**Solution:**

- Ensure mock objects are appropriately destroyed.
- Use the heap checker in tests.
- Or explicitly call `Mock::VerifyAndClearExpectations(&mock_obj);` to verify before destruction.

---

## 2. Best Practices and Proactive Tips

### Setting Expectations Correctly

- Always set `EXPECT_CALL()` **before** the mocked method is invoked.
- Use matchers like `_` to avoid overly strict argument matching.

### Handling Overloaded Methods

- Use `Const()` wrapper for const overloaded method versions.
- Help disambiguate overloads using explicit matchers or casts.

### Order of Expectations Matters

- Newer `EXPECT_CALL()` statements override older ones.
- For call order enforcement, use `InSequence` block or `After()` clause explicitly.

### Use `ON_CALL()` to Define Default Behaviors

- `ON_CALL()` sets the mock method's behavior when no explicit expectation matches.
- Does not enforce that the call happens, which leads to less brittle tests.

### Mock Objects Strictness Modes

- Use `NiceMock` to suppress warnings for uninteresting calls.
- Use `StrictMock` to make such calls test failures.

### Delegating to Fakes or Real Objects

- Consider delegating mock calls to real implementations for default behavior to reduce maintenance overhead.

### Using `RetiresOnSaturation()` to Manage Repeated Calls

- Prevents overly strict upper bounds from causing errors on repeated calls once saturated.

### Verifying Mocks Explicitly

- Use `Mock::VerifyAndClearExpectations()` to force verification at any point.

### Avoid Mocking Classes You Do Not Own

- Create adaptor interfaces you own to mock safely.

---

## 3. Frequently Asked Questions

### Q1: Can I Mock Non-Virtual Methods?

- Direct mocking of non-virtual methods is not supported. Use techniques such as templated dependency injection or wrappers as described in the gMock Cookbook.

### Q2: How Do I Test That a Method Is Never Called?

- Use `.Times(0)` on the expectation:

```cpp
EXPECT_CALL(mock_obj, Method(_)).Times(0);
```

### Q3: How Can I Control the Number of Calls to a Mock Method?

- Use the `Times()` clause with cardinalities like `Exactly(n)`, `AtLeast(n)`, `AtMost(n)`, or `AnyNumber()`.

### Q4: Why Do Mocks Report Failures Twice for the Same Expectation?

- Because failures are reported at the time of occurrence and sometimes at verification time—they tell about the state of mock expectations at those distinct points.

### Q5: How Does gMock Differentiate Between Unexpected and Uninteresting Calls?

- **Unexpected Calls:** Calls that do not match any active `EXPECT_CALL` expectation. They cause test errors.
- **Uninteresting Calls:** Calls to mock methods without any `EXPECT_CALL` set. They cause warnings unless suppressed.

### Q6: How Do I Deal with Move-Only Types in Mocked Methods?

- Use the standard `MOCK_METHOD` macro to mock methods taking or returning move-only types.
- Set return values using lambdas or callable objects rather than `Return(std::move(...))` to avoid moved-from errors.
- For legacy approaches, delegate to non-move parameter mock methods.

### Q7: How Do I Mock Methods With Complex or Long Argument Lists?

- Consider redefining a mock method with a simplified interface and delegating the original call.
- Use matchers to ignore uninteresting arguments or combine matchers with `AllOf()`.

### Q8: Can I Mock Free Functions or Static Methods?

- Not directly. Wrap free functions behind interfaces and mock the interfaces.

---

## 4. Troubleshooting Integration and Setup

### Runtime Library Mismatches on Windows

- Ensure consistent runtime library usage between GoogleTest/GoogleMock and your project (e.g., Multi-threaded DLL).

### Compiler Errors on Macro Parsing

- Wrap return types or argument types containing commas in extra parentheses or use type aliases to resolve parsing errors in `MOCK_METHOD`.

### Build Issues with C++17 Compatibility

- Confirm the compiler supports C++17 and build scripts specify the standard.

### Using Alternative Build Systems

- Follow specific guidelines for Bazel or pkg-config integration.

---

## 5. Diagnostic Tools and Flags

- **`--gmock_verbose=<level>`** controls logging verbosity:
  - `info` — Logs all calls and expectations with stack traces.
  - `warning` (default) — Logs warnings and errors without stack traces.
  - `error` — Logs only errors.

- **Heap checking** to verify allocation correctness.

- **`Mock::AllowLeak()`** to ignore leak warnings for mocks deliberately kept alive.

---

## 6. Example: Diagnosing an Unexpected Call

```cpp
// Suppose this test fails due to an unexpected call:
EXPECT_CALL(mock, Foo(5));

// Code under test:
mock.Foo(3);
```

Run test with verbose logging:

```bash
test_binary --gmock_verbose=info
```

Look for the log showing which expectation the call matched or why it failed.

Use diagnostic info to adjust your expectations or code.

---

## 7. Useful Links

- [gMock for Dummies](gmock_for_dummies.md) — Introductory tutorial on setting up and using mock objects.
- [Mocking Reference](reference/mocking.md) — Detailed macro and class documentation.
- [gMock Cookbook](gmock_cook_book.md) — Recipes for advanced mocking patterns.
- [Legacy gMock FAQ](gmock_faq.md) — Frequently asked questions with detailed answers.
- [Mocking Cheat Sheet](gmock_cheat_sheet.md) — Quick syntax and command reference.
- [Installation and Setup](guides/getting-started/installing-and-setting-up.mdx) — For environment setup and validation.

---

## 8. Additional Pro Tips

- When adding `EXPECT_CALL` with overlapping matchers, place the more specific ones after generic ones to ensure correct precedence.
- Use `RetiresOnSaturation()` for expectations that should not remain active once satisfied.
- Prefer `ON_CALL` for default behaviors and `EXPECT_CALL` only when you want to enforce interaction expectations.
- Keep mock destructors virtual to ensure proper cleanup and verification.
- Guard tests with `ASSERT_*` when failure should prevent further execution to avoid crashes or leaks.

---