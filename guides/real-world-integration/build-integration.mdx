---
title: "Integrating GoogleTest with CMake and Bazel"
description: "Walks users through adding GoogleTest to their CMake or Bazel projects, including dependencies, test targets, and cross-platform configuration. Provides troubleshooting tips and links to example setups."
---

# Integrating GoogleTest with CMake and Bazel

## Overview

This guide walks you through the process of adding GoogleTest to your C++ projects using the CMake and Bazel build systems. It covers how to manage dependencies, define test targets, and configure your project for cross-platform compatibility. Additionally, troubleshooting tips are provided along with references to example setups to streamline your integration process.

### Who Should Use This Guide

Developers and teams aiming to incorporate GoogleTest into their projects via CMake or Bazel will find this guide valuable. It assumes a basic understanding of these build systems and focuses on practical steps to get GoogleTest tests compiled and running efficiently.

---

## Prerequisites

Before you start, ensure that:

- Your development environment supports C++17 or later.
- You have a working CMake or Bazel setup configured for your project.
- You have Git installed to clone GoogleTest repositories if needed.
- Basic familiarity with writing tests using GoogleTest macros (e.g., `TEST()`, `TEST_F()`).

If you haven't set these up, please refer to the [GoogleTest Prerequisites & Supported Platforms](https://github.com/google/googletest/blob/main/docs/getting-started/prerequisites-installation/system-requirements.md) and [Writing and Running Your First Test](https://github.com/google/googletest/blob/main/guides/gtest-core-workflows/writing-and-running-tests.md) guides.

---

## Expected Outcome

By following this guide, you will successfully:

- Integrate GoogleTest and GoogleMock into your existing CMake or Bazel project.
- Define and build test targets that compile with those frameworks.
- Configure project settings to work on various platforms including Windows, Linux, and macOS.
- Understand how to troubleshoot common integration issues.

---

## Time Estimate

The integration process typically takes between 15 to 30 minutes depending on your project's complexity and familiarity with the build tools.

---

## Difficulty Level

Intermediate — requires basic knowledge of C++ build systems and test frameworks.

---

# Section 1: Integrating GoogleTest with CMake

## 1. Adding GoogleTest as a Dependency

GoogleTest can be added to your CMake project either by including it as a subdirectory or by FetchContent. Both methods allow seamless integration and building alongside your code.

### Using add_subdirectory

If you have included the GoogleTest source code in your project tree (or as a submodule), use:

```cmake
# Assuming googletest directory exists in your project
add_subdirectory(googletest)

# Add your test executable
add_executable(my_tests test_main.cpp my_code_under_test.cpp)

# Link GoogleTest and GoogleMock libraries
target_link_libraries(my_tests PRIVATE gtest gmock gtest_main)

# Enable testing
enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```

### Using FetchContent for Automatic Download

If you prefer GoogleTest to be automatically fetched during the build, use this approach (requires CMake 3.14+):

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.tar.gz
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_code_under_test.cpp)

target_link_libraries(my_tests PRIVATE gtest gmock gtest_main)

enable_testing()
add_test(NAME MyTests COMMAND my_tests)
```


## 2. Configuring Test Targets

- Link against `gtest` and `gmock` for test functionality.
- Use `gtest_main` or `gmock_main` if you want to link in the main function provided by GoogleTest or GoogleMock, which automatically initializes and runs tests.

### Example `CMakeLists.txt` excerpt:

```cmake
add_executable(example_tests example_test.cpp)
target_link_libraries(example_tests PRIVATE gtest_main gmock)

enable_testing()
add_test(NAME ExampleTests COMMAND example_tests)
```

### Important Notes:

- Use `target_link_libraries` with `PRIVATE` scope to limit exposure.
- Prefer linking `gtest_main` or `gmock_main` if you don't want to implement your own `main()`.
- Confirm that your compiler supports C++17 via `set(CMAKE_CXX_STANDARD 17)`.


## 3. Cross-Platform Configuration

GoogleTest's CMake scripts handle cross-platform nuances, but keep in mind:

- On Windows, consider setting the option `gtest_force_shared_crt` to handle runtime library compatibility.
- On platforms that require pthreads, CMake configuration will usually detect and link automatically.

Example for Windows dynamic runtime:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "Use dynamic runtimes for GoogleTest")
```

## 4. Building and Running Your Tests

Once configured, build your tests:

```sh
mkdir build && cd build
cmake ..
cmake --build .
ctest
```

Or run your test executable directly:

```sh
./my_tests
```


---

# Section 2: Integrating GoogleTest with Bazel

## 1. Setting Up Workspace Dependencies

In your `WORKSPACE` file, add GoogleTest as an external dependency:

```starlark
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.11.0.zip"],
    strip_prefix = "googletest-release-1.11.0",
)
```

(Note: Adjust version as needed.)

## 2. Defining Test Targets

Use Bazel's `cc_test` rule to create test targets linked against GoogleTest.

Example `BUILD` file:

```python
load("@com_google_googletest//:bazel/repositories.bzl", "googletest")

cc_test(
    name = "my_tests",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

## 3. Running Tests

Execute tests with Bazel:

```sh
bazel test //path/to:my_tests
```

Bazel automatically manages dependencies including `gtest` and `gmock` binaries.

---

# Section 3: Common Troubleshooting Tips

### Issue: Tests Link Errors

- Ensure you link both `gtest` and `gmock` libraries as required.
- If using `gmock_main`, link only with `gmock_main` (it includes GoogleTest).
- On Windows, verify runtime library settings with `gtest_force_shared_crt`.

### Issue: C++ Standard Version Compilation Failures

- Confirm your compiler supports C++17.
- In CMake, set `CMAKE_CXX_STANDARD` to `17` or later.

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### Issue: Tests Not Running or Showing No Output

- Ensure `InitGoogleTest()` or `InitGoogleMock()` is called before `RUN_ALL_TESTS()`.
- When using `gtest_main` or `gmock_main`, this is handled automatically.
- Confirm tests are not disabled by naming (`DISABLED_` prefix).
- Check command line filtering flags (e.g., `--gtest_filter`).

### Issue: Threading or Platform-Specific Errors

- On POSIX systems, verify your build includes pthread flags (CMake does this automatically).
- On embedded platforms (ESP8266, ESP32, NRF52), special main loops may be required (see GoogleMock examples).

---

# Section 4: Example Configurations

### CMake Minimal Example

```cmake
cmake_minimum_required(VERSION 3.13)
project(MyProject CXX)

# Fetch GoogleTest
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.11.0.zip
)
FetchContent_MakeAvailable(googletest)

# Build the test executable
add_executable(my_test test.cpp)

# Link against gtest and gmock
target_link_libraries(my_test PRIVATE gtest_main gmock)

# Enable testing and add tests
enable_testing()
add_test(NAME BasicTest COMMAND my_test)
```

### Bazel Minimal Example

```python
load("@com_google_googletest//:bazel/repositories.bzl", "googletest")

cc_test(
    name = "my_test",
    srcs = ["test.cpp"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

---

# Section 5: Additional Resources

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md) - Learn how to write tests.
- [GoogleTest Integration with Other Systems](https://github.com/google/googletest/blob/main/overview/audience-usecases-integration/integration-with-other-systems.md) - Integrate with CI tools and IDEs.
- [Troubleshooting Common Issues](https://github.com/google/googletest/blob/main/getting-started/first-steps-validation/troubleshooting-common-issues.md) - Resolve setup or runtime problems.
- [GoogleMock User’s Guide](https://github.com/google/googletest/blob/main/googlemock/README.md) - Get help integrating mocks.

---

# Summary

This documentation explained how to integrate GoogleTest with CMake and Bazel projects. It focused specifically on setting up dependencies, defining test targets, managing cross-platform configurations, building, running tests, and troubleshooting common pitfalls. Minimal example build configurations were provided for hands-on reference.

For your integration to succeed, ensure your environment meets C++17 requirements, carefully link the necessary GoogleTest and GoogleMock libraries, and correctly initialize GoogleTest in your test executables. Consider using the existing `gtest_main` or `gmock_main` libraries to simplify entry point setup.

Effective test integration empowers efficient, maintainable unit testing with GoogleTest in real-world C++ projects.


---

<AccordionGroup title="Troubleshooting Tips">
<Accordion title="Common Link Errors">
Link errors often arise from missing `gtest` or `gmock` libraries in the link command or incorrect linkage between `gmock` and `gtest`. Ensure that your `target_link_libraries` includes all necessary libraries—linking with `gmock_main` alone suffices as it also links `gtest`.
</Accordion>
<Accordion title="Runtime Failures or No Tests Run">
Make sure `testing::InitGoogleTest()` or `testing::InitGoogleMock()` is called before `RUN_ALL_TESTS()`. When using `gtest_main` or `gmock_main`, this happens automatically. Also verify that your tests are not disabled via the `DISABLED_` prefix and that no test filtering is suppressing test runs.
</Accordion>
<Accordion title="Compiler Support Issues">
Verify your compiler supports C++17 or later, and set the proper standard flag in your build system:
```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```
</Accordion>
</AccordionGroup>