---
title: "Continuous Integration & Build System Integration"
description: "How to integrate GoogleTest and GoogleMock into popular CI pipelines and build system configurations. Includes actionable examples and tips for seamless automation in development workflows."
---

# Continuous Integration & Build System Integration

## Overview

This guide provides practical, actionable steps to integrate GoogleTest and GoogleMock into your continuous integration (CI) pipelines and build system configurations. Whether you use CMake, pkg-config, or other popular build tools, this document helps you automate your tests smoothly as part of your development workflow.

By following this guide, you'll learn how to set up GoogleTest and GoogleMock in your build environment, incorporate them into your CI system, and avoid common pitfalls to achieve reliable automated testing.

---

## Prerequisites

Before you begin:

- You should have a working C++ project to test.
- C++ compiler support for at least C++17.
- Access to your preferred build system, ideally CMake since it is fully supported.
- Basic familiarity with your CI environment (Jenkins, GitHub Actions, GitLab CI, etc.).
- GoogleTest and GoogleMock source or installed libraries available.

---

## Expected Outcome

- GoogleTest and GoogleMock integrated into your build system.
- Automated tests running as part of your CI pipeline.
- Ability to detect test failures and report CI status accurately.

---

## Time Estimate

About 30â€“60 minutes depending on your familiarity with build systems and CI.

---

## Difficulty Level

Intermediate: some build system and CI configuration experience required.

---

# Step-by-Step Integration Instructions

## 1. Building GoogleTest and GoogleMock with CMake

GoogleTest provides a cross-platform CMake build setup that includes GoogleMock by default.

### a. Standalone GoogleTest Build

1. Clone the GoogleTest repository:

```bash
git clone https://github.com/google/googletest.git -b v1.17.0
dcd googletest
```

2. Create and enter a build directory:

```bash
mkdir build
cd build
```

3. Generate native build files (includes GoogleMock):

```bash
cmake ..
```

- To build only GoogleTest (no GoogleMock), run:

```
cmake .. -DBUILD_GMOCK=OFF
```

4. Build the libraries:

```bash
make
```

5. (Optional) Install GoogleTest system-wide (requires admin privileges):

```bash
sudo make install
```

- For Windows, open the generated `gtest.sln` in Visual Studio and build.
- On macOS, use the generated Xcode project.

### b. Incorporating GoogleTest/GoogleMock into Your Existing CMake Project

GoogleTest works well integrated within your project:

- You can add GoogleTest sources as a git submodule or download them manually.
- In your `CMakeLists.txt`, add:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # Adjust for Visual Studio dynamic runtime
FetchContent_MakeAvailable(googletest)

add_executable(your_tests your_tests.cpp)
target_link_libraries(your_tests gtest_main gmock_main)
add_test(NAME your_tests COMMAND your_tests)
```

**Note:** Requires CMake 3.14 or later.

---

## 2. Linking and Compiler Flags

### a. C++ Standard
Make sure your project enforces C++17 or later:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### b. Threading Support
GoogleTest detects pthread support automatically. If your environment is non-standard, you can force pthread availability:

- To force pthread support:

```bash
-DGTEST_HAS_PTHREAD=1
```

- To disable pthread support:

```bash
-DGTEST_HAS_PTHREAD=0
```

Ensure the proper compiler and linker flags to link pthread if not using CMake scripts.

### c. Shared vs Static Libraries on Windows
By default, GoogleTest builds static libs, but your project may use dynamic runtimes. To avoid linker errors due to mismatched runtimes, enable dynamic CRT linkage with:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

### d. Avoiding Macro Name Conflicts
If you encounter macro name conflicts with other libraries, you can prevent GoogleTest from defining certain macros by passing flags like:

```
-DGTEST_DONT_DEFINE_TEST=1
```
Then you must prefix macro names with `GTEST_`, e.g., `GTEST_TEST()` instead of `TEST()`.

---

## 3. Using pkg-config for Build System Integration

GoogleTest provides pkg-config files to simplify compiler and linker flag management.

### a. Incorporate pkg-config in CMake

```cmake
find_package(PkgConfig)
pkg_search_module(GTEST REQUIRED gtest_main)

add_executable(testapp samples/sample3_unittest.cc)
target_link_libraries(testapp PRIVATE ${GTEST_LDFLAGS})
target_compile_options(testapp PRIVATE ${GTEST_CFLAGS})

enable_testing()
add_test(NAME first_and_only_test COMMAND testapp)
```

### b. Troubleshooting pkg-config

If `pkg-config` cannot find GoogleTest, ensure the `.pc` files are discoverable by setting:

```bash
export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig
```

Adjust this to your installation path.

### c. Cross-Compilation

Define environment variables to enable sysroot-aware pkg-config:

```bash
export PKG_CONFIG_ALLOW_SYSTEM_CFLAGS=yes
export PKG_CONFIG_ALLOW_SYSTEM_LIBS=yes
export PKG_CONFIG_SYSROOT_DIR=/path/to/sysroot
export PKG_CONFIG_LIBDIR=${PKG_CONFIG_SYSROOT_DIR}/usr/lib64/pkgconfig
```

This ensures correct paths during cross-compilation.

---

## 4. Continuous Integration Pipeline Integration

### a. Automating Builds and Tests

- Incorporate your CMake build commands into CI scripts:

```bash
mkdir build && cd build
cmake ..
make -j
ctest --output-on-failure
```

- Use `ctest` or invoke your test binary directly to run tests.

### b. Test Reporting

- GoogleTest supports XML output with `--gtest_output=xml:<path>` flag.
- Configure your CI parser to consume these XML reports for test result visualization.

Example:

```bash
./your_tests --gtest_output=xml:test_results.xml
```

- Integrate this into Jenkins, GitHub Actions, GitLab, or other CI tools for test reporting.

---

## 5. Best Practices & Tips

- **Use the GoogleTest CMake integration**: Leverage official `FetchContent` or submodule methods to keep GoogleTest up-to-date and tightly integrated.
- **Match compiler flags**: Especially on Windows, ensure your main project and GoogleTest use the same runtime linkage (`/MD` vs `/MT`).
- **Run tests on multiple platforms in your CI pipeline** to verify portability.
- **Use `gtest_main` library** to avoid writing custom `main()` unless customization is needed.
- **Limit the scope of test macros** to avoid macro name conflicts by defining `DGTEST_DONT_DEFINE_*` flags as needed.

---

## 6. Troubleshooting Common Issues

### a. Build Failures / Linker Errors

- Verify C++17 standard is enforced.
- Check runtime linkage mismatch on Windows and use `gtest_force_shared_crt` if needed.
- Ensure pthread flags are set if your system requires them.

### b. Tests Not Discovering or Running

- Confirm `RUN_ALL_TESTS()` is used in the main entry point.
- Verify tests are correctly linked to `gtest` or `gtest_main`.
- Make sure `InitGoogleTest()` is called before running tests.

### c. pkg-config Can't Find GoogleTest

- Set `PKG_CONFIG_PATH` to where `.pc` files are installed.
- For cross-compilation, set `PKG_CONFIG_SYSROOT_DIR` and `PKG_CONFIG_LIBDIR` properly.

### d. Test Macro Conflicts

- Use `-DGTEST_DONT_DEFINE_TEST=1` and prefix test macros with `GTEST_` if macros clash.

---

## 7. Next Steps & Related Content

- Explore [GoogleTest Primer](https://google.github.io/googletest/primer.html) for test writing basics.
- Read the [GoogleTest Advanced Guide](../advanced.md) for more complex usage.
- Consult the [Integration with Other Systems](../overview/integration-and-ecosystem/integration-points.md) guide for ecosystem tools.
- Review [Using pkg-config](../docs/pkgconfig.md) for advanced build integration.
- Visit the [Getting Started Guides](../guides/getting-started-workflows/setup-quickstart.md) for setup workflows.


---

# Summary

This guide walks you through integrating GoogleTest and GoogleMock into your CI pipelines and build systems with practical CMake examples and pkg-config usage. It covers building GoogleTest standalone or embedded, ensuring compatible compiler flags, handling threading and runtime linkage, and leveraging test automation in CI environments. Troubleshooting tips and best practices help ensure smooth test automation.

## Key Sections

- Building GoogleTest/GoogleMock with CMake
- Compiler and Linker Setup
- Using pkg-config for build flags
- CI Pipeline Automation
- Troubleshooting
- Best Practices

## Important Links

- GoogleTest Primer: https://google.github.io/googletest/primer.html
- Using pkg-config guide: /docs/pkgconfig.md
- Getting Started Quickstart: /guides/getting-started-workflows/setup-quickstart.md
- Integration Points: /overview/integration-and-ecosystem/integration-points.md

## Cross-References

For writing tests: see the [GoogleTest Primer](../docs/primer.md).
For advanced mocking scenarios, consult the [GoogleMock README](../googlemock/README.md).

This documentation is intended to fit into the broader GoogleTest User's Guide ecosystem, focusing specifically on continuous integration and build automation.
