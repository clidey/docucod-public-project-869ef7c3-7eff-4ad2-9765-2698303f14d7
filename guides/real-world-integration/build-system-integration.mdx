---
title: "Integrating with Build Systems"
description: "Actionable steps to integrate GoogleTest and GoogleMock into CMake and Bazel projects, handling dependencies, and automating test runs as part of CI pipelines."
---

# Integrating with Build Systems

## Overview

This guide provides actionable instructions to integrate **GoogleTest** and **GoogleMock** into your C++ project build environment using popular systems like **CMake** and **Bazel**. It covers managing dependencies, building tests, linking required libraries, and automating test runs within continuous integration (CI) pipelines.

---

## Prerequisites

Before integrating GoogleTest and GoogleMock with your build system, ensure the following:

- Your development environment supports at least **C++17**.
- You have access to GoogleTest and GoogleMock sources or pre-built binaries.
- Your build environment is compatible with your chosen build system (CMake or Bazel).
- Familiarity with your project’s existing build configuration and workflows.

---

## Integration with CMake

GoogleTest provides robust support for CMake, making integration straightforward.

### Step 1: Fetch or install GoogleTest

You can either clone the GoogleTest repository as a submodule or use CMake's `FetchContent` to download GoogleTest during configuration.

#### Option A: Add GoogleTest as a Git submodule

```bash
git submodule add https://github.com/google/googletest.git external/googletest
```

Add this directory via `add_subdirectory()` in your `CMakeLists.txt`.

#### Option B: FetchContent method (recommended to keep your project lean)

Insert the following into your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)

# Avoids overriding your project’s compiler/linker settings on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```


### Step 2: Link test targets against GoogleTest and GoogleMock

Create your test executable and link it with the `gtest_main` or `gmock_main` libraries.

```cmake
add_executable(my_test test_example.cpp)
target_link_libraries(my_test gtest_main gmock_main)
add_test(NAME MyTest COMMAND my_test)
```

GoogleMock is included with GoogleTest by default with `gmock_main`.


### Step 3: Configure compiler flags

Ensure your C++ standard is set to at least C++17:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```


### Step 4: Build and run tests

At the command line in the build directory:

```bash
cmake ..
cmake --build .
ctest --verbose
```

This runs your tests and reports results.

---

## Integration with Bazel

Bazel users can easily integrate GoogleTest and GoogleMock via Bazel Central Registry or direct workspace declaration.

### Step 1: Declare GoogleTest dependency

Add googletest to your `MODULE.bazel` or `WORKSPACE` file:

```bazel
bazel_dep(name = "com_google_googletest", version = "1.17.0")
```

### Step 2: Write your test

Example `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 3: Create a BUILD file

Define the cc_test and link dependencies:

```bazel
cc_test(
    name = "hello_test",
    srcs = ["hello_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

Use `gtest_main` to provide an automatic main function suitable for test runs.

### Step 4: Build and run

Execute:

```bash
bazel test //:hello_test
```

Builds and runs the test, reporting the results.

---

## Automating in Continuous Integration (CI)

Integrating test runs in your CI pipelines ensures consistent quality checks.

### Best Practices:

- Add test execution commands within your CI scripts, e.g., `ctest --output-on-failure` (CMake) or `bazel test` (Bazel).
- Use test filters to limit runs to relevant tests during incremental builds.
- Capture test logs and failure artifacts for diagnostics.
- Set environment variables as needed, especially for GoogleMock verbosity or to handle multithreading flags.

Example CMake CI script snippet:

```bash
mkdir build && cd build
cmake ..
cmake --build . --config Release
ctest --output-on-failure
```

Example Bazel CI snippet:

```bash
bazel test --test_output=errors //...
```

---

## Additional Integration Notes

- **Compiler Runtime Configuration:** On Windows, consider setting `gtest_force_shared_crt` to `ON` in CMake to prevent runtime library mismatches.
- **Multi-threaded Tests:** Ensure your build system links pthread (or equivalent) on platforms that require it when testing multi-threaded code.
- **Macro Name Clashes:** Use compiler flags like `-DGTEST_DONT_DEFINE_TEST=1` if macro clashes occur to rename GoogleTest macros.
- **Shared vs Static Libraries:** Consider building GoogleTest and GoogleMock as shared libraries if you prefer dynamic linking.

---

## Troubleshooting

<AccordionGroup title="Common Build & Integration Issues">
<Accordion title="Symbol Not Found or Linker Errors">
Ensure that your test targets link to `gtest_main` or `gmock_main` libraries and that paths to GoogleTest includes are correctly set.
</Accordion>
<Accordion title="C++ Standard Mismatch">
Verify that your project and GoogleTest use a compatible C++ standard (minimum C++17). Set `CMAKE_CXX_STANDARD` explicitly.
</Accordion>
<Accordion title="Runtime Library Mismatch on Windows">
Use `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` in CMake to align runtimes.
</Accordion>
<Accordion title="Tests Not Running or Detected">
Confirm that test targets are correctly declared and that `add_test()` is used in CMake, or that Bazel cc_test targets are properly specified.
</Accordion>
</AccordionGroup>

---

## Tips & Best Practices

- Use the **FetchContent** method in CMake for easy version-controlled GoogleTest dependencies.
- Prefer linking against `gmock_main` for tests requiring GoogleMock, as it initializes both GoogleTest and GoogleMock.
- Organize test code separately from production code but keep mocks close to the interfaces they test.
- Keep your CI environment flags (such as verbosity and thread options) consistent with your local build setup to avoid surprises.
- Use `ctest` and Bazel's test flags to get detailed output on failing tests.

---

## Next Steps & Related Documentation

- [Writing Your First Test](guides/getting-started/first-test) — Learn how to write and run basic tests.
- [Getting Started with GoogleMock](guides/mocking-advanced/getting-started-mocking) — Dive deeper into mocking techniques.
- [Managing Test Dependencies and Configuration](guides/getting-started/managing-test-dependencies) — Organize tests and dependencies.
- [Troubleshooting and FAQ](guides/real-world-integration/troubleshooting-faq) — Solve common integration problems.
- Official GoogleTest GitHub Repository: <https://github.com/google/googletest>

---

## References

- GoogleTest CMake Build Instructions: <https://github.com/google/googletest/blob/main/README.md#build-and-install>
- GoogleMock Cookbook: <https://google.github.io/googletest/gmock_cook_book.html>
- Bazel C++ Tutorial: <https://docs.bazel.build/versions/main/tutorial/cpp.html>

---

This guide walks you productively through integrating GoogleTest and GoogleMock build capabilities so you can focus on writing strong, maintainable, and fast tests.
