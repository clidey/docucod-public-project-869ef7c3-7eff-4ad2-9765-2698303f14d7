---
title: "Creating Custom Assertions and Matchers"
description: "Extend GoogleTest and GoogleMock by defining your own assertion macros and custom matchers—enabling expressive, domain-tailored validation for your tests and mocks."
---

# Creating Custom Assertions and Matchers

Extend GoogleTest and GoogleMock by defining your own assertion macros and custom matchers—enabling expressive, domain-tailored validation for your tests and mocks.

---

## Overview

Custom assertions and matchers let you express complex validation logic succinctly and clearly. They enhance test readability, aid in debugging by providing meaningful failure messages, and integrate smoothly with GoogleTest's and GoogleMock's existing assertion framework.

This guide walks you through the following:

- How to define new assertion macros for reusable test checks.
- How to create custom matchers using the `MATCHER` and `MATCHER_P` macros.
- Implementing more advanced matchers for greater flexibility.

---

## Why Create Custom Assertions and Matchers?

Often, the built-in assertions and matchers do not cover all specific needs in your domain or project. Custom assertions allow you to:

- Encapsulate repetitive test logic into reusable components.
- Generate clearer, domain-specific error messages.
- Compose complex expectations in a more natural way.

Creating custom matchers also enables:

- Matching complex object properties beyond simple equality.
- Parameterized matchers for fine-tuned checks.
- Integration with GoogleMock expectations for mock verification.

---

## Defining Custom Assertion Macros

Custom assertions are user-defined macros that wrap common checks. They simplify test code and provide meaningful failure output.

### Creating a Simple Custom Assertion

Define a macro using GoogleTest's `EXPECT_` or `ASSERT_` family inside:

```cpp
#define EXPECT_IS_EVEN(val) \  
    EXPECT_PRED2([](int v, ::testing::TestPartResult* result) { \  
      if (v % 2 != 0) { \  
        *result = ::testing::MakeTestPartResult(\  
            ::testing::TestPartResult::kFatalFailure, \
            __FILE__, __LINE__, \
            "Expected an even number but was " + std::to_string(v), ""); \
        return false; \
      } \
      return true; \
    }, val, ::testing::Message())
```

Use it as any other assertion:

```cpp
EXPECT_IS_EVEN(4);  // Passes
EXPECT_IS_EVEN(5);  // Fails with descriptive message
```

### Best Practices

- Use `EXPECT_` for non-fatal and `ASSERT_` for fatal failures.
- Provide file and line information to point users to the failure.
- Return meaningful messages to explain the failure cause.

---

## Writing Custom Matchers with `MATCHER` Macros

The `MATCHER` macros generate classes implementing matcher interfaces, suitable for use with `EXPECT_THAT` and `EXPECT_CALL`.

### Basic Matcher

Syntax:

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}
```

Usage:

```cpp
EXPECT_THAT(value, IsEven());
```

This matcher:
- Receives the current argument as `arg`.
- Returns `true` if it matches, `false` otherwise.

### Providing Descriptions and Failure Messages

Add a detailed description and additional failure explanation:

```cpp
MATCHER(IsDivisibleBy, "", int divisor) {
  if (arg % divisor == 0) return true;

  *result_listener << "which has remainder " << (arg % divisor);
  return false;
}

// Usage:
EXPECT_THAT(10, IsDivisibleBy(3));  // Fails with "which has remainder 1"
```

### Parameterized Matchers

Use `MATCHER_P` for single-parameter:

```cpp
MATCHER_P(IsMultipleOf, factor, "") {
  return (arg % factor) == 0;
}

EXPECT_THAT(15, IsMultipleOf(5));  // Passes
```

For multiple parameters, use `MATCHER_P2`, `MATCHER_P3`, ... etc.

---

## Custom Matcher Implementation Guidelines

- Keep matchers **pure functions** without side effects.
- Use the provided `result_listener` to append helpful failure details.
- Leverage Google's stream-based printing utilities for readability.
- Favor parameterized matchers to cover more use cases from a single matcher.

---

## Advanced Matcher Techniques

### Composite Matchers

You can build matchers combining other matchers:

```cpp
MATCHER_P2(InRange, low, high, "") {
  return low <= arg && arg <= high;
}
EXPECT_THAT(5, InRange(1, 10));  // Passes
```

### Using Matchers on Object Fields or Properties

Use built-in helpers `Field()` and `Property()` to match parts of objects:

```cpp
EXPECT_THAT(person, Field(&Person::age, Ge(18)));
EXPECT_THAT(obj, Property(&Obj::GetName, StartsWith("Test")));
```

### Custom Descriptions for Better Messages

Describe expected and negated cases clearly:

```cpp
MATCHER_P(IsNonNegative, "must be non-negative") {
  return arg >= 0;
}
```

---

## Integrating Custom Matchers with GoogleMock

Custom matchers work seamlessly when specifying expectations with `EXPECT_CALL`:

```cpp
EXPECT_CALL(mock_obj, Foo(IsEven()));
```

The matcher logic checks arguments when the mock method is called and generates detailed error messages if they do not match.

---

## Practical Example

Suppose you want to validate that a mock function receives a vector whose size is between 3 and 5:

```cpp
MATCHER_P2(VectorSizeInRange, low, high, "") {
  return arg.size() >= low && arg.size() <= high;
}

TEST(MyTest, UsesVectorSizeInRange) {
  MockMyClass mock;
  EXPECT_CALL(mock, Process(VectorSizeInRange(3, 5)));

  std::vector<int> vec{1, 2, 3};
  mock.Process(vec);  // Passes

  std::vector<int> small_vec{1};
  mock.Process(small_vec);  // Fails with explanation
}
```

---

## Troubleshooting & Tips

- **Mismatched matchers:** Check types carefully; use `SafeMatcherCast<T>()` if needed.
- **Descriptive failures:** Always add meaningful output to `result_listener`.
- **Returning meaningful messages:** Use `MATCHER_P` variants for parameterization.
- **Avoid side effects:** Matchers may be lazily evaluated or called multiple times.
- **Keep matchers lightweight:** Complex logic can slow tests; consider caching if appropriate.

---

## Next Steps & Related Content

- Explore [Writing Your First Test](guides/getting-started/writing-your-first-test) to practice assertion usage.
- Learn about [Using Assertions Effectively](guides/core-workflows/using-assertions) for better test verification.
- Dive into [Matchers Reference](reference/matchers.md) for advanced matcher usage.
- Consult [gMock Cookbook](docs/gmock_cook_book.md) for more recipes on mock testing.

---

For additional details, see the official GoogleTest documentation and the [gMock Reference](docs/reference/mocking.md).


---

# Summary
This documentation guides users through creating custom assertions and matchers in GoogleTest and GoogleMock, empowering more expressive, readable, and maintainable tests. Key sections include defining simple and parameterized matchers, integrating them into expectations, and troubleshooting common pitfalls. It encourages writing domain-specific validation while leveraging GoogleTest’s robust assertion framework.

### Key Sections:
- Defining Custom Assertion Macros
- Writing Custom Matchers with `MATCHER` Macros
- Parameterized and Composite Matchers
- Integrating Matchers with GoogleMock Expectations
- Practical Examples and Troubleshooting

### Important Links:
- [Matchers Reference](reference/matchers.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Writing and Running Your First Test](guides/getting-started/writing-your-first-test)
- [Using Assertions Effectively](guides/core-workflows/using-assertions)
- [Mocking Reference](docs/reference/mocking.md)

### Cross-References:
Users are encouraged to explore the Mocking Basics guide for a foundation on mocks, the Matchers API for built-in patterns, and the Actions API for controlling mock behavior.

### Action Items:
Try creating custom assertions and matchers for your domain, practice writing tests that employ them, and learn to interpret detailed failure messages confidently. Consult the official references for advanced scenarios as you progress.