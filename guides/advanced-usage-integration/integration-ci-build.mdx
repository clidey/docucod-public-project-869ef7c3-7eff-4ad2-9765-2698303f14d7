---
title: "Integrating with CI and Build Systems"
description: "Shows how to connect GoogleTest/GoogleMock with popular CI workflows and build systems (CMake, Bazel, custom scripts), automate test discovery and execution, and collect rich outputs for reporting and analysis."
---

# Integrating with CI and Build Systems

GoogleTest and GoogleMock integrate seamlessly with popular Continuous Integration (CI) workflows and build systems such as CMake, Bazel, and custom scripts. This page guides you through automating test discovery and execution, configuring builds for testing, and collecting rich test outputs for reporting and analysis.

---

## Workflow Overview

### Task Description
This guide helps you incorporate GoogleTest and GoogleMock into your CI pipelines and build systems, enabling automated and reliable test execution as part of your development lifecycle.

### Prerequisites
- You have a working GoogleTest and GoogleMock installation.
- Your project uses one or more supported build systems: **CMake**, **Bazel**, or custom build scripts.
- You have access to your CI system configuration files (e.g., GitHub Actions, Jenkinsfiles, etc.).

### Expected Outcome
- Tests are discovered and run automatically within your builds.
- Test results are collected and output in formats compatible with CI reporting tools.
- Your build and CI pipelines can efficiently verify code correctness using GoogleTest/GoogleMock.

### Time Estimate
Setting up basic integration can take 15-30 minutes, depending on your existing build system and CI environment.

### Difficulty Level
Intermediate - requires familiarity with your build system and CI platform configuration.

---

## Step-by-Step Instructions

### 1. Integrate GoogleTest/GoogleMock with Your Build System

#### a. CMake Integration

1. **Add GoogleTest as a Subdirectory** (recommended for full control):

   In your `CMakeLists.txt`, include:

   ```cmake
   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
   )
   FetchContent_MakeAvailable(googletest)

   add_executable(your_tests test_main.cpp your_test_files.cpp)
   target_link_libraries(your_tests gtest_main gmock)

   enable_testing()
   add_test(NAME YourTests COMMAND your_tests)
   ```

2. **Build and Run Tests via CMake:**

   - Run `cmake` to generate your build system files.
   - Use `cmake --build .` to build the tests.
   - Run `ctest` to execute the tests with output captured.

3. **Automate Coverage and Reporting (Optional):**

   - Configure CTest to output XML for CI consumption: `ctest -T Test -D Experimental`.

#### b. Bazel Integration

- Define `cc_test` rules for your test targets that link against GoogleTest and GoogleMock:

```bazel
cc_test(
    name = "your_test",
    srcs = ["your_test.cc"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock_main"],
)
```

- Run tests via `bazel test //path/to:your_test`.
- Bazel test runner automatically collects and reports test results.

#### c. Custom Build Scripts

- Compile test executables with appropriate include paths and linking options:

```bash
# Example g++ command
g++ -std=c++17 -I/path/to/googletest/include -I/path/to/googlemock/include \
    your_test_main.cpp your_test_files.cpp \
    /path/to/libgtest.a /path/to/libgmock.a -lpthread -o your_tests

./your_tests
```

- Incorporate test execution into your scripts and capture test outputs.

### 2. Automate Test Discovery and Execution

- Use test runners (`ctest`, `bazel test`, or direct execution) integrated into your CI pipeline.
- For CMake, define tests using `add_test()` and then invoke `ctest` in CI scripts.
- For Bazel, use Bazel's test command which auto-discovers and executes tests.

### 3. Configure Rich Outputs for Reporting

- Enable XML or JUnit-compatible output in test runs to allow CI systems to generate test reports and dashboards.

- **For GoogleTest:** Use the flag

```bash
--gtest_output=xml:report.xml
```

- This generates an XML report suitable for most CI systems (e.g., Jenkins, GitHub Actions).

- Pass this flag in your test execution command.

### 4. Example: GitHub Actions Workflow for CMake Project

```yaml
name: C++ Test

on: [push, pull_request]

jobs:
  build_and_test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies
        run: sudo apt-get install -y cmake g++

      - name: Configure
        run: cmake -S . -B build

      - name: Build
        run: cmake --build build

      - name: Run Tests
        run: ctest --test-dir build --output-on-failure --verbose --gtest_output=xml:build/report.xml

      - name: Upload Test Report
        uses: actions/upload-artifact@v2
        with:
          name: test-report
          path: build/report.xml
```

### 5. Troubleshooting and Verifications

- **Tests not running or discovered?**
  - Ensure your test executables are correctly linked with GoogleTest and GoogleMock.
  - Verify that `add_test()` entries exist for CMake projects.

- **No test output or XML report missing?**
  - Confirm that the `--gtest_output=xml:<path>` flag is passed properly.
  - Check file permissions for report output.

- **Test failures but unclear reason:**
  - Use `--gtest_verbose=info` flag during test execution to get detailed logs.
  - Check mock warnings or failures related to EXPECT_CALL.

- **Slow builds?**
  - For CMake, consider building GoogleTest/GoogleMock as a pre-built/static library.

---

## Tips & Best Practices

- Use dedicated test targets in your build system to isolate test builds.
- Suppress unnecessary warnings from mocks in CI by using `NiceMock` where applicable.
- Use test sequences and expectations carefully to avoid brittle tests in CI.
- Cache your build system's downloaded dependencies (e.g., googletest) in CI to speed up builds.
- Use parallel test execution features (`ctest -j`, Bazel concurrent tests) to reduce CI runtime.

---

## Summary

Integrating GoogleTest and GoogleMock into CI workflows and build systems is essential for automated quality assurance. Whether you build with CMake, Bazel, or custom scripts, GoogleTest provides mechanisms for test discovery, execution, and rich reporting that CI/CD platforms expect.

---

## Next Steps & Related Content

- [Setup and Installation](../getting-started/setup-prerequisites-installation/installation-platforms.md) - for initial build environment setup.
- [GoogleTest Primer](../docs/primer.md) - basics of writing and running tests.
- [gMock Cookbook](../docs/gmock_cook_book.md) - advanced mocking usage.
- [Mocking Reference](../docs/reference/mocking.md) - detailed API for mocks.
- [Integration and Platform Support](../overview/features-integration/integration-and-platforms.md) - deeper integration techniques.

---

## Additional Resources

- GoogleTest Official GitHub: https://github.com/google/googletest
- GoogleTest CMake Build Instructions: https://google.github.io/googletest/primer.html#using-cmake

---