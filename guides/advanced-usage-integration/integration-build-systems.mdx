---
title: "Integrating with Build Systems and CI"
description: "Shows how to integrate GoogleTest and GoogleMock within various build environments (like CMake and Bazel) and CI pipelines. Covers dependency management, test discovery automation, and output integration."
---

# Integrating with Build Systems and CI

## Overview

This guide shows how to integrate GoogleTest and GoogleMock into your build systems and Continuous Integration (CI) pipelines. It focuses on practical steps for managing dependencies, automating test discovery, and incorporating test output into CI workflows. We'll cover integration with popular build tools like CMake and Bazel, dependency management best practices, enabling automatic test registration, and capturing test results for CI reporting.

---

## 1. Integration Workflow Overview

### Goal
Enable seamless incorporation of GoogleTest and GoogleMock into your existing build and CI environment to automate testing, dependency management, and result reporting.

### Prerequisites
- Your build system should support C++17 or later.
- Basic familiarity with your build tool (CMake or Bazel).
- GoogleTest source or binaries accessible to your project.
- Your CI pipeline can execute test binaries and capture output.

### Expected Outcome
After following this guide, your project will:
- Build GoogleTest and GoogleMock automatically or link against installed versions.
- Discover and register tests without manual listing.
- Run tests automatically with the `RUN_ALL_TESTS()` invocation.
- Provide test results in a format consumable by CI (e.g., XML reports).

### Time Estimate
Setting up the integration varies by project size and familiarity. Expect 1-3 hours for initial setup.

### Difficulty Level
Intermediate

---

## 2. Step-by-Step Integration Instructions

### A. Integrating GoogleTest in CMake

1. **Add GoogleTest as a Subdirectory or Use Installed Version**

   - If using the source directly, add GoogleTest via `add_subdirectory()`:

     ```cmake
     # Assuming googletest is in 'third_party/googletest'
     add_subdirectory(third_party/googletest)

     # Your test executable
     add_executable(my_tests test_main.cpp my_tests.cpp)

     # Link against gtest and gmock
     target_link_libraries(my_tests GTest::gtest GTest::gtest_main GTest::gmock GTest::gmock_main)

     # Enable testing
     enable_testing()
     add_test(NAME MyTestSuite COMMAND my_tests)
     ```

   - Alternatively, use the installed GoogleTest and find with `find_package(GTest REQUIRED)`:

     ```cmake
     find_package(GTest CONFIG REQUIRED)

     add_executable(my_tests test_main.cpp my_tests.cpp)
     target_link_libraries(my_tests GTest::gtest GTest::gtest_main GTest::gmock GTest::gmock_main)

     enable_testing()
     add_test(NAME MyTestSuite COMMAND my_tests)
     ```

2. **Configure C++ Standard and Compiler Settings**

   Ensure your project sets the C++ standard compatible with GoogleTest (C++17+):

   ```cmake
   set(CMAKE_CXX_STANDARD 17)
   set(CMAKE_CXX_STANDARD_REQUIRED ON)
   ```

3. **Write Tests Using TEST/TEST_F Macros**

   Use `TEST()` and `TEST_F()` macros in your test source files. GoogleTest automatically registers all your tests.

4. **Use `RUN_ALL_TESTS()` in `main()`**

   GoogleTest provides `gtest_main` library with a default `main()`. If you want a custom main:

   ```cpp
   #include <gtest/gtest.h>

   int main(int argc, char **argv) {
     testing::InitGoogleTest(&argc, argv);
     return RUN_ALL_TESTS();
   }
   ```

5. **Enable XML Output for CI Integration**

   Pass command-line flag `--gtest_output=xml:<path>` to your test binary in CI:

   ```bash
   ./my_tests --gtest_output=xml:test_results.xml
   ```

6. **Add to CI Pipeline**

   Add build steps to compile tests, run tests capturing XML output, and publish XML artifacts.

### B. Integrating GoogleTest in Bazel

1. **Load Rules and Add Dependencies**

   In your `BUILD` files, declare dependencies on GoogleTest and GoogleMock repositories.

2. **Use Provided Bazel Rules**

   Use `cc_test` targets with `deps` linking to `@com_google_googletest//:gtest_main` or `@com_google_googletest//:gmock_main`.

   ```bazel
   cc_test(
       name = "my_tests",
       srcs = ["my_tests.cpp"],
       deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock_main"],
   )
   ```

3. **Test Discovery**

   Bazel builds and runs all tests under `cc_test` targets without extra work.

4. **CI Integration**

   Your CI can invoke `bazel test ...` and capture output to read results.

### C. Handling Dependencies

- Prefer bundling GoogleTest sources or using package manager versions to avoid mismatches.
- Sync GoogleTest versions across environments.
- Utilize `FetchContent` in CMake to automate fetching GoogleTest:

  ```cmake
  include(FetchContent)
  FetchContent_Declare(
    googletest
    URL https://github.com/google/googletest/archive/release-1.13.0.tar.gz
  )
  FetchContent_MakeAvailable(googletest)
  ```

### D. Automating Test Discovery

- GoogleTest automatically registers tests defined with `TEST()`, `TEST_F()`, etc., so no manual steps are required for discovery.
- Build systems will compile test binaries which contain full test registrations.
- Use `RUN_ALL_TESTS()` to execute all tests at runtime.

### E. Test Output and CI Reporting

- Enable XML reports with the `--gtest_output=xml:` command-line flag.
- CI systems like Jenkins, GitLab CI, GitHub Actions can consume these XML files.
- Consider combining with test filters (`--gtest_filter=pattern`) for targeting tests.

---

## 3. Practical Tips and Best Practices

- **Link gtest_main or provide your own main:** Prefer linking `gtest_main` and `gmock_main` to avoid writing and maintaining your own test entry point.
- **Use `enable_testing()` and register tests in CMake:** To enable CTest functionality.
- **Use `FetchContent` for automated dependency management:** This ensures build reproducibility.
- **Keep C++ standard consistent:** All parts of your build should target C++17 or later.
- **Run tests in isolation:** CI should execute test binaries separately to catch flaky tests.
- **Capture and archive test outputs:** Integrate test XML output with your CI dashboard for easy diagnosis.
- **Use test filters carefully:** To run a subset of tests during development.
- **Handle flaky tests:** Mark or isolate flaky tests to avoid CI instability.

---

## 4. Common Troubleshooting

### GoogleTest Not Found by Build System
- Verify correct path or `find_package` configuration.
- Sync submodule if using git submodules.
- Use absolute paths or FetchContent for better reliability.

### Tests Not Discovered or Not Running
- Ensure `RUN_ALL_TESTS()` is called.
- Check linking order and libraries: `gtest`, `gmock`, and `gtest_main`.
- Confirm that test files are included in the build.

### Failing to Report Results in CI
- Validate XML output path and permission.
- Use `--gtest_output=xml:filename.xml` explicitly.

### Linking Errors on Windows
- Use the `gtest_force_shared_crt` CMake option to match runtime linkage.

### Build Failures Due to C++ Standard
- Confirm compiler supports C++17.
- Set `CMAKE_CXX_STANDARD` appropriately.

---

## 5. Next Steps & Related Content

- Explore the [GoogleTest Primer](primer.md) to learn writing tests.
- Review the [Using Matchers](reference/matchers.md) to write expressive assertions.
- Consult the [Mocking Framework Guide](gmock_for_dummies.md) to write mocks.
- Check [Continuous Integration Best Practices](overview/inside-googletest/integration-points.md) for advanced pipeline setup.
- Optimize test performance with [Performance and Scaling Guide](guides/advanced-usage-integration/performance-scaling.md).

---

## References
- [Installation and Integration (CMake & Bazel)](getting-started/setup-prerequisites-installation/installation-integration.md)
- [Configuration & Validation](getting-started/setup-prerequisites-installation/configuration-validation.md)
- [GoogleTest Primer](primer.md)
- [gMock for Dummies](gmock_for_dummies.md)
- [Matchers Reference](reference/matchers.md)

---

<Tip>
Integrating GoogleTest and GoogleMock seamlessly reduces test maintenance overhead and accelerates your CI feedback cycle. Combine dependency management with consistent build configuration to create reliable, automated test infrastructure.
</Tip>