---
title: "Performance and Scalability Tips"
description: "Optimize your test suites for fast, scalable runs. These actionable tips cover running tests in parallel, structuring for minimal dependencies, and using continuous integration practices to keep your builds and tests efficient."
---

# Performance and Scalability Tips

Optimize your test suites for fast, scalable runs. This guide offers actionable techniques to speed up your tests, enable parallel execution, and maintain efficient continuous integration workflows.

---

## 1. Why Optimize Test Performance?

Running tests is a core part of your development lifecycle, but as your codebase grows, test execution time can become a bottleneck. Speeding up tests and scaling them effectively ensures rapid feedback, higher developer productivity, and smoother continuous integration (CI) pipelines.

---

## 2. Prerequisites

Before applying these tips, make sure:

- Your tests are organized using GoogleTest's **test suites** and **fixtures** to allow logical grouping.
- You understand basic GoogleTest test structure: `TEST()`, `TEST_F()`, and parameterized tests.
- Your build environment supports parallel builds and concurrent execution (most modern CI environments do).

---

## 3. Effective Strategies for Performance and Scalability

### 3.1 Run Tests in Parallel

GoogleTest does not provide built-in parallel execution, but you can leverage external tools to run tests simultaneously.

- Use tools like [`gtest-parallel`](https://github.com/google/gtest-parallel) to run your test binary concurrently across multiple CPU cores.
- On CI systems, split tests by test suite or source files to run in parallel shards.
- Employ GoogleTest's **sharding** features by setting environment variables:
  - `GTEST_TOTAL_SHARDS` to the total number of parallel shards
  - `GTEST_SHARD_INDEX` to the index of the current shard (0-based)

GoogleTest will run only the subset of tests assigned to each shard, enabling distribution across multiple machines or cores.

#### Example: Environment Setup for Sharding

```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0  # In first shard
./my_test_binary
```

Repeat on other shards with `GTEST_SHARD_INDEX` 1, 2, and 3 respectively.

---

### 3.2 Minimize Dependencies Between Tests

Speed also comes from reducing test interdependencies:

- Design tests to be independent and stateless where possible.
- Avoid global or static state that might require expensive setup or tear-down.
- Use **test fixtures** (`TEST_F`) with shared resources initialized only once for multiple tests.

#### Using Test Suite Setup and Teardown

GoogleTest lets you define `SetUpTestSuite()` and `TearDownTestSuite()` static methods for expensive operations that are shared across all tests in a suite.

```cpp
class DatabaseTest : public ::testing::Test {
protected:
  static void SetUpTestSuite() {
    // Expensive setup, e.g. launching a test DB instance
  }

  static void TearDownTestSuite() {
    // Cleanup the database
  }

  void SetUp() override {
    // Run before each test
  }
};
```

This approach amortizes setup costs and ensures tests run faster.

---

### 3.3 Use Value-Parameterized and Typed Tests to Avoid Redundant Code

Value-parameterized tests (`TEST_P`) and typed tests (`TYPED_TEST`) help by allowing one test definition to cover many input scenarios, reducing duplication and simplifying maintenance.

This approach reduces overall test code and can also speed up builds and test runs when paired with parallel test execution.

See the [Parameterized Tests guide](../advanced.md#value-parameterized-tests) for details.

---

### 3.4 Optimize Test Code Efficiency

Some code-level practices directly impact test speed:

- Avoid expensive operations inside the test body unless necessary.
- Cache reusable test data where possible.
- Avoid long waits and unnecessary thread sleeps in tests.
- Use fast assertions (`EXPECT_` over `ASSERT_` where continuation makes sense).

---

### 3.5 Leverage Continuous Integration Best Practices

- Run fast, critical tests on every commit.
- Schedule longer, more comprehensive test suites nightly or on demand.
- Use test sharding and parallel execution on CI to reduce total feedback time.
- Cache build artifacts and test databases to avoid repetitive setup.

---

### 3.6 Filter and Select Tests Efficiently

Use GoogleTest's filtering flags to run only relevant tests during development:

- `--gtest_filter=TestSuiteName.TestName` to run specific tests.
- Use complex patterns to include or exclude certain suites or tests.

This avoids running unnecessary tests, saving time during iterative development.

---

## 4. Troubleshooting Common Performance Issues

<AccordionGroup title="Common Performance Issues and Solutions">
<Accordion title="Tests Taking Too Long to Run">
- **Cause:** Expensive setup repeated unnecessarily.
- **Solution:** Use `SetUpTestSuite()` and `TearDownTestSuite()` for shared resources.
</Accordion>
<Accordion title="Tests Not Running in Parallel">
- **Cause:** You may be running your test binary serially without parallel tooling.
- **Solution:** Integrate with `gtest-parallel` or configure your CI to shard tests.
</Accordion>
<Accordion title="Flaky Tests When Running in Parallel">
- **Cause:** Tests depend on shared mutable state.
- **Solution:** Redesign tests to be independent and isolated.
</Accordion>
<Accordion title="Slow Startup or Teardown of Test Environments">
- **Cause:** Global test environments with heavy setup/teardown.
- **Solution:** Use `AddGlobalTestEnvironment()` wisely; consider sharing setup only once.
</Accordion>
</AccordionGroup>

<Tip>
Remember: The goal is to get quick, reliable feedback from your tests. Focus on structuring tests for isolation and parallelism before micro-optimizing individual lines.
</Tip>

---

## 5. Summary and Next Steps

### What You'll Achieve

By applying these tips, your GoogleTest suites will:

- Run faster through parallel execution.
- Scale smoothly in CI with sharding and selective test runs.
- Have minimal inter-test dependencies.
- Provide rapid, reliable feedback.

### Next Steps

- Explore and configure [gtest-parallel](https://github.com/google/gtest-parallel) or your CI for parallel test execution.
- Learn about [test sharding](../advanced.md#running-a-subset-of-the-tests) in the Advanced GoogleTest Topics.
- Review [Global Set-Up and Tear-Down](../advanced.md#global-set-up-and-tear-down) for sharing test environments.
- Improve test code efficiency using [Advanced Assertions and Matchers](../guides/core-testing-workflows/advanced-assertions-and-matchers.md) and [Parameterized Tests](../guides/advanced-testing-patterns/parameterized-tests.md).

---

## 6. Additional Resources

- [GoogleTest Primer](../primer.md) — Basics of writing tests
- [Advanced GoogleTest Topics](../advanced.md) — Deep dive into test patterns
- [Organizing and Running Test Suites](../guides/core-testing-workflows/organizing-and-running-tests.md)
- [Continuous Integration Example Setup](https://github.com/google/googletest/tree/main/examples)

---

## 7. Quick Reference Commands

```bash
# Run all tests with 4 shards (parallel workers)
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0
./my_test_binary &
export GTEST_SHARD_INDEX=1
./my_test_binary &
export GTEST_SHARD_INDEX=2
./my_test_binary &
export GTEST_SHARD_INDEX=3
./my_test_binary &
wait

# Run tests matching a filter
./my_test_binary --gtest_filter=MySuite*.*

# Run tests using gtest-parallel
gtest-parallel ./my_test_binary
```

---

Optimizing your GoogleTest suites with these strategies will make your tests faster, your builds more scalable, and your development experience more productive.