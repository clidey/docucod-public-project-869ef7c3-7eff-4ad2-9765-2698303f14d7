---
title: "Integrating with CI/CD Pipelines"
description: "Outlines reliable recipes for running tests in various continuous integration environments (Linux, macOS, Windows). Includes scripting strategies and artifact configuration to ensure stable automated test runs."
---

# Integrating with CI/CD Pipelines

GoogleTest offers reliable, flexible support for running comprehensive test suites within continuous integration and deployment (CI/CD) systems across diverse platforms including Linux, macOS, and Windows. This guide provides actionable recipes, scripting patterns, and artifact management tips to ensure your automated test runs are resilient, maintainable, and informative.

---

## 1. Workflow Overview

### Purpose
Enable developers and automation engineers to seamlessly integrate GoogleTest-powered tests within various CI/CD environments, ensuring stable builds and insightful test result reporting.

### Prerequisites
- GoogleTest properly installed and configured in your project
- A build system (e.g., CMake or Bazel) configured to compile tests
- Access to your CI/CD environment configurator (e.g., Jenkins, GitHub Actions, GitLab CI, Azure Pipelines)
- Basic familiarity with scripting for build and test automation

### Expected Outcomes
- Automated test compilation and execution as part of CI pipelines
- Structured test output available in XML or JSON for reports and dashboards
- Stable handling of test failures, flaky tests, and environment setups
- Support for test sharding and parallelization when applicable

### Estimated Time
Setup steps range from 15 minutes (with existing build and CI setup) to 1 hour for full integration including artifact handling and advanced options.

### Audience
Intermediate level engineers and developers involved in build, test automation, and CI maintenance.

---

## 2. Step-by-Step Integration Instructions

### Step 1: Configure Your Build System for CI Compatibility

- **CMake Users:** Use the provided `CMakeLists.txt` and include GoogleTest as a subdirectory or as an installed package.
- **Bazel Users:** Adjust your `BUILD.bazel` files to include `cc_test` or `py_test` targets for GoogleTest cases.

Example for CMake in your `CMakeLists.txt`:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

### Step 2: Build Tests in CI

- Use your CI script to configure and build with your build tool (e.g., `cmake`, `make`, `bazel build`).
- Ensure compiler and linker flags align with GoogleTest requirements (e.g., C++17 standard).

Linux example:
```bash
mkdir -p build && cd build
cmake ..
make -j$(nproc)
```

### Step 3: Run Tests with Structured Output

- Execute tests with GoogleTest flags for output formats that can be consumed by CI dashboards.
- Use `--gtest_output=xml:<path>` (or `json:<path>`) to generate structured reports.

Example:
```bash
./my_tests --gtest_output=xml:reports/my_tests_results.xml
```

- This XML report can be uploaded as an artifact in your CI system for integration.

### Step 4: Handle Test Filtering and Sharding

- Use the `--gtest_filter` flag to run subsets of tests.
- For large test suites, leverage test sharding environment variables:
  - `GTEST_TOTAL_SHARDS` - Total partitions
  - `GTEST_SHARD_INDEX` - Current shard zero-based index

Example shard environment setup in CI YAML:
```yaml
env:
  - GTEST_TOTAL_SHARDS=4
  - GTEST_SHARD_INDEX=${{ matrix.shard_index }}
```

- GoogleTest will run only the tests assigned to the current shard, which improves CI parallelism.

### Step 5: Incorporate Retry and Flakiness Handling

- Use the `--gtest_repeat=<count>` flag to rerun tests multiple times.
- Combine with `--gtest_recreate_environments_when_repeating` if your tests require fresh setups each iteration.

Example CLI:
```bash
./my_tests --gtest_repeat=3 --gtest_recreate_environments_when_repeating
```

This helps detect flaky tests and stabilize your pipeline.

### Step 6: Configure Test Failure Behavior

- Control whether tests stop at the first failure with `--gtest_fail_fast`.
- Define behavior on no tests selected or no tests linked with `--gtest_fail_if_no_test_selected` and `--gtest_fail_if_no_test_linked` flags.

### Step 7: Capture and Upload Test Artifacts

- Upload XML/JSON output files from the test run as part of CI artifacts.
- Configure your CI system's artifact upload step to retain these for historical tracking and failure diagnosis.

Example for GitHub Actions:
```yaml
- name: Upload test reports
  uses: actions/upload-artifact@v3
  with:
    name: GoogleTest-results
    path: reports/my_tests_results.xml
```

### Step 8: Monitor Logs and Test Warnings Output

- GoogleTest uses the `TEST_WARNINGS_OUTPUT_FILE` environment variable to append warnings to a persistent file.
- Configure this environment variable if your CI process aggregates warning logs separately.

---

## 3. Practical Examples

### Full Linux Shell Script Example
```bash
#!/bin/bash
set -e

# Build
mkdir -p build
cd build
cmake ..
make -j$(nproc)

# Run tests with XML output
./my_tests --gtest_output=xml:../artifacts/my_tests_results.xml
```

### GitHub Actions Snippet for CI Run
```yaml
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Setup CMake
      uses: jwlawson/actions-setup-cmake@v1
    - name: Build
      run: |
        mkdir build
        cd build
        cmake ..
        make
    - name: Run tests
      run: |
        ./build/my_tests --gtest_output=xml:artifacts/tests_results.xml
    - name: Upload test results
      uses: actions/upload-artifact@v3
      with:
        name: test-results
        path: artifacts/tests_results.xml
```

### Sharding Example (Matrix Build)
```yaml
strategy:
  matrix:
    shard_index: [0,1,2,3]

steps:
- name: Run shard ${{ matrix.shard_index }}
  run: |
    export GTEST_TOTAL_SHARDS=4
    export GTEST_SHARD_INDEX=${{ matrix.shard_index }}
    ./build/my_tests --gtest_output=xml:artifacts/shard_${{ matrix.shard_index }}_results.xml
```

---

## 4. Troubleshooting & Best Practices

### Common Issues
- **No tests run or matched:** Verify `--gtest_filter` or shard indexes.
- **Test hangs or crashes:** Run tests locally with `--gtest_catch_exceptions=0` to identify.
- **Output files not generated:** Check file system permissions and relative paths.
- **Mismatched shared library and runtime:** Use appropriate CMake flags (e.g., `gtest_force_shared_crt`) to ensure runtime library consistency on Windows.

### Best Practices
- Always generate structured test output for easy integration with CI reports.
- Use test sharding to scale large test suites and reduce overall CI duration.
- Employ retries and environment recreation flags to catch and isolate flaky tests.
- Configure your CI to preserve test output artifacts for post-mortem debugging.
- Align compiler and runtime settings between your tests and GoogleTest to avoid linkage errors.

### Performance & Stability
- Disable test sharding in death test subprocesses to avoid flaky results.
- Use the `--gtest_fail_fast` flag cautiously; stopping immediately on the first failure can speed feedback but may hide related issues.
- If tests are slow due to environment setup, consider using global test environment setups rather than per-test fixtures.

---

## 5. Next Steps & Related Documentation

- **Integrating with Your Build & CI:** For build system and CI integration scenarios ([Integration Scenarios](/overview/architecture-features-integration/integration-scenarios)).
- **Quickstart with CMake/Bazel:** Fast setup and getting started ([Quickstart with CMake](/guides/getting-started/quickstart-cmake), [Quickstart with Bazel](/guides/getting-started/quickstart-bazel)).
- **Running Tests:** Advanced test execution and filtering ([Running Tests](/getting-started/first-test-and-validation/running-tests)).
- **Test Output and Reporting:** Details on GoogleTest output formats and flags.
- **Death Tests:** For special scenario testing and integration considerations ([Death Tests Guide](/guides/real-world-workflows/death-tests)).

---

For more, visit the [GoogleTest GitHub repository](https://github.com/google/googletest) and [official documentation homepage](https://github.com/google/googletest/tree/main/docs).
