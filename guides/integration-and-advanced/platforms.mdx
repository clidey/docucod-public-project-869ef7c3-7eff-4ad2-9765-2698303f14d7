---
title: "Cross-Platform and Embedded Testing"
description: "Shows how to leverage GoogleTest and GoogleMock on multiple platforms, including embedded systems. Addresses platform-specific setup, flags, and recommended practices for portability."
---

# Cross-Platform and Embedded Testing

## Overview
This guide demonstrates how to leverage GoogleTest and GoogleMock across multiple platforms, including conventional desktop operating systems and embedded systems. It covers platform-specific initialization patterns, key flags for portability, and recommended practices to ensure tests run reliably and consistently irrespective of the target environment.

GoogleTest is designed with broad platform compatibility in mind, supporting environments from Linux and Windows to microcontroller-focused platforms like ESP8266/ESP32 and NRF52. Understanding platform differences and how GoogleTest adapts to them is crucial to writing portable and robust tests.

---

## 1. Preparing Your Environment for Cross-Platform Testing

### Prerequisites
- Have GoogleTest and GoogleMock source or binaries ready per your platform’s build system.
- Ensure you are working with at least C++17 compliant compilers and toolchains on your target platforms.
- For embedded systems, confirm that your platform's runtime environment supports the portions of the C++ standard library needed by GoogleTest (exceptions may be limited).

### What to Expect
By following this guide, you will be able to write tests using GoogleTest/GoogleMock that successfully initialize and execute on various supported platforms including embedded microcontrollers.

---

## 2. Platform-Specific Entry Points and Initialization

GoogleTest adapts its program entry points and initialization to the peculiarities of each platform. The core function responsible for setting up the framework is `testing::InitGoogleTest()` or `testing::InitGoogleMock()` (which also calls `InitGoogleTest`). How these are invoked depends on the environment.

### 2.1 Desktop and Standard Platforms

On most platforms (Linux, Windows, Mac, etc.), the program begins execution from a standard `main(int argc, char** argv)` function:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);  // Initializes GoogleTest as well
  return RUN_ALL_TESTS();
}
```

This setup allows GoogleTest to parse command-line flags and run all registered tests.

### 2.2 Embedded Platforms and Arduino-like Platforms

Some embedded systems, such as ESP8266, ESP32, and NRF52 (when using Arduino), have non-standard program start points - typically `setup()` and `loop()` functions instead of `main`.

GoogleTest provides special support for these platforms. For example:

```cpp
extern "C" void setup() {
  testing::InitGoogleMock();  // Initializes both GoogleMock and GoogleTest
}

extern "C" void loop() {
  RUN_ALL_TESTS();  // Executes tests repeatedly
}
```

> **Note:** The `RUN_ALL_TESTS()` call in `loop()` runs tests continuously which fits embedded workflow constraints.

### 2.3 Special Cases

- **QuRT platform**: Has a `main()` entry but no accessible `argc` or `argv`. Use default initialization without arguments.

---

## 3. Flags and Macros for Portability

GoogleTest exposes internal platform detection macros and feature-flags to help control behavior for portability:

| Macro                         | Purpose                                        | Typical Value on Supported Platforms |
|-------------------------------|------------------------------------------------|--------------------------------------|
| `GTEST_OS_ESP8266`            | Defined when compiling for ESP8266 platform    | 1 or 0                              |
| `GTEST_OS_ESP32`              | Defined when compiling for ESP32                | 1 or 0                              |
| `GTEST_OS_NRF52`              | Defined for NRF52 embedded platform            | 1 or 0                              |
| `GTEST_HAS_STREAM_REDIRECTION`| Enable/disable stdout/stderr capturing          | Disabled on embedded platforms      |
| `GTEST_HAS_DEATH_TEST`        | Enable death test functionality                 | Disabled on embedded platforms      |

### Best Practices for Using Flags

1. Use the `GTEST_OS_*` macros to perform conditional compilation if you need platform-specific code.
2. Avoid relying on features like death tests or stream redirection on embedded platforms, as these are either unavailable or unreliable.
3. When building for embedded, link with GoogleMock's version of the main file (`gmock_main.cc`) which provides the correct `setup()` / `loop()` entry points.

---

## 4. Integrating GoogleTest in Embedded Systems

### 4.1 Build and Link

- Include `gmock_main.cc` in your build for embedded, not the typical `gtest_main.cc`.
- Use your platform-specific toolchain and adjust compiler flags according to platform constraints.
- Make sure the test binary fits your device memory and CPU capacity.

### 4.2 Initialization and Execution

- Use the provided `setup()` function to perform framework initialization using `testing::InitGoogleMock()`.
- Drive test execution via the `loop()` function calling `RUN_ALL_TESTS()`.

Example for an Arduino-based environment:

```cpp
#include "gmock/gmock.h"
#include "gtest/gtest.h"

void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

### 4.3 Continuous Test Runs

The typical embedded environment calls `loop()` indefinitely, causing all tests to run repeatedly. This is often desirable for quick feedback in development loops.

---

## 5. Recommended Practices for Cross-Platform Test Code

- **Avoid platform-specific APIs inside tests.** Use mocks or abstractions to isolate platform dependencies.
- **Guard platform-dependent tests** using `#ifdef` checks to skip them where unsupported.
- **Prefer portable assertions and test fixtures** rather than relying on behavior only supported on desktops.
- **Do not expect exceptions on embedded platforms** unless the platform’s C++ runtime robustly supports them.
- **Avoid death tests on embedded platforms** because they require OS features like process control not usually available.
- **Isolate test initialization if your platform initializes hardware/resources differently.**

---

## 6. Troubleshooting Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Tests Not Running on Embedded Platforms">
Verify that you are linking `gmock_main.cc` (which defines `setup()` and `loop()`), not `gtest_main.cc`.

Ensure `testing::InitGoogleMock()` is called in `setup()` and `RUN_ALL_TESTS()` is called in `loop()`.
</Accordion>
<Accordion title="Linker Errors Regarding `main` or Entry Point">
Embedded systems may not use `main`. Including both `gmock_main.cc` and your own `main` can cause conflicts.

Use the platform-appropriate entry scenario and avoid duplicate entry definitions.
</Accordion>
<Accordion title="Failure to Capture Output or Stream Redirection Issues">
Embedded platforms often disable stdout/stderr or have limited IO support. Avoid depending on output capturing features.

Check `GTEST_HAS_STREAM_REDIRECTION` - if 0 in your environment, do not rely on output capture.
</Accordion>
<Accordion title="Death Tests Failing to Compile or Run">
Death tests require OS-level process control and filesystem features.

They are not supported on most embedded platforms. Surround death tests with `#ifdef GTEST_HAS_DEATH_TEST`.
</Accordion>
</AccordionGroup>

---

## 7. Example: Minimal Embedded Test Setup

```cpp
#include "gmock/gmock.h"
#include "gtest/gtest.h"

// Sample test - verify true is true
TEST(SampleTest, AlwaysPasses) {
  EXPECT_TRUE(true);
}

void setup() {
  testing::InitGoogleMock();
}

void loop() {
  RUN_ALL_TESTS();
}
```

Build this with your embedded toolchain, including `gmock_main.cc`, flash to device, and watch the test output stream.

---

## 8. Additional Resources

- [Installation Guide](https://google.github.io/googletest/installation-guide.html) for platform-specific setup instructions
- [Getting Started with CMake](https://google.github.io/googletest/quickstart-cmake.html) for building on various platforms
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) for fundamental concepts
- [Integrating with Your Build & CI](https://google.github.io/googletest/integration-scenarios.html) for build system integration

---

## 9. Summary

This page equips you to use GoogleTest and GoogleMock in cross-platform and embedded environments by explaining platform entry points, configuration flags, and best practices. With embedded-specific entry points like `setup()`/`loop()` and careful use of feature flags, your tests achieve portability and consistent execution.

By following the recommendations and examples here, you will avoid common pitfalls and harness the power of GoogleTest for testing on a wide variety of hardware and OS platforms, including resource-constrained embedded devices.

---