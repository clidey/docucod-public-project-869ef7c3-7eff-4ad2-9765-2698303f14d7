---
title: "Designing and Using Mock Objects"
description: "Step-by-step tutorial on creating and using mock classes, setting expectations, and verifying interactions. Discusses the MOCK_METHOD macro and strategies for testable interfaces."
---

# Designing and Using Mock Objects

This guide provides a step-by-step tutorial on how to create and use mock classes with GoogleMock. It covers defining mock methods using the `MOCK_METHOD` macro, setting expectations on mock objects, handling uninteresting calls, and strategies for designing easily testable interfaces.

---

## Workflow Overview

### Task Description
Learn how to design mock classes, create mock objects, set expectations about their behavior, and verify interactions during tests. This empowers you to write robust tests that verify interactions without relying on real implementations.

### Prerequisites
- You should have a C++ project with GoogleTest and GoogleMock integrated.
- Basic understanding of C++ virtual interfaces and inheritance.
- Familiarity with writing test cases using GoogleTest.

### Expected Outcome
You will be able to:
- Define mock classes using the `MOCK_METHOD` macro.
- Choose between different mock strictness settings (`NiceMock`, `NaggyMock`, `StrictMock`).
- Set expectations using `EXPECT_CALL`.
- Understand uninteresting vs unexpected calls and how strictness affects them.
- Use mocks with non-default constructors and move-only types.

### Time Estimate
Approximately 20-30 minutes to understand and apply the examples.

### Difficulty Level
Intermediate — requires familiarity with C++ and unit testing concepts.

---

## Step-by-Step Instructions

### 1. Define Your Mock Class

To create a mock class, inherit from the interface or base class you want to mock and use the `MOCK_METHOD` macro inside the `public` section for each virtual method you want to mock.

Example:
```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Notes:**
- Always place `MOCK_METHOD` in the `public` section, even if the original methods are `protected` or `private`.
- Use `(override)` to clearly indicate overriding virtual methods.
- Use `(const)` for const-qualified methods.
- Namespace `testing` should be imported or fully qualified when writing tests.

### 2. Choosing Mock Strictness

GoogleMock provides three wrappers to control the behavior of uninteresting calls:

| Wrapper        | Behavior                                                 | Usage Example                    |
|----------------|----------------------------------------------------------|---------------------------------|
| `NiceMock<T>`  | Suppresses warnings on uninteresting calls. Recommended for most tests to reduce noise.
| `NaggyMock<T>` | (Default) Prints warnings on uninteresting calls. Useful when developing or debugging tests.
| `StrictMock<T>`| Treats uninteresting calls as errors, causing test failures.

Example:
```cpp
using ::testing::NiceMock;

NiceMock<MockTurtle> turtle;
```

**Tips:**
- Use `NiceMock` when you want to ignore calls for which you have no explicit expectations.
- Use `StrictMock` to enforce that no unexpected methods are called.
- You can construct these mocks with the same arguments as their base mock class.

### 3. Setting Expectations with EXPECT_CALL

Use `EXPECT_CALL(mock_object, Method(matchers...))` to specify expected calls, argument constraints, call counts, and behaviors.

Example:
```cpp
using ::testing::AtLeast;
using ::testing::Return;
using ::testing::_;

EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1));

EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(50))
    .WillRepeatedly(Return(60));
```

**Key points:**
- If you omit argument matchers, `_` matches any argument.
- You can chain clauses like `.Times()`, `.WillOnce()`, `.WillRepeatedly()`, `.InSequence()`, `.After()`, and `.RetiresOnSaturation()`.
- Later `EXPECT_CALL` statements override earlier ones for the matching functions.

### 4. Handling Uninteresting Calls

Calls to mock methods without any `EXPECT_CALL` set are called "uninteresting calls." By default, GoogleMock warns about them (naggy behavior).

To suppress such warnings:
- Wrap your mocks with `NiceMock`, or
- Add an `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())` to allow any number of calls.

Example:
```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> turtle;
```

### 5. Using ON_CALL for Default Behavior

`ON_CALL` specifies default behavior without setting calls as expected.

Example:
```cpp
ON_CALL(turtle, GetX()).WillByDefault(Return(5));
```

This pattern is recommended for setting typical behaviors, complemented by `EXPECT_CALL` for specific assertions.

### 6. Verifying Expectation Satisfaction

When a mock object is destructed, GoogleMock automatically verifies that all set expectations are satisfied, reporting failures when they are not.

You can also verify explicitly before destruction:
```cpp
::testing::Mock::VerifyAndClearExpectations(&mock_object);
```

### 7. Supporting Mocks with Non-default Constructors

`NiceMock`, `NaggyMock`, and `StrictMock` support mock classes with constructors that take arguments, forwarding constructor parameters:

```cpp
NiceMock<MockBar> nice_bar("hello");
```

Use variadic forwarding to pass parameters transparently.

### 8. Mocking Methods with Move-only Types

GoogleMock supports mocking methods taking or returning move-only types (e.g., `std::unique_ptr`). Use the same `MOCK_METHOD` syntax:

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
```

Use lambdas or callable objects with `EXPECT_CALL` to return new move-only instances:

```cpp
EXPECT_CALL(mock_buzzer_, MakeBuzz("hello"))
    .WillRepeatedly([](StringPiece) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

### 9. Verifying Mock Destruction

To test the timing of mock destruction (e.g., upon deletion), you cannot mock destructors directly.

Pattern:
- Add a mock method (e.g., `Die()`) to your mock class.
- Call `Die()` in the destructor.
- Set expectations on `Die()`.

Example:
```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};

EXPECT_CALL(mock_foo, Die());
```

### 10. Avoid Nested Strictness Modifiers

Do **not** nest `NiceMock<StrictMock<T>>` or similar combinations, as this is unsupported and may lead to undefined behavior.

---

## Examples & Use Cases

### Basic Mock with NiceMock

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(void, DoSomething, (), ());
};

using ::testing::NiceMock;
using ::testing::AtLeast;

TEST(FooTest, TestDoSomething) {
  NiceMock<MockFoo> mock;

  EXPECT_CALL(mock, DoSomething()).Times(AtLeast(1));

  mock.DoSomething();
}
```

_No warnings about uninteresting calls will be printed._

### Using StrictMock to Enforce Call Restrictions

```cpp
using ::testing::StrictMock;

StrictMock<MockFoo> strict_mock;
EXPECT_CALL(strict_mock, DoSomething());

strict_mock.DoSomething();
// Calling any other method without expectation causes test failures.
```

### Mocking Non-default Constructors

```cpp
class MockBar {
 public:
  explicit MockBar(const std::string& name);  // Non-default ctor

  MOCK_METHOD(void, DoWork, (), ());
};

NiceMock<MockBar> nice_bar("my_name");
nice_bar.DoWork();
```

### Return Move-only Values

```cpp
MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));

EXPECT_CALL(mock_buzzer_, MakeBuzz(_))
    .WillRepeatedly([](StringPiece) {
      return std::make_unique<Buzz>(AccessLevel::kInternal);
    });
```

### Delegating to a Fake for Default Behavior

If you have an existing fake implementation:

```cpp
class FakeFoo : public Foo {
 public:
  // Real fake implementations of methods.
  char DoThis(int n) override { ... }
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(char, DoThis, (int n), (override));

  void DelegateToFake() {
    ON_CALL(*this, DoThis).WillByDefault(
        [this](int n) { return fake_.DoThis(n); });
  }

 private:
  FakeFoo fake_;
};
```

Then in tests:

```cpp
MockFoo mock;
mock.DelegateToFake();
EXPECT_CALL(mock, DoThis(5));
char result = mock.DoThis(5);  // Delegates to fake implementation.
```

### Setting Multiple Expectations

```cpp
EXPECT_CALL(turtle, Forward(10)).Times(2);
EXPECT_CALL(turtle, Forward(_)).Times(AnyNumber());
```

This means calling `Forward(10)` more than twice will be a test failure, other calls allowed any number of times.

---

## Troubleshooting & Best Practices

### Common Issues

- **Uninteresting call warnings:** If you see "Uninteresting mock function call", consider using `NiceMock` or explicitly allowing calls with `EXPECT_CALL(...).Times(AnyNumber())`.
- **Unexpected calls:** Indicate that your code under test is calling the mock in an unexpected way. Correct your expectations accordingly.
- **Mock methods not called:** Ensure that your `EXPECT_CALL` statements appear before code that calls the mock methods.
- **Mock methods with non-default constructible return types:** Provide a return action explicitly using `WillOnce` or set a `DefaultValue` for that type.
- **Tests fail unexpectedly when using `StrictMock`:** This is by design to catch unanticipated calls. Use `NiceMock` if you want to relax this.

### Best Practices

- Define mock classes in dedicated test header/source files, especially when mocking types you don't own.
- Avoid nesting strictness wrappers like `NiceMock<StrictMock<T>>`.
- Use `ON_CALL` for default behaviors and `EXPECT_CALL` for interactions you want to verify.
- Prefer `NiceMock` as your default to reduce noise in test outputs.
- For complex interfaces, consider adapters to simplify mocked interfaces.
- Always use `override` and `const` specifiers in `MOCK_METHOD` to catch signature mismatches early.
- For methods with arguments containing commas (e.g., templates), wrap argument types in extra parentheses or use type aliases to avoid macro parsing issues.

### Performance Tips

- Move mock class constructors and destructors to .cc files to speed up compilation.

---

## Summary

Designing and using mock classes efficiently ensures robust and maintainable tests by focusing on the exact interactions your code under test must have. GoogleMock’s `MOCK_METHOD` macro automatically generates mocking code; the `NiceMock`, `NaggyMock`, and `StrictMock` templates control how uninteresting calls are handled. Understanding how to set expectations with `EXPECT_CALL` and default behaviors with `ON_CALL` is paramount. Proper structuring of mocks, careful use of strictness policies, and delegation to fakes or real objects enhance test clarity and reusability.

---

## Next Steps & Related Content

- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes.
- Read [Mocking Reference](docs/reference/mocking.md) for full details on macros and classes.
- Use [gMock for Dummies](docs/gmock_for_dummies.md) for fundamental concepts and examples.
- Learn about [Actions and Matchers](guides/advanced-mocking/actions-matchers) to customize mock method behavior.


---

For more information, see:
- [MOCK_METHOD Macro Reference](docs/reference/mocking.md#MOCK_METHOD)
- [EXPECT_CALL and ON_CALL Usage](docs/reference/mocking.md#EXPECT_CALL)
- [NiceMock, NaggyMock, StrictMock Details](docs/reference/mocking.md#NiceMock)

---

*This document is part of the GoogleMock advanced mocking and test pattern guides.*