---
title: "Optimizing Test Performance and Scalability"
description: "Practical strategies for keeping tests fast and reliable as suites grow. Covers parallel execution, test filtering, and best practices for structuring large test suites."
---

# Optimizing Test Performance and Scalability

## Overview

As your test suite grows in size and complexity, maintaining fast and reliable test execution becomes crucial. This guide focuses on practical strategies to scale your GoogleTest and GoogleMock-powered tests while keeping build and runtime overhead manageable. You'll learn techniques for parallel test execution, intelligent test filtering, and best practices for structuring large test suites.

---

## 1. Workflow Overview

### Task Description
Learn how to optimize your test execution to handle growing test suites efficiently. This includes enabling parallel test runs, using filters to run relevant tests, and structuring your suite for incremental builds and fast feedback.

### Prerequisites
- GoogleTest and GoogleMock properly installed and configured.
- Existing tests organized in source files with appropriate TEST or TEST_F macros.
- Basic familiarity with running tests using `RUN_ALL_TESTS()` and command-line flags.

### Expected Outcome
By following this guide, you'll achieve:
- Faster overall test runs via parallel execution.
- Targeted test runs by filtering tests through custom patterns.
- Reduced test maintenance pain caused by redundant or overlapping tests.

### Time Estimate
Approximately 30-60 minutes to integrate and validate suggested optimizations.

### Difficulty Level
Intermediate. Requires understanding of test execution commands and some build system familiarity.

---

## 2. Step-by-Step Instructions

### Step 1: Enable Parallel Test Execution
1. Use your build system or Continuous Integration (CI) environment to run tests in parallel. Most modern CI systems support this.
2. You can also run tests in parallel locally by splitting your test binary with the `--gtest_list_tests` flag:

```bash
./my_tests --gtest_list_tests > test_list.txt
```

3. Divide tests across parallel runners using `--gtest_filter` to run subsets:

```bash
./my_tests --gtest_filter=TestSuite1.*
./my_tests --gtest_filter=TestSuite2.*
```

4. Alternatively, integrate parallel execution options that your CI/build system supports (e.g. `bazel test --test_output=streamed --jobs=N`).

**Expected Result:** Tests run concurrently, reducing total runtime.

---

### Step 2: Use Test Filtering for Focused Execution
1. Use the `--gtest_filter` flag to specify the tests you want to run.

Examples:

- Run all tests in a test suite:

```bash
--gtest_filter=MyTestSuite.*
```

- Run an individual test:

```bash
--gtest_filter=MyTestSuite.MyTestName
```

- Exclude tests:

```bash
--gtest_filter=-MyTestSuite.SkipTest
```

2. Combine filters for complex patterns, e.g.,

```bash
--gtest_filter=MyTestSuite.*:AnotherSuite.*-MyTestSuite.FlakyTest
```

**Expected Result:** Only relevant tests run, speeding up the feedback cycle.

---

### Step 3: Organize Your Tests for Incremental Builds
1. Segregate tests based on logical units or features. Place related tests in dedicated source files or libraries.
2. Use appropriate Bazel or CMake targets to limit recompilation.
3. Avoid overly large test binaries that include many unrelated tests.
4. Tag or label tests for grouping, enabling easier selective runs.

**Expected Result:** Changes trigger rebuilding and retesting of only affected components.

---

### Step 4: Use Mocking Wisely to Reduce Test Overhead
1. Use GoogleMock’s `ON_CALL` to define default behaviors for mocks to avoid unnecessary strict expectations.
2. Limit the use of `EXPECT_CALL` to only what you intend to verify, reducing brittle tests.
3. Use `NiceMock` to suppress uninteresting call warnings and keep tests clean.
4. Leverage `RetiresOnSaturation()` for expectations to retire them early, preventing over-saturated call issues.

**Expected Result:** Faster test execution with fewer false failures.

---

### Step 5: Adjust Verbosity for Test Run Logs
1. The `--gmock_verbose` flag controls logging detail:

- `info` shows all messages including call stacks.
- `warning` shows warnings.
- `error` shows only failures.

2. Use this flag to reduce noise and improve performance when running large test suites.

Example:

```bash
./my_tests --gmock_verbose=error
```

**Expected Result:** Cleaner logs and potentially faster test runs.

---

## 3. Examples & Usage Patterns

### Example: Running Tests in Parallel with Filtering

Suppose you want to run tests in two parallel jobs, splitting test suites alphabetically:

```bash
# Job 1 runs suites starting with letters A-M
./my_tests --gtest_filter=A*:*B*:*C*:*D*:*E*:*F*:*G*:*H*:*I*:*J*:*K*:*L*:*M*

# Job 2 runs suites starting with letters N-Z
./my_tests --gtest_filter=N*:*O*:*P*:*Q*:*R*:*S*:*T*:*U*:*V*:*W*:*X*:*Y*:*Z*
```

This strategy balances load and speeds up overall test execution.

### Example: Using `RetiresOnSaturation()` in Expectations

```cpp
EXPECT_CALL(mock_object, Foo(_))
    .Times(2)
    .RetiresOnSaturation();

mock_object.Foo(1);  // Matches first call
mock_object.Foo(2);  // Matches second call
mock_object.Foo(3);  // Matches fallback expectation if defined, or error
```

This avoids errors on calls exceeding the expected count by retiring the expectation after it's saturated.

### Example: Controlling Mock Verbosity

```bash
./my_tests --gmock_verbose=info
```

This gives detailed logs for debugging when tests fail due to mocks.

---

## 4. Troubleshooting & Tips

### Common Issues

**Problem:** Tests run slowly and feedback loop is long.
- **Solution:** Enable parallel test runs via build tools or distribute tests using `--gtest_filter`.

**Problem:** Unexpected warnings about uninteresting mock calls.
- **Solution:** Switch to using `NiceMock` for mocks or add appropriate `EXPECT_CALL` or `ON_CALL` to specify behaviors.

**Problem:** Over-saturated calls cause test failures.
- **Solution:** Use `.RetiresOnSaturation()` on expectations that should retire after being fulfilled.

**Problem:** Test binaries grow too large and build times increase.
- **Solution:** Organize tests into smaller logical groups, use separate targets, and avoid monolithic test binaries.

### Best Practices

- Write tests that verify only what is necessary to prevent brittle tests.
- Use sequences (`InSequence`) or the `After` clause to maintain meaningful ordering without over-constraint.
- Prefer `ON_CALL` over `EXPECT_CALL` for defining common mock behaviors that don’t need strict verification.
- Regularly profile test runs to detect bottlenecks.
- Beware of over-using `WillRepeatedly` without specifying call counts, as it may mask unexpected calls.

### Performance Considerations

- Minimize the number of mock expectations if not strictly needed.
- Run tests in parallel leveraging multiple CPU cores.
- Use filtering to focus only on subsets of tests during development.

### Alternative Approaches

- Use GoogleMock’s `DefaultValue<T>::Set()` to customize return values and speed up mock behavior setup.
- Leverage sub-tests or parameterized tests to reduce number of test functions while increasing coverage.

---

## 5. Next Steps & Related Content

- **Getting Started Guides:** [Installation and Setup](../getting-started/installation-setup) to ensure your environment is correct.
- **Mocking Workflows:** [Creating and Using Mocks](../guides/mocking-best-practices/creating-mocks) to build efficient mocks.
- **Writing Expectations:** [Writing Expectations and Actions](../guides/mocking-best-practices/writing-expectations-actions) for precision in tests.
- **Managing Mock Strictness:** [Mock Strictness](../guides/mocking-best-practices/mock-strictness) to control test flakiness.
- **Speed & Scalability FAQ:** Refer to [Performance Optimization Best Practices](../faq/performance-integration/performance-best-practices) for deeper insights.

---

<CardGroup cols={2}>
<Card title="GoogleMock Official Documentation">
  <ul>
    <li><a href="https://google.github.io/googletest/gmock_for_dummies.html">gMock for Dummies</a></li>
    <li><a href="https://google.github.io/googletest/gmock_cheat_sheet.html">gMock Cheat Sheet</a></li>
    <li><a href="https://google.github.io/googletest/gmock_cook_book.html">gMock Cookbook</a></li>
  </ul>
</Card>
<Card title="GoogleTest Guides & API Reference">
  <ul>
    <li><a href="/guides/mocking-best-practices/creating-mocks">Creating and Using Mocks</a></li>
    <li><a href="/guides/mocking-best-practices/writing-expectations-actions">Writing Expectations and Actions</a></li>
    <li><a href="/guides/mocking-best-practices/mock-strictness">Managing Mock Strictness</a></li>
    <li><a href="/api-reference/core-testing-apis/mock-class-api">Mock Classes API</a></li>
  </ul>
</Card>
</CardGroup>

---

<Info>
Keep your expectations targeted and avoid over-specification to prevent brittle tests. Use parallelization and filtering to keep test run times manageable as your suite grows.
</Info>

---