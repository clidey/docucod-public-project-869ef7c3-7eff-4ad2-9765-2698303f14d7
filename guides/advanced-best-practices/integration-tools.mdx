---
title: "Integrating with Build Systems and Toolchains"
description: "Best practices and hands-on tips for integrating GoogleTest and GoogleMock with CMake, Bazel, and other build tools. Covers organizing test targets, leveraging pkg-config, and automating test discovery as part of CI/CD pipelines."
---

# Integrating with Build Systems and Toolchains

## Overview

This guide helps you efficiently integrate GoogleTest and GoogleMock into your build systems and toolchains, including CMake, Bazel, and others. It focuses specifically on organizing test targets, leveraging `pkg-config`, and automating test discovery workflows to enable smooth Continuous Integration and Continuous Deployment (CI/CD) integration.

By following this guide, you will establish robust build workflows that ensure your tests are correctly built, linked, and executed as part of your development pipeline.

## Prerequisites

Before you begin integrating GoogleTest and GoogleMock into your build systems, ensure you have:

- GoogleTest and GoogleMock source or installed libraries ready.
- Basic familiarity with your build system of choice (CMake, Bazel, etc.).
- A C++17-compatible compiler environment (See [Prerequisites & System Requirements](https://yourdocs/getting-started/setup-introduction/prerequisites-requirements)).
- Your project set up to include or reference GoogleTest/GoogleMock headers.
- Basic understanding of test declaration and execution with GoogleTest.

## Expected Outcome

By completing the workflows in this guide, your project will:

- Correctly compile and link GoogleTest and GoogleMock test binaries.
- Use `pkg-config` files to manage include directories and linker flags.
- Organize test source files and targets logically in your build configuration.
- Automatically discover and include tests in CI/CD workflows.

## Time Estimate

Allow approximately 30â€“60 minutes depending on your build system familiarity and project complexity.

## Difficulty Level

Intermediate - requires working knowledge of C++ build systems and test organization.

---

# Step-by-Step Integration Guide

### 1. Organize Your Test Targets

Ensure your project clearly separates production code and test code. Create dedicated targets for GoogleTest/GoogleMock test binaries to avoid mixing concerns.

#### For a CMake-based project:

- Define a test target linking against `GTest::gtest` and/or `GMock::gmock` targets provided by GoogleTest package.

```cmake
add_executable(MyTest test_main.cpp my_test.cpp)
target_link_libraries(MyTest PRIVATE GTest::gtest GMock::gmock)
```

- Use `target_include_directories` if you have headers outside default GoogleTest include paths.

- Consider linking with `gtest_main` or `gmock_main` if you want to use the built-in main function.

```cmake
target_link_libraries(MyTest PRIVATE GTest::gtest_main GMock::gmock_main)
```

#### For Bazel projects:

- Use appropriate `cc_test` rules.
- Include GoogleTest and GoogleMock dependencies in your `WORKSPACE` and BUILD files following Bazel's conventions.

### 2. Leverage `pkg-config` for Dependency Management

GoogleTest and GoogleMock provide `.pc` files to facilitate dependency management with `pkg-config`.

- **Available `.pc` files:**
  - `gtest.pc` and `gtest_main.pc` for GoogleTest
  - `gmock.pc` and `gmock_main.pc` for GoogleMock

- **Example usage in Unix-like build environments:**

```bash
pkg-config --cflags gtest
pkg-config --libs gtest_main
```

- When using CMake, you can use `pkg_check_modules` macro: 

```cmake
find_package(PkgConfig REQUIRED)
pkg_check_modules(GTEST REQUIRED gtest)
include_directories(${GTEST_INCLUDE_DIRS})
target_link_libraries(MyTest ${GTEST_LIBRARIES})
```

- Use the corresponding `gmock` `.pc` files similarly.

>**Tip:** Using `pkg-config` helps keep build configurations clean and portable by centralizing compilation and linking flags.

### 3. Automate Test Discovery and Execution

Integrate your tests into your CI/CD environment by automating their discovery and execution.

- With CMake:
  - Use the built-in CTest framework to register and run tests.

```cmake
enable_testing()
add_test(NAME MyTest COMMAND MyTest)
```

- In Bazel or other systems, ensure your test targets are included in your test suites and detectable by your automation tools.

- Use GoogleTest's command-line flags to customize test execution, filtering, and output formats suitable for CI parsing:

```bash
./MyTest --gtest_output=xml:report.xml --gtest_filter=MyTest.*
```

- For more advanced automation:
  - Integrate with `pkg-config` to detect installed versions and adjust run configurations.
  - Use sharding and parallelization via environment variables (`GTEST_TOTAL_SHARDS`, `GTEST_SHARD_INDEX`).

### 4. Best Practices and Troubleshooting

- **Link only what you need:** Prefer using `GTest::gtest_main` for simple projects, but link `GMock` when mocking is involved.

- **Consistent compiler options:** Build GoogleTest/GoogleMock and your tests with the same flags to avoid ABI issues.

- **Use modern CMake targets:** Prefer imported targets like `GTest::gtest` instead of specifying include directories and libraries manually.

- **If using pkg-config:** Confirm `.pc` files are installed and paths are correct. Use `pkg-config --exists gtest` to verify presence.

- **Common pitfalls:**
  - Mixing GoogleTest versions can cause linker errors.
  - Failing to call `enable_testing()` when expecting CTest integration.
  - Incomplete linking of required pthread or system libraries (most CMake integrations handle this).

- For troubleshooting, see [Installation and Environment Setup](https://yourdocs/guides/getting-started/setup-installation) and [Troubleshooting & Common Issues](https://yourdocs/getting-started/first-steps-validation/troubleshooting).

---

# Examples

### Minimal CMakeLists.txt snippet to integrate GoogleTest and GoogleMock:

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject)

# Find GoogleTest package
find_package(GTest REQUIRED)

# Create test executable
add_executable(MyTests test_main.cpp my_tests.cpp)

# Link with GoogleTest and GoogleMock
target_link_libraries(MyTests PRIVATE GTest::gtest GTest::gmock GTest::gtest_main GTest::gmock_main)

# Enable testing and add tests to CTest
enable_testing()
add_test(NAME MyTests COMMAND MyTests)
```

### Building and running tests with pkg-config and Makefile:

```makefile
CXX = g++
CXXFLAGS = $(shell pkg-config --cflags gtest gmock)
LDFLAGS = $(shell pkg-config --libs gtest_main gmock_main) -pthread

all: mytests

mytests: test_main.o my_tests.o
	$(CXX) $^ -o $@ $(LDFLAGS)

clean:
	rm -f *.o mytests
```

Run tests:
```bash
./mytests --gtest_output=xml:report.xml
```

---

# Summary

This page focuses on practical tips and best practices for integrating GoogleTest and GoogleMock with your build tools, primarily CMake and Bazel. It covers:

- Structuring test targets and binaries
- Using `pkg-config` to manage dependencies
- Automating test discovery for CI/CD
- Best practices to avoid common build and linking issues

For extended setup and troubleshooting, consult the related guides on [Installation and Environment Setup](https://yourdocs/guides/getting-started/setup-installation) and [Troubleshooting & Common Issues](https://yourdocs/getting-started/first-steps-validation/troubleshooting).

---

<AccordionGroup title="Additional Resources">
<Accordion title="Official GitHub Repository">
[GoogleTest GitHub](https://github.com/google/googletest)
</Accordion>
<Accordion title="CMake Integration Guide">
[Overview: Platform Support and Build Integration](https://yourdocs/overview/integrations-and-ecosystem/platform-support-and-build-integration)
</Accordion>
<Accordion title="GoogleMock CMake pkg-config Files">
- `gmock.pc`
- `gmock_main.pc`

These files are installed with GoogleMock to aid building with pkg-config.
</Accordion>
</AccordionGroup>

---

# Diagram: Build Integration Workflow

```mermaid
flowchart TD
  A[Project Source Code] --> B[Build System Configuration]
  B --> C{Choose Build System}
  C -->|CMake| D[Add Subdirectory or find_package(GTest)]
  C -->|Bazel| E[Define cc_test Targets]

  D --> F[Link Test Targets with GTest and GMock Libraries]
  E --> G[Link Test Targets with GoogleTest and GoogleMock Dependencies]

  F --> H[Build Test Executable]
  G --> H

  H --> I[Run Tests]
  I --> J[Generate Test Reports (XML/JSON)]
  J --> K[Integrate with CI/CD Pipelines]

  subgraph pkg-config
    B --- L[Use pkg-config to discover GTest/GMock flags]
    L --> F
  end
```

This flow describes how your test sources go through your build configuration to produce test executables that run and generate reports, supported by pkg-config discovery where applicable.
