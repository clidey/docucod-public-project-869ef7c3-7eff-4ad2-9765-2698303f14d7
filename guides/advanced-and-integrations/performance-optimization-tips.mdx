---
title: "Performance Optimization Tips"
description: "Practical techniques for keeping your test suite fast and reliable, including test selection, parallelization, optimizing fixtures, and best use of resources."
---

# Performance Optimization Tips

## Overview

This guide equips you with practical techniques for keeping your GoogleTest and GoogleMock test suites both fast and reliable. By applying strategies around test selection, parallel test execution, optimizing fixtures, and sensible resource management, you'll ensure your tests scale efficiently as your codebase grows.

## Who This Is For

- Developers maintaining large or growing C++ codebases using GoogleTest/GoogleMock
- Engineers looking to reduce test execution time without sacrificing reliability
- Test architects aiming for scalable CI/CD pipelines

## What You Will Achieve

By following this guide, you will learn to:

- Select and run only relevant subsets of tests to reduce wasted effort
- Run tests in parallel to maximize CPU utilization without conflicts
- Design and manage test fixtures to minimize expensive setup/teardown
- Use resources judiciously to avoid test flakiness and performance degradation

## Estimated Time

Approximately 10-20 minutes depending on familiarity with test infrastructure and toolchain.

---

## 1. Selective Test Execution

### Why Select Tests?
Running the entire test suite on every code change can be slow and inefficient. Selective test execution reduces runtime by focusing on tests affected by the recent changes.

### How To Select Tests

- Use built-in test filters (`--gtest_filter`) to run only matching test suites or test names.
  
  ```bash
  ./my_tests --gtest_filter=MyComponentTest.*
  ```

- Integrate test selection into your build system or CI tooling by associating source files with test suites.

- Continuously update and refine filters based on code ownership and dependencies.

### Verify Your Selection

Run tests with filters to confirm they cover intended code paths properly.

---

## 2. Parallelizing Test Runs

### Benefits
Leveraging multiple CPUs can dramatically reduce total test suite runtime.

### Execution Approaches

- Use GoogleTest’s `--gtest_jobs=N` flag (*in environments supporting it*) to run tests concurrently.

- Employ a test runner or CI system that splits test binaries or suites across agents.

- Ensure tests are isolated and avoid shared state that causes conflicts or race conditions.

### Best Practices

- Avoid tests that depend on global mutable state unless properly synchronized.
- Use unique temporary directories or filenames per test instance.
- Design fixtures to prevent cross-test contamination.

### Example
If your CI has 8 cores, run tests in 8 parallel jobs:

```bash
./run_tests --gtest_jobs=8
```

---

## 3. Optimizing Test Fixtures

### Minimize Expensive Setup

Fixtures with heavy setup/teardown slow down each test. Reduce this by:

- Sharing common setup across multiple tests if safe, using `SetUpTestSuite` and `TearDownTestSuite` methods.
- Lazily initializing resources only when needed.

### Use Constructor/Destructor Overhead Wisely

GoogleTest calls a fresh fixture for each test. Use the constructor/destructor for lightweight initialization and cleanup where possible; avoid expensive operations there.

### Avoid Global or Static State Pollution

Managing state locality improves test independence and reduces flakiness.

### Example

```cpp
class MyFixture : public ::testing::Test {
 protected:
  static std::unique_ptr<HeavyResource> shared_resource_;

  static void SetUpTestSuite() {
    shared_resource_ = std::make_unique<HeavyResource>();
  }
  
  static void TearDownTestSuite() {
    shared_resource_.reset();
  }
};
```

---

## 4. Resource Management Best Practices

### Avoid Global Locks or Long-Running Threads

Tests competing for global synchronization points or using background threads can become contented and slow.

### Manage Temporary Files and Network Resources

- Isolate temporary files per test.
- Clean up after tests to avoid buildup.

### Control Mock Object Behaviors to Avoid Slow or Blocking Calls

- Use `ON_CALL` and `EXPECT_CALL` with `WillOnce` or `WillRepeatedly` wisely to avoid unintended blocking behaviors.

### Suppress Unnecessary Logging

Excessive logging slows tests and clutters output. Use appropriate gMock verbosity (`--gmock_verbose=warning` or `error`) to limit logs.

---

## 5. Continuous Monitoring & Troubleshooting

### Common Issues

- **Tests running slower after adding more mocks:** Check fixture setup and mock behaviors for costly side effects.
- **Flaky parallel tests:** Verify absence of shared mutable state or race conditions.
- **Excessive warnings or logs:** Use appropriate verbosity flags; convert naggy mocks to nice mocks where safe.

### Profiling Test Execution

Measure individual test runtime to identify bottlenecks and optimize accordingly.

<Tip>
If you have a large test suite, integrate test execution profiling tools or CI reports to understand slow tests.
</Tip>

### Debugging Performance Problems

- Use `--gtest_repeat` to isolate intermittent slow behavior.
- Use Google Mock’s verbose options (`--gmock_verbose=info`) sparingly during debugging.

---

## Summary

By deliberately managing which tests you run, how they execute, and how resources are used, you maintain a performant test suite that grows with your project. Optimize incrementally and measure the impact of changes frequently.

---

## Related Documentation

- [Getting Started Guide](../overview/quickstart-integration/getting-started.md)
- [GoogleMock Cheat Sheet](../docs/gmock_cheat_sheet.md)
- [Mocking Techniques and Patterns](../guides/core-testing-workflows/mocking-techniques.md)
- [Mock Object Strictness Modes](../guides/advanced-and-integrations/mock-object-strictness.md)
- [FAQ: Improving Test Performance](../faq/integration-performance/performance-optimization.md)


---

## Quick Reference

| Technique                  | Action Needed                                 | Outcome                          |
|----------------------------|----------------------------------------------|---------------------------------|
| Selective test execution    | Use `--gtest_filter` with targeted tests     | Faster runs, focused testing     |
| Parallel test runs          | Use multiple jobs/threads                      | Utilizes available CPU cores     |
| Optimized test fixtures    | Shared setup with `SetUpTestSuite`            | Reduced setup overhead           |
| Resource-conscious mocks   | Control mock behaviors, suppress noise        | Reduced flakiness and overhead  |

---

### Callouts
<Check>
Always verify that your tests remain reliable after optimizing for speed.
</Check>

<Tip>
Consider automating test selection based on code changes in CI pipelines for maximum efficiency.
</Tip>

<Warning>
Parallelizing tests requires careful fixture and resource management to avoid flaky failures.
</Warning>

<Info>
Using `NiceMock` instead of default mocks can suppress annoying uninteresting call warnings and improve test logs.
</Info>
