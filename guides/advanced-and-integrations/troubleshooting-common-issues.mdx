---
title: "Troubleshooting Common Test Issues"
description: "A practical guide to diagnosing and solving frequent problems in writing and running tests, such as flaky tests, linking errors, and integration failures. Includes tips, gotchas, and workarounds."
---

# Troubleshooting Common Test Issues

## Overview

This guide helps you identify and resolve frequent problems encountered when writing and running tests using GoogleTest and GoogleMock. Common challenges such as flaky tests, linking errors, integration failures, and expectation mismatches are addressed with practical, straightforward solutions. By following this guide, you'll be able to maintain reliable, efficient tests and diagnose issues swiftly.

---

## Prerequisites

- GoogleTest and GoogleMock must be correctly installed and integrated into your project.
- Basic familiarity with writing tests using `TEST` and `TEST_F` macros.
- Understanding of mock classes created using `MOCK_METHOD` macros and expectation setup via `EXPECT_CALL`.

---

## Common Issues and How to Fix Them

### 1. Flaky Tests (Non-Deterministic Test Failures)

Flaky tests intermittently pass or fail without code changes, often due to timing, environment, or concurrency issues.

**How to diagnose:**

- Check if tests depend on external resources (network, files, databases).
- Look for shared global state or race conditions within tests.
- Run tests in isolation and repeat to detect inconsistency.

**Workarounds and fixes:**

- Use mocks (`GoogleMock`) to isolate dependencies and remove reliance on external systems.
- Add explicit synchronization or serialization in tests involving asynchronous operations.
- Avoid reliance on real-time or random values; instead, use deterministic inputs.
- Use test-specific setup and teardown to clear state properly.

<Tip>
Use `--gmock_verbose=info` to get detailed logs of mock interactions during flaky test debugging.
</Tip>

---

### 2. Linking Errors and Missing Symbols

If tests fail to link successfully, the following are common causes:

- Missing virtual destructors in base classes causing undefined behaviors.
- Macro conflicts (e.g., Windows API redefining identifiers).
- Improper build configuration or missing GoogleTest libraries.

**How to resolve:**

- Ensure **all interfaces and base classes that you mock have virtual destructors**. This is critical to avoid subtle bugs when deleting mocks.

- Review build and linking instructions from the platform-specific setup guides.

- Verify that you include `gmock` and `gtest` libraries and headers correctly.

- If using Windows, watch for macro conflicts and use `#undef` or namespace qualifiers to avoid collisions.

<Warning>
Always declare virtual destructors in your interfaces before mocking, e.g.,
```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual void Bar() = 0;
};
```
</Warning>

---

### 3. Unexpected or Uninteresting Mock Function Calls

GoogleMock distinguishes the following:

- **Unexpected calls**: Calls to mock methods that do not match any `EXPECT_CALL`. These are errors.
- **Uninteresting calls**: Calls to mock methods with no expectations set. By default, they generate warnings.

**Frequently encountered symptoms:**

- Warnings like "Uninteresting mock function call".
- Test failures due to unexpected function calls.

**Resolution strategies:**

- Use `EXPECT_CALL` to explicitly specify expectations on mock methods you expect to be called.

- To suppress warnings on calls you don't care about, wrap your mock in `NiceMock<MockType>`.
  ```cpp
  NiceMock<MockFoo> mock_foo;
  ```

- If you want to ensure no other calls than explicitly expected ones happen, use `StrictMock<MockType>`.

- Add catch-all expectations when other calls are acceptable but irrelevant:
  ```cpp
  EXPECT_CALL(mock_foo, SomeMethod(_)).Times(AnyNumber());
  ```

---

### 4. Cardinality Mismatches and Excessive Calls

Excessive calls occur when a mock method is called more times than expected.

**Typical message:**
```
Mock function called more times than expected
```

**How to avoid:**

- Define precise call counts using `.Times()`, e.g., `.Times(Exactly(2))`.

- For flexible counts, use `.Times(AtLeast(n))` or `.Times(AnyNumber())` when appropriate.

- Chain multiple `WillOnce()` actions to specify behaviors for sequential calls.

- Use `.RetiresOnSaturation()` if you want an expectation to deactivate after reaching its call limit.

---

### 5. Integration Failures with Build and CI Systems

Tests may fail to build or run properly due to integration or environment issues.

**Guidelines:**

- Follow platform-specific setup for your OS and toolchain.

- Make sure you integrate properly with build systems like CMake or Bazel.

- Use the integration guides for setting up and running tests in CI environments.

- Confirm all dependencies are included in build configurations.

---

### 6. Diagnosing Assertion Failures and Mismatched Expectations

Sometimes tests fail due to incorrect matcher usage or unsatisfied call order.

**Effective debugging tactics:**

- Utilize `--gmock_verbose=info` to see detailed call matching logs.

- Check call ordering when using sequences or `.InSequence()`/`.After()` clauses.

- For overloaded mock methods, ensure you disambiguate using parameter matchers or `Const()` wrapper.

- Simplify matchers by using `_` wildcard when argument specifics are unimportant.

---

## Practical Tips & Best Practices

- Always set expectations *before* exercising mocks; do not mix `EXPECT_CALL` statements after mock use.

- Use `ON_CALL` to define common default behavior without setting expectations.

- Avoid over-constraining tests; prefer specifying only what matters to minimize brittle tests.

- When mocking classes you don't own, define mocks close to the class and share them to minimize maintenance overhead.

- For logs or verbose output, control verbosity with the `--gmock_verbose` flag (`info`, `warning`, `error`).

- Use `Mock::VerifyAndClearExpectations()` to force verification of mocks before their destruction when necessary.

- Prefer mock interfaces for dependencies instead of mocking concrete classes directly.

- To suppress uninteresting call warnings for particular methods, prefer using `Times(AnyNumber())` on relevant `EXPECT_CALL`s.

---

## Troubleshooting Workflow Example

**Scenario:** Unexpected call to a mocked method.

1. Run your test with `--gmock_verbose=info`.
2. Identify which call was unexpected from the detailed output.
3. Add or adjust `EXPECT_CALL` matching this call before the code exercise.
4. Run tests again to verify the expectation is matched and no warnings/errors remain.

---

## Additional Resources

- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Advanced recipes and examples for dealing with complex mocks.
- [Mocking FAQ](https://google.github.io/googletest/gmock_faq.html): Answers to common FAQ and intricate mocking questions.
- [GoogleTest Primer](../getting-started/first-test-and-validation/quickstart-primer): Basics of writing and running tests.
- [Supported Platforms & Toolchains](../overview/integration-and-ecosystem/supported-platforms): Guidance on platform compatibility.
- [Integrating with Build and CI Systems](../guides/advanced-and-integrations/integrating-with-build-systems): Best practices for build integration.

---

## Summary

Whether you are encountering linking errors, flaky tests, or unexpected mock function calls, addressing these common pitfalls and following the outlined best practices ensures robust, maintainable test suites. Leveraging Google's verbose debugging and mock control features gives you transparency into test execution and faster diagnosis.

---

*For a deep dive into mocking techniques and defining mocks, see [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and the [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html).*


---

## Troubleshooting Checklist

- Verify virtual destructors are declared on all base classes.
- Ensure all mocks have expectations set before use.
- Use `NiceMock` or `StrictMock` to control warnings.
- Audit tests for flaky or timing-dependent constructs.
- Consult platform-specific setup if build issues arise.
- Use verbose flags (`--gmock_verbose=info`) for comprehensive logs.


---

## Frequently Asked Questions

<AccordionGroup title="Common Troubleshooting FAQs">
<Accordion title="Why am I getting uninteresting call warnings?">

This occurs when mock methods are called without a matching `EXPECT_CALL`. They are warnings that could signal missing expectations. Suppress them with `NiceMock` or by adding broad `EXPECT_CALL` with `Times(AnyNumber())`.

</Accordion>

<Accordion title="How do I avoid flaky tests?">

Isolate dependencies using mocks, avoid shared state and asynchronous hazards, and ensure determinism in inputs and environment.

</Accordion>

<Accordion title="What causes linking errors with mocks?">

Missing virtual destructors or incorrect linkage to GoogleTest/GoogleMock libraries are the usual causes. Confirm your build is configured properly.

</Accordion>

<Accordion title="How can I debug failing expectations?">

Use `--gmock_verbose=info` to see which calls match expectations and where mismatches occur.

</Accordion>

</AccordionGroup>

---

## What's Next

- Explore [Writing and Running Your First Test](../getting-started/first-test-and-validation/writing-and-running-your-first-test) to create robust tests.
- Learn mocking best practices in [Mocking Dependencies with GoogleMock](../guides/core-testing-workflows/mocking-with-googlemock).
- Deepen your understanding with the [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).
- Increase test reliability using tips from the [Performance and Best Practices](../guides/advanced-and-integrations/performance-and-best-practices) guide.


<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/gmock_for_dummies.md", "range": "1-250"},{"path": "docs/gmock_cook_book.md", "range": "1-800"},{"path": "docs/gmock_faq.md", "range": "1-250"},{"path": "docs/gmock_cheat_sheet.md", "range": "1-180"},{"path": "docs/reference/mocking.md", "range": "1-3200"}]} />