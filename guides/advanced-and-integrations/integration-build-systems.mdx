---
title: "Integrating with Build Systems & CI"
description: "Explains how to incorporate GoogleTest into modern build systems (CMake, Bazel), how to set up and automate test runs, and resolve integration nuances. Provides real-world CI/CD tips for C++ projects."
---

# Integrating with Build Systems & CI

GoogleTest is designed to seamlessly integrate with modern C++ build systems and Continuous Integration (CI) workflows. This guide walks you through incorporating GoogleTest into common build tools like CMake and Bazel, automating test executions, and resolving common integration nuances. By following these best practices, you’ll enable robust, repeatable testing as part of your development and release pipelines.

---

## Workflow Overview

### What This Guide Helps You Accomplish
This guide explains how to:

- Embed GoogleTest into CMake and Bazel build environments.
- Automate test builds and runs within CI/CD pipelines.
- Handle integration nuances, such as compiler compatibility and threading.
- Optimize test execution and reporting in CI contexts.

### Prerequisites

- A C++ project with GoogleTest source or installed libraries available.
- Familiarity with CMake or Bazel build systems.
- A CI environment or system where automated builds and tests will run.
- A compiler supporting at least C++17.

### Expected Outcome

By following this guide, you will have GoogleTest building and running as part of your project's build system, fully integrated with CI pipelines to automate testing and help catch regressions early.

### Estimated Time

Setting basic integration may take 30 minutes to an hour, depending on familiarity with build systems and CI tools.

### Difficulty Level

Intermediate — requires knowledge of build systems and C++ project configuration.

---

## Step-by-Step Instructions

### 1. Integrating GoogleTest with CMake

GoogleTest supplies official CMake scripts to incorporate it as a standalone project or embed it into your existing build.

#### Standalone Build Setup

1. Clone GoogleTest's repository matching your required version:
   ```bash
   git clone https://github.com/google/googletest.git -b v1.17.0
   cd googletest
   mkdir build
   cd build
   ```

2. Generate build files:
   ```bash
   cmake ..
   ```
   *To build only GoogleTest (no GoogleMock), add* `-DBUILD_GMOCK=OFF`.

3. Build GoogleTest:
   ```bash
   make
   ```

4. (Optional) Install it system-wide:
   ```bash
   sudo make install
   ```

> **Note:** On Windows with Visual Studio, open the generated `.sln` file and build.
>
> On macOS with Xcode, open the `.xcodeproj` file.

#### Incorporating into an Existing CMake Project

The recommended approach is to add GoogleTest as part of your project build to ensure consistent compiler and linker flags:

1. Add the following snippet to your `CMakeLists.txt`:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
# On Windows: synchronize runtime linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(your_test_executable your_test.cpp)
target_link_libraries(your_test_executable gtest_main)
add_test(NAME your_test COMMAND your_test_executable)
```

2. This will automatically download GoogleTest during configuration and build it with your project.

3. Make sure your project uses CMake 3.14 or newer because of `FetchContent_MakeAvailable()`.

> **Tip:** Setting `gtest_force_shared_crt` to `ON` avoids linker errors on Windows related to runtime libraries.

#### C++ Standard and Compiler Options

- GoogleTest requires C++17; you should explicitly set this in your top-level CMakeLists:
  ```cmake
  set(CMAKE_CXX_STANDARD 17)
  set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```
- Ensure proper threading flags and libraries are found by CMake (usually automatic).

---

### 2. Integrating GoogleTest with Bazel

Bazel is a fast, correct build system widely used in large C++ projects.

1. Add GoogleTest to your Bazel workspace, typically via a `MODULE.bazel` file or in your `WORKSPACE` with the appropriate Bazel rules for downloading and managing dependencies.

2. Define your test targets in `BUILD` files using `cc_test` rules:

```python
cc_test(
    name = "example_test",
    srcs = ["example_test.cc"],
    deps = ["@com_github_google_googletest//:gtest_main"],
    copts = ["-std=c++17"],
)
```

3. Build and run tests using:

```bash
bazel build //path/to:example_test
bazel test //path/to:example_test
```

4. For continuous integration, configure your CI system to invoke Bazel's build and test commands similarly.

> For full Bazel integration details, consult the [Installing with Bazel guide](https://github.com/google/googletest/blob/main/docs/getting-started/installation-and-configuration/install-bazel.md).

---

### 3. Automating Test Runs in CI/CD Pipelines

To incorporate GoogleTest into CI environments, you need to automate both building and running tests with reliable reporting.

#### Build and Test Scripts

- Use build system commands (e.g., `cmake --build`, `bazel test`) in your CI workflows.
- Ensure your build scripts:
  - Configure with the correct C++ standard.
  - Enable parallel builds for speed.
  - Capture and handle test exit codes properly.

#### Running Tests & Reporting

- GoogleTest returns a non-zero exit code if any test fails — critical for CI failure detection.
- Enable XML output for test reports by adding the `--gtest_output=xml:<path>` flag when running your test executable.
- Many CI systems support parsing GoogleTest XML results to present detailed reports.

Example run command with XML output:
```bash
./your_test_executable --gtest_output=xml:results.xml
```

#### Common CI Integration Tips

- Cache built GoogleTest artifacts where possible.
- Use GNU Make, Ninja, or Bazel’s native caching and parallelism features to speed up builds.
- Set up environment-specific variables in your build scripts (for Windows, Linux, macOS).
- Validate that GoogleTest and GoogleMock initialization (`InitGoogleTest()` or `InitGoogleMock()`) is called correctly to parse flags and set up test framework.

---

### 4. Resolving Common Integration Nuances

#### Compiler and Runtime Mismatch

- GoogleTest can default to static runtime linkage on Windows, which may conflict with your project's dynamic runtime linkage.
- Use `-Dgtest_force_shared_crt=ON` to align GoogleTest with your project’s runtime linkage.

#### Threading Support

- GoogleTest is thread-safe if built with pthread support on POSIX systems.
- For custom build systems, manually link against pthread if needed.
- Use flags like `-DGTEST_HAS_PTHREAD=1` or `0` to force enable or disable threading support.

#### Building as Shared Libraries

- Though GoogleTest is typically linked statically, building shared libraries (DLLs) is possible.
- Set `-DGTEST_CREATE_SHARED_LIBRARY=1` to build shared libraries.
- Add `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when compiling your test binaries to link correctly.
- Shared builds can improve load performance, especially in large projects or CI environments.

#### Avoiding Macro Name Conflicts

- If you encounter macro name collisions in your code, define flags like `-DGTEST_DONT_DEFINE_TEST=1` to rename conflicting macros.

---

## Practical Tips & Best Practices

- Prefer linking with `gtest_main` or `gmock_main` to avoid writing boilerplate `main()` functions.
- Always check the exit code of `RUN_ALL_TESTS()` to ensure CI catches test failures.
- Use CTest or native test runners integrated into IDEs or CI for richer testing feedback.
- Group GoogleTest-related code logically and keep dependencies clear to ease CI build maintenance.
- Regularly update your GoogleTest submodules or FetchContent versions to keep up with bug fixes and features.

---

## Troubleshooting Common Issues

### Build or Link Errors on Windows

- Confirm your runtime flags match between GoogleTest and your project.
- Use the `gtest_force_shared_crt` flag to switch runtime linkage.

### Missing pthread Library on Linux

- If experiencing unresolved references to pthread symbols, ensure your compiler flags include `-pthread`.
- If using CMake, this is handled automatically when `find_package(Threads)` finds pthread.

### Tests Not Found or Not Running

- Confirm tests are registered (via `TEST()`, `TEST_F()`, etc.) and your test program calls `RUN_ALL_TESTS()` once after `InitGoogleTest()`.
- Verify test discovery in your build system includes all test source files.

---

## Relevant Example: Embedding GoogleTest into CMake

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest_main)
add_test(NAME my_tests COMMAND my_tests)
```

---

## Visualizing the CMake Integration Flow

```mermaid
flowchart TD
  Start([Start CMake Configure]) --> Fetch[Test FetchContent_Declare]
  Fetch --> Download[Download GoogleTest Sources]
  Download --> Build[Test GoogleTest Build]
  Build --> Link[Link GoogleTest to Your Tests]
  Link --> Run[Run Tests with RUN_ALL_TESTS()]
  Run --> Report[Generate Test Reports]
  Report --> End([End])
```

---

## Next Steps & Related Content

- Explore the [Installing with CMake](../getting-started/installation-and-configuration/install-cmake.md) and [Installing with Bazel](../getting-started/installation-and-configuration/install-bazel.md) guides for more detailed build setup.
- Review the [Quick Setup & First Test](../guides/getting-started-workflows/quick-setup.md) guide to learn how to write and run your first tests.
- Consult the [Common Setup Issues](../getting-started/setup-troubleshooting/common-setup-issues.md) documentation for resolving integration problems.
- For CI-specific pipelines, see third-party examples and community plugins that integrate GoogleTest XML output with Jenkins, GitHub Actions, GitLab CI, or other popular tools.

---

<Tip>
Start integrating GoogleTest early in your project setup and automate test runs as part of your CI pipeline to catch bugs quickly and improve code quality continuously.
</Tip>

<Check>
Verify your build system is correctly linking GoogleTest with matching runtime libraries and that tests are registered and run successfully in CI.
</Check>
