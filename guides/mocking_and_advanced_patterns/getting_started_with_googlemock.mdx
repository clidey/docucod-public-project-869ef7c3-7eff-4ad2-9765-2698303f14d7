---
title: "Getting Started with GoogleMock"
description: "Follow this tutorial to start mocking dependencies in C++ using GoogleMock. Learn to define mock classes, use expectation macros, and interpret typical test failures."
---

# Getting Started with GoogleMock

Welcome to your first step toward mastering mocking dependencies in C++ using GoogleMock. This guide walks you through defining mock classes, setting expectations, and decoding common testing issues.

---

## 1. Introduction to GoogleMock Workflow

### What This Guide Will Help You Achieve
In this tutorial, you will learn how to:
- Define mock classes that simulate interfaces or abstract classes.
- Use `EXPECT_CALL` and `ON_CALL` macros to specify expected interactions.
- Handle common patterns like mocking overloaded methods and templates.
- Interpret typical failure messages to diagnose test issues.

### Prerequisites
You should have:
- Basic familiarity with C++ and unit testing.
- GoogleMock and GoogleTest installed and configured in your project.
- A working development environment with a C++17 compatible compiler.

### Expected Outcome
By the end, you will be able to create and integrate mock objects in your C++ tests, improving your test coverage and design clarity.

### Time Estimate
Approximately 30-45 minutes.

### Difficulty Level
Beginner to Intermediate.

---

## 2. Defining Mock Classes

GoogleMock simplifies mock class creation through the `MOCK_METHOD` macro.
Here is how to get started with typical classes and common nuances.

### Mocking a Normal Class
Suppose you have this abstract base class:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual std::string Describe(int type) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};
```

Defining its mock class looks like this:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

### Best Practice Tip
Ensure the destructor in your base class is marked `virtual`. This avoids undefined behavior and ensures mocks work correctly.

### Mocking Class Templates
Mock templates similarly:

```cpp
template <typename Elem>
class StackInterface {
 public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const Elem& x) = 0;
};

template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

### Handling Commas in Arguments
If your mock method's parameters involve commas (like `std::pair`), wrap them in parentheses or use type aliases:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### Mocking Overloaded Methods
Mock all versions of overloaded methods to prevent hidden base method warnings:

```cpp
MOCK_METHOD(int, Add, (Element x), (override));
MOCK_METHOD(int, Add, (int times, Element x), (override));

MOCK_METHOD(Bar&, GetBar, (), (override));
MOCK_METHOD(const Bar&, GetBar, (), (const, override));
```

If you mock only some overloads, use `using BaseClass::MethodName;` to avoid hiding.

### Types of Mocks: Nice, Strict, and Naggy
You can make a mock object vary in how it treats unexpected calls:

- `NiceMock<MockFoo>`: suppresses warnings for unexpected calls.
- `NaggyMock<MockFoo>`: (default) warns on unexpected calls.
- `StrictMock<MockFoo>`: treats unexpected calls as errors.

Example:

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, DoThis());
```

### Important Usage Note
Put the `MOCK_METHOD` declarations in the `public` section of your mock class, even if the methods in the base are `protected` or `private`.

---

## 3. Using Mocks in Tests

### Typical Workflow
1. Import `testing` namespace symbols you need (e.g., `Return`, `NiceMock`).
2. Instantiate your mock objects.
3. Optionally define default actions using `ON_CALL`.
4. Set explicit expectations with `EXPECT_CALL`.
5. Run your test code that interacts with mocks.
6. Upon destruction, mocks verify that all expectations were met.

### Example
```cpp
#include <gmock/gmock.h>
using ::testing::Return;

TEST(BarTest, DoesThis) {
  MockFoo foo;

  // Default actions for some methods
  ON_CALL(foo, GetSize()).WillByDefault(Return(1));

  // Expect Describe(int) to be called 3 times, returning a specific value
  EXPECT_CALL(foo, Describe(5))
      .Times(3)
      .WillRepeatedly(Return("Category 5"));

  // Exercise the code
  EXPECT_EQ(MyProductionFunction(&foo), "good");
}
```

### Default Actions vs Expectations
- `ON_CALL`: Defines what happens *when* a method is called but doesn't require the call.
- `EXPECT_CALL`: Requires that the call happens as specified.

Use `ON_CALL` for common default behaviors shared by tests, and `EXPECT_CALL` to verify specific interactions.

---

## 4. Setting Expectations and Actions

### Specifying How Many Times Methods Are Called
Use `.Times()` with cardinalities like `Exactly(n)`, `AtLeast(n)`, or `AnyNumber()`.

### Controlling Call Order
Use `InSequence` to enforce the order of method calls, or `After()` to specify partial ordering dependencies.

Example of ordered calls:

```cpp
using ::testing::InSequence;
{
  InSequence s;
  EXPECT_CALL(foo, Init());
  EXPECT_CALL(foo, Process());
}
```

### Default Actions
If no `WillOnce` or `WillRepeatedly` is set, GoogleMock returns default-constructed values for functions with return types.

Explicitly define behaviors with:

- `.WillOnce(action)` - used for a single call.
- `.WillRepeatedly(action)` - used for all calls after `WillOnce` are consumed.

### Common Actions
- `Return(value)` — return a fixed value.
- `ReturnRef(variable)` — return a reference.
- Use lambdas or functions with `Invoke` to specify more complex behaviors.

### Tips
- Use `RetiresOnSaturation()` when you want an expectation to be disabled after it's met.
- Avoid overspecifying mocks — don’t use more expectations than needed.

---

## 5. Troubleshooting Common Issues

### Uninteresting Calls Warning
If you see warnings like "Uninteresting mock function call", it means a method was called without an `EXPECT_CALL`.
- Use `NiceMock` to suppress these warnings where appropriate.
- Alternatively, add `EXPECT_CALL(...).Times(AnyNumber())` to explicitly allow calls.

### Unexpected Calls
Calls that don’t match any expectation lead to errors. Confirm your expectations match the intended calls.

### Too Few or Too Many Calls
GoogleMock verifies the exact number of calls as specified by `.Times()`. Adjust `Times` or use `AtLeast`/`AtMost` to fix.

### Overloaded Method Ambiguities
Specify the correct overload explicitly or mock all overloads to prevent compilation warnings or runtime issues.

### Virtual Destructor Requirement
Ensure your base class has a virtual destructor to avoid undefined behavior and heap errors when mocking.

---

## 6. Practical Example: Step-by-Step Mock Setup

### Step 1: Define the Interface and Mock

```cpp
class Database {
 public:
  virtual ~Database() = default;
  virtual bool Connect(const std::string& uri) = 0;
  virtual int GetRecordCount() const = 0;
};

class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& uri), (override));
  MOCK_METHOD(int, GetRecordCount, (), (const, override));
};
```

### Step 2: Write Your Test Using the Mock

```cpp
#include <gmock/gmock.h>
using ::testing::Return;
using ::testing::NiceMock;

TEST(DatabaseTest, ConnectsSuccessfully) {
  NiceMock<MockDatabase> mock_db;

  ON_CALL(mock_db, Connect(::testing::_))
      .WillByDefault(Return(true));

  EXPECT_CALL(mock_db, Connect("db://localhost"))
      .Times(1);

  MyApp app(&mock_db);
  EXPECT_TRUE(app.InitializeDatabase("db://localhost"));
}
```

### Step 3: Run and Verify
- When the test runs, `mock_db.Connect` will be called.
- GoogleMock will verify the expectation has been met.

---

## 7. Best Practices & Tips

- Define mocks only for interfaces or classes with virtual methods.
- Use `NiceMock` to reduce noise from uninteresting calls unless strict verification is needed.
- Always set expectations before invoking the code that uses mocks.
- Use type aliases or parentheses to handle complex argument types in `MOCK_METHOD`.
- Use `.RetiresOnSaturation()` to avoid sticky expectations causing test brittleness.

---

## 8. Next Steps & Further Learning

- Explore **Writing Flexible Expectations and Matchers** to deepen your control over argument verification.
- Look into **Advanced Mock Behaviors and Actions** for customizing mock methods beyond simple return values.
- Read the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for practical recipes.
- Refer to the Mocking Reference for thorough details on APIs and clauses.

---

## 9. Additional Resources

- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — quick syntax reference.
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html) — answers to common problems.
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — deeper introduction to GoogleTest and GoogleMock.

---

For full API usage and all the details on matchers, actions, and cardinalities, consult the sections:
- [Defining and Using Mocks](https://google.github.io/googletest/reference/mocking.html)
- [Setting Expectations and Actions](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL)

---

# Summary
This guide introduces you to GoogleMock by teaching you how to define mock classes, set expectations using `EXPECT_CALL` and `ON_CALL`, and troubleshoot common test failures. Starting with defining mock interfaces to writing complete tests, it empowers you to efficiently mock dependencies in C++ tests.

主要章节包括:
- Defining Mock Classes
- Using Mocks in Tests
- Expectations, Actions, and Call Control
- Troubleshooting Common Issues
- Best Practices and Practical Tips

重要链接:
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html)

推荐接下来的文档:
- Guides on writing flexible expectations and advanced mock behaviors
- Core concepts and terminology in related overview sections

开始使用 GoogleMock，将提升你的单元测试的准确性和维护性。下一步，请参阅“Writing Flexible Expectations and Matchers”引导，以掌握更复杂的需求。