---
title: "Integrating with Build Systems"
description: "Detailed tutorials for integrating GoogleTest and GoogleMock with CMake and Bazel. Covers practical steps, build file modifications, and troubleshooting tips for real projects."
---

# Integrating with Build Systems

GoogleTest and GoogleMock seamlessly integrate with popular C++ build systems like CMake and Bazel. This guide provides practical tutorials to help you add GoogleTest and GoogleMock to your projects by modifying build files, setting up dependencies, and resolving common integration challenges.

---

## Workflow Overview

- **Purpose**: Enable you to integrate GoogleTest and GoogleMock into your CMake or Bazel project builds smoothly.
- **Prerequisites**:
  - Have a C++ project using CMake or Bazel as the build system.
  - Basic familiarity with either CMakeLists.txt or Bazel BUILD files.
  - GoogleTest and GoogleMock source code cloned or available as dependencies.
- **Expected Outcome**: After completing the steps, your build system will compile and link tests using GoogleTest and GoogleMock with proper dependency management.
- **Time Estimate**: 20-40 minutes depending on project complexity and familiarity with the build system.
- **Difficulty Level**: Intermediate

---

## Integrating GoogleTest and GoogleMock with CMake

### 1. Standalone Build of GoogleTest

If you want to build GoogleTest separately before using it:

1. Clone the repository:
    ```bash
    git clone https://github.com/google/googletest.git
    cd googletest
    mkdir build
    cd build
    cmake ..
    make
    sudo make install    # Optional system-wide install
    ```
2. This builds both GoogleTest and GoogleMock by default.


### 2. Using GoogleTest Within Your Existing CMake Project

#### Option A: Using Installed GoogleTest

- Use `find_package` to discover GoogleTest and GoogleMock via CMake's config packages:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests GTest::gtest GTest::gmock GTest::gtest_main GTest::gmock_main)
add_test(NAME MyTests COMMAND my_tests)
```

- This approach assumes GoogleTest and GoogleMock have been built and installed on your system.


#### Option B: Embed GoogleTest source using `add_subdirectory()`

- Download or add GoogleTest as a git submodule inside your project.
- In your top-level `CMakeLists.txt`:

```cmake
add_subdirectory(path/to/googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gtest gmock gtest_main gmock_main)
add_test(NAME MyTests COMMAND my_tests)
```

- This method builds GoogleTest using the same compiler and flags as your project, avoiding incompatibilities.


#### Option C: Fetch GoogleTest at Configure Time

- Use CMake's `FetchContent` module to download GoogleTest during configuration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)

# Needed on Windows to avoid runtime conflicts
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp)
target_link_libraries(my_tests gtest gmock gtest_main gmock_main)
add_test(NAME MyTests COMMAND my_tests)
```

- This approach keeps GoogleTest versioned within CMake.


### 3. Important Considerations for CMake Integration

- **C++17 requirement:** Ensure your project sets `CMAKE_CXX_STANDARD` to at least 17:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

- **Visual Studio runtimes:** If building on Windows with Visual Studio, use the `gtest_force_shared_crt` option to ensure runtime compatibility:

```cmake
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
```

- **Linking libraries:** Link against `gtest`, `gmock`, and optionally `gtest_main` or `gmock_main` for test executables with a main function.


### 4. Sample `CMakeLists.txt` Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(
  my_tests
  test/test_suite.cpp
)
target_link_libraries(
  my_tests
  gtest
  gmock
  gtest_main
  gmock_main
)
add_test(NAME MyTests COMMAND my_tests)
```


## Integrating GoogleTest and GoogleMock with Bazel

> Bazel integration assumes you are familiar with Bazel BUILD files and WORKSPACE.

### 1. Add GoogleTest and GoogleMock dependencies in `WORKSPACE`

Add the following to your `WORKSPACE` file to link to GoogleTest and GoogleMock:

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.tar.gz"],
    strip_prefix = "googletest-release-1.17.0",
    sha256 = "abcdef123456...",  # Replace with correct sha256
)
```


### 2. Load GoogleTest/Bazel rules in your `BUILD` file

Declare test targets and link with GoogleTest and GoogleMock from the external repository:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = [
        "@com_google_googletest//:gtest",
        "@com_google_googletest//:gmock",
        # Your project deps
    ],
)
```


### 3. Write your tests as usual

- Write GoogleTest and GoogleMock tests.
- Bazel will manage building and linking the required dependencies automatically.


### 4. Run tests with Bazel

Simply run:

```bash
bazel test //path/to:my_test
```

---

## Troubleshooting & Tips

### Common Issues When Integrating

- **CMake not finding GoogleTest:** 
  - Verify GoogleTest is installed or the path to the source is correct.
  - Use `CMAKE_PREFIX_PATH` to help `find_package` locate GoogleTest.

- **RuntimeLibrary mismatches on Windows:**
  - Enable `gtest_force_shared_crt` in CMake.

- **C++ standard compatibility errors:**
  - Confirm `CMAKE_CXX_STANDARD` is at least 17.

- **Bazel sha256 mismatch:**
  - Ensure the checksum is correct for the downloaded GoogleTest archive.

### Best Practices

- Prefer using `FetchContent` or Bazel's `http_archive` instead of manual vendor copies.
- Link to `gtest_main` or `gmock_main` to avoid writing your own main function.
- Confirm build and test executables invoke `testing::InitGoogleMock` or `InitGoogleTest` before running tests.
- Use `add_test()` in CMake to include your test executables in the CTest framework.

### Performance Considerations

- GoogleTest and GoogleMock are lightweight; build impact is minimal.
- Embedding GoogleTest source in your project (via `add_subdirectory`) ensures consistent compile flags and reduces incompatibilities.


---

## Next Steps & Related Content

- After integration, explore the [Writing Your First Test & Mock](https://your-doc-link/guides/getting-started/writing-first-test) to write and run tests.
- For build configuration examples, refer to the [Building & Integration Patterns](https://your-doc-link/concepts/integration-security-scalability/build-and-integration-models) documentation.
- If you encounter obstacles, see [Troubleshooting & Solutions to Common Issues](https://your-doc-link/guides/integration-and-real-world-scenarios/troubleshooting-common-issues).

---

## Summary

Integrating GoogleTest and GoogleMock into your existing C++ projects using CMake or Bazel is streamlined by their built-in support and flexible configuration. This guide walked you through practical, step-by-step instructions for incorporating and linking the test frameworks, along with recommended configurations and troubleshooting tips to ensure smooth builds and test runs.


---

## References

- GoogleTest CMake Build Script — [CMakeLists.txt](https://github.com/google/googletest/blob/main/CMakeLists.txt)
- GoogleTest GitHub Repository — https://github.com/google/googletest/
- GoogleMock Cheat Sheet — https://google.github.io/googletest/gmock_cheat_sheet.html
- GoogleTest Build and Integration Patterns — /concepts/integration-security-scalability/build-and-integration-models
- GoogleMock Mocking Reference — /docs/reference/mocking

------------

## Example CMake Minimal Workflow

```bash
# Clone GoogleTest (optional if embedding)
git clone https://github.com/google/googletest.git
dir=%cd%

# Create build directory
mkdir build && cd build

# Configure the build
cmake .. -DCMAKE_CXX_STANDARD=17

# Build
make

# If installed, find_package in your project CMakeLists.txt
# then add target link libraries:
# target_link_libraries(my_tests gtest gmock gtest_main gmock_main)
```

## Example Bazel WORKSPACE snippet

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.tar.gz"],
    strip_prefix = "googletest-release-1.17.0",
    sha256 = "<correct-checksum>",
)
```

## Example Bazel BUILD snippet

```python
cc_test(
    name = "example_test",
    srcs = ["example_test.cc"],
    deps = ["@com_google_googletest//:gmock", "@com_google_googletest//:gtest"],
)
```


---

<Tip>
Always match the compiler and linker settings between your project and GoogleTest to avoid runtime issues. Embedding GoogleTest sources via `add_subdirectory` or downloading it as part of build is the most reliable approach.
</Tip>

<Note>
You must initialize GoogleMock (which also initializes GoogleTest) in your test executable via `testing::InitGoogleMock(&argc, argv);` before calling `RUN_ALL_TESTS();`
</Note>

<Warning>
Avoid mixing dynamic and static runtimes on Windows. Enable `gtest_force_shared_crt` in CMake for compatibility.
</Warning>
