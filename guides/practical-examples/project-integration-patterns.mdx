---
title: "Integrating Tests into Your Build System"
description: "Hands-on guidance for integrating GoogleTest and GoogleMock with popular C++ build systems like Bazel and CMake. Includes troubleshooting tips, CI integration advice, and patterns for keeping your tests running smoothly as your project evolves."
---

# Integrating Tests into Your Build System

This guide provides hands-on, practical instructions to integrate GoogleTest and GoogleMock with popular C++ build systems such as Bazel and CMake. It is designed to help you seamlessly build, run, and manage tests within your project's build process, ensuring your tests run smoothly and reliably as your codebase grows.

---

## Workflow Overview

### What You'll Achieve
- Learn how to incorporate GoogleTest and GoogleMock into Bazel and CMake projects.
- Build and run your tests as part of your standard build process.
- Enable continuous integration (CI) integration with your testing setup.
- Access troubleshooting tips to resolve common integration issues.

### Prerequisites
- A working C++ development environment supporting C++17 or later.
- Basic familiarity with either Bazel or CMake build systems.
- GoogleTest and GoogleMock sources either cloned or available via package manager.
- Access to your project's build scripts or configuration files.

### Expected Outcome
By completing this guide, your build system will:
- Compile and link GoogleTest and GoogleMock correctly with your code.
- Automatically discover, register, and run your tests.
- Support CI pipeline integration for automated test runs.

### Time Commitment
- 30 to 60 minutes, depending on prior experience and project complexity.

---

## Step-by-Step Integration Instructions

### 1. Integrating GoogleTest and GoogleMock with Bazel

GoogleTest and GoogleMock can be smoothly integrated within Bazel workspaces using available rules and dependencies.

#### Step 1. Add GoogleTest as a Bazel External Dependency

- Use Bazel's `http_archive` or similar rule to fetch the googletest repository in your `WORKSPACE` file. For example:

```python
load("@bazel_tools//tools/build_defs/repo:http.bzl", "http_archive")

http_archive(
    name = "com_google_googletest",
    url = "https://github.com/google/googletest/archive/release-1.17.0.tar.gz",
    strip_prefix = "googletest-release-1.17.0",
    sha256 = "b0c2b3c5e6ec6f29dd10cc113beb9fbbea9c3874b34424e0510f98b7fd484a5e",
)
```

#### Step 2. Define BUILD Dependencies in Your Bazel Targets

- In your Bazel `BUILD` files, link your test targets against `@com_google_googletest//:gtest` and `@com_google_googletest//:gmock` as needed.

For example:

```python
cc_test(
    name = "my_tests",
    srcs = ["my_tests.cc"],
    deps = [
        "@com_google_googletest//:gtest_main",
        "@com_google_googletest//:gmock",
        # Other dependencies...
    ],
)
```

#### Step 3. Build and Run Your Tests

- Use Bazel commands to build and run tests:

```shell
bazel test //path/to:my_tests
```

Expected Result:
- Bazel compiles and links your test target with GoogleTest and GoogleMock.
- Tests run with output reflecting successes and failures.

---

### 2. Integrating GoogleTest and GoogleMock with CMake

CMake offers multiple ways to include GoogleTest into your project: standalone, as a subdirectory, or via `find_package`.

#### Step 1. Download or Reference GoogleTest

- You can include GoogleTest by cloning the repository or downloading release archives.

#### Step 2. Standalone or Subdirectory Usage

##### Option 1: Standalone Build

- Perform out-of-source build:

```shell
git clone https://github.com/google/googletest.git -b release-1.17.0
mkdir googletest/build
cd googletest/build
cmake ..
make
sudo make install
```

- After installation, you can use `find_package(GTest REQUIRED)` in your project.

##### Option 2: Add as Subdirectory in Your Project

In your top-level `CMakeLists.txt`, add:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.tar.gz
)
# Allow shared CRT usage on Windows
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests my_tests.cpp)
target_link_libraries(my_tests gtest_main gmock)
add_test(NAME my_tests COMMAND my_tests)
```

This way GoogleTest and GoogleMock targets become part of your build.

#### Step 3. Build and Run Your Tests

- Run CMake configuration and build as usual:

```shell
cmake -S . -B build
cmake --build build
ctest --test-dir build
```

Expected Result:
- Your tests compile and link to GoogleTest and GoogleMock.
- `ctest` runs your tests, with detailed reports.

---

### 3. Continuous Integration (CI) Integration Suggestions

- In CI scripts, invoke your build tool (`bazel test` or `cmake --build` + `ctest`) after building dependencies.
- Set up test filters to isolate failing tests or avoid flaky tests.
- Use environment variables `GTEST_OUTPUT=xml:<file>` or `GTEST_OUTPUT=json:<file>` for machine-readable reports.
- Configure retry or repeat flags (`--gtest_repeat`) to catch flaky failures.

---

## Troubleshooting Tips

### Bazel Troubleshooting

- **Build errors linking GoogleTest:** Verify the dependency paths and the archived version SHA.
- **Tests not found or run:** Ensure `cc_test` targets are correctly defined and include `gtest_main`.

### CMake Troubleshooting

- **GoogleTest not found:** Confirm `find_package(GTest REQUIRED)` or the FetchContent URLs and versions.
- **Runtime test failures:** Check the compatibility between compiler flags and GoogleTest (e.g., C++ standard set to 17).
- **Visual Studio runtime mismatch:** Use `gtest_force_shared_crt` to align CRT settings.

### General Tips

- Make sure your compiler environment supports **C++17** as required by GoogleTest 1.17.x.
- Prefer linking against `gtest_main` to avoid writing a custom `main()` unless necessary.
- Pay attention to test output to ensure tests are registered and executed correctly.

---

## Best Practices for Integration

- **Consistent Compiler Settings:** Use the same compiler flags and runtime library settings for your code and GoogleTest.
- **Use Test Fixtures & Parametrization:** Organize tests logically; your build system should handle dependencies efficiently.
- **Centralize Test Dependencies:** Manage GoogleTest and GoogleMock versions centrally in dependency management files.
- **Automate Test Execution:** Integrate tests into CI pipelines with clear pass/fail criteria.
- **Capture Test Results:** Save XML or JSON test reports for continuous integration dashboards or quality gates.

---

## Additional Resources

- [GoogleTest Primer](primer.md): Essential reading to understand writing tests.
- [googletest/README.md](googletest/README.md): Official build instructions and tweak options.
- [GoogleMock Overview](googlemock/README.md): Understand mocking integration.
- [Testing Reference](docs/reference/testing.md): Detailed testing macros and API.
- [Advanced Topics](docs/advanced.md): For optimizing and extending your testing framework.

---

## Summary

Integrating GoogleTest and GoogleMock into your Bazel or CMake build system allows for robust, automated C++ testing seamlessly incorporated with your codebase. Following structured setup steps ensures your tests build and run reliably, with best practices promoting maintainability and CI-friendly configurations. Troubleshooting sections equip you to resolve common pitfalls that may arise during integration.

---

## Sample Bazel BUILD Snippet

```python
load("@bazel_tools//tools/build_defs/cpp:cc_test.bzl", "cc_test")

cc_test(
    name = "example_test",
    srcs = ["example_test.cc"],
    deps = [
        "@com_google_googletest//:gtest_main",
        "@com_google_googletest//:gmock",
    ],
)
```

## Sample CMakeLists Snippet

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)

FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/release-1.17.0.tar.gz
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_test my_test.cpp)
target_link_libraries(my_test gtest_main gmock)
add_test(NAME my_test COMMAND my_test)
```

---

## How It Fits Into Your Workflow

1. Install and reference GoogleTest and GoogleMock sources.
2. Configure your build system (Bazel or CMake) to locate and link test libraries.
3. Write tests using GoogleTest primitives (`TEST()`, `TEST_F()`, `TEST_P()`).
4. Build your tests to validate linkage.
5. Run tests automatically via CLI or CI to confirm behavior.
6. Use output reports and flags for fine-grained control and diagnostics.

---

This guide empowers you to grow your project with reliable test automation by embedding GoogleTest and GoogleMock deeply into your build process.

---

<Check>
Remember to always match your GoogleTest version with your project's C++ standard requirements and build tool capabilities for smooth integration.
</Check>