---
title: "Real-World Example Suite"
description: "A curated set of real-world test scenarios, drawn from open source and Google projects, to illustrate how GoogleTest and GoogleMock are used in practice. Includes full-stack examples and cross-component testing."
---

# Real-World Example Suite

This page presents a curated collection of real-world test scenarios that demonstrate practical uses of GoogleTest and GoogleMock. It includes comprehensive full-stack examples and cross-component testing drawn from well-crafted open source and official Google projects.

---

## 1. Purpose and Scope

The examples showcased here serve to bridge theory and practice, showing how to harness the power of GoogleTest and GoogleMock beyond simple unit tests. They provide insights into realistic testing challenges such as managing complex mock behaviors, enforcing call sequences, handling argument matchers, and verifying intricate interactions.

As you explore these examples, you will see how key features like:

- Mock class definitions using `MOCK_METHOD`
- Specifying default and explicit behaviors with `ON_CALL` and `EXPECT_CALL`
- Sequencing calls with `Sequence` and `InSequence`
- Declaring cardinalities with `Times()`, `WillOnce()`, and `WillRepeatedly()` 
- Matching arguments precisely including use of `_` (wildcard matcher)
- Handling uninteresting, unexpected, and excessive calls

come alive in realistic scenarios.

---

## 2. Workflow Overview

### Task Description
Learn how to apply GoogleMock constructs in real code to create reliable, maintainable, and expressive tests that capture complex behavioral expectations.

### Prerequisites
- Familiarity with GoogleTest and GoogleMock basics
- Basic understanding of C++ and mock object concepts
- Access to GoogleMock headers (`#include <gmock/gmock.h>`)

### Expected Outcome
You will be able to define mocks, assign expectations, and capture nuanced mock interactions to rigorously verify your code under test.

### Time Estimate
15-30 minutes to study and internalize key examples presented here.

### Difficulty Level
Intermediate to Advanced

---

## 3. Step-by-Step Illustrative Examples

This section illustrates core concepts as implemented in the included tests found in `googlemock/test/gmock-spec-builders_test.cc` which is a canonical example suite.

### 3.1 Creating Mock Classes and Methods

Mock classes are defined by inheriting the real class or interface and declaring mock methods using `MOCK_METHOD`:

```cpp
class MockA {
 public:
  MockA() = default;

  MOCK_METHOD(void, DoA, (int n));
  MOCK_METHOD(Result, ReturnResult, (int n));
  MOCK_METHOD(NonDefaultConstructible, ReturnNonDefaultConstructible, ());
  MOCK_METHOD(bool, Binary, (int x, int y));
  MOCK_METHOD(int, ReturnInt, (int x, int y));

 private:
  MockA(const MockA&) = delete;
  MockA& operator=(const MockA&) = delete;
};
```

*Use public visibility for mock methods regardless of base class visibility.*

### 3.2 Setting Default Behavior with `ON_CALL`

`ON_CALL` defines default actions without asserting the call must happen:

```cpp
MockA a;
ON_CALL(a, Binary(_, _)).WillByDefault(Return(true));
```

This means any call to `a.Binary` returns true unless overridden by expectations.

### 3.3 Specifying Expectations with `EXPECT_CALL`

Expect and specify precise calls, number of invocations, behaviors, and call ordering.

Basic example:

```cpp
EXPECT_CALL(a, DoA(5)).Times(1).WillOnce(Return());
```

Complex chaining example:

```cpp
Sequence s;
EXPECT_CALL(a, DoA(1)).InSequence(s);
EXPECT_CALL(a, DoA(2)).InSequence(s);
a.DoA(1);
a.DoA(2);
```

Here, `DoA(1)` must be called before `DoA(2)`.

### 3.4 Handling Overloaded and Const Methods

Use appropriate `MOCK_METHOD` signatures including `(const, override)` specifiers and `Const(mock)` when setting expectations on const methods:

```cpp
MOCK_METHOD(int, Foo, (int), (const, override));
...
EXPECT_CALL(Const(mock), Foo(5));
```

### 3.5 Managing Multiple Call Expectations and Actions

You can list multiple `WillOnce()` clauses followed by an optional `WillRepeatedly()`:

```cpp
EXPECT_CALL(b, DoB())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

This returns 1 then 2 then 3 on subsequent calls.

### 3.6 Ordering Calls Using Partial Order and `.After()` Clauses

Define complex call dependencies between expectations:

```cpp
Expectation e1 = EXPECT_CALL(a, DoA(1));
Expectation e2 = EXPECT_CALL(b, DoB()).After(e1);
EXPECT_CALL(a, DoA(2)).After(e2);

// Call order enforced: DoA(1) -> DoB() -> DoA(2)

```

### 3.7 Detecting and Reporting Errors

GoogleMock automatically detects:

- Unexpected calls (calls not matching any expectation)
- Excessive calls (calls in excess of Times())
- Call order violations

Details handled with clear diagnostic messages showing expected vs actual.

### 3.8 Using Special Utilities

**Sequences:** for linear call ordering.

**ExpectationSet:** to specify groups of prerequisites.

**RetiresOnSaturation():** to retire expectations once saturated.

**AllowLeak():** to suppress leak detection for specific mocks.

---

## 4. Best Practices from the Examples

- Explicitly define expectations using `EXPECT_CALL` to document behavior and verify contract.
- Use `ON_CALL` to set default behaviors without asserting.
- Use `InSequence` or `Sequence` to enforce ordering where needed.
- Prefer `RetiresOnSaturation()` on expectations in sequences or that should be non-sticky.
- Use matchers (`_`, `Eq(value)`, composite matchers) to minimize test brittleness.
- Avoid over-specification: only assert what matters to your test.
- Use `NiceMock` to suppress uninteresting call warnings when appropriate.
- Use `VerifyAndClearExpectations()` if you must verify mocks before destruction.

---

## 5. Troubleshooting Common Issues

### 5.1 Unexpected Calls

If your test fails with unexpected call errors, verify:
- All expected calls are set before exercising code.
- Argument matchers correctly match invoked arguments.
- No missing catch-all expectations if calls are valid.

### 5.2 Calls Out of Order

- Use `Sequence` or `InSequence` to specify precise call order.
- Verify `.After()` clauses do not conflict.

### 5.3 Too Many or Too Few Calls

- Ensure `Times()` cardinalities reflect expected call counts.
- Use `WillOnce()` and `WillRepeatedly()` appropriately.

### 5.4 Mock Method Overload Ambiguity

- Use `Const()` wrapper or specify explicit matcher types for overloaded methods.

### 5.5 Default Actions Not Triggering as Expected

- Confirm `ON_CALL` clauses are correctly defined with `.WillByDefault()`.
- Check no conflicts overriding default actions in `EXPECT_CALL`.

---

## 6. Next Steps & Related Content

- Explore [Writing Your First Test](../guides/getting-started/writing-your-first-test.md) to start creating simple tests.
- Dive into [Using Assertions Effectively](../guides/getting-started/using-assertions.md) to improve failure diagnostics.
- Learn advanced mocking with [Using GoogleMock](../guides/advanced-testing-patterns/using-googlemock.md).
- For continuous integration, check [Integrating with Build Systems](../guides/real-world-guidance/project-integration.md).
- Refer to the full [Mocking Reference](../docs/reference/mocking.md) for detailed API specs.

---

## 7. Additional References

- [gMock FAQ](../docs/gmock_faq.md) for common pitfalls and solutions.
- [gMock Cookbook](../docs/gmock_cook_book.md) for recipes on complex mock patterns.
- Official GitHub repository: [https://github.com/google/googletest](https://github.com/google/googletest)

---

**Example: Defining a Mock Method Expectation with Sequence**

```cpp
class MockA {
 public:
  MOCK_METHOD(void, DoA, (int n));
};

TEST(RealWorldTest, SequenceExample) {
  MockA mock_a;
  Sequence s;

  EXPECT_CALL(mock_a, DoA(1)).InSequence(s);
  EXPECT_CALL(mock_a, DoA(2)).InSequence(s);

  mock_a.DoA(1);  // Ok
  mock_a.DoA(2);  // Ok
}
```

**Example: Setting Default Behavior and Expectation**

```cpp
MockA mock_a;

ON_CALL(mock_a, Binary(_, _)).WillByDefault(Return(true));
EXPECT_CALL(mock_a, Binary(0, 0));

bool result = mock_a.Binary(0, 0);  // Returns true as per default
```

---

By studying and adapting real-world patterns like these, you will gain mastery over writing maintainable GoogleTest and GoogleMock suites that provide robust regression guards and clear test intent.
