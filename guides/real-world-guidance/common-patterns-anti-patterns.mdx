---
title: "Common Patterns and Anti-patterns"
description: "Explore recommended patterns for fixture management, shared environments, assertion usage, test readability, and maintenance. Avoid common anti-patterns that lead to brittle or unmanageable tests."
---

# Common Patterns and Anti-patterns

Explore recommended patterns for fixture management, shared environments, assertion usage, test readability, and maintenance. Avoid common anti-patterns that lead to brittle or unmanageable tests.

---

## Overview

This page provides practical guidance on effective patterns and practices when using GoogleMock to write tests. It highlights the most beneficial ways to manage fixtures, structure expectations, handle shared resources, and maintain readable, robust, and maintainable test code. It also calls out common anti-patterns — habits and approaches that commonly cause brittle tests, confusing failures, or excessive maintenance overhead.

By following these common patterns, you will achieve test suites that are easier to understand, faster to run, and more resistant to unintended failures.


---

## Fixture Management

### Pattern: Use Test Fixtures for Shared Setup

- **Intent:** Share common initialization logic and mocked dependencies cleanly across related tests.
- **Approach:** Define a test fixture class inheriting from `::testing::Test`, instantiate mock objects as member variables, and perform setup work in `SetUp()`.
- **Benefits:** Avoids duplicated setup code, ensures consistent initial state, and leverages GoogleTest's built-in lifecycle.

```cpp
class MyTest : public ::testing::Test {
 protected:
  void SetUp() override {
    // Common setup here
  }

  MockFoo mock_foo_;
  MockBar mock_bar_;
};

TEST_F(MyTest, TestCase1) {
  // Use mock_foo_, mock_bar_ here
}
```


### Anti-pattern: Excessive or Global Fixture State

- Avoid sharing mutable state across unrelated tests or too broadly exposing mocks.
- This can cause unintended test dependencies and make it hard to reason about failures.

<Tip>
If you need isolated contexts, prefer test parameters or separate fixture classes over global variables or shared mutable objects.
</Tip>


---

## Managing Shared Environments

### Pattern: Use Scoped Setup and Teardown

- Use RAII-style or fixture `SetUp()`/`TearDown()` to manage shared resources (e.g. databases, filesystems).
- Prefer controlled, repeatable fixtures over one-time global state initialization.

### Anti-pattern: Relying on Global or Static Mutable State

- Tests that depend on global or static state can become flaky and order-dependent.
- Hard to run tests in parallel reliably.

<Warning>
Tests must be independent and repeatable. Avoid mutable shared state without isolation.
</Warning>


---

## Assertion Usage

### Pattern: Focus Assertions

- Each test should verify a single behavior or outcome.
- Use GoogleTest assertions (`EXPECT_` or `ASSERT_`) to express expectations clearly.
- Prefer `EXPECT_` for non-fatal checks to continue test flow and gather multiple failures per test.

### Anti-pattern: Overly Broad or Complex Assertions

- Tests that verify too many outcomes become fragile and hard to maintain.
- Avoid bulky assertions that verify large data structures in one step without clear intent.

<Tip>
Break complex assertions into smaller, named tests to improve clarity and diagnose failure points easily.
</Tip>

---

## Test Readability and Maintenance

### Pattern: Use Descriptive Names and Comments

- Name tests clearly to describe the behavior being verified.
- Use comments sparingly to explain the why behind complex test logic.

### Pattern: Limit Expectation Strictness

- Use `ON_CALL` to set default behaviors without strict expectations.
- Use `EXPECT_CALL` sparingly and precisely to verify critical interactions.
- Avoid over-specified expectations that make refactoring painful.

### Anti-pattern: Overly Tight Call Counts and Argument Matchers

- Restricting calls to exact matchers unnecessarily causes brittleness.
- Over-specification can cause tests to fail due to unrelated internal changes.

<Note>
If you don’t care about certain arguments or number of calls, use flexible matchers (`_`, `AnyNumber()`) and default actions.
</Note>

---

## Common Anti-patterns to Avoid

- **Mocking Concrete Classes Without Interfaces:** Leads to tight coupling and fragile tests. Prefer coding to interfaces and mocking those instead.

- **Mixing Too Many Expectations in One Test:** Results in tests hard to understand and maintain. Test one scenario per test.

- **Ignoring Uninteresting Calls Without `NiceMock`:** Leads to noisy warnings cluttering output.

- **Not Using `RetiresOnSaturation()` with Overlapping Expectations:** Can cause confusing errors with sticky expectations.

<Tip>
Use `RetiresOnSaturation()` to make expectations retire after they have been fulfilled, reducing unexpected interaction errors.
</Tip>

---

## Best Practices Summary

| Category                  | Recommended Practice                                        | Avoid                                     |
|---------------------------|------------------------------------------------------------|-------------------------------------------|
| Fixture Management        | Use `TEST_F` fixtures with clear setup and teardown         | Global mutable shared fixtures            |
| Shared Environments        | Use scoped setup/teardown and isolate external dependencies | Rely on global/static mutable state       |
| Assertions                 | Test one thing at a time, prefer `EXPECT_` for non-fatal     | Overly complex, multiple concerns         |
| Expectations               | Use default `ON_CALL` for common behavior; `EXPECT_CALL` to verify critical calls | Over-specifying call counts and argument matchers |
| Call Ordering & Sequences  | Use sequences (`InSequence`) or partial orders for call order control | Implicit call order assumptions           |
| Mock Class Design          | Mock interfaces or adapt to interfaces                       | Mock concrete classes directly             |

---

## Troubleshooting Common Issues

### Tests Fail with "Unexpected Mock Function Call"

- Check if you have missing or incorrect `EXPECT_CALL` statements.
- Use `--gmock_verbose=info` flag to trace mock calls and see which expectations they match.

### Tests Warn of "Uninteresting Mock Function Call"

- This indicates calls to mock methods without `EXPECT_CALL`. Consider using `NiceMock` to suppress warnings if legitimate.
- If unexpected, add an `EXPECT_CALL(...).Times(0)` to ensure the method should never get called.

### Overly Strict Expectations Cause Flaky Tests

- Relax argument matchers using wildcards (`_`) or less strict matchers.
- Use `RetiresOnSaturation` to retire expectations after hitting call limits.

<Tip>
Use the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for in-depth solutions.
</Tip>

---

## Next Steps & Further Reading

- Explore **[gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)** for practical recipes to implement patterns and avoid anti-patterns.
- Review **[Mocking Reference](https://google.github.io/googletest/reference/mocking.html)** for detailed API and usage.
- Read **[gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)** for foundational understanding.
- Deepen familiarity with **Matchers and Actions** to write expressive and maintainable expectations.

---

## Related Pages in Documentation

- [Using GoogleMock](https://google.github.io/googletest/guides/advanced-testing-patterns/using-googlemock.html)
- [Complex Matchers and Actions](https://google.github.io/googletest/guides/advanced-testing-patterns/complex-matchers-actions.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock FAQ](https://google.github.io/googletest/gmock_faq.html)

---

_For more examples and in-depth explanations, visit the official [GoogleMock GitHub repository](https://github.com/google/googletest) and consult the source files under `docs/`._
