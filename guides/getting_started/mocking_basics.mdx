---
title: "Mocking Functions and Classes: The Basics"
description: "Step through the essentials of replacing dependencies with mocks using GoogleMock. Covers how to declare, instantiate, and use mocks for function and method calls in your testsâ€”empowering reliable isolation and behavior verification."
---

# Mocking Functions and Classes: The Basics

Step through the essentials of replacing dependencies with mocks using GoogleMock. This guide covers how to declare mock classes and functions, instantiate mock objects, and use expectations and default behaviors to verify interactions in your tests. Harness the power of mocks to isolate your code, simulate complex behaviors, and validate collaboration precisely.

---

## 1. Introduction to Mocking

Mocking replaces real dependencies with fake objects that simulate their behavior. This helps you write tests that isolate the system under test from external influences, making tests faster, more reliable, and focused on behavior verification.

GoogleMock (gMock) is a framework that automates the creation of mocks for C++ classes following interfaces or abstract base classes. It provides intuitive macros and APIs to define, configure, and verify mock expectations.

## 2. Defining Mock Classes Using `MOCK_METHOD`

To mock a class or an interface, you define a mock class derived from the original interface and declare mocked methods using the `MOCK_METHOD` macro.

### Basic Syntax

```cpp
class MockClass : public OriginalClass {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (qualifiers));
};
```

- `ReturnType`: method return type
- `MethodName`: name of the method to mock
- `(Args...)`: parameter list in parentheses
- `(qualifiers)`: optional specifiers such as `const`, `override`, or calling conventions

### Example: Mocking an Interface

Given the interface:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual std::string Describe(int type) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};
```

Define a mock class:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(std::string, Describe, (int type), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

### Handling Commas in Types

If your return type or arguments include commas (e.g., in templates), wrap them in extra parentheses or use type aliases:

```cpp
MOCK_METHOD((std::pair<bool, int>), GetPair, ());
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### Other Qualifiers

You can add qualifiers like `const`, `noexcept`, or call type (`Calltype(...)`) as needed:

```cpp
MOCK_METHOD(bool, Foo, (int n), (Calltype(STDMETHODCALLTYPE)));
MOCK_METHOD(bool, Bar, (double x, double y), (const, Calltype(STDMETHODCALLTYPE)));
```

### Mocking Class Templates

Mock class templates much like regular classes:

```cpp
template <typename Elem>
class StackInterface {
 public:
  virtual ~StackInterface();
  virtual int GetSize() const = 0;
  virtual void Push(const Elem& x) = 0;
};

template <typename Elem>
class MockStack : public StackInterface<Elem> {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(void, Push, (const Elem& x), (override));
};
```

## 3. Creating and Using Mock Objects

### Typical Workflow

1. Include the GoogleMock namespace:

```cpp
using ::testing::NiceMock;  // Or NaggyMock, StrictMock
```

2. Instantiate your mock object:

```cpp
NiceMock<MockFoo> mock_foo;
```

3. Optionally, set default behaviors with `ON_CALL`.

4. Set expectations with `EXPECT_CALL` on methods you want to verify.

5. Run the code under test that exercises these mocks.

6. On destruction, mocks automatically verify that all expectations were met.

### Types of Mock Objects

- `NiceMock<T>`: suppresses warnings for unexpected or "uninteresting" calls.
- `NaggyMock<T>`: default mock object; warns on uninteresting calls.
- `StrictMock<T>`: treats uninteresting calls as errors, failing the test.

Use according to your level of strictness in test enforcement.

### Setting Default Behavior: `ON_CALL`

To specify default actions for mock methods without setting expectations:

```cpp
ON_CALL(mock_foo, GetSize())
    .WillByDefault(Return(5));
```

Default actions apply whenever the mock method is called without an active expectation.

### Setting Expectations: `EXPECT_CALL`

Declare expected calls and behaviors:

```cpp
EXPECT_CALL(mock_foo, Describe("test"))
    .Times(3)
    .WillRepeatedly(Return("ok"));
```

The chained clauses control:
- How many times the call is expected (`Times`)
- The returned values or actions (`WillOnce`, `WillRepeatedly`)
- Argument matching
- Invocation order constraints

Expectations must be set *before* the code under test calls the mock.

### Matchers

Matchers let you specify argument expectations flexibly. For example:

```cpp
EXPECT_CALL(mock_foo, Process(_, 10));     // Any first arg, count == 10
EXPECT_CALL(mock_foo, Process(Ge(5), _));  // First arg >= 5, any count
EXPECT_CALL(mock_foo, Describe(_));        // Any argument
EXPECT_CALL(mock_foo, Describe("foo"));  // Exact string match
```

Use `_` for wildcard. Combine matchers for fine control.

## 4. Best Practices

- Set expectations only on methods whose interaction you want to verify.
- Use `ON_CALL` liberally to specify default responses for other mocked methods.
- Choose `NiceMock` for relaxed tests; use `StrictMock` for strict verification.
- Order expectations carefully; understand that newer expectations override older ones.
- For overloaded methods, specify the overload explicitly if ambiguous.
- Avoid mocking methods you don't control; consider wrappers or adaptors.
- Use sequences (`InSequence`) or order constraints (`After`) to enforce call order.

## 5. Example: Using a Mock in a Test

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::NiceMock;
using ::testing::Return;

// Interface to be mocked.
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
};

// Mock class.
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};

// Class under test.
class Painter {
 public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}

  bool DrawLine() {
    turtle_->PenDown();
    turtle_->Forward(100);
    turtle_->PenUp();
    return true;
  }

 private:
  Turtle* turtle_;
};

TEST(PainterTest, DrawsLine) {
  NiceMock<MockTurtle> mock_turtle;

  // Expect PenDown called once
  EXPECT_CALL(mock_turtle, PenDown()).Times(1);
  // Expect Forward called with 100 exactly once
  EXPECT_CALL(mock_turtle, Forward(100)).Times(1);
  // Expect PenUp called once
  EXPECT_CALL(mock_turtle, PenUp()).Times(1);

  Painter painter(&mock_turtle);
  EXPECT_TRUE(painter.DrawLine());
}
```

In this test:
- The `MockTurtle` object stands in for a real `Turtle`.
- `EXPECT_CALL` declares what calls are expected and with what arguments.
- If the code fails to call methods correctly, the test will fail with descriptive messages.

## 6. Common Pitfalls

<AccordionGroup title="Common Issues and How to Avoid Them">
<Accordion title="Uninteresting Calls Warning">
When mock methods without expectations are called, gMock issues warnings by default.

**Solution:** Use `NiceMock` to suppress these or add permissive expectations:
```cpp
EXPECT_CALL(mock, Method(_)).Times(testing::AnyNumber());
```
</Accordion>
<Accordion title="Setting Expectations After Calls">
Expectations must be set before the mock methods are exercised.

**Issue:** Setting `EXPECT_CALL` after the method is called leads to undefined behavior.

**Solution:** Always prepare expectations or default actions before running the tested code.
</Accordion>
<Accordion title="Mocking Non-Virtual Functions">
Only virtual methods can be mocked by `MOCK_METHOD` macros.

**Solution:** Refactor code to interfaces; or use alternative techniques like templated mocks.
</Accordion>
<Accordion title="Overloaded Methods Ambiguity">
Overloaded methods can confuse gMock's matcher resolution.

**Solution:** Use explicit matchers or `Const()` wrapper to disambiguate overloads.
</Accordion>
<Accordion title="Destructor Not Virtual in Interface">
Non-virtual destructors in interfaces cause undefined behavior when deleting mocks.

**Solution:** Ensure destructors of interfaces to be mocked are virtual.
</Accordion>
</AccordionGroup>

## 7. Next Steps & Additional Resources

- Explore the [Mocking Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced mocking patterns.
- Check out the [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for quick references.
- Dive into [Writing Your First Test](../../getting-started/first-tests-and-troubleshooting/writing-your-first-test.md) to understand basic GoogleTest usage.
- Learn about sequences and ordered expectations in the [Test Discovery and Execution Patterns](../getting_started/test_discovery_execution.md).
- Understand how to combine GoogleTest and GoogleMock for comprehensive testing in [Integrating GoogleTest and GoogleMock](../advanced_testing_patterns/combining_gtest_gmock.md).

<Tip>
Always design your code to depend on interfaces rather than concrete classes. This makes mocking straightforward and tests more maintainable.
</Tip>

---