---
title: "Writing Your First Unit and Mock Tests"
description: "Step-by-step tutorial on creating basic test cases and mock classes, including the use of test macros, assertions, and mock method definitions. Ideal for users taking their first steps into unit testing or mocking in C++."
---

# Writing Your First Unit and Mock Tests

This guide leads you through creating your initial unit tests and mock classes using GoogleTest and GoogleMock. It focuses on using test macros, assertions, and defining mock methods for effective C++ testing.

---

## 1. Understanding Your Testing Goals

Before writing any code, clarify what you want to achieve:

- **Unit Test:** Verify a specific function or class works as expected in isolation.
- **Mocking:** Replace parts of your system with mock objects to verify interactions and behavior.

By mastering both, you can write robust tests that catch errors early and facilitate better design.

---

## 2. Preparing Your Test Environment

### Prerequisites

- GoogleTest and GoogleMock installed and linked in your project.
- Include the primary header in your test files:

```cpp
#include <gmock/gmock.h>  // Brings in GoogleMock (and GoogleTest)
```

- Basic understanding of your system's interfaces to mock.

### Import gMock Namespace Symbols

For cleaner code, import the gMock namespace symbols you will be using:

```cpp
using ::testing::Return;  // Example common action
using ::testing::_;       // Wildcard matcher
```

---

## 3. Writing Your First Unit Test

GoogleTest uses `TEST()` macros to define individual test cases.

### Syntax

```cpp
TEST(TestSuiteName, TestName) {
  // Test logic here
  EXPECT_EQ(actual, expected);
}
```

- **TestSuiteName:** Groups related tests
- **TestName:** Identifies this particular test

### Example

```cpp
// Function to test
int Add(int a, int b) { return a + b; }

TEST(MathTest, AddsTwoNumbers) {
  EXPECT_EQ(Add(2, 3), 5);
  EXPECT_EQ(Add(-1, 1), 0);
}
```

**Outcome:** Running this test confirms your Add function behaves correctly.

---

## 4. Defining and Using Mock Classes

Mocks simulate behavior of complex or external parts of your code.

### Creating a Mock Class

Given an interface or base class with virtual functions:

```cpp
class Calculator {
 public:
  virtual ~Calculator() {}
  virtual int Add(int a, int b) = 0;
  virtual int Subtract(int a, int b) = 0;
};
```

You create a mock derived class using `MOCK_METHOD` macros:

```cpp
#include <gmock/gmock.h>

class MockCalculator : public Calculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
  MOCK_METHOD(int, Subtract, (int a, int b), (override));
};
```

Notes:
- `MOCK_METHOD` parameters represent return type, method name, argument list, and optional qualifiers like `override` and `const`.
- Mock methods **must be in the public section** even if the base method is protected or private.

### Using Your Mock in Tests

You can now set expectations on mock methods and test your code:

```cpp
using ::testing::Return;
using ::testing::_;

TEST(MathUserTest, UsesAddCorrectly) {
  MockCalculator mock_calc;

  EXPECT_CALL(mock_calc, Add(3, 4))
      .WillOnce(Return(7));  // Expect Add with 3 and 4 to be called, returning 7

  // Use mock_calc in your test subject, e.g., a class depending on Calculator
  int result = mock_calc.Add(3, 4);
  EXPECT_EQ(result, 7);
}
```

**Outcome:** This test verifies that your code calls `Add` with expected arguments and correctly handles the response.

---

## 5. Setting Expectations with `EXPECT_CALL`

`EXPECT_CALL` configures what your mock methods should expect and do.

### Basic Use

```cpp
EXPECT_CALL(mock_object, MethodName(matchers))
  .Times(n)
  .WillOnce(action)
  .WillRepeatedly(action);
```

- **Matchers:** Specify arguments expected.
- **Times:** How many times the method is expected to be called.
- **WillOnce / WillRepeatedly:** What the mock method returns or does.

### Examples

Expect a method to be called once returning a fixed value:

```cpp
EXPECT_CALL(mock_calc, Add(5, 2))
    .WillOnce(Return(7));
```

Ignore arguments (match anything):

```cpp
EXPECT_CALL(mock_calc, Subtract(_, _))
    .Times(AnyNumber())
    .WillRepeatedly(Return(0));
```

### Important Notes

- `EXPECT_CALL`s must be set *before* the mock methods are exercised.
- Use `_` as a wildcard matcher if argument values donâ€™t matter.
- To suppress warnings for uninteresting calls, use `NiceMock`.

---

## 6. Common Assertions inside Tests

GoogleTest provides many assertion macros; here are some essential ones:

| Macro       | Description                          | Does Test Continue on Failure? |
| ----------- | ---------------------------------- | ------------------------------ |
| `EXPECT_EQ` | Verifies equality of two values    | Yes                            |
| `ASSERT_EQ` | Verifies equality, aborts on fail  | No                             |
| `EXPECT_TRUE` | Checks that condition is true      | Yes                            |
| `ASSERT_TRUE` | Checks that condition is true      | No                             |

### Example

```cpp
EXPECT_EQ(result, 10) << "The result should be 10";
```

---

## 7. Using Test Fixtures for Multiple Related Tests

For tests sharing setup and teardown, use test fixtures:

```cpp
class MathTest : public testing::Test {
 protected:
  MockCalculator mock_calc_;

  void SetUp() override {
    // Common setup here
  }
};

TEST_F(MathTest, TestAddition) {
  EXPECT_CALL(mock_calc_, Add(1, 2)).WillOnce(Return(3));
  EXPECT_EQ(mock_calc_.Add(1, 2), 3);
}

TEST_F(MathTest, TestSubtraction) {
  EXPECT_CALL(mock_calc_, Subtract(5, 2)).WillOnce(Return(3));
  EXPECT_EQ(mock_calc_.Subtract(5, 2), 3);
}
```

**Outcome:** Each test reuses the fixture, reducing duplication and improving maintainability.

---

## 8. Best Practices and Tips

- Declare mock methods with `override` to ensure correct overriding.
- Use type aliases or parentheses to handle complex argument types with commas.
- Limit how many expectations you set; over-specification leads to brittle tests.
- Use `NiceMock<T>` to silence warnings on uninteresting calls when appropriate.
- Set `ON_CALL` for default mock behavior without strict expectations.
- Always verify that the destructor is virtual in your interfaces.
- Use `InSequence` or `.After` clauses to specify call order when needed.

---

## 9. Troubleshooting Common Issues

### Mock Methods Not Called

- Ensure `EXPECT_CALL` is correctly placed before method calls.
- Check that argument matchers are accurate.

### Warnings about Uninteresting Calls

- Consider using `NiceMock` to suppress warnings if the calls are expected but unimportant.
- Alternatively, add catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`.

### Compilation Errors with `MOCK_METHOD`

- Wrap complex return or argument types containing commas in parentheses or use type aliases.
- Ensure correct syntax with four parameters if qualifiers are used (e.g., `(const, override)`).

### Mock Method Does Not Override Correctly

- Confirm the method signature matches exactly, including `const` and reference qualifiers.
- Add the `override` keyword.

### Test Fails Unexpectedly Due to Call Order

- Use `InSequence` to enforce strict call ordering.

---

## 10. Next Steps

- Explore **[Matchers and Actions](https://google.github.io/googletest/reference/matchers.html)** to write flexible expectations.
- Review the **[gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)** for recipes on advanced mocking techniques.
- Understand **[Test Fixtures and Advanced Features](docs/primer.md)** for more complex test scenarios and setup management.
- Use **[GoogleTest Primer](docs/primer.md)** for overall test writing workflows alongside mocking.

---

### Additional Resources

- [GoogleMock README](googlemock/README.md)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [Mocking FAQ](docs/gmock_faq.md)
- [Setting Up GoogleTest and GoogleMock](guides/getting_started/project_setup.md)

---

By following this guide, you will successfully create your first tests and mocks, setting a solid foundation for rigorous C++ testing in your projects.