---
title: "Setting Up GoogleTest and GoogleMock"
description: "Learn how to install and set up GoogleTest and GoogleMock in new or existing C++ projects using CMake or Bazel. Covers download, build, linking, and basic configuration for a seamless start."
---

# Setting Up GoogleTest and GoogleMock

Learn how to install and set up GoogleTest and GoogleMock in new or existing C++ projects using CMake or Bazel. This guide walks you through downloading, building, linking, and basic configuration for a seamless start with these frameworks.

---

## Workflow Overview

### What This Guide Helps You Accomplish
This guide helps you integrate GoogleTest and GoogleMock into your C++ project to enable unit testing and mocking capabilities. It covers the essential steps for downloading the source code, configuring your build system (primarily CMake), building the libraries, linking them in your test executables, and running your first tests.

### Prerequisites
- Basic familiarity with C++ development.
- Installed C++17 or later compatible compiler (e.g., GCC, Clang, MSVC).
- CMake 3.13 or later installed for build configuration.
- Git installed for source code cloning (optional but recommended).
- Access to your project’s build system to include GoogleTest and GoogleMock.

### Expected Outcome
- You will have GoogleTest and GoogleMock built and installed either standalone or within your project.
- Your test executables linked against GoogleTest and GoogleMock.
- Ability to run unit and mock tests using provided main functions or custom main.

### Time Estimate
Approximately 15-30 minutes, depending on your build environment.

### Difficulty Level
Beginner to Intermediate

---

## Step-by-Step Instructions

### 1. Obtain the Source Code

You can download the latest official release or clone the repository:

```bash
# Clone the full googletest repository including GoogleTest and GoogleMock
git clone https://github.com/google/googletest.git -b main
cd googletest
```

### 2. Prepare the Build Directory

Create a separate directory for build artifacts to keep your source clean:

```bash
mkdir build
cd build
```

### 3. Generate Build Files with CMake

#### Build GoogleTest and GoogleMock Together (Default)

```bash
cmake ..
```

This configures the build system for both libraries.

#### To Build Only GoogleTest

If you want only GoogleTest and NOT GoogleMock, use:

```bash
cmake .. -DBUILD_GMOCK=OFF
```

### 4. Build the Libraries

On Linux or MacOS, run:

```bash
make
```

On Windows with Visual Studio, open the generated `.sln` file and build.

### 5. (Optional) Run GoogleMock's Own Tests

By default, GoogleMock’s internal tests are not built. To enable them:

- When running cmake, add `-Dgmock_build_tests=ON`.
- Then run `make test` or `ctest` to execute the tests.

Example:

```bash
cmake .. -Dgmock_build_tests=ON
make
ctest
```

### 6. Install the Libraries (Optional)

If you want to install GoogleTest and GoogleMock system-wide:

```bash
sudo make install
```

This will place headers and libraries typically in `/usr/local/`.

### 7. Integrate into Your Project’s CMake Build

#### Linking Installed Libraries

If installed system-wide or via package manager, find and link:

```cmake
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test_file.cpp)
target_link_libraries(my_tests GTest::gtest_main GTest::gmock)
add_test(NAME my_tests COMMAND my_tests)
```

#### Including GoogleTest/GoogleMock as Part of Your Build

If you want to include GoogleTest source as part of your project:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_file.cpp)
target_link_libraries(my_tests gtest_main gmock)
add_test(NAME my_tests COMMAND my_tests)
```

This ensures your tests compile with the exact same compiler flags as your project.

### 8. Initialize GoogleMock in Your Code

GoogleMock depends on GoogleTest, so initialization covers both. Typical main function:

```c++
#include "gmock/gmock.h"

int main(int argc, char** argv) {
  testing::InitGoogleMock(&argc, argv);
  return RUN_ALL_TESTS();
}
```

If you link with `gmock_main` or `gtest_main` libraries, you may omit writing a main.

### 9. Write and Run Your First Test

Once linked, write simple test cases and mocks (covered in writing tests guides). Running your test executable will run all registered tests.

---

## Practical Tips & Best Practices

- **Use `gmock_main` or `gtest_main` libraries** when possible to avoid writing your own main function.
- Building GoogleMock tests (`gmock_build_tests=ON`) helps verify your build but is not required for normal usage.
- Use CMake integration to keep GoogleTest compiled with your project settings for compatibility.
- For Visual Studio, watch runtime library settings (`gtest_force_shared_crt`) to avoid linkage errors.
- If building as shared libraries, enable `DGTEST_CREATE_SHARED_LIBRARY=1` compile flag.

---

## Troubleshooting Common Setup Issues

<AccordionGroup title="Troubleshooting Common Issues">
<Accordion title="Build Failures or Missing Compiler Support">
Make sure your compiler supports C++17 or newer. Older compilers may fail. Use GCC 7+, Clang 5+, or MSVC 2017+.
</Accordion>
<Accordion title="CMake Configuration Errors">

- Verify the correct path to GoogleTest and GoogleMock sources.
- Use `cmake --trace` to debug variable values.
- If using FetchContent, ensure CMake version is 3.14+.

</Accordion>
<Accordion title="Linker Errors on Windows">

- Use `gtest_force_shared_crt=ON` to match your project's runtime linkage.
- Ensure no mixing of static and dynamic CRTs.
- Link against `gmock_main` or `gtest_main` properly.

</Accordion>
<Accordion title="Tests Not Running or Undefined Symbols">

- Confirm tests are linked correctly and `RUN_ALL_TESTS()` is called.
- If you wrote your own main, you must call `testing::InitGoogleMock(&argc, argv);`.
- Check that your test source files include `<gtest/gtest.h>` or `<gmock/gmock.h>`.

</Accordion>
</AccordionGroup>

---

## Diagram: Typical Setup Flow

```mermaid
flowchart TD
  A[Start: Clone googletest repo] --> B[CMake configure & build]
  B --> C{Build GoogleMock tests?}
  C -->|Yes| D[Run GoogleMock internal tests]
  C -->|No| E[Use GoogleTest & GoogleMock libs]
  D --> E
  E --> F{Use main library?}
  F -->|Yes| G[Link with gmock_main or gtest_main]
  F -->|No| H[Write custom main()]
  G & H --> I[Write test/mocks]
  I --> J[Build test executables]
  J --> K[Run tests with RUN_ALL_TESTS()]

  classDef decision fill:#f96,stroke:#333,stroke-width:2px;
  class C,F decision;
```

---

## Next Steps & Related Content

- **Writing Your First Unit and Mock Tests:** Start building test cases using GoogleTest and GoogleMock features.
- **Configuring Your First Test Project:** Detailed configuration steps for existing projects.
- **Troubleshooting Common Setup Issues:** In-depth help for build and runtime problems.
- **GoogleMock Cookbook and gMock for Dummies:** Learn mocking patterns and advanced features.
- **Integration with CI:** Automate your testing in continuous integration pipelines.

---

## References & Links

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [GoogleMock README](https://github.com/google/googletest/blob/main/googlemock/README.md)
- [GoogleTest Primer](https://google.github.io/googletest/primer.html)
- [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [GoogleTest CMake Integration](https://github.com/google/googletest/blob/main/googletest/README.md#build-with-cmake)

<Check>
Make sure to verify your compiler compatibility and follow platform-specific instructions if you encounter setup issues.
</Check>

---

## Summary

You now have the foundation to download, build, link, and configure GoogleTest and GoogleMock to run your tests. Using CMake integration ensures your test environment is robust, and GoogleMock’s mocking capabilities are ready for use.

For smooth progression, consult the Writing Your First Unit and Mock Tests guide next.

---
