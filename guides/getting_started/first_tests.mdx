---
title: "Writing Your First Tests and Mocks"
description: "A hands-on walkthrough for writing your initial unit tests using GoogleTest assertions and your first mock classes with GoogleMock. Covers basic test structure, the use of core macros, and how to verify code behavior with simple expectations and matchers."
---

# Writing Your First Tests and Mocks

## Workflow Overview

### What This Guide Helps You Accomplish
This guide provides a step-by-step introduction to writing your first unit tests using GoogleTest—and creating your first mock classes with GoogleMock. You'll learn how to structure tests, use core macros for assertions, and verify the behavior of code with simple expectations and matchers.

### Prerequisites
- Basic knowledge of C++ programming
- GoogleTest and GoogleMock installed and configured in your development environment
- A project set up to compile and run tests with GoogleTest/GoogleMock

### Expected Outcome
By the end of this guide, you will:
- Write basic GoogleTest tests using `TEST()` and `TEST_F()` macros
- Use assertions to verify your code behavior
- Define test fixtures to share setup and data between tests
- Write simple mock classes using GoogleMock
- Set expectations on mocks to control behavior and verify interactions

### Time Estimate
Expect to spend approximately 30 to 60 minutes following this guide, depending on familiarity with C++ testing.

### Difficulty Level
Beginner

---

## Step-by-Step Instructions

### 1. Writing Your First Simple Test

GoogleTest organizes tests into *test suites* and *tests*. Start with the simplest form using the `TEST` macro.

```cpp
// Tests factorial of 0.
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

// Tests factorial of positive numbers.
TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
}
```

- The first argument `FactorialTest` is the test suite name (grouping related tests).
- The second argument is the test name.
- Use assertions like `EXPECT_EQ` to verify conditions.

#### What You Should See
When running the test binary, GoogleTest will report these tests as passing or failing with line numbers and messages.

### 2. Using Assertions to Check Conditions

GoogleTest provides many assertions:

- `EXPECT_EQ(val1, val2)`: verifies equality.
- `ASSERT_TRUE(condition)`: checks if condition is true (aborts current test on failure).
- `EXPECT_FALSE(condition)`: non-fatal check of false condition.

Use `ASSERT_*` when failing the test immediately makes further checks irrelevant; otherwise prefer `EXPECT_*` to continue checking.


### 3. Sharing Setup with Test Fixtures

When multiple tests need similar setup or shared data, define a *test fixture* class derived from `testing::Test`:

```cpp
class QueueTest : public testing::Test {
 protected:
  QueueTest() {
    q1_.Enqueue(1);
    q2_.Enqueue(2);
    q2_.Enqueue(3);
  }

  Queue<int> q0_;
  Queue<int> q1_;
  Queue<int> q2_;
};
```

Then write tests using `TEST_F()`:

```cpp
TEST_F(QueueTest, IsEmptyInitially) {
  EXPECT_EQ(q0_.size(), 0);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q0_.Dequeue();
  EXPECT_EQ(n, nullptr);

  n = q1_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
}
```

Each test runs with a fresh instance of the fixture.

#### Best Practices
- Use `SetUp()` and `TearDown()` overrides for complex setup/cleanup if needed.
- Keep shared data minimal and immutable or reset between tests.

### 4. Writing Your First Mocks with GoogleMock

GoogleMock extends GoogleTest with mocking capabilities—allowing the creation of mock classes and setting expectations on member functions.

To create a mock, inherit from the interface or base class you want to mock, and use `MOCK_METHOD` macros:

```cpp
#include <gmock/gmock.h>

class MockFoo {
 public:
  MOCK_METHOD(int, Bar, (int), ());  // Mock a method Bar(int)
};
```

Then, in your test:

```cpp
TEST(FooTest, CallsBar) {
  MockFoo mock;

  EXPECT_CALL(mock, Bar(42))
      .Times(1)
      .WillOnce(testing::Return(7));

  EXPECT_EQ(mock.Bar(42), 7);
}
```

- `EXPECT_CALL` sets an expectation on the mock object.
- `Times(1)` expects exactly one call.
- `WillOnce(Return(value))` specifies the return value for the call.

### 5. Running Your Tests and Validating Results

- Compile your test program linking against GoogleTest and GoogleMock.
- Run the test binary. GoogleTest automatically discovers and runs all tests.

You should see output similar to:

```
[==========] Running 3 tests from 1 test suite.
[ RUN      ] FactorialTest.HandlesZeroInput
[       OK ] FactorialTest.HandlesZeroInput (0 ms)
[ RUN      ] FactorialTest.HandlesPositiveInput
[       OK ] FactorialTest.HandlesPositiveInput (0 ms)
[ RUN      ] FooTest.CallsBar
[       OK ] FooTest.CallsBar (0 ms)
[==========] 3 tests from 1 test suite ran. (0 ms total)
[  PASSED  ] 3 tests.
```

If tests fail, use the detailed messages and line numbers to debug your code and tests.

---

## Examples & Code Samples

### Simple Test Example

```cpp
TEST(MathTest, Addition) {
  EXPECT_EQ(2 + 2, 4);
}
```

### Test Fixture with Setup Example

```cpp
class VectorTest : public testing::Test {
 protected:
  void SetUp() override {
    v_.push_back(1);
    v_.push_back(2);
  }

  std::vector<int> v_;
};

TEST_F(VectorTest, SizeIsTwo) {
  EXPECT_EQ(v_.size(), 2);
}

TEST_F(VectorTest, FirstElementIsOne) {
  EXPECT_EQ(v_[0], 1);
}
```

### Mock Class Example

```cpp
class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (), ());
  MOCK_METHOD(int, Query, (const std::string& sql), ());
};

TEST(DatabaseTest, ConnectAndQuery) {
  MockDatabase mock_db;

  EXPECT_CALL(mock_db, Connect())
      .Times(1)
      .WillOnce(testing::Return(true));

  EXPECT_CALL(mock_db, Query(testing::_))
      .Times(testing::AtLeast(1))
      .WillRepeatedly(testing::Return(42));

  ASSERT_TRUE(mock_db.Connect());
  EXPECT_EQ(mock_db.Query("SELECT * FROM Foo"), 42);
}
```

### Using GoogleTest Assertions

```cpp
EXPECT_TRUE(IsValid(input));
ASSERT_EQ(result.size(), expected_size);
EXPECT_NE(pointer, nullptr) << "Pointer must not be NULL";
```


---

## Troubleshooting & Tips

### Common Issues

- **Tests not discovered or run:** Make sure `RUN_ALL_TESTS()` is called in your `main()`.
- **Compilation errors with mock macros:** Confirm `<gmock/gmock.h>` is included and your compiler is C++11 or above.
- **Linker errors:** Verify linking against `gtest` and `gmock` libraries properly.
- **Using `ASSERT_*` in non-void functions:** `ASSERT_*` macros cause early return; they must be used only in functions returning `void`.
- **Tests running unexpectedly disabled:** Check if test or test suite names prefixed with `DISABLED_`.

### Best Practices

- Use `TEST_F` when tests share complex setup or data.
- Prefer non-fatal `EXPECT_*` assertions unless failure means abort test.
- Use `SCOPED_TRACE` to provide contextual info in complex test helpers.
- Name your test suites and tests consistently with project style.
- Avoid dependencies between tests; tests should run independently.

### Performance Considerations

- Reuse resources in `SetUpTestSuite()` and `TearDownTestSuite()` to speed up tests.
- Keep mock expectations tight and specific to avoid brittle tests.

### Alternative Approaches

- Use *parameterized tests* to test multiple input values with the same test logic.
- Use typed tests to run common tests across multiple types.

---

## Next Steps & Related Content

- Learn to write [parameterized tests](../core_testing_patterns/parameterized_tests) once comfortable.
- Explore [mastering matchers](../core_testing_patterns/mastering_matchers) for flexible assertions.
- Dive into [effective mocking](../core_testing_patterns/effective_mocking) for advanced mock behaviors.
- Study [GoogleTest Primer](../primer) for foundational concepts.
- Review [Assertions Reference](../reference/assertions) for comprehensive assertion list.

---

For more detailed information, consult the [GoogleTest Primer](primer.md) and the [GoogleMock documentation](https://github.com/google/googletest/tree/main/googlemock) to expand your testing capabilities.
