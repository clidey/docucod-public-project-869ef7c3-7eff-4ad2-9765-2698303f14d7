---
title: "Mocking with GoogleMock: Quickstart"
description: "An introductory walkthrough that covers creating and using mock objects with GoogleMock. Learn how to declare mock classes, specify expectations, and use the main mocking utilities in basic scenarios."
---

# Mocking with GoogleMock: Quickstart

An introductory walkthrough that covers creating and using mock objects with GoogleMock. Learn how to declare mock classes, specify expectations, and use the main mocking utilities in basic scenarios.

---

## 1. Overview

### What This Guide Helps You Accomplish
This quickstart guide walks you through the fundamental workflow of creating and using mock objects with GoogleMock. You will learn how to:

- Define a mock class based on your interface
- Instantiate mock objects
- Set expectations on mock methods
- Specify behaviors for mocked methods
- Use the main mocking utilities like `NiceMock`, `NaggyMock`, and `StrictMock`

This knowledge will help you write unit tests that verify interactions with dependencies and control their behavior precisely.

### Prerequisites
- Basic understanding of C++ and virtual functions
- GoogleTest and GoogleMock installed and configured in your project
- Familiarity with writing simple tests in GoogleTest

### Expected Outcome
By following this guide, you will be able to create mock classes, specify clear expectations on mock methods, and use them to test your production code effectively.

### Time Estimate
Approximately 15 â€“ 30 minutes to complete the steps and try the examples.

### Difficulty Level
Beginner

---

## 2. Defining a Mock Class

GoogleMock uses macros to generate mock classes quickly. Given an interface with virtual methods, you derive a mock class and use the `MOCK_METHOD` macro to mock each method.

> **Important:** Virtual destructors in your base class are required for safe mocking.

### Example: Mocking a Simple Interface
Assume you have the following interface:

```cpp
class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};
```

Define the mock class as:

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};
```

### Notes on `MOCK_METHOD`
- Must be placed in the `public:` section regardless of the base method's access.
- The 4th argument specifies method qualifiers: `const`, `override`, `noexcept`, etc.
- To mock overloaded methods, mock all overloads explicitly.

### Handling Complex Types
If an argument or return type contains commas (e.g., templates like `std::pair<bool,int>`), wrap the type in parentheses or use a `using` alias to avoid macro parsing errors.

---

## 3. Creating Mock Objects with Different Strictness

GoogleMock provides three wrapper templates to control the behavior for uninteresting calls (mock method calls without expectations):

- `NiceMock<MockClass>`: ignores uninteresting calls (no warnings)
- `NaggyMock<MockClass>`: warns on uninteresting calls (default behavior)
- `StrictMock<MockClass>`: treats uninteresting calls as errors

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // Suppresses warnings on unexpected calls
NaggyMock<MockFoo> naggy_foo;    // Default; warnings on uninteresting calls
StrictMock<MockFoo> strict_foo;  // Fails test on uninteresting calls
```

Use these wrappers in tests depending on the level of strictness you want for your mocks.

---

## 4. Setting Expectations on Mock Methods

Expectations define *how* you expect mock methods to be called in your tests: how many times, with which arguments, and what actions to perform.

### Basic Syntax

Use `EXPECT_CALL` prior to invoking the code under test:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `matchers...` are argument matchers (e.g., literals, `_` for any value, or more complex matchers).
- `Times()` indicates how many times the function is expected to be called. If omitted, defaults are inferred.
- `WillOnce()` specifies the action on the first matching call.
- `WillRepeatedly()` specifies the action for subsequent calls.

### Setting Default Behavior with `ON_CALL`

Use `ON_CALL` to specify the default behavior when you do not want to set an expectation that a method must be called:

```cpp
ON_CALL(mock_object, GetSize()).WillByDefault(Return(42));
```

This sets behavior without failing the test if the method is never called.

### Complete Example

```cpp
using ::testing::Return;

TEST(BarTest, DoesThis) {
  MockFoo foo;

  ON_CALL(foo, GetSize())
      .WillByDefault(Return(1));  // Default return value

  EXPECT_CALL(foo, Describe(5))
      .Times(3)
      .WillRepeatedly(Return("Category 5"));  // Must be called 3 times

  EXPECT_EQ(MyProductionFunction(&foo), "good");
}
```

---

## 5. Common Mocking Patterns

### Ignoring Uninteresting Calls

If you don't care if some mock methods are called, simply don't set `EXPECT_CALL` on them. GoogleMock will issue warnings by default, but the test will pass unless strict mocks are used.

### Enforcing Call Counts

To assert a method is never called:

```cpp
EXPECT_CALL(mock_object, SomeMethod(_))
    .Times(0);
```

To enforce call order, use sequences:

```cpp
using ::testing::InSequence;
{
  InSequence s;
  EXPECT_CALL(foo, FirstMethod());
  EXPECT_CALL(foo, SecondMethod());
}
```

---

## 6. Practical Tips

- **Set expectations *before* exercising your code**. Setting expectations after invoking methods leads to undefined behavior.
- Use `_` matcher to specify "any value" when input arguments are irrelevant.
- Use `NiceMock` during test development to avoid noise from uninteresting calls, then switch to `StrictMock` for final tests to catch unwanted calls.
- Return references with `ReturnRef()` if your mock method returns a reference.
- For methods returning move-only types like `std::unique_ptr`, use lambdas in `.WillOnce()` to create and return fresh objects.

---

## 7. Troubleshooting

### Uninteresting Call Warnings

If you see warnings like "Uninteresting mock function call encountered", it means a mock method was called without an expectation. This might be expected or a test oversight.

- To suppress warnings, wrap the mock with `NiceMock`.
- To assert that the method should never be called, use `EXPECT_CALL(...).Times(0)`.

### Test Failures Due to Unexpected Calls

If a mock method call does not match any expectation, the test will fail. Review the matchers and ensure your expectations cover all call scenarios.

### Virtual Destructor Requirement

Ensure your mocked interface has a virtual destructor. Without it, deleting a mock via base pointer may leak objects or cause undefined behavior.

### Slow Compilation Due to Mocks

If compilation is slow, consider moving mock class constructor and destructor definitions to a separate `.cc` file.

---

## 8. Next Steps & Related Content

- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced mocking patterns.
- Read the [Mocking Reference](https://google.github.io/googletest/docs/reference/mocking.html) for complete API details.
- Begin writing tests with mocks, and practice setting expectations and behaviors.
- Visit `/guides/core_workflows/creating-mocks` for comprehensive mock creation workflows.

---

## 9. References

- GoogleMock Cheat Sheet: https://google.github.io/googletest/gmock_cheat_sheet.html
- gMock Cookbook: https://google.github.io/googletest/gmock_cook_book.html
- gMock for Dummies: https://google.github.io/googletest/gmock_for_dummies.html
- Mocking Reference: https://google.github.io/googletest/docs/reference/mocking.html

---

## 10. Code Example Summary

```cpp
#include <gmock/gmock.h>

// Interface
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(Bar elem, int count) = 0;
};

// Mock class
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (Bar elem, int count), (override));
};

// Using mocks in tests
using ::testing::Return;

TEST(FooTest, Example) {
  MockFoo mock_foo;

  ON_CALL(mock_foo, GetSize())
      .WillByDefault(Return(5));

  EXPECT_CALL(mock_foo, Describe("test"))
      .Times(1)
      .WillOnce(Return("Description"));

  // Your code under test uses mock_foo...
}
```
