---
title: "Mock Object Basics"
description: "A hands-on guide to defining and using mock classes with GoogleMock. Learn to declare mock methods, inject mocks, and verify interactions using intuitive macros, enhancing your tests with tight control over dependencies."
---

# Mock Object Basics

A practical guide to defining and using mock classes with GoogleMock. This page focuses exclusively on how to declare mock methods, instantiate mocks, set behaviors, and verify interactions using GoogleMock’s intuitive macros.

---

## What You Will Learn

- How to use the `MOCK_METHOD` macro to define mock methods
- How to create mock objects
- How to set expectations and behaviors with `EXPECT_CALL` and `ON_CALL`
- How to verify mock interactions

---

## Prerequisites

Before you begin:

- Have GoogleTest/GoogleMock installed and configured in your project.
- Understand basic C++ inheritance and virtual methods.
- Know the interface or class you want to mock.

---

## 1. Defining a Mock Class

The foundation of mocking in GoogleMock is defining a mock class that mimics the interface you want to control in your tests.

### Step 1: Derive Your Mock Class

Derive a class from your interface or base class.

### Step 2: Declare Mock Methods Using `MOCK_METHOD`

- Place `MOCK_METHOD` declarations in the `public:` section, regardless of the access specifier of the original method.
- Syntax:

```cpp
MOCK_METHOD(return_type, method_name, (argument_types), (optional_qualifiers));
```

- Example for a mock turtle interface:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

### Notes:
- For `const` methods, add `(const)` qualifier.
- For overriding virtual methods, it’s recommended to add `(override)`.
- If your method has commas in return or argument types (e.g., templates), wrap them in extra parentheses or use `using` type aliases:

```cpp
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD((BoolAndInt), GetPair, ());
```

---

## 2. Creating Mock Objects

Instantiate your mock as a normal C++ object.

```cpp
MockTurtle turtle;
```

You can also create mocks on the heap. Just ensure you delete them so the expectations are verified.

---

## 3. Setting Behavior and Expectations

### 3.1 Default Behavior with `ON_CALL`

Use `ON_CALL` to define what happens when a mock method is called but without setting any expectation on the call count or order.

```cpp
ON_CALL(turtle, GetX()).WillByDefault(Return(10));
```

Notes:
- Use `ON_CALL` to specify *default* behavior.
- Must use `.WillByDefault()` to specify the action. This is mandatory.
- `ON_CALL` alone does not expect the method to be called; calls are allowed but not verified.

### 3.2 Setting Expectations with `EXPECT_CALL`

Use `EXPECT_CALL` to specify that a mock method is expected to be called with certain arguments, number of times, and behaviors.

```cpp
EXPECT_CALL(turtle, Forward(50))
    .Times(AtLeast(1))
    .WillRepeatedly(Return());
```

The chainable modifiers (in order) are:

| Clause            | Description                                                  |
|-------------------|--------------------------------------------------------------|
| `.With()`         | Restrict to calls whose arguments as a whole match a matcher.|
| `.Times()`        | Sets cardinality (number of expected calls).                 |
| `.InSequence()`   | Specifies one or more sequences for call order.              |
| `.After()`        | Specifies expectations that must happen before this call.   |
| `.WillOnce()`     | Specifies the action for the next call matching this expectation. Can be repeated multiple times.
| `.WillRepeatedly()`| Specifies the fallback action after `WillOnce`s are exhausted. Can appear once.
| `.RetiresOnSaturation()` | Causes the expectation to become inactive after its cardinality is reached.

### 3.3 Matchers

- Use matchers like `Eq(value)`, `Gt()`, `Lt()`, `_` (wildcard), or composite matchers to specify expected arguments.
- Omitting arguments implies wildcard `_` for each.

```cpp
EXPECT_CALL(turtle, GoTo(50, _));
```

---

## 4. Using Mock Objects in Tests

Typical workflow:

1. Include `#include <gmock/gmock.h>`
2. Create mock objects
3. Set default behaviors (`ON_CALL`)
4. Set expectations (`EXPECT_CALL`)
5. Run code that calls the mock
6. Let destruction verify expectations

Example:

```cpp
TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;
  ON_CALL(turtle, PenDown()).WillByDefault(Return());
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

---

## 5. Best Practices & Common Pitfalls

- **Expectations must be set before exercise:** `EXPECT_CALL` should appear before any code that invokes the mock method.
- **Sticky expectations:** Calls beyond an expectation's specified count produce errors by default. Use `.RetiresOnSaturation()` to retire expectations automatically.
- **Ordering of multiple expectations:** Later `EXPECT_CALL`s override earlier ones for matching calls; to enforce call order, use sequences or `.After()`.
- **Dealing with uninteresting calls:** Avoid suppressing warnings by adding unnecessary `EXPECT_CALL`s; instead, use `NiceMock` if you want to suppress warnings.
- **Mock methods should be `virtual` in base:** to enable mocking.
- **When mocking const or overloaded methods:** Use appropriate qualifiers and disambiguate using `Const()` wrapper.

---

## 6. Advanced Usage

### 6.1 Sequences and Ordering

Use the `InSequence` helper to enforce order across multiple expectations:

```cpp
{
  InSequence s;
  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

### 6.2 Partial Ordering with `After`

Define dependencies between expectations for flexibility:

```cpp
Expectation e1 = EXPECT_CALL(foo, InitX());
Expectation e2 = EXPECT_CALL(foo, InitY());
EXPECT_CALL(foo, Use()).After(e1, e2);
```

### 6.3 Mocking Move-Only Types

`MOCK_METHOD` supports move-only return and argument types (e.g., `std::unique_ptr`) with the usual macro syntax.

### 6.4 Mocking Non-Virtual Methods

Possible using templates and mock classes unrelated to real class.

### 6.5 Delegating to Real or Fake Objects

You can delegate the default action of mocks to a real or fake implementation using lambdas inside `ON_CALL`.

---

## 7. Debugging and Verification

- Mocks verify expectations on destruction automatically.
- Use `Mock::VerifyAndClearExpectations(&mock)` to verify early.
- To allow leaks (disable verification), call `Mock::AllowLeak(&mock)`.

---

## 8. Sample Code Snippets

### Defining a Mock Class

```cpp
class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
  MOCK_METHOD(void, Reset, (), (override));
};
```

### Setting Expectations and Default Actions

```cpp
MockCalculator mock;

ON_CALL(mock, Add(_, _)).WillByDefault(Return(0));  // Default behavior

EXPECT_CALL(mock, Add(5, 3))
    .Times(1)
    .WillOnce(Return(8));
```

### Using in a Test

```cpp
TEST(CalculatorTest, AddsNumbers) {
  MockCalculator mock;

  ON_CALL(mock, Add(_, _)).WillByDefault(Return(0));
  EXPECT_CALL(mock, Add(5, 3)).Times(1).WillOnce(Return(8));

  int result = mock.Add(5, 3);
  EXPECT_EQ(result, 8);
}
```

---

## 9. Troubleshooting Common Errors

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Mock Methods Not Called as Expected">
Ensure all `EXPECT_CALL` statements precede any invocation of mock methods. Setting expectations after calls leads to undefined behavior.
</Accordion>
<Accordion title="Uninteresting Call Warning">
Use `NiceMock` wrapper for mocks to suppress warnings on uninteresting calls, or add `EXPECT_CALL(...).Times(AnyNumber())` to explicitly allow them.
</Accordion>
<Accordion title="Compile Errors with MOCK_METHOD">
Check for commas in return or argument types and use extra parentheses or type aliases to resolve parsing.
</Accordion>
<Accordion title="Unexpected or Excessive Calls Failure">
Verify your expectations and cardinalities; use sequences or `.RetiresOnSaturation()` to manage complex call order and limits.
</Accordion>
</AccordionGroup>

---

## 10. Additional Resources

- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)

---

## 11. Summary

This page provides a focused introduction to creating mock objects using GoogleMock, focusing on declaring mock methods with `MOCK_METHOD`, setting up behaviors and expectations with `ON_CALL` and `EXPECT_CALL`, and verifying interactions in tests.


---

**Happy Mocking!**


## Code Example Recap

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};

TEST(PainterTest, CanDrawCircle) {
  MockTurtle turtle;
  ON_CALL(turtle, PenDown()).WillByDefault(Return());
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  // Code under test that uses turtle
  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

---
