---
title: "Getting Started with Mock Objects"
description: "A hands-on introduction to GoogleMock, showing how to create and use mock objects in your tests. Covers the basics of defining mocks, setting up method expectations, and verifying interactions."
---

# Getting Started with Mock Objects

## Introduction

This guide introduces you to GoogleMock (gMock), GoogleTest's C++ mocking framework. It will help you create and use mock objects in your tests—a powerful way to simulate dependencies, verify interactions, and build robust, fast, and maintainable unit tests.

You will learn how to define mock classes, set expectations on mock methods, and verify that your code uses collaborators correctly.

---

## What Are Mock Objects?

When writing tests, you often want to isolate the unit under test from external dependencies like databases, file systems, or network services. A **mock object** acts as a stand-in for such dependencies. It implements the same interface but lets you control and verify the interaction at runtime.

**Key Difference from Fakes:**
- *Fake objects* have working implementations but are usually simplified and not production-ready.
- *Mocks* are pre-programmed with **expectations** describing how they should be used in a test.

Mocks help you check that your code calls the right methods, with the right arguments, the expected number of times, and in the correct order.

---

## Why Use GoogleMock?

Manual mocks in C++ are tedious and error-prone. GoogleMock automates mock creation and verification using expressive, declarative syntax:

- Avoid tedious boilerplate for mocks.
- Detect incorrect interactions promptly.
- Improve test speed by eliminating expensive or unreliable dependencies.
- Simplify testing error handling by simulating failures.

---

## Quick Workflow Overview

- **Objective:** Define mock classes for your interfaces and verify interactions in tests.
- **Prerequisites:** Basic familiarity with C++ interfaces, virtual methods, and GoogleTest.
- **Outcome:** Tests that verify method calls precisely, improving reliability and understandability.
- **Estimated Time:** 15-30 minutes.
- **Skill Level:** Beginner to intermediate.

---

## Step 1: Define a Mock Class

Your first step is to define a mock class implementing the interface your code depends on.

### What You Need to Do:

- Derive a class from the interface.
- For each **virtual** method to mock, use the `MOCK_METHOD` macro.
- If the method is const, add `(const, override)` qualifiers.
- Use `(override)` otherwise.

### Example:

Suppose you have a drawing interface `Turtle`:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};
```

Define a mock like this:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

**Tips:**
- Always mock methods you want to verify in tests.
- Place mock class declarations where they can be maintained alongside the interface if you own it.
- Avoid mocking classes you do not own; consider coding to an adaptor interface instead.

---

## Step 2: Use Mocks in Your Tests

In your test code, you will instantiate mock objects and set expectations describing how your code under test should call them.

### Typical Test Flow:

1. Import gMock symbols into scope.
2. Create mock objects.
3. Optionally, set **default actions** with `ON_CALL` (behavior when calls are made but not explicitly expected).
4. Set verification **expectations** with `EXPECT_CALL`.
5. Exercise the code under test.
6. Let mock destruction verify all expectations automatically.

### Example Test:

```cpp
#include "mock_turtle.h"  // Your mock class header
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;  // Import gMock utilities

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;  // Create mock

  EXPECT_CALL(turtle, PenDown())
      .Times(AtLeast(1));  // Expect PenDown called at least once

  Painter painter(&turtle);  // Class under test takes Turtle interface
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));  // Exercise your code
  // No manual verification needed - will be checked on destruction
}
```

### Key Notes:
- `EXPECT_CALL` must appear **before** exercising the code.
- If methods are called more or less than expected, the test fails immediately.
- Default actions (via `ON_CALL`) specify behavior without requiring a call.

---

## Step 3: Setting Expectations

Here’s how to specify expectations on mock method calls.

### Basic Syntax:

```cpp
EXPECT_CALL(mock_object, Method(argument_matchers))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `argument_matchers` specify what argument values you expect.
- `Times()` controls how many calls are expected.
- `WillOnce()` specifies behavior for one call.
- `WillRepeatedly()` specifies behavior for all further calls.

### Examples:

- Expect `Forward` to be called with distance 100:

  ```cpp
  EXPECT_CALL(turtle, Forward(100));
  ```

- Expect `GetX` to be called 5 times, returning different values sequentially:

  ```cpp
  EXPECT_CALL(turtle, GetX())
      .Times(5)
      .WillOnce(Return(100))
      .WillOnce(Return(150))
      .WillRepeatedly(Return(200));
  ```

- Expect a method to never be called:

  ```cpp
  EXPECT_CALL(foo, Bar(_)).Times(0);
  ```

### Matchers:

- `_` means accept any value.
- Use built-in matchers like `Eq()`, `Ge()`, `NotNull()`, or combine them.
- To avoid brittle tests, match only arguments you care about.

### Cardinalities:

- Use `Times(Exactly(n))`, `Times(AtLeast(n))`, `AnyNumber()`, etc.
- If omitted, gMock infers the cardinality based on `WillOnce` and `WillRepeatedly` clauses.

### Actions:

- Commonly use `Return(value)` to specify return values.
- Use `SetArgPointee<N>(value)` to set output parameters.
- Chain multiple actions with `DoAll()`.

---

## Step 4: Controlling Call Order

By default, calls can occur in any order matching the expectations.

### Sequences

To enforce call ordering:

```cpp
using ::testing::InSequence;
{
  InSequence seq;  // All expectations inside this scope must happen in order

  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

Calls out of this order will make tests fail.

### Partial Ordering

Partial order can also be specified using `InSequence` with multiple `Sequence` objects or the `.After()` clause for more complex dependencies.

---

## Step 5: Common Best Practices & Tips

- **Set expectations before exercising code.** Setting them after the fact results in undefined behavior.
- **Match arguments carefully.** Use `_` to avoid brittleness.
- **Use `ON_CALL` to define default behaviors** without enforcing call expectations.
- **Be mindful of sticky expectations.** Use `.RetiresOnSaturation()` or sequences to prevent unexpected failures due to repeated calls.
- **Suppress warnings for uninteresting calls** by using `NiceMock` or explicit `EXPECT_CALL` with `Times(AnyNumber())`.
- **Always have virtual destructors in interfaces** you mock to avoid leaks and undefined behavior.

---

## Troubleshooting

### Most Common Issues

- **Mock class functions not called as expected:** Ensure `EXPECT_CALL` is set before code execution.
- **Unexpected Calls:** Check argument matchers; run with `--gmock_verbose=info` to trace calls.
- **Uninteresting Call Warnings:** Use `NiceMock` or add `EXPECT_CALL` with `Times(AnyNumber())` for those methods.
- **Leaked Mocks Detected:** Verify all mock objects are deleted to ensure expectations run.

### Debugging Tips

- Use the flag `--gmock_verbose=info` to see detailed matching of each mock method call.
- Use your IDE integration (e.g., Emacs key bindings) to jump to failing expectation lines.

---

## Next Steps & Related Topics

- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes.
- Learn about [Matchers and Actions](https://google.github.io/googletest/reference/matchers.html) to write complex and expressive expectations.
- Consult [Writing Your First Test](../guides/core-testing-workflows/writing-your-first-test.md) to integrate mocking into your overall testing workflow.
- For large code bases, use sequences and `EXPECT_CALL` chaining to precisely specify interactions.

---

## Summary

This document equips you with the essential skills to start using GoogleMock:
- Writing mock classes with `MOCK_METHOD`
- Setting method call expectations (`EXPECT_CALL`)
- Specifying call behaviors and return values
- Verifying interaction correctness
- Enforcing call order

With these foundations, you will enhance the reliability and maintainability of your C++ tests.

---

## References

- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [GoogleMock API Reference: Mocking](../reference/gmock-api/mock-object-construction.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [GoogleTest Primer](../getting-started/first-test-experience/write-first-test.md)
- [Matchers Reference](../reference/matchers.md)
- [Actions Reference](../reference/actions.md)
