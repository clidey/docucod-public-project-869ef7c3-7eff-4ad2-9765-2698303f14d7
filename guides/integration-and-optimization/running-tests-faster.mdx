---
title: "Speeding Up Test Execution"
description: "Tips and techniques for reducing test suite execution time, including running tests in parallel, test filtering, and managing long-running or flaky tests. Links to external tooling and advanced runner strategies."
---

# Speeding Up Test Execution

## Overview
This guide empowers you to streamline your GoogleTest test suite execution by leveraging key techniques such as parallel test runs, test filtering, and handling long-running or flaky tests effectively. By adopting these practices, you’ll reduce build times, improve feedback cycles, and optimize your test workflows.

## Prerequisites
- A working GoogleTest setup with your tests compiled and linked.
- Familiarity with running test binaries using `RUN_ALL_TESTS()`.
- Access to your test environment command line or CI/CD pipeline configuration.

## What You’ll Achieve
- Run tests in parallel to fully utilize CPU resources.
- Execute only relevant tests using filters.
- Manage flaky or slow tests to maintain reliability and speed.
- Understand when and how to apply advanced test runner flags.

## Time Estimate
Setting up basic filtering and parallel runs: 10-15 minutes
Advanced tuning and flaky test management: 30-60 minutes

## Difficulty
Intermediate: Requires understanding of your test suite and command-line usage.

---

## Step-by-Step Instructions

### 1. Run Tests in Parallel
Parallel execution uses multiple CPU cores to run tests simultaneously, dramatically cutting overall test time.

- **Linux and macOS:**

  Use your build system or test runner that supports parallelism (like `make -j`, `ctest -j`, or scripting).

- **GoogleTest in isolation:**

  GoogleTest itself does not directly support test parallelism internally but is compatible with external parallel runners. Consider these strategies:

  - Split test binaries by source, running multiple instances concurrently.
  - Use test sharding (see next section).

<Check>
GoogleTest supports test sharding, which enables running tests distributed across multiple processes or machines.
</Check>

### 2. Use Test Sharding to Distribute Tests
Sharding lets you divide your test suite into *shards*, each running a non-overlapping subset.

**How to enable sharding:**

- Define total shards and shard indices in environment variables:

```bash
export GTEST_TOTAL_SHARDS=4   # Total number of parallel shards
export GTEST_SHARD_INDEX=2    # Index of this shard (0-based)
```

- Run the same test binary on each shard machine/process with appropriate `GTEST_SHARD_INDEX`.

- GoogleTest automatically runs the subset of tests assigned to the shard.

<Note>
Shard indices must be in `[0, GTEST_TOTAL_SHARDS - 1]` and total shards the same on all instances.
</Note>

### 3. Filter Tests to Run a Subset
Narrowing the executed tests speeds runs by skipping unrelated tests.

- Use the `--gtest_filter` flag or `GTEST_FILTER` environment variable.

- Filter syntax:

  - Positives: patterns separated by `:`

  - Negatives: prefixes with `-`

- Example:

```bash
./my_test --gtest_filter=FooTest.*-FooTest.FlakyTest
```

(Will run all tests in `FooTest` except `FlakyTest`.)

- Wildcards supported: `*` matches any string, `?` matches one character.

- Combine multiple positive and negative expressions:

```bash
--gtest_filter=FooTest.*:BarTest.*-FlakyTest.*
```

### 4. Handle Long-Running or Flaky Tests
Long or unreliable tests slow down the whole suite. Manage them by isolating and controlling execution.

- **Mark tests as disabled** if temporarily incomplete or unstable by prefixing test or suite names with `DISABLED_`.

- Run disabled tests explicitly with `--gtest_also_run_disabled_tests` when needed.

- Consider moving slow or flaky tests to separate binaries.

- Use `--gtest_repeat=N` to execute tests multiple times to detect flakes.

- Use `--gtest_break_on_failure` in combination with `--gtest_repeat` to halt on first failure during debugging.

- For flaky tests, add logs or use `SCOPED_TRACE` to improve failure diagnostics.

### 5. Shuffle Tests to Detect Ordering Dependencies
Run tests in a random order each time to detect hidden dependencies.

- Use `--gtest_shuffle` flag:

```bash
./my_test --gtest_shuffle
```

- For reproducibility, specify the random seed with `--gtest_random_seed=SEED`.

### 6. Generate Reports to Diagnose Performance Bottlenecks
Generating XML or JSON reports with timing information helps identify slow tests.

- Enable output with:

```bash
./my_test --gtest_output=xml:results.xml
```

- Analyze cumulative test suite results to pinpoint bottlenecks.

### 7. Integrate Advanced Runner Flags
Explore these flags to further optimize and customize test runs:

| Flag                               | Purpose                                              |
|-----------------------------------|------------------------------------------------------|
| `--gtest_fail_fast`                | Stop running further tests on first failure          |
| `--gtest_repeat=N`                 | Run all tests N times                                 |
| `--gtest_shuffle`                  | Run tests in random order                             |
| `--gtest_random_seed=SEED`         | Seed value for shuffle ordering                      |
| `--gtest_also_run_disabled_tests` | Enable running disabled tests                        |

Use these flags based on your workflow needs, especially in CI.

---

## Practical Example

Imagine your test suite takes over 1 hour to run sequentially on a single core. Your CI server has 8 cores available.

1. **Run tests in parallel shards:** Split your tests into 8 shards by setting the following on each CI node:

```bash
GTEST_TOTAL_SHARDS=8
GTEST_SHARD_INDEX=0  # or 1, 2, ..., 7 on other nodes
```

 Run the same test binary on all 8 nodes. Each runs only ~7.5 minutes worth of tests.

2. **Filter flaky tests:** Disable unstable tests by renaming them to include `DISABLED_`.

3. **Run flaky tests separately:** Use `--gtest_filter=DISABLED_*` and `--gtest_repeat=100` to catch intermittent failures.

4. **Shuffle:** Add `--gtest_shuffle` to randomize test runs and detect dependencies.

5. **Generate reports:** Use `--gtest_output=xml:report.xml` to get detailed duration breakdown.

---

## Troubleshooting & Tips

<AccordionGroup title="Troubleshooting and Best Practices">
<Accordion title="Tests Not Running with Sharding">
Ensure `GTEST_SHARD_INDEX` and `GTEST_TOTAL_SHARDS` are set correctly with consistent values across shards. Both must be numeric and indices must be within bounds.
</Accordion>
<Accordion title="Filter Not Matching Expected Tests">
Double-check your `--gtest_filter` syntax. Patterns use `*` and `?` wildcards. Look for typos or unintended exclusions with the negative patterns.
</Accordion>
<Accordion title="Parallel Execution Causing Resource Conflicts">
Ensure tests are isolated and stateless since parallel runs share environments. Use test fixtures to manage resources independently.
</Accordion>
<Accordion title="Shuffling Hides Failures">
Sometimes shuffling can cause flaky tests to occasionally pass. Combine with `--gtest_repeat` to detect flaky tests reliably.
</Accordion>
<Accordion title="Slow Test Detection">
Use XML timing reports to pinpoint slow tests. Refactor or isolate such tests for separate execution.
</Accordion>
<Accordion title="Use With CI Pipelines">
Automate setting environment variables and flags for sharding and filtering to leverage multiple machines and speed up test runs.
</Accordion>
</AccordionGroup>

---

## Next Steps & Related Content

- Explore [Running and Interpreting Test Results](/guides/getting-started-workflows/running-interpreting-tests) to deepen your knowledge of test flags and output.
- Review [Configuring GoogleTest](/getting-started/setup-prerequisites-installation/configuration-basics) for project setup tips to support optimized runs.
- Learn about [Integration with CI Systems](/guides/integration-and-optimization/ci-integration-examples) to automate tests efficiently.
- Dive into [Advanced Testing Patterns](/guides/advanced-testing-patterns/using-gmock) to optimize mocking and test isolation for better performance.

---

## References
- [GoogleTest Primer](primer.md)
- [Advanced GoogleTest Topics](advanced.md)
- [Testing Reference](reference/testing.md)
- [GoogleTest CMake Build Instructions](googletest/README.md#build-with-cmake)

---