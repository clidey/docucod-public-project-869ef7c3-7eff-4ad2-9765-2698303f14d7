---
title: "Cross-Platform and CI Integration"
description: "Strategies for integrating tests into modern CI/CD pipelines and working across different platforms (Linux, macOS, Windows). Includes tips for managing dependencies, reproducibility, and recommended workflow automations."
---

# Cross-Platform and CI Integration

## Overview

This guide provides practical strategies for integrating GoogleTest into modern Continuous Integration (CI) and Continuous Deployment (CD) pipelines across multiple platforms including Linux, macOS, and Windows. You will learn how to manage dependencies effectively, ensure test reproducibility, and automate workflows to streamline your testing process.

## Prerequisites

Before proceeding, ensure you have:

- A working GoogleTest setup compatible with your platform.
- Your project configured to build and run tests using GoogleTest.
- Familiarity with your chosen CI environment and scripting capabilities.
- Basic knowledge of build automation tools like CMake or Bazel.

## Expected Outcome

By the end of this guide, you will be able to:

- Integrate GoogleTest into CI/CD pipelines on Linux, macOS, and Windows.
- Manage dependencies and configurations effectively to maintain test consistency.
- Automate testing workflows with best practices that ensure speed and reliability.

## Time Estimate

Setting up cross-platform CI integration typically takes between 1-3 hours depending on your CI system familiarity and project complexity.

## Difficulty Level

Intermediate

---

## 1. Understanding Platform Variations and Compatibility

GoogleTest supports a wide range of platforms and compilers, but certain platform-specific nuances exist:

- **Linux and macOS:** POSIX compliance provides robust threading and file system support. Thread-safety (`GTEST_IS_THREADSAFE`) is typically enabled, allowing safe multi-threaded test execution.
- **Windows:** Supports threading and synchronization primitives differently; GoogleTest uses native Windows APIs for mutexes and thread local storage.
- **Exceptions and RTTI:** GoogleTest auto-detects if exceptions and RTTI are available but can be overridden via compiler flags if necessary.

<Tip>
Check the `GTEST_IS_THREADSAFE` macro at compile time to confirm if your build enables thread safety, especially important for parallel test execution in CI.
</Tip>

## 2. Managing Dependencies and Build Configurations

### Use CMake or Bazel for Consistent Cross-Platform Builds

GoogleTest integrates seamlessly with both CMake and Bazel, enabling you to build tests reliably on any supported platform.

**CMake Integration Example:**

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/heads/main.zip
)
FetchContent_MakeAvailable(googletest)

add_executable(mytest mytest.cpp)
target_link_libraries(mytest gtest_main)
add_test(NAME mytest COMMAND mytest)
```

Ensure that you specify the C++17 standard:

```cmake
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```

### Dependency and Flag Management

- Explicitly define platform macros or override defaults if your environment isn't detected correctly, e.g., by using `-DGTEST_HAS_PTHREAD=1` or `-DGTEST_HAS_PTHREAD=0`.
- For shared library builds (DLLs on Windows), define:
  - `-DGTEST_CREATE_SHARED_LIBRARY=1` when building GoogleTest.
  - `-DGTEST_LINKED_AS_SHARED_LIBRARY=1` when building your test binaries.
- Disable or rename GoogleTest macros if there are conflicts with other libraries using `-DGTEST_DONT_DEFINE_<MACRO>=1`.

<Tip>
Maintain build flags centralized in your CI configuration scripts to ensure uniformity across all agents and platforms.
</Tip>

## 3. Automating Tests in CI/CD Pipelines

### Recommended Workflow

<Steps>
<Step title="Setup Dependencies and Build Environment">
- Install required compiler toolchains supporting C++17.
- Install build tools (CMake, Bazel).
- Clone GoogleTest sources or use a package manager if available.
- Configure environment variables and paths.
</Step>
<Step title="Build Test Binaries">
- Configure build system with proper flags.
- Compile and link your test executable(s).
- Ensure tests link against `gtest` and `gtest_main` as needed.
</Step>
<Step title="Run Tests with Consistent Flags">
- Use `testing::InitGoogleTest(&argc, argv)` in your `main()` function.
- Pass any GoogleTest flags (e.g., `--gtest_output=xml:results.xml`) to produce machine-readable reports.
- Run the tests with `RUN_ALL_TESTS()` invoked exactly once.
</Step>
<Step title="Report Test Results">
- Collect and publish test results in your CI environment.
- Use XML reports for integration with dashboards.
- Optionally archive logs for historical analysis.
</Step>
</Steps>

<Tip>
Automate environment setup and test execution in scriptable steps to facilitate reproducibility and debugging.
</Tip>

## 4. Handling Cross-Platform Differences

- **Path separators:** Use platform-agnostic path handling in your tests or build scripts (e.g., `/` vs `\`).
- **File system availability:** GoogleTest detects if a file system is present; death tests and some features may require it.
- **Stream redirection:** Some embedded or mobile platforms may disable stream redirection, affecting output capture.

<Tip>
Use GoogleTest’s internal macros such as `GTEST_OS_*` and `GTEST_HAS_FILE_SYSTEM` to conditionally compile platform-specific test code.
</Tip>

## 5. Ensuring Reproducibility and Managing Flakiness

- Use isolated test fixtures (`TEST_F`) to avoid shared state across tests.
- Run tests on a clean environment to prevent dependency issues.
- Avoid tests that depend on system time, randomness without seeding, or external resources.
- Use the `--gtest_shuffle` and `--gtest_repeat` flags in CI to detect flaky tests.

<Tip>
Flaky tests undermine CI reliability. Configure retries wisely and fix root causes rather than masking failures.
</Tip>

## 6. Common Integration Tips and Best Practices

- **Thread safety:** Prefer enabling thread safety to enable parallel test execution and better CI throughput.
- **Exit codes:** Always check the exit code of your test binaries in CI to accurately detect failures.
- **Test selection:** Use GoogleTest filters (`--gtest_filter`) to selectively run subsets of tests if needed.
- **Resource constraints:** Limit concurrency and resource usage on CI agents to avoid timeout or resource starvation issues.

## 7. Troubleshooting

<AccordionGroup title="Common Issues in Cross-Platform CI Integration">
<Accordion title="Tests Not Discovered or Run">
- Confirm `InitGoogleTest` is called before `RUN_ALL_TESTS()`.
- Ensure test binaries are built and linked with `gtest_main` or provide your own main.
- Verify test registration macros (`TEST()`, `TEST_F()`) are reachable in your compiled code.
</Accordion>
<Accordion title="Linking Errors on Windows">
- Check that runtime libraries match between your tests and GoogleTest (static vs dynamic CRT).
- Use CMake option `gtest_force_shared_crt` to align CRT linkage.
- Define `GTEST_LINKED_AS_SHARED_LIBRARY=1` when using DLL builds.
</Accordion>
<Accordion title="Thread Safety Errors or Crashes">
- Verify `GTEST_IS_THREADSAFE` macro is defined as `1`.
- On POSIX systems, ensure to link against pthreads (e.g., via CMake’s `find_package(Threads)`).
- For unsupported platforms, consider disabling parallel execution.
</Accordion>
<Accordion title="Platform Detection Issues">
- Manually override platform macros in your build flags if incorrect detection occurs (see `gtest-port-arch.h`).
- Review exceptions and RTTI availability flags and confirm your compiler matches GoogleTest expectations.
</Accordion>
</AccordionGroup>

## 8. Example CI Integration Snippet (Linux / macOS with CMake)

```bash
mkdir build
cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
cmake --build .
ctest --output-on-failure
```

Use environment variables or CI configuration files to trigger this sequence.

## 9. Next Steps & Related Content

- Explore [Supported Platforms & Compatibility](/overview/integration-platforms/supported-platforms) to confirm your environment.
- Use [Quickstart: Integration with CMake and Bazel](/guides/getting-started/quickstart-build-tools) for building tests.
- Review the [FAQ and Troubleshooting Patterns](/guides/best-practices-integrations/faq-and-troubleshooting) for common CI and integration problems.
- For performance concerns in large suites, consult [Performance Optimization in Large Test Suites](/guides/best-practices-integrations/performance-optimization).

---

## References

- [GoogleTest Official Documentation](https://google.github.io/googletest/)  
- [GoogleTest README](https://github.com/google/googletest/blob/main/README.md)  
- [Supported Platforms](https://github.com/google/googletest/blob/main/docs/platforms.md)  
- [GoogleTest Internal Platform Macros](https://github.com/google/googletest/blob/main/googletest/include/gtest/internal/gtest-port.h)  


---

<Info>
This guide focuses exclusively on integrating GoogleTest with CI/CD pipelines across supported platforms. For detailed build instructions, refer to the "Installing with CMake" and "Installing with Bazel" guides.
</Info>

<Check>
Ensure your CI agents have a consistent environment setup, particularly compiler versions and required build tools.
</Check>