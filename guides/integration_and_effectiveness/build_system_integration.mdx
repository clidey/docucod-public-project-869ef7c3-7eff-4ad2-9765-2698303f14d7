---
title: "Integration with Build Systems"
description: "Clear, actionable steps for integrating GoogleTest and GoogleMock with CMake and Bazel. Provides example setups and tips to streamline test builds in modern development workflows."
---

# Integration with Build Systems

This guide provides clear, actionable steps to integrate GoogleTest and GoogleMock with popular build systems—specifically **CMake** and **Bazel**. By following these workflows, developers can seamlessly add GoogleTest-based testing capabilities to their C++ projects and streamline test builds within modern development environments.

---

## 1. Integration with CMake

### Workflow Overview

- **Task Description:** Easily build and run tests using GoogleTest and GoogleMock through CMake.
- **Prerequisites:** 
  - A C++17 compatible compiler (GCC, Clang, MSVC).
  - CMake version 3.16 or later.
  - Basic familiarity with CMakeLists.txt files.
- **Expected Outcome:** 
  - GoogleTest and GoogleMock libraries configured and built within your project.
  - A test target that runs automatically via `ctest`.
- **Time Estimate:** 10 to 20 minutes.
- **Difficulty Level:** Beginner to Intermediate.

### Step-by-Step Instructions

<Steps>
<Step title="Set minimum CMake version and enable testing">
Start your `CMakeLists.txt` by specifying the minimum CMake version and enabling testing:
```cmake
cmake_minimum_required(VERSION 3.16)
enable_testing()
```
This establishes the environment and allows `ctest` integration.
</Step>

<Step title="Declare your project and C++ standard">
Include your project declaration ensuring at least C++17 standard support:
```cmake
project(my_project)
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
```
</Step>

<Step title="Integrate GoogleTest via FetchContent">
Use CMake's `FetchContent` module to download and add GoogleTest into your build:
```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
# For Windows compatibility
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```
Replace the URL commit hash with the latest stable version as needed.
</Step>

<Step title="Add your test executable">
Create an executable target for your test binary and link GoogleTest:
```cmake
add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)
```
This example assumes you have a `hello_test.cc` containing your test code.
</Step>

<Step title="Enable test discovery">
Use the `GoogleTest` module to discover and register all tests:
```cmake
include(GoogleTest)
gtest_discover_tests(hello_test)
```
This enables `ctest` to automatically find and run your tests.
</Step>

<Step title="Build and run your tests">
From your project root folder, run the following:
```bash
cmake -S . -B build
cmake --build build
ctest --test-dir build
```
You should see your tests run with success messages on completion.
</Step>
</Steps>

### Expected Results

- GoogleTest and GoogleMock source are automatically downloaded during configuration.
- Your test executable compiles and links without errors.
- Executing `ctest` runs all tests and reports output in a readable format.

### Tips for Success

- Ensure your compiler supports C++17, or update your toolchain.
- Use `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` on Windows to avoid runtime library mismatches.
- Enable verbose output in CTest with `ctest -V` if tests don’t run as expected.

### Example `CMakeLists.txt`

```cmake
cmake_minimum_required(VERSION 3.16)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

---

## 2. Integration with Bazel

### Workflow Overview

- **Task Description:** Utilize Bazel build system to integrate and run GoogleTest and GoogleMock tests.
- **Prerequisites:** 
  - Bazel installed and configured on your system.
  - Basic knowledge of writing Bazel BUILD files.
- **Expected Outcome:** 
  - Bazel builds GoogleTest/GoogleMock libraries as dependencies.
  - You can define and run tests using Bazel commands.
- **Time Estimate:** 15 minutes.
- **Difficulty Level:** Intermediate.

### Step-by-Step Instructions

<Steps>
<Step title="Clone GoogleTest with Bazel support">
Clone the GoogleTest repository to access required Bazel BUILD files:
```bash
git clone https://github.com/google/googletest.git
cd googletest
```
GoogleTest includes native Bazel build support.
</Step>

<Step title="Add GoogleTest dependencies in your Bazel workspace">
In your workspace `WORKSPACE` file, add a repository rule to pull GoogleTest:
```
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.16.0.zip"],
    strip_prefix = "googletest-release-1.16.0",
)
```
Adjust URL and version as needed.
</Step>

<Step title="Declare dependencies in BUILD files">
In your Bazel `BUILD` file where your tests reside, link against GoogleTest:
```starlark
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```
This tells Bazel to use GoogleTest's main function and libraries.
</Step>

<Step title="Run your Bazel test">
Use Bazel’s test command to build and run tests:
```bash
bazel test //path/to:my_test
```
Bazel will build your test binary, link with GoogleTest, and execute the tests.
</Step>
</Steps>

### Expected Results

- Bazel downloads and manages GoogleTest as an external dependency.
- Tests compile and link successfully.
- Running `bazel test` executes your GoogleTest tests, showing pass/fail results.

### Tips for Success

- Use versioned URLs and stable tags to ensure reproducible builds.
- Combine with Bazel’s caching and parallelism to expedite test runs.
- For mocking support, depend on `@com_google_googletest//:gmock_main` in place of or alongside `gtest_main`.

---

## 3. Best Practices and Common Pitfalls

### Best Practices

- Prefer linking with `gtest_main` or `gmock_main` libraries instead of writing custom main functions.
- Use CMake’s `gtest_discover_tests()` for automatic test discovery and integration with `ctest`.
- Enable compiler warnings and strict standards to catch issues early.
- Keep your tests modular and focused for easier maintenance.

### Common Issues and Troubleshooting

<AccordionGroup title="Troubleshooting Guide">
<Accordion title="GoogleTest or GoogleMock Source Not Found in CMake">
Ensure the URL or path provided to `FetchContent` is correct and accessible. Check your network connectivity and repository URLs.
</Accordion>
<Accordion title="Linker Errors on Windows">
Use `set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)` in your `CMakeLists.txt` to align runtime libraries.
</Accordion>
<Accordion title="Tests Not Discovered by CTest">
Confirm that `enable_testing()` and `include(GoogleTest)` are called, and `gtest_discover_tests()` is present for your test targets.
</Accordion>
<Accordion title="Bazel Fails to Download External Repos">
Verify your workspace file syntax and internet access. Check for typos in repository declarations.
</Accordion>
</AccordionGroup>

---

## 4. Next Steps & Resources

- Explore the [GoogleTest Primer](primer.md) to learn how to write effective tests once your build system is set up.
- Advance to the [Parameterizing Tests](guides/common_patterns_scenarios/test_parameterization) guide to utilize advanced test patterns.
- Consult the [Integration & Ecosystem](overview/core-concepts/integration-landscape.md) page for additional tooling and IDE support.
- Visit the [Troubleshooting Common Issues](getting-started/troubleshooting-getting-started/common-setup-issues.md) if you encounter environment or build problems.

---

This guide equips you to integrate GoogleTest and GoogleMock into your C++ project's build process, empowering efficient and reliable automated testing workflows.



