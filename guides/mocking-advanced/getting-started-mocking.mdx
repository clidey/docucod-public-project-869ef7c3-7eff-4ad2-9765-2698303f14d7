---
title: "Getting Started with GoogleMock"
description: "Introduction to mocking in C++ with GoogleMock, including creating mock classes, setting expectations, and verifying interactions. Walkthroughs with real examples to illustrate the mocking workflow."
---

# Getting Started with GoogleMock

## Introduction
GoogleMock is the C++ mocking framework bundled with GoogleTest, designed to help you create mock classes easily and write reliable tests that verify how your code interacts with its dependencies. This page guides you through the essentials of using GoogleMock: creating mock classes, setting expectations, and verifying interactions with practical examples.

---

## 1. Understanding Mock Objects

### What is a Mock Object?
A mock object acts as a stand-in for a real object in your tests. It implements the same interface as the real object but allows you to specify and verify:
- Which methods are called
- With what arguments
- How many times
- In which order
- What these methods return or do

Mocks focus on checking interactions, enabling faster and more robust tests by isolating code from complex or unreliable dependencies.


### Mock vs Fake Objects
- **Fakes** provide simplified working implementations (e.g., an in-memory database) but aren't suitable for production.
- **Mocks** are pre-programmed with expectations on method calls and are used to verify interactions precisely.


### Key Benefit
By coding to interfaces and supplying mocks in tests, you gain precise control over dependency behavior without relying on real implementations.

---

## 2. Writing a Mock Class

### Steps to Define a Mock Class
Suppose you have the following interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual void GoTo(int x, int y) = 0;
  virtual int GetX() const = 0;
  virtual int GetY() const = 0;
};
```

To create a mock for `Turtle`:

1. Derive a class `MockTurtle` from `Turtle`.
2. For each virtual method, use the `MOCK_METHOD` macro inside the public section.
3. Include the `override` qualifier for proper C++ overriding.

```cpp
#include <gmock/gmock.h>  // Brings in GoogleMock.

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(void, GoTo, (int x, int y), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
  MOCK_METHOD(int, GetY, (), (const, override));
};
```

### Tips for Mock Class Placement
- Define mocks where you own the interface.
- Avoid mocking classes you do not own directly.
- Consider placing shared mocks in a separate header and library marked `testonly=True` in Bazel.
- Alternatively, create an adaptor interface you own and mock that, shielding you from downstream changes.

---

## 3. Using Mocks in Tests

### Typical Workflow
1. Import `testing` namespace or use `using ::testing::...`.
2. Instantiate mock objects.
3. Set **expectations** on mock methods with `EXPECT_CALL`.
4. Exercise code that uses these mocks.
5. Assertions verify code behavior.
6. On mock destruction, GoogleMock verifies expectations automatically.

### Example
```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;

TEST(PainterTest, DrawsCorrectly) {
  MockTurtle turtle;  // Mock object

  // Expect PenDown() to be called at least once
  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));

  Painter painter(&turtle);  // Class using Turtle interface

  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));  // Exercise code
}
```

### What Happens
- If `PenDown()` is not called, the test fails immediately with a clear message.
- If it is called as expected, the test passes.

### Best Practices
- Set expectations *before* performing the actions that invoke the mock methods.
- Use matchers (`_`, `Eq(value)`, `Ge(value)`, etc.) to specify argument constraints.
- Keep expectations focused on what interactions matter to the test.

---

## 4. Setting Expectations

### Basic Syntax
```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .Times(cardinality)      // How many times expected
    .WillOnce(action)        // What to do once
    .WillRepeatedly(action)  // What to do after WillOnce calls
    .RetiresOnSaturation();  // Retire when saturated
```

- The `Times()` clause controls call count (e.g., `Exactly(3)`, `AtLeast(1)`, `AnyNumber()`).
- `WillOnce()` specifies behavior on the next call.
- `WillRepeatedly()` specifies behavior on all subsequent calls.

### Matchers
- Use `_` to accept any argument.
- Specify exact values or more complex matchers.

```cpp
using ::testing::_;

EXPECT_CALL(turtle, GoTo(50, _));  // Matches any second coordinate
```

### Cardinalities
- Omit `Times()` and GoogleMock infers call count based on `WillOnce()` and `WillRepeatedly()` clauses.

### Examples
```cpp
EXPECT_CALL(turtle, GetX())
    .Times(5)
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));
```
This sets `GetX()` to be called 5 times, returning 100, then 150, then 200 thereafter.

### Advanced Notes
- Expectation order matters: later `EXPECT_CALL`s override earlier ones.
- Use `InSequence` to enforce call order.

```cpp
{
  InSequence seq;
  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```
---

## 5. Common Patterns & Tips

### Ignoring Uninteresting Calls
- If you donâ€™t care about certain method calls, do not set expectations on them.
- By default, GoogleMock warns about uninteresting calls; use `NiceMock` to suppress warnings.

### Strictness of Mocks
- `NaggyMock` (default): warns on uninteresting calls.
- `NiceMock`: suppresses warnings on uninteresting calls.
- `StrictMock`: treats uninteresting calls as failures.

### Retiring Expectations
- Use `.RetiresOnSaturation()` to make an expectation inactive once its call count limit is reached.

### Verifying Early
- You can force verification before mock destruction with `Mock::VerifyAndClearExpectations(&mock);`

### Mocking Overloaded Methods
- Specify arguments to disambiguate overloads.
- Use `Const(mock)` to specify const method versions.

### Delegating to Real or Fake Objects
- Default mock behavior can delegate to a real or fake object to combine verification with real behavior.

### Dealing with Non-Virtual Methods
- Use templates or interfaces for dependency injection to mock non-virtual functions.

### Handling Move-Only Types
- GoogleMock supports methods with move-only (e.g., `std::unique_ptr`) arguments and return values.

---

## 6. Troubleshooting & Best Practices

### Common Issues
- Mock methods must be virtual.
- Ensure virtual destructors in interfaces you're mocking.
- Set expectations *before* exercising the mock.
- Use `--gmock_verbose=info` for detailed mock call traces when debugging.

### Best Practices
- Use `ON_CALL` to specify default behaviors without imposing call count constraints.
- Use `EXPECT_CALL` to assert the code must perform certain interactions.
- Prefer clear, minimal expectations to avoid brittle tests.

### Performance
- To speed up compilation of large mocks, define mock class constructors and destructors in `.cc` files instead of headers.

---

## 7. Next Steps

- Explore [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced mocking techniques.
- Read the [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) to write expressive argument constraints.
- Review [Using Matchers and Custom Actions](https://google.github.io/googletest/gmock_advanced.html#using-matchers-and-actions) for complex behavior flows.
- Understand [Test Fixtures with GoogleTest](https://google.github.io/googletest/primer.html#writing-the-first-test) for grouping mock-based tests.

---

## References
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html) - Beginner-friendly intro
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - In-depth recipes
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) - Macro and API docs
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) - For writing tests
- [Integration with Build Systems](https://google.github.io/googletest/integration.html)

---

_Last updated with GoogleMock from GoogleTest version `main` branch._
