---
title: "Managing Call Counts and Mock Strictness"
description: "Best practices for specifying cardinalities (call count expectations) and controlling mock behavior: using NaggyMock, NiceMock, and StrictMock to enforce or relax verification as needed."
---

# Managing Call Counts and Mock Strictness

Understanding how to manage call count expectations (cardinalities) and control the strictness of mocks is essential for writing robust and maintainable tests with GoogleMock. This guide details best practices for specifying how many times you expect mock methods to be called and how to control warnings or errors for uninteresting or unexpected calls by using mocking modes such as NaggyMock, NiceMock, and StrictMock.

---

## 1. Overview

### What This Guide Helps You Accomplish
- Confidently specify how often mock methods should be called using cardinalities.
- Manage mock behavior for calls that are unexpected or uninteresting.
- Apply mock strictness levels (`NaggyMock`, `NiceMock`, `StrictMock`) to enforce or relax verification as needed.

### Prerequisites
- Basic familiarity with defining mock classes using `MOCK_METHOD`.
- Understanding of how to write `EXPECT_CALL` and `ON_CALL` statements.
- Some experience running tests with GoogleTest and GoogleMock.

### Expected Outcome
By following this guide, you'll be able to:
- Precisely control mock method invocation counts.
- Avoid flaky tests caused by over- or under-specified expectations.
- Customize how GoogleMock reports (or ignores) uninteresting calls.

### Time Estimate
15-25 minutes depending on familiarity with gMock concepts.

### Difficulty Level
Intermediate.

---

## 2. Specifying Call Counts with Cardinalities

Cardinalities govern how many times a mock method is expected or allowed to be called. They are specified using the `.Times()` clause on an `EXPECT_CALL`. If omitted, GoogleMock infers cardinality from `WillOnce` and `WillRepeatedly` actions.

### Built-in Cardinalities
Available in the `::testing` namespace:

- `Exactly(n)`: expect the method to be called exactly `n` times.
- `AtLeast(n)`: expect at least `n` calls.
- `AtMost(n)`: expect at most `n` calls.
- `Between(m, n)`: expect between `m` and `n` calls, inclusive.
- `AnyNumber()`: called any number of times (including zero).

### Basic Usage Example
```cpp
using ::testing::AtLeast;
using ::testing::Exactly;
using ::testing::Return;

// Expect DoSomething() to be called exactly 3 times.
EXPECT_CALL(mockObj, DoSomething())
    .Times(Exactly(3))
    .WillRepeatedly(Return(true));

// Expect DoOther() to be called at least twice.
EXPECT_CALL(mockObj, DoOther())
    .Times(AtLeast(2));
```

### Cardinality Behavior
- If `Times()` is not specified:
  - If no actions specified (`WillOnce`/`WillRepeatedly`), `Times(1)` is inferred.
  - If *n* `WillOnce` actions specified and no `WillRepeatedly`, cardinality is `Times(n)`.
  - If there is a `WillRepeatedly` in addition to *n* `WillOnce`, cardinality is `Times(AtLeast(n))`.

### Handling Over- and Under-Calls
- Calls beyond the upper bound cause a test failure and produce informative diagnostics.
- Calls below lower bound at test end also generate failures.
- Use `.RetiresOnSaturation()` to have expectations retire (become inactive) once saturated, reducing failures caused by call order or repetition.

<Tip>
When using `.RetiresOnSaturation()`, expectations no longer match calls after hitting their upper call count, making them "sticky" only as long as needed. This is valuable when defining sequences or multiple calls returning different actions.
</Tip>

---

## 3. Mock Strictness: Naggy, Nice, and Strict Mocks

Mock strictness controls how GoogleMock reacts to calls of mock methods that do not match any expectation (unexpected calls) or are uninteresting (calls with no expectations).

### Uninteresting Calls
An _uninteresting call_ is when a mock method without any expectations (`EXPECT_CALL`) is called. These calls by default trigger a warning but do not fail the test.

### Unexpected Calls
An _unexpected call_ is when a mock method has at least one expectation but none match the particular call. This is always an error and fails the test.

### Types of Mocks
- **NaggyMock**: Default mock behavior. Prints warnings on uninteresting calls.
- **NiceMock**: Suppresses warnings on uninteresting calls, treating them as ignored.
- **StrictMock**: Treats uninteresting calls as errors, failing the test.

### Usage Examples
```cpp
using ::testing::NaggyMock;
using ::testing::NiceMock;
using ::testing::StrictMock;

class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
};

// NaggyMock: warnings on calls without EXPECT_CALL
NaggyMock<MockFoo> naggy_foo;
EXPECT_CALL(naggy_foo, DoThis());
naggy_foo.DoThis();
naggy_foo.DoSomethingElse();  // Warning, but not failure

// NiceMock: no warnings on calls without EXPECT_CALL
NiceMock<MockFoo> nice_foo;
EXPECT_CALL(nice_foo, DoThis());
nice_foo.DoThis();
nice_foo.DoSomethingElse();  // Silently ignored

// StrictMock: fails on calls without EXPECT_CALL
StrictMock<MockFoo> strict_foo;
EXPECT_CALL(strict_foo, DoThis());
strict_foo.DoThis();
strict_foo.DoSomethingElse();  // Test failure
```

<Tip>
Always prefer `NiceMock` for most unit tests to reduce noise from irrelevant calls. Use `StrictMock` sparingly when you want tight control over all interactions.
</Tip>

### Important Notes
- Strictness applies only to _uninteresting calls_. Unexpected calls always fail regardless of strictness.
- `NiceMock` and `StrictMock` only affect methods defined directly in the mock class with `MOCK_METHOD`. They may not affect inherited mock methods.
- Mixing or nesting `NiceMock` and `StrictMock` (e.g., `NiceMock<StrictMock<MockFoo>>`) is not supported.

---

## 4. Practical Guidelines and Best Practices

### Using `ON_CALL` vs. `EXPECT_CALL`
- Use `ON_CALL` to specify default behavior **without** imposing expectations.
- Use `EXPECT_CALL` when you want to verify the call is made.
- Avoid using `EXPECT_CALL(...).Times(AnyNumber())` just to suppress warnings; prefer using `NiceMock` instead.

### Specifying Call Counts Carefully
- Start with broad cardinalities like `AnyNumber()` or `AtLeast(0)` to avoid brittle tests.
- Restrict cardinalities when verifying precise call counts matter.
- Use `.RetiresOnSaturation()` to simplify scenarios with repeated calls that produce different outcomes.

### Handling Multiple Expectations on the Same Mock Method
- More specific expectations should appear **after** general ones.
- GoogleMock matches the *last* matching expectation.
- Use sequences (`InSequence`) or partial orders (`After()`) to enforce call ordering when critical.

### Avoiding Common Pitfalls
- Don't add `EXPECT_CALL` for methods you don't care about just to silence warnings.
- Ensure `Times()` clauses and number of `WillOnce()` calls align.
- Beware that default call counts inferred by GoogleMock may surprise you if you do not specify `Times()` explicitly.

### Debugging Tips
- Use flag `--gmock_verbose=info` to get detailed logs on matching expectations and calls.
- When warnings about action count appear, double-check your `WillOnce()` and `Times()` alignment.
- Use `Mock::VerifyAndClearExpectations(&mock_obj)` to manually verify and reset expectations early if needed.

---

## 5. Troubleshooting Common Issues

### Unexpected Calls Fail the Test
- This means a call was made that did not match any specified `EXPECT_CALL`.
- Verify your expectations include all valid calls, or use catch-all expectations, e.g., `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`

### Uninteresting Calls Generate No Failure but Print Warnings
- Consider using `NiceMock` if ignoring uninteresting calls is intentional.
- Alternatively, explicitly add expectations with `.Times(AnyNumber())` for methods called uninterestingly.

### Too Many or Too Few `WillOnce()` Actions
- GoogleMock warns if you have more `WillOnce()` than the specified cardinality or fewer when no `WillRepeatedly()` is defined.
- Align your action count with expected calls, or add `WillRepeatedly()` for fallback behavior.

### Calls Going Over the Expected Count
- Check if your cardinality incorrectly set too low.
- Add `.RetiresOnSaturation()` if you want expectations to become inactive after being satisfied.

### Mixing Mock Strictness Does Not Work as Expected
- Confirm mock methods are defined directly in the class.
- Avoid nesting or mixing different strictness wrappers.
- Ensure mock class destructors are virtual for `NiceMock` and `StrictMock` to work correctly.

<Tip>
When in doubt about failing expectations or unexpected calls, incrementally add `EXPECT_CALL(...).Times(AnyNumber())` as catch-all expectations for debugging. Remove when understanding is achieved.
</Tip>

---

## 6. Next Steps & Related Documentation

- **Learn More About Cardinalities:** See the [gMock Cardinalities Test](https://github.com/google/googletest/blob/main/googlemock/test/gmock-cardinalities_test.cc) for examples.
- **Dive Deeper Into Mock Strictness:** Read the [gMock Cookbook section on Nice, Strict, and Naggy Mocks](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy) for detailed behavior.
- **Explore Full Mocking API Reference:** Consult the [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) for other mocking features and fine-tuning.
- **See Matchers and Actions:** Use the [Matchers and Actions Guide](https://google.github.io/googletest/guides/mocking-advanced/matchers-and-actions.html) to combine call counts with argument matching and return value customization.

---

## Appendix: Summary of Cardinality Functions

| Function       | Meaning                                     | Example                    |
|----------------|---------------------------------------------|----------------------------|
| `Exactly(n)`   | Called exactly `n` times                     | `.Times(Exactly(3))`         |
| `AtLeast(n)`   | Called at least `n` times                    | `.Times(AtLeast(2))`         |
| `AtMost(n)`    | Called at most `n` times                     | `.Times(AtMost(5))`          |
| `Between(m,n)` | Called between `m` and `n` times inclusive  | `.Times(Between(1,3))`       |
| `AnyNumber()`  | Called any number of times (including zero) | `.Times(AnyNumber())`        |

---

## Appendix: Example Code Snippet
```cpp
#include <gmock/gmock.h>

class MockWorker {
 public:
  MOCK_METHOD(bool, Process, (int task_id), ());
};

TEST(WorkerTest, CallCountsAndStrictness) {
  using ::testing::AtLeast;
  using ::testing::Exactly;
  using ::testing::NiceMock;
  using ::testing::StrictMock;

  NiceMock<MockWorker> nice_worker;
  EXPECT_CALL(nice_worker, Process).Times(AtLeast(1));
  nice_worker.Process(42);          // No warning even if called with odd args
  nice_worker.Process(99);

  StrictMock<MockWorker> strict_worker;
  EXPECT_CALL(strict_worker, Process(1)).Times(Exactly(1));
  strict_worker.Process(1);         // OK
  // strict_worker.Process(2);      // Fails: unexpected call
}
```

---