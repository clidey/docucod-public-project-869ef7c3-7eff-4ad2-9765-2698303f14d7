---
title: "Introduction to Mocking"
description: "A foundational guide to using GoogleMock: how to create mock classes, use MOCK_METHOD macros, set simple expectations, and verify interaction between objects. Ideal for users new to mocking."
---

# Introduction to Mocking

A foundational guide to using **GoogleMock** for creating mock classes, leveraging the `MOCK_METHOD` macros, setting straightforward expectations with `EXPECT_CALL`, and verifying interaction between objects. This guide is designed for users new to mocking and aims to build your confidence in writing and using mocks effectively in C++ tests.

---

## 1. Why Mocking?

Imagine you are developing a component that depends on other complex subsystems or external resources — like databases, network services, or hardware. Testing this component in isolation becomes hard because you either don't want to trigger real resource usage or want precise control over collaborators' behavior.

**Mock objects** solve this by simulating these dependencies and allowing you to define exactly how they behave and how they should be interacted with.

Using GoogleMock facilitates:

- Precise control over method calls, arguments, return values, and call order.
- Detection of incorrect interactions early during testing.
- Simplification of testing by replacing complex collaborators with simple, programmable objects.

---

## 2. Workflow Overview

### Task Description
Learn how to create mock classes in GoogleMock, use `MOCK_METHOD` macros to define mock behaviors, set simple expectations with `EXPECT_CALL`, and confirm mocked interactions.

### Prerequisites
- Familiarity with C++ syntax and concepts like virtual functions.
- GoogleMock installed and configured in your project.
- Basic understanding of writing tests using GoogleTest.

### Expected Outcome
By following this guide, you will be able to:
- Define mock classes supporting virtual interfaces.
- Use `MOCK_METHOD` correctly.
- Set expectations on mock objects for calls and behaviors.
- Run tests that verify if the expected calls have happened.

### Time Estimate
Approximately 20-30 minutes to grasp the basics and run initial example tests.

### Difficulty Level
Beginner

---

## 3. Step-by-Step Instructions

### Step 1: Define a Mock Class

Mocks are classes that simulate interfaces or base classes by providing mocked versions of virtual methods.

Example based on a hypothetical `Turtle` interface:

```cpp
#include <gmock/gmock.h>  // Include GoogleMock header

class Turtle {
 public:
  virtual ~Turtle() {}  // Always virtual destructor for base interfaces
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual void Turn(int degrees) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(void, Turn, (int degrees), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Key points:**
- Use `MOCK_METHOD(return_type, method_name, (args...), (qualifiers))`.
- Put all `MOCK_METHOD`s in the `public` section, even if the base method is `protected` or `private`.
- Use `(override)` for overridden virtual methods.
- For `const` methods, include `(const, override)`.


### Step 2: Handle Complex Types with Commas

If your function arguments or return types contain commas (like `std::pair<bool, int>`), you must:

- Wrap the type in parentheses, or
- Use a `using` alias to simplify the type

Example:

```cpp
class MockFoo {
 public:
  // Wrong: will fail to compile
  MOCK_METHOD(std::pair<bool, int>, GetPair, ());
  MOCK_METHOD(bool, CheckMap, (std::map<int, double>, bool));

  // Correct: wrap types with parentheses
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());
  MOCK_METHOD(bool, CheckMap, ((std::map<int, double>), bool));

  // Or use type aliases
  using BoolAndInt = std::pair<bool, int>;
  using MapIntDouble = std::map<int, double>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
  MOCK_METHOD(bool, CheckMap, (MapIntDouble, bool));
};
```

### Step 3: Create Mock Objects

Instantiate your mock class like any other: 

```cpp
MockTurtle mock_turtle;
```

Use it as a substitute for the real interface in your test.

### Step 4: Set Expectations with `EXPECT_CALL`

Specify expected method calls, argument constraints, and behaviors.

Basic example:

```cpp
using ::testing::_;          // matcher for any argument
using ::testing::AtLeast;   // cardinality matcher
using ::testing::Return;    // action

// Expect PenDown() to be called at least once
EXPECT_CALL(mock_turtle, PenDown())
    .Times(AtLeast(1));

// Expect Forward() with distance > 0 to be called once and do nothing
EXPECT_CALL(mock_turtle, Forward(testing::Gt(0)))
    .Times(1);
```

### Step 5: Specify Return Values or Actions

For methods returning values, define what should be returned.

Example:

```cpp
EXPECT_CALL(mock_turtle, GetX())
    .WillOnce(Return(100))
    .WillRepeatedly(Return(50));
```

This means:
- First call to `GetX()` returns 100.
- Subsequent calls return 50.

### Step 6: Use Mock Object in Tests

Exercise the system under test by passing the mock object where the real one is expected.

Example:

```cpp
// Assuming Painter uses a Turtle interface
Painter painter(&mock_turtle);
painter.DrawCircle(0, 0, 10);
```

### Step 7: Verify Interactions

By default, GoogleMock will verify that all expectations are met when the mock object is destroyed. You can also force verification explicitly:

```cpp
using ::testing::Mock;

Mock::VerifyAndClearExpectations(&mock_turtle);
```

---

## 4. Practical Tips & Common Pitfalls

<Tip>
Always define a **virtual destructor** in your base class/interface. Without it, deleting a mock object through a base pointer can cause undefined behavior and memory leaks.
</Tip>

<Tip>
Put all `MOCK_METHOD` declarations in the **public** section of your mock class, even if the base method is protected or private.
</Tip>

<Tip>
Use `using ::testing::_;` to enable the wildcard matcher `_` which matches any argument.
</Tip>

<Tip>
To mock **const** methods, add `(const)` in the fourth parameter of `MOCK_METHOD`, e.g., `(const, override)`.
</Tip>

<Warning>
If your method arguments or return types contain commas (e.g., template types like `std::map<int, double>`), wrap the type in parentheses or use type aliases; otherwise, `MOCK_METHOD` will fail to parse.
</Warning>

<Tip>
`EXPECT_CALL` statements must be made **before** exercising the mock object. Setting expectations after calls has undefined behavior.
</Tip>

<Tip>
Use `NiceMock<YourMock>` to suppress warnings about uninteresting calls when you don't want to set expectations for every method.
</Tip>

<Tip>
If your mock method shouldn’t be called, explicitly forbid calls using `.Times(0)`. For example:

```cpp
EXPECT_CALL(mock_turtle, GoTo(_, _)).Times(0);
```
</Tip>

---

## 5. Example: Mocking a Simple Interface

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

// Interface
class Printer {
 public:
  virtual ~Printer() {}
  virtual void Print(int n) = 0;
};

// Mock class
class MockPrinter : public Printer {
 public:
  MOCK_METHOD(void, Print, (int n), (override));
};

// Test Example
TEST(MockTest, PrintIsCalled)
{
  MockPrinter mock_printer;

  // Expect Print method to be called exactly once with any integer
  EXPECT_CALL(mock_printer, Print(testing::_)).Times(1);

  // Call the mock method
  mock_printer.Print(5);
}
```

Run this test to confirm your mocking setup works correctly.

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Common Problems and Solutions">
<Accordion title="Compilation errors with MOCK_METHOD macro">
  Commas in complex types cause parse errors. Wrap argument types containing commas in extra parentheses or use type aliases to fix.
</Accordion>
<Accordion title="Mock method is not called as expected">
  Ensure `EXPECT_CALL` appears before exercising the mock.
  Check that argument matchers correctly specify the expected arguments, or use `_` to match anything.
  Review call order if sequences (`InSequence`) are used.
</Accordion>
<Accordion title="Uninteresting calls warning">
  Indicates a mock method was called without an `EXPECT_CALL`. Use `NiceMock` to suppress or add `EXPECT_CALL(...).Times(AnyNumber())` to allow.
</Accordion>
<Accordion title="Destructor not virtual">
  Virtual destructor missing in base interface causes leaks or undefined behavior. Add a virtual destructor to base classes.
</Accordion>
</AccordionGroup>

---

## 7. Next Steps and Further Reading

- [Specifying Expectations and Behaviors](../mocking-real-world/expectations-behaviors) — Delve deeper into customizing mock call behavior.
- [Advanced Mocking Techniques](../mocking-real-world/advanced-mocking-patterns) — Explore complex mocking patterns, sequences, and partial orderings.
- [GoogleMock Cookbook](../gmock_cook_book.md) — Practical recipes for common and advanced use cases.
- [Matchers Reference](../reference/matchers.md) — Learn about argument matchers for precise expectation matching.
- [Actions Reference](../reference/actions.md) — Understand how to customize mocked method actions.

---