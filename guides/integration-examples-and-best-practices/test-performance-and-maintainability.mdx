---
title: "Test Performance and Maintainability"
description: "Explore practical advice for writing fast, reliable, and maintainable tests. This guide addresses test isolation, minimizing flakiness, optimizing test suite runtime, and maintaining code clarity over the lifetime of your project."
---

# Test Performance and Maintainability

## Workflow Overview

### Task Description
This guide helps you write tests in GoogleTest that are fast, reliable, and easy to maintain over time. It focuses on optimizing test suite runtime, ensuring test isolation, minimizing flakiness, and keeping test code clean and clear.

### Prerequisites
- GoogleTest installed and integrated in your C++ project.
- Basic familiarity with writing tests and assertions in GoogleTest.
- Understanding of test fixtures and test suites.

### Expected Outcome
By following this guide, you will:
- Understand how to isolate tests to avoid inter-test dependencies.
- Learn techniques to reduce test flakiness.
- Optimize your test execution time without sacrificing coverage.
- Maintain clarity and readability in your test code.

### Time Estimate
30 to 45 minutes to read and apply the recommended practices.

### Difficulty Level
Intermediate to Advanced

---

## Step-by-Step Instructions

### 1. Design Tests with Proper Isolation
- **Action:** Use test fixtures to set up and tear down test state explicitly.
- **Explanation:** GoogleTest creates a *new* fixture instance for each test, ensuring independence.
- **Best Practice:** Avoid sharing mutable global state between tests to prevent hidden dependencies.
- **Verification:** Confirm each test passes independently when run alone.

### 2. Avoid Overly Tight Coupling Between Tests
- **Action:** Do not rely on ordering or side effects of tests.
- **Tip:** Make sure tests do not depend on the outcome or side effects of others.
- **Common Pitfall:** Tests that pass only when run in a certain order.

### 3. Use `SCOPED_TRACE` for Tracing Failures in Helpers
- **Action:** Wrap complex or shared test helper code with `SCOPED_TRACE("context")`.
- **Outcome:** When an assertion fails inside helpers, you’ll see the call context, easing debugging.

### 4. Minimize Test Flakiness
- **Action:** Identify and remove randomness, asynchronous waits, or shared resource conflicts in tests.
- **Technique:** Use synchronized mocks or notifications to wait for async operations deterministically.
- **Verification:** Run tests repeatedly with `--gtest_repeat=<count>` to ensure reliability.

### 5. Optimize Test Suite Execution Time
- **Action:** 
  - Run only necessary tests during development using `--gtest_filter`.
  - Cache expensive setup in `SetUpTestSuite()` and avoid redundant initialization.
  - Use `InSequence` and `RetiresOnSaturation()` to express order where relevant and avoid hanging expectations.
- **Bad Practice to Avoid:** Overusing expensive system calls or I/O in each test.

### 6. Write Clear and Maintainable Test Code
- **Action:**
  - Name your tests and test suites clearly and consistently.
  - Avoid underscores (`_`) in test suite and test names to prevent name collisions.
  - Use comments and clustering logically related tests for readability.
  - Use helper functions and custom matchers to reduce repetitive code.

### 7. Leverage Advanced Assertions and Matchers for Expressiveness
- **Action:** Use GoogleMock’s matchers (`EXPECT_THAT`, predicate assertions) to produce precise and readable failure messages.
- **Benefit:** Easier to diagnose test failures and maintain tests as your code evolves.

---

## Practical Examples

### Example 1: Using Test Fixture for Isolation

```cpp
class StackTest : public ::testing::Test {
 protected:
  void SetUp() override {
    stack_.Clear();
  }

  Stack stack_;
};

TEST_F(StackTest, StartsEmpty) {
  EXPECT_TRUE(stack_.IsEmpty());
}

TEST_F(StackTest, CanPushAndPop) {
  stack_.Push(42);
  EXPECT_EQ(stack_.Top(), 42);
  stack_.Pop();
  EXPECT_TRUE(stack_.IsEmpty());
}
```

### Example 2: Preventing Flakiness in Async Code

```cpp
// Using a notification to wait on async events deterministically.

class AsyncHandler {
  ...
  MOCK_METHOD(void, OnComplete, (int result));
};

TEST(AsyncTest, HandlesCompletion) {
  AsyncHandler handler;
  absl::Notification completed;

  EXPECT_CALL(handler, OnComplete(0))
      .WillOnce([&completed] {
        completed.Notify();
      });

  StartAsyncOperation(&handler);
  completed.WaitForNotification();
}
```

### Example 3: Expressing Call Order and Retiring Expectations

```cpp
using ::testing::InSequence;
using ::testing::Return;

TEST(FooTest, OrderedCalls) {
  MockFoo foo;
  InSequence seq;

  EXPECT_CALL(foo, Prepare()).RetiresOnSaturation();
  EXPECT_CALL(foo, Execute()).RetiresOnSaturation();
  EXPECT_CALL(foo, Cleanup()).RetiresOnSaturation();

  foo.Prepare();
  foo.Execute();
  foo.Cleanup();
}
```

---

## Troubleshooting & Tips

### Common Issues

- **Tests Sharing State:** If failing tests depend on previous tests, review fixture setup and teardown.
- **Flaky Tests with Async:** Ensure all asynchronous operations are completed deterministically before assertions.
- **Slow Tests:** Use profiling or `--gtest_brief=1` and `--gtest_shuffle` to identify costly or order-dependent tests.

### Best Practices

- Avoid side effects spanning multiple tests; use mocks and stubs to simulate dependencies.
- Prefer `EXPECT_*` over `ASSERT_*` to continue tests for broader coverage unless early abortion is required.
- Test naming: Avoid underscores `_` in test suite and test names to prevent clashes (e.g., use `MyTestSuite` rather than `My_Test_Suite`).

### Performance Considerations

- Use `SetUpTestSuite()` and `TearDownTestSuite()` for expensive shared initializations.
- When possible, mock external resources rather than accessing real databases or files.
- Leverage filtering and repetitions to focus on critical tests during development.

### Alternative Approaches

- Use value-parameterized tests (`TEST_P`) to avoid repetitive test code.
- Use typed tests (`TYPED_TEST`) to validate multiple implementations with the same logic.

---

## Next Steps & Related Content

### What's Next
- Explore the [Writing Effective Assertions](guides/core-testing-workflows/writing-effective-assertions) guide to improve your test correctness checks.
- Learn about [Mocking with GoogleMock](guides/mocking-and-advanced-usage/mocking-with-gmock) to enhance your test isolation.

### Related Guides
- [Organizing and Running Test Suites](guides/core-testing-workflows/organizing-and-running-test-suites) for effective test organization.
- [Parameterized and Type-Parameterized Tests](guides/mocking-and-advanced-usage/parameterized-and-type-parameterized-tests) for scalable and reusable tests.

### Resources
- The official [GoogleTest Primer](overview/introduction-core-value/what-is-googletest).
- [Assertions Reference](reference/assertions.md) for in-depth coverage of assertion macros.
- [Mocking Reference](reference/mocking.md) and [gMock Cookbook](docs/gmock_cook_book.md) for advanced mocking.

---

<Accordion title="Quick Tips for Test Performance and Maintenance">

- Name tests clearly and avoid underscores to prevent internal clashes.
- Use fixtures and `SetUpTestSuite()`/`TearDownTestSuite()` to manage shared resources.
- Eliminate randomness and asynchronous uncertainty for reliable tests.
- Favor expressive assertions with rich failure messages using matchers.
- Use sequences and call retirement to enforce call order without brittle tests.
- Run tests in isolation to detect flaky or order-dependent behavior early.

</Accordion>