---
title: "Using Matchers for Argument Verification"
description: "Explains the rich set of built-in matchers for specifying expectations on arguments in mocks, and guides users to create and use custom matchers for precise test intent."
---

# Using Matchers for Argument Verification

This guide explains how to effectively use GoogleMock's rich set of built-in matchers to specify expectations on mock function arguments. It also guides you through creating and using custom matchers to precisely express your test intent, ensuring your mock objects validate interactions exactly as your tests require.

---

## Workflow Overview

### Task Description
This page helps you master the use of argument matchers in GoogleMock, enabling you to write expressive, robust expectations on the arguments passed to mock methods. Matchers allow you to define predicates that specify not only exact values but also flexible constraints like ranges, subsets, or complex conditions.

### Prerequisites
- You should have a basic understanding of GoogleMock, including mock classes, mock methods, and setting expectations with `EXPECT_CALL`.
- Familiarity with GoogleTest assertions and general C++ testing practices.
- Your test suite must include `#include <gmock/gmock.h>` and use the `testing` namespace or qualified names.

### Expected Outcome
By following this guide, you will be able to:
- Use predefined matchers to set clear and concise argument expectations.
- Combine and compose matchers to express complex argument constraints.
- Define custom matchers tailored to your specific data structures or logic.
- Debug matcher failures with informative messages.
- Avoid common pitfalls in matcher usage for more maintainable tests.

### Time Estimate
Approximately 20-30 minutes for an intermediate user to read and experiment with examples.

### Difficulty Level
Intermediate

---

## Getting Started with Argument Matchers

### What are Matchers?
Matchers are predicate objects used inside `EXPECT_CALL` or `ON_CALL` macros to specify constraints on the arguments that mock methods are called with. Instead of checking for simple value equality, matchers let you express conditions like "greater than", "starts with", "points to a non-null object", or any custom property, enabling expressive and readable tests.

### Built-in Matchers
GoogleMock ships with a comprehensive list of built-in matchers, including but not limited to:

- **Wildcard matcher:** `_` matches any argument.
- **Comparison matchers:** `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- **Container matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `Contains()`, `Each()`, `SizeIs()`
- **String matchers:** `StartsWith()`, `EndsWith()`, `HasSubstr()`, `StrEq()`, `StrCaseEq()`
- **Pointer matchers:** `IsNull()`, `NotNull()`, `Pointee()`
- **Logical combinators:** `AllOf()`, `AnyOf()`, `Not()`
- **Tuple and pair matchers:** `Pair()`, `Key()`, `Property()`, `Field()`
- **Floating-point approximations:** `FloatEq()`, `DoubleEq()`, `NanSensitiveFloatEq()`, `NanSensitiveDoubleEq()`
- **Predicate matchers:** `Truly()` accepts custom unary predicate functions.

### Simple Usage Example
```cpp
using ::testing::_;
using ::testing::Ge;

// Expects method Forward to be called with an integer argument >= 100.
EXPECT_CALL(turtle, Forward(Ge(100)));

// Matches any call to GoTo() with x = 50, and any y.
EXPECT_CALL(turtle, GoTo(50, _));
```

### Omitting Arguments
If you don't care about the arguments at all, and the method is not overloaded, you can omit the argument list to match any:
```cpp
EXPECT_CALL(turtle, Forward);  // Matches Forward with any args
```

---

## Step-by-Step Instructions

### Step 1: Import Matchers
Make sure you import the necessary matcher symbols once per test file for readability:
```cpp
using ::testing::_;
using ::testing::Eq;
using ::testing::StartsWith;
using ::testing::Return;
```

### Step 2: Specify Matchers in EXPECT_CALL
Inside `EXPECT_CALL`, use matchers for each argument to specify what the mock method should expect:
```cpp
EXPECT_CALL(mock_object, MethodName(Eq(5), StartsWith("prefix"), _));
```
This expects the first argument to be equal to 5, the second to be a string starting with "prefix", and the third to match anything.

### Step 3: Use Logical Combinators to Combine Conditions
You can build complex matchers using `AllOf()`, `AnyOf()`, and `Not()`:
```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(10), Ne(15))));  // Argument >= 10 and not 15
EXPECT_CALL(mock, Bar(AnyOf(Eq("a"), Eq("b"), Eq("c"))));
EXPECT_CALL(mock, Baz(Not(Eq(nullptr))));  // Argument not null
```

### Step 4: Match Containers with ElementsAre and UnorderedElementsAre
For container arguments, check contents precisely or partially:
```cpp
EXPECT_CALL(mock, ProcessData(ElementsAre(1, Ge(5), _)));
EXPECT_CALL(mock, ProcessData(UnorderedElementsAre(Ge(0), 2, 5)));
```

### Step 5: Use Field and Property to Match Object Members
To verify member variables or getters without matching the whole object:
```cpp
EXPECT_CALL(mock, HandleFoo(Field(&Foo::id, Eq(42))));
EXPECT_CALL(mock, HandleFoo(Property(&Foo::Name, StartsWith("John"))));
```

### Step 6: Define and Use Custom Matchers
If built-in matchers don't meet your needs, define custom matchers:
```cpp
MATCHER(IsDivisibleBy7, "is divisible by 7") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock, Foo(IsDivisibleBy7()));
```

Or define parameterized matchers:
```cpp
MATCHER_P(HasAbsoluteValue, value, "has absolute value") {
  return abs(arg) == value;
}

EXPECT_CALL(mock, Bar(HasAbsoluteValue(10)));
```

### Step 7: Combine Matchers with With()
To apply a matcher on all arguments as a tuple:
```cpp
EXPECT_CALL(mock, SetRange(_, _))
    .With(Lt());  // First argument less than second
```

### Step 8: Debug Matcher Failures
Failed expectations print detailed messages describing:
- Actual argument values
- Matcher descriptions and which matcher failed
- Explanation if available (e.g., remainder if divisibility check fails)

Use `--gmock_verbose=info` flag to get call tracing and detailed diagnostics.

---

## Examples & Code Samples

### Exact Value Match
```cpp
EXPECT_CALL(mock_turtle, Forward(100));  // Argument must be exactly 100
```

### Wildcard Match
```cpp
EXPECT_CALL(mock_turtle, GoTo(50, _));  // x must be 50, y can be anything
```

### Composite Matchers
```cpp
using ::testing::AllOf;
EXPECT_CALL(mock, Foo(AllOf(Ge(5), Le(10))));  // Argument between 5 and 10
```

### Container Match
```cpp
using ::testing::ElementsAre;
EXPECT_CALL(mock, ProcessList(ElementsAre(1, Ge(5), _)));  // First element=1, second >=5, third anything
```

### Pointer Check
```cpp
using ::testing::NotNull;
EXPECT_CALL(mock, ProcessPointer(NotNull()));  // Pointer argument must not be NULL
```

### Using Custom Matcher
```cpp
MATCHER(IsEven, "is even") { return (arg % 2) == 0; }
EXPECT_CALL(mock, Calculate(IsEven()));
```

### Matcher with Parameter
```cpp
MATCHER_P(IsMultipleOf, factor, "is multiple of factor") {
  return arg % factor == 0;
}
EXPECT_CALL(mock, Calculate(IsMultipleOf(3)));
```

---

## Troubleshooting & Tips

### Common Issues

- **Matcher Fails Unexpectedly:** Ensure the matcher matches the argument type. Use `SafeMatcherCast` if needed.
- **Using `Return` with Move-only Types:** Define lambdas for `WillOnce` or `WillRepeatedly` to return fresh instances, as `Return` copies the value once.
- **Overloaded Methods Ambiguity:** Specify argument types or use `Const()` wrapper for const overloads to disambiguate overloads.
- **Uninteresting Call Warnings:** Use `NiceMock<T>` to suppress warnings or define default actions with `ON_CALL()`.
- **Upper-bound Violations on Duplicate Calls:** Use `.RetiresOnSaturation()` to make expectations inactive after saturation, preventing unwanted errors.
- **Complex Matchers With Side Effects:** Matchers must be side-effect free; do not call mock methods within matcher predicates.

### Best Practices

- **Use Matchers to Express Intent, Not Implementation:** Focus on what argument value properties matter, not on replicating exact data structures.
- **Keep Matchers Pure:** Avoid any side-effecting code in matcher predicates.
- **Prefer `ON_CALL` for Default Behavior:** Use `ON_CALL` to specify default action, and reserve `EXPECT_CALL` for actual call count and argument verification.
- **Use Sequence and After for Call Order:** For ordered expectations, combine matchers with call order controls.
- **Break Down Complex Argument Checks:** Use `Field`, `Property`, and custom matchers to target only relevant parts of input arguments.

### Performance Considerations

- Caching complex matchers in variables avoids rebuilding them repeatedly.
- Prefer simple matchers and combine carefully to avoid compiler slowdowns.

### Alternative Approaches

- Use predicate functions wrapped in `Truly()` when a matcher is difficult to express with built-ins.
- Create specialized parameterized matchers for reusable logic.

---

## Next Steps & Related Content

### Whatâ€™s Next
- Explore [Defining Mock Classes](gmock_cook_book.md#CreatingMockClasses) to integrate matchers with mocks.
- Learn about [Mock Actions](reference/mocking.md#Actions) to control mock behavior.
- Master [Setting Expectations and Default Actions](guides/mocking-best-practices/setting-expectations) to combine matchers and call counts.

### Related Guides
- [gMock Cookbook](gmock_cook_book.md#UsingMatchers)
- [Matchers Reference](reference/matchers.md)
- [Mocking Reference](reference/mocking.md)

### Resources
- GoogleTest GitHub: [https://github.com/google/googletest](https://github.com/google/googletest)
- Official Matchers Guide: [https://google.github.io/googletest/gmock_cheat_sheet.html#matchers](https://google.github.io/googletest/gmock_cheat_sheet.html#matchers)
- Examples and tests in source: `googlemock/test/gmock-matchers_test.h`

---

For detailed usage patterns, examples, and best practices, refer to the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#UsingMatchers) and the comprehensive API reference for matchers and actions.

---

**Note:** Always set `EXPECT_CALL` expectations before running the code under test to ensure correct verification of argument matching and call counts.

---

### Quick Reference

| Matcher       | Description                               | Example Usage                         |
|---------------|-------------------------------------------|-------------------------------------|
| `_`           | Matches any argument                      | `Expect_Call(obj, Func(_));`         |
| `Eq(val)`     | Matches equality with `val`               | `Eq(42)`                            |
| `Ne(val)`     | Not equal to `val`                        | `Ne(nullptr)`                       |
| `Lt(val)`     | Less than `val`                          | `Lt(10)`                           |
| `Ge(val)`     | Greater or equal to `val`                 | `Ge(100)`                          |
| `StartsWith(s)`| String starts with `s`                    | `StartsWith("prefix")`            |
| `ElementsAre(...)` | Matches sequence exactly                | `ElementsAre(1, _, 3)`              |
| `Pointee(m)`  | Pointer's pointee matches `m`             | `Pointee(Ge(0))`                   |
| `Field(&Class::member, m)` | Member of object matches `m`      | `Field(&Foo::id, Eq(5))`            |
| `Truly(pred)` | Matches if predicate returns true         | `Truly([](int x){ return x % 2 == 0; })` |

---

### Contact and Contribution
For issues or feature requests about argument matchers, please check the GoogleTest GitHub repository issue tracker and contribute via pull requests under the [googletest](https://github.com/google/googletest) project.
