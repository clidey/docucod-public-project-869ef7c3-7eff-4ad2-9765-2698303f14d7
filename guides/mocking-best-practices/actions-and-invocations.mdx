---
title: "Configuring Mock Actions and Return Values"
description: "Guides users to use GoogleMock actions—such as returning specific values, invoking functions, and side-effecting calls—empowering realistic and dynamic mock behavior in testing."
---

# Configuring Mock Actions and Return Values

This guide empowers you to control the behavior of GoogleMock mock methods by configuring actions such as returning specific values, invoking functions, and side-effecting calls. Mastering these capabilities allows you to create dynamic, realistic mocks tailored precisely for your testing scenarios.

---

## 1. Overview

### What You'll Achieve
- Learn how to specify what mock methods should do when called, including:
  - Returning fixed or live values
  - Invoking custom functions or lambdas
  - Performing side effects like modifying output parameters
  - Combining multiple actions into sequences

### Prerequisites
- Have mock classes defined using `MOCK_METHOD`.
- Basic understanding of `EXPECT_CALL` and `ON_CALL` macros.
- A C++ project set up with GoogleMock.

### Outcome
After completing this guide, you'll be able to precisely configure mock method behaviors to simulate realistic conditions and verify complex interactions.

### Time Commitment
~15-30 minutes depending on familiarity with C++ lambdas and GoogleMock basics.

### Skill Level
Intermediate – assumes familiarity with GoogleMock basics and some C++ lambda proficiency.

---

## 2. Configuring Mock Method Behaviors

GoogleMock lets you define what a mock method does when invoked via **actions**. These are specified with `ON_CALL` for default behavior and `EXPECT_CALL` combined with `.WillOnce()` / `.WillRepeatedly()` for expected calls.

### 2.1 Returning Specific Values

#### Basic Return
```cpp
using ::testing::Return;

EXPECT_CALL(mock_obj, Method(args))
    .WillOnce(Return(value));
```
This returns a fixed `value` whenever the expectation matches.

#### Returning References
If your mock method returns a reference, use `ReturnRef`:
```cpp
using ::testing::ReturnRef;

Bar bar_instance;
EXPECT_CALL(mock_obj, GetBar())
    .WillOnce(ReturnRef(bar_instance));
```

#### Returning Live Values
To return the current value of a variable at call-time (not the value when the expectation was created), use `ReturnPointee`:
```cpp
using ::testing::ReturnPointee;

int counter = 0;
EXPECT_CALL(mock_obj, GetCount())
    .WillRepeatedly(ReturnPointee(&counter));

counter = 5;
// Now GetCount() returns 5.
```

### 2.2 Using Functions, Lambdas, and Functors as Actions

For more complex behavior beyond returning values, use callable objects:
```cpp
using ::testing::Invoke;

int Add(int x, int y) { return x + y; }

EXPECT_CALL(mock_obj, Sum(_, _))
    .WillOnce(Invoke(&Add));

EXPECT_CALL(mock_obj, Check(_))
    .WillRepeatedly([](int n) { return n > 0; });
```
Action callables must match the method signature or be safely convertible.

### 2.3 Combining Multiple Actions

Sometimes you want to perform multiple actions on a method call (e.g., modify an argument and return a value). Use `DoAll`:
```cpp
using ::testing::DoAll;
using ::testing::SetArgPointee;
using ::testing::Return;

EXPECT_CALL(mock_obj, Mutate(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(42), Return(true)));
```
Here, the second argument pointed to gets set to `42`, and then `true` is returned.

### 2.4 Mocking Side Effects on Output Arguments

Use built-in actions to set output parameters:
- `SetArgPointee<N>(value)` sets the value pointed to by the N-th argument
- `SetArrayArgument<N>(begin, end)` copies a range into an array argument

Example:
```cpp
EXPECT_CALL(mock_obj, UpdateValue(_))
    .WillOnce(SetArgPointee<0>(100));  // Sets *arg0 to 100
```

### 2.5 Invoking Function Arguments (Callbacks)

If the mocked method receives a callable (e.g., a callback), you can invoke it with `InvokeArgument`:
```cpp
using ::testing::InvokeArgument;

EXPECT_CALL(mock_obj, DoWork(_, _))
    .WillOnce(InvokeArgument<1>(5));  // Calls the 2nd argument as function with 5
```
If arguments are by reference, wrap with `std::ref()`.

### 2.6 Ignoring Action Results

If you have an action that returns a value but need it to behave as void (e.g., in `DoAll`), use `IgnoreResult`:
```cpp
EXPECT_CALL(mock_obj, Run(_))
    .WillOnce(IgnoreResult(Invoke(SomeFuncReturningInt)));
```

### 2.7 Selecting Specific Arguments for Actions

When an action only needs some arguments of a mock method, use `WithArgs`:
```cpp
EXPECT_CALL(mock_obj, Foo(_, _, _))
    .WillOnce(WithArgs<0, 2>(Invoke(MyFunc)));
```
This passes only the 1st and 3rd arguments of `Foo` to `MyFunc`.

### 2.8 Sharing Actions and Matchers

Actions and matchers can be assigned to variables and reused efficiently:
```cpp
auto action = Return(true);
EXPECT_CALL(mock_obj, IsReady()).WillOnce(action).WillRepeatedly(action);
```

---

## 3. Best Practices and Tips

- **Prefer `ON_CALL` for specifying default behavior** and reserve `EXPECT_CALL` for calls you want to verify explicitly.
- **Use `RetiresOnSaturation()`** when an expectation should be considered inactive once its call count is met.
- When returning move-only objects (e.g., `std::unique_ptr`), prefer lambdas over `Return(std::move(...))` to avoid errors.
- Use `NiceMock<T>` to suppress warnings on uninteresting calls when you expect some calls but don't want to verify all.
- Use `StrictMock<T>` to treat uninteresting calls as errors to enforce stricter test behavior.
- Combine multiple `WillOnce()` and a `WillRepeatedly()` clause to specify ordered sequences of return values and fallback behavior.

---

## 4. Common Pitfalls and Troubleshooting

### 4.1 Action Evaluation

Remember that actions are **evaluated once at definition time**, not at call time. If you want fresh evaluation per call, use lambdas or callable objects.

### 4.2 Overlapping Expectations

More specific expectations should come **after** more general ones to avoid being shadowed, as GoogleMock picks the last matching expectation.

### 4.3 Callback Reference Parameters

When invoking callback arguments that take parameters by reference, wrap arguments in `std::ref()` to pass the original reference.

### 4.4 Too Many or Too Few Actions

GoogleMock will warn if the number of `.WillOnce()` actions does not match the call count expected by `.Times()`. Use `.RetiresOnSaturation()` to help manage this.

---

## 5. Examples

### Return Different Values on Sequential Calls
```cpp
EXPECT_CALL(mock_obj, GetValue())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

### Set Output Argument and Return a Value
```cpp
EXPECT_CALL(mock_obj, Compute(_, _))
    .WillOnce(DoAll(SetArgPointee<1>(100), Return(true)));
```

### Invoke a Lambda Ignoring Method Arguments
```cpp
EXPECT_CALL(mock_obj, Process(_))
    .WillOnce([]() { DoSomeSetup(); });
```

### Delegate Default Behavior to a Fake Object
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Calculate, (int x), (override));

  void DelegateToFake() {
    ON_CALL(*this, Calculate)
        .WillByDefault([this](int x) { return fake_.Calculate(x); });
  }

 private:
  FakeFoo fake_;
};
```

---

## 6. Next Steps

- Read the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes.
- Explore the [Matchers Reference](reference/matchers.md) for argument constraints.
- Understand [Setting Expectations and Default Actions](guides/mocking-best-practices/setting-expectations) for better test coverage.
- Review [Test Fixtures and Test Organization](guides/core-testing-workflows/test-fixtures-best-practices) to integrate mocking into your tests efficiently.
- Consult the troubleshooting guide if you encounter warnings or unexpected mock behaviors.

---

## 7. References

- [MOCK_METHOD Macro](api-reference/core-mocking-apis/mock-methods)
- [ON_CALL and EXPECT_CALL macros](reference/mocking.md#ON_CALL)
- [Actions Reference](reference/actions.md)
- [gMock FAQ](docs/gmock_faq.md)

---

This guide focuses exclusively on mock **actions** and return value configuration within GoogleMock, detailing how to craft realistic and flexible mock behaviors for testing robustness and precision.