---
title: "Managing Mock Strictness"
description: "Explains the use of NiceMock, NaggyMock, and StrictMock wrappers to handle unexpected or uninteresting calls. Provides strategies for choosing the right strictness to reduce test brittleness."
---

# Managing Mock Strictness

This guide explains how to manage the strictness levels of mock objects in GoogleMock using the `NiceMock`, `NaggyMock`, and `StrictMock` wrappers. It offers practical advice on choosing the appropriate strictness to handle uninteresting or unexpected method calls while reducing test brittleness.

---

## Understanding Mock Strictness

When using GoogleMock, not all calls to mock methods need to be explicitly expected. However, uninteresting calls (calls to mock methods with no `EXPECT_CALL` specifications) are handled differently based on the mock's strictness level:

- **Nice Mocks**: Suppress any warnings or errors for uninteresting calls.
- **Naggy Mocks**: Print warnings on uninteresting calls (default behavior of raw mocks).
- **Strict Mocks**: Treat uninteresting calls as errors, causing test failures.

### Why Manage Strictness?

Managing mock strictness helps reduce noise when tests exercise methods you're not interested in. It enables you to:

- Focus only on interactions relevant to the test.
- Avoid brittle tests that fail due to harmless method calls.
- Enforce stricter behavior where unexpected calls indicate a real problem.

---

## Mock Strictness Wrappers: Classes and Usage

GoogleMock provides three primary templates to control mock strictness:

- `NiceMock<T>`: Allows uninteresting calls silently.
- `NaggyMock<T>`: Prints warnings for uninteresting calls.
- `StrictMock<T>`: Fails tests on uninteresting calls.

These wrappers inherit from the mock class `T` with constructors forwarded, so you can create them with the same arguments as `T`.

### Basic Usage Example

Given a mock class `MockFoo`:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // Ignores uninteresting calls.
NaggyMock<MockFoo> naggy_foo;    // Warns on uninteresting calls (default for MockFoo).
StrictMock<MockFoo> strict_foo;  // Errors on uninteresting calls.
```

### Using Non-default Constructors

You can forward constructor arguments when creating wrapped mocks:

```cpp
NiceMock<MockFoo> nice_foo(5, "arg");
StrictMock<MockFoo> strict_foo('a', 'b');
```

### Important Restrictions

- Only works properly for mock methods defined directly in `T` using `MOCK_METHOD` macros. Methods inherited from base classes may not respect strictness.
- Nesting wrappers like `NiceMock<StrictMock<MockFoo>>` is **not** supported.
- Your mock class should have a virtual destructor for consistent behavior.

---

## When to Use Each Wrapper

### NiceMock

- Recommended for most use cases where you want to ignore uninteresting calls.
- Keeps test output clean by suppressing spurious warnings.
- Helps maintain tests that are resilient to internal implementation changes.

### NaggyMock

- Default for raw mocks.
- Useful during test development or debugging to see stray calls.
- Can detect unintended method invocations but may lead to noisier tests.

### StrictMock

- Use when any uninteresting call should be treated as a test failure.
- Enforces strict verification of mock interactions.
- Ideal for ensuring no unexpected calls occur in highly critical tests.

**Tip:** Avoid using `StrictMock` unless necessary, as it may increase test brittleness.

---

## Practical Strategies for Managing Mock Strictness

1. **Start with `NiceMock` for better maintainability.**
   
   Use `NiceMock` in your tests when you mainly care about specific interactions but don't want test failures due to unrelated mock method calls.

2. **Switch to `NaggyMock` during test debugging.**

   Temporarily use `NaggyMock` while developing or debugging tests to spot unexpected uninteresting calls.

3. **Reserve `StrictMock` for enforcing critical call expectations.**

   Only escalate to `StrictMock` when you want to enforce that no uninteresting calls happen, catching subtle bugs.

4. **Use catch-all expectations when you want to accept some uninteresting calls explicitly.**

   For example, to accept any call to `GetDomainOwner` with any argument:

   ```cpp
   EXPECT_CALL(mock_registry, GetDomainOwner(_)).Times(AnyNumber());
   EXPECT_CALL(mock_registry, GetDomainOwner("google.com")).WillRepeatedly(Return("Larry Page"));
   ```

   This prevents unexpected calls from triggering errors or warnings.

---

## Step-by-Step: Creating a Nice, Naggy, or Strict Mock

<Steps>
<Step title="Define your basic mock class">
Start by creating a mock class inheriting from your interface and define mock methods with `MOCK_METHOD`.

Example:
```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
  MOCK_METHOD(int, DoThat, (bool flag), ());
};
```
</Step>
<Step title="Choose the strictness wrapper">
Decide how you want to handle uninteresting calls:
- To ignore and suppress warnings, use `NiceMock`.
- To warn on uninteresting calls (default), use `NaggyMock` or default `MockFoo`.
- To treat uninteresting calls as errors, use `StrictMock`.
</Step>
<Step title="Create an instance of the wrapped mock">
Wrap your mock class instance accordingly.

```cpp
NiceMock<MockFoo> nice_foo;
NaggyMock<MockFoo> naggy_foo;
StrictMock<MockFoo> strict_foo;
```

Pass constructor arguments if needed:
```cpp
NiceMock<MockFoo> nice_foo(42);
```
</Step>
<Step title="Set expectations and default actions">
Define expectations using `EXPECT_CALL` to specify desired method calls and behaviors.

If you want to allow calls without specific expectations, consider adding catch-all expectations.
</Step>
<Step title="Write and run your tests">
Exercise your code against the mock objects.

The mock's behavior will depend on its strictness wrapper:
- `NiceMock` suppresses warnings for uninteresting calls.
- `NaggyMock` warns on uninteresting calls.
- `StrictMock` fails on uninteresting calls.
</Step>
</Steps>

---

## Verification and Leak Handling

GoogleMock automatically verifies expectations when mocks are destructed. You may:

- Use `Mock::AllowLeak()` on a mock pointer to suppress leak warnings.
- Call `Mock::VerifyAndClearExpectations(&mock)` to verify expectations early if needed.

---

## Common Pitfalls & Troubleshooting

<AccordionGroup title="Handling Unexpected or Uninteresting Calls">
<Accordion title="Why Do I Get Warnings for Uninteresting Calls?">
This happens when a mock method is called but no `EXPECT_CALL` covers it. To suppress warnings:
- Use `NiceMock`.
- Add a catch-all expectation with `.Times(AnyNumber())`.
</Accordion>
<Accordion title="Uninteresting Calls Are Errors in StrictMock">
`StrictMock` treats all uninteresting calls as failures. Check your test to ensure all calls are expected or use `NiceMock` if warnings suffice.
</Accordion>
<Accordion title="Nesting NiceMock, NaggyMock, and StrictMock" >
Nesting wrappers, e.g., `NiceMock<StrictMock<MockFoo>>`, is **unsupported** and will cause unexpected behavior.
</Accordion>
</AccordionGroup>

<AccordionGroup title="Mock Method Not Affected by Strictness Wrapper">
<Accordion title="Mock Methods in Base Classes">
Strictness wrappers only apply to mock methods defined directly in the mock class. If methods are in a base class, strictness may not be applied.
</Accordion>
<Accordion title="Non-virtual Destructors Cause Issues">
If your mock class destructor is not virtual, strictness wrappers may behave incorrectly.
</Accordion>
</AccordionGroup>

---

## Best Practices

- Prefer using `NiceMock` in most tests for a clean test output and less brittleness.
- Use `NaggyMock` or default mocks while actively developing or debugging tests.
- Use `StrictMock` sparingly when strict call validation is essential.
- Add catch-all expectations when some calls aren’t interesting but should be accepted.
- Always set expectations before exercising the code under test.

---

## Additional Resources

- [GoogleMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — Quick syntax reference.
- [gMock Cookbook: The Nice, the Strict, and the Naggy](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy) — Detailed explanations and recipes.
- [Mocking Reference: NiceMock, NaggyMock, StrictMock](https://google.github.io/googletest/reference/mocking.html#NiceMock) — API reference on strictness wrappers.

---

## Summary

Choosing the right strictness level for your mocks simplifies tests, improves maintainability, and clarifies expectations. Use `NiceMock` to ignore uninteresting calls quietly, `NaggyMock` to get warnings during test development, and `StrictMock` to enforce strict call verification. Apply these wrappers thoughtfully based on the test’s stability and debugging needs.
