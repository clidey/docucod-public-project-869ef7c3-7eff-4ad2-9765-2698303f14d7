---
title: "Introduction to Mocking with GoogleMock"
description: "Learn the basics of writing mock classes and methods with GoogleMock, setting expectations and behaviors, and integrating them into your tests. This guide covers the core ON_CALL, EXPECT_CALL, and MOCK_METHOD patterns, illustrated with step-by-step examples."
---

# Introduction to Mocking with GoogleMock

## Workflow Overview

### What You Will Learn
This guide teaches you the essentials of creating and using mock classes with GoogleMock. You'll learn how to write mocked methods using the `MOCK_METHOD` macro, how to set up default behaviors with `ON_CALL`, and how to set and verify expectations using `EXPECT_CALL`. Core patterns such as defining mock classes, specifying method behaviors, and controlling test interactions are covered with clear, actionable examples.

### Prerequisites
- Familiarity with C++ and virtual functions.
- Basic understanding of GoogleTest, the underlying testing framework.
- GoogleTest and GoogleMock installed and configured in your environment (see the [Initial Configuration Guide](https://github.com/google/googletest/tree/main/docs/getting-started/setup-and-installation/initial-configuration)).
- A C++ project setup where you can compile and run GoogleMock based tests.

### Expected Outcome
By completing this guide, you will confidently write mock classes and methods, correctly set default and expected behaviors, and integrate the mocks into your test suites effectively.

### Time Estimate
Allow approximately 20-30 minutes to read and practice the examples.

### Difficulty Level
Beginner to Intermediate

---

## Step-by-Step Instructions

### 1. Writing Mock Classes with `MOCK_METHOD`
Create a mock class by inheriting from the interface or base class you want to mock. Use the `MOCK_METHOD` macro inside the public section of your mock class to declare mocked methods.

```cpp
#include <gmock/gmock.h>

class MockExample : public ExampleInterface {
 public:
  MOCK_METHOD(void, DoSomething, (int param), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
};
```

**Key points:**
- The first parameter is the return type.
- The second parameter is the method name.
- The third parameter is the argument list enclosed in parentheses.
- The fourth, optional parameter lists qualifiers in parentheses, e.g., `(const, override)`.
- Place `MOCK_METHOD` in `public:` regardless of base method access.

#### Dealing with Commas in Types
If your argument or return type includes commas (e.g., templates), wrap the type in an extra parentheses or use a type alias:

```cpp
// Using parentheses
MOCK_METHOD((std::pair<int, int>), GetPair, ());

// Using type alias
using IntPair = std::pair<int, int>;
MOCK_METHOD(IntPair, GetPair, ());
```

### 2. Setting Default Behaviors with `ON_CALL`
`ON_CALL` defines default behavior for mock methods without setting explicit call expectations. This is important for specifying what the mock method should do when invoked without failing your tests.

```cpp
using ::testing::Return;

MockExample mock_obj;

ON_CALL(mock_obj, GetValue())
    .WillByDefault(Return(42));
```

**Note:** `ON_CALL` does not expect the method to be called; it only defines the default action when it is called.

### 3. Setting Expectations with `EXPECT_CALL`
Use `EXPECT_CALL` to specify that you expect a method to be called with specific argument matchers, how many times, and what it should return or perform.

```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::Return;

EXPECT_CALL(mock_obj, DoSomething(_))
    .Times(2);
EXPECT_CALL(mock_obj, GetValue())
    .WillOnce(Return(100))
    .WillRepeatedly(Return(0));
```

Key modifiers (must be used in this order if combined):

- `.With(multi_arg_matcher)`: Restricts expectation to calls matching a multi-argument predicate.
- `.Times(cardinality)`: Specifies how many times the call is expected (`AnyNumber()`, `AtLeast(n)`, `Exactly(n)`, etc.).
- `.InSequence(...)`: Declares call order relative to defined sequences.
- `.After(...)`: Specifies that this call must happen after other expectations.
- `.WillOnce(action)`: Specifies an action to perform once.
- `.WillRepeatedly(action)`: Action for all subsequent calls after `WillOnce`s.
- `.RetiresOnSaturation()`: Causes expectation to deactivate after it is fulfilled.

### 4. Using Matchers in Calls
Matchers let you specify fine-grained argument validation. `_` matches any value. Common matchers include `Eq()`, `Ge()`, `NotNull()`, etc.

```cpp
EXPECT_CALL(mock_obj, DoSomething(Ge(5)));  // Argument must be >= 5
EXPECT_CALL(mock_obj, DoSomething(_));      // Any argument
```

### 5. Handling Uninteresting Calls
By default, an uninteresting call (a mock method called without any `EXPECT_CALL`) prints a warning but is allowed. To suppress warnings use `NiceMock` or to make such calls errors use `StrictMock`:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

NiceMock<MockExample> nice_mock; // suppresses uninteresting call warnings
StrictMock<MockExample> strict_mock; // treats uninteresting calls as failures
```

### 6. Verifying Mock Behavior
Mocks automatically verify expectations upon destruction. If you allocate mocks on the heap and have complicated ownership, force verification manually:

```cpp
using ::testing::Mock;

Mock::VerifyAndClearExpectations(&mock_obj);
```

---

## Examples & Code Samples

### Defining a Mock Class
```cpp
class Shape {
 public:
  virtual ~Shape() {}
  virtual double Area() const = 0;
  virtual void Draw(int color) = 0;
};

class MockShape : public Shape {
 public:
  MOCK_METHOD(double, Area, (), (const, override));
  MOCK_METHOD(void, Draw, (int color), (override));
};
```

### Setting Default Behavior
```cpp
MockShape mock_shape;
ON_CALL(mock_shape, Area())
    .WillByDefault(testing::Return(3.14));
```

### Setting Expectations
```cpp
EXPECT_CALL(mock_shape, Draw(testing::_))  // Accept any color
    .Times(testing::AtLeast(1));
EXPECT_CALL(mock_shape, Area())
    .WillOnce(testing::Return(1.0))
    .WillRepeatedly(testing::Return(5.0));
```

### Using Strict and Nice Mocks
```cpp
NiceMock<MockShape> nice_mock;
StrictMock<MockShape> strict_mock;
```

**Use `NiceMock` when you want to ignore uninteresting calls with no warnings.**

---

## Troubleshooting & Tips

### Common Issues
- **Compilation fails on `MOCK_METHOD` with template types:** Wrap the return or argument type in extra parentheses or use type aliases to avoid comma parsing issues.
- **Mock methods not called as expected:** Ensure `EXPECT_CALL` is set before exercising code. Use `--gmock_verbose=info` to trace mock calls.
- **Uninteresting call warnings:** Use `NiceMock` to suppress, or set an expectation using `EXPECT_CALL` if the call is expected.
- **Multiple `EXPECT_CALL`s on overloaded methods:** Specify arguments or use `using` declarations to disambiguate.

### Best Practices
- Use `ON_CALL` to set default behavior for mock methods you don't want to strictly verify.
- Use `EXPECT_CALL` only when you want to verify that a call occurs.
- Use `.RetiresOnSaturation()` for expectations that should only apply for their expected number of calls.
- When testing call order, use sequences with `InSequence` and `After` for readable and robust tests.
- Avoid over-specifying matchersâ€”generalize where possible to reduce test brittleness.

### Performance
- For large mocks, move constructor and destructor definitions out to source files to reduce compile times.

---

## Next Steps & Related Content

### What to Read Next
- [gMock Cookbook](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md) for advanced recipes.
- [Setting Up GoogleTest and GoogleMock](https://github.com/google/googletest/tree/main/docs/getting-started/setup-and-installation/initial-configuration) for integration details.
- [Writing Your First Test Case](https://github.com/google/googletest/tree/main/docs/getting-started/first-test-experience/writing-your-first-test) if new to GoogleTest.
- [Understanding Mocks in GoogleTest](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md) for conceptual depth.

### Related Guides
- [Designing Clean and Maintainable Mocks](https://github.com/google/googletest/tree/main/guides/mocking-best-practices/designing-better-mocks)
- [Advanced Mocking Scenarios and Custom Actions](https://github.com/google/googletest/tree/main/guides/mocking-best-practices/advanced-mocking)
- [Strictness Wrappers: NiceMock, NaggyMock, StrictMock](https://github.com/google/googletest/tree/main/api-reference/mocking-apis/strictness-wrappers.md)

### Support and Troubleshooting
- Consult the [Troubleshooting and Common Setup Issues](https://github.com/google/googletest/tree/main/docs/getting-started/first-test-experience/troubleshooting-and-validation) guide for errors in mocking.

---

<Info>
This guide focuses exclusively on the mocking aspects of GoogleMock: writing mock classes, setting behaviors with `ON_CALL`, and verifying with `EXPECT_CALL`.
For broader GoogleTest usage (e.g., running tests, assertions), see the Getting Started guides.
</Info>

