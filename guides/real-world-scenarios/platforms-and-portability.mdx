---
title: "Testing Across Platforms"
description: "Discover tips for writing portable tests and working with GoogleTest on different operating systems, compilers, and embedded environments. Learn to handle platform-specific failures and leverage cross-platform stubs."
---

# Testing Across Platforms

GoogleTest enables you to write portable C++ tests that run reliably across multiple operating systems, compilers, and embedded environments. This page guides you through practical tips for ensuring your tests behave consistently, handling platform-specific quirks and failures gracefully, and leveraging cross-platform stubs to isolate tests.

---

## 1. Overview: Why Cross-Platform Testing Matters

GoogleTest is designed to support diverse environments including Linux, Windows, macOS, and embedded platforms like Android or QNX. However, differences in:

- Compiler capabilities,
- Operating system APIs,
- Standard library implementations,
- Threading and synchronization support,
- File system and environment behavior

can impact your tests’ portability.

Writing portable tests ensures your code remains robust as it runs on different platforms, enabling better maintenance, wider adoption, and easier troubleshooting.

<Check>
Test portability requires awareness of platform-specific features and limitations. GoogleTest simplifies this by automatically detecting environment properties and supporting feature flags.
</Check>

---

## 2. Platform-Dependent Behavior Detection

GoogleTest internally detects many platform-specific features through macros defined during compilation. This detection informs how tests execute or skip certain behaviors.

Examples of platform-related macros:

- `GTEST_OS_LINUX`, `GTEST_OS_WINDOWS`, `GTEST_OS_MAC`: Operating system detection.
- `GTEST_HAS_PTHREAD`: Whether pthread threading library is available.
- `GTEST_HAS_EXCEPTIONS`: Exception support availability.
- `GTEST_HAS_RTTI`: Runtime type information support.
- `GTEST_HAS_FILE_SYSTEM`: File system availability.
- `GTEST_HAS_STREAM_REDIRECTION`: Ability to redirect stdout/stderr.

These definitions are part of the internal portability utilities declared in files like `gtest-port-arch.h` and `gtest-port.h`.

---

## 3. Writing Portable Tests: Practical Guidelines

To maximize portability and reduce platform-dependent breakage, follow these actionable practices:

### Step 1: Avoid Platform-Specific APIs in Test Code

- Do not rely on operating system calls or APIs unavailable on all target platforms.
- Use GoogleTest assertions and interfaces, which abstract many low-level operations.

### Step 2: Use Feature Detection Macros for Conditional Compilation

- Use the platform and feature macros to selectively include or exclude test code paths.

```cpp
#if GTEST_OS_LINUX
  // Append Linux-specific tests or workarounds here.
#endif

#if GTEST_HAS_PTHREAD
  // Include POSIX threading tests.
#endif

#if GTEST_HAS_EXCEPTIONS
  // Test exception handling code.
#endif
```

This pattern prevents compilation or runtime failures from unsupported features.

### Step 3: Write Tests That Degrade Gracefully

- For platforms lacking features like filesystem or threading, design tests to skip or mark unsupported cases.
- Use the GoogleTest `GTEST_SKIP()` macro to skip tests dynamically when platform capabilities are insufficient.

### Step 4: Use Cross-platform Stubs and Mocks

- Where platform APIs are unavoidable, replace real implementations with cross-platform stubs or mocks.
- This approach isolates your tests from platform-dependent behavior.

### Step 5: Ensure Test Data Portability

- Use UTF-8 encoded text files and avoid platform-specific file paths.
- Normalize path separators using GoogleTest's portable path macros if applicable (`GTEST_PATH_SEP_`).

<Tip>
GoogleTest macros like `GTEST_PATH_SEP_` help you write path-independent code, e.g., `"dir" + GTEST_PATH_SEP_ + "file.txt"`.
</Tip>

---

## 4. Platform-Specific Failure Handling

Tests can fail due to differences in runtime behavior or environmental constraints.

### Common Failure Scenarios

- **Assertion failures due to floating-point precision differences:**
  Use GoogleTest’s floating-point equality assertions with tolerances (`EXPECT_NEAR`) to allow for platform-dependent floating-point behavior.

- **Threading and timing issues:**
  Platforms with limited threading or different scheduling can cause flaky tests. Use feature macros to disable such tests when necessary.

- **File system access errors:**
  Some embedded or sandboxed platforms may restrict file system access. Use conditional compilation or runtime checks to skip such tests.

- **Wide string and locale issues:**
  Certain platforms may not support `std::wstring` or unicode fully. Use `GTEST_HAS_STD_WSTRING` macro to detect this capability.

### Best Practice: Report Skipped Tests and Provide Diagnostics

- Use proper logging within tests to indicate when and why a test is skipped.
- Encourage test maintainers to document platform limitations clearly.

---

## 5. Leveraging GoogleTest Porting Utilities

GoogleTest includes utility macros and functions to smooth over platform disparities:

### Platform Macros

Defined in `gtest-port-arch.h`, these macros enable detection of:

- Operating systems (Windows, Linux, macOS, Android, etc.)
- Embedded hardware platforms (ESP32, NXP QN9090)

### Feature Availability Macros

Defined in `gtest-port.h`, check for:

- Exception support (`GTEST_HAS_EXCEPTIONS`)
- Threading support (`GTEST_HAS_PTHREAD`)
- File system availability (`GTEST_HAS_FILE_SYSTEM`)

Example usage:

```cpp
#include "gtest/internal/gtest-port.h"

#if GTEST_HAS_EXCEPTIONS
  TEST(ExceptionFeatureTest, CatchesExceptions) {
    // Test code with exceptions enabled
  }
#else
  GTEST_SKIP() << "Exceptions not supported on this platform.";
#endif
```

### Thread-safe Utilities

Where threading is available, GoogleTest provides synchronization primitives (`Mutex`, `MutexLock`) and thread-local storage abstractions to write thread-safe tests.

---

## 6. Example: Conditional Test Using Platform Macros

```cpp
#include <gtest/gtest.h>

TEST(FileSystemTest, CanCreateFile) {
#if GTEST_HAS_FILE_SYSTEM
  FILE* file = fopen("testfile.tmp", "w");
  ASSERT_NE(file, nullptr);
  fclose(file);

  remove("testfile.tmp");
#else
  GTEST_SKIP() << "File system not available on this platform.";
#endif
}
```

This test attempts to create a file only if the platform supports a file system.

---

## 7. Troubleshooting Portable Test Failures

- **Build fails due to undefined macros:** Make sure your build system defines the appropriate platform macros or that GoogleTest detects your platform correctly.

- **Tests fail with errors on one platform but not others:** Review test code for platform-specific API usage or threading assumptions.

- **Tests that rely on features not available on the embedded platform:** Provide alternative stubs or skip logic.

- **Unintended test skips appear:** Confirm that feature macros reflect actual capabilities on your target platform.

---

## 8. Best Practices Summary

- Use feature detection macros (`GTEST_OS_*`, `GTEST_HAS_*`) to gate platform-dependent code.
- Provide cross-platform stubs or mocks to abstract platform differences.
- Use assertion macros that accommodate platform variability (e.g., `EXPECT_NEAR`) where appropriate.
- Avoid hardcoded paths or strings that depend on platform locale or encoding.
- Log skipped tests clearly to differentiate unsupported scenarios from failing ones.

---

## 9. Next Steps & Related Content

- Explore the [Supported Platforms](https://github.com/google/googletest/blob/main/docs/platforms.md) page for official platform coverage details.
- Review [Getting Started Guides](../../getting-started/prerequisites-installation/requirements-overview) for platform-specific build and installation advice.
- Use [Mocking Workflows](../../guides/effective-testing-techniques/mocking-workflows) to implement effective stubs and mocks when abstracting platform dependencies.
- Learn about test organization and best practices in the [Test Structure Guide](../../guides/getting-started/test-structure).

---

<Testimonial>
"By leveraging GoogleTest’s platform detection macros and writing conditional tests, our testing process became fundamentally more robust when deploying across Linux, Windows, and embedded devices. It eliminated flaky tests caused by platform idiosyncrasies and simplified diagnosing failures." – Experienced GoogleTest User
</Testimonial>
