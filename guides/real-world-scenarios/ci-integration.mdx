---
title: "Continuous Integration and Test Automation"
description: "How to integrate GoogleTest and GoogleMock into popular CI/CD pipelines, with sample scripts and advice for automatic test discovery and reporting. Addresses cross-platform builds and reporting best practices."
---

# Continuous Integration and Test Automation with GoogleTest and GoogleMock

Integrating GoogleTest and GoogleMock into your Continuous Integration (CI) and automation workflows ensures reliable, fast, and maintainable test execution across teams and platforms. This guide helps you seamlessly incorporate your C++ unit and mock tests into popular CI/CD pipelines, taking advantage of automatic test discovery, consistent reporting, and cross-platform builds.

---

## 1. Workflow Overview

### Task Description
This guide details how to integrate GoogleTest and GoogleMock into CI/CD pipelines, enabling automated building, test execution, and results reporting with minimal manual intervention.

### Prerequisites
- A working GoogleTest and GoogleMock setup in your project.
- Familiarity with your CI platform (e.g., Jenkins, GitHub Actions, GitLab CI, Azure DevOps).
- Source code managed in a version control system accessible by the CI.
- A C++ build system configured for your environment (preferably CMake).

### Expected Outcome
- Automated builds compiling tests on every commit or merge.
- Execution of all GoogleTest/GoogleMock tests with automatic discovery.
- Standardized test result reporting in CI dashboards (e.g., JUnit XML format).
- Cross-platform compatibility for building and testing on different OS targets.

### Time Estimate
Setting up initial CI integration typically takes 1-3 hours depending on CI experience and environment complexity.

### Difficulty Level
Intermediate—requires understanding of build systems, test frameworks, and CI pipeline configuration.

---

## 2. Step-by-Step Integration Instructions

### Step 1: Prepare Your Tests for Automated Build and Execution

- Ensure your tests compile with `gtest_main` or `gmock_main` linking to provide `main()` automatically.
- Prefer CMake to manage builds, as GoogleTest includes CMake build scripts facilitating CI use.
- Confirm that tests run locally using native build commands (e.g., `ctest`, `make test`, or direct executables).

<Tip>
Use `gmock_main` when you also utilize GoogleMock; it initializes GoogleMock along with GoogleTest.
</Tip>

### Step 2: Enable Automatic Test Discovery

- Use `ctest` (from CMake) or GoogleTest’s native test filtering to discover and run all tests automatically.
- Running `ctest` in your build directory executes all tests registered by GoogleTest/GoogleMock.

```bash
mkdir build
cd build
cmake ..
make
ctest --output-on-failure
```

- Alternatively, run test executables directly with flags like `--gtest_list_tests` and `--gtest_filter` for finer control.

### Step 3: Configure Test Result Reporting

- GoogleTest supports standard XML output for continuous integration via the `--gtest_output` flag.

```bash
./my_tests --gtest_output=xml:report.xml
```

- Configure your CI system to collect and display JUnit-style XML reports.

<Tip>
Ensure your test runner captures XML report files as artifacts for CI dashboard reporting.
</Tip>

### Step 4: Integrate Tests into CI Pipeline Steps

- Add build and test commands as job steps in your CI pipeline configuration file.
- Example GitHub Actions snippet using CMake:

```yaml
jobs:
  build_and_test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Setup CMake
        uses: jwlawson/actions-setup-cmake@v1
      - name: Configure
        run: cmake -S . -B build
      - name: Build
        run: cmake --build build
      - name: Run Tests
        run: ctest --test-dir build --output-on-failure
      - name: Upload Test Report
        uses: actions/upload-artifact@v3
        with:
          name: test-report
          path: build/*.xml
```

- Adjust paths and commands accordingly for other CI services (GitLab, Jenkins, Azure Pipelines).

### Step 5: Cross-Platform Considerations

- GoogleTest supports major desktop platforms (Linux, Windows, macOS) with platform-neutral CMake scripts.
- Test your build and run steps on all target environments.
- Use platform-specific runners or containers as needed.

### Step 6: Continuous Improvement and Reporting Best Practices

- Leverage filters to exclude flaky or long-running tests during certain CI runs.
- Use `--gtest_repeat=N` to run tests multiple times for stability checks.
- Incorporate test coverage tools in the pipeline.

<Tip>
Use `--gtest_color=yes` for colorized console output when supported by your CI terminal.
</Tip>

---

## 3. Sample CI Integration Example with CMake and GoogleTest

```yaml
name: C++ CI with GoogleTest

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Install Dependencies
      run: sudo apt-get update && sudo apt-get install -y cmake g++
    - name: Configure Project
      run: cmake -S . -B build
    - name: Build Project
      run: cmake --build build --config Release
    - name: Run Tests
      run: |
        ctest --test-dir build --output-on-failure --no-compress-output \
          -T Test --gtest_output=xml:build/test-results.xml
    - name: Upload Test Results
      uses: actions/upload-artifact@v3
      with:
        name: Test Results
        path: build/test-results.xml
```

This workflow runs on each push and pull request, building your code, running tests, capturing output, and uploading a test artifact.

---

## 4. Troubleshooting & Tips

### Common Issues
- **Tests not discovered:** Ensure tests register properly; verify your test executable is linked with `gtest_main` or `gmock_main`.
- **XML reports missing or unreadable:** Confirm `--gtest_output=xml:<filename>` is specified correctly and file permissions allow writing.
- **Build errors in CI:** Align compiler and flags in CI environment with local development; confirm C++17 support.
- **Flaky tests:** Use `--gtest_repeat` to debug instability; mark unstable tests to run separately.

### Best Practices
- Keep CI build and test steps clean and minimal to optimize speed.
- Use CMake’s `add_test()` and `ctest` to integrate tests seamlessly.
- Collect and analyze test metrics over time.
- Integrate code coverage and static analysis tools when feasible.

### Performance Considerations
- Parallelize test execution using `ctest -j <jobs>` to speed tests.
- Use test filters to run quick smoke tests on every commit and full suites nightly.

### Alternative Approaches
- Use native test runners of your CI instead of `ctest` but ensure to preserve GoogleTest reporting flags.
- Employ containerization to provide consistent environments across CI runs.

---

## 5. Next Steps & Related Content

- **Writing and Running Your First Test:** Learn the test authoring basics.
- **Using GoogleMock Basics:** Introduce mocking in your tests.
- **Setting Up Your Testing Environment:** Configure your local dev environment for test development.
- **Effective Mocking Patterns:** Optimize your mock expectations and behaviors.
- **Common Installation Issues:** Troubleshoot build or dependency problems encountered in CI.

---

## Additional Resources
- [GoogleTest CMake Build Instructions](https://github.com/google/googletest/blob/main/README.md#build-with-cmake)
- [GoogleTest Command-Line Options](https://github.com/google/googletest/blob/main/docs/advanced.md#running-the-tests)
- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [JUnit XML Reporting Format](https://llg.cubic.org/docs/junit/)

---

Integrating GoogleTest and GoogleMock into automation pipelines empowers your teams to ensure code quality continuously with effortless, reliable verification across diverse environments.


---