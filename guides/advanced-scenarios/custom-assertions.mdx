---
title: "Creating and Using Custom Assertions"
description: "Discover how to craft expressive, reusable assertions tailored to your domain logic. This guide covers implementation tips, integration with test results, and when to employ user-defined assertions for improved clarity."
---

# Creating and Using Custom Assertions

Discover how to craft expressive, reusable assertions tailored to your domain logic. This guide covers implementation tips, integration with test results, and when to employ user-defined assertions for improved clarity.

---

## Overview

Custom assertions in GoogleTest empower you to extend the framework’s rich assertion set with your own domain-specific checks. These assertions make your tests more readable, maintainable, and provide clearer failure diagnostics by encapsulating complex verification logic.

This page guides you through creating and employing custom assertions that integrate seamlessly with GoogleTest’s testing framework and reporting system.

### Prerequisites

- You should have a working knowledge of basic GoogleTest assertions and tests.
- Ability to write C++ code, including defining functions and classes.
- Understand the difference between fatal (`ASSERT_`) and nonfatal (`EXPECT_`) assertions.

### What You Will Achieve

By the end of this guide, you will be able to:

- Implement custom assertions that return `::testing::AssertionResult` for expressive checks.
- Use predicate functions and predicate-formatters for detailed failure messages.
- Integrate these assertions in your test code, gaining improved diagnostic output.
- Identify when to create custom assertions versus using existing ones.

---

## Writing Custom Assertions

### Why Create Custom Assertions?

Sometimes your code requires checks that are beyond built-in assertions or involve complex logic. Wrapping these in custom assertions:

- Simplifies test logic by avoiding repetitive code.
- Enhances failure messages with clear, domain-specific explanations.
- Encourages reuse and consistent verification.

### Basic Form: Using `::testing::AssertionResult`

The recommended form for custom assertions is to write a function that returns a `::testing::AssertionResult`. This supports both success and failure results, and allows streaming detailed failure messages.

#### Syntax

```cpp
::testing::AssertionResult AssertMyCondition(Type param) {
  if (/* condition holds */) {
    return ::testing::AssertionSuccess();
  } else {
    return ::testing::AssertionFailure() << "Failure details here about " << param;
  }
}
```

#### How It Works

- `AssertionSuccess()` indicates the assertion passed.
- `AssertionFailure()` indicates failure, and the streamed message is shown on test failure.

This lets you use the assertion in tests naturally:

```cpp
EXPECT_TRUE(AssertMyCondition(foo));
ASSERT_TRUE(AssertMyCondition(bar)) << "Extra contextual info";
```

---

### Example 1: Checking Evenness

```cpp
#include <gtest/gtest.h>

::testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) {
    return ::testing::AssertionSuccess();
  } else {
    return ::testing::AssertionFailure() << n << " is not even";
  }
}

TEST(NumberTest, CheckEven) {
  EXPECT_TRUE(IsEven(4));  // Passes
  EXPECT_TRUE(IsEven(5));  // Fails with message "5 is not even"
}
```

### Example 2: Comparing Vectors

```cpp
#include <vector>
#include <gtest/gtest.h>

::testing::AssertionResult VectorsEqual(const std::vector<int>& v1,
                                       const std::vector<int>& v2) {
  if (v1.size() != v2.size()) {
    return ::testing::AssertionFailure() << "Vector sizes differ: " << v1.size() << " vs " << v2.size();
  }

  for (size_t i = 0; i < v1.size(); ++i) {
    if (v1[i] != v2[i]) {
      return ::testing::AssertionFailure() << "Vectors differ at index " << i << ": " << v1[i] << " vs " << v2[i];
    }
  }

  return ::testing::AssertionSuccess();
}

TEST(VectorTest, Equality) {
  std::vector<int> a = {1,2,3};
  std::vector<int> b = {1,2,3};
  std::vector<int> c = {2,3,4};

  EXPECT_TRUE(VectorsEqual(a, b));  // Passes
  EXPECT_TRUE(VectorsEqual(a, c));  // Fails with clear message
}
```

---

### Predicate Assertions for Overcoming Boolean Limitations

If you have an existing predicate (a function returning `bool`), you can improve error messages by wrapping it with GoogleTest’s `EXPECT_PRED*` macros which print argument values on failure:

```cpp
bool IsPositive(int n) { return n > 0; }

TEST(MyTest, PositiveCheck) {
  EXPECT_PRED1(IsPositive, 3);  // Passes
  EXPECT_PRED1(IsPositive, -1); // Fails with message including argument value
}
```

### Predicate Formatters for Custom Failure Messages

When you want full control over failure messages, implement predicate-formatters that return `AssertionResult` and receive argument expressions as strings:

```cpp
::testing::AssertionResult IsDivisibleBy(const char* expr, int n, int divisor) {
  if (n % divisor == 0) {
    return ::testing::AssertionSuccess();
  } else {
    return ::testing::AssertionFailure() << expr << " (" << n << ") is not divisible by " << divisor;
  }
}

TEST(MyTest, DivisibleByThree) {
  EXPECT_PRED_FORMAT2(IsDivisibleBy, 6, 3);  // Pass
  EXPECT_PRED_FORMAT2(IsDivisibleBy, 7, 3);  // Fail with friendly message
}
```

Use these in tests with macros like `EXPECT_PRED_FORMAT2` or `ASSERT_PRED_FORMAT2`.

---

## Integrating Custom Assertions in Tests

- Custom assertion functions can be used in place of Boolean conditions in `EXPECT_TRUE` or `ASSERT_TRUE`.
- Custom assertions can also be used directly with `EXPECT_PRED*` or `EXPECT_PRED_FORMAT*` macros when appropriate.

Example:

```cpp
TEST(FooTest, CustomAssert) {
  int value = ComputeValue();
  EXPECT_TRUE(IsEven(value)) << "Value is not even";
}
```

**Tip:** When testing critical preconditions, use `ASSERT_*` macros to abort the test early upon failure.

---

## Best Practices

- Return early in custom assertions for clarity.
- Always return `AssertionSuccess()` or `AssertionFailure()` objects.
- Provide meaningful failure messages to ease debugging.
- Stream actual values and context into failure messages.
- Avoid side effects in custom assertions.
- Use predicate-format assertions when you want to print the expressions as well as values.
- Consider using existing GoogleTest assertions or matchers before creating a new custom assertion.

---

## Troubleshooting Common Issues

<AccordionGroup title="Common Pitfalls">
  <Accordion title="Assertion does not abort the test">
    When using custom assertion functions with `EXPECT_TRUE`, failing assertions are nonfatal and test execution continues. Use `ASSERT_TRUE` if you want the test to abort immediately on failure.
  </Accordion>
  <Accordion title="Lack of detailed failure message">
    Return descriptive messages from your custom assertions using `<<` streaming on `AssertionFailure()`. Avoid vague failure outputs.
  </Accordion>
  <Accordion title="Multiple evaluations of expressions">
    Ensure that expressions with side effects are evaluated only once inside your assertion functions.
  </Accordion>
  <Accordion title="Incompatible return type errors">
    Custom assertion functions must return `::testing::AssertionResult`. Using other return types will cause compilation errors.
  </Accordion>
</AccordionGroup>

<Tip>
Use `SCOPED_TRACE()` to add contextual information to your failures when calling custom assertions in helper functions.
</Tip>

---

## Next Steps & Related Content

- Explore the **[Assertions Reference](../reference/assertions.md)** for existing assertions and predicate macros.
- Learn about **[Writing New Matchers Quickly](../gmock_cook_book.md#NewMatchers)** for extending GoogleMock's matcher functionality.
- Review **[Using Assertions and Matchers Effectively](../core-workflows/rich-assertions.md)** to understand best practices.
- Visit the **[Getting Started - First Test](../getting-started/core-setup/first-test.md)** guide for foundational testing workflows.

---

## Additional Resources

- GoogleTest Primer: [docs/primer.md](../primer.md)
- Assertions Reference: [docs/reference/assertions.md](../reference/assertions.md)
- Advanced Topics on Assertions: [docs/advanced.md#Using-Assertions-in-Sub-routines](../advanced.md#Using-Assertions-in-Sub-routines)
- GoogleMock Cookbook (Matchers and Actions): [docs/gmock_cook_book.md](../gmock_cook_book.md)

---

*This documentation is specific to creating custom assertions in GoogleTest and integrates with the broader ecosystem of GoogleTest and GoogleMock for powerful C++ testing.*
