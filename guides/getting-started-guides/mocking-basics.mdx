---
title: "Getting Started with GoogleMock"
description: "Introductory guide to using mocks in your C++ tests. Explains mock class creation, expectation setting, and verification using GoogleMock, equipping users to simulate dependencies and exercise test-driven development patterns."
---

# Getting Started with GoogleMock

## Introduction

This guide serves as your comprehensive introduction to using mocks in your C++ tests with GoogleMock. You'll learn to create mock classes, set expectations on their behavior, and verify these expectations during test execution. GoogleMock equips you to simulate complex dependencies easily, empowering you to practice test-driven development effectively.


## Workflow Overview

### Task Description

By following this guide, you will understand how to:

- Define a mock class that simulates a real interface.
- Set default behaviors and expectations for mock methods.
- Use these mocks to isolate your unit tests from external dependencies.
- Verify that your code interacts correctly with those dependencies.

### Prerequisites

- Basic knowledge of C++ including classes, inheritance, and virtual methods.
- GoogleTest and GoogleMock properly installed and integrated into your build.
- A realistic interface with virtual methods to mock.

### Expected Outcome

You will be able to write tests that employ GoogleMock mocks to:

- Simulate any behavior of your dependencies.
- Check call counts, argument values, and call ordering.
- Control return values and side effects to test diverse scenarios.

### Time Estimate

Approximately 20-30 minutes to read and try out the examples provided.

### Difficulty Level

Beginner to intermediate. No advanced C++ or GoogleMock internals required.


## Step-by-Step Instructions

### 1. Define a Mock Class

Your first step is to define a mock class that inherits from the interface you want to mock. Use the `MOCK_METHOD` macro to declare mocked methods within this class.

#### Example:

```cpp
#include <gmock/gmock.h>  // Include GoogleMock header

// Original interface
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

// Mock class
class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

**Key points:**
- `MOCK_METHOD` requires you to specify the return type, method name, argument list, and qualifiers (e.g., `(const, override)`).
- Put all `MOCK_METHOD` declarations in the `public:` section even if original methods are protected or private.

<Tip>
Make sure the destructor of the interface you mock is virtual to avoid undefined behavior and potential resource leaks.
</Tip>

### 2. Create Mock Objects in Your Tests

Instantiate your mock classes in your test functions or fixtures.

```cpp
TEST(PainterTest, DrawsLine) {
  MockTurtle turtle;  // Create mock object
  // Further steps ...
}
```

### 3. Set Default Behavior with `ON_CALL`

Define how mock methods behave by default using `ON_CALL`. This sets behavior but does not assert that the method must be called.

```cpp
using ::testing::Return;
using ::testing::_;

ON_CALL(turtle, GetX()).WillByDefault(Return(42));  // Always returns 42 unless overridden
```

<Tip>
Use `ON_CALL` in test setup or fixtures for behaviors common to many tests.
</Tip>

### 4. Set Expectations with `EXPECT_CALL`

Specify your test's expectations on which methods should be called, with what arguments, how many times, and with what behavior.

```cpp
EXPECT_CALL(turtle, PenDown())
    .Times(1);  // Expect PenDown() to be called exactly once

EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1))  // Expect forwarding at least once
    .WillRepeatedly(Return());
```

#### Clauses of `EXPECT_CALL`

- `.Times(cardinality)` — How many times the call is expected.
- `.WillOnce(action)` — Action for the next matching call.
- `.WillRepeatedly(action)` — Action for the remaining matching calls.
- `.InSequence(seq)` — Expect calls in a specific order.
- `.After(...)` — Controls call ordering relative to other expectations.
- `.RetiresOnSaturation()` — Retire expectation after it saturates.

`Times()` is optional; if omitted, GoogleMock infers cardinality.

### 5. Exercise the Code Under Test

Invoke the code that uses the mocked dependencies. GoogleMock will check expectations during these calls and at the end when mocks are destroyed.

Example:

```cpp
Painter painter(&turtle);
EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
```

If your code does not meet the expectations (wrong arguments, missing calls, excessive calls), GoogleMock reports errors immediately.

### 6. Automatic Verification

GoogleMock automatically verifies expectations when the mock object is destructed. You can also force verification earlier with:

```cpp
EXPECT_TRUE(::testing::Mock::VerifyAndClearExpectations(&turtle));
```


## Practical Examples

### Simple Mock and Test

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;
using ::testing::_;

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenDown() = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(PainterTest, CallsPenDown) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenDown()).Times(1);
  ON_CALL(turtle, GetX()).WillByDefault(Return(100));

  turtle.PenDown();  // Should satisfy expectation
  EXPECT_EQ(turtle.GetX(), 100);
}
```

### Using Sequences

```cpp
using ::testing::InSequence;

TEST(PainterTest, CallsInOrder) {
  MockTurtle turtle;
  {
    InSequence s;

    EXPECT_CALL(turtle, PenDown());
    EXPECT_CALL(turtle, Forward(100));
    EXPECT_CALL(turtle, PenDown());
  }

  turtle.PenDown();
  turtle.Forward(100);
  turtle.PenDown();
}
```

The above test verifies calls happen strictly in the declared order.

### Return Different Values on Multiple Calls

```cpp
using ::testing::Return;

EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(10))
    .WillOnce(Return(20))
    .WillRepeatedly(Return(30));

EXPECT_EQ(turtle.GetX(), 10);  // First call
EXPECT_EQ(turtle.GetX(), 20);  // Second call
EXPECT_EQ(turtle.GetX(), 30);  // Third call and subsequent
```


## Best Practices & Tips

- Always put `MOCK_METHOD` in the `public:` section of the mock class.
- Mock *only interfaces* where feasible, rather than concrete classes.
- Use `ON_CALL` for default mock behavior, and `EXPECT_CALL` to specify calls that must happen.
- For liberal mocks that don't complain about unexpected calls, wrap your mock in `NiceMock<MyMock>`.
- Use `StrictMock<MyMock>` to enforce no unexpected calls occur.
- Use sequences and `.After()` clauses to express call ordering.
- Use matchers like `_` to specify flexible argument expectations.
- Avoid over-specifying tests; verify only what matters to prevent brittle tests.
- For non-copyable or move-only types, use lambdas or functors to specify behaviors.


## Common Pitfalls & Troubleshooting

### Method Not Mocked: Real Implementation Called

Ensure the method you want to mock is declared `virtual` in the base class, otherwise GoogleMock cannot intercept calls.

### Compiler Warnings with `const` Parameters

Visual C++ may warn if `const` is on parameters. It is recommended to remove top-level `const` qualifiers from parameter declarations.

### Unexpected Calls and Warnings

Calls to mock methods without matching `EXPECT_CALL` are called "uninteresting" and generate warnings by default. You can suppress these using `NiceMock`, or explicitly expect these calls with `.Times(AnyNumber())`.

### Calls Not Matching Expectations

Use `--gmock_verbose=info` to debug why calls are not matching expectations. The log will show which expectations were tried for each call.

### Verifying and Clearing Expectations Manually

You can force verification of a mock using `Mock::VerifyAndClearExpectations(&mock)`. Do not set new expectations after verification.


## Next Steps & Related Content

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) — advanced recipes and tips.
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) — quick syntax reference.
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) — details on argument matching.
- [Actions Reference](https://google.github.io/googletest/reference/actions.html) — how to specify mock method behaviors.
- [Understanding Uninteresting vs Unexpected Calls](https://google.github.io/googletest/gmock_cook_book.html#uninteresting-vs-unexpected) — to better control warnings and errors.
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) — for foundational testing knowledge.

<Tip>
Remember to define your expectations before exercising code that calls the mock methods. Setting expectations afterwards leads to undefined behavior.
</Tip>

<Info>
For complete usage and troubleshooting details, consult the [Legacy gMock FAQ](https://google.github.io/googletest/gmock_faq.html).
</Info>

<AccordionGroup title="Example Mock-Testing Cycle">
<Accordion title="1. Define Mock Class">
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Bar, (int x), (override));
};
```
</Accordion>
<Accordion title="2. Set Expectations and Default Behavior">
```cpp
MockFoo mock;
ON_CALL(mock, Bar(_)).WillByDefault(Return(0));
EXPECT_CALL(mock, Bar(42)).WillOnce(Return(7));
```
</Accordion>
<Accordion title="3. Run Test Code Using Mock">
```cpp
int result = mock.Bar(42);  // Returns 7, satisfies expectation.
int other = mock.Bar(10);   // Returns 0, default action.
```
</Accordion>
<Accordion title="4. Test Teardown: Automatic Verification">
// Done automatically when `mock` goes out of scope.
```
</Accordion>
</AccordionGroup>