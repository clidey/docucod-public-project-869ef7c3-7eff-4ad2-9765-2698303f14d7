---
title: "Advanced Mocking: Matchers, Sequences, and Strictness"
description: "Explore advanced topics including argument matchers, call sequencing, NiceMock vs StrictMock, and handling uninteresting calls. Useful for complex dependencies and fine-grained test control."
---

# Advanced Mocking: Matchers, Sequences, and Strictness

Explore advanced mocking techniques in GoogleMock that help you handle complex dependencies and gain fine-grained control of your tests. This guide covers advanced concepts including the use of argument matchers for flexible and precise verification, controlling call sequencing to manage the order of mock interactions, and understanding the implications of NiceMock, NaggyMock, and StrictMock for managing uninteresting calls.

---

## 1. Advanced Argument Matching

GoogleMock’s powerful matcher framework lets you specify exactly how method arguments should be validated in your expectations. This allows your tests to focus on *what matters*, avoiding brittle, overly specific tests.

### What You Will Learn
- Specify argument matchers for flexible test conditions
- Combine and compose matchers for complex argument validation
- Match argument tuples as a whole for inter-parameter dependencies

### Key Techniques

- **Using simple and compound matchers**: Use wildcards (`_`) for "anything", built-in matchers like `Ge()`, `Ne()`, or custom predicates via `Truly()`.

- **Combining matchers**: Use `AllOf()`, `AnyOf()`, `Not()`, and other combinators to express precise conditions.

- **Matching multiple arguments together**: Use `.With()` and tuple matchers to validate relationships across arguments.

- **Handling non-copyable arguments**: Use `std::ref()` to safely refer to arguments without copies.

### Example

```cpp
using ::testing::_;
using ::testing::Ge;
using ::testing::AllOf;
using ::testing::Ne;

// Expect the method Foo(int a, int b) where a >= 5 and a != 10
EXPECT_CALL(mock_obj, Foo(AllOf(Ge(5), Ne(10)), _));

// Match argument tuple: first arg is less than second
EXPECT_CALL(mock_obj, SetPosition(_, _))
    .With(Lt());

// Custom predicate matcher example
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_CALL(mock_obj, ProcessNumber(testing::Truly(IsEven)));
```

### Tips
- Use `_` (wildcard) for arguments your test doesn't care about.
- Avoid over-specifying arguments to keep tests resilient.

---

## 2. Call Sequences and Partial Ordering

Sometimes, the order in which mock method calls happen is important. GoogleMock provides mechanisms to enforce call order precisely or partially.

### Core Concepts

- **`InSequence`**: Enforces strict sequential order for all expectations defined within its scope.
- **`Sequence` objects**: Allow declaring sequences on specific expectations to build complex ordering constraints, including partial orders.
- **`After` clause**: Lets you specify that a call is expected after other expectations have been satisfied.

### How to Use

```cpp
using ::testing::InSequence;
using ::testing::Sequence;

// Strict sequence over multiple expectations
{
  InSequence s;
  EXPECT_CALL(mock_obj, Initialize());
  EXPECT_CALL(mock_obj, Execute());
  EXPECT_CALL(mock_obj, Cleanup());
}

// Partial order between multiple sequences
Sequence s1, s2;
EXPECT_CALL(mock_obj, Step1()).InSequence(s1, s2);
EXPECT_CALL(mock_obj, Step2()).InSequence(s1);
EXPECT_CALL(mock_obj, Step3()).InSequence(s2);
EXPECT_CALL(mock_obj, Step4()).InSequence(s2);

// Using After to specify dependencies explicitly
Expectation e1 = EXPECT_CALL(mock_obj, Start());
EXPECT_CALL(mock_obj, Stop()).After(e1);
```

### Best Practices
- Use `InSequence` for simple linear ordering needs.
- Use `Sequence` objects for more flexible partial orders.
- Avoid unnecessarily strict ordering to keep tests maintainable.

---

## 3. Managing Uninteresting Calls: Nice, Naggy, and Strict Mocks

By default, GoogleMock warns about calls to mock methods for which no expectation (`EXPECT_CALL`) exists. These are called "uninteresting calls."

You can control this behavior on a per-mock-object basis:

| Mock Type    | Behavior on Uninteresting Calls                          |
| ------------ | -------------------------------------------------------- |
| **NaggyMock** (default) | Emits warnings but allows the call
| **NiceMock**  | Suppresses warnings and allows the call
| **StrictMock** | Treats uninteresting calls as test failures

### Usage

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

// Default (naggy) mock
MockFoo mock_default;

// Nice mock suppresses warnings
NiceMock<MockFoo> mock_nice;

// Strict mock fails on uninteresting calls
StrictMock<MockFoo> mock_strict;
```

### When to Use

- **NiceMock**: Use when you want to avoid warnings and do not care about all calls.
- **NaggyMock (default)**: Useful when developing tests to catch forgotten expectations.
- **StrictMock**: Use when you want complete control and to catch unexpected calls as errors.

### Important Notes
- This setting only affects *uninteresting* calls (no expectation exists), not *unexpected* calls (calls that do not match any expectation).
- Wrapping a mock inside `NiceMock` or `StrictMock` retains all constructors of the original mock class.

---

## 4. Putting It All Together: Sample Workflow

Here is how you combine advanced mocking techniques to create robust and maintainable tests.

```cpp
using ::testing::_;
using ::testing::InSequence;
using ::testing::Return;
using ::testing::Sequence;
using ::testing::StrictMock;

class MockService {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& addr), ());
  MOCK_METHOD(void, Disconnect, (), ());
  MOCK_METHOD(int, SendData, (int data), ());
};

TEST(ServiceTest, DataSendSequence) {
  StrictMock<MockService> mock_service;

  Sequence s1;
  EXPECT_CALL(mock_service, Connect(_)).InSequence(s1).WillOnce(Return(true));
  EXPECT_CALL(mock_service, SendData(42)).InSequence(s1).WillOnce(Return(1));
  EXPECT_CALL(mock_service, Disconnect()).InSequence(s1);

  // Code under test uses mock_service here
}
```

In the example above:
- A `StrictMock` ensures uninteresting calls cause test failures.
- A `Sequence` guarantees that `Connect` happens before `SendData`, which happens before `Disconnect`.
- Specific argument matcher (`_`) and actions (`Return(...)`) are specified.

---

## 5. Troubleshooting Common Issues

### Too Many or Too Few Actions Warning
If the number of `.WillOnce()` and `.WillRepeatedly()` clauses does not match the expectation’s `Times()`, GoogleMock will warn:
- Ensure `.WillOnce()` count matches or is less than expected calls.
- Use `.RetiresOnSaturation()` if you want expectations to be deactivated after being met.

### Unexpected or Uninteresting Calls
- An unexpected call is a call matching no expectation and is always an error.
- An uninteresting call has no expectation and may only generate warnings.
- To control noise, use `NiceMock` or add catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.

### Overloaded Methods and Matchers
- When mocking overloaded methods, specify argument types explicitly.
- Use `Const()` helper to distinguish const overloads.

### Order of Expectations
- GoogleMock matches expectations in reverse order declared.
- Put more specific expectations **after** general ones.

---

## 6. References and Further Reading

To deepen your understanding:

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - recipes including matchers and sequences.
- [Introduction to Mocking and GoogleMock](/guides/mocking-with-googlemock/introduction-to-mocking) - basics before advancing.
- [Writing Mock Expectations](/guides/mocking-with-googlemock/writing-mock-expectations) - setting behaviors and expectations.
- [Mocking Reference](docs/reference/mocking.md) - API and detailed descriptions.

---

Use these advanced mocking techniques to write flexible, precise, and maintainable tests with GoogleMock. Proper use of matchers, call sequencing, and mock strictness will improve your test clarity and robustness.

---