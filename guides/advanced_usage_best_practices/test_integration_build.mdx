---
title: "Integrating Tests into Your Build and CI Pipeline"
description: "A step-by-step guide to automating test execution with popular build systems (CMake/Bazel) and incorporating tests into continuous integration pipelines. Covers sample configurations, output customization, and tracking test results."
---

# Integrating Tests into Your Build and CI Pipeline

Ensure your GoogleTest-powered tests run smoothly within your build environment and continuous integration (CI) pipelines by following this practical guide. You'll automate test execution, produce meaningful output reports, and effectively track test results to maintain high code quality.

---

## 1. Overview

This guide helps you integrate GoogleTest into popular build systems like **CMake** and **Bazel**, and incorporate test execution into your CI workflows. You'll learn how to:

- Configure your build system to compile and run tests automatically.
- Customize test output formats to generate XML or JSON reports.
- Use command-line flags to filter, repeat, or shuffle test execution.
- Register global test environments for setup/teardown at the test program level.

### Prerequisites

- Basic GoogleTest installation and test project setup.
- Familiarity with CMake or Bazel build tools.
- Access to your project's CI environment (e.g., Jenkins, GitHub Actions).

### Expected Outcome

After following this guide, your project’s tests will be:

- Automatically built and linked during compilation.
- Executed during CI runs with configurable flags.
- Generating detailed reports usable by CI tools.

### Time Estimate

15-30 minutes depending on prior build system familiarity.

### Difficulty Level

Intermediate

---

## 2. Integrating with Build Systems

### 2.1 GoogleTest with CMake

The canonical and robust approach to build and run tests using GoogleTest is through its CMake integration.

#### Standalone GoogleTest Build

1. Clone GoogleTest:

    ```bash
    git clone https://github.com/google/googletest.git -b v1.17.0
    cd googletest
    mkdir build && cd build
    cmake ..
    make
    sudo make install  # Optional: to install in /usr/local
    ```

2. In your project’s `CMakeLists.txt`, include GoogleTest as a dependency using CMake's `FetchContent`:

    ```cmake
    include(FetchContent)
    FetchContent_Declare(
      googletest
      URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
    )

    set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)  # For Visual Studio runtime compatibility
    FetchContent_MakeAvailable(googletest)

    add_executable(my_test_executable test_main.cpp my_tests.cpp)
    target_link_libraries(my_test_executable gtest_main)
    add_test(NAME MyTests COMMAND my_test_executable)
    ```

3. Build and run your tests:

    ```bash
    mkdir build && cd build
    cmake ..
    make
    ctest
    ```

#### Important CMake Options

- `gtest_force_shared_crt`: Ensures runtime linking consistency on Windows.
- `CMAKE_CXX_STANDARD`: Typically set to 17 or higher to satisfy GoogleTest requirements.

#### Tips

- Use the `add_test()` CMake command to register test executables with CTest.
- Ensure that your test targets link against `gtest_main` for an automatic main() function.

---

### 2.2 GoogleTest with Bazel

Bazel users can integrate GoogleTest by declaring it as a dependency and using `cc_test` rules.

Example `BUILD` snippet:

```starlark
cc_test(
    name = "my_tests",
    srcs = ["my_tests.cc"],
    deps = ["@com_google_googletest//:gtest_main"],
)
```

Run tests with:

```bash
bazel test //path/to:my_tests
```

Bazel automatically manages test execution and reporting.

---

## 3. Automating Test Execution in CI Pipelines

Integrating GoogleTest into your CI pipeline requires automating the build and test run steps using the appropriate commands and capturing their output for review.

### 3.1 Basic CI Script Example (Shell)

```bash
# Build and install dependencies if needed
cmake -S . -B build
cmake --build build --target all

# Run tests
cd build
ctest --output-on-failure

# Optionally, generate XML output for CI consumption
ctest -T Test --output-junit junit_results.xml
```

Make sure your CI runner picks up `junit_results.xml` for visualization.

### 3.2 Using GoogleTest Command-Line Flags

GoogleTest executables accept multiple flags to customize test runs:

- `--gtest_filter=MyTestSuite.MyTest`: Run subset of tests matching names.
- `--gtest_repeat=10`: Repeat all tests 10 times.
- `--gtest_shuffle`: Randomize test execution order.
- `--gtest_break_on_failure`: Break upon first failure.
- `--gtest_also_run_disabled_tests`: Include tests that are normally disabled.
- `--gtest_output=xml:output_dir/`: Produce XML reports (also supports `json:`).

Example CI test execution command:

```bash
./my_tests --gtest_output=xml:test_results/ --gtest_color=yes
```

### 3.3 Handling Flaky Tests

- Utilize `--gtest_repeat=N` to repeat flaky tests multiple times to catch intermittent failures.
- Use `--gtest_fail_fast` to abort on first failure during debug cycles.

---

## 4. Customizing Test Output

### 4.1 Generating XML and JSON Reports

GoogleTest supports detailed test result reporting in formats consumable by CI dashboards.

- Command flag: `--gtest_output=xml:<path>` produces an XML report.
- Command flag: `--gtest_output=json:<path>` produces a JSON report.

If path is a directory, GoogleTest names the report files with the test executable name plus extension.

### 4.2 Disabling Console Output

To disable console output while generating reports:

- Remove the default listener by accessing the event listeners in code:

```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  // Remove default console output
  auto& listeners = testing::UnitTest::GetInstance()->listeners();
  delete listeners.Release(listeners.default_result_printer());

  return RUN_ALL_TESTS();
}
```

### 4.3 Adding Custom Event Listeners

You can provide your own test result listeners by subclassing `testing::TestEventListener`. Append your listener before running tests to implement customized behavior such as logging to a database or custom report formatting.

---

## 5. Global Test Environments

GoogleTest enables setting up and tearing down resources at the test program level with `Environment`.

### 5.1 How to Use

Subclass `testing::Environment` and override `SetUp()` and `TearDown()`:

```cpp
class MyEnvironment : public ::testing::Environment {
 public:
  void SetUp() override {
    // Global setup logic
  }
  void TearDown() override {
    // Global teardown logic
  }
};

int main(int argc, char** argv) {
  ::testing::InitGoogleTest(&argc, argv);
  ::testing::AddGlobalTestEnvironment(new MyEnvironment);
  return RUN_ALL_TESTS();
}
```

### 5.2 CI Usage

- Use global environments to setup databases, mock servers, or other expensive resources used across multiple test suites.
- Ensure to handle failures in `SetUp()` properly; if a fatal failure occurs, tests will be skipped.

---

## 6. Best Practices & Troubleshooting

### 6.1 Best Practices

- Always call `InitGoogleTest()` before `RUN_ALL_TESTS()`.
- Use `add_test()` in CMake to register tests with your build system's test runner.
- Generate XML or JSON reports for CI consumption.
- Utilize filters (`--gtest_filter`) to run relevant subsets of tests.
- Use `GTEST_SKIP()` to skip tests conditional on environment or configuration.

### 6.2 Common Pitfalls

- Forgetting to link the test executable with `gtest_main` or providing a custom `main()`.
- Mixing `TEST` and `TEST_F` within the same test suite (causes failures).
- Not handling failures in global environments, which leads to skipped tests.
- Using unsupported compiler versions or missing C++17 support.
- Not including test source files in the build system, causing no tests to be discovered.

### 6.3 Troubleshooting Tips

- If tests do not run, check the output of `--gtest_list_tests` to ensure tests are registered.
- If build errors related to mismatched runtime libraries appear on Windows, adjust `gtest_force_shared_crt` in CMake.
- Use the `--gtest_break_on_failure` flag in CI runs to halt on first failure and inspect.
- Validate that environment variables for test sharding (`GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`) are consistent if sharding tests.

---

## 7. Additional Resources & Next Steps

- [GoogleTest Primer](../primer.md): Learn the basics of writing tests.
- [Setting Up Your Test Project (CMake and Bazel)](/guides/getting_started/setup_project): Integrate GoogleTest source into your project builds.
- [Running and Interpreting Test Results](/getting-started/first-steps/running-tests): Understand test execution and results.
- [Global Test Environments](/core-concepts/test-foundations/global-set-up-and-tear-down): Advance resource management across tests.
- [Mastering Event Listeners](/guides/advanced_usage_best_practices/test_integration_build): Customize test event handling for advanced CI workflows.

For CI integration, consult your CI server’s documentation on importing JUnit XML or JSON test results for optimal display.

---

#### Quick CMake Sample for Test Integration:

```cmake
include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/5376968f6948923e2411081fd9372e71a59d8e77.zip
)
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)
target_link_libraries(my_tests gtest_main)
add_test(NAME all_tests COMMAND my_tests --gtest_output=xml:reports/test_results.xml)
```

Run the tests with:

```bash
ctest --verbose
```

#### Shell snippet for CI test execution and report collection:

```bash
cmake -S . -B build
cmake --build build
cd build
./my_tests --gtest_output=xml:../test_reports/result.xml
```