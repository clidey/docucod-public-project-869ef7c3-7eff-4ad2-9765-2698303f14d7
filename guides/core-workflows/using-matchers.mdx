---
title: "Using Advanced Matchers"
description: "Master GoogleTest's built-in matchers and learn how to create custom matchers for more expressive, readable assertions—improving the clarity and maintainability of your tests."
---

# Using Advanced Matchers

Master GoogleTest's built-in matchers and learn how to create custom matchers for more expressive, readable assertions—improving the clarity and maintainability of your tests.

---

## Overview

This guide focuses exclusively on using advanced matchers within GoogleTest and GoogleMock. It will help you leverage the power of built-in matchers for precise, expressive assertions, and guide you through creating custom matchers tailored to your domain. This sharpens the readability and debuggability of your tests and mocks.

By following this guide, you'll gain proficiency in matching argument values, composing matchers, and extending matcher functionality — all aimed at writing clearer, maintainable, and more robust tests.

---

## Prerequisites

Before proceeding, ensure you have:

- Set up GoogleTest and GoogleMock in your project.
- Familiarity with basic GoogleTest assertions like `EXPECT_EQ` and `EXPECT_TRUE`.
- Basic understanding of mock objects and `EXPECT_CALL` syntax.

---

## What You Will Achieve

After mastering this guide, you will be able to:

- Use built-in matchers like `Eq()`, `Gt()`, and `Contains()` to enhance your assertions.
- Combine matchers to specify complex argument validations.
- Create your own custom matchers using the `MATCHER` macros or matcher interface.
- Use matchers to test containers, strings, exceptions, and pointers clearly and efficiently.
- Integrate matchers within `EXPECT_CALL`, `ON_CALL`, and direct test assertions for expressive, maintainable test code.

---

## Time Estimate

This guide can be completed in about **30 to 45 minutes** depending on your familiarity with GoogleTest and C++.

---

## Difficulty Level

Intermediate — assumes you are comfortable writing basic tests and mocks.

---

## 1. Understanding Built-in Matchers

GoogleTest comes equipped with a rich set of matchers that make assertions more readable and tests easier to maintain.

### Key Built-in Matchers

- **Generic Comparisons:** `Eq(value)`, `Ne(value)`, `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`
- **Boolean Conditions:** `IsTrue()`, `IsFalse()`
- **Pointer Checks:** `IsNull()`, `NotNull()`, `Pointee(matcher)`, `Pointer(matcher)`
- **Container Matchers:** `ElementsAre(...)`, `UnorderedElementsAre(...)`, `Contains(...)`, `Each(...)`, `SizeIs(matcher)`
- **String Matchers:** `StartsWith()`, `EndsWith()`, `HasSubstr()`, `MatchesRegex()`, `ContainsRegex()`, `StrEq()`, `StrNe()`
- **Exception Assertions:** `Throws<E>()`, `Throws<E>(matcher)`, `ThrowsMessage<E>(matcher)`
- **Composite Matchers:** `AllOf()`, `AnyOf()`, `Not()`, `Conditional()`

### Usage with EXPECT_THAT

Use matchers in conjunction with the `EXPECT_THAT()` macro for flexible value assertions:

```cpp
using ::testing::Gt;
using ::testing::StartsWith;

EXPECT_THAT(value, Gt(5));
EXPECT_THAT(some_string, StartsWith("Hello"));
```

### Benefits

- Natural-language-like assertions clearly state intent.
- Failure messages explain why the assertion failed, improving debuggability.
- Matchers can be composed to build complex conditions.

---

## 2. Using Matchers in Mock Expectations

Matchers are essential for validating mock method arguments in `EXPECT_CALL` and `ON_CALL`.

### Applying Matchers in EXPECT_CALL

```cpp
using ::testing::_;          // Matches anything
using ::testing::Lt;         // Matches values less than
using ::testing::Return;

EXPECT_CALL(mock_object, Method(Lt(10), _))
    .WillOnce(Return(true));
```

- Matchers correspond to the method's arguments positionally.
- The wildcard matcher `_` matches any value.

### Combining Matchers with `.With()` Clause

You can assert conditions on all arguments as a tuple:

```cpp
EXPECT_CALL(mock, Foo(_, _))
    .With(Lt())  // Asserts the first argument is less than the second.
    .WillOnce(Return(1));
```

---

## 3. Writing Custom Matchers

Custom matchers let you test domain-specific properties, enhancing clarity and enabling reusable assertions.

### Defining a Simple Custom Matcher Using `MATCHER`

```cpp
MATCHER(IsEven, "") {
  return (arg % 2) == 0;
}

// Usage
EXPECT_THAT(number, IsEven());
```

- `arg` is the value being matched.
- You return `true` if the value matches; otherwise, `false`.
- Use an optional description string; if empty, matcher name forms the description.

### Adding Detailed Failure Messages

```cpp
MATCHER_P(DivisibleBy, divisor, "") {
  if (arg % divisor == 0) return true;
  *result_listener << "which is " << (arg % divisor) << " modulo " << divisor;
  return false;
}

EXPECT_THAT(10, DivisibleBy(3));  // Fails with a detailed message.
```

### Using Custom Matcher Classes

For advanced usage, define a class implementing `MatchAndExplain()`, `DescribeTo()`, `DescribeNegationTo()`:

```cpp
class BarPlusBazEqMatcher {
public:
  explicit BarPlusBazEqMatcher(int sum) : sum_(sum) {}

  bool MatchAndExplain(const Foo& foo, std::ostream* os) const {
    return foo.bar() + foo.baz() == sum_;
  }

  void DescribeTo(std::ostream* os) const {
    *os << "bar() + baz() equals " << sum_;
  }

  void DescribeNegationTo(std::ostream* os) const {
    *os << "bar() + baz() does not equal " << sum_;
  }

private:
  int sum_;
};

::testing::Matcher<const Foo&> BarPlusBazEq(int sum) {
  return BarPlusBazEqMatcher(sum);
}

// Usage
EXPECT_THAT(foo, BarPlusBazEq(10));
```

---

## 4. Composing Matchers

Combine multiple matchers for more complex validation using:

- `AllOf(m1, m2, ...)` – all must match
- `AnyOf(m1, m2, ...)` – any one matches
- `Not(m)` – negates matcher
- `Conditional(cond, m1, m2)` – selects matcher based on boolean

Example:

```cpp
EXPECT_THAT(value, AllOf(Gt(0), Lt(10)));
EXPECT_THAT(value, Not(Eq(5)));
```

---

## 5. Matching Containers and Composite Types

Built-in matchers allow detailed matching of containers and objects.

### Containers

- `ElementsAre(e0, e1, ...)` – matches exact elements in order
- `UnorderedElementsAre(e0, e1, ...)` – matches elements ignoring order
- `Contains(e)` – container contains at least one element matching `e`
- `Each(e)` – every element matches `e`
- `SizeIs(matcher)` – container size matches the matcher

Example:

```cpp
std::vector<int> v = {1, 2, 3};
EXPECT_THAT(v, ElementsAre(1, 2, 3));
EXPECT_THAT(v, Contains(Gt(2)));
```

### Composite Types

- `Pair(m1, m2)` – matches std::pair with first and second members matching
- `Field(&Class::field, matcher)` – matches member field
- `Property(&Class::method, matcher)` – matches property method return
- `FieldsAre(m1, m2, ...)` – matches struct-like objects field-wise

Example:

```cpp
std::pair<int, std::string> p(5, "hello");
EXPECT_THAT(p, Pair(Gt(0), StartsWith("he")));

struct S { int x; std::string y; } s = {5, "hello"};
EXPECT_THAT(s, FieldsAre(5, "hello"));
```

---

## 6. Using Exceptions and Predicate Matchers

Verify that code throws exceptions matching expected types and messages:

```cpp
EXPECT_THAT([] { throw std::runtime_error("error"); }, Throws<std::runtime_error>());
EXPECT_THAT([] { throw std::runtime_error("error"); }, ThrowsMessage<std::runtime_error>(HasSubstr("error")));
```

---

## 7. Tips and Best Practices

- Prefer expressive matchers with clear failure messages over `EXPECT_TRUE` raw expressions.
- Use composition to build complex match conditions.
- When mocking, use matchers in `EXPECT_CALL` to precisely specify expected arguments.
- For custom types, define `AbslStringify()` or `PrintTo()` to improve matcher output.
- Avoid side-effects in matchers; they must be pure functions.
- Use `MATCHER` macros for quick matchers; implement matcher interfaces for heavily reused code.
- Use `SafeMatcherCast<T>(matcher)` to safely cast matchers when necessary.

---

## 8. Troubleshooting Common Problems

### Matchers Not Matching as Expected

- Check argument types passed to matchers; ensure types are compatible.
- Be wary of implicit conversions causing unexpected matches.
- Use `TypedEq<T>(value)` if you need explicit type matching.

### Custom Matcher Fails Without Clear Message

- Add detailed diagnostic output by streaming to `*result_listener` in your matcher.
- Verify that the matcher correctly implements `DescribeTo` and `DescribeNegationTo`.

### Compiling Custom Matchers Fails

- Ensure your matcher class declares `using is_gtest_matcher = void;`.
- Check template parameters match usage context.

---

## 9. Next Steps & Related Content

- Review the [Mocking Reference](reference/mocking.md) to see practical usage of matchers in mocks.
- Explore the [Writing Custom Matchers](api-reference/assertions-and-matchers/custom-matchers.md) guide for detailed examples.
- Read more about [Assertions Reference](reference/assertions.md) for assertion usage paired with matchers.
- Check out [Using Advanced Matchers](guides/core-workflows/using-matchers.md) for practical workflows and examples.
- For complex conditions, consider [Predicate Assertions](reference/assertions.md#predicates) with AssertionResult.

---

## Appendix: Example Custom Matcher

```cpp
// Custom matcher to check if a string is a valid identifier.
MATCHER(IsIdentifier, "checks if a string is a valid C++ identifier") {
  if (arg.empty()) return false;
  if (!isalpha(arg[0]) && arg[0] != '_') return false;
  for (size_t i = 1; i < arg.size(); ++i) {
    if (!isalnum(arg[i]) && arg[i] != '_') return false;
  }
  return true;
}

// Usage
std::string name = "my_var1";
EXPECT_THAT(name, IsIdentifier());
```

---

## Appendix: Matcher Composition Example

```cpp
EXPECT_CALL(mock, ProcessData(_))
    .With(AllOf(Args<0, 2>(Gt()), Args<1>(NotNull())))
    .WillOnce(Return(true));
```

The above expects that the first argument is greater than the third, and
second argument is non-null.

---

## References

- [Matchers Reference](reference/matchers.md)
- [Assertions Reference](reference/assertions.md)
- [Mocking Reference](reference/mocking.md)
- [GoogleMock Cookbook](gmock_cook_book.md)
- [Advanced GoogleTest Topics](docs/advanced.md)


<Info>
Tip: You can define complex matchers quickly using `MATCHER` and `MATCHER_P` macros to keep your assertions readable and maintainable.
</Info>
<Info>
Tip: Use `EXPECT_THAT(value, matcher)` over `EXPECT_TRUE(some_condition)` for better failure messages.
</Info>
