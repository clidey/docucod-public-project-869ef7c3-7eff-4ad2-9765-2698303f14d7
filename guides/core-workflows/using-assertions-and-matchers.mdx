---
title: "Using Assertions and Matchers Effectively"
description: "Explores the wide variety of assertions and matchers provided by GoogleTest and GoogleMock, including customizing matchers for your own types. This guide also demonstrates combining matchers, best practices for clarity, and how matchers improve test diagnostics."
---

# Using Assertions and Matchers Effectively

Explore the wide variety of assertions and matchers provided by GoogleTest and GoogleMock, including how to customize matchers for your own types. This guide also demonstrates combining matchers, offers best practices for clarity, and shows how matchers improve test diagnostics.

---

## 1. Introduction

In C++ unit testing with GoogleTest and mocking with GoogleMock, assertions and matchers are fundamental tools to verify program behavior. This page helps you understand how to use the rich set of built-in assertions and matchers effectively, how to combine them to express complex expectations clearly, and how to write custom matchers for your specialized types.

Using assertions and matchers correctly saves you debugging time, clarifies test intentions, and makes failure diagnostics immediately actionable.

---

## 2. Understanding Assertions

Assertions verify conditions in your tests and report failures when expectations are violated. GoogleTest offers various assertion macros tailored for typical testing scenarios.

### Types of Assertions

- **Fatal Assertions (`ASSERT_*`)**: Abort the current function immediately upon failure.
- **Nonfatal Assertions (`EXPECT_*`)**: Report failure but let the current function continue.

### Core Assertion Macros

| Assertion        | Description                                                         | Typical Usage                           |
|------------------|---------------------------------------------------------------------|---------------------------------------|
| `EXPECT_TRUE(condition)`  | Verifies `condition` is true                                   | General boolean conditions             |
| `EXPECT_FALSE(condition)` | Verifies `condition` is false                                  | Control flow checks                    |
| `EXPECT_EQ(val1, val2)`   | Verifies `val1 == val2`                                       | Equality checks                       |
| `EXPECT_NE(val1, val2)`   | Verifies `val1 != val2`                                       | Inequality checks                    |
| `EXPECT_LT(val1, val2)`   | Verifies `val1 < val2`                                        | Ordering checks                      |
| `EXPECT_LE(val1, val2)`   | Verifies `val1 <= val2`                                       | Ordering checks, inclusive           |
| `EXPECT_GT(val1, val2)`   | Verifies `val1 > val2`                                        | Ordering checks                      |
| `EXPECT_GE(val1, val2)`   | Verifies `val1 >= val2`                                       | Ordering checks, inclusive           |
| `EXPECT_STREQ(str1, str2)`| Verifies `str1` and `str2` C strings have the same contents | C string equality                    |
| `EXPECT_STRNE(str1, str2)`| Verifies `str1` and `str2` C strings differ                   | C string inequality                  |
| `EXPECT_THROW(stmt, exception_type)` | Verifies `stmt` throws `exception_type`              | Exception testing                   |
| `EXPECT_NO_THROW(stmt)`   | Verifies `stmt` does not throw                                | Exception testing                   |

### Using `EXPECT_THAT` with Matchers

`EXPECT_THAT(value, matcher)` uses matchers for expressive assertions. Matchers produce detailed diagnostics when a test fails.

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(collection, ElementsAre(1, 2, 3));
EXPECT_THAT(number, AllOf(Gt(0), Lt(10)));
```

Matchers are introduced in detail in the next section.

---

## 3. Working with Matchers

Matchers allow you to specify *what* you expect in a natural, readable way. Each matcher tests a value or a group of values and supports detailing *why* a match failed.

### Built-in Matchers

GoogleMock includes a rich library of matchers. Some commonly used ones:

- `_`: Matches any value (wildcard matcher).
- `Eq(value)`: Matches values equal to `value`.
- `Ne(value)`: Matches values not equal to `value`.
- `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)`: Value ordering matchers.
- `StrEq(s)`, `StrNe(s)`: Matcher for string equality/inequality.
- `Contains(substring)`: Checks substring inclusion.
- `StartsWith(prefix)`, `EndsWith(suffix)`: String prefix/suffix match.
- `ElementsAre(...)`, `UnorderedElementsAre(...)`: Matchers for container contents.
- `Pointee(matcher)`: Matcher for the object pointed to by a pointer.

### Combining Matchers

Use combinators to express complex conditions:

- `AllOf(m1, m2, ...)`: Matches if all matchers succeed.
- `AnyOf(m1, m2, ...)`: Matches if any matcher succeeds.
- `Not(m)`: Matches if matcher `m` fails.

Example:

```cpp
EXPECT_CALL(mock, Method(AllOf(Gt(5), Ne(10))));
EXPECT_THAT(vec, AnyOf(ElementsAre(1, 2, 3), ElementsAre(4, 5)));
```

### Matching Multiple Arguments as a Whole

Sometimes you want to match arguments not individually but as a group. Use the `.With()` clause or `EXPECT_THAT` with multi-argument matchers (matchers over tuples):

```cpp
EXPECT_CALL(mock, Func(_, _))
    .With(Lt());  // The tuple of args matches Lt()
```

Use helper matchers like `Args<>` to specify selected arguments.

### Using Matchers in Code

Matchers are passed as arguments to `EXPECT_CALL()`, `ON_CALL()`, or `EXPECT_THAT()`. They must be *pure functions* with no side effects.

### Tip: Sharing Matchers

Because matchers are lightweight and copyable by pointer, you can assign complex matchers to variables and reuse them:

```cpp
Matcher<int> in_range = AllOf(Gt(5), Le(10));
EXPECT_CALL(mock, Foo(in_range));
EXPECT_CALL(mock, Bar(in_range));
```

---

## 4. Customizing Matchers

Sometimes built-in matchers are not enough. Defining custom matchers unlocks more expressive power.

### Defining Simple Matchers

Use the `MATCHER` macro when you want a matcher without parameters:

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Foo(IsEven()));
```

### Defining Parameterized Matchers

Use `MATCHER_P` for one-parameter matchers, `MATCHER_P2` for two, and so on:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "divided by divisor") {
  return (arg % divisor) == 0;
}

EXPECT_THAT(value, IsDivisibleBy(3));
```

### Writing Class-Based Matchers

For complex logic, implement the matcher interface with methods for matching and description.

### Best Practices

- Always provide a clear textual description in `DescribeTo` and `DescribeNegationTo`.
- Stream additional diagnostics during matching to help understanding failures.
- Keep matchers side-effect free.

---

## 5. Best Practices for Using Assertions and Matchers

- **Use matchers for clarity:** They make tests readable and failure messages informative.
- **Prefer `EXPECT_THAT` for complex matching:** It integrates well with GoogleMock matchers.
- **Use `_` as a wildcard when you don’t care about an argument’s value:** Keeps tests flexible and less brittle.
- **Set expectations explicitly and concisely:** Over-specification leads to brittle tests.
- **Avoid using `EXPECT_CALL` just to suppress warnings on uninteresting calls:** Use `ON_CALL` or `NiceMock` instead.
- **When expecting ordered calls, use `InSequence` or `After` to express dependencies explicitly.**
- **Write custom matchers when you need detailed control on argument validation and diagnostics.**

---

## 6. Examples

### Example 1: Using Matchers with EXPECT_THAT

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

std::string value1 = "Hello, World!";
std::string value2 = "Line 42";
int value3 = 7;

EXPECT_THAT(value1, StartsWith("Hello"));
EXPECT_THAT(value2, MatchesRegex("Line \\d+"));
ASSERT_THAT(value3, AllOf(Gt(5), Lt(10)));
```

If the first assertion fails, the failure message will say:
```
Value of: value1
  Actual: "Hi, world!"
Expected: starts with "Hello"
```

### Example 2: Using `.With()` Clause in EXPECT_CALL

```cpp
using ::testing::_;
using ::testing::Lt;
using ::testing::Return;

EXPECT_CALL(my_mock, SetPosition(_, _))
    .With(Lt())
    .WillOnce(Return(true));
```

This expects `SetPosition` to be called with two arguments where the first is less than the second.

### Example 3: Writing a Custom Matcher

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

EXPECT_CALL(mock, CheckNumber(IsDivisibleBy7()));
```

If the matcher fails, it will print:
```
Value of: number
Expected: is divisible by 7
  Actual: 23 (the remainder is 2)
```

### Example 4: Combining Matchers

```cpp
EXPECT_CALL(mock, ProcessNumber(AllOf(Gt(5), Ne(10))));
```
Matches if the argument is greater than 5 and not equal to 10.

---

## 7. Troubleshooting & Tips

- **Unmatched calls:** If a mock function call fails because no expectation matched the arguments, review your matchers and expected sequences carefully.
- **Too few or too many calls:** Adjust `.Times()` clauses. If unspecified, cardinality is inferred from `.WillOnce()` and `.WillRepeatedly()` clauses.
- **Ambiguous matches:** Make sure your expectations are ordered correctly; the last matching expectation takes precedence.
- **Uninteresting calls warnings:** Use `NiceMock` or specify `ON_CALL` for default actions instead of `EXPECT_CALL` just to suppress warnings.
- **Matcher purity:** Matchers must be pure. Do not produce side effects in matcher code as execution count and timing is not guaranteed.
- **Use verbosity flags:** Run tests with `--gmock_verbose=info` to get detailed matching and call tracing aiding in debugging failures.

---

## 8. Next Steps & Related Content

- Read the [Mocking Your First Method](https://google.github.io/googletest/guides/getting-started/mocking-your-first-method.html) guide to start writing mocks.
- Explore the [Matchers Reference](reference/matchers-reference.md) for a full list of built-in matchers.
- Learn about custom matchers in the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers).
- Review the [Assertions Reference](reference/assertions.md) for more assertion macros.
- Understand managing expectations and call ordering with [`InSequence`, `After`, and cardinalities`](reference/mocking.md#EXPECT_CALL).

---

## 9. References

- [GoogleTest Assertions Reference](reference/assertions.md)
- [GoogleMock Mocking Reference](reference/mocking.md)
- [GoogleMock Cheat Sheet](docs/gmock_cheat_sheet.md)
- [GoogleMock Cookbook - Writing New Matchers](docs/gmock_cook_book.md#NewMatchers)
- [Matchers Reference](reference/matchers-reference.md)

---

## 10. Summary

This guide equips you with the knowledge to harness GoogleTest’s assertion macros and GoogleMock’s matcher framework to build expressive and robust tests. By mastering built-in assertions, combining matchers, and defining custom matchers, you gain fine-grained control over test behavior verification and clearer failure diagnostics, driving more maintainable and effective test suites.

---
