---
title: "Using Assertions and Matchers"
description: "Explore the full range of assertions and matchers provided in GoogleTest and GoogleMock. Learn how to express test intent clearly, and choose the right assertion for each verification scenario."
---

# Using Assertions and Matchers

Explore the full range of assertions and matchers provided in GoogleTest and GoogleMock. Learn how to express test intent clearly and choose the right assertion for each verification scenario.

---

## 1. Overview of Assertions and Matchers

Assertions and matchers are the cornerstone for verifying conditions and validating behavior in tests using GoogleTest and GoogleMock. 

- **Assertions** decide whether a test succeeds or fails based on conditions.
- **Matchers** describe the expected properties of values or arguments with expressive predicates.

This guide focuses on helping you understand when and how to use the different assertions and matchers for clear, maintainable, and precise tests.

---

## 2. Prerequisites

Before using assertions and matchers effectively, ensure:

- GoogleTest (`#include <gtest/gtest.h>`) and GoogleMock (`#include <gmock/gmock.h>`) are installed and correctly integrated.
- You have defined your tests and optionally mocks if working with mock objects.
- Basic familiarity with test setup, mock creation, and GoogleTest test flows.

---

## 3. Key Assertions in GoogleTest

GoogleTest provides a comprehensive set of assertion macros to verify boolean conditions, compare values, check strings, handle exceptions, and more.

### 3.1 Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` — Verify a condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` — Verify a condition is false.

### 3.2 Value Comparison Assertions

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` — Check equality using `==`.
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` — Check inequality.
- Ordering comparisons: `EXPECT_LT`, `EXPECT_LE`, `EXPECT_GT`, `EXPECT_GE` for `<`, `<=`, `>`, `>=`.

### 3.3 String Assertions

Specialized macros for C strings:
- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ` — Compare C strings for equality.
- Case-insensitive variants: `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`.

### 3.4 Floating-Point Comparisons

For approximate equality:
- `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ` — for `float` and `double` respecting floating-point precision.
- `EXPECT_NEAR(val1, val2, abs_error)` — check difference within an absolute error.

### 3.5 Exception Assertions

Test code for throwing or not throwing exceptions:
- `EXPECT_THROW(statement, exception_type)`
- `EXPECT_ANY_THROW(statement)`
- `EXPECT_NO_THROW(statement)`

### 3.6 Predicate Assertions

For complex predicates:
- `EXPECT_PREDn(predicate, args...)` - Assert that predicate returns true for args.
- `EXPECT_PRED_FORMATn(pred_formatter, args...)` - Provide custom formatted failures for predicates.

### 3.7 Explicit Success or Failure

- Use `SUCCEED()` to indicate an explicit success point.
- Use `FAIL()` or `ADD_FAILURE()` for explicit failures within tests.

---

## 4. Using Matchers for Expressive Assertions

Matchers allow you to write human-readable, flexible assertions about values and mock call arguments.

### 4.1 Basic Matchers

- `_` matcher matches anything.
- `Eq(value)` checks for equality.
- `Ne(value)`, `Lt(value)`, `Le(value)`, `Gt(value)`, `Ge(value)` for relational checks.

### 4.2 Compound Matchers

- `AllOf(m1, m2, ...)` — All matchers must match.
- `AnyOf(m1, m2, ...)` — At least one matcher matches.
- `Not(m)` — The matcher does not match.

### 4.3 Container Matchers

- `ElementsAre(...)` — Check container elements exactly, in order.
- `UnorderedElementsAre(...)` — Check container elements exactly, any order.
- `Contains(matcher)` — Container has at least one element matching the matcher.
- `Each(matcher)` — All elements of the container satisfy the matcher.
- `SizeIs(n)` — Container size matches matchers.

### 4.4 Pointer and Object Matchers

- `Pointee(matcher)` — The value pointed to by a pointer matches.
- `Field(&Class::field, matcher)` — Matches object where a member field matches.
- `Property(&Class::GetProperty, matcher)` — Matches object where a property getter method matches.

### 4.5 Advanced Matchers

- `Truly(predicate)` — Write a custom predicate function or functor to use as a matcher.
- `MatcherCast<T>(m)` / `SafeMatcherCast<T>(m)` — Explicitly cast matchers to different types.

### 4.6 Using Matchers in Asserts

Use `EXPECT_THAT(value, matcher)` or `ASSERT_THAT(value, matcher)` to assert that `value` satisfies the matcher.

### 4.7 Writing Custom Matchers

You can define your own matchers using the `MATCHER` and `MATCHER_P*` macros to precisely express complex conditions.

---

## 5. Usage in Mock Expectations (GoogleMock)

GoogleMock integrates matchers deeply to specify expected arguments in mock method calls.

### 5.1 Setting Expectations

Use `EXPECT_CALL(mock_object, Method(matchers...))` to set expectations on mock methods.

### 5.2 Default vs Expected Behavior

- `ON_CALL(mock_object, Method(matchers...)).WillByDefault(action)` sets default behavior without expectation of being called.
- `EXPECT_CALL` both sets behavior and expects calls to happen.

### 5.3 Specifying Argument Matchers

You may specify precise or broad matchers for arguments to control how calls to mock methods are matched and verified.

### 5.4 Specifying Call Cardinalities

Control how many times a method is expected:
- `Times(n)`, `AtLeast(n)`, `AnyNumber()`, `Between(m, n)`, etc.
- Inferred based on `WillOnce` and `WillRepeatedly` if omitted.

### 5.5 Controlling Call Order

Using `InSequence` or the `.After()` clause, you can enforce calls to occur in specific sequences or partial orderings.

### 5.6 Actions

Within `WillOnce()` and `WillRepeatedly()`, specify what the mock method should do (e.g., return a value, invoke a callback).

---

## 6. Examples

### 6.1 Simple Assertion

```cpp
TEST(FactorialTest, PositiveNos) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_EQ(Factorial(2), 2);
  EXPECT_EQ(Factorial(3), 6);
  EXPECT_EQ(Factorial(8), 40320);
}
```

### 6.2 Matcher with EXPECT_THAT

```cpp
using ::testing::StartsWith;

std::string greeting = "Hello world";
EXPECT_THAT(greeting, StartsWith("Hello"));
```

### 6.3 Setting Expectations on a Mock Object

```cpp
using ::testing::Return;
using ::testing::_;

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};

TEST(PaintTest, MovesForward) {
  MockTurtle turtle;
  EXPECT_CALL(turtle, PenUp());
  EXPECT_CALL(turtle, Forward(100)).Times(1);

  turtle.PenUp();
  turtle.Forward(100);
}
```

### 6.4 Using Compound Matchers

```cpp
EXPECT_THAT(value, AllOf(Gt(5), Lt(10)));
```

---

## 7. Tips & Best Practices

- **Prefer Clear Intent Over Over-Specification:** Carefully choose matchers and cardinalities to avoid brittle tests.
- **Use `_` as a Wildcard:** When argument values don't matter.
- **Use `NiceMock` or `StrictMock` to Control Uninteresting Calls:** Suppress warnings or make uninteresting calls errors respectively.
- **Use `RetiresOnSaturation()` in sequences:** To retire expectations after their cardinality is met, avoiding errors in ordered sequences.
- **Write Custom Matchers for Reusable Complex Checks:** Use `MATCHER` macros for clarity.
- **Avoid Overly Complex Expectations:** Break down expectations and verify incrementally.

---

## 8. Troubleshooting Common Issues

- **Uninteresting Call Warnings:** Ignore or suppress with `NiceMock` when expected.
- **Unexpected Calls:** Check if arguments mismatch matchers or call order violated sequences.
- **Failed Cardinality:** Ensure your mock method is called the expected number of times.
- **Matchers Not Matching:** Run tests with `--gmock_verbose=info` to trace call matches.
- **Compile Errors Mocking Functions:** Confirm methods are `virtual` and `MOCK_METHOD` is used properly.

---

## 9. Next Steps & Related Documentation

- Explore [Mocking Techniques and Patterns](../core-workflows/mocking-techniques-and-patterns) for better mock usage.
- Deepen knowledge with [Matchers Reference](../../api-reference/mocking-api/matchers-reference).
- Build robust expectations using [Actions & Cardinalities](../../api-reference/mocking-api/actions-and-cardinalities).
- Review [Writing Your First Mock](../../guides/getting-started/writing-your-first-mock) and [Writing Your First Test](../../guides/getting-started/writing-your-first-test).
- Use [GoogleMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes.

---

For exhaustive reference and advanced techniques, consult the [Assertions Reference](../../api-reference/core-test-api/assertions-reference) and gMock documentation.

---

<Source url="https://github.com/google/googletest" branch="main" paths={[{"path": "docs/reference/assertions.md", "range": "#"},{"path": "docs/gmock_cook_book.md", "range": "#"},{"path": "docs/reference/mocking.md", "range": "#"},{"path": "docs/gmock_cheat_sheet.md", "range": "#"}]} />