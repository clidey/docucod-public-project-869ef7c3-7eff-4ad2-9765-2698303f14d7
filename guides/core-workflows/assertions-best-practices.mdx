---
title: "Assertions and Testing Patterns"
description: "Understand how to use the rich assertion macros in GoogleTest. Learn practical patterns for checking values, handling failures, and structuring expectations in daily testing tasks."
---

# Assertions and Testing Patterns

## Overview

This guide helps you harness the full power of GoogleTest's rich set of assertion macros. It covers practical patterns for verifying code behavior, handling success and failure cases explicitly, and structuring expectations to write robust, clear, and well-organized tests. Whether you're checking simple conditions or writing detailed death tests, this page focuses on how to apply assertions effectively to achieve confident and maintainable testing.

---

## Understanding Assertion Macros

GoogleTest assertions come mainly in pairs: `EXPECT_` and `ASSERT_`. Both check conditions but differ in failure behavior:

- **`EXPECT_` Assertions**: Produce *nonfatal* failures. The test continues executing, which is useful when you want to catch multiple errors within the same test.
- **`ASSERT_` Assertions**: Produce *fatal* failures. They abort the current test function immediately, used when continuing makes no sense, such as when a prerequisite fails.

All assertions print failure messages including the source code location by default. You can add custom failure messages using the `<<` stream operator.

### Basic Syntax

```cpp
EXPECT_TRUE(condition) << "Custom failure message if condition is false";
ASSERT_EQ(expected, actual) << "Expected and actual values differ";
```

These macros are your primary tools to verify behavior.

---

## Explicit Success and Failure

GoogleTest provides macros to explicitly signal success or failure, allowing better control in complex test flows.

- **`SUCCEED()`**: Generates a success message. It is mainly used for documentation within tests or to mark code paths as explicitly reached. Does *not* affect overall test result.

- **`FAIL()`**: Generates a fatal failure immediately and aborts the current test function.

- **`ADD_FAILURE()`**: Generates a nonfatal failure, allowing the test to continue.

- **`ADD_FAILURE_AT(file, line)`**: Generates a nonfatal failure at a specified file and line number.

#### Example:

```cpp
switch (result) {
  case Expected:
    SUCCEED() << "The expected case was reached.";
    break;
  default:
    FAIL() << "Unexpected result value!";
}
```

### Best Practices

- Use `FAIL()` only where continuing the test makes no sense.
- Use `ADD_FAILURE()` sparingly to avoid cluttering test results.

---

## Common Assertion Macros and Usage Patterns

### Boolean Condition Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Verifies that *condition* is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Verifies that *condition* is false.

### Binary Comparison Assertions

GoogleTest provides assertions to compare two values using standard operators.

| Macro        | Description                            |
|--------------|------------------------------------|
| `EXPECT_EQ(a, b)` / `ASSERT_EQ(a, b)` | Check `a == b`                   |
| `EXPECT_NE(a, b)` / `ASSERT_NE(a, b)` | Check `a != b`                   |
| `EXPECT_LT(a, b)` / `ASSERT_LT(a, b)` | Check `a < b`                    |
| `EXPECT_LE(a, b)` / `ASSERT_LE(a, b)` | Check `a <= b`                   |
| `EXPECT_GT(a, b)` / `ASSERT_GT(a, b)` | Check `a > b`                    |
| `EXPECT_GE(a, b)` / `ASSERT_GE(a, b)` | Check `a >= b`                   |

> **Note:** For C strings, use the specialized string comparison assertions below.

### String Comparison Assertions

These assert on C-style strings (null-terminated char arrays or wide strings), comparing content instead of pointer values.

| Macro                      | Description                          |
|----------------------------|------------------------------------|
| `EXPECT_STREQ(s1, s2)` / `ASSERT_STREQ(s1, s2)`   | Checks strings are equal           |
| `EXPECT_STRNE(s1, s2)` / `ASSERT_STRNE(s1, s2)`   | Checks strings are not equal       |
| `EXPECT_STRCASEEQ(s1, s2)` / `ASSERT_STRCASEEQ(s1, s2)` | Checks strings equal ignoring case |
| `EXPECT_STRCASENE(s1, s2)` / `ASSERT_STRCASENE(s1, s2)` | Checks strings differ ignoring case |


### Floating-Point Comparisons

Due to rounding errors in floating-point numbers, special macros compare with appropriate tolerance:

- `EXPECT_FLOAT_EQ(a, b)` / `ASSERT_FLOAT_EQ(a, b)`: Checks two `float` values approximately equal
- `EXPECT_DOUBLE_EQ(a, b)` / `ASSERT_DOUBLE_EQ(a, b)`: Checks two `double` values approximately equal
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`: Checks difference is within the specified absolute error

These assertions ensure that floating-point comparisons reflect practical equivalence, not bit-for-bit equality.

### Exception Assertions (when exceptions are enabled)

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(statement, exception_type)`: Verifies that `statement` throws the specified exception.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(statement)`: Verifies that `statement` throws any exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(statement)`: Verifies that `statement` does not throw.

### Death Assertions (for death tests)

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH(statement, matcher)`: Verifies process exits and outputs an error matching `matcher`.
- `EXPECT_EXIT(statement, predicate, matcher)` / `ASSERT_EXIT(statement, predicate, matcher)`: Verifies process exits satisfying `predicate` and outputs matching `matcher`.

Usage examples are found in the [Advanced Guide](docs/advanced.md#death-tests).

---

## Using Generalized Assertions with Matchers

GoogleTest supports matchers allowing you to express more complex conditions clearly.

- Use `EXPECT_THAT(value, matcher)` / `ASSERT_THAT(value, matcher)` to check `value` against a [matcher](reference/matchers.md).

Matchers enable readable test conditions and generate detailed failure messages.

Example:

```cpp
#include <gmock/gmock.h>  // for matchers
using ::testing::StartsWith;
using ::testing::MatchesRegex;

EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_string, MatchesRegex("Line \d+"));
```

---

## Predicate Assertions: For Complex Logical Checks

If you have functions or predicates returning `bool`, GoogleTest provides macros to easily integrate with assertions while printing detailed failure messages.

- `EXPECT_PREDn(pred, ...)` / `ASSERT_PREDn(pred, ...)`: Assert a predicate function returns true with `n` arguments.
- `EXPECT_PRED_FORMATn(pred_formatter, ...)` / `ASSERT_PRED_FORMATn(pred_formatter, ...)`: Assert with a predicate-formatter for customized failure messages.

This approach helps when you need to check custom conditions with descriptive error outputs.

Example:

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, 4);  // Succeeds
EXPECT_PRED1(IsEven, 5);  // Fails and prints the arguments
```

For a predicate-formatter:

```cpp
testing::AssertionResult AssertIsEven(const char* expr, int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " evaluates to " << n << ", which is not even.";
}
EXPECT_PRED_FORMAT1(AssertIsEven, 5);  // Produces custom failure message
```

---

## Practical Testing Patterns

### Choosing Between `EXPECT_` and `ASSERT_`

- Use `EXPECT_` when you want the test to report a failure but continue checking other conditions within the same test.
- Use `ASSERT_` when failure means the test cannot proceed safely, e.g., when checking pointers before dereferencing.

### Streaming Custom Messages

Add context to failures with streaming:

```cpp
EXPECT_EQ(value, expected) << "Value did not match expected; index: " << i;
```

### Avoiding Side Effects in Assertions

Ensure that expressions passed to assertions have no side effects or that side effects have no effect on test determinism since macros evaluate arguments exactly once.

### Skipping Tests Conditionally

Use `GTEST_SKIP()` to skip tests at runtime if preconditions are not met.

### Recording Test Properties

Enhance XML and JSON reports with additional key/value data using `RecordProperty(key, value)`.

Example:

```cpp
TEST(MyTest, Sample) {
  RecordProperty("MaxValue", 100);
  EXPECT_TRUE(Check());
}
```

---

## Troubleshooting Common Issues

- **Assertion failure without clear message?** Use predicate assertions (`EXPECT_PRED*`) or `ASSERT_*` with streaming messages.
- **Using assertions in non-void functions?** Fatal assertions (`ASSERT_*`) must be in void-returning functionsâ€”use `EXPECT_*` or restructure functions.
- **Unchecked return of `RUN_ALL_TESTS()`?** Always return its value from `main`.
- **Death tests hanging or failing?** Run them in isolation and ensure you follow death test guidelines in [Advanced Guide](docs/advanced.md#death-tests).

---

## Next Steps and Related Content

- Explore writing your tests with the [GoogleTest Primer](docs/primer.md).
- Learn detailed idioms and best practices in the [Advanced Topics](docs/advanced.md#more-assertions).
- Use parameterized and typed tests to reuse test logic ([Testing Reference](docs/reference/testing.md#TEST_P)).
- Integrate mocks to simulate behavior in complex systems ([Mocking Reference](docs/reference/mocking.md)).
- Understand interpreting failure messages and adding traces with [SCOPED_TRACE](docs/advanced.md#adding-traces-to-assertions).

---

## References

- [Assertions Reference](reference/assertions.md)
- [GoogleTest Primer](primer.md)
- [Advanced GoogleTest Topics](advanced.md)
- [Testing Reference](reference/testing.md)
- [Mocking Reference](reference/mocking.md)
- [Using Matchers](guides/core-workflows/using-matchers)

---

## Summary

This page introduces you to the comprehensive set of GoogleTest assertion macros, including basic boolean checks, value comparisons, string checks, floating-point comparisons, exception and death tests, and advanced predicate assertions. You will learn when and how to use `EXPECT_` vs `ASSERT_`, how to manage explicit successes and failures, and how to write complex assertions with custom messages and predicate-formatters. Practical patterns promote readable, maintainable, and robust testing code.

For a deep dive on writing tests that leverage assertions effectively, visit the [GoogleTest Primer](docs/primer.md) and the [Advanced Topics](docs/advanced.md#more-assertions). To integrate user-friendly error messages and flexible condition checks, explore predicate assertions and generalized matchers.

Continue your testing mastery by exploring related pages on parameterized tests, test fixtures, and mocking to build powerful, scalable C++ test suites.