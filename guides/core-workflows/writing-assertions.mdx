---
title: "Mastering Assertions: Standard and Custom"
description: "Deep dive into GoogleTest’s assertion framework. Learn the difference between fatal and non-fatal failures, how to use built-in assertion macros, and ways to create powerful user-defined assertions that make your tests expressive and robust."
---

# Mastering Assertions: Standard and Custom

Explore GoogleTest's rich assertion framework to write effective, expressive unit tests for C++. This guide covers the difference between fatal and non-fatal failures, practical use of built-in assertion macros, and detailed steps to create powerful user-defined assertions. By the end, you'll know how to apply assertions to verify code correctness precisely and understand how to extend assertion behavior for complex scenarios.

---

## 1. Understanding Assertions in GoogleTest

Assertions are your primary tool for verifying test conditions in GoogleTest. They evaluate expressions and report successes or failures based on the result.

### 1.1 Fatal vs Non-Fatal Failures

- **Fatal failures (`ASSERT_` macros):** These immediately abort the current function, skipping any subsequent code inside it. Use these when continuing the test after failure could cause undefined behavior.

- **Non-fatal failures (`EXPECT_` macros):** These report failures but allow the test function to continue running. Use when you want to collect multiple failure reports in one test run.

### 1.2 When to Use Which

Choose `ASSERT_` when a failure invalidates further test logic or setup. Use `EXPECT_` for checking multiple conditions independently in a test.

<Callout title="Tip" type="info">
  Avoid mixing `ASSERT_` and `EXPECT_` on the same logical check. Be deliberate about test flow continuation.
</Callout>

## 2. Using Built-In Assertion Macros

GoogleTest provides a comprehensive set of assertion macros for various verification needs. They come mostly in `EXPECT_` and `ASSERT_` pairs.

### 2.1 Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` — Checks that a condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` — Checks that a condition is false.

```cpp
EXPECT_TRUE(x > 0) << "x must be positive";
ASSERT_FALSE(ptr == nullptr) << "Pointer must not be null";
```

### 2.2 Equality and Comparison Assertions

For comparing values, use:

- Equality: `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`
- Inequality: `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`
- Less/Greater than or equal: `EXPECT_LE`, `EXPECT_LT`, `EXPECT_GE`, `EXPECT_GT`

```cpp
ASSERT_EQ(expected_count, actual_count);
EXPECT_LT(value, 100);
```

> **Important:** For C strings (`char*` or wide strings), use specific string assertions like `EXPECT_STREQ` and `EXPECT_STRCASEEQ` to compare content rather than pointer addresses.

### 2.3 String Comparison

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` — Checks if two C strings are equal.
- `EXPECT_STRNE`, `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE` — Case-sensitive/insensitive variants.

```cpp
EXPECT_STREQ("hello", received_cstring);
```

### 2.4 Floating-Point Assertions

Use specialized macros to deal with precision challenges:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ` — Approximate equality for floats
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ` — Approximate equality for doubles
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR` — Checks that *val1* and *val2* are within an absolute error margin

```cpp
EXPECT_NEAR(calculated_value, expected_value, 1e-5);
```

### 2.5 Exception Assertions

If your build supports exceptions, verify throwing behavior:

- `EXPECT_THROW(statement, exception_type)`
- `EXPECT_ANY_THROW(statement)`
- `EXPECT_NO_THROW(statement)`

```cpp
EXPECT_THROW(MyFunction(), std::runtime_error);
EXPECT_NO_THROW(MySafeFunction());
```

### 2.6 Death Assertions (Testing Process Termination)

Use these to test code paths that terminate the program:

- `EXPECT_DEATH(statement, regex)`
- `EXPECT_EXIT(statement, predicate, regex)`

```cpp
EXPECT_DEATH(DangerousFunction(), "Segmentation fault");
```

## 3. Advanced Assertions and Matchers

### 3.1 Using `EXPECT_THAT` with Matchers

`EXPECT_THAT(value, matcher)` integrates GoogleMock-style matchers for expressive, readable assertions.

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;

EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(code_line, MatchesRegex("\d+"));
```

Matchers add semantic clarity and detailed failure messages.

### 3.2 Predicate Assertions

For reusable complex conditions, you can write:

- `EXPECT_PRED1`, ..., `EXPECT_PRED_FORMAT2`, etc.

These allow invoking custom predicate functions and printing clear failure diagnostics.

```cpp
bool IsEven(int n) { return n % 2 == 0; }
EXPECT_PRED1(IsEven, value);
```

### 3.3 Custom User-Defined Assertions

Create expressive domain-specific checks with:

- Custom matcher classes implementing the matcher interface.
- Using `MATCHER` and `MATCHER_P*` macros for concise matcher definitions.

```cpp
MATCHER(IsDivisibleBy7, "checks divisibility by 7") {
  return (arg % 7) == 0;
}
EXPECT_THAT(21, IsDivisibleBy7());
```

Use `result_listener` to provide additional failure information inside the matcher.

## 4. Crafting Custom Assertions

### 4.1 Introduction

Sometimes built-in assertions are insufficient for complex logic. Custom asserts and matchers allow precise validation.

### 4.2 Basic Custom Matcher Example

```cpp
MATCHER(IsEven, "value is even") {
  if (arg % 2 == 0) return true;
  *result_listener << "which is odd";
  return false;
}

EXPECT_THAT(my_value, IsEven());
```

### 4.3 Parameterized Matchers

Create matchers accepting parameters via `MATCHER_P`.

```cpp
MATCHER_P(IsMultipleOf, factor, "is a multiple of") {
  return (arg % factor) == 0;
}
EXPECT_THAT(val, IsMultipleOf(5));
```

### 4.4 Defining Matcher Classes

For full control, implement the matcher interface:

```cpp
class PositiveMatcher {
 public:
  using is_gtest_matcher = void;

  bool MatchAndExplain(int n, std::ostream* os) const {
    if (n > 0) return true;
    if (os) *os << "is " << n << ", which is not positive";
    return false;
  }
  void DescribeTo(std::ostream* os) const { *os << "is positive"; }
  void DescribeNegationTo(std::ostream* os) const { *os << "is not positive"; }
};

::testing::Matcher<int> IsPositive() { return PositiveMatcher(); }

EXPECT_THAT(value, IsPositive());
```

## 5. Best Practices and Tips

- Use `ASSERT_` when failing further tests might cause crashes or undefined states.
- Prefer `EXPECT_` for multiple, independent checks per test.
- Use `EXPECT_THAT` with matchers for readable and maintainable assertions.
- Avoid over-specifying argument matchers to keep tests resilient.
- Provide custom failure messages with `<<` streaming for context.
- Define custom matchers for reusable, domain-specific validation logic.
- Include logging or side effects sparingly in matchers (must be pure functions).

## 6. Troubleshooting Common Issues

### 6.1 Assertion Fails Unexpectedly

- Verify the tested expression corresponds exactly to expected behavior.
- Use the `--gtest_break_on_failure` flag to pause tests at failure points.

### 6.2 Pointers and Strings Comparison

- Remember `EXPECT_EQ` compares pointer addresses for C strings, use `EXPECT_STREQ` for content equality.

### 6.3 Floating-Point Precision

- Use `EXPECT_NEAR`, `EXPECT_FLOAT_EQ`, or `EXPECT_DOUBLE_EQ` to avoid false failures due to rounding errors.

### 6.4 Matching Complex Objects

- Implement custom `operator<<` for your types to ensure diagnostic messages are informative.

## 7. Next Steps & Further Exploration

- Explore [Assertions Reference](https://google.github.io/googletest/reference/assertions.html) for detailed macro usage.
- Discover how to integrate assertions into mock tests with [Mocking Reference](https://google.github.io/googletest/reference/mocking.html).
- Advance your skills by learning to write Parameterized and Death Tests.
- Investigate [Custom Matchers and Actions](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers) for higher test expressiveness.

---

## Appendix: Quick Assertion Examples

```cpp
// Fatal failure
ASSERT_EQ(expected, actual) << "Expected and actual values mismatch";

// Non-fatal failure
EXPECT_TRUE(condition) << "Condition failed";

// String equality
EXPECT_STREQ("hello", my_string.c_str());

// Floating point near equality
EXPECT_NEAR(3.14, computed_value, 0.01);

// Matching with custom matcher
EXPECT_THAT(vec, ElementsAre(1, 2, 3));
```

---

For comprehensive code snippets, usage syntax, and detailed guidance, consult GoogleTest's [Assertions Reference](https://google.github.io/googletest/reference/assertions.html) and [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html).
