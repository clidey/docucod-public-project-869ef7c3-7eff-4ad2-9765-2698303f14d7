---
title: "Writing Powerful Assertions"
description: "Explains the full range of assertions available in GoogleTest, including basic, advanced, and user-defined options. Provides practical examples and their best-fit scenarios."
---

# Writing Powerful Assertions

This guide explores the comprehensive assertion capabilities provided by GoogleTest, focusing on how to write powerful assertions in your tests. It covers basic assertions, advanced assertions, and user-defined assertions with practical examples and guidance on when to best apply them.

---

## 1. Understanding Assertions in GoogleTest

Assertions are the backbone of test verification in GoogleTest. They confirm that the code under test behaves as expected by evaluating conditions and reporting failures when conditions are violated.

GoogleTest provides a rich set of assertion macros that cover various use cases:

- **Basic Assertions** like `EXPECT_EQ()`, `ASSERT_TRUE()`, etc., to check simple conditions.
- **Predicate Assertions** for verifying complex predicates.
- **Exception Assertions** to verify exception-throwing behavior.
- **String Assertions** for content-based string comparison.
- **Floating-Point Assertions** to deal with approximate equality.

GoogleTest assertions come in pairs: `EXPECT_` variants generate nonfatal failures (allowing tests to continue), while `ASSERT_` variants generate fatal failures (immediately aborting the current test function).

<Tip>
Use `EXPECT_` when you want your test to continue even if the assertion fails, and `ASSERT_` when the failure indicates that further test execution is meaningless.
</Tip>

---

## 2. Basic Assertions

### Common Macros

| Macro       | Purpose                                  |
|-------------|------------------------------------------|
| `EXPECT_TRUE` / `ASSERT_TRUE` | Verifies a condition is true.          |
| `EXPECT_FALSE` / `ASSERT_FALSE` | Verifies a condition is false.         |
| `EXPECT_EQ` / `ASSERT_EQ`       | Checks equality of two values (uses `==`). |
| `EXPECT_NE` / `ASSERT_NE`       | Checks inequality of two values.        |
| `EXPECT_LT` / `ASSERT_LT`       | Checks less-than relation.               |
| `EXPECT_LE` / `ASSERT_LE`       | Checks less-than-or-equal relation.     |
| `EXPECT_GT` / `ASSERT_GT`       | Checks greater-than relation.            |
| `EXPECT_GE` / `ASSERT_GE`       | Checks greater-than-or-equal relation.  |

### Usage Examples

```cpp
EXPECT_EQ(foo, bar) << "foo and bar should be equal";
ASSERT_TRUE(IsValid(foo)) << "foo is invalid!";
EXPECT_LT(count, 10);
```

Assertions can stream additional failure message information using the `<<` operator.

### Best Practice

- Use assertions to check the correctness of return values, state changes, and any invariants your code must maintain.
- Favor `EXPECT_` over `ASSERT_` when possible to allow multiple verifications per test.
- Use `ASSERT_` when subsequent test code depends on the assertion being successful.

---

## 3. String Assertions

Strings require special assertions since `EXPECT_EQ` on C strings only compares pointers, not content.

| Macro             | Purpose                                          |
|-------------------|--------------------------------------------------|
| `EXPECT_STREQ` / `ASSERT_STREQ` | Checks whether two C strings have the same contents. |
| `EXPECT_STRNE` / `ASSERT_STRNE` | Checks whether two C strings differ.               |
| `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ` | Case-insensitive string equality check.        |
| `EXPECT_STRCASENE` / `ASSERT_STRCASENE` | Case-insensitive string inequality check.     |

### Usage Example

```cpp
EXPECT_STREQ(actual_cstr, expected_cstr);
EXPECT_STRCASEEQ(user_input, "admin");
```

---

## 4. Floating-Point Assertions

Floating-point comparisons use approximate equality to account for rounding errors.

| Macro             | Purpose                                            |
|-------------------|----------------------------------------------------|
| `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ` | Checks approximate equality of `float`s.          |
| `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ` | Checks approximate equality of `double`s.         |
| `EXPECT_NEAR` / `ASSERT_NEAR`           | Checks numbers are within a specified absolute error. |

### Usage Example

```cpp
EXPECT_FLOAT_EQ(computed_value, expected_value);
ASSERT_NEAR(measured, target, 1e-5);
```

### Best Practices

- Use these when exact equality is not guaranteed but values are expected to be close.
- Choose tolerances carefully based on domain knowledge.

---

## 5. Predicate Assertions

Sometimes you want to verify custom conditions or complex predicates, where basic binary comparisons are insufficient.

- Use macros `EXPECT_PRED1`, `EXPECT_PRED2`, ..., `ASSERT_PRED1`, etc., to check predicates with up to 5 arguments.
- When you want custom failure messages and control, use `EXPECT_PRED_FORMATn` macros with a predicate-formatter function.

### Example

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, value);

// Custom failure message
testing::AssertionResult IsPositiveMessage(const char* expr, int val) {
  if (val > 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << expr << " is not positive";
}
EXPECT_PRED_FORMAT1(IsPositiveMessage, some_value);
```

---

## 6. Writing Custom Assertions

For more complex verification, you can define your own assertions that combine matchers and custom logic.

- Use `MATCHER`, `MATCHER_P`, or define a custom matcher class to enable expressive failure messages.
- Combine matchers using logical constructs like `AllOf()`, `AnyOf()`, and `Not()`.

### Basic Matcher Example

```cpp
MATCHER(IsDivisibleBy7, "is divisible by 7") {
  return (arg % 7) == 0;
}
EXPECT_THAT(value, IsDivisibleBy7());
```

### Parameterized Matcher

```cpp
MATCHER_P(InClosedRange, range, "checks if in closed range") {
  return arg >= range.first && arg <= range.second;
}
EXPECT_THAT(x, InClosedRange(std::make_pair(5, 10)));
```

### Benefits

- Provides clear, user-friendly failure diagnostics.
- Enhances test expressiveness.

---

## 7. Practical Tips for Writing Assertions

- Prefer `EXPECT_THAT()` with matchers for complex argument checks.
- Avoid over-specification; assert only what matters to the test.
- Use `With()` clause in mock expectations to constrain argument tuples holistically.
- Combine multiple `WillOnce()` actions with matching `.Times()` or sequences to control behavior precisely.

<Tip>
Use carefully crafted assertions to detect failures early and provide actionable diagnostics, improving test reliability and maintainability.
</Tip>

---

## 8. Examples

### Basic Assertion

```cpp
TEST(FooTest, BasicAssertions) {
  int x = 5;
  int y = 5;
  EXPECT_EQ(x, y) << "x and y should be equal";
  EXPECT_TRUE(x == y);
}
```

### Assert String Equality

```cpp
TEST(MyTest, StringComparison) {
  const char* expected = "hello";
  const char* actual = "hello";
  EXPECT_STREQ(actual, expected);
}
```

### Floating-Point Approximate Equality

```cpp
TEST(MyTest, FloatEq) {
  float value = 0.1f + 0.2f;
  EXPECT_FLOAT_EQ(value, 0.3f);
}
```

### Predicate Assertion

```cpp
bool IsNonNegative(int n) { return n >= 0; }

TEST(MyTest, Predicate) {
  int val = 5;
  EXPECT_PRED1(IsNonNegative, val);
}
```

### Custom Matcher

```cpp
MATCHER_P(IsMultipleOf, factor, "is multiple of given factor") {
  return arg % factor == 0;
}

TEST(MyTest, CustomMatcher) {
  EXPECT_THAT(14, IsMultipleOf(7));
}
```

---

## 9. Troubleshooting Assertions

### Problem: Assertion Does Not Trigger

- Ensure your test executes the code path that hits the assertion.
- Verify that the assertion predicate is correctly formulated.

### Problem: Too Many Failures from One Assertion

- Check if assertion is `EXPECT_` and not `ASSERT_` where continuation causes cascading failures.

### Problem: Floating-Point Failures Due to Precision

- Use `EXPECT_NEAR`, `EXPECT_FLOAT_EQ`, or `EXPECT_DOUBLE_EQ` instead of exact equality.

### Problem: Confusing Failure Messages

- Use more descriptive assertion messages with the streaming operator `<<`.
- Use custom matchers to clarify intent.

---

## 10. Next Steps & Related Content

- Explore [Using and Customizing Matchers](/guides/core-workflows/using-matchers) to master argument matching in expectations.
- Read [Mocking Best Practices](/guides/core-workflows/mocking-best-practices) for efficient test writing.
- Review the [Assertions Reference](../../api-reference/core-testing-apis/assertions.md) for a comprehensive list of macros.
- Try [Your First Unit Test](/guides/getting-started/first-unit-test) to apply these concepts in actual code.

---

## Additional Resources

- [GoogleTest Assertions Reference](https://google.github.io/googletest/reference/assertions.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html#NewMatchers)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)

---