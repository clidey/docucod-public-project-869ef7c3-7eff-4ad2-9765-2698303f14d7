---
title: "Writing Effective Assertions"
description: "Comprehensive guide to GoogleTest's built-in assertions—covering equality, inequality, exceptions, fatal and non-fatal failures, and custom assertions. Teaches practical usage and when to use each pattern."
---

# Writing Effective Assertions

Comprehensive guide to GoogleTest's built-in assertions—covering equality, inequality, exceptions, fatal and non-fatal failures, and custom assertions. Learn practical usage and when to use each pattern effectively.

---

## 1. Introduction

GoogleTest provides a rich set of **assertions** which form the core of verifying expected behavior in tests. Assertions are statements that check whether a condition holds true during test execution. If an assertion fails, GoogleTest reports a failure with detailed diagnostics.

This guide focuses specifically on **writing assertions in tests**. It explains the types of assertions available, when to choose certain types, and how to write custom assertions where built-in ones don't suffice.


## 2. Understanding Assertions in GoogleTest

### 2.1 What are Assertions?

Assertions verify conditions in tests. They come in two major flavors:

- **Fatal Assertions**: Immediately abort the current test function upon failure.
- **Non-Fatal Assertions**: Report the failure but continue executing the test function.

### 2.2 When to Use Each

- Use *fatal* assertions when proceeding further after failure is meaningless (e.g., basic preconditions).
- Use *non-fatal* assertions when you want to record multiple failures in the same test iteration.

<Tip>
Consider starting with non-fatal assertions for validating multiple related conditions in a single test to get the most comprehensive feedback.
</Tip>

## 3. Built-In Assertion Macros

GoogleTest provides a variety of macros to check different conditions. Here are the primary groups:

### 3.1 Equality and Inequality

Use these to compare values or expressions.

| Assertion       | Checks for                                  | Example                                   |
|-----------------|---------------------------------------------|-------------------------------------------|
| `EXPECT_EQ`     | Equality (`==`)                             | `EXPECT_EQ(expected, actual);`            |
| `ASSERT_EQ`     | Equality (fatal)                            | `ASSERT_EQ(expected, actual);`            |
| `EXPECT_NE`     | Inequality (`!=`)                           | `EXPECT_NE(unexpected, actual);`          |
| `ASSERT_NE`     | Inequality (fatal)                          | `ASSERT_NE(unexpected, actual);`          |
| `EXPECT_STREQ`  | C-string equality                          | `EXPECT_STREQ("foo", actual_cstr);`     |
| `EXPECT_STRNE`  | C-string inequality                        | `EXPECT_STRNE("foo", actual_cstr);`     |

### 3.2 Boolean Conditions

| Assertion       | Checks                                   | Example                                 |
|-----------------|------------------------------------------|-----------------------------------------|
| `EXPECT_TRUE`   | Condition is `true`                      | `EXPECT_TRUE(condition);`               |
| `ASSERT_TRUE`   | Condition is `true` (fatal)              | `ASSERT_TRUE(condition);`               |
| `EXPECT_FALSE`  | Condition is `false`                     | `EXPECT_FALSE(condition);`              |
| `ASSERT_FALSE`  | Condition is `false` (fatal)             | `ASSERT_FALSE(condition);`              |

### 3.3 Exception Assertions

| Assertion         | Description                                | Example                                   |
|-------------------|--------------------------------------------|-------------------------------------------|
| `EXPECT_THROW`    | Expects statement to throw an exception   | `EXPECT_THROW(func(), std::runtime_error);` |
| `EXPECT_NO_THROW` | Expects no exception thrown                 | `EXPECT_NO_THROW(func());`                  |
| `EXPECT_ANY_THROW`| Expects any exception to be thrown         | `EXPECT_ANY_THROW(func());`                  |

### 3.4 Additional Common Assertions

| Assertion             | Description                          | Example                           |
|-----------------------|------------------------------------|-----------------------------------|
| `EXPECT_NEAR`         | Compares floating-point values within a tolerance | `EXPECT_NEAR(3.14, val, 0.01);`    |
| `EXPECT_THROW_BYDEATH`| Checks if code causes program abort (death test) | `EXPECT_DEATH(func(), "error");`|

### 3.5 Using `EXPECT_*` vs `ASSERT_*`

- `EXPECT_*` macros are **non-fatal assertions**: test continues after failure.
- `ASSERT_*` macros are **fatal assertions**: test aborts immediately after failure.

For example, prefer `ASSERT_*` if further test steps rely on the condition being true.


## 4. Writing Custom Assertions

Sometimes built-in assertions aren't enough, especially when you want to validate complex conditions or provide more meaningful diagnostics.

GoogleTest allows defining custom assertions following these forms:

### 4.1 Defining Boolean Assertion Functions

Write a function or functor that returns `bool` and provides an output message on failure.

Example:

```cpp
// Custom assertion: checks if x is even
::testing::AssertionResult IsEven(int x) {
  if (x % 2 == 0) {
    return ::testing::AssertionSuccess();
  } else {
    return ::testing::AssertionFailure() << x << " is not even";
  }
}

TEST(MyTest, EvenCheck) {
  EXPECT_PRED_FORMAT1(IsEven, 4);  // Passes
  EXPECT_PRED_FORMAT1(IsEven, 3);  // Fails with message
}
```

### 4.2 Using `ASSERT_PRED_FORMAT` and `EXPECT_PRED_FORMAT`

Many macros allow using predicate-format functions like above to enable writing expressive custom checks.

### 4.3 Using `EXPECT_THAT` with Matchers

GoogleTest and GoogleMock support powerful matchers for complex assertions, including containers, pointers, exceptions, composition, etc. Use `EXPECT_THAT(value, matcher)` for expressive assertions with detailed diagnostics.

For example:

```cpp
using ::testing::ElementsAre;
EXPECT_THAT(my_vector, ElementsAre(1, 2, 3));
```

See [Matchers Reference](reference/matchers.md) for a full list.


## 5. Practical Tips & Best Practices

- **Write clear, intention-revealing assertions**—prefer specialized matchers to generic boolean checks.
- **Minimize test brittleness** by avoiding overly strict matching of arguments or call counts.
- **Use sequences and ordering only if necessary**, to reduce maintenance overhead.
- **Use fatal assertions for critical failures** to avoid obscure cascading errors.
- **Leverage `EXPECT_THAT` and matchers** for more expressive and maintainable tests.
- **Avoid writing tests with side effects inside assertions.**

<Tip>
If you see warnings about uninteresting calls when using mocks, check if you need to add explicit expectations or use `NiceMock`.
</Tip>


## 6. Illustrative Examples

### 6.1 Basic Equality Assertion

```cpp
TEST(SampleTest, Equality) {
  int expected = 5;
  int actual = ComputeValue();

  EXPECT_EQ(expected, actual) << "Value mismatch";
}
```

### 6.2 Exception Assertion

```cpp
TEST(SampleTest, ThrowsOnError) {
  EXPECT_THROW({ ProcessInvalidInput(); }, std::invalid_argument);
}
```

### 6.3 Custom Predicate Assertion

```cpp
::testing::AssertionResult IsPrime(int n) {
  if (n <= 1) return ::testing::AssertionFailure() << n << " is not prime";
  for (int i = 2; i * i <= n; ++i) {
    if (n % i == 0) return ::testing::AssertionFailure() << n << " is divisible by " << i;
  }
  return ::testing::AssertionSuccess();
}

TEST(NumberTest, PrimeCheck) {
  EXPECT_PRED_FORMAT1(IsPrime, 7);
  EXPECT_PRED_FORMAT1(IsPrime, 10);
}
```

### 6.4 Using Matchers

```cpp
#include <gmock/gmock.h>
using ::testing::HasSubstr;
using ::testing::MatchesRegex;

TEST(StringTest, MatcherExample) {
  std::string hostname = "www.example.com";

  EXPECT_THAT(hostname, HasSubstr("example"));
  EXPECT_THAT(hostname, MatchesRegex("www\\..+\\.com"));
}
```


## 7. Troubleshooting & Common Issues

### 7.1 Assertions Not Failing When Expected

- Check if you used `EXPECT_*` (non-fatal) instead of `ASSERT_*` (fatal) where fatal is needed.
- Verify all prerequisite setup steps are met before the assertion.
- Use `--gmock_verbose=info` flag to get detailed mock call traces when debugging mock-related assertions.

### 7.2 Unclear Failure Messages

- Use custom assertion predicates to add informative messages.
- Use `EXPECT_THAT` and matchers for richer diagnostics.

### 7.3 Overly Strict Assertions

- Loosen matchers or use `_` to avoid brittle tests.
- Apply `RetiresOnSaturation()` for expectations that should retire after use.


## 8. Related Documentation & Next Steps

- [GoogleTest Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Matchers Reference](reference/matchers.md)
- [gMock Cookbook](gmock_cook_book.md) — for advanced mocking and custom assertions
- [Writing Your First Test](guides/getting-started/first-test.md) — for basic example

Explore the "Core Testing Workflows" section for deeper insights:

- Writing Effective Assertions
- Using Test Fixtures for Reusable Setups
- Parameterized and Typed Tests


---

##### Troubleshooting Tip
If errors about uninteresting calls or unexpected calls arise during assertions, review your mock expectations or consider adjusting the verbosity of GoogleMock messages using the `--gmock_verbose` flag.


---

_End of Writing Effective Assertions Guide._