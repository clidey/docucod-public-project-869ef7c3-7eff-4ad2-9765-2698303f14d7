---
title: "Mocking Functions and Objects"
description: "Learn how to use GoogleMock to create mock classes, set expectations on functions, and define behaviors for dependencies when testing your code. This guide features realistic scenarios to cement practical mocking techniques."
---

# Mocking Functions and Objects

## Workflow Overview

### Task Description
Learn how to create mock classes in GoogleMock, set expectations on mock functions, and control mock object behaviors during testing. This guide empowers you to mimic dependencies, isolate test scenarios, and verify interactions in your C++ code.

### Prerequisites
- Basic familiarity with C++ and virtual functions.
- GoogleMock integrated into your project (`#include <gmock/gmock.h>`).
- An interface or base class with virtual methods to mock.

### Expected Outcome
By completing this guide, you'll be able to:
- Define mock classes using the `MOCK_METHOD` macro.
- Set expectations on method calls with `EXPECT_CALL`.
- Specify default behaviors with `ON_CALL`.
- Handle complex mocking scenarios like const methods, overloaded methods, templated mocks, and uninteresting calls.

### Time Estimate
15-30 minutes for basic mock class creation and understanding expectations.

### Difficulty Level
Beginner to Intermediate

---

## Step-by-Step Instructions

### 1. Define a Mock Class
Mock classes imitate real classes' interfaces for testing purposes.

- **Create a mock subclass** inheriting from the interface or base class.
- In the `public:` section, use the `MOCK_METHOD` macro for each method you want to mock.

#### Syntax Example
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));
};
```

#### Key Notes
- Always add `MOCK_METHOD` in the `public:` section, regardless of base method's access level.
- For `const` methods, add `(const)` in the specs.
- Use `(override)` if overriding a virtual method.

#### Handling Types with Commas
If a return or argument type contains commas, wrap the type in parentheses or define an alias:

```cpp
// Wrapping with parentheses
MOCK_METHOD((std::pair<bool, int>), GetPair, ());

// Using type alias
using BoolAndInt = std::pair<bool, int>;
MOCK_METHOD(BoolAndInt, GetPair, ());
```

### 2. Set Default Behavior with ON_CALL

Use `ON_CALL` to define what should happen when a function is called without setting an expectation (no verification of call count):

```cpp
ON_CALL(mock_obj, MethodName(matchers...))
    .WillByDefault(action);
```

- `ON_CALL` applies default behavior.
- It's important to use `WillByDefault` exactly once per `ON_CALL`.
- Use `ON_CALL` primarily for uninteresting calls or fallback behavior.

Example:
```cpp
ON_CALL(my_mock, GetValue()).WillByDefault(Return(42));
```

### 3. Set Expectations with EXPECT_CALL

`EXPECT_CALL` both defines behavior and verifies that the call happens as expected.

Basic usage:
```cpp
EXPECT_CALL(mock_obj, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- Match arguments explicitly or with matchers (e.g., `_` to match anything).
- `Times()` clause controls expected invocation count (default inferred).
- `WillOnce` and `WillRepeatedly` control returned values or side effects.

Example:
```cpp
EXPECT_CALL(turtle, Forward(100))
    .Times(1);
```

### 4. Handle Overloaded and Const Methods

When mocking overloaded functions:
- Mock each overload separately with appropriate `MOCK_METHOD`.
- If not mocking all overloads, use `using BaseClass::MethodName;` to avoid hiding.

For const methods, add `(const, override)` in `MOCK_METHOD` specs.

Example:
```cpp
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int times, int x), (override));
  MOCK_METHOD(int, GetValue, (), (const, override));
};
```

### 5. Use NiceMock, NaggyMock, and StrictMock for Uninteresting Calls

These wrappers control how uninteresting calls (methods called with no matching `EXPECT_CALL`s) are handled:

- **NiceMock<T>**: Suppresses warnings on uninteresting calls.
- **NaggyMock<T>**: Prints warnings on uninteresting calls (default behavior).
- **StrictMock<T>**: Treats uninteresting calls as errors.

Usage example:
```cpp
NiceMock<MockFoo> nice_mock;
StrictMock<MockFoo> strict_mock;
EXPECT_CALL(strict_mock, DoThis());
```

**Note:** Only use these with mock methods defined **directly** in `T` (not inherited). Nested modifiers are not supported.

### 6. Manage Expectations Using Sequences and Ordering

If call order matters, use `InSequence` or `After` clauses:

```cpp
{
  InSequence seq;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

Or:
```cpp
Expectation e1 = EXPECT_CALL(mock, FirstCall());
EXPECT_CALL(mock, SecondCall()).After(e1);
```

### 7. Verify and Reset Mock Expectations

- Mocks automatically verify expectations on destruction.
- Verify earlier using `Mock::VerifyAndClearExpectations(&mock_obj);`
- To reset default actions too, use `Mock::VerifyAndClear(&mock_obj);`

> Avoid setting new expectations after verification.

### 8. Tips on Actions and Matchers

- Use built-in matchers (e.g., `_`, `Eq()`, `Ge()`) to specify argument patterns.
- Chain actions: `WillOnce(Return(x))`, `WillRepeatedly(Return(y))`.
- For side effects like modifying an out parameter, use `SetArgPointee<N>(value)`.
- To invoke a callable argument, use `InvokeArgument<N>(args...)`.

---

## Examples

### Defining a Simple Mock
```cpp
class Foo {
 public:
  virtual ~Foo() {}
  virtual int GetValue() const = 0;
  virtual void SetValue(int v) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int v), (override));
};
```

### Using NiceMock to Suppress Warnings
```cpp
using ::testing::NiceMock;

TEST(MyTest, Example) {
  NiceMock<MockFoo> mock_foo;

  EXPECT_CALL(mock_foo, SetValue(10));

  mock_foo.SetValue(10);
  mock_foo.GetValue();  // No warning even though no EXPECT_CALL.
}
```

### Setting Default Behavior with ON_CALL
```cpp
ON_CALL(mock_foo, GetValue())
    .WillByDefault(Return(42));
```

### Setting Expectations with Complex Matchers
```cpp
using ::testing::_, ::testing::Ge;
EXPECT_CALL(mock_foo, SetValue(Ge(5)));
```

### Mocking Overloads
```cpp
class Foo {
 public:
  virtual int Add(int x) = 0;
  virtual int Add(int x, int y) = 0;
};
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Add, (int x), (override));
  MOCK_METHOD(int, Add, (int x, int y), (override));
};

// In test:
EXPECT_CALL(mock_foo, Add(5));
EXPECT_CALL(mock_foo, Add(3, 7));
```

### Delegating Calls to a Fake Object
```cpp
class FakeFoo : public Foo { ... };
class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, Compute, (int x), (override));

  void DelegateToFake() {
    ON_CALL(*this, Compute).
        WillByDefault([this](int x) { return fake_.Compute(x); });
  }

 private:
  FakeFoo fake_;
};
```

---

## Troubleshooting & Tips

### Common Issues

- **Uninteresting call warnings:** If warnings about uninteresting calls annoy you, consider wrapping your mock with `NiceMock`.
- **Unexpected calls failures:** Check your `EXPECT_CALL`s match the method calls correctly, including argument matchers.
- **Overloaded method ambiguity:** Use `using BaseClass::Method` or specify all overloads.
- **Mock methods not invoked:** Verify methods are `virtual`.
- **Destructor not virtual:** Mock classes must have virtual destructors for proper cleanup.

### Best Practices

- Use `ON_CALL` for default behaviors without expectations.
- Use `EXPECT_CALL` to verify interactions.
- Keep expectations minimal and focused.
- Use sequences only when call order matters.
- Avoid nesting `NiceMock`, `NaggyMock`, or `StrictMock`.

### Advanced Considerations

- Mock move-only types with care, using lambdas for returning new objects.
- Use `RetiresOnSaturation()` to make expectations retire once they are satisfied.

---

## Next Steps & Related Content

- Explore [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for recipes on advanced mocking patterns.
- Study [Matchers Reference](reference/matchers.md) to craft powerful argument matchers.
- Learn to write custom actions in [Actions API](api-reference/mock-actions-cardinalities/gmock-actions).
- Understand mock strictness control in [Mock Strictness Control](api-reference/core-apis/gmock-nice-strict-api).
- Begin with [Writing and Running Your First Test](guides/getting-started/writing-your-first-test) for foundational skills.

---
