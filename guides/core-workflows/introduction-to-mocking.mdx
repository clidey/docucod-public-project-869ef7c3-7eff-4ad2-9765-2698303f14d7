---
title: "Getting Started with Mocking"
description: "Learn the basics of using GoogleMock to replace and verify the behavior of dependencies in your code. This guide walks you through creating simple mocks, setting expectations, and verifying interactions using the MOCK_METHOD macro and EXPECT_CALL. Designed for those new to mocking in C++."
---

# Getting Started with Mocking

## Introduction

This guide will help you learn the basics of using GoogleMock (gMock) to replace and verify the behavior of dependencies in your C++ code. It walks you step-by-step through creating simple mock classes, setting expectations, and verifying interactions using the core `MOCK_METHOD` macro and `EXPECT_CALL` syntax.

Whether you are new to mocking or want a straightforward introduction, this guide will get you started quickly with practical examples and actionable steps.

---

## 1. What You Will Achieve

- Create mock classes that simulate your dependencies.
- Set up expectations on mocked methods for how they should be called.
- Control return values and behavior of mocks.
- Verify that your code interacts with dependencies as intended.

---

## 2. Prerequisites

Before you start, ensure:

- You have GoogleTest and GoogleMock installed and configured in your build system.
- You have a basic understanding of C++ syntax and virtual functions.
- Your interfaces have virtual (or abstract) methods to mock.


---

## 3. Writing Your First Mock Class

### Define the Mock Class

Mock classes are derived from the interface or base class you want to mock. Use the `MOCK_METHOD` macro in the `public:` section of your mock class to declare mock methods.

Each `MOCK_METHOD` has the form:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (OptionalQualifiers));
```

- The first parameter is the return type.
- The second parameter is the method name.
- The third parameter is the parameter list enclosed in parentheses.
- The fourth, optional parameter is a comma-separated list of qualifiers like `const`, `override`, or `noexcept`.


### Example

Suppose you have this interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

You can define the mock class as follows:

```cpp
#include <gmock/gmock.h>  // Include for gMock macros

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```


### Tips

- Always place `MOCK_METHOD` definitions in `public:` section, even if the original method is `private` or `protected`.
- For methods returning references, use `ReturnRef()` in actions to return existing references correctly.
- When methods have commas in their argument types (e.g., templates like `std::pair<int, double>`), wrap the type in extra parentheses or create a type alias to avoid macro parsing issues.

---

## 4. Setting Expectations

### The `EXPECT_CALL` Macro

Use `EXPECT_CALL` to define the expected usage of a mock method during your test.

General form:

```cpp
EXPECT_CALL(mock_object, Method(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `mock_object` is an instance of your mock class.
- `Method` is the method you are expecting to be called.
- Matchers specify what arguments you expect. Use `_` as a wildcard for “any value”.
- `Times` specifies how many times you expect this call (optional).
- `WillOnce` and `WillRepeatedly` specify what the mock does when invoked.


### Examples

```cpp
using ::testing::_;  // Wildcard matcher
using ::testing::Return;

MockTurtle turtle;

// Expect PenDown() to be called at least once
EXPECT_CALL(turtle, PenDown()).Times(testing::AtLeast(1));

// Expect Forward() to be called with any integer argument, and always return void (default behavior)
EXPECT_CALL(turtle, Forward(_));

// GetX() called once, returns 10 the first time, then 20 subsequently
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(10))
    .WillRepeatedly(Return(20));
```

### Matchers

- Use literal values for exact matches (e.g., `Forward(100)`).
- Use `_` to match any argument value.
- Use built-in matchers like `Ge()`, `Le()`, `Not()`, etc., for more nuanced expectations.

---

## 5. Default Behavior With `ON_CALL`

If you want to control the default behavior when there is no explicit `EXPECT_CALL` for a method, use `ON_CALL`. This sets the default action but does not set expectations.

Example:

```cpp
ON_CALL(turtle, GetX()).WillByDefault(Return(0));
```

Now, any call to `GetX()` without an explicit expectation will return 0.

*Use `ON_CALL` for broad defaults, and `EXPECT_CALL` when you must verify calls happen.*

---

## 6. Controlling Call Order

Sometimes the order of calls matters. Use `InSequence` to enforce ordering:

```cpp
{
  testing::InSequence s;

  EXPECT_CALL(turtle, PenDown());
  EXPECT_CALL(turtle, Forward(100));
  EXPECT_CALL(turtle, PenUp());
}
```

The above expects the three calls to happen in the specified order.

You can also use `Sequence` objects to create partially ordered call graphs.

---

## 7. Verifying Interactions

gMock automatically verifies expectations when your mock object is destructed.

If a method is called more or fewer times than expected, or out of order, gMock will report errors immediately.

To explicitly verify and clear expectations on a mock object (for example, if it is allocated on the heap and may leak), use:

```cpp
testing::Mock::VerifyAndClearExpectations(&mock_object);
```

---

## 8. Handling Common Scenarios

### Ignoring Uninteresting Calls

If you don't want warnings on methods without explicit expectations, wrap a mock with `NiceMock`:

```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> nice_turtle;
```

`NiceMock` suppresses warnings and lets uninteresting calls pass silently.

### Strict Verification

If you want every unexpected call to cause a test failure, use `StrictMock`:

```cpp
using ::testing::StrictMock;
StrictMock<MockTurtle> strict_turtle;
```

---

## 9. Example Test

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::AtLeast;
using ::testing::Return;
using ::testing::_;

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

TEST(PaintingTest, DrawsCircle) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  EXPECT_CALL(turtle, Forward(_)).Times(AtLeast(1));
  EXPECT_CALL(turtle, PenUp()).Times(AtLeast(1));
  EXPECT_CALL(turtle, GetX()).WillRepeatedly(Return(0));

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

---

## 10. Troubleshooting

### Common Issues

- **Mock methods not called as expected?** Use `--gmock_verbose=info` flag when running your tests to see detailed mock call traces.
- **Compilation errors with complex types?** Wrap types with commas in parentheses or create type aliases.
- **Uninteresting call warnings?** These are informative; wrap the mock object in `NiceMock` if you want to suppress them.
- **Order violations?** Ensure you use `InSequence` to enforce call order.
- **Leaked mocks detected?** Use `testing::Mock::AllowLeak()` if intentional, or ensure mocks are properly destroyed to enforce verification.

---

## 11. Best Practices

- Use `ON_CALL` to set default behavior, and `EXPECT_CALL` only when you want to verify calls.
- Avoid over-specifying expectations; match only what your test cares about.
- Use sequences to test ordered calls.
- Always mock virtual methods.
- Keep mock class definitions close to interface declarations when possible.

---

## 12. Next Steps

- Explore the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) for advanced recipes.
- Learn about [Matchers](https://google.github.io/googletest/reference/matchers.html) to refine argument expectations.
- Understand [Actions](https://google.github.io/googletest/reference/mock-actions.html) to specify method behavior.
- Check out the [Strict, Nice, and Naggy Mock guide](https://google.github.io/googletest/gmock_cook_book.html#NiceStrictNaggy) for handling uninteresting calls.

---

## References and Resources

- [gMock for Dummies Guide](https://google.github.io/googletest/gmock_for_dummies.html) - Beginner-friendly introduction.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) - Practical recipes.
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html) - Full API details.
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) - Built-in and custom matchers.
- [GoogleTest Primer](https://google.github.io/googletest/primer.html) - For general testing basics.

---

## Summary
This guide introduced the essential concepts and workflows for mocking with GoogleMock. You learned how to define mock classes using `MOCK_METHOD`, set expectations with `EXPECT_CALL`, and customize mock behavior. You also discovered how to control call order, handle default behaviors, and troubleshoot common issues. With these fundamentals, you can write effective interaction-based tests for your C++ code.
