---
title: "Writing and Running Unit Tests"
description: "Step-by-step instructions for writing effective unit tests with GoogleTest, including test suites, assertions, test runners, and best practices for code organization and maintainability."
---

# Writing and Running Unit Tests with GoogleTest

## Overview

GoogleTest provides a powerful, flexible framework to write and run unit tests in C++. This guide focuses specifically on how to write effective unit tests using GoogleTest, organize them into test suites, apply assertions to validate your code, and execute tests with the built-in test runner. You'll also learn best practices for structuring your test code to improve maintainability and clarity.

---

## 1. What You Will Achieve

- **Write meaningful unit tests** to verify your C++ code behavior.
- **Organize tests into suites** for modular and maintainable verification.
- **Use assertions effectively** to check conditions and catch regressions.
- **Run tests with the GoogleTest runner** and interpret results.
- **Adopt best practices** to keep your test code clean and reusable.

## 2. Prerequisites

- You must have GoogleTest installed in your development environment.
- Your project should be configured with a build system compatible with GoogleTest (e.g., CMake or Bazel).
- Basic knowledge of C++ syntax and programming.
- Familiarity with command-line interface for building and running tests.

---

## 3. Writing Unit Tests: Step-by-Step

### 3.1 Define a Test

To create a unit test, use the `TEST` macro to define a test case and its individual test:

```cpp
TEST(TestSuiteName, TestName) {
  // Your test code here
  EXPECT_EQ(function_under_test(), expected_value);
}
```

- **TestSuiteName** groups related tests logically.
- **TestName** identifies the individual test.

**Example:**

```cpp
TEST(MathTest, FactorialOfZero) {
  EXPECT_EQ(Factorial(0), 1);
}
```

### 3.2 Using Test Fixtures

For tests that need common setup or shared objects, define a test fixture by subclassing `testing::Test`:

```cpp
class MyTestFixture : public testing::Test {
 protected:
  void SetUp() override {
    // Setup code here
  }

  void TearDown() override {
    // Cleanup code here
  }

  // Shared data members
};
```

Then, write tests using the fixture with `TEST_F`:

```cpp
TEST_F(MyTestFixture, TestName) {
  // Test code using shared members
  EXPECT_TRUE(condition);
}
```

---

## 4. Using Assertions

Assertions examine your test conditions and determine if the test passes or fails.

### 4.1 Assertion Types

- **Fatal assertions (`ASSERT_*`)** abort the current function on failure.
- **Nonfatal assertions (`EXPECT_*`)** continue the test even if they fail.

### 4.2 Common Assertions

| Macro           | Description                              | Usage Example                    |
|-----------------|------------------------------------------|--------------------------------|
| `EXPECT_EQ`     | Checks equality of two values            | `EXPECT_EQ(a, b);`               |
| `ASSERT_NE`     | Checks inequality                        | `ASSERT_NE(ptr, nullptr);`       |
| `EXPECT_TRUE`   | Checks if a condition is true            | `EXPECT_TRUE(is_valid);`         |
| `ASSERT_FALSE`  | Checks if a condition is false           | `ASSERT_FALSE(has_error);`       |
| `EXPECT_STREQ`  | Checks two C strings are equal by content | `EXPECT_STREQ(str1, str2);`    |
| `EXPECT_FLOAT_EQ` | Checks approximate equality for floats | `EXPECT_FLOAT_EQ(f1, f2);`    |

### 4.3 Streaming Custom Failure Messages

You can append custom messages to assertions to clarify failures:

```cpp
EXPECT_EQ(x, expected) << "x should be " << expected << " but was " << x;
```

---

## 5. Organizing Tests into Test Suites

Group your related tests into test suites for logical organization and shared setup.

- Use the same **TestSuiteName** in the `TEST` macro to group tests.
- Use **fixtures** (`TEST_F`) to share common setup and teardown logic.

**Example:**

```cpp
TEST(MathTest, Addition) { EXPECT_EQ(Add(2, 3), 5); }
TEST(MathTest, Subtraction) { EXPECT_EQ(Sub(10, 3), 7); }
```

```cpp
// With a fixture
class QueueTest : public testing::Test {
 protected:
  Queue<int> q;
  void SetUp() override {
    // Initialize queue before each test
    q.Enqueue(1);
  }
};

TEST_F(QueueTest, EmptyAfterDequeue) {
  int* n = q.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
  EXPECT_TRUE(q.IsEmpty());
}
```

---

## 6. Running Tests

Compile your test executable with GoogleTest linked. Then run the binary:

```bash
./my_test_executable
```

- GoogleTest will automatically discover and run all tests defined with `TEST` or `TEST_F`.
- The output shows each test result, duration, and failures.
- Use command-line flags to filter tests or change behavior:
  - `--gtest_filter=TestSuiteName.TestName` to run specific tests.
  - `--gtest_repeat=N` to run tests multiple times.
  - `--gtest_color=yes` to enable colored output.

---

## 7. Best Practices for Test Design

- **Name test suites and tests clearly** to reflect their purpose.
- **Isolate tests:** each test should be independent and repeatable.
- **Prefer nonfatal assertions (`EXPECT_*`)** when possible, to see all failures.
- **Use fixtures for shared setup/cleanup**, but remember each test gets a fresh fixture instance.
- **Keep tests small and focused**; one logical assertion per test is ideal.
- **Use `SCOPED_TRACE`** to add contextual information in failure messages when testing loops or subroutines.

---

## 8. Examples

### 8.1 Basic Test

```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}
```

### 8.2 Using a Fixture

```cpp
class StackTest : public testing::Test {
 protected:
  std::stack<int> s;

  void SetUp() override {
    s.push(42);
  }
};

TEST_F(StackTest, TopReturnsLastPushedValue) {
  EXPECT_EQ(s.top(), 42);
}

TEST_F(StackTest, PopRemovesElement) {
  s.pop();
  EXPECT_TRUE(s.empty());
}
```

### 8.3 Using Assertions with Custom Message

```cpp
TEST(MathTest, Division) {
  int divisor = 0;
  ASSERT_NE(divisor, 0) << "Divisor must not be zero";
  EXPECT_EQ(Divide(10, divisor), 5);
}
```

---

## 9. Troubleshooting Tips

- Ensure your test fixture classes have a default constructor; GoogleTest needs to instantiate them.
- Avoid underscores in test suite and test names to prevent naming conflicts.
- Use `ASSERT_*` assertions carefully, as they abort the current function, potentially skipping cleanup.
- Use `EXPECT_*` when you want tests to continue after failure.
- If you encounter "uninteresting mock function call" warnings (in mock-enabled tests), consider using `NiceMock` to suppress noise.
- Verify your build configuration to ensure GoogleTest and your tests compile and link correctly.

---

## 10. Next Steps & Further Reading

- Explore [Writing Your First Test](https://yourdocs/getting-started/first-test-experience/hello-test) to start with simple test examples.
- Learn about [Test Fixtures](https://yourdocs/overview/core-concepts/core-concepts-terminology) for shared setup.
- Advance to [Using Assertions Effectively](https://yourdocs/guides/core-workflows/using-assertions) for mastering validation.
- Read about [Mocking with GoogleMock](https://yourdocs/guides/advanced-testing-patterns/mocking-with-googlemock) to handle dependencies.
- Check out the [Testing Reference](https://yourdocs/docs/reference/testing) for comprehensive macro and API details.


---

## Additional Tips

- Always check the return value of `RUN_ALL_TESTS()` in your `main()` function to ensure test correctness.
- Customize test behavior with command-line options for better control during development.
- Use the rich set of assertions to make your tests expressive and informative.
- Modularize complex tests using fixtures and parameterized tests to avoid duplication.

```cpp
int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This completes your introduction to writing and running unit tests with GoogleTest.

---

For full API details, visit the [GoogleTest Testing Reference](https://github.com/google/googletest/blob/main/docs/reference/testing.md).

---