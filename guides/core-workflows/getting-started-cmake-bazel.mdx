---
title: "Getting Started: Building with CMake and Bazel"
description: "A hands-on guide to setting up GoogleTest and GoogleMock in your C++ project using the most common build systems: CMake and Bazel. Walk through typical installation steps, linking libraries, and compiling your first test cases to ensure a smooth initial experience."
---

# Getting Started: Building with CMake and Bazel

A hands-on guide to setting up GoogleTest and GoogleMock in your C++ project using the most common build systems: CMake and Bazel. Walk through typical installation steps, linking libraries, and compiling your first test cases to ensure a smooth initial experience.

---

## 1. Workflow Overview

### What this guide helps you accomplish
This documentation shows you how to incorporate GoogleTest and GoogleMock into your C++ projects using the widely adopted build systems CMake and Bazel. You'll learn how to set up the environment, declare dependencies, compile your tests, and run them successfully.

### Prerequisites
- A supported operating system (Linux, macOS, Windows).
- A C++ compiler that supports at least C++17.
- Either CMake (version 3.14 or higher) with a compatible build tool (e.g., Make, Ninja) or Bazel (version 7.0 or higher) installed and ready.
- Basic familiarity with your chosen build system.

### Expected Outcome
After following this guide, you will have:
- Configured a new C++ project or workspace to download and build GoogleTest and GoogleMock automatically.
- Created a simple test source file with sample assertions.
- Built and linked the test binary using either CMake or Bazel.
- Successfully run your first automated test confirming integration.

### Time Estimate
Approximately 15-30 minutes depending on your familiarity and system configuration.

### Difficulty Level
Beginner to Intermediate â€” no advanced build system expertise required.

---

## 2. Building with CMake

CMake is a cross-platform build system generator commonly used in C++ projects. This section demonstrates how to download GoogleTest and GoogleMock, integrate them using CMake's FetchContent, and run your first test.

### Step 1: Create your project directory
Open a terminal and run:

```bash
mkdir my_project && cd my_project
```

### Step 2: Create `CMakeLists.txt` to declare GoogleTest dependency
Create a file named `CMakeLists.txt` with the following contents:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17 standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# On Windows, prevent overriding the parent project's CRT settings
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)

FetchContent_MakeAvailable(googletest)

enable_testing()

add_executable(
  hello_test
  hello_test.cc
)

target_link_libraries(
  hello_test
  GTest::gtest_main
)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

> **Tip:** The GooglTest version is pinned via the commit hash in the URL. Update it periodically to keep up with improvements.

### Step 3: Write your first test
Create a file `hello_test.cc` in the project root:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");  // Check strings are not equal
  EXPECT_EQ(7 * 6, 42);              // Expect multiplication result
}
```

### Step 4: Build your project
Run the following commands to configure and build:

```bash
cmake -S . -B build
cmake --build build
```

### Step 5: Run your tests
Execute tests using `ctest`:

```bash
cd build
ctest --output-on-failure
```

You should see output confirming your test passed:

```
Test project /path/to/my_project/build
    Start 1: HelloTest.BasicAssertions
1/1 Test #1: HelloTest.BasicAssertions ........   Passed    0.00 sec

100% tests passed, 0 tests failed out of 1
```

### Best Practices & Tips for CMake
- Enable `gtest_force_shared_crt` on Windows to avoid runtime link mismatches.
- Prefer `FetchContent` for fetching dependencies dynamically during configuration to keep builds reproducible.
- Use `gtest_discover_tests` to automatically register test cases for CTest.

### Common Pitfalls
- Forgetting to set C++17 standard can cause compiler errors.
- Not calling `enable_testing()` disables test discovery.
- If tests do not run, ensure GoogleTest libraries link correctly.

---

## 3. Building with Bazel

Bazel is a fast, scalable build system used internally by Google and many C++ projects. This section guides you through initializing a Bazel workspace, declaring GoogleTest dependencies, and running your first test.

### Step 1: Create a Bazel workspace
Create a new directory to hold your Bazel project:

```bash
mkdir my_workspace && cd my_workspace
```

### Step 2: Declare GoogleTest dependency in `MODULE.bazel`
Create a file named `MODULE.bazel` with the following contents:

```python
bazel_dep(name = "googletest", version = "1.17.0")
```

This declaration pulls GoogleTest from the Bazel Central Registry.

### Step 3: Write your test source
Create `hello_test.cc` in your workspace:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 4: Create a Bazel build target
Create a file named `BUILD` in the same directory with:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

This tells Bazel to compile `hello_test.cc` as a test binary, linking with GoogleTest.

### Step 5: Build and run the test
Run this command in your workspace root:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

Expected output shows the test running and passing:

```
INFO: Build completed successfully, 27 total actions
//:hello_test                                                     PASSED in 0.1s
```

### Best Practices & Tips for Bazel
- Specify C++ standard explicitly (`--cxxopt=-std=c++17`) to ensure consistent compilation.
- Use the Bazel Central Registry to pull in GoogleTest dependencies; this keeps your workspace manageable.
- Use `cc_test` for test targets to automatically register tests.

### Common Pitfalls
- Forgetting to add `@googletest//:gtest_main` dependency means no test main() function, causing link errors.
- Not setting correct C++ standard options causes compiler compatibility issues.
- Bazel versions prior to 7.0 do not support module-based dependency management.

---

## 4. Troubleshooting & Tips

### Common Issues
- **Build fails with runtime mismatch errors on Windows**: Enable `gtest_force_shared_crt ON` in CMake or configure your build to link runtimes consistently.
- **Tests do not execute or no tests discovered**: For CMake, ensure `enable_testing()` and `gtest_discover_tests()` are called. For Bazel, confirm `cc_test` is used.
- **Link errors regarding missing main()**: Link with `gtest_main` or `gmock_main` libraries.

### Performance Considerations
- When working with large projects, consider building GoogleTest and GoogleMock as shared libraries if build time or binary size is a concern.
- Use test filtering features in Bazel and CTest for faster feedback loops.

### Alternative Approaches
- For advanced CMake users, consider embedding the GoogleTest source in your project with `add_subdirectory()` for tighter version control.
- For Bazel users, managing dependencies via `WORKSPACE` instead of `MODULE.bazel` may apply in older versions.

---

## 5. Next Steps and Related Content

- Explore the [Writing and Running Your First Tests](../configuration-first-run/your-first-test) guide to learn writing more in-depth tests.
- Check out the [Setup and Project Integration](../configuration-first-run/configuration-setup) page to refine your project build setup.
- Dive into [Writing Clear and Effective Assertions](../../integration-and-best-practices/writing-effective-assertions) to enhance test expressiveness.
- Visit the [Supported Platforms](../../getting-started/prerequisites-installation/system-requirements) documentation to verify your environment compatibility.

---

## References

- [GoogleTest GitHub Repository](https://github.com/google/googletest)
- [CMake Documentation: FetchContent](https://cmake.org/cmake/help/latest/module/FetchContent.html)
- [Bazel C++ Tutorial](https://docs.bazel.build/versions/main/tutorial/cpp.html)
- [CMake GoogleTest Module](https://cmake.org/cmake/help/git-stage/module/GoogleTest.html)

---

Congratulations! You are now equipped to set up and build GoogleTest and GoogleMock in your C++ projects using CMake or Bazel, setting the stage for effective, automated unit testing.