---
title: "Assertions and Test Expectations"
description: "Details how to use GoogleTest's rich assertion macros to validate behavior, including equality, exception, and fatal/non-fatal checks. Introduces best practices for writing clear and meaningful assertions."
---

# Assertions and Test Expectations

This guide details how to use GoogleTest's rich assertion macros to validate behavior, enabling you to write clear, meaningful, and robust tests. You will learn how to express various types of checks, handle expected failures gracefully, and follow best practices for test validation.

---

## 1. Overview of Assertions in GoogleTest

Assertions are the fundamental building blocks in test cases that check whether your code behaves as expected. GoogleTest supports two broad categories:

- **Fatal Assertions** (`ASSERT_*`): On failure, the current test function is aborted immediately.
- **Non-fatal Assertions** (`EXPECT_*`): On failure, execution continues, allowing multiple checks per test.

### Key Points:

- Use **fatal assertions** when subsequent test steps depend on the success of the assertion.
- Use **non-fatal assertions** to accumulate errors and report all failures in one run.
- Assertions are thread-safe and are automatically integrated with test result reporting.

---

## 2. Basic Equality and Relational Assertions

The simplest and most common assertions compare values for equality or inequalities.

### Using `EXPECT_EQ` and `ASSERT_EQ`

```cpp
EXPECT_EQ(expected_value, actual_value);  // Non-fatal
ASSERT_EQ(expected_value, actual_value);  // Fatal
```

- Compares using `operator==`.
- On failure, reports the expected and actual values.
- These macros automatically print values in case of failure to aid debugging.

### Other Comparisons

| Macro       | Description                                   |
|-------------|-----------------------------------------------|
| `EXPECT_NE` | Expect not equal                              |
| `EXPECT_LT` | Expect less than                              |
| `EXPECT_LE` | Expect less or equal                          |
| `EXPECT_GT` | Expect greater than                           |
| `EXPECT_GE` | Expect greater or equal                       |

Example:

```cpp
ASSERT_LT(result, threshold);
EXPECT_NE(result, 0);
```

---

## 3. Checking Boolean Conditions

Use `EXPECT_TRUE(condition)` or `EXPECT_FALSE(condition)` for general boolean expressions.

```cpp
EXPECT_TRUE(pointer != nullptr);
EXPECT_FALSE(is_error);
```

Prefer relational assertions (`EXPECT_EQ`, `EXPECT_NE`, etc.) when possible for clearer failure messages.

---

## 4. String and Floating-Point Assertions

### String Assertions

- `EXPECT_STREQ(expected_c_str, actual_c_str)`: Compares C strings for equality.
- `EXPECT_STRNE(expected_c_str, actual_c_str)`: Compares C strings for inequality.
- `EXPECT_STRCASEEQ(expected_c_str, actual_c_str)`: Case-insensitive equality.
- `EXPECT_STRCASENE(expected_c_str, actual_c_str)`: Case-insensitive inequality.

Example:

```cpp
EXPECT_STREQ("hello", GetGreeting());
```

### Floating-Point Assertions

To account for floating-point imprecision, use:

- `EXPECT_FLOAT_EQ(expected, actual)` for float comparison
- `EXPECT_DOUBLE_EQ(expected, actual)` for double comparison
- `EXPECT_NEAR(val1, val2, abs_error)` to check if two values are within an absolute difference.

```cpp
EXPECT_NEAR(computed_value, expected_value, 1e-5);
```

---

## 5. Exception Assertions

Verify that code throws or does not throw expected exceptions:

- `EXPECT_THROW(statement, ExceptionType)`
- `EXPECT_ANY_THROW(statement)`
- `EXPECT_NO_THROW(statement)`

Example:

```cpp
EXPECT_THROW(Foo(-1), std::invalid_argument);
EXPECT_NO_THROW(Foo(10));
```

---

## 6. Fatal vs Non-Fatal Assertions in Practice

Here is a typical usage scenario:

```cpp
TEST(MyTestSuite, ExampleTest) {
  int* ptr = GetPointer();
  ASSERT_NE(ptr, nullptr) << "Pointer must not be null!";

  // Safe to dereference ptr beyond this point.
  EXPECT_EQ(*ptr, expected_value);

  // The test continues even if EXPECT_EQ fails,
  // so further checks can be done.
}
```

- `ASSERT_NE` ensures the pointer is valid before continuing;
- `EXPECT_EQ` allows multiple checks without aborting the test.

---

## 7. Timeout and Fatal Failure Handling

Use these macros to assert conditions in tests that require strict termination:

- `ASSERT_DEATH(statement, regex)`: Assert that `statement` causes the process to die and the error message matches `regex`.
- Use to test fatal failures and program shutdown scenarios.

Example:

```cpp
ASSERT_DEATH(SomeFunctionThatExits(), "explicit exit message");
```

---

## 8. Writing Custom Failure Messages

You can append custom messages to assertions by using stream syntax:

```cpp
EXPECT_EQ(result, expected) << "Value did not match after step 3.";
ASSERT_TRUE(ptr != nullptr) << "Pointer should never be null when calling Foo().";
```

This context helps clarify the failure source during debugging.

---

## 9. Best Practices for Assertions

- Use **clear, specific assertions** rather than generic ones.
- Keep each test focused; multiple checks per test help detect all issues in one run.
- Place **critical checks** as fatal assertions to avoid cascading errors.
- Avoid side-effects in expression arguments to assertions.
- Prefer built-in typed assertions (`EXPECT_EQ`, etc.) over `EXPECT_TRUE` when comparing values.
- Use `ASSERT_THROW` and `EXPECT_THROW` to validate exception-throwing behavior.

---

## 10. Advanced Tips

- To compare containers or objects, use `EXPECT_THAT()` with GoogleMock matchers for expressive and descriptive validation.
- Use `ASSERT_NO_FATAL_FAILURE()` to run some code but abort on any fatal failures during it.
- Use the `SCOPED_TRACE()` macro to add contextual information that propagates through nested assertions.

---

## 11. Troubleshooting Assertions

### Common Issues

- **False positives/negatives**: Ensure that expressions in assertions do not have unpredictable side effects.
- **Unclear failure messages**: Use custom failure messages or switch to typed assertions for better diagnostics.
- **Test aborting prematurely**: Make sure to distinguish when to use fatal vs non-fatal assertions.

### Diagnostics

- Use verbose logging or debug mode to see assertion failures in detail.
- In IDEs, failure location links can help pinpoint the source.

---

## 12. Example: Validating a Calculator

```cpp
TEST(CalculatorTest, AddsNumbers) {
  Calculator calc;
  int result = calc.Add(2, 3);
  EXPECT_EQ(result, 5) << "Addition failed for 2 + 3.";
}

TEST(CalculatorTest, DividesNumbers) {
  Calculator calc;
  ASSERT_NO_THROW({
    int div = calc.Divide(10, 2);
    EXPECT_EQ(div, 5) << "Division result incorrect.";
  });

  EXPECT_THROW(calc.Divide(10, 0), std::invalid_argument);
}
```

This test suite shows both non-fatal and fatal assertion usage, messages, and exception validation.

---

## 13. Next Steps & Related Content

- Explore [Writing Parameterized and Typed Tests](guides/core-workflows/parameterized-tests) to test multiple data combinations efficiently.
- Consult the [Matchers Reference](api-reference/matchers-actions/argument-matchers) for more expressive assertions using predicates.
- Review the [Mocking Reference](api-reference/mocking-apis/mock-expectations-actions) to understand how to use assertions with mock expectations.
- Learn about [Death Tests and Error Handling](guides/core-workflows/death-tests) for advanced failure scenario testing.

---

## 14. Additional Resources

- [GoogleTest Primer](getting-started/first-test-experience/writing-your-first-test)
- [Core Concepts & Terminology](overview/architecture-concepts/core-concepts-terminology)
- [Setting Expectations and Actions](api-reference/mocking-apis/mock-expectations-actions)

---

# Summary
This page equips you with comprehensive knowledge on GoogleTest's assertions and expectations, guiding you to write robust tests that capture intended behaviors, handle errors gracefully, and provide meaningful feedback. It covers basic and advanced assertions, exception checks, failure handling, and best usage practices.
