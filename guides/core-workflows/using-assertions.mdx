---
title: "Using Assertions Effectively"
description: "Explore the wide variety of assertion macros available in GoogleTest, distinguishing between fatal and non-fatal failures, custom assertions, and best practices for writing expressive tests."
---

# Using Assertions Effectively

Explore the wide variety of assertion macros available in GoogleTest, distinguishing between fatal and non-fatal failures, custom assertions, and best practices for writing expressive tests.

---

## 1. Understanding Assertions in GoogleTest

Assertions are the core verification mechanism in GoogleTest. They let you assert expected conditions in your test code. This guide helps you to master the different types of assertions, when to use them, and how to write meaningful failure messages.

### Types of Assertions

GoogleTest divides assertions into two primary categories:

- **Fatal Failures (`ASSERT_` macros)**: These immediately stop execution of the test function when the assertion fails.
- **Nonfatal Failures (`EXPECT_` macros)**: These log failures but allow the test function to continue running.

Knowing when to use each type is critical to writing robust tests.

<Check>
Use `ASSERT_` macros when continuing test execution after failure would lead to invalid or misleading results.
Use `EXPECT_` macros when you want to verify multiple conditions in one test without aborting early.
</Check>

---

## 2. Using Common Assertion Macros

### Boolean Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: Verify that a condition is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: Verify that a condition is false.

Example:
```cpp
EXPECT_TRUE(IsPrime(7)) << "7 should be prime";
ASSERT_FALSE(IsPrime(8)) << "8 should not be prime";
```

### Equality and Comparison Assertions

- Equality:
  - `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` verifies `val1 == val2`.
  - `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` verifies `val1 != val2`.
- Comparison:
  - `EXPECT_LT(val1, val2)`, `EXPECT_LE(val1, val2)`, `EXPECT_GT(val1, val2)`, `EXPECT_GE(val1, val2)` (and their `ASSERT_` variants).

Example:
```cpp
EXPECT_EQ(sum, expected_sum);
ASSERT_LT(distance, 10.0);
```

### String Comparison

Special assertions are provided for comparing C strings, accounting for content equality rather than pointer equality:

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` â€” check that two C strings have the same content.
- Similarly, `EXPECT_STRNE` and case-insensitive variants.

Example:
```cpp
ASSERT_STREQ(GetUserName(), "admin");
```

### Floating-Point Comparisons

Use dedicated floating-point assertions to handle rounding errors:

- `EXPECT_FLOAT_EQ` / `ASSERT_FLOAT_EQ`
- `EXPECT_DOUBLE_EQ` / `ASSERT_DOUBLE_EQ`
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR`

Example:
```cpp
EXPECT_NEAR(computed_value, expected_value, 1e-5);
```

### Explicit Success and Failure

- `SUCCEED()` generates a documented success. Useful in complex control flows.
- `FAIL()` generates an immediate fatal failure.
- `ADD_FAILURE()` logs nonfatal failures.

---

## 3. Writing Custom Assertions with Matchers

GoogleTest allows expressive, readable assertions using _matchers_ via the `EXPECT_THAT` and `ASSERT_THAT` macros.

These let you verify complex conditions reading like natural language:

```cpp
EXPECT_THAT(value, ::testing::StartsWith("Hello"));
EXPECT_THAT(container, ::testing::ElementsAre(1, 2, 3));
```

Custom matchers can also be written for tailored validation.

---

## 4. Best Practices for Using Assertions

### Prefer Nonfatal Assertions Where Appropriate

Use `EXPECT_` when failures should not stop the test immediately. This allows multiple checks per test and provides more comprehensive failure information.

### Use Fatal Assertions to Protect Dependent Test Logic

When subsequent test steps depend on an assertion (e.g., a pointer is non-null), use `ASSERT_` to prevent dereferencing invalid data.

### Stream Descriptive Failure Messages

Add custom messages explaining failure reasons to improve diagnostics:

```cpp
EXPECT_EQ(result, expected) << "Result does not match expected output for input: " << input;
```

### Avoid Ambiguous Assertions

For string comparisons, prefer `EXPECT_STREQ` over `EXPECT_EQ` when comparing C strings.

### Verify Floating-Point Results Safely

Use proper tolerance with `EXPECT_NEAR` or specialized floating-point comparisons to avoid flaky tests.

### Check Exception Thrown Using Exception Assertions

Use:
- `EXPECT_THROW` / `ASSERT_THROW` to expect an exception
- `EXPECT_NO_THROW` / `ASSERT_NO_THROW` to ensure no exception is thrown

Example:
```cpp
EXPECT_THROW(FunctionUnderTest(), std::runtime_error);
```

---

## 5. Common Pitfalls and Troubleshooting

### Side Effects in Assertions

Remember that expressions passed to assertions are evaluated exactly once. Avoid side effects inside the assertion expressions.

### Pointer vs String Comparison

Avoid mistakenly comparing C string pointers instead of their content. Use string-specific assertions.

### Ignoring Useful Failure Information

Avoid using `EXPECT_TRUE` on complex conditions where `EXPECT_THAT` with a matcher makes failure messages more informative.

### Floating Point Equality

Never compare floating-point numbers for direct equality with `EXPECT_EQ`.

---

## 6. Examples of Using Assertions

### Example: Basic Assertions
```cpp
TEST(MathTest, BasicOperations) {
  int x = 5;
  int y = 10;

  EXPECT_TRUE(x < y);
  EXPECT_EQ(x + y, 15);
  EXPECT_NE(x, y);
  EXPECT_LT(x, y);
  EXPECT_GT(y, x);

  const char* s1 = "hello";
  const char* s2 = "hello";
  EXPECT_STREQ(s1, s2);
}
```

### Example: Using Matchers
```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::ElementsAre;
using ::testing::_;

TEST(ContainerTest, VectorContents) {
  std::vector<int> v{3, 1, 4};

  EXPECT_THAT(v, ElementsAre(3, 1, 4));
  EXPECT_THAT("Hello world", StartsWith("Hello"));
  EXPECT_THAT(v, ::testing::Each(::testing::Gt(0)));
}
```

### Example: Exception Assertions
```cpp
TEST(ExceptionTest, ThrowsOnInvalidInput) {
  EXPECT_THROW({ FunctionThatThrows(); }, std::invalid_argument);
  EXPECT_NO_THROW({ FunctionThatDoesNotThrow(); });
}
```

---

## 7. Understanding Fatal vs Nonfatal Failures

- `ASSERT_` failures are fatal and abort the current function immediately. Use them when subsequent code depends on the assertion's success.
- `EXPECT_` failures are logged but allow execution to continue, enabling multiple checks within one test.

Always consider control flow when choosing between these two.

---

## 8. Advanced Assertion Topics

### Using Predicate Assertions

For complex or custom predicate checks, use `EXPECT_PRED*` macros:

```cpp
EXPECT_PRED2(MyPredicate, arg1, arg2);
```

These print individual argument values on failure.

### Predicate-Formatter Assertions

For full control over failure messages, define predicate-formatters and use `EXPECT_PRED_FORMAT*` macros.

### HRESULT Assertions

Specific assertions exist for Windows HRESULT success or failure:

- `EXPECT_HRESULT_SUCCEEDED(expression)`
- `EXPECT_HRESULT_FAILED(expression)`

Useful when testing COM APIs.

---

## 9. Summary

Effectively using assertions in GoogleTest enables precise, maintainable, and expressive tests. Start simple with basic boolean and equality checks, then adopt matchers for readability and expressiveness. Use fatal assertions responsibly to guard dependent logic and leverage nonfatal assertions to check multiple conditions per test.

Proper use of assertions leads to faster debugging and more reliable tests.

---

## 10. Additional Resources

- [Assertions Reference](https://github.com/google/googletest/blob/main/docs/reference/assertions.md)
- [Matchers Reference](https://github.com/google/googletest/blob/main/docs/reference/matchers.md)
- [Writing Your First Test](../../guides/getting-started/writing-first-test.md)
- [Using Assertions in Tests](https://github.com/google/googletest/blob/main/docs/gmock_for_dummies.md#using-assertions)

---

## Appendix: Quick Reference to Common Assertions

| Macro                 | Description                                | Failure Behavior    |
|-----------------------|--------------------------------------------|--------------------|
| `EXPECT_TRUE(cond)`    | Check `cond` is true                        | Nonfatal           |
| `ASSERT_TRUE(cond)`    | Check `cond` is true                        | Fatal              |
| `EXPECT_EQ(a, b)`     | Check `a == b`                             | Nonfatal           |
| `ASSERT_EQ(a, b)`     | Check `a == b`                             | Fatal              |
| `EXPECT_STREQ(a, b)`  | Check C strings equal                      | Nonfatal           |
| `ASSERT_STREQ(a, b)`  | Check C strings equal                      | Fatal              |
| `EXPECT_THROW(stmt, ex)` | Check `stmt` throws exception type `ex`  | Nonfatal           |
| `ASSERT_THROW(stmt, ex)` | Check `stmt` throws exception type `ex`  | Fatal              |

---

This guide equips you with practical insights and examples to write effective, expressive assertions and improve your test quality when using GoogleTest.
