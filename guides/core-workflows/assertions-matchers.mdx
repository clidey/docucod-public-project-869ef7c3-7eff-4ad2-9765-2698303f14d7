---
title: "Assertions and Matchers in Practice"
description: "Demonstrates the full range of assertions and matchers available in GoogleTest, illustrating how to validate correctness, handle special types (like floating points or containers), and define user-specific conditions. Includes actionable examples and anti-patterns."
---

# Assertions and Matchers in Practice

Explore the full spectrum of GoogleTest assertions and matchers, focusing on practical applications to verify correctness, handle special data types like floating points and containers, and define custom validation rules. This page provides clear, hands-on examples alongside common pitfalls to avoid.

---

## Workflow Overview

### What This Guide Helps You Accomplish
- Understand various built-in assertions and matchers in GoogleTest.
- Learn how to validate different data types, including primitives, floating points, and STL containers.
- Use matchers to write expressive and maintainable unit tests.
- Create user-defined matchers to tailor validations to your specific needs.

### Prerequisites
- Basic familiarity with GoogleTest and C++ unit testing.
- GoogleTest installed and integrated with your project (see [Getting Started](https://google.github.io/googletest/quickstart-cmake.html)).
- Ability to write simple test cases with `EXPECT_` and `ASSERT_` macros.

### Expected Outcome
- Confidently write assertions and matchers for complex test validations.
- Apply floating point tolerant comparisons and container inspections.
- Avoid common mistakes when writing match conditions.
- Extend GoogleTest capabilities with custom matchers.

### Time Estimate
15-30 minutes for a thorough read and experimentation.

### Difficulty Level
Intermediate: Requires foundational knowledge of GoogleTest and basic C++.

---

## Step-by-Step Instructions

### 1. Understanding Basic Assertions
GoogleTest provides a variety of assertion macros. Most come as pairs:
- `EXPECT_*` macros generate nonfatal failures, allowing test continuation.
- `ASSERT_*` macros generate fatal failures, aborting the current test.

#### Example: Checking Conditions
```cpp
EXPECT_TRUE(condition) << "Condition failed with explanation";
ASSERT_EQ(value1, value2) << "Values mismatch details";
```

After basic macros, `EXPECT_THAT` allows powerful matcher-based assertions:
```cpp
EXPECT_THAT(actual_value, Eq(expected_value));
EXPECT_THAT(actual_value, StartsWith("Hello"));
EXPECT_THAT(actual_value, AllOf(Ge(5), Le(10)));
```

### 2. Using Assertions with Floating Point Values
Avoid using `EXPECT_EQ` for floating point comparisons â€” rounding errors make this unreliable.

Use specialized macros:
- `EXPECT_FLOAT_EQ` for `float`
- `EXPECT_DOUBLE_EQ` for `double`
- `EXPECT_NEAR(val1, val2, abs_error)` for custom precision

Example:
```cpp
EXPECT_NEAR(a, b, 0.001) << "Values differ by more than 0.001";
EXPECT_FLOAT_EQ(x, y);
```

### 3. Validating Containers with Matchers
GoogleTest matchers allow direct verification of STL containers:
- Exact match: `EXPECT_THAT(container, ElementsAre(1, 2, 3));`
- Containment: `EXPECT_THAT(container, Contains(5));`
- Every element: `EXPECT_THAT(container, Each(Gt(0)));`
- Unordered elements: `EXPECT_THAT(container, UnorderedElementsAre(3, 1, 2));`

Use container matchers that compare order or tolerate unordered content as appropriate.

### 4. Combining Matchers
Matchers can be combined using:
- `AllOf(m1, m2, ...)`: matches if all matchers match.
- `AnyOf(m1, m2, ...)`: matches if any matcher matches.
- `Not(m)`: matches if matcher `m` does not match.

Example:
```cpp
EXPECT_THAT(value, AllOf(Ge(5), Le(10)));
EXPECT_THAT(container, AnyOf(Contains(3), Contains(5)));
EXPECT_THAT(string, Not(HasSubstr("error")));
```

### 5. Matching Function Arguments in Mocks
Use matchers inside `EXPECT_CALL` or `ON_CALL` to specify argument expectations.
Wildcards:
- `_` matches anything.
- `A<T>()` or `An<T>()` matches any argument of type `T`.

Example:
```cpp
EXPECT_CALL(mock_obj, Process(_)).Times(2);
EXPECT_CALL(mock_obj, Save(Key(Ge(5)), _));
```

### 6. Handling Special Argument Types
- Use `IsNull()`, `NotNull()` to check pointer arguments.
- Use `Pointee(m)` to match the value pointed to by a pointer argument.
- Use `Ref(variable)` to match if argument references the given variable.

Example:
```cpp
EXPECT_CALL(mock, Process(Pointee(Eq(42))));
EXPECT_CALL(mock, Setup(Ref(config)));
```

### 7. Using Multi-Argument Matchers
To match against multiple arguments together:
- `.With(multi_argument_matcher)` restricts matching to calls where the whole argument tuple matches `m`.

Example:
```cpp
EXPECT_CALL(mock, Update(_, _)).With(Lt());  // First arg less than second.
```

### 8. Creating Custom Matchers
Create expressive, reusable matchers using `MATCHER` macros.
Example:
```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_THAT(value, IsEven());
```

Parameterized matchers:
```cpp
MATCHER_P(IsMultipleOf, n, "checks if arg is multiple of n") {
  return (arg % n) == 0;
}
EXPECT_THAT(value, IsMultipleOf(3));
```

### 9. Common Pitfalls and Anti-Patterns
- Avoid over-constraining tests using excessive `EXPECT_CALL` clauses.
- Use `ON_CALL` to set default behavior without setting expectations.
- Use `NiceMock` or `StrictMock` to control behavior on uninteresting calls appropriately.
- Remember `EXPECT_EQ` between floating points may silently fail; use floating-point aware assertions.

---

## Practical Examples

### Basic Assertion
```cpp
TEST(FactorialTest, BasicAssertions) {
  EXPECT_EQ(Factorial(1), 1);
  EXPECT_NE(Factorial(2), 1);
  EXPECT_GT(Factorial(3), 3);
  EXPECT_LT(Factorial(4), 30);
}
```

### Floating Point Comparison
```cpp
TEST(MathTest, ApproxEqual) {
  float a = 0.1f + 0.2f;
  float b = 0.3f;
  EXPECT_FLOAT_EQ(a, b);
  EXPECT_NEAR(a, b, 0.00001f);
}
```

### Container Matching
```cpp
std::vector<int> v = {1, 2, 3, 4};
EXPECT_THAT(v, ElementsAre(1, 2, 3, 4));
EXPECT_THAT(v, UnorderedElementsAre(4, 3, 2, 1));
EXPECT_THAT(v, Each(Gt(0)));
EXPECT_THAT(v, Contains(3));
```

### Using Matchers in Mocks
```cpp
class MockDatabase {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& server), ());
  MOCK_METHOD(int, Query, (int id, std::vector<int>* results), ());
};

TEST(DatabaseTest, ConnectTest) {
  MockDatabase db;
  EXPECT_CALL(db, Connect(StartsWith("dbserver")))
      .WillOnce(Return(true));
  EXPECT_TRUE(db.Connect("dbserver01"));
}
``` 

### Custom Matcher
```cpp
MATCHER(IsEven, "Checks if a number is even") {
  return (arg % 2) == 0;
}

TEST(CustomMatcherTest, Example) {
  int x = 4;
  EXPECT_THAT(x, IsEven());
}
```

---

## Troubleshooting & Tips

### Common Failures
- **Uninteresting mock function call warnings**: Use `NiceMock` to suppress warnings or add explicit `EXPECT_CALL` with `Times(AnyNumber())` for calls you want to ignore.
- **Floating point equality issues**: Avoid `EXPECT_EQ` for floats/doubles. Use `EXPECT_FLOAT_EQ` or `EXPECT_NEAR` for precision-sensitive comparisons.
- **Matcher mismatches**: Check argument types and use `SafeMatcherCast` if needed, especially for polymorphic values.

### Best Practices
- Prefer `ON_CALL` for defining default mock behavior without setting expectations.
- Use `EXPECT_CALL` sparingly to verify calls you are interested in.
- Structure expectations using `Sequence` and `InSequence` when call order matters.
- Create reusable matchers/custom actions for complex validations.

### Performance Considerations
- Define mock classes in separate compilation units to minimize compile time.
- Minimize usage of heavy custom matchers or actions in tight performance-sensitive loops.

### Alternative Approaches
- Use `Truly` matcher for arbitrary predicates.
- Combine multiple matchers using `AllOf`/`AnyOf`.
- For complex sets of expectations, use `ExpectationSet` and `.After()` for partial ordering.

---

## Next Steps & Related Content

- Learn about [Parameterized and Typed Tests](/guides/core-workflows/parameterized-typed-tests) to reuse test logic with varied data.
- Explore [Writing and Organizing Test Suites](/guides/core-workflows/writing-and-organizing-tests) for scalable test architecture.
- Dive into [Mocking with GoogleMock](/guides/mocking-patterns/introduction-to-mocking) for advanced mocking features.
- Consult [Matchers Reference](/docs/reference/matchers.md) for an exhaustive matcher catalog.
- Understand [Assertion Macros](/docs/reference/assertions.md) to select the right assertion.

---

## References

- [GoogleTest Primer](https://github.com/google/googletest/blob/main/docs/primer.md)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Matchers Reference](/docs/reference/matchers.md)
- [Assertions Reference](/docs/reference/assertions.md)
- [Mocking Reference](/docs/reference/mocking.md)

---

This documentation provides a practical, step-by-step approach to leverage GoogleTest's assertions and matchers effectively in your tests, helping ensure code correctness with clarity and maintainability.