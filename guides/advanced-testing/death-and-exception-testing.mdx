---
title: "Testing for Deaths and Exceptions"
description: "Learn to verify failure conditions, fatal errors, and exception paths robustly using GoogleTest's death tests and exception assertions. Understand best practices for validating error-handling code and common patterns in testing for failures."
---

# Testing for Deaths and Exceptions

## Overview

This guide helps you **verify failure conditions, fatal errors, and exception handling robustly** in your C++ tests using GoogleTest. It covers writing death tests that confirm your code terminates as expected and assertions for validating exception paths safely.

You will learn how to write targeted tests that check your program’s behavior under fatal circumstances such as assertion failures and process termination, as well as how to use exception assertions to verify exception throwing and catching correctly.

## Prerequisites

- A working C++17 environment with GoogleTest integrated into your project.
- Basic familiarity with writing tests using `TEST()`, `TEST_F()`, and GoogleTest assertions.
- Understanding of your program's fatal error points or exception-throwing paths.

## Expected Outcome

By the end of this guide, you will be able to:
- Write **death tests** that verify your code terminates with expected error outputs.
- Use **exception assertions** to check that code throws or does not throw expected exceptions.
- Apply best practices to avoid common pitfalls in failure testing.

## Time Estimate

Approximately 20-30 minutes to read through and implement basic death and exception tests.

## Difficulty Level

Intermediate – Requires understanding of test isolation, process control, and C++ exceptions.

---

## Step-by-Step Instructions

### 1. Writing Death Tests to Verify Process Termination

Death tests check that a piece of code causes the process to terminate in a controlled way—such as on a failed assertion or a call to `abort()`.

#### How to Write a Death Test

Use the macros `ASSERT_DEATH()` or `EXPECT_DEATH()` as follows:

```cpp
TEST(MyDeathTest, CrashesOnInvalidInput) {
  ASSERT_DEATH(SomeFunctionThatShouldCrash(-1), "expected error message regex");
}
```

- The first parameter is the statement that should cause the process to die.
- The second parameter is a string or matcher that checks stderr output from the child process (regular expression).

#### Death Test Variants

- `ASSERT_DEATH` aborts the current function if the test fails.
- `EXPECT_DEATH` continues running after failure.
- `ASSERT_DEBUG_DEATH` and `EXPECT_DEBUG_DEATH` run the death test only in debug builds. In release builds, they run the statement normally.
- `ASSERT_EXIT` and `EXPECT_EXIT` additionally allow verifying exit codes or signals:

```cpp
EXPECT_EXIT(ProcessExitFunction(), ::testing::ExitedWithCode(0), "Success");
```

#### Best Practices

- Name your test suites containing death tests with the suffix `DeathTest` to ensure they're run before other tests, helping with threading isolation.

- Use `ASSERT_DEATH` when continuing the current test after a failure could cause undefined behavior.

- Avoid multiple death test assertions on the same line, as this can cause compilation issues.

- In death tests, side effects (like modifying variables) won't be visible in the parent process because the test runs in a separate child process.

- If you control mock objects in death tests, use `Mock::AllowLeak()` to prevent mock leak detection errors.

Example:

```cpp
class SomeDeathTest : public testing::Test {};

TEST_F(SomeDeathTest, DiesWhenInputIsNegative) {
  EXPECT_DEATH({
    SomeCriticalFunction(-1);
  }, "Invalid input");
}
```

### 2. Writing Exception Assertions

GoogleTest provides `EXPECT_THROW`, `EXPECT_ANY_THROW`, and `EXPECT_NO_THROW` macros to validate exception throwing behavior.

#### Basic Usage

- `EXPECT_THROW(statement, exception_type)` verifies that the statement throws an exception of the specified type.
- `EXPECT_ANY_THROW(statement)` checks that any exception is thrown.
- `EXPECT_NO_THROW(statement)` checks that no exception is thrown.

Example:

```cpp
TEST(ExceptionTest, ThrowsOnInvalidInput) {
  EXPECT_THROW(FunctionThatThrows(), std::invalid_argument);
  EXPECT_ANY_THROW(FunctionThatThrowsAny());
  EXPECT_NO_THROW(FunctionThatDoesNotThrow());
}
```

#### Tips

- Exception assertions require your build environment to enable exceptions.
- You can test compound statements by wrapping them in braces.

### 3. Handling Exceptions in Death Tests

When exceptions are thrown inside death test macros, GoogleTest reports the exception as a failure rather than crashing. For example:

```cpp
TEST(CxxExceptionDeathTest, ExceptionIsFailure) {
  EXPECT_NONFATAL_FAILURE(
    EXPECT_DEATH(throw std::runtime_error("error"), ""),
    "threw an exception"
  );
}
```

- This prevents exceptions from escaping death test macros.
- Exception messages are included in the failure output.

### 4. Configuring Death Test Styles

GoogleTest supports two styles of death tests:

- **fast** (default): The child process runs the test immediately after forking.
- **threadsafe**: The child process re-executes the test binary, running only the desired death test.

Set the style at runtime via:

```cpp
GTEST_FLAG_SET(death_test_style, "threadsafe");
```

Use threadsafe style in environments involving multiple threads to avoid fork-related issues.

### 5. Validating Death Test Outcomes

Death tests check that:

- The statement terminates the process.
- The stderr output matches the regex provided.
- The exit status matches expectations (for `EXPECT_EXIT`).

If any check fails, GoogleTest reports a failure with detailed output including actual stderr content.

### 6. Common Pitfalls

- **Multiple threads** when running death tests may cause hanging or flakiness.
- **Invalid regex** syntax will cause death tests to fail.
- **Statements with return statements** inside death tests are illegal and cause failures.
- Expecting death on non-fatal failures—GoogleTest assertions like `EXPECT_*` do not cause death, so your death test must cause true process termination.

---

## Examples

### Example 1: Validating Abort on Invalid Parameter

```cpp
TEST(FooDeathTest, FailsOnNullPointer) {
  EXPECT_DEATH(Foo(nullptr), "null pointer");
}
```

Validates that calling `Foo` with a `nullptr` causes process termination with an error message containing 'null pointer'.

### Example 2: Asserting Exception Throwing

```cpp
TEST(BarTest, ThrowsOnNegativeValue) {
  EXPECT_THROW(Bar(-5), std::invalid_argument);
}
```

Checks that `Bar()` throws an `std::invalid_argument` when passed a negative number.

### Example 3: Death Test with Exit Code Verification

```cpp
TEST(ExitTest, ExitsSuccessfully) {
  EXPECT_EXIT(ExitFunction(), ::testing::ExitedWithCode(0), "Success");
}
```

Verifies `ExitFunction` exits with code 0 and prints "Success".

### Example 4: Death Test Catching Exception Escape

```cpp
TEST(CxxExceptionDeathTest, ExceptionIsFailure) {
  EXPECT_NONFATAL_FAILURE(
    EXPECT_DEATH(throw std::runtime_error("error"), ""),
    "threw an exception"
  );
}
```

Ensures exceptions thrown inside death test code do not escape the macro.

---

## Troubleshooting & Tips

<AccordionGroup title="Common Issues and Solutions">
<Accordion title="Death Test Fails Without Process Termination">
Ensure your statement actually aborts or crashes. GoogleTest assertions (`EXPECT_*`) do not cause death.
</Accordion>
<Accordion title="Death Test Fails Due to Regex Mismatch">
Check your regex syntax and confirm error output matches regex precisely. Use simpler regex during debugging.
</Accordion>
<Accordion title="Exception Escapes Death Test">
Verify you have exceptions enabled in your build. Use `EXPECT_NONFATAL_FAILURE` to catch exceptions escaping death tests.
</Accordion>
<Accordion title="Multiple Death Tests on Same Line Cause Compile Errors">
Place each death test macro on its own line to avoid macro expansion conflicts.
</Accordion>
<Accordion title="Threaded Environment Causes Death Test Failures or Hangs">
Try switching to `threadsafe` style with `GTEST_FLAG_SET(death_test_style, "threadsafe");`.
</Accordion>
</AccordionGroup>

<Tip>
Name your test suites with `*DeathTest` suffix to ensure early execution and environment readiness for death tests.
</Tip>

<Tip>
Use `EXPECT_THROW` family for exception testing and `EXPECT_DEATH` family for termination testing. They serve different purposes.
</Tip>

---

## Next Steps & Related Content

- Learn to write [Custom Assertions and Matchers](https://google.github.io/googletest/guides/advanced-testing/custom-assertions-matchers) to extend testing expressiveness.
- Explore [Using Mocks in Tests](https://google.github.io/googletest/guides/core-testing-workflows/using-mocks-in-tests) to isolate failure paths.
- Understand [Structuring Test Suites](https://google.github.io/googletest/guides/core-testing-workflows/structuring-test-suites) for scalable test management.
- Review the [Assertions Reference](../reference/assertions.md) for full details on assertions including death and exception macros.

---

## References

- [GoogleTest Death Assertions](../reference/assertions.md#death)
- [GoogleTest Exception Assertions](../reference/assertions.md#exceptions)
- [Death Tests Section in Advanced Topics](../advanced.md#death-tests)
- [GoogleTest Primer](../primer.md) for core concepts
- GitHub Repository: [https://github.com/google/googletest](https://github.com/google/googletest)

---

*This documentation focuses specifically on verifying error and failure handling using GoogleTest's death and exception testing features, empowering you to write robust tests that check how your program handles fatal errors and unexpected conditions.*
