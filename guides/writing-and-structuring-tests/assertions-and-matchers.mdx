---
title: "Assertions and Matchers in Depth"
description: "Explore the range of assertions provided by GoogleTest and discover how to use built-in and custom matchers for more readable and robust test conditions. Understand matcher composition and typical usage scenarios."
---

# Assertions and Matchers in Depth

## Overview

This guide dives deep into GoogleTest's powerful assertions and matchers, enabling you to write expressive, readable, and robust test conditions. You'll discover how to leverage built-in assertions, compose matchers, and create custom matchers to verify complex code behavior effectively.

---

## 1. Understanding Assertions

Assertions are the fundamental building blocks used to check conditions in your tests. GoogleTest provides a rich set of assertion macros, which come in two flavors:

- **`EXPECT_` assertions**: Generate nonfatal failures and allow the test to continue running.
- **`ASSERT_` assertions**: Generate fatal failures and abort the current function immediately.

Both support streaming custom failure messages to provide clearer diagnostics.

### Key Assertion Types

- **Boolean Conditions**: `EXPECT_TRUE()`, `EXPECT_FALSE()`
- **Binary Comparisons**: `EXPECT_EQ()`, `EXPECT_NE()`, `EXPECT_LT()`, `EXPECT_LE()`, `EXPECT_GT()`, `EXPECT_GE()`
- **String Comparisons** (C strings): `EXPECT_STREQ()`, `EXPECT_STRNE()`, `EXPECT_STRCASEEQ()`, `EXPECT_STRCASENE()`
- **Floating-Point Comparisons**: `EXPECT_FLOAT_EQ()`, `EXPECT_DOUBLE_EQ()`, `EXPECT_NEAR()`
- **Exception Assertions**: `EXPECT_THROW()`, `EXPECT_NO_THROW()`, `EXPECT_ANY_THROW()`
- **Death Tests**: `EXPECT_DEATH()`, `EXPECT_EXIT()` (to verify that code terminates as expected)

### Using `EXPECT_THAT` with Matchers

For more flexible assertions, especially for complex data and conditions, use `EXPECT_THAT(value, matcher)`:

```cpp
EXPECT_THAT(value, StartsWith("Hello"));
EXPECT_THAT(number, AllOf(Ge(5), Le(10), Ne(7)));
```

Matchers provide human-readable error messages and let you express intent clearly.

---

## 2. Matchers: Expressing What You Expect

Matchers enable you to specify the precise properties that arguments or values must satisfy. They allow partial matching, composition, and custom behavior.

### Built-in Matchers

- **Wildcard:** `_` matches any value.
- **Equality and Comparison:** `Eq()`, `Ne()`, `Lt()`, `Le()`, `Gt()`, `Ge()`
- **Logical combinations:** `AllOf()`, `AnyOf()`, `Not()`
- **String matching:** `StartsWith()`, `Contains()`, `EndsWith()`, `MatchesRegex()`
- **Container matchers:** `ElementsAre()`, `UnorderedElementsAre()`, `Pointee()`

### Matching Multiple Arguments as a Whole

Use the `.With()` clause in expectations to match the whole argument tuple at once:

```cpp
EXPECT_CALL(mock, Func(_, _))
    .With(Lt());  // expects first arg < second arg
```

You can also define matchers over subsets of arguments using `Args<>()` and `AllArgs()`.

### Combining Matchers

Matchers can be composed into complex conditions:

```cpp
EXPECT_CALL(foo, Bar(AllOf(Gt(5), Ne(10))));
EXPECT_CALL(foo, Baz(Not(HasSubstr("error"))));
```

### Custom Matchers

You can define your own matcher classes for domain-specific checks. Here's a simple example of a matcher verifying divisibility:

```cpp
MATCHER(IsDivisibleBy7, "") {
  return (arg % 7) == 0;
}

// Usage:
EXPECT_CALL(mock, Func(IsDivisibleBy7()));
```

Custom matchers can produce detailed failure messages and can be parameterized using macros like `MATCHER_P`.

---

## 3. Setting Expectations with Assertions and Matchers

Use assertions combined with matchers to specify the exact behavior and constraints of your tested code.

### Basic Example

```cpp
using ::testing::_;  // For wildcard matcher
using ::testing::Return;

EXPECT_CALL(mock_object, Method(Eq(42), _))
    .Times(1)
    .WillOnce(Return(true));

EXPECT_TRUE(function_under_test());
```

This expects `mock_object.Method()` to be called once where the first argument equals 42 and the second can be anything, returning `true`.

### Handling Uninteresting or Unexpected Calls

- **Uninteresting calls**: method calls without an expectation produce warnings by default, unless suppressed with `NiceMock` or explicit expectations.
- **Unexpected calls**: method calls that violate existing expectations produce errors.

### Using `EXPECT_THAT` for Richer Checks

To assert complex conditions on values or mock call arguments, `EXPECT_THAT` with matchers provides better readability and diagnostics than basic assertions.

---

## 4. Practical Tips and Best Practices

- Use `EXPECT_THAT` to make your assertions clear and expressive.
- Compose matchers to capture complex argument properties succinctly.
- Use the wildcard matcher `_` when arguments are irrelevant.
- Use `.With()` for matching all arguments as a tuple when their combined relationship matters.
- Prefer `ON_CALL` for establishing default behavior without enforcing call expectations.
- Use `EXPECT_CALL` to specify precisely when and how often mock methods should be invoked.
- Define custom matchers for reusable, domain-specific verification logic.
- Leverage `MATCHER` macros for concise matcher definitions.

---

## 5. Troubleshooting Assertion Failures

- Run tests with the `--gmock_verbose=info` flag to get detailed matching information and call traces.
- Carefully check matcher types and ensure they match the function argument types.
- Use parenthesized matchers or `SafeMatcherCast` to resolve type mismatches and overload ambiguities.
- For unexpected call errors, review all expectations and ensure their argument matchers do not conflict.
- If tests fail with too strict expectations, consider relaxing matchers or cardinalities.

---

## 6. Advanced Topics and Next Steps

- Explore defining parameterized matchers with `MATCHER_P`, `MATCHER_P2`, ... for flexible condition reuse.
- Learn about `Expectation` and `ExpectationSet` for ordering and dependency among mock calls.
- Review the usage of `RetiresOnSaturation()`, `.InSequence()`, and `.After()` clauses for precise control over call order and lifecycle.
- Check the GoogleMock Cookbook for patterns on combining assertions, matchers, and actions.

---

## References and Related Documentation

- [Official Assertions Reference](reference/assertions.md)
- [Matchers Guide](reference/matchers.md)
- [Mocking Reference](docs/reference/mocking.md)
- [gMock Cookbook](docs/gmock_cook_book.md)
- [Writing New Matchers Quickly](docs/gmock_cook_book.md#NewMatchers)
- [Mocking Basics Introduction](guides/getting-started/basic-mocking.md)
- [Advanced Mocking Patterns](guides/writing-and-structuring-tests/advanced-mocking-patterns.md)

---

## Summary

This guide has explored GoogleTest's capabilities in crafting precise, expressive, and maintainable test validations via assertions and matchers. You now understand the different types of assertions, how to apply matchers effectively (including multi-argument and custom matchers), and best practices for writing robust tests that gracefully handle expected and unexpected behavior.

Use this knowledge to improve test clarity, maintainability, and correctness in your C++ projects.

---

## Examples

### Simple EXPECT_CALL with Matcher

```cpp
using ::testing::Return;
using ::testing::_;

class MockCalculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), ());
};

...
MockCalculator calc;
EXPECT_CALL(calc, Add(_, _))
    .WillRepeatedly(Return(42));

int result = calc.Add(1, 2);  // returns 42
```

### Expectation for Ordered Calls

```cpp
using ::testing::InSequence;

{
  InSequence seq;
  EXPECT_CALL(mock, Foo(1));
  EXPECT_CALL(mock, Foo(2));
  EXPECT_CALL(mock, Foo(3));
}

mock.Foo(1); // OK
mock.Foo(3); // Fails (out of order)
```

### Custom Matcher Example

```cpp
MATCHER_P(IsBetween, range, "") {
  return arg >= std::get<0>(range) && arg <= std::get<1>(range);
}

EXPECT_CALL(mock, Process(IsBetween(std::make_pair(10, 20))));
```

---

## Callouts

<Tip>
Use `EXPECT_THAT` with matchers for clearer and more robust assertions instead of bare `EXPECT_EQ` or `EXPECT_TRUE`.
</Tip>

<Note>
Matchers are purely functional and must not have side effects or call mock methods.
</Note>

<Warning>
Avoid over-specifying mock expectations to prevent brittle tests. Use `ON_CALL` for default behavior without call count constraints.
</Warning>

<Check>
Verify matcher types match the mock method argument types, and disambiguate overloaded methods with `Const()` or `SafeMatcherCast`.
</Check>
