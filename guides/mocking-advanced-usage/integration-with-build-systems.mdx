---
title: "Integrating with Build Systems & External Tools"
description: "Seamlessly integrate GoogleTest and GoogleMock into your CI/CD pipeline and external tools. Understand best practices for running tests via CMake, Bazel, or Makefiles, generating reports, and leveraging IDE/test runners for productivity."
---

# Integrating with Build Systems & External Tools

GoogleTest and GoogleMock offer seamless integration pathways to embed testing into your CI/CD pipelines and external tools. This guide empowers you to integrate test execution and reporting efficiently, whether using CMake, Bazel, Makefiles, or IDE test runners, while following best practices for productivity and automation.

---

## 1. Overview of Integration Goals

- **Task Description**: Enable automated building, running, and reporting of tests written with GoogleTest and GoogleMock within your continuous integration and external tooling.
- **Prerequisites**: A working build environment with GoogleTest and GoogleMock sources or pre-built libraries; basic understanding of your build system (CMake, Bazel, Makefiles); access to the test binaries.
- **Expected Outcome**: Configured build files that build and run your tests automatically, collect and integrate test results into CI dashboards or IDE test runners, improving feedback loops for developers.
- **Time Estimate**: 30–60 minutes for initial integration, plus ongoing tuning.
- **Difficulty Level**: Intermediate

---

## 2. Running Tests via CMake

GoogleTest and GoogleMock provide out-of-the-box CMake support with target libraries and convenient testing infrastructure.

### Step-by-Step Setup

<Steps>
<Step title="Add GoogleTest/GoogleMock to Your CMake Project">
Include GoogleTest/GoogleMock source via `add_subdirectory()` or find installed package:

```cmake
# Embedded method example
add_subdirectory(path/to/googletest)

# Or find installed package
find_package(GTest CONFIG REQUIRED)

add_executable(my_tests test1.cpp test2.cpp)
target_link_libraries(my_tests PRIVATE GTest::gtest_main GTest::gmock)
```

This uses the `gtest_main` or `gmock_main` library, which includes a default `main()` that initializes and runs all tests.
</Step>

<Step title="Configure Tests for CTest">
Make your test executables discoverable by CTest for integration with `make test` or `ctest`:

```cmake
add_test(NAME my_tests COMMAND my_tests)
```

This registers your test executable with CTest to execute and report results.
</Step>

<Step title="Run Tests and Generate Reports">
Run your tests with:

```bash
ctest --output-on-failure
```

To generate XML test result reports (compatible with most CI systems), run:

```bash
ctest -T Test --no-compress-output
```

Configure your CI pipeline to capture these XML reports for test result visualization.
</Step>

<Step title="Customize Test Run Configuration">
Pass GoogleTest flags by appending them to `ctest` or your executable command, such as:

```bash
./my_tests --gtest_filter=MySuite.* --gtest_repeat=2 --gtest_shuffle
```

Customize these flags in CMake if needed with:

```cmake
set_tests_properties(my_tests PROPERTIES PASS_REGULAR_EXPRESSION "^.*Passed$")
```

Use `testing::InitGoogleTest()` in a custom `main()` when embedding non-standard initialization.
</Step>
</Steps>

### Best Practices

- Link against `gtest_main` or `gmock_main` to avoid writing a custom `main()` unless test initialization needs customization.
- Use CTest to integrate with CI systems effortlessly.
- Generate XML test results for CI dashboards.

<Tip>
If you want to disable GoogleMock main and just build GoogleMock library, use `-DBUILD_GMOCK=ON` and `-DBUILD_GTEST=ON` flags appropriately.
</Tip>

---

## 3. Integrating with Bazel

Bazel integration allows you to include GoogleTest/GoogleMock tests in your Bazel builds with ease and consistency.

### Essential Steps

1. **Add External Dependency**

Update your `WORKSPACE` file to include GoogleTest and GoogleMock via `http_archive` (or similar remote repository fetch):

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.17.0.tar.gz"],
    strip_prefix = "googletest-release-1.17.0",
)
```

2. **Write BUILD Files**

Create `BUILD` files referencing `cc_test` or `cc_binary` for your tests, linking against `@com_google_googletest//:gtest_main` or `:gmock_main`:

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gtest_main", "@com_google_googletest//:gmock"],
)
```

3. **Run Tests**

Invoke Bazel test:

```bash
bazel test //path/to:my_test
```

The output includes detailed results and is interpretable by CI systems.

### Tips

- Use Bazel `tags` to group or filter tests.
- Follow Bazel’s workspace and BUILD file best practices to keep tests modular.

---

## 4. Running Tests with Makefiles

For projects using GNU Make or similar, you can write rules to build and execute test binaries.

### Steps

1. **Compile Tests**

Ensure your Makefile includes compilation of tests linking `libgtest` and `libgmock` if installed, or with source files:

```make
TESTS = test1 test2

all: $(TESTS)

test1: test1.o
	$(CXX) -o $@ $^ -lgtest_main -lgmock -pthread


# Add similar rules for other tests
```

2. **Run Tests**

Add a target to run all tests:

```make
run_tests: all
	./test1
	./test2
```

3. **Generate Reports**

Run tests with GoogleTest flags to produce JUnit XML reports if your CI supports it:

```make
./test1 --gtest_output=xml:report1.xml
```

Aggregate reports for CI use.

### Tips

- Consider adding a `clean` target to remove built artifacts.
- Use parallel test execution where possible.

---

## 5. Leveraging IDEs and Test Runners

Many modern IDEs and editors support GoogleTest as a test framework, allowing you to run, debug, and analyze tests interactively.

### Productivity Enhancements

- **Auto-Discovery:** IDEs like CLion and Visual Studio automatically detect tests in your source tree if linked with GoogleTest libraries.
- **Filter and Navigate:** Use IDE test runners to filter by test suite, individual tests, and rerun failures quickly.
- **Debugging:** Attach the debugger on test failure points directly from the IDE.
- **Integration:** IDEs can consume XML (JUnit) reports generated by GoogleTest, enhancing test monitoring.

### Practical Tips

- Ensure your build system generates the test binaries with debug symbols.
- Link with `gtest_main` or `gmock_main` unless you provide a custom `main`.
- Use test annotations and naming conventions to organize within IDEs.

---

## 6. Understanding Default `main()` Behavior

GoogleTest and GoogleMock provide default `main()` implementations via `gtest_main` and `gmock_main` libraries. These simplify test programs by handling command-line parsing and test execution setup.

- **Default main()** located in `googletest/src/gtest_main.cc` and `googlemock/src/gmock_main.cc` initializes the test framework (`InitGoogleTest()` or `InitGoogleMock()`) and calls `RUN_ALL_TESTS()`.

- If your test setup requires customized initialization or command-line handling, implement your own `main()` that calls these initialization functions explicitly.

<Tip>
Link against `gtest_main` or `gmock_main` to avoid writing boilerplate for a `main()` function in most cases.
</Tip>

---

## 7. Generating and Using Test Reports

Automated test reports boost CI feedback and quality control.

### Generating Reports

- Use the `--gtest_output` flag to generate XML reports:

```bash
./my_tests --gtest_output=xml:report.xml
```

- Use `ctest` with XML output support for native integration.

### Integrating Reports

- Configure your CI server (e.g., Jenkins, GitLab, GitHub Actions) to consume these XML files for test result visualization.
- Enable test failure notifications based on results.

---

## 8. Troubleshooting Common Issues

<AccordionGroup title="Common Integration Issues and Solutions">
<Accordion title="Tests Not Running or Discovered">
- Verify test executables are included in `add_test()` or Bazel `cc_test()`.
- Ensure `main()` is present via `gtest_main` or custom implementation.
- Confirm tests are not filtered out by `--gtest_filter` flags unintentionally.
</Accordion>

<Accordion title="Linking Errors with gtest_main or gmock_main">
- Confirm proper linking order and presence of pthreads (`-lpthread`) on POSIX systems.
- Check your CMake or Makefile config includes `gtest_main` or `gmock_main`.
- For Windows, ensure runtime libraries match between your project and GoogleTest builds.
</Accordion>

<Accordion title="Test Report XML Not Generated or Empty">
- Confirm correct syntax of `--gtest_output=xml:<filename>`.
- Check that tests actually execute and complete.
- Verify file system permissions for report file paths.
</Accordion>

<Accordion title="CI Integration Failing to Parse Reports">
- Make sure your CI tool expects the GoogleTest XML format.
- Validate XML files for corruption.
- Check paths and report artifact upload in CI configuration.
</Accordion>
</AccordionGroup>

<Tip>
Run tests locally with verbose logging to help diagnose failing integrations before pushing changes to CI.
</Tip>

---

## 9. Summary and Best Practices

- **Automate**: Integrate tests into your build and CI pipelines using CTest, Bazel test rules, or Makefile targets.
- **Use Defaults**: Leverage `gtest_main` and `gmock_main` to avoid writing your own `main()` unless customization is needed.
- **Report**: Generate JUnit-compatible XML reports for CI dashboard integration.
- **Leverage Tools**: Use IDE test runners to boost development productivity.
- **Validate**: Confirm your tests run correctly locally in your build environment before CI integration.

---

## 10. Next Steps & Related Documentation

- [Setup & Installation Guide](/guides/getting-started/setup-and-installation)
- [Your First Test](/guides/getting-started/your-first-test)
- [Using Bazel for Build & Test](/getting-started/installation-guides/bazel-integration)
- [Mocking Reference](/api-reference/mocking-apis/expectations-behaviors)
- [Debugging Common Test Failures](/guides/real-world-patterns/debugging-common-failures)

Explore these documents to deepen your mastery of test writing, mocking, and integration.

---

## Appendix: Sample CMakeLists.txt Snippet Integrating GoogleMock

```cmake
cmake_minimum_required(VERSION 3.14)
project(MyProject LANGUAGES CXX)

# Enable testing
include(CTest)

# Add GoogleTest
add_subdirectory(third_party/googletest)

add_executable(my_tests test_main.cpp my_tests.cpp)

# Link with GoogleMock and GoogleTest
target_link_libraries(my_tests PRIVATE gmock_main)

# Register test with CTest
add_test(NAME my_tests COMMAND my_tests)
```

Ensure `third_party/googletest` points to Googletest source or installed location.


---

## Appendix: Sample Bazel BUILD File

```python
cc_test(
    name = "my_test",
    srcs = ["my_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

Run with:

```bash
bazel test //path/to:my_test
```

See Bazel documentation for advanced configuration.

---

This guide equips you to efficiently embed GoogleTest and GoogleMock in your developer workflow and CI pipeline, helping you automate testing and reap reliable, fast feedback.
