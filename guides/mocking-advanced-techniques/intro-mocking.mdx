---
title: "Intro to Mocking with GoogleMock"
description: "Step-by-step tutorial for defining and using mock objects, setting expectations, and verifying interactions to achieve comprehensive test isolation."
---

# Intro to Mocking with GoogleMock

## Overview
This guide walks you through the essential process of defining and using mock objects in GoogleMock, setting up expectations, and verifying interactions to achieve complete test isolation. By following this tutorial, you will master the creation of mocks for interfaces, controlling mock behavior, and validating that your code interacts with dependencies exactly as intended.

---

## Workflow Overview

### Goal
Enable you to create mock classes and objects using GoogleMock,
set precise expectations on how mocked methods are called,
and verify those expectations during unit testing to isolate code behavior.

### Prerequisites
- Basic understanding of C++ and unit testing concepts.
- GoogleMock (gMock) library installed and integrated with your test environment.
- Familiarity with virtual functions in C++.

### Expected Outcome
- You will define mock classes from interfaces using `MOCK_METHOD`.
- You will create mock objects and specify expected method calls with `EXPECT_CALL`.
- You will learn how to set default behaviors using `ON_CALL`.
- You will handle complex mocking scenarios such as overloaded methods and sequences.
- You will verify and reset mocks programmatically.

### Time Estimate
Approximately 20–30 minutes to complete the entire workflow with hands-on coding.

### Difficulty Level
Intermediate — assumes familiarity with C++ testing and virtual functions.

---

## Step-by-Step Instructions

### 1. Define a Mock Class

The first step is to define a mock class that inherits from the interface or abstract class you want to mock. Use the `MOCK_METHOD` macro inside the mock class to mock virtual methods.

**Key points:**
- The base class methods must be `virtual`.
- The mock class should override these methods.
- `MOCK_METHOD` syntax:

```cpp
MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
```

- Use `(override)` to indicate override; use `(const, override)` for const methods.

**Example:**
```cpp
#include <gmock/gmock.h>

class Foo {
 public:
  virtual ~Foo();
  virtual int GetSize() const = 0;
  virtual std::string Describe(const char* name) = 0;
  virtual bool Process(int elem, int count) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetSize, (), (const, override));
  MOCK_METHOD(std::string, Describe, (const char* name), (override));
  MOCK_METHOD(bool, Process, (int elem, int count), (override));
};
```

> **Tip:** If your methods are overloaded, mock all versions you intend to use, adding the `override` qualifier accordingly.


### 2. Create Mock Objects

Instantiate your mock class where you want to use mocked dependencies in your tests.

```cpp
MockFoo mock_foo;
```

If you want to control how mock objects treat uninteresting calls:
- `NiceMock<MockFoo>` ignores uninteresting calls.
- `NaggyMock<MockFoo>` (default) warns on uninteresting calls.
- `StrictMock<MockFoo>` treats uninteresting calls as failures.

```cpp
using ::testing::NiceMock;
NiceMock<MockFoo> nice_mock;
```

### 3. Set Default Actions (Optional)

If you want to specify what a mock method should return or do by default when it’s called without explicit expectations, use `ON_CALL`:

```cpp
using ::testing::Return;
ON_CALL(mock_foo, GetSize()).WillByDefault(Return(10));
```

This does not enforce that the method *must* be called; it only controls the behavior when called.

### 4. Set Expectations with `EXPECT_CALL`

Specify how your code is expected to interact with the mock object:

- Which methods should be called?
- How many times?
- With what arguments?
- What should be returned or done when called?

The general form is:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- If `Times` is omitted, it is inferred from the number of `WillOnce` clauses or defaults to 1.
- Use matchers like `_` (wildcard), `Eq()`, `Ge()`, etc. to specify arguments.

**Example:**
```cpp
using ::testing::Return;
using ::testing::_;

EXPECT_CALL(mock_foo, Describe(_))
    .Times(3)
    .WillRepeatedly(Return("Fixed description"));
```

### 5. Organize Calls in Sequence (Optional)

If the order of calls matters, use `InSequence` to enforce sequential expectations:

```cpp
{
  ::testing::InSequence seq;
  EXPECT_CALL(mock_foo, MethodA());
  EXPECT_CALL(mock_foo, MethodB());
}
```

All calls within the `InSequence` block must occur in that order.

### 6. Exercise Your Code

Run your test code which uses the mock objects. gMock will verify that all expectations are satisfied automatically at the end of the test or when the mock is destroyed.

**Example:**

```cpp
ASSERT_EQ(10, mock_foo.GetSize());
mock_foo.Describe("abc");
mock_foo.Describe("xyz");
mock_foo.Describe("def");
```

### 7. Verifying and Resetting a Mock (Advanced)

You can explicitly verify that expectations were met before a mock is destructed and clear expectations using:

```cpp
using ::testing::Mock;

// Verify all expectations on mock_foo were met.
bool result = Mock::VerifyAndClearExpectations(&mock_foo);
```

Do not set new expectations on a mock after verification and clearing.

### 8. Handling Common Scenarios

#### Mocking Overloaded Methods
Define mocks for each overload:

```cpp
MOCK_METHOD(int, Foo, (int));
MOCK_METHOD(int, Foo, (double), (const, override));
```
Disambiguate call sites using `Const()` or static_cast, if necessary.

#### Matchers for Arguments
Use `_` to match any argument or specify matchers like `Ge(n)`, `Eq(value)`, etc.

#### Retiring Expectations
Use `.RetiresOnSaturation()` to deactivate an expectation once it has reached its call count.

#### Ignoring Uninteresting Calls
Use `NiceMock` or add catch-all expectations with `.Times(AnyNumber())` on methods you do not want to fail on.

---

## Examples

### Defining a Mock for a Simple Interface
```cpp
class Calculator {
 public:
  virtual ~Calculator() {}
  virtual int Add(int a, int b) = 0;
  virtual int Subtract(int a, int b) const = 0;
};

class MockCalculator : public Calculator {
 public:
  MOCK_METHOD(int, Add, (int a, int b), (override));
  MOCK_METHOD(int, Subtract, (int a, int b), (const, override));
};
```

### Setting Expectations for Calls
```cpp
using ::testing::Return;
using ::testing::_;

MockCalculator mock_calc;

// Expect Add to be called once with any arguments and return their sum.
EXPECT_CALL(mock_calc, Add(_, _)).WillOnce([](int a, int b) { return a + b; });

// Expect Subtract to return -1 for any call.
ON_CALL(mock_calc, Subtract(_, _)).WillByDefault(Return(-1));

int result = mock_calc.Add(3, 4);  // returns 7
int diff = mock_calc.Subtract(10, 5);  // returns -1 (default)
```

### Enforcing Call Order
```cpp
{
  ::testing::InSequence seq;
  EXPECT_CALL(mock_calc, Add(1, 2));
  EXPECT_CALL(mock_calc, Subtract(4, 3));
}

mock_calc.Add(1, 2);      // OK
mock_calc.Subtract(4, 3); // OK
``` 

### Verifying Expectations Early
```cpp
using ::testing::Mock;

bool ok = Mock::VerifyAndClearExpectations(&mock_calc);
ASSERT_TRUE(ok);
```

---

## Troubleshooting & Tips

### Common Issues

- **Unexpected function calls:** You may see errors when a function is called more times than expected or with unmatched arguments. Use `--gmock_verbose=info` to print detailed traces.

- **Uninteresting calls:** Warnings indicate mock methods called without matching `EXPECT_CALL`. Use `NiceMock` or add broad expectations with `.Times(AnyNumber())`.

- **Mock destructor usage:** To test destruction order, mock a `Die()` method and call it in the destructor.

- **Overloaded functions confusion:** Use `Const()` or cast matchers to specify the intended overload.

- **Default actions not set:** If a mock function has no default action and gets called unexpectedly, define behaviors with `ON_CALL`.

### Best Practices

- Always define expectations before exercising the mock.
- Don't over-specify expectations; verify only what your test truly cares about.
- Use `RetiresOnSaturation()` to deactivate expectations after they're met.
- Prefer writing mocks for interfaces you own, or place mock definitions close to the interface.
- Use `DelegateToFake()` or delegation to a real or fake object if you want partial mock behavior.

### Performance Considerations

- Moving mock class constructor and destructor definitions to `.cc` files can reduce build times.
- Avoid mocking non-virtual methods unless you explicitly understand high-performance dependency injection.

---

## Next Steps & Resources

- Practice writing mocks for your own interfaces and set diverse expectations.
- Learn about actions and matchers in depth from [Actions and Matchers in Practice](../actions-and-matchers.md).
- Understand different strictness levels using [Nice, Naggy, and Strict Mocks](../nice-naggy-strict-mocks.md).
- Explore advanced mocking patterns in [Mocking Best Practices & Patterns](../mocking-best-practices.md).
- Review the full [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html) for concise reference.
- Consult the [Mocking Reference](../reference/mocking.md) for the complete API.

---

## Related Documentation

- [gMock for Dummies](../gmock_for_dummies.md) — Beginner-friendly intro with examples.
- [gMock Cookbook](../gmock_cook_book.md) — Recipes for common mocking scenarios.
- [Legacy gMock FAQ](../gmock_faq.md) — Troubleshooting and common questions.
- [GoogleTest Primer](../../primer.md) — Foundation for writing tests with googletest.

## External Resources

- GoogleTest GitHub repository: https://github.com/google/googletest
- gMock Online Documentation: https://google.github.io/googletest/gmock_for_dummies.html

---

<Accordion title="Example: Defining and Using a Mock Class">
```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};

using ::testing::AtLeast;

TEST(PainterTest, DrawsCircle) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenDown()).Times(AtLeast(1));
  EXPECT_CALL(turtle, Forward(100));

  // Code under test that uses turtle.
  // ...
}
```
</Accordion>

<Note>
This example shows the complete flow from mock class definition to expectations and test usage.
</Note>
