---
title: "Integrating with Build Systems"
description: "Step-by-step guides for configuring GoogleTest and GoogleMock with CMake and Bazel, including tips for organizing large projects, customizing build outputs, and verifying cross-platform compatibility."
---

# Integrating with Build Systems

This guide provides clear, step-by-step instructions to integrate GoogleTest and GoogleMock into your C++ projects using the popular build systems CMake and Bazel. Whether you are starting a small test project or managing large, complex codebases, this document shows you how to configure your builds, organize tests, customize outputs, and ensure cross-platform compatibility.

---

## 1. Overview of Build System Integration

### What You Will Achieve
- Seamlessly include GoogleTest and GoogleMock libraries in your builds
- Compile and link test binaries with minimal configuration
- Organize tests within large projects efficiently
- Customize build behaviors for platform-specific requirements
- Validate and run tests with automated discovery

### Prerequisites
- A supported operating system (Linux, macOS, Windows)
- A C++ compiler with C++17 support
- CMake (3.14 or newer) or Bazel (7.0 or newer) installed
- Familiarity with basic project build concepts

### Expected Outcomes
By completing the workflows in this guide, you will have functional, maintainable test builds integrated into your development environment.

---

## 2. Integrating GoogleTest and GoogleMock with CMake

GoogleTest and GoogleMock come with rich CMake support enabling easy project setup, dependency fetching, and test discovery.

### Step 1: Set Up Your CMake Project

1. Create your project directory:
   ```bash
   mkdir my_project && cd my_project
   ```

2. Create a `CMakeLists.txt` file that includes GoogleTest and GoogleMock using the `FetchContent` module:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

# Require C++17
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# On Windows, ensure runtime compatibility
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

<Tip>
Update the URL's commit hash periodically to use the latest stable GoogleTest release.
</Tip>

### Step 2: Add Your Test Source Code

Create a test file `hello_test.cc` in the project root:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 3: Configure Test Executable and Link Libraries

Extend your `CMakeLists.txt` to include the executable and link it with GoogleTest's main library:

```cmake
enable_testing()

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```

This setup automatically discovers tests within your binary and enables running them via CTest.

### Step 4: Build and Run Tests

Use the following commands:

```bash
cmake -S . -B build
cmake --build build
cd build
ctest
```

You should see output indicating your tests passed successfully.

<Check>
If tests are not discovered:
- Verify you linked to `GTest::gtest_main`
- Confirm use of `gtest_discover_tests()`
- Check your CMake version meets minimum requirements
</Check>

---

## 3. Integrating GoogleTest and GoogleMock with Bazel

Bazel is a fast, extensible build system favored for large GoogleTest projects.

### Step 1: Create Bazel Workspace

In a new directory:

```bash
mkdir my_workspace && cd my_workspace
```

Create a `MODULE.bazel` file declaring the GoogleTest dependency:

```python
# MODULE.bazel
bazel_dep(name = "googletest", version = "1.17.0")
```

### Step 2: Add Test Source Code

Create `hello_test.cc` with your tests:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

### Step 3: Define Test Target in BUILD File

Create `BUILD` file in the same directory:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```

### Step 4: Build and Run the Test

Run Bazel test command:

```bash
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

You will see detailed output with passed test confirmation.

<Warning>
Remember to specify C++17 standard options compatible with your compiler.
</Warning>

---

## 4. Organizing Tests in Large Projects

Managing many tests requires best practices to keep builds efficient and maintainable.

- **Modularize Tests:** Group related tests into libraries or directories.
- **Use Targets Strategically:** Create CMake or Bazel targets for components or feature sets.
- **Control Build Dependencies:** Link only the required GoogleTest components (`gtest`, `gtest_main`, `gmock`, `gmock_main`).
- **Lazy Test Discovery:** Use test discovery tools (`gtest_discover_tests()` in CMake) to avoid manual test registrations.

<Tip>
For Bazel users, consider using test suites to run subsets selectively.
</Tip>

---

## 5. Customizing Build Outputs and Cross-Platform Considerations

### Linking Options

- Link to `gtest_main` or `gmock_main` for convenience; for custom main functions, link to `gtest` or `gmock` only.
- On Windows, use `gtest_force_shared_crt` CMake option to avoid runtime library linkage conflicts.

### Multi-threaded Tests

GoogleTest detects pthread availability automatically; if you encounter linking errors, set the `GTEST_HAS_PTHREAD` macro explicitly in compiler flags.

### Shared vs Static Libraries

Decide if you want GoogleTest/GoogleMock as shared or static libs by setting `BUILD_SHARED_LIBS` in CMake.

---

## 6. Verifying Integration and Running Tests

After building your tests:

1. Run your test executable directly or through the build system test runner.
2. Observe console output for passed/failed results.
3. Use filtering flags (e.g., `--gtest_filter`) to run subsets.

Example:

```bash
./hello_test --gtest_filter=HelloTest.BasicAssertions
```

Use test logs and exit codes to integrate with CI/CD pipelines.

---

## 7. Troubleshooting Common Issues

<AccordionGroup title="Integration and Build Troubleshooting">
<Accordion title="Tests Not Being Discovered or Run">
- Ensure `gtest_discover_tests()` is included (CMake).
- Verify proper linkage to `gtest_main` or `gmock_main`.
- Check for build warnings or errors.
</Accordion>
<Accordion title="Linker Errors Related to pthread">
- Confirm `GTEST_HAS_PTHREAD` macro is set correctly.
- Check compiler and linker flags for pthread linkage.
- Use CMake's included threading packages to resolve.
</Accordion>
<Accordion title="Runtime Errors or Unexpected Failures">
- Verify test main() initialization is correct.
- Use GoogleTest and GoogleMock latest stable releases.
- Run tests with verbose output enabled.
</Accordion>
</AccordionGroup>

<Tip>
Refer to the [Troubleshooting Installation & Setup](getting-started/first-steps-validation/troubleshooting-setup) guide for detailed solutions.
</Tip>

---

## 8. Summary and Next Steps

### What to Do Next
- Explore writing your own test cases with the [Primer](primer.md).
- Learn how to use assertions effectively in the [Using Assertions Effectively](guides/core-workflows/using-assertions-effectively) guide.
- Dive into mocking techniques with the [Introduction to Mocking](guides/mocking-techniques/introduction-to-mocking) page.

### Related Content
- [Setup and Installation](guides/getting-started/setup-and-installation)
- [Running Tests and Understanding Results](guides/getting-started/running-tests-and-understanding-results)
- [GoogleTest System Architecture and Integration](overview/system-architecture-and-integration/integration-and-dependencies)

---

With these integration steps, you will establish a robust foundation to build, organize, and maintain your automated tests effectively using GoogleTest and GoogleMock within modern build systems across platforms.
