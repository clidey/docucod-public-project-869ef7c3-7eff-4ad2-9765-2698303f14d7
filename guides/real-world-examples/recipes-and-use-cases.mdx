---
title: "Common Use Cases and Recipes"
description: "A curated collection of patterns and examples addressing everyday testing scenarios, including mocking dependencies, handling legacy code, and verifying side effects—a practical toolkit for serious developers."
---

# Common Use Cases and Recipes

A curated collection of patterns and examples addressing everyday testing scenarios, including mocking dependencies, handling legacy code, and verifying side effects—a practical toolkit for serious developers.

---

## Overview

This page presents practical recipes to solve common testing challenges with GoogleMock (gMock). Whether you're mocking complex interfaces, dealing with legacy code, or verifying side effects, these use cases offer proven patterns to help you write effective and maintainable tests.

Each recipe focuses on addressing a real-world problem, illustrating the right approach to use the gMock features effectively.

---

## Table of Contents

- [Creating Mock Classes](#creating-mock-classes)
- [Dealing with Unprotected Commas in Mock Methods](#dealing-with-unprotected-commas)
- [Mocking Private or Protected Methods](#mocking-private-or-protected-methods)
- [Mocking Overloaded Methods](#mocking-overloaded-methods)
- [Mocking Class Templates](#mocking-class-templates)
- [Mocking Non-virtual Methods](#mocking-non-virtual-methods)
- [Mocking Free Functions via Interfaces](#mocking-free-functions)
- [Using Nice, Strict, and Naggy Mocks](#the-nice-strict-and-naggy)
- [Simplifying Interfaces Without Breaking Code](#simplifying-interfaces)
- [Delegating Calls to a Fake or Real Object](#delegating-calls-to-fakes-and-real-objects)
- [Using Expectations and Matchers](#using-matchers)
- [Setting Default and Custom Actions](#setting-default-and-custom-actions)
- [Ordering Calls and Sequences](#expecting-ordered-calls)
- [Using Checkpoints for Complex Call Flows](#using-checkpoints)
- [Mocking Move-Only Types](#mocking-move-only-types)
- [Advanced Matchers and Actions](#advanced-matchers-and-actions)

---

## Creating Mock Classes

Use the `MOCK_METHOD` macro within a class to generate mocked methods.

**How to define:**

```cpp
class MockMyClass {
 public:
  MOCK_METHOD(ReturnType, MethodName, (Args...));
  MOCK_METHOD(ReturnType, MethodName, (Args...), (Specs...));  // e.g., const, override
};
```

**Tips:**

- Always put `MOCK_METHOD` declarations in the `public:` section, even if mocking protected or private methods.
- Use `override` in specs when mocking virtual methods.

---

## Dealing with Unprotected Commas

When method signatures include comma-separated template types (e.g., `std::pair<bool, int>`), wrapping the type in parentheses or using a type alias prevents parsing errors.

**Example:**

```cpp
class MockFoo {
 public:
  // Wrap types with commas in parentheses
  MOCK_METHOD((std::pair<bool, int>), GetPair, ());

  // Or define type aliases
  using BoolAndInt = std::pair<bool, int>;
  MOCK_METHOD(BoolAndInt, GetPair, ());
};
```

---

## Mocking Private or Protected Methods

To mock methods that are private or protected in the base class, declare the mocked methods in `public:` of the derived mock class.

**Example:**

```cpp
class Base {
 protected:
  virtual void ProtectedMethod();
 private:
  virtual int PrivateMethod();
};

class MockBase : public Base {
 public:
  MOCK_METHOD(void, ProtectedMethod, (), (override));
  MOCK_METHOD(int, PrivateMethod, (), (override));
};
```

---

## Mocking Overloaded Methods

Mock each overloaded version explicitly with `MOCK_METHOD`. Use `using` declarations to bring base class overloads into scope and avoid hiding other overloads.

**Example:**

```cpp
class Base {
  virtual int Add(int x);
  virtual int Add(double x);
};

class MockBase : public Base {
  using Base::Add;  // Bring all overloads into scope
  MOCK_METHOD(int, Add, (int x), (override));
  // Optional to mock other overloads
};
```

---

## Mocking Class Templates

Mock template classes by templating your mock class similarly.

**Example:**

```cpp
template<typename T>
class Interface {
 public:
  virtual ~Interface();
  virtual void Push(const T& item) = 0;
};

template<typename T>
class MockInterface : public Interface<T> {
 public:
  MOCK_METHOD(void, Push, (const T& item), (override));
};
```

---

## Mocking Non-virtual Methods

Mock non-virtual functions by defining a mock class unrelated to the original class but declaring methods with the same signature (without `override`). Use templates to choose between real and mock implementations at compile time.

**Example:**

```cpp
class RealClass {
 public:
  void NonVirtualMethod();
};

class MockClass {
 public:
  MOCK_METHOD(void, NonVirtualMethod, ());
};

template <typename Stream>
void Process(Stream* s) {
  s->NonVirtualMethod();
}
```

---

## Mocking Free Functions

Direct mocking of free functions is not supported. Instead, abstract free functions behind an interface, implement the interface with a concrete class, and mock the interface.

**Example:**

```cpp
class FileInterface {
 public:
  virtual bool Open(const char* path) = 0;
};

class File : public FileInterface {
 public:
  bool Open(const char* path) override {
    return ::OpenFile(path);  // Calls real free function
  }
};

class MockFile : public FileInterface {
 public:
  MOCK_METHOD(bool, Open, (const char* path), (override));
};
```

---

## Using Nice, Strict, and Naggy Mocks

Control treatment of uninteresting calls using mock modifiers:

- **NaggyMock** (default): Warn on uninteresting calls.
- **NiceMock**: Suppress warnings on uninteresting calls.
- **StrictMock**: Fail tests on uninteresting calls.

**Example:**

```cpp
NiceMock<MockFoo> nice_mock;  // Ignores uninteresting call warnings
StrictMock<MockFoo> strict_mock;  // Fails on uninteresting calls
```

**Use cases:**

- Use `NiceMock` for common, less strict tests.
- Use `NaggyMock` (default) for debugging.
- Use `StrictMock` when enforcing strict call validation.

---

## Simplifying Interfaces Without Breaking Existing Code

When mocking methods with complex arguments, consider redispatching the original method in the mock or defining user-friendly mock methods with simplified signatures.

**Example:**

```cpp
class LogSink {
 public:
  virtual void send(int severity, const char* file, const char* message, size_t len) = 0;
};

class MockLogSink : public LogSink {
 public:
  void send(int severity, const char* file, const char* message, size_t len) override {
    Log(severity, file, std::string(message, len));
  }

  MOCK_METHOD(void, Log, (int severity, const std::string& file, const std::string& message));
};
```

Use this approach to improve readability and ease testing.

---

## Delegating Calls to a Fake or Real Object

Delegate mock calls to a fake or real object to reuse existing behavior and still verify calls.

**Delegating to a fake:**

```cpp
class FakeFoo : public Foo { ... };

class MockFoo : public Foo {
 public:
  MOCK_METHOD(...);
  void DelegateToFake() {
    ON_CALL(*this, Method).WillByDefault([this](...) { return fake_.Method(...); });
  }

 private:
  FakeFoo fake_;
};
```

**Delegating to a real object:**

Use a real instance and delegate calls similarly in constructor.

**Delegating to parent class:**

Call parent method explicitly using scoped call:

```cpp
ON_CALL(mock, Concrete)
    .WillByDefault([&mock](const char* s) { return mock.Foo::Concrete(s); });
```

---

## Using Expectations and Matchers

Specify which calls to expect with `EXPECT_CALL` and use matchers to describe the expected argument values:

- Use exact values or built-in matchers like `_` (wildcard), `Ge()`, `NotNull()`, `HasSubstr()`, etc.
- Combine matchers with `AllOf()`, `AnyOf()`, and `Not()`.
- Use `Truly()` for custom predicate matchers.
- For overloaded functions, disambiguate using wrappers like `Const()` or explicit matcher types.

**Example:**

```cpp
EXPECT_CALL(mock, Foo(Ge(5), _)).WillOnce(Return(true));
EXPECT_CALL(mock, Bar(Truly([](int x) { return x % 2 == 0; })));
```

---

## Setting Default and Custom Actions

Control mock method behavior with:

- `ON_CALL()` to set default actions without expectation.
- `EXPECT_CALL()` combined with `WillOnce()` and `WillRepeatedly()` for specific call behaviors.
- Use built-in actions like `Return()`, `ReturnRef()`, `SetArgPointee()`, `DoAll()`, `Invoke()`, and more.

**Example:**

```cpp
ON_CALL(mock, Foo()).WillByDefault(Return(42));
EXPECT_CALL(mock, Bar(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

---

## Ordering Calls and Sequences

Enforce call order with:

- `InSequence` object to ensure expectations occur in sequence.
- Use `Sequence` objects for partial or multiple sequence constraints.
- `After()` clause for complex dependency ordering.

**Example:**

```cpp
{
  InSequence s;
  EXPECT_CALL(mock, Init());
  EXPECT_CALL(mock, Process());
}
```

---

## Using Checkpoints

Insert explicit checkpoints to split tests into manageable phases and check calls occur at expected points.

**Example:**

```cpp
MockFunction<void(std::string)> checkpoint;
{
  InSequence s;
  EXPECT_CALL(mock, Foo(1));
  EXPECT_CALL(checkpoint, Call("phase1"));
  EXPECT_CALL(mock, Foo(2));
}
Foo(1);
checkpoint.Call("phase1");
Foo(2);
```

---

## Mocking Move-Only Types

Mocking functions accepting or returning move-only types (like `std::unique_ptr`) is supported with standard `MOCK_METHOD` syntax.

**Tips:**

- Use lambdas or callable objects in `WillOnce`/`WillRepeatedly` to generate fresh move-only return values.
- Avoid `Return(std::move(...))` in `WillRepeatedly` as the moved object is consumed.

**Example:**

```cpp
class MockBuzzer : public Buzzer {
 public:
  MOCK_METHOD(std::unique_ptr<Buzz>, MakeBuzz, (StringPiece text), (override));
};

EXPECT_CALL(mock_buzzer, MakeBuzz("hello"))
    .WillRepeatedly([](StringPiece){ return std::make_unique<Buzz>(); });
```

---

## Advanced Matchers and Actions

- Define custom matchers using `MATCHER` macros or full matcher class implementations for reuse and enhanced error messages.
- Customize actions by implementing call operators or using `ACTION` macros.
- Use matchers in assertions (`EXPECT_THAT`) for expressive validation.
- Use `Invoke()` and `InvokeWithoutArgs()` to delegate to existing functions or lambdas.

**Example custom matcher:**

```cpp
MATCHER(IsEven, "is even") { return (arg % 2) == 0; }
EXPECT_CALL(mock, Foo(IsEven()));
```

**Example custom action:**

```cpp
ACTION(IncrementArg) { (*arg0)++; return *arg0; }
EXPECT_CALL(mock, Foo(_)).WillOnce(IncrementArg());
```

---

## Additional Resources

For authoritative guidance on specific gMock features, consult:

- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)

Refer to related guides to deepen your understanding:

- [Creating and Using Mocks with GoogleMock](../core-testing-workflows/using-mocks.md)
- [Setting Expectations and Call Sequences](../reference/mocking-api/expectations-and-sequencing.md)

---

This collection enables you to apply best practices, avoid common pitfalls, and gain mastery in mocking with gMock to craft reliable, maintainable tests.