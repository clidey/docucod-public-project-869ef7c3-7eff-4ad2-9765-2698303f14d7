---
title: "Performance and Scaling Your Tests"
description: "Techniques and tips for optimizing test performance, minimizing overhead from mocks, running tests in parallel, and managing large test suites effectively."
---

# Performance and Scaling Your Tests

## Overview

This guide provides practical techniques and tips to optimize the performance of your GoogleTest test suites. By minimizing overhead from mock objects, running tests in parallel effectively, and managing large test suites, you will achieve faster execution and more scalable test workflows.

---

## Why Optimize Test Performance?

As your codebase and test coverage grow, tests may slow down and impact productivity. Efficient test execution is critical for rapid feedback in continuous integration (CI) and development cycles. Applying the strategies here ensures your tests run reliably and scale with your project.

---

## Key Strategies for Performance and Scaling

### 1. Minimize Mock Overhead

Mocks are powerful but add runtime cost when overused or misconfigured. Reduce mock-induced slowdowns by:

- Using `NiceMock` to suppress unnecessary warnings without losing verification benefits.
- Avoiding excessive `EXPECT_CALL` statements that add strictness beyond necessity; prefer `ON_CALL` for default stub behavior when you don't care about invocation counts.
- Efficiently delegating default actions to fakes or real implementations when mocks need real behavior, reducing complexity.
- Defining mock methods only for strictly necessary interfaces to avoid bloated mock classes.

### 2. Use Test Fixture and Suite Set-Up Wisely

- Share expensive resources by leveraging `SetUpTestSuite()` and `TearDownTestSuite()` for shared initializations rather than repeating setup per test.
- Keep per-test setup minimal; reuse initialized memory or objects where safe and applicable.

### 3. Parallelize Test Execution

Running tests concurrently improves turnaround:

- Use external test runners or CI tools to run multiple test binaries or shards in parallel.
- GoogleTest supports sharding via the environment variables `GTEST_TOTAL_SHARDS` and `GTEST_SHARD_INDEX`. Divide your test workloads across machines or cores.
- Employ the `--gtest_repeat` flag combined with sharding to run tests multiple times efficiently.
- Avoid global shared state or data races to ensure safe parallel test execution.

### 4. Filter and Select Tests Smartly

- Use `--gtest_filter` to run targeted subsets during frequent development cycles.
- Combine filtering with sharding to isolate flaky tests or high-impact areas.

### 5. Control Logging and Output Overhead

- Limit verbose output to avoid slowing down test runs. Use `--gtest_color`, `--gtest_brief`, or suppress logging where appropriate.
- Redirect logs and output streams separately (`stdout` vs. `stderr`) to keep test reports clean and faster to parse.

### 6. Optimize Test Suite Structure

- Organize tests into logical test suites to reduce setup and teardown costs.
- Avoid inter-test dependencies which can cause fragile and slow tests.
- Prefer smaller suites when parallelizing, so sharding is fine-grained.

### 7. Efficient Use of Death Tests and Timeouts

- Use death tests judiciously, as they spawn additional processes and increase runtime.
- Consider the "threadsafe" death test style for safer concurrency but note it has a performance tradeoff.
- Limit length and complexity inside death tests.

---

## Practical Tips & Common Pitfalls

- **Avoid Unbounded Mock Expectations:** Unconstrained `EXPECT_CALL` without cardinality can lead to confusing expectations and slow execution.
- **Retire Expectations Promptly:** Use `.RetiresOnSaturation()` on expectations to avoid sticky match failures and reduce matcher overhead.
- **Beware of Global State:** Shared global resources can cause serialization or race conditions, limiting parallel execution.
- **Use `GTEST_SKIP()` to Avoid Inefficient Tests:** Skip long-running or resource-heavy tests in certain environments.
- **Watch for Large Fixture SetUp/TearDown:** Move expensive initialization to suite-level to avoid repeated overhead.

---

## Sample Workflow: Parallel Test Sharding

1. Determine total number of shards (machines or cores): e.g., 4.
2. For each shard, set:
   - Environment variable `GTEST_TOTAL_SHARDS=4`
   - Environment variable `GTEST_SHARD_INDEX` to 0, 1, 2, or 3 respectively
3. Run the same test executable on all shards.
4. Each shard runs a distinct subset of tests, collectively covering the full suite.
5. Collect test results and aggregate.

Use case:

```bash
export GTEST_TOTAL_SHARDS=4
export GTEST_SHARD_INDEX=0
./my_test_binary
# In parallel on other machines or processes with SHARD_INDEX=1,2,3
```

This reduces individual test run times significantly and takes full advantage of available resources.

---

## Troubleshooting Performance Issues

<AccordionGroup title="Common Performance Issues & Solutions">
<Accordion title="Tests Run Too Slowly When Using Many Mocks">
Review your mock usage. Ensure that unnecessary detailed `EXPECT_CALL` specifications are replaced with lighter `ON_CALL`s.
Use `NiceMock` if you only need to suppress warnings without strict checking.
</Accordion>
<Accordion title="Parallel Test Execution Results in Races or Failures">
Check for shared global variables or resources that may conflict. Refactor tests to avoid state sharing or protect shared resources.
Use per-test fresh fixtures and avoid static mutable state.
</Accordion>
<Accordion title="Death Tests Significantly Increase Test Time">
Limit the number of death tests. Prefer fast tests for continuous development.
Use `--gtest_repeat` and filtering to isolate death tests for dedicated runs.
Consider the death test style flag for safer multi-threaded tests.
</Accordion>
<Accordion title="Build and Link Times Increase Substantially with Tests">
Move mock class constructor and destructor definitions to `.cc` files to speed up compilation.
Minimize template expansions in mocks.
</Accordion>
</AccordionGroup>

---

## Additional Resources

- [GoogleTest FAQ: Performance-related questions](docs/faq.md)
- [GoogleMock Cookbook: Advanced Mocking Techniques](docs/gmock_cook_book.md)
- [GoogleTest Advanced Topics](docs/advanced.md)
- [Guide: Test Automation and CI Tips](guides/integration-advanced/test-automation)
- [Guide: Integrating with Build Systems](guides/integration-advanced/build-system-integration)

---

## Next Steps

Once your test suite runs efficiently:

- Explore [Test Automation and CI Tips](guides/integration-advanced/test-automation) to integrate with your continuous workflow.
- Learn how to write fast, maintainable mocks using [Mocking Complex Scenarios](guides/core-workflows/mocking-scenarios).
- Adopt parallel test execution practice with sharding and distributed test runners.
- Continuously profile your test runs and tune resource sharing and mocking.

---

Thank you for choosing GoogleTest. Optimized and scalable tests empower you to deliver quality software faster and with confidence.
