---
title: "Integrating GoogleTest/GoogleMock with Your Build System"
description: "Step-by-step integration guides for CMake and Bazel, including tips for managing dependencies, organizing tests, and troubleshooting common setup issues. Ensures frictionless adoption from pilot projects to enterprise-scale CI."
---

# Integrating GoogleTest/GoogleMock with Your Build System

## Workflow Overview

This guide takes you through the essential steps to integrate GoogleTest and GoogleMock into your C++ projects using the two widely-used build systems: **CMake** and **Bazel**. You'll learn how to properly configure dependencies, organize your test code, and troubleshoot common issues to ensure smooth adoption — from small pilot projects to enterprise continuous integration setups.

### Prerequisites
- Installed and configured build system: **CMake** (version 3.13 or later) or **Bazel**.
- A C++17 compatible compiler environment.
- Basic familiarity with your chosen build system's syntax and workflows.
- Access to GoogleTest/GoogleMock source or precompiled packages.

### Expected Outcome
By following this guide, you will have GoogleTest and GoogleMock correctly integrated into your build environment, enabling you to compile, link, and run tests that use these powerful testing frameworks with confidence.

### Time Estimate
Depending on your familiarity with build systems, expect to spend **30 minutes to 1 hour** completing the integration and validation steps.

### Difficulty Level
Intermediate — assumes prior exposure to C++ build systems and project configuration.

---

## Step-by-Step Integration Instructions

### Integration with CMake

1. **Add GoogleTest and GoogleMock to Your Project**
   - You can use `FetchContent` in CMake to download and build GoogleTest as part of your build process, or you can use installed versions.

   ```cmake
   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.tar.gz
   )
   FetchContent_MakeAvailable(googletest)
   ```

2. **Link Your Test Targets with gmock/gmock_main**
   - For tests using mocks, link your test executable to `gmock_main` to include the `main()` function.

   ```cmake
   add_executable(MyTest test_my_class.cpp)
   target_link_libraries(MyTest PRIVATE gmock_main)
   ```

3. **Include GoogleTest/GoogleMock Headers**
   - Include directories are automatically available if you use the modern CMake targets as above.

4. **Configure Threading Support**
   - Confirm your platform supports pthread or appropriate thread libraries, as GoogleMock depends on threading.

5. **Build and Run Tests**
   - Use `cmake --build .` and then run the tests executable.

6. **Managing Dependencies**
   - Use the provided pkg-config files (`gmock.pc`, `gmock_main.pc`) if your environment supports pkg-config to simplify linking.

7. **Example CMakeLists.txt snippet:**

   ```cmake
   cmake_minimum_required(VERSION 3.13)
   project(MyProject)

   enable_testing()

   include(FetchContent)
   FetchContent_Declare(
     googletest
     URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.tar.gz
   )
   FetchContent_MakeAvailable(googletest)

   add_executable(MyTest test_my_class.cpp)
   target_link_libraries(MyTest PRIVATE gmock_main)

   add_test(NAME MyTest COMMAND MyTest)
   ```

### Integration with Bazel

1. **Set Up Bazel Workspace**
   - Declare dependencies on GoogleTest and GoogleMock in your `WORKSPACE` file using the Bazel Central Registry or as external git repositories.

   ```python
   http_archive(
       name = "com_google_googletest",
       urls = ["https://github.com/google/googletest/archive/release-1.17.0.tar.gz"],
       strip_prefix = "googletest-release-1.17.0",
   )
   load("@com_google_googletest//:bazel/repositories.bzl", "googletest_repositories")
   googletest_repositories()
   ```

2. **Add BUILD Targets**
   - Create `BUILD` files for your tests, linking them to `@com_google_googletest//:gmock_main` or `@com_google_googletest//:gmock`.

   ```python
   cc_test(
       name = "my_test",
       srcs = ["test_my_class.cc"],
       deps = ["@com_google_googletest//:gmock_main"],
   )
   ```

3. **Build and Run Your Tests**
   - Run `bazel test //:my_test` to build and execute your tests.

4. **Handling Complex Dependency Graphs**
   - Use Bazel macros and `bind` rules to manage dependencies consistently and avoid duplication.

5. **Workspace Configuration Tips**
   - Pin dependency versions explicitly.
   - Use `local_repository` or `git_repository` if needed for local/custom forks.

### Organizing Test Code

- Place your tests in dedicated source trees to separate production and test code.
- Keep mock classes and fixtures close to the tests that use them.
- Use consistent naming conventions (e.g., `*_test.cc`) to leverage automatic test discovery.

---

## Examples

### CMake Minimal Example

```cmake
cmake_minimum_required(VERSION 3.13)
project(SimpleTest)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/refs/tags/release-1.17.0.tar.gz
)
FetchContent_MakeAvailable(googletest)

add_executable(simple_test simple_test.cpp)
target_link_libraries(simple_test PRIVATE gmock_main)
add_test(NAME simple_test COMMAND simple_test)
```

### Bazel Simple BUILD Example

```python
cc_test(
    name = "simple_test",
    srcs = ["simple_test.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

---

## Troubleshooting & Best Practices

### Common Issues and Solutions

| Issue                                         | Resolution                                                  |
|-----------------------------------------------|-------------------------------------------------------------|
| Linker errors (undefined references to gmock) | Ensure linking against `gmock` or `gmock_main` libraries.    |
| Missing headers                               | Confirm include paths include GoogleTest and GoogleMock.     |
| Multiple definitions of `main()`             | Link against `gmock_main` OR `gtest_main`, not both.         |
| Thread safety errors                          | Verify platform threading support; add `-DGTEST_HAS_PTHREAD=1` if needed. |
| Conflicting runtimes on Windows              | Use `gtest_force_shared_crt` option in CMake to match runtimes. |

### Best Practices

- Prefer linking with `gmock_main` for test executables to use the default `main()`.
- Use CMake's modern targets (`gtest::gtest`, `gmock::gmock`) where available for better dependency management.
- Pin dependency versions explicitly to avoid surprises in CI.
- Organize build scripts with target aliases for clarity.
- For large projects, isolate GoogleTest/GoogleMock builds to speed up compilation.

### Performance Considerations

- If compilation slows down drastically, consider moving mock class constructor and destructor implementations to `.cc` files.
- Cache downloaded dependencies in Bazel and CMake to reduce build overhead.

### Alternative Approaches

- Using `pkg-config` with `gmock.pc` and `gmock_main.pc` can simplify integration for CMake and other build systems.
- For projects not using CMake or Bazel, manual integration is possible but requires carefully managing include paths and libraries.

---

## Next Steps & Related Content

- After integration, continue with [Writing and Running Your First Test](../gs-configuration-first-test/gs-first-test.md) to get hands-on.
- Explore [Creating and Using Basic Mocks](../../guides/mocking-scenarios/creating-basic-mocks.md) to leverage mocking capabilities.
- Review [Mock Strictness: Nice, Naggy, and Strict](../../guides/mocking-scenarios/mock-strictness-best-practices.md) to manage uninteresting call behaviors.
- Consult [Troubleshooting Common Setup Issues](../gs-validation-troubleshooting/gs-troubleshooting-common-issues.md) for deeper troubleshooting.
- To optimize your builds, see [Test Performance and Scalability Best Practices](../../guides/integration-advanced/test-performance-bestpractices.md).

---

## References

- Official GoogleTest repo and docs: https://github.com/google/googletest
- GoogleMock Cookbook for advanced mocking: https://google.github.io/googletest/gmock_cook_book.html
- CMake official docs on FetchContent: https://cmake.org/cmake/help/latest/module/FetchContent.html
- Bazel Build Encyclopedia: https://docs.bazel.build/versions/main/be/cc-tests.html


<Info>
For the latest integration patterns and CMake files, review the [googlemock/CMakeLists.txt](https://github.com/google/googletest/blob/main/googlemock/CMakeLists.txt).
</Info>

<Check>
Confirm you are linking against `gmock_main` in your tests to leverage the GoogleMock main function.
</Check>

<Warning>
Do not mix static and shared runtimes on Windows; enable `gtest_force_shared_crt` in CMake to avoid conflicts.
</Warning>