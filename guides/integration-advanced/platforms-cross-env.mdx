---
title: "Best Practices for Cross-Platform and CI Testing"
description: "Provides practical guidance for running tests across Windows, Linux, and macOS; integrating with CI pipelines; managing platform differences; and ensuring reproducible and portable test results."
---

# Best Practices for Cross-Platform and CI Testing

## Overview
This page provides practical guidance for effectively running GoogleTest across different platforms (Windows, Linux, macOS), integrating GoogleTest in Continuous Integration (CI) pipelines, handling platform-specific nuances, and ensuring reproducible, portable test results. Whether you are working locally or in a large-scale CI environment, these recommendations will help you write robust tests that work seamlessly across environments.

---

## 1. Running Tests Across Platforms

### 1.1 Platform Differences to Consider
Each operating system and environment has unique behaviors that can affect tests. Pay attention to the following:

- **File paths and separators:** Use platform agnostic paths or abstractions instead of hardcoding `/` or `\\`. GoogleTest internally handles most path syntax, but your tests may need to consider this.
- **Line endings:** Text comparisons can fail if tests expect Linux-style (`\n`) line endings but run on Windows (which uses `\r\n`). Use normalized comparisons when dealing with text files.
- **Shell and environment differences:** Commands run during tests (via system calls or scripts) may behave differently or not be available on all platforms.
- **Temporary directories:** Use `testing::TempDir()` rather than hardcoded temporary paths.

### 1.2 Writing Portable Tests
- Avoid assumptions about thread scheduling, timeouts, and exact timing. Allow some margin in timing-related tests.
- Use GoogleTest’s [file system APIs and matchers](https://github.com/google/googletest/tree/main/googletest/include/gtest) to perform file operations safely.
- Do not rely on platform-specific environment variables or system state.

### 1.3 Platform-Specific Notes
Refer to the [Platform-specific Notes](../../getting-started/installation/platform-specific-notes) documentation for special handling on Windows (e.g., runtime flags), Linux (e.g., cross-compilation concerns), and macOS.

---

## 2. Integrating with Continuous Integration (CI) Pipelines

### 2.1 Best Practices for CI Integration
- Use GoogleTest’s XML output format (`--gtest_output=xml`) for integration with CI test reporting dashboards.
- Enable test sharding or parallel test runs to reduce feedback times on large test suites.
- Ensure the test binary is built with the same compiler and flags as your production code to avoid ABI mismatches.

### 2.2 Environment Configuration
- Explicitly configure test environments to have consistent locale, timezone, and environment variables.
- Avoid reliance on network connectivity or external services unless the CI environment guarantees stability.
- Set the working directory explicitly or change to a known directory at test startup.

### 2.3 Running Tests in Parallel
- Exploit built-in support or external tools (e.g., `gtest-parallel`) to run tests concurrently.
- Ensure tests are independent and use isolated temporary directories or sandboxing to avoid flaky failures.

### 2.4 Handling Test Failures in CI
- Use GoogleTest’s failure screenshot or logging hooks (if available) to capture diagnostic data.
- Aggregate logs and artifacts for easier triage.

Reference integration workflows at [Integration with Build and CI Systems](/overview/integration-adoption/integration-workflow).

---

## 3. Managing Platform Differences

### 3.1 Dealing with Platform-Specific Test Flags
Certain GoogleTest flags or build settings affect behavior:

- **`GTEST_HAS_PTHREAD` flag:** On some platforms, you may need to manually control this flag to enable multi-threaded tests.
- **DAL runtime linkage (Visual Studio):** On Windows, pay attention to runtime linking options (`/MD`, `/MT`) as mismatches cause link errors.
- **Death tests style:** Prefer `--gtest_death_test_style=threadsafe` on newer platforms for reliable death test execution.

### 3.2 Using Conditional Compilation
Use macros such as `#ifdef _WIN32`, `#ifdef __linux__`, or GoogleTest’s own macros (`GTEST_OS_WINDOWS`, `GTEST_OS_LINUX`) to conditionally compile platform-specific test code.

### 3.3 Resolving Line Ending Issues
Normalize line endings when reading or comparing files, especially in cross-platform environments.

### 3.4 Handling File Permissions
Be cautious about file permission expectations, as Windows and Unix-like OS permissions differ substantially.

---

## 4. Ensuring Reproducible and Portable Test Results

### 4.1 Avoid Non-Deterministic Test Data
Tests should not rely on random data or any non-repeatable state unless you seed and control randomness explicitly.

### 4.2 Use Stable Test Fixtures
Keep test setup and teardown consistent and isolated to avoid flaky tests due to shared state.

### 4.3 Manage Timezone and Locale
When tests depend on locale-sensitive formatting, fix the locale or be tolerant to differences.

### 4.4 Capture and Control Environment Variables
Control and document environment variables essential for tests in CI and on different platforms.

### 4.5 Version Control for Test Dependencies
Ensure all test dependencies (including GoogleTest version) are pinned and consistent across environments.

---

## 5. Sample Cross-Platform Test Snippet
```cpp
#include <gtest/gtest.h>
#include <filesystem>

TEST(FileUtilsTest, CreateAndReadFile) {
  auto temp_path = testing::TempDir();
  std::filesystem::path file_path = std::filesystem::path(temp_path) / "tempfile.txt";

  std::ofstream out(file_path);
  out << "Hello, cross-platform test!";
  out.close();

  std::ifstream in(file_path);
  std::string content;
  std::getline(in, content);
  EXPECT_EQ(content, "Hello, cross-platform test!");
}
```

This example uses `testing::TempDir()` to ensure portability and the C++17 `<filesystem>` API for file path operations.

---

## 6. Troubleshooting Common Issues

<AccordionGroup title="Troubleshooting Cross-Platform Issues">
<Accordion title="Linker or Compilation Errors on Windows">
Verify runtime library options (`/MD` vs `/MT`) match for all dependencies. Consider `gtest_force_shared_crt` option if building with CMake.
</Accordion>
<Accordion title="Tests Failing on CI but Passing Locally">
Check environment differences in locales, environment variables, working directories, and dependencies. Enable verbose logging with `--gtest_verbose=info`.
</Accordion>
<Accordion title="Death Tests Fail or Hang">
Use `--gtest_death_test_style=threadsafe`. Avoid platform-specific code in death tests unless necessary.
</Accordion>
<Accordion title="Timing or Threading-Related Flakes">
Increase timing margins, avoid assumptions of execution order, and isolate tests involving threads.
</Accordion>
</AccordionGroup>

<Tip>
Enabling `--gtest_color=yes` and `--gtest_output=xml` in CI helps improve test readability and integration.
</Tip>

---

## 7. Next Steps & Related Documentation

- Read the [Integration with Build and CI Systems](/overview/integration-adoption/integration-workflow) for detailed CI integration
- Consult [Platform-specific Notes](/getting-started/installation/platform-specific-notes) for OS-dependent handling
- Explore [Improving Test Performance at Scale](/guides/integration-advanced/performance-tips) for optimization strategies
- Review [Writing Your First Test](/getting-started/first-steps/writing-your-first-test) to build foundational test skills

---

## References
- GoogleTest official repository: https://github.com/google/googletest
- GoogleTest Primer: /overview/intro-value-prop/welcome-product-overview
- GoogleMock Cookbook: /docs/gmock_cook_book.md

---