---
title: "Integrating with CMake and Bazel"
description: "A practical how-to for setting up GoogleTest and GoogleMock with CMake and Bazel. Walks through common integration workflows, best practices for project layout, and troubleshooting step-by-step, catering to both new and experienced C++ developers."
---

# Integrating with CMake and Bazel

This guide walks you through practical setup workflows for integrating **GoogleTest** and **GoogleMock** into your C++ projects using the two most popular build systems: **CMake** and **Bazel**. Whether you are new or experienced, this tutorial explains how to configure your project, add the necessary dependencies, build your tests, and troubleshoot common integration issues.

---

## 1. Workflow Overview

### Purpose
Enable you to seamlessly integrate GoogleTest and GoogleMock into your C++ projects by leveraging either CMake or Bazel. Learn best practices for project layout, dependency declaration, and test execution.

### Prerequisites
- A compatible operating system (Linux, macOS, Windows).
- A C++ compiler with C++17 support or newer.
- Installed and configured versions of either CMake (3.16+ recommended) or Bazel (7.0+ recommended).
- Basic understanding of C++ build workflows.

### Outcome
By the end of this guide, you will have functional build system configurations for both CMake and Bazel that compile, link, and run GoogleTest and GoogleMock tests properly.

### Time Commitment
Approximately 20-40 minutes depending on familiarity with build systems.

### Difficulty
Intermediateâ€”assumes some experience setting up C++ projects.

---

## 2. Integrating GoogleTest and GoogleMock with CMake

### Overview
CMake integration is community-supported and allows building GoogleTest and GoogleMock as either standalone projects or incorporated directly into your existing projects.

### Step-by-Step Instructions

<Steps>
<Step title="Create Project Directory and CMakeLists.txt">
1. Create a new project folder and navigate into it.

```sh
mkdir my_project && cd my_project
```

2. Create a `CMakeLists.txt` file to define project settings and fetch GoogleTest.

Example `CMakeLists.txt` snippet using `FetchContent`:

```cmake
cmake_minimum_required(VERSION 3.14)
project(my_project)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

include(FetchContent)
FetchContent_Declare(
  googletest
  URL https://github.com/google/googletest/archive/03597a01ee50ed33e9dfd640b249b4be3799d395.zip
)

# For Windows - ensure shared CRT linkage
set(gtest_force_shared_crt ON CACHE BOOL "" FORCE)
FetchContent_MakeAvailable(googletest)
```

> Replace the URL with the latest commit hash for the newest release.
</Step>

<Step title="Add Test Source and Link GoogleTest">
1. Create a test source file `hello_test.cc` containing a simple test:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

2. Extend your `CMakeLists.txt` to add the executable, link to GoogleTest, and enable test discovery:

```cmake
enable_testing()

add_executable(hello_test hello_test.cc)
target_link_libraries(hello_test GTest::gtest_main)

include(GoogleTest)
gtest_discover_tests(hello_test)
```
</Step>

<Step title="Build and Run Tests">
1. Generate build files and build:

```sh
cmake -S . -B build
cmake --build build
```

2. Run tests using CTest:

```sh
cd build
ctest
```

You should see output indicating your test passed successfully.
</Step>
</Steps>

### Best Practices and Tips
- Always specify `CMAKE_CXX_STANDARD 17` or higher.
- Use `gtest_force_shared_crt` on Windows to avoid runtime conflicts.
- `FetchContent` makes GoogleTest integration simpler and keeps dependencies isolated.
- To build only GoogleTest without GoogleMock, pass `-DBUILD_GMOCK=OFF` during CMake configuration.

### Troubleshooting
<Accordion title="Common CMake Build Issues">

- **Missing pthreads on Linux:** Ensure CMake properly finds Threads package. You can check `GTEST_HAS_PTHREAD` macro.
- **Compiler version errors:** Confirm your compiler supports C++17.
- **Linking errors on Windows:** Check `gtest_force_shared_crt` is set appropriately.
- **GoogleTest headers not found:** Verify `FetchContent` runs successfully and includes paths are correct.

</Accordion>

---

## 3. Integrating GoogleTest and GoogleMock with Bazel

### Overview
Bazel is GoogleTest's officially recommended build system by Google developers. It uses a declarative workspace with dependency management handled via the Bazel Central Registry.

### Step-by-Step Instructions

<Steps>
<Step title="Set up Bazel Workspace">
1. Create a workspace directory and navigate into it:

```sh
mkdir my_workspace && cd my_workspace
```

2. Create a file called `MODULE.bazel` to declare the GoogleTest dependency:

```python
# MODULE.bazel
bazel_dep(name = "googletest", version = "1.17.0")
```

Use the latest version available from the [Bazel Central Registry](https://registry.bazel.build/modules/googletest).
</Step>

<Step title="Create Test Source and BUILD File">
1. Add a test source file `hello_test.cc`:

```cpp
#include <gtest/gtest.h>

TEST(HelloTest, BasicAssertions) {
  EXPECT_STRNE("hello", "world");
  EXPECT_EQ(7 * 6, 42);
}
```

2. Create a `BUILD` file to define your test target:

```python
cc_test(
    name = "hello_test",
    size = "small",
    srcs = ["hello_test.cc"],
    deps = [
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
```
</Step>

<Step title="Build and Run Tests with Bazel">
Execute:

```sh
bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test
```

You should observe test execution output showing success.
</Step>
</Steps>

### Best Practices and Tips
- Ensure your Bazel version is 7.0 or newer.
- Use the Bazel Central Registry for stable dependency management.
- Pass appropriate C++17 compiler options (
  e.g., `--cxxopt=-std=c++17` for GCC/Clang or `/std:c++17` for MSVC).
- Leverage Bazel's `cc_test` rule to easily manage test binaries.

### Troubleshooting
<Accordion title="Common Bazel Issues">

- **Build errors due to missing dependencies:** Confirm `MODULE.bazel` is present and correctly declares GoogleTest.
- **Unsupported C++ standard:** Use the `--cxxopt` flag to enforce C++17.
- **Linker errors:** Verify `@googletest//:gtest` and `@googletest//:gtest_main` are in deps.
- **Long path errors on Windows:** Use Bazel's `--output_user_root` flag to reduce path length.

</Accordion>

---

## 4. Best Practices for Project Layout and Maintenance

- Keep your testing code isolated in dedicated directories (e.g., `tests/`).
- Use consistent naming conventions for test binaries and targets.
- Regularly update GoogleTest and GoogleMock versions for latest fixes and features.
- In Bazel, prefer `cc_test` over `cc_binary` for test executables to leverage built-in test handling.
- Leverage CMake's `gtest_discover_tests` for automatic test discovery.
- Enable and review test build warnings by using strict compiler flags.

---

## 5. Summary Diagram of Integration Workflow

```mermaid
flowchart TD
  subgraph CMake Integration
    A1[Create Project Directory]
    A2[Add CMakeLists.txt with FetchContent]
    A3[Write Test Source (.cc)]
    A4[Configure and Build (cmake, build)]
    A5[Run Tests with CTest]
  end

  subgraph Bazel Integration
    B1[Create Workspace Directory]
    B2[Create MODULE.bazel with googletest dep]
    B3[Write Test Source (.cc)]
    B4[Create BUILD with cc_test Rule]
    B5[Build and Run Tests with bazel test]
  end

  A1 --> A2 --> A3 --> A4 --> A5
  B1 --> B2 --> B3 --> B4 --> B5

  style A1 fill:#d6eaff,stroke:#0366d6
  style B1 fill:#d6eaff,stroke:#0366d6
```

---

## 6. Next Steps & Related Documentation

- **Get Started with Writing Tests:** [Writing Your First Test](../core-workflow/getting-started-tests)
- **Explore Mocking:** [Mocking with GoogleMock](../core-workflow/writing-mocks)
- **Deep Dive into Build Systems:**
  - CMake Quickstart: [docs/quickstart-cmake.md](../quickstart-cmake.md)
  - Bazel Quickstart: [docs/quickstart-bazel.md](../quickstart-bazel.md)
- **Troubleshooting:** [Common Issues and Fixes](../../getting-started/troubleshooting-support/common-issues)

---

## 7. Additional Resources

- [GoogleTest official GitHub repository](https://github.com/google/googletest)
- [CMake Official Site](https://cmake.org/)
- [Bazel Official Site](https://bazel.build/)
- [GoogleTest Primer](../primer.md) for learning assertions and test organization

---

Congratulations! You now have clear, practical workflows for integrating GoogleTest and GoogleMock into your C++ projects using either CMake or Bazel. Your tests are reliably built, linked, and runnable, empowering you to write and maintain robust unit and mock-based tests with confidence.
