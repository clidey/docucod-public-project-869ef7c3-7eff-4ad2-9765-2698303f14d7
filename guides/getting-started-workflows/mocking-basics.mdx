---
title: "Getting Started with Mocks"
description: "Discover how to use GoogleMock to replace real components with controllable mocks in your tests. This tutorial covers creating mock classes, using the MOCK_METHOD macro, and setting expectations for function calls."
---

# Getting Started with Mocks

Unlock the power of GoogleMock by learning how to replace real components with controllable mocks in your C++ tests. This guide walks you through the essentials of creating mock classes using the `MOCK_METHOD` macro, defining mocked methods, and setting up expectations for function call behavior.

---

## 1. Introduction to Mocking

Mocking is essential when testing code that depends on external components or complex objects. Instead of using actual implementations—which may be slow, non-deterministic, or incomplete—you create mock objects that mimic the interfaces and behaviors of the real objects, giving you control over their responses and interaction verification.

GoogleMock (gMock) enables convenient, expressive mock class definitions and provides powerful tools to specify expectations for how these mocks are used.


## 2. Prerequisites

Before you start:

- Your project should be set up to include GoogleMock headers (`#include <gmock/gmock.h>`).
- Basic understanding of C++ inheritance and virtual functions.
- Familiarity with writing unit tests using GoogleTest is helpful but not mandatory.


## 3. Creating Mock Classes

### 3.1 Define the Mock Class

To create a mock for an interface or class, derive a new class and use the `MOCK_METHOD` macro in its **public** section for all methods you want to mock.

The syntax of `MOCK_METHOD` is:

```cpp
MOCK_METHOD(ReturnType, MethodName, (ArgTypes...), (Qualifiers));
```

- `ReturnType`: the return type of the method.
- `MethodName`: the method's name.
- `(ArgTypes...)`: a parenthesized, comma-separated list of argument types.
- `(Qualifiers)`: optional parentheses-enclosed list such as `override`, `const`, `noexcept`.


### 3.2 Common Qualifiers

- `override`: marks the method as overriding a virtual method.
- `const`: if mocking a `const` method.
- `noexcept`: if the original method is marked with `noexcept`.
- More qualifiers like `Calltype(STDMETHODCALLTYPE)` and `ref(...)` are supported for specialized use cases.


### 3.3 Handling Types with Commas

If your return type or arguments contain commas (e.g., `std::pair<int, int>`), wrap the type itself in parentheses or use a type alias:

```cpp
class MockFoo {
 public:
  // With parentheses
  MOCK_METHOD((std::pair<int, int>), GetPair, ());

  // Or using type aliases
  using PairType = std::pair<int, int>;
  MOCK_METHOD(PairType, GetPair, ());
};
```


### 3.4 Mocking Private or Protected Methods

Always declare mock methods in the **public** section, even if the original method is `private` or `protected`. This enables `EXPECT_CALL` and `ON_CALL` to interact with the mock properly.


### 3.5 Example Mock Class

```cpp
#include <gmock/gmock.h>

class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```


## 4. Using Mocked Methods in Tests

### 4.1 Setting Expectations: `EXPECT_CALL`

Specify how you expect the mock’s methods to be called using `EXPECT_CALL`. Basic usage:

```cpp
EXPECT_CALL(mock_object, MethodName(matchers...))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
```

- `matchers...`: Matchers define acceptable argument values (e.g., specific values, or `_` for any).
- `Times`: how often the method is expected to be called (e.g., `Times(1)`, `AtLeast(2)`, `AnyNumber()`).
- `WillOnce`: action to perform on the first matching call.
- `WillRepeatedly`: action after all `WillOnce` actions are used.


### 4.2 Setting Default Behavior: `ON_CALL`

Use `ON_CALL` to specify default behavior **without setting expectations** on call counts:

```cpp
ON_CALL(mock_object, MethodName(matchers...))
    .WillByDefault(action);
```

This is useful when you want to provide realistic behavior but don't want to enforce exact call counts.


### 4.3 Using Common Matchers

- `_`: Matches any argument.
- `Eq(value)`: Matches equality to `value` (implicit when you pass a literal).
- `NotNull()`, `IsNull()`: For pointer arguments.
- `Ge(n)`, `Le(n)`, `Lt(n)`, `Gt(n)`, etc.: Comparisons.


### 4.4 Example: Setting Expectations and Actions

```cpp
using ::testing::_;
using ::testing::Return;
using ::testing::AtLeast;

MockTurtle turtle;

EXPECT_CALL(turtle, Forward(100))
    .Times(AtLeast(1));
EXPECT_CALL(turtle, GetX())
    .WillOnce(Return(10))
    .WillRepeatedly(Return(20));

// Exercise code that interacts with turtle...
int pos = turtle.GetX();  // Returns 10 on first call, 20 thereafter
```


## 5. Best Practices

- **Use `ON_CALL` for default behaviors** and only add `EXPECT_CALL` where you intend to verify calls.
- **Avoid over-specifying arguments** unless necessary; use `_` to generalize.
- When mocking overloaded methods, mock all relevant overloads and use `using` to avoid hiding base versions.
- Use **sequences** (`InSequence`) when call order matters.
- Use **NiceMock**, **NaggyMock**, or **StrictMock** to control warnings and failures on uninteresting calls.
- Always put `EXPECT_CALL` before the code that triggers the mocked method.


## 6. Common Pitfalls

- Mock methods must be in the **public** section to be usable with `EXPECT_CALL`.
- Incorrectly wrapping types with commas may cause macro parsing errors.
- Missing `override` or `const` qualifiers may cause the mock method not to override the base method correctly.
- Setting multiple contradictory `EXPECT_CALL` statements without understanding precedence may cause unexpected failures.
- Forgetting that expectations are **sticky** unless `.RetiresOnSaturation()` is used.


## 7. Troubleshooting

- **Uninteresting call warnings:** Use `NiceMock<T>` to suppress if expected, or add a catch-all `EXPECT_CALL(mock, Method(_)).Times(AnyNumber());`.
- **Unexpected calls:** Verify your matchers and call order; enable `--gmock_verbose=info` to trace calls.
- **Compilation warnings/errors:** Verify `MOCK_METHOD` syntax matches exactly including qualifiers.
- Use `Mock::VerifyAndClearExpectations(&mock_object)` to manually verify expectations before mock destruction if needed.


## 8. Next Steps

After mastering basic mocking:

- Explore advanced matchers for complex argument validation.
- Use sequences and `After` clauses for partial ordering of calls.
- Define custom actions to simulate complex behaviors.
- Utilize delegation techniques to combine real objects and mocks.
- Dive into the [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html) and [Mocks Reference](https://google.github.io/googletest/reference/mocking.html) for deeper insights.


---

## Additional Resources

- [GoogleMock Mocking Reference](https://google.github.io/googletest/reference/mocking.html)
- [gMock for Dummies Tutorial](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [GoogleTest README and Setup](https://github.com/google/googletest)


<CalloutTitle value="Quick Start Tip" />
<Tip>
Use the `MOCK_METHOD` macro inside your mock class's **public** section for each virtual method you want to mock. Then use `EXPECT_CALL` to set expectations **before** exercising code that uses the mock.
</Tip>