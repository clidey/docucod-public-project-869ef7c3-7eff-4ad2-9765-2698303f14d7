---
title: "Integrating with Build Systems (CMake, Bazel)"
description: "Walkthroughs for integrating GoogleTest into popular C++ build systems, including CMake and Bazel. Covers recommended project structures, linking strategies, and troubleshooting for seamless test execution."
---

# Integrating with Build Systems (CMake, Bazel)

## Overview
This guide provides practical walkthroughs for integrating **GoogleTest** into popular C++ build systems, focusing specifically on **CMake** and **Bazel**. You will learn recommended project structures, best practices for linking GoogleTest and GoogleMock, and troubleshooting tips to ensure seamless test discovery and execution.

Integration with your build system is critical for automating tests efficiently. This guide keeps the focus on GoogleTest's interaction with the build tools rather than the full installation or test writing workflow.

---

## Prerequisites
- GoogleTest source or installed binaries available in your project environment.
- Basic familiarity with CMake or Bazel build systems, including how to define targets and dependencies.
- Your development environment configured as per GoogleTest's [Prerequisites and System Requirements](/getting-started/setup-and-installation/prerequisites-system-requirements).

---

## Expected Outcome
By following this guide, you will:
- Understand how to structure your C++ project to include GoogleTest using CMake and Bazel.
- Be able to link your tests against GoogleTest and GoogleMock correctly.
- Gain insight into common integration pitfalls and how to resolve them.
- Have a foundation for reliable automated test builds and executions.

---

## Integration with CMake

### 1. Project Setup
Organize your project directory to clearly separate source code from tests:

```
my_project/
├── src/
│   └── your_code.cpp
├── tests/
│   ├── CMakeLists.txt
│   └── your_tests.cpp
└── CMakeLists.txt
```

Your top-level `CMakeLists.txt` should include GoogleTest and add the test directory:

```cmake
cmake_minimum_required(VERSION 3.10)
project(MyProject)

# Enable testing
enable_testing()

# Add GoogleTest
add_subdirectory(external/googletest) # path to GoogleTest source

# Add test directory
add_subdirectory(tests)
```

### 2. Defining Test Targets
In your `tests/CMakeLists.txt`, define an executable for your tests and link against GoogleTest and GoogleMock:

```cmake
# Gather test sources
set(TEST_SOURCES
    your_tests.cpp
)

# Create the test executable
add_executable(runTests ${TEST_SOURCES})

# Link with GoogleTest and GoogleMock
target_link_libraries(runTests gtest gmock gtest_main)

# Enable test discovery
include(GoogleTest)
gtest_discover_tests(runTests)
```


### 3. Building and Running Tests

Build your test suite:

```bash
mkdir build && cd build
cmake ..
cmake --build .
ctest
```

This compiles your tests, links correctly to GoogleTest binaries, and runs all discovered test cases.

### 4. Best Practices & Tips

- Use `gtest_main` to provide a main function for test executables, reducing boilerplate.
- Prefer `gtest_discover_tests()` for CTest integration—it automatically maps your tests.
- If you're using external GoogleTest binaries (installed system-wide), use `find_package(GTest REQUIRED)` and link against `${GTEST_LIBRARIES}`.
- Always confirm GoogleTest version compatibility with your compiler features (at least C++17).

### 5. Common Pitfalls

- Forgetting to `enable_testing()` in the root `CMakeLists.txt` will prevent test discovery.
- Linking only to `gtest` without `gmock` when GoogleMock is used results in link errors.
- Missing include directories for GoogleTest headers if not using CMake’s `add_subdirectory()` or `find_package()` properly.
- Overlapping test names across multiple test executables can cause confusion during discovery.

---

## Integration with Bazel

### 1. Project Structure
A typical Bazel workspace for using GoogleTest looks like this:

```
my_project/
├── WORKSPACE
├── BUILD
├── src/
│   └── your_code.cc
└── tests/
    ├── BUILD
    └── your_tests.cc
```

### 2. Defining the WORKSPACE
Add GoogleTest as an external dependency in your `WORKSPACE` file:

```python
http_archive(
    name = "com_google_googletest",
    urls = ["https://github.com/google/googletest/archive/release-1.12.1.tar.gz"],
    strip_prefix = "googletest-release-1.12.1",
    sha256 = "94c634d499558a4b58c2f4b44f7270f1dfd2858e9ce42a28b92e0a9f419b4939",
)

load("@com_google_googletest//:bazel/googlemock.bzl", "gmock_repositories")
gmock_repositories()
```

Alter the URL and checksum for your desired GoogleTest version.

### 3. Writing BUILD Files
In your `tests/BUILD`, define test targets:

```python
cc_test(
    name = "my_tests",
    srcs = ["your_tests.cc"],
    deps = ["@com_google_googletest//:gmock_main"],
)
```

Here, `gmock_main` provides the GoogleTest main function along with GoogleMock.
Add any additional dependencies from your source code targets as needed.

### 4. Running Tests

Use Bazel commands to build and run tests:

```bash
bazel test //tests:my_tests
```

Bazel handles compilation, linking, and test execution including detailed logging.

### 5. Best Practices & Tips

- Use `cc_test` rules for your tests to enable Bazel-aware test execution.
- Pin your GoogleTest version in `WORKSPACE` for reproducible builds.
- Take advantage of Bazel’s caching and parallel builds to speed up testing cycles.
- Use `bazel query` to inspect the dependency graph if link errors occur.

### 6. Common Pitfalls

- Missing GoogleMock dependency in `deps` can cause unresolved symbols for mocking features.
- Failing to include `gmock_main` can lead to missing `main()` errors.
- Not specifying transitive dependencies from your source code can cause build failures.

---

## Troubleshooting

### Common Integration Issues
- **Test Not Found or Not Running:**
  - Verify that test executables are linked with `gtest_main` (CMake) or use `cc_test` (Bazel).
  - Ensure your tests are included in the build (via `add_subdirectory` or proper Bazel target).
  - Confirm that `enable_testing()` is called in CMake to activate test discovery.

- **Linker Errors (Undefined References):**
  - Check that both `gtest` and `gmock` libraries are linked properly.
  - Verify include directories for GoogleTest headers.
  - For Bazel, confirm `deps` cover all necessary targets.

- **Compiler Errors about C++17 or newer Features:**
  - Update your compiler or set appropriate C++ standard flags (`-std=c++17` or higher).
  - Confirm your build system forwards these flags.

- **Tests Fail to Run or Crash:**
  - Run your tests with verbosity or debug flags (`ctest -V`, `bazel test --test_output=all`).
  - Ensure GoogleMock is initialized properly if using mocks.

### Pro Tips
- Use GoogleTest’s verbose mode (`--gtest_verbose`) to get detailed output.
- Structure your tests separately from production code for clear dependencies.
- Automate test runs in your CI pipelines using integrated build steps.

---

## Next Steps & Related Guides
- **Writing Your First Test Case:** [Writing Your First Test Case](/getting-started/first-test-experience/writing-your-first-test).
- **Using Assertions Effectively:** Learn how to verify outcomes in tests with assertions at [Using Assertions Effectively](/guides/core-workflows/using-assertions).
- **Mocking Best Practices:** Expand your testing roles with mocks at [Introduction to Mocking with GoogleMock](/guides/mocking-best-practices/intro-mocking).
- **Continuous Integration:** Integrate tests in automated build and test pipelines at [Continuous Integration and Test Automation](/guides/patterns-integration/ci-cd-practices).
- **Installation & Setup:** Review installation details in [Installation Instructions](/getting-started/setup-and-installation/installation-platforms).

---

## Additional Resources
- [GoogleTest Official Repository](https://github.com/google/googletest)
- [CMake Documentation](https://cmake.org/documentation/)
- [Bazel Documentation](https://bazel.build/docs)
- GoogleTest Guides on [Getting Started](https://google.github.io/googletest/quickstart-cmake.html)

---

## Summary Diagram: GoogleTest Integration Flow

```mermaid
flowchart TD
  A[Start: Project with C++ codebase] --> B{Choose Build System}
  B --> C[CMake]
  B --> D[Bazel]

  subgraph CMake Flow
    C --> C1[Add googletest with add_subdirectory]
    C1 --> C2[Define test executable with add_executable]
    C2 --> C3[Link against gtest, gmock, gtest_main]
    C3 --> C4[Enable testing with enable_testing()]
    C4 --> C5[Discover and run tests with gtest_discover_tests()]
  end

  subgraph Bazel Flow
    D --> D1[Declare googletest external dependency in WORKSPACE]
    D1 --> D2[Use cc_test in BUILD files]
    D2 --> D3[Link deps with @com_google_googletest//:gmock_main]
    D3 --> D4[Build and execute tests using bazel test]
  end

  C5 & D4 --> E[Tests run successfully]
  E --> F[End]
```

---