---
title: "Effective Mock Behaviors"
description: "Explore advanced mock behaviors, including controlling strictness (NiceMock, StrictMock), custom actions, cardinalities, and sequencing. Use these tools to create expressive and robust test doubles."
---

# Effective Mock Behaviors

Explore advanced mock behaviors, including controlling strictness (NiceMock, StrictMock), custom actions, cardinalities, and sequencing. Use these tools to create expressive and robust test doubles.

---

## 1. Understanding Mock Strictness

When writing tests with GoogleMock, controlling how strictly your mock objects respond to unexpected or uninteresting calls is vital for test clarity and maintainability.

### 1.1 Behavior Modes

- **NaggyMock (Default)**: Mocks produce warnings for uninteresting calls (methods called without defined expectations) but allow execution to continue.
- **NiceMock**: Suppresses warnings for uninteresting calls, keeping output clean during normal test runs.
- **StrictMock**: Treats any uninteresting calls as test failures, enforcing strict call expectations.

### 1.2 How to Use Strictness Wrappers

Wrap your mock object in the corresponding template:

```cpp
using ::testing::NiceMock;
using ::testing::StrictMock;

// Naggy (default)
MockFoo mock;

// Nice (suppress warnings)
NiceMock<MockFoo> nice_mock;

// Strict (fail on uninteresting)
StrictMock<MockFoo> strict_mock;
```

These wrappers behave like subclasses and can be initialized with your mock's constructor arguments.

### 1.3 Practical Recommendations

- Use **NiceMock** in most cases to reduce noise from uninteresting calls.
- Use **StrictMock** sparingly for precise verification when you want to catch unexpected interactions.
- Avoid unnecessary nesting (e.g., `NiceMock<StrictMock<MockFoo>>`)—it’s unsupported.

<Note>
`NiceMock` and `StrictMock` affect only uninteresting calls—calls to methods without expectations. Unexpected calls, where arguments do not match expectations, remain failures regardless.
</Note>

---

## 2. Custom Actions and Return Values

Mocks let you define *actions* that specify what happens when a method is called. These can be static returns, dynamic computations, or side effects.

### 2.1 Defining Return Values

- Use `Return(value)` to specify a fixed return.
- Use `ReturnRef(object)` to return a reference.
- Use `ReturnPointee(pointer)` to return the current value pointed by a pointer dynamically.

```cpp
EXPECT_CALL(mock, GetValue())
    .WillRepeatedly(ReturnPointee(&dynamic_value));
```

### 2.2 Sequencing Actions

You can specify multiple actions in order:

```cpp
EXPECT_CALL(mock, Compute())
    .WillOnce(Return(1))
    .WillOnce(Return(2))
    .WillRepeatedly(Return(3));
```

Each call consumes one `WillOnce`. After exhausting all, `WillRepeatedly` is used.

### 2.3 Composite Actions

Use `DoAll()` to execute multiple actions in sequence, with the return value of the last action:

```cpp
EXPECT_CALL(mock, Process(_))
    .WillOnce(DoAll(SetArgPointee<0>(5), Return(true)));
```

Here, the first argument is set to `5` and the method returns `true`.

### 2.4 Using Lambdas and Functors as Actions

For complex behaviors, use a lambda or callable:

```cpp
EXPECT_CALL(mock, Calculate(_))
    .WillRepeatedly([](int x) { return x * 42; });
```

This flexibility enables you to tailor mock methods precisely as your test logic requires.

---

## 3. Cardinalities: Controlling Call Counts

Cardinalities define how many times you expect a mock method to be called.

### 3.1 Built-in Cardinalities

Common examples include:

| Cardinality             | Meaning                                      |
|------------------------|----------------------------------------------|
| `Times(AnyNumber())`    | Any number of calls allowed                  |
| `Times(AtLeast(n))`     | Called *at least* n times                     |
| `Times(AtMost(n))`      | Called *at most* n times                      |
| `Times(Between(m, n))`  | Called between m and n times (inclusive)    |
| `Times(Exactly(n))`     | Called exactly n times (zero means never)    |

### 3.2 Specifying Cardinalities

Attach cardinalities to expectations:

```cpp
EXPECT_CALL(mock, DoSomething())
    .Times(Exactly(3));
```

If omitted, cardinality is inferred:

- No `WillOnce` or `WillRepeatedly` means expected **once**.
- *n* `WillOnce()` means expected *n* times.
- If `WillRepeatedly()` follows `WillOnce()`, cardinality becomes `AtLeast(n)`.

### 3.3 Creating Custom Cardinalities

You can create your own cardinalities (e.g., for even-number calls) by implementing the CardinalityInterface.

---

## 4. Sequencing Expectations (Ordering Calls)

Sometimes, the order in which methods are called matters.

### 4.1 Enforcing Strict Order with `InSequence`

Wrap expectations in a sequence block:

```cpp
using ::testing::InSequence;
{
  InSequence seq;
  EXPECT_CALL(mock, FirstCall());
  EXPECT_CALL(mock, SecondCall());
}
```

This insists that `FirstCall` happens before `SecondCall`.

### 4.2 Partial Ordering with `Sequence`

More flexible than `InSequence`, `Sequence` objects let you build DAGs of expectations.

```cpp
using ::testing::Sequence;
Sequence s1, s2;
EXPECT_CALL(mock, A()).InSequence(s1, s2);
EXPECT_CALL(mock, B()).InSequence(s1);
EXPECT_CALL(mock, C()).InSequence(s2);
EXPECT_CALL(mock, D()).InSequence(s2);
```

Here, `A` must happen before `B` and `C`, and `C` before `D`. `B` and `C` order is independent.

### 4.3 Using `After` Clause

You can also specify explicitly that an expectation occurs after others:

```cpp
Expectation e1 = EXPECT_CALL(mock, Init());
EXPECT_CALL(mock, Run()).After(e1);
```

### 4.4 Retiring Expectations

Use `.RetiresOnSaturation()` to make an expectation inactive once it saturates, letting subsequent calls match other expectations.

---

## 5. Control Over Uninteresting Calls

Uninteresting calls are those where no `EXPECT_CALL` is specified.

### 5.1 Default Behavior

- They trigger warnings by default.
- Using `NiceMock` suppresses these warnings.
- Using `StrictMock` treats them as errors.

### 5.2 Suppressing Warnings Manually

Add a catch-all expectation:

```cpp
EXPECT_CALL(mock, Method(_)).Times(AnyNumber());
```

This makes calls to `Method()` with any arguments expected and stops warnings.

### 5.3 Understanding Uninteresting vs Unexpected Calls

- *Uninteresting*: No expectation set for the method. Allowed but warned.
- *Unexpected*: Some expectations set but given call does not match.

Unexpected calls always cause errors.

---

## 6. Best Practices and Common Pitfalls

- **Set expectations before exercising mocks** to avoid undefined behaviors.
- Use **`ON_CALL` wisely** to set default behaviors without implying call counts.
- Avoid over-specifying; prefer *loosely focused tests* verifying a single behavior.
- Use **`NiceMock` to reduce noise** and **`StrictMock` to enforce precision** where needed.
- For methods with many arguments, **consider creating simpler forwarding mocks** for ease.
- When mocking overloaded methods, remember to specify correct overloads or use `using` declarations.
- Use **sequences** to maintain readability and robustness in complex ordering.

---

## 7. Sample Usage Scenarios

### 7.1 Using NiceMock for Uninteresting Calls

```cpp
using ::testing::NiceMock;

NiceMock<MockFoo> mock_foo;
EXPECT_CALL(mock_foo, DoThis());
// No warnings for other method calls
```

### 7.2 Enforcing Call Order

```cpp
using ::testing::InSequence;

{
  InSequence s;

  EXPECT_CALL(mock, Start());
  EXPECT_CALL(mock, Process(_));
  EXPECT_CALL(mock, Finish());
}
```

### 7.3 Custom Sequence Example

```cpp
using ::testing::Sequence;
Sequence seq1, seq2;

EXPECT_CALL(mock, Init()).InSequence(seq1, seq2);
EXPECT_CALL(mock, Work()).InSequence(seq1);
EXPECT_CALL(mock, Cleanup()).InSequence(seq2);
```

---

## 8. Troubleshooting Common Issues

| Issue                              | Cause & Resolution                                                 |
|----------------------------------|------------------------------------------------------------------|
| Uninteresting call warnings       | Use `NiceMock` or add `EXPECT_CALL(...).Times(AnyNumber())`      |
| Unexpected calls causing failure  | Adjust or add `EXPECT_CALL` for those arguments                  |
| Mock methods called too many times| Check `Times()` clause and `RetiresOnSaturation()` usage         |
| `StrictMock` causes unexpected failures | Confirm all expected calls are specified precisely              |

---

## 9. Additional Resources

- [gMock Cookbook - The Nice, Strict and Naggy](https://google.github.io/googletest/gmock_cook_book.html#The-Nice-Strict-and-Naggy)
- [gMock Reference - EXPECT_CALL Syntax](https://google.github.io/googletest/reference/mocking.html#EXPECT_CALL)
- [Using Matchers and Actions](https://google.github.io/googletest/gmock_for_dummies.html)
- [gMock Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)

---

<Info>
This page focuses specifically on advanced mock behaviors within GoogleMock. For foundational information, refer to the Getting Started and Mocking Reference documents.
</Info>
