---
title: "Writing Effective Assertions"
description: "Explore the variety of assertions available in GoogleTest, including equality, relational, and exception-based assertions. See real-world examples of choosing the right assertion for the task, and learn best practices for expressive, maintainable tests."
---

# Writing Effective Assertions

## Overview

Assertions are the foundation of any test written using GoogleTest. They verify your code's behavior by checking conditions, comparing values, or confirming that exceptions are thrown as expected. This guide will help you understand how to choose and write effective assertions that are both expressive and maintainable.

GoogleTest provides a rich set of assertion macros tailored for various testing needs, from simple boolean checks to complex predicate assertions and exception handling. Understanding these enables you to write tests that clearly indicate intent, offer detailed failure messages, and facilitate faster debugging.

---

## Understanding Assertion Types

GoogleTest assertions come in two main categories based on their severity:

- **Nonfatal assertions** (`EXPECT_*`): On failure, the test records the failure but continues executing the current function. Use these when subsequent checks are still valid.
- **Fatal assertions** (`ASSERT_*`): On failure, the assertion aborts the current function immediately. Use these when continuing the test after failure doesn't make sense (e.g., when checking prerequisites).

### General Principle

Use `EXPECT_` assertions whenever possible for thorough testing and `ASSERT_` when a failure means the test cannot proceed meaningfully.

---

## Core Assertion Categories and Usage

### Boolean Conditions

Use these to verify simple true or false expressions.

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

**Example:**
```cpp
EXPECT_TRUE(is_connected) << "Connection failed!";
ASSERT_FALSE(is_error) << "Unexpected error occurred.";
```

### Binary Comparisons

Compare two values using relational operators. Arguments are evaluated exactly once; side effects are safe but argument order is undefined.

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)`  — checks equality (`==`)
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)`  — checks inequality (`!=`)
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)`  — less than (`<`)
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)`  — less or equal (`<=`)
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)`  — greater than (`>`)
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)`  — greater or equal (`>=`)

**Important:**
- For pointer comparison, `EXPECT_EQ` checks pointer identity, not string content. Use string-specific assertions for C strings.

**Example:**
```cpp
EXPECT_EQ(result.size(), expected_size) << "Size mismatch.";
ASSERT_LT(value, threshold) << "Value too large.";
```

### String Comparisons

Specifically designed for comparing C strings (`const char*`) and wide strings.

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` — equal contents
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)` — different contents
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)` — equal ignoring case
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)` — different ignoring case

**Example:**
```cpp
EXPECT_STREQ(user_input.c_str(), "expected");
ASSERT_STRNE(status_message, "Error");
```

### Floating-Point Comparisons

Due to rounding errors, use these assertions instead of `EXPECT_EQ` for floating-point numbers.

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)` — float comparison, within 4 ULPs
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)` — double comparison, within 4 ULPs
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)` — difference within absolute error

**Example:**
```cpp
EXPECT_FLOAT_EQ(calculated_pi, 3.14159f);
ASSERT_NEAR(measured_voltage, expected_voltage, 0.01);
```

---

## Advanced Assertions

### Exception Assertions

Validate whether code throws exceptions as expected. These require exceptions to be enabled in your build.

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW(...)`
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW(...)`
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW(...)`

**Example:**
```cpp
EXPECT_THROW(Compute(-1), std::invalid_argument);
ASSERT_NO_THROW(Process(data));
```

You may use compound statements in `statement` by wrapping in curly braces:

```cpp
EXPECT_NO_THROW({
  Init();
  RunProcess();
});
```

### Predicate Assertions

For cases where built-in assertions aren't sufficient, predicate assertions provide detailed failure messages with streaming of involved values.

- `EXPECT_PREDn(pred, ...)` / `ASSERT_PREDn(pred, ...)` — where `pred` returns `bool`
- `EXPECT_PRED_FORMATn(pred_formatter, ...)` / `ASSERT_PRED_FORMATn(...)` — where `pred_formatter` returns `AssertionResult` with custom messages

These macros support from 1 to 5 arguments.

**Example:**
```cpp
bool AreEqual(int a, int b) { return a == b; }

EXPECT_PRED2(AreEqual, x, y);

// Custom predicate-formatter example:
AssertionResult IsValidScore(const char* exp, int score) {
  if (score >= 0 && score <= 100) return AssertionSuccess();
  return AssertionFailure() << exp << " is out of range: " << score;
}

EXPECT_PRED_FORMAT1(IsValidScore, score);
```

### Explicit Success and Failure

- `SUCCEED()` marks a point in the test as successful (no failure) — useful for documentation.
- `FAIL()` generates a fatal failure and aborts the current function (void-returning only).
- `ADD_FAILURE()` generates a nonfatal failure and allows the current function to continue.
- `ADD_FAILURE_AT(file, line)` generates a nonfatal failure at a specific location.

**Example:**
```cpp
if (unexpected_path) {
  FAIL() << "Should not be here!";
}
```

### Using gMock Matchers

`EXPECT_THAT(value, matcher)` / `ASSERT_THAT(value, matcher)` assert that the value satisfies the given matcher, enabling expressive and customizable checks.

**Example:**
```cpp
EXPECT_THAT(str, StartsWith("Hello"));
ASSERT_THAT(number, AllOf(Gt(0), Lt(100)));
```

Matchers allow readable assertions and provide informative failure messages.

---

## Writing Clear and Maintainable Assertions

- **Choose appropriate assertion type:** Use `EXPECT_` for recoverable checks and `ASSERT_` when failure should abort the test.
- **Provide messages for clarity:** Stream messages with `<<` for additional context.
- **Use predicate assertions for complex logic:** This provides detailed diagnostic information.
- **Prefer matchers for readability and flexibility:** They support chaining and combinators.
- **Beware of side effects:** Arguments in assertions are evaluated exactly once, but argument order is unspecified.
- **Use string assertions for C strings:** To avoid pointer equality confusion.

---

## Practical Tips

- Use `SCOPED_TRACE` to add contextual information to nested assertions.
- Avoid fatal assertions in constructors or destructors.
- When comparing floating-point values, prefer `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` over `EXPECT_EQ` to handle rounding errors.
- Use `EXPECT_NO_FATAL_FAILURE` to ensure subroutine calls do not generate fatal failures.

---

## Common Pitfalls & Troubleshooting

### Assertion Macros Behavior

- Remember: `ASSERT_*` aborts the _current function_ upon failure, not the entire test.
- If cleaning up is needed after an assertion, use `EXPECT_*` or handle failure logic explicitly.

### Comparing C Strings

- `EXPECT_EQ` on C strings tests pointer equality, not string content. Use `EXPECT_STREQ` for content comparison.

### Exception Assertions

- Ensure your build enables exceptions.
- Wrap multiple statements in `{ ... }` when testing exception throwing.

### Floating-Point Comparisons

- Use floating point assertions designed to handle precision issues.

### Predicate Assertions

- Explicitly specify function pointer types for overloaded or templated predicate functions to avoid compilation errors.

---

## Summary

Writing effective assertions in GoogleTest is about selecting the right macro for the situation, using clear messages, and leveraging advanced features like predicate assertions and matchers for expressive tests. This results in tests that are easier to understand, maintain, and diagnose when failures occur.

---

## See Also

- [Assertions Reference](reference/assertions.md) — complete list of assertions.
- [Matchers Reference](reference/matchers.md) — for expressive matching in assertions.
- [Advanced GoogleTest Topics](advanced.md#more-assertions) — deeper insights into predicate assertions and failure message customization.
- [GoogleTest Primer](primer.md#assertions) — introduction to assertions with examples.
- [Using Death Tests Effectively](guides/mocking-and-advanced-usage/using-death-tests) — testing for fatal failure scenarios.

---

## Code Samples

```cpp
#include <gtest/gtest.h>

// Basic boolean assertion
TEST(BasicTest, BooleanCondition) {
  bool is_ready = true;
  EXPECT_TRUE(is_ready) << "System is not ready";
}

// Equality comparison
TEST(ComparisonTest, ExpectEquals) {
  int result = Add(2, 3);
  EXPECT_EQ(result, 5) << "Unexpected addition result";
}

// String content comparison
TEST(StringTest, CompareCStrings) {
  const char* actual = function_under_test();
  EXPECT_STREQ(actual, "expected string");
}

// Floating point approximate equality
TEST(MathTest, PiApproximation) {
  double pi = ComputePi();
  EXPECT_NEAR(pi, 3.14159, 0.0001);
}

// Exception assertion
TEST(ExceptionTest, ThrowsInvalidArgument) {
  EXPECT_THROW({ FunctionThatThrows(-1); }, std::invalid_argument);
}

// Using predicate assertion
bool IsPositive(int x) { return x > 0; }
TEST(PredicateTest, PositiveCheck) {
  EXPECT_PRED1(IsPositive, 10);
}
```

---

## Additional Resources

- [GoogleTest Primer](primer.md) for beginner-friendly introduction.
- [Assertions Reference](reference/assertions.md) for detailed assertion macros.
- [Matchers Reference](matchers.md) for matcher usage.
- [Advanced Guide on Predicate Assertions](advanced.md#predicate-assertions-for-better-error-messages).

---