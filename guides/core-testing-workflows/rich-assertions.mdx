---
title: "Assertions: From Basics to Advanced"
description: "A comprehensive dive into writing effective assertions with GoogleTest, including equality, exceptions, and fatal/non-fatal failures. This page also introduces user-defined and custom assertions."
---

# Assertions: From Basics to Advanced

This guide walks you through writing effective assertions with GoogleTest, starting from the basics of equality verification, moving through exception handling, and exploring both fatal and non-fatal failures. You'll also learn about composing user-defined assertions, custom assertions, and tips for leveraging GoogleTest's rich assertion macros to write clear, reliable tests.

---

## Table of Contents

- [Introduction and Overview](#introduction-and-overview)
- [Basic Assertions](#basic-assertions)
  - [SUCCESS and FAILURE Assertions](#success-and-failure-assertions)
  - [Boolean Conditions](#boolean-conditions)
  - [Binary Comparisons](#binary-comparisons)
  - [String Comparisons](#string-comparisons)
  - [Floating-Point Comparisons](#floating-point-comparisons)
- [Exception Assertions](#exception-assertions)
- [Predicate Assertions](#predicate-assertions)
- [Death Assertions](#death-assertions)
- [User-Defined Assertions](#user-defined-assertions)
- [Custom Assertions](#custom-assertions)
- [Practical Examples](#practical-examples)
- [Tips & Best Practices](#tips--best-practices)
- [Troubleshooting Common Issues](#troubleshooting-common-issues)
- [Next Steps & Related Content](#next-steps--related-content)

---

## Introduction and Overview

GoogleTest provides a comprehensive set of assertion macros to verify conditions in your test code. Assertions can be used to check values, conditions, exceptions, and program behavior. They either result in test failures (fatal or non-fatal) or successes based on evaluated conditions.

- **Fatal failures** abort the current test case immediately.
- **Non-fatal failures** allow the test case to continue running but mark it as failed.

Understanding these assertions is crucial to writing meaningful, maintainable, and reliable tests.

---

## Basic Assertions

### SUCCESS and FAILURE Assertions

These assertions explicitly generate success or failure signals.

**Usage:**

- `SUCCEED()` signals a successful assertion. It is mainly documentary and does not force test success.

- `FAIL()` generates an immediate fatal failure, aborting the current test function.

- `ADD_FAILURE()` emits a non-fatal failure but lets the current test continue.

- `ADD_FAILURE_AT(file, line)` emits a non-fatal failure, pinpointing a specific source location.

```cpp
SUCCEED(); // Marks this point as a successful assertion.
FAIL() << "This test fails here."; // Stops test with fatal failure
ADD_FAILURE() << "Non-fatal failure message.";
ADD_FAILURE_AT("my_file.cc", 45) << "Failure at a specific location";
```

### Boolean Conditions

You can assert the truth or falsity of a boolean condition.

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`: succeeds if `condition` is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`: succeeds if `condition` is false.

`EXPECT_` allows test continuation upon failure, while `ASSERT_` aborts the current test function.

```cpp
EXPECT_TRUE(is_initialized) << "Initialization failed";
ASSERT_FALSE(has_error) << "Unexpected error occurred";
```

### Binary Comparisons

Compare two values using standard relational operators:

- Equality: `EXPECT_EQ(val1, val2)`, `ASSERT_EQ(val1, val2)`
- Inequality: `EXPECT_NE`, `ASSERT_NE`
- Less than: `EXPECT_LT`, `ASSERT_LT`
- Less or equal: `EXPECT_LE`, `ASSERT_LE`
- Greater than: `EXPECT_GT`, `ASSERT_GT`
- Greater or equal: `EXPECT_GE`, `ASSERT_GE`

**Tips:**

- For C-style strings, use `EXPECT_STREQ` and `EXPECT_STRNE` to compare contents (not pointers).
- Compare pointers to `nullptr` using `EXPECT_EQ(ptr, nullptr)` over `EXPECT_EQ(ptr, NULL)`.

Example:

```cpp
EXPECT_EQ(expected_value, actual_value) << "Values mismatch";
EXPECT_STREQ("hello", str) << "Strings are not equal";
```

### String Comparisons

GoogleTest provides specialized macros for C-strings and wide strings comparison:

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)`: exact content equality.
- `EXPECT_STRNE` / `ASSERT_STRNE`: exact content inequality.
- `EXPECT_STRCASEEQ` / `ASSERT_STRCASEEQ`: equality ignoring case.
- `EXPECT_STRCASENE` / `ASSERT_STRCASENE`: inequality ignoring case.

Use these where value equality of C-style strings is needed.

### Floating-Point Comparisons

Due to precision and rounding errors, floating-point comparisons require tolerance.

- `EXPECT_FLOAT_EQ(val1, val2)`: checks for approximate equality between `float` values.
- `EXPECT_DOUBLE_EQ(val1, val2)`: for `double` values.
- `EXPECT_NEAR(val1, val2, abs_error)`: verifies values are within `abs_error` tolerance.

**Example:**

```cpp
EXPECT_NEAR(calculated_value, expected_value, 0.001) << "Value out of tolerance";
```

---

## Exception Assertions

Verify that a block of code throws or does not throw exceptions.

Use:

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW`
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW`
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW`

Example:

```cpp
EXPECT_THROW(MyFunction(), std::runtime_error);
EXPECT_NO_THROW(MySafeFunction());
```

These assertions provide detailed failure messages when the thrown exception does not match expectations.

---

## Predicate Assertions

Predicate assertions enable comparing complex logic with descriptive failure messages.

- `EXPECT_PRED1(pred, val1)`, `EXPECT_PRED2(pred, val1, val2)`, ... up to five arguments.

The predicate `pred` should return `true` if the assertion passes.

Example:

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, number);
```

- `EXPECT_PRED_FORMAT*` versions allow writing detailed failure messages by defining predicate-formatters.

Use these when boolean conditions are insufficient or you want expressive messages.

---

## Death Assertions

Death assertions verify that a statement causes the program to terminate.

- `EXPECT_DEATH(statement, matcher)` / `ASSERT_DEATH`:
  Verifies if `statement` causes process termination and stderr output matches `matcher`.

- `EXPECT_DEATH_IF_SUPPORTED`, `EXPECT_DEBUG_DEATH`, `EXPECT_EXIT`: specialized variants for platform and mode compatibility.

Use these for testing fatal error handling and termination logic safely.

Example:

```cpp
EXPECT_DEATH(DoSomethingDangerous(), "Error on line");
EXPECT_EXIT(NormalExit(), ::testing::ExitedWithCode(0), "Success");
```

---

## User-Defined Assertions

GoogleTest allows writing your own custom assertion macros to suit your codebase needs.

Use `ASSERT_TRUE` or `EXPECT_TRUE` with your predicates, optionally adding custom failure messages with `<<` streaming.

Example:

```cpp
#define ASSERT_IS_VALID(ptr) \
  ASSERT_TRUE(IsValid(ptr)) << "Pointer is invalid: " << ptr;
```

This makes your tests clearer and easier to read.

---

## Custom Assertions

For more control over complex checks and better failure reporting, implement custom assertions using functions returning `::testing::AssertionResult`.

Structure your custom assertion as:

```cpp
::testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return ::testing::AssertionSuccess();
  return ::testing::AssertionFailure() << n << " is not even";
}
```

Use in tests:

```cpp
EXPECT_PRED1(IsEven, number);
```

This approach integrates neatly with GoogleTest's failure reporting framework.

---

## Practical Examples

### Basic Equality Check

```cpp
TEST(MyTest, BasicEquality) {
  int expected = 42;
  int actual = ComputeAnswer();
  EXPECT_EQ(expected, actual) << "Answer does not match expected.";
}
```

### Exception Testing

```cpp
TEST(MyTest, ThrowsException) {
  EXPECT_THROW(SomeFunctionThatThrows(), std::invalid_argument);
}
```

### Using Predicates

```cpp
bool IsPositive(int n) { return n > 0; }
TEST(MyTest, PredicateCheck) {
  EXPECT_PRED1(IsPositive, GetValue());
}
```

---

## Tips & Best Practices

- Prefer `EXPECT_` variants when you want test execution to continue and `ASSERT_` variants to stop on failure.
- Use specific assertions instead of generic `EXPECT_TRUE` for clearer failure output.
- Use matchers and predicates to make your assertions expressive yet precise.
- Avoid over-specifying expectations; focus assertions on what truly matters.
- Use `EXPECT_DEATH` carefully to test crash scenarios.
- Leverage custom assertions to encapsulate complex logic and improve test readability.
- Always include meaningful failure messages with `<<` for easier debugging.

---

## Troubleshooting Common Issues

- **Assertion messages unclear?** Use Google's built-in matchers or write custom assertions for clarity.
- **Tests unexpectedly pass/fail?** Check your assertion type (`EXPECT_` vs `ASSERT_`) and conditions.
- **Exception tests fail?** Verify the exact exception type and scope of tested code.
- **Death tests flaky or time out?** Use `EXPECT_DEATH_IF_SUPPORTED`, and avoid side effects before death assertion.

---

## Next Steps & Related Content

- Explore [Matchers Reference](reference/matchers.md) for detailed argument validation.
- Review [Mocking Reference](reference/mocking.md) to combine assertions with mocks effectively.
- Learn about [Custom Actions and Matchers](guides/mocking-and-advanced-techniques/actions-and-matchers.md) to extend GoogleTest.
- Familiarize with [Death Tests and Error-Handling Scenarios](guides/core-testing-workflows/death-tests-error-handling.md) for more advanced termination testing.

---