---
title: "Organizing and Running Tests"
description: "Learn how to structure test code, use test fixtures, and take advantage of automatic test discovery. This guide covers grouping tests, filtering executions, and leveraging command-line options for optimal workflows."
---

# Organizing and Running Tests

## Overview
This guide helps you effectively structure your test code using GoogleTest, organize tests into logical groups, utilize test fixtures, and take full advantage of GoogleTest's automatic test discovery and execution features. It also shows how to filter tests on the command line and control test execution for optimized workflows.

## Prerequisites
- Basic knowledge of C++ and your build environment.
- GoogleTest installed and configured for your project.
- Familiarity with writing simple test cases using the `TEST()` macro.

## Expected Outcome
By following this guide, you will:
- Understand how to group tests using test suites and fixtures.
- Learn how to write shared setup/teardown logic with test fixtures.
- Run selected tests using GoogleTest command-line filters.
- Use command-line flags to customize test execution and reporting.

## Time Estimate
Completing this workflow requires approximately 20-30 minutes depending on familiarity with GoogleTest.

## Difficulty Level
Beginner to Intermediate

---

# 1. Grouping Test Code

Organizing tests logically ensures clarity, maintainability, and efficient test execution.

### 1.1 Test Suites
- Tests are grouped into *test suites* (historically called "test cases").
- Use the `TEST(TestSuiteName, TestName)` macro to define individual tests within a suite.
- Test suite names should reflect the component or class under test.

Example:
```cpp
TEST(FactorialTest, HandlesZeroInput) {
  EXPECT_EQ(Factorial(0), 1);
}

TEST(FactorialTest, HandlesPositiveInput) {
  EXPECT_EQ(Factorial(5), 120);
}
```

### Best Practice
- Group logically related tests sharing subject or intent into the same test suite.
- Avoid overly large suites to keep tests isolated and fast.

---

# 2. Using Test Fixtures to Share Setup and Teardown

Repeated setup and cleanup code across tests can be centralized in test fixtures.

### 2.1 Defining a Test Fixture
- Derive a class from `testing::Test`.
- Add common member variables and setup code inside.
- Use `SetUp()` for initialization before each test.
- Use `TearDown()` for cleanup after each test.

Example:
```cpp
class QueueTest : public testing::Test {
 protected:
  void SetUp() override {
    q_.Enqueue(1);
    q_.Enqueue(2);
  }

  Queue<int> q_;
};
```

### 2.2 Writing Tests with Fixtures
- Use `TEST_F(TestFixtureClassName, TestName)` to access fixture members.

Example:
```cpp
TEST_F(QueueTest, IsNotEmptyInitially) {
  EXPECT_EQ(q_.size(), 2);
}

TEST_F(QueueTest, DequeueWorks) {
  int* n = q_.Dequeue();
  ASSERT_NE(n, nullptr);
  EXPECT_EQ(*n, 1);
  delete n;
}
```

### Tips
- Each `TEST_F` runs with a fresh fixture instance to maintain test isolation.
- Use the fixture's constructor or `SetUp()` for initializing test data.

---

# 3. Automatic Test Discovery and Execution

GoogleTest automatically discovers and runs all defined tests in your linked executable.

### How It Works
- Tests defined using `TEST()` or `TEST_F()` macros register themselves at runtime.
- Running the test binary executes all registered tests in sequence.
- Use `RUN_ALL_TESTS()` in your `main()` function to launch all tests.

Example:
```cpp
int main(int argc, char** argv) {
  testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

### Benefits
- No manual registration or enumeration of tests needed.
- Simplifies adding new tests.
- Testing frameworks report detailed pass/fail info.

---

# 4. Filtering Which Tests to Run

You may want to run a subset of tests based on name or other criteria.

### 4.1 Using the `--gtest_filter` Flag
- Control tests to run with `--gtest_filter=<pattern>`.
- `<pattern>` can include positive and negative filters separated by `-`.

Examples:
- Run all tests in `QueueTest` suite:
  ```
  ./my_tests --gtest_filter=QueueTest.*
  ```
- Run only tests named `HandlesZeroInput`:
  ```
  ./my_tests --gtest_filter=*.HandlesZeroInput
  ```
- Exclude a test named `QueueTest.DequeueWorks`:
  ```
  ./my_tests --gtest_filter=-QueueTest.DequeueWorks
  ```

### 4.2 Wildcards
- Wildcards `*` can be used to match any number of characters.

---

# 5. Command-Line Options for Test Runs

GoogleTest provides various flags to customize test execution and output.

| Flag                      | Description                                    |
|---------------------------|-----------------------------------------------|
| `--gtest_repeat=N`        | Run all tests N times (0 means repeat forever).|
| `--gtest_shuffle`         | Shuffle the order tests are run.               |
| `--gtest_output=xml[:filepath]` | Outputs test results in XML format.      |
| `--gtest_break_on_failure`| Breaks into debugger on first failure.        |

### Helpful Examples
- Run tests multiple times to catch flakiness:
  ```
  ./my_tests --gtest_repeat=10
  ```
- Shuffle tests to find inter-test dependencies:
  ```
  ./my_tests --gtest_shuffle
  ```

### Additional Flags
- Use `--help` for a full list.

---

# 6. Best Practices for Organizing and Running Tests

- **Name your test suites and test names clearly** to reflect their intent.
- **Group related tests using test suites and fixtures** to reuse code.
- **Keep test fixtures lean** and focused only on what tests need.
- **Isolate tests to avoid dependencies or order sensitivity.** Use shuffling and filtering when debugging.
- **Leverage command-line filtering** to focus on specific tests during development.
- Use fixturesâ€™ `SetUp()` and `TearDown()` correctly to manage state.
- **Avoid side effects between tests** to maintain repeatability.

---

# 7. Troubleshooting Common Issues

### Issue: Tests Not Running
- Ensure your test binary calls `testing::InitGoogleTest()` and `RUN_ALL_TESTS()`.
- Confirm tests are linked into the binary.

### Issue: Tests Run but Not Found by Filter
- Check the exact test suite and test names.
- Remember filters are case-sensitive.

### Issue: Test Fixtures Not Reset Between Tests
- Confirm `TEST_F()` is used instead of `TEST()` to use fixtures.
- Each test should get a fresh fixture object. If not, investigate constructor usage.

### Tips
- Turn on verbose output with `--gtest_verbose=info` for detailed test execution.
- Use `--gtest_list_tests` to see all discovered tests.

---

# 8. Next Steps & Related Topics

- Explore [Writing Your First Test](writing-your-first-test.md) to build simple tests.
- Learn to [Use Assertions Effectively](using-assertions-effectively.md) for robust validations.
- Deep dive into [Mocking with gMock](introduction-to-mocking.md) for interaction-based testing.
- Configure project integration and build settings in [Configuring Your Project](configuring-your-project.md).

---

# Appendix: Sample Main and Test Fixture Example

```cpp
#include <gtest/gtest.h>

class MyTestFixture : public ::testing::Test {
 protected:
  void SetUp() override {
    // common initialization code
  }

  void TearDown() override {
    // cleanup code
  }
};

TEST_F(MyTestFixture, TestOne) {
  EXPECT_TRUE(true);
}

TEST_F(MyTestFixture, TestTwo) {
  EXPECT_EQ(1, 1);
}

int main(int argc, char **argv) {
  ::testing::InitGoogleTest(&argc, argv);
  return RUN_ALL_TESTS();
}
```

This sample shows how to write tests with shared setup and run all tests automatically.

---