---
title: "Assertions and Test Verification"
description: "Explore the full spectrum of assertions provided by GoogleTest and learn how to choose the right ones to verify your code's behavior, including fatal vs non-fatal checks and custom assertions."
---

# Assertions and Test Verification

Explore the full spectrum of assertions provided by GoogleTest and learn how to choose the right ones to verify your code's behavior, including fatal vs non-fatal checks and custom assertions.

---

## 1. Understanding Assertions

Assertions are the core mechanism to verify the correctness of your code in GoogleTest. They check conditions and produce success or failure results that determine whether your tests pass or fail.

### Types of Assertions

- **Fatal Assertions (`ASSERT_*`)**: Abort the current function immediately upon failure. Use them when continuing the test after a failure is nonsensical (e.g., a required resource initialization).

- **Nonfatal Assertions (`EXPECT_*`)**: Report failure but allow the test function to continue running. Use these to report multiple issues in a single test run.

### Custom Failure Messages

Most assertion macros support inserting custom failure messages by streaming into the macro using the `<<` operator.

```cpp
EXPECT_TRUE(ptr != nullptr) << "Expected non-null pointer";
ASSERT_EQ(value, expected) << "Value mismatch";
```

Customize failure messages to give meaningful context about what went wrong.

---

## 2. Common Assertion Macros

### Boolean Condition Assertions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` 
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

Use these to test Boolean conditions directly.

### Equality and Comparison Assertions

Use these to compare two values:

| Assertion          | Description                        |
|--------------------|----------------------------------|
| `EXPECT_EQ(val1, val2)` | Checks if `val1 == val2`          |
| `EXPECT_NE(val1, val2)` | Checks if `val1 != val2`          |
| `EXPECT_LT(val1, val2)` | Checks if `val1 < val2`           |
| `EXPECT_LE(val1, val2)` | Checks if `val1 <= val2`          |
| `EXPECT_GT(val1, val2)` | Checks if `val1 > val2`           |
| `EXPECT_GE(val1, val2)` | Checks if `val1 >= val2`          |

Use the `ASSERT_` versions for fatal failures. Note that for C-style strings (char*), use string-specific macros instead.

### String Comparison Assertions

For C strings (`const char*`), use:

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ` for equality
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE` for inequality
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ` for case-insensitive equality
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE` for case-insensitive inequality

These compare contents, not pointers.

### Floating-Point Assertions

Floating-point comparisons require tolerance due to precision errors:

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ` checks if float values differ by no more than 4 ULPs.
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ` checks the same for doubles.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR` verifies the absolute difference does not exceed `abs_error`.

Avoid using `EXPECT_EQ` for floating point types.

### Exception Assertions

If exceptions are enabled, use:

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW`
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW`
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW`

These verify whether a statement throws or does not throw exceptions.

### Explicit Success and Failure

- `SUCCEED()` generates a success explicitly (mainly for documentation).
- `FAIL()` generates a fatal failure immediately.
- `ADD_FAILURE()` generates a nonfatal failure immediately.
- `ADD_FAILURE_AT(file, line)` generates a nonfatal failure at a specified location.

---

## 3. Advanced Assertions

### Predicate Assertions for Custom Logic

Standard macros can be limiting when testing complex conditions.
GoogleTest offers predicate assertions which let you define custom predicate functions with informative messages.

- `EXPECT_PRED*` and `ASSERT_PRED*` take boolean predicates.
- `EXPECT_PRED_FORMAT*` and `ASSERT_PRED_FORMAT*` accept predicate-formatters that can generate detailed failure diagnostics.

Example predicate function:

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
EXPECT_PRED1(IsEven, value);
```

Or with formatter:

```cpp
testing::AssertionResult IsEven(int n) {
  return (n % 2) == 0 ? testing::AssertionSuccess() : 
         testing::AssertionFailure() << n << " is not even";
}
EXPECT_PRED_FORMAT1(IsEven, value);
```

### Using Matchers with `EXPECT_THAT`

`EXPECT_THAT(value, matcher)` utilizes GoogleMock matchers to provide readable and expressive assertions.

Example:

```cpp
EXPECT_THAT(str, StartsWith("Hello"));
EXPECT_THAT(num, AllOf(Gt(5), Lt(10)));
```

Matchers provide rich pattern matching, including regex matching, containers, pointers and more.

### HRESULT Assertions (Windows only)

Special macros to verify COM `HRESULT` return codes:

- `EXPECT_HRESULT_SUCCEEDED(expression)` / `ASSERT_HRESULT_SUCCEEDED`
- `EXPECT_HRESULT_FAILED(expression)` / `ASSERT_HRESULT_FAILED`

These macros will report human-readable error messages if the `HRESULT` indicates failure.

### Death Assertions

Used to verify code that terminates the process (e.g., fails assertion or calls abort):

- `EXPECT_DEATH(statement, regex)` / `ASSERT_DEATH`
- `EXPECT_DEATH_IF_SUPPORTED`
- `EXPECT_DEBUG_DEATH`
- `EXPECT_EXIT(statement, predicate, regex)` / `ASSERT_EXIT`

Death tests run the tested statement in a separate process and check the exit condition and output.

**Important**: Name death test suites with a trailing `DeathTest` to ensure correct ordering and thread safety.

---

## 4. Best Practices and Tips

### Choosing Between `EXPECT_*` and `ASSERT_*`

- Use `EXPECT_*` when the test can sensibly continue after failure for more comprehensive feedback.
- Use `ASSERT_*` when continuing would cause invalid state or crashes.

### Custom Failure Messages

Always provide custom failure messages using `<<` especially for complex or critical assertions to ease debugging.

### Using `SUCCEED()`

Use `SUCCEED()` sparingly to document intended success points or to mark code coverage paths.

### Propagating Fatal Failures from Subroutines

Fatal assertions abort the current function, not the whole test. To propagate failures properly:

- Use `ASSERT_NO_FATAL_FAILURE(statement)` or `EXPECT_NO_FATAL_FAILURE(statement)` to verify subroutine calls donâ€™t produce fatal failures.
- Use `testing::Test::HasFatalFailure()` to conditionally abort further checks.

### Adding Traces With `SCOPED_TRACE`

Use `SCOPED_TRACE(message)` in helper functions or loops to include contextual information in failure messages, making test failures easier to trace back.

### Skipping Tests

Use `GTEST_SKIP()` to skip tests at runtime due to unmet preconditions or environment constraints.

```cpp
TEST(MyTest, SkipExample) {
  if (!IsFeatureSupported()) GTEST_SKIP() << "Feature unsupported";
  ... test code ...
}
```

### Using `RecordProperty` for Extra Metadata

`RecordProperty(key, value)` logs additional info for XML or JSON reports, useful for recording dynamic results or environment info.

---

## 5. Inspecting Test Execution and Results

### Obtaining Current Test Info

Get information about the currently running test:

```cpp
const testing::TestInfo* test_info = testing::UnitTest::GetInstance()->current_test_info();
if (test_info != nullptr) {
  std::cout << "Running test: " << test_info->test_suite_name()
            << "." << test_info->name() << std::endl;
}
```

### Using Assertion Macros Within Custom Event Listeners

GoogleTest allows extending testing output by implementing custom event listeners with the `TestEventListener` interface.

*Note*: Be careful not to generate failures inside `OnTestPartResult` to avoid recursion.

---

## 6. Quick Reference Code Examples

### Basic Assertions

```cpp
TEST(FactorialTest, HandlesZero) {
  EXPECT_EQ(Factorial(0), 1);
  ASSERT_TRUE(Factorial(0) == 1) << "Factorial of 0 should be 1";
}
```

### Asserting Floating Points

```cpp
EXPECT_FLOAT_EQ(3.14159f, ComputePiApprox());
EXPECT_NEAR(3.14159, ComputePiApproxDouble(), 0.00001);
```

### Using Predicate Assertions

```cpp
bool IsEven(int n) { return (n % 2) == 0; }
TEST(EvenTest, Basic) {
  EXPECT_PRED1(IsEven, 4);  // Succeeds
}
```

### Writing Death Tests

```cpp
TEST(FooDeathTest, HandlesNull) {
  ASSERT_DEATH(FunctionThatExpectsNonNull(nullptr), "null pointer");
}
```

### Custom Failure Message

```cpp
EXPECT_EQ(actual, expected) << "Mismatch for input value " << input_value;
```

### Adding Contextual Trace

```cpp
void Helper(int n) {
  SCOPED_TRACE("Testing value " + std::to_string(n));
  EXPECT_GT(n, 0);
  EXPECT_LT(n, 100);
}

TEST(MyTest, Range) {
  for (int i = -1; i <= 101; ++i) {
    Helper(i);
  }
}
```

---

## 7. Troubleshooting Common Issues

- **Using `ASSERT_*` vs. `EXPECT_*` incorrectly**: Fatal assertions abort only the current function.
- **Comparison of C strings using `EXPECT_EQ` instead of `EXPECT_STREQ`** will compare pointers, not string contents.
- **Floating point comparisons using `EXPECT_EQ`** cause flaky tests due to rounding. Use `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR`.
- **Death test failures due to unexpected state**: Make sure to `Mock::AllowLeak()` mocks used in death tests to avoid false positives.
- **Compile errors with assertions in non-void functions**: Use non-fatal assertions or refactor functions to `void` if using fatal assertions.

---

For a comprehensive list of assertion macros and best practices, always refer to the official [Assertions Reference](reference/assertions.md).

---

# Additional Resources

- [GoogleTest Primer](docs/primer.md)
- [GoogleTest Advanced Topics](docs/advanced.md)
- [gMock Cookbook](docs/gmock_cook_book.md) for integrating mocking with assertions
- [Matchers Reference](reference/matchers.md) for enhanced assertions with patterns
- [Test Fixtures and Test Suite](reference/testing.md) to learn organizing tests

---

This page fits within the broader documentation by focusing exclusively on assertions and verification techniques in GoogleTest, complementing guides on writing tests, mocking, and running tests effectively.

---