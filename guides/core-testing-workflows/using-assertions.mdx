---
title: "Assertions and Matchers"
description: "Learn how to leverage the full power of GoogleTest's assertion macros and matchers to write clear, intention-revealing tests for your code. Includes usage patterns for custom assertions."
---

# Assertions and Matchers

GoogleTest provides a comprehensive set of assertion macros and matcher utilities to help you verify your code's behavior with clear, intention-revealing tests. This guide covers how to leverage built-in assertions, predicate assertions, matchers, and custom assertions to write readable and robust tests.

---

## 1. Overview

### What This Page Helps You Do
Learn how to use GoogleTest's assertion macros and matchers effectively, including predicate assertions for complex conditions and custom assertion formatting. You'll gain the ability to write tests that provide insightful failure messages, improving debugging and test maintenance.

### Prerequisites
- Basic understanding of writing tests using GoogleTest.
- Familiarity with C++ functions and templates.

### Expected Outcome
- Confident use of a broad range of assertion macros.
- Ability to write predicate-based assertions that explain failures.
- Use of matchers with `EXPECT_THAT` for expressive testing.
- Understanding of custom predicate-formatters for tailored error messages.

### Estimated Time
15-30 minutes

### Difficulty Level
Intermediate

---

## 2. Core Assertion Macros

GoogleTest assertions come in pairs: `EXPECT_` macros generate nonfatal failures allowing tests to continue, whereas `ASSERT_` macros generate fatal failures aborting the current test function.

### Common Assertion Types

- **Boolean Conditions:**
  - `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)`
  - `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)`

- **Binary Comparisons:**
  - `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` // Equality comparison
  - `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` // Inequality
  - `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)` // Less than
  - `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)` // Less or equal
  - `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)` // Greater than
  - `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)` // Greater or equal

- **String Comparisons:**
  - `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` // C string equality
  - `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)` // Not equal
  - `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)` // Equality ignoring case
  - `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)` // Inequality ignoring case

- **Floating-Point Comparisons:**
  - `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)`
  - `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)`
  - `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`

- **Exception Assertions:**
  - `EXPECT_THROW(stmt, exception_type)` / `ASSERT_THROW(stmt, exception_type)`
  - `EXPECT_ANY_THROW(stmt)` / `ASSERT_ANY_THROW(stmt)`
  - `EXPECT_NO_THROW(stmt)` / `ASSERT_NO_THROW(stmt)`

- **Explicit Success and Failure:**
  - `SUCCEED()` - documents success.
  - `FAIL()` - generates fatal failure, aborting test.
  - `ADD_FAILURE()` - generates nonfatal failure.

### Using Custom Failure Messages
Append additional descriptions to assertions by streaming into the macro:

```cpp
EXPECT_TRUE(my_condition) << "Condition failed on input X";
ASSERT_EQ(x, 5) << "x did not equal 5";
```

This improves failure diagnostics.

---

## 3. Predicate Assertions for Detailed Failures

Sometimes, complex conditions cannot be expressed clearly via base assertions. To get detailed failure messages revealing the values involved, GoogleTest provides predicate assertions:

### Using Boolean Predicate Functions

If you have a function or functor that returns `bool`, you can use these macros:

```cpp
EXPECT_PRED1(pred, val1)
EXPECT_PRED2(pred, val1, val2)
... up to 5 arguments ...

ASSERT_PRED1(pred, val1)
...
```

These verify that `pred(val1, val2, ...) == true`.

Example:

```cpp
bool MutuallyPrime(int m, int n) { ... }
EXPECT_PRED2(MutuallyPrime, a, b);
```

If the assertion fails, GoogleTest prints argument values automatically, for example:

```
MutuallyPrime(b, c) evaluates to false, where
b evaluates to 4
c evaluates to 10
```

<Note>
For overloaded or template predicates, you must explicitly specify the function pointer type or template parameters to resolve ambiguity.
</Note>

### Using Predicate Functions Returning `AssertionResult`

For richer success/failure explanation, write predicates that return `testing::AssertionResult`:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess() << n << " is even";
  else return testing::AssertionFailure() << n << " is odd";
}

EXPECT_TRUE(IsEven(x));
```

This produces detailed failure messages:

```
Value of: IsEven(x)
  Actual: false (3 is odd)
Expected: true
```

### Using Predicate-Formatter Assertions for Custom Messages

To fully customize failure message formatting, use predicate-format assertions with predicate-formatter functions:

```cpp
EXPECT_PRED_FORMAT1(formatter, val1)
EXPECT_PRED_FORMAT2(formatter, val1, val2)
...
```

A *predicate-formatter* is a function or functor with signature:

```cpp
testing::AssertionResult PredicateFormatter(
    const char* expr1, const T1& val1);

// or for more args

testing::AssertionResult PredicateFormatter(
    const char* expr1, const char* expr2, const T1& val1, const T2& val2);
```

It receives expressions as C strings with the argument names (for displaying in error messages), along with their values. It returns success or failure along with a message.

Example:

```cpp
testing::AssertionResult AssertMutuallyPrime(const char* m_expr, const char* n_expr, int m, int n) {
  if (MutuallyPrime(m, n)) return testing::AssertionSuccess();
  return testing::AssertionFailure() << m_expr << " and " << n_expr
         << " (" << m << " and " << n << ") are not mutually prime.";
}
EXPECT_PRED_FORMAT2(AssertMutuallyPrime, a, b);
```

If the assertion fails, it might print:

```
b and c (4 and 10) are not mutually prime.
```

---

## 4. Using GoogleMock Matchers with `EXPECT_THAT`

GoogleTest integrates with gMock matchers, allowing more readable and expressive assertions:

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;
using ::testing::MatchesRegex;
using ::testing::AllOf;
using ::testing::Gt;
using ::testing::Lt;

EXPECT_THAT(value1, StartsWith("Hello"));
EXPECT_THAT(value2, MatchesRegex("Line \\d+"));
ASSERT_THAT(value3, AllOf(Gt(5), Lt(10)));
```

Matchers support complex conditions, wildcards, logical combinations, and can provide detailed failure diagnostics.

See the [Matchers Reference](matchers.md) for a comprehensive list of built-in matchers and guidance on creating custom matchers.

---

## 5. Floating-Point Predicate-Format Functions

Floating-point comparisons require special handling due to rounding errors. GoogleTest provides predicate-format functions for approximate comparisons:

```cpp
using ::testing::FloatLE;
using ::testing::DoubleLE;

EXPECT_PRED_FORMAT2(FloatLE, val1, val2);  // val1 <= val2 approximately
EXPECT_PRED_FORMAT2(DoubleLE, val1, val2); 
```

These verify that `val1` is less than or approximately equal to `val2` within a small tolerance, including handling of special cases like NaN and infinity.

---

## 6. Type Assertions

For compile-time type checks inside templates, use:

```cpp
::testing::StaticAssertTypeEq<T1, T2>();
```

It compiles only if the types match exactly; otherwise, it triggers a compile error.

---

## 7. Practical Tips & Best Practices

### Always Evaluate Arguments Once

All assertion macros evaluate their arguments exactly once, preventing subtle bugs caused by multiple evaluations.

### Use `EXPECT_` vs. `ASSERT_` Appropriately

Use `ASSERT_` macros when test continuation after failure makes no sense (e.g., after null pointer checks).

### Writing Efficient Custom Assertions

Prefer predicate assertions returning `AssertionResult` for rich failure info and easier debugging.

### Working With Overloaded or Template Predicates

Be explicit about predicate function types to avoid ambiguity.

### Combine Matchers for Expressivity

Use multiple matchers with logical combinators in `EXPECT_THAT` for clear and powerful assertions.

---

## 8. Common Pitfalls & Troubleshooting

- **Ambiguous predicate usage:** Use explicit casting or template specification for overloaded/polymorphic predicates.
- **Fatal assertions in non-void functions:** Fatal assertions abort the current (void-returning) function only; fatal assertions cannot be used in non-void-returning functions.
- **Unstreamable types in predicates:** Use predicate-formatters that provide custom message formatting for types lacking stream `<<` support.

---

## 9. Examples

### Basic Boolean Assertion

```cpp
TEST(FactorialTest, Positive) {
  EXPECT_TRUE(Factorial(5) > 0);
  ASSERT_FALSE(Factorial(-1) > 0);
}
```

### Using a Predicate Function

```cpp
bool IsEven(int n) { return n % 2 == 0; }

TEST(NumberTest, EvenCheck) {
  EXPECT_PRED1(IsEven, 4);  // Passes
  EXPECT_PRED1(IsEven, 5);  // Fails and prints the value
}
```

### Using a Predicate Returning AssertionResult

```cpp
testing::AssertionResult IsEvenWithMessage(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess() << n << " is even";
  else return testing::AssertionFailure() << n << " is odd";
}

TEST(NumberTest, EvenCheckDetailed) {
  EXPECT_TRUE(IsEvenWithMessage(5));  // Prints detailed failure
}
```

### Using Predicate-Formatter

```cpp
testing::AssertionResult AssertSumIsEven(const char* e1, const char* e2, int a, int b) {
  int sum = a + b;
  if (sum % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << e1 << " + " << e2 << " evaluates to " << sum << ", which is not even.";
}

TEST(NumberTest, SumEvenCheck) {
  EXPECT_PRED_FORMAT2(AssertSumIsEven, 2, 3);  // Fails
}
```

### Using `EXPECT_THAT` with Matchers

```cpp
#include <gmock/gmock.h>
using ::testing::StartsWith;

TEST(StringTest, PrefixCheck) {
  std::string str = "Hello, world!";
  EXPECT_THAT(str, StartsWith("Hello"));
}
```

---

## 10. Related Documentation & Next Steps

- [Assertions Reference](reference/assertions.md) - Comprehensive API documentation.
- [Matchers Reference](reference/matchers.md) - Details on matchers used with `EXPECT_THAT`.
- [GoogleTest Primer](primer.md) - Getting started with writing tests.
- [Advanced GoogleTest Topics](docs/advanced.md) - Deeper insights into assertions and test lifecycle.
- [Mocking Reference](docs/reference/mocking.md) - Integrating with GoogleMock for mocking APIs.

Use this page as a foundational guide to mastering test assertions that clearly communicate your verification intent and provide detailed diagnostics on failure.