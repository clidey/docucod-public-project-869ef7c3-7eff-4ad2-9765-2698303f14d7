---
title: "Writing Effective Assertions"
description: "Learn the most important assertions in GoogleTest, when to use fatal vs. non-fatal failures, and how to define your own custom assertions for domain-specific needs."
---

# Writing Effective Assertions

GoogleTest provides a rich and versatile set of assertion macros that let you verify code behavior effectively. This guide will help you understand the most important assertions, when to use fatal versus non-fatal failures, and how to create custom assertions to tailor verification to your domain-specific needs.

---

## 1. Introduction

Assertions are the building blocks of your tests. They verify that the program behaves as expected and generate informative messages when tests fail. GoogleTest assertions come generally in two variants:

- **`EXPECT_` assertions:** Generate *non-fatal* failures that allow the test function to continue.
- **`ASSERT_` assertions:** Generate *fatal* failures that abort the current function immediately.

Using the right type of assertion is crucial to writing robust, maintainable tests.

---

## 2. When to Use Fatal (`ASSERT_`) vs. Non-Fatal (`EXPECT_`) Assertions

### Fatal Assertions (`ASSERT_*`)
Use fatal assertions when continuing the current test function after failure would produce misleading or cascading failures that are hard to interpret, or when proceeding could cause crashes. For example:

- Verifying an important precondition for subsequent verification.
- Checking that resource initialization succeeded.

When a fatal assertion fails, GoogleTest stops executing the current function, skipping remaining checks to avoid spurious errors.

### Non-Fatal Assertions (`EXPECT_*`)
Use non-fatal assertions when you want to verify multiple independent conditions within a test and see all failures at once, making debugging easier. They do not stop execution and allow subsequent assertions to run.

**Example:** When checking multiple elements of a container, use `EXPECT_EQ` to verify each element. That way, you learn about all discrepancies in a single run.


---

## 3. Commonly Used Assertions

### Boolean Conditions

- `EXPECT_TRUE(condition)` / `ASSERT_TRUE(condition)` - succeeds if `condition` is true.
- `EXPECT_FALSE(condition)` / `ASSERT_FALSE(condition)` - succeeds if `condition` is false.

### Equality and Comparison Assertions

- `EXPECT_EQ(val1, val2)` / `ASSERT_EQ(val1, val2)` - expects `val1 == val2`.
- `EXPECT_NE(val1, val2)` / `ASSERT_NE(val1, val2)` - expects `val1 != val2`.
- `EXPECT_LT(val1, val2)` / `ASSERT_LT(val1, val2)` - expects `val1 < val2`.
- `EXPECT_LE(val1, val2)` / `ASSERT_LE(val1, val2)` - expects `val1 <= val2`.
- `EXPECT_GT(val1, val2)` / `ASSERT_GT(val1, val2)` - expects `val1 > val2`.
- `EXPECT_GE(val1, val2)` / `ASSERT_GE(val1, val2)` - expects `val1 >= val2`.

**Note:** When comparing C-strings use `EXPECT_STREQ` or `EXPECT_STRNE` instead of `EXPECT_EQ` and `EXPECT_NE` to compare contents rather than pointer addresses.

### String Assertions

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)` - expects C strings to be equal.
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)` - expects C strings to not be equal.
- Case-insensitive variants: `EXPECT_STRCASEEQ`, `EXPECT_STRCASENE`.

### Floating-Point Assertions

Floating-point values should be compared with specialized assertions due to rounding errors.

- `EXPECT_FLOAT_EQ(val1, val2)` / `ASSERT_FLOAT_EQ(val1, val2)` - for `float` approximate equality.
- `EXPECT_DOUBLE_EQ(val1, val2)` / `ASSERT_DOUBLE_EQ(val1, val2)` - for `double` approximate equality.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)` - checks absolute difference within `abs_error`.

### Exception Assertions (requires exceptions enabled)

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW` - expects that `statement` throws `exception_type`.
- `EXPECT_ANY_THROW` / `ASSERT_ANY_THROW` - expects any exception is thrown.
- `EXPECT_NO_THROW` / `ASSERT_NO_THROW` - expects no exception thrown.

### Explicit Success and Failure

- `SUCCEED()` - documents a success condition explicitly.
- `FAIL()` - generates a fatal failure immediately (must be in functions returning `void`).
- `ADD_FAILURE()` - generates a non-fatal failure allowing continued execution.

---

## 4. Advanced Assertions for Improved Debugging

### `EXPECT_THAT(value, matcher)` and Custom Matchers

Use `EXPECT_THAT` when you want to apply rich predicates (matchers) to values for expressive assertions and detailed failure messages.

Example:

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
EXPECT_THAT(my_vector, ElementsAre(1, 2, 3));
```

You can define your own matchers for complex domain-specific criteria (see [Defining Custom Matchers](../gmock_cook_book.md#CustomMatcherClass)).

### Predicate Assertions

- `EXPECT_PREDn` - assert a predicate returns true with up to 5 arguments.
- `EXPECT_PRED_FORMATn` - more flexible; allows custom formatted error messages.

These are useful when you want to test a Boolean condition that includes some logic and want to show values in error messages.

Example:

```cpp
bool IsPrime(int n) { ... }
EXPECT_PRED1(IsPrime, value);
```

### Skipping Tests

`GTEST_SKIP() << "optional reason";` can be used to skip tests conditionally.

---

## 5. Creating Custom Assertions

When none of the built-in assertions or matchers fit, define your own custom assertion functions or matcher classes that return `testing::AssertionResult` or implement the matcher interface.

Example of a predicate returning `AssertionResult`:

```cpp
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is odd";
}
```

Use it as:

```cpp
EXPECT_TRUE(IsEven(value)) << "Value must be even";
```

Custom matchers can also be written using the `MATCHER` or `MATCHER_P` macros to integrate seamlessly with `EXPECT_THAT`.

---

## 6. Practical Tips and Best Practices

- Choose between fatal and non-fatal assertions based on whether the rest of the test depends on the success of the check.
- Use `EXPECT_THAT` with matchers to write expressive, readable tests.
- For floating-point values, avoid equality comparisons; use appropriate near-equality assertions.
- When comparing pointers, make sure you understand if pointer equality or object equality is desired.
- Stream helpful messages in assertions to clarify failures.
- Use `ASSERT_*` for preconditions to avoid cascading failures and crashes.
- Avoid overly strict expectations to reduce test brittleness.
- Use parameterized and typed tests where applicable for thorough testing.

---

## 7. Example: Writing Tests with Proper Assertions

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::StartsWith;

test
class MathUtils {
 public:
  static int Square(int n) { return n * n; }
};

TEST(MathUtilsTest, SquareReturnsCorrectValue) {
  int value = 5;

  // Check that Square of 5 is 25
  EXPECT_EQ(MathUtils::Square(value), 25) << "Square calculation failed";

  // Check a complex condition with predicate
  EXPECT_PRED1([](int n){ return n % 2 == 0; }, MathUtils::Square(value)) << "Result not even";
}

TEST(StringTest, StartsWithCorrectPrefix) {
  std::string s = "Hello, World!";

  EXPECT_THAT(s, StartsWith("Hello"));
}

TEST(FloatingTest, ApproximatelyEqual) {
  double a = 0.1 * 10;
  double b = 1.0;

  // Use near-equality assertion
  EXPECT_NEAR(a, b, 1e-9);
}

TEST(ExceptionTest, ThrowsWhenDividingByZero) {
#ifdef EXCEPTIONS_ENABLED
  EXPECT_THROW({ int x = 1 / 0; }, std::exception);
#else
  GTEST_SKIP() << "Exceptions not enabled.";
#endif
}
```

---

## 8. Troubleshooting and Common Pitfalls

- **Assertion placement:** Fatal assertions (`ASSERT_*`) can only be used inside `void` functions; otherwise, compilation errors occur.
- **Over-specification:** Avoid putting too many expectations which make tests brittle.
- **Using matchers incorrectly:** Ensure that argument types match matcher expectations; otherwise, compile errors or runtime errors might occur.
- **Misusing `EXPECT_CALL` and `ON_CALL`:** Be sure to set expectations before exercising your mocks.
- **Assertions inside loops:** Beware that repeating an expectation in a loop may lead to unexpected failures due to sticky expectations.

---

## 9. Next Steps & Related Content

- Learn about [Mocking and Setting Expectations](guides/core-testing-workflows/mocking-and-expectations) to combine assertions with mock verifications.
- Dive into [Using Matchers and Actions](guides/core-testing-workflows/using-matchers-and-actions) for advanced assertion logic.
- Explore [Writing and Managing Death Tests](guides/advanced-usage-and-optimization/death-tests) for assertions that expect program termination.
- Review the [Assertions Reference](reference/assertions.md) for a complete list of available assertion macros.


---

## References

- [Assertions Reference](reference/assertions.md)
- [GoogleTest Primer](guides/getting-started/primer)
- [gMock Cookbook](docs/gmock_cook_book.md#NewMatchers) for custom matchers
- [Matchers Reference](reference/matchers.md)

---

Feel confident choosing, applying, and extending GoogleTest assertions to create robust, informative, and maintainable tests.