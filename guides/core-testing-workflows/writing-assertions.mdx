---
title: "Writing and Using Assertions"
description: "Explains the full range of assertion macros provided by GoogleTest, demonstrates their use in verifying code behavior, and highlights when and how to use user-defined assertions for better diagnostics."
---

# Writing and Using Assertions

This page explains the full range of assertion macros provided by GoogleTest, demonstrates their use in verifying code behavior, and highlights when and how to use user-defined assertions for better diagnostics.

---

## 1. Understanding Assertions in GoogleTest

### What Assertions Do
Assertions are the fundamental verification tools that enable you to confirm expected code behavior during tests. GoogleTest provides a rich set of macros that help you test boolean conditions, compare values, handle exceptions, verify floating-point numbers, and more.

### Types of Assertions
Each assertion macro has two variants:
- `EXPECT_`: generates a *nonfatal* failure and lets the test continue.
- `ASSERT_`: generates a *fatal* failure and aborts the current function immediately.

Use `EXPECT_` if you want to check multiple conditions in a test and report all failures, and `ASSERT_` when further execution after a failure makes no sense.

---

## 2. Practical Guide to Using Assertions

### Explicit Success and Failure
- **SUCCEED()**: Generates a success for documentation or control flow purposes. It does not make the whole test succeed.
- **FAIL()**: Generates a fatal failure and aborts the current function. Useful when execution should never reach a point.
- **ADD_FAILURE()** and **ADD_FAILURE_AT(file, line)**: Generate nonfatal failure messages at the current or specified location.

**Example: Using FAIL() in switch-case**
```cpp
switch (state) {
  case STATE_ONE:
    // ... checks ...
    break;
  case STATE_TWO:
    // ... checks ...
    break;
  default:
    FAIL() << "Unhandled state";
}
```

### Boolean Condition Assertions
- `EXPECT_TRUE(condition)` and `ASSERT_TRUE(condition)`: Check if a condition is true.
- `EXPECT_FALSE(condition)` and `ASSERT_FALSE(condition)`: Check if a condition is false.


### Comparing Values
GoogleTest provides a comprehensive set of macros to check equality and relational properties:

| Macro         | Description                         | Example                              |
|---------------|-----------------------------------|------------------------------------|
| `EXPECT_EQ`   | Checks `val1 == val2`              | `EXPECT_EQ(x, 5);`                  |
| `EXPECT_NE`   | Checks `val1 != val2`              | `EXPECT_NE(pointer, nullptr);`     |
| `EXPECT_LT`   | Checks `val1 < val2`               | `EXPECT_LT(a, b);`                  |
| `EXPECT_LE`   | Checks `val1 <= val2`              | `EXPECT_LE(a, b);`                  |
| `EXPECT_GT`   | Checks `val1 > val2`               | `EXPECT_GT(b, a);`                  |
| `EXPECT_GE`   | Checks `val1 >= val2`              | `EXPECT_GE(b, a);`                  |

*Note:* When comparing C-strings, use `EXPECT_STREQ` and `EXPECT_STRNE` to compare contents, not pointer addresses.

### String Assertions
- `EXPECT_STREQ(str1, str2)` and `ASSERT_STREQ`: Verify C strings’ equality.
- `EXPECT_STRNE` and `ASSERT_STRNE`: Verify C strings’ inequality.
- Case-insensitive variants: `EXPECT_STRCASEEQ` and `EXPECT_STRCASENE`.

### Floating-Point Comparisons
Due to rounding errors, floating-point comparisons require tolerance:
- `EXPECT_FLOAT_EQ` and `ASSERT_FLOAT_EQ`: Check approximate equality for `float` values.
- `EXPECT_DOUBLE_EQ` and `ASSERT_DOUBLE_EQ`: For `double` values.
- `EXPECT_NEAR(val1, val2, abs_error)`: Verify that values are within an absolute error bound.


### Exception Assertions (if exceptions enabled)
- `EXPECT_THROW(statement, exception_type)`: Checks that code throws a specific exception.
- `EXPECT_ANY_THROW(statement)`: Checks that code throws any exception.
- `EXPECT_NO_THROW(statement)`: Checks that code does not throw.

### Predicate Assertions
These enable complex condition checks with improved failure messages:
- `EXPECT_PRED1(pred, val1)` through `EXPECT_PRED5(pred, val1, ..., val5)` evaluate predicates with 1 to 5 arguments.
- `EXPECT_PRED_FORMAT*` variants let you define custom failure message formatting.

Example:
```cpp
bool IsPrime(int n); // user defined
EXPECT_PRED1(IsPrime, 17); // Assert 17 is prime
```

### Explicit Use of Matchers with `EXPECT_THAT`
The powerful `EXPECT_THAT(value, matcher)` macro integrates GoogleMock matchers to provide expressive and extensible assertions.

Example:
```cpp
EXPECT_THAT(str, testing::StartsWith("Hello"));
EXPECT_THAT(numbers, testing::ElementsAre(1, 2, 3));
```

Matchers enable writing assertions that read like English and print detailed diagnostics on failure.

---

## 3. Writing Custom Assertions

Sometimes built-in assertions are not enough and you need to create custom, reusable assertions.

### How to Write a Custom Assertion Function
Your assertion function should return a `testing::AssertionResult` object.

Example:
```cpp
#include <gtest/gtest.h>

// Checks if a number is even.
testing::AssertionResult IsEven(int n) {
  if (n % 2 == 0) return testing::AssertionSuccess();
  return testing::AssertionFailure() << n << " is not even";
}

TEST(CustomAssertionTest, CheckEven) {
  EXPECT_TRUE(IsEven(4));  // Passes
  EXPECT_TRUE(IsEven(7));  // Fails with message: 7 is not even
}
```

### Using Predicate-Formatter Assertions
You can integrate these with `EXPECT_PRED_FORMAT1` and friends to get detailed failure messages that include the expressions.

Example:
```cpp
TEST(CustomAssertionTest, UsingPredFormat) {
  EXPECT_PRED_FORMAT1(IsEven, 5);  // Shows expression and failure message
}
```

---

## 4. Best Practices and Tips

- Use `EXPECT_` when you want to continue running the test after a failure and `ASSERT_` when the failure should abort the test immediately.
- Keep failure messages descriptive and meaningful by streaming messages into assertions.
- Prefer `EXPECT_THAT` with matchers for expressive tests and better diagnostics.
- When comparing floating-point numbers, use the specialized macros to handle rounding errors.
- Use custom predicates and assertions to clarify complex conditions and enhance maintainability.
- Be careful with exceptions: enable exception support in your build environment before using exception assertions.

---

## 5. Troubleshooting Common Issues

### Assertion Not Firing When Expected
- Ensure the expression inside the assertion macro evaluates as expected.
- Remember `EXPECT_TRUE(expression)` expects the expression to be true, so verify your test logic accordingly.

### Comparing C Strings Incorrectly
- Using `EXPECT_EQ` on C-strings compares pointer addresses, not string contents. Use `EXPECT_STREQ` for content comparison.

### Floating-Point Comparisons Fail Because of Rounding
- Use `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, or `EXPECT_NEAR` instead of exact equality checks.

### Tests Aborting Prematurely
- Check if you are using `ASSERT_` macros that abort on failure.
- Keep in mind control flow changes due to assertions.

### Exceptions Not Caught
- Exception assertions require builds with exceptions enabled.
- Check compiler flags ensuring exceptions are not disabled.

---

## 6. Summary of Common Assertion Macros

| Category                  | Macros                                  | Description                                     |
|---------------------------|----------------------------------------|-------------------------------------------------|
| Explicit Success/Failure  | `SUCCEED()`, `FAIL()`, `ADD_FAILURE()` | Manual pass/fail signaling                     |
| Boolean checks            | `EXPECT_TRUE/FALSE`, `ASSERT_TRUE/FALSE` | Verify boolean expressions                      |
| Equality/Inequality       | `EXPECT_EQ/NE` and `ASSERT_EQ/NE`        | Compare values                                  |
| Relational                | `EXPECT_LT/LE/GT/GE`                     | Compare ordering                               |
| String equality           | `EXPECT_STREQ/STRNE`, case insensitive | C-string content comparison                     |
| Floating-point comparison | `EXPECT_FLOAT_EQ`, `EXPECT_DOUBLE_EQ`, `EXPECT_NEAR` | Approximate numeric comparison               |
| Exceptions                | `EXPECT_THROW`, `EXPECT_ANY_THROW`, `EXPECT_NO_THROW` | Exception handling                      |
| Predicates                | `EXPECT_PREDx`, `EXPECT_PRED_FORMATx`    | Custom predicate checks                         |
| Matchers                  | `EXPECT_THAT`                             | Advanced matching with matcher objects          |

---

## 7. Next Steps & Related Content

- Explore the [Matchers Reference](https://google.github.io/googletest/reference/matchers.html) for expressive assertions using `EXPECT_THAT`.
- Learn about [Writing Custom Matchers and Actions](https://google.github.io/googletest/gmock_cook_book.html#WritingNewMatchersQuickly).
- For exception handling, ensure your build environment supports exceptions.
- Incorporate your assertions with Test Fixtures and Parameterized Tests for advanced test structuring.

---