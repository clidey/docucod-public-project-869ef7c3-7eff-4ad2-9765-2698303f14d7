---
title: "Using Matchers Effectively"
description: "Understand how to use built-in and custom matchers for expressive, readable tests. This tutorial covers fundamental matcher concepts and demonstrates their use in both assertions and mocks."
---

# Using Matchers Effectively

This guide helps you master the use of built-in and custom matchers in GoogleTest and GoogleMock to write expressive, readable, and maintainable tests. You will learn fundamental matcher concepts and see how to apply matchers both in test assertions and mock expectations.

---

## 1. Understanding Matcher Basics

Matchers let you specify the expected properties of test values or mock function arguments in a declarative, readable way. Rather than writing complex Boolean expressions, you use matchers to describe "what" a value should satisfy.

- Matchers can be polymorphic (usable with multiple types) or monomorphic (type-specific).
- They provide rich, human-friendly failure messages explaining mismatches.
- Built-in matchers cover comparisons, containers, strings, pointers, tuples, and more.

**Example:** Verifying a value is greater than 5 using a matcher â€“

```cpp
#include <gmock/gmock.h>
using ::testing::Gt;
...
EXPECT_THAT(value, Gt(5));
```

This reads as "expect that value is greater than 5" and gives clear messages on failure.

<Check>
Always prefer matchers over raw Boolean assertions because they improve test clarity and diagnostics.
</Check>

---

## 2. Using Matchers in Assertions and Mocks

### Assertions with Matchers

Use the `EXPECT_THAT` and `ASSERT_THAT` macros to assert that a value satisfies a matcher:

```cpp
EXPECT_THAT(actual_value, matcher);
ASSERT_THAT(actual_value, matcher);
```

For example, check that a string starts with "Hello":

```cpp
EXPECT_THAT(my_string, StartsWith("Hello"));
```

### Mocking with Matchers

When setting expectations on mock methods, use matchers to specify argument constraints:

```cpp
EXPECT_CALL(mock_object, MethodName(matcher1, matcher2));
```

For instance, expecting a call where the first int argument is positive:

```cpp
EXPECT_CALL(mock_foo, Bar(Gt(0)));
```

If you want to match any argument, use the wildcard matcher `_`:

```cpp
EXPECT_CALL(mock_foo, Bar(_, Ne(nullptr)));
```

---

## 3. Built-in Matchers Overview

### Comparison Matchers

| Matcher  | Description                   |
| -------- | -----------------------------|
| `Eq(x)`  | is equal to `x`               |
| `Ne(x)`  | is not equal to `x`           |
| `Lt(x)`  | is less than `x`              |
| `Le(x)`  | is less or equal to `x`       |
| `Gt(x)`  | is greater than `x`           |
| `Ge(x)`  | is greater or equal to `x`    |

Example:

```cpp
EXPECT_THAT(number, AllOf(Ge(0), Le(100)));
```

### String Matchers

| Matcher             | Description                              |
|---------------------|------------------------------------------|
| `StrEq(s)`          | equals string `s` (case-sensitive)       |
| `StrCaseEq(s)`      | equals string `s` (case-insensitive)     |
| `HasSubstr(sub)`    | contains substring `sub`                  |
| `StartsWith(prefix)`| starts with `prefix`                      |
| `EndsWith(suffix)`  | ends with `suffix`                        |

Example:

```cpp
EXPECT_THAT(my_string, HasSubstr("needle"));
```

### Container Matchers

| Matcher               | Description                                              |
| --------------------- | --------------------------------------------------------|
| `ElementsAre(...)`    | container has elements matching provided matchers in order |
| `UnorderedElementsAre(...)` | container has elements matching matchers, any order    |
| `Contains(element)`   | container contains at least one element                    |
| `SizeIs(matcher)`     | container size matches given matcher                       |

Example:

```cpp
EXPECT_THAT(vec, ElementsAre(1, Gt(2), _));
EXPECT_THAT(set, Contains(42));
```

### Pointer and Optional Matchers

- `IsNull()` matches null pointers.
- `NotNull()` matches non-null pointers.
- `Pointee(matcher)` matches pointer to a value that satisfies matcher.
- `Optional(matcher)` matches engaged optional values satisfying matcher.

Example:

```cpp
EXPECT_CALL(mock, Func(Pointee(Ge(0))));
```

---

## 4. Combining and Composing Matchers

### Logical Combinators

Combine multiple matchers with:

- `AllOf(m1, m2, ...)`: all matchers must match
- `AnyOf(m1, m2, ...)`: any matcher matches
- `Not(m)`: negates matcher

Example:

```cpp
EXPECT_THAT(x, AllOf(Gt(0), Lt(10))); // 0 < x < 10
EXPECT_THAT(name, AnyOf(StartsWith("Dr."), EndsWith("PhD")));
EXPECT_THAT(val, Not(Eq(5)));
```

### Tuple Matching

Use `Pair(m1, m2)` to match `std::pair` or `std::tuple` elements.

Example:

```cpp
EXPECT_THAT(p, Pair(Ge(0), HasSubstr("foo")));
```

### Field and Property Matchers

- `Field(&Class::member, matcher)`: match member variable
- `Property(&Class::getter, matcher)`: match return value of const getter method

Example:

```cpp
EXPECT_THAT(foo_obj, Field(&Foo::id, Ge(100)));
EXPECT_THAT(bar_obj, Property(&Bar::GetName, StartsWith("John")));
```

---

## 5. Writing Custom Matchers

When built-in matchers don't meet your needs, define your own using `MATCHER` macros or by implementing the matcher interface.

### Simple Example Using `MATCHER`

```cpp
MATCHER(IsEven, "checks if a number is even") {
  return (arg % 2) == 0;
}

EXPECT_THAT(number, IsEven());
```

You can provide custom descriptions and failure explanations by streaming into the hidden `result_listener`.

### Parameterized Matchers

Use `MATCHER_P` and variants for matchers with parameters:

```cpp
MATCHER_P(IsDivisibleBy, divisor, "checks divisibility") {
  if ((arg % divisor) == 0) return true;
  *result_listener << "the remainder is " << (arg % divisor);
  return false;
}

EXPECT_THAT(10, IsDivisibleBy(3));
```

---

## 6. Best Practices and Tips

- Use `EXPECT_THAT` for expressive assertions with matchers rather than complex Boolean expressions.
- Prefer `ON_CALL` to specify default behaviors of mocks and use `EXPECT_CALL` only when you want to verify a call actually occurs.
- Combine matchers logically using `AllOf`, `AnyOf`, and `Not` to precisely express expectations.
- Name your custom matchers clearly to help generate meaningful error messages.
- For matching container contents, specify order with `ElementsAre` and ignore order with `UnorderedElementsAre`.
- To match calls with complex argument relations, use `.With()` clause in `EXPECT_CALL` with multi-argument matchers.
- Avoid side-effects inside matchers since they can be invoked multiple times unpredictably.
- Leverage `Pointee` and `Field` matchers to inspect member values or pointed-to values naturally.

<Tip>
If unprotected commas cause compilation error in `MOCK_METHOD`, wrap return or argument types containing commas in parentheses or use type aliases.
</Tip>

<Tip>
For verifying member states or multiple aspects of an object, compose matchers with `AllOf` and use `Field` or `Property` matchers.
</Tip>

<Tip>
Use `SafeMatcherCast<T>(m)` when you need to cast a matcher safely between types, for example, to loosen type strictness in expectations.
</Tip>

---

## 7. Troubleshooting Common Issues

### Compilation Errors in `MOCK_METHOD`

- Occur if the argument list has unprotected commas.
- Fix by wrapping types with commas in parentheses or defining type aliases.

### Matcher Type Mismatch

- Use `SafeMatcherCast` or explicitly specify matcher types to resolve compiler errors.

### Uninteresting Calls Warnings in Mocks

- If you want to suppress warnings about uninteresting calls, use `NiceMock`.
- To make uninteresting calls cause failures, use `StrictMock`.

### Matcher Side-Effects

- Ensure matchers never change program state or have side-effects.
- Use matchers only to describe expected properties.

---

## 8. Additional Resources & Next Steps

- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html): Detailed descriptions of all built-in matchers.
- [Mocking Basics](guides/getting-started-testing/mocking-basics.mdx): Learn how to define and set expectations on mock methods.
- [gMock Cookbook](https://google.github.io/googletest/gmock_cook_book.html): Recipes including custom matcher creation.
- [GoogleTest Primer](docs/primer.md): Overview of assertions and basic test writing.

Explore these topics next to deepen your testing proficiency:
- Writing custom matchers beyond simple macro-based definitions.
- Multi-argument and multi-field matching techniques.
- Combining matchers in complex test scenarios.

---

For comprehensive information on `EXPECT_THAT`, matcher types, and creating custom matchers, always consult the official [GoogleTest Matchers Reference](reference/matchers.md) and [gMock Mocking Reference](docs/reference/mocking.md).


---