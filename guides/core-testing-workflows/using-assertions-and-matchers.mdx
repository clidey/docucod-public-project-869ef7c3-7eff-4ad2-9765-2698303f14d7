---
title: "Using Assertions and Matchers"
description: "Master the variety of assertions and matchers provided by GoogleTest and GoogleMock to express expectations, compare values, and create readable, precise tests. Learn common patterns and how to apply them effectively."
---

# Using Assertions and Matchers

## Overview

This guide teaches you how to use the rich set of assertions and matchers provided by GoogleTest and GoogleMock to write expressive, maintainable, and precise tests. You will learn how to verify conditions, compare complex data, use powerful matchers, and combine them with mock objects to control and verify test behavior effectively.

## 1. Assertions in GoogleTest

Assertions are the foundation of test verification in GoogleTest. They check conditions and report success or failure.

### 1.1 Basic Assertions

- `EXPECT_TRUE(condition)`, `ASSERT_TRUE(condition)`: Verify the condition is true.
- `EXPECT_FALSE(condition)`, `ASSERT_FALSE(condition)`: Verify the condition is false.
- `EXPECT_EQ(val1, val2)`, `ASSERT_EQ(val1, val2)`: Verify `val1 == val2`.
- `EXPECT_NE(val1, val2)`, `ASSERT_NE(val1, val2)`: Verify `val1 != val2`.
- `EXPECT_LT(val1, val2)`, `ASSERT_LT(val1, val2)`: Verify `val1 < val2`.
- `EXPECT_LE(val1, val2)`, `ASSERT_LE(val1, val2)`: Verify `val1 <= val2`.
- `EXPECT_GT(val1, val2)`, `ASSERT_GT(val1, val2)`: Verify `val1 > val2`.
- `EXPECT_GE(val1, val2)`, `ASSERT_GE(val1, val2)`: Verify `val1 >= val2`.

### 1.2 String Assertions

Specialized macros for comparing C strings with content checks:

- `EXPECT_STREQ(str1, str2)`, `ASSERT_STREQ(str1, str2)`: Strings are equal.
- `EXPECT_STRNE(str1, str2)`, `ASSERT_STRNE(str1, str2)`: Strings are unequal.
- `EXPECT_STRCASEEQ(str1, str2)`, `ASSERT_STRCASEEQ(str1, str2)`: Case-insensitive equality.
- `EXPECT_STRCASENE(str1, str2)`, `ASSERT_STRCASENE(str1, str2)`: Case-insensitive inequality.

### 1.3 Floating-Point Assertions

Floating-point comparison is tricky due to rounding errors:

- `EXPECT_FLOAT_EQ(val1, val2)`, `ASSERT_FLOAT_EQ(val1, val2)`: Compares floats approximately.
- `EXPECT_DOUBLE_EQ(val1, val2)`, `ASSERT_DOUBLE_EQ(val1, val2)`: Compares doubles approximately.
- `EXPECT_NEAR(val1, val2, abs_error)`, `ASSERT_NEAR(val1, val2, abs_error)`: Allow controlled absolute error.

### 1.4 Failure and Success Macros

- `FAIL()`: Immediately marks the test as failed and exits the current function.
- `SUCCEED()`: Marks an explicit success point (usually not needed).
- `ADD_FAILURE()`: Generates a nonfatal failure allowing tests to continue.

### 1.5 Using Matchers in Assertions

GoogleTest supports matcher-based assertions for expressive checks:

```cpp
EXPECT_THAT(value, matcher);
ASSERT_THAT(value, matcher);
```

Matchers allow writing assertions that read like English and produce detailed failure messages.

## 2. Understanding Matchers in GoogleMock

Matchers specify how to verify that function or method arguments meet your expectations. They are powerful predicates that can express simple and complex conditions.

### 2.1 Basic Matchers

- `_` - Matches any value (wildcard).
- `Eq(value)` or just `value` - Matches exact equality.
- `Ne(value)` - Not equal.
- Comparison: `Lt()`, `Le()`, `Gt()`, `Ge()`

### 2.2 Combining Matchers

You can compose multiple matchers for complex conditions:

- `AllOf(m1, m2, ...)` - All must match.
- `AnyOf(m1, m2, ...)` - At least one must match.
- `Not(m)` - Negates matcher.

### 2.3 Matchers on Container Elements

Use container-aware matchers:

- `ElementsAre(m1, m2, ...)` - Matches a container with elements matching m1, m2 in order.
- `UnorderedElementsAre(m1, m2, ...)` - Elements can appear in any order.
- `ElementsAreArray()` variants can match arrays or other containers.

### 2.4 Advanced Matchers

- `Field(&Class::field, m)` - Matches a struct/class by matching a field.
- `Property(&Class::method, m)` - Matches a class whose method’s return value matches m.
- `Pointee(m)` - Matches the value pointed to by a pointer or smart pointer.

### 2.5 Custom Matchers

You can define your own matchers using `MATCHER`, `MATCHER_P`, or by implementing matcher classes for reuse and clarity.

Example:

```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
EXPECT_THAT(x, IsDivisibleBy7());
```

### 2.6 Matcher Usage Tips

- Use `_` liberally to avoid overly brittle tests.
- Combine matchers to focus tests on behavior critical to correctness.
- Avoid side effects inside matchers, as they may be evaluated multiple times.

## 3. Setting Expectations with Assertions and Matchers

GoogleMock uses expectations that combine matchers to test interactions with mock objects.

### 3.1 Using `EXPECT_CALL` with Matchers

Define expectations on mock methods, specifying argument matchers and behaviors. For example:

```cpp
EXPECT_CALL(mock_obj, Foo(5));
EXPECT_CALL(mock_obj, Bar(Ge(10), _));
EXPECT_CALL(mock_obj, Baz(AllOf(Lt(100), Ne(42))));
```

### 3.2 Parameterless Expectations

If you don't care about arguments, omit them in `EXPECT_CALL`: 

```cpp
EXPECT_CALL(mock_obj, MethodName).Times(2);
```

Only usable with non-overloaded methods.

### 3.3 Using Matchers in `ON_CALL`

Use `ON_CALL` to provide default behavior for mock methods without setting strict call count expectations:

```cpp
ON_CALL(mock_obj, MethodName(_)).WillByDefault(Return(42));
```

This ensures that calls not covered by `EXPECT_CALL` get defined behavior.

## 4. Common Assertion and Matcher Patterns

### 4.1 Verifying Exact Calls

```cpp
EXPECT_CALL(foo, Bar(42));
foo.Bar(42);  // Passes
foo.Bar(43);  // Fails
```

### 4.2 Ignoring Arguments

Use `_` to ignore arguments you don't care about:

```cpp
EXPECT_CALL(foo, SetValue(_, _));  // Matches any arguments.
```

### 4.3 Using Value Matchers

```cpp
EXPECT_CALL(foo, Process(Ge(0), Lt(10)));
```

### 4.4 Ordering Calls

Use `InSequence` to verify call order:

```cpp
{
  InSequence s;
  EXPECT_CALL(foo, Init());
  EXPECT_CALL(foo, Run());
  EXPECT_CALL(foo, Cleanup());
}
```

### 4.5 Partial Orders

Use `EXPECT_CALL(...).After(...)` or `.InSequence(...)` for complex ordering.

### 4.6 Verifying Calls with Side Effects

Combine matchers with actions to test side effects using `SAVE_ARG`, `SET_ARG_POINTEE`, etc.

## 5. Troubleshooting & Best Practices

### 5.1 Common Issues

- **Unmatched calls:** Usually caused by omitting or misusing matchers in expectations.
- **Too strict matchers:** Over-specifying arguments can make tests brittle.
- **Unexpected calls:** Verify if `EXPECT_CALL` covers all expected invocations or use catch-all with `_`.
- **Uninteresting calls warnings:** Use `NiceMock` to suppress.

### 5.2 Best Practices

- Use `ON_CALL` to establish default mock behavior.
- Use `EXPECT_CALL` sparingly, only when verifying interaction.
- Match arguments only as precise as necessary.
- Use `InSequence` only when call order is crucial.

### 5.3 Performance

Minimize unnecessary expectations and complex matchers to keep tests fast.

### 5.4 Scoping and Verification

- Mocks verify expectations on destruction.
- Use `Mock::VerifyAndClearExpectations()` to verify early if needed.

## 6. Examples

### 6.1 Basic Assertion + Matcher Example

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

using ::testing::Return;
using ::testing::_;

class MockFoo {
 public:
  MOCK_METHOD(int, GetValue, (), ());
  MOCK_METHOD(void, SetValue, (int v), ());
};

TEST(FooTest, BasicTest) {
  MockFoo foo;

  ON_CALL(foo, GetValue()).WillByDefault(Return(10));

  EXPECT_CALL(foo, SetValue(42));

  EXPECT_EQ(foo.GetValue(), 10);
  foo.SetValue(42);  // Correctly matches expectation
}
```

### 6.2 Matcher Composition Example

```cpp
EXPECT_CALL(mock_obj, Process(
    AllOf(Ge(10), Lt(100))));
```

### 6.3 Ordering Calls Example

```cpp
using ::testing::InSequence;

{
  InSequence seq;
  EXPECT_CALL(mock, Start());
  EXPECT_CALL(mock, Run(_)).Times(3);
  EXPECT_CALL(mock, Finish());
}
```

### 6.4 Catch-all Expectation Example

```cpp
EXPECT_CALL(mock, Foo(_)).Times(::testing::AnyNumber());
EXPECT_CALL(mock, Foo(42)).WillOnce(Return(true));
```

### 6.5 Using Custom Matcher

```cpp
MATCHER(IsEven, "is an even number") {
  return (arg % 2) == 0;
}

EXPECT_CALL(mock, Compute(IsEven()));
```

## 7. Additional Resources

- [Matchers Reference](reference/matchers.md) — Comprehensive list of built-in matchers.
- [Assertions Reference](docs/reference/assertions.md) — Detailed test assertions.
- [gMock for Dummies](docs/gmock_for_dummies.md) — Introductory guide to using gMock.
- [gMock Cheat Sheet](docs/gmock_cheat_sheet.md) — Quick reference for mocking.

## Summary

This guide equips you to master assertions and matchers in GoogleTest and GoogleMock, enabling test verification with precision and clarity. By learning to use built-in assertions, compose matchers, and set expectations on mock methods, you will write robust, expressive tests that clearly communicate intent and catch regression errors efficiently.

---

<Tip>
For best results, apply matchers only as strictly as necessary to avoid brittle tests, and leverage `ON_CALL` to specify default behaviors separate from call count verification.
</Tip>

<Tip>
Use `EXPECT_THAT` with matchers to write readable assertions on complex objects and containers.
</Tip>

<Tip>
Control test verbosity and leverage GoogleMock’s diagnostic flags to troubleshoot matching and call ordering issues.
</Tip>
