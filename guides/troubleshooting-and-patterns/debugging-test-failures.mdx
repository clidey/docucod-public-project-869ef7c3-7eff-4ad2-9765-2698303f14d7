---
title: "Debugging Test Failures and Output"
description: "Effective techniques for diagnosing failing tests, interpreting GoogleTest output, and using the available logging, assertions, and test filtering options to quickly isolate bugs."
---

# Debugging Test Failures and Output

## Overview

When a test fails, it can sometimes be challenging to understand why it happened. GoogleTest provides rich output messages and logging mechanisms to help you pinpoint the source of the failure quickly. This guide shows you how to interpret GoogleTest output, use logging and assertions effectively, filter tests for focused debugging, and apply proven troubleshooting strategies.

## Understanding GoogleTest Output

GoogleTest test output consists of informative messages that help you identify what went wrong when a test fails.

### Key Elements of Test Output

- **Test Start and End Markers:**
  GoogleTest clearly marks the beginning and end of each test with lines like:
  ```
  [ RUN      ] TestSuiteName.TestName
  [       OK ] TestSuiteName.TestName (10 ms)
  [  FAILED  ] TestSuiteName.TestName (10 ms)
  ```
  This helps you locate each test's results quickly.

- **Failure Messages:**
  When a test assertion fails, GoogleTest prints:
  - The source file and line number where the failure happened.
  - The expected and actual values, if applicable.
  - An optional user-supplied failure message.

  Example:

  ```
  foo_test.cc:45: Failure
  Expected equality of these values:
    actual_value
      Which is: 4
    expected_value
      Which is: 5
  ```

- **Stack Traces:**
  If enabled, GoogleTest can provide stack traces for failures, showing the call chain leading to the failing assertion. This is controlled by the `--gtest_stack_trace_depth` flag.

### Verbosity Levels

Use the `--gtest_verbose` flag to control how much information is shown during test runs:

| Level    | Description                                            |
| -------- | ------------------------------------------------------|
| `info`   | Shows all informational messages, including assertions and mock calls (most verbose). |
| `warning`| Shows warnings and errors (default).                   |
| `error`  | Shows only errors.                                     |

Example to run with info verbosity:

```bash
./my_test --gmock_verbose=info
```

## Interpreting Mock Failures

When using GoogleMock in your tests, you might encounter failures related to mock expectations. GoogleMock provides detailed messages explaining:

- **Expectation Mismatches:** When the actual call arguments don't match expected arguments.
- **Call Count Violations:** Calling more or fewer times than expected.
- **Order Violations:** Calls made out of the expected sequence.

Example error message if a mock method wasn't called as expected:

```text
path/to/my_test.cc:119: Failure
Actual function call count doesn't match this expectation:
Actually: never called;
Expected: called at least once.
```

Enable detailed traces for mock calls with `--gmock_verbose=info` to see call matching details and stack traces.

## Using Assertions and Custom Failure Messages

GoogleTest provides a rich set of assertions to verify your code behavior.

- Use `EXPECT_*` assertions for non-fatal failures (test continues).
- Use `ASSERT_*` assertions for fatal failures (aborts current test).

Example with custom failure message:

```cpp
EXPECT_EQ(x.size(), y.size()) << "Vectors x and y have different lengths";
```

### Helpful Assertions for Debugging

| Assertion         | Purpose                                      |
|-------------------|----------------------------------------------|
| `EXPECT_EQ`       | Check equality of two values                  |
| `EXPECT_TRUE`     | Check a condition is true                      |
| `EXPECT_THROW`    | Verify a piece of code throws an exception    |
| `EXPECT_THAT`     | Check a value using a matcher                  |

Use GoogleMock's matchers with `EXPECT_THAT` to write expressive and readable tests.

## Filtering Tests for Focused Debugging

Sometimes, you want to run a subset of tests while debugging.

- Use the `--gtest_filter` flag to specify which tests to run.

Format:

```bash
--gtest_filter=[positive_pattern][-negative_pattern]
```

Example to run only tests that contain "Factorial":

```bash
./my_test --gtest_filter=*Factorial*
```

Exclude a test:

```bash
./my_test --gtest_filter=-MyTestSuite.TestName
```

Combine inclusion and exclusion:

```bash
./my_test --gtest_filter=MySuite.*-MySuite.TestToExclude
```

This helps to speed up debugging by focusing only on relevant tests.

## Capturing and Examining Test Logs

GoogleTest and GoogleMock emit logs that can be captured for offline analysis.

- Redirect stdout/stderr to files when running tests.
- Use the `--gtest_output=xml:filename.xml` flag to generate structured XML reports.

These reports integrate well with continuous integration and test visualization tools.

## Practical Debugging Tips

- **Check failure messages early:** The first failure message usually contains the root cause.
- **Run failing tests in isolation:** Use test filters to run only failing tests.
- **Use verbose mode:** Enable `--gmock_verbose=info` for detailed mock call diagnostics.
- **Add custom failure messages:** Providing context in failures saves investigation time later.
- **Use assertions wisely:** Prefer `EXPECT_*` to collect multiple failures in one run, use `ASSERT_*` when failing makes further checks meaningless.
- **Review test logs:** Use XML reports or test log files to analyze flaky or intermittent failures.

## Handling Common Failure Scenarios

### Unexpected Mock Function Calls

- Occurs when code calls a mock method not expected by any `EXPECT_CALL`.
- By default, GoogleMock prints a warning.
- To disable warnings, use `NiceMock<T>`.
- To enforce strictness (fail on unexpected calls), use `StrictMock<T>`.
- Use catch-all expectations with `.Times(AnyNumber())` to allow unexpected calls deliberately.

### Mismatched Arguments

- Occurs when the arguments of a call donâ€™t match the expectation.
- Use matchers carefully; use `_` to indicate arguments you wish to ignore.
- Enable verbose mock logs to see why a call didn't match.

### Incorrect Call Order

- Calls expected in sequence can fail if order is violated.
- Use `InSequence` or `Sequence` to enforce call order.
- When testing partial order, use `.After()` clauses or multiple sequences.

### Upper or Lower Bound Violations

- Calling a mock method more times than allowed triggers an error.
- Set `Times(n)` carefully.
- Use `.RetiresOnSaturation()` to retire expectations after saturation.

## Example: Debugging a Failed Expectation

```cpp
TEST(FooTest, ReturnsExpectedValue) {
  MockFoo foo;
  EXPECT_CALL(foo, GetValue())
      .Times(1)
      .WillOnce(Return(42));

  int result = foo.GetValue();
  EXPECT_EQ(result, 40) << "GetValue should return 42";
}
```

If this test fails, GoogleTest will explain the mismatch and the custom message.

## Using GoogleTest with Emacs for Easier Navigation

If you compile and run tests inside Emacs (for example, using `M-x google-compile`),
compile errors and test failures will be hyperlinked.

- Press `<Enter>` on an error line to jump directly to the source.
- Bind keys for easier navigation between failures (e.g., `M-up` and `M-down`).

Add to your `~/.emacs`:

```elisp
(global-set-key "\M-m"  'google-compile)
(global-set-key [M-down] 'next-error)
(global-set-key [M-up]  '(lambda () (interactive) (next-error -1)))
```

## Summary

Mastering test failure messages and output is key to rapid and efficient bug identification. GoogleTest's clear error messages, stack traces, test filtering, and mock diagnostics combine to help you understand and fix failing tests fast. Combine these tools with good assertion practices and careful test design to build robust, maintainable tests.

## Troubleshooting Checklist

- Do your tests run without unexpected mock calls? If not, consider using `NiceMock` or updating `EXPECT_CALL`s.
- Are your expectations too strict (fail often on unrelated changes)? Try loosening them or using matchers like `_`.
- Did you miss specifying the call order when needed? Use `InSequence` or `Sequence` to enforce.
- Are you running tests isolated enough to reproduce failures? Use `--gtest_filter` to focus.
- Is your environment showing full stack traces? Increase `--gtest_stack_trace_depth` if needed.

## Next Steps

- Learn how to [write maintainable mocks](../guides/mocking-best-practices/designing-better-mocks.md).
- Explore advanced debugging in [Debugging Test Failures and Output](this guide).
- Deep dive into [Matchers and Actions](../api-reference/mocking-apis/actions-advanced.md).
- Read the [gMock Cookbook](../docs/gmock_cook_book.md) for recipes on complex mocking scenarios.

---

## References

- [GoogleTest Primer](../docs/primer.md)
- [gMock for Dummies](../docs/gmock_for_dummies.md)
- [gMock Cheat Sheet](../docs/gmock_cheat_sheet.md)
- [Mocking Reference](../docs/reference/mocking.md)


---

# Practical Tools and Commands Summary

```bash
# Run all tests with verbose mock output:
./my_test --gmock_verbose=info

# Run a single test:
./my_test --gtest_filter=TestSuiteName.TestName

# Run tests excluding specific ones:
./my_test --gtest_filter='MySuite.*-MySuite.TestToSkip'

# Generate XML report for CI systems:
./my_test --gtest_output=xml:report.xml

# Increase stack trace depth for failures:
./my_test --gtest_stack_trace_depth=20
```

---

# Diagram: Test Failure Debugging Flow

```mermaid
flowchart TD
  Start[Start Test Run] --> RunTest[Execute a Test]

  RunTest --> CheckAssertions{All Assertions Passed?}

  CheckAssertions -->|Yes| NextTest[Run Next Test]
  CheckAssertions -->|No| ShowFailure[Show Failure Message & Location]

  ShowFailure --> ShowStack[Show Stack Trace (if enabled)]
  ShowStack --> Diagnose[User Reviews Failure Output]

  Diagnose --> Filter[Filter Tests if Needed]
  Filter --> RunTest

  NextTest --> End[All Tests Complete]

  classDef decision fill:#f9f,stroke:#333,stroke-width:2px;
  class CheckAssertions decision;
```
