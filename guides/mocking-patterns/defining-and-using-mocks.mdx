---
title: "Defining and Using Mock Objects"
description: "A practical guide to creating mock classes, specifying expectations on mock methods, and verifying interactions. Includes concrete examples to help you simulate and test code in isolation."
---

# Defining and Using Mock Objects

Create mock classes and objects that simulate real components, allowing you to specify method behavior, set expectations for interactions, and verify these expectations during tests. This guide provides practical steps, examples, and best practices to help you isolate and test code effectively using GoogleMock.

---

## 1. Introduction to Mock Objects

A *mock object* implements the same interface as a real object but enables you to specify and verify interaction expectations with that object. Instead of relying on actual implementations, mocks allow you to simulate, control, and observe the behavior of dependencies in isolation.

This page focuses specifically on **how to define mock classes** with mocked methods and **how to use these mocks** in your tests to set expectations and verify interactions.

<Check>
You must include `#include <gmock/gmock.h>` to access the full mocking features.
</Check>

---

## 2. Creating Mock Classes

### 2.1 Define the Mock Class

Start by deriving a mock class from the interface or base class you want to mock. Use the `MOCK_METHOD` macro to mock each virtual method you need.

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, DoThis, (), (override));
  MOCK_METHOD(int, DoThat, (bool flag), (override));
};
```

- Place `MOCK_METHOD` in the `public` section even if the original methods are protected or private.
- Include qualifiers such as `(const)` or `(override)` as needed.

### 2.2 Handling Constructors

If your interface or base class has constructors with parameters, your mock class should declare implicit constructors or explicitly forward them.

```cpp
class MockBar {
 public:
  explicit MockBar(const std::string& s) : str_(s) {}

  MOCK_METHOD(int, This, (), ());
  MOCK_METHOD(std::string, That, (int, bool), ());

 private:
  std::string str_;
};
```

### 2.3 Avoid Copy Operations

Mocks should be non-copyable to prevent unexpected behavior. Delete copy constructor and assignment operator.

```cpp
private:
  MockFoo(const MockFoo&) = delete;
  MockFoo& operator=(const MockFoo&) = delete;
```

---

## 3. Using Mock Objects in Tests

### 3.1 Import GoogleMock Namespace

For ease of use, bring commonly used symbols into your file:

```cpp
using ::testing::_;            // Wildcard matcher
using ::testing::Return;       // Action to return value
using ::testing::AtLeast;      // Cardinality matcher
```

### 3.2 Create Mock Instances

Mock objects can be instantiated on the stack or heap. For mocks with complex constructors, use the appropriate syntax.

```cpp
MockFoo foo;  // Stack allocation
NiceMock<MockBar> nice_bar("example");  // NiceMock with constructor args
```

### 3.3 Setting Expectations

Use `EXPECT_CALL()` to specify how the mock methods are expected to be called.

```cpp
EXPECT_CALL(foo, DoThis())
    .Times(AtLeast(1))
    .WillOnce(Return());

EXPECT_CALL(foo, DoThat(true))
    .WillRepeatedly(Return(42));
```

- Expectations must be set **before** exercising the code under test that calls the mock.
- If arguments don't matter, use the wildcard matcher `_`.

### 3.4 Setting Default Behavior

Specify default behaviors that apply when no explicit expectations are matched using `ON_CALL()`.

```cpp
ON_CALL(foo, DoThis())
    .WillByDefault(Return());
```

This is useful to suppress warnings or provide fallback behavior.

### 3.5 Executing and Verifying

After exercising code that uses the mock, GoogleMock automatically verifies that all expectations were met when the mock object is destructed. Alternatively, force verification early:

```cpp
ASSERT_TRUE(Mock::VerifyAndClearExpectations(&foo));
```

---

## 4. Mock Strictness Levels

By default, mocks behave as **NaggyMocks**, which warn on uninteresting calls (calls without expectations).

To control uninteresting call behavior, use:

- `NiceMock<T>`: Suppresses warnings on uninteresting calls.
- `NaggyMock<T>`: Prints warnings (default for raw mocks).
- `StrictMock<T>`: Treats uninteresting calls as failures.

Example:

```cpp
NiceMock<MockFoo> nice_mock;
EXPECT_CALL(nice_mock, DoThis());
// No warnings for uninteresting calls
```

---

## 5. Practical Examples

### 5.1 Defining a Simple Mock Class

```cpp
class Foo {
 public:
  virtual ~Foo() = default;
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
};

class MockFoo : public Foo {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
};
```

### 5.2 Using Mock in a Test

```cpp
TEST(PainterTest, DrawsLine) {
  MockFoo turtle;

  EXPECT_CALL(turtle, PenDown()).Times(1);
  EXPECT_CALL(turtle, Forward(100)).Times(1);
  EXPECT_CALL(turtle, PenUp()).Times(1);

  Painter painter(&turtle);
  EXPECT_TRUE(painter.DrawLine(100));
}
```

### 5.3 Using NiceMock to Suppress Warnings

```cpp
NiceMock<MockFoo> nice_turtle;
// No warnings for uninteresting calls
EXPECT_CALL(nice_turtle, PenDown());
...
```

### 5.4 Handling Non-Default Constructible Return Types

If a mock method returns a non-default constructible type, you must specify the behavior explicitly, or an exception will be thrown.

```cpp
EXPECT_CALL(mock_obj, NonDefaultReturn())
    .WillOnce(Return(NonDefaultConstructible(5)));
```

---

## 6. Tips and Best Practices

- Always mock **virtual** methods. Non-virtual methods can't be mocked directly.
- Prefer coding to interfaces. Avoid mocking concrete classes directly to reduce test brittleness.
- Set expectations before exercising the test subject.
- Use `_` wildcard matcher sparingly to avoid brittle argument expectations.
- Use sequences (`InSequence`) to enforce call order if needed.
- Use `RetiresOnSaturation()` to retire expectations after they are met.
- Use `Mock::AllowLeak(&mock_obj);` if your mock will deliberately not be deleted.
- Prefer `ON_CALL()` for common default behavior; use `EXPECT_CALL()` only to set expectations you want to verify.

---

## 7. Troubleshooting Common Issues

### The Real Method is Called Instead of Mock

- Ensure the method is marked `virtual` in the base class.

### Warnings About Uninteresting Calls

- Use `NiceMock<>` to suppress warnings.
- Explicitly set default behaviors with `ON_CALL()` or match all calls with `EXPECT_CALL(mock, Method(_)).Times(AnyNumber())`.

### Mock Object Not Verified

- Verify mock destruction to trigger expectation verification.
- If mocks are dynamically allocated, make sure they are deleted.
- Use `Mock::VerifyAndClearExpectations()` to verify early.

### Compilation Issues with `MOCK_METHOD`

- Wrap complex argument types containing commas in extra parentheses or define type aliases.

---

## 8. Next Steps & Related Content

- **Advanced Mocking Techniques:** Learn about partial mocks, delegating calls, and action customization in [GoogleMock Cookbook](../guides/mocking-patterns/advanced-mocking-features).
- **Matchers:** Explore argument matching strategies in [Matchers Reference](../reference/matchers.md).
- **Actions:** Customize mock behavior in [Actions Reference](../reference/actions.md).
- **Organizing Tests:** Structure and manage tests in [Organizing and Managing Test Suites](../guides/core-workflows/organizing-tests).
- **Mocking Patterns:** Understand when and how to use mocks effectively in [Introduction to Mocking](../guides/mocking-patterns/introduction-to-mocking).

---

<Info>
For comprehensive macro and class reference, see the [Mocking Reference](../reference/mocking.md).
</Info>

---

## Appendix: Quick Syntax Summary

| Feature             | Syntax Example                                   |
|---------------------|------------------------------------------------|
| Define Mock Method   | `MOCK_METHOD(return_type, method_name, (args...), (specifiers));` |
| Set Expectation     | `EXPECT_CALL(mock, Method(args_matchers))...;`   |
| Set Default Action  | `ON_CALL(mock, Method(args_matchers)).WillByDefault(action);` |
| Suppress Warnings   | `NiceMock<MockClass> mock;`                       |
| Strict Mocks        | `StrictMock<MockClass> mock;`                     |
| Call Sequence       | `InSequence seq; EXPECT_CALL(...); EXPECT_CALL(...);` |
| Retire Expectation  | `.RetiresOnSaturation()`                          |

---

## Code Example: Complete Mocking Flow

```cpp
#include <gmock/gmock.h>
#include <gtest/gtest.h>

class Database {
 public:
  virtual ~Database() = default;
  virtual bool Connect(const std::string& url) = 0;
  virtual int Read(int id) = 0;
};

class MockDatabase : public Database {
 public:
  MOCK_METHOD(bool, Connect, (const std::string& url), (override));
  MOCK_METHOD(int, Read, (int id), (override));
};

TEST(MyAppTest, ReadsDataCorrectly) {
  MockDatabase mock_db;

  EXPECT_CALL(mock_db, Connect("mydb://localhost"))
      .WillOnce(testing::Return(true));
  EXPECT_CALL(mock_db, Read(42))
      .WillOnce(testing::Return(100));

  MyApp app(&mock_db);
  EXPECT_TRUE(app.Initialize("mydb://localhost"));
  EXPECT_EQ(app.GetData(42), 100);
}
```

---

## Troubleshooting Checklist

- If you see warnings about uninteresting calls:
  - Decide if the calls should be allowed or disallowed.
  - Add `ON_CALL()` defaults or use `NiceMock` to suppress noisy warnings.
- Unexpected calls indicate a mismatch between test expectations and actual usage.
- Verify destructors are virtual to avoid undefined behavior when deleting mock pointers.

---

<Callout title="Related Resources">
- [gMock for Dummies](../getting-started/basic-setup-first-test/using-googlemock) — Beginner-friendly introduction.
- [gMock Cookbook](../docs/gmock_cook_book.md) — Detailed recipes and patterns.
- [Mocking Reference](../reference/mocking.md) — Comprehensive API reference.
- [Matchers Reference](../reference/matchers.md) — How to match arguments.
- [Actions Reference](../reference/actions.md) — How to define mock method behaviors.
- [Organizing Tests](../guides/core-workflows/organizing-tests) — For managing complex test structures.
</Callout>

---

<Note>
This page focuses on mocking—defining mock classes and using mock objects to verify interaction behavior in tests. For usage of mocks in your wider test strategy, see introductory guides on mocking and test writing.
</Note>
