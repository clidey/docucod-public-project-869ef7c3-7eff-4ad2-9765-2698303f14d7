---
title: "Mock Strictness and Object Lifecycle"
description: "Explore the different mock object policies—NiceMock, StrictMock, and NaggyMock—and learn how to manage uninteresting calls and errors. See patterns for constructing and using these wrappers to fit various test strategies."
---

# Mock Strictness and Object Lifecycle

Explore how GoogleMock (gMock) manages mock object strictness policies—namely `NiceMock`, `NaggyMock`, and `StrictMock`—and learn effective patterns to control warnings or failures on uninteresting calls. Additionally, understand lifecycle management to avoid common pitfalls when mocks interact with test code or get deleted prematurely.

---

## 1. Understanding Mock Strictness Policies

GoogleMock provides three distinct mock policies that control how uninteresting calls (calls to mock methods without explicit expectations) behave:

- **NiceMock**: Silences warnings on uninteresting calls, allowing them silently without complaint.
- **NaggyMock**: (Default behavior) Prints warnings when uninteresting calls happen.
- **StrictMock**: Treats any uninteresting call as a test failure.

These policies are implemented as class templates wrapping your mock class:

```cpp
using ::testing::NiceMock;
using ::testing::NaggyMock;
using ::testing::StrictMock;

NiceMock<MockFoo> nice_foo;      // No warnings on uninteresting calls
NaggyMock<MockFoo> naggy_foo;    // Prints warnings on uninteresting calls (default)
StrictMock<MockFoo> strict_foo;  // Errors on uninteresting calls
```

### Why Use These Policies?

- Use **NiceMock** for cleaner test output when uninteresting method calls should be ignored.
- Use **NaggyMock** during test development to catch possible missing expectations without failing tests.
- Use **StrictMock** when you want rigorous test coverage and want to ensure no unexpected unplanned calls occur.

---

## 2. Practical Usage and Examples

### 2.1 Suppressing Warnings with `NiceMock`

```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, DoThis, (), ());
  MOCK_METHOD(int, Calculate, (int), ());
};

NiceMock<MockFoo> mock;

EXPECT_CALL(mock, DoThis());
mock.DoThis();        // Matches expectation
mock.Calculate(5);    // No warning despite no EXPECT_CALL
```

*Expected Behavior*: `NiceMock` silently ignores uninteresting calls like `Calculate` without warnings.

### 2.2 Warnings with `NaggyMock`

```cpp
NaggyMock<MockFoo> mock;

EXPECT_CALL(mock, DoThis());
mock.DoThis();        // Matches expectation
mock.Calculate(42);   // Prints a warning "Uninteresting mock function call"
```

### 2.3 Errors with `StrictMock`

```cpp
StrictMock<MockFoo> mock;

EXPECT_CALL(mock, DoThis());
mock.DoThis();        // Matches expectation
mock.Calculate(7);    // Test failure due to uninteresting call
```

---

## 3. Managing Uninteresting vs Unexpected Calls

- **Uninteresting Call:** No `EXPECT_CALL` has been set for this method; it's "uninteresting" to the test.
- **Unexpected Call:** The method has one or more `EXPECT_CALL`s, but none match the actual call arguments.

Policies affect **only uninteresting calls**:

- Unexpected calls always fail, regardless of policy.

**Best Practice**: Use `NiceMock` most of the time to avoid noisy warnings, reserve `StrictMock` for critical interfaces where unexpected calls are bugs.

---

## 4. Constructing Strictness-Wrapped Mocks

Strictness policies are wrappers around your mock class that "inherit" the constructors.

For example, given:

```cpp
class MockFoo {
 public:
  MockFoo(int n, const std::string& name);
  MOCK_METHOD(void, DoThis, (), ());
};

// You can create a nice mock passing constructor args:
NiceMock<MockFoo> mock(42, "hello");
```

This allows seamless substitution of mocks wrapped in `NiceMock`, `NaggyMock`, or `StrictMock`.

---

## 5. Allowing Mock Leaks to Avoid False Positives

Sometimes mocks outlive your test scope intentionally or are managed outside your code—for instance, persistent singletons, or mocks passed into other components.

To avoid false failure reports from gMock when mocks are leaked, explicitly mark mocks as "allowed to leak":

```cpp
Mock::AllowLeak(&mock_obj);
```

This disables lifetime verification and suppresses leaks-related errors for the specified mock.

---

## 6. Verifying and Clearing Expectations

GoogleMock validates all expectations of a mock on destruction. You can force earlier verification and clear expectations using:

```cpp
using ::testing::Mock;

ASSERT_TRUE(Mock::VerifyAndClearExpectations(&mock));
// Or verify and clear expectations *and* default actions
ASSERT_TRUE(Mock::VerifyAndClear(&mock));
```

After clearing, the mock can be reused with new expectations.

---

## 7. Mock Destruction and Calls in Destructor

If a mock calls its own methods (or other mocks) in its destructor, expectations set on those methods may cause warnings or failures if uninteresting or unexpected calls happen.

Example approach to test when mocks die:

```cpp
class MockFoo {
 public:
  MOCK_METHOD(void, Die, ());
  ~MockFoo() override { Die(); }
};
```

You can then set expectations on `Die()` to check mock object lifecycle.

---

## 8. Tips and Pitfalls

- `NiceMock`, `NaggyMock`, and `StrictMock` only reliably affect mock methods defined directly by `MOCK_METHOD` in the mock's immediate class.
- Nesting strictness wrappers (e.g., `NiceMock<StrictMock<MockFoo>>`) is not supported.
- Mocks without virtual destructors may behave unpredictably with these wrappers.
- Use `AllowLeak()` when mocks intentionally live beyond test lifespan.
- Uninteresting calls with non-default-constructible return types can throw exceptions on `NiceMock` and above.
- Policies do not affect the behavior of expected calls or argument mismatches.

---

## 9. Summary

This page focused strictly on controlling mock strictness policies and lifecycle management to enable smoother test experience, better debug info, and more control over unexpected/uninteresting mock calls.

---

## 10. Additional References

- [gMock Cheat Sheet: NiceMock, NaggyMock, StrictMock](https://github.com/google/googletest/blob/main/docs/gmock_cheat_sheet.md#the-nice-the-strict-and-the-naggy)
- [Mocking Reference: NiceMock, NaggyMock, StrictMock](https://github.com/google/googletest/blob/main/docs/reference/mocking.md#nicemock)
- [gMock Cookbook: Nice, Strict, and Naggy](https://github.com/google/googletest/blob/main/docs/gmock_cook_book.md#nice-strict-naggy)


---

## Code Example: Using StrictMock

```cpp
#include <gmock/gmock.h>

class MockDatabase {
 public:
  MOCK_METHOD(void, Connect, (), ());
  MOCK_METHOD(int, Query, (const std::string& query), ());
};

using ::testing::StrictMock;

TEST(DatabaseTest, StrictMockExample) {
  StrictMock<MockDatabase> mock_db;

  EXPECT_CALL(mock_db, Connect());
  mock_db.Connect();  // Ok

  mock_db.Query("SELECT *");  // Test failure: uninteresting call!
}
```

---

## Code Example: Suppressing Uninteresting Call Warnings

```cpp
#include <gmock/gmock.h>

class MockService {
 public:
  MOCK_METHOD(void, Initialize, (), ());
  MOCK_METHOD(void, DoWork, (), ());
};

using ::testing::NiceMock;

TEST(ServiceTest, NiceMockSuppressesWarnings) {
  NiceMock<MockService> mock_service;

  EXPECT_CALL(mock_service, Initialize());
  mock_service.Initialize();   // Expected call

  mock_service.DoWork();       // No warning, uninteresting call ignored
}
```

---

## Summary

The `Mock Strictness and Object Lifecycle` page guides users through managing uninteresting call policies with `NiceMock`, `NaggyMock`, and `StrictMock` wrappers. It presents practical scenarios illustrating how each affects test behavior, methods to allow mock leaks intentionally, and patterns for verifying and clearing mock expectations. Users gain confidence in controlling noisy warnings versus strict failure and understanding lifecycle considerations when mocks call each other during destruction.

---