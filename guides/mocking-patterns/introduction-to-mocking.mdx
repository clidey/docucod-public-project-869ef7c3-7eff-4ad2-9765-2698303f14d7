---
title: "Introduction to Mocking with GoogleMock"
description: "An approachable introduction to GoogleMock explaining what mocking is, when to use it, and how to define and use mock classes to simulate dependencies in your tests."
---

# Introduction to Mocking with GoogleMock

## Workflow Overview

### Task Description
This guide introduces you to GoogleMock, Google's C++ mocking framework. It explains what mocking is, why and when to use it in your tests, and provides practical steps for defining and using mock classes to simulate dependencies effectively.

### Prerequisites
- Basic familiarity with C++ programming
- Understanding of virtual functions and interfaces
- A configured project with GoogleTest and GoogleMock installed and ready

### Expected Outcome
After following this guide, you will understand the principles of mocking, how to create mock classes using GoogleMock's macros, and how to integrate these mocks into your tests to check interactions between components.

### Time Estimate
Approximately 20-30 minutes.

### Difficulty Level
Beginner to Intermediate


## 1. Understanding Mocking

### What Is Mocking?
Mocking allows you to create stand-in objects (mock objects) that simulate the behavior of real dependencies in your code. These mock objects:

- Implement the same interface as the real objects
- Allow you to specify at runtime which methods will be called, how many times, with which arguments, and what they should return
- Enable tests that verify *interactions* with dependencies rather than just end-state or output

### When to Use Mocking?
Use mocking when:

- Your module depends on external systems or complex components hard to reproduce or control in tests (e.g., databases, network, hardware)
- You want to isolate the unit under test by removing its dependencies
- You need to simulate specific behaviors or failures of collaborators
- You want fast, reliable, and maintainable tests focusing on behavior and interaction


## 2. Defining Mock Classes

GoogleMock simplifies creating mock classes via the `MOCK_METHOD` macro.

### Step-by-Step Mock Class Definition

1. **Derive from the Interface or Base Class** you want to mock. It must have virtual methods.
2. **Use `MOCK_METHOD` to mock each virtual method** you want to simulate in tests.
   - Syntax:

   ```cpp
   MOCK_METHOD(ReturnType, MethodName, (Args...), (Qualifiers));
   ```

3. Qualifiers include `const`, `override`, `noexcept`, calling conventions, or reference qualifiers.

### Example
Suppose you have this interface:

```cpp
class Turtle {
 public:
  virtual ~Turtle() {}
  virtual void PenUp() = 0;
  virtual void PenDown() = 0;
  virtual void Forward(int distance) = 0;
  virtual int GetX() const = 0;
};
```

You can mock it like this:

```cpp
#include <gmock/gmock.h>

class MockTurtle : public Turtle {
 public:
  MOCK_METHOD(void, PenUp, (), (override));
  MOCK_METHOD(void, PenDown, (), (override));
  MOCK_METHOD(void, Forward, (int distance), (override));
  MOCK_METHOD(int, GetX, (), (const, override));
};
```

### Tips for Defining Mock Classes
- Put the mock class in a location accessible to your tests.
- Always ensure the original base class destructor is virtual for safe mocking.
- You can mock overloaded methods by declaring each overload.
- Use type aliases or parentheses in `MOCK_METHOD` argument and return types if they contain commas.


## 3. Using Mock Objects in Tests

Once your mock class is ready, here’s how to effectively use it in your test cases.

### Workflow

1. **Import GoogleMock name symbols:**

```cpp
using ::testing::Return;
using ::testing::_;  // wildcard matcher
```

2. **Create mock object instances:**

```cpp
MockTurtle mock_turtle;
```

3. **Set up default actions (optional):**

Use `ON_CALL` to specify default behaviors when calls are not explicitly expected.

```cpp
ON_CALL(mock_turtle, GetX()).WillByDefault(Return(100));
```

4. **Set your expectations:**

Specify which mock methods will be called, with what arguments, how many times, and their behaviors.

```cpp
EXPECT_CALL(mock_turtle, PenDown()).Times(AtLeast(1));
EXPECT_CALL(mock_turtle, Forward(10)).WillOnce(Return());
```

5. **Execute the code under test** that interacts with the mock objects.
6. **Automatic verification of expectations** occurs when the mock object is destructed.

### Example Test

```cpp
#include <gtest/gtest.h>
#include <gmock/gmock.h>

using ::testing::AtLeast;
using ::testing::Return;
using ::testing::_;

class Painter {
 public:
  explicit Painter(Turtle* turtle) : turtle_(turtle) {}
  bool DrawCircle(int x, int y, int radius) {
    turtle_->PenDown();
    turtle_->Forward(radius);
    // ... more drawing ...
    return true;
  }
 private:
  Turtle* turtle_;
};

TEST(PainterTest, DrawsCircle) {
  MockTurtle mock_turtle;

  EXPECT_CALL(mock_turtle, PenDown()).Times(AtLeast(1));
  EXPECT_CALL(mock_turtle, Forward(_));

  Painter painter(&mock_turtle);
  EXPECT_TRUE(painter.DrawCircle(0, 0, 10));
}
```

If `PenDown()` or `Forward()` is not called as expected, the test fails immediately with a detailed error.

### Mock Strictness Levels

- **NaggyMock (default):** Warns on uninteresting calls (calls with no expectations).
- **NiceMock:** Suppresses warnings on uninteresting calls.
- **StrictMock:** Treats uninteresting calls as errors.

Usage:

```cpp
using ::testing::NiceMock;
NiceMock<MockTurtle> nice_mock_turtle;
```

Choose strictness based on how strict your verification needs to be.


## 4. Practical Tips and Best Practices

- **Set expectations *before* exercising your mock in tests.** Setting expectations after the mock methods are called leads to undefined behavior.
- **Use matchers to specify argument expectations precisely but not overly specifically.** Use `_` to ignore arguments where possible.
- **Use `.Times()` to specify call counts explicitly** when needed or rely on inferred cardinalities.
- **Use sequences (`InSequence`) to enforce call order** when the order matters.
- **Combine expectations with `RetiresOnSaturation()`** to deactivate expectations once saturated if needed.
- **Leverage `ON_CALL` for default mock behaviors** without requiring calls.
- **Avoid mocking non-virtual functions unless using special techniques.**
- **Leverage delegation to fakes or real objects** if default implementations exist and suit most cases.
- **Keep tests focused and avoid over-specifying mocks to reduce brittleness.**


## 5. Troubleshooting & Common Issues

### My Mock Method Calls the Real Method Instead
Ensure the method you mock is declared `virtual` in the base class.

### Compiler Warnings on `const` Parameters
C++ ignores top-level `const` in parameters. To avoid warnings in MSVC, remove redundant `const` qualifiers in parameters.

### Uninteresting Call Warnings
These occur when a mock method with no expectation is called. Use `NiceMock` to suppress or add explicit expectations if the call should be allowed.

### Order of Expectation Matching
Remember, gMock matches the most recently defined matching expectation. Place more specific expectations **after** general ones.

### Mock Object Not Being Destroyed
If your mock is on the heap and not deleted properly, final verification will not occur. Consider verifying explicitly or using heap checkers.

### Over-Specified or Fragile Tests
Avoid too strict argument matching or call order unless necessary. This reduces false failures due to implementation changes.


## 6. Useful References & Next Steps

- **GoogleMock for Dummies** – A comprehensive beginner’s guide with many examples
- **Mocking Cheat Sheet** – Quick reference for mocking macros, matchers, actions
- **Mocking Cookbook** – Recipes for advanced mocking scenarios and tips
- **Matchers Reference** – Details on how to specify argument matchers
- **Actions Reference** – How to specify behavior for mock methods
- **Defining and Using Mock Objects** – Next guide for deeper usage


## Summary
GoogleMock empowers you to create mock classes and verify interactions with dependencies in your tests. Starting with simple definitions using the `MOCK_METHOD` macro and expectations with `EXPECT_CALL`, you can control mock behaviors and calls precisely. Remember to write expectations before you use mocks, use matchers sensibly for argument verification, and employ strictness levels and sequences to enforce test correctness.


---

# Quick Reference

```cpp
#include <gmock/gmock.h>

class MockFoo : public Foo {
 public:
  MOCK_METHOD(int, GetValue, (), (const, override));
  MOCK_METHOD(void, SetValue, (int val), (override));
};

using ::testing::Return;
using ::testing::_;

TEST(FooTest, UsesMock) {
  MockFoo mock;

  // Default action
  ON_CALL(mock, GetValue()).WillByDefault(Return(42));

  // Set expectations
  EXPECT_CALL(mock, SetValue(10)).Times(1);
  EXPECT_CALL(mock, GetValue()).Times(AtLeast(1));

  mock.SetValue(10);
  int val = mock.GetValue();
  ASSERT_EQ(val, 42);
}
```

---

# Notes
- Make sure destructors in interfaces are virtual.
- Use `NiceMock<T>` or `StrictMock<T>` to customize uninteresting call handling.
- Use `INVOKE`/`WillOnce` lambdas or actions for customized side-effect simulations.
- Write tests declaratively to express behavior expectations clearly.


## Helpful Links
- [GoogleMock for Dummies](https://google.github.io/googletest/gmock_for_dummies.html)
- [Mocking Cheat Sheet](https://google.github.io/googletest/gmock_cheat_sheet.html)
- [Mocking Cookbook](https://google.github.io/googletest/gmock_cook_book.html)
- [Matchers Reference](https://google.github.io/googletest/reference/matchers.html)
- [Actions Reference](https://google.github.io/googletest/reference/actions.html)
