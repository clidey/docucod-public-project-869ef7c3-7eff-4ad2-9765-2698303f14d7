---
title: "Using Assertions and Matchers Effectively"
description: "Explore the full spectrum of built-in assertions and matchers, harness matcher libraries, and define custom matchers for domain-specific testing. This guide helps users express test intent clearly and capture complex expectations."
---

# Using Assertions and Matchers Effectively

This guide empowers you to harness GoogleTest’s assertion macros and GoogleMock’s powerful matcher library to clearly express your test expectations. It helps you verify code behavior concisely while creating expressive tests that capture complex conditions and interactions.

---

## 1. Assertion Macros: Verifying Test Results

GoogleTest provides a rich set of assertion macros to verify conditions in your tests. Each assertion can generate a **fatal** or **nonfatal** failure:

- `ASSERT_` macros: Fatal failures stop the current test function immediately.
- `EXPECT_` macros: Nonfatal failures allow the test function to continue.

Use assertions based on *what you want to verify* and *how critical* the check is.

### Common Boolean Assertions

| Macro          | Description                                   |
|----------------|-----------------------------------------------|
| `EXPECT_TRUE(cond)` / `ASSERT_TRUE(cond)`   | Verifies that `cond` is true.                 |
| `EXPECT_FALSE(cond)` / `ASSERT_FALSE(cond)` | Verifies that `cond` is false.                |

Example:
```cpp
EXPECT_TRUE(IsPrime(11)) << "11 should be prime";
ASSERT_FALSE(IsPrime(4));
```

### Binary Comparison Assertions

Compare two values using operators like `==`, `!=`, `<`, `<=`, `>`, and `>=`:

| Macro          | Equivalent To      | Checks that...                              |
|----------------|--------------------|--------------------------------------------|
| `EXPECT_EQ(a,b)` / `ASSERT_EQ(a,b)` | `a == b`           | `a` equals `b`.                           |
| `EXPECT_NE(a,b)` / `ASSERT_NE(a,b)` | `a != b`           | `a` is not equal to `b`.                   |
| `EXPECT_LT(a,b)` / `ASSERT_LT(a,b)` | `a < b`            | `a` is less than `b`.                      |
| `EXPECT_LE(a,b)` / `ASSERT_LE(a,b)` | `a <= b`           | `a` is less than or equal to `b`.          |
| `EXPECT_GT(a,b)` / `ASSERT_GT(a,b)` | `a > b`            | `a` is greater than `b`.                   |
| `EXPECT_GE(a,b)` / `ASSERT_GE(a,b)` | `a >= b`           | `a` is greater than or equal to `b`.       |

**Important:** To compare C strings *by value* rather than by pointer equality, use [`EXPECT_STREQ`](#string-comparison) instead.

### Floating-Point Comparisons

Floating-point types require approximate comparisons due to rounding errors:

- `EXPECT_FLOAT_EQ(a, b)` / `ASSERT_FLOAT_EQ(a, b)`: Approximate equality for `float`.
- `EXPECT_DOUBLE_EQ(a, b)` / `ASSERT_DOUBLE_EQ(a, b)`: Approximate equality for `double`.
- `EXPECT_NEAR(val1, val2, abs_error)` / `ASSERT_NEAR(val1, val2, abs_error)`: Custom absolute error margin.

Example:
```cpp
EXPECT_NEAR(computed_pi, 3.14159, 1e-5);
```

### String Comparisons

C strings are compared by pointer equality by default. To compare contents, use:

- `EXPECT_STREQ(str1, str2)` / `ASSERT_STREQ(str1, str2)`: Equal content.
- `EXPECT_STRNE(str1, str2)` / `ASSERT_STRNE(str1, str2)`: Different content.
- `EXPECT_STRCASEEQ(str1, str2)` / `ASSERT_STRCASEEQ(str1, str2)`: Equal ignoring case.
- `EXPECT_STRCASENE(str1, str2)` / `ASSERT_STRCASENE(str1, str2)`: Different ignoring case.

Example:
```cpp
EXPECT_STREQ(GetName(), "John");
```

### Exception Assertions

Verify exception throwing behavior:

- `EXPECT_THROW(statement, exception_type)` / `ASSERT_THROW`: asserts the statement throws a specific exception.
- `EXPECT_ANY_THROW(statement)` / `ASSERT_ANY_THROW`: asserts statement throws any exception.
- `EXPECT_NO_THROW(statement)` / `ASSERT_NO_THROW`: asserts statement does not throw.

Example:
```cpp
EXPECT_THROW(FunctionThatThrows(), std::runtime_error);
```

### Explicit Success and Failure

- `SUCCEED()`: Generates a success (mostly for documentation).
- `FAIL()`: Generates a fatal failure.
- `ADD_FAILURE()`: Generates a nonfatal failure.
- `ADD_FAILURE_AT(file, line)`: Logs failure at specific source location.

Use these to explicitly mark unexpected code paths or control flow.

---

## 2. Matchers: Expressing Flexible Expectations

Matchers allow you to specify *patterns* for allowed argument values, improving test expressiveness and robustness.

### Basic Wildcard

- `_`: Matches any value regardless of type.

Example:
```cpp
EXPECT_CALL(mock_obj, Foo(_));  // Accept any argument.
```

### Built-in Matchers

| Matcher       | Description                                  |
|---------------|----------------------------------------------|
| `Eq(value)`   | Equal to `value`                             |
| `Ne(value)`   | Not equal                                   |
| `Lt(value)`   | Less than                                   |
| `Le(value)`   | Less than or equal                          |
| `Gt(value)`   | Greater than                                |
| `Ge(value)`   | Greater or equal                            |
| `Not(matcher)`| Negates the matcher                         |
| `Any<T>()`    | Matches any value of type `T`               |
| `IsNull()`    | Matches a null pointer                       |
| `NotNull()`   | Matches any non-null pointer                 |

Example:
```cpp
EXPECT_CALL(mock, ProcessData(Ge(10)));  // Argument >= 10
```

### Combining Matchers

Use combinators for complex conditions:

- `AllOf(m1, m2, ...)`: matches if all matchers match.
- `AnyOf(m1, m2, ...)`: matches if any one matcher matches.
- `Not(m)`: negates matcher `m`.

Example:
```cpp
EXPECT_CALL(mock, Foo(AllOf(Ge(0), Ne(5))));  // >=0 and !=5
```

### Multi-Argument Matchers with `.With()`

The `.With()` clause allows you to constrain the entire argument tuple of a function call:

```cpp
EXPECT_CALL(mock, SetPosition(_, _))
    .With(Lt());  // First arg less than second.
```

This allows expressing relationships between arguments, not just per-argument checks.

### Matching Containers

For STL-like containers:

- `ElementsAre(...)`: Tests *ordered* element matches.
- `UnorderedElementsAre(...)`: Tests elements ignoring order.
- `Contains(matcher)`: At least one element matches.
- `Each(matcher)`: All elements match.

Example:
```cpp
EXPECT_CALL(mock, ProcessVector(ElementsAre(1, 2, 3)));
EXPECT_CALL(mock, ProcessSet(UnorderedElementsAre(1, 2, 3)));
```

### Member Access Matching

You can match object members or properties with:

- `Field(&Type::member, matcher)`: Matches member variable.
- `Property(&Type::getter, matcher)`: Matches via getter method.

Example:
```cpp
EXPECT_CALL(mock, Handle(FooArg))
    .With(Field(&Foo::id, Eq(42)))
    .WillOnce(Return(true));
```

### Pointer Indirection Matching

- `Pointee(matcher)`: Matches pointers pointing to values matching `matcher`.

Example:
```cpp
EXPECT_CALL(mock, Foo(Pointee(Ne(nullptr))));  // Non-null pointer.
```

### Custom Matchers

Define your own matcher with `MATCHER` macros for domain-specific logic.

Basic example:
```cpp
MATCHER(IsDivisibleBy7, "") { return (arg % 7) == 0; }
EXPECT_CALL(mock, Func(IsDivisibleBy7()));
```

You can customize failure messages and parameterize matchers using `MATCHER_P` and related macros.

Full details are in the [Writing New Matchers Quickly](../gmock_cook_book.md#NewMatchers) section.

---

## 3. Assertions with Matchers

GoogleTest provides assertion macros that accept matchers to assert flexible conditions.

- `EXPECT_THAT(value, matcher)` — Nonfatal assertion with matcher.
- `ASSERT_THAT(value, matcher)` — Fatal assertion with matcher.

Example:
```cpp
EXPECT_THAT(value, StartsWith("hello"));
ASSERT_THAT(numbers, ElementsAre(1, 2, 3));
```

These allow you to verify complex expressions elegantly.

---

## 4. Best Practices & Tips

- **Prefer `EXPECT_` assertions over `ASSERT_`** where possible to allow more comprehensive test execution.
- **Use matchers rather than exact values** to make tests more resilient to changes.
- **Don’t over-specify arguments**; match only what your test truly needs.
- **Use `.With()` to express inter-argument relationships** cleanly.
- **Use sequences and `InSequence` to test call ordering** rather than fragile positional logic.
- **Define custom matchers** to encapsulate commonly repeated validation logic.
- **Use built-in container and string matchers** rather than custom code.
- **Avoid side effects in matchers** to prevent undefined behaviors.

---

## 5. Troubleshooting Common Issues

### Assertion Failures

- Check the failure messages to identify which expectation was unmet or which matcher failed.
- Use `--gmock_verbose=info` to get detailed traces of mock calls and expectation matches.

### Comparing C Strings

- Use `EXPECT_STREQ` for comparing C-string content, NOT `EXPECT_EQ`.

### Matcher Type Mismatches

- Use `SafeMatcherCast<T>(m)` if you need to match arguments of a different but compatible type.

### Unexpected vs Uninteresting Calls

- Unexpected calls (calls matching no `EXPECT_CALL`) always fail.
- Uninteresting calls (no expectation set) produce warnings or can be controlled via mock strictness modes.

### Over-saturated Calls

- Too many calls to a mock function than expected generate nonfatal failures.
- Use `.RetiresOnSaturation()` to auto-retire expectations.

---

## 6. Next Steps & Related Content

- Dive into [Matchers Reference](reference/matchers.md) for deeper understanding of matchers.
- Explore [Mocking Reference](reference/mocking.md) to master mock class creation and expectations.
- Learn about [Actions and Cardinalities](reference/actions-and-cardinalities.md) to control mock behavior.
- Visit the [gMock Cookbook](guides/mocking-techniques-integration/gmock_cook_book.md) for recipes and advanced techniques.
- Consult [Writing Scalable and Maintainable Tests](guides/advanced-testing-and-best-practices/maintainable-tests.md) to improve your test design.

---

## 7. Example Usage

```cpp
#include <gmock/gmock.h>
using ::testing::;

class MockTurtle {
 public:
  MOCK_METHOD(void, PenUp, (), ());
  MOCK_METHOD(void, GoTo, (int x, int y), ());
  MOCK_METHOD(int, GetX, (), (const));
};

TEST(PaintTest, TurtleMovesCorrectly) {
  MockTurtle turtle;

  EXPECT_CALL(turtle, PenUp());
  EXPECT_CALL(turtle, GoTo(50, _));
  EXPECT_CALL(turtle, GetX())
      .Times(2)
      .WillOnce(Return(50))
      .WillRepeatedly(Return(100));

  turtle.PenUp();
  turtle.GoTo(50, 100);
  EXPECT_EQ(turtle.GetX(), 50);
  EXPECT_EQ(turtle.GetX(), 100);
}
```

---

This example shows using simple matchers (`_`), specifying call counts with `Times()`, and setting return values with `WillOnce` and `WillRepeatedly`.

<Tip>
Always place `EXPECT_CALL` before exercising the mocks to avoid undefined behavior.
</Tip>
